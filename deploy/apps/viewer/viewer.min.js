(function(f){var k=function(){var k=65,ha={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!1},M=function(b,c){var h=R(b);h.r=Math.round(1E3*Math.pow(h.r/255,2.2))/1E3;h.g=Math.round(1E3*Math.pow(h.g/255,2.2))/1E3;h.b=Math.round(1E3*Math.pow(h.b/255,2.2))/1E3;f(c).data("colorpicker").fields.eq(1).val(h.r).end().eq(2).val(h.g).end().eq(3).val(h.b).end()},E=function(b,c){f(c).data("colorpicker").fields.eq(4).val(b.h).end().eq(5).val(b.s).end().eq(6).val(b.b).end()},
N=function(b,c){f(c).data("colorpicker").fields.eq(0).val(I(b)).end()},F=function(b,c){f(c).data("colorpicker").selector.css("backgroundColor","#"+I({h:b.h,s:100,b:100}));f(c).data("colorpicker").selectorIndic.css({left:parseInt(150*b.s/100,10),top:parseInt(150*(100-b.b)/100,10)})},U=function(b,c){f(c).data("colorpicker").hue.css("top",parseInt(150-150*b.h/360,10))},Y=function(b,c){f(c).data("colorpicker").currentColor.css("backgroundColor","#"+I(b))},O=function(b,c){f(c).data("colorpicker").newColor.css("backgroundColor",
"#"+I(b))},qa=function(b){b=b.charCode||b.keyCode||-1;if(b>k&&90>=b||32==b)return!1;!0===f(this).parent().parent().data("colorpicker").livePreview&&B.apply(this)},B=function(b){var c=f(this).parent().parent(),h;if(0<this.parentNode.className.indexOf("_hex")){h=c.data("colorpicker");var r=this.value,k=6-r.length;if(0<k){for(var w=[],B=0;B<k;B++)w.push("0");w.push(r);r=w.join("")}r=x(Z(r));h.color=h=r}else 0<this.parentNode.className.indexOf("_hsb")?c.data("colorpicker").color=h=aa({h:parseInt(c.data("colorpicker").fields.eq(4).val(),
10),s:parseInt(c.data("colorpicker").fields.eq(5).val(),10),b:parseInt(c.data("colorpicker").fields.eq(6).val(),10)}):(h=c.data("colorpicker"),r=parseInt(c.data("colorpicker").fields.eq(1).val(),10),k=parseInt(c.data("colorpicker").fields.eq(2).val(),10),w=parseInt(c.data("colorpicker").fields.eq(3).val(),10),r={r:Math.min(255,Math.max(0,r)),g:Math.min(255,Math.max(0,k)),b:Math.min(255,Math.max(0,w))},h.color=h=x(r));b&&(M(h,c.get(0)),N(h,c.get(0)),E(h,c.get(0)));F(h,c.get(0));U(h,c.get(0));O(h,c.get(0));
c.data("colorpicker").onChange.apply(c,[h,I(h),R(h)])},ra=function(b){f(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus")},sa=function(){k=0<this.parentNode.className.indexOf("_hex")?70:65;f(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus");f(this).parent().addClass("colorpicker_focus")},ja=function(b){var c=f(this).parent().find("input").focus();b={el:f(this).parent().addClass("colorpicker_slider"),max:0<this.parentNode.className.indexOf("_hsb_h")?
360:0<this.parentNode.className.indexOf("_hsb")?100:255,y:b.pageY,field:c,val:parseInt(c.val(),10),preview:f(this).parent().parent().data("colorpicker").livePreview};f(document).bind("mouseup",b,ia);f(document).bind("mousemove",b,ba)},ba=function(b){b.data.field.val(Math.max(0,Math.min(b.data.max,parseInt(b.data.val+b.pageY-b.data.y,10))));b.data.preview&&B.apply(b.data.field.get(0),[!0]);return!1},ia=function(b){B.apply(b.data.field.get(0),[!0]);b.data.el.removeClass("colorpicker_slider").find("input").focus();
f(document).unbind("mouseup",ia);f(document).unbind("mousemove",ba);return!1},ta=function(b){b.preventDefault();b={cal:f(this).parent(),y:f(this).offset().top};b.preview=b.cal.data("colorpicker").livePreview;f(document).bind("mouseup touchend",b,ka);f(document).bind("mousemove touchmove",b,la)},la=function(b){var c=b;"undefined"!==typeof event&&event.touches&&(c=event.touches[0]);B.apply(b.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,c.pageY-b.data.y)))/
150,10)).get(0),[b.data.preview]);return!1},ka=function(b){M(b.data.cal.data("colorpicker").color,b.data.cal.get(0));N(b.data.cal.data("colorpicker").color,b.data.cal.get(0));f(document).unbind("mouseup touchend",ka);f(document).unbind("mousemove touchmove",la);return!1},ua=function(b){b.preventDefault();b={cal:f(this).parent(),pos:f(this).offset()};b.preview=b.cal.data("colorpicker").livePreview;f(document).bind("mouseup touchend",b,ma);f(document).bind("mousemove touchmove",b,ca)},ca=function(b){var c=
b;"undefined"!==typeof event&&event.touches&&(c=event.touches[0]);B.apply(b.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,c.pageY-b.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,c.pageX-b.data.pos.left))/150,10)).get(0),[b.data.preview]);return!1},ma=function(b){M(b.data.cal.data("colorpicker").color,b.data.cal.get(0));N(b.data.cal.data("colorpicker").color,b.data.cal.get(0));f(document).unbind("mouseup touchend",ma);f(document).unbind("mousemove touchmove",
ca);return!1},va=function(b){f(this).addClass("colorpicker_focus")},wa=function(b){f(this).removeClass("colorpicker_focus")},xa=function(b){b=f(this).parent();var c=b.data("colorpicker").color;b.data("colorpicker").origColor=c;Y(c,b.get(0));b.data("colorpicker").onSubmit(c,I(c),R(c),b.data("colorpicker").el)},ya=function(b){var c=f("body"),h=c.data("colorpickerId"),r=f(this).data("colorpickerId");h&&h===r?(f(document).trigger("mousedown"),c.data("colorpickerId",null)):(na.call(this,b),c.data("colorpickerId",
r))},na=function(b){var c,h,r=f("#"+f(this).data("colorpickerId"));r.data("colorpicker").onBeforeShow.apply(this,[r.get(0)]);var k=f(this).offset(),w="CSS1Compat"==document.compatMode;b=window.pageXOffset||(w?document.documentElement.scrollLeft:document.body.scrollLeft);c=window.pageYOffset||(w?document.documentElement.scrollTop:document.body.scrollTop);h=window.innerWidth||(w?document.documentElement.clientWidth:document.body.clientWidth);var x=k.top+this.offsetHeight,k=k.left;x+176>c+(window.innerHeight||
(w?document.documentElement.clientHeight:document.body.clientHeight))&&(x-=this.offsetHeight+176);k+356>b+h&&(k=Math.max(0,k-356));r.css({left:k+"px",top:x+"px"});0!=r.data("colorpicker").onShow.apply(this,[r.get(0)])&&r.show();f(document).bind("mousedown",{cal:r},oa);return!1},oa=function(b){za(b.data.cal.get(0),b.target,b.data.cal.get(0))||(0!=b.data.cal.data("colorpicker").onHide.apply(this,[b.data.cal.get(0)])&&b.data.cal.hide(),f(document).unbind("mousedown",oa))},za=function(b,c,h){if(b==c)return!0;
if(b.contains)return b.contains(c);if(b.compareDocumentPosition)return!!(b.compareDocumentPosition(c)&16);for(c=c.parentNode;c&&c!=h;){if(c==b)return!0;c=c.parentNode}return!1},aa=function(b){return{h:Math.round(Math.min(360,Math.max(0,b.h))),s:Math.round(Math.min(100,Math.max(0,b.s))),b:Math.round(Math.min(100,Math.max(0,b.b)))}},Z=function(b){b=parseInt(-1<b.indexOf("#")?b.substring(1):b,16);return{r:b>>16,g:(b&65280)>>8,b:b&255}},x=function(b){var c={h:0,s:0,b:0},h=Math.min(b.r,b.g,b.b),f=Math.max(b.r,
b.g,b.b),h=f-h;c.b=f;c.s=0!=f?255*h/f:0;c.h=0!=c.s?b.r==f?(b.g-b.b)/h:b.g==f?2+(b.b-b.r)/h:4+(b.r-b.g)/h:-1;c.h*=60;0>c.h&&(c.h+=360);c.s*=100/255;c.b*=100/255;c.h=Math.round(c.h);c.s=Math.round(c.s);c.b=Math.round(c.b);return c},R=function(b){var c,h,f;c=Math.round(b.h);var k=Math.round(255*b.s/100);b=Math.round(255*b.b/100);if(0==k)c=h=f=b;else{var k=(255-k)*b/255,w=c%60*(b-k)/60;360==c&&(c=0);60>c?(c=b,f=k,h=k+w):120>c?(h=b,f=k,c=b-w):180>c?(h=b,c=k,f=k+w):240>c?(f=b,c=k,h=b-w):300>c?(f=b,h=k,
c=k+w):360>c?(c=b,h=k,f=b-w):f=h=c=0}return{r:Math.round(c),g:Math.round(h),b:Math.round(f)}},da=function(b){var c=[b.r.toString(16),b.g.toString(16),b.b.toString(16)];f.each(c,function(b,f){1==f.length&&(c[b]="0"+f)});return c.join("")},I=function(b){return da(R(b))},Aa=function(){var b=f(this).parent(),c=b.data("colorpicker").origColor;b.data("colorpicker").color=c;M(c,b.get(0));N(c,b.get(0));E(c,b.get(0));F(c,b.get(0));U(c,b.get(0));O(c,b.get(0))};return{init:function(b){b=f.extend({},ha,b||{});
if("string"==typeof b.color)b.color=x(Z(b.color));else if(void 0!=b.color.r&&void 0!=b.color.g&&void 0!=b.color.b)b.color=x(b.color);else if(void 0!=b.color.h&&void 0!=b.color.s&&void 0!=b.color.b)b.color=aa(b.color);else return this;return this.each(function(){if(!f(this).data("colorpickerId")){var c=f.extend({},b);c.origColor=b.color;var h="collorpicker_"+parseInt(1E3*Math.random());f(this).data("colorpickerId",h);h=f('<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>').attr("id",
h);c.flat?h.appendTo(this).show():h.appendTo(document.body);c.fields=h.find("input").bind("keyup",qa).bind("change",B).bind("blur",ra).bind("focus",sa);h.find("span").bind("mousedown touchstart",ja).end().find(">div.colorpicker_current_color").bind("click",Aa);c.selector=h.find("div.colorpicker_color").bind("touchstart mousedown",ua);c.selectorIndic=c.selector.find("div div");c.el=this;c.hue=h.find("div.colorpicker_hue div");h.find("div.colorpicker_hue").bind("mousedown touchstart",ta);c.newColor=
h.find("div.colorpicker_new_color");c.currentColor=h.find("div.colorpicker_current_color");h.data("colorpicker",c);h.find("div.colorpicker_submit").bind("mouseenter touchstart",va).bind("mouseleave touchend",wa).bind("click",xa);M(c.color,h.get(0));E(c.color,h.get(0));N(c.color,h.get(0));U(c.color,h.get(0));F(c.color,h.get(0));Y(c.color,h.get(0));O(c.color,h.get(0));c.flat?h.css({position:"relative",display:"block"}):f(this).bind(c.eventName,ya)}})},showPicker:function(){return this.each(function(){f(this).data("colorpickerId")&&
na.apply(this)})},hidePicker:function(){return this.each(function(){f(this).data("colorpickerId")&&f("#"+f(this).data("colorpickerId")).hide()})},setColor:function(b){if("string"==typeof b)b=x(Z(b));else if(void 0!=b.r&&void 0!=b.g&&void 0!=b.b)b=x(b);else if(void 0!=b.h&&void 0!=b.s&&void 0!=b.b)b=aa(b);else return this;return this.each(function(){if(f(this).data("colorpickerId")){var c=f("#"+f(this).data("colorpickerId"));c.data("colorpicker").color=b;c.data("colorpicker").origColor=b;M(b,c.get(0));
E(b,c.get(0));N(b,c.get(0));U(b,c.get(0));F(b,c.get(0));Y(b,c.get(0));O(b,c.get(0))}})}}}();f.fn.extend({ColorPicker:k.init,ColorPickerHide:k.hidePicker,ColorPickerShow:k.showPicker,ColorPickerSetColor:k.setColor})})(jQuery);b4w.register("viewer_main",function(f,k){function Va(a,d){if(!d)return console.log("b4w init failure"),null;window.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1};window.ondragstart=function(a){a.preventDefault();a.stopPropagation();return!1};u.enable_controls();window.addEventListener("resize",oa,!1);var c=document.createEvent("CustomEvent");c.initEvent("resize",!1,!1);window.dispatchEvent(c);J.detect_mobile()||m(["gyro_use"],"disable");var C=u.get_url_params();Ia.enqueue([["manifest",
Ia.AT_JSON,"assets.json"]],function(a,d,c,Ba){G=a;pa=document.getElementById("info_left_down");z=document.getElementById("lights_cont");document.getElementById("build_date").innerHTML=Ja.date();e(ta,"quality","string");switch(y.get("quality")){case y.P_ULTRA:var f=0;break;case y.P_HIGH:f=1;break;case y.P_LOW:f=2;break;case y.P_CUSTOM:f=3}document.getElementById("quality").options[f].selected=!0;$("#quality").selectmenu("refresh");u.set_onclick("reset_memory",la);u.set_onclick("auto_rotate_cam",Ya);
u.set_onclick("pause",ka);u.set_onclick("resume",ua);u.set_onclick("auto_view",na);a=document.getElementById("manifest");if(G){c="";d=(d=u.get_url_params())&&d.load?d.load.split("/"):["dev","logo.json"];d="Home ("+d[d.length-1]+")";c=c+"<div class='min_font' id='default_scene'>"+("<h6 class='ui-collapsible-heading'><a class='ui-mini ui-btn ui-btn-icon-right ui-icon-home'>"+d+"</a></h6>");c+="</div>";for(d=0;d<G.length;d++){f=G[d];Ba=f.name;for(var f=f.items,g="",g=g+"<div data-role='collapsible' data-mini='true' >",
g=g+("<h6>"+Ba+"</h6>"),g=g+"<ul data-role='listview' data-mini='true' data-inset='true' style='margin: -10px 0;'>",k=0;k<f.length;k++)var l=f[k].name,g=g+("<li data-mini='true'><a href='#' class='min_font' id='"+("MANIFEST_ITEM_"+l+"__SEPARATOR__"+Ba)+"'>"+l+"</a></li>");g+="</ul>";g+="</div>";c+=g}$("#"+a.id).append(c);$("#"+a.id).trigger("create");a.addEventListener("mouseup",Y,!1)}else a.innerHTML="<p style='color: red;'>Failed loading scenes list.</p><p>Maybe a syntax error?</p>";U();e(x,"anim_active_object",
"string");e(x,"animation","string");e(x,"anim_mix_factor","number");e(x,"anim_slot","number");e(x,"anim_cyclic","bool");e(x,"anim_frame_current","number");u.set_onclick("anim_play",za);u.set_onclick("anim_stop",aa);u.set_onclick("get_max_bones",Z);e(S,"material_name","string");K(S,"material_diffuse_color");e(S,"material_reflectivity","number");e(S,"material_fresnel","number");e(S,"material_fresnel_factor","number");e(S,"material_parallax_scale","number");e(S,"material_parallax_steps","number");e(q,
"material_name","string");e(q,"shore_smoothing","bool");e(q,"absorb_factor","number");e(q,"sss_strength","number");e(q,"sss_width","number");K(q,"water_fog_color");e(q,"water_fog_density","number");K(q,"shallow_water_col");e(q,"shallow_water_col_fac","number");K(q,"shore_water_col");e(q,"shore_water_col_fac","number");e(q,"foam_factor","number");e(q,"norm_uv_velocity","number");e(q,"water_dynamic","bool");e(q,"waves_height","number");e(q,"waves_length","number");e(q,"dst_noise_scale0","number");e(q,
"dst_noise_scale1","number");e(q,"dst_noise_freq0","number");e(q,"dst_noise_freq1","number");e(q,"dir_min_shore_fac","number");e(q,"dir_freq","number");e(q,"dir_noise_scale","number");e(q,"dir_noise_freq","number");e(q,"dir_min_noise_fac","number");e(q,"dst_min_fac","number");e(q,"waves_hor_fac","number");e(Ca,"environment_energy","string");K(Ca,"horizon_color");K(Ca,"zenith_color");e(V,"light_name","string");K(V,"light_color");e(V,"light_energy","number");e(V,"light_spot_size","number");e(V,"light_spot_blend",
"number");e(V,"light_distance","number");K(L,"sky_color");e(L,"rayleigh_brightness","number");e(L,"mie_brightness","number");e(L,"spot_brightness","number");e(L,"scatter_strength","number");e(L,"rayleigh_strength","number");e(L,"mie_strength","number");e(L,"rayleigh_collection_power","number");e(L,"mie_collection_power","number");e(L,"mie_distribution","number");e(Da,"date","string");e(Da,"day_time","number");e(Ka,"sun_horizontal_position","number");e(Ka,"sun_vertical_position","number");e(Za,"max_sun_angle",
"number");u.set_onclick("run_sun",$a);u.set_onclick("stop_sun",ab);e(W,"csm_first_cascade_border","number");e(W,"csm_last_cascade_border","number");e(W,"self_shadow_polygon_offset","number");e(W,"self_shadow_normal_offset","number");e(W,"first_cascade_blur_radius","number");e(W,"last_cascade_blur_radius","number");e(b,"ssao_quality","string");e(b,"ssao_hemisphere","bool");e(b,"ssao_blur_depth","bool");e(b,"ssao_blur_discard_value","number");e(b,"ssao_radius_increase","number");e(b,"ssao_influence",
"number");e(b,"ssao_dist_factor","number");e(b,"ssao_only","bool");e(b,"ssao_white","bool");e(w,"fog_density","number");e(w,"fog_density1000","number");K(w,"fog_color");e(ea,"dof_distance","number");e(ea,"dof_front","number");e(ea,"dof_rear","number");e(ea,"dof_power","number");e(ea,"dof_on","bool");e(Ea,"god_rays_intensity","number");e(Ea,"god_rays_max_ray_length","number");e(Ea,"god_rays_steps","number");e(h,"brightness","number");e(h,"contrast","number");e(h,"exposure","number");e(h,"saturation",
"number");e(va,"sfx_mix_mode","bool");a=Number("true"===t.get("sfx_mix_mode"));document.getElementById("sfx_mix_mode").options[a].selected=!0;$("#sfx_mix_mode").slider("refresh");e(wa,"anaglyph_use","bool");a=Number("true"===t.get("anaglyph_use"));document.getElementById("anaglyph_use").options[a].selected=!0;$("#anaglyph_use").slider("refresh");e(xa,"gyro_use","bool");a=Number("true"===t.get("gyro_use"));document.getElementById("gyro_use").options[a].selected=!0;$("#gyro_use").slider("refresh");
e(La,"wind_dir","number");e(La,"wind_strength","number");e(Fa,"bloom_key","number");e(Fa,"bloom_blur","number");e(Fa,"bloom_edge_lum","number");e(Ma,"wireframe_mode","string");K(Ma,"wireframe_edge_color","object");e(ma,"show_hud_debug_info","bool");e(ya,"all_objs_selectable","bool");a=""==t.get("all_objs_selectable")?1:Number("true"===t.get("all_objs_selectable"));document.getElementById("all_objs_selectable").options[a].selected=!0;$("#all_objs_selectable").slider("refresh");u.set_onclick("make_screenshot",
bb);a=Number("true"===t.get("show_hud_debug_info"));document.getElementById("show_hud_debug_info").options[a].selected=!0;$("#show_hud_debug_info").slider("refresh");a=N();O(a,!1,!1,C&&C.load)},null)}function ha(a){if(pa){$("#material_warning")[0].style.display="none";a.preventDefault&&a.preventDefault();var d=a.clientX;a=a.clientY;var b=D;b&&l.clear_glow_anim(b);(D=d=l.pick_object(d,a))?(Na(d),l.apply_glow_anim(d,.2,3.8,1)):Oa();E();Q||(d?(Q=d,E(),u.enable_object_controls(d),v.create_kb_sensor_manifold(d,
"QUIT",v.CT_SHOT,v.KEY_Q,function(a,d,b,c){Q=null;E();u.disable_object_controls(a)})):M())}}function M(){var a=l.get_active_camera();Q=a;E();u.enable_camera_controls();v.create_kb_sensor_manifold(a,"QUIT",v.CT_SHOT,v.KEY_Q,function(a,d,b,c){Q=null;E();u.disable_camera_controls(a);v.remove_sensor_manifold(a,"ZOOM_TO")});var d=v.create_keyboard_sensor(v.KEY_Z),b=v.create_keyboard_sensor(v.KEY_DEC_POINT);v.create_sensor_manifold(a,"ZOOM_TO",v.CT_SHOT,[d,b],function(a){return a[0]||a[1]},function(a,d,
b){(d=D)&&Pa.zoom_object(a,d)})}function E(){if(pa){var a="CONTROLLED: "+(Q?String(Q.name):"NONE")+" | SELECTED: "+(D?String(D.name):"NONE"),d=D;d&&(d=l.get_type_mesh_object(d))&&(a+=" | TYPE: "+d);d=Q;D&&d&&"CAMERA"===d.type&&(a+=" | DISTANCE: "+Qa);pa.innerHTML=a}}function N(){var a=t.get("last_item_name");if(!a)return null;for(var d=0;d<G.length;d++){var b=G[d];if(fa.keyfind("name",a,b.items)[0])return{category:b.name,item:a}}return null}function F(a,d){var b=document.getElementById(a);b.innerHTML=
"";for(var c=0;c<d.length;c++){var e=document.createElement("option");e.text=e.value=d[c];0===c&&(e.selected=!0);b.appendChild(e)}$("#"+a).selectmenu();$("#"+a).selectmenu("refresh")}function U(){var a=document.getElementById("default_scene");a&&(a.onclick=function(){ga=!1;clearTimeout(Ga);O(null,!0,!1,!0)})}function Y(a){a=a.target.id;if(-1!=a.indexOf("MANIFEST_ITEM_")){var d=a.split("__SEPARATOR__");a=d[1];d=d[0].split("MANIFEST_ITEM_")[1];ga=!1;clearTimeout(Ga);O({category:a,item:d},!0,!1,!1)}}
function O(a,d,b,c){if(z)for(var e=0;e<z.children.length;e++)z.children[e].style.visibility="hidden";if((e=u.get_url_params())&&e.load){var f=e.load.split("/");X={load_file:e.load,name:f[f.length-1].split(".")[0],animated_objects:[]}}else X={load_file:y.get_std_assets_path()+"dev/logo.json",name:"Logo",animated_objects:[]};n=null;if(!c)if(a){c=fa.keyfind("name",a.category,G)[0];c=fa.keyfind("name",a.item,c.items)[0];for(var g in c)X[g]="load_file"==g?y.get_std_assets_path()+c[g]:c[g];t.set("last_item_name",
a.item)}else t.set("last_item_name","");d&&(J.clear_render_callback(),Ha.cleanup());J.get_canvas_elem().removeEventListener("mousedown",ha);A.clear_errors_warnings();a=X.name;d=X.load_file;g=document.getElementById("current_file");g.innerHTML=a;g.setAttribute("title",a+" ("+d+")");Ha.load(d,qa,ra,b)}function qa(a){J.get_canvas_elem().addEventListener("mousedown",ha,!1);l.set_glow_color([1,.4,.05]);D=null;sa(X);M();u.enable_debug_controls();ca()&&cb.enable_mixer_controls();y.get("gyro_use")&&db.enable_camera_rotation();
J.set_render_callback(ia);ga&&(Ga=setTimeout(B,1E3));a=v.create_elapsed_sensor();v.create_sensor_manifold(l.get_active_camera(),"TO_OBJ",v.CT_CONTINUOUS,[a],null,function(a,b,c){if(1==c&&D){if(c=D)b=eb,fb.get_object_center(c,!0,b),a=Pa.get_eye(a,gb),Qa=hb.dist(b,a).toFixed(3);E()}})}function B(){var a=N();if(a){var d=a.item,a=fa.keyfind("name",a.category,G)[0],d=fa.keyfind("name",d,a.items)[0],d=a.items.indexOf(d);if(d=a.items[d+1])a={category:a.name,item:d.name};else if(a=G.indexOf(a),a=G[a+1])a=
{category:a.name,item:a.items[0].name};else{ga=!1;return}}else a=G[0],d=a.items[0],a={category:a.name,item:d.name};O(a,!0,!0,!1)}function ra(a,d){document.getElementById("loading_progress").innerHTML=a+"% ("+Math.round(10*d/1E3)/10+"s)";var b=A.get_error_quantity(),c=A.get_warning_quantity();if(Ha.is_primary_loaded()){var e=A.num_vertices(),f=A.num_triangles(),g=A.num_draw_calls(),h=A.num_shaders();document.getElementById("info_right_up").innerHTML=e+" verts, "+f+" tris, "+g+" draw calls, "+h+" shaders";
var e=A.geometry_stats(),f=A.num_textures(),g=A.num_render_targets(),h=Math.round(10*(e.ibo_memory+e.vbo_memory))/10,k=Math.round(10*f.memory)/10,l=Math.round(10*g.memory)/10,m=Math.round(10*(h+k+l))/10;document.getElementById("info_right_down").innerHTML="Geometry: "+h+" MiB ("+e.ibo_number+"+"+e.vbo_number+")<br>Textures: "+k+" MiB ("+f.number+")<br>RTs: "+l+" MiB ("+g.number+")<br><br>Total: "+m+" MiB";e=A.get_error_quantity();(f=A.get_warning_quantity())||e?z.setAttribute("title","Errors: "+e+
", Warnings: "+f+"\nSee browser console for more info"):z.setAttribute("title","Loaded OK");c||b||(z.children[0].style.visibility="hidden",z.children[1].style.visibility="hidden",z.children[2].style.visibility="visible")}c&&!b&&(z.children[0].style.visibility="hidden",z.children[1].style.visibility="visible",z.children[2].style.visibility="hidden");b&&(z.children[0].style.visibility="visible",z.children[1].style.visibility="hidden",z.children[2].style.visibility="hidden")}function sa(a){for(var d=
l.get_active(),b=l.get_scenes(),C=0;C<b.length;C++){var e=b[C];if(e!==d){var f=ja(e,a);ba(e,f)}}f=ja(d,a);ba(d,f);Na=function(a){var d=T.get_materials_names(a);F("material_name",d);Ra(a,d[0]);a=T.get_water_material_params(a,d[0]);d="shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor norm_uv_velocity waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" ");
a?(m(d,"enable"),l.get_water_mat_params(a),a.shallow_water_col&&P("shallow_water_col",a.shallow_water_col),a.shallow_water_col_fac&&g("shallow_water_col_fac",a.shallow_water_col_fac),a.shore_water_col&&P("shore_water_col",a.shore_water_col),a.shore_water_col_fac&&g("shore_water_col_fac",a.shore_water_col_fac),a.water_fog_color&&(P("water_fog_color",a.water_fog_color),g("water_fog_density",a.water_fog_density)),g("absorb_factor",a.absorb_factor),g("sss_strength",a.sss_strength),g("sss_width",a.sss_width),
g("foam_factor",a.foam_factor),g("norm_uv_velocity",a.norm_uv_velocity),g("waves_height",a.waves_height),g("waves_length",a.waves_length),g("dst_noise_scale0",a.dst_noise_scale0),g("dst_noise_scale1",a.dst_noise_scale1),g("dst_noise_freq0",a.dst_noise_freq0),g("dst_noise_freq1",a.dst_noise_freq1),g("dir_min_shore_fac",a.dir_min_shore_fac),g("dir_freq",a.dir_freq),g("dir_noise_scale",a.dir_noise_scale),g("dir_noise_freq",a.dir_noise_freq),g("dir_min_noise_fac",a.dir_min_noise_fac),g("dst_min_fac",
a.dst_min_fac),g("waves_hor_fac",a.waves_hor_fac)):m(d,"disable")};ib();a=l.get_all_objects("LAMP");d=[];for(C=0;C<a.length;C++)d.push(a[C].name);F("light_name",d);0<a.length&&Sa(a[0]);Xa();Aa();Wa();jb();kb();c();lb();mb();nb();ob();pb();Oa();$("#wireframe_mode").val("WM_NONE");$("#wireframe_mode").selectmenu("refresh",!0);$("#wireframe_edge_color div").css("backgroundColor","#333");C=new Date(document.getElementById("date").value);Da({date:C})}function ja(a,d){function b(a,d){for(var c in a)d[c]=
a[c];return d}var c=d.scene_settings;if(c&&c[a]){var e={};b(d,e);b(c[a],e);delete e.scene_settings;return e}return d}function ba(a,d){l.set_active(a);var b=l.get_active_camera();d.camera_target&&qb.append_follow(b,d.camera_target);for(var b=[],c=l.get_all_objects(),e=0;e<c.length;e++){var f=c[e];p.is_animated(f)&&(n||(n=f),b.push(l.get_object_name(f)))}c="anim_active_object anim_slot animation anim_cyclic anim_frame_range anim_mix_factor anim_frame_current anim_play anim_stop get_max_bones".split(" ");
n?(m(c,"enable"),F("anim_active_object",b),x({anim_active_object:l.get_object_name(n)})):m(c,"disable")}function ia(a,d){l.get_active_camera();if(n){var b=parseInt(document.getElementById("anim_slot").value),c=Math.round(p.get_frame(n,b));parseInt($("#anim_frame_current").val())!==c&&g("anim_frame_current",c);c=document.getElementById("anim_status");p.is_play(n,b)?c.innerHTML="PLAYING":c.innerHTML="STOPPED"}}function ta(a){t.set("quality",a.quality);setTimeout(function(){window.location.reload()},
100)}function la(){t.cleanup();window.location.reload()}function ka(){J.pause()}function ua(){J.resume()}function ca(){return"true"===t.get("sfx_mix_mode")?!0:!1}function ma(a){t.set("show_hud_debug_info",a.show_hud_debug_info);window.location.reload()}function va(a){t.set("sfx_mix_mode",a.sfx_mix_mode);window.location.reload()}function wa(a){t.set("anaglyph_use",a.anaglyph_use);window.location.reload()}function xa(a){t.set("gyro_use",a.gyro_use);window.location.reload()}function ya(a){t.set("all_objs_selectable",
a.all_objs_selectable);window.location.reload()}function na(){ga=!0;B()}function oa(a){u.resize_to_container();a=J.get_canvas_elem();document.getElementById("info_left_up").innerHTML=a.width+"x"+a.height+" ("+a.width/a.clientWidth+":1)"}function za(){var a=document.getElementById("animation").value,d=parseInt(document.getElementById("anim_slot").value);"None"!==a&&p.play(n,null,d)}function aa(){document.getElementById("animation");var a=parseInt(document.getElementById("anim_slot").value);p.stop(n,
a)}function Z(){J.pause();var a=rb.determine_max_bones();document.getElementById("max_bones").innerHTML=a.max_bones;document.getElementById("max_bones_no_blending").innerHTML=a.max_bones_no_blending;J.resume()}function x(a){if("anim_active_object"in a){n=l.get_object_by_name(a.anim_active_object);var d=p.get_anim_names(n);if(d.length){for(var b=[],c=0;c<d.length&&8>c;c++)b.push(c);d.push("None");F("animation",d);F("anim_slot",b);d=parseInt(document.getElementById("anim_slot").value);R(n,d);da(n,d)}else F("animation",
["N/A"]);I(n)}if("anim_slot"in a){if(!n)return;d=a.anim_slot;R(n,d);da(n,d);I(n)}"animation"in a&&(d=parseInt(document.getElementById("anim_slot").value),p.get_current_anim_name(n,d),"None"==a.animation?p.remove_slot_animation(n,d):(p.apply(n,a.animation,d),p.play(n,null,d)),da(n,d),I(n));"anim_cyclic"in a&&(d=document.getElementById("animation").value,d=p.get_slot_num_by_anim(n,d),p.set_behavior(n,a.anim_cyclic?p.AB_CYCLIC:p.AB_FINISH_RESET,d));"anim_frame_current"in a&&(d=parseInt(document.getElementById("anim_slot").value),
p.is_play(n,d)||(b=parseInt(a.anim_frame_current),p.set_frame(n,b,d)));"anim_mix_factor"in a&&p.set_skel_mix_factor(n,a.anim_mix_factor)}function R(a,d){for(var b=p.get_anim_name(a,d),b=b||"None",c=$("#animation"),e=c.children(),f=0;f<e.length;f++){var g=e[f];if(g.value==b){g.selected=!0;c.selectmenu();c.selectmenu("refresh");break}}}function da(a,d){g("anim_cyclic",Number(p.get_behavior(a,d)==p.AB_CYCLIC));var b=document.getElementById("anim_frame_range"),c=p.get_anim_start_frame(a,d),e=p.get_anim_length(a,
d);-1!=c&&-1!=e?(e=c+e,b.innerHTML=c+" - "+e,b=document.getElementById("anim_frame_current"),b.min=""+c,b.max=""+e):b.innerHTML="N/A"}function I(a){for(var d=$("#anim_slot-listbox").find("a"),b=parseInt(document.getElementById("anim_slot").value),c=p.get_anim_type(a,b),b=0;b<d.length;b++){c=p.get_anim_type(a,b);switch(c){case p.OBJ_ANIM_TYPE_ARMATURE:c="ARMATURE";break;case p.OBJ_ANIM_TYPE_OBJECT:c="OBJECT";break;case p.OBJ_ANIM_TYPE_PARTICLES:c="PARTICLES";break;case p.OBJ_ANIM_TYPE_VERTEX:c="VERTEX";
break;case p.OBJ_ANIM_TYPE_MATERIAL:c="MATERIAL";break;case p.OBJ_ANIM_TYPE_STATIC:c="STATIC";break;default:c="NONE"}d.eq(b);c=b+" ("+c+")";$("#anim_slot").children().eq(b).text(c)}$("#anim_slot").selectmenu();$("#anim_slot").selectmenu("refresh")}function Aa(){var a=l.get_ssao_params(),d="ssao_quality ssao_hemisphere ssao_blur_depth ssao_blur_discard_value ssao_radius_increase ssao_influence ssao_dist_factor ssao_only ssao_white".split(" ");if(a){m(d,"enable");for(var b=document.getElementById("ssao_quality"),
d=a.ssao_quality,b=b.options,c=0;c<b.length;c++){var e=b[c];e.selected=e.value==d?!0:!1}$("#ssao_quality").selectmenu("refresh");d=Number(a.ssao_hemisphere);document.getElementById("ssao_hemisphere").options[d].selected=!0;$("#ssao_hemisphere").slider("refresh");d=Number(a.ssao_blur_depth);document.getElementById("ssao_blur_depth").options[d].selected=!0;$("#ssao_blur_depth").slider("refresh");g("ssao_blur_discard_value",a.blur_discard_value);g("ssao_radius_increase",a.radius_increase);g("ssao_influence",
a.influence);g("ssao_dist_factor",a.dist_factor);d=Number(a.ssao_only);document.getElementById("ssao_only").options[d].selected=!0;$("#ssao_only").slider("refresh");d=Number(a.ssao_white);document.getElementById("ssao_white").options[d].selected=!0;$("#ssao_white").slider("refresh")}else m(d,"disable")}function b(a){l.get_ssao_params();var d={};"ssao_quality"in a&&(d.ssao_quality=r(document.getElementById("ssao_quality")));"ssao_hemisphere"in a&&(d.ssao_hemisphere=Number(a.ssao_hemisphere));"ssao_blur_depth"in
a&&(d.ssao_blur_depth=Number(a.ssao_blur_depth));"ssao_blur_discard_value"in a&&(d.ssao_blur_discard_value=a.ssao_blur_discard_value);"ssao_radius_increase"in a&&(d.ssao_radius_increase=a.ssao_radius_increase);"ssao_influence"in a&&(d.ssao_influence=a.ssao_influence);"ssao_dist_factor"in a&&(d.ssao_dist_factor=a.ssao_dist_factor);"ssao_only"in a&&(d.ssao_only=Number(a.ssao_only));"ssao_white"in a&&(d.ssao_white=Number(a.ssao_white));l.set_ssao_params(d)}function c(){var a=l.get_color_correction_params(),
d=["brightness","contrast","exposure","saturation"];a?(m(d,"enable"),g("brightness",a.brightness),g("contrast",a.contrast),g("exposure",a.exposure),g("saturation",a.saturation)):m(d,"disable")}function h(a){var d=l.get_color_correction_params();d&&(d={},"brightness"in a&&(d.brightness=parseFloat(a.brightness)),"contrast"in a&&(d.contrast=parseFloat(a.contrast)),"exposure"in a&&(d.exposure=parseFloat(a.exposure)),"saturation"in a&&(d.saturation=parseFloat(a.saturation)),l.set_color_correction_params(d))}
function r(a){a=a.options;for(var d=0;d<a.length;d++){var b=a[d];if(b.selected)return b.value}}function Wa(){var a=l.get_fog_color_density();.2<a[3]?g("fog_density",a[3]):g("fog_density1000",1E3*a[3]);P("fog_color",a)}function w(a){var d=l.get_fog_color_density();"fog_density"in a&&(d[3]=a.fog_density);"fog_density1000"in a&&(d[3]=a.fog_density1000/1E3);"fog_color"in a&&(d[0]=a.fog_color[0],d[1]=a.fog_color[1],d[2]=a.fog_color[2]);l.set_fog_color_density(d)}function Xa(){var a=l.get_shadow_params(),
d="csm_first_cascade_border csm_last_cascade_border self_shadow_polygon_offset self_shadow_normal_offset first_cascade_blur_radius last_cascade_blur_radius res_ui-block-b num_ui-block-b blur_ui-block-b".split(" ");if(!a)return m(d,"disable"),document.getElementById("csm_resolution").innerHTML="",document.getElementById("csm_num").innerHTML="",document.getElementById("csm_borders").innerHTML="",document.getElementById("blur_radii").innerHTML="",null;m(d,"enable");Ta(a);g("self_shadow_polygon_offset",
a.self_shadow_polygon_offset);g("self_shadow_normal_offset",a.self_shadow_normal_offset);g("first_cascade_blur_radius",a.first_cascade_blur_radius);a.b4w_enable_csm?(g("csm_first_cascade_border",a.csm_first_cascade_border),1<a.csm_num?(g("csm_last_cascade_border",a.csm_last_cascade_border),g("last_cascade_blur_radius",a.last_cascade_blur_radius)):m(["csm_last_cascade_border","last_cascade_blur_radius"],"disable")):m(["csm_first_cascade_border","csm_last_cascade_border","last_cascade_blur_radius"],
"disable")}function W(a){var d={};"csm_first_cascade_border"in a&&(d.csm_first_cascade_border=a.csm_first_cascade_border);"csm_last_cascade_border"in a&&(d.csm_last_cascade_border=a.csm_last_cascade_border);"self_shadow_polygon_offset"in a&&(d.self_shadow_polygon_offset=a.self_shadow_polygon_offset);"self_shadow_normal_offset"in a&&(d.self_shadow_normal_offset=a.self_shadow_normal_offset);"first_cascade_blur_radius"in a&&(d.first_cascade_blur_radius=a.first_cascade_blur_radius);"last_cascade_blur_radius"in
a&&(d.last_cascade_blur_radius=a.last_cascade_blur_radius);l.set_shadow_params(d);Ta(l.get_shadow_params())}function Ta(a){document.getElementById("csm_resolution").innerHTML="&nbsp;&nbsp;"+a.csm_resolution;if(a.b4w_enable_csm){document.getElementById("csm_num").innerHTML=" "+a.csm_num;for(var d=["csm_borders","blur_radii"],b=0;b<d.length;b++){var c=d[b],e=a[c],c=document.getElementById(c);c.innerHTML="(";for(var f=0;f<e.length;f++)0<f&&(c.innerHTML+=" __ "),c.innerHTML+=Math.round(10*e[f])/10;c.innerHTML+=
")"}}else document.getElementById("cascades-info-block").style.display="none",document.getElementById("csm_first_cascade_border-info-block").style.display="none",document.getElementById("csm_last_cascade_border-info-block").style.display="none",document.getElementById("blur_radii-info-block").style.display="none",document.getElementById("first_cascade_blur_radius-label").innerHTML="Blur radius",document.getElementById("last_cascade_blur_radius-info-block").style.display="none"}function ib(){var a=
l.get_environment_colors();g("environment_energy",a[0]);P("horizon_color",a[1]);P("zenith_color",a[2])}function Ca(a){"environment_energy"in a&&l.set_environment_colors(a.environment_energy,null,null);"horizon_color"in a&&l.set_environment_colors(null,a.horizon_color,null);"zenith_color"in a&&l.set_environment_colors(null,null,a.zenith_color)}function Ma(a){var d={};"string"==typeof a.wireframe_mode&&(d.wireframe_mode=r(document.getElementById("wireframe_mode")));"object"==typeof a.wireframe_edge_color&&
(d.wireframe_edge_color=a.wireframe_edge_color);A.set_debug_params(d)}function bb(){sb.shot()}function nb(){var a=l.get_sky_params(),d="sky_color rayleigh_brightness mie_brightness spot_brightness scatter_strength rayleigh_strength mie_strength rayleigh_collection_power mie_collection_power mie_distribution".split(" ");if(!a)return m(d,"disable"),null;m(d,"enable");P("sky_color",a.color);g("rayleigh_brightness",a.rayleigh_brightness);g("mie_brightness",a.mie_brightness);g("spot_brightness",a.spot_brightness);
g("scatter_strength",a.scatter_strength);g("rayleigh_strength",a.rayleigh_strength);g("mie_strength",a.mie_strength);g("rayleigh_collection_power",a.rayleigh_collection_power);g("mie_collection_power",a.mie_collection_power);g("mie_distribution",a.mie_distribution)}function L(a){var d={};"sky_color"in a&&(d.color=a.sky_color);"rayleigh_brightness"in a&&(d.rayleigh_brightness=a.rayleigh_brightness);"mie_brightness"in a&&(d.mie_brightness=a.mie_brightness);"spot_brightness"in a&&(d.spot_brightness=
a.spot_brightness);"scatter_strength"in a&&(d.scatter_strength=a.scatter_strength);"rayleigh_strength"in a&&(d.rayleigh_strength=a.rayleigh_strength);"mie_strength"in a&&(d.mie_strength=a.mie_strength);"rayleigh_collection_power"in a&&(d.rayleigh_collection_power=a.rayleigh_collection_power);"mie_collection_power"in a&&(d.mie_collection_power=a.mie_collection_power);"mie_distribution"in a&&(d.mie_distribution=a.mie_distribution);l.set_sky_params(d)}function Ra(a,d){var b=T.get_material_extended_params(a,
d),c="material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" ");if(!b)return m(c,"disable"),$("#material_warning")[0].style.display="block",null;var e=T.get_diffuse_color(a,d);e.pop();b.diffuse_color=e;m(c,"enable");P("material_diffuse_color",b.diffuse_color);g("material_reflectivity",b.reflect_factor);g("material_fresnel",b.fresnel);g("material_fresnel_factor",b.fresnel_factor);g("material_parallax_scale",
b.parallax_scale);g("material_parallax_steps",b.parallax_steps)}function S(a){var b=D;"material_name"in a&&Ra(b,a.material_name);if("material_diffuse_color"in a){var c=a.material_diffuse_color.slice();c.push(1);T.set_diffuse_color(b,$("#material_name").val(),c)}c={};"material_reflectivity"in a&&(c.material_reflectivity=a.material_reflectivity);"material_fresnel"in a&&(c.material_fresnel=a.material_fresnel);"material_fresnel_factor"in a&&(c.material_fresnel_factor=a.material_fresnel_factor);"material_parallax_scale"in
a&&(c.material_parallax_scale=a.material_parallax_scale);"material_parallax_steps"in a&&(c.material_parallax_steps=a.material_parallax_steps);T.set_material_extended_params(b,$("#material_name").val(),c);l.update_scene_materials_params()}function q(a){var b=D,c="waves_height waves_length sss_strength sss_width dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac".split(" ");if(!b)return null;
var e={},f=$("#water_dynamic").val(),g=$("#shore_smoothing").val();Boolean(Number(f))?m(c,"enable"):m(c,"disable");Boolean(Number(g))?m(["absorb_factor"],"enable"):m(["absorb_factor"],"disable");"shore_smoothing"in a&&(e.shore_smoothing=a.shore_smoothing);"absorb_factor"in a&&(e.absorb_factor=a.absorb_factor);"water_fog_color"in a&&(e.water_fog_color=a.water_fog_color);"water_fog_density"in a&&(e.water_fog_density=a.water_fog_density);"shallow_water_col"in a&&(e.shallow_water_col=a.shallow_water_col);
"shallow_water_col_fac"in a&&(e.shallow_water_col_fac=a.shallow_water_col_fac);"shore_water_col"in a&&(e.shore_water_col=a.shore_water_col);"shore_water_col_fac"in a&&(e.shore_water_col_fac=a.shore_water_col_fac);"foam_factor"in a&&(e.foam_factor=a.foam_factor);"norm_uv_velocity"in a&&(e.norm_uv_velocity=a.norm_uv_velocity);"sss_strength"in a&&(e.sss_strength=a.sss_strength);"sss_width"in a&&(e.sss_width=a.sss_width);"water_dynamic"in a&&(e.water_dynamic=a.water_dynamic);"waves_height"in a&&(e.waves_height=
a.waves_height);"waves_length"in a&&(e.waves_length=a.waves_length);"dst_noise_scale0"in a&&(e.dst_noise_scale0=a.dst_noise_scale0);"dst_noise_scale1"in a&&(e.dst_noise_scale1=a.dst_noise_scale1);"dst_noise_freq0"in a&&(e.dst_noise_freq0=a.dst_noise_freq0);"dst_noise_freq1"in a&&(e.dst_noise_freq1=a.dst_noise_freq1);"dir_min_shore_fac"in a&&(e.dir_min_shore_fac=a.dir_min_shore_fac);"dir_freq"in a&&(e.dir_freq=a.dir_freq);"dir_noise_scale"in a&&(e.dir_noise_scale=a.dir_noise_scale);"dir_noise_freq"in
a&&(e.dir_noise_freq=a.dir_noise_freq);"dir_min_noise_fac"in a&&(e.dir_min_noise_fac=a.dir_min_noise_fac);"dst_min_fac"in a&&(e.dst_min_fac=a.dst_min_fac);"waves_hor_fac"in a&&(e.waves_hor_fac=a.waves_hor_fac);if(!T.set_water_material_params(b,$("#material_name").val(),e))return null;l.update_scene_materials_params();l.set_water_params(e)}function Sa(a){if(a=H.get_light_params(a)){P("light_color",a.light_color);g("light_energy",a.light_energy);var b=a.light_type;$("#light_type").text(b);"SPOT"==a.light_type?
(m(["light_spot_blend","light_spot_size"],"enable"),"light_spot_blend"in a&&g("light_spot_blend",a.light_spot_blend),"light_spot_size"in a&&g("light_spot_size",Math.round(a.light_spot_size*tb))):m(["light_spot_blend","light_spot_size"],"disable");"SPOT"==a.light_type||"POINT"==a.light_type?(m(["light_distance"],"enable"),"light_distance"in a&&g("light_distance",a.light_distance)):m(["light_distance"],"disable")}}function V(a){"light_name"in a&&Sa(l.get_object_by_name(a.light_name));var b={};"light_color"in
a&&(b.light_color=a.light_color);"light_energy"in a&&(b.light_energy=parseFloat(a.light_energy));"light_spot_size"in a&&(b.light_spot_size=parseFloat(a.light_spot_size*ub));"light_spot_blend"in a&&(b.light_spot_blend=parseFloat(a.light_spot_blend));"light_distance"in a&&(b.light_distance=parseFloat(a.light_distance));a=l.get_object_by_name($("#light_name").val());H.set_light_params(a,b)}function mb(){var a=H.get_sun_params(),b=["sun_horizontal_position","sun_vertical_position"];if(!a)return m(b,"disable"),
null;g("sun_horizontal_position",a.hor_position);g("sun_vertical_position",a.vert_position)}function Ka(a){var b={};"sun_horizontal_position"in a&&(b.hor_position=parseFloat(a.sun_horizontal_position),b.vert_position=parseFloat(document.getElementById("sun_vertical_position").value));"sun_vertical_position"in a&&(b.hor_position=parseFloat(document.getElementById("sun_horizontal_position").value),b.vert_position=parseFloat(a.sun_vertical_position));H.set_sun_params(b)}function Za(a){a=parseFloat(a.max_sun_angle);
H.set_max_sun_angle(a)}function Da(a){"day_time"in a&&H.set_day_time(a.day_time);"date"in a&&H.set_date(new Date(a.date))}function $a(){var a=0,b=parseFloat(document.getElementById("day_time").value),c=v.create_elapsed_sensor(),e=H.get_lamps("SUN")[0];v.create_sensor_manifold(e,"ELAPSED",v.CT_CONTINUOUS,[c],function(a){return a[0]},function(c,e,f){1==f&&(a=document.getElementById("sun_time_multiplier").value,c=v.get_sensor_value(c,e,0),b+=c*a/3600,24<b&&(b-=Math.floor(b)),g("day_time",b))})}function pb(){var a=
H.get_lamps("SUN")[0],b=["sn-ui-grid-b"];H.get_lamps().length?a||m("run_sun stop_sun date sun_time_multiplier day_time max_sun_angle".split(" "),"disable"):m(b,"disable")}function Oa(){m("material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" "),"disable");m("shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor norm_uv_velocity waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" "),
"disable")}function ab(){var a=H.get_lamps("SUN")[0];v.check_sensor_manifolds(a)&&v.remove_sensor_manifold(a,"ELAPSED")}function jb(){var a=l.get_dof_params(),b=["dof_distance","dof_front","dof_rear","dof_power","dof_on"];a?(g("dof_distance",a.dof_distance),g("dof_front",a.dof_front),g("dof_rear",a.dof_rear),g("dof_power",a.dof_power),m(b,"enable"),a=0<a.dof_distance?0:1,document.getElementById("dof_on").options[a].selected=!0,$("#dof_on").slider("refresh")):m(b,"disable")}function ea(a){var b={};
"dof_distance"in a&&Number($("#dof_on").val())&&(b.dof_distance=a.dof_distance);"dof_front"in a&&(b.dof_front=a.dof_front);"dof_rear"in a&&(b.dof_rear=a.dof_rear);"dof_power"in a&&(b.dof_power=a.dof_power);"dof_on"in a&&(b.dof_on=Boolean($("#dof_on").val()),b.dof_distance=Number(a.dof_on)?parseFloat($("#dof_distance").val()):0);l.set_dof_params(b)}function kb(){var a=l.get_god_rays_params(),b=["god_rays_intensity","god_rays_max_ray_length","god_rays_steps"];a?(m(b,"enable"),a&&(g("god_rays_intensity",
a.god_rays_intensity),g("god_rays_max_ray_length",a.god_rays_max_ray_length),g("god_rays_steps",a.god_rays_steps))):m(b,"disable")}function Ea(a){var b={};"god_rays_intensity"in a&&(b.god_rays_intensity=a.god_rays_intensity);"god_rays_max_ray_length"in a&&(b.god_rays_max_ray_length=a.god_rays_max_ray_length);"god_rays_steps"in a&&(b.god_rays_steps=a.god_rays_steps);l.set_god_rays_params(b)}function ob(){var a=l.get_bloom_params(),b=["bloom_key","bloom_blur","bloom_edge_lum"];a?(m(b,"enable"),a&&(g("bloom_key",
a.bloom_key),g("bloom_blur",a.bloom_blur),g("bloom_edge_lum",a.bloom_edge_lum))):m(b,"disable")}function Fa(a){var b={};"bloom_key"in a&&(b.bloom_key=a.bloom_key);"bloom_blur"in a&&(b.bloom_blur=a.bloom_blur);"bloom_edge_lum"in a&&(b.bloom_edge_lum=a.bloom_edge_lum);l.set_bloom_params(b)}function P(a,b){b=vb(b);var c={r:Math.round(255*b[0]),g:Math.round(255*b[1]),b:Math.round(255*b[2])};$("#"+a).ColorPickerSetColor(c);$("#"+a+" div").css("backgroundColor","#"+function(a){var b=[a.r.toString(16),a.g.toString(16),
a.b.toString(16)];$.each(b,function(a,c){1==c.length&&(b[a]="0"+c)});return b.join("")}(c))}function vb(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]}function lb(){var a=l.get_wind_params(),b=["wind_dir","wind_strength"];a?(g("wind_dir",a.wind_dir),g("wind_strength",a.wind_strength)):m(b,"disable")}function La(a){var b={};"wind_dir"in a&&(b.wind_dir=a.wind_dir);"wind_strength"in a&&(b.wind_strength=a.wind_strength);l.set_wind_params(b)}function g(a,b){$("#"+a).val(b);$("#"+
a).slider("refresh")}function e(a,b,c){$("#"+b).bind("change",function(e){var f={};switch(c){case "string":f[b]=e.target.value;break;case "number":f[b]=parseFloat(e.target.value);break;case "bool":f[b]=Boolean(Number(e.target.value));break;default:return console.log("wrong value type"),null}a(f)})}function K(a,b){$("#"+b).ColorPicker({onChange:function(c,e,f){$("#"+b+" div").css("backgroundColor","#"+e);c={};e=[];e[0]=f.r/255;e[1]=f.g/255;e[2]=f.b/255;f=e;f=[Math.pow(f[0],2.2),Math.pow(f[1],2.2),
Math.pow(f[2],2.2)];c[b]=f;a(c)}})}function Ya(){wb.auto_rotate(.3)}function m(a,b){if(!a)return null;for(var c=0;c<a.length;c++){var e=$("#"+a[c]).parent().parent();"enable"==b?e.removeClass("ui-disabled"):"disable"==b&&e.addClass("ui-disabled")}}var p=k("animation"),u=k("app"),Ia=k("assets"),Pa=k("camera"),wb=k("camera_anim"),y=k("config"),qb=k("constraints"),v=k("controls"),Ha=k("data"),A=k("debug"),db=k("gyroscope"),H=k("lights"),J=k("main"),cb=k("mixer"),T=k("material"),sb=k("screenshooter"),
l=k("scenes"),rb=k("shaders"),t=k("storage"),fb=k("transform"),fa=k("util"),Ja=k("version"),hb=k("vec3"),Ua="DEBUG"===Ja.type(),ub=Math.PI/180,tb=180/Math.PI,eb=new Float32Array(3),gb=new Float32Array(3),ga=!1,Ga,G=null,n=null,X=null,pa=null,z=null,D=null,Na=function(){},Q=null,Qa=null;f.init=function(){t.init("b4w_viewer");var a=t.get("quality");if(a){switch(a){case "ULTRA":var b=y.P_ULTRA;break;case "HIGH":b=y.P_HIGH;break;case "LOW":b=y.P_LOW;break;case "CUSTOM":b=y.P_CUSTOM}y.set("quality",b)}y.set("anaglyph_use",
"true"===t.get("anaglyph_use"));y.set("gyro_use","true"===t.get("gyro_use"));""==t.get("all_objs_selectable")?y.set("all_objs_selectable",!0):y.set("all_objs_selectable","true"===t.get("all_objs_selectable"));u.init({canvas_container_id:"main_canvas_container",callback:Va,autoresize:!1,gl_debug:!0,show_hud_debug_info:"true"===t.get("show_hud_debug_info")?!0:!1,sfx_mix_mode:ca(),show_fps:!0,alpha:!0,assets_dds_available:!Ua,assets_min50_available:!Ua,console_verbose:!0,physics_enabled:!0,wireframe_debug:!0})}});
b4w.require("viewer_main").init();
