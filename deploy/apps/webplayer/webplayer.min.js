var ld={},qd;for(qd in window)ld[qd]=!0;var b4w=function(a){var q={};a.module=q;var d={};a.register=function(a,d){if(q[a])throw Error('Module "'+a+'" already registered');q[a]=d};a.require=function(a,g){if(!q[a])throw Error('Module "'+a+'" not found');g=g||"__B4W_DEF_NS";d[g]||(d[g]=function(a){return function(b){var g=q[b];if(!g)throw Error('Module "'+b+'" not found');g.hi||(g.hi={});g.hi[a]||(g.hi[a]={},g(g.hi[a],d[a]));return g.hi[a]}}(g));return d[g](a)};a.module_check=function(a){return q[a]?!0:!1};return a}({});b4w.module.app=function(a,q){function d(){var a=h.$k();document.addEventListener("visibilitychange",function(){document.hidden?(a=h.$k(),h.pause()):a||h.ie()},!1)}function b(a,b){var e=String(a);b&&(e+="/"+String(b));l.innerHTML=e}function g(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function c(a,b,e){if(u.Tk(a))var d=r.Sc(a,J),l=u.qt(a,C),d=E.subtract(d,l,J),d=Math.max(E.len(d),1);else d=10;l=r.Ln(a,P);b=v.S(l,b,J);b[1]=0;E.normalize(b,b);E.scale(b,
d*e,b);u.Tk(a)?(l=u.qt(a,C),E.add(l,b,l),u.Ep(a,l)):(d=r.Sc(a,C),E.add(d,b,d),u.Ep(a,d))}function n(a,b){if(u.Tk(a)){var e=u.jC(a,N);if(0<e[0]-e[1]){var d=u.Dk(a),e=(d-e[1])/(e[0]-e[1]),l=u.XB(a),e=Math.max(e,2/l[0]);u.zE(a,d-e*b)}}else d=r.Sc(a,J),e=E.scale(v.Ba,-b,C),E.add(d,e,d),u.Ep(a,d)}function p(a,b,e,d){r.tc(a,5*b,5*e,5*d)}function k(a,b,e){var d=r.Sc(a,J),l=u.Kn(a,C),d=E.dist(d,l),l=Math.abs(b);e=Math.pow(l*e,1-Math.pow(l*e,.15));r.tc(a,0,0>b?.001<d?-d*e:0:e/(1-e)*d,0)}function y(a,b,e,d){for(var l=
e*b;0<a;--a)e+=l,d+=l,l=e*b;return d}function m(a,b,e,d,l){l?(l=u.Kn(a,J),a=u.it(a),a=E.dist(l,a)+d,d=0<b?y(b,-e,a,d):y(-b,e/(1-e),a,d)):d-=2*b*e;return d}function s(a,b,e,d){var l=document.createElement("div"),c=document.createElement("div"),f=document.createElement("div");if(d)for(var t=0;t<d.length;t++){var h=document.getElementById(d[t]);h&&h.parentNode.removeChild(h)}l.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";c.style.cssText=
"color:#fff;font-size:24px;";f.style.cssText="color:#fff;font-size:20px;";c.innerHTML=a;f.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+e+'">'+e.replace("https://www.","")+"</a>";l.appendChild(c);l.appendChild(f);document.body.appendChild(l)}function B(a,b,e,d){function l(f){f=1E3*f-c;d(a+f*(b-a)/e);f>=e&&h.WD(l)}var c=1E3*h.zC();h.$y(l)}q("animation");var u=q("camera"),H=q("config"),A=q("constraints"),x=q("controls"),f=q("data"),F=q("debug"),h=q("main"),z=q("physics"),
D=q("print"),I=q("scenes"),r=q("transform"),v=q("util"),E=q("vec3");q("quat");var e=null,t=null,l=null,N=new Float32Array(2),J=new Float32Array(3),C=new Float32Array(3),R=new Float32Array(3),M=new Float32Array(3),P=new Float32Array(4);a.ac=function(a){function c(){var a;a=g;var f=v,C=N,U=document.createElement("canvas");U.style.position="absolute";U.style.left="0px";U.style.top="0px";if(K){var Q=document.createElement("canvas");Q.style.cssText="z-index: 2; position:absolute; left:0px; top:0px; pointer-events: none;"}else Q=
null;h.ac(U,Q)?(t=U,f=document.getElementById(a),f||(D.error('Warning: canvas container "'+a+'" not found, appending to body'),f=document.body),f.appendChild(U),Q&&f.appendChild(Q),a=f):(f&&s("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",C),a=null);a?(e=a,h.Zo(n),J&&((a=m)?(E&&(document.getElementById(E).style.display="block"),l=document.getElementById(a)):(l=document.createElement("div"),l.innerHTML=0,l.style.cssText="             position:absolute;            top: 23px;            right: 20px;            font-size: 45px;            line-height: 50px;            font-weight: bold;            color: #000;            z-index: 1;        ",
document.body.appendChild(l)),h.vE(b)),T&&d(),k(t,!0)):k(t,!1)}function C(a){a.keyCode==x.Kx&&(h.$k()?h.ie():h.pause())}function k(){}a=a||{};var g=null,n=!1,N=null,m=null,E=null,p=!0,Q=!1,T=!0,v=!0,J=!1,U=!1,Y;for(Y in a)switch(Y){case "canvas_container_id":g=a.canvas_container_id;break;case "callback":k=a.callback;break;case "do_not_use_onload":break;case "gl_debug":n=a.gl_debug;break;case "show_hud_debug_info":U=a.show_hud_debug_info;break;case "sfx_mix_mode":Q=a.sfx_mix_mode;break;case "show_fps":J=
a.show_fps;break;case "fps_wrapper_id":E=a.fps_wrapper_id;break;case "fps_elem_id":m=a.fps_elem_id;break;case "error_purge_elements":N=a.error_purge_elements;break;case "report_init_failure":v=a.report_init_failure;break;case "pause_invisible":T=a.pause_invisible;break;case "key_pause_enabled":p=a.key_pause_enabled;break;default:H.set(Y,a[Y])}p&&document.addEventListener("keydown",C,!1);H.set("show_hud_debug_info",U);H.set("sfx_mix_mode",Q);var K=U||Q||null;"complete"==document.readyState?window.setTimeout(c,
0):window.addEventListener("load",c,!1);window.addEventListener("unload",function(){f.ba()},!1)};a.nL=function(){h.resize(e.clientWidth,e.clientHeight,!0)};a.AJ=function(){return e};a.TL=function(a,b){var e=g(a);e.addEventListener("mouseup",function(){b(e.value)},!1)};a.SL=function(a,b){var e=g(a);e.addEventListener("change",function(){var a=e.checked;b(void 0!=a?a:e.value)},!1)};a.UL=function(a,b){var e=g(a);e.addEventListener("keypress",function(a){b(a.keyCode,e.value)},!1)};a.fB=function(){function a(b,
e,K,l){if(1==K){var d=h?.003*g[0]:.003*g[1];K=x.Qb(b,e,0);x.Xd(b,e,0)===x.Nj?(Xa+="X"==l?-K*d:0,Qa+="Y"==l?-K*d:0):x.Xd(b,e,0)===x.Lj&&(b=h?.003*g[1]:7.5E-4*g[0],La+="X"==l?-K*b:0,Ca+="Y"==l?-K*b:0)}}function b(a,e,K,l){if(1==K){K=x.Qb(a,e,1);u.Ii(a,g);if(h)d=.003*g[0],c=7.5E-4*g[1];else var d=.003*g[1],c=7.5E-4*g[0];if(1===x.Xd(a,e,0))q+="X"==l?-K*d:0,Ma+="Y"==l?-K*d:0;else if(2===x.Xd(a,e,0)||3===x.Xd(a,e,0))ta+="X"==l?-K*c:0,za+="Y"==l?-K*c:0}}function e(a){return a[0]&&(a[1]||a[2])}function d(a,
b,e){if(!Q||!x.Qb(a,"CAMERA_COLLISION",1)){if(1==e)switch(e=x.Qb(a,b,0),u.Ii(a,g),b){case "FORWARD":t?B[0]=1:h?Math.abs(u.Dk(a))>=Math.PI/4?c(a,v.qf,.5*g[0]*e):c(a,v.rb,.5*g[0]*e):f?k(a,-g[2],e):p(a,0,-g[0]*e,0);break;case "BACKWARD":t?B[0]=-1:h?Math.abs(u.Dk(a))>=Math.PI/4?c(a,v.jc,.5*g[0]*e):c(a,v.Ba,.5*g[0]*e):f?k(a,g[2],e):p(a,0,g[0]*e,0);break;case "UP":h?n(a,30*-g[2]*e):t||p(a,0,0,-g[0]*e);break;case "DOWN":h?n(a,30*g[2]*e):t||p(a,0,0,g[0]*e);break;case "LEFT":t?B[1]=1:h?c(a,v.Ij,.5*g[0]*e):
p(a,-g[0]*e,0,0);break;case "RIGHT":t?B[1]=-1:h?c(a,v.ad,.5*g[0]*e):p(a,g[0]*e,0,0);break;case "ROT_LEFT":f?u.vg(a,2*-g[1]*e,0):u.rotate(a,2*g[1]*e,0);break;case "ROT_RIGHT":f?u.vg(a,2*g[1]*e,0):u.rotate(a,2*-g[1]*e,0);break;case "ROT_UP":f?u.vg(a,0,2*-g[1]*e):u.rotate(a,0,2*-g[1]*e);break;case "ROT_DOWN":f?u.vg(a,0,2*g[1]*e):u.rotate(a,0,2*g[1]*e)}else switch(b){case "FORWARD":case "BACKWARD":t&&(B[0]=0);break;case "LEFT":case "RIGHT":t&&(B[1]=0)}t&&(z.Yo(t,B[0],B[1]),b=N,u.Je(a,b),b[0]+=Math.PI,
b[1]*=-1,z.Gl(t,b[0],b[1]))}}var l=I.Bk(),f=!1,t=null,h=!1;switch(u.Nf(l)){case u.fa:f=!0;break;case u.kc:t=I.gC();break;case u.ci:return;case u.Xb:h=!0}var g=u.Ii(l,M),y=x.Sg();if(z.Wn(l)){var Q=x.Zm(l,null,!0);x.J(l,"CAMERA_COLLISION",x.ca,[y,Q],null,function(a,b,e){if(1==e){b=x.Xd(a,b,1);e=r.Sc(a,J);var K=C;E.sub(e,b,K);E.normalize(K,K);E.scale(K,.01,K);E.add(e,K,e);r.ep(a,e)}})}if(t){var T=r.Sc(l),s=r.Hi(l),s=v.Jm(s);T[1]-=.5;z.Hl(t,T,s);A.ez(l,t);var B=new Float32Array(2),U=!0;z.Fl(t,z.cq);x.Tg(l,
"TOGGLE_CHAR_MOVE_TYPE",x.cd,x.Fx,function(){U=!U;z.Fl(t,U?z.cq:z.px)})}var T=x.Pa(x.oq),s=x.Pa(x.mq),Y=x.Pa(x.hq),K=x.Pa(x.iq),qa=x.Pa(x.Lx),F=x.Pa(x.Gx),ja=x.Pa(x.nq),D=x.Pa(x.jq),H=x.Pa(x.kq),ia=x.Pa(x.lq);h||(x.J(l,"FORWARD",x.ca,[y,T],null,d),x.J(l,"BACKWARD",x.ca,[y,s],null,d));f?(x.J(l,"ROT_UP",x.ca,[y,ja,qa],e,d),x.J(l,"ROT_DOWN",x.ca,[y,D,F],e,d),x.J(l,"ROT_LEFT",x.ca,[y,H,Y],e,d),x.J(l,"ROT_RIGHT",x.ca,[y,ia,K],e,d)):h?(x.J(l,"LEFT",x.ca,[y,H,Y],e,d),x.J(l,"RIGHT",x.ca,[y,ia,K],e,d),x.J(l,
"FORWARD",x.ca,[y,ja,T],e,d),x.J(l,"BACKWARD",x.ca,[y,D,s],e,d),x.J(l,"UP",x.ca,[y,F],e,d),x.J(l,"DOWN",x.ca,[y,qa],e,d)):(x.J(l,"UP",x.ca,[y,qa],e,d),x.J(l,"DOWN",x.ca,[y,F],e,d),x.J(l,"LEFT",x.ca,[y,Y],e,d),x.J(l,"RIGHT",x.ca,[y,K],e,d),x.J(l,"ROT_UP",x.ca,[y,ja],e,d),x.J(l,"ROT_DOWN",x.ca,[y,D],e,d),x.J(l,"ROT_LEFT",x.ca,[y,H],e,d),x.J(l,"ROT_RIGHT",x.ca,[y,ia],e,d));var O=0,T=x.$m(),P=0,s=x.pk();x.J(l,"MOUSE_WHEEL",x.bd,[T],null,function(a,b,e){1==e&&(b=x.Qb(a,b,0),u.Ii(a,g),f||h?O=m(a,b,g[2],
O,f):(g[0]*=1+b*g[2],u.IE(a,g)))});x.J(l,"TOUCH_ZOOM",x.bd,[s],null,function(a,b,e){1==e&&(e=x.Qb(a,b,0),u.Ii(a,g),x.Xd(a,b,0)===x.Mj&&(P=m(a,e,.03*g[2],P,f)))});x.J(l,"ZOOM_INTERPOL",x.ca,[y],null,function(a,b,e){if(1==e&&(f||h))if(1E-5<Math.abs(O)||1E-5<Math.abs(P)){b=x.Qb(a,b,0);e=v.Mb(O,0,b,.1);O-=e;var K=v.Mb(P,0,b,.15);P-=K;if(!Q||!x.Qb(a,"CAMERA_COLLISION",1))if(h)n(a,-(e+K));else{b=u.Kn(a,J);var l=u.it(a,C);.001<E.dist(b,l)+e+K?r.tc(a,0,e+K,0):(e=E.subtract(l,b,C),K=E.normalize(e,R),E.scale(K,
.001,K),E.add(b,K,e),r.ep(a,e),P=O=0)}}else P=O=0});var q=0,Ma=0,ta=0,za=0,T=x.Ug("X"),s=x.Ug("Y"),Y=x.mk();x.J(l,"MOUSE_X",x.bd,[Y,T],null,b,"X");x.J(l,"MOUSE_Y",x.bd,[Y,s],null,b,"Y");var Xa=0,Qa=0,La=0,Ca=0,T=x.pi("X"),s=x.pi("Y");x.J(l,"TOUCH_X",x.bd,[T],null,a,"X");x.J(l,"TOUCH_Y",x.bd,[s],null,a,"Y");x.J(l,"ROT_TRANS_INTERPOL",x.ca,[y],null,function(a,b,e){if(1==e&&(.001<Math.abs(q)||.001<Math.abs(Ma)||.001<Math.abs(Xa)||.001<Math.abs(Qa)||.001<Math.abs(ta)||.001<Math.abs(za)||1E-5<Math.abs(La)||
1E-5<Math.abs(Ca))){var K=x.Qb(a,b,0);b=v.Mb(q,0,K,.08);e=v.Mb(Ma,0,K,.08);q-=b;Ma-=e;var l=v.Mb(Xa,0,K,.12),d=v.Mb(Qa,0,K,.12);Xa-=l;Qa-=d;var U=v.Mb(ta,0,K,.08),C=v.Mb(za,0,K,.08);ta-=U;za-=C;var k=v.Mb(La,0,K,.12),K=v.Mb(Ca,0,K,.12);La-=k;Ca-=K;f?(u.vg(a,b+l,e+d),u.rD(a,U+k,C+K)):h?(b+l&&c(a,v.ad,.2*(b+l)),e+d&&(Math.abs(u.Dk(a))>Math.PI/4?c(a,v.jc,.2*(e+d)):c(a,v.Ba,.2*(e+d))),u.Dv(a,U+k)):(u.rotate(a,.5*(b+l),.5*-(e+d)),t&&(b=N,u.Je(a,b),b[0]+=Math.PI,b[1]*=-1,z.Gl(t,b[0],b[1])))}});x.Tg(l,"DEC_STEREO_DIST",
x.cd,x.Jx,function(a){u.$v(a,.9*u.Gt(a))});x.Tg(l,"INC_STEREO_DIST",x.cd,x.Mx,function(a){u.$v(a,1.1*u.Gt(a))})};a.SI=function(){for(var a=I.Bk(),b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL".split(" "),e=0;e<b.length;e++)x.ge(a,b[e])};a.$I=function(a){function b(a){return a[0]&&(a[1]||a[2])}function e(a,b,d){if(1==d)switch(d=x.Qb(a,b,0),b){case "FORWARD":l?z.Yh(a,1):r.tc(a,0,0,1*d);
break;case "BACKWARD":l?z.Yh(a,-1):r.tc(a,0,0,-1*d);break;case "LEFT":l?z.Xh(a,-1):r.tc(a,1*d,0,0);break;case "RIGHT":l?z.Xh(a,1):r.tc(a,-1*d,0,0)}else switch(b){case "FORWARD":case "BACKWARD":l&&z.Yh(a,0);break;case "LEFT":case "RIGHT":l&&z.Xh(a,0)}}var l=z.bc(a)||z.cc(a),d=x.Sg(),c=x.Pa(x.oq),f=x.Pa(x.mq),t=x.Pa(x.hq),h=x.Pa(x.iq),C=x.Pa(x.nq),k=x.Pa(x.jq),T=x.Pa(x.kq),g=x.Pa(x.lq);x.J(a,"FORWARD",x.ca,[d,c,C],b,e);x.J(a,"BACKWARD",x.ca,[d,f,k],b,e);x.J(a,"LEFT",x.ca,[d,t,T],b,e);x.J(a,"RIGHT",
x.ca,[d,h,g],b,e)};a.UI=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],e=0;e<b.length;e++)x.ge(a,b[e])};a.gB=function(a){x.Mo(document,!1);x.No(a,!0);x.Po(a,!0);x.Oo(a,!0);x.Bl()};a.TI=function(a){x.Fp(document);x.Gp(a);x.Ip(a);x.Hp(a);x.Sw()};a.ZI=function(){x.Tg(null,"CAMERA_SHOT",x.cd,x.Hx,function(){F.eD()});x.Tg(null,"LIGHT_SHOT",x.cd,x.Ix,function(){F.hD()});x.Tg(null,"TELEMETRY",x.cd,x.Nx,function(){F.Go()})};a.bE=function(a,b){var e=document.body;function l(){document.fullscreenElement===
e||document.webkitFullScreenElement===e||document.mozFullScreenElement===e||document.webkitIsFullScreen||document.msFullscreenElement===e?a():(document.removeEventListener("fullscreenchange",l,!1),document.removeEventListener("webkitfullscreenchange",l,!1),document.removeEventListener("mozfullscreenchange",l,!1),document.removeEventListener("MSFullscreenChange",l,!1),b())}a=a||function(){};b=b||function(){};document.addEventListener("fullscreenchange",l,!1);document.addEventListener("webkitfullscreenchange",
l,!1);document.addEventListener("mozfullscreenchange",l,!1);document.addEventListener("MSFullscreenChange",l,!1);e.requestFullScreen=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen;e.requestFullScreen==e.webkitRequestFullScreen?e.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.requestFullScreen()};a.iB=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";
a.apply(document)};a.Sz=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?!0:!1};a.lL=s;a.Jk=function(a){a=!!a;var b=location.href.toString();if(-1==b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),e={},l=0;l<b.length;l++){var d=b[l].split("="),c=d[0];1<d.length?(d=d[1],a?c in e?e[c].push(d):e[c]=[d]:e[c]=d):a?c in e||(e[c]=[]):e[c]=""}return e};a.JI=function(a,b,e,
l,d,c,f){B(e,l,d,function(d){var t=d;c&&(t+=c);a.style[b]=t;(e>l&&d<=l||e<l&&d>=l)&&f()})}};b4w.module.animation=function(a,q){var d=q("__animation"),b=q("__constraints");q("__physics");var g=q("__print"),c=q("__util");a.Oa=d.Oa;a.Cq=d.Cq;a.Dq=d.Dq;a.Eq=d.Eq;a.Fq=d.Fq;a.Gq=d.Gq;a.Hq=d.Hq;a.gm=d.gm;a.hm=d.hm;a.rq=d.rq;a.tq=d.tq;a.xq=d.xq;a.vq=d.vq;a.uq=d.uq;a.sq=d.sq;a.wq=d.wq;a.bm=d.bm;a.cm=d.cm;a.dm=d.dm;var n=new Float32Array(4);a.Ga=function(a){return d.Ga(a)};a.uJ=function(){for(var a=[],b=d.PB(),c=0;c<b.length;c++)a.push(d.iF(b[c].name));return a};a.FJ=function(b,d){return a.aC(b,d)};
a.Ws=function(a){return d.Xk(a)?d.Ws(a):[]};a.aC=function(a,b){if(!d.Ga(a))return null;b=b||d.Oa;return d.bC(a,b)};a.apply=function(a,b,c){if(c>d.gm)g.error("Can't apply animation to slot "+c+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{c=c||d.Oa;if(d.Ga(a)){var n=d.Nn(a,b);if(-1!=n&&n!=c){g.error('Animation "'+b+'" is already applied to object "'+a.name+'" (slot "'+n+'").');return}}d.apply(a,b,c)}};a.remove=function(a){d.remove(a)};a.xv=function(a,b){d.Ga(a)&&(b=
b||d.Oa,d.xv(a,b))};a.um=function(a){d.um(a)};a.play=function(a,b,c){d.Ga(a)?(c=c||d.Oa,d.play(a,b,c),d.wj(a,0,c)):g.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){d.Ga(a)&&(b=b||d.Oa,d.stop(a,b))};a.Oi=function(a,b){if(!d.Ga(a))return!1;b=b||d.Oa;return d.Oi(a,b)};a.$o=function(b,d,c){a.wE(b,d,c)};a.dt=function(b,d){return a.hC(b,d)};a.wE=function(a,b,c){d.Ga(a)&&(c=c||d.Oa,d.$o(a,b,c),d.wj(a,0,c))};a.hC=function(a,b){if(!d.Ga(a))return 0;b=b||d.Oa;return d.dt(a,b)};
a.Yv=function(a,b,c){d.Ga(a)&&(c=c||d.Oa,d.Yv(a,b||1,c))};a.Dt=function(a,b){if(!d.Ga(a))return 0;b=b||d.Oa;return d.Dt(a,b)};a.LJ=function(a,b){if(d.Ga(a)){b=b||d.Oa;var c=a.D[b];if(c)return[c.start,c.start+c.length]}return null};a.Xs=function(a,b){return d.Ga(a)?(b=b||d.Oa,d.Xs(a,b)):-1};a.Vs=function(a,b){return d.Ga(a)?(b=b||d.Oa,d.Vs(a,b)):-1};a.Hc=function(b,c,g){a.El(b,c?d.bm:d.cm,g)};a.jh=function(a,b){if(!d.Ga(a))return!1;b=b||d.Oa;return d.jh(a,b)};a.El=function(a,b,c){d.Ga(a)&&(c=c||d.Oa,
d.El(a,b,c))};a.$s=function(a,b){if(!d.Ga(a))return null;b=b||d.Oa;return d.$s(a,b)};a.$q=function(a,b,c,g){g=g||d.Oa;d.Ga(a)&&d.$q(a,b,c,g)};a.wj=function(a,b,c){d.Ga(a)&&(c=c||d.Oa,d.wj(a,b||0,c))};a.Qs=function(a){return d.Qs(a)};a.yJ=function(a,d,g){if(!c.Tf(a))return null;g||(g=new Float32Array(3));b.WB(a,d,!1,n,null);g[0]=n[0];g[1]=n[1];g[2]=n[2];return g};a.Fi=function(a){return c.rc(a)?d.Fi(a):null};a.Nn=function(a,b){return d.Ga(a)&&b?d.Nn(a,b):null};a.vJ=function(a,b){if(!d.Ga(a))return null;
b=b||d.Oa;return d.SB(a,b)};a.Ys=function(a,b){return d.Ga(a)?d.Ys(a,b):null};a.ar=function(a,b){return d.ar(a,b)};a.$J=function(a){return a.d.ve};a.Wv=function(a,b,n){c.Tf(a)?(b=Math.min(Math.max(b,0),1),a.d.ve!=b&&d.Wv(a,b,n||0)):g.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.__animation=function(a,q){function d(a,b){var e=a.D[b];e&&e.vn&&e.yi&&(e.yi=!1,e.vn(a))}function b(a,b,e){e=a.D[e];e.type=30;var l=b.frame_start,d=b.frame_end-l+1;e.start=l;e.length=d;e.pc=l;e.Id=b.name;for(d=l=0;d<a.data.b4w_vertex_anim.length;d++){var c=a.data.b4w_vertex_anim[d];if(c==b)break;else l+=c.frame_end-c.frame_start+1}e.ax=l}function g(a,b,e){a=a.D[e];a.type=50;a.Id=b.name;e=b.settings;a.start=e.frame_start;a.length=e.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=e.lifetime);
a.od=b}function c(a){return a.replace(/_B4W_BAKED$/,"")}function n(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:X.ma("Wrong animation behavior")}}function p(a){var b=[];a=a.data.materials;for(var e=0;e<a.length;e++){var l=a[e].node_tree;l&&l.animation_data&&(l=l.animation_data,l.action&&b.push(l.action))}return b}function k(a){return X.rc(a)&&a.d.$l?!0:!1}function y(a){a=a.modifiers;for(var b=0;b<a.length;b++){var e=a[b];if("ARMATURE"==e.type)return e.object}return null}
function m(a,b,e){if(-1==b)for(b=0;8>b;b++){var l=a[b];l&&e(l)}else(l=a[b])&&e(l)}function s(a,b,e){F(a,b,e);d(a,e);a.d.we&&(D(a,b),z(a,b))}function B(a,b,e){var l=b.frame_range,d=b.d,c=a.D[e];c.Id=b.name;c.Pq=l;c.Ty=d.ED;c.Ry=d.yz;c.start=l[0];c.length=l[1]-l[0];c.pc=l[0];l=X.Mf(d.ck);if(X.Tf(a)&&l){c.type=10;var t=u(a,b);t||(t=I(a,b,x(a)),a.gi.push(b,t));c.g=t.g;c.va=t.va;var c=a.d,t=c.Ll,h=a.D[e],d=h.ip,T;a:{T=c.ow;for(var g=0;g<T.length;g+=2)if(b==T[g]){T=T[g+1];break a}T=null}if(T)h.ip=T;else{for(h=
0;h<t.length;h++)T=I(a,b,t[h].Fc),d.push(T);c.ow.push(b,d)}c.we&&(b=c.Tl,e>b[1]?(c=b[1],b[1]=e,b[0]=c):e>b[0]&&e<b[1]&&(b[0]=e),H(a))}else if(S.ce(a)&&(d.Ja.volume||d.Ja.pitch))c.volume=d.Ja.volume||null,c.pitch=d.Ja.pitch||null,c.type=40;else if("MESH"==a.type&&f(b)){c.type=70;d=u(a,b);if(!d){d=[];h=[];T=b.d;g=a.d.Ui;for(t in T.Ja)for(var Q=b.name+"_"+t,k=0;k<g.length;k+=2)if(Q==g[k]){d.push(g[k+1]);h.push(T.Ja[t]);break}d={WF:d,XF:h};a.gi.push(b,d)}c.Gu=d.WF;c.Hu=d.XF}else if(t=d.Ja.tsr){c.type=
20;d=u(a,b);if(!d){d=b.d.Ku;h=[];T=[];for(g=0;g<d;g++)h.push(t.subarray(8*g,8*g+4)),T.push(t.subarray(8*g+4,8*g+8));d={g:h,va:T};a.gi.push(b,d)}c.g=d.g;c.va=d.va;C.Vn(a)&&C.QF(a,c.g,c.va)}else M.warn('B4W Warning: Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),c.type=60;X.Tf(a)&&!l&&A(a,e)}function u(a,b){for(var e=a.gi,d=0;d<e.length;d+=2)if(b==e[d])return e[d+1];return null}function H(a){var b=a.d.Tl;if(-1!=b[0]&&-1!=b[1]){var e=a.D;a=e[b[1]].pc;var d=Math.floor(a),l=
a-d,b=e[b[0]];a=b.pc;d=Math.floor(a);b.pc=d+l}}function A(a,b){var e=a.d.Tl,d=e[1];e[0]=-1;e[1]=-1;if(-1!=b)for(var l=a.D;0<=d;d--){var c=l[d];if(c&&10==c.type)if(d>e[1])e[1]=d;else{d>e[0]&&(e[1]=d);break}}}function x(a){var b=a.data.bones;a=a.pose.bones;for(var e={},d=0;d<b.length;d++){var l=b[d].name;e[l]={tr:d,si:d,Ho:X.In(a,"name",l),cx:-1}}return e}function f(a){a=a.d;for(var b in a.Ja)if(-1!=b.indexOf("nodes"))return!0;return!1}function F(a,b,e){if((e=a.D[e])&&(e.play||0==b)){var d=a.d,l=e.pc,
c=e.start,f=e.length,l=l+e.speed*b*ca.Ia,t=e.type,T=e.speed;if(0<=T&&l>=c+f||0>T&&l<c)switch(e.yi=!0,e.behavior){case 10:l=0<=T?(l-c)%f+c:c+f-1E-6;break;case 20:l=0<=T?c:c+f-1E-6;e.play=!1;break;case 30:l=0<=T?c+f-1E-6:c,e.play=!1}e.pc=l;switch(t){case 10:if(!d.we){l=h(e,l,w);b=l[0];c=l[1];l=l[2];d.vc=e.va[b];d.uc=e.va[c];d.Cc=e.g[b];d.Bc=e.g[c];d.Jf=l;d=d.Ll;e=e.ip;for(f=0;f<d.length;f++)t=d[f],T=e[f],t.vc=T.va[b],t.uc=T.va[c],t.Cc=T.g[b],t.Bc=T.g[c],t.Jf=l;Z.A(a)}break;case 20:t=l=h(e,l,w);(d=ea)||
(d=new Float32Array(4));var c=t[0],f=t[1],t=t[2],T=e.g,g=T[c][1],k=T[c][2],n=T[f][1],N=T[f][2];d[0]=(1-t)*T[c][0]+t*T[f][0];d[1]=(1-t)*g+t*n;d[2]=(1-t)*k+t*N;c=l;(f=ba)||(f=new Float32Array(4));t=e.va;V.slerp(t[c[0]].subarray(0,4),t[c[1]].subarray(0,4),c[2],f);c=f;f=l[2];t=e.g;l=(1-f)*t[l[0]][3]+f*t[l[1]][3];e.Bp&&(f=ha,Z.Sc(a,f),X.Ch(d,f,b,e.Bp,d));e.Ko&&(f=Q,Z.Hi(a,f),X.rw(c,f,b,e.Ko,c));Z.Zc(a,d);Z.Yc(a,c);Z.Ye(a,l);Z.A(a);R.T(a);break;case 30:(a=w)||(a=Array(3));c=l-e.start;0>c&&(c=0);c>=e.length&&
(c=e.length);b=Math.floor(c);l=b+1;c-=b;10!=e.behavior&&l==e.length&&(l=b-=1,c=1);e=e.ax;a[0]=b+e;a[1]=l+e;a[2]=c;l=w;d.Np=l[0];d.$w=l[2];break;case 40:l=h(e,l,w);b=l[0];d=l[1];l=l[2];e.volume&&S.fp(a,(1-l)*e.volume[b]+l*e.volume[d]);e.pitch&&S.cj(a,(1-l)*e.pitch[b]+l*e.pitch[d]);break;case 50:C.FE(e.od,l/ca.Ia);break;case 70:l=h(e,l,w);b=l[0];d=l[1];l=l[2];c=e.Hu;e=e.Gu;for(f=0;f<e.length;f++)t=c[f],a.d.gg[e[f]]=(1-l)*t[b]+l*t[d];break;case 60:break;default:throw"Unknown animation type:"+t;}}}function h(a,
b,e){e||(e=Array(3));var l=a.Pq[0],d=a.Pq[1]-l;b-=l;0>b&&(b=0);b>=d&&(b=d);b/=a.Ty;d=Math.floor(b);a=a.Ry[d]?b-d:0;e[0]=d;e[1]=d+1;e[2]=a;return e}function z(a,b){var e=a.d,d=e.ve,l=e.Tl,c=l[0],l=l[1];if(-1!=l){if(-1!=c){var f=a.D[c];if(f.play||0==b)var t=h(f,f.pc,w),T=t[0],C=t[1],t=t[2],g=f.va[T],k=f.va[C],T=f.g[T],C=f.g[C];else d=1}else d=1;l=a.D[l];if(l.play||0==b)var t=h(l,l.pc,w),n=t[0],N=t[1],t=t[2];else if(-1!=c&&f.play)d=0;else return;c=l.va[n];f=l.va[N];n=l.g[n];l=l.g[N];if(1==d)e.vc.set(c),
e.uc.set(f),e.Cc.set(n),e.Bc.set(l);else if(0==d)e.vc.set(g),e.uc.set(k),e.Cc.set(T),e.Bc.set(C);else{for(N=0;N<g.length;N+=4){for(var E=ba,m=Q,v=0;4>v;v++)E[v]=g[N+v],m[v]=c[N+v];V.slerp(E,m,d,E);for(v=0;4>v;v++)e.vc[N+v]=E[v];for(v=0;4>v;v++)E[v]=k[N+v],m[v]=f[N+v];V.slerp(E,m,d,E);for(v=0;4>v;v++)e.uc[N+v]=E[v]}X.pr(T,n,d,e.Cc);X.pr(C,l,d,e.Bc)}Z.A(a);d=e.Ll;g=e.Cu;for(N=0;N<d.length;N++){k=d[N];T=g[N];for(C=0;C<T.length;C+=2)for(n=T[C],c=T[C+1],f=0;4>f;f++)k.vc[n+f]=e.vc[c+f],k.uc[n+f]=e.uc[c+
f],k.Cc[n+f]=e.Cc[c+f],k.Bc[n+f]=e.Bc[c+f];k.Jf=t}}}function D(a,b){var e=a.d,l=e.ve,d=e.pm;if(0!=d){var l=e.om-l,c=d*b;X.sign(l)==X.sign(d)&&Math.abs(c)<Math.abs(l)?e.ve+=c:(e.ve=e.om,e.pm=0)}}function I(a,b,e){for(var l=a.pose.bones,d=[],c=[],f=b.d.Ku,t=0;t<f;t++){for(var h=0;h<l.length;h++){var T=l[h],C=L.create(),g=b.d.ck[T.name];g&&L.copy(g.subarray(8*t,8*t+8),C);T.Nq=C;T.Sj=!1}h=r(a,e);d.push(h.g);c.push(h.va)}return{g:d,va:c}}function r(a,b){var e=[],l=[],d=a.pose.bones,c=new Float32Array(4),
f=new Float32Array(4),t;for(t in b){var h=b[t],C=h.si,g=d[h.Ho],h=c,Q=f,k=g.Ky,n=k[k.length-1],N=n.km;n.Sj||L.identity(N);for(n=k.length-1;0<=n;n--){var g=k[n],v=g.km;if(g.Sj)N=v;else{var E=g.Oq,m=g.Nq;L.invert(E,T);L.multiply(m,T,T);L.multiply(E,T,T);L.multiply(N,T,v);N=v;g.Sj=!0}}g=g.km;h[0]=g[0];h[1]=g[1];h[2]=g[2];h[3]=g[3];Q[0]=g[4];Q[1]=g[5];Q[2]=g[6];Q[3]=g[7];V.normalize(Q,Q);for(h=0;4>h;h++)Q=4*C+h,e[Q]=c[h],l[Q]=f[h]}e=new Float32Array(e);l=new Float32Array(l);return{g:e,va:l}}function v(a,
b,e,l,d,c,f){var t=a+(b-a)/2,h=E(t,l,d,c,f)-e;return.02>Math.abs(h)?t:0<h?v(a,t,e,l,d,c,f):v(t,b,e,l,d,c,f)}function E(a,b,e,l,d){var c=1-a;return b*c*c*c+3*e*c*c*a+3*l*c*a*a+d*a*a*a}function e(a,b){a.D||(a.D=[null,null,null,null,null,null,null,null]);a.D[b]={type:null,Id:null,va:null,g:null,ip:[],play:!1,behavior:20,pc:0,start:0,length:0,Bp:0,Ko:0,yi:!1,ax:null,speed:1,volume:null,pitch:null,Hu:[],Gu:[]};a.gi=a.gi||[];-1==pa.indexOf(a)&&pa.push(a)}function t(a,b){Z.A(a);R.T(a);s(a,0,b)}function l(a,
l,d){d=d||0;if(X.rc(a)){var c=X.Kc("name",l,a.data.b4w_vertex_anim);if(c)return e(a,d),b(a,c,d),t(a,d),!0;if((c=X.Kc("name",l,a.particle_systems))&&"EMITTER"==c.settings.type)return e(a,d),g(a,c,d),t(a,d),!0}if(c=X.Kc("name",l,ma)||X.Kc("name",l+"_B4W_BAKED",ma)){if(!X.Mf(c.fcurves))return M.error('No fcurves in action "'+c.name+'"'),!1;e(a,d);B(a,c,d);t(a,d);return!0}M.error('Unsupported object: "',a.name,'" or animation name: "',l,'"');return!1}function N(a){if("MESH"!=a.type||!a.data)return!1;
a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var e=a[b],l=e.node_tree;if(e.use_nodes&&l&&l.animation_data)return!0}return!1}var J=q("__config"),C=q("__particles"),R=q("__physics"),M=q("__print"),P=q("__scenes"),S=q("__sfx"),Z=q("__transform"),L=q("__tsr"),X=q("__util");q("mat4");var V=q("quat");q("vec4");var ca=J.Hd;a.rq=10;a.tq=20;a.xq=30;a.vq=40;a.uq=50;a.wq=60;a.sq=70;a.Oa=0;a.Cq=1;a.Dq=2;a.Eq=3;a.Fq=4;a.Gq=5;a.Hq=6;a.gm=7;a.hm=-1;a.bm=10;a.cm=20;a.dm=30;var w=Array(3),ea=new Float32Array(3),
ha=new Float32Array(3),ba=new Float32Array(4),Q=new Float32Array(4),T=new Float32Array(8);new Float32Array(16);var pa=[],ma=[];a.Qs=function(a){return a/ca.Ia};a.update=function(a){for(var b=0;b<pa.length;b++){for(var e=pa[b],l=0;8>l;l++)F(e,a,l);e.d.we&&(D(e,a),z(e,a))}for(b=0;b<pa.length;b++)for(e=pa[b],l=0;8>l&&e.D;l++)d(e,l)};a.PB=function(){return ma};a.bC=function(a,b){var e=a.D[b];return e&&e.Id?c(e.Id):null};a.Ws=function(a){var b=[];if(k(a))for(var e=0;e<a.data.b4w_vertex_anim.length;e++)b.push(a.data.b4w_vertex_anim[e].name);
var l,e=[];for(l=0;l<ma.length;l++){var d=ma[l],t=d.d;X.Mf(d.d.ck)?"ARMATURE"==a.type&&e.push(d):t.Ja.volume||t.Ja.pitch?S.ce(a)&&e.push(d):f(d)||e.push(d)}"MESH"==a.type&&(e=e.concat(p(a)));l=e;for(e=0;e<l.length;e++)b.push(c(l[e].name));if(C.Vn(a)&&C.Sk(a))for(e=0;e<a.particle_systems.length;e++)b.push(a.particle_systems[e].name);return b};a.iF=c;a.Ys=function(a,b){var e=a.D[b];return e?e.type:null};a.um=function(a){var l=0,d;d=[];var c=a.animation_data;if(c&&c.action){var f=X.Mf(c.action.d.ck);
"ARMATURE"!=a.type&&f||d.push(c.action)}S.ce(a)&&a.data.animation_data&&a.data.animation_data.action&&d.push(a.data.animation_data.action);"MESH"==a.type&&(d=d.concat(p(a)));for(c=0;c<d.length;c++)f=d[c],X.Mf(f.fcurves)?(e(a,l),B(a,f,l),t(a,l),a.D[l].behavior=n(a.b4w_anim_behavior),l++):M.error('No fcurves in action "'+f.name+'"');f=a.particle_systems;for(c=0;c<f.length;c++){var h=f[c],T=h.settings;"EMITTER"==T.type&&(e(a,l),g(a,h,l),t(a,l),a.D[l].behavior=n(a.b4w_anim_behavior),T.b4w_cyclic&&(a.D[l].behavior=
10),l++)}k(a)?(e(a,l),b(a,a.data.b4w_vertex_anim[0],l),t(a,l),a.D[l].behavior=n(a.b4w_anim_behavior)):d.length||C.Sk(a)||(e(a,0),d=a.D[0],d.type=60,d.Id=a.name+"_STATIC",c=P.pC(P.u()),d.start=c[0],d.length=c[1]-c[0]+1,t(a,l))};a.Fi=y;a.play=function(a,b,e){m(a.D,e,function(a){a.play=!0;a.vn=b?b:null;a.yi=!1});a.d.we&&H(a)};a.stop=function(a,b){m(a.D,b,function(a){a.play=!1;a.vn=null;a.yi=!1})};a.Oi=function(a,b){var e=a.D[b];return e?e.play:!1};a.$o=function(a,b,e){var l=a.D;if(-1==e)for(e=0;8>e;e++){var d=
l[e];d&&(d.pc=b,s(a,0,e))}else if(d=l[e])d.pc=b,s(a,0,e)};a.dt=function(a,b){var e=a.D[b];return e&&e.pc?e.pc:0};a.jh=function(a,b){var e=a.D[b];return e&&10==e.behavior};a.El=function(a,b,e){m(a.D,e,function(a){a.behavior=b})};a.$s=function(a,b){var e=a.D[b];return e&&e.behavior};a.$q=function(a,b,e,l){m(a.D,l,function(a){a.Bp=b||0;a.Ko=e||0})};a.xv=function(a,b){if(-1==b)for(var e=0;8>e;e++)a.D[e]=null;else a.D[b]=null;a.d.we&&A(a,b)};a.wj=s;a.Xk=function(a){if("ARMATURE"==a.type||y(a))return!0;
var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||C.Vn(a)&&C.Sk(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||N(a)?!0:!1};a.Ga=function(a){return a.D?!0:!1};a.Fz=x;a.vr=r;a.Vy=function(a){function b(a,e){for(var l=0;l<e;l++){var d=a.subarray(8*l+4,8*l+8);V.normalize(d,d)}}function e(a,b){if(-1<a.indexOf("location"))var l=0,d=b;else-1<a.indexOf("rotation_quaternion")?(l=4,d=0==b?3:b-1):(l=-1<a.indexOf("scale")?3:0,d=0);return l+
d}function l(a,b,e,d){if(-1<e.search(c)){a=b;e=e.split('"')[1];var K=f}else-1<e.indexOf("location")?(e="tsr",K=f):-1<e.indexOf("rotation_quaternion")?(e="tsr",K=f):-1<e.indexOf("scale")?(e="tsr",K=f):K=0;if(!a[e]){b=a;var t=e;if("object"==typeof K&&K.length)for(var h=K.length,T=new Float32Array(d*h),C=0;C<d;C++)for(var g=0;g<h;g++)T[C*h+g]=K[g];else if("number"==typeof K)for(T=new Float32Array(d),C=0;C<d;C++)T[C]=K;else throw"Wrong storage default value";b[t]=T}return a[e]}a.d={};var d=a.d;d.ED=1/
ca.Kf;var c=new RegExp(/pose.bones\[\".+\"\]/g),f=L.create(),t=a.fcurves,h={},T={},C=0,g;for(g in t){var Q=t[g],k;for(k in Q){var n=Q[k].mc;C||(C=n.length);for(var N=l(h,T,g,C),v=N.length/C,E=e(g,k|0),m=0;m<C;m++)N[m*v+E]=n[m]}}for(var J in h)"tsr"==J&&b(h[J],C);for(var r in T)b(T[r],C);d.Ja=h;d.ck=T;d.yz=a.Jy;d.Ku=C;ma.push(a)};a.UB=function(a,b){return(b-a)*ca.Kf+1};a.oz=function(a,b,e,l,d,c){var f,t,h=new Float32Array(2),T=new Float32Array(2),C=new Float32Array(2),g=new Float32Array(2),Q=b[1],
k=b[2],n=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var N=0,m=0,J=null;d<=c;d++)if(d<Q)for(var r=0;r<ca.Kf;r++)e[N++]=k;else if(d>n)for(r=0;r<ca.Kf;r++)e[N++]=a;else{var s=b[m],A=3;0===s&&(A+=2);0===J&&(A+=2);var y=2===s?0:1;if(b[m+1]==b[m+A+1])J=s,m+=A;else{r=0;d==b[m+1]&&(y&&(l[N]=1),e[N]=b[m+2],N++,r++);if(d==n)for(;r<ca.Kf;r++)e[N++]=a;else for(h[0]=b[m+1],h[1]=b[m+2],0!==s?(T[0]=0,T[1]=0):0===J?(T[0]=b[m+5],T[1]=b[m+6]):(T[0]=b[m+3],T[1]=b[m+4]),0!==s?(C[0]=0,C[1]=0):(C[0]=b[m+A+
3],C[1]=b[m+A+4]),g[0]=b[m+A+1],g[1]=b[m+A+2];r<ca.Kf;r++){var x=d+r/ca.Kf;switch(s){case 0:f=h;t=T;var u=C,B=g,R=[],p=[],z=void 0,F=void 0,D=void 0,z=void 0;R[0]=f[0]-t[0];R[1]=f[1]-t[1];p[0]=B[0]-u[0];p[1]=B[1]-u[1];D=B[0]-f[0];z=Math.abs(R[0]);F=Math.abs(p[0]);0!=z+F&&z+F>D&&(z=D/(z+F),t[0]=f[0]-z*R[0],t[1]=f[1]-z*R[1],u[0]=B[0]-z*p[0],u[1]=B[1]-z*p[1]);y&&(l[N]=1);e[N]=E(v(0,1,x,h[0],T[0],C[0],g[0]),h[1],T[1],C[1],g[1]);N++;break;case 1:t=h[0];u=h[1];f=B=(g[1]-u)/(g[0]-t);t=u-B*t;y&&(l[N]=1);
e[N]=f*x+t;N++;break;case 2:y&&(l[N]=1);e[N]=b[m+2];N++;break;default:throw"Unknown keyframe intepolation mode: "+s;}}d+1==b[m+A+1]&&(J=s,m+=A)}}};a.iJ=function(a){for(var b=0;b<a.length;b++)if(a[b].EH)return a[b];return!1};a.apply=l;a.Nn=function(a,b){for(var e=a.D,l=0;l<e.length;l++){var d=e[l];if(d&&c(d.Id)==c(b))return l}return-1};a.SB=function(a,b){var e=a.D[b];return e&&e.Id?c(e.Id):null};a.remove=function(a){a.D=null;a=pa.indexOf(a);-1!=a&&pa.splice(a,1)};a.UD=function(a){for(var b=ma.length-
1;0<=b;b--)ma[b].Ly==a&&ma.splice(b,1)};a.ar=function(a,b){if(!a.D)return l(a,b,0)?0:-1;for(var e=0;e<a.D.length;e++)if(!a.D[e])return l(a,b,e)?e:-1};a.Wv=function(a,b,e){a.d.pm=(b-a.d.ve)/e;a.d.om=b};a.Yv=function(a,b,e){m(a.D,e,function(a){a.speed=b})};a.Dt=function(a,b){return a.D[b].speed};a.Xs=function(a,b){return a.D[b].start};a.Vs=function(a,b){return a.D[b].length};a.Tn=N;a.ba=function(){pa.length=0;ma.length=0};a.qB=function(a,b){var e=a[b],l=(e[0]||e[1]||e[2]).mc.length,d=ba,c=ea,f=Boolean(e[0]);
f||(e[0]={mc:new Float32Array(l)});var t=Boolean(e[1]);t||(e[1]={mc:new Float32Array(l)});var h=Boolean(e[2]);h||(e[2]={mc:new Float32Array(l)});e[3]={mc:new Float32Array(l)};for(var T=0;T<l;T++)c[0]=f?e[0].mc[T]:0,c[1]=t?e[1].mc[T]:0,c[2]=h?e[2].mc[T]:0,X.Ge(c,d),e[0].mc[T]=d[3],e[1].mc[T]=d[0],e[2].mc[T]=d[1],e[3].mc[T]=d[2];l=b.replace("euler","quaternion");a[l]=e;delete a[b]}};b4w.module.__config=function(a,q){function d(){return b4w.module_check(a.dc.dk)}var b=q("__print"),g=q("__util");a.sf=1;a.rf=2;a.Ig=3;a.Bq=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.hA=g.Ea(a.context);a.p={alpha_sort:!0,alpha_sort_threshold:.1,Du:5,Qe:1E4,console_verbose:!1,do_not_load_resources:!1,Xl:!1,vB:1.5,uB:10,background_color:[0,0,0,0],force_selectable:!1,all_objs_selectable:!1,eg:.01,resolution_factor:1,canvas_resolution_factor:1,Ql:3,allow_cors:!1,yn:!1,Vj:!0,show_hud_debug_info:!1,
QI:!0,Ze:"DEPTH",anaglyph_use:!1,Al:!0,ij:.5,Vc:!0,glow:!0,ef:!0,Yg:!0,hh:!0,Mg:!0,oh:!0,Rg:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,kx:!1,zi:!0,$i:!0,La:!0,xl:!0,water_dynamic:!0,yh:!0,Jl:!0,nd:1024,po:512,Tc:53,Xw:!0,precision:"highp",quality:a.rf,mm:!0,Of:!1,tD:!1,hw:!1,vs:!1,bx:!1,Vf:!1,eu:!1,Pr:!1,Ks:!1,iM:!1,Xc:!1,allow_hidpi:!1,Rk:!1,Ls:!1};a.RA=g.Ea(a.p);a.Hd={Ia:-1,Rs:!1,Kf:1};a.controls={qD:1/120};a.Jd={dir:"ASSETS=../../assets/",lD:15,iv:!0,ro:!1,hn:!1};a.qz=g.Ea(a.Jd);a.dc={shaders_dir:"../../shaders/",
NE:"include/",dk:"built_in_data",smaa_search_texture_path:"",smaa_area_texture_path:"",dE:"./",Av:["b4w.min.js","b4w.full.min.js","src/b4w.js","webplayer.min.js"]};a.zb={enabled:!0,Qe:60,Uh:""};a.DD=g.Ea(a.zb);a.oj={Nk:1024,qk:384};a.lE=g.Ea(a.oj);a.me={dG:!0,kl:!1,jr:!1,Ir:!1,ws:!1};a.ME=g.Ea(a.me);a.kn={enabled:!1,pF:"MAIN_OPAQUE",oF:0,QE:"COLOR"};a.NA=g.Ea(a.kn);a.nz=function(){var b=a.p,d=a.zb,g=a.oj;switch(b.quality){case a.Ig:b.Ze="DEPTH";b.yh=!0;b.glow=!0;b.ef=!0;b.Yg=!0;b.hh=!0;b.Mg=!0;b.Al=
!0;b.ij=1;b.Vc=!0;b.zi=!0;b.$i=!0;b.La=!0;b.xl=!0;b.resolution_factor=1.75;g.Nk=2048;b.Ql=3;b.Vj=!0;b.Xl=!1;b.Tc=53;b.precision="highp";b.water_dynamic=!0;b.Jl=!0;b.antialiasing=!0;b.smaa=!0;b.Rg=!0;b.oh=!0;b.allow_hidpi=!0;d.Qe=120;break;case a.rf:b.Ze="DEPTH";b.yh=!0;b.glow=!0;b.ef=!0;b.Yg=!0;b.hh=!0;b.Mg=!0;b.Al=!0;b.ij=.5;b.Vc=!0;b.zi=!0;b.$i=!0;b.La=!0;b.xl=!0;b.resolution_factor=1;g.Nk=1024;b.Ql=3;b.Vj=!0;b.Xl=!1;b.Tc=53;b.precision="highp";b.water_dynamic=!0;b.Jl=!0;b.antialiasing=!0;b.smaa=
!1;b.Rg=!0;b.oh=!0;b.allow_hidpi=!1;d.Qe=60;break;case a.sf:b.Ze="NONE",b.yh=!1,b.glow=!1,b.ef=!1,b.Yg=!1,b.hh=!1,b.Mg=!1,b.Al=!1,b.ij=.5,b.Vc=!1,b.zi=!1,b.$i=!1,b.La=!1,b.xl=!1,b.resolution_factor=1,g.Nk=512,b.Ql=2,b.Vj=!1,b.Xl=!0,b.Tc=53,b.precision="mediump",b.water_dynamic=!1,b.Jl=!1,b.antialiasing=!1,b.smaa=!1,b.Rg=!1,b.oh=!1,b.allow_hidpi=!1,d.Qe=60}};a.set=function(d,g){switch(d){case "all_objs_selectable":a.p.all_objs_selectable=g;break;case "allow_cors":a.p.allow_cors=g;break;case "allow_hidpi":a.p.allow_hidpi=
g;break;case "alpha":a.context.alpha=g;break;case "alpha_sort":a.p.alpha_sort=g;break;case "alpha_sort_threshold":a.p.alpha_sort_threshold=g;break;case "anaglyph_use":a.p.anaglyph_use=g;break;case "animation_framerate":a.Hd.Ia=g;break;case "antialiasing":a.p.antialiasing=g;break;case "assets_dds_available":a.Jd.hn=g;break;case "assets_min50_available":a.Jd.ro=g;break;case "background_color":a.p.background_color=g;break;case "built_in_module_name":a.dc.dk=g;break;case "canvas_resolution_factor":a.p.canvas_resolution_factor=
g;break;case "console_verbose":a.p.console_verbose=g;break;case "context_antialias":a.context.antialias=g;break;case "do_not_load_resources":a.p.do_not_load_resources=g;break;case "force_selectable":a.p.force_selectable=g;break;case "gyro_use":a.p.Rk=g;break;case "glow":a.p.glow=g;break;case "physics_enabled":a.zb.enabled=g;break;case "physics_uranium_path":a.zb.Uh=g;break;case "precision":a.p.precision=g;break;case "quality":a.p.quality=g;break;case "resolution_factor":a.p.resolution_factor=g;break;
case "sfx_mix_mode":a.me.kl=g;break;case "shaders_dir":a.dc.shaders_dir=g;break;case "show_hud_debug_info":a.p.show_hud_debug_info=g;break;case "smaa":a.p.smaa=g;break;case "smaa_search_texture_path":a.dc.smaa_search_texture_path=g;break;case "smaa_area_texture_path":a.dc.smaa_area_texture_path=g;break;case "wireframe_debug":a.p.wireframe_debug=g;break;default:b.error("B4W config set - property unknown: "+d)}};a.get=function(d){switch(d){case "all_objs_selectable":return a.p.all_objs_selectable;case "allow_cors":return a.p.allow_cors;
case "allow_hidpi":return a.p.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.p.alpha_sort;case "alpha_sort_threshold":return a.p.alpha_sort_threshold;case "anaglyph_use":return a.p.anaglyph_use;case "animation_framerate":return a.Hd.Ia;case "antialiasing":return a.p.antialiasing;case "assets_dds_available":return a.Jd.hn;case "assets_min50_available":return a.Jd.ro;case "background_color":return a.p.background_color;case "built_in_module_name":return a.dc.dk;case "canvas_resolution_factor":return a.p.canvas_resolution_factor;
case "console_verbose":return a.p.console_verbose;case "context_antialias":return a.context.antialias;case "do_not_load_resources":return a.p.do_not_load_resources;case "force_selectable":return a.p.force_selectable;case "gyro_use":return a.p.Rk;case "glow":return a.p.glow;case "physics_enabled":return a.zb.enabled;case "physics_uranium_path":return a.zb.Uh;case "precision":return a.p.precision;case "quality":return a.p.quality;case "resolution_factor":return a.p.resolution_factor;case "sfx_mix_mode":return a.me.kl;
case "shaders_dir":return a.dc.shaders_dir;case "show_hud_debug_info":return a.p.show_hud_debug_info;case "smaa":return a.p.smaa;case "smaa_search_texture_path":return a.dc.smaa_search_texture_path;case "smaa_area_texture_path":return a.dc.smaa_area_texture_path;case "wireframe_debug":return a.p.wireframe_debug;default:b.error("B4W config get - property unknown: "+d)}};a.reset=function(){a.context=g.Ea(a.hA);a.p=g.Ea(a.RA);a.Jd=g.Ea(a.qz);a.zb=g.Ea(a.DD);a.oj=g.Ea(a.lE);a.me=g.Ea(a.ME);a.kn=g.Ea(a.NA)};
a.iu=d;a.CE=function(){var c=a.dc,g=a.zb;if(d())c.smaa_search_texture_path="smaa_search_texture.png",c.smaa_area_texture_path="smaa_area_texture.png";else if(""==c.smaa_search_texture_path||""==c.smaa_area_texture_path||""==g.Uh){for(var p=null,k=document.getElementsByTagName("script"),y=0;y<k.length;y++){for(var m=k[y].src,s=0;s<c.Av.length;s++)if(0<=m.indexOf(c.Av[s])){p=m;break}if(null!==p)break}p||(b.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),
p=document.location.href);k=p.indexOf("?");0<=k&&(p=p.substring(0,k));p=p.substring(0,p.lastIndexOf("/")+1)+c.dE;g.Uh=g.Uh||p+"uranium.js";c.smaa_search_texture_path=c.smaa_search_texture_path||p+"smaa_search_texture.png";c.smaa_area_texture_path=c.smaa_area_texture_path||p+"smaa_area_texture.png"}};a.Ft=function(){return a.Jd.dir.replace("ASSETS=","")}};b4w.module.__print=function(a){var q=!1,d=0,b=0;a.JE=function(a){q=a};a.log=function(){q&&console.log.apply(console,arguments)};a.error=function(){d++;console.error.apply(console,arguments)};a.warn=function(){b++;console.warn.apply(console,arguments)};a.time=function(){q&&console.time.apply(console,arguments)};a.timeEnd=function(){q&&console.timeEnd.apply(console,arguments)};a.group=function(){q&&console.group.apply(console,arguments)};a.groupCollapsed=function(){q&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){q&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.xC=function(){return b};a.fC=function(){return d};a.Nr=function(){d=b=0}};b4w.module.print=b4w.module.__print;b4w.module.__util=function(a,q){function d(a,b,e){for(var d=[],l=e.length,c=0;c<l;c++){var f=e[c];f[a]==b&&d.push(f)}return d}function b(a,e){var d=a instanceof Array?[]:{},l;for(l in a)d[l]=!a[l]||"object"!=typeof a[l]||-1!=e.indexOf(a[l])||a[l]instanceof Float32Array?a[l]:b(a[l],e);return d}function g(a){var b=a[0],e=a[1],l=a[2],d=a[3],c=Math.sqrt(b*b+e*e+l*l),c=1/c;a[0]=b*c;a[1]=e*c;a[2]=l*c;a[3]=d*c}function c(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function n(a,b){var e=b;switch(typeof a){case "number":return p(a,
e);case "string":return k(a,e);case "boolean":return p(a|0,e);case "function":case "undefined":return p(0,e);case "object":if(a){var l=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(l=0;l<a.length;l++)e=p(a[l],e);else if(l)for(l=0;l<a.length;l++)e=n(a[l],e);else for(var d in a)e=n(a[d],e)}else e=p(0,e)}return e}function p(a,b){var e=b;C[0]=a;e=(e<<5)-e+R[0];e&=e;e=(e<<5)-e+R[1];return e&e}function k(a,b){for(var e=b,l=0;l<a.length;l++)e=(e<<5)-e+a.charCodeAt(l),
e&=e;return e}function y(a){return(34*a+1)*a%289}function m(a){return a-Math.floor(a)}function s(a){return B((34*a+5)*a)}function B(a){return a-289*Math.floor(a/289)}function u(a){return a-7*Math.floor(a/7)}function H(a,b){if(a&&b){var e=a instanceof Array,l=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,d=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(e!=b instanceof Array||l!=d)return!1;if(e){if(a.length!=b.length)return!1;for(e=0;e<a.length;e++)if(!A(a[e],b[e]))return!1}else if(l){if(a.length!=
b.length)return!1;for(e=0;e<a.length;e++)if(a[e]!=b[e])return!1}else{for(var c in a)if(!A(a[c],b[c]))return!1;for(c in b)if(!(c in a))return!1}return!0}return!(a||b)}function A(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return H(a,b);default:return!0}}var x=q("__print"),f=q("vec3"),F=q("vec4"),h=q("quat"),z=q("mat3"),D=q("mat4"),I=0,r={},v=new Float32Array(3),E=new Float32Array(3),e=new Float32Array(4),t=new Float32Array(4),
l=new Float32Array(9),N=new Float32Array(16),J=new Float32Array(16),C=new Float64Array(1),R=new Uint32Array(C.buffer),M=new Float32Array([0,0,0]),P=new Float32Array([0,0,0,1]),S=new Float32Array([0,0,0,1,0,0,0,1]),Z=new Float32Array([1,0,0]),L=new Float32Array([0,1,0]),X=new Float32Array([0,0,1]),V=new Float32Array([-1,0,0]),ca=new Float32Array([0,-1,0]),w=new Float32Array([0,0,-1]),ea=Math.floor(44488.07041494893);a.Iy=M;a.Dy=P;a.BH=S;a.ad=Z;a.Ba=L;a.jc=X;a.Ij=V;a.rb=ca;a.qf=w;a.pu=d;a.tB=function(a,
b){var e=a.length,l=new Float32Array(e+b.length);l.set(a);l.set(b,e);return l};a.zF=function(a,b){var e=a.length,l=new Uint32Array(e+b.length);l.set(a);l.set(b,e);return l};a.Rz=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.pz=function(a,b){var e=[],l={},d=b.length,c,f;for(c=0;c<d;c++)l[b[c]]=!0;d=a.length;for(c=0;c<d;c++)f=a[c],f in l&&e.push(f);return e};a.sign=function(a){return 0<a?1:0>a?-1:0};a.GK=function(a,b,e){for(var l=e.length,d=0;d<l;d++)if(e[d][a]==
b)return!0;return!1};a.Kc=function(a,b,e){for(var l=0;l<e.length;l++){var d=e[l];if(d[a]===b)return d}return null};a.FK=function(a,b,e,l,d){for(var c=0;c<d.length;c++){var f=d[c];if(f[a]==b&&f[e]==l)return f}return null};a.In=function(a,b,e){for(var l=0;l<a.length;l++)if(a[l][b]==e)return l;return-1};a.kz=function(a,b){for(var e=0;e<a.length;e++)if(a[e]==b)return;a.push(b)};a.sI=function(a){for(var b=0;b<a.length-1;b++)for(var e=a[b],l=b+1;l<a.length;l++)if(e==a[l])return!1;return!0};a.aL=function(a,
b){for(var e=[],l=0;l<a.length;l++){var d=a[l];d.type==b&&e.push(d)}return e};a.ZK=function(a,b){var e=d("name",b,a);1<e.length&&x.error("obj_by_name(): name resolution ambiguity");return e};a.$K=function(a,b){var e=d("name",b,a),l=e.length;1<l&&x.error("obj_by_name(): name resolution ambiguity");if(0>=l)return[];for(var c=[],f=0;f<l;f++){var t=e[f];if("EMPTY"==t.type&&t.dupli_group)for(var t=t.dupli_group.objects,K=0;K<t.length;K++)c.push(t[K])}return e=e.concat(c)};a.wF=function(a,b,e,l){l||(l=
new Float32Array(16));D.identity(l);l[12]=a;l[13]=b;l[14]=e};var ha=1;a.OD=function(){ha=(69069*ha+5)%Math.pow(2,32);return Math.round(ha/65536)%32768/32767};a.gF=function(a){ha=a};a.Nc=function(a){var b=a[0]%ea*48271-3399*Math.floor(a[0]/ea);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.Wk=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.Ge=function(a,b){var e=Math.cos(a[1]/2),l=Math.cos(a[2]/2),d=Math.cos(a[0]/2),c=Math.sin(a[1]/2),f=Math.sin(a[2]/2),K=Math.sin(a[0]/2);b[0]=c*f*
d+e*l*K;b[1]=c*l*d+e*f*K;b[2]=e*f*d-c*l*K;b[3]=e*l*d-c*f*K;return b};a.hB=function(a){var b=z.create(),e=Math.cos(a[0]),l=Math.cos(a[1]),d=Math.cos(a[2]),c=Math.sin(a[0]),f=Math.sin(a[1]);a=Math.sin(a[2]);var K=e*d,t=e*a,h=c*d,g=c*a;b[0]=l*d;b[1]=l*a;b[2]=-f;b[3]=f*h-t;b[4]=f*g+K;b[5]=l*c;b[6]=f*K+g;b[7]=f*t-h;b[8]=l*e;return b};a.qv=function(a,b){var e=a[0],l=a[1],d=a[2],c=a[3],f=d*d,K=e*l+d*c;.499999<K?(b[0]=0,b[1]=2*Math.atan2(e,c),b[2]=Math.PI/2):-.499999>K?(b[0]=0,b[1]=-2*Math.atan2(e,c),b[2]=
-Math.PI/2):(b[0]=Math.atan2(2*e*c-2*l*d,1-2*e*e-2*f),b[1]=Math.atan2(2*l*c-2*e*d,1-2*l*l-2*f),b[2]=Math.asin(2*e*l+2*d*c));return b};a.S=function(a,b,e){e||(e=new Float32Array(3));f.transformQuat(b,a,e);return e};a.RI=function(a,b,e){e||(e=new Float32Array(4));a=f.normalize(a,v);var l=f.dot(b,a);a=f.cross(b,a,E);l=Math.acos(l);e[0]=a[0]*Math.sin(l/2);e[1]=a[1]*Math.sin(l/2);e[2]=a[2]*Math.sin(l/2);e[3]=Math.cos(l/2);return e};a.xF=function(a,b,e,l){l||(l=new Float32Array(4));f.transformQuat(e,b,
l);l[3]=-f.dot(a,l)};a.XA=function(a){var b=a.d.quat;switch(a.type){case "CAMERA":v[0]=0;v[1]=-1;v[2]=0;f.transformQuat(v,b,v);E[0]=0;E[1]=0;E[2]=-1;break;case "MESH":v[0]=0;v[1]=0;v[2]=1;f.transformQuat(v,b,v);E[0]=0;E[1]=0;E[2]=1;break;case "EMPTY":v[0]=0,v[1]=1,v[2]=0,f.transformQuat(v,b,v),E[0]=0,E[1]=1,E[2]=0}v[1]=0;f.normalize(v,v);a=f.dot(v,E);return Math.acos(a)*(0<-v[0]*E[2]?-1:1)};a.pr=function(a,b,e,l){if(0!=e){l=l||[];for(var d=0;d<a.length;d++)l[d]=(1-e)*a[d]+e*b[d]}};a.vM=function(){I++;
return I.toString(16)};a.Ul=function(a){r[a]||(r[a]=0);var b=a+r[a];r[a]++;return b};a.Qd=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.Eb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,I:0,ia:null,t:[],F:b}};a.du=function(a){return{name:a,type:"MESH",modifiers:[],particle_systems:[],data:null}};a.Df=function(a){return JSON.parse(JSON.stringify(a))};a.BI=
function(a,e){var l=[],d;for(d in e){var c=e[d];if(c)for(var f=0;f<c.length;f++)l.push(c[f])}return b(a,l)};a.Ea=function(b){var e=b instanceof Array?[]:{},l;for(l in b)e[l]=b[l]&&"object"==typeof b[l]?b[l]instanceof Float32Array?new Float32Array(b[l]):b[l]instanceof Uint32Array?new Uint32Array(b[l]):b[l]instanceof Uint16Array?new Uint16Array(b[l]):a.Ea(b[l]):b[l];return e};a.ni=function(a){var b=a instanceof Array?[]:{},e;for(e in a)b[e]=a[e]&&"object"==typeof a[e]?a[e]instanceof Float32Array?new Float32Array(a[e]):
a[e]instanceof Uint32Array?new Uint32Array(a[e]):a[e]instanceof Uint16Array?new Uint16Array(a[e]):a[e]instanceof Array?a[e].slice(0):a[e]:a[e];return b};a.rc=function(a){return"MESH"===a.type?!0:!1};a.TC=function(a){return"EMPTY"===a.type?!0:!1};a.Tf=function(a){return"ARMATURE"===a.type?!0:!1};a.ee=function(a,b){b||(b=new Float32Array(4));z.fromMat4(a,l);var e=l[0],d=l[3],c=l[6],f=l[1],t=l[4],K=l[7],g=l[2],C=l[5],k=l[8],e=Math.sqrt(e*e+d*d+c*c)||1,f=Math.sqrt(f*f+t*t+K*K)||1,g=Math.sqrt(g*g+C*C+
k*k)||1;l[0]/=e;l[3]/=e;l[6]/=e;l[1]/=f;l[4]/=f;l[7]/=f;l[2]/=g;l[5]/=g;l[8]/=g;h.fromMat3(l,b);return b};a.fg=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.gl=function(a){e[0]=.577350269189626;e[1]=.577350269189626;e[2]=.577350269189626;e[3]=0;F.transformMat4(e,a,e);return F.length(e)};a.Gs=function(a,b){var e=b.left,l=b.right,d=b.top,c=b.bottom,f=b.Sa,K=b.Za;e[0]=a[3]+a[0];e[1]=a[7]+a[4];e[2]=a[11]+a[8];e[3]=a[15]+a[12];l[0]=a[3]-a[0];l[1]=a[7]-a[4];l[2]=
a[11]-a[8];l[3]=a[15]-a[12];d[0]=a[3]-a[1];d[1]=a[7]-a[5];d[2]=a[11]-a[9];d[3]=a[15]-a[13];c[0]=a[3]+a[1];c[1]=a[7]+a[5];c[2]=a[11]+a[9];c[3]=a[15]+a[13];f[0]=a[3]+a[2];f[1]=a[7]+a[6];f[2]=a[11]+a[10];f[3]=a[15]+a[14];K[0]=a[3]-a[2];K[1]=a[7]-a[6];K[2]=a[11]-a[10];K[3]=a[15]-a[14];g(e);g(l);g(d);g(c);g(f);g(K)};a.bF=function(a,b,e){return e<-c(a,b.left)||e<-c(a,b.right)||e<-c(a,b.top)||e<-c(a,b.bottom)||e<-c(a,b.Sa)||e<-c(a,b.Za)?!0:!1};a.eB=function(a,b,e,l,d){t=f.dot(e,b.Za);h=f.dot(l,b.Za);K=f.dot(d,
b.Za);t=Math.sqrt(t*t+h*h+K*K);if(t<-c(a,b.Sa)||t<-c(a,b.Za))return!0;var t=f.dot(e,b.left),h=f.dot(l,b.left),K=f.dot(d,b.left);if(Math.sqrt(t*t+h*h+K*K)<-c(a,b.left))return!0;t=f.dot(e,b.right);h=f.dot(l,b.right);K=f.dot(d,b.right);if(Math.sqrt(t*t+h*h+K*K)<-c(a,b.right))return!0;t=f.dot(e,b.top);h=f.dot(l,b.top);K=f.dot(d,b.top);if(Math.sqrt(t*t+h*h+K*K)<-c(a,b.top))return!0;t=f.dot(e,b.bottom);h=f.dot(l,b.bottom);K=f.dot(d,b.bottom);return Math.sqrt(t*t+h*h+K*K)<-c(a,b.bottom)?!0:!1};a.Te=function(a,
b,e,l){l||(l=0);for(var d=a.length,c=0;c<d;c+=3){var f=a[c],t=a[c+1],h=a[c+2];e[l+c]=b[0]*f+b[4]*t+b[8]*h+b[12];e[l+c+1]=b[1]*f+b[5]*t+b[9]*h+b[13];e[l+c+2]=b[2]*f+b[6]*t+b[10]*h+b[14]}};a.$F=function(a,b,e){for(var l=0,l=0,d=a.length,c=0;c<d;c+=3){var f=a[c],t=a[c+1],h=a[c+2];e[l+c]=b[0]*f+b[4]*t+b[8]*h;e[l+c+1]=b[1]*f+b[5]*t+b[9]*h;e[l+c+2]=b[2]*f+b[6]*t+b[10]*h}};a.tF=function(a,b,e){for(var l=0,l=0,d=a.length,c=0;c<d;c+=4){var f=a[c],t=a[c+1],h=a[c+2];e[l+c]=b[0]*f+b[4]*t+b[8]*h;e[l+c+1]=b[1]*
f+b[5]*t+b[9]*h;e[l+c+2]=b[2]*f+b[6]*t+b[10]*h;e[l+c+3]=a[c+3]}};a.YF=function(a,b,l){l||(l=new Float32Array(3));e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=0;F.transformMat4(e,b,e);l[0]=e[0];l[1]=e[1];l[2]=e[2]};a.jJ=function(a,b){var e=a.length;if(!e)throw"flatten(): Wrong or empty array";var l=a[0].length;if(!l)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(e*l));for(var d=0;d<e;d++)for(var c=0;c<l;c++)b[d*l+c]=a[d][c];return b};a.ZF=function(a){for(var b=[],e=0;e<a.length;e+=3){var l=
new Float32Array([a[e],a[e+1],a[e+2]]);b[e/3]=l}return b};a.ak=function(b,e,l,d){if(d<l)return l;var c=l+Math.floor((d-l)/2);return b[c]>e?a.ak(b,e,l,c-1):b[c]<e?a.ak(b,e,c+1,d):c};a.Ae=function(a,b){for(var e=0;e<a.length;e++)if(a[e]!=b[e])return!1;return!0};a.jk=function(a,b){for(var e=0;e<a.length;e++)if(1E-7<Math.abs(a[e]-b[e]))return!1;return!0};a.iE=function(a,b,e){e||(e=new Float32Array(16));for(var l=0;12>l;l++)e[l]=a[l]*b;e[12]=a[12];e[13]=a[13];e[14]=a[14];e[15]=a[15]};a.Cp=function(a,b,
e,l){l||(l=new Float32Array(16));b=D.fromRotationTranslation(b,e,N);D.multiply(b,a,l)};a.uj=function(a,b,e,l,d){d||(d=new Float32Array(3));e=D.fromRotationTranslation(e,l,N);1!==b&&(l=D.identity(J),b=f.set(b,b,b,v),D.scale(l,b,l),D.multiply(e,l,e));f.transformMat4(a,e,d);return d};a.Dp=function(a,b,e,l){l||(l=new Float32Array(4));b=D.fromRotationTranslation(b,e,N);F.transformMat4(a,b,l)};a.tK=function(a,b,e,l,d){d||(d=new Float32Array(3));b=D.fromRotationTranslation(e,l,N);D.invert(b,b);f.transformMat4(a,
b,d);return d};a.rM=function(a,b,e){e||(e=new Float32Array(16));D.fromRotationTranslation(b,a,e);a=a[3];for(b=0;12>b;b++)e[b]*=a;return e};a.QK=function(b,e,l){a.fg(b,e);e[3]=a.gl(b);a.ee(b,l)};a.er=function(a){for(var b=[],e=0;e<a.length;e++)b.push(a[e]);return JSON.stringify(b)};a.eE=function(a,b,e,l){l||(l=new Float32Array(3));f.subtract(b,a,v);f.transformQuat(v,e,v);f.subtract(b,v,l)};a.GB=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),e=new Float32Array(16),l=new Float32Array(16),
d=new Float32Array(16),c=new Float32Array(16),f=new Float32Array(16);D.lookAt(a,[-1,0,0],[0,-1,0],b);D.scale(b,[-1,1,1],b);D.scale(b,[-1,1,-1],e);D.lookAt(a,[0,-1,0],[0,0,-1],l);D.scale(l,[1,1,-1],l);D.scale(l,[1,-1,-1],d);D.lookAt(a,[0,0,-1],[0,-1,0],c);D.scale(c,[-1,1,1],c);D.scale(c,[-1,1,-1],f);return[b,e,l,d,c,f]};a.li=function(a,b){return n(a,b)};a.$t=n;a.nK=k;a.PK=function(a,b,e){var l=b[0],d=b[1];b=b[2];var c,f,t,h,g,C,k,N,m,n,v,E;if(!e||a===e)return a[12]=a[0]*l+a[4]*d+a[8]*b+a[12],a[13]=
a[1]*l+a[5]*d+a[9]*b+a[13],a[14]=a[2]*l+a[6]*d+a[10]*b+a[14],a[15]=a[3]*l+a[7]*d+a[11]*b+a[15],a;c=a[0];f=a[1];t=a[2];h=a[3];g=a[4];C=a[5];k=a[6];N=a[7];m=a[8];n=a[9];v=a[10];E=a[11];e[0]=c;e[1]=f;e[2]=t;e[3]=h;e[4]=g;e[5]=C;e[6]=k;e[7]=N;e[8]=m;e[9]=n;e[10]=v;e[11]=E;e[12]=c*l+g*d+m*b+a[12];e[13]=f*l+C*d+n*b+a[13];e[14]=t*l+k*d+v*b+a[14];e[15]=h*l+N*d+E*b+a[15];return e};a.iD=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];
b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.pv=function(a,b){b||(b=a);var e=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<e?(b[3]=2*Math.acos(a[3]),e=1/Math.sqrt(e),b[0]=a[0]*e,b[1]=a[1]*e,b[2]=a[2]*e):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.ND=function(a){return a*Math.PI/180};a.NI=function(a){return 180*a/Math.PI};a.mp=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],e=Math.floor(a[0]+b),l=Math.floor(a[1]+b),d=.211324865405187*
e+.211324865405187*l,b=a[0]-e+d;a=a[1]-l+d;var c=b>a?1:0,f=1-c,d=b+.211324865405187-c,t=a+.211324865405187-f,h=b+-.577350269189626,g=a+-.577350269189626,e=e%289,l=l%289,C=y(y(l)+e),f=y(y(l+f)+e+c),k=y(y(l+1)+e+1),e=Math.max(.5-(b*b+a*a),0),l=Math.max(.5-(d*d+t*t),0),c=Math.max(.5-(h*h+g*g),0),N=2*m(.024390243902439*C)-1,n=2*m(.024390243902439*f)-1,v=2*m(.024390243902439*k)-1,C=Math.abs(N)-.5,f=Math.abs(n)-.5,k=Math.abs(v)-.5,N=N-Math.floor(N+.5),n=n-Math.floor(n+.5),v=v-Math.floor(v+.5),e=e*e*e*e*
(1.79284291400159-.85373472095314*(N*N+C*C)),l=l*l*l*l*(1.79284291400159-.85373472095314*(n*n+f*f)),c=c*c*c*c*(1.79284291400159-.85373472095314*(v*v+k*k));return 130*(e*(N*b+C*a)+l*(n*d+f*t)+c*(v*h+k*g))};a.zr=function(a){var b=1/7,e=b/2,l=B(Math.floor(a[0])),d=B(Math.floor(a[1])),c=m(a[0]);a=m(a[1]);var f=c-.5,t=c-1.5,c=a-.5;a-=1.5;var h=s(l),g=s(l+1),C=h,l=g,h=s(h+d),g=s(g+d),C=s(C+d+1),l=s(l+d+1),d=f+.7*(u(h)*b+e),k=t+.7*(u(g)*b+e),f=f+.7*(u(C)*b+e),t=t+.7*(u(l)*b+e),h=c+.7*(u(Math.floor(h*b))*
b+e),c=c+.7*(u(Math.floor(g*b))*b+e),C=a+.7*(u(Math.floor(C*b))*b+e),b=a+.7*(u(Math.floor(l*b))*b+e);return Math.min(d*d+h*h,k*k+c*c,f*f+C*C,t*t+b*b)};a.Jo=function(a,b,e,d,c){c||(c=new Float32Array(4));a=f.transformQuat(b,a,v);b=e[0];var t=e[1];e=e[2];l[0]=t*t+e*e;l[1]=-t*b;l[2]=-e*b;l[3]=-b*t;l[4]=b*b+e*e;l[5]=-e*t;l[6]=-b*e;l[7]=-t*e;l[8]=b*b+t*t;f.transformMat3(a,l,a);f.normalize(a,a);h.rotationTo(d,a,c);return c};a.Jm=function(a,b){b||(b=new Float32Array(4));var l=e,d=t,l=h.setAxisAngle([0,1,
0],Math.PI,h.create()),d=h.setAxisAngle([1,0,0],Math.PI/2,h.create());h.multiply(l,d,l);h.multiply(a,l,b);return b};a.ba=function(){I=0;r={}};a.xa=function(a,b,e){return Math.min(Math.max(a,b),e)};a.Mb=function(a,b,e,l){e=Math.exp(-e/l);return(1-e)*a+e*b};a.Ch=function(a,b,e,l,d){d||(d=new Float32Array(a.length));e=Math.exp(-e/l);for(l=0;l<d.length;l++)d[l]=(1-e)*a[l]+e*b[l];return d};a.rw=function(a,b,e,l,d){d||(d=new Float32Array(a.length));h.slerp(a,b,Math.exp(-e/l),d)};a.uK=function(a){return"object"===
typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.Xf=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.Um=function(a,b){var e=z.fromQuat(a,l);E[0]=0;E[1]=1;E[2]=0;v[0]=e[3];v[1]=e[4];v[2]=e[5];var d=f.cross(E,v,v);f.normalize(d,d);var c=e[7];!b&&0<c&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);E[0]=e[0];E[1]=e[1];E[2]=e[2];f.normalize(E,E);h.rotationTo(E,d,t);h.multiply(t,a,a)};a.Zs=function(a,b,e,l){e=e*b-.5;var d=l*b-.5;l=e-Math.floor(e);
var c=d-Math.floor(d);e=Math.floor(e);var d=Math.floor(d),f=b-1,t=a[d*b+e],h=a[d*b+Math.min(e+1,f)],g=a[Math.min(d+1,f)*b+e];a=a[Math.min(d+1,f)*b+Math.min(e+1,f)];return(t*(1-l)+h*l)*(1-c)+(g*(1-l)+a*l)*c};a.ug=function(a){for(var b=0,e=0;3>e;e++)0<(a&1<<e)&&b++;return b};a.Bv=function(a){for(var b=[0,0,0],e=0;3>e;e++)0<(a&1<<e)&&(b[2-e]=1);return b};a.nj=function(a,b){var e=0;(1==b||2==b)&&0<(a&4)&&e++;2==b&&0<(a&2)&&e++;return e};a.DB=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.Mf=function(a){var b=0,e;for(e in a)a.hasOwnProperty(e)&&b++;return b};a.sv=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.mx=function(a,b,e){e||(e=new Float32Array(3));e[0]=a[0]-b[0];e[1]=0;e[2]=a[2]-b[2];f.normalize(e,e)};a.sM=function(a,b,e){var l=a[0],d=a[1];a=a[2];var c=b[0],f=b[1],t=b[2];b=b[3];var h=f*a-t*d,g=t*l-c*a,C=c*d-f*l,k=f*C-t*g,t=t*h-c*C,c=c*g-f*h;e[0]=l+2*h*
b+2*k;e[1]=d+2*g*b+2*t;e[2]=a+2*C*b+2*c;return e};a.ma=function(a){a&&x.error.apply(x,arguments);throw"panic: see above for possible error messages";};a.vf=function(a){return a-2*Math.floor(a/(2*Math.PI))*Math.PI};a.Gn=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.Dw=function(a,b){for(var e in a){var l=!0,d=a[e],c=b[e];switch(typeof d){case "number":case "string":case "boolean":l=d==c;break;case "object":l=H(d,c)}if(!l)return!1}return!0};a.MD=function(a,b){var e=a[0],l=a[2],d=a[3];b[0]=a[1];b[1]=
l;b[2]=d;b[3]=e};a.CB=function(a){a+=1;132651<a&&x.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var e=Math.floor(a/51);return[b/51,e/51,a%51/51]};a.io=function(a,b,l,d,c){e.set(a);e[3]=b;t.set(d);t[3]=0;a=F.dot(e,t);if(0==a)return null;t.set(l);t[3]=1;a=-F.dot(e,t)/a;c[0]=l[0]+a*d[0];c[1]=l[1]+a*d[1];c[2]=l[2]+a*d[2];return c};a.EI=function(a,b){for(var e=0;e<a.length;e++)b[e]=a[e];return b};a.Fv=function(a,b,e){var l=f.dot(a,b);-.9999999>l?(f.cross(Z,a,v),1E-6>f.length(v)&&f.cross(L,
a,v),f.normalize(v,v),h.setAxisAngle(v,Math.PI,e)):(f.cross(a,b,v),e.set(v),e[3]=1+l,h.normalize(e,e));return e}};b4w.module.vec3=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new q(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var d=new q(3);d[0]=a[0];d[1]=a[1];d[2]=a[2];return d};a.fromValues=function(a,d,c){var n=new q(3);n[0]=a;n[1]=d;n[2]=c;return n};a.copy=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];return d};a.set=function(a,d,c,n){n[0]=a;n[1]=d;n[2]=c;return n};a.add=function(a,d,c){c[0]=a[0]+d[0];c[1]=a[1]+d[1];c[2]=a[2]+d[2];return c};
a.subtract=function(a,d,c){c[0]=a[0]-d[0];c[1]=a[1]-d[1];c[2]=a[2]-d[2];return c};a.sub=a.subtract;a.multiply=function(a,d,c){c[0]=a[0]*d[0];c[1]=a[1]*d[1];c[2]=a[2]*d[2];return c};a.mul=a.multiply;a.divide=function(a,d,c){c[0]=a[0]/d[0];c[1]=a[1]/d[1];c[2]=a[2]/d[2];return c};a.div=a.divide;a.min=function(a,d,c){c[0]=Math.min(a[0],d[0]);c[1]=Math.min(a[1],d[1]);c[2]=Math.min(a[2],d[2]);return c};a.max=function(a,d,c){c[0]=Math.max(a[0],d[0]);c[1]=Math.max(a[1],d[1]);c[2]=Math.max(a[2],d[2]);return c};
a.scale=function(a,d,c){c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;return c};a.scaleAndAdd=function(a,d,c,n){n[0]=a[0]+d[0]*c;n[1]=a[1]+d[1]*c;n[2]=a[2]+d[2]*c;return n};a.distance=function(a,d){var c=d[0]-a[0],n=d[1]-a[1],p=d[2]-a[2];return Math.sqrt(c*c+n*n+p*p)};a.dist=a.distance;a.squaredDistance=function(a,d){var c=d[0]-a[0],n=d[1]-a[1],p=d[2]-a[2];return c*c+n*n+p*p};a.sqrDist=a.squaredDistance;a.length=function(a){var d=a[0],c=a[1];a=a[2];return Math.sqrt(d*d+c*c+a*a)};a.len=a.length;a.squaredLength=
function(a){var d=a[0],c=a[1];a=a[2];return d*d+c*c+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,d){d[0]=-a[0];d[1]=-a[1];d[2]=-a[2];return d};a.inverse=function(a,d){d[0]=1/a[0];d[1]=1/a[1];d[2]=1/a[2];return d};a.normalize=function(a,d){var c=a[0],n=a[1],p=a[2],c=c*c+n*n+p*p;0<c&&(c=1/Math.sqrt(c),d[0]=a[0]*c,d[1]=a[1]*c,d[2]=a[2]*c);return d};a.dot=function(a,d){return a[0]*d[0]+a[1]*d[1]+a[2]*d[2]};a.cross=function(a,d,c){var n=a[0],p=a[1];a=a[2];var k=d[0],y=d[1];d=d[2];c[0]=p*d-a*y;c[1]=
a*k-n*d;c[2]=n*y-p*k;return c};a.lerp=function(a,d,c,n){var p=a[0],k=a[1];a=a[2];n[0]=p+c*(d[0]-p);n[1]=k+c*(d[1]-k);n[2]=a+c*(d[2]-a);return n};a.random=function(a,g){a=a||1;var c=2*d()*Math.PI,n=2*d()-1,p=Math.sqrt(1-n*n)*a;g[0]=Math.cos(c)*p;g[1]=Math.sin(c)*p;g[2]=n*a;return g};a.transformMat4=function(a,d,c){var n=a[0],p=a[1];a=a[2];var k=d[3]*n+d[7]*p+d[11]*a+d[15],k=k||1;c[0]=(d[0]*n+d[4]*p+d[8]*a+d[12])/k;c[1]=(d[1]*n+d[5]*p+d[9]*a+d[13])/k;c[2]=(d[2]*n+d[6]*p+d[10]*a+d[14])/k;return c};a.transformMat3=
function(a,d,c){var n=a[0],p=a[1];a=a[2];c[0]=n*d[0]+p*d[3]+a*d[6];c[1]=n*d[1]+p*d[4]+a*d[7];c[2]=n*d[2]+p*d[5]+a*d[8];return c};a.transformQuat=function(a,d,c){var n=a[0],p=a[1],k=a[2];a=d[0];var y=d[1],m=d[2];d=d[3];var s=d*n+y*k-m*p,B=d*p+m*n-a*k,u=d*k+a*p-y*n,n=-a*n-y*p-m*k;c[0]=s*d+n*-a+B*-m-u*-y;c[1]=B*d+n*-y+u*-a-s*-m;c[2]=u*d+n*-m+s*-y-B*-a;return c};a.rotateX=function(a,d,c,n){var p=[],k=[];p[0]=a[0]-d[0];p[1]=a[1]-d[1];p[2]=a[2]-d[2];k[0]=p[0];k[1]=p[1]*Math.cos(c)-p[2]*Math.sin(c);k[2]=
p[1]*Math.sin(c)+p[2]*Math.cos(c);n[0]=k[0]+d[0];n[1]=k[1]+d[1];n[2]=k[2]+d[2];return n};a.rotateY=function(a,d,c,n){var p=[],k=[];p[0]=a[0]-d[0];p[1]=a[1]-d[1];p[2]=a[2]-d[2];k[0]=p[2]*Math.sin(c)+p[0]*Math.cos(c);k[1]=p[1];k[2]=p[2]*Math.cos(c)-p[0]*Math.sin(c);n[0]=k[0]+d[0];n[1]=k[1]+d[1];n[2]=k[2]+d[2];return n};a.rotateZ=function(a,d,c,n){var p=[],k=[];p[0]=a[0]-d[0];p[1]=a[1]-d[1];p[2]=a[2]-d[2];k[0]=p[0]*Math.cos(c)-p[1]*Math.sin(c);k[1]=p[0]*Math.sin(c)+p[1]*Math.cos(c);k[2]=p[2];n[0]=k[0]+
d[0];n[1]=k[1]+d[1];n[2]=k[2]+d[2];return n};a.forEach=function(){var b=a.create();return function(a,d,n,p,k,y){d||(d=3);n||(n=0);for(p=p?Math.min(p*d+n,a.length):a.length;n<p;n+=d)b[0]=a[n],b[1]=a[n+1],b[2]=a[n+2],k(b,y,b),a[n]=b[0],a[n+1]=b[1],a[n+2]=b[2];return a}}();a.IH=function(b,d){var c=a.fromValues(b[0],b[1],b[2]),n=a.fromValues(d[0],d[1],d[2]);a.normalize(c,c);a.normalize(n,n);c=a.dot(c,n);return 1<c?0:Math.acos(c)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==
typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array,d=Math.random;a.create=function(){var a=new q(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var d=new q(4);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];return d};a.fromValues=function(a,d,c,n){var p=new q(4);p[0]=a;p[1]=d;p[2]=c;p[3]=n;return p};a.copy=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];return d};a.set=function(a,d,c,n,p){p[0]=a;p[1]=d;p[2]=c;p[3]=n;return p};a.add=function(a,d,c){c[0]=
a[0]+d[0];c[1]=a[1]+d[1];c[2]=a[2]+d[2];c[3]=a[3]+d[3];return c};a.subtract=function(a,d,c){c[0]=a[0]-d[0];c[1]=a[1]-d[1];c[2]=a[2]-d[2];c[3]=a[3]-d[3];return c};a.sub=a.subtract;a.multiply=function(a,d,c){c[0]=a[0]*d[0];c[1]=a[1]*d[1];c[2]=a[2]*d[2];c[3]=a[3]*d[3];return c};a.mul=a.multiply;a.divide=function(a,d,c){c[0]=a[0]/d[0];c[1]=a[1]/d[1];c[2]=a[2]/d[2];c[3]=a[3]/d[3];return c};a.div=a.divide;a.min=function(a,d,c){c[0]=Math.min(a[0],d[0]);c[1]=Math.min(a[1],d[1]);c[2]=Math.min(a[2],d[2]);c[3]=
Math.min(a[3],d[3]);return c};a.max=function(a,d,c){c[0]=Math.max(a[0],d[0]);c[1]=Math.max(a[1],d[1]);c[2]=Math.max(a[2],d[2]);c[3]=Math.max(a[3],d[3]);return c};a.scale=function(a,d,c){c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;c[3]=a[3]*d;return c};a.scaleAndAdd=function(a,d,c,n){n[0]=a[0]+d[0]*c;n[1]=a[1]+d[1]*c;n[2]=a[2]+d[2]*c;n[3]=a[3]+d[3]*c;return n};a.distance=function(a,d){var c=d[0]-a[0],n=d[1]-a[1],p=d[2]-a[2],k=d[3]-a[3];return Math.sqrt(c*c+n*n+p*p+k*k)};a.dist=a.distance;a.squaredDistance=
function(a,d){var c=d[0]-a[0],n=d[1]-a[1],p=d[2]-a[2],k=d[3]-a[3];return c*c+n*n+p*p+k*k};a.sqrDist=a.squaredDistance;a.length=function(a){var d=a[0],c=a[1],n=a[2];a=a[3];return Math.sqrt(d*d+c*c+n*n+a*a)};a.len=a.length;a.squaredLength=function(a){var d=a[0],c=a[1],n=a[2];a=a[3];return d*d+c*c+n*n+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,d){d[0]=-a[0];d[1]=-a[1];d[2]=-a[2];d[3]=-a[3];return d};a.inverse=function(a,d){d[0]=1/a[0];d[1]=1/a[1];d[2]=1/a[2];d[3]=1/a[3];return d};a.normalize=
function(a,d){var c=a[0],n=a[1],p=a[2],k=a[3],c=c*c+n*n+p*p+k*k;0<c&&(c=1/Math.sqrt(c),d[0]=a[0]*c,d[1]=a[1]*c,d[2]=a[2]*c,d[3]=a[3]*c);return d};a.dot=function(a,d){return a[0]*d[0]+a[1]*d[1]+a[2]*d[2]+a[3]*d[3]};a.lerp=function(a,d,c,n){var p=a[0],k=a[1],y=a[2];a=a[3];n[0]=p+c*(d[0]-p);n[1]=k+c*(d[1]-k);n[2]=y+c*(d[2]-y);n[3]=a+c*(d[3]-a);return n};a.random=function(b,g){b=b||1;g[0]=d();g[1]=d();g[2]=d();g[3]=d();a.normalize(g,g);a.scale(g,b,g);return g};a.transformMat4=function(a,d,c){var n=a[0],
p=a[1],k=a[2];a=a[3];c[0]=d[0]*n+d[4]*p+d[8]*k+d[12]*a;c[1]=d[1]*n+d[5]*p+d[9]*k+d[13]*a;c[2]=d[2]*n+d[6]*p+d[10]*k+d[14]*a;c[3]=d[3]*n+d[7]*p+d[11]*k+d[15]*a;return c};a.transformQuat=function(a,d,c){var n=a[0],p=a[1],k=a[2],y=d[0],m=d[1],s=d[2];d=d[3];var B=d*n+m*k-s*p,u=d*p+s*n-y*k,H=d*k+y*p-m*n,n=-y*n-m*p-s*k;c[0]=B*d+n*-y+u*-s-H*-m;c[1]=u*d+n*-m+H*-y-B*-s;c[2]=H*d+n*-s+B*-m-u*-y;c[3]=a[3];return c};a.forEach=function(){var b=a.create();return function(a,d,n,p,k,y){d||(d=4);n||(n=0);for(p=p?Math.min(p*
d+n,a.length):a.length;n<p;n+=d)b[0]=a[n],b[1]=a[n+1],b[2]=a[n+2],b[3]=a[n+3],k(b,y,b),a[n]=b[0],a[n+1]=b[1],a[n+2]=b[2],a[n+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,q){var d=q("vec3"),b=q("vec4"),g=q("mat3"),c="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new c(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=d.create(),c=d.fromValues(1,0,0),k=d.fromValues(0,1,0);return function(y,m,s){var g=d.dot(y,m);if(-.9999999>g)return d.cross(c,y,b),1E-6>d.length(b)&&d.cross(k,y,b),d.normalize(b,b),a.setAxisAngle(b,Math.PI,s),s;if(.9999999<g)return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s;d.cross(y,
m,b);s[0]=b[0];s[1]=b[1];s[2]=b[2];s[3]=1+g;return a.normalize(s,s)}}();a.setAxes=function(){var b=g.create();return function(d,c,g,m){b[0]=c[0];b[3]=c[1];b[6]=c[2];b[1]=g[0];b[4]=g[1];b[7]=g[2];b[2]=-d[0];b[5]=-d[1];b[8]=-d[2];return a.normalize(a.fromMat3(b,m),m)}}();a.clone=b.clone;a.fromValues=b.fromValues;a.copy=b.copy;a.set=b.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,d){b*=.5;var c=Math.sin(b);d[0]=c*a[0];d[1]=c*a[1];d[2]=c*a[2];d[3]=Math.cos(b);
return d};a.add=b.add;a.multiply=function(a,b,d){var c=a[0],m=a[1],s=a[2];a=a[3];var g=b[0],u=b[1],H=b[2];b=b[3];d[0]=c*b+a*g+m*H-s*u;d[1]=m*b+a*u+s*g-c*H;d[2]=s*b+a*H+c*u-m*g;d[3]=a*b-c*g-m*u-s*H;return d};a.mul=a.multiply;a.scale=b.scale;a.rotateX=function(a,b,d){b*=.5;var c=a[0],m=a[1],s=a[2];a=a[3];var g=Math.sin(b);b=Math.cos(b);d[0]=c*b+a*g;d[1]=m*b+s*g;d[2]=s*b-m*g;d[3]=a*b-c*g;return d};a.rotateY=function(a,b,d){b*=.5;var c=a[0],m=a[1],s=a[2];a=a[3];var g=Math.sin(b);b=Math.cos(b);d[0]=c*
b-s*g;d[1]=m*b+a*g;d[2]=s*b+c*g;d[3]=a*b-m*g;return d};a.rotateZ=function(a,b,d){b*=.5;var c=a[0],m=a[1],s=a[2];a=a[3];var g=Math.sin(b);b=Math.cos(b);d[0]=c*b+m*g;d[1]=m*b-c*g;d[2]=s*b+a*g;d[3]=a*b-s*g;return d};a.calculateW=function(a,b){var d=a[0],c=a[1],m=a[2];b[0]=d;b[1]=c;b[2]=m;b[3]=Math.sqrt(Math.abs(1-d*d-c*c-m*m));return b};a.dot=b.dot;a.lerp=b.lerp;a.slerp=function(a,b,d,c){var m=a[0],s=a[1],g=a[2];a=a[3];var u=b[0],H=b[1],A=b[2];b=b[3];var x,f,F;f=m*u+s*H+g*A+a*b;0>f&&(f=-f,u=-u,H=-H,
A=-A,b=-b);1E-6<1-f?(x=Math.acos(f),F=Math.sin(x),f=Math.sin((1-d)*x)/F,d=Math.sin(d*x)/F):f=1-d;c[0]=f*m+d*u;c[1]=f*s+d*H;c[2]=f*g+d*A;c[3]=f*a+d*b;return c};a.invert=function(a,b){var d=a[0],c=a[1],m=a[2],s=a[3],g=d*d+c*c+m*m+s*s,g=g?1/g:0;b[0]=-d*g;b[1]=-c*g;b[2]=-m*g;b[3]=s*g;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=b.length;a.len=a.length;a.squaredLength=b.squaredLength;a.sqrLen=a.squaredLength;a.normalize=b.normalize;a.fromMat3=function(a,
b){var d=a[0]+a[4]+a[8];if(0<d)d=Math.sqrt(d+1),b[3]=.5*d,d=.5/d,b[0]=(a[5]-a[7])*d,b[1]=(a[6]-a[2])*d,b[2]=(a[1]-a[3])*d;else{var c=0;a[4]>a[0]&&(c=1);a[8]>a[3*c+c]&&(c=2);var m=(c+1)%3,s=(c+2)%3,d=Math.sqrt(a[3*c+c]-a[3*m+m]-a[3*s+s]+1);b[c]=.5*d;d=.5/d;b[3]=(a[3*m+s]-a[3*s+m])*d;b[m]=(a[3*m+c]+a[3*c+m])*d;b[s]=(a[3*s+c]+a[3*c+s])*d}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new q(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new q(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=
a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var g=a[1],c=a[2],n=a[5];b[1]=a[3];b[2]=a[6];b[3]=g;b[5]=a[7];b[6]=c;b[7]=n}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var g=a[0],c=a[1],n=a[2],p=a[3],k=a[4],y=a[5],m=a[6],s=a[7],B=a[8],u=B*k-y*s,H=-B*p+y*m,A=
s*p-k*m,x=g*u+c*H+n*A;if(!x)return null;x=1/x;b[0]=u*x;b[1]=(-B*c+n*s)*x;b[2]=(y*c-n*k)*x;b[3]=H*x;b[4]=(B*g-n*m)*x;b[5]=(-y*g+n*p)*x;b[6]=A*x;b[7]=(-s*g+c*m)*x;b[8]=(k*g-c*p)*x;return b};a.adjoint=function(a,b){var g=a[0],c=a[1],n=a[2],p=a[3],k=a[4],y=a[5],m=a[6],s=a[7],B=a[8];b[0]=k*B-y*s;b[1]=n*s-c*B;b[2]=c*y-n*k;b[3]=y*m-p*B;b[4]=g*B-n*m;b[5]=n*p-g*y;b[6]=p*s-k*m;b[7]=c*m-g*s;b[8]=g*k-c*p;return b};a.determinant=function(a){var b=a[3],g=a[4],c=a[5],n=a[6],p=a[7],k=a[8];return a[0]*(k*g-c*p)+a[1]*
(-k*b+c*n)+a[2]*(p*b-g*n)};a.multiply=function(a,b,g){var c=a[0],n=a[1],p=a[2],k=a[3],y=a[4],m=a[5],s=a[6],B=a[7];a=a[8];var u=b[0],H=b[1],A=b[2],x=b[3],f=b[4],F=b[5],h=b[6],z=b[7];b=b[8];g[0]=u*c+H*k+A*s;g[1]=u*n+H*y+A*B;g[2]=u*p+H*m+A*a;g[3]=x*c+f*k+F*s;g[4]=x*n+f*y+F*B;g[5]=x*p+f*m+F*a;g[6]=h*c+z*k+b*s;g[7]=h*n+z*y+b*B;g[8]=h*p+z*m+b*a;return g};a.mul=a.multiply;a.translate=function(a,b,g){var c=a[0],n=a[1],p=a[2],k=a[3],y=a[4],m=a[5],s=a[6],B=a[7];a=a[8];var u=b[0];b=b[1];g[0]=c;g[1]=n;g[2]=p;
g[3]=k;g[4]=y;g[5]=m;g[6]=u*c+b*k+s;g[7]=u*n+b*y+B;g[8]=u*p+b*m+a;return g};a.rotate=function(a,b,g){var c=a[0],n=a[1],p=a[2],k=a[3],y=a[4],m=a[5],s=a[6],B=a[7];a=a[8];var u=Math.sin(b);b=Math.cos(b);g[0]=b*c+u*k;g[1]=b*n+u*y;g[2]=b*p+u*m;g[3]=b*k-u*c;g[4]=b*y-u*n;g[5]=b*m-u*p;g[6]=s;g[7]=B;g[8]=a;return g};a.scale=function(a,b,g){var c=b[0];b=b[1];g[0]=c*a[0];g[1]=c*a[1];g[2]=c*a[2];g[3]=b*a[3];g[4]=b*a[4];g[5]=b*a[5];g[6]=a[6];g[7]=a[7];g[8]=a[8];return g};a.AB=function(a,b){b[0]=1;b[1]=0;b[2]=
0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.yB=function(a,b){var g=Math.sin(a),c=Math.cos(a);b[0]=c;b[1]=g;b[2]=0;b[3]=-g;b[4]=c;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.zB=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var g=a[0],c=a[1],n=a[2],p=a[3],k=g+g,y=c+c,m=n+n,g=g*k,s=c*k,c=c*y,B=n*k,u=
n*y,n=n*m,k=p*k,y=p*y,p=p*m;b[0]=1-c-n;b[3]=s-p;b[6]=B+y;b[1]=s+p;b[4]=1-g-n;b[7]=u-k;b[2]=B-y;b[5]=u+k;b[8]=1-g-c;return b};a.normalFromMat4=function(a,b){var g=a[0],c=a[1],n=a[2],p=a[3],k=a[4],y=a[5],m=a[6],s=a[7],B=a[8],u=a[9],H=a[10],A=a[11],x=a[12],f=a[13],F=a[14],h=a[15],z=g*y-c*k,D=g*m-n*k,I=g*s-p*k,r=c*m-n*y,v=c*s-p*y,E=n*s-p*m,e=B*f-u*x,t=B*F-H*x,B=B*h-A*x,l=u*F-H*f,u=u*h-A*f,H=H*h-A*F,A=z*H-D*u+I*l+r*B-v*t+E*e;if(!A)return null;A=1/A;b[0]=(y*H-m*u+s*l)*A;b[1]=(m*B-k*H-s*t)*A;b[2]=(k*u-y*
B+s*e)*A;b[3]=(n*u-c*H-p*l)*A;b[4]=(g*H-n*B+p*t)*A;b[5]=(c*B-g*u-p*e)*A;b[6]=(f*E-F*v+h*r)*A;b[7]=(F*I-x*E-h*D)*A;b[8]=(x*v-f*I+h*z)*A;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.xB=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new q(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new q(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];b[1]=
a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var g=a[1],c=a[2],n=a[3],p=a[6],k=a[7],y=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=g;b[6]=a[9];b[7]=a[13];b[8]=c;b[9]=p;b[11]=a[14];b[12]=n;b[13]=k;
b[14]=y}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var g=a[0],c=a[1],n=a[2],p=a[3],k=a[4],y=a[5],m=a[6],s=a[7],B=a[8],u=a[9],H=a[10],A=a[11],x=a[12],f=a[13],F=a[14],h=a[15],z=g*y-c*k,D=g*m-n*k,I=g*s-p*k,r=c*m-n*y,v=c*s-p*y,E=n*s-p*m,e=B*f-u*x,t=B*F-H*x,l=B*h-A*x,N=u*F-H*f,J=u*h-A*f,C=H*h-A*F,R=z*C-D*J+I*N+r*l-v*t+E*e;if(!R)return null;
R=1/R;b[0]=(y*C-m*J+s*N)*R;b[1]=(n*J-c*C-p*N)*R;b[2]=(f*E-F*v+h*r)*R;b[3]=(H*v-u*E-A*r)*R;b[4]=(m*l-k*C-s*t)*R;b[5]=(g*C-n*l+p*t)*R;b[6]=(F*I-x*E-h*D)*R;b[7]=(B*E-H*I+A*D)*R;b[8]=(k*J-y*l+s*e)*R;b[9]=(c*l-g*J-p*e)*R;b[10]=(x*v-f*I+h*z)*R;b[11]=(u*I-B*v-A*z)*R;b[12]=(y*t-k*N-m*e)*R;b[13]=(g*N-c*t+n*e)*R;b[14]=(f*D-x*r-F*z)*R;b[15]=(B*r-u*D+H*z)*R;return b};a.adjoint=function(a,b){var g=a[0],c=a[1],n=a[2],p=a[3],k=a[4],y=a[5],m=a[6],s=a[7],B=a[8],u=a[9],H=a[10],A=a[11],x=a[12],f=a[13],F=a[14],h=a[15];
b[0]=y*(H*h-A*F)-u*(m*h-s*F)+f*(m*A-s*H);b[1]=-(c*(H*h-A*F)-u*(n*h-p*F)+f*(n*A-p*H));b[2]=c*(m*h-s*F)-y*(n*h-p*F)+f*(n*s-p*m);b[3]=-(c*(m*A-s*H)-y*(n*A-p*H)+u*(n*s-p*m));b[4]=-(k*(H*h-A*F)-B*(m*h-s*F)+x*(m*A-s*H));b[5]=g*(H*h-A*F)-B*(n*h-p*F)+x*(n*A-p*H);b[6]=-(g*(m*h-s*F)-k*(n*h-p*F)+x*(n*s-p*m));b[7]=g*(m*A-s*H)-k*(n*A-p*H)+B*(n*s-p*m);b[8]=k*(u*h-A*f)-B*(y*h-s*f)+x*(y*A-s*u);b[9]=-(g*(u*h-A*f)-B*(c*h-p*f)+x*(c*A-p*u));b[10]=g*(y*h-s*f)-k*(c*h-p*f)+x*(c*s-p*y);b[11]=-(g*(y*A-s*u)-k*(c*A-p*u)+B*
(c*s-p*y));b[12]=-(k*(u*F-H*f)-B*(y*F-m*f)+x*(y*H-m*u));b[13]=g*(u*F-H*f)-B*(c*F-n*f)+x*(c*H-n*u);b[14]=-(g*(y*F-m*f)-k*(c*F-n*f)+x*(c*m-n*y));b[15]=g*(y*H-m*u)-k*(c*H-n*u)+B*(c*m-n*y);return b};a.determinant=function(a){var b=a[0],g=a[1],c=a[2],n=a[3],p=a[4],k=a[5],y=a[6],m=a[7],s=a[8],B=a[9],u=a[10],H=a[11],A=a[12],x=a[13],f=a[14];a=a[15];return(b*k-g*p)*(u*a-H*f)-(b*y-c*p)*(B*a-H*x)+(b*m-n*p)*(B*f-u*x)+(g*y-c*k)*(s*a-H*A)-(g*m-n*k)*(s*f-u*A)+(c*m-n*y)*(s*x-B*A)};a.multiply=function(a,b,g){var c=
a[0],n=a[1],p=a[2],k=a[3],y=a[4],m=a[5],s=a[6],B=a[7],u=a[8],H=a[9],A=a[10],x=a[11],f=a[12],F=a[13],h=a[14];a=a[15];var z=b[0],D=b[1],I=b[2],r=b[3];g[0]=z*c+D*y+I*u+r*f;g[1]=z*n+D*m+I*H+r*F;g[2]=z*p+D*s+I*A+r*h;g[3]=z*k+D*B+I*x+r*a;z=b[4];D=b[5];I=b[6];r=b[7];g[4]=z*c+D*y+I*u+r*f;g[5]=z*n+D*m+I*H+r*F;g[6]=z*p+D*s+I*A+r*h;g[7]=z*k+D*B+I*x+r*a;z=b[8];D=b[9];I=b[10];r=b[11];g[8]=z*c+D*y+I*u+r*f;g[9]=z*n+D*m+I*H+r*F;g[10]=z*p+D*s+I*A+r*h;g[11]=z*k+D*B+I*x+r*a;z=b[12];D=b[13];I=b[14];r=b[15];g[12]=z*c+
D*y+I*u+r*f;g[13]=z*n+D*m+I*H+r*F;g[14]=z*p+D*s+I*A+r*h;g[15]=z*k+D*B+I*x+r*a;return g};a.mul=a.multiply;a.translate=function(a,b,g){var c=b[0],n=b[1];b=b[2];var p,k,y,m,s,B,u,H,A,x,f,F;a===g?(g[12]=a[0]*c+a[4]*n+a[8]*b+a[12],g[13]=a[1]*c+a[5]*n+a[9]*b+a[13],g[14]=a[2]*c+a[6]*n+a[10]*b+a[14],g[15]=a[3]*c+a[7]*n+a[11]*b+a[15]):(p=a[0],k=a[1],y=a[2],m=a[3],s=a[4],B=a[5],u=a[6],H=a[7],A=a[8],x=a[9],f=a[10],F=a[11],g[0]=p,g[1]=k,g[2]=y,g[3]=m,g[4]=s,g[5]=B,g[6]=u,g[7]=H,g[8]=A,g[9]=x,g[10]=f,g[11]=F,
g[12]=p*c+s*n+A*b+a[12],g[13]=k*c+B*n+x*b+a[13],g[14]=y*c+u*n+f*b+a[14],g[15]=m*c+H*n+F*b+a[15]);return g};a.scale=function(a,b,g){var c=b[0],n=b[1];b=b[2];g[0]=a[0]*c;g[1]=a[1]*c;g[2]=a[2]*c;g[3]=a[3]*c;g[4]=a[4]*n;g[5]=a[5]*n;g[6]=a[6]*n;g[7]=a[7]*n;g[8]=a[8]*b;g[9]=a[9]*b;g[10]=a[10]*b;g[11]=a[11]*b;g[12]=a[12];g[13]=a[13];g[14]=a[14];g[15]=a[15];return g};a.rotate=function(a,b,g,c){var n=g[0],p=g[1];g=g[2];var k=Math.sqrt(n*n+p*p+g*g),y,m,s,B,u,H,A,x,f,F,h,z,D,I,r,v,E,e,t,l;if(1E-7>Math.abs(k))return null;
k=1/k;n*=k;p*=k;g*=k;y=Math.sin(b);m=Math.cos(b);s=1-m;b=a[0];k=a[1];B=a[2];u=a[3];H=a[4];A=a[5];x=a[6];f=a[7];F=a[8];h=a[9];z=a[10];D=a[11];I=n*n*s+m;r=p*n*s+g*y;v=g*n*s-p*y;E=n*p*s-g*y;e=p*p*s+m;t=g*p*s+n*y;l=n*g*s+p*y;n=p*g*s-n*y;p=g*g*s+m;c[0]=b*I+H*r+F*v;c[1]=k*I+A*r+h*v;c[2]=B*I+x*r+z*v;c[3]=u*I+f*r+D*v;c[4]=b*E+H*e+F*t;c[5]=k*E+A*e+h*t;c[6]=B*E+x*e+z*t;c[7]=u*E+f*e+D*t;c[8]=b*l+H*n+F*p;c[9]=k*l+A*n+h*p;c[10]=B*l+x*n+z*p;c[11]=u*l+f*n+D*p;a!==c&&(c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);
return c};a.rotateX=function(a,b,g){var c=Math.sin(b);b=Math.cos(b);var n=a[4],p=a[5],k=a[6],y=a[7],m=a[8],s=a[9],B=a[10],u=a[11];a!==g&&(g[0]=a[0],g[1]=a[1],g[2]=a[2],g[3]=a[3],g[12]=a[12],g[13]=a[13],g[14]=a[14],g[15]=a[15]);g[4]=n*b+m*c;g[5]=p*b+s*c;g[6]=k*b+B*c;g[7]=y*b+u*c;g[8]=m*b-n*c;g[9]=s*b-p*c;g[10]=B*b-k*c;g[11]=u*b-y*c;return g};a.rotateY=function(a,b,g){var c=Math.sin(b);b=Math.cos(b);var n=a[0],p=a[1],k=a[2],y=a[3],m=a[8],s=a[9],B=a[10],u=a[11];a!==g&&(g[4]=a[4],g[5]=a[5],g[6]=a[6],
g[7]=a[7],g[12]=a[12],g[13]=a[13],g[14]=a[14],g[15]=a[15]);g[0]=n*b-m*c;g[1]=p*b-s*c;g[2]=k*b-B*c;g[3]=y*b-u*c;g[8]=n*c+m*b;g[9]=p*c+s*b;g[10]=k*c+B*b;g[11]=y*c+u*b;return g};a.rotateZ=function(a,b,g){var c=Math.sin(b);b=Math.cos(b);var n=a[0],p=a[1],k=a[2],y=a[3],m=a[4],s=a[5],B=a[6],u=a[7];a!==g&&(g[8]=a[8],g[9]=a[9],g[10]=a[10],g[11]=a[11],g[12]=a[12],g[13]=a[13],g[14]=a[14],g[15]=a[15]);g[0]=n*b+m*c;g[1]=p*b+s*c;g[2]=k*b+B*c;g[3]=y*b+u*c;g[4]=m*b-n*c;g[5]=s*b-p*c;g[6]=B*b-k*c;g[7]=u*b-y*c;return g};
a.AB=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.zB=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.yB=function(a,b,g){var c=b[0],n=b[1];b=b[2];var p=Math.sqrt(c*c+n*n+b*b),k;if(1E-7>Math.abs(p))return null;p=1/p;c*=p;n*=p;b*=p;p=Math.sin(a);a=Math.cos(a);k=1-a;g[0]=c*c*k+a;g[1]=n*c*k+b*
p;g[2]=b*c*k-n*p;g[3]=0;g[4]=c*n*k-b*p;g[5]=n*n*k+a;g[6]=b*n*k+c*p;g[7]=0;g[8]=c*b*k+n*p;g[9]=n*b*k-c*p;g[10]=b*b*k+a;g[11]=0;g[12]=0;g[13]=0;g[14]=0;g[15]=1;return g};a.lJ=function(a,b){var g=Math.sin(a),c=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=c;b[6]=g;b[7]=0;b[8]=0;b[9]=-g;b[10]=c;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.mJ=function(a,b){var g=Math.sin(a),c=Math.cos(a);b[0]=c;b[1]=0;b[2]=-g;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=g;b[9]=0;b[10]=c;b[11]=0;b[12]=0;b[13]=0;
b[14]=0;b[15]=1;return b};a.nJ=function(a,b){var g=Math.sin(a),c=Math.cos(a);b[0]=c;b[1]=g;b[2]=0;b[3]=0;b[4]=-g;b[5]=c;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,g){var c=a[0],n=a[1],p=a[2],k=a[3],y=c+c,m=n+n,s=p+p;a=c*y;var B=c*m,c=c*s,u=n*m,n=n*s,p=p*s,y=k*y,m=k*m,k=k*s;g[0]=1-(u+p);g[1]=B+k;g[2]=c-m;g[3]=0;g[4]=B-k;g[5]=1-(a+p);g[6]=n+y;g[7]=0;g[8]=c+m;g[9]=n-y;g[10]=1-(a+u);g[11]=0;g[12]=b[0];g[13]=b[1];g[14]=b[2];
g[15]=1;return g};a.fromQuat=function(a,b){var g=a[0],c=a[1],n=a[2],p=a[3],k=g+g,y=c+c,m=n+n,g=g*k,s=c*k,c=c*y,B=n*k,u=n*y,n=n*m,k=p*k,y=p*y,p=p*m;b[0]=1-c-n;b[1]=s+p;b[2]=B-y;b[3]=0;b[4]=s-p;b[5]=1-g-n;b[6]=u+k;b[7]=0;b[8]=B+y;b[9]=u-k;b[10]=1-g-c;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,g,c,n,p,k){var y=1/(b-a),m=1/(c-g),s=1/(n-p);k[0]=2*n*y;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=2*n*m;k[6]=0;k[7]=0;k[8]=(b+a)*y;k[9]=(c+g)*m;k[10]=(p+n)*s;k[11]=-1;k[12]=0;k[13]=0;k[14]=
p*n*2*s;k[15]=0;return k};a.perspective=function(a,b,g,c,n){a=1/Math.tan(a/2);var p=1/(g-c);n[0]=a/b;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=a;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=(c+g)*p;n[11]=-1;n[12]=0;n[13]=0;n[14]=2*c*g*p;n[15]=0;return n};a.bL=function(a,b,g,c){var n=Math.tan(a.wM*Math.PI/180),p=Math.tan(a.VI*Math.PI/180),k=Math.tan(a.IK*Math.PI/180);a=Math.tan(a.oL*Math.PI/180);var y=2/(k+a),m=2/(n+p);c[0]=y;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=m;c[6]=0;c[7]=0;c[8]=-((k-a)*y*.5);c[9]=(n-p)*m*.5;c[10]=g/
(b-g);c[11]=-1;c[12]=0;c[13]=0;c[14]=g*b/(b-g);c[15]=0;return c};a.ortho=function(a,b,g,c,n,p,k){var y=1/(a-b),m=1/(g-c),s=1/(n-p);k[0]=-2*y;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=-2*m;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=2*s;k[11]=0;k[12]=(a+b)*y;k[13]=(c+g)*m;k[14]=(p+n)*s;k[15]=1;return k};a.lookAt=function(d,b,g,c){var n,p,k,y,m,s,B,u,H=d[0],A=d[1];d=d[2];k=g[0];y=g[1];p=g[2];B=b[0];g=b[1];n=b[2];if(1E-7>Math.abs(H-B)&&1E-7>Math.abs(A-g)&&1E-7>Math.abs(d-n))return a.identity(c);b=H-B;g=A-g;B=d-n;u=1/Math.sqrt(b*
b+g*g+B*B);b*=u;g*=u;B*=u;n=y*B-p*g;p=p*b-k*B;k=k*g-y*b;(u=Math.sqrt(n*n+p*p+k*k))?(u=1/u,n*=u,p*=u,k*=u):k=p=n=0;y=g*k-B*p;m=B*n-b*k;s=b*p-g*n;(u=Math.sqrt(y*y+m*m+s*s))?(u=1/u,y*=u,m*=u,s*=u):s=m=y=0;c[0]=n;c[1]=y;c[2]=b;c[3]=0;c[4]=p;c[5]=m;c[6]=g;c[7]=0;c[8]=k;c[9]=s;c[10]=B;c[11]=0;c[12]=-(n*H+p*A+k*d);c[13]=-(y*H+m*A+s*d);c[14]=-(b*H+g*A+B*d);c[15]=1;return c};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.xB=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.__particles=function(a,q){function d(){throw"_rand() undefined";}function b(a,b,c,d,k,h,m){var s=a.O.mn,g=a.O.ld,r=a.O.time;a=a.O.hv;for(var v=b?4:1,E=0;E<s.length;E+=v){var e=s[E];if(e>a&&e<=r)for(e=0;8>e;e++)g[8*E+e]=k[e];for(e=0;8>e;e++)B[e]=g[8*E+e];e=u;e[0]=c[3*E];e[1]=c[3*E+1];e[2]=c[3*E+2];y.uj(e,B,e);h[3*E]=e[0];h[3*E+1]=e[1];h[3*E+2]=e[2];var t=u;t[0]=d[3*E];t[1]=d[3*E+1];t[2]=d[3*E+2];y.Rl(t,B,t);m[3*E]=t[0];m[3*E+1]=t[1];m[3*E+2]=t[2];if(b)for(e=1;4>e;e++)h[3*(E+e)]=h[3*E],h[3*
(E+e)+1]=h[3*E+1],h[3*(E+e)+2]=h[3*E+2],m[3*(E+e)]=t[0],m[3*(E+e)+1]=t[1],m[3*(E+e)+2]=t[2]}}function g(a){a?(k.gF(a),d=function(){return k.OD()}):d=function(){return Math.random()}}var c=q("__config"),n=q("__geometry"),p=q("__scenes"),k=q("__util"),y=q("__tsr"),m=q("vec3"),s=c.Hd,B=new Float32Array(8),u=new Float32Array(3);a.Vn=function(a){return 0<a.particle_systems.length?!0:!1};a.Sk=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.kK=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.IC=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.HB=function(a,c,u,f){u.O=u.O||{};var y=n.oB(c),h=u.settings.count,z=u.settings.frame_start/s.Ia,B=u.settings.frame_end/s.Ia,p=u.settings.lifetime/s.Ia,r=u.settings.lifetime_random,v=u.settings.emit_from,E=
u.settings.factor_random,e=u.settings.angular_velocity_mode,t=u.settings.angular_velocity_factor,l=u.settings.b4w_randomize_emission,N=u.settings.b4w_cyclic;g(u.seed);var J=u.O.VF="WORLD"==u.settings.b4w_coordinate_system?!0:!1;u.O.frame=0;if(c=!a.Pf){var C;C=[];for(var R=0;R<h;R++)C.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);C=new Float32Array(C);for(var R=[],M=0;M<h;M++)R.push(4*M,4*M+2,4*M+1,4*M,4*M+3,4*M+2);R=new Uint16Array(R)}switch(v){case "VERT":for(var M=y.t[0].a_position,y=y.t[0].a_normal,P=M.length/
3,v=[],q=0;q<h;q++){var Z=Math.round((P-1)*d());v.push(Z);c&&(v.push(Z),v.push(Z),v.push(Z))}P=[];for(q=0;q<v.length;q++)P.push(M[3*v[q]]),P.push(M[3*v[q]+1]),P.push(M[3*v[q]+2]);M=new Float32Array(P);P=[];for(q=0;q<v.length;q++)P.push(y[3*v[q]]),P.push(y[3*v[q]+1]),P.push(y[3*v[q]+2]);v=new Float32Array(P);break;case "FACE":M=[];v=[];q=[];k.Wk(0,q);P=n.Cn(y,h,!1,q);k.Wk(0,q);y=n.Cn(y,h,!0,q);for(q=0;q<P.length;q++)M.push(P[q][0],P[q][1],P[q][2]),c&&(M.push(P[q][0],P[q][1],P[q][2]),M.push(P[q][0],
P[q][1],P[q][2]),M.push(P[q][0],P[q][1],P[q][2])),v.push(y[q][0],y[q][1],y[q][2]),c&&(v.push(y[q][0],y[q][1],y[q][2]),v.push(y[q][0],y[q][1],y[q][2]),v.push(y[q][0],y[q][1],y[q][2]));M=new Float32Array(M);v=new Float32Array(v);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}v=[M,v];y=v[0];v=v[1];u.O.HD=new Float32Array(y);u.O.wD=new Float32Array(v);u.O.ID=new Float32Array(y.length);u.O.xD=new Float32Array(v.length);u.O.time=0;u.O.hv=
-1;M=[];B=(B-z)/h;for(P=0;P<h;P++)q=l?B*P+10*B*(.5-d()):B*P,N||(q+=z),M.push(q),c&&(M.push(q),M.push(q),M.push(q));z=new Float32Array(M);u.O.mn=new Float32Array(z);u.O.ss=new Float32Array(z);u.O.ld=new Float32Array(8*z.length);for(l=0;l<8*z.length;l++)for(N=0;8>N;N++)u.O.ld[8*l+N]=f[N];J&&b(u,c,y,v,f,y,v);u=[];f=p*r;for(r=0;r<h;r++)J=f*d(),u.push(p-J),c&&(u.push(p-J),u.push(p-J),u.push(p-J));p=new Float32Array(u);u=[];for(f=0;f<h;f++){r=[d()-.5,d()-.5,d()-.5];m.normalize(r,r);u.push(E*r[0]);u.push(E*
r[1]);u.push(E*r[2]);switch(e){case "NONE":u.push(0);break;case "SPIN":case "VELOCITY":u.push(t);break;case "RAND":u.push(2*t*(d()-.5));break;default:throw"Undefined velocity factor";}if(c)for(r=u.slice(-4),J=0;12>J;J++)u.push(r[J%4])}h=new Float32Array(u);E=k.Eb("EMITTER_PARTICLES");e=k.Qd();e.a_position=y;e.a_normal=v;E.t[0]=e;c?E.ia=R:(a.De=n.eq,E.ia=new Uint16Array(0));E.I=y.length/3;E.F.a_p_delay=z;E.F.a_p_lifetime=p;E.F.a_p_vels=h;c&&(E.F.a_p_bb_vertex=C);return E};a.FF=function(a){for(var c=
a.ga,d=0;d<c.length;d++){var f=c[d],m=c[d].od;if(m){var h=f.Gc;if(!m.O.VF)break;var k=m.O.ID,s=m.O.xD;b(m,!f.Pf,m.O.HD,m.O.wD,a.d.qe,k,s);n.gD(h);n.Kp(h,"a_position",3,k);n.Kp(h,"a_normal",3,s)}}};a.uE=function(a,b,c){var d=b.settings.lifetime/s.Ia,m=b.settings.normal_factor,h=9.81*b.settings.effector_weights.gravity,k=b.settings.effector_weights.wind,g=b.settings.mass,u=b.settings.b4w_fade_in/s.Ia,r=b.settings.b4w_fade_out/s.Ia,v=b.settings.b4w_cyclic;a.Vu=b.settings.frame_end/s.Ia-b.settings.frame_start/
s.Ia;a.Ru=v?1:0;a.Bo=m;a.Uu=h;m=p.yC();a.ql[0]=m[0]*k;a.ql[1]=m[1]*k;a.ql[2]=m[2]*k;a.Xu=d;a.Wu=g;a.Su=u;a.Tu=r;a.Pf?(d=c.halo.size,k=c.halo.hardness,30>k?(k=.5,g=.9):40>k?(k=.1,g=1):50>k?(k=0,g=.8):(k=0,g=.5)):(d=b.settings.particle_size,g=k=1);a.Co=d;a.Ou=k;a.Nu=g;d=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;k=Math.min(2*d.length,b.length);for(g=0;g<k;g+=2)u=
d[g/2],b[g]=u.position,b[g+1]=(u.color[0]+u.color[1]+u.color[2])/3;a.Zu=d.length}a.Yu.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;k=Math.min(4*d.length,c.length);for(g=0;g<k;g+=4)u=d[g/4],c[g]=u.position,c[g+1]=u.color[0],c[g+2]=u.color[1],c[g+3]=u.color[2];a.Qu=d.length}a.Pu.set(c)};a.FE=function(a,b){a.O.hv=a.O.time;a.O.time=b};a.JD=
function(a){for(var b=a.I,c=a.t[0].a_position,d=a.F.a_texcoord,k=[],h=[],m=0;m<b;m++)h.push(c[3*m]),h.push(c[3*m+1]),k.push(c[3*m+2]);k=new Float32Array(k);h=new Float32Array(h);a.F.a_lf_dist=k;a.F.a_lf_bb_vertex=h;a.F.a_texcoord=d;return a};a.bM=function(a,b,c){a=a.ga;for(var d=0;d<a.length;d++){var k=a[d],h=k.od;h&&h.name==b&&(k.Co=c)}};a.QL=function(a,b,c){a=a.ga;for(var d=0;d<a.length;d++){var k=a[d],h=k.od;h&&h.name==b&&(k.Bo=c)}};a.EL=function(a,b,c){a=a.ga;for(var d=0;d<a.length;d++){var k=
a[d],h=k.od;if(h&&h.name==b){var m=h.O.mn;if(1==c)h=m;else if(0==c)for(var g=!k.Pf,s=g?4:1,h=h.O.ss,r=0;r<h.length;r+=s)h[r]=1E4,g&&(h[r+1]=h[r],h[r+2]=h[r],h[r+3]=h[r]);else for(var v=1/c,h=h.O.ss,s=(g=!k.Pf)?4:1,E=0,r=0;r<h.length;r+=s)r>=E?(h[r]=m[r],E+=v):h[r]=1E4,g&&(h[r+1]=h[r],h[r+2]=h[r],h[r+3]=h[r]);n.Kp(k.Gc,"a_p_delay",1,h)}}};a.QF=function(a,b,c){a=a.particle_systems;for(var d=0;d<a.length;d++){var k=a[d];if("EMITTER"==k.settings.type)for(var h=k.O.mn,d=0;d<8*h.length;d++)k.O.ld[8*d]=
b[0],k.O.ld[8*d+1]=b[1],k.O.ld[8*d+2]=b[2],k.O.ld[8*d+3]=b[3],k.O.ld[8*d+4]=c[0],k.O.ld[8*d+5]=c[1],k.O.ld[8*d+6]=c[2],k.O.ld[8*d+7]=c[3]}}};b4w.module.__geometry=function(a,q){function d(a){return 65536<a.I?I.gt()?!1:!0:!1}function b(a){return 0<a.ia.length?!0:!1}function g(a,e,d){if(!b(a))return a;d||h.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.I*(e||1)+", will use drawArrays","color: #aa0");e=a.ia;d=a.I;var f=a.F,t=a.t,k;for(k in f){var m=f[k],v=u(m,d);f[k]=c(e,m,v)}for(f=0;f<t.length;f++){var E=t[f];for(k in E)m=E[k],v=u(m,d),E[k]=c(e,m,v)}a.I=e.length;a.ia=new Uint16Array(0);return a}function c(a,b,e){if(0==
b.length)return new Float32Array(0);for(var c=new Float32Array(a.length*e),d=0;d<a.length;d++)for(var f=a[d],t=0;t<e;t++)c[e*d+t]=b[e*f+t];return c}function n(a,b){var e=a.kf,c=a.dj[b];if(c)return e.subarray(c.offset,c.offset+c.length);throw"extract_array() failed; invalid name: "+b;}function p(b,e){var c,d;switch(e){case a.bi:case a.Jj:c=t.TRIANGLES;d=t.STATIC_DRAW;break;case a.eq:c=t.POINTS;d=t.STATIC_DRAW;break;case a.dq:c=t.TRIANGLES;d=t.DYNAMIC_DRAW;break;case a.rx:c=t.POINTS;d=t.DYNAMIC_DRAW;
break;case a.sx:c=t.LINES;d=t.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=c;b.yj=d}function k(a){a.Qf?(a.$d||(a.$d=t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.$d),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a.Qf,a.yj),a.rk=a.Qf.byteLength):a.rk=0;a.Cg||(a.Cg=t.createBuffer());t.bindBuffer(t.ARRAY_BUFFER,a.Cg);t.bufferData(t.ARRAY_BUFFER,a.kf,a.yj);a.rs=a.kf.byteLength}function y(a){for(var b=D.Eb("JOIN_"+a.length+"_SUBMESHES"),e=0,c=0;c<a.length;c++)e+=a[c].ia.length;b.ia=new Uint32Array(e);
for(c=e=0;c<a.length;c++)e+=a[c].I;b.I=e;var d=a[0],f;for(f in d.F){for(c=e=0;c<a.length;c++)e+=a[c].F[f].length;b.F[f]=new Float32Array(e)}for(f in d.t[0]){for(c=e=0;c<a.length;c++)e+=a[c].t[0][f].length;for(c=0;c<d.t.length;c++)b.t[c]=b.t[c]||{},b.t[c][f]=new Float32Array(e)}for(d=c=e=0;d<a.length;d++){f=a[d];for(var t=f.ia,h=f.I,k=f.F,m=0;m<t.length;m++)b.ia[e+m]=t[m]+c;var e=e+t.length,v;for(v in k){var t=k[v],E=c*u(t,h);b.F[v].set(t,E)}for(m=0;m<f.t.length;m++){var k=f.t[m],g=b.t[m];for(v in k)t=
k[v],E=c*u(t,h),g[v].set(t,E)}c+=h}return b}function m(a,b,e,c,d,t){var k=D.Eb("SUBMESH_"+a.name+"_"+b),m=a.submeshes[b],u=m.base_length,n=a.materials[b];k.I=u;if(s(e,"a_texcoord")){var y=null,A=a.materials[b];b=a.submeshes[b];if(A.texture_slots.length)switch(A=A.texture_slots[0],A.texture_coords){case "UV":A=a.uv_textures.indexOf(A.uv_layer);-1==A||0==A?y=new Float32Array(b.texcoord):1==A&&(y=new Float32Array(b.texcoord2));break;case "ORCO":for(var z=a.b4w_bounding_box,y=new Float32Array(2*b.base_length),
A=(z.max_x+z.min_x)/2,x=(z.max_z+z.min_z)/2,p=z.max_x-z.min_x,z=z.max_z-z.min_z,F=0,H=0;H<b.position.length;H+=3)y[F++]=(b.position[H]-A)/p+.5,y[F++]=(x-b.position[H+2])/z+.5}null===y&&(y=new Float32Array(b.texcoord));b=y}else b=new Float32Array(0);var Q,y=m.group;if(s(e,"a_influence")&&c){A=new Float32Array(4*u);x=y.length/u;p=new Float32Array(x);for(z=0;z<x;z++)for(Q in p[z]=-1,c)if(F=c[Q],F.cx===z){p[z]=F.si;break}H=3<x?x:4;c=new Float32Array(H);Q=new Uint32Array(H);for(var z=new Float32Array(4),
F=new Float32Array(H),H=new Uint32Array(H),T=new Float32Array(4),I=0;I<u;I++)c.set(F),Q.set(H),z.set(T),A.set(B(y,x,I,u,p,c,Q,z),4*I)}else A=new Float32Array(0);Q=A;c=d?D.Ea(d):{};c.a_color={Lf:!0};c.a_color.src=s(e,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,Lc:7}]:[];d={a_texcoord:b,a_influence:Q};Q=m.vertex_colors;b=m.color;y=a.name;A=[];for(x=0;x<Q.length;x++)A.push(Q[x].name);for(var q in c)if(x=c[q].src,x.length){for(z=p=0;z<x.length;z++)p+=D.ug(x[z].Lc);d[q]=new Float32Array(p*
u);for(z=F=0;z<x.length;z++){var U=x[z].name,H=x[z].Lc,T=D.Bv(H),Y=A.indexOf(U);if(-1==Y)throw'B4W Error: vertex color "'+U+'" for mesh "'+y+'" not found.';var I=Q[Y].mask,K=D.ug(I);(H&I)!==H&&h.error("B4W Error: Wrong color extraction from "+U+" to "+q+".");for(var qa=U=0;qa<Y;qa++)U+=D.ug(Q[qa].mask);Y=U*u;for(U=0;U<u;U++)for(qa=0;3>qa;qa++)T[qa]&&(d[q][U*p+(F+D.nj(H,qa))]=b[Y+U*K+D.nj(I,qa)]);F+=K}}else d[q]=new Float32Array(0);q=a.uv_textures;c=m.texcoord;Q=m.texcoord2;b=a.name;if(t)for(var oa in t){y=
q.indexOf(oa);if(-1==y)throw'B4W Error: uv map "'+oa+'" for mesh "'+b+'" not found';if(0==y)var ja=new Float32Array(c);else 1==y&&(ja=new Float32Array(Q));d[t[oa]]=ja}k.F=d;k.ia=new Uint32Array(m.indices);t=m.position.length/u/3;ja=(oa=s(e,"a_normal")&&m.normal.length?!0:!1)&&s(e,"a_tangent")&&m.tangent.length?!0:!1;q=oa&&n.texture_slots.length&&s(e,"a_tangent")&&"ORCO"==n.texture_slots[0].texture_coords?!0:!1;for(d=0;d<t;d++){n={};c=new Float32Array(3*u);Q=new Float32Array(oa?3*u:0);b=new Float32Array(ja||
q?4*u:0);y=d*u*3;A=y+3*u;c.set(m.position.subarray(y,A),0);oa&&(y=d*u*3,A=y+3*u,Q.set(m.normal.subarray(y,A),0));if(ja)y=d*u*4,A=y+4*u,b.set(m.tangent.subarray(y,A),0);else if(q)for(y=Q,A=b,x=u,h.warn('B4W Warning: Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+a.name+'". Please add a UV-map.'),p=0;p<x;p++)z=v,F=E,z[0]=y[3*p],z[1]=y[3*p+1],z[2]=y[3*p+2],r.cross(z,D.jc,F),0==r.length(F)&&r.cross(z,D.ad,F),r.normalize(F,F),A[4*p]=F[0],A[4*p+1]=F[1],A[4*
p+2]=F[2],A[4*p+3]=1;else if(oa&&s(e,"a_tangent"))for(b=new Float32Array(4*u),d=0;d<b.length;d++)b[d]=1;n.a_position=c;n.a_normal=Q;n.a_tangent=b;k.t.push(n)}if(1<t){a=k.t[0];var n={},fa;for(fa in a)n[fa]=new Float32Array(a[fa]);k.t.push(n)}s(e,"a_polyindex")&&(g(k,1,!0),k.F.a_polyindex=f(k));return k}function s(a,b){return-1<a.indexOf(b)?!0:!1}function B(a,b,e,c,d,f,t,h){for(var k=!0,m=0;m<b;m++){var v=a[m*c+e];if(-1!==v){var E=d[m];-1!==E&&(f[m]=v,t[m]=E,k=!1)}}if(k)return h;H(f,t,!1);for(m=a=0;4>
m;m++)a+=f[m];if(.01>a)return h;for(m=0;4>m;m++)f[m]/=a;if(.01>Math.abs(f[0]-1))h[0]=t[0]+1;else for(m=0;4>m;m++)h[m]=t[m]+f[m];return h}function u(a,b){if(0==b)return 0;var e=a.length,c=e/b;if(c!=Math.floor(c))throw"Array size mismatch during geometry calculation: array length="+e+", base length="+b;return c}function H(a,b,e){var c=a.length,d=c,f=!1;for(e=e?-1:1;1<d||f;){1<d&&(d=Math.floor(d/1.247330950103979));for(var f=!1,t=0;d+t<c;t++)0>e*(a[t]-a[t+d])&&(f=a[t],a[t]=a[t+d],a[t+d]=f,f=b[t],b[t]=
b[t+d],b[t+d]=f,f=!0)}}function A(a,b,e){var c=[],d=[];r.subtract(b,a,c);r.subtract(e,a,d);r.normalize(c,c);r.normalize(d,d);return Math.acos(r.dot(c,d))}function x(a,e,c){e||(e=[]);c=c?a.t[0].a_normal:a.t[0].a_position;if(b(a)){a=a.ia;for(var d=a.length/3,f=0;f<d;f++){var t=new Float32Array(9),h=a[3*f];t[0]=c[3*h];t[1]=c[3*h+1];t[2]=c[3*h+2];h=a[3*f+1];t[3]=c[3*h];t[4]=c[3*h+1];t[5]=c[3*h+2];h=a[3*f+2];t[6]=c[3*h];t[7]=c[3*h+1];t[8]=c[3*h+2];e[f]=t}}else for(f=0;f<c.length;f++)t=new Float32Array(9),
t[0]=c[9*f],t[1]=c[9*f+1],t[2]=c[9*f+2],t[3]=c[9*f+3],t[4]=c[9*f+4],t[5]=c[9*f+5],t[6]=c[9*f+6],t[7]=c[9*f+7],t[8]=c[9*f+8],e[f]=t;return e}function f(a){for(var b=new Float32Array(a.I),e=0;e<a.I;e++)b[e]=e%3;return b}function F(a,b,e){var c=r.dist(a,b);a=r.dist(a,e);b=r.dist(b,e);e=(c+a+b)/2;return e*(e-c)*(e-a)*(e-b)}var h=q("__print"),z=q("__tsr"),D=q("__util"),I=q("__extensions"),r=q("vec3"),v=new Float32Array(3),E=new Float32Array(3),e=new Float32Array(3);a.Gd=10;a.Kq=20;a.DH=30;a.Jj=10;a.eq=
20;a.dq=30;a.rx=40;a.sx=50;a.bi=a.Jj;var t=null;a.xc=function(a){t=a};a.OI=function(a){var b=_buffers[a];t.deleteBuffer(b.$d);t.deleteBuffer(b.Cg);delete _buffers[a]};a.mF=function(e,c,f,h){d(e)&&g(e);var m=e.ia,v=e.I,E=e.t,r={},s;for(s in e.F)s in h&&!h[s].Lf||(r[s]=e.F[s]);h={Qf:null,kf:null,Yn:0,count:0,dj:{},mode:0,yj:0,rk:0,rs:0,Cg:null,$d:null,Vk:null};if(m.length)if(s=m.length,65536>=v)var y=new Uint16Array(m),n=t.UNSIGNED_SHORT;else y=new Uint32Array(m),n=t.UNSIGNED_INT;else s=v,y=null;var A=
0,z=E.length,B;for(B in E[0])var x=E[0][B],A=A+x.length*z;for(B in r)x=r[B],A+=x.length;B=new Float32Array(A);var A=0,z={},F;for(F in r){var D=r[F];if(x=D.length)B.set(D,A),z[F]={eI:F,ig:u(D,v),offset:A,frames:1,length:x},A+=x}r=E.length;for(F in E[0])if(D=E[0][F],x=D.length,D=u(D,v),x){z[F]={ig:D,offset:A,frames:r,length:x};1<r&&(z[F+"_next"]={ig:D,offset:A+x,frames:r,length:x});for(var H=0;H<r;H++)D=E[H][F],B.set(D,A),A+=x}h.count=s;h.Qf=y;h.kf=B;h.Yn=n;h.dj=z;p(h,f);k(h);c!=a.Gd&&b(e)&&(h.Vk={oD:new Float32Array(m.length),
pD:new Float32Array(m.length),ZA:new Float32Array(m.length/3),type:c});return h};a.XC=d;a.WC=b;a.vp=g;a.xM=function(a,b,e){p(a,b);a.count=e.length;a.Qf=e;a.Yn=e instanceof Uint16Array?t.UNSIGNED_SHORT:t.UNSIGNED_INT;return a};a.Kp=function(a,b,e,c){var d=a.kf,f=a.dj,t=f[b];if(t){if(e&&t.ig!=e)throw'Error: invalid num_comp for "'+b+'"';d.set(c,t.offset)}else d=d.length,t=new Float32Array(d+c.length),t.set(a.kf),t.set(c,d),a.kf=t,f[b]={ig:e,offset:d};k(a)};a.bJ=n;a.OK=function(a){a.yj=t.STATIC_DRAW};
a.gD=function(a){a.yj=t.DYNAMIC_DRAW};a.zM=k;a.Lr=function(a){a.$d&&t.deleteBuffer(a.$d);a.Cg&&t.deleteBuffer(a.Cg)};a.Xt=function(a,b){return a.submeshes[b].base_length?!1:!0};a.Fw=function(a,b){for(var e=0;e<a.t.length;e++){var c=a.t[e].a_position;z.Sl(c,b,c,0);c=a.t[e].a_normal;0<c.length&&z.Mw(c,b,c,0);c=a.t[e].a_tangent;0<c.length&&z.Nw(c,b,c,0)}(e=a.F.au_center_pos)&&e.length&&z.Sl(e,b,e,0);return a};a.kF=function(a,b){var e=a.F.au_center_pos;if(e&&e.length){var c=new Float32Array(e);z.Sl(c,
b,c,0);for(var d=0;d<a.t.length;d++)for(var f=0;f<c.length;f++)a.t[d].a_position[f]+=c[f]-e[f];e.set(c)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.jF=function(a,b){var e=a.I,c;for(c in b){var d=b[c].length;a.F[c]=new Float32Array(d*e);for(var f=0;f<e;f++)for(var t=0;t<d;t++)a.F[c][f*d+t]=b[c][t]}};a.lF=y;a.fD=function(a,b,e){if(!a.I)return D.Eb("EMPTY");var c=e.length;65536<a.I*c&&!I.gt()&&g(a,c);var d=a.ia,f=a.I,t=a.F;a=a.t;for(var h in b){var m=b[h].length,k=m*f;t[h]=
new Float32Array(k);for(var v=0;v<f;v++)for(k=0;k<m;k++)t[h][v*m+k]=b[h][k]}b=D.Eb("CLONE_"+c+"_SUBMESHES");b.I=f*c;b.ia=new Uint32Array(d.length*c);for(v=0;v<c;v++)for(m=d.length*v,h=f*v,k=0;k<d.length;k++)b.ia[m+k]=d[k]+h;for(var E in t)for(d=t[E],k=d.length*c,m=u(d,f),b.F[E]=new Float32Array(k),v=0;v<c;v++)h=f*m*v,b.F[E].set(d,h);for(E in a[0])for(v=0;v<a.length;v++)for(d=a[v][E],k=d.length*c,m=u(d,f),b.t[v]=b.t[v]||{},b.t[v][E]=new Float32Array(k),k=0;k<c;k++)switch(t=e[k],h=f*m*k,E){case "a_position":z.Sl(d,
t,b.t[v][E],h);break;case "a_normal":z.Mw(d,t,b.t[v][E],h);break;case "a_tangent":z.Nw(d,t,b.t[v][E],h);break;default:throw"Wrong attribute name: "+E;}return b};a.Is=m;a.nB=function(a){var b=a.I,e=a.t[0].a_position,c=new Float32Array(12*b),d=new Float32Array(8*b);a=new Uint16Array(4*a.ia.length);for(var f=0;f<b;f++)c[12*f]=e[3*f],c[12*f+1]=e[3*f+1],c[12*f+2]=e[3*f+2],c[12*f+3]=e[3*f],c[12*f+4]=e[3*f+1],c[12*f+5]=e[3*f+2],c[12*f+6]=e[3*f],c[12*f+7]=e[3*f+1],c[12*f+8]=e[3*f+2],c[12*f+9]=e[3*f],c[12*
f+10]=e[3*f+1],c[12*f+11]=e[3*f+2],d[8*f]=-.5,d[8*f+1]=-.5,d[8*f+2]=-.5,d[8*f+3]=.5,d[8*f+4]=.5,d[8*f+5]=.5,d[8*f+6]=.5,d[8*f+7]=-.5,a[6*f]=4*f+2,a[6*f+1]=4*f+1,a[6*f+2]=4*f,a[6*f+3]=4*f+2,a[6*f+4]=4*f,a[6*f+5]=4*f+3;e=D.Eb("HALO");e.t=[];e.t[0]={};e.I=4*b;e.t[0].a_position=c;e.F.a_halo_bb_vertex=d;e.ia=a;return e};a.GC=s;a.oB=function(a){for(var b=["a_position","a_normal"],e=[],c=0;c<a.submeshes.length;c++){var d=m(a,c,b,null,null,null);d.I&&e.push(d)}return 0==e.length?D.Eb("EMPTY"):1==e.length?
e[0]:y(e)};a.CF=function(a,e,b){for(var c=a.Qf,d=n(a,"a_position"),f=a.Vk,h=f.oD,m=f.pD,f=f.ZA,k=c,v=k.length/3,E=0;E<v;E++){var r=k[3*E],g=k[3*E+1],u=k[3*E+2],s=d[3*r+1],y=d[3*r+2],A=d[3*g+1],z=d[3*g+2],B=d[3*u+1],x=d[3*u+2];h[3*E]=(d[3*r]+d[3*g]+d[3*u])/3;h[3*E+1]=(s+A+B)/3;h[3*E+2]=(y+z+x)/3}D.Te(h,e,m);e=h.length/3;for(d=0;d<e;d++)m=h[3*d]-b[0],k=h[3*d+1]-b[1],v=h[3*d+2]-b[2],f[d]=m*m+k*k+v*v;b=c;c=f.length;if(!(2>c))for(h=c,d=!1;1<h||d;)for(1<h&&(h=Math.floor(h/1.247330950103979)),d=!1,e=0;h+
e<c;e++)0>f[e]-f[e+h]&&(d=f[e],f[e]=f[e+h],f[e+h]=d,d=b,m=e,k=e+h,v=d[3*m],E=d[3*m+1],r=d[3*m+2],d[3*m]=d[3*k],d[3*m+1]=d[3*k+1],d[3*m+2]=d[3*k+2],d[3*k]=v,d[3*k+1]=E,d[3*k+2]=r,d=!0);c=b;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.$d);t.bufferData(t.ELEMENT_ARRAY_BUFFER,c,t.DYNAMIC_DRAW)};a.VE=H;a.Gz=function(a,e,b){for(var c=e.length/3,d=a.length/3,f=[],t=Array(3),h=Array(3),k=Array(3),m=0;m<d;m++){for(var v=a[3*m],E=a[3*m+1],g=a[3*m+2],u=0;3>u;u++)t[u]=e[3*v+u],h[u]=e[3*E+u],k[u]=e[3*g+u];if(b)var u=
A(t,h,k),s=A(h,k,t),y=Math.PI-u-s;else y=s=u=1;var n=f,z;z=t;var B=k,x=[],p=[],D=[];r.subtract(h,z,x);r.subtract(B,z,p);r.cross(x,p,D);r.normalize(D,D);z=D;for(B=0;3>B;B++)x=3*E+B,p=3*g+B,n[3*v+B]=u*z[B],n[x]=s*z[B],n[p]=y*z[B]}if(b)for(var F in b)for(m=b[F],a=0;3>a;a++){e=3*m[0]+a;for(d=1;d<m.length;d++)t=3*m[d]+a,f[e]+=f[t];for(d=1;d<m.length;d++)t=3*m[d]+a,f[t]=f[e]}for(m=0;m<c;m++){b=m;F=f;a=new Float32Array(3);for(e=0;3>e;e++)d=3*b+e,a[e]=F[d];r.normalize(a,a);for(e=0;3>e;e++)d=3*b+e,F[d]=a[e]}return f};
a.Hz=function(a,e,b){for(var c={},d=e.length/3,f=0;f<d;f++){var t=String(e[3*f])+String(e[3*f+1])+String(e[3*f+2]);c[t]=[]}d=a.length;for(f=0;f<d;f++)e=a[f],t=String(b[3*e])+String(b[3*e+1])+String(b[3*e+2]),t in c&&c[t].push(e);return c};a.Cn=function(a,b,c,d){var f=x(a,null,!1);if(c)var t=x(a,null,!0);var h=f.length,m=new Float32Array(h),k=v,u=E;for(a=0;a<h;a++){var r=f[a];k.set(r.subarray(0,3));u.set(r.subarray(3,6));e.set(r.subarray(6));m[a]=Math.sqrt(F(k,u,e))}k=new Float32Array(h);k[0]=m[0];
for(a=1;a<h;a++)k[a]=k[a-1]+m[a];h=k[m.length-1];m=[];for(a=0;a<b;a++){var u=h*D.Nc(d),u=D.ak(k,u,0,k.length-1),r=c?t[u]:f[u],u=a,g=r,s=d,r=void 0,r=new Float32Array(3),y=g[0],A=g[1],n=g[2],B=g[3],z=g[4],p=g[5],H=g[6],I=g[7],U=g[8],g=D.Nc(s),s=D.Nc(s);1<g+s&&(g=1-g,s=1-s);var Y=1-g-s,A=Y*A+g*z+s*I,n=Y*n+g*p+s*U;r[0]=Y*y+g*B+s*H;r[1]=A;r[2]=n;m[u]=r}return m};a.cJ=x;a.Hs=f;a.uM=F;a.nC=function(a,e,b,c){var d=e[0]-a[0],f=b[0]-a[0],t=e[1]-a[1],h=b[1]-a[1];e=e[2]-a[2];a=b[2]-a[2];c[0]=t*a-e*h;c[1]=f*
e-d*a;c[2]=d*h-t*f;return c};a.jE=function(a,e,b){a=a.t[0].a_position;for(var c=0;c<a.length;c+=3)a[c]=(a[c]-b[0])*e[0]+b[0],a[c+1]=(a[c+1]-b[1])*e[1]+b[1],a[c+2]=(a[c+2]-b[2])*e[2]+b[2]}};b4w.module.__tsr=function(a,q){function d(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function b(a,b,c){var d=b[0],k=b[1],g=b[2],A=b[3],n=b[4],f=b[5],p=b[6];b=b[7];var h=a[0]*A,z=a[1]*A,D=a[2]*A;a=b*h+f*D-p*z;var A=b*z+p*h-n*D,I=b*D+n*z-f*h,h=-n*h-f*z-p*D;c[0]=a*b+h*-n+A*-p-I*-f;c[1]=A*b+h*-f+I*-n-a*-p;c[2]=I*b+h*-p+a*-f-A*-n;c[0]+=d;c[1]+=k;c[2]+=g;return c}var g=q("__util"),c=q("vec3"),n=q("quat");q("mat4");var p=new Float32Array(3),k=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.Vg=function(a,b,c,k){k||(k=new Float32Array(8));d(a,b,c,k);return k};a.qj=d;a.GE=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.Ye=function(a,b){b[3]=a};a.HE=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.cp=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.Ht=function(a){return a.subarray(0,
3)};a.Hk=function(a){return a[3]};a.xt=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],g=a[1],p=a[2];k[0]=a[4];k[1]=a[5];k[2]=a[6];k[3]=a[7];n.invert(k,k);var A=k[0],x=k[1],f=k[2],F=k[3],d=d*c,g=g*c,h=p*c,p=F*d+x*h-f*g,z=F*g+f*d-A*h,D=F*h+A*g-x*d,d=-A*d-x*g-f*h;b[0]=-(p*F+d*-A+z*-f-D*-x);b[1]=-(z*F+d*-x+D*-A-p*-f);b[2]=-(D*F+d*-f+p*-x-z*-A);b[3]=c;b[4]=A;b[5]=x;b[6]=f;b[7]=F;return b};a.Ss=function(a,b){var c=g.fg(a,p),n=g.gl(a),u=g.ee(a,k);d(c,n,
u,b);return b};a.multiply=function(a,c,d){b(c,a,d);d[3]=a[3]*c[3];var k=a[4],g=a[5],n=a[6];a=a[7];var A=c[4],x=c[5],f=c[6];c=c[7];d[4]=k*c+a*A+g*f-n*x;d[5]=g*c+a*x+n*A-k*f;d[6]=n*c+a*f+k*x-g*A;d[7]=a*c-k*A-g*x-n*f;return d};a.uj=b;a.Sl=function(a,b,c,d){d||(d=0);var k=a.length,g=b[0],n=b[1],x=b[2],f=b[3],p=b[4],h=b[5],z=b[6];b=b[7];for(var D=0;D<k;D+=3){var I=a[D]*f,r=a[D+1]*f,v=a[D+2]*f,E=b*I+h*v-z*r,e=b*r+z*I-p*v,t=b*v+p*r-h*I,I=-p*I-h*r-z*v;c[d+D]=E*b+I*-p+e*-z-t*-h;c[d+D+1]=e*b+I*-h+t*-p-E*-z;
c[d+D+2]=t*b+I*-z+E*-h-e*-p;c[d+D]+=g;c[d+D+1]+=n;c[d+D+2]+=x}};a.Mw=function(a,b,c,d){d||(d=0);var k=a.length,g=b[3],n=b[4],x=b[5],f=b[6];b=b[7];for(var p=0;p<k;p+=3){var h=a[p]*g,z=a[p+1]*g,D=a[p+2]*g,I=b*h+x*D-f*z,r=b*z+f*h-n*D,v=b*D+n*z-x*h,h=-n*h-x*z-f*D;c[d+p]=I*b+h*-n+r*-f-v*-x;c[d+p+1]=r*b+h*-x+v*-n-I*-f;c[d+p+2]=v*b+h*-f+I*-x-r*-n}};a.Rl=function(a,b,c){var d=b[3],k=b[4],g=b[5],n=b[6];b=b[7];var p=a[0]*d,f=a[1]*d,F=a[2]*d;a=b*p+g*F-n*f;var d=b*f+n*p-k*F,h=b*F+k*f-g*p,p=-k*p-g*f-n*F;c[0]=
a*b+p*-k+d*-n-h*-g;c[1]=d*b+p*-g+h*-k-a*-n;c[2]=h*b+p*-n+a*-g-d*-k};a.Nw=function(a,b,c,d){d||(d=0);var k=a.length,g=b[3],n=b[4],p=b[5],f=b[6];b=b[7];for(var F=0;F<k;F+=4){var h=a[F]*g,z=a[F+1]*g,D=a[F+2]*g,I=b*h+p*D-f*z,r=b*z+f*h-n*D,v=b*D+n*z-p*h,h=-n*h-p*z-f*D;c[d+F]=I*b+h*-n+r*-f-v*-p;c[d+F+1]=r*b+h*-p+v*-n-I*-f;c[d+F+2]=v*b+h*-f+I*-p-r*-n;c[d+F+3]=a[F+3]}};a.translate=function(a,b,c){var d=a[3],k=a[4],g=a[5],n=a[6],p=a[7],f=b[0]*d,F=b[1]*d,h=b[2]*d;b=p*f+g*h-n*F;var d=p*F+n*f-k*h,z=p*h+k*F-g*
f,f=-k*f-g*F-n*h;c[0]=a[0]+b*p+f*-k+d*-n-z*-g;c[1]=a[1]+d*p+f*-g+z*-k-b*-n;c[2]=a[2]+z*p+f*-n+b*-g-d*-k;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.sK=function(a,b,d,k){k||(k=new Float32Array(8));c.lerp(a.subarray(0,3),b.subarray(0,3),d,k.subarray(0,3));var g=a[3];k[3]=g+d*(b[3]-g);n.slerp(a.subarray(4),b.subarray(4),d,k.subarray(4));return k};a.dJ=function(a,b,c,d){d||(d=new Float32Array(8));var k=a.subarray(0,3),g=b.subarray(0,3),A=d.subarray(0,3);A[0]=g[0]*(c+1)-k[0]*c;A[1]=g[1]*
(c+1)-k[1]*c;A[2]=g[2]*(c+1)-k[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);k=d.subarray(4);k[0]=b[0]*(c+1)-a[0]*c;k[1]=b[1]*(c+1)-a[1]*c;k[2]=b[2]*(c+1)-a[2]*c;k[3]=b[3]*(c+1)-a[3]*c;n.normalize(k,k);return d};a.OC=function(a,b,c,d,k){var g=a.subarray(0,3),A=k.subarray(0,3);A[0]=g[0]+b*c[0];A[1]=g[1]+b*c[1];A[2]=g[2]+b*c[2];k[3]=a[3];a=a.subarray(4);k=k.subarray(4);c=d[0];g=d[1];d=d[2];var A=a[0],p=a[1],f=a[2],F=a[3];k[0]=.5*(c*F+g*f-d*p);k[1]=.5*(g*F+d*A-c*f);k[2]=.5*(d*F+c*p-g*A);
k[3]=.5*(-c*A-g*p-d*f);k[0]=a[0]+k[0]*b;k[1]=a[1]+k[1]*b;k[2]=a[2]+k[2]*b;k[3]=a[3]+k[3]*b;n.normalize(k,k)}};b4w.module.__extensions=function(a,q){function d(a){if(a in c)return c[a];var d=g.getExtension(a)||null;c[a]=d;b.log("%cGET EXTENSION","color: #"+(d?"0a0":"a00"),a);return d}var b=q("__print"),g=null,c={};a.xc=function(a){g=a};a.zt=function(){return d("WEBGL_compressed_texture_s3tc")||d("WEBKIT_WEBGL_compressed_texture_s3tc")||d("MOZ_WEBGL_compressed_texture_s3tc")};a.dC=function(){return d("WEBGL_depth_texture")||d("WEBKIT_WEBGL_depth_texture")||d("MOZ_WEBGL_depth_texture")};a.TB=function(){return d("EXT_texture_filter_anisotropic")||
d("WEBKIT_EXT_texture_filter_anisotropic")||d("MOZ_EXT_texture_filter_anisotropic")};a.cC=function(){return d("WEBGL_debug_shaders")};a.yt=function(){return d("WEBGL_debug_renderer_info")};a.gt=function(){return d("OES_element_index_uint")};a.sC=function(){return d("OES_standard_derivatives")};a.ba=function(){c={}}};b4w.module.__scenes=function(a,q){function d(){if(!ib)throw"No active scene available";return ib}function b(){return ib?!0:!1}function g(a,b,e,c){for(var d=null,l=0;l<b.length;l++){var f=b[l];if((e?f.origin_name:f.name)==a&&f.d.Rd==c){d=f;break}}return d}function c(a,b){b||(b="ALL");var e=[];n(a.objects,b,e);return e}function n(a,b,e){for(var c=0;c<a.length;c++){var d=a[c];"ALL"!=b&&b!=d.type||e.push(d);(d=d.dupli_group)&&n(d.objects,b,e)}}function p(b){if("NONE"==sa.Ze||!b.b4w_render_shadows)return!1;
var e=!1,c=!1;if(0==ca(b,"LAMP",a.V).length)return!1;b=ca(b,"MESH",a.V);for(var d=0;d<b.length;d++){var l=b[d];l.b4w_shadow_cast&&(e=!0);l.b4w_shadow_receive&&(c=!0);if(e&&c)return!0}return!1}function k(a){if(!a.ub)return!1;a=a.ub.LAMP;for(var b=0;b<a.length;b++)if("SUN"==a[b].Bb.type)return!0;return!1}function y(a){if(!sa.yh)return!1;a=w(a);for(var b=0;b<a.length;b++){var e=a[b];if(e.b4w_water&&e.b4w_water_shore_smoothing)return!0}return!1}function m(b){var e=w(b),c=[];b=ca(b,"MESH",a.V);for(var d=
0;d<e.length;d++){var l=e[d];if(l.b4w_water){for(var f={},t=0;t<b.length;t++)for(var h=b[t],K=h.data.materials,k=0;k<K.length;k++)K[k]==l&&(f.mf=h.location[1]);if(sa.sk)for(f.Yb=l.b4w_water_fog_color.slice(0),f.Yb.push(l.b4w_water_fog_density),l.b4w_water_dynamic?(f.Zg=!0,f.waves_height=l.b4w_waves_height,f.waves_length=l.b4w_waves_length,f.dst_noise_scale0=l.b4w_water_dst_noise_scale0,f.dst_noise_scale1=l.b4w_water_dst_noise_scale1,f.dst_noise_freq0=l.b4w_water_dst_noise_freq0,f.dst_noise_freq1=
l.b4w_water_dst_noise_freq1,f.dir_min_shore_fac=l.b4w_water_dir_min_shore_fac,f.dir_freq=l.b4w_water_dir_freq,f.dir_noise_scale=l.b4w_water_dir_noise_scale,f.dir_noise_freq=l.b4w_water_dir_noise_freq,f.dir_min_noise_fac=l.b4w_water_dir_min_noise_fac,f.dst_min_fac=l.b4w_water_dst_min_fac,f.waves_hor_fac=l.b4w_water_waves_hor_fac):(f.Zg=!1,f.waves_height=0,f.waves_length=0),f.gk=null,f.Lm=null,f.Mm=new Float32Array(2),f.Kl=null,l=l.texture_slots,t=0;t<l.length;t++)h=l[t].texture,"VORONOI"==h.type&&
(f.gk=h.noise_scale,f.Mm.set([.3,.7]),f.Lm=h.noise_intensity),!0===h.b4w_shore_dist_map&&(f.Kl=h.image,f.zh=h.image.size[0],f.OE=h.b4w_shore_boundings,f.nh=h.b4w_max_shore_dist);else f.waves_height=0,f.waves_length=0,f.gk=null,f.Lm=null,f.Mm=null,f.Yb=null,f.Zg=!1;c.push(f)}}if(0<c.length){f=c[0];if(!f.Zg)for(d=0;d<c.length;d++)c[d].Zg&&(f=c[d]);return f}return null}function s(a){function b(a){if(a){a=a.nodes;for(var c=0;c<a.length;c++){var d=a[c];"GROUP"==d.type&&d.node_group&&b(d.node_group.node_tree);
"GROUP"==d.type&&"B4W_REFRACTION"==d.node_tree_name&&(e.Vc=!0)}}}var e={};a=w(a);for(var c=0;c<a.length;c++){var d=a[c];d.b4w_refractive&&(e.Vc=!0);d.node_tree&&b(d.node_tree)}return e}function B(b){if(!sa.Al||!b.b4w_render_reflections)return!1;var e=[];b=ca(b,"MESH",a.V);for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_reflective){var l;a:{d=d.constraints;for(l=0;l<d.length;l++){var f=d[l];if("LOCKED_TRACK"==f.type&&"REFLECTION PLANE"==f.name){l=f.target;break a}}l=null}l&&(d=l.location,l=l.d.quat,
f=new Float32Array(4),wa.xF(d,l,wa.Ba,f),e.push(f))}}return e}function u(a,b){var e={},c=a.world.b4w_sky_settings;e.procedural_skydome=c.procedural_skydome&&b;e.use_as_environment_lighting=c.use_as_environment_lighting;e.Ah=c.color;e.rayleigh_brightness=c.rayleigh_brightness;e.mie_brightness=c.mie_brightness;e.spot_brightness=c.spot_brightness;e.scatter_strength=c.scatter_strength;e.rayleigh_strength=c.rayleigh_strength;e.mie_strength=c.mie_strength;e.rayleigh_collection_power=c.rayleigh_collection_power;
e.mie_collection_power=c.mie_collection_power;e.mie_distribution=c.mie_distribution;!b&&c.procedural_skydome&&Ca.warn("B4W Warning: There is no sun on the scene. Procedural sky won't be rendered");return e}function H(a){var b={};a=a.world.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.KC=a.hemisphere;b.Cz=a.blur_depth;b.qr=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.hE=a.samples;return b}function A(a){var b={};a=a.world.b4w_bloom_settings;b.blur=a.blur;b.bB=
a.edge_lum;b.key=a.key;return b}function x(a){var b={};a=a.world.b4w_motion_blur_settings;b.hl=a.motion_blur_decay_threshold;b.il=a.motion_blur_factor;return b}function f(a){var b={};a=a.world.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function F(a){var b={};a=a.world.b4w_god_rays_settings;b.PC=a.intensity;b.mh=a.max_ray_length;b.Kh=a.steps_per_pass;return b}function h(a){var b={};a=a.world;b.Ji=a.b4w_glow_color;
b.Lk=a.b4w_glow_factor;return b}function z(a){var b=a.world;a=[0,0,0];var e=[0,0,0],c=b.light_settings,d=b.texture_slots;if(c.use_environment_light)if("SKY_COLOR"==c.environment_color||"SKY_TEXTURE"==c.environment_color)a=b.horizon_color.slice(0),e=b.zenith_color.slice(0);else if("PLAIN"==c.environment_color)a=[1,1,1],e=[1,1,1];else throw"Unsupported world environment color"+c.environment_color;b={};b.Fe=c.environment_energy;b.Jc=a;b.Oc=e;b.Bh=d;return b}function D(b){if(!sa.La)return!1;var e=!1,
c=!1;b=ca(b,"MESH",a.V);for(var d=0;d<b.length;d++){for(var l=b[d],f=l.data.materials,t=0;t<f.length;t++)f[t].b4w_terrain&&(e=!0);l=l.particle_systems;for(t=0;t<l.length;t++)f=l[t].settings,"HAIR"==f.type&&f.b4w_dynamic_grass&&(c=!0);if(e&&c)return!0}return!1}function I(b){b=ca(b,"MESH",a.V);for(var e=0;e<b.length;e++)if(b[e].d.qd)return!0;return!1}function r(b){b=ca(b,"MESH",a.V);for(var e=0;e<b.length;e++)for(var c=b[e].data.materials,d=0;d<c.length;d++){var l=c[d],f=l.game_settings.alpha_blend;
if(l.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f)return!0}return!1}function v(a,b,e){var c=ta.qh(a,b);ta.pe(a,c,function(a,b,c){if(c.Ka){switch(c.P){case "COLOR":case "CUBEMAP":a=b.j.Db;break;case "DEPTH":a=b.j.Ic;break;case "SCREEN":a=null;break;default:throw"Wrong slink";}switch(c.ka){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(!a)throw"Connection of SCREEN is forbidden";if(a.lf)throw"Batch texture can't use renderbuffer";la.Fr(e.gc,c.ka)&&
aa.Wj(e,a,c.ka)}}});for(a=0;a<b.ja.length;a++){var c=b.ja[a],d=b.yd[a];switch(c.ka){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(d.lf)throw"Batch texture can't use renderbuffer";la.Fr(e.gc,c.ka)&&aa.Wj(e,d,c.ka)}}}function E(a,b,c,d,f){for(var h=b.d,K=b.ga,k=0;k<K.length;k++){var g=K[k];if(!(g.ic||g.fc||"MAIN"!=g.type&&"NODES"!=g.type&&"PARTICLES"!=g.type||C(a,g))){if("OPAQUE"===d){if(g.Da)continue;var E=ra.kb(c,"SHADOW_CAST")&&g.Lb?"SHADOW_SRC_MASK":
"SHADOW_SRC_NONE"}else if("BLEND"===d||"XRAY"===d){if(!g.Da)continue;if("XRAY"==d!=g.re)continue;if(ra.kb(c,"SHADOW_CAST")&&g.Lb)switch(sa.Ze){case "DEPTH":E="SHADOW_SRC_DEPTH";break;default:throw"Wrong shadows type";}else E="SHADOW_SRC_NONE"}else throw"Wrong main subscene type";"NODES"==g.type&&g.Uy&&(b.d.HH.push(g.Uy),b.d.GH.push(g.JH));var m=g.Kb,r=f.d.sd;la.H(m,"SHADOW_SRC",E);aa.wm(g,r);la.H(m,"NUM_LIGHTS",a.jg);"special_skydome.glslf"==la.lt(m)&&la.H(m,"REFLECTION_PASS",0);la.H(m,"SSAO_ONLY",
0);a.Va&&a.$c?la.H(m,"WATER_EFFECTS",1):la.H(m,"WATER_EFFECTS",0);a.Va&&a.Bf&&h.Bf?(la.H(m,"CAUSTICS",1),la.H(m,"CAUST_SCALE",a.xr),la.H(m,"CAUST_SPEED",la.K(a.yr,2)),la.H(m,"CAUST_BRIGHT",a.wr)):la.H(m,"CAUSTICS",0);a.Va&&(la.H(m,"WAVES_HEIGHT",la.K(a.nf)),la.H(m,"WAVES_LENGTH",la.K(a.Gg)),la.H(m,"WATER_LEVEL",la.K(a.mf)));g.Uc&&ra.kb(c,"MAIN_REFLECT")&&-1===g.oe.indexOf("u_mirrormap")?la.H(m,"REFLECTIVE",1):la.H(m,"REFLECTIVE",0);var n=ra.kb(c,"SKY");n?g.lv?(r=n.j.Db,aa.Wj(g,r,"u_sky")):sa.xl?(g.oc=
n.oc,la.H(m,"PROCEDURAL_FOG",1)):la.H(m,"PROCEDURAL_FOG",0):la.H(m,"PROCEDURAL_FOG",0);if("SKY_TEXTURE"==f.world.light_settings.environment_color){r=null;if(f.d.kp.procedural_skydome&&f.world.b4w_sky_settings.use_as_environment_lighting)r=n.j.Db;else for(k=0;k<a.Bh.length;k++)if(a.Bh[k].texture.b4w_use_as_environment_lighting){r=aa.VB(a.Bh[k],!1);break}r?(la.H(m,"SKY_TEXTURE",1),aa.Wj(g,r,"u_sky_texture")):Ca.warn("B4W Warning: environment lighting is set to 'Sky Texture', but there is no world texture with environment map")}g.La&&
(r=ra.kb(c,"GRASS_MAP"))&&J(g,r,h);g.Lo?"NODES"==g.type?(la.H(m,"REFRACTIVE",1),f.d.Vc?la.H(m,"USE_REFRACTION",1):la.H(m,"USE_REFRACTION",0)):f.d.Vc?la.H(m,"REFRACTIVE",1):la.H(m,"REFRACTIVE",0):(la.H(m,"REFRACTIVE",0),la.H(m,"USE_REFRACTION",0));g.Fg&&(g.ix&&ra.kb(c,"DEPTH")?la.H(m,"SHORE_SMOOTHING",1):la.H(m,"SHORE_SMOOTHING",0),g.water_dynamic&&a.Va&&a.nf?la.H(m,"DYNAMIC",1):la.H(m,"DYNAMIC",0));"PARTICLES"==g.type&&(la.H(m,"SIZE_RAMP_LENGTH",g.Zu),la.H(m,"COLOR_RAMP_LENGTH",g.Qu));for(var n=g.aa,
u=0;u<n.length;u++)if(r=n[u],"SCENE"==r.source)for(var s=0;s<xa.length;s++)for(var A=xa[s],z=xa[s].ue,p=0;p<z.length;p++)z[p].d==r&&ta.m(ya,A,f,null);if(g.kh){var r=0,qa;for(qa in g.kh)r++;la.H(m,"NUM_LAMP_LIGHTS",r);g.eo=new Float32Array(3*r);g.bo=new Float32Array(3*r);g.ao=new Float32Array(3*r);g.co=new Float32Array(4*r);for(u=0;u<f.ub.LAMP.length;u++)e(g,f.ub.LAMP[u])}N(c,a,E);aa.Wb(g);E={Y:!0,nb:h,n:g};t(g);a.o.push(E);v(c,a,g);l(g)}}a.o.sort(function(a,b){var e;if(a.n&&b.n){e=a.n.Da;var c=b.n.Da;
(e=e==c?0:e>c?1:-1)||(e=a.n.ng,c=b.n.ng,e=e==c?0:e>c?1:-1)}else e=0;return e})}function e(a,b){var e=b.uuid;if(e in a.kh){e=a.kh[e];a.eo.set(b.d.g,3*e);a.bo.set(b.Bb.direction,3*e);a.ao.set(b.Bb.Pg,3*e);var c=Pb;L(b.Bb,yb,c);a.co.set(c,4*e)}}function t(a){var b=a.gc.attributes,e=a.Gc.dj,c;for(c in b)if(!e[c])throw'B4W Error: missing data for "'+c+'" attribute';if("MAIN"==a.type||"NODES"==a.type)b=la.wC(a.gc.dx),10<b&&("MAIN"==a.type&&Ca.warn("B4W Warning: Varying limit exceeded for main shader - "+
b+', materials: "'+a.Pe.join(", ")+'"'),"NODES"==a.type&&(c=e=0,a.Bg&&(e=wa.Mf(a.Bg)),a.fb&&(c=wa.Mf(a.fb)),Ca.warn("B4W Warning: Varying limit exceeded for node shader - "+b+", uv: "+e+", vc: "+c+', materials: "'+a.Pe.join(", ")+'"')))}function l(a){8<a.aa.length&&Ca.warn("B4W Warning: too many textures used - "+a.aa.length+' (max 8), materials "'+a.Pe.join(", ")+'"')}function N(a,b,e){for(var c=0,d=ra.rt(a,b),l=0;l<d.length;l++){var f=d[l];"SHADOW_SRC_DEPTH"!=e||"SHADOW_CAST"!=f.type&&"POSTPROCESSING"!=
f.type||(f=ra.sB(a,f,"SHADOW_CAST").j,b.Zw=f.oa,b.nr=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.qg=b.qg||[],b.qg[c]=f.ua,c++)}}function J(a,b,e){a.$b=b.$b;var c=b.$b[0],d=b.$b[1],l=b.$b[2];e=e.Ub;e=Math.max(e.max_x-e.min_x,e.max_z-e.min_z);l=0==l?e:Math.max(l,e);b.$b[2]=l;b=b.j;O.bp(b,l/2,-d,-c,l/2);O.xh(b);c=a.Pn||0;c=0==c?e:Math.max(c,e);a.Pn=c}function C(a,b){for(var e=a.o,c=0;c<e.length;c++){var d=e[c].n;if(d&&d.id==b.id)return!0}return!1}function R(a){var b=Q(a,"MAIN_OPAQUE"),
e=!0;ta.U(a.d.xb,function(c,d){"SHADOW_CAST"===d.type&&(M(d,b,d.o,a,e),e=!1)})}function M(b,e,c,d,l){if(0!=c.length){var f=b.j;e=e.j;var t=ca(d,"LAMP",a.V),t=P(t)||t[0],h=t.d;O.dw(f,h.g,h.quat);Aa.copy(e.He,f.He);Ia.copy(e.oa,f.iw);if("SPOT"==t.Bb.type||"POINT"==t.Bb.type)O.xh(f,f.hb);else{t=nb;ia.Cd(t);for(h=0;h<c.length;h++){var K=c[h].nb;0==h?ia.Yr(K.Wa,t):ia.Cs(t,K.Wa)}c=ia.lB(t,Ya);wa.Te(c,f.oa,c);if(d.d.sd.enable_csm){d=Aa.copy(e.qi[b.bn],Ja);t=Ia.invert(e.oa,Va);wa.Te(d,t,d);wa.Te(d,f.oa,d);
b=e.cn[b.bn];if(l)for(tb=0,l=2;l<c.length;l+=3)tb=Math.min(tb,c[l]);l=nb;l.max_x=d[0]+b;l.max_y=d[1]+b;l.max_z=0;l.min_x=d[0]-b;l.min_y=d[1]-b;l.min_z=tb}else{b=l=nb;e=Da;e.set(c);d=Sb/9;c=Ia.identity(Va);Ia.rotate(c,d,wa.qf,c);h=t=-1;for(K=0;10>K;K++){var k=ia.xz(e,mc),g=(k.max_x-k.min_x)*(k.max_y-k.min_y);if(-1==t||g<t)t=g,h=K,ia.Yr(k,b);wa.Te(e,c,e)}b=h*d;0<b&&(e=Ia.identity(Va),Ia.rotate(e,b,wa.qf,e),Ia.multiply(e,f.oa,f.oa));b=l.max_x-l.min_x;e=l.max_y-l.min_y;b&&e&&(d=Math.abs(b-e)/2,2<b/e?
(l.max_y+=d,l.min_y-=d):2<e/b&&(l.max_x+=d,l.min_x-=d));l.max_x+=.005;l.max_y+=.005;l.max_z+=.005;l.min_x-=.005;l.min_y-=.005;l.min_z-=.005}O.xE(f,l.min_x,l.max_x,l.min_y,l.max_y,-l.max_z,-l.min_z);O.xh(f)}wa.Gs(f.Eg,f.An)}}function P(a){for(var b=0;b<a.length;b++){var e=a[b];if(e.data.b4w_generate_shadows)return e}return!1}function S(a,b){for(var e=b.d,c=b.ga,d="COLOR_PICKING_XRAY"==a.type,l=0;l<c.length;l++){var f=c[l];if(f.re==d&&"COLOR_ID"==f.type&&!C(a,f)){aa.le(f,"USE_GLOW",0);aa.Wb(f);var h=
{Y:!0,nb:e,n:f};t(f);a.o.push(h)}}}function Z(a){var b=wa.ni(a);a.Kb=JSON.parse(JSON.stringify(a.Kb));return b}function L(a,b,e){b[0]=1;b[1]=0;b[2]=0;b[3]=a.Vh?1:0;e[0]=-1;e[1]=-1;e[2]=-1;e[3]=a.Wh?1:0;switch(a.type){case "HEMI":b[0]=.5;b[1]=.5;break;case "POINT":e[2]=a.distance;break;case "SPOT":e[2]=a.distance,b=e[0]=Math.cos(a.Eh/2),e[1]=a.qp*(1-b)}}function X(a,b){for(var c=ba(b,ob),d=a.Bb,l=a.d,f=d.index,t=0;t<c.length;t++){var h=c[t];h.bg.set(l.g,3*f);h.Zf.set(d.direction,3*f);h.Yf.set(d.Pg,
3*f);var K=yb,k=Pb;L(d,K,k);switch(d.type){case "SUN":if(h.Iw.set(l.quat),h.Hw=d.Pg,"SKY"===h.type){var g=Ja;g[0]=g[1]=g[2]=1;var v=Math.acos(Aa.dot(h.Ol,g)),g=Math.acos(Aa.dot(d.direction,g));h.ll=Math.floor(v/.025)!=Math.floor(g/.025)?!0:!1;Aa.copy(d.direction,h.Ol);V(b,h)}else Aa.copy(d.direction,h.Ol);case "HEMI":case "POINT":case "SPOT":break;default:Ca.error("B4W Warning: unknown light type: "+d.type)}h.$f.set(K,4*f);h.ag.set(k,4*f);h.Ha=!0;for(K=0;K<h.o.length;K++)k=h.o[K].n,k.kh&&e(k,a)}}
function V(a,b){lb.ui(b);if(b.ll)for(var e=ba(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY"]),c=0;c<e.length;c++)for(var d=e[c].o,l=0;l<d.length;l++){var f=d[l];f.Y&&(f=f.n,aa.Nz(f)&&lb.BF(f))}}function ca(b,e,c){if(!b.ub)throw"Access to uninitialized scene";b=b.ub[e];if(c==a.V)return b;e=[];for(var d=0;d<b.length;d++){var l=b[d];l.d.Rd==c&&e.push(l)}return e}function w(b){var e=[];b=ca(b,"MESH",a.V);for(var c=0;c<b.length;c++)for(var d=b[c].data,l=0;l<d.materials.length;l++){var f=d.materials[l];-1==
e.indexOf(f)&&e.push(f)}return e}function ea(a,b,e){for(var c=a.d,d=a.camera.d.M,l=0;l<d.length;l++){var f=d[l];O.xh(f,b/e);c.To&&O.Lp(f,c.sd)}c.To&&(c.ml=!0,Q(a,"DEPTH").Ha=!0,Q(a,"MAIN_BLEND").Ha=!0);O.Tw(a.camera);ra.yF(c.xb,function(c,d,l){if(c.Th){var f=c.cf*b,t=c.cf*e;if(d)for(d=0;d<l.ja.length;d++)l.ja[d]==c&&gb.resize(c.na,f,t);else gb.Qi(c.na)&&gb.resize(c.na,f,t),c=l.j,c.width=f,c.height=t,"DOF"==l.type&&T(a,{dof_power:l.j.dof_power,dof_on:l.j.dof_on}),ha(l,1/b,1/e)}})}function ha(a,b,e){a=
a.o;for(var c=0;c<a.length;c++){var d=a[c].n;d&&aa.rj(d,b,e)}}function ba(a,b){for(var e=[],c=0;c<b.length;c++){var d=b[c];ta.U(a.d.xb,function(a,b){b.type==d&&e.push(b)})}return e}function Q(a,b){return ra.kb(a.d.xb,b)}function T(a,b){var e=Q(a,"DOF");if(!e)return Ca.error("DOF is not enabled on scene. Check camera settings"),0;var c=a.d.xb;"boolean"==typeof b.dof_on&&(e.j.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(e.j.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&
(e.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(e.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){e.j.dof_power=b.dof_power;for(var d=ra.wb(c,e,"POSTPROCESSING"),c=ra.wb(c,d,"POSTPROCESSING"),d=[d,c],c=0;c<d.length;c++){var l=d[c].o[0].n;l&&(aa.wg(l,e.j.dof_power),ha(d[c],1/e.j.width,1/e.j.height))}}e.Ha=!0}function pa(a,b){var e=Q(ib,"MAIN_OPAQUE");if(!e||!e.Va)return Ca.error("get_water_surface_level() - no water parameters on this scene"),0;var c=e.nf,d=e.Gg,l=e.mf,f=e.Va;if(!c||
!f.Zg)return f.mf;var t=Aa.length(e.Bj),h=e.time;t&&(h*=t);var K=Wa;K[0]=20/d*(a-.25*h);K[1]=20/d*(b-.25*h);t=wa.zr(K);K[0]=17/d*(b+.1*h);K[1]=17/d*(a+.1*h);var K=wa.zr(K),t=t+K-1,k=f.dst_noise_scale0,K=f.dst_noise_scale1,g=f.dst_noise_freq0,v=f.dst_noise_freq1,E=Wa;E[0]=k*(a+g*h);E[1]=k*(b+g*h);k=wa.mp(E);E[0]=K*(b-v*h);E[1]=K*(a-v*h);K=wa.mp(E);K*=c*k;if(e.Yl)if(v=(a-e.$e[0])/e.af[0],E=(e.$e[1]+b)/e.af[1],v+=.5,E+=.5,1<v||0>v||1<E||0>E)c=K;else var v=wa.Zs(ib.d.gp,e.zh,v,E),k=f.dir_freq,m=f.dir_noise_scale,
r=f.dir_noise_freq,g=f.dir_min_noise_fac,E=f.dst_min_fac,e=d/e.nh/Math.PI,m=[m/d*(a+r*h),m/d*(b+r*h)],d=Math.sqrt(v),c=c*Math.max(v,f.dir_min_shore_fac)*Math.sin(d/e+k*h)*Math.max(wa.mp(m),g),f=Math.max(d,E),c=c*(1-f)+K*f,t=t*v;else c=K;return l+(c+.05*t)}function ma(a,b){a.Ni&&"POSTPROCESSING"==a.type&&b.Y!=a.Y&&(a.Y=b.Y);b.Y||"GLOW"!=a.type||(a.rn=0)}function U(a,b,e,c){var d=ta.$a(a,b);O.Dl(d.j,e,c);d.xm=!0;ta.jf(a,b,function(b,d,l){l.Ka&&l.P==e&&ra.Xz(l)&&Y(a,b,l.ka,c)});ta.pe(a,b,function(b,
d,l){l.Ka&&l.P==e&&l.P==l.ka&&U(a,b,e,c)})}function Y(a,b,e,c){a=ta.$a(a,b).o;for(b=0;b<a.length;b++)aa.aE(a[b].n,c,e)}function K(a){var b=Q(a,"GRASS_MAP");if(b){var e=b.j,c=a.camera.d,d=c.g;a=Ja;a[0]=0;a[1]=-b.$b[2]/2;a[2]=0;Aa.transformQuat(a,c.quat,a);a[0]+=d[0];a[1]=0;a[2]+=d[2];b=pb;b[0]=0;b[1]=0;b[2]=0;b[3]=1;O.dw(e,a,b)}}function qa(a,b){ta.U(a,function(e,c){if("MOTION_BLUR"==c.type){if(!c.ja[0]||!c.yd[0])throw"Wrong MOTION_BLUR subscene";var d=c.ja[0],l=c.yd[0];c.yd[0]=c.j.Db;ta.jf(a,e,function(b,
e,c){c.Ka&&Y(a,b,c.ka,l)});U(a,e,d.P,l);Y(a,e,d.ka,c.yd[0]);c.Eu=Math.exp(-b/c.il)}})}function oa(b,e){var c=0,d=b.My;0==d.zp&&(d.zp=e);var l=e-d.zp;if(d.wv&&l/d.Mc>=d.wv)a.hk(b);else{l%=d.Mc;if(l<d.Ot)switch(d=l/(d.Ot/5),l=Math.floor(d),l){case 0:c=(d-l)/2;break;case 1:c=(d-l)/2+.5;break;case 2:c=1;break;case 3:c=1-(d-l)/2;break;case 4:c=.5-(d-l)/2}for(d=0;d<b.ga.length;d++)l=b.ga[d],"COLOR_ID"==l.type&&(l.gh=c)}}function ja(a){ta.U(a.d.xb,function(a,b){b.Ha=!0})}function fa(a){if("WIND"==a.field.type){a=
a.d;wa.S(a.quat,wa.Ba,va);Aa.normalize(va,va);Aa.scale(va,a.zn,va);a=xa;for(var b=0;b<a.length;b++)for(var e=ba(a[b],cb),c=0;c<e.length;c++)e[c].Bj.set(va)}}var aa=q("__batch"),ia=q("__boundings"),O=q("__camera"),ua=q("__config"),ka=q("__debug"),Ma=q("__geometry"),ta=q("__graph"),za=q("__hud"),Xa=q("__objects");q("__particles");var Qa=q("__prerender"),La=q("__primitives"),Ca=q("__print"),lb=q("__renderer"),ra=q("__scenegraph"),ic=q("__sfx"),la=q("__shaders"),gb=q("__textures"),wa=q("__util"),Aa=q("vec3"),
Ia=q("mat4"),sa=ua.p,Ga=ua.Hd,Na="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),mb=["ARMATURE","EMPTY","MESH","SPEAKER"],Jb="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GLOW_MASK WIREFRAME".split(" "),ob="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),Tb=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],cb="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS GLOW_MASK WIREFRAME".split(" "),
bc=["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],nc=0,ib=null,xa=[],ya=null,zb=[],Ub=0,Ab=0,Fb=1,Kb=0,Sa=0,Sb=Math.PI/2;a.Kj=0;a.fq=1;a.gq=2;a.V=-1;var Wa=new Float32Array(2),Ja=new Float32Array(3),yb=new Float32Array(4),Pb=new Float32Array(4),pb=new Float32Array(4),Va=new Float32Array(16),Ya=new Float32Array(24),Da=new Float32Array(24),nb=ia.Cd(),mc=ia.Cd(),va=new Float32Array(3),tb=null;a.Xo=function(a){ib=a;ic.rE(a)};a.KD=function(a,b){var e=a.d,c=ra.zA(e.xb);if(a==b){ea(a,Ub,Ab);for(var d=
0;d<c.length;d++)a.d.tg.push(c[d])}else for(d=a.ue[0],ea(a,d.d.xg,d.d.xg),d=0;d<c.length;d++)b.d.tg.push(c[d]);c=ba(a,cb);for(d=0;d<c.length;d++)c[d].Bj.set(va);for(d=0;d<e.tg.length;d++)"SHADOW_CAST"==e.tg[d].type&&lb.ui(e.tg[d])};a.u=d;a.ea=b;a.Fn=function(a){return a.camera};a.Ck=function(){return xa};a.oC=function(){if(1==xa.length)return xa;for(var a=[],b=0;b<xa.length;b++){var e=xa[b];if(!e.ue.length){b=ta.qh(ya,e);b=ta.Ew(ya,b,ta.bq);b=ta.Ap(b);ta.U(b,function(b,e){a.push(e)});break}}return a};
a.Gi=function(b,e,c,d){for(var l=xa,f=null,t="",h=0;h<l.length;h++){var K=ca(l[h],"ALL",a.V);switch(b){case a.Kj:t=e;f=g(e,K,!1,c);break;case a.fq:t=c;f=null;(K=g(e,K,!1,d))&&K.dupli_group&&(f=g(c,K.dupli_group.objects,!0,d));break;case a.gq:for(var t=e[e.length-1],f=null,k=0;k<e.length;k++)if((f=g(e[k],K,0!=k,c))&&f.dupli_group)K=f.dupli_group.objects;else break}if(f)break}f||Ca.warn("get object "+t+": not found");return f};a.hz=function(a,b,e){for(var d in mb){var l=mb[d],f=c(a,l),t=b.d.Zh,h=!1;
for(d=0;d<e.length;d++)if(h=!0,e[d].d&&e[d].d.Wf){for(var K=0;K<t.length;K++)t[K]==e[d]&&(h=!1);h&&t.push(e[d])}l in b.ub||(b.ub[l]=[]);for(K=0;K<f.length;K++)wa.Tf(f[K])&&f[K].proxy||(b.ub.ALL.push(f[K]),b.ub[l].push(f[K]))}};a.az=function(b,e){b.ub={ALL:[]};for(var d in Na){var l=Na[d],t=c(b,l);b.ub[l]=[];for(var K=0;K<t.length;K++)wa.Tf(t[K])&&t[K].proxy||(b.ub.ALL.push(t[K]),b.ub[l].push(t[K]))}b.ue=b.ue||[];b.d=b.d||{};l=b.d;t=b.camera.d;d=b.world.b4w_shadow_settings;K=l.sd={};d.csm_resolution>
sa.nd?(K.csm_resolution=sa.nd,Ca.error("B4W warning: Shadow map texture has unsupported size. Changed to "+sa.nd+".")):K.csm_resolution=d.csm_resolution;K.self_shadow_polygon_offset=d.self_shadow_polygon_offset;K.self_shadow_normal_offset=d.self_shadow_normal_offset;K.enable_csm=d.b4w_enable_csm;var g=ca(b,"LAMP",a.V);if(g=P(g)||g[0])K.fo=g.Bb.type,K.Eh=g.Bb.Eh,K.distance=g.Bb.distance,"SPOT"!=K.fo&&"POINT"!=K.fo||!K.enable_csm||(Ca.warn("B4W Warning: Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),
K.enable_csm=!1);K.enable_csm?(K.csm_num=d.csm_num,K.csm_first_cascade_border=d.csm_first_cascade_border,K.first_cascade_blur_radius=d.first_cascade_blur_radius,K.csm_last_cascade_border=d.csm_last_cascade_border,K.last_cascade_blur_radius=d.last_cascade_blur_radius,K.fade_last_cascade=d.fade_last_cascade,K.blend_between_cascades=d.blend_between_cascades):(K.csm_num=1,K.csm_first_cascade_border=d.csm_first_cascade_border,K.first_cascade_blur_radius=d.first_cascade_blur_radius,K.csm_last_cascade_border=
d.csm_last_cascade_border,K.last_cascade_blur_radius=d.last_cascade_blur_radius,K.fade_last_cascade=!1,K.blend_between_cascades=!1);l.Zh=[];for(d=0;d<e.length;d++)e[d].d&&e[d].d.Wf&&l.Zh.push(e[d]);d=b.world.b4w_fog_color;l.Yb=new Float32Array([d[0],d[1],d[2],b.world.b4w_fog_density]);l.Mh=k(b);l.kp=u(b,l.Mh);l.hG=z(b);l.qu=ca(b,"LAMP",a.V).length;l.Va=m(b);l.jD=s(b);l.Vr=I(b)||sa.force_selectable;l.re=r(b);l.Ju=0;t.M[0].type!=O.Dc&&sa.anaglyph_use?(Ca.warn("B4W Warning: Anaglyph stereo is disabled for the non-perspective camera"),
d=!1):d=sa.anaglyph_use;l.anaglyph_use=d;l.To=sa.sk&&p(b);l.kJ=b.world.b4w_fog_color;l.yh=y(b);l.SD=B(b);l.Bz=A(b);l.nD=x(b);l.Mz=f(b);l.EC=F(b);l.BC=h(b);l.Yg=sa.Yg&&(0<t.dof_distance||t.Gf);l.La=D(b);l.oh=sa.oh&&b.b4w_enable_motion_blur;l.Rg=sa.Rg&&b.b4w_enable_color_correction;l.antialiasing=sa.antialiasing&&b.b4w_enable_antialiasing;l.Mg=sa.Mg&&b.b4w_enable_bloom&&l.Mh;l.ef=sa.ef&&b.b4w_enable_ssao;l.hF=H(b);l.hh=sa.hh&&b.b4w_enable_god_rays&&l.Mh;l.Vc=sa.Vc&&b.b4w_render_refractions;l.glow=sa.glow?
l.Vr:!1;l.VA=sa.sk;d=b.ue.sort(function(a,b){return b.d.xg-a.d.xg});l.xb=ra.yA(l,t,d);l.tg=[];l.ml=!1;l.wo=!1;xa.push(b);ya||(ya=ta.create());ta.v(ya,b)};a.Sm=c;a.Hn=function(a){return a.d.xb};a.EB=function(a){ta.U(a,function(b,e){var c=null;switch(e.type){case "POSTPROCESSING":c=aa.gs(e.ej);break;case "SSAO":c=aa.GA(e);break;case "SSAO_BLUR":c=aa.HA(e);aa.rj(c,1/e.j.width,1/e.j.height);break;case "DEPTH_PACK":c=aa.pA();break;case "REFRACT":case "COPY":c=aa.gs("NONE");break;case "GOD_RAYS":ra.wb(a,
e,"WIREFRAME")||ra.wb(a,e,"MAIN_BLEND")||ra.wb(a,e,"GOD_RAYS");c=aa.sA(e.$u|0,(e.Jb&&e.Fg)|0,e.Kh);break;case "GOD_RAYS_COMBINE":ra.wb(a,e,"WIREFRAME")||ra.wb(a,e,"MAIN_BLEND");ra.wb(a,e,"GOD_RAYS");c=aa.tA();break;case "MOTION_BLUR":c=aa.xA(e.hl);break;case "DOF":c=aa.qA();aa.wg(c,e.j.dof_power);for(var d=ra.wb(a,e,"POSTPROCESSING"),f=ra.wb(a,d,"POSTPROCESSING"),h=[d,f],K=0;K<h.length;K++){var k=h[K].o;(d=k[0].n)&&aa.wg(d,e.j.dof_power)}break;case "GLOW":h=ra.wb(a,e,"POSTPROCESSING");K=ra.wb(a,h,
"POSTPROCESSING");d=ra.wb(a,K,"POSTPROCESSING");f=ra.wb(a,d,"POSTPROCESSING");c=aa.rA();h=[K,h];for(K=0;K<h.length;K++)k=h[K].o,(k=k[0].n)&&aa.wg(k,e.rr);h=[f,d];for(K=0;K<h.length;K++)k=h[K].o,(k=k[0].n)&&aa.wg(k,e.Fs*e.Lk);break;case "COMPOSITING":c=aa.nA();break;case "ANTIALIASING":c=aa.jA();break;case "LANCZOS":c=aa.uA(e.HK);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":c=aa.EA(e.type);break;case "ANAGLYPH":c=aa.iA();
break;case "SKY":c=aa.DA();aa.rj(c,1/e.j.width,1/e.j.height);break;case "LUMINANCE":c=aa.vA();break;case "AVERAGE_LUMINANCE":c=aa.kA();break;case "LUMINANCE_TRUNCED":c=aa.wA();break;case "BLOOM_BLUR":c=aa.lA(e.ej);aa.rj(c,1/e.j.width,1/e.j.height);break;case "BLOOM":c=ra.wb(a,e,"BLOOM_BLUR");h=[ra.wb(a,c,"BLOOM_BLUR"),c];for(K=0;K<h.length;K++)k=h[K].o,(k=k[0].n)&&aa.wg(k,e.bloom_blur);c=aa.mA();break;case "VELOCITY":c=aa.KA()}c&&(d={Y:!0,nb:Xa.nk("NONE"),n:c},t(c),e.o.push(d),v(a,e,c),l(c))})};a.Lg=
function(a,b){switch(b.type){case "MESH":var e=a.d.xb,c=b.d;!ra.kb(e,"SHADOW_CAST")&&c.Lb&&(c.Lb=!1);for(var c=ba(a,Jb),d=0;d<c.length;d++){var f=c[d],h=b,K=e,k=a;switch(f.type){case "MAIN_OPAQUE":E(f,h,K,"OPAQUE",k);break;case "MAIN_BLEND":E(f,h,K,"BLEND",k);break;case "MAIN_XRAY":E(f,h,K,"XRAY",k);break;case "MAIN_REFLECT":K=h.d;h=h.ga;for(k=0;k<h.length;k++){var g=h[k],m=Z(g);if(!("MAIN"!=m.type&&"NODES"!=m.type&&"PARTICLES"!=m.type||C(f,m)||m.Da)&&m.wc){var r=m.Kb;la.H(r,"DISABLE_FOG",0);la.H(r,
"WATER_EFFECTS",0);"special_skydome.glslf"==la.lt(r)&&la.H(r,"REFLECTION_PASS",1);la.H(r,"SHADOW_SRC","SHADOW_SRC_NONE");la.H(r,"TEXTURE_NORM",0);aa.Wb(m);r={Y:!0,nb:K,n:m};t(m);f.o.push(r);"MAIN"==m.type&&(g.gd||(g.gd=[]),g.gd.push(m))}}break;case "DEPTH":g=h.d;h=h.ga;for(m=0;m<h.length;m++){var n=h[m];if("DEPTH"==n.type&&!C(f,n)&&!n.ic){if(ra.JC(K,f,"SHADOW_CAST"))if(n.Lb){switch(sa.Ze){case "DEPTH":var r="SHADOW_SRC_DEPTH",u="SHADOW_DST_MASK";break;default:throw"Wrong shadows type";}n=aa.Jp(n,
r,u);aa.wm(n,k.d.sd);ra.rt(K,f);N(K,f,r)}else n=aa.Jp(n,"SHADOW_SRC_NONE","SHADOW_DST_MASK");else n=aa.Jp(n,"SHADOW_SRC_NONE","SHADOW_DST_NONE");n.La&&(r=ra.kb(K,"GRASS_MAP"))&&J(n,r,g);aa.Wb(n);r={Y:!0,nb:g,n:n};t(n);f.o.push(r);v(K,f,n);l(n)}}break;case "SHADOW_CAST":g=!1;m=h.d;h=h.ga;for(r=0;r<h.length;r++)if(n=h[r],n.hc||n.Lb)if(g=!0,"DEPTH"==n.type&&!C(f,n)&&n.hc){switch(sa.Ze){case "DEPTH":u="SHADOW_DST_DEPTH";break;default:throw"Wrong shadows type";}n=aa.CA(n,u);n.La&&(u=ra.kb(K,"GRASS_MAP"))&&
J(n,u,m);aa.le(n,"SHADOW_TEX_RES",la.K(k.d.sd.csm_resolution));aa.Wb(n);u={Y:!0,nb:m,n:n};t(n);f.o.push(u)}g&&M(f,ra.kb(K,"MAIN_OPAQUE"),f.o,k,!0);break;case "COLOR_PICKING":S(f,h);break;case "COLOR_PICKING_XRAY":S(f,h);break;case "GRASS_MAP":K=h.d;h=h.ga;for(k=0;k<h.length;k++)g=h[k],"GRASS_MAP"!=g.type||C(f,g)||(aa.Wb(g),m={Y:!0,nb:K,n:g},t(g),f.o.push(m),g=f.j,u=K.Wa,m=f.$b[0],r=f.$b[1],n=f.$b[2],0==m&&0==r?(m=u.min_y,r=u.max_y):(m=Math.min(m,u.min_y),r=Math.max(r,u.max_y)),u=1E-4*(r-m),f.$b[0]=
m-u,f.$b[1]=r+u,O.bp(g,n/2,-r,-m,n/2),O.xh(g));break;case "GLOW_MASK":K=h.d;h=h.ga;for(k=0;k<h.length;k++)g=h[k],"COLOR_ID"!=g.type||C(f,g)||(m=Z(g),aa.le(m,"USE_GLOW",1),aa.Wb(m),h.push(m),r={Y:!0,nb:K,n:m},t(m),f.o.push(r),g.gd||(g.gd=[]),g.gd.push(m));break;case "WIREFRAME":for(k=h.d,h=h.ga,g=0;g<h.length;g++)m=h[g],"WIREFRAME"!=m.type||C(f,m)||(m.La&&(r=ra.kb(K,"GRASS_MAP"))&&J(m,r,k),aa.Wb(m),r={Y:!0,nb:k,n:m},t(m),f.o.push(r),v(K,f,m),l(m))}}break;case "LAMP":b.Bb.index=a.d.Ju++;e=ba(a,ob);
for(c=0;c<e.length;c++)e[c].jg++;X(b,a)}};a.jK=C;a.Wo=function(a){a.d.ml=!0};a.$B=function(a,b){for(var e=a.d.sd,c=new Float32Array(e.csm_num),d=0;d<e.csm_num;d++)c[d]=O.LA(e,b,d);return c};a.Uk=function(a){a.d.Ki=!0};a.hp=function(a){a.d.Ki=!1};a.XD=function(a,b){for(var e=b.d,c=ba(a,Jb),d=0;d<c.length;d++)for(var l=c[d].o,f=l.length-1;0<=f;f--){var t=l[f];t.nb==e&&(t.n&&Ma.Lr(t.n.Gc),l.splice(f,1))}};a.Er=function(a,b){return b.ub[a.type]&&-1<b.ub[a.type].indexOf(a)?!0:!1};a.UE=function(a){var b=
a.ub.LAMP;if(b.length==a.d.Ju){for(var e=[],c=0;c<b.length;c++)e[b[c].Bb.index]=c;for(c=0;c<e.length-1;c++)for(var d=c+1;d<e.length;d++){var l=b[e[c]].Bb,f=b[e[d]].Bb;if(f.Vh&&f.Wh&&(!l.Vh||!l.Wh)||!l.Vh&&(f.Vh||!l.Wh&&f.Wh))l=e[c],e[c]=e[d],e[d]=l}for(c=0;c<e.length;c++)b[e[c]].Bb.index=c,X(b[e[c]],a)}};a.GF=X;a.OF=function(b){var e=ca(b,"LAMP",a.V);if(e=P(e)||e[0]){b=ba(b,ob);for(var c=0;c<b.length;c++)b[c].jw=e.Bb.index}};a.ba=function(){for(var a=0;a<xa.length;a++){var b=xa[a];ta.U(b.d.xb,function(a,
b){if("SINK"!=b.type){var e=b.j;lb.YD(e.Ie,e.Db,e.Ic,e.width,e.height);for(var e=b.o,c=0;c<e.length;c++){var d=e[c].n;d&&aa.aA(d)}}});b.d.xb=[];b.d.tg=[]}ib=null;xa.length=0;ya=null;zb.length=0;va[0]=0;va[1]=0;va[2]=0};a.Au=function(a,b,e){a=O.mB(a,a.Sa,a.Za,null,!0);var c=La.IB(a);a=Xa.nk("DYNAMIC");a.Wa=a.Ub={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.Cb=a.Qc=ia.zz();var d=a.Cb.za;a.Af=a.zf=ia.Xm([d,0,0],[0,d,0],[0,0,d],a.Cb.w);e=aa.BA(c,e);b.o.push({Y:!0,nb:a,n:e})};
a.Hb=ca;a.pC=function(a){return[a.frame_start,a.frame_end]};a.gw=function(a,b,e,c,d){Ub=a;Ab=b;Fb=e;Kb=d;Sa=c;ib&&ea(ib,a,b)};a.rj=ha;a.nF=ba;a.qa=Q;a.ht=function(a){a=ba(a,ob)[0];var b=a.Jc,e=a.Oc,c=[],d=[];c[0]=b[0];c[1]=b[1];c[2]=b[2];d[0]=e[0];d[1]=e[1];d[2]=e[2];return[a.Fe,c,d]};a.Qv=function(a,b,e,c){a=ba(a,ob);for(var d=0;d<a.length;d++){var l=a[d];isNaN(b)||(l.Fe=b);e&&l.Jc.set(e);c&&l.Oc.set(c);l.Ha=!0}};a.Ct=function(a){if(a=Q(a,"SKY")){var b={};b.color=Array(3);Aa.copy(a.Ah,b.color);b.procedural_skydome=
a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.Xv=function(a,b){var e=Q(a,"SKY");
e&&("number"==typeof b.procedural_skydome&&(e.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(e.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&e.Ah.set(b.color),"number"==typeof b.rayleigh_brightness&&(e.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(e.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(e.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&
(e.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(e.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(e.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(e.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(e.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(e.mie_distribution=b.mie_distribution),e.Ha=!0,e.ll=!0,V(a,e))};a.mt=function(a,b){var e=
b||[],c=ba(a,Tb)[0].Yb;e[0]=c[0];e[1]=c[1];e[2]=c[2];e[3]=c[3];return e};a.Sv=function(a,b){for(var e=ba(a,Tb),c=0;c<e.length;c++){var d=e[c];d.Yb.set(b);d.Ha=!0}};a.Et=function(a){var b=Q(a,"SSAO");a=Q(a,"SSAO_BLUR");if(!b)return null;var e=b.o[0].n,c={};c.ssao_quality=aa.En(e,"SSAO_QUALITY")[1];c.ssao_hemisphere=b.ssao_hemisphere;c.ssao_blur_depth=a.ssao_blur_depth;c.qr=a.ssao_blur_discard_value;c.radius_increase=b.Hh;c.influence=b.Gh;c.dist_factor=b.Fh;c.ssao_only=b.ssao_only;c.ssao_white=aa.En(e,
"SSAO_WHITE")[1];return c};a.Zv=function(a,b){var e=Q(a,"SSAO"),c=Q(a,"SSAO_BLUR");if(!e)return Ca.error("SSAO is not enabled on scene"),0;if("string"==typeof b.ssao_quality){var d=e.o[0].n;aa.le(d,"SSAO_QUALITY",b.ssao_quality);aa.Wb(d,!0)}"number"==typeof b.ssao_hemisphere&&(d=e.o[0].n,aa.le(d,"SSAO_HEMISPHERE",b.ssao_hemisphere),aa.Wb(d,!0));"number"==typeof b.ssao_blur_depth&&(d=c.o[0].n,aa.le(d,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),aa.Wb(d,!0));"number"==typeof b.ssao_blur_discard_value&&(c.ssao_blur_discard_value=
b.ssao_blur_discard_value);"number"==typeof b.Hh&&(e.Hh=b.Hh);"number"==typeof b.Gh&&(e.Gh=b.Gh);"number"==typeof b.Fh&&(e.Fh=b.Fh);if("number"==typeof b.ssao_only){e=Q(a,"MAIN_OPAQUE");e.ssao_only=b.ssao_only;for(var l=0;l<e.o.length;l++)d=e.o[l].n,aa.le(d,"SSAO_ONLY",b.ssao_only),aa.Wb(d,!0)}"number"==typeof b.ssao_white&&(d=e.o[0].n,aa.le(d,"SSAO_WHITE",b.ssao_white),aa.Wb(d,!0));e.Ha=!0;c.Ha=!0};a.et=function(a){a=Q(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=
a.j.dof_front;b.dof_rear=a.j.dof_rear;b.dof_power=a.j.dof_power;return b};a.Pv=T;a.nt=function(a){var b=ba(a,["GOD_RAYS"]);a=Q(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var e={};e.god_rays_max_ray_length=b[0].mh;e.god_rays_intensity=a.god_rays_intensity;e.god_rays_steps=aa.En(b[0].o[0].n,"STEPS_PER_PASS")[1];return e};a.Tv=function(a,b){var e=ba(a,["GOD_RAYS"]),c=Q(a,"GOD_RAYS_COMBINE");if(!e||!c)return Ca.error("God Rays are not enabled on scene"),0;"number"==typeof b.god_rays_intensity&&(c.god_rays_intensity=
b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var d=b.god_rays_max_ray_length,l=0;l<e.length;l++)e[l].mh=d,e[l].zl=d/e[l].Kh/(l+1),e[l].Ha=!0;if("number"==typeof b.god_rays_steps)for(var f=la.K(b.god_rays_steps,1),d=e[0].mh,l=0;l<e.length;l++){e[l].Kh=f;e[l].zl=d/f/(l+1);e[l].Ha=!0;var t=e[l].o[0].n;aa.le(t,"STEPS_PER_PASS",f);aa.Wb(t,!0)}c.Ha=!0};a.at=function(a){var b=Q(a,["LUMINANCE_TRUNCED"]);a=Q(a,"BLOOM");if(!b||!a)return null;var e={};e.bloom_key=b.bloom_key;e.bloom_edge_lum=
b.bloom_edge_lum;e.bloom_blur=a.bloom_blur;return e};a.Hv=function(a,b){var e=Q(a,"LUMINANCE_TRUNCED"),c=Q(a,"BLOOM");if(!e||!c)return Ca.error("Bloom is not enabled on scene"),0;"number"==typeof b.bloom_key&&(e.bloom_key=b.bloom_key,e.Ha=!0);"number"==typeof b.bloom_edge_lum&&(e.bloom_edge_lum=b.bloom_edge_lum,e.Ha=!0);if("number"==typeof b.bloom_blur)for(var d=a.d.xb,e=ra.wb(d,c,"BLOOM_BLUR"),d=ra.wb(d,e,"BLOOM_BLUR"),e=[e,d],d=0;d<e.length;d++){var l=e[d].o[0].n;l&&(aa.wg(l,b.bloom_blur),ha(e[d],
1/c.j.width,1/c.j.height))}};a.Nt=function(){var a=va,b=Aa.length(a);if(0==b)return null;var e={};e.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;e.wind_strength=b;return e};a.fw=function(b,e){for(var c=ca(b,"ALL",a.V),d=0;d<c.length;d++){var l=c[d];if("EMPTY"===l.type&&l.field&&"WIND"===l.field.type)var f=l}if(!f)return Ca.error("There is no wind on the scene"),0;c=f.d;"number"==typeof e.wind_dir&&(Ja=[0,e.wind_dir/180*Math.PI,-Math.PI/2],wa.Ge(Ja,pb),c.quat.set(pb),fa(f));"number"==typeof e.wind_strength&&
(c.zn=e.wind_strength,fa(f));ja(b)};a.mE=function(a){a.d.wo=!0};a.Lt=pa;a.Kt=function(a,b){var e=Q(a,"MAIN_OPAQUE");if(e&&(b.waves_height=e.nf,b.waves_length=e.Gg,e.$c)){b.water_fog_density=e.$c[3];var c=b.water_fog_color=[];c[0]=e.$c[0];c[1]=e.$c[1];c[2]=e.$c[2]}};a.ew=function(a,b){var e=Q(a,"MAIN_OPAQUE");if(!e||!e.Va)return Ca.error("set_water_params() - no water parameters on this scene"),null;e=e.Va;"number"==typeof b.dst_noise_scale0&&(e.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&
(e.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(e.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(e.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(e.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(e.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(e.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(e.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&
(e.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(e.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(e.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(e.Zg=b.water_dynamic);for(var c=ba(a,bc),d=0;d<c.length;d++){var l=c[d];"number"==typeof b.water_fog_density&&e.Yb&&(l.$c[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&e.Yb&&l.$c.set(b.water_fog_color);"number"==typeof b.waves_height&&(l.nf=b.waves_height);"number"==typeof b.waves_length&&
(l.Gg=b.waves_length);l.Ha=!0}};a.Bt=function(a,b){var e=Q(ib,"MAIN_OPAQUE");if(!e.Yl)return 100;var c=e.nh,d=e.mf,l=(a[0]-e.$e[0])/e.af[0],f=(e.$e[1]+a[2])/e.af[1],l=l+.5,f=f+.5;if(1<l||0>l||1<f||0>f)d=1;else return e=c*wa.Zs(ib.d.gp,e.zh,l,f),d=(d-a[1])*b,d=Math.sqrt(e*e+d*d)};a.update=function(a,b){for(var e=d().camera.d,c=0;c<xa.length;c++){var l=xa[c],f=l.d.xb;if(l.d.Va)var t=e.g[1]-pa(e.g[0],e.g[2]);for(var h=l.d.Zh,k=0;k<h.length;k++){var g=h[k].d,m=g.gb,v=g.ah+g.Fa;if(m){var E=Math.round(m.currentTime*
g.Zb),r=g.Fa/g.Zb;if(E<g.Fa-(sa.Vf?5:0)||h[k].d.yg&&E>v)m.currentTime=r;!g.yg&&E>v&&m.pause();2<=m.readyState&&!m.paused&&gb.RF(g)}else if(g.vh){m=Math.min(g.vh.length,g.ah+g.Fa);if(g.ke<g.Fa||g.yg&&g.ke>=m)g.ke=g.Fa;!g.yg&&g.ke>=m&&(g.wh=!1);m=Math.round(a*Ga.Ia/g.Zb)*g.Gv;m!=nc&&g.wh&&(gb.NF(g),g.ke++);nc=m}}ta.U(f,function(b,e){-1<cb.indexOf(e.type)&&(e.time=a);-1<bc.indexOf(e.type)&&l.d.Va&&(e.Km=t)})}for(c=0;c<zb.length;c++)oa(zb[c],a);for(c=0;c<xa.length;c++)if(l=xa[c],k=l.d,e=k.tg,k.ml&&(R(l),
k.ml=!1),k.wo&&(K(l),k.wo=!1),e.length){l.b4w_enable_motion_blur&&qa(k.xb,b);if(k.glow){for(var f=Q(l,"GLOW_MASK").o,C=0,k=0;k<f.length;k++)C+=f[k].n.gh;ta.U(l.d.xb,function(a,b){"GLOW"===b.type&&(b.rn=C)})}f=null;for(k=0;k<e.length;k++)"GLOW_MASK"==e[k].type&&(f=k);for(k=0;k<e.length;k++)h=e[k],Qa.Io(h),null!==f&&ma(h,e[f]),lb.ui(h)}sa.show_hud_debug_info&&za.PE(xa,b)};a.Dn=function(a){var b=[];ta.U(a.d.xb,function(a,e){b.push(e)});return b};a.vm=function(a,b,e,c){a.My={zp:0,Ot:b,Mc:e,wv:c};-1==
zb.indexOf(a)&&zb.push(a)};a.hk=function(a){if(a.ga)for(var b=0;b<a.ga.length;b++){var e=a.ga[b];"COLOR_ID"==e.type&&(e.gh=0)}a=zb.indexOf(a);-1!=a&&zb.splice(a,1)};a.tI=function(){zb=[]};a.bt=function(){var a=Q(ib,"MAIN_BLEND"),b=ib;return a||b.d.Va?a.Km:null};a.ut=function(a){return a.d.Rd};a.Ww=ja;a.LE=function(a,b){switch(b){case "WM_NONE":a.Y=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var e=0;e<a.o.length;e++)a.o[e].n.wireframe_mode=
ka.Jq[b];a.Y=!0}a.Da="WM_TRANSPARENT_WIREFRAME"==b;a.Ha=!0};a.KE=function(a,b){for(var e=0;e<a.o.length;e++)a.o[e].n.wireframe_edge_color=b,a.Ha=!0};a.Sq=function(a,b){for(var e=0;e<b.length;e++)a.ub.ALL.push(b[e]),a.ub.MESH.push(b[e])};a.Vw=fa;a.wl=function(e,c){if(!b())return Ca.error("No active scene"),null;var l=d(),f=Q(l,"COLOR_PICKING");if(f){e-=Sa;c-=Kb;e*=Fb;c*=Fb;Qa.Io(f);lb.ui(f);var t=Q(l,"COLOR_PICKING_XRAY");t?(Qa.Io(t),lb.ui(t),f=t.j):f=f.j;c=f.height-c;f=lb.PD(f.Ie,e,c);l=ca(l,"MESH",
a.V);for(t=0;t<l.length;t++){var h=l[t].Lq;if(h&&5>Math.abs(255*h[0]-f[0])&&5>Math.abs(255*h[1]-f[1])&&5>Math.abs(255*h[2]-f[2]))return l[t]}}else Ca.error("Color picking is not available");return null};a.yC=function(){return va};a.qC=function(b){var e=[];b=ca(b,"MESH",a.V);for(var c=0;c<b.length;c++){var d=b[c];d.d.qd&&e.push(d)}return e};a.Fk=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b}};b4w.module.__batch=function(a,q){function d(a){a={type:a,id:0,So:0,lg:"",aa:[],oe:[],Pe:[],yo:[],Od:[],Bg:null,fb:{},gc:null,Kb:null,ir:[],od:null,Gc:null,Fc:null,gd:null,qs:!1,Wi:0,kg:0,bl:0,cl:0,gh:0,Mk:0,Pn:0,$b:new Float32Array(3),Tr:new Float32Array(3),oc:new Float32Array(16),Da:!1,Ur:!1,Z:!1,re:!1,wa:!1,Ag:!1,Ee:!1,hc:!1,ic:!1,Lb:!1,wc:!1,fc:!1,Uc:!1,La:!1,lv:!1,De:P.bi,se:P.Gd,Rh:0,yp:new Float32Array(2),s:new Float32Array(2),Pt:!1,Tt:0,Qt:0,Ut:0,Vt:0,St:new Float32Array(3),Rt:new Float32Array(3),
Pf:!1,Uj:0,xk:0,qn:1,uv:0,uw:0,Dh:1,dv:0,pn:0,nm:1,Iu:0,so:0,ng:0,vv:0,Sd:Array(2),Ml:new Float32Array(3),xd:new Float32Array(3),np:new Float32Array(3),kd:new Float32Array(4),Bi:new Float32Array(4),kh:null,eo:null,bo:null,ao:null,co:null,Fg:!1,water_dynamic:!1,ix:!1,fx:!1,hx:0,jx:0,ex:0,gx:.1,lw:0,nw:0,Ms:0,Os:new Float32Array(2),Ns:new Float32Array(2),xn:new Float32Array(2),kw:new Float32Array(3),mw:new Float32Array(3),hg:null,Lo:!1,Vu:0,Ru:0,Bo:0,Uu:0,Xu:0,Wu:0,Su:0,Tu:0,Co:0,Ou:0,Nu:0,Zu:0,Qu:0,
ql:new Float32Array(3),Yu:new Float32Array(8),Pu:new Float32Array(16)};a.kd[3]=1;a.Ur=!0;a.Z=!0;a.Rh=1;return a}function b(a,b,e){for(var d=[],l=0;l<a.length;l++){var f=a[l],t=f.d,h=n(f.data.b4w_bounding_box),k=f.data.b4w_bounding_cylinder_radius,g=f.data.b4w_bounding_sphere_radius,m=f.data.b4w_bounding_sphere_center,v=f.data.b4w_bounding_ellipsoid_axes,E=f.data.b4w_bounding_ellipsoid_center;if(t.Ld){var g=Math.max(Math.abs(h.max_x),Math.abs(h.min_x)),k=Math.max(Math.abs(h.max_y),Math.abs(h.min_y)),
r=Math.max(Math.abs(h.max_z),Math.abs(h.min_z)),r=Math.sqrt(g*g+k*k+r*r),g=Math.sqrt(g*g+k*k);h.max_x=h.max_y=h.max_z=r;h.min_x=h.min_y=h.min_z=-r;k=g;g=r;m[0]=m[1]=m[2]=0;v[0]=v[1]=v[2]=r;E[0]=E[1]=E[2]=0}t.Ub=h;r=J.Fm(h,t.N);t.Wa=r;var r=t,C=k;r.Bm=J.as(C,h);r.zm=J.Zr(k,h);r.Am=J.$r(C,h);m=J.Ym(g,m);t.Qc=m;m=J.Hm(m,t.N);t.Cb=m;v=J.Xm([v[0],0,0],[0,v[1],0],[0,0,v[2]],E);t.zf=v;v=J.Gm(v,t.qe);t.Af=v;d=d.concat(c(f,t,b,e))}return d}function g(a,b,e,d){for(var l=[],f=[],t={},h=0;h<a.length;h++){var k=
a[h],g=k.d,m=n(k.data.b4w_bounding_box),E=J.Fm(m,g.N),C=J.Ym(k.data.b4w_bounding_sphere_radius,k.data.b4w_bounding_sphere_center),u=J.Hm(C,g.N),s=k.data.b4w_bounding_ellipsoid_axes,s=J.Xm([s[0],0,0],[0,s[1],0],[0,0,s[2]],k.data.b4w_bounding_ellipsoid_center),A=J.Gm(s,g.qe);g.Ub=m;g.Wa=E;g.Qc=C;g.Cb=u;g.zf=s;g.Af=A;m={};m.hc=g.hc;m.ic=g.ic;m.Lb=g.Lb;m.qd=g.qd;m.pl=g.pl;m.Kk=g.Kk;m.wc=g.wc;m.fc=g.fc;m.Uc=g.Uc;m.Bf=g.Bf;m.Ad=g.Ad;m.de=g.de;m.Pb=g.Pb;m.Ld=g.Ld;m.ji=g.ji;m.La=g.La;m.Xg=g.Xg;m.tk=g.tk;
m.Ee=g.Ee;E=g.Cb.w;m.FC=0==e?[0,0]:[Math.floor(E[0]/e),Math.floor(E[2]/e)];m.Oe=g.Oe;m.Ti=g.Ti;m.eg=g.eg;g=JSON.stringify(m);t[g]=t[g]||[];t[g].push(k)}for(var z in t){m=JSON.parse(z);e=t[z];var k=L.nk("STATIC"),p;for(p in m)k[p]=m[p];k.Rd=a[0].d.Rd;k.Bd=0;k.of=0;k.Ce=0;k.Be=0;k.ze=0;k.Ki=!1;for(h=0;h<e.length;h++)g=e[h],0==h?(k.Wa=Q.Ea(g.d.Wa),k.Cb=Q.Ea(g.d.Cb),k.zf=Q.Ea(g.d.zf),k.Af=Q.Ea(g.d.Af)):(J.Cs(k.Wa,g.d.Wa),J.jB(k.Cb,g.d.Cb));k.Ub=Q.Ea(k.Wa);k.Qc=Q.Ea(k.Cb);f.push({Vb:k,fe:e})}for(a=0;a<
f.length;a++)for(t=f[a].Vb,h=f[a].fe,z=0;z<h.length;z++){p=h[z];e=c(p,t,b,d);k=r(p.d)||r(t);g={};t.Ad&&(g.au_center_pos=[k[0],k[1],k[2]],g.au_wind_bending_amp=[p.d.Bd],g.au_wind_bending_freq=[p.b4w_wind_bending_freq],g.au_detail_bending_amp=[p.b4w_detail_bending_amp],g.au_detail_bending_freq=[p.b4w_detail_bending_freq],g.au_branch_bending_amp=[p.b4w_branch_bending_amp]);for(m=0;m<e.length;m++)u=e[m].Vb,E=e[m].zc,C=e[m].n,u.Zk?u.Ld?P.kF(E,k):P.Fw(E,k):("COLOR_ID"==C.type?(u=e[m].Vb=p.d,u.type="DYNAMIC",
C.lg=p.uuid,F(C,u),v(C,Q.li(u,0))):E=P.Fw(E,k),P.jF(E,g));l=l.concat(e)}return l}function c(a,b,e,c){for(var l=[],f=p(e,b),t=Q.li(b,0),h=a.data,g=h.materials,m=0;m<f.length;m++){var E=f[m];if(!a.b4w_do_not_render||"PHYSICS"==E)for(var r=0;r<g.length;r++){var C=g[r];if(("LENS_FLARES"!=C.name||0!=c)&&!P.Xt(h,r)){var n=d(E);if(k(n,C,!0)){n.De=h.De||P.bi;"COLOR_ID"===E&&n.Tr.set(a.Lq);F(n,b);for(var u=n,s=a.particle_systems,A=0;A<s.length;A++){var N=s[A].settings.b4w_vcol_from_name,x=s[A].settings.b4w_vcol_to_name;
""!==N&&""!==x&&(u.fb[N]={Lf:!1,src:[{name:N,Lc:7}]})}"DYNAMIC"==b.type&&(n.lg=a.uuid);v(n,t);u=P.Is(h,r,n.Od,n.Fc,n.fb,n.Bg);"LENS_FLARES"==C.name&&(u=X.JD(u));l.push({n:n,zc:u,sc:[C.name],Vb:b,Wc:[a]})}}}}f=a.particle_systems;if(0<f.length&&l.length){c=!0;for(m=0;m<f.length;m++)if(f[m].settings.use_render_emitter){c=!1;break}m=l[0].n;f=l[0].zc;h=[];g=a.particle_systems;E=a.data;for(r=0;r<g.length;r++)if(C=g[r],n=C.settings,n.count)if("EMITTER"==n.type){if("DYNAMIC"==b.type){u=d("PARTICLES");s=E.materials;
A=C.settings.material-1;A>=s.length&&(R.warn('B4W Warning: Wrong material used for rendering particle system "'+C.name+'"'),A=0);s=s[A];"HALO"===C.settings.render_type&&(u.Pf=!0);k(u,s);F(u,b);A=u;N=C;switch(N.settings.b4w_billboard_align){case "VIEW":z(A,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":z(A,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":z(A,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":z(A,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";
}z(A,"BILLBOARD",0);ea.H(A.Kb,"WORLD_SPACE","WORLD"==N.settings.b4w_coordinate_system?1:0);u.Ee=!0;u.lg=a.name+"_"+n.uuid;v(u,t);u.od=C;n=X.HB(u,E,C,a.d.qe);X.uE(u,C,s);h.push({n:u,zc:n,sc:[s.name],Vb:b,Wc:[a]})}}else if("HAIR"==n.type){u=Q.Wk(C.seed);n.b4w_dynamic_grass&&(b.Xg=!0);if(C.transforms.length)var D=C.transforms;else for(var s=P.Cn(f,n.count,!1,u),D=new Float32Array(4*s.length),y=0;y<s.length;y++)A=.75+.5*Q.Nc(u),D[4*y]=s[y][0],D[4*y+1]=s[y][1],D[4*y+2]=s[y][2],D[4*y+3]=A;s=w.kb(e,"GRASS_MAP")?
!0:!1;if("OBJECT"==n.render_type)A=[p(e,n.dupli_object.d)],C=I(a,b,m,f,[n.dupli_object],A,[D],n,C,s,u,!1),h=h.concat(C);else if("GROUP"==n.render_type){N=n.dupli_group.objects;x=!1;A=[];for(y=0;y<N.length;y++){var B=p(e,n.dupli_group.objects[y].d);A.push(B)}if(n.use_whole_group){x=D;D=N;y={};for(B=0;B<x.length;B+=4)for(var J=0;J<D.length;J++){var U=T.create();T.scale(D[J].d.g,D[J].d.scale,U);var Y=T.clone([x[B],x[B+1],x[B+2]]);T.add(Y,U,Y);y[J]||(y[J]=new Float32Array(x.length));y[J][B]=Y[0];y[J][B+
1]=Y[1];y[J][B+2]=Y[2];y[J][B+3]=x[B+3]}D=y;x=!0}else if(n.use_group_count){for(var Y=N,H=n.dupli_weights,y=u,B={},J=[],U=0;U<Y.length;U++)for(var q=Y[U],q=q.origin_name||q.name,M=0;M<H.length;M++){var pa=H[M];q==pa.name.split(": ")[0]&&J.push(pa)}H.length!=J.length&&R.error("B4W Error: dupli weights match failed");for(U=0;U<D.length;U+=4){var ma,H=J;ma=[0];for(Y=0;Y<H.length;Y++)ma[Y+1]=ma[Y]+H[Y].count;H=ma[ma.length-1]*Q.Nc(y);for(Y=q=0;Y<ma.length;Y++)if(H>=ma[Y]&&H<ma[Y+1]){q=Y;break}ma=q;B[ma]=
B[ma]||[];B[ma].push(D[U],D[U+1],D[U+2],D[U+3])}for(ma in B)B[ma]=new Float32Array(B[ma]);D=B}else{y=u;B=N.length;J={};for(U=0;U<D.length;U+=4){var L=Math.floor(B*Q.Nc(y));J[L]=J[L]||[];J[L].push(D[U],D[U+1],D[U+2],D[U+3])}for(L in J)J[L]=new Float32Array(J[L]);D=J}C=I(a,b,m,f,N,A,D,n,C,s,u,x);h=h.concat(C)}"INSTANCE"==n.b4w_wind_bend_inheritance&&(a.d.Bd=0)}else throw"Unknown particle settings type";a=h;l=c?a:l.concat(a)}return l}function n(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,
max_z:a.max_z,min_z:a.min_z}}function p(a,b){var e=["MAIN","NODES"];b.qd&&(w.kb(a,"COLOR_PICKING")||w.kb(a,"GLOW_MASK"))&&e.push("COLOR_ID");w.kb(a,"WIREFRAME")&&e.push("WIREFRAME");e.push("PHYSICS");(w.kb(a,"DEPTH")||w.kb(a,"SHADOW_CAST"))&&e.push("DEPTH");w.kb(a,"GRASS_MAP")&&e.push("GRASS_MAP");if(b.ic||b.fc){var c=null;b.ic&&(c=["MAIN","NODES","COLOR_ID","PHYSICS","WIREFRAME"]);if(b.fc)var d=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],c=null!==c?Q.pz(c,d):d;for(d=0;d<c.length;d++){var l=e.indexOf(c[d]);
-1!==l&&e.splice(l,1)}}return e}function k(a,b,c){var d,l;switch(a.type){case "MAIN":if(b.b4w_do_not_render||b.use_nodes)a=!1;else{m(a,b);var f=b.game_settings.alpha_blend;a.re=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;a.ng=b.offset_z;a.xd.set([1,1,1]);var k=b.texture_slots;pa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.kd);switch(b.name){case "LENS_FLARES":e(a,"special_lens_flares.glslv","special_lens_flares.glslf");h(a,"a_position");h(a,"a_texcoord");var g=c?[1,1,
1,0]:null,g=s(k[0],g);t(a,g);break;default:e(a,"main.glslv","main.glslf");var v=B("use_map_color_diffuse",k),E=B("use_map_color_spec",k),r=B("use_map_normal",k),C=B("use_map_mirror",k),n=B("use_stencil",k),f=v[0],E=E[0],r=r[0],C=C[0],v=v[1],k=n[0]&&B("use_rgb_to_intensity",k)[0];if(f){switch(f.blend_type){case "MIX":z(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":z(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}g="IMAGE"==f.texture.d.source&&c?[a.kd[0],a.kd[1],a.kd[2],
1]:"ENVIRONMENT_MAP"==f.texture.d.source&&c?[.8,.8,.8,1]:null;g=s(f,g);t(a,g,"u_colormap0");a.pn=f.diffuse_color_factor;a.nm=f.use_map_alpha?f.alpha_factor:0;a.xd.set(f.scale)}n=f&&f==E;E&&(n||(g=c?[.5,.5,.5,1]:null,g=s(E,g),t(a,g,"u_specmap0")),a.uw=E.specular_color_factor);if(r){h(a,"a_normal");h(a,"a_tangent");g=c?[.5,.5,1,1]:null;g=s(r,g);t(a,g,"u_normalmap0");a.Iu=r.normal_factor;var p=r.texture;if(p.b4w_use_map_parallax&&U.$i){var g=ea.K(p.b4w_parallax_steps),N=ea.K(p.b4w_parallax_lod_dist);
z(a,"PARALLAX",1);z(a,"PARALLAX_STEPS",g);z(a,"PARALLAX_LOD_DIST",N);a.dv=p.b4w_parallax_scale}}C&&(g=c?[0,0,.5,1]:null,g=s(C,g),t(a,g,"u_mirrormap"),a.so=C.mirror_factor);if(p=f&&v&&k?1:0)g=c?[.8,.8,.8,1]:null,g=s(v,g),t(a,g,"u_colormap1"),g=c?[.5,.5,.5,1]:null,g=s(k,g),t(a,g,"u_stencil0");(c=f||E||r)&&a.xd.set(c.scale);z(a,"TEXTURE_SPEC",void 0==E?0:1);z(a,"TEXTURE_MIRROR",void 0==C?0:1);z(a,"ALPHA_AS_SPEC",n?1:0);z(a,"TEXTURE_STENCIL_ALPHA_MASK",p);h(a,"a_position");h(a,"a_normal");(f||E||r)&&
h(a,"a_texcoord");if(b.b4w_water){a.Fg=!0;a.ix=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;c=b.texture_slots;e(a,"special_water.glslv","special_water.glslf");h(a,"a_position");h(a,"a_texcoord");h(a,"a_normal");h(a,"a_tangent");U.kx?(h(a,"a_polyindex"),a.Z=!0,a.wireframe_edge_color=[0,0,0],z(a,"DEBUG_WIREFRAME",1)):z(a,"DEBUG_WIREFRAME",0);n=B("use_map_normal",c);C=B("use_map_mirror",c)[0];n.length&&(p=s(n[0]),t(a,p,"u_normalmap0"),a.gx=b.b4w_water_norm_uv_velocity);z(a,"NUM_NORMALMAPS",
n.length);a.hg=Array(n.length);for(p=0;p<n.length;p++)a.hg[p]=new Float32Array(2),a.hg[p].set([n[p].scale[0],n[p].scale[1]]);C?(z(a,"TEXTURE_MIRROR",1),n=s(C),t(a,n,"u_mirrormap"),a.so=C.mirror_factor):z(a,"TEXTURE_MIRROR",0);C=null;for(p=0;p<c.length;p++)if(d=c[p],!0===d.texture.b4w_water_foam){C=d;break}C&&U.zi?(z(a,"FOAM",1),n=s(C),t(a,n,"u_foam"),a.Ms=b.b4w_foam_factor,a.Os.set(C.texture.b4w_foam_uv_freq),a.Ns.set(C.texture.b4w_foam_uv_magnitude),a.xn[0]=C.scale[0],a.xn[1]=C.scale[1]):z(a,"FOAM",
0);for(p=0;p<c.length;p++)if(d=c[p],!0===d.texture.b4w_shore_dist_map){l=d;break}l&&U.mm?(l=s(l),t(a,l,"u_shore_dist_map"),z(a,"SHORE_PARAMS",1),l=d.texture.b4w_shore_boundings,z(a,"MAX_SHORE_DIST",ea.K(d.texture.b4w_max_shore_dist)),z(a,"SHORE_MAP_SIZE_X",ea.K(l[0]-l[1])),z(a,"SHORE_MAP_SIZE_Y",ea.K(l[2]-l[3])),z(a,"SHORE_MAP_CENTER_X",ea.K((l[0]+l[1])/2)),z(a,"SHORE_MAP_CENTER_Y",ea.K((l[2]+l[3])/2))):z(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&U.sk?(z(a,"GENERATED_MESH",1),a.fx=!0,a.hx=b.b4w_water_num_cascads,
a.jx=b.b4w_water_subdivs,a.ex=b.b4w_water_detailed_dist):z(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){d=ea.K(b.b4w_water_dst_noise_scale0);l=ea.K(b.b4w_water_dst_noise_scale1);c=ea.K(b.b4w_water_dst_noise_freq0);var C=ea.K(b.b4w_water_dst_noise_freq1),n=ea.K(b.b4w_water_dir_min_shore_fac),p=ea.K(b.b4w_water_dir_freq),g=ea.K(b.b4w_water_dir_noise_scale),N=ea.K(b.b4w_water_dir_noise_freq),D=ea.K(b.b4w_water_dir_min_noise_fac),J=ea.K(b.b4w_water_dst_min_fac),F=ea.K(b.b4w_water_waves_hor_fac);z(a,
"DST_NOISE_SCALE_0",d);z(a,"DST_NOISE_SCALE_1",l);z(a,"DST_NOISE_FREQ_0",c);z(a,"DST_NOISE_FREQ_1",C);z(a,"DIR_MIN_SHR_FAC",n);z(a,"DIR_FREQ",p);z(a,"DIR_NOISE_SCALE",g);z(a,"DIR_NOISE_FREQ",N);z(a,"DIR_MIN_NOISE_FAC",D);z(a,"DST_MIN_FAC",J);z(a,"WAVES_HOR_FAC",F)}H(a,b);A(a,b);a.kw.set(b.b4w_shallow_water_col);a.mw.set(b.b4w_shore_water_col);a.lw=b.b4w_shallow_water_col_fac;a.nw=b.b4w_shore_water_col_fac;z(a,"ABSORB",ea.K(b.b4w_water_absorb_factor));z(a,"SSS_STRENGTH",ea.K(b.b4w_water_sss_strength));
z(a,"SSS_WIDTH",ea.K(b.b4w_water_sss_width));d=a.Kb;l=a.Od;a.Kb=d;a.Od=l}"HALO"===b.type&&(d=b.halo,e(a,"halo.glslv","halo.glslf"),z(a,"NUM_RINGS",d.ring_count),z(a,"NUM_LINES",d.line_count),z(a,"NUM_STARS",d.star_tip_count),z(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.Od=["a_position"],a.Tt=d.size,a.Qt=d.hardness/20,a.St.set(d.b4w_halo_rings_color),a.Rt.set(d.b4w_halo_lines_color),a.Ut=1/b.b4w_halo_stars_blend_height,a.Vt=b.b4w_halo_stars_min_height,a.Pt=!0);z(a,"TEXCOORD",0);z(a,"NORMAL_TEXCOORD",
0);f&&y(a,f,"TEXTURE_COLOR0_CO");v&&y(a,v,"TEXTURE_COLOR1_CO");k&&y(a,k,"TEXTURE_STENCIL_ALPHA_MASK_CO");E&&y(a,E,"TEXTURE_SPEC_CO");r&&y(a,r,"TEXTURE_NORM_CO");z(a,"SHADELESS",b.use_shadeless?1:0);a.Ag=b.use_shadeless}f=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===f?0:1);z(a,"ALPHA_CLIP","CLIP"===f?1:0);z(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(z(a,"VERTEX_COLOR",1),h(a,"a_color")):z(a,"VERTEX_COLOR",0);a.Uj=b.ambient;a.qn=b.diffuse_intensity;a.xk=
b.emit;a.np.set(b.specular_color);a.Dh=b.specular_alpha;H(a,b);A(a,b);b.b4w_wettable?z(a,"WETTABLE",1):z(a,"WETTABLE",0);u(a,b);U.Of?z(a,"UNROLL_LOOPS",1):z(a,"UNROLL_LOOPS",0);a.Lo=b.b4w_refractive;a.vv=b.b4w_refr_bump;a=!0}break;case "NODES":a=x(a,b);break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)a=!1;else if(m(a,b),a.Da)a=!1;else{e(a,"depth.glslv","depth.glslf");h(a,"a_position");h(a,"a_normal");f=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===
f?0:1);a.xd.set([1,1,1]);if((b=B("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===f){a.xd.set(b.scale);z(a,"TEXTURE_COLOR",1);h(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)f=s(b),t(a,f,"u_colormap0");"NONE"==b.texture.d.source&&(f=s(b),t(a,f,"u_colormap0"))}else z(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.UF=b.b4w_use_ghost,a.nc=b.b4w_collision_id,a.Rr=b.b4w_collision_group,a.Sr=b.b4w_collision_mask,a.Ci=b.physics.friction,a.vi=
b.physics.elasticity,a=!0):b.b4w_water?(a.Fg=!0,a.bG=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,
a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_do_not_render||"HALO"===b.type)a=!1;else{m(a,b);a.se=P.Gd;a.Z=!0;a.Da=!1;f=b.game_settings.alpha_blend;a.re=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;e(a,"color_id.glslv","color_id.glslf");h(a,"a_position");f=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===f?0:1);a.xd.set([1,1,1]);if((b=B("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===f){a.xd.set(b.scale);z(a,"TEXTURE_COLOR",
1);h(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)f=s(b),t(a,f,"u_colormap0");"NONE"==b.texture.d.source&&(f=s(b),t(a,f,"u_colormap0"))}else z(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?a=!1:(m(a,b),a.Da=!1,a.se=P.Gd,a.Z=!0,e(a,"grass_map.glslv","grass_map.glslf"),h(a,"a_position"),f=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.fb.a_grass_size={Lf:!0,
src:[]},f?(a.fb.a_grass_size.src.push({name:f,Lc:4}),z(a,"DYNAMIC_GRASS_SIZE",1)):z(a,"DYNAMIC_GRASS_SIZE",0),a.fb.a_grass_color={Lf:!0,src:[]},b?(a.fb.a_grass_color.src.push({name:b,Lc:7}),z(a,"DYNAMIC_GRASS_COLOR",1)):z(a,"DYNAMIC_GRASS_COLOR",0),U.Of?z(a,"UNROLL_LOOPS",1):z(a,"UNROLL_LOOPS",0),a=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?a=!1:(e(a,"wireframe.glslv","wireframe.glslf"),h(a,"a_position"),h(a,"a_normal"),h(a,"a_polyindex"),
a.Z=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],U.Of?z(a,"UNROLL_LOOPS",1):z(a,"UNROLL_LOOPS",0),a=!0);break;case "PARTICLES":if(b.b4w_do_not_render)a=!1;else{f=b.texture_slots;if(a.Pf)e(a,"particles_color.glslv","particles_color.glslf");else if(e(a,"particles_texture.glslv","particles_texture.glslf"),f=B("use_map_color_diffuse",f)[0]){z(a,"TEXTURE_COLOR",1);switch(f.blend_type){case "MIX":z(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":z(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.pn=
f.diffuse_color_factor;a.nm=f.use_map_alpha?f.alpha_factor:0;f=s(f);t(a,f)}pa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.kd);a.Uj=b.ambient;a.qn=b.diffuse_intensity;a.xk=b.emit;a.np.set(b.specular_color);a.Dh=b.specular_alpha;h(a,"a_position");h(a,"a_normal");f=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===f?0:1);z(a,"ALPHA_CLIP","CLIP"===f?1:0);z(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);H(a,b);A(a,b);m(a,b);f=b.game_settings.alpha_blend;a.re=b.b4w_render_above_all&&
"OPAQUE"!=f&&"CLIP"!=f;a.ng=b.offset_z;U.Of?z(a,"UNROLL_LOOPS",1):z(a,"UNROLL_LOOPS",0);a=!0}break;default:throw"Wrong batch type: "+a.type;}return a}function y(a,b,e){switch(b.texture_coords){case "UV":case "ORCO":z(a,e,"TEXTURE_COORDS_UV_ORCO");z(a,"TEXCOORD",1);break;case "NORMAL":z(a,e,"TEXTURE_COORDS_NORMAL");z(a,"NORMAL_TEXCOORD",1);break;default:z(a,e,0)}}function m(a,b){var e=b.game_settings,c=e.alpha_blend;switch(c){case "ALPHA_SORT":a.Da=!0;a.se=P.Kq;a.Z=!0;break;case "ALPHA":a.Da=!0;a.se=
P.Gd;a.Z=!0;break;case "CLIP":a.Da=!1;a.se=P.Gd;a.Z=!0;break;case "ADD":a.Da=!0;a.se=P.Gd;a.Z=!1;break;case "OPAQUE":a.Da=!1;a.se=P.Gd;a.Z=!0;break;default:throw Error("Unknown alpha blend mode: "+c);}a.wa=e.use_backface_culling}function s(a,b){var e=a.texture,c=e.d,e=e.image;c&&b&&e&&ha.xj(c,b,e.lc,e.filepath);return c}function B(a,b){for(var e=[],c=b.length,d=0;d<c;d++){var l=b[d];1==l[a]&&l.texture&&l.texture.d&&e.push(l)}return e}function u(a,b){var e=b.raytrace_transparency;a.Bi[0]=e.fresnel;
a.Bi[1]=1-e.fresnel_factor/5;e=b.raytrace_mirror;a.uv=e.reflect_factor;a.Bi[2]=e.fresnel;a.Bi[3]=1-e.fresnel_factor/5}function H(a,b){var e,c=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":z(a,"SPECULAR_SHADER","SPECULAR_PHONG");e=b.specular_hardness;break;case "WARDISO":z(a,"SPECULAR_SHADER","SPECULAR_WARDISO");e=b.specular_slope;break;case "TOON":z(a,"SPECULAR_SHADER","SPECULAR_TOON");e=b.specular_toon_size;c=b.specular_toon_smooth;break;default:R.error("B4W Error: unsupported specular shader: "+
b.specular_shader+' (material "'+b.name+'")'),e=b.specular_hardness}a.Ml[0]=b.specular_intensity;a.Ml[1]=e;a.Ml[2]=c}function A(a,b){switch(b.diffuse_shader){case "LAMBERT":z(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.Sd[0]=0;a.Sd[1]=0;break;case "OREN_NAYAR":z(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.Sd[0]=b.roughness;a.Sd[1]=0;break;case "FRESNEL":z(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.Sd[0]=b.diffuse_fresnel;a.Sd[1]=b.diffuse_fresnel_factor;break;default:R.error("B4W Error: unsupported diffuse shader: "+
b.diffuse_shader+' (material "'+b.name+'")'),a.Sd[0]=0,a.Sd[1]=0}}function x(a,b){if(!b.use_nodes||b.b4w_do_not_render)return!1;var c=Z.bA(b.node_tree,b.uuid,!1);if(!c)return R.error('Failed to create node graph for material "'+b.name+'", disable nodes'),f(a,b),!0;e(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===d?0:1);z(a,"ALPHA_CLIP","CLIP"===d?1:0);z(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);h(a,"a_position");m(a,b);a.ng=b.offset_z;d=b.game_settings.alpha_blend;
a.re=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;pa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.kd);a.xk=b.emit;a.Uj=b.ambient;u(a,b);b.b4w_wettable?z(a,"WETTABLE",1):z(a,"WETTABLE",0);a.yo=Z.cA(c);var l=!1;S.U(c,function(e,c){switch(c.type){case "GEOMETRY_UV":var d=c.data.name,f=c.data.value;a.Bg||(a.Bg={});a.Bg[f]=d;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":d=c.data.name;a.fb[d]={Lf:!0,src:[{name:c.data.value}]};f=0;if("GEOMETRY_VC"==
c.type)f=7;else for(var k=0;k<c.bb.length;k++){var g="RGB".indexOf(c.bb[k].identifier);-1<g&&(f|=1<<2-g)}a.fb[d].src[0].Lc=f;break;case "GEOMETRY_NO":h(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":d=c.data.value;h(a,"a_normal");z(a,"DIFFUSE_SHADER","DIFFUSE_"+d.WA);z(a,"SPECULAR_SHADER","SPECULAR_"+d.aF);z(a,"SHADELESS_MAT",d.Ag?1:0);a.Ag=d.Ag;a.Dh=d.Dh;l=!0;break;case "TEXTURE_COLOR":case "TEXTURE_COLOR2":case "TEXTURE_COLOR3":case "TEXTURE_COLOR4":case "TEXTURE_ENVIRONMENT":d=c.data.name;
f=c.data.value;!1!==f.d.Tj&&(f.d.Tj="TEXTURE_ENVIRONMENT"!=c.type?!0:!1);t(a,f.d,d);break;case "TEXTURE_NORMAL":case "TEXTURE_NORMAL2":case "TEXTURE_NORMAL3":case "TEXTURE_NORMAL4":case "B4W_PARALLAX":z(a,"CALC_TBN_SPACE",1);h(a,"a_normal");h(a,"a_tangent");d=c.data.name;(f=c.data.value)?(f.d.Tj=!1,t(a,f.d,d)):R.error("Missing texture in node ",c.name,"for material ",b.name);break;case "LAMP":c.data&&(a.kh=c.data);break;case "B4W_REFRACTION":a.Lo=!0}});l||(a.Ag=!0);U.Of?z(a,"UNROLL_LOOPS",1):z(a,
"UNROLL_LOOPS",0);return!0}function f(a,b){e(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===c?0:1);z(a,"ALPHA_CLIP","CLIP"===c?1:0);z(a,"SHADELESS",1);h(a,"a_position");h(a,"a_normal");pa.set(1,0,1,1,a.kd);z(a,"VERTEX_COLOR",0);a.ng=b.offset_z;m(a,b)}function F(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.Zk?z(a,"AU_QUALIFIER","attribute"):z(a,"AU_QUALIFIER","uniform"),z(a,"STATIC_BATCH",0)):(z(a,"AU_QUALIFIER","attribute"),z(a,"STATIC_BATCH",1));"WIREFRAME"==
a.type&&(M.sC()?z(a,"WIREFRAME_QUALITY",1):z(a,"WIREFRAME_QUALITY",0),a.jn?(z(a,"DEBUG_SPHERE",1),a.qs?z(a,"DEBUG_SPHERE_DYNAMIC",1):z(a,"DEBUG_SPHERE_DYNAMIC",0)):z(a,"DEBUG_SPHERE",0),z(a,"ALPHA",1));b.Ad?(""!==b.de?(a.fb.a_bending_col_main={Lf:!0,src:[{name:b.de,Lc:4}]},h(a,"a_bending_col_main"),""!==b.Pb.uu&&""!==b.Pb.tu&&""!==b.Pb.Mu?(a.fb.a_bending_col_detail={Lf:!0,src:[{name:b.Pb.uu,Lc:4},{name:b.Pb.tu,Lc:2},{name:b.Pb.Mu,Lc:1}]},h(a,"a_bending_col_detail"),h(a,"a_normal"),z(a,"DETAIL_BEND",
1)):z(a,"DETAIL_BEND",0),z(a,"MAIN_BEND_COL",1)):z(a,"MAIN_BEND_COL",0),z(a,"WIND_BEND",1)):z(a,"WIND_BEND",0);b.$j?z(a,"BEND_CENTER_ONLY",1):z(a,"BEND_CENTER_ONLY",0);z(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.Az|0);b.Ld?z(a,"BILLBOARD",1):z(a,"BILLBOARD",0);b.Ld&&b.Zk?z(a,"HAIR_BILLBOARD",1):z(a,"HAIR_BILLBOARD",0);b.Em?z(a,"BILLBOARD_SPHERICAL",1):z(a,"BILLBOARD_SPHERICAL",0);switch(b.ji){case "RANDOM":z(a,"BILLBOARD_RANDOM",1);z(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":z(a,"BILLBOARD_RANDOM",
0);z(a,"BILLBOARD_JITTERED",1);break;default:z(a,"BILLBOARD_RANDOM",0),z(a,"BILLBOARD_JITTERED",0)}b.La&&U.mm?z(a,"DYNAMIC_GRASS",1):z(a,"DYNAMIC_GRASS",0);a.La=b.La;a.Ee=b.Ee;a.hc=b.hc;a.ic=b.ic;a.Lb=b.Lb&&!a.Ag&&!(a.Da&&U.vs);a.wc=b.wc;a.fc=b.fc;a.Uc=b.Uc;b.Pi?(h(a,"a_influence"),z(a,"SKINNED",1),b.Ai?z(a,"FRAMES_BLENDING",1):z(a,"FRAMES_BLENDING",0),z(a,"MAX_BONES",b.Tc)):(z(a,"SKINNED",0),z(a,"FRAMES_BLENDING",0));b.$l?(z(a,"VERTEX_ANIM",1),U.bx?z(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):z(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",
"u_va_frame_factor")):z(a,"VERTEX_ANIM",0);if(b.Pi&&b.$l)throw"Skinning and vertex animation are mutually exlusive";b.tk?z(a,"DISABLE_FOG",1):z(a,"DISABLE_FOG",0);b.Fc&&(a.Fc=b.Fc);if(b.gg&&"NODES"==a.type){for(var e=a.yo,c=b.Ui,d=0;d<e.length;d++){var l=e[d];switch(l.id){case "ANIM_VALUE":for(var f=l.sl[1],t=0;t<c.length;t+=2)if(c[t]==f){l.sl[0]=c[t+1];break}}}z(a,"NUM_ANIM_VALUES",b.gg.length)}}}function h(a,b){var e=a.Od;-1==e.indexOf(b)&&e.push(b)}function z(a,b,e){ea.H(a.Kb,b,e)}function D(a,
b){if("PHYSICS"==a.type)a.zc=b;else{var e=a.se,c=a.De;a.Pt&&(b=P.nB(b));a.fx&&(b=V.LB(a.hx,a.jx,a.ex));e=P.mF(b,e,c,a.fb);a.Ee||e.Vk||(e.Qf=null,e.kf=null);a.Gc=e;e=b.t.length;a.Wi=b.I*e;a:switch(a.De){case P.bi:case P.Jj:case P.dq:c=!0;break a;default:c=!1}c?P.WC(b)?a.kg=b.ia.length/3*e:a.kg=b.I/3*e:a.kg=0}}function I(a,b,e,c,l,f,t,h,g,m,E,r){var C=[],n=h.b4w_dynamic_grass;if(!m&&n)return C;for(var u="INSTANCE"==h.b4w_wind_bend_inheritance,s="INSTANCE"==h.b4w_shadow_inheritance,A="INSTANCE"==h.b4w_reflection_inheritance,
p=[],z=[],N=0;N<l.length;N++){var D=l[N],x=Q.ni(b);x.Ld=h.b4w_hair_billboard;x.ji=h.b4w_hair_billboard_type;x.Em="SPHERICAL"==h.b4w_hair_billboard_geometry;x.La=n;x.Zk=!0;x.gg=D.d.gg;x.Ui=D.d.Ui;u?(x.Ad=D.d.Ad,x.Cj=D.d.Cj,x.of=D.d.of,x.Ce=D.d.Ce,x.de=D.d.de,x.Be=D.d.Be,x.ze=D.d.ze,x.Bd=D.d.Bd,x.Pb=D.d.Pb,x.$j=!1):(x.Ad=a.d.Ad,x.Cj=a.d.Cj,x.of=a.d.of,x.Ce=a.d.Ce,x.de=a.d.de,x.Be=a.d.Be,x.ze=a.d.ze,x.Bd=a.d.Bd,x.Pb=a.d.Pb,x.$j=!0);s?(x.hc=D.d.hc,x.ic=D.d.ic,x.Lb=D.d.Lb):(x.hc=a.d.hc,x.ic=a.d.ic,x.Lb=
a.d.Lb);A?(x.wc=D.d.wc,x.fc=D.d.fc,x.Uc=D.d.Uc):(x.wc=a.d.wc,x.fc=a.d.fc,x.Uc=a.d.Uc);p.push(x);var y=t[N];y||(y=new Float32Array);r&&Q.Wk(g.seed,E);for(var B=new Float32Array(3),J=new Float32Array([0,0,0,1]),U=[],Y=0;Y<y.length;Y+=4){B[0]=y[Y];B[1]=y[Y+1];B[2]=y[Y+2];var H=y[Y+3];if(h.b4w_initial_rand_rotation){switch(h.b4w_rotation_type){case "XYZ":var w=new Float32Array([Q.Nc(E),Q.Nc(E),Q.Nc(E)]);T.normalize(w,w);break;case "Z":w=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+
h.b4w_rotation_type;}ma.setAxisAngle(w,h.b4w_rand_rotation_strength*(2*Math.PI*Q.Nc(E)-Math.PI),J)}var I=ba.Vg(B,H,J);U.push(I)}z.push(U)}for(var q={},N=0;N<l.length;N++){var M=f[N],x=p[N],L=Q.li(x,0),U=z[N];if(U.length)for(var S=l[N].data,Z=S.materials,Y=0;Y<Z.length;Y++)if(!P.Xt(S,Y))for(var V=0;V<M.length;V++){var xa=M[V];if("COLOR_ID"!==xa){var ya=d(xa),ca=Z[Y];if(k(ya,ca,!0)){ya.De=S.De||P.bi;F(ya,x);ya.lg=h.uuid;"JITTERED"==h.b4w_hair_billboard_type&&(ya.bl=h.b4w_hair_billboard_jitter_amp,ya.cl=
h.b4w_hair_billboard_jitter_freq);n&&(ya.Mk=h.b4w_dynamic_grass_scale_threshold);u||(delete ya.fb.a_bending_col_main,delete ya.fb.a_bending_col_detail);v(ya,L);var Ub=P.Is(S,Y,ya.Od,ya.Fc,ya.fb,ya.Bg),Ab=[];if(x.Ad||x.La||x.Ld)Ab.au_wind_bending_amp=[x.Bd],Ab.au_wind_bending_freq=[x.of],Ab.au_detail_bending_freq=[x.Ce],Ab.au_detail_bending_amp=[x.Be],Ab.au_branch_bending_amp=[x.ze];var ea=P.fD(Ub,Ab,U),X=ea,ha=U;X.F.au_center_pos=new Float32Array(3*X.I);for(var Sb=ha.length,Wa=X.I/Sb,Ja=0;Ja<Sb;Ja++)for(var yb=
ha[Ja],Pb=3*Wa*Ja,pb=0;pb<Wa;pb++)X.F.au_center_pos[Pb+3*pb]=yb[0],X.F.au_center_pos[Pb+3*pb+1]=yb[1],X.F.au_center_pos[Pb+3*pb+2]=yb[2];ea=X;if(x.$j){var Va=ea,Ya=a.d.N;Va.F.a_emitter_center=new Float32Array(3*Va.I);var Da=pa.fromValues(0,0,0,1);pa.transformMat4(Da,Ya,Da);for(var nb=0;nb<Va.I;nb++)Va.F.a_emitter_center[3*nb]=Da[0],Va.F.a_emitter_center[3*nb+1]=Da[1],Va.F.a_emitter_center[3*nb+2]=Da[2];ea=Va}var mc=h.b4w_vcol_from_name,va=h.b4w_vcol_to_name,tb=ya,da=e,Gb=!u,Ba=S,Ea=[];if(""!==mc&&
""!==va){var Fa,wb=va,xb=tb.fb,Ra=[],Hb=void 0;for(Hb in xb)for(var jb=xb[Hb].src,Ib=0,$b=0;$b<jb.length;$b++){var xc=jb[$b].Lc;wb==jb[$b].name&&Ra.push(Hb,xc,Ib);Ib+=Q.ug(xc)}Fa=Ra;if(0<Fa.length)for(var Nb=0;Nb<Fa.length;Nb+=3)Ea.push({wi:mc,yk:7,tl:Fa[Nb],ul:Fa[Nb+1],vk:Fa[Nb+2]});else P.GC(tb.Od,"a_color")&&va==Ba.active_vcol_name&&Ea.push({wi:mc,yk:7,tl:"a_color",ul:7,vk:0})}Gb&&("a_bending_col_main"in da.fb&&Ea.push({wi:"a_bending_col_main",yk:4,tl:"a_bending_col_main",ul:4,vk:0}),"a_bending_col_detail"in
da.fb&&Ea.push({wi:"a_bending_col_detail",yk:7,tl:"a_bending_col_detail",ul:7,vk:0}));for(var Eb=ea,jc=U,kc=c,Ua=Ea,lc=ya.fb,Ob=!1,bb=0;bb<Ua.length;bb++){var ac=Ua[bb].wi,sb=kc.F[ac];if(sb&&0<sb.length){Ob=!0;break}}if(Ob){var G,db=a.d.Ub,Za=kc.t[0].a_position,$a=jc,na=q,W=new Float32Array(3),Oa=new Float32Array(3),eb=new Uint32Array($a.length);if(!("verts_indices"in na)){na.Nd=new Float32Array(3);na.Kd=new Float32Array(3);na.Tp=new Uint32Array(Za.length/3);na.Xi=new Uint32Array(Za.length/3);na.Nd[0]=
(db.max_x-db.min_x)/20;na.Nd[1]=(db.max_y-db.min_y)/20;na.Nd[2]=(db.max_z-db.min_z)/20;na.Kd[0]=db.min_x;na.Kd[1]=db.min_y;na.Kd[2]=db.min_z;for(var Ta=0;Ta<Za.length/3;Ta++){var cc=Q.trunc((Za[3*Ta]-na.Kd[0])/na.Nd[0]),oc=Q.trunc((Za[3*Ta+1]-na.Kd[1])/na.Nd[1]),dc=Q.trunc((Za[3*Ta+2]-na.Kd[2])/na.Nd[2]),cc=Q.xa(cc,0,19),oc=Q.xa(oc,0,19),dc=Q.xa(dc,0,19);na.Tp[Ta]=Ta;na.Xi[Ta]=dc*Math.pow(20,2)+20*oc+cc}P.VE(na.Xi,na.Tp,!0);na.Dg=new Uint32Array(Math.pow(20,3));for(Ta=0;Ta<na.Xi.length;Ta++)na.Dg[na.Xi[Ta]]++;
delete na.Xi;for(Ta=1;Ta<na.Dg.length;Ta++)na.Dg[Ta]+=na.Dg[Ta-1]}for(var ec=0;ec<$a.length;ec++){W[0]=$a[ec][0];W[1]=$a[ec][1];W[2]=$a[ec][2];for(var Vb=1E10,pc=-1,qc=Q.trunc((W[0]-na.Kd[0])/na.Nd[0]),Ec=Q.trunc((W[1]-na.Kd[1])/na.Nd[1]),Ka=Q.trunc((W[2]-na.Kd[2])/na.Nd[2]),qc=Q.xa(qc,0,19),Ec=Q.xa(Ec,0,19),Ka=Q.xa(Ka,0,19),Ha=Ka*Math.pow(20,2)+20*Ec+qc,Yc=na.Dg[Ha],qb=0==Ha?0:na.Dg[Ha-1];qb<Yc;qb++){var Wb=na.Tp[qb];Oa[0]=Za[3*Wb];Oa[1]=Za[3*Wb+1];Oa[2]=Za[3*Wb+2];T.sub(Oa,W,Oa);var Xb=T.sqrLen(Oa);
Xb<=Vb&&(Vb=Xb,pc=Wb)}if(-1==pc)for(qb=0;qb<Za.length/3;qb++)Oa[0]=Za[3*qb],Oa[1]=Za[3*qb+1],Oa[2]=Za[3*qb+2],T.sub(Oa,W,Oa),Xb=T.sqrLen(Oa),Xb<=Vb&&(Vb=Xb,pc=qb);eb[ec]=pc}G=eb;for(var kd=Eb.I/jc.length,bb=0;bb<Ua.length;bb++){var Qb=Ua[bb].tl,fc=Ua[bb].ul,ac=Ua[bb].wi,Yb=Ua[bb].yk,sb=kc.F[ac];switch(Qb){case "a_bending_col_main":var kb=1;break;case "a_bending_col_detail":kb=3;break;case "a_color":kb=3;break;default:for(var Bb=kb=0;Bb<lc[Qb].src.length;Bb++)kb+=Q.ug(lc[Qb].src[Bb].Lc)}if(sb&&0<sb.length){var yc=
Q.ug(Yb),zc=Q.ug(fc),rc=Yb&fc,Zb=Q.Bv(rc);rc!=fc&&R.error("Wrong color extraction from "+ac+" to "+Qb+".");if("a_bending_col_main"==Qb||"a_bending_col_detail"==Qb)Eb.F[Qb]=new Float32Array(Eb.I*zc);for(Bb=0;Bb<jc.length;Bb++){var sc=G[Bb],Lb=sc*yc,rb=Bb*kd*kb;if(-1!=sc)for(var Cb=0;Cb<kd;Cb++)for(var gc=Cb*kb,ub=0;ub<Zb.length;ub++)Zb[ub]&&(Eb.F[Qb][rb+gc+(Ua[bb].vk+Q.nj(fc,ub))]=sb[Lb+Q.nj(Yb,ub)])}}else Eb.F[Qb]=new Float32Array(0)}}ea=Eb;C.push({n:ya,zc:ea,sc:[ca.name],Vb:x,Wc:[a]})}}}}return C}
function r(a){return ba.Vg(a.g,a.scale,a.quat)}function v(a,b){for(var e=null,c=null,d=0;d<a.aa.length;d++){var l=a.aa[d].Md;l&&(e||(e={}),e[d]=l,a.aa[d].Md=null);if(l=a.aa[d].gb)c||(c={}),c[d]=l,a.aa[d].gb=null}a.id=0;a.So=b;a.id=Q.li(a,b);if(e)for(var f in e)a.aa[f].Md=e[f];if(c)for(f in c)a.aa[f].gb=c[f]}function E(a,b,c,l,f){var t=d("WIREFRAME");e(t,"wireframe.glslv","wireframe.glslf");t.wireframe_mode=0;t.jn=!0;t.Z=!0;t.lg=c;f&&(t.qs=!0);F(t,b);v(t,Q.li(b,0));l?(b=V.Us(1,a.w),P.jE(b,[a.wf[0],
a.xf[1],a.yf[2]],a.w)):b=V.Us(a.za,a.w);P.vp(b,1,!0);b.F.a_polyindex=P.Hs(b);D(t,b);return t}function e(a,b,e){a.Kb={Zl:b,Ak:e,Ff:[]};ea.tE(a.Kb)}function t(a,b,e){1==a.aa.length&&0==a.oe.length&&a.oe.push("default0");e=e||"default"+String(a.aa.length);-1==a.oe.indexOf(e)&&(a.aa.push(b),a.oe.push(e));a.gc&&ca.fr(a)}function l(a){if(!a.Kb)throw"No shaders info for batch "+a.name;a.gc=ea.YB(a.Kb,a.yo);ca.uz(a.gc);ca.rz(a);ca.fr(a)}function N(a,b,e){var c=a.Kb;ea.H(c,"SHADOW_SRC",b);ea.H(c,"SHADOW_DST",
e);return a}var J=q("__boundings"),C=q("__config"),R=q("__print"),M=q("__extensions"),P=q("__geometry"),S=q("__graph"),Z=q("__nodemat"),L=q("__objects"),X=q("__particles"),V=q("__primitives");q("__reformer");var ca=q("__renderer"),w=q("__scenegraph");q("__scenes");var ea=q("__shaders"),ha=q("__textures"),ba=q("__tsr"),Q=q("__util"),T=q("vec3"),pa=q("vec4"),ma=q("quat"),U=C.p,Y=["MAIN","NODES"];a.pK=d;a.KB=function(a,c,l,f,k){for(var m=[],v=[],r=0;r<l.length;r++){var C=l[r];switch(C.d.type){case "DYNAMIC":m.push(C);
break;case "STATIC":v.push(C)}}l=[];l=l.concat(b(m,a,k));c=l=l.concat(g(v,a,c,k));r=[];C=[];k={};for(l=0;l<c.length;l++){var v=c[l].n,n=c[l].Vb,m=null;if(v.id in k){var u=k[v.id],A=C[u].n,p=C[u].Vb,z=null,N=null;for(a=0;a<v.aa.length;a++){var x=v.aa[a].Md;x&&(z||(z={}),z[a]=x,v.aa[a].Md=null);if(x=v.aa[a].gb)N||(N={}),N[a]=x,v.aa[a].gb=null}Q.Dw(v,A)&&Q.Dw(n,p)&&(m=C[u]);if(z)for(a in z)v.aa[a].Md=z[a];if(N)for(a in N)v.aa[a].gb=N[a];if(!m){do v.id++;while(k[v.id])}}m||(m={n:v,Vb:c[l].Vb,Wc:[],Gw:[],
sc:[]},k[v.id]=C.length,C.push(m));m.Wc=m.Wc.concat(c[l].Wc);c[l].zc&&c[l].zc.I&&m.Gw.push(c[l].zc);if(m.sc.length)for(a=0;a<c[l].sc.length;a++)v=c[l].sc[a],-1==m.sc.indexOf(v)&&m.sc.push(v);else m.sc=c[l].sc}for(l=0;l<C.length;l++){c=C[l].Gw;if(0==c.length)a=Q.Eb(Q.Ul("%empty"));else if(1==c.length)a=c[0];else{k=[];for(a=0;a<c.length;a++)P.XC(c[a])||k.push(a);if(k.length<c.length)for(a=0;a<k.length;a++)P.vp(c[k[a]]);a=P.lF(c)}r.push({n:C[l].n,Vb:C[l].Vb,zc:a,sc:C[l].sc,Wc:C[l].Wc})}l=r;for(r=0;r<
l.length;r++)D(l[r].n,l[r].zc),l[r].n.Pe=l[r].sc;a=[];for(r=0;r<l.length;r++)if(c=l[r].n,"STATIC"==l[r].Vb.type)C=Q.du(Q.Ul("%meta")),C.d=l[r].Vb,C.ga=[c],a.push(C);else for(k=[],m=0;m<l[r].Wc.length;m++)if(C=l[r].Wc[m],-1==k.indexOf(C.name)){for(v=0;v<C.ga.length;v++)if(C.ga[v]==c)throw"Batch already exist in object";C.ga.push(c);k.push(C.name)}if(U.wireframe_debug){for(r=0;r<l.length;r++)c=l[r].Vb,"DYNAMIC"==c.type&&(C=l[r].Wc[0],-1<Y.indexOf(l[r].n.type)&&(c=E(c.zf,c,C.name,!0,!0),C.ga.push(c)));
for(r=0;r<a.length;r++)C=a[r],c=C.d,-1<Y.indexOf(C.ga[0].type)&&(c=E(c.Qc,c,C.name,!1),C.ga.push(c))}C=null;if(f.texture_slots)for(r=0;r<f.texture_slots.length;r++)if(f.texture_slots[r].texture.b4w_use_as_skydome){C=s(f.texture_slots[r],null);break}if(f.b4w_sky_settings.procedural_skydome||C)c=d("MAIN"),e(c,"special_skydome.glslv","special_skydome.glslf"),f.b4w_sky_settings.procedural_skydome?c.lv=!0:t(c,C,"u_sky"),f.b4w_sky_settings.reflexible&&(c.wc=!0,f.b4w_sky_settings.reflexible_only&&(c.fc=
!0)),h(c,"a_position"),c.ng=99999,f=V.JB(),D(c,f),C=Q.du(Q.Ul("%meta")),C.d=L.nk("DYNAMIC"),C.d.Xg=!0,C.d.Ub=J.Cd(),C.d.Qc=J.Dj(),C.d.Wa=J.Cd(),C.d.Cb=J.Dj(),C.ga=[c],a.push(C);return a};a.cG=function(a,b,e){if(b)b=e*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.wz=n;a.VB=s;a.wm=function(a,b){z(a,"CSM_SECTION0",0);z(a,"CSM_SECTION1",0);z(a,"CSM_SECTION2",0);z(a,"CSM_SECTION3",0);for(var e=0;e<b.csm_num;e++)z(a,
"CSM_SECTION"+String(e),1);z(a,"SHADOW_TEX_RES",ea.K(b.csm_resolution));z(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);z(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.le=z;a.En=function(a,b){return ea.eC(a.Kb,b)};a.Wj=t;a.aE=function(a,b,e){e=a.oe.indexOf(e);-1<e&&(a.aa[e]=b)};a.BA=function(a,b){var c=d("MAIN");c.Da=!0;pa.set(b[0],b[1],b[2],.5,c.kd);c.De=P.Jj;D(c,a);e(c,"main.glslv","main.glslf");z(c,"SHADELESS",1);l(c);return c};a.Wb=l;a.Nz=function(a){return a.gc.aj.length?
a.gc.Eo.u_cube_fog?!0:!1:!1};a.CA=function(a,b){var c=d("DEPTH");c.wa=a.wa;c.xd.set(a.xd);c.La=a.La;c.Gc=a.Gc;c.id=a.id;c.So=a.So;a.aa.length&&(c.aa[0]=a.aa[0],c.oe[0]=a.oe[0]);c.Od=a.Od;c.bl=a.bl;c.cl=a.cl;c.Mk=a.Mk;c.kg=a.kg;c.Wi=a.Wi;c.lg=a.lg;for(var l=0;l<a.Pe.length;l++)c.Pe.push(a.Pe[l]);c.od=a.od;a.gd||(a.gd=[]);a.gd.push(c);e(c,"depth.glslv","depth.glslf");ea.MC(c.Kb,a.Kb);return c=N(c,"SHADOW_SRC_NONE",b)};a.Jp=N;a.pA=function(){var a=d("DEPTH_PACK");a.wa=!0;a.Z=!1;var b=V.Qa();D(a,b);e(a,
"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");l(a);return a};a.gs=function(a){var b=d("POSTPROCESSING");e(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":z(b,"POST_EFFECT","POST_EFFECT_NONE");b.s[0]=1;b.s[1]=1;break;case "GRAYSCALE":z(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");b.s[0]=1;b.s[1]=1;break;case "X_BLUR":z(b,"POST_EFFECT","POST_EFFECT_X_BLUR");b.s[0]=1;b.s[1]=0;break;case "Y_BLUR":z(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");
b.s[0]=0;b.s[1]=1;break;case "X_EXTEND":z(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");b.s[0]=1;b.s[1]=0;break;case "Y_EXTEND":z(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");b.s[0]=0;b.s[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}b.wa=!0;b.Z=!1;a=V.Qa();D(b,a);l(b);return b};a.FI=function(){var a=d("EDGE");a.Z=!1;a.wa=!0;a.s[0]=1;a.s[1]=1;var b=V.Qa();D(a,b);e(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");l(a);return a};a.GA=function(a){var b=d("SSAO");b.Z=!1;b.wa=!0;
b.s[0]=1;b.s[1]=1;var c=V.Qa();D(b,c);e(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");z(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.yw);z(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:ha.NB(a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=s(a,c);t(b,a,"u_ssao_special_tex");l(b);
return b};a.HA=function(a){var b=d("SSAO_BLUR");b.Z=!1;b.wa=!0;b.s[0]=1;b.s[1]=1;var c=V.Qa();D(b,c);e(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");z(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);l(b);return b};a.qA=function(){var a=d("DOF");a.Z=!1;a.wa=!0;a.s[0]=1;a.s[1]=1;var b=V.Qa();D(a,b);e(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");z(a,"DEPTH_RGBA",1);l(a);return a};a.rA=function(){var a=d("GLOW");a.Z=!1;a.wa=!0;a.s[0]=1;a.s[1]=1;var b=V.Qa();
D(a,b);e(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");l(a);return a};a.sA=function(a,b,c){var f=d("GOD_RAYS");f.Z=!1;f.wa=!0;f.s[0]=1;f.s[1]=1;var t=V.Qa();D(f,t);e(f,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");z(f,"DEPTH_RGBA",a);z(f,"WATER_EFFECTS",b);z(f,"STEPS_PER_PASS",ea.K(c,1));l(f);return f};a.tA=function(){var a=d("GOD_RAYS_COM");a.Z=!1;a.wa=!0;a.s[0]=1;a.s[1]=1;var b=V.Qa();D(a,b);e(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");
l(a);return a};a.DA=function(){var a=d("SKY");a.Z=!1;a.wa=!0;a.s[0]=1;a.s[1]=1;var b=V.FB();D(a,b);e(a,"procedural_skydome.glslv","procedural_skydome.glslf");z(a,"NUM_LIGHTS",1);z(a,"WATER_EFFECTS",1);l(a);return a};a.jA=function(){var a=d("ANTIALIASING");a.Z=!1;a.wa=!0;a.s[0]=1;a.s[1]=1;a.Rh=1/U.resolution_factor;var b=V.Qa();D(a,b);e(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");z(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");l(a);return a};a.EA=function(a){var b=d("SMAA"),
c=V.Qa();D(b,c);e(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");z(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");z(b,"SMAA_PASS",a);z(b,"SMAA_PREDICATION",0);z(b,"SMAA_REPROJECTION",0);l(b);b.Z=!1;b.wa=!0;b.s[0]=1;b.s[1]=1;b.Rh=1/U.resolution_factor;return b};a.uA=function(a){var b=d("LANCZOS");b.Z=!1;b.wa=!0;b.Rh=1/U.resolution_factor;"LANCZOS_X"==a?(b.s[0]=1,b.s[1]=0):"LANCZOS_Y"==a&&(b.s[0]=0,b.s[1]=1);a=V.Qa();D(b,a);e(b,"postprocessing/postprocessing.glslv","postprocessing/lanczos.glslf");
l(b);return b};a.nA=function(){var a=d("COMPOSITING");a.Z=!1;a.wa=!0;a.s[0]=1;a.s[1]=1;var b=V.Qa();D(a,b);e(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");l(a);return a};a.xA=function(a){var b=d("MOTION_BLUR");b.wa=!0;b.Z=!1;var c=V.Qa();D(b,c);e(b,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");z(b,"BLUR_DECAY_THRESHOLD",ea.K(a));l(b);return b};a.iA=function(){var a=d("ANAGLYPH");a.wa=!0;a.Z=!1;var b=V.Qa();D(a,b);e(a,"postprocessing/postprocessing.glslv",
"postprocessing/anaglyph.glslf");l(a);return a};a.vA=function(){var a=d("LUMINANCE");a.Z=!1;a.wa=!0;a.s[0]=1;a.s[1]=1;var b=V.Qa();D(a,b);e(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");l(a);return a};a.kA=function(){var a=d("LUMINANCE");a.Z=!1;a.wa=!0;a.s[0]=1;a.s[1]=1;var b=V.Qa();D(a,b);e(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");l(a);return a};a.wA=function(){var a=d("LUMINANCE_X_BLUR");a.Z=!1;a.wa=!0;a.s[0]=1;a.s[1]=1;var b=V.Qa();
D(a,b);e(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");l(a);return a};a.lA=function(a){var b=d("POSTPROCESSING");switch(a){case "X_BLUR":b.s[0]=1;b.s[1]=0;break;case "Y_BLUR":b.s[0]=0;b.s[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}b.wa=!0;b.Z=!1;a=V.Qa();D(b,a);e(b,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");l(b);return b};a.mA=function(){var a=d("BLOOM");a.Z=!1;a.wa=!0;a.s[0]=1;a.s[1]=1;var b=V.Qa();
D(a,b);e(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");l(a);return a};a.KA=function(){var a=d("VELOCITY");a.Z=!1;a.wa=!0;a.s[0]=1;a.s[1]=1;var b=V.Qa();D(a,b);e(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");l(a);return a};a.rj=function(a,b,e){var c=a.Rh;a.yp[0]=b*a.s[0]*c;a.yp[1]=e*a.s[1]*c};a.wg=function(a,b){a.Rh=b};a.gJ=function(a,b,e){a=a.ga;for(var c=null,d=0;d<a.length;d++){var l=a[d];if(-1<l.Pe.indexOf(b)&&(e&&l.type==e||!e)){if(l.gd)return l;
c=null===c?l:c}}return c};a.aA=function(a){for(var b=a.aa,e=0;e<b.length;e++)ha.UA(b[e].Ua);P.Lr(a.Gc)}};b4w.module.__boundings=function(a,q){function d(a,b){for(var c=a[0],d=a[1],f=a[2],k=a[0],h=a[1],g=a[2],m=3;m<a.length;m+=3)var n=a[m],r=a[m+1],v=a[m+2],c=Math.max(c,n),d=Math.max(d,r),f=Math.max(f,v),k=Math.min(k,n),h=Math.min(h,r),g=Math.min(g,v);b.max_x=c;b.max_y=d;b.max_z=f;b.min_x=k;b.min_y=h;b.min_z=g;return b}function b(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,f=a.max_z,k=a.min_x,h=a.min_y,g=a.min_z;b[0]=k;b[1]=h;b[2]=g;b[3]=c;b[4]=h;b[5]=g;b[6]=c;b[7]=d;b[8]=g;b[9]=k;b[10]=
d;b[11]=g;b[12]=k;b[13]=h;b[14]=f;b[15]=c;b[16]=h;b[17]=f;b[18]=c;b[19]=d;b[20]=f;b[21]=k;b[22]=d;b[23]=f;return b}function g(a,b,c){k.add(b,c,a.w);k.scale(a.w,.5,a.w);a.za=k.distance(a.w,b);return a}var c=q("__geometry"),n=q("__util"),p=q("__tsr"),k=q("vec3"),y=new Float32Array(24),m=new Float32Array(3),s=new Float32Array(3),B=new Float32Array(3);a.Yr=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.fI=function(){return{max_x:1E12,min_x:-1E12,
max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.Cd=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.Cs=function(a,b){var c=a.max_y,d=a.max_z,f=a.min_x,k=a.min_y,h=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,f);a.min_y=Math.min(b.min_y,k);a.min_z=Math.min(b.min_z,h)};a.xz=d;a.Fm=function(c,k,g){g||(g=a.Cd());c=b(c,y);n.Te(c,k,c);return d(c,g)};a.lB=b;a.hM=function(b,c,d){d||
(d=a.Cd());var k=c.min_x,f=c.max_x,g=c.min_y,h=c.max_y,m=c.min_z;c=c.max_z;if(k>=b.max_x||f<=b.min_x||g>=b.max_y||h<=b.min_y||m>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,k);d.max_x=Math.min(b.max_x,f);d.min_y=Math.max(b.min_y,g);d.max_y=Math.min(b.max_y,h);d.min_z=Math.max(b.min_z,m);d.max_z=Math.min(b.max_z,c);return d};a.oM=function(b,c,d){d||(d=a.Cd());var k=b.max_x-b.min_x,f=b.max_y-b.min_y,g=b.max_z-b.min_z;d.min_x=
b.min_x-.5*(c-1)*k;d.max_x=b.max_x+.5*(c-1)*k;d.min_y=b.min_y-.5*(c-1)*f;d.max_y=b.max_y+.5*(c-1)*f;d.min_z=b.min_z-.5*(c-1)*g;d.max_z=b.max_z+.5*(c-1)*g;return d};a.Hm=function(b,c,d){d||(d=a.Dj());k.transformMat4(b.w,c,d.w);d.za=b.za*n.gl(c);return d};a.Gm=function(a,b,c){c||(c={wf:new Float32Array(3),xf:new Float32Array(3),yf:new Float32Array(3),w:new Float32Array([0,0,0])});p.uj(a.w,b,c.w);k.copy(a.wf,c.wf);k.copy(a.xf,c.xf);k.copy(a.yf,c.yf);p.Rl(c.wf,b,c.wf);p.Rl(c.xf,b,c.xf);p.Rl(c.yf,b,c.yf);
return c};a.Ym=function(a,b){return{za:a,w:new Float32Array(b)}};a.Dj=function(){return{w:new Float32Array([0,0,0]),za:0}};a.Xm=function(a,b,c,d){return{wf:new Float32Array(a),xf:new Float32Array(b),yf:new Float32Array(c),w:new Float32Array([d[0],d[1],d[2]])}};a.zz=function(){return{w:new Float32Array([0,0,0]),za:1E12}};a.jB=function(a,b){var c=k.subtract(b.w,a.w,k.create());0==k.length(c)&&k.set(1,0,0,c);var d=k.normalize(c,k.create()),c=k.scale(d,a.za,k.create());k.add(c,a.w,c);var f=k.scale(d,
-a.za,k.create());k.add(f,a.w,f);var g=k.scale(d,b.za,k.create());k.add(g,b.w,g);var h=k.scale(d,-b.za,k.create());k.add(h,b.w,h);c=[c,f,g,h];d=k.normalize(d,k.create());f=c[0];g=c[0];for(h=1;h<c.length;h++){var m=k.dot(c[h],d);m<k.dot(f,d)&&(f=c[h]);m>k.dot(g,d)&&(g=c[h])}d=[f,g];c=d[0];d=d[1];a.w=k.scale(k.add(c,d,k.create()),.5,k.create());a.za=k.length(k.subtract(d,c,k.create()))/2};a.Zr=function(a,b){var c=b.max_y,d=b.min_y,f=Math.max(0,c-d-2*a);return{za:a,height:f,w:new Float32Array([0,(c+
d)/2,0])}};a.as=function(a,b){var c=b.max_y,d=b.min_y,f=Math.max(0,c-d);return{za:a,height:f,w:new Float32Array([0,(c+d)/2,0])}};a.$r=function(a,b){var c=b.max_y,d=b.min_y,f=Math.max(0,c-d);return{za:a,height:f,w:new Float32Array([0,(c+d)/2,0])}};a.mI=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.QD=function(a){for(var b=0,c=0,d=0,f=0,k=0,h=0,g=0,m=0,n=0;n<a.submeshes.length;n++){var r=a.submeshes[n];if(r.position.length){b=
f=r.position[0];c=k=r.position[1];d=h=r.position[2];break}}for(n=0;n<a.submeshes.length;n++)for(var r=a.submeshes[n],r=r.position,v=0;v<r.length/3;v++)var E=r[3*v],e=r[3*v+1],t=r[3*v+2],b=Math.max(E,b),c=Math.max(e,c),d=Math.max(t,d),f=Math.min(E,f),k=Math.min(e,k),h=Math.min(t,h),g=Math.max(Math.sqrt(E*E+e*e+t*t),g),m=Math.max(Math.sqrt(E*E+t*t),m);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=f;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=k;a.b4w_bounding_box.max_z=d;a.b4w_bounding_box.min_z=
h;a.b4w_bounding_sphere_radius=g;a.b4w_bounding_cylinder_radius=m};a.iC=function(b){var d=b.subarray(0,3),n=b.subarray(6,9),p=b.subarray(12,15),f=b.subarray(18,21);b=k.subtract(n,d,m);k.normalize(b,b);var y=c.nC(d,n,p,s),y=k.cross(y,b,y);k.normalize(y,y);var h=k.create(),z=k.create();k.subtract(n,d,B);z[0]=k.dot(B,b);z[1]=k.dot(B,y);n=k.create();k.subtract(p,d,B);n[0]=k.dot(B,b);n[1]=k.dot(B,y);p=k.create();k.subtract(f,d,B);p[0]=k.dot(B,b);p[1]=k.dot(B,y);f=a.Dj();p=[h,z,n,p];h=g(f,p[0],p[1]);for(f=
2;f<p.length;f++)if(k.distance(h.w,p[f])>h.za){for(var D=h,h=p,z=p[f],n=f-1,D=g(D,z,h[0]),I=1;I<=n;I++)if(k.distance(D.w,h[I])>D.za){for(var r=D,D=h,v=z,E=h[I],e=I-1,r=g(r,v,E),t=0;t<=e;t++)if(k.distance(r.w,D[t])>r.za){var l=v,N=E,J=D[t],C=k.subtract(N,J,B),C=k.squaredLength(C),R=k.subtract(l,J,B),q=k.squaredLength(R),R=k.subtract(l,N,B),P=k.squaredLength(R),R=C*(q+P-C),S=q*(P+C-q),C=P*(C+q-P),q=R+S+C;k.copy(l,r.w);k.scale(r.w,R/q,r.w);k.scaleAndAdd(r.w,N,S/q,r.w);k.scaleAndAdd(r.w,J,C/q,r.w);r.za=
k.distance(r.w,l)}D=r}h=D}f=h;b=k.scale(b,f.w[0],B);k.scaleAndAdd(b,y,f.w[1],b);k.add(b,d,f.w);return f}};b4w.module.__graph=function(a){function q(a,b,c){c||(c=null);if(d(a,b))throw"Graph already has node with given ID";a.Ma.push(b,c)}function d(a,b){for(var c=a.Ma,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function b(a,b,c,f){f||(f=null);if(d(a,b)&&d(a,c))a.ya.push(b,c,f);else throw"Wrong node IDs";}function g(a,b){if(!d(a,b))throw"Node not found";for(var c=a.Ma,f=0;f<c.length;f+=2)c[f]==b&&(c.splice(f,2),f-=2)}function c(a){a=a.Ma;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}
function n(a,b){for(var c=a.Ma,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function p(a){var b=[],c={};k(a,c);for(var d=a.Ma,f=0;f<d.length;f+=2)0==F(a,d[f])&&y(a,d[f],c,b);return{Ma:b,ya:a.ya.slice(0)}}function k(a,b){for(var c=a.Ma,d=0;d<c.length;d+=2)b[c[d]]=!1}function y(a,b,c,d){if(!c[b]){c[b]=!0;for(var k=0;k<f(a,b);k++)y(a,h(a,b,k),c,d);d.unshift(b,x(a,b))}}function m(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var k=0;k<f(a,b);k++){var g=h(a,b,k);m(a,g,c,d)}if(20==d||30==d)for(k=
0;k<F(a,b);k++)g=z(a,b,k),m(a,g,c,d)}}function s(a){var b=a.Ma;a=a.ya;for(var c=[],d=[],f=[],h=0;h<b.length;h++)f[b[2*h]]=h,c.push(h,b[2*h+1]);for(h=0;h<a.length;h+=3)d.push(f[a[h]],f[a[h+1]],a[h+2]);return{Ma:c,ya:d}}function B(a,b,c){if(c.jd==c.Re){for(var d=0,k=0;d<c.Re;d++)-1!=c.Pd[d]&&(a[k]=d,b[k]=c.Pd[d],k++);return!0}if(c.Re>c.ph||c.ff>c.gf||c.Oh>c.Qh||c.Nh>c.Ph)return!1;for(var k=d=-1,g=!1;!g&&u(c,E,d,k);)if(d=E[0],k=E[1],H(c,d,k)){var m;m=c;g={};g.Di=m.Di;g.Ei=m.Ei;g.xo=m.xo;g.wk=m.wk;g.Re=
m.Re;g.ph=m.ph;g.Se=m.Se;g.jd=g.ol=m.jd;g.Nh=m.Nh;g.Oh=m.Oh;g.ff=m.ff;g.Ph=m.Ph;g.Qh=m.Qh;g.gf=m.gf;g.ii=-1;g.Pd=m.Pd;g.Ef=m.Ef;g.Rf=m.Rf;g.Sf=m.Sf;g.og=m.og;g.pg=m.pg;g.Il=m.Il;m.Il[0]+=1;var g=m=g,r=d,v=k,n=g.Di,p=g.Ei,s=g.Re,D=g.ph,y=g.Pd,x=g.Ef,w=g.Rf,I=g.Sf,q=g.og,ba=g.pg;A(r<s);A(v<D);A(g.jd<s);A(g.jd<D);s=++g.jd;g.ii=r;w[r]||(w[r]=s,g.Nh++,q[r]&&g.ff++);q[r]||(q[r]=s,g.Oh++,w[r]&&g.ff++);I[v]||(I[v]=s,g.Ph++,ba[v]&&g.gf++);ba[v]||(ba[v]=s,g.Qh++,I[v]&&g.gf++);y[r]=v;x[v]=r;for(y=0;y<F(n,r);y++)x=
z(n,r,y),w[x]||(w[x]=s,g.Nh++,q[x]&&g.ff++);for(y=0;y<f(n,r);y++)x=h(n,r,y),q[x]||(q[x]=s,g.Oh++,w[x]&&g.ff++);for(y=0;y<F(p,v);y++)x=z(p,v,y),I[x]||(I[x]=s,g.Ph++,ba[x]&&g.gf++);for(y=0;y<f(p,v);y++)x=h(p,v,y),ba[x]||(ba[x]=s,g.Qh++,I[x]&&g.gf++);g=B(a,b,m);A(1>=m.jd-m.ol);A(-1!=m.ii);x=m.Di;r=m.Ei;v=m.jd;n=m.ii;p=m.Pd;w=m.Ef;s=m.Rf;I=m.Sf;D=m.og;q=m.pg;if(m.ol<v){s[n]==v&&(s[n]=0);for(ba=0;ba<F(x,n);ba++)y=z(x,n,ba),s[y]==v&&(s[y]=0);D[n]==v&&(D[n]=0);for(ba=0;ba<f(x,n);ba++)y=h(x,n,ba),D[y]==v&&
(D[y]=0);x=p[n];I[x]==v&&(I[x]=0);for(ba=0;ba<F(r,x);ba++)y=z(r,x,ba),I[y]==v&&(I[y]=0);q[x]==v&&(q[x]=0);for(ba=0;ba<f(r,x);ba++)y=h(r,x,ba),q[y]==v&&(q[y]=0);p[n]=-1;w[x]=-1;m.jd=m.ol;m.ii=-1}}return g}function u(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var f=a.ff,h=a.gf,k=a.Oh,g=a.Qh,m=a.Nh,r=a.Ph,v=a.jd,E=a.Re,n=a.ph,p=a.Pd,s=a.Ef,z=a.Rf,y=a.Sf,x=a.og,D=a.pg;if(f>v&&h>v)for(;c<E&&(-1!=p[c]||0==x[c]||0==z[c]);)c++,d=0;else if(k>v&&g>v)for(;c<E&&(-1!=p[c]||0==x[c]);)c++,d=0;else if(m>v&&r>v)for(;c<E&&
(-1!=p[c]||0==z[c]);)c++,d=0;else if(0==c&&0!=a.Se){for(z=0;z<E&&-1!=p[c=a.Se[z]];)z++;z==E&&(c=E)}else for(;c<E&&-1!=p[c];)c++,d=0;if(f>v&&h>v)for(;d<n&&(-1!=s[d]||0==D[d]||0==y[d]);)d++;else if(k>v&&g>v)for(;d<n&&(-1!=s[d]||0==D[d]);)d++;else if(m>v&&r>v)for(;d<n&&(-1!=s[d]||0==y[d]);)d++;else for(;d<n&&-1!=s[d];)d++;return c<E&&d<n?(b[0]=c,b[1]=d,!0):!1}function H(a,b,c){var d=a.Di,k=a.Ei,g=a.ph,m=a.Pd,v=a.Ef,r=a.Rf,E=a.Sf,n=a.og,p=a.pg;A(b<a.Re);A(c<g);A(-1==m[b]);A(-1==v[c]);if(!(0,a.xo)(x(d,
b),x(k,c)))return!1;for(var s=g=0,y=0,u=0,B=0,q=0,H=0;H<f(d,b);H++){var ba=h(d,b,H);if(-1!=m[ba]){var Q=m[ba];if(!D(k,c,Q)||!I(a.wk,d,b,ba,k,c,Q))return!1}else r[ba]&&y++,n[ba]&&g++,r[ba]||n[ba]||B++}for(H=0;H<F(d,b);H++)if(ba=z(d,b,H),-1!=m[ba]){if(Q=m[ba],!D(k,Q,c)||!I(a.wk,d,ba,b,k,Q,c))return!1}else r[ba]&&y++,n[ba]&&g++,r[ba]||n[ba]||B++;for(H=0;H<f(k,c);H++)if(Q=h(k,c,H),-1!=v[Q]){if(ba=v[Q],!D(d,b,ba))return!1}else E[Q]&&u++,p[Q]&&s++,E[Q]||p[Q]||q++;for(H=0;H<F(k,c);H++)if(Q=z(k,c,H),-1!=
v[Q]){if(ba=v[Q],!D(d,ba,b))return!1}else E[Q]&&u++,p[Q]&&s++,E[Q]||p[Q]||q++;return y<=u&&g<=s&&B<=q}function A(a){if(!a)throw"Assertion failed";}function x(a,b){for(var c=a.Ma,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function f(a,b){for(var c=a.ya,d=0,f=0;f<c.length;f+=3)c[f]==b&&d++;return d}function F(a,b){for(var c=a.ya,d=0,f=0;f<c.length;f+=3)c[f+1]==b&&d++;return d}function h(a,b,c){a=a.ya;for(var d=0,f=0;f<a.length;f+=3)if(a[f]==b){if(d==c)return a[f+1];d++}return-1}function z(a,
b,c){a=a.ya;for(var d=0,f=0;f<a.length;f+=3)if(a[f+1]==b){if(d==c)return a[f];d++}return-1}function D(a,b,c){a=a.ya;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function I(a,b,c,d,f,h,k){for(var g=r(b,c,d),m=r(f,h,k),E=0;E<g;E++){for(var n=!1,p=0;p<m;p++)if(a(v(b,c,d,E),v(f,h,k,p))){n=!0;break}if(!n)return!1}return!0}function r(a,b,c){var d=0;a=a.ya;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&d++;return d}function v(a,b,c,d){a=a.ya;for(var f=0,h=0;h<a.length;h+=3)if(a[h]==
b&&a[h+1]==c){if(f==d)return a[h+2];f++}return null}var E=[-1,-1];a.qq=-1;a.xG=10;a.bq=20;a.CH=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var f=a[d];switch(f.length){case 2:b.push(f[0],f[1]);break;case 3:c.push(f[0],f[1],f[2]);break;default:throw"Wrong graph constructor params";}}return{Ma:b,ya:c}};a.HI=function(a,b){for(var c=[],d=[],f=0;f<a.length;f++)c.push(a[f][0],a[f][1]);for(f=0;f<b.length;f++)d.push(b[f][0],b[f][1],b[f][2]);return{Ma:c,ya:d}};a.rm=q;a.mK=d;a.ye=
b;a.uh=g;a.th=function(a,b,c,d){if(!D(a,b,c))throw"Edge not found";a=a.ya;for(var f=0,h=0;h<a.length;h+=3)if(a[h]==b&&a[h+1]==c){if(-1==d)a.splice(h,3);else{if(d==f){a.splice(h,3);break}f++}h-=3}};a.v=function(a,b){if(-1==n(a,b)){var d=c(a);q(a,d,b);return d}throw"Non-unique attribute";};a.$D=function(a,b,c,d,f){a=a.ya;for(var h=0;h<a.length;h+=3)a[h]==b&&a[h+1]==c&&a[h+2]==d&&(a[h+2]=f)};a.Ts=c;a.qh=n;a.m=function(a,c,d,f){c=n(a,c);d=n(a,d);if(-1!=c&&-1!=d)b(a,c,d,f);else throw"Attributes not found";
};a.U=function(a,b){for(var c=a.Ma,d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};a.hf=function(a,b){for(var c=a.ya,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.pe=function(a,b,c){for(var d=a.ya,f=0;f<d.length;f+=3)if(d[f+1]==b){var h=d[f];if(c(h,x(a,h),d[f+2]))break}};a.jf=function(a,b,c){for(var d=a.ya,f=0;f<d.length;f+=3)if(d[f]==b){var h=d[f+1];if(c(h,x(a,h),d[f+2]))break}};a.Ap=p;a.vF=function(a){a=p(a).Ma;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.vK=function(){};a.Ew=function(a,
b,c){if(!d(a,b))throw"No such node";var f={};k(a,f);m(a,b,f,c);b=[];for(var h in f)f[h]&&(h=Number(h),b.push(h,x(a,h)));a={Ma:b,ya:a.ya.slice(0)};f=a.ya;for(h=0;h<f.length;h+=3)b=f[h+1],d(a,f[h])&&d(a,b)||(f.splice(h,3),h-=3);return a};a.rC=function(a){for(var b=[],c=a.Ma,d=0;d<c.length;d+=2){var f=c[d];F(a,f)||b.push(f)}return b};a.Mn=function(a){for(var b=[],c=a.Ma,d=0;d<c.length;d+=2){var h=c[d];f(a,h)||b.push(h)}return b};a.match=function(a,b,c,d){var f={};f.Di=s(a);f.Ei=s(b);f.xo=c||function(a,
b){return a==b};f.wk=d||function(a,b){return a==b};d=a.Ma.length/2;var h=b.Ma.length/2;f.Re=d;f.ph=h;f.Se=0;f.jd=f.ol=0;f.ff=f.Nh=f.Oh=0;f.gf=f.Ph=f.Qh=0;f.ii=-1;f.Pd=Array(d);f.Ef=Array(h);f.Rf=Array(d);f.Sf=Array(h);f.og=Array(d);f.pg=Array(h);f.Il=[1];for(c=0;c<d;c++)f.Pd[c]=-1,f.Rf[c]=0,f.og[c]=0;for(c=0;c<h;c++)f.Ef[c]=-1,f.Sf[c]=0,f.pg[c]=0;h=Array(d);d=Array(d);if(B(h,d,f)){for(c=0;c<h.length;c++)h[c]=a.Ma[2*h[c]],d[c]=b.Ma[2*d[c]];return[h,d]}return null};a.$a=x;a.rh=f;a.cu=F;a.eh=h;a.Ek=
z;a.HJ=r;a.dh=v;a.replace=function(a,b,d){for(var f=a.ya,h=c(a),k=0;k<b.length;k++){var m=b[k];g(a,m);for(var v=0;v<f.length;v+=3)f[v]==m&&(f[v]=h),f[v+1]==m&&(f[v+1]=h),f[v]==f[v+1]&&(f.splice(v,3),v-=3)}q(a,h,d)};a.RD=function(a,b,c,d,f){if(!D(a,b,c))throw"Edge not found";a=a.ya;for(var h=0;h<a.length;h+=3)a[h]==b&&a[h+1]==c&&(a[h]=d,a[h+1]=f)};a.KI=function(a,b){var c=a.Ma,d=a.ya,f;f="digraph debug {\n    node [shape=box];\n";for(var h=0;h<c.length;h+=2){var k=c[h],g=c[h+1],g=b?b(k,g):String(k);
f+="    ";f+=String(k)+' [label="'+g.replace(/\"/g,'\\"')+'"];\n'}for(h=0;h<d.length;h+=3)c=d[h],k=d[h+1],f+="    ",f+=String(c)+" -> "+String(k)+";\n";return f+="}"}};b4w.module.__nodemat=function(a,q){function d(a,e,d){if(e in Q)return Q[e];for(var f=L.create(),l=a.nodes,h=a.links,t=a.animation_data,k=0;k<l.length;k++)if(!A(f,l[k],0,t))return Q[e]=null;if(d&&-1==u(a,f,"GROUP_OUTPUT","group"))return null;k=N(f);if(!J(f,h,k))return null;if(d)return f;for(k=0;k<h.length;k++){d=h[k];for(var l=n(d.from_node,f),t=n(d.to_node,f),g=0;g<l.length;g++)for(var v=0;v<t.length;v++){for(var r=l[g],E=t[v],C=L.$a(f,r),s=L.$a(f,E),z=f,x=s,s=[],D=d.from_socket.identifier,T=d.to_socket.identifier,
F=C.bb,C=0;C<F.length;C++)if(F[C].identifier==D){s.push(C);break}x=x.G;for(C=0;C<x.length;C++)if(x[C].identifier==T){s.push(C);break}2==s.length&&L.ye(z,r,E,s)}}c(f);a=u(a,f,"OUTPUT","material");if(-1==a)return Q[e]=null;p(f);f=L.Ew(f,a,L.bq);b(f);y(f);m(f);B(f);return Q[e]=f}function b(a){L.U(a,function(b,e){for(var c=e.G,d=e.bb,f=0;f<c.length;f++)g(a,c[f],b,f,1);for(f=0;f<d.length;f++)g(a,d[f],b,f,0)})}function g(a,b,e,c,d){if(b.ae){var f=!0;L.hf(a,function(a,b,l){if(!d&&a==e&&l[0]==c||d&&b==e&&
l[1]==c)f=!1});f&&(b.ae=!1)}}function c(a){var b=[];L.U(a,function(e,c){switch(c.type){case "B4W_TRANSLUCENCY":L.hf(a,function(a,d,f){a==e&&"Translucency"==c.bb[f[0]].name&&b.push(a,d,[f[0]+1,f[1]+1])})}});for(var e=0;e<b.length;e+=3)L.ye(a,b[e],b[e+1],b[e+2])}function n(a,b){var e=[];L.U(b,function(b,c){c.name==a.name&&e.push(b)});if(e.length)return e;throw"Node not found";}function p(a){var b=[];L.U(a,function(a,e){"B4W_PARALLAX"!=e.type&&"REROUTE"!=e.type||b.push(a,e)});for(var e=0;e<b.length;e+=
2){var c=b[e],d=b[e+1];if("B4W_PARALLAX"==d.type){var f=k(a,c);if(-1!=f){var l=L.Ek(a,f,0);L.th(a,f,c,-1);-1!=l&&L.th(a,l,f,-1);c=L.$a(a,f);d.data=c.data;d.Ja[0]=c.Ja[0];L.uh(a,f)}d.G.splice(1,1)}else if("REROUTE"==d.type){for(var d=L.Ek(a,c,0),h=L.rh(a,c),f=[],l=[],t=[],g=0;g<h;g++){var m=L.eh(a,c,g),v=l.indexOf(m);-1!=v?t[v]+=1:(l.push(m),t.push(1),f.push(c,m))}if(-1!=d)for(h=L.dh(a,d,c,0)[0],g=0;g<l.length;g++)for(m=0;m<t[g];m++)v=L.dh(a,c,l[g],m)[1],L.ye(a,d,l[g],[h,v]);for(g=0;g<f.length;g+=
2)L.th(a,f[g],f[g+1],-1)}}}function k(a,b){for(var e=a.ya,c=0;c<e.length;c+=3)if(e[c+1]==b&&1==e[c+2][1])return e[c];return-1}function y(a){var b=[];L.U(a,function(a,e){"GEOMETRY_VC"!=e.type&&"GEOMETRY_UV"!=e.type&&"GEOMETRY_NO"!=e.type&&"GEOMETRY_FB"!=e.type&&"GEOMETRY_VW"!=e.type&&"GEOMETRY_GL"!=e.type||b.push(a,e)});for(var e=[],c=0;c<b.length;c+=2){for(var d=b[c],f=b[c+1],l=!0,h=0;h<e.length;h++){var t=e[h];if(s(f,t.Ca)){l=[];h=L.rh(a,d);for(m=0;m<h;m++){var k=L.eh(a,d,m),g=L.dh(a,d,k,0);l.push(d,
k,g);L.ye(a,t.id,k,g)}for(var m=0;m<l.length;m+=3)L.th(a,l[m],l[m+1],0);L.uh(a,d);l=!1;break}}l&&(t={id:d,Ca:f},e.push(t))}}function m(a){var b=[];L.U(a,function(a,e){"TEXTURE_COLOR"!=e.type&&"TEXTURE_NORMAL"!=e.type||b.push(a,e)});for(var e=[],c=0;c<b.length;c+=2){for(var d=b[c],f=b[c+1],l=!0,h=0;h<e.length;h++){var t=e[h];if(!(3<=t.jl.length)&&s(f,t.Ca)){for(var h=[],k=L.cu(a,d),l={},g=0;g<k;g++){var m=L.Ek(a,d,g);m in l||(l[m]=0);var v=L.dh(a,m,d,l[m]++);h.push(m,d,v)}for(var k=[],l=L.rh(a,d),
r={},g=0;g<l;g++)m=L.eh(a,d,g),m in r||(r[m]=0),v=L.dh(a,d,m,r[m]++),k.push(d,m,v);for(var l=h.concat(k),g=0;g<l.length;g+=3)L.th(a,l[g],l[g+1],0);L.uh(a,d);g={Ca:f,cB:h,dB:k};t.jl.push(g);l=!1;break}}l&&(t={id:d,Ca:f,jl:[]},e.push(t))}for(c=0;c<e.length;c++){t=e[c];d=t.jl.length;k=t.Ca.G.length;l=t.Ca.bb.length;for(h=0;h<d;h++){v=t.jl[h];g=v.Ca;f=v.cB;r=v.dB;t.Ca.G=t.Ca.G.concat(g.G);t.Ca.bb=t.Ca.bb.concat(g.bb);for(g=0;g<t.Ca.G.length;g++)t.Ca.G[g].identifier+=V.trunc(g/k)+1;for(g=0;g<t.Ca.bb.length;g++)t.Ca.bb[g].identifier+=
V.trunc(g/l)+1;for(g=0;g<f.length;g+=3)m=f[g],v=f[g+2],v[1]+=(h+1)*k,L.ye(a,m,t.id,v);for(g=0;g<r.length;g+=3)m=r[g+1],v=r[g+2],v[0]+=(h+1)*l,L.ye(a,t.id,m,v)}switch(d){case 1:t.Ca.type+="2";break;case 2:t.Ca.type+="3";break;case 3:t.Ca.type+="4"}L.uh(a,t.id);L.rm(a,t.id,t.Ca)}}function s(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==
b.data.value;default:return!1}}function B(a){var b=[];L.U(a,function(a,e){"GEOMETRY_VC"==e.type&&b.push(a,e)});for(var e=0;e<b.length;e+=2){for(var c=b[e],d=b[e+1],f=!1,l=[],h=[],t=[[],[],[]],k=L.rh(a,c),g=0;g<k;g++){var m=L.eh(a,c,g);if("SEPRGB"!=L.$a(a,m).type){f=!1;break}l.push(c,m);for(var v={},r=L.rh(a,m),f=0;f<r;f++){var E=L.eh(a,m,f);E in v||(v[E]=0);var n=L.dh(a,m,E,v[E]++);l.push(m,E);t[n[0]].push(c,E,n)}h.push(m);f=!0}if(f){for(g=c=k=0;g<t.length;g++)t[g].length&&(k++,c|=1<<2-g);if(k){d.type+=
k;d.bb=[];for(g=0;g<t.length;g++)if(t[g].length)for(d.bb.push({Gb:0,identifier:"RGB"[g],ae:!0,name:"RGB"[g]}),f=0;f<t[g].length;f+=3)t[g][f+2][0]=V.nj(c,g);for(g=0;g<l.length;g+=2)L.th(a,l[g],l[g+1],0);for(g=0;g<h.length;g++)L.uh(a,h[g]);for(g=0;g<t.length;g++)for(f=0;f<t[g].length;f+=3)L.ye(a,t[g][f],t[g][f+1],t[g][f+2])}}}}function u(a,b,e,c){a=a.nodes;for(var d=null,f=0;f<a.length;f++){var l=a[f];l.type==e&&(d=l)}return d?n(d,b)[0]:(Z.error('No "'+e+'" node in node '+c),-1)}function H(a,b,e,c){return{name:a,
type:b,inputs:e,outputs:c}}function A(a,b,c,d){var l=b.name,g=b.type,k=[],m=[],r=[],n=[],C=null,s=[];switch(g){case "CAMERA":m=[];r=e(b);break;case "COMBRGB":case "COMBHSV":m=E(b);r=e(b);break;case "GEOMETRY":a:{for(var g=b.outputs,p=0;p<g.length;p++)if(g[p].is_linked){g=!0;break a}g=!1}if(!g)return!0;g=z(b,c);if(!g)return Z.error("Geometry output is not supported"),!1;switch(g){case "GEOMETRY_UV":if(!b.uv_layer)return Z.error('Missing uv layer in node "',b.name,'"'),!1;C=h("param_GEOMETRY_UV_a");
p=h("param_GEOMETRY_UV_v");k.push(t(C));k.push(t(p));r.push(I(b,"UV"));n.push(t(p));C={name:C,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return Z.error("Missing vertex color layer in node ",b.name),!1;C=h("param_GEOMETRY_VC_a");p=h("param_GEOMETRY_VC_v");k.push(t(C));k.push(t(p));r.push(I(b,"Vertex Color"));n.push(t(p));C={name:C,value:b.color_layer};break;case "GEOMETRY_NO":r.push(I(b,"Normal"));break;case "GEOMETRY_FB":r.push(I(b,"Front/Back"));break;case "GEOMETRY_VW":r.push(I(b,
"View"));break;case "GEOMETRY_GL":r.push(I(b,"Global"))}break;case "GROUP":p=b.node_tree_name;switch(p){case "B4W_LINEAR_TO_SRGB":if(!x(b,[1],[1])){C=f(b);break}g="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!x(b,[1],[1])){C=f(b);break}g="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!x(b,[1],[1])){C=f(b);break}g="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!x(b,[1,1],[1])){C=f(b);break}g="B4W_REFLECT";break;case "B4W_REFRACTION":if(!x(b,[1,0],[1])){C=f(b);
break}g="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!x(b,[1,1,0,0,0],[1])){C=f(b);break}g="B4W_PARALLAX";if(!b.inputs[1].is_linked)return Z.error('Missing texture in node "',b.name,'"'),!1;var y=h("temp_texture");n.push(t(y));break;case "B4W_CLAMP":if(!x(b,[1],[1])){C=f(b);break}g="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!x(b,[0,0,0,0,0],[0])){C=f(b);break}g="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!x(b,[],[0])){C=f(b);break}g="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!x(b,[0,0,0],[0])){C=
f(b);break}g="B4W_SMOOTHSTEP";break;default:C=f(b)}m=E(b);r=e(b);"B4W_TRANSLUCENCY"==p&&(p=v("TranslucencyParams","TranslucencyParams",[0,0,0,0]),p.ae=r[0].ae,r.push(p));break;case "LAMP":C=b.lamp;if(!C)return Z.error("There is no lamp in node: "+b.name),!1;r.push(I(b,"Color"));r.push(I(b,"Light Vector"));r.push(I(b,"Distance"));r.push(I(b,"Visibility Factor"));C.uuid in T?n.push(t(h("param_LAMP_lamp_index"),T[C.uuid],1)):(T[C.uuid]=pa,n.push(t(h("param_LAMP_lamp_index"),pa++,1)));C=T;break;case "NORMAL":m=
E(b);r=e(b);p=I(b,"Normal");n.push(t(h("param_NORMAL_Normal"),p.Gb,3));break;case "MAPPING":p=b.vector_type;g="MAPPING";m.push(D(b,"Vector"));r.push(I(b,"Vector"));var y=b.rotation,u=b.scale,B=b.translation,F=ea.create(),N=V.hB(y),Q=new Float32Array([u[0],0,0,0,u[1],0,0,0,u[2]]);ea.multiply(N,Q,F);F=V.iD(F,ha.create());switch(p){case "POINT":F[12]=B[0];F[13]=B[1];F[14]=B[2];break;case "TEXTURE":F[12]=B[0];F[13]=B[1];F[14]=B[2];F=ha.invert(F,F);break;case "NORMAL":ha.invert(F,F),ha.transpose(F,F)}switch(p){case "NORMAL":s.push(["MAPPING_IS_NORMAL",
1]);case "TEXTURE":s.push(["MAPPING_TRS_MATRIX",X.K(F,16)]);break;case "POINT":0!==w.length(y)?s.push(["MAPPING_TRS_MATRIX",X.K(F,16)]):(0!==w.length(u)&&s.push(["MAPPING_SCALE",X.K(u,3)]),0!==w.length(B)&&s.push(["MAPPING_TRANSLATION",X.K(B,3)]));break;case "VECTOR":0!==w.length(y)?s.push(["MAPPING_TRS_MATRIX",X.K(F,16)]):0!==w.length(u)&&s.push(["MAPPING_SCALE",X.K(u,3)])}b.use_min&&s.push(["MAPPING_MIN_CLIP",X.K(b.min,3)]);b.use_max&&s.push(["MAPPING_MAX_CLIP",X.K(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":C=
D(b,"Color");C.Gb.splice(3);m.push(C);(C=D(b,"Alpha"))?m.push(C):m.push(v("Alpha","Alpha",1));C=D(b,"Spec");C.Gb.splice(3);m.push(C);p=D(b,"Normal");p.Gb.splice(3);m.push(p);r.push(I(b,"Color"));r.push(I(b,"Alpha"));r.push(I(b,"Normal"));"MATERIAL_EXT"==g&&((C=D(b,"Emit"))?m.push(C):m.push(v("Emit","Emit",0)),C=D(b,"Translucency"),C.Gb=0,C.name="Translucency",C.identifier="Translucency",C?m.push(C):m.push(v(C.name,C.identifier,C.Gb)),C=D(b,"Translucency"),C.Gb=[0,0,0,0],C.name="TranslucencyParams",
C.identifier="TranslucencyParams",C?m.push(C):m.push(v(C.name,C.identifier,C.Gb)),(C=D(b,"Ray Mirror"))?m.push(C):m.push(v("Ray Mirror","Ray Mirror",0)),(C=D(b,"SpecTra"))?m.push(C):m.push(v("SpecTra","SpecTra",0)),r.push(I(b,"Diffuse")),r.push(I(b,"Spec")));y=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":C=b.specular_hardness;break;case "WARDISO":C=b.specular_slope;break;case "TOON":C=b.specular_toon_size;y=b.specular_toon_smooth;break;default:Z.error("B4W Error: unsupported specular shader: "+
b.specular_shader+' (material "'+b.material_name+'")'),C=b.specular_hardness}switch(b.diffuse_shader){case "LAMBERT":B=u=0;break;case "OREN_NAYAR":u=b.roughness;B=0;break;case "FRESNEL":u=b.diffuse_fresnel;B=b.diffuse_fresnel_factor;break;default:Z.error("B4W Error: unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),B=u=0}n.push(t(h("param_MATERIAL_diffuse"),[u,B],2));n.push(t(h("param_MATERIAL_spec"),[b.specular_intensity,C,y],3));C={name:b.name,value:{aF:b.specular_shader,
WA:b.diffuse_shader,Ag:b.use_shadeless,Dh:b.specular_alpha}};p.ae&&s.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&s.push(["USE_MATERIAL_DIFFUSE",1]);b.use_specular&&s.push(["USE_MATERIAL_SPECULAR",1]);break;case "MATH":switch(b.operation){case "ADD":g="MATH_ADD";break;case "SUBTRACT":g="MATH_SUBTRACT";break;case "MULTIPLY":g="MATH_MULTIPLY";break;case "DIVIDE":g="MATH_DIVIDE";break;case "SINE":g="MATH_SINE";break;case "COSINE":g="MATH_COSINE";break;case "TANGENT":g="MATH_TANGENT";break;case "ARCSINE":g=
"MATH_ARCSINE";break;case "ARCCOSINE":g="MATH_ARCCOSINE";break;case "ARCTANGENT":g="MATH_ARCTANGENT";break;case "POWER":g="MATH_POWER";break;case "LOGARITHM":g="MATH_LOGARITHM";break;case "MINIMUM":g="MATH_MINIMUM";break;case "MAXIMUM":g="MATH_MAXIMUM";break;case "ROUND":g="MATH_ROUND";break;case "LESS_THAN":g="MATH_LESS_THAN";break;case "GREATER_THAN":g="MATH_GREATER_THAN";break;case "MODULO":g="MATH_MODULO";break;case "ABSOLUTE":g="MATH_ABSOLUTE";break;default:return Z.error("Unsupported MATH operation: "+
b.operation),!1}s.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);m=E(b);r=e(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":g="MIX_RGB_MIX";break;case "ADD":g="MIX_RGB_ADD";break;case "MULTIPLY":g="MIX_RGB_MULTIPLY";break;case "SUBTRACT":g="MIX_RGB_SUBTRACT";break;case "SCREEN":g="MIX_RGB_SCREEN";break;case "DIVIDE":g="MIX_RGB_DIVIDE";break;case "DIFFERENCE":g="MIX_RGB_DIFFERENCE";break;case "DARKEN":g="MIX_RGB_DARKEN";break;case "LIGHTEN":g="MIX_RGB_LIGHTEN";break;case "OVERLAY":g="MIX_RGB_OVERLAY";
break;case "DODGE":g="MIX_RGB_DODGE";break;case "BURN":g="MIX_RGB_BURN";break;case "HUE":g="MIX_RGB_HUE";break;case "SATURATION":g="MIX_RGB_SATURATION";break;case "VALUE":g="MIX_RGB_VALUE";break;case "COLOR":g="MIX_RGB_COLOR";break;case "SOFT_LIGHT":g="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":g="MIX_RGB_LINEAR_LIGHT";break;default:return Z.error("Unsupported MIX_RGB blend type: "+b.blend_type),!1}s.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);m=E(b);r=e(b);break;case "OUTPUT":m=E(b);r=[];
break;case "RGB":p=I(b,"Color");r.push(p);n.push(t(h("param_RGB_Color"),p.Gb,3));break;case "SEPRGB":case "SEPHSV":m=E(b);r=e(b);break;case "TEXTURE":if(!b.texture)return Z.error("No texture attached to node: "+b.name),!1;a:{g=b.outputs;C=!1;for(p=0;p<g.length;p++)if(y=g[p],y.is_linked)switch(y.identifier){case "Color":g="ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";break a;case "Normal":g="TEXTURE_NORMAL";break a;case "Value":C=!0;break;default:throw"Unknown texture output";
}g=C?"ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR":void 0}m.push(D(b,"Vector"));if("TEXTURE_COLOR"==g||"TEXTURE_ENVIRONMENT"==g)r.push(I(b,"Color")),r.push(I(b,"Value"));if("TEXTURE_NORMAL"==g){if("ENVIRONMENT_MAP"==b.texture.type)return Z.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),!1;r.push(I(b,"Normal"));r.push(I(b,"Value"))}y=h("param_TEXTURE_texture");n.push(t(y));C={name:y,value:b.texture};break;case "VALUE":a:if(d){if(g=d.action)for(p in N=g.d.Ja,N)if(N=
p.match(/"(.*?)"/)[1],N==b.name){y=g.name+"_"+p;break a}y=d.nla_tracks;for(u=0;u<y.length;u++)for(B=y[u].strips,F=0;F<y[u].strips.length;F++)for(p in g=B[F].action,N=g.d.Ja,N)if(N=p.match(/"(.*?)"/)[1],N==b.name){y=g.name+"_"+p;break a}y=void 0}else y=null;p=I(b,"Value");y?(g="ANIM_VALUE",u={name:h("param_ANIM_VALUE_Value"),value:"0"},n.push(u),u={name:"-1",value:y},n.push(u)):(g="VALUE",n.push(t(h("param_value_value"),p.Gb,1)));r.push(p);break;case "VECT_MATH":switch(b.operation){case "ADD":g="VECT_MATH_ADD";
break;case "SUBTRACT":g="VECT_MATH_SUBTRACT";break;case "AVERAGE":g="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":g="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":g="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":g="VECT_MATH_NORMALIZE";break;default:return Z.error("Unsupported VECT_MATH operation: "+b.operation),!1}m=E(b);r=e(b);break;default:m=E(b),r=e(b)}l={name:l,type:g,Aj:k,G:m,bb:r,Ja:n,data:C,ti:s};L.rm(a,L.Ts(a),l);if(l="GEOMETRY"==b.type)a:{l=b.outputs;for(m=k=0;m<l.length;m++)if(l[m].is_linked&&
k++>c){l=!0;break a}l=!1}return l&&!A(a,b,++c,d)?!1:!0}function x(a,b,e){for(var c=a.inputs,d=a.outputs,f=a.node_tree_name,l=0;l<b.length;l++){var h=c[l],g=b[l];if(!h||h.default_value instanceof Array!=g)return Z.warn('B4W Warning: Wrong inputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1}for(l=0;l<e.length;l++)if(b=d[l],c=e[l],!b||b.default_value instanceof Array!=c)return Z.warn('B4W Warning: Wrong outputs for custom node group "'+a.name+'" of type: "',
f,'".Processing as general node group.'),!1;return!0}function f(a){var b=a.node_group.node_tree,e={},c;for(c in b)if("links"==c||"nodes"==c){e[c]=[];for(var f=0;f<b[c].length;f++){e[c][f]={};for(var h in b[c][f])if("links"==c){e[c][f][h]={};for(var g in b[c][f][h])e[c][f][h][g]=F(b[c][f][h][g])}else e[c][f][h]=F(b[c][f][h])}}else e[c]=F(b[c]);b=a.node_tree_name;if("B4W_REPLACE"==b||"B4W_LEVELS_OF_QUALITY"==b)c=H("Group input","GROUP_INPUT",[],a.inputs),f=H("Group output","GROUP_OUTPUT",a.outputs,
[]),h=null,h="B4W_REPLACE"==b||"B4W_LEVELS_OF_QUALITY"==b&&(ma.quality==ca.sf||ma.yn)?{from_node:c,from_socket:c.outputs[1],to_node:f,to_socket:f.inputs[0]}:{from_node:c,from_socket:c.outputs[0],to_node:f,to_socket:f.inputs[0]},e.nodes=[c,f],e.links=[h];b=a.name;c=e.nodes;f=e.links;for(h=0;h<c.length;h++)c[h].name=l(c[h].type,b,c[h].name);for(h=0;h<f.length;h++)f[h].from_node.name=l(f[h].from_node.type,b,f[h].from_node.name),f[h].to_node.name=l(f[h].to_node.type,b,f[h].to_node.name);return{uD:d(e,
a.node_group.uuid,!0),vD:e.links}}function F(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?V.ni(a):a}function h(a){ba[a]||(ba[a]=0);var b=a+ba[a],b=b.replace(/ /g,"_").replace(/\//g,"_");ba[a]++;return b}function z(a,b){for(var e=a.outputs,c=0,d=0;d<e.length;d++){var f=e[d];if(f.is_linked&&!(c++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";
case "Global":return"GEOMETRY_GL";default:return null}}}function D(a,b){for(var e=a.inputs,c=0;c<e.length;c++){var d=e[c];if(d.identifier==b)return r(d)}return null}function I(a,b){for(var e=a.outputs,c=0;c<e.length;c++){var d=e[c];if(d.identifier==b)return r(d)}return null}function r(a){var b=a.name,e=a.identifier,c=a.is_linked;a=a.default_value;a=V.Xf(a)?a.slice(0):a;return{name:b,identifier:e,ae:c,Gb:a}}function v(a,b,e){return{name:a,identifier:b,ae:!1,Gb:e}}function E(a){for(var b=[],e=0;e<a.inputs.length;e++){var c=
r(a.inputs[e]);c.Gb.length&&c.Gb.splice(3);b.push(c)}return b}function e(a){for(var b=[],e=0;e<a.outputs.length;e++){var c=r(a.outputs[e]);b.push(c)}return b}function t(a,b,e){b=null===b||void 0===b?null:X.K(b,e);return{name:a,value:b}}function l(a,b,e){return"GROUP_INPUT"==a?b+"*GI*"+e:"GROUP_OUTPUT"==a?b+"*GO*"+e:b+"*"+e}function N(a){var b=[];L.U(a,function(a,e){"GROUP"==e.type&&b.push(e)});return b}function J(a,b,e){for(var c=0;c<e.length;c++){var d=e[c].data.uD,f=e[c].data.vD;if(!d)return!1;
L.U(d,function(b,e){L.rm(a,L.Ts(a),e)});for(d=0;d<f.length;d++)b.push(f[d]);S(e[c],b,a)}return!0}function C(a,b,e,c,d,f){switch(a.type){case "GROUP":a.name==b&&c.push(e);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||d.push(e);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(e)}}function R(a,b,e){for(var c=[],d=0;d<e.length;d++){for(var f=e[d],l=null,h=0;h<b.length;h++)if(f.from_socket.identifier==b[h].to_socket.identifier){l=b[h];break}l?(f.from_node=l.from_node,f.from_socket=l.from_socket):
c.push(f)}for(d=0;d<b.length;d++)a.splice(a.indexOf(b[d]),1);return c}function M(a,b){if(b.length)for(var e=b[0].from_node.name,c=0;c<a.length;c++)a[c].from_node.name==e&&b.push(a[c])}function P(a,b,e,c){for(var d=0;d<c.length;d++){for(var f=c[d],l,h=0;h<e.G.length;h++)if(f.from_socket.identifier==e.G[h].identifier){l=e.G[h].Gb;break}for(var h=f,g=b,t=l,k=n(h.to_node,g),m=0;m<k.length;m++)for(var v=L.$a(g,k[m]),r=0;r<v.G.length;r++)if(v.G[r].identifier==h.to_socket.identifier){v.G[r].Gb=t;break}f=
a.indexOf(f);-1!=f&&a.splice(f,1)}}function S(a,b,e){for(var c=a.name,d=[],f=[],l=[],h=[],g=0;g<b.length;g++){var t=b[g];C(t.from_node,c,t,d,l,h);C(t.to_node,c,t,f,l,h)}f=R(b,f,l);d=R(b,h,d);M(b,f);P(b,e,a,f);if(d.length){var k;L.U(e,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(c+"*GO*")||(k=b)});P(b,e,k,d)}}var Z=q("__print"),L=q("__graph"),X=q("__shaders"),V=q("__util"),ca=q("__config"),w=q("vec3");q("vec4");var ea=q("mat3"),ha=q("mat4"),ba={},Q={},T={},pa=0;new Float32Array(4);var ma=ca.p;
a.bA=d;a.cA=function(a){var b=[],e={};ba={};var c=L.Ap(a);L.U(c,function(a,c){var d;d=[];for(var f=[],l=[],g=[],t=[],k=[],m=0;m<c.G.length;m++){var r=c.G[m];if(r.ae)d.push(null),f.push(null);else{d.push(h("in_"+c.type+"_"+r.identifier));var v=X.K(r.Gb,0);ma.hw&&(0<=c.type.indexOf("MIX_RGB_")&&("Color1"==r.identifier||"Color2"==r.identifier||"Fac"==r.identifier)||0<=c.type.indexOf("MATH_")&&("Value"==r.identifier||"Value_001"==r.identifier)||0<=c.type.indexOf("VECT_MATH_")&&"Vector_001"==r.identifier)&&
(r=v,r=r.replace(/(,)/g,"$1 "),r=r.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),r=r.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),v=r=r.replace(/\s+/g,""));f.push(v)}}for(m=0;m<c.bb.length;m++)r=c.bb[m],r.ae?l.push(null):l.push(h("out_"+c.type+"_"+r.identifier));for(m=0;m<c.Ja.length;m++)r=c.Ja[m],g.push(r.name),t.push(r.value);for(m=0;m<c.Aj.length;m++)k.push(c.Aj[m].name);d={id:c.type,G:d,fu:f,bb:l,Ja:g,sl:t,Aj:k,ti:c.ti};b.push(d);e[a]=d});L.hf(c,function(a,
b,d){var f=L.$a(c,a);L.$a(c,b);var l=f.bb[d[0]];a=e[a].bb;b=e[b].G;f=a[d[0]]||h("out_"+f.type+"_"+l.identifier);a[d[0]]=f;b[d[1]]=f});return b};a.ba=function(){for(var a in Q)delete Q[a];for(var b in T)delete T[b];pa=0}};b4w.module.__shaders=function(a,q){function d(a,c,d){var e=a.Ff;"string"==typeof d&&(a=b(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==c){e[a][1]=d;return}e.push([c,d])}function b(a,b){for(var c=a.Ff,e=0;e<c.length;e++)if(c[e][0]==b)return c[e];return!1}function g(a,b){var c=a+b;if(z[c])return z[c];if(f){var e=f[b];if(!e)return null}else{e=A.tC(a+b);if(!e)return null;e=F.ev.parse(e)}return z[c]=e}function c(a,b,c,e){function d(b){b=b.a;for(var c=0;c<b.length;c++){var v=b[c];switch(v.type){case "condition":a:for(var v=
v.a,E=0;E<v.length;E++){var p=v[E];switch(p.type){case "if":case "elif":var u=p.c;try{var T=f(u)}catch(I){throw"Failed to process #"+p.type+" expression: "+u.join(" ");}if(T){d(p.group);break a}break;case "else":d(p.group);break a;case "ifdef":p.name in m&&d(p.group);break;case "ifndef":p.name in m||d(p.group)}}break;case "include":v=g(x.shaders_dir,x.NE+v.file);d(v);break;case "var":case "export":case "import":break;case "define":E=v.name;m[E]=v.b;v.Ja&&(s[E]=v.Ja);break;case "error":throw"Shader error: #error "+
v.b.join(" ");case "line":break;case "pragma":k.push("#pragma "+v.name+" "+v.b.join(" "));break;case "undef":v=v.name;delete m[v];delete s[v];break;case "warning":B.warn("Shader warning: #warning "+v.b.join(" "));break;case "extension":k.push("#extension "+n(v.b,m,s,!1));break;case "#":break;case "node":z[v.name]=v;break;case "nodes_global":v=e;for(E=0;E<v.length;E++)if(p=v[E],u=z[p.id])for(var q=0,R=0;R<u.k.length;R++){var H=u.k[R];"node_param"==H.type&&(H=H.qualifier.join(" ")+" ","vert"==a?H+=
p.Aj[q]:"frag"==a&&(H+=p.Ja[q],null!==p.sl[q]&&(H+=" = "+p.sl[q])),H+=";",k.push(H),q++)}break;case "nodes_main":v=e;for(E=0;E<v.length;E++)if(p=v[E],u=z[p.id]){q={};R={};for(H=0;H<p.ti.length;H++)R[p.ti[H][0]]=[p.ti[H][1]];F=A=D=0;for(var H=p,K=u.k,Z=q,oa=R,ja=0;ja<K.length;ja++){var fa=K[ja];switch(fa.type){case "node_in":var aa=H.G[D];if(null!==H.fu[D]){if(("MATERIAL"==H.id&&3===D||"MATERIAL_EXT"==H.id&&3===D)&&fa.e){D++;continue}var ia=fa.qualifier.join(" ")+" ",ia=ia+aa,ia=ia+(" = "+H.fu[D]),
ia=ia+";";k.push(ia)}Z[fa.name]=aa;D++;break;case "node_out":aa=H.bb[A];if(!fa.e||-1<y.indexOf(aa))ia=fa.qualifier.join(" ")+" ",ia+=aa,ia+=";",k.push(ia),Z[fa.name]=aa;-1<y.indexOf(aa)&&(oa["USE_OUT_"+fa.name]=[1]);A++;break;case "node_param":"vert"==a?aa=H.Aj[F]:"frag"==a&&(aa=H.Ja[F]),Z[fa.name]=aa,F++}}h(p,u.f,q,R)}break;case "textline":k.push(n(v.b,m,s,!1));break;default:throw"Unknown element type: "+v.type;}}}function f(a,b){var e=n(a,m,s,!0,b);return H.ev.parse(e)}function h(a,b,e,c){for(var d=
0;d<b.length;d++){var g=b[d];switch(g.type){case "node_condition":a:for(var t=a,g=g.a,v=e,r=c,E=0;E<g.length;E++){var p=g[E];switch(p.type){case "node_if":case "node_elif":var z=p.c;try{var y=f(z,r)}catch(u){throw"Failed to process #"+p.type+" expression: "+z.join(" ");}if(y){h(t,p.f,v,r);break a}break;case "node_else":h(t,p.f,v,r);break a;case "node_ifdef":(p.name in m||p.name in r)&&h(t,p.f,v,r);break;case "node_ifndef":p.name in m||p.name in r||h(t,p.f,v,r)}}break;case "textline":t=[];for(v=0;v<
g.b.length;v++)r=g.b[v],r in e?t.push(e[r]):t.push(r);k.push(n(t,m,s,!0,c))}}}for(var k=[],m={},p=0;p<c.length;p++)m[c[p][0]]=[c[p][1]];for(p=0;p<e.length;p++)m["USE_NODE_"+e[p].id]=[1];var s={},z={},y=[];for(p in e)for(var u in e[p].G)y.push(e[p].G[u]);d(b);var D=0,A=0,F=0;return k.join("\n")}function n(a,b,c,e,d){var f=[];p(a,b,c,e,f,d);return f.join(" ")}function p(a,b,c,e,d,f){for(var h=0;h<a.length;h++){var g=a[h];g in b||f&&g in f?(g=f&&f[g]||b[g],0==g.length&&e?d.push(0):p(g,b,c,e,d,f)):d.push(g)}}
function k(a,b,c,e){e=a.createShader(e);a.shaderSource(e,c);a.compileShader(e);u.Vz(e,b,c);return e}function y(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return m(a);case 2:return"vec2("+m(a[0])+","+m(a[1])+")";case 3:return"vec3("+m(a[0])+","+m(a[1])+","+m(a[2])+")";case 4:return"vec4("+m(a[0])+","+m(a[1])+","+m(a[2])+","+m(a[3])+")";case 9:return"mat3("+m(a[0])+","+m(a[1])+","+m(a[2])+","+m(a[3])+","+m(a[4])+","+m(a[5])+","+m(a[6])+","+m(a[7])+","+m(a[8])+")";case 16:return"mat4("+m(a[0])+
","+m(a[1])+","+m(a[2])+","+m(a[3])+","+m(a[4])+","+m(a[5])+","+m(a[6])+","+m(a[7])+","+m(a[8])+","+m(a[9])+","+m(a[10])+","+m(a[11])+","+m(a[12])+","+m(a[13])+","+m(a[14])+","+m(a[15])+")";default:throw"Wrong glsl value dimension";}}function m(a){return a%1?String(a):String(a)+".0"}var s=q("__config"),B=q("__print"),u=q("__debug"),H=q("__gpp_eval"),A=q("__assets");q("__util");var x=s.dc;if(b4w.module_check("shader_texts"))var f=q("shader_texts"),F=null;else f=null,F=q("__gpp_parser");var h={},z=
{},D=[],I=null;a.xc=function(a){I=a};a.H=d;a.eC=b;a.wK=function(a,b){for(var c=a.Ff,e=0;e<c.length;e++)if(c[e][0]==b&&1==c[e][1])return!0;return!1};a.tE=function(a){a.Ff=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE USE_REFRACTION SHORE_SMOOTHING SKINNED SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
c=0;c<b.length;c++){var e=b[c],f;switch(e){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_LIGHTS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "USE_REFRACTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":f=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":f=1;break;case "SHADOW_TEX_RES":f=y(2048);break;case "AA_METHOD":f="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":f="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":f="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":f="POST_EFFECT_NONE";break;case "SHADOW_SRC":f="SHADOW_SRC_NONE";break;case "SHADOW_DST":f=
"SHADOW_DST_NONE";break;case "SSAO_QUALITY":f="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":f="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":f="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":f=s.p.precision;break;case "EPSILON":f="highp"==s.p.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":f="u_va_frame_factor";break;default:B.error("Unknown directive ("+a.Zl+", "+a.Ak+"): "+e)}d(a,e,f)}};a.gK=function(a){return a.Zl};a.lt=function(a){return a.Ak};a.MC=function(a,c){for(var f=
c.Ff,e=0;e<f.length;e++){var h=f[e][0],l=f[e][1];b(a,h)&&d(a,h,l)}};a.YB=function(a,b){var d=JSON.stringify(a)+JSON.stringify(b),e=h[d];if(e)return e;var f=a.Ak,e=g(x.shaders_dir,a.Zl),f=g(x.shaders_dir,f);if(!e||!f)return null;var l=a.Ff||[],m=c("vert",e,l,b),l=c("frag",f,l,b),e=I,n=k(e,d,m,e.VERTEX_SHADER),p=k(e,d,l,e.FRAGMENT_SHADER),f=e.createProgram();e.attachShader(f,n);e.attachShader(f,p);e.linkProgram(f);e.validateProgram(f);e.getProgramParameter(f,e.VALIDATE_STATUS)==e.wG&&B.error("B4W Error - shader program is not valid",
d);u.Wz(f,d,n,p,m,l);m={dx:n,BB:p,fj:f,attributes:{},vj:{},aj:[],Eo:{},Ow:[],Kb:a};n=e.getProgramParameter(f,e.ACTIVE_ATTRIBUTES);for(l=0;l<n;l++)p=e.getActiveAttrib(f,l).name,m.attributes[p]=e.getAttribLocation(f,p);n=e.getProgramParameter(f,e.ACTIVE_UNIFORMS);for(l=0;l<n;l++)p=e.getActiveUniform(f,l).name.split("[0]").join(""),m.vj[p]=e.getUniformLocation(f,p);return h[d]=e=m};a.LI=function(){return D};a.EJ=function(){return h};a.ba=function(){for(var a in h){var b=h[a];I.deleteProgram(b.fj);I.deleteShader(b.dx);
I.deleteShader(b.BB);delete h[a]}for(var c in z)delete z[c];for(var e in D)delete D[e]};a.MI=function(a){var b=a.Ff;B.log("Shader: "+a.Zl+" "+a.Ak+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)B.log("  "+b[a][0],b[a][1])};a.K=y;a.Fr=function(a,b){return b in a.vj?!0:!1};a.wC=function(a){return(I.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__debug=function(a,q){function d(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function b(a,b){typeof a!=typeof b&&p.ma("Structure assertion failed: incompatible types");for(var c in a)c in b||p.ma("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||p.ma("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&p.ma("Structure assertion failed: incompatible types for key "+c)}var g=
q("__extensions"),c=q("__print"),n=q("__textures"),p=q("__util"),k=null,y={},m=!1,s={},B=[],u=-1,H=null,A=!1;a.Jq={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.xc=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(y[a[d]]=d)}k=a};a.Tz=function(a){if(m){var b=k.getError();if(b!=k.NO_ERROR){if(b in y)throw"B4W Error: "+b+", gl."+y[b]+
" ("+a+")";throw"Unknown GL error: "+b+" ("+a+")";}}};a.Oz=function(){if(m)switch(k.checkFramebufferStatus(k.FRAMEBUFFER)){case k.FRAMEBUFFER_COMPLETE:break;case k.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:c.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case k.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:c.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case k.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:c.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case k.FRAMEBUFFER_UNSUPPORTED:c.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:c.error("B4W Error: FRAMEBUFFER CHECK FAILED")}};a.Cr=function(){if(-1!=u)return u;k.bindFramebuffer(k.FRAMEBUFFER,k.createFramebuffer());var a=n.ok("DEBUG",n.di);n.resize(a,1,1);k.framebufferTexture2D(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,a.Rb,a.Ua,0);k.checkFramebufferStatus(k.FRAMEBUFFER)!=k.FRAMEBUFFER_COMPLETE?(u=!0,c.warn("B4W warning: depth-only issue was found")):u=!1;k.bindFramebuffer(k.FRAMEBUFFER,
null);return u};a.Vz=function(a,b,h){if(m&&!k.getShaderParameter(a,k.COMPILE_STATUS))throw h=d(h),c.error("B4W Error: shader compilation failed:\n"+h+"\n"+k.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.Wz=function(a,b,h,n,p,s){if(m&&!k.getProgramParameter(a,k.LINK_STATUS)){var r=g.cC();r&&(p=r.getTranslatedShaderSource(h),s=r.getTranslatedShaderSource(n));p=d(p);s=d(s);c.error("B4W Error: shader linking failed:\n"+p+"\n\n\n"+s+"\n"+k.getProgramInfoLog(a)+" ("+
b+")");throw"Engine failed: see above for error messages";}};a.Zo=function(a){m=a};a.aJ=function(a){s[a]=a in s?s[a]+1:1};a.update=function(){for(var a in s)c.log(a,s[a]),s[a]=0};a.zk=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(p.Xf(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}B.push(a)};a.Fu=function(){for(var a=1,b=0;b<B.length;b++){var c=B[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],p.Xf(a))for(var d=
0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);B.push(c)};var x=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.kv=function(a){a||(a=1);for(var b=0,d={},g=Math.max(0,performance.now()-1E3*a),k=0;k<B.length;k++){var m=B[k];a=m[0];if(!(a<g)){var r=String(m[1]);d[r]||(d[r]=x[b++%x.length]);a=["%c"+(a/1E3).toFixed(6),d[r],r];for(r=2;r<m.length;r++)a.push(m[r]);c.log.apply(this,a)}}B.splice(0)};a.Go=function(a){a||(a=1);for(var b={},d=Math.max(0,performance.now()-
1E3*a),g=0;g<B.length;g++){var k=B[g];a=k[0];if(!(a<d))for(var m=2;m<k.length;m++){var r=String(k[1]);3<k.length&&(r+="_"+String(m-2));b[r]||(b[r]=r+"\n");b[r]+=String(a)+" "+k[m]+"\n"}}a="";for(r in b)a+=b[r]+"\n\n";c.log(a);B.splice(0)};a.nI=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&
b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.Dr=function(a){if(p.Xf(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.$H=function(a,b){typeof a!=b&&p.ma("Type assertion failed: value type is not a {"+b+"}:",a)};a.YH=b;a.ZH=function(a){A?b(a,H):A=!0;H=a}};b4w.module.__textures=function(a,q){function d(){return{name:"",type:0,source:"",width:0,height:0,Tm:1,Tj:!0,xg:1024,zs:!1,Md:null,gb:null,vh:null,Gv:1,ke:0,wh:!1,am:!1,Wf:!1,W:0,Fa:0,ah:0,TF:!1,yg:!1,uo:0,Zb:0,Rb:0,Ua:null,lf:null}}function b(b,e,c){var l=b.type,h=new Uint8Array([204,204,204,255]),k=d();switch(l){case "DATA_TEX2D":case "IMAGE":var m=r.createTexture(),n=r.TEXTURE_2D;r.bindTexture(n,m);r.texImage2D(n,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,h);b.image&&"MOVIE"==b.image.source&&(k.Wf=
!0,k.W=b.frame_start,k.Fa=b.frame_offset,k.ah=b.frame_duration,k.TF=b.use_auto_refresh,k.yg=b.use_cyclic,k.uo=b.movie_length,0!=k.Fa&&H.warn('Frame offset for texture "'+b.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":m=r.createTexture();n=r.TEXTURE_2D;r.bindTexture(n,m);if("NONE"==b.b4w_source_type)return null;if("SCENE"==b.b4w_source_type)if(b.b4w_source_id&&(c=f.Kc("name",b.b4w_source_id,c)))k.xg=b.b4w_source_size,c.ue=c.ue||[],c.ue.push(b),
r.texImage2D(n,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,h);else return null;break;case "ENVIRONMENT_MAP":m=r.createTexture();n=r.TEXTURE_CUBE_MAP;r.bindTexture(n,m);c="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var p=0;6>p;p++)r.texImage2D(r["TEXTURE_CUBE_MAP_"+c[p]],0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,h);break;case "VORONOI":case "BLEND":return null;default:return H.error('B4W warning: texture "'+b.name+'" has unsupported type "'+l+'"'),null}("NONE"!=l||b.b4w_enable_canvas_mipmapping&&
"CANVAS"==b.b4w_source_type)&&"DATA_TEX2D"!=l?r.texParameteri(n,r.TEXTURE_MIN_FILTER,v[F.Ql]):r.texParameteri(n,r.TEXTURE_MIN_FILTER,r.LINEAR);r.texParameteri(n,r.TEXTURE_MAG_FILTER,r.LINEAR);h=n;c=b.b4w_anisotropic_filtering;"DEFAULT"===c&&(c=e);"OFF"!==c&&F.Vj&&(e=x.TB())&&(c=parseFloat(c.split("x")[0]),r.texParameterf(h,e.TEXTURE_MAX_ANISOTROPY_EXT,c));"REPEAT"!=b.extension||b.b4w_shore_dist_map?(r.texParameteri(n,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(n,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)):
(r.texParameteri(n,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(n,r.TEXTURE_WRAP_T,r.REPEAT));k.type=a.Kg;k.width=1;k.height=1;k.Ua=m;k.Rb=n;"CANVAS"==b.b4w_source_type&&"NONE"==l?(l=b.b4w_source_id,m=b.b4w_source_size,k.zs=b.b4w_enable_canvas_mipmapping,k.name=l,k.source="CANVAS",n=document.createElement("canvas"),n.setAttribute("id",l),n.width=m,n.height=m,k.Md=n.getContext("2d"),D[l]=k,g(k)):"SCENE"==b.b4w_source_type&&"NONE"==l?(k.name=b.b4w_source_id,k.source="SCENE"):(k.name=b.name,k.source=l,
r.generateMipmap(n),r.bindTexture(n,null));return b.d=k}function g(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Rb;r.bindTexture(b,a.Ua);var c=k(a),d=y(a),f=a.Md.canvas;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0);r.texImage2D(b,0,c,c,d,f);r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1);a.zs&&r.generateMipmap(b);r.bindTexture(b,null);a.width=f.width;a.height=f.height}function c(a){var b=a.Rb;r.bindTexture(b,a.Ua);r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0);r.texImage2D(b,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,a.vh[a.ke]);
r.bindTexture(b,null)}function n(a){r.texParameteri(a,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(a,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);r.texParameteri(a,r.TEXTURE_MAG_FILTER,r.LINEAR);r.texParameteri(a,r.TEXTURE_MIN_FILTER,r.LINEAR)}function p(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function k(b){switch(b.type){case a.Kg:b=r.RGBA;break;case a.im:b=r.RGB;break;case a.Pj:b=r.RGBA;break;case a.Qj:b=r.RGB;break;case a.di:b=r.DEPTH_COMPONENT;
break;default:throw"Wrong texture type";}return b}function y(b){switch(b.type){case a.Kg:b=r.UNSIGNED_BYTE;break;case a.im:b=r.UNSIGNED_BYTE;break;case a.Pj:b=r.FLOAT;break;case a.Qj:b=r.FLOAT;break;case a.di:b=r.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function m(a){return a in I?(F.Xc?I[a].wh=!0:I[a].gb.play(),!0):null}function s(a){return a in I?(a=I[a],F.Xc?(a.ke=a.Fa,c(a),a.ke++):a.gb.currentTime=a.Fa/a.Zb,!0):null}function B(a){return a in I?(F.Xc?I[a].wh=!1:I[a].gb.pause(),
!0):null}var u=q("__config"),H=q("__print"),A=q("__dds"),x=q("__extensions"),f=q("__util"),F=u.p,h=u.Hd,z=u.me;a.Ed=0;a.C=0;a.Hy=0;a.Fy=0;a.Gy=0;a.Ey=0;a.Kg=10;a.im=20;a.Pj=30;a.Qj=40;a.di=50;a.Jg=60;var D={},I={},r=null,v;a.xc=function(b){v=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.Ed=b.NEAREST;a.C=b.LINEAR;a.Hy=b.NEAREST_MIPMAP_NEAREST;a.Fy=b.LINEAR_MIPMAP_NEAREST;a.Gy=b.NEAREST_MIPMAP_LINEAR;a.Ey=b.LINEAR_MIPMAP_LINEAR;r=b};a.BJ=function(a){return a in
D?D[a].Md:null};a.yM=function(a){return a in D?(g(D[a]),!0):!1};a.ok=function(b,e){var c=d();c.name=b;c.type=e;c.source="NONE";if(e==a.Jg)c.lf=r.createRenderbuffer();else{var f=r.TEXTURE_2D,h=r.createTexture();r.bindTexture(f,h);r.texParameteri(f,r.TEXTURE_MAG_FILTER,r.LINEAR);r.texParameteri(f,r.TEXTURE_MIN_FILTER,r.LINEAR);r.texParameteri(f,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(f,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);r.bindTexture(f,null);c.Rb=f;c.Ua=h}return c};a.oA=function(b){var e=r.createTexture(),
c=r.TEXTURE_CUBE_MAP;r.bindTexture(c,e);r.texParameteri(c,r.TEXTURE_MAG_FILTER,r.LINEAR);r.texParameteri(c,r.TEXTURE_MIN_FILTER,r.LINEAR);r.texParameteri(c,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(c,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),h=0;6>h;h++)r.texImage2D(r[f[h]],0,r.RGBA,b,b,0,r.RGBA,r.UNSIGNED_BYTE,
null);r.bindTexture(c,null);c=d();c.name="CUBEMAP";c.type=a.Kg;c.source="NONE";c.width=3*b;c.height=2*b;c.Tm=1;c.Ua=e;c.Rb=r.TEXTURE_CUBE_MAP;return c};a.ap=function(b,e,c){if(b.type!=a.Jg){var d=b.Rb;r.bindTexture(d,b.Ua);e&&r.texParameteri(d,r.TEXTURE_MIN_FILTER,e);c&&r.texParameteri(d,r.TEXTURE_MAG_FILTER,c);r.bindTexture(d,null)}};a.JJ=function(b){if(b.type==a.Jg)return{min:a.Ed,dD:a.Ed};var e=b.Rb;r.bindTexture(e,b.Ua);b=r.getTexParameter(e,r.TEXTURE_MIN_FILTER);var c=r.getTexParameter(e,r.TEXTURE_MAG_FILTER);
r.bindTexture(e,null);return{min:b,dD:c}};a.resize=function(b,e,c){e=Math.max(e,1);c=Math.max(c,1);if(b.width!=e||b.height!=c){if(b.type==a.Jg)r.bindRenderbuffer(r.RENDERBUFFER,b.lf),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e,c),r.bindRenderbuffer(r.RENDERBUFFER,null);else{var d=b.Rb;r.bindTexture(d,b.Ua);var f=k(b),h=y(b);r.texImage2D(d,0,f,e,c,0,f,h,null);r.bindTexture(d,null)}e>F.nd||c>F.nd?H.error('B4W warning: Slink texture "'+b.name+'" has unsupported size'):(b.width=e,b.height=
c)}};a.IA=b;a.RF=function(a){var b=a.Rb;r.bindTexture(b,a.Ua);r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0);4!=a.gb.length?r.texImage2D(b,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,a.gb):r.texImage2D(b,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,a.gb);r.bindTexture(b,null)};a.NF=c;a.xj=function(a,b,c,d){var f=a.source,g=a.Rb;r.bindTexture(g,a.Ua);if(4==b.length){var k=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==f)if(k)r.texImage2D(g,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,b),a.width=1,a.height=
1;else if(c){c=A.Mt(b);if(c.width>F.nd||c.height>F.nd){H.error("B4W warning: texture has unsupported size",d);return}A.SF(r,x.zt(),b,!0);p(c.width,c.height)&&(a.mr||H.warn("B4W warning: using NPOT texture",d),n(g));a.width=c.width;a.height=c.height;a.Tm=A.ZB(b)}else{r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>F.nd||b.height>F.nd){H.error("B4W warning: texture has unsupported size",d);return}a.Wf?F.Xc?b&&(I[a.name]=a,a.vh=b,a.Zb=a.uo/b.length,a.ah=Math.round(a.ah/a.Zb),a.Fa=Math.round(a.Fa/
a.Zb),a.W=Math.round(a.W/a.Zb),a.ke=a.Fa,r.texImage2D(g,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,a.vh[0])):(a.gb=b,a.gb.loop=a.yg,b&&(I[a.name]=a),a.Zb=h.Ia,b.duration&&(a.Zb=a.uo/b.duration),z.ws||(b.playbackRate=h.Ia/a.Zb,z.Ir&&2<b.playbackRate&&(b.playbackRate=2)),r.texImage2D(g,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,a.gb)):r.texImage2D(g,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,b);F.Xc&&a.Wf?(a.width=b[0].width,a.height=b[0].height):(a.width=b.width,a.height=b.height);p(b.width,b.height)?(a.mr||(a.Wf?H.warn("B4W warning: using NPOT video texture",
d):H.warn("B4W warning: using NPOT texture",d)),n(g)):a.Wf||r.generateMipmap(g)}else if("ENVIRONMENT_MAP"==f)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],k){for(k=0;6>k;k++)f=c[k],r.texImage2D(r["TEXTURE_CUBE_MAP_"+f[0]],0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1);var m=b.width/3;if(m>F.po||m>F.po){H.error("B4W warning: cubemap has unsupported size",d);return}for(k=
0;6>k;k++){var f=c[k],v=document.createElement("canvas");v.width=m;v.height=m;var s=v.getContext("2d");"POSITIVE_Y"==f[0]||"NEGATIVE_Y"==f[0]?(s.translate(0,m),s.scale(1,-1)):(s.translate(m,0),s.scale(-1,1));s.drawImage(b,f[1]*m,f[2]*m,m,m,0,0,m,m);r.texImage2D(r["TEXTURE_CUBE_MAP_"+f[0]],0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,v)}a.width=3*m;a.height=2*m;p(b.width/3,b.height/2)?(H.warn("B4W warning: using NPOT cube map texture",d),n(g)):r.generateMipmap(g)}else"DATA_TEX2D"==f&&(r.texImage2D(g,0,r.RGBA,b.width,
b.height,0,r.RGBA,r.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);r.bindTexture(g,null)};a.UA=function(a){r.deleteTexture(a)};a.Qi=function(a){return a&&a.name&&(a.Ua||a.lf)?!0:!1};a.lu=function(a){return a&&a.name&&a.lf?!0:!1};a.xK=function(b){return b.type==a.Pj||b.type==a.Qj?!0:!1};a.uC=function(b){var e=0;switch(b.type){case a.Kg:case a.im:e=4;break;case a.Pj:case a.Qj:e=16;break;case a.di:e=3;break;case a.Jg:e=2}return e};a.NB=function(a){var e=null,e={name:"special_ssao_texture",
type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};b(e,null,a);e.image={filepath:null};return e};a.ba=function(){D={};I={}};a.GD=m;a.cE=s;a.CD=B;a.pause=function(){for(var a in I)F.Xc&&!I[a].wh||!F.Xc&&I[a].gb.paused||(B(a),I[a].am=!0)};a.reset=function(){for(var a in I)s(a),I[a].am=!1};a.play=function(a){for(var b in I)if(!a||I[b].am)m(b),I[b].am=!1}};b4w.module.__dds=function(a,q){function d(a,b,c,d){var g=new Uint16Array(4),k=new Uint16Array(c*d),f=0,m=0,h=0,n=m=f=0,p=0,y=0,r=0,v=c/4;d/=4;for(var E=0;E<d;E++)for(var e=0;e<v;e++)h=b+4*(E*v+e),g[0]=a[h],g[1]=a[h+1],f=g[0]&31,m=g[0]&2016,n=g[0]&63488,p=g[1]&31,y=g[1]&2016,r=g[1]&63488,g[2]=5*f+3*p>>3|5*m+3*y>>3&2016|5*n+3*r>>3&63488,g[3]=5*p+3*f>>3|5*y+3*m>>3&2016|5*r+3*n>>3&63488,f=a[h+2],m=4*E*c+4*e,k[m]=g[f&3],k[m+1]=g[f>>2&3],k[m+2]=g[f>>4&3],k[m+3]=g[f>>6&3],m+=c,k[m]=g[f>>8&3],k[m+1]=g[f>>
10&3],k[m+2]=g[f>>12&3],k[m+3]=g[f>>14],f=a[h+3],m+=c,k[m]=g[f&3],k[m+1]=g[f>>2&3],k[m+2]=g[f>>4&3],k[m+3]=g[f>>6&3],m+=c,k[m]=g[f>>8&3],k[m+1]=g[f>>10&3],k[m+2]=g[f>>12&3],k[m+3]=g[f>>14];return k}function b(a,b,c,g){var A=new Int32Array(c,0,31),x,f,F,h,z,D;if(542327876!=A[0])return p.error("Invalid magic number in DDS header"),0;if(!A[20]&4)return p.error("Unsupported format, must contain a FourCC code"),0;x=A[21];switch(x){case k:f=8;F=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case y:f=16;F=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case m:f=16;F=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return p.error("Unsupported FourCC code:",n(x)),null}D=1;A[2]&131072&&!1!==g&&(D=Math.max(1,A[7]));h=A[4];z=A[3];A=A[1]+4;if(b)for(x=0;x<D;++x)g=Math.max(4,h)/4*Math.max(4,z)/4*f,b=new Uint8Array(c,A,g),a.compressedTexImage2D(a.TEXTURE_2D,x,F,h,z,0,b),A+=g,h=Math.max(.5*h,1),z=Math.max(.5*z,1);else if(x==k)Math.max(4,h),Math.max(4,z),b=new Uint16Array(c),c=d(b,A/2,h,z),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,h,z,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,c),g&&a.generateMipmap(a.TEXTURE_2D);else return p.error("No manual decoder for",n(x),"and no native support"),0;return D}function g(a,c,d,g,k,m){var f=new XMLHttpRequest;f.open("GET",d,!0);f.responseType="arraybuffer";f.onload=function(){if(200==f.status){a.bindTexture(a.TEXTURE_2D,g);var d=b(a,c,f.response,k);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}m&&
m(g)};f.send(null);return g}function c(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function n(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var p=q("__print"),k=c("DXT1"),y=c("DXT3"),m=c("DXT5");a.XI=d;a.SF=b;a.Mt=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.ZB=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case k:b=6;break;case y:case m:b=4;break;default:p.error("Unsupported FourCC code:",n(a))}return b};
a.MK=g;a.LK=function(a,b,c,d){var k=a.createTexture();g(a,b,c,k,!0,d);return k}};b4w.module.__gpp_eval=function(a){a.ev=function(){function a(d,b,g,c,n,p){this.message=d;this.offset=c;this.Si=n;this.Qg=p;this.name="SyntaxError"}(function(a,b){function g(){this.constructor=a}g.prototype=b.prototype;a.prototype=new g})(a,Error);return{SyntaxError:a,parse:function(d){function b(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function g(a){if(db!==a){db>a&&(db=0,Za={Si:1,Qg:1,pj:!1});var b=Za,e,c;for(e=
db;e<a;e++)c=d.charAt(e),"\n"===c?(b.pj||b.Si++,b.Qg=1,b.pj=!1):"\r"===c||"\u2028"===c||"\u2029"===c?(b.Si++,b.Qg=1,b.pj=!0):(b.Qg++,b.pj=!1);db=a}return Za}function c(a){G<$a||(G>$a&&($a=G,na=[]),na.push(a))}function n(){var a,b,e;a=G;b=L();b!==w?(b=p(),b!==w?(e=L(),e!==w?(W++,10===d.charCodeAt(G)?(e=kc,G++):(e=w,0===W&&c(Ua)),e===w&&(d.substr(G,2)===lc?(e=lc,G+=2):(e=w,0===W&&c(Ob)),e===w&&(13===d.charCodeAt(G)?(e=bb,G++):(e=w,0===W&&c(ac)))),W--,e===w&&0===W&&c(jc),e===w&&(e=null),e!==w?a=b:(G=
a,a=w)):(G=a,a=w)):(G=a,a=w)):(G=a,a=w);return a}function p(){var a,b,e,f,l,h,g,m;a=G;b=k();if(b!==w){e=[];f=G;l=L();l!==w?(44===d.charCodeAt(G)?(h=ba,G++):(h=w,0===W&&c(Q)),h!==w?(g=L(),g!==w?(m=k(),m!==w?f=l=[l,h,g,m]:(G=f,f=w)):(G=f,f=w)):(G=f,f=w)):(G=f,f=w);for(;f!==w;)e.push(f),f=G,l=L(),l!==w?(44===d.charCodeAt(G)?(h=ba,G++):(h=w,0===W&&c(Q)),h!==w?(g=L(),g!==w?(m=k(),m!==w?f=l=[l,h,g,m]:(G=f,f=w)):(G=f,f=w)):(G=f,f=w)):(G=f,f=w);e!==w?a=b=0==e.length?b:e[e.length-1]:(G=a,a=w)}else G=a,a=w;
return a}function k(){var a,b,e,f;a=G;b=y();b!==w?(e=L(),e!==w?(63===d.charCodeAt(G)?(e=T,G++):(e=w,0===W&&c(pa)),e!==w?(e=L(),e!==w?(e=p(),e!==w?(f=L(),f!==w?(58===d.charCodeAt(G)?(f=ma,G++):(f=w,0===W&&c(U)),f!==w?(f=L(),f!==w?(f=p(),f!==w?a=b?e:f:(G=a,a=w)):(G=a,a=w)):(G=a,a=w)):(G=a,a=w)):(G=a,a=w)):(G=a,a=w)):(G=a,a=w)):(G=a,a=w)):(G=a,a=w);a===w&&(a=y());return a}function y(){var a,b,e,c,d,f,l,h;a=G;b=m();if(b!==w){e=[];c=G;d=L();d!==w?(f=Z(),f!==w?(l=L(),l!==w?(h=m(),h!==w?c=d=[d,f,l,h]:(G=
c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);for(;c!==w;)e.push(c),c=G,d=L(),d!==w?(f=Z(),f!==w?(l=L(),l!==w?(h=m(),h!==w?c=d=[d,f,l,h]:(G=c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);if(e!==w)for(a=b,b=0;b<e.length;b++)a=a||e[b][3];else G=a,a=w}else G=a,a=w;return a}function m(){var a,b,e,c,d,f,l,h;a=G;b=s();if(b!==w){e=[];c=G;d=L();d!==w?(f=S(),f!==w?(l=L(),l!==w?(h=s(),h!==w?c=d=[d,f,l,h]:(G=c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);for(;c!==w;)e.push(c),c=G,d=L(),d!==w?(f=S(),f!==w?(l=L(),l!==w?(h=s(),h!==
w?c=d=[d,f,l,h]:(G=c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);if(e!==w)for(a=b,b=0;b<e.length;b++)a=a&&e[b][3];else G=a,a=w}else G=a,a=w;return a}function s(){var a,b,e,c,d,f,l,h;a=G;b=B();if(b!==w){e=[];c=G;d=L();d!==w?(f=P(),f!==w?(l=L(),l!==w?(h=B(),h!==w?c=d=[d,f,l,h]:(G=c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);for(;c!==w;)e.push(c),c=G,d=L(),d!==w?(f=P(),f!==w?(l=L(),l!==w?(h=B(),h!==w?c=d=[d,f,l,h]:(G=c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);if(e!==w)for(a=b,b=0;b<e.length;b++)a|=e[b][3];else G=
a,a=w}else G=a,a=w;return a}function B(){var a,b,e,c,d,f,l,h;a=G;b=u();if(b!==w){e=[];c=G;d=L();d!==w?(f=M(),f!==w?(l=L(),l!==w?(h=u(),h!==w?c=d=[d,f,l,h]:(G=c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);for(;c!==w;)e.push(c),c=G,d=L(),d!==w?(f=M(),f!==w?(l=L(),l!==w?(h=u(),h!==w?c=d=[d,f,l,h]:(G=c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);if(e!==w)for(a=b,b=0;b<e.length;b++)a^=e[b][3];else G=a,a=w}else G=a,a=w;return a}function u(){var a,b,e,c,d,f,l,h;a=G;b=H();if(b!==w){e=[];c=G;d=L();d!==w?(f=R(),f!==w?
(l=L(),l!==w?(h=H(),h!==w?c=d=[d,f,l,h]:(G=c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);for(;c!==w;)e.push(c),c=G,d=L(),d!==w?(f=R(),f!==w?(l=L(),l!==w?(h=H(),h!==w?c=d=[d,f,l,h]:(G=c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);if(e!==w)for(a=b,b=0;b<e.length;b++)a&=e[b][3];else G=a,a=w}else G=a,a=w;return a}function H(){var a,b,e,c,d,f,l,h;a=G;b=A();if(b!==w){e=[];c=G;d=L();d!==w?(f=C(),f!==w?(l=L(),l!==w?(h=A(),h!==w?c=d=[d,f,l,h]:(G=c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);for(;c!==w;)e.push(c),c=G,d=L(),
d!==w?(f=C(),f!==w?(l=L(),l!==w?(h=A(),h!==w?c=d=[d,f,l,h]:(G=c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);if(e!==w)for(a=b,b=0;b<e.length;b++)switch(e[b][1]){case "==":a=a==e[b][3];break;case "!=":a=a!=e[b][3]}else G=a,a=w}else G=a,a=w;return a}function A(){var a,b,c,e,d,f,l,h;a=G;b=x();if(b!==w){c=[];e=G;d=L();d!==w?(f=J(),f!==w?(l=L(),l!==w?(h=x(),h!==w?e=d=[d,f,l,h]:(G=e,e=w)):(G=e,e=w)):(G=e,e=w)):(G=e,e=w);for(;e!==w;)c.push(e),e=G,d=L(),d!==w?(f=J(),f!==w?(l=L(),l!==w?(h=x(),h!==w?e=d=[d,f,l,h]:
(G=e,e=w)):(G=e,e=w)):(G=e,e=w)):(G=e,e=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else G=a,a=w}else G=a,a=w;return a}function x(){var a,b,e,c,d,l,h,g;a=G;b=f();if(b!==w){e=[];c=G;d=L();d!==w?(l=N(),l!==w?(h=L(),h!==w?(g=f(),g!==w?c=d=[d,l,h,g]:(G=c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);for(;c!==w;)e.push(c),c=G,d=L(),d!==w?(l=N(),l!==w?(h=L(),h!==w?(g=f(),g!==w?c=d=[d,l,h,g]:(G=c,
c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);if(e!==w)for(a=b,b=0;b<e.length;b++)switch(e[b][1]){case "<<":a<<=e[b][3];break;case ">>":a>>=e[b][3]}else G=a,a=w}else G=a,a=w;return a}function f(){var a,b,c,e,d,f,h,g;a=G;b=F();if(b!==w){c=[];e=G;d=L();d!==w?(f=l(),f!==w?(h=L(),h!==w?(g=F(),g!==w?e=d=[d,f,h,g]:(G=e,e=w)):(G=e,e=w)):(G=e,e=w)):(G=e,e=w);for(;e!==w;)c.push(e),e=G,d=L(),d!==w?(f=l(),f!==w?(h=L(),h!==w?(g=F(),g!==w?e=d=[d,f,h,g]:(G=e,e=w)):(G=e,e=w)):(G=e,e=w)):(G=e,e=w);if(c!==w)for(a=b,b=0;b<
c.length;b++)switch(c[b][1]){case "+":a+=c[b][3];break;case "-":a-=c[b][3]}else G=a,a=w}else G=a,a=w;return a}function F(){var a,b,e,c,d,f,l,g;a=G;b=h();if(b!==w){e=[];c=G;d=L();d!==w?(f=t(),f!==w?(l=L(),l!==w?(g=h(),g!==w?c=d=[d,f,l,g]:(G=c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);for(;c!==w;)e.push(c),c=G,d=L(),d!==w?(f=t(),f!==w?(l=L(),l!==w?(g=h(),g!==w?c=d=[d,f,l,g]:(G=c,c=w)):(G=c,c=w)):(G=c,c=w)):(G=c,c=w);if(e!==w)for(a=b,b=0;b<e.length;b++)switch(e[b][1]){case "*":a*=e[b][3];break;case "/":a=
Math.floor(a/e[b][3]);break;case "%":a%=e[b][3]}else G=a,a=w}else G=a,a=w;return a}function h(){var a,e,f;a=G;d.substr(G,7)===Y?(e=Y,G+=7):(e=w,0===W&&c(K));e!==w?(f=L(),f!==w?(f=D(),f!==w?a=f:(G=a,a=w)):(G=a,a=w)):(G=a,a=w);if(a===w){a=G;e=z();if(e!==w)if(f=L(),f!==w)if(d.substr(G,2)===Aa?(f=Aa,G+=2):(f=w,0===W&&c(Ia)),f===w&&(d.substr(G,2)===sa?(f=sa,G+=2):(f=w,0===W&&c(Ga))),f!==w){a:{a=e;switch(f){case "++":e=++a;break a;case "--":e=--a;break a}e=void 0}a=e}else G=a,a=w;else G=a,a=w;else G=a,
a=w;a===w&&(a=z());a===w&&(a=G,d.substr(G,2)===Aa?(e=Aa,G+=2):(e=w,0===W&&c(Ia)),e===w&&(d.substr(G,2)===sa?(e=sa,G+=2):(e=w,0===W&&c(Ga)),e===w&&(43===d.charCodeAt(G)?(e=Na,G++):(e=w,0===W&&c(mb)),e===w&&(45===d.charCodeAt(G)?(e=Jb,G++):(e=w,0===W&&c(ob)),e===w&&(126===d.charCodeAt(G)?(e=Tb,G++):(e=w,0===W&&c(cb)),e===w&&(33===d.charCodeAt(G)?(e=bc,G++):(e=w,0===W&&c(nc))))))),e!==w?(f=L(),f!==w?(f=h(),f!==w?a=e=b(e,f):(G=a,a=w)):(G=a,a=w)):(G=a,a=w))}return a}function z(){var a,b,e;W++;var f;a=
G;48===d.charCodeAt(G)?(b=ia,G++):(b=w,0===W&&c(O));if(b!==w)if(za.test(d.charAt(G))?(b=d.charAt(G),G++):(b=w,0===W&&c(Xa)),b!==w){b=G;e=[];f=r();if(f!==w)for(;f!==w;)e.push(f),f=r();else e=w;b=e!==w?d.substring(b,G):e;b!==w?a=b=parseInt("0x"+b):(G=a,a=w)}else G=a,a=w;else G=a,a=w;if(a===w){a=G;48===d.charCodeAt(G)?(b=ia,G++):(b=w,0===W&&c(O));if(b===w)if(b=G,Ma.test(d.charAt(G))?(e=d.charAt(G),G++):(e=w,0===W&&c(ta)),e!==w){var l;f=[];l=I();if(l!==w)for(;l!==w;)f.push(l),l=I();else f=w;f===w&&(f=
null);f!==w?b=e=[e,f]:(G=b,b=w)}else G=b,b=w;a=b!==w?d.substring(a,G):b;a!==w&&(a=parseInt(a))}W--;a===w&&0===W&&c(aa);a===w&&(b=v(),b!==w&&(b=0),a=b,a===w&&(a=G,40===d.charCodeAt(G)?(b=qa,G++):(b=w,0===W&&c(oa)),b!==w?(b=L(),b!==w?(b=p(),b!==w?(e=L(),e!==w?(41===d.charCodeAt(G)?(e=ja,G++):(e=w,0===W&&c(fa)),e!==w?a=b:(G=a,a=w)):(G=a,a=w)):(G=a,a=w)):(G=a,a=w)):(G=a,a=w)));return a}function D(){var a,b,e,f,l;b=v();b!==w&&(b=0);a=b;if(a===w){b=[];f=e=G;W++;40===d.charCodeAt(G)?(l=qa,G++):(l=w,0===
W&&c(oa));l===w&&(41===d.charCodeAt(G)?(l=ja,G++):(l=w,0===W&&c(fa)));W--;l===w?f=void 0:(G=f,f=w);f!==w?(l=V(),l!==w?e=f=[f,l]:(G=e,e=w)):(G=e,e=w);if(e!==w)for(;e!==w;)b.push(e),f=e=G,W++,40===d.charCodeAt(G)?(l=qa,G++):(l=w,0===W&&c(oa)),l===w&&(41===d.charCodeAt(G)?(l=ja,G++):(l=w,0===W&&c(fa))),W--,l===w?f=void 0:(G=f,f=w),f!==w?(l=V(),l!==w?e=f=[f,l]:(G=e,e=w)):(G=e,e=w);else b=w;b!==w&&(b=1);a=b;a===w&&(a=G,40===d.charCodeAt(G)?(b=qa,G++):(b=w,0===W&&c(oa)),b!==w?(e=L(),e!==w?(f=D(),f!==w?
(l=L(),l!==w?(41===d.charCodeAt(G)?(b=ja,G++):(b=w,0===W&&c(fa)),b!==w?a=f:(G=a,a=w)):(G=a,a=w)):(G=a,a=w)):(G=a,a=w)):(G=a,a=w))}return a}function I(){var a;ua.test(d.charAt(G))?(a=d.charAt(G),G++):(a=w,0===W&&c(ka));return a}function r(){var a;Qa.test(d.charAt(G))?(a=d.charAt(G),G++):(a=w,0===W&&c(La));return a}function v(){var a,b;W++;b=a=G;W++;var f,l,h,g;f=G;d.substr(G,7)===Y?(l=Y,G+=7):(l=w,0===W&&c(K));l!==w?(h=G,W++,g=e(),W--,g===w?h=void 0:(G=h,h=w),h!==w?f=l=[l,h]:(G=f,f=w)):(G=f,f=w);W--;
f===w?b=void 0:(G=b,b=w);if(b!==w){W++;b=G;f=E();if(f!==w){l=[];for(h=e();h!==w;)l.push(h),h=e();l!==w?b=f+=l.join(""):(G=b,b=w)}else G=b,b=w;W--;b===w&&0===W&&c(Ca);b!==w?a=b:(G=a,a=w)}else G=a,a=w;W--;a===w&&0===W&&c(Ca);return a}function E(){var a;gb.test(d.charAt(G))?(a=d.charAt(G),G++):(a=w,0===W&&c(wa));a===w&&(36===d.charCodeAt(G)?(a=lb,G++):(a=w,0===W&&c(ra)),a===w&&(95===d.charCodeAt(G)?(a=ic,G++):(a=w,0===W&&c(la))));return a}function e(){var a;a=E();a===w&&(a=I());return a}function t(){var a,
b,e,f;a=G;42===d.charCodeAt(G)?(b=ib,G++):(b=w,0===W&&c(xa));b===w&&(47===d.charCodeAt(G)?(b=ya,G++):(b=w,0===W&&c(zb)),b===w&&(37===d.charCodeAt(G)?(b=Ub,G++):(b=w,0===W&&c(Ab))));b!==w?(e=G,W++,61===d.charCodeAt(G)?(f=Fb,G++):(f=w,0===W&&c(Kb)),W--,f===w?e=void 0:(G=e,e=w),e!==w?a=b:(G=a,a=w)):(G=a,a=w);return a}function l(){var a,b,e;a=G;43===d.charCodeAt(G)?(b=Na,G++):(b=w,0===W&&c(mb));b!==w?(b=G,W++,43===d.charCodeAt(G)?(e=Na,G++):(e=w,0===W&&c(mb)),e===w&&(61===d.charCodeAt(G)?(e=Fb,G++):(e=
w,0===W&&c(Kb))),W--,e===w?b=void 0:(G=b,b=w),b!==w?a="+":(G=a,a=w)):(G=a,a=w);a===w&&(a=G,45===d.charCodeAt(G)?(b=Jb,G++):(b=w,0===W&&c(ob)),b!==w?(b=G,W++,45===d.charCodeAt(G)?(e=Jb,G++):(e=w,0===W&&c(ob)),e===w&&(61===d.charCodeAt(G)?(e=Fb,G++):(e=w,0===W&&c(Kb))),W--,e===w?b=void 0:(G=b,b=w),b!==w?a="-":(G=a,a=w)):(G=a,a=w));return a}function N(){var a;d.substr(G,2)===Sa?(a=Sa,G+=2):(a=w,0===W&&c(Sb));a===w&&(d.substr(G,2)===Wa?(a=Wa,G+=2):(a=w,0===W&&c(Ja)));return a}function J(){var a;d.substr(G,
2)===yb?(a=yb,G+=2):(a=w,0===W&&c(Pb));a===w&&(d.substr(G,2)===pb?(a=pb,G+=2):(a=w,0===W&&c(Va)),a===w&&(60===d.charCodeAt(G)?(a=Ya,G++):(a=w,0===W&&c(Da)),a===w&&(62===d.charCodeAt(G)?(a=nb,G++):(a=w,0===W&&c(mc)))));return a}function C(){var a;d.substr(G,2)===va?(a=va,G+=2):(a=w,0===W&&c(tb));a===w&&(d.substr(G,2)===da?(a=da,G+=2):(a=w,0===W&&c(Gb)));return a}function R(){var a,b,e;a=G;38===d.charCodeAt(G)?(b=Ba,G++):(b=w,0===W&&c(Ea));b!==w?(b=G,W++,38===d.charCodeAt(G)?(e=Ba,G++):(e=w,0===W&&
c(Ea)),W--,e===w?b=void 0:(G=b,b=w),b!==w?a="&":(G=a,a=w)):(G=a,a=w);return a}function M(){var a,b,e;a=G;94===d.charCodeAt(G)?(b=Fa,G++):(b=w,0===W&&c(wb));b!==w?(b=G,W++,94===d.charCodeAt(G)?(e=Fa,G++):(e=w,0===W&&c(wb)),W--,e===w?b=void 0:(G=b,b=w),b!==w?a="^":(G=a,a=w)):(G=a,a=w);return a}function P(){var a,b,e;a=G;124===d.charCodeAt(G)?(b=xb,G++):(b=w,0===W&&c(Ra));b!==w?(b=G,W++,124===d.charCodeAt(G)?(e=xb,G++):(e=w,0===W&&c(Ra)),W--,e===w?b=void 0:(G=b,b=w),b!==w?a="|":(G=a,a=w)):(G=a,a=w);
return a}function S(){var a;d.substr(G,2)===Hb?(a=Hb,G+=2):(a=w,0===W&&c(jb));a!==w&&(a="&&");return a}function Z(){var a;d.substr(G,2)===Ib?(a=Ib,G+=2):(a=w,0===W&&c($b));a!==w&&(a="||");return a}function L(){var a,b;a=[];for(b=X();b!==w;)a.push(b),b=X();return a}function X(){var a;W++;Nb.test(d.charAt(G))?(a=d.charAt(G),G++):(a=w,0===W&&c(Eb));W--;a===w&&0===W&&c(xc);return a}function V(){var a;d.length>G?(a=d.charAt(G),G++):(a=w,0===W&&c(sb));return a}var ca=1<arguments.length?arguments[1]:{},
w={},ea={start:n},ha=n,ba=",",Q={type:"literal",value:",",description:'","'},T="?",pa={type:"literal",value:"?",description:'"?"'},ma=":",U={type:"literal",value:":",description:'":"'},Y="defined",K={type:"literal",value:"defined",description:'"defined"'},qa="(",oa={type:"literal",value:"(",description:'"("'},ja=")",fa={type:"literal",value:")",description:'")"'},aa={type:"other",description:"number"},ia="0",O={type:"literal",value:"0",description:'"0"'},ua=/^[0-9]/,ka={type:"class",value:"[0-9]",
description:"[0-9]"},Ma=/^[1-9]/,ta={type:"class",value:"[1-9]",description:"[1-9]"},za=/^[xX]/,Xa={type:"class",value:"[xX]",description:"[xX]"},Qa=/^[0-9a-fA-F]/,La={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},Ca={type:"other",description:"identifier"},lb="$",ra={type:"literal",value:"$",description:'"$"'},ic="_",la={type:"literal",value:"_",description:'"_"'},gb=/^[a-zA-Z]/,wa={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},Aa="++",Ia={type:"literal",value:"++",description:'"++"'},
sa="--",Ga={type:"literal",value:"--",description:'"--"'},Na="+",mb={type:"literal",value:"+",description:'"+"'},Jb="-",ob={type:"literal",value:"-",description:'"-"'},Tb="~",cb={type:"literal",value:"~",description:'"~"'},bc="!",nc={type:"literal",value:"!",description:'"!"'},ib="*",xa={type:"literal",value:"*",description:'"*"'},ya="/",zb={type:"literal",value:"/",description:'"/"'},Ub="%",Ab={type:"literal",value:"%",description:'"%"'},Fb="=",Kb={type:"literal",value:"=",description:'"="'},Sa=
"<<",Sb={type:"literal",value:"<<",description:'"<<"'},Wa=">>",Ja={type:"literal",value:">>",description:'">>"'},yb="<=",Pb={type:"literal",value:"<=",description:'"<="'},pb=">=",Va={type:"literal",value:">=",description:'">="'},Ya="<",Da={type:"literal",value:"<",description:'"<"'},nb=">",mc={type:"literal",value:">",description:'">"'},va="==",tb={type:"literal",value:"==",description:'"=="'},da="!=",Gb={type:"literal",value:"!=",description:'"!="'},Ba="&",Ea={type:"literal",value:"&",description:'"&"'},
Fa="^",wb={type:"literal",value:"^",description:'"^"'},xb="|",Ra={type:"literal",value:"|",description:'"|"'},Hb="&&",jb={type:"literal",value:"&&",description:'"&&"'},Ib="||",$b={type:"literal",value:"||",description:'"||"'},xc={type:"other",description:"whitespace"},Nb=/^[\t\x0B\f ]/,Eb={type:"class",value:"[\\t\\v\\f ]",description:"[\\t\\v\\f ]"},jc={type:"other",description:"end of line"},kc="\n",Ua={type:"literal",value:"\n",description:'"\\n"'},lc="\r\n",Ob={type:"literal",value:"\r\n",description:'"\\r\\n"'},
bb="\r",ac={type:"literal",value:"\r",description:'"\\r"'},sb={type:"any",description:"any character"},G=0,db=0,Za={Si:1,Qg:1,pj:!1},$a=0,na=[],W=0,Oa;if("startRule"in ca){if(!(ca.zw in ea))throw Error("Can't start parsing from rule \""+ca.zw+'".');ha=ea[ca.zw]}Oa=ha();if(Oa!==w&&G===d.length)return Oa;Oa!==w&&G<d.length&&c({type:"end",description:"end of input"});throw function(b,e,c){function f(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?
1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function l(a,b){function e(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,
function(a){return"\\u"+b(a)})}var c=Array(a.length),d;for(d=0;d<a.length;d++)c[d]=a[d].description;c=1<a.length?c.slice(0,-1).join(", ")+" or "+c[a.length-1]:c[0];d=b?'"'+e(b)+'"':"end of input";return"Expected "+c+" but "+d+" found."}var h=g(c),k=c<d.length?d.charAt(c):null;null!==e&&f(e);return new a(null!==b?b:l(e,k),0,0,c,h.Si,h.Qg)}(null,na,$a);}}}()};b4w.module.__assets=function(a,q){function d(){return A.iu()?q(A.dc.dk).data:null}function b(){var a={Rj:null,Oy:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),f=0;f<c;f++)d[f]=b.charCodeAt(f);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.Rj=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=d();b&&a.Rj in b&&(a.status=200,b[a.Rj]&&(a.response=a.Oy(b[a.Rj])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function g(b){for(var d=0,f=0;f<b.length;f++){var h=b[f];20===h.state&&d++;if(d>=D.lD)break;if(10===h.state)switch(h.state=20,d++,h.type){case a.Ej:c(h,"arraybuffer");break;case a.aq:c(h,"json");break;case a.ox:c(h,"text");break;case a.Zp:n(h);break;case a.Fj:p(h);break;case a.$p:k(h);break;case a.Hj:y(h);break;
case a.Gj:m(h);break;default:throw"Wrong asset type: "+h.type;}}}function c(a,c){var f=d(),h=f&&a.r in f?new b:new XMLHttpRequest;h.open("GET",a.r,!0);"text"==c?(h.overrideMimeType("text/plain"),h.responseType="text"):"json"==c?(h.overrideMimeType("application/json"),h.responseType="text"):h.responseType=c;h.onreadystatechange=function(){if(40!=a.state&&4==h.readyState){if(200==h.status||0==h.status){var b=h.response;if(b){if("json"==c&&"string"==typeof b)try{b=JSON.parse(b)}catch(d){a.ib(null,a.uri,
a.type,a.r,a.ob);x.error(d+" (parsing JSON "+a.r+")");return}a.ib(b,a.uri,a.type,a.r,a.ob)}else a.ib(null,a.uri,a.type,a.r,a.ob),x.error("B4W Error: empty responce when trying to get "+a.r)}else a.ib(null,a.uri,a.type,a.r,a.ob),x.error("B4W Error: "+h.status+" when trying to get "+a.r);a.state=30}};h.addEventListener("progress",function(b){b.lengthComputable&&a.mv(b.loaded/b.total)},!1);h.send(null)}function n(a){var c=d(),l=c&&a.r in c?new b:new XMLHttpRequest;l.open("GET",a.r,!0);l.responseType=
"arraybuffer";l.onreadystatechange=function(){if(40!=a.state&&4==l.readyState)if(200==l.status||0==l.status){var b=l.response;b?f.PA(b,function(b){a.ib(b,a.uri,a.type,a.r,a.ob);a.state=30},function(){a.ib(null,a.uri,a.type,a.r,a.ob);x.error("B4W Error: failed to decode "+a.r);a.state=30}):(a.ib(null,a.uri,a.type,a.r,a.ob),x.error("B4W Error: empty responce when trying to get "+a.r),a.state=30)}else a.ib(null,a.uri,a.type,a.r,a.ob),x.error("B4W Error: "+l.status+" when trying to get "+a.r),a.state=
30};l.send(null)}function p(a){var b=document.createElement("img");I.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.ib(b,a.uri,a.type,a.r,a.ob),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.ib(null,a.uri,a.type,a.r,a.ob),x.error("B4W Error: could not load image: "+a.r),a.state=30)},!1);var c=d();if(c&&a.r in c)if(c[a.r]){var f=B(a.r);b.src="data:"+f+";base64,"+c[a.r]}else z.$n()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,
null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.r}function k(a){var b=document.createElement("audio");I.allow_cors&&(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=a.state&&(a.ib(b,a.uri,a.type,a.r,a.ob),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.ib(null,a.uri,a.type,a.r,a.ob),x.error("B4W Error: could not load sound: "+a.r),a.state=30)},!1);var c=d();if(c&&a.r in c)if(c[a.r]){var f=u(a.r);b.src="data:"+f+";base64,"+c[a.r];40!=
a.state&&(a.ib(b,a.uri,a.type,a.r,a.ob),a.state=30)}else z.$n()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.r,I.Vf&&b.load();setTimeout(function(){b.TE=1},5E3)}function y(a){var b=document.createElement("video");b.muted=!0;if(I.allow_cors||I.Vf)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.ib(b,a.uri,a.type,a.r,a.ob),a.state=30)},!1);b.addEventListener("error",function(){40!=
a.state&&(a.ib(null,a.uri,a.type,a.r),x.error("B4W Error: could not load video: "+a.r,a.ob),a.state=30)},!1);var c=d();if(c&&a.r in c)if(c[a.r]){var f=H(a.r);b.src="data:"+f+";base64,"+c[a.r];40!=a.state&&(a.ib(b,a.uri,a.type,a.r,a.ob),a.state=30)}else z.$n()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.r,I.Vf&&b.load();setTimeout(function(){b.TE=1},1E4)}function m(a){function c(b){a.ib(b,a.uri,a.type,a.r,
a.ob)}var f=d(),h=f&&a.r in f?new b:new XMLHttpRequest;h.open("GET",a.r,!0);h.responseType="arraybuffer";h.onreadystatechange=function(){if(40!=a.state&&4==h.readyState){if(200==h.status||0==h.status){var b=h.response;b?s(b,c):(a.ib(null,a.uri,a.type,a.r,a.ob),x.error("B4W Error: empty responce when trying to get "+a.r))}else a.ib(null,a.uri,a.type,a.r,a.ob),x.error("B4W Error: "+h.status+" when trying to get "+a.r);a.state=30}};h.addEventListener("progress",function(b){b.lengthComputable&&a.mv(b.loaded/
b.total)},!1);h.send(null)}function s(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),f=c[3],h={images:[],Zb:c[4]},g=20,k=0;k<f;k++){var m=c[g/4],v=new Blob([d.subarray(g+4,g+4+m)],{type:"image/jpg"}),n=document.createElement("img");n.src=window.URL.createObjectURL(v);h.images.push(n);g+=m+8-m%4}n.onload=function(){b(h)}}function B(a){var b="image";switch(F.Gn(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function u(a){var b="audio";switch(F.Gn(a).toLowerCase()){case "ogv":case "ogg":b+=
"/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function H(a){var b="video";switch(F.Gn(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var A=q("__config"),x=q("__print"),f=q("__sfx"),F=q("__util"),h=q("__version"),z=q("__compat"),D=A.Jd,I=A.p;a.Ej=10;a.aq=20;a.ox=30;a.Zp=40;a.Fj=50;a.$p=60;a.Hj=70;a.Gj=80;var r=[],v=0,E={};a.sj=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,
-1).join(".");b[1]=String(a.slice(-1));return b};a.tC=function(a){if(E[a])return E[a];var b=D.iv?a+h.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return E[a]=b;throw"Error XHR: responce is empty, GET "+a;}throw"Error XHR: "+c.status+", GET "+a;};a.ba=function(){for(var a=0;a<r.length;a++)r[a].state=40;r=[];v=0;E={}};a.qc=function(a,b,c,f){for(var k=0;k<a.length;k++){var m=a[k],m={uri:m[0],
type:m[1],r:m[2],ob:m[3],state:10,ib:b||function(){},av:c||function(){},mv:f||function(){},bv:v};if(D.iv){var n=d();n&&m.r in n||(m.r+=h.timestamp())}r.push(m)}g(r);v++};a.update=function(){g(r);for(var a=r,b=0,c=!0,d=0;d<a.length;d++){var f=a[d];f.bv===a[b].bv?30!==f.state&&(c=!1):(c&&(a[d-1].av(),c=d-b,a.splice(b,c),d-=c),b=d,c=30===a[d].state?!0:!1);d===a.length-1&&c&&(a[d].av(),a.splice(b))}}};b4w.module.__sfx=function(a,q){function d(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;x.warn("B4W warning: deprecated WebAudio implementation");return null}x.warn("B4W warning: WebAudio is not supported");return null}function b(a,b,c){var d=a.h;if("NONE"!=d.behavior){c||(c=0);var l=d.loop,h=d.pitch;if(d.src&&(l||0<=c)){d.ym=Math.floor(5E4*Math.random());var m=e.currentTime+b;d.yc=m;d.state=20;g(a);"POSITIONAL"==d.behavior||"BACKGROUND_SOUND"==d.behavior?
(b=e.createBufferSource(),b.buffer=d.src,b.playbackRate.value=h,l?(d.qb&&d.qb.disconnect(),b.loop=!0,b.start(m),d.duration=0):(l=b.buffer?b.buffer.duration:0,c>l?(l=m+c+d.Ud,b.loop=!0,b.start(m),b.stop(l),d.duration=c):(b.loop=!1,b.start(m),d.duration=l)),b.connect(d.ec),d.qb=b,n(d),p(d)):"BACKGROUND_MUSIC"==d.behavior&&(f.ik(d.Cm),f.ik(d.Dm),c=function(){var b=a.h,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.qb=b.qb||e.createMediaElementSource(c),b.qb.connect(b.ec),20==b.state&&(c.currentTime&&(c.currentTime=
0),c.play()))},0==b?c():d.Cm=f.bw(c,1E3*b),d.duration=l?0:H(a));k(d,m)}}}function g(a){var b=a.h;if(!b.ec){var c=a.d.g;a=a.d.quat;if(z.kl){var d=e.createBiquadFilter();d.type="peaking"}else d=null;var f=e.createGain();switch(b.behavior){case "POSITIONAL":var l=e.createPanner();"string"!=typeof l.panningModel?(l.panningModel=l.EQUALPOWER,l.distanceModel=l.INVERSE_DISTANCE):(l.panningModel="equalpower",l.distanceModel="inverse");l.setPosition(c[0],c[1],c[2]);b.ho.set(c);c=D;F.S(a,F.rb,c);l.setOrientation(c[0],
c[1],c[2]);b.direction.set(c);l.refDistance=b.dist_ref;l.maxDistance=b.dist_max;l.rolloffFactor=b.attenuation;l.coneInnerAngle=b.eA;l.coneOuterAngle=b.fA;l.coneOuterGain=b.gA;var h=e.createGain();h.gain.value=u(b);d?(l.connect(d),d.connect(h)):l.connect(h);h.connect(f);b.ec=l;if(b.ai){var g=e.createGain();f.connect(g);g.connect(e?t.h.ec:null)}else g=null,f.connect(e?t.h.ec:null);break;case "BACKGROUND_SOUND":l=null;h=e.createGain();h.gain.value=u(b);d?(b.ec=d,d.connect(h)):b.ec=h;h.connect(f);b.ai?
(g=e.createGain(),f.connect(g),g.connect(e?t.h.ec:null)):(g=null,f.connect(e?t.h.ec:null));break;case "BACKGROUND_MUSIC":g=l=null,h=e.createGain(),h.gain.value=u(b),d?(b.ec=d,d.connect(h)):b.ec=h,h.connect(f),f.connect(e?t.h.ec:null)}b.Zi=l;b.md=d;b.bh=h;b.If=f;b.rv=g}}function c(a){var c=a.h,e=c.duration,c=c.SA+c.TA*Math.random();b(a,c,e)}function n(a){a.ai&&a.rv.gain.cancelScheduledValues(a.yc);a.bj&&a.qb.playbackRate.cancelScheduledValues(a.yc);a.zj=a.yc}function p(a){if(a.ai||a.bj){var b=a.rv,
c=a.qb,e=c.buffer?c.buffer.duration:0;if(e){var d=a.yc;N[0]=a.ym;for(var f=0;5>f;){var l=a.pitch+a.bj*F.Nc(N);if(d>=a.zj){if(a.ai){var h=1-F.xa(a.ai,0,1)*Math.random();b.gain.setValueAtTime(h,d)}a.bj&&c.playbackRate.setValueAtTime(l,d);f++}d+=e/l}a.zj=d-.001}}}function k(a,b){if(a.un||a.Ud){var c=a.If;c.gain.cancelScheduledValues(b);a.un?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.un)):c.gain.setValueAtTime(1,b);a.Ud&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,
b+a.duration+a.Ud))}}function y(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.h;if(20==b.state||40==b.state){var c=b.If,d=e.currentTime;b.Ud&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.Ud));"BACKGROUND_MUSIC"==b.behavior?b.src&&(f.ik(b.Cm),f.ik(b.Dm),b.Dm=f.bw(function(){var b=a.h.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.Ud)):(c=b.qb,b.duration<c.buffer.duration?b.Ud&&20==b.state?c.stop(d+b.Ud):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),
b.yc=0,b.Do=0,b.Im=0);b.state=30}}function m(a){a=a.h;if(20==a.state){var b=e.currentTime;a.Do=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.yc){N[0]=a.ym;for(var d=a.qb.buffer.duration,f=a.yc;f<b;)c=a.pitch+a.bj*F.Nc(N),f+=d/c;c*=d/c-(f-b)}else c=0;a.Im=c;a.qb.stop(0);a.qb.disconnect();n(a)}a.state=40}}function s(a){var b=a.h;if(40==b.state){var c=e.currentTime;b.yc+=c-b.Do;if("BACKGROUND_MUSIC"==b.behavior)b.src.play();else{a=a.h;var d=e.createBufferSource();d.loop=a.qb.loop;
d.buffer=a.qb.buffer;d.playbackRate.value=a.qb.playbackRate.value;a.Zi?d.connect(a.Zi):d.connect(a.bh);a.qb=d;b.zj=c;b.qb.start(b.yc,b.Im);p(b)}k(b,b.yc);b.state=20}}function B(a){return!a.h||20!=a.h.state&&40!=a.h.state&&30!=a.h.state?!1:!0}function u(a){return a.muted?0:a.volume}function H(a){a=a.h;return(a=a.src)?a.duration:0}var A=q("__config"),x=q("__print"),f=q("__time"),F=q("__util"),h=q("vec3"),z=A.me;a.Yp=10;a.em=20;a.Xp=30;var D=new Float32Array(3),I=new Float32Array(3),r=new Float32Array(3),
v=[],E=[],e=null,t=null,l=[],N=[1],J=null;a.ac=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(v.push("ogg"),v.push("ogv")),""!=a.canPlayType("audio/mpeg")&&v.push("mp3"),""!=a.canPlayType("audio/mp4")&&(v.push("mp4"),v.push("m4v")),""!=a.canPlayType("audio/webm")&&v.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&E.push("ogv"),""!=b.canPlayType("video/mp4")&&E.push("m4v"),""!=b.canPlayType("video/webm")&&
E.push("webm"));(e=z.dG?d():null)&&x.log("%cINIT WEBAUDIO: "+e.sampleRate+"Hz","color: #00a")};a.hr=function(a){var b={cg:new Float32Array(3),wu:new Float32Array(3),lh:new Float32Array(3)};a.h=b;if(e){var c=e.createGain(),d=e.createGain();b.bh=c;b.If=d;c.connect(d);d.connect(e.destination);if(a.b4w_enable_dynamic_compressor){var d=e.createDynamicsCompressor(),f=a.b4w_dynamic_compressor_settings;d.threshold.value=f.threshold;d.knee.value=f.knee;d.ratio.value=f.ratio;d.attack.value=f.attack;d.release.value=
f.release;d.connect(c);b.oi=d;b.ec=d}else b.oi=null,b.ec=c;c=e.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=!1;b.volume=1;b.Hf=0}};a.rE=function(a){t=a};a.nn=function(a){a||(a="ogg");return-1<v.indexOf(a)?a:"ogg"==a&&-1<v.indexOf("mp4")?"mp4":"mp3"==a&&-1<v.indexOf("ogg")?"ogg":"mp4"==a&&-1<v.indexOf("ogg")?"ogg":"ogv"==a&&-1<v.indexOf("m4v")?"m4v":"webm"==a&&-1<v.indexOf("m4v")?"m4v":"m4v"==a&&-1<v.indexOf("webm")?"webm":""};a.on=function(a){a||(a=
"webm");return-1<E.indexOf(a)?a:"ogv"==a&&-1<E.indexOf("m4v")?"m4v":"webm"==a&&-1<E.indexOf("m4v")?"m4v":"m4v"==a&&-1<E.indexOf("webm")?"webm":""};a.Lg=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.h={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.h.behavior=e?b.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var c=a.h,d;e?(window.MediaElementAudioSourceNode?d=!0:(x.warn("B4W warning: MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":
"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.h.behavior="NONE");a.h.YA=b.b4w_disable_doppler;a.h.muted=b.muted;a.h.volume=b.volume;a.h.pitch=b.pitch;a.h.attenuation=b.attenuation;a.h.dist_ref=b.distance_reference;a.h.dist_max=b.distance_max||1E4;a.h.eA=b.cone_angle_inner;a.h.fA=b.cone_angle_outer;a.h.gA=b.cone_volume_outer;a.h.Hc=b.b4w_cyclic_play;a.h.loop=b.b4w_loop;a.h.SA=b.b4w_delay;a.h.TA=b.b4w_delay_random;a.h.ai=b.b4w_volume_random;a.h.bj=
b.b4w_pitch_random;a.h.un=b.b4w_fade_in;a.h.Ud=b.b4w_fade_out;a.h.yc=0;a.h.Do=0;a.h.Im=0;a.h.duration=0;a.h.zj=0;a.h.ym=1;a.h.src=null;a.h.state=10;a.h.ho=new Float32Array(3);a.h.direction=new Float32Array(3);a.h.op=new Float32Array(3);a.h.Cm=-1;a.h.Dm=-1;a.h.Hf=0;l.push(a)};a.sw=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.h.behavior){case "POSITIONAL":return a.em;case "BACKGROUND_SOUND":return a.em;case "BACKGROUND_MUSIC":return a.Xp;case "NONE":return a.Yp;default:throw"Wrong speaker behavior";
}};a.PF=function(a,b){var c=a.h;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.FD=function(){var a=e.createBufferSource();a.buffer=e.createBuffer(1,22050,22050);a.connect(e.destination);a.start(0)};a.PA=function(a,b,c){e?e.decodeAudioData(a,b,c):c()};a.YE=function(a){y(a);delete a.h;l.splice(l.indexOf(a),1)};a.ba=function(){for(var a=0;a<l.length;a++){var b=l[a].h;"BACKGROUND_MUSIC"==b.behavior?
(b=b.src)&&b.pause():b.qb&&b.qb.disconnect()}t&&t.h&&(a=t.h,a.cg[0]=0,a.cg[1]=0,a.cg[2]=0,a.lh[0]=0,a.lh[1]=0,a.lh[2]=0);t=null;l.splice(0);J=null};a.update=function(a){if(e&&0!=l.length){for(var b=0;b<l.length;b++){var d=l[b],f=d.h,h=e.currentTime;e&&!f.loop&&f.Hc&&20==f.state&&f.duration&&f.yc+f.duration<h&&c(d);20==f.state&&3>f.zj-h&&p(f)}J&&(-1==J.Ka||a>J.Rq+J.ys[J.Ka])&&(b=J,-1<b.Ka&&y(b.df[b.Ka]),-1==b.Ka&&b.random?d=Math.round(Math.random()*(b.df.length-1)):b.random?(d=1+Math.round(Math.random()*
(b.df.length-2)),d=(b.Ka+d)%b.df.length):d=(b.Ka+1)%b.df.length,c(b.df[d]),b.Ka=d,b.Rq=a)}};a.play=b;a.Fo=c;a.stop=y;a.Oi=function(a){return 20==a.h.state};a.XE=m;a.ZE=s;a.cj=function(a,b){var c=a.h;c.pitch=b;!B(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.qb.playbackRate.value=b,n(c),p(c))};a.vt=function(a){return a.h.pitch};a.Hc=function(a,b){a.h.Hc=Boolean(b)};a.jh=function(a){return a.h.Hc};a.bD=function(a,b,c,d){if(e&&a.h){var f=D;f[0]=0;f[1]=-1;f[2]=0;h.transformQuat(f,c,
f);I[0]=0;I[1]=0;I[2]=-1;h.transformQuat(I,c,I);c=e.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(f[0],f[1],f[2],I[0],I[1],I[2]);a.h.wu.set(f);d&&(r[0]=(b[0]-a.h.cg[0])/d,r[1]=(b[1]-a.h.cg[1])/d,r[2]=(b[2]-a.h.cg[2])/d,F.Ch(r,a.h.lh,d,.3,r),c.setVelocity(r[0],r[1],r[2]),a.h.lh.set(r));a.h.cg.set(b)}};a.xu=function(a,b){if(e&&t.h){var c=D;b?c.set(b):c.set(t.h.wu);h.scale(c,a,c);e.listener.setVelocity(c[0],c[1],c[2]);t.h.lh.set(c)}};a.$E=function(a,b){var c=a.h;if(B(a)&&"POSITIONAL"==c.behavior){var e=
a.d.g,d=c.Zi;d.setPosition(e[0],e[1],e[2]);var f=D;F.S(a.d.quat,F.rb,f);d.setOrientation(f[0],f[1],f[2]);f=c.ho;!c.YA&&b&&(I[0]=(e[0]-f[0])/b,I[1]=(e[1]-f[1])/b,I[2]=(e[2]-f[2])/b,F.Ch(I,c.op,b,.3,I),d.setVelocity(I[0],I[1],I[2]),c.op.set(I));f.set(e)}};a.tw=function(a,b,c){var e=a.h;if(B(a)&&"POSITIONAL"==e.behavior){var d=D;c?d.set(c):d.set(e.direction);h.scale(d,b,d);e.Zi.setVelocity(d[0],d[1],d[2]);e.op.set(d);e.ho.set(a.d.g)}};a.ce=function(a){return a.h?!0:!1};a.On=function(a){return a.h.behavior};
a.Nm=function(){for(var a=0;a<l.length;a++)if(B(l[a]))return!0;return!1};a.AE=function(a){var b=t.h;b&&(b.volume=a,e&&(b.bh.gain.value=u(b)))};a.lC=function(){var a=t.h;return a?a.volume:0};a.fp=function(a,b){var c=a.h;c.volume=b;B(a)&&(c.bh.gain.value=u(c))};a.Jt=function(a){return a.h.volume};a.Vi=function(a,b){a.h.muted=Boolean(b);B(a)&&(a.h.bh.gain.value=u(a.h))};a.ku=function(a){return a.h.muted};a.sD=function(a){var b=t.h;b&&(b.muted=Boolean(a),e&&(b.bh.gain.value=u(b)))};a.YC=function(){var a=
t.h;return a?a.muted:!1};a.Ik=function(){return l};a.pause=function(){for(var a=0;a<l.length;a++)m(l[a])};a.ie=function(){for(var a=0;a<l.length;a++)s(l[a])};a.Nv=function(a,b){if(a.h&&a.h.oi){var c=a.h.oi;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.ct=function(a){if(!a.h||!a.h.oi)return null;a=a.h.oi;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};
a.xs=function(a,b,c){if(B(a)){a=a.h;var d=a.If,f=e.currentTime;d.gain.setValueAtTime(d.gain.value,f);d.gain.linearRampToValueAtTime(b,f+c);a.Hf=c}};a.Rw=function(a){if(B(a)){a=a.h;var b=a.If,c=e.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Hf);a.Hf=0}};a.$A=function(a,b){if(e){var c=t.h,d=c.If,f=e.currentTime;d.gain.setValueAtTime(d.gain.value,f);d.gain.linearRampToValueAtTime(a,f+b);c.Hf=b}};a.AF=function(){if(e){var a=t.h,b=a.If,c=e.currentTime;b.gain.setValueAtTime(b.gain.value,
c);b.gain.linearRampToValueAtTime(1,c+a.Hf);a.Hf=0}};a.Zq=function(a,b,c){J={Ka:-1,Rq:0,random:c,df:[],ys:[]};for(c=0;c<a.length;c++){var e=a[c],d=H(e);0==d?x.warn("B4W warning: Ignoring speaker with zero duration: "+e.name):(y(e),e.h.Hc=!1,J.df.push(e),J.ys.push(d+b))}};a.ft=H;a.Or=function(){if(J)for(var a=J.df,b=0;b<a.length;b++)y(a[b]);J=null};a.wt=function(a){return(a=a.h)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.Vv=function(a,b){var c=
a.h;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var e=c.Zi;e&&(e.refDistance=c.dist_ref,e.maxDistance=c.dist_max,e.rolloffFactor=c.attenuation)}};a.Rv=function(a,b){var c=a.h;c&&c.md&&(c.md.frequency.value=b.freq,c.md.Q.value=b.Q,c.md.gain.value=b.gain)};a.kt=function(a){return(a=a.h)&&a.md?{freq:a.md.frequency.value,Q:a.md.Q.value,gain:a.md.gain.value}:null};a.jt=function(a,b,c,e){a=a.h;if(!a||!a.md)return null;a.md.getFrequencyResponse(b,
c,e)}};b4w.module.__time=function(a,q){q("__util");var d=0,b=0,g=[],c=0;a.aw=function(a){d=a;b=performance.now();for(a=0;a<g.length;a++){var c=g[a];d>c.kB&&(g.splice(a,1),a--,c.callback())}};a.fh=function(){return d};a.bw=function(a,p){var k;c++;k=c;g.push({id:k,callback:a,kB:d+(performance.now()-b+p)/1E3});return k};a.ik=function(a){for(var b=0;b<g.length;b++)if(g[b].id==a){g.splice(b,1);break}};a.reset=function(){b=d=0;c=g.length=0}};"object"==typeof module&&module.tn&&(GLOBAL.b4w={module:{}});b4w.module.__version=function(a){function q(){return"25.02.2015 10:29:23"}a.version=function(){return"15.02"};a.type=function(){return"RELEASE"};a.gn=q;a.timestamp=function(){var a=q(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.tn&&b4w.module.__version(exports);b4w.module.__compat=function(a,q){function d(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function b(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function g(){return!window.ActiveXObject&&"ActiveXObject"in window}var c=q("__config"),n=q("__extensions"),p=q("__print"),
k=q("__util");a.yE=function(a){var m=c.Hd,s=c.p,B=c.context,u=c.oj,q=c.me;s.nd=a.getParameter(a.MAX_TEXTURE_SIZE);s.po=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var A=Boolean(n.dC());d("Firefox")&&c.iu()&&(p.warn("Firefox detected for single HTML version, disable video textures."),s.Ks=!0);d("Firefox/28.0")&&(d("Linux")||d("Macintosh"))&&(p.warn("Firefox 28 detected, applying depth hack"),A=!1);d("iPad")||d("iPhone")?(p.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
B.alpha||(s.background_color[3]=1),s.bx=!0,s.smaa=!1,s.ef=!1,s.precision="highp",s.eu=!0):d("Mac OS X")&&d("Safari")&&!d("Chrome")&&(p.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),q.jr=!0,q.Ir=!0);d("Windows")&&(d("Chrome/40")||d("Firefox/33")||d("Firefox/34")||d("Firefox/35")||d("Firefox/36"))&&(p.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),s.Pr=!0);b()&&(p.warn("Mobile detected, applying glsl loops unroll hack, applying various hacks for video textures."),
s.Of=!0,s.Vf=!0,d("iPad")||d("iPhone")||(p.warn("Mobile (not iOS) detected, disable playback rate for video textures."),q.ws=!0));(d("Firefox/35.0")||d("Firefox/36.0"))&&d("Windows")&&(p.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),s.Ls=!0);if(d("iPhone")||g())p.warn("iPhone or IE11 detected. Enable sequential video fallback for video textures."),s.Xc=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(p.warn("Not enough varyings, disable shadows on blend objects"),s.vs=!0);if(B=
n.yt())d("Macintosh")&&-1<a.getParameter(B.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(p.warn("OS X / Intel HD 3000 detected, applying depth and glsl loops unroll hacks"),A=!1,s.Of=!0),-1<a.getParameter(B.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(B.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(p.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),A=!1,m.Rs=!0),-1<a.getParameter(B.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(B.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&
(p.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),s.precision="highp",s.Ze="NONE"),-1<a.getParameter(B.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(B.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(p.warn("ARM Mali-T760 detected, disable SSAO."),s.ef=!1),-1<a.getParameter(B.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&-1<a.getParameter(B.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(p.warn("Qualcomm Adreno detected, applying shader constants hack."),s.hw=!0,-1<
a.getParameter(B.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(p.warn('Qualcomm Adreno305 detected, set "highp" precision.'),s.precision="highp"),-1<a.getParameter(B.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(p.warn('Qualcomm Adreno330 detected, set "highp" precision.'),s.precision="highp")),-1<a.getParameter(B.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(B.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&(p.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),
s.yn=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(p.warn("Vertex textures are not allowed. Disabling vertex textures"),s.mm=!1);s.allow_hidpi&&1<window.devicePixelRatio&&(p.log("%cENABLE HIDPI MODE","color: #00a"),s.resolution_factor=1,s.smaa=!1);A||(s.zi=!1,s.$i=!1,s.La=!1,s.water_dynamic=!1,s.yh=!1,s.Jl=!1,s.Vc=!1,s.smaa=!1);s.Xw=Boolean(n.zt());s.sk=A;m=k.xa(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),128,Infinity);s.Tc=k.trunc((m-50)/4);s.RK=k.trunc((m-50)/2);0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,
a.HIGH_FLOAT).precision&&(s.precision="mediump");g()&&(p.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),u.qk=512);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(p.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),s.yn=!0)};a.us=b;a.lz=function(){d("Firefox/35.0")&&d("Windows")&&(p.warn("Windows/Firefox 35 detected, forcing context's alpha"),c.context.alpha=!0)};a.$n=g};b4w.module.shader_texts=function(a){a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_glow_intensity",";"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",
b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_glow_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},
{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",
a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 cl = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"cl = mix ( cl , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 cm = vec3 ( 0.0 ) ; vec3 cn = vec3 ( 0.0 ) ; vec3 co = vec3 ( 0.0 ) ; bt ( cl , cm , cn , co ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","cp","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cp = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 cq = ( u_model_matrix * vec4 ( cp , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",
b:"mat4 cr = ag ( u_camera_eye , cq , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 cr = aa ( u_camera_eye , cq , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 cs = ( u_model_matrix * vec4 ( cp , 1.0 ) ) . xyz ; cr = cr * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , cs ) ;".split(" ")}]}}]},{type:"textline",b:"d ct = an ( cl - cp , cp , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , cr ) ; ct . b = cq ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"d ct = an ( cl , cp , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","cu","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cu = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ck ( ct . a , ct . b , cu ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( ct . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ;".split(" ")}]}}]},{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"shadow.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:"float ft = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ft = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( ft < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cs ( cF ) ;".split(" ")}]}},
{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( fn ( cL . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"WIND_BEND && MAIN_BEND_COL && DETAIL_BEND || SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:"BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},
{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 gw = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"gw = mix ( gw , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 gx = vec3 ( 0.0 ) ; vec3 gy = vec3 ( 0.0 ) ; vec3 gz = vec3 ( 0.0 ) ; bt ( gw , gx , gy , gz ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","gA","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d gB = gh ( gw , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gA , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gC = ( u_model_matrix * vec4 ( gA , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! HAIR_BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["mat4","gD","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["mat4","gD",
"=","u_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 gE = ag ( u_camera_eye , gC , gD , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gE = aa ( u_camera_eye , gC , gD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 gF = ( u_model_matrix * vec4 ( gA , 1.0 ) ) . xyz ; gE = gE * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , gF ) ;".split(" ")}]}}]},
{type:"textline",b:"d gB = an ( gw - gA , gA , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gE ) ; gB . b = gC ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d gB = an ( gw , gA , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","gG","=","a_normal",
";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gG = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ck ( gB . a , gB . b , gG ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gH = u_view_matrix * vec4 ( gB . a , 1.0 ) ; vec4 gI = u_proj_matrix * gH ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"gI . xy += u_subpixel_jitter * gI . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gr ( gB . a ) ; cL = gH ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"cF = - gH . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 gJ = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; float gK = SHADOW_TEX_RES / 2.0 ; gJ = floor ( gJ * gK + 0.5 ) / gK - gJ ; gI . xy += gJ ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gI",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gw",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gw",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( gw , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , gw ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",
b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gw",";"]}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gw",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gx = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 gy = aa ( u_camera_eye , gx , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"gy = gy * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"d gz = an ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gy ) ; gz . b = gx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d gz = an ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gA = u_proj_matrix * u_view_matrix * vec4 ( gz . a , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gw = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["gw","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gw","=","a_grass_color",";"]}]}}]}]}}]},
{type:"textline",b:["gl_Position","=","gA",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 gE ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float gF ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",
">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int gG = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int gG = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float gI ( float gH ) { return gH - floor ( gH * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void gR ( inout float gJ , in float gK [ gG ] , in float gL ) { for ( int gM = 0 ; gM < NUM_RINGS ; gM ++ ) { float gN = 40.0 * gK [ gM ] ; float gO = 300.0 * ( gI ( gN ) - 0.005 ) ; float gP = gN ; float gQ = abs ( gP * ( u_halo_size * gO - gL ) ) ; gJ += 1.0 - min ( gQ , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void g_ ( inout float gS , in float gT [ gG ] , in float gU ) { for ( int gV = 0 ; gV < NUM_LINES ; gV ++ ) { float gW = gT [ gV ] ; float gX = gW ; float gY = 1000.0 * ( gI ( gW ) - 0.005 ) ; float gZ = 20.0 * abs ( gX * a . x + gY * a . y ) ; gS += 1.0 - min ( gZ , 1.0 ) ; } gS *= gU ; }".split(" ")}]}}]},{type:"textline",b:"void hg ( inout float ha , in vec2 hb ) { float hc , hd ; hd = atan ( hb . y , hb . x ) ; hd *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float he = cos ( hd ) ; float hf = sin ( hd ) ; hd = ( he * hb . x + hf * hb . y ) * ( he * hb . y - hf * hb . x ) ; hc = abs ( hd ) ; if ( hc < 1.0 ) { hc = ( 0.01 * u_halo_size ) / ( hc ) ; ha *= sqrt ( min ( hc , 1.0 ) ) ; } } void main ( ) { float hh = ( a . x * a . x + a . y * a . y ) ; float hi = sqrt ( hh ) ; hh = max ( 1.0 - hh , 0.0 ) ; hh = pow ( hh , u_halo_hardness ) ; float hj = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hk [ gG ] ; for ( int hl = 0 ; hl < gG ; hl ++ ) { hk [ hl ] = fract ( gF / ( float ( hl ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"float hm = 0.0 ; gR ( hm , hk , hi ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hn = 0.0 ; g_ ( hn , hk , hh ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"hg ( hh , a ) ;".split(" ")}]}}]},{type:"textline",b:"hh *= hj ; vec3 ho = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"hm *= hh ; ho += u_halo_rings_color * hm ; hh += hm ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"hn *= hj ; ho += u_halo_lines_color * hn ; hh += hn ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"hh *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float hp = u_halo_stars_blend * ( gE . y - u_halo_stars_height ) ; hh *= clamp ( hp , 0.0 , 1.0 ) ; hh *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"gA ( ho ) ; gD ( ho , hh ) ; gl_FragColor = vec4 ( ho , hh ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float gF ;".split(" ")},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gE",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 gG = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; a = a_halo_bb_vertex * 2.0 ; gF = fract ( gG . x + gG . y + gG . z ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",
a:[{type:"textline",b:"mat4 gH = z ( gG , u_view_matrix ) ; mat4 gI = u_view_matrix ; gI [ 3 ] [ 0 ] = 0.0 ; gI [ 3 ] [ 1 ] = 0.0 ; gI [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gH = z ( gG , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gJ = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 gK = gH * gJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"vec4 gL = u_proj_matrix * gI * gK ; gL . z = 0.99999 * gL . w ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["gE","=","gK",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 gL = u_proj_matrix * u_view_matrix * gK ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gL",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};
a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 gG = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( gG , 1.0 ) ; }".split(" ")}]};a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",
name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ; uniform int u_shadow_lamp_id ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D",
"u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_reflect_factor ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 kE ; varying vec3 kF ; varying vec3 kG ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kH",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],
group:{type:"group",a:[{type:"textline",b:"float lu = kF . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["vec2","lv","=","a",";"]}]}}]},{type:"textline",b:["vec3","lw","=","kG",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) lw = lw ; else lw = - lw ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:"vec3 lx = cross ( lw , kH . xyz ) * kH . w ; mat3 ly = mat3 ( kH . xyz , lx , lw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float lz = length ( cL ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"vec2 lA = normalize ( u_view_matrix_frag * vec4 ( kG , 0.0 ) ) . st ; lA = lA * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( lz < PARALLAX_LOD_DIST ) { float lB = clamp ( 0.5 * ( PARALLAX_LOD_DIST - lz ) , 0.0 , 1.0 ) ; float lC = u_parallax_scale * lB ; vec3 lD = normalize ( kE * ly ) ; float lE = 1.0 / PARALLAX_STEPS ; vec2 lF = lD . xy * lC / ( PARALLAX_STEPS * lD . z ) ; float lG = 1.0 ; float lH ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:["vec2","lI","=","lA",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","lI","=","lv",";"]}]}}]},{type:"textline",b:"lH = texture2D ( u_normalmap0 , lI ) . a ; for ( float lJ = 1.0 ; lJ <= PARALLAX_STEPS ; lJ ++ ) { if ( lH < lG ) { lG -= lE ; lI -= lF ; lH = texture2D ( u_normalmap0 , lI ) . a ; } } vec2 lK = lI + lF ; float lL = texture2D ( u_normalmap0 , lK ) . a - ( lG + lE ) ; float lM = lH - lG ; float lN = lM / ( lM - lL ) ; lI = lN * lK + ( 1.0 - lN ) * lI ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lv += lI - lA ;".split(" ")}]}}]},{type:"textline",b:["lA","=","lI",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lA += lI - lv ;".split(" ")}]}}]},{type:"textline",b:["lv","=","lI",";"]}]}}]},{type:"textline",
b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["vec4","lO",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lO = texture2D ( u_normalmap0 , lA ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lO = texture2D ( u_normalmap0 , lv ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lP = lO . rgb - 0.5 ; lP = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , lP , u_normal_factor ) ; vec3 lQ = ly * lP ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","lQ","=","lw",";"]}]}}]},{type:"textline",b:"lQ = normalize ( lQ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lA = normalize ( u_view_matrix_frag * vec4 ( lQ , 0.0 ) ) . st ; lA = lA * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lR = normalize ( kE ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],
group:{type:"group",a:[{type:"textline",b:"vec3 lS = kI ; gy ( lS ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec4 lT = vec4 ( lS , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","lT","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["float","lU","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:"vec4 lV = texture2D ( u_colormap0 , lA ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec4 lV = texture2D ( u_colormap0 , lv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"gy ( lV . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","lW",
";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lW = texture2D ( u_colormap1 , lA ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lW = texture2D ( u_colormap1 , lv ) ;".split(" ")}]}}]},{type:"textline",b:"gy ( lW . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec4 lX = texture2D ( u_stencil0 , lA ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 lX = texture2D ( u_stencil0 , lv ) ;".split(" ")}]}}]},{type:"textline",b:"lV = mix ( lV , lW , lX . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lT . rgb = mix ( lT . rgb , lV . rgb , u_diffuse_color_factor ) ; float lY = u_alpha_factor * lV . a ; lY += ( 1.0 - step ( 0.0 , lY ) ) ; lT . a = mix ( lY , 1.0 , u_diffuse_color . a ) ; lU = lV . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lT . rgb *= mix ( vec3 ( 1.0 ) , lV . rgb , u_diffuse_color_factor ) ; lT . a = lV . a ; lU = lV . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 lZ = u_diffuse_intensity * lT . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["vec3","l_","=","lZ",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ma = 0.5 * lQ . y + 0.5 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 mb = u_environment_energy * textureCube ( u_sky_texture , lQ ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mb = u_environment_energy * mix ( u_horizon_color , u_zenith_color , ma ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 mc = u_ambient * mb ; float md = fs ( lZ ) ; vec3 me = u_emit * lT . rgb ; vec3 mf = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"vec3 mg = vec3 ( lU ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 mg = texture2D ( u_specmap0 , lA ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mg = texture2D ( u_specmap0 , lv ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"gy ( mg . rgb ) ; mf = mix ( mf , mg , u_specular_color_factor ) ;".split(" ")}]}}]},
{type:"textline",b:"float mh = u_specular_params [ 0 ] ; vec2 mi = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 mj = mh * mf ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS","==","0"],group:{type:"group",a:[{type:"textline",b:"hw mk = kc ( me , mc , lZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hw mk = jY ( me , mc , lZ , mj , kF , lQ , lR , mi , u_diffuse_params , md , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , u_shadow_lamp_id ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 l_ = mk . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["float","ml","=","u_reflect_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","ml","=","0.0",";"]}]}}]},{type:"textline",b:"lf ( l_ , lR , lQ , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , ml ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"l_ += mk . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"l_ = max ( l_ - sqrt ( 0.01 * - min ( lu , 0.0 ) ) , 0.5 * l_ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"kD ( l_ , lu , u_time , md , lQ , u_sun_direction , u_sun_intensity , u_sun_quaternion , kF , lz ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"float mm = lT . a ; if ( mm <= 0.5 ) discard ; mm = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float mm = lT . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"mm += mk . a . a * mj . r * u_specular_alpha ;".split(" ")}]}}]}]}}]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["float","mm","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"l_ = mix ( lt ( cK , lQ . xz * u_refr_bump ) , l_ , mm ) ; mm = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float mn = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 mo = gS ( u_cube_fog , lR ) ; vec4 mp = vec4 ( mo , u_fog_color_density . a ) ; gy ( mp . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 mp = u_fog_color_density ; mp . rgb *= mn ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"hk ( l_ , lz , lR , u_cam_water_depth , u_underwater_fog_color_density , mp , lu , mn ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( l_ , lz , mp ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),group:{type:"group",a:[{type:"textline",b:"l_ = vec3 ( dT . a ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","l_",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"gD ( l_ , mm ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( l_ , mm ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 kE ; varying vec3 kF ; varying vec3 kG ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 lu = a_position ; vec3 lv = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec3 lw = vec3 ( a_tangent ) ; vec3 lx = a_tangent [ 3 ] * cross ( lv , lw ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 ly = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 lz = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vec3 lA = ly - u_camera_eye ; vec3 lx = cross ( lA , lz ) ; vec3 lw = cross ( lz , lx ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lw = vec3 ( 0.0 ) ; vec3 lx = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"lu = mix ( lu , a_position_next , u_va_frame_factor ) ; lv = mix ( lv , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vec3 lB = vec3 ( a_tangent ) ; vec3 lC = a_tangent_next [ 3 ] * cross ( a_normal_next , lB ) ; lw = mix ( lw , lB , u_va_frame_factor ) ; lx = mix ( lx , lC , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bt ( lu , lw , lx , lv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","lD","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lD = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d lE = gh ( lu , lw , lx , lv , lD , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lF = ( u_model_matrix * vec4 ( lD , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 lG = ag ( u_camera_eye , lF , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 lG = aa ( u_camera_eye , lF , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lH = ( u_model_matrix * vec4 ( lD , 1.0 ) ) . xyz ; lG = lG * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lH ) ;".split(" ")}]}}]},{type:"textline",b:"d lE = an ( lu - lD , lD , lw , lx , lv , lG ) ; lE . b = lF ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d lE = an ( lu , lD , lw , lx , lv , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"float lI = ( dot ( cross ( lE . e , lE . c ) , lE . d ) < 0.0 ) ? - 1.0 : 1.0 ; kH = vec4 ( lE . c , lI ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( lE . a , lE . b , lv ) ;".split(" ")}]}}]},{type:"textline",b:"kF = lE . a ; kG = lE . e ; kE = u_camera_eye - lE . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",
a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kI = lE . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["kI","=","a_color",";"]}]}}]},{type:"textline",b:"vec4 lJ = u_view_matrix * vec4 ( lE . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),
group:{type:"group",a:[{type:"textline",b:["cL","=","lJ",";"]}]}}]},{type:"textline",b:"vec4 lK = u_proj_matrix * lJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"lK . xy += u_subpixel_jitter * lK . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gr","(","lK",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",
b:"gr ( lE . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:"float lL = lK . x ; float lM = lK . y ; float lN = lK . w ; cK . x = ( lL + lN ) / 2.0 ; cK . y = ( lM + lN ) / 2.0 ; cK . z = lN ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kJ = - lJ . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position",
"=","lK",";","}"]}]};a["nodes.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_ANIM_VALUES",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",
b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",
b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ; uniform int u_shadow_lamp_id ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_reflectmap ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_ANIM_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_anim_values [ NUM_ANIM_VALUES ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 kF ; varying vec4 cL ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","kH",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"textline",
b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 lu = vec3 ( ZERO_VALUE_NODES ) ; vec3 lv = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 lz ( in vec3 lw , in float lx ) { vec3 ly = lu ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"ly = lt ( cK , lw . xz * lx ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ly = texture2D ( u_refractmap , cK . xy / cK . z ) . rgb ; gy ( ly ) ;".split(" ")}]}}]},{type:"textline",b:["return","ly",";","}"]}]}}]},{type:"textline",b:"vec3 lC ( float lA , vec3 lB ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , lB ) . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"return mix ( u_horizon_color , u_zenith_color , lA ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 lJ ( vec3 lD ) { vec4 lE = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; vec4 lF = mix ( vec4 ( lD . bg , lE . wz ) , vec4 ( lD . gb , lE . xy ) , step ( lD . b , lD . g ) ) ; vec4 lG = mix ( vec4 ( lF . xyw , lD . r ) , vec4 ( lD . r , lF . yzx ) , step ( lF . x , lD . r ) ) ; float lH = lG . x - min ( lG . w , lG . y ) ; float lI = 1.0e-10 ; return vec3 ( abs ( lG . z + ( lG . w - lG . y ) / ( 6.0 * lH + lI ) ) , lH / ( lG . x + lI ) , lG . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 lN ( vec3 lK ) { vec4 lL = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; vec3 lM = abs ( fract ( vec3 ( lK . r , lK . r , lK . r ) + lL . xyz ) * 6.0 - lL . www ) ; return lK . b * mix ( lL . xxx , clamp ( lM - lL . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , lK . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_B4W_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 lP ( vec2 lO ) { return vec3 ( lO * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_TEXTURE_COLOR || USE_NODE_TEXTURE_NORMAL || USE_NODE_TEXTURE_COLOR2 || USE_NODE_TEXTURE_NORMAL2 || USE_NODE_TEXTURE_COLOR3 || USE_NODE_TEXTURE_NORMAL3 || USE_NODE_TEXTURE_NORMAL4 || USE_NODE_TEXTURE_COLOR4 || USE_NODE_B4W_PARALLAX".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lR ( vec3 lQ ) { return vec2 ( lQ . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},{type:"node",name:"CAMERA",k:[{type:"node_out",name:"mz",qualifier:["vec3"],e:!0},{type:"node_out",name:"mA",qualifier:["float"],e:!0},{type:"node_out",name:"mB",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mz"],f:[{type:"textline",b:"mz = normalize ( mp . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_mA"],f:[{type:"textline",b:"mA = abs ( mp . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mB"],f:[{type:"textline",b:"mB = length ( mp . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",k:[{type:"node_in",name:"mC",qualifier:["float"],e:!1},{type:"node_in",name:"mD",qualifier:["float"],e:!1},{type:"node_in",name:"mE",qualifier:["float"],e:!1},{type:"node_out",name:"mF",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mF = vec3 ( mC , mD , mE ) ;".split(" ")}]},
{type:"node",name:"COMBHSV",k:[{type:"node_in",name:"mG",qualifier:["float"],e:!1},{type:"node_in",name:"mH",qualifier:["float"],e:!1},{type:"node_in",name:"mI",qualifier:["float"],e:!1},{type:"node_out",name:"mJ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mJ = lN ( vec3 ( mG , mH , mI ) ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_out",name:"mK",qualifier:["vec3"],e:!1},{type:"node_param",name:"lS",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"mK = lP ( lS ) ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC",k:[{type:"node_out",name:"mL",qualifier:["vec3"],e:!1},{type:"node_param",name:"lT",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["mL","=","lT",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_out",name:"mM",qualifier:["float"],e:!1},{type:"node_param",name:"lU",qualifier:["varying","float"]}],f:[{type:"textline",b:["mM","=","lU",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_out",name:"mN",qualifier:["float"],e:!1},{type:"node_out",name:"mO",
qualifier:["float"],e:!1},{type:"node_param",name:"lV",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"mN = lV [ 0 ] ; mO = lV [ 1 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_out",name:"mP",qualifier:["float"],e:!1},{type:"node_out",name:"mQ",qualifier:["float"],e:!1},{type:"node_out",name:"mR",qualifier:["float"],e:!1},{type:"node_param",name:"lW",qualifier:["varying","vec3"]}],f:[{type:"textline",b:"mP = lW [ 0 ] ; mQ = lW [ 1 ] ; mR = lW [ 2 ] ;".split(" ")}]},{type:"node",
name:"GEOMETRY_NO",k:[{type:"node_out",name:"mS",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mS","=","mi",";"]}]},{type:"node",name:"GEOMETRY_FB",k:[{type:"node_out",name:"mT",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mT = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",k:[{type:"node_out",name:"mU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mU","=","mn",";"]}]},{type:"node",name:"GEOMETRY_GL",k:[{type:"node_out",name:"mV",
qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mV = vec3 ( mo . r , - mo . b , mo . g ) ;".split(" ")}]},{type:"node",name:"HUE_SAT",k:[{type:"node_in",name:"mW",qualifier:["float"],e:!1},{type:"node_in",name:"mX",qualifier:["float"],e:!1},{type:"node_in",name:"mY",qualifier:["float"],e:!1},{type:"node_in",name:"mZ",qualifier:["float"],e:!1},{type:"node_in",name:"m_",qualifier:["vec3"],e:!1},{type:"node_out",name:"na",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ vec3 nb = lJ ( m_ ) ; nb [ 0 ] += ( mW - 0.5 ) ; if ( nb [ 0 ] > UNITY_VALUE_NODES ) nb [ 0 ] -= UNITY_VALUE_NODES ; else if ( nb [ 0 ] < ZERO_VALUE_NODES ) nb [ 0 ] += UNITY_VALUE_NODES ; nb *= vec3 ( UNITY_VALUE_NODES , mX , mY ) ; nb = mix ( lv , mix ( lu , nb , step ( lu , nb ) ) , step ( nb , lv ) ) ; na = mix ( m_ , lN ( nb ) , mZ ) ; }".split(" ")}]},
{type:"node",name:"INVERT",k:[{type:"node_in",name:"nc",qualifier:["float"],e:!1},{type:"node_in",name:"nd",qualifier:["vec3"],e:!1},{type:"node_out",name:"ne",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ne = mix ( nd , lv - nd , nc ) ;".split(" ")}]},{type:"node",name:"LAMP",k:[{type:"node_out",name:"nf",qualifier:["vec3"],e:!1},{type:"node_out",name:"ng",qualifier:["vec3"],e:!1},{type:"node_out",name:"nh",qualifier:["float"],e:!1},{type:"node_out",name:"ni",qualifier:["float"],e:!1},{type:"node_param",
name:"lX",qualifier:["const","float"]}],f:[{type:"textline",b:"{ const int nj = int ( lX ) ; nf = u_lamp_light_color_intensities [ nj ] ; vec4 nk = u_lamp_light_factors [ nj ] ; vec3 nl = u_lamp_light_directions [ nj ] ; vec3 nm = u_lamp_light_positions [ nj ] ; float nn = nk . z ; if ( nn != - UNITY_VALUE_NODES ) { ng = nm - kF ; nh = length ( ng ) ; ng = normalize ( ng ) ; ni = nn / ( nn + nh * nh ) ; float no = nk . x ; float np = nk . y ; if ( no > - UNITY_VALUE_NODES ) { float nq = dot ( ng , nl ) ; nq *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( nq - no ) / np ) ; ni *= nq ; } } else { ng = nl ; nh = length ( nm - kF ) ; ni = UNITY_VALUE_NODES ; } }".split(" ")}]},
{type:"node",name:"NORMAL",k:[{type:"node_in",name:"nr",qualifier:["vec3"],e:!1},{type:"node_out",name:"ns",qualifier:["vec3"],e:!0},{type:"node_out",name:"nt",qualifier:["float"],e:!0},{type:"node_param",name:"lY",qualifier:["vec3"]}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ns"],f:[{type:"textline",b:["ns","=","lY",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nt"],f:[{type:"textline",b:"nt = - dot ( nr , lY ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",
k:[{type:"node_in",name:"nu",qualifier:["vec3"],e:!1},{type:"node_out",name:"nv",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"nv = - ( u_view_matrix_frag * vec4 ( nu , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"MAPPING",k:[{type:"node_in",name:"nw",qualifier:["vec3"],e:!1},{type:"node_out",name:"nx",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["nx","=","nw",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",f:[{type:"textline",b:"nx = ( MAPPING_TRS_MATRIX * vec4 ( nx , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_SCALE",f:[{type:"textline",b:"nx = nx * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",f:[{type:"textline",b:"nx = nx + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",f:[{type:"textline",b:"nx = max ( nx , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",f:[{type:"textline",
b:"nx = min ( nx , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],f:[{type:"textline",b:"nx = normalize ( nx ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",k:[{type:"node_in",name:"ny",qualifier:["float"],e:!1},{type:"node_in",name:"nz",qualifier:["float"],e:!1},{type:"node_out",name:"nA",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nA = ny + nz ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",
b:"nA = clamp ( nA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",k:[{type:"node_in",name:"nB",qualifier:["float"],e:!1},{type:"node_in",name:"nC",qualifier:["float"],e:!1},{type:"node_out",name:"nD",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nD = nB - nC ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nD = clamp ( nD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_MULTIPLY",k:[{type:"node_in",name:"nE",qualifier:["float"],e:!1},{type:"node_in",name:"nF",qualifier:["float"],e:!1},{type:"node_out",name:"nG",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nG = nE * nF ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nG = clamp ( nG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",k:[{type:"node_in",name:"nH",qualifier:["float"],e:!1},{type:"node_in",name:"nI",
qualifier:["float"],e:!1},{type:"node_out",name:"nJ",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nJ = ( nI != ZERO_VALUE_NODES ) ? nH / nI : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nJ = clamp ( nJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SINE",k:[{type:"node_in",name:"nK",qualifier:["float"],e:!1},{type:"node_in",name:"nL",qualifier:["float"],e:!1},{type:"node_out",name:"nM",
qualifier:["float"],e:!1}],f:[{type:"textline",b:"nM = sin ( nK ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nM = clamp ( nM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nL",";"]}]},{type:"node",name:"MATH_COSINE",k:[{type:"node_in",name:"nN",qualifier:["float"],e:!1},{type:"node_in",name:"nO",qualifier:["float"],e:!1},{type:"node_out",name:"nP",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nP = cos ( nN ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nP = clamp ( nP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nO",";"]}]},{type:"node",name:"MATH_TANGENT",k:[{type:"node_in",name:"nQ",qualifier:["float"],e:!1},{type:"node_in",name:"nR",qualifier:["float"],e:!1},{type:"node_out",name:"nS",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nS = tan ( nQ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],
f:[{type:"textline",b:"nS = clamp ( nS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nR",";"]}]},{type:"node",name:"MATH_ARCSINE",k:[{type:"node_in",name:"nT",qualifier:["float"],e:!1},{type:"node_in",name:"nU",qualifier:["float"],e:!1},{type:"node_out",name:"nV",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nV = ( nT <= UNITY_VALUE_NODES && nT >= - UNITY_VALUE_NODES ) ? asin ( nT ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nV = clamp ( nV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nU",";"]}]},{type:"node",name:"MATH_ARCCOSINE",k:[{type:"node_in",name:"nW",qualifier:["float"],e:!1},{type:"node_in",name:"nX",qualifier:["float"],e:!1},{type:"node_out",name:"nY",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nY = ( nW <= UNITY_VALUE_NODES && nW >= - UNITY_VALUE_NODES ) ? acos ( nW ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nY = clamp ( nY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nX",";"]}]},{type:"node",name:"MATH_ARCTANGENT",k:[{type:"node_in",name:"nZ",qualifier:["float"],e:!1},{type:"node_in",name:"n_",qualifier:["float"],e:!1},{type:"node_out",name:"oa",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oa = atan ( nZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",
b:"oa = clamp ( oa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["n_",";"]}]},{type:"node",name:"MATH_POWER",k:[{type:"node_in",name:"ob",qualifier:["float"],e:!1},{type:"node_in",name:"oc",qualifier:["float"],e:!1},{type:"node_out",name:"od",qualifier:["float"],e:!1}],f:[{type:"textline",b:"if ( ob < ZERO_VALUE_NODES || ob == ZERO_VALUE_NODES && oc == ZERO_VALUE_NODES ) od = ZERO_VALUE_NODES ; else od = pow ( ob , oc ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"od = clamp ( od , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",k:[{type:"node_in",name:"oe",qualifier:["float"],e:!1},{type:"node_in",name:"of",qualifier:["float"],e:!1},{type:"node_out",name:"og",qualifier:["float"],e:!1}],f:[{type:"textline",b:"og = ( oe > ZERO_VALUE_NODES && of > ZERO_VALUE_NODES ) ? log2 ( oe ) / log2 ( of ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"og = clamp ( og , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",k:[{type:"node_in",name:"oh",qualifier:["float"],e:!1},{type:"node_in",name:"oi",qualifier:["float"],e:!1},{type:"node_out",name:"oj",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oj = min ( oh , oi ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oj = clamp ( oj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MAXIMUM",k:[{type:"node_in",name:"ok",qualifier:["float"],e:!1},{type:"node_in",name:"ol",qualifier:["float"],e:!1},{type:"node_out",name:"om",qualifier:["float"],e:!1}],f:[{type:"textline",b:"om = max ( ok , ol ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"om = clamp ( om , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",k:[{type:"node_in",name:"on",qualifier:["float"],e:!1},
{type:"node_in",name:"oo",qualifier:["float"],e:!1},{type:"node_out",name:"op",qualifier:["float"],e:!1}],f:[{type:"textline",b:"op = floor ( on + 0.5 ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"op = clamp ( op , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oo",";"]}]},{type:"node",name:"MATH_LESS_THAN",k:[{type:"node_in",name:"oq",qualifier:["float"],e:!1},{type:"node_in",name:"or",qualifier:["float"],e:!1},
{type:"node_out",name:"os",qualifier:["float"],e:!1}],f:[{type:"textline",b:"os = ( oq < or ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"os = clamp ( os , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",k:[{type:"node_in",name:"ot",qualifier:["float"],e:!1},{type:"node_in",name:"ou",qualifier:["float"],e:!1},{type:"node_out",name:"ov",qualifier:["float"],
e:!1}],f:[{type:"textline",b:"ov = ( ot > ou ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ov = clamp ( ov , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",k:[{type:"node_in",name:"ow",qualifier:["float"],e:!1},{type:"node_in",name:"ox",qualifier:["float"],e:!1},{type:"node_out",name:"oy",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oy = abs ( ox ) > 0.000001 ? mod ( ow , ox ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oy = clamp ( oy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ABSOLUTE",k:[{type:"node_in",name:"oz",qualifier:["float"],e:!1},{type:"node_in",name:"oA",qualifier:["float"],e:!1},{type:"node_out",name:"oB",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oB = abs ( oz ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oB = clamp ( oB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["oA",";"]}]},{type:"node",name:"MIX_RGB_MIX",k:[{type:"node_in",name:"oC",qualifier:["float"],e:!1},{type:"node_in",name:"oD",qualifier:["vec3"],e:!1},{type:"node_in",name:"oE",qualifier:["vec3"],e:!1},{type:"node_out",name:"oF",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oG = clamp ( oC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oF = mix ( oD , oE , oG ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oF = clamp ( oF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_ADD",k:[{type:"node_in",name:"oH",qualifier:["float"],e:!1},{type:"node_in",name:"oI",qualifier:["vec3"],e:!1},{type:"node_in",name:"oJ",qualifier:["vec3"],e:!1},{type:"node_out",name:"oK",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oL = clamp ( oH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oK = mix ( oI , oI + oJ , oL ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oK = clamp ( oK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_MULTIPLY",k:[{type:"node_in",name:"oM",qualifier:["float"],e:!1},{type:"node_in",name:"oN",qualifier:["vec3"],e:!1},{type:"node_in",name:"oO",qualifier:["vec3"],e:!1},{type:"node_out",name:"oP",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oQ = clamp ( oM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oP = mix ( oN , oN * oO , oQ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oP = clamp ( oP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SUBTRACT",k:[{type:"node_in",name:"oR",qualifier:["float"],e:!1},{type:"node_in",name:"oS",qualifier:["vec3"],e:!1},{type:"node_in",name:"oT",qualifier:["vec3"],e:!1},{type:"node_out",name:"oU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oV = clamp ( oR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oU = mix ( oS , oS - oT , oV ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oU = clamp ( oU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SCREEN",k:[{type:"node_in",name:"oW",qualifier:["float"],e:!1},{type:"node_in",name:"oX",qualifier:["vec3"],e:!1},{type:"node_in",name:"oY",qualifier:["vec3"],e:!1},{type:"node_out",name:"oZ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float o_ = clamp ( oW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pa = UNITY_VALUE_NODES - o_ ; oZ = lv - ( vec3 ( pa ) + o_ * ( lv - oY ) ) * ( lv - oX ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oZ = clamp ( oZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DIVIDE",k:[{type:"node_in",name:"pb",qualifier:["float"],e:!1},{type:"node_in",name:"pc",qualifier:["vec3"],e:!1},{type:"node_in",name:"pd",qualifier:["vec3"],e:!1},{type:"node_out",name:"pe",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pf = clamp ( pb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pg = UNITY_VALUE_NODES - pf ; pd += step ( pd , lu ) ; pe = pg * pc + pf * pc / pd ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pe = clamp ( pe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",k:[{type:"node_in",name:"ph",qualifier:["float"],e:!1},{type:"node_in",name:"pi",qualifier:["vec3"],e:!1},{type:"node_in",name:"pj",qualifier:["vec3"],e:!1},{type:"node_out",name:"pk",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pl = clamp ( ph , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pk = mix ( pi , abs ( pi - pj ) , pl ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pk = clamp ( pk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DARKEN",k:[{type:"node_in",name:"pm",qualifier:["float"],e:!1},{type:"node_in",name:"pn",qualifier:["vec3"],e:!1},{type:"node_in",name:"po",qualifier:["vec3"],e:!1},{type:"node_out",name:"pp",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pq = clamp ( pm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pp = min ( pn . rgb , po . rgb * pq ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pp = clamp ( pp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_LIGHTEN",k:[{type:"node_in",name:"pr",qualifier:["float"],e:!1},{type:"node_in",name:"ps",qualifier:["vec3"],e:!1},{type:"node_in",name:"pt",qualifier:["vec3"],e:!1},{type:"node_out",name:"pu",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pv = clamp ( pr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pu = max ( ps . rgb , pt . rgb * pv ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pu = clamp ( pu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_OVERLAY",k:[{type:"node_in",name:"pw",qualifier:["float"],e:!1},{type:"node_in",name:"px",qualifier:["vec3"],e:!1},{type:"node_in",name:"py",qualifier:["vec3"],e:!1},{type:"node_out",name:"pz",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pA = clamp ( pw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pB = UNITY_VALUE_NODES - pA ; vec3 pC = vec3 ( pB ) ; pz = mix ( px * ( pC + 2.0 * pA * py ) , lv - ( pC + 2.0 * pA * ( lv - py ) ) * ( lv - px ) , step ( 0.5 , px ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pz = clamp ( pz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DODGE",k:[{type:"node_in",name:"pD",qualifier:["float"],e:!1},{type:"node_in",name:"pE",qualifier:["vec3"],e:!1},{type:"node_in",name:"pF",qualifier:["vec3"],e:!1},{type:"node_out",name:"pG",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pH = clamp ( pD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pI = lv - pH * pF ; vec3 pJ = pE / ( pI + step ( pI , lu ) ) ; pG = ( lv - step ( pE , lu ) ) * mix ( mix ( lv , pJ , step ( pJ , lv ) ) , lv , step ( pI , lu ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pG = clamp ( pG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_BURN",k:[{type:"node_in",name:"pK",qualifier:["float"],e:!1},{type:"node_in",name:"pL",qualifier:["vec3"],e:!1},{type:"node_in",name:"pM",qualifier:["vec3"],e:!1},{type:"node_out",name:"pN",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pO = clamp ( pK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pP = lv - pO * ( lv - pM ) ; vec3 pQ = lv - ( lv - pL ) / ( pP + step ( pP , lu ) ) ; pN = mix ( mix ( lu , mix ( lv , pQ , step ( pQ , lv ) ) , step ( ZERO_VALUE_NODES , pQ ) ) , lu , step ( pP , lu ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pN = clamp ( pN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_HUE",k:[{type:"node_in",name:"pR",qualifier:["float"],e:!1},{type:"node_in",name:"pS",qualifier:["vec3"],e:!1},{type:"node_in",name:"pT",qualifier:["vec3"],e:!1},{type:"node_out",name:"pU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pV = clamp ( pR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pW , pX , pY ; pU = pS ; pX = lJ ( pT ) ; if ( pX . y != ZERO_VALUE_NODES ) { pW = lJ ( pU ) ; pW . x = pX . x ; pY = lN ( pW ) ; pU = mix ( pU , pY , pV ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pU = clamp ( pU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SATURATION",k:[{type:"node_in",name:"pZ",qualifier:["float"],e:!1},{type:"node_in",name:"p_",qualifier:["vec3"],e:!1},{type:"node_in",name:"qa",qualifier:["vec3"],e:!1},{type:"node_out",name:"qb",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qc = clamp ( pZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qd = UNITY_VALUE_NODES - qc ; qb = p_ ; vec3 qe , qf ; qe = lJ ( qb ) ; if ( qe . y != ZERO_VALUE_NODES ) { qf = lJ ( qa ) ; qe . y = qd * qe . y + qc * qf . y ; qb = lN ( qe ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qb = clamp ( qb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_VALUE",k:[{type:"node_in",name:"qg",qualifier:["float"],e:!1},{type:"node_in",name:"qh",qualifier:["vec3"],e:!1},{type:"node_in",name:"qi",qualifier:["vec3"],e:!1},{type:"node_out",name:"qj",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qk = clamp ( qg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float ql = UNITY_VALUE_NODES - qk ; vec3 qm , qn ; qm = lJ ( qh ) ; qn = lJ ( qi ) ; qm . z = ql * qm . z + qk * qn . z ; qj = lN ( qm ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qj = clamp ( qj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_COLOR",k:[{type:"node_in",name:"qo",qualifier:["float"],e:!1},{type:"node_in",name:"qp",qualifier:["vec3"],e:!1},{type:"node_in",name:"qq",qualifier:["vec3"],e:!1},{type:"node_out",name:"qr",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qs = clamp ( qo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qt , qu , qv ; qr = qp ; qu = lJ ( qq ) ; if ( qu . y != ZERO_VALUE_NODES ) { qt = lJ ( qr ) ; qt . x = qu . x ; qt . y = qu . y ; qv = lN ( qt ) ; qr = mix ( qr , qv , qs ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qr = clamp ( qr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",k:[{type:"node_in",name:"qw",qualifier:["float"],e:!1},{type:"node_in",name:"qx",qualifier:["vec3"],e:!1},{type:"node_in",name:"qy",qualifier:["vec3"],e:!1},{type:"node_out",name:"qz",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qA = clamp ( qw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qB = UNITY_VALUE_NODES - qA ; vec3 qC = qy + qx - qy * qx ; qz = qx * ( vec3 ( qB ) + vec3 ( qA ) * ( ( lv - qx ) * qy + qC ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qz = clamp ( qz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",k:[{type:"node_in",name:"qD",qualifier:["float"],e:!1},{type:"node_in",name:"qE",qualifier:["vec3"],e:!1},{type:"node_in",name:"qF",qualifier:["vec3"],e:!1},{type:"node_out",name:"qG",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qH = clamp ( qD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qG = clamp ( qE + qH * ( 2.0 * qF - lv ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qG = clamp ( qG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"OUTPUT",k:[{type:"node_in",name:"qI",qualifier:["vec3"],e:!1},{type:"node_in",name:"qJ",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mt = qI ; my = qJ ;".split(" ")}]},{type:"node",name:"MATERIAL",k:[{type:"node_in",name:"qK",qualifier:["vec3"],e:!1},{type:"node_in",name:"qL",qualifier:["float"],
e:!1},{type:"node_in",name:"qM",qualifier:["vec3"],e:!1},{type:"node_in",name:"qN",qualifier:["vec3"],e:!0},{type:"node_out",name:"qO",qualifier:["vec3"],e:!0},{type:"node_out",name:"qP",qualifier:["float"],e:!0},{type:"node_out",name:"qQ",qualifier:["vec3"],e:!0},{type:"node_param",name:"lZ",qualifier:["const","vec2"]},{type:"node_param",name:"l_",qualifier:["const","vec3"]}],f:[{type:"textline",b:"{ vec3 qR = clamp ( qK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qS = l_ [ 0 ] * clamp ( qM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"vec3 qT = normalize ( qN ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["vec3","qT","=","mi",";"]}]}]},{type:"textline",b:["hw","qU",";"]},{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT"],f:[{type:"textline",b:"vec3 qV = mq * qR ; float qW = 0.5 * qT . y + 0.5 ; vec3 qX = ms * u_environment_energy * lC ( qW , qT ) ; float qY = fs ( qR ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"vec2 qZ = vec2 ( lZ [ 0 ] , lZ [ 1 ] ) ; vec2 q_ = vec2 ( l_ [ 1 ] , l_ [ 2 ] ) ; qU = jY ( qV , qX , qR , qS , mo , qT , mn , q_ , qZ , qY , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) , u_shadow_lamp_id ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:"qU = kc ( qV , qX , qR ) ;".split(" ")}]}]},{type:"textline",b:["mx","=","qY",";"]}]},
{type:"node_else",f:[{type:"textline",b:"qU . a = vec4 ( qR , ZERO_VALUE_NODES ) ; qU . b = lu ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qO"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"qO = qU . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["qO","=","lu",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"qO += qU . b ;".split(" ")}]}]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_qP"],f:[{type:"textline",b:"qP = clamp ( qL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"qP += qU . a . a * qS . r * mr ; qP = clamp ( qP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qQ"],f:[{type:"textline",b:["qQ","=","qT",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],
f:[{type:"textline",b:"mu = qU . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["mu","=","lu",";"]}]}]},{type:"textline",b:["mv","=","qT",";","}"]}]},{type:"node",name:"MATERIAL_EXT",k:[{type:"node_in",name:"ra",qualifier:["vec3"],e:!1},{type:"node_in",name:"rb",qualifier:["float"],e:!1},{type:"node_in",name:"rc",qualifier:["vec3"],e:!1},{type:"node_in",name:"rd",qualifier:["vec3"],e:!0},{type:"node_in",name:"re",qualifier:["float"],e:!1},{type:"node_in",name:"rf",qualifier:["float"],
e:!1},{type:"node_in",name:"rg",qualifier:["vec4"],e:!1},{type:"node_in",name:"rh",qualifier:["float"],e:!1},{type:"node_in",name:"ri",qualifier:["float"],e:!1},{type:"node_out",name:"rj",qualifier:["vec3"],e:!0},{type:"node_out",name:"rk",qualifier:["float"],e:!0},{type:"node_out",name:"rl",qualifier:["vec3"],e:!0},{type:"node_out",name:"rm",qualifier:["vec3"],e:!0},{type:"node_out",name:"rn",qualifier:["vec3"],e:!0},{type:"node_param",name:"ma",qualifier:["const","vec2"]},{type:"node_param",name:"mb",
qualifier:["const","vec3"]}],f:[{type:"textline",b:"{ vec3 ro = clamp ( ra , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 rp = mb [ 0 ] * clamp ( rc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"vec3 rq = normalize ( rd ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["vec3","rq","=","mi",";"]}]}]},{type:"textline",b:["hw","rr",";"]},{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT"],
f:[{type:"textline",b:"float rs = fs ( ro ) ; vec3 rt = re * ro ; float ru = 0.5 * rq . y + 0.5 ; vec3 rv = ms * u_environment_energy * lC ( ru , rq ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"vec2 rw = vec2 ( ma [ 0 ] , ma [ 1 ] ) ; vec2 rx = vec2 ( mb [ 1 ] , mb [ 2 ] ) ; rr = jY ( rt , rv , ro , rp , mo , rq , mn , rx , rw , rs , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , rf , rg , u_shadow_lamp_id ) ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",b:"rr = kc ( rt , rv , ro ) ;".split(" ")}]}]},{type:"textline",b:["mx","=","rs",";"]}]},{type:"node_else",f:[{type:"textline",b:"rr . a = vec4 ( ro , ZERO_VALUE_NODES ) ; rr . b = lu ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rj"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"rj = rr . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["rj","=","lu",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],f:[{type:"textline",b:"lf ( rj , mn , rq , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , rh ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"rj += rr . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rk"],f:[{type:"textline",b:"rk = clamp ( rb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],
f:[{type:"textline",b:"rk += rr . a . a * rp . r * ri ; rk = clamp ( rk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rl"],f:[{type:"textline",b:["rl","=","rq",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rm"],f:[{type:"textline",b:"rm = rr . a . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rn"],f:[{type:"textline",b:"rn = rr . b ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"mu = rr . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["mu","=","lu",";"]}]}]},{type:"textline",b:["mv","=","rq",";","}"]}]},{type:"node",name:"RGB",k:[{type:"node_out",name:"ry",qualifier:["vec3"],e:!1},{type:"node_param",name:"mc",qualifier:["vec3"]}],f:[{type:"textline",b:["ry","=","mc",";"]}]},{type:"node",name:"RGBTOBW",k:[{type:"node_in",name:"rz",qualifier:["vec3"],e:!1},{type:"node_out",name:"rA",qualifier:["float"],e:!1}],
f:[{type:"textline",b:"rA = rz . r * 0.35 + rz . g * 0.45 + rz . b * 0.2 ;".split(" ")}]},{type:"node",name:"SEPRGB",k:[{type:"node_in",name:"rB",qualifier:["vec3"],e:!1},{type:"node_out",name:"rC",qualifier:["float"],e:!0},{type:"node_out",name:"rD",qualifier:["float"],e:!0},{type:"node_out",name:"rE",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rC"],f:[{type:"textline",b:"rC = rB . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rD"],
f:[{type:"textline",b:"rD = rB . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rE"],f:[{type:"textline",b:"rE = rB . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",k:[{type:"node_in",name:"rF",qualifier:["vec3"],e:!1},{type:"node_out",name:"rG",qualifier:["float"],e:!0},{type:"node_out",name:"rH",qualifier:["float"],e:!0},{type:"node_out",name:"rI",qualifier:["float"],e:!0}],f:[{type:"textline",b:"{ vec3 rJ = lJ ( rF ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_rG"],f:[{type:"textline",b:"rG = rJ . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rH"],f:[{type:"textline",b:"rH = rJ . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rI"],f:[{type:"textline",b:"rI = rJ . b ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"SQUEEZE",k:[{type:"node_in",name:"rK",qualifier:["float"],e:!1},{type:"node_in",name:"rL",qualifier:["float"],e:!1},{type:"node_in",name:"rM",qualifier:["float"],
e:!1},{type:"node_out",name:"rN",qualifier:["float"],e:!1}],f:[{type:"textline",b:"rN = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( rK - rM ) * rL ) ) ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",k:[{type:"node_in",name:"rO",qualifier:["vec3"],e:!1},{type:"node_out",name:"rP",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rP = max ( lu , rO ) ; rP = pow ( rP , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",k:[{type:"node_in",name:"rQ",
qualifier:["vec3"],e:!1},{type:"node_out",name:"rR",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rR = max ( lu , rQ ) ; rR = pow ( rR , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_COLOR",k:[{type:"node_in",name:"rS",qualifier:["vec3"],e:!1},{type:"node_out",name:"rT",qualifier:["vec3"],e:!1},{type:"node_out",name:"rU",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 rV = texture2D ( node_TEXTURE_COLOR_var_texture , lR ( rS ) ) ; rT = rV . xyz ; gy ( rT ) ; rU = rV . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_NORMAL",k:[{type:"node_in",name:"rW",qualifier:["vec3"],e:!1},{type:"node_out",name:"rX",qualifier:["vec3"],e:!1},{type:"node_out",name:"rY",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 rZ = texture2D ( node_TEXTURE_NORMAL_var_texture , lR ( rW ) ) ; mw = rZ . xyz - 0.5 ; rX = normalize ( ml * mw ) ; rY = rZ . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_ENVIRONMENT",
k:[{type:"node_in",name:"r_",qualifier:["vec3"],e:!1},{type:"node_out",name:"sa",qualifier:["vec3"],e:!0},{type:"node_out",name:"sb",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]}],f:[{type:"textline",b:"{ vec4 sc = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , r_ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sa"],f:[{type:"textline",b:"sa = sc . xyz ; gy ( sa ) ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_sb"],f:[{type:"textline",b:"sb = sc . w ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"TEXTURE_COLOR2",k:[{type:"node_in",name:"sd",qualifier:["vec3"],e:!1},{type:"node_in",name:"se",qualifier:["vec3"],e:!1},{type:"node_out",name:"sf",qualifier:["vec3"],e:!1},{type:"node_out",name:"sg",qualifier:["float"],e:!1},{type:"node_out",name:"sh",qualifier:["vec3"],e:!1},{type:"node_out",name:"si",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_COLOR2_var_texture",
qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sj = texture2D ( node_TEXTURE_COLOR2_var_texture , lR ( sd ) ) ; sf = sj . xyz ; gy ( sf ) ; sg = sj . w ; sj = texture2D ( node_TEXTURE_COLOR2_var_texture , lR ( se ) ) ; sh = sj . xyz ; gy ( sh ) ; si = sj . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_NORMAL2",k:[{type:"node_in",name:"sk",qualifier:["vec3"],e:!1},{type:"node_in",name:"sl",qualifier:["vec3"],e:!1},{type:"node_out",name:"sm",qualifier:["vec3"],e:!1},{type:"node_out",
name:"sn",qualifier:["float"],e:!1},{type:"node_out",name:"so",qualifier:["vec3"],e:!1},{type:"node_out",name:"sp",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL2_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sq = texture2D ( node_TEXTURE_NORMAL2_var_texture , lR ( sk ) ) ; mw = sq . xyz - 0.5 ; sm = normalize ( ml * mw ) ; sn = sq . w ; sq = texture2D ( node_TEXTURE_NORMAL2_var_texture , lR ( sl ) ) ; mw = sq . xyz - 0.5 ; so = normalize ( ml * mw ) ; sp = sq . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_COLOR3",k:[{type:"node_in",name:"sr",qualifier:["vec3"],e:!1},{type:"node_in",name:"ss",qualifier:["vec3"],e:!1},{type:"node_in",name:"st",qualifier:["vec3"],e:!1},{type:"node_out",name:"su",qualifier:["vec3"],e:!1},{type:"node_out",name:"sv",qualifier:["float"],e:!1},{type:"node_out",name:"sw",qualifier:["vec3"],e:!1},{type:"node_out",name:"sx",qualifier:["float"],e:!1},{type:"node_out",name:"sy",qualifier:["vec3"],e:!1},{type:"node_out",name:"sz",qualifier:["float"],e:!1},
{type:"node_param",name:"node_TEXTURE_COLOR3_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sA = texture2D ( node_TEXTURE_COLOR3_var_texture , lR ( sr ) ) ; su = sA . xyz ; gy ( su ) ; sv = sA . w ; sA = texture2D ( node_TEXTURE_COLOR3_var_texture , lR ( ss ) ) ; sw = sA . xyz ; gy ( sw ) ; sx = sA . w ; sA = texture2D ( node_TEXTURE_COLOR3_var_texture , lR ( st ) ) ; sy = sA . xyz ; gy ( sy ) ; sz = sA . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_COLOR4",k:[{type:"node_in",
name:"sB",qualifier:["vec3"],e:!1},{type:"node_in",name:"sC",qualifier:["vec3"],e:!1},{type:"node_in",name:"sD",qualifier:["vec3"],e:!1},{type:"node_in",name:"sE",qualifier:["vec3"],e:!1},{type:"node_out",name:"sF",qualifier:["vec3"],e:!1},{type:"node_out",name:"sG",qualifier:["float"],e:!1},{type:"node_out",name:"sH",qualifier:["vec3"],e:!1},{type:"node_out",name:"sI",qualifier:["float"],e:!1},{type:"node_out",name:"sJ",qualifier:["vec3"],e:!1},{type:"node_out",name:"sK",qualifier:["float"],e:!1},
{type:"node_out",name:"sL",qualifier:["vec3"],e:!1},{type:"node_out",name:"sM",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_COLOR4_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sN = texture2D ( node_TEXTURE_COLOR4_var_texture , lR ( sB ) ) ; sF = sN . xyz ; gy ( sF ) ; sG = sN . w ; sN = texture2D ( node_TEXTURE_COLOR4_var_texture , lR ( sC ) ) ; sH = sN . xyz ; gy ( sH ) ; sI = sN . w ; sN = texture2D ( node_TEXTURE_COLOR4_var_texture , lR ( sD ) ) ; sJ = sN . xyz ; gy ( sJ ) ; sK = sN . w ; sN = texture2D ( node_TEXTURE_COLOR4_var_texture , lR ( sE ) ) ; sL = sN . xyz ; gy ( sL ) ; sM = sN . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_NORMAL3",k:[{type:"node_in",name:"sO",qualifier:["vec3"],e:!1},{type:"node_in",name:"sP",qualifier:["vec3"],e:!1},{type:"node_in",name:"sQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"sR",qualifier:["vec3"],e:!1},{type:"node_out",name:"sS",qualifier:["float"],e:!1},{type:"node_out",name:"sT",qualifier:["vec3"],e:!1},{type:"node_out",name:"sU",qualifier:["float"],e:!1},{type:"node_out",name:"sV",qualifier:["vec3"],e:!1},{type:"node_out",name:"sW",qualifier:["float"],
e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL3_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sX = texture2D ( node_TEXTURE_NORMAL3_var_texture , lR ( sO ) ) ; mw = sX . xyz - 0.5 ; sR = normalize ( ml * mw ) ; sS = sX . w ; sX = texture2D ( node_TEXTURE_NORMAL3_var_texture , lR ( sP ) ) ; mw = sX . xyz - 0.5 ; sT = normalize ( ml * mw ) ; sU = sX . w ; sX = texture2D ( node_TEXTURE_NORMAL3_var_texture , lR ( sQ ) ) ; mw = sX . xyz - 0.5 ; sV = normalize ( ml * mw ) ; sW = sX . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_NORMAL4",k:[{type:"node_in",name:"sY",qualifier:["vec3"],e:!1},{type:"node_in",name:"sZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"s_",qualifier:["vec3"],e:!1},{type:"node_in",name:"ta",qualifier:["vec3"],e:!1},{type:"node_out",name:"tb",qualifier:["vec3"],e:!1},{type:"node_out",name:"tc",qualifier:["float"],e:!1},{type:"node_out",name:"td",qualifier:["vec3"],e:!1},{type:"node_out",name:"te",qualifier:["float"],e:!1},{type:"node_out",name:"tf",qualifier:["vec3"],e:!1},
{type:"node_out",name:"tg",qualifier:["float"],e:!1},{type:"node_out",name:"th",qualifier:["vec3"],e:!1},{type:"node_out",name:"ti",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL4_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 tj = texture2D ( node_TEXTURE_NORMAL4_var_texture , lR ( sY ) ) ; mw = tj . xyz - 0.5 ; tb = normalize ( ml * mw ) ; tc = tj . w ; tj = texture2D ( node_TEXTURE_NORMAL4_var_texture , lR ( sZ ) ) ; mw = tj . xyz - 0.5 ; td = normalize ( ml * mw ) ; te = tj . w ; tj = texture2D ( node_TEXTURE_NORMAL4_var_texture , lR ( s_ ) ) ; mw = tj . xyz - 0.5 ; tf = normalize ( ml * mw ) ; tg = tj . w ; tj = texture2D ( node_TEXTURE_NORMAL4_var_texture , lR ( ta ) ) ; mw = tj . xyz - 0.5 ; th = normalize ( ml * mw ) ; ti = tj . w ; }".split(" ")}]},
{type:"node",name:"VALUE",k:[{type:"node_out",name:"tk",qualifier:["float"],e:!1},{type:"node_param",name:"md",qualifier:["const","float"]}],f:[{type:"textline",b:["tk","=","md",";"]}]},{type:"node",name:"ANIM_VALUE",k:[{type:"node_out",name:"tl",qualifier:["float"],e:!1},{type:"node_param",name:"me",qualifier:["const","int"]}],f:[{type:"textline",b:"tl = u_anim_values [ me ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",k:[{type:"node_in",name:"tm",qualifier:["vec3"],e:!1},{type:"node_in",name:"tn",
qualifier:["vec3"],e:!1},{type:"node_out",name:"to",qualifier:["vec3"],e:!1},{type:"node_out",name:"tp",qualifier:["float"],e:!0}],f:[{type:"textline",b:"to = tm + tn ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tp"],f:[{type:"textline",b:"tp = ( abs ( to [ 0 ] ) + abs ( to [ 1 ] ) + abs ( to [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_SUBTRACT",k:[{type:"node_in",name:"tq",qualifier:["vec3"],e:!1},{type:"node_in",name:"tr",qualifier:["vec3"],e:!1},{type:"node_out",
name:"ts",qualifier:["vec3"],e:!1},{type:"node_out",name:"tt",qualifier:["float"],e:!0}],f:[{type:"textline",b:"ts = tq - tr ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tt"],f:[{type:"textline",b:"tt = ( abs ( ts [ 0 ] ) + abs ( ts [ 1 ] ) + abs ( ts [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",k:[{type:"node_in",name:"tu",qualifier:["vec3"],e:!1},{type:"node_in",name:"tv",qualifier:["vec3"],e:!1},{type:"node_out",name:"tw",qualifier:["vec3"],
e:!1},{type:"node_out",name:"tx",qualifier:["float"],e:!0}],f:[{type:"textline",b:"tw = tu + tv ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tx"],f:[{type:"textline",b:"tx = length ( tw ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tw"],f:[{type:"textline",b:"tw = normalize ( tw ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",k:[{type:"node_in",name:"ty",qualifier:["vec3"],e:!1},{type:"node_in",name:"tz",qualifier:["vec3"],e:!1},
{type:"node_out",name:"tA",qualifier:["vec3"],e:!1},{type:"node_out",name:"tB",qualifier:["float"],e:!0}],f:[{type:"textline",b:["tA","=","lu",";"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tB"],f:[{type:"textline",b:"tB = dot ( ty , tz ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",k:[{type:"node_in",name:"tC",qualifier:["vec3"],e:!1},{type:"node_in",name:"tD",qualifier:["vec3"],e:!1},{type:"node_out",name:"tE",qualifier:["vec3"],e:!1},{type:"node_out",name:"tF",
qualifier:["float"],e:!0}],f:[{type:"textline",b:"tE = cross ( tC , tD ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tF"],f:[{type:"textline",b:"tF = length ( tE ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",k:[{type:"node_in",name:"tG",qualifier:["vec3"],e:!1},{type:"node_in",name:"tH",qualifier:["vec3"],e:!1},{type:"node_out",name:"tI",qualifier:["vec3"],e:!1},{type:"node_out",name:"tJ",qualifier:["float"],e:!0}],f:[{type:"textline",b:"tI = normalize ( tG ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tJ"],f:[{type:"textline",b:"tJ = length ( tG ) ;".split(" ")}]}]},{type:"textline",b:["tH",";"]}]},{type:"node",name:"B4W_REFLECT",k:[{type:"node_in",name:"tK",qualifier:["vec3"],e:!1},{type:"node_in",name:"tL",qualifier:["vec3"],e:!1},{type:"node_out",name:"tM",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"tM = reflect ( - tK , tL ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",k:[{type:"node_in",name:"tN",qualifier:["vec3"],e:!1},{type:"node_in",
name:"tO",qualifier:["float"],e:!1},{type:"node_in",name:"tP",qualifier:["const","float"],e:!1},{type:"node_in",name:"tQ",qualifier:["const","float"],e:!1},{type:"node_out",name:"tR",qualifier:["vec3"],e:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ float tS = length ( mp ) ; if ( tS < tQ ) { vec2 tT = lR ( tN ) ; float tU = clamp ( 0.5 * ( tQ - tS ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float tV = tO * tU ; vec3 tW = normalize ( mn * ml ) ; float tX = UNITY_VALUE_NODES / tP ; vec2 tY = tW . xy * tV / ( tP * tW . z ) ; float tZ = UNITY_VALUE_NODES ; float t_ = texture2D ( node_B4W_PARALLAX_var_texture , tT ) . a ; for ( float ua = 1.0 ; ua <= tP ; ua ++ ) { if ( t_ < tZ ) { tZ -= tX ; tT -= tY ; t_ = texture2D ( node_B4W_PARALLAX_var_texture , tT ) . a ; } } vec2 ub = tT + tY ; float uc = texture2D ( node_B4W_PARALLAX_var_texture , ub ) . a - ( tZ + tX ) ; float ud = t_ - tZ ; float ue = ud / ( ud - uc ) ; tT = ue * ub + ( UNITY_VALUE_NODES - ue ) * tT ; tR = lP ( tT ) ; } else tR = tN ; }".split(" ")}]},
{type:"node",name:"B4W_CLAMP",k:[{type:"node_in",name:"uf",qualifier:["vec3"],e:!1},{type:"node_out",name:"ug",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ug = clamp ( uf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",k:[{type:"node_in",name:"uh",qualifier:["vec3"],e:!1},{type:"node_in",name:"ui",qualifier:["float"],e:!1},{type:"node_out",name:"uj",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"uj = lz ( uh , ui ) ;".split(" ")}]},{type:"node",
name:"B4W_TRANSLUCENCY",k:[{type:"node_in",name:"uk",qualifier:["float"],e:!1},{type:"node_in",name:"ul",qualifier:["float"],e:!1},{type:"node_in",name:"um",qualifier:["float"],e:!1},{type:"node_in",name:"un",qualifier:["float"],e:!1},{type:"node_in",name:"uo",qualifier:["float"],e:!1},{type:"node_out",name:"up",qualifier:["float"],e:!0},{type:"node_out",name:"uq",qualifier:["vec4"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_up"],f:[{type:"textline",b:["up","=","uk",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_uq"],f:[{type:"textline",b:"uq = vec4 ( ul , um , un , uo ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",k:[{type:"node_out",name:"ur",qualifier:["float"],e:!1}],f:[{type:"textline",b:["ur","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",k:[{type:"node_in",name:"us",qualifier:["float"],e:!1},{type:"node_in",name:"ut",qualifier:["float"],e:!1},{type:"node_in",name:"uu",qualifier:["float"],e:!1},{type:"node_out",name:"uv",qualifier:["float"],
e:!1}],f:[{type:"textline",b:"uv = smoothstep ( ut , uu , us ) ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mf","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float mg = kF . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mh","=","kG",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) mh = mh ; else mh = - mh ;".split(" ")}]}}]},{type:"textline",b:"vec3 mi = normalize ( mh ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",
a:[{type:"textline",b:"vec3 mj = cross ( mh , kH . xyz ) * kH . w ; mat3 mk = mat3 ( kH . xyz , mj , mh ) ; mat3 ml = mk ;".split(" ")}]}}]},{type:"textline",b:"vec3 mm = u_camera_eye_frag - kF ; vec3 mn = normalize ( mm ) ; vec3 mo = kF ; vec4 mp = cL ; float mq = u_emit ; float mr = u_specular_alpha ; float ms = u_ambient ; vec3 mt ; vec3 mu ; vec3 mv ; vec3 mw ; float mx ; float my ;".split(" ")},{type:"nodes_main"},{type:"textline",b:"vec3 uw = mt ; float ux = my ;".split(" ")},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"uw = max ( uw - sqrt ( 0.01 * - min ( mg , ZERO_VALUE_NODES ) ) , 0.5 * uw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"kD ( uw , mg , u_time , mx , mv , u_sun_direction , mf , u_sun_quaternion , kF , length ( cL ) ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),
group:{type:"group",a:[{type:"textline",b:"float uy = clamp ( length ( u_sun_intensity ) + u_environment_energy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 uz = gS ( u_cube_fog , mn ) ; vec4 uA = vec4 ( uz , u_fog_color_density . a ) ; gy ( uA . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec4 uA = u_fog_color_density ; uA . rgb *= uy ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"hk ( uw , length ( cL ) , mn , u_cam_water_depth , u_underwater_fog_color_density , uA , mg , uy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( uw , length ( cL ) , uA ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( ux < 0.5 ) discard ; ux = UNITY_VALUE_NODES ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 uB = texture2DProj ( u_shadow_mask , cK ) . rg ; float uC = uB . g ; uw = vec3 ( uC ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","uw",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( uw , ux ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( uw , ux ) ; }".split(" ")}]};
a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",
b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",
b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",
";"]}]}}]},{type:"textline",b:"varying vec3 kF ; varying vec4 cL ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kH",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"lS",qualifier:["varying",
"vec2"]}],f:[{type:"textline",b:["lS","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",k:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"lX",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["lX","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"lY",
qualifier:["varying","float"]}],f:[{type:"textline",b:["lY","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"lZ",qualifier:["varying","vec2"]}],f:[{type:"textline",b:["lZ","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute",
"vec3"]},{type:"node_param",name:"l_",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["l_","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec3 ma = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mb = a_normal ; vec3 mc = vec3 ( a_tangent ) ; vec3 md = a_tangent [ 3 ] * cross ( mb , mc ) ;".split(" ")}]}},{type:"elif",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec3 mb = a_normal ; vec3 mc = vec3 ( 0.0 ) ; vec3 md = vec3 ( 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mb = vec3 ( 0.0 ) ; vec3 mc = vec3 ( 0.0 ) ; vec3 md = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"ma = mix ( ma , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"mb = mix ( mb , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 me = vec3 ( a_tangent ) ; vec3 mf = a_tangent_next [ 3 ] * cross ( a_normal_next , me ) ; mc = mix ( mc , me , u_va_frame_factor ) ; md = mix ( md , mf , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",
b:"bt ( ma , mc , md , mb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","mg","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mg = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 mh = ( u_model_matrix * vec4 ( mg , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],
group:{type:"group",a:[{type:"textline",b:"mat4 mi = ag ( u_camera_eye , mh , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 mi = aa ( u_camera_eye , mh , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 mj = ( u_model_matrix * vec4 ( mg , 1.0 ) ) . xyz ; mi = mi * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , mj ) ;".split(" ")}]}}]},
{type:"textline",b:"d mk = an ( ma - mg , mg , mc , md , mb , mi ) ; mk . b = mh ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d mk = an ( ma , mg , mc , md , mb , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( mk . a , mk . b , mb ) ;".split(" ")}]}}]},{type:"textline",b:"kF = mk . a ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"kG = mk . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"float ml = ( dot ( cross ( mk . e , mk . c ) , mk . d ) < 0.0 ) ? - 1.0 : 1.0 ; kH = vec4 ( mk . c , ml ) ;".split(" ")}]}}]},{type:"textline",b:"cL = u_view_matrix * vec4 ( mk . a , 1.0 ) ; vec4 mm = u_proj_matrix * cL ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"mm . xy += u_subpixel_jitter * mm . w ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gr","(","mm",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gr ( mk . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_B4W_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:"float mn = mm . x ; float mo = mm . y ; float mp = mm . w ; cK . x = ( mn + mp ) / 2.0 ; cK . y = ( mo + mp ) / 2.0 ; cK . z = mp ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kJ = - cL . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},{type:"textline",b:["gl_Position","=","mm",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float ma ; varying vec3 kI ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cL",";"]}]}}]},{type:"textline",b:"void main ( ) { float mb = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; float mc = smoothstep ( u_p_alpha_start , u_p_alpha_end , mb ) ; float md = u_diffuse_color . a * ma * ( 1.0 - clamp ( mc , 0.0 , 1.0 ) ) ; vec3 me = kI * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gL ( me , length ( cL ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","me",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( me , md ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( me , md ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",
b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",
b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float ma ; varying vec3 kI ; varying vec3 cL ;".split(" ")},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { mb mT ; mT = mS ( ) ; vec4 mU = u_view_matrix * vec4 ( mT . b , 1.0 ) ; gl_Position = u_proj_matrix * mU ; ma = mT . c ; kI = mT . d ; cL = mU . xyz ; float mV = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = mT . a * mV ; }".split(" ")}]};
a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float ma ; varying vec3 kI ; varying vec2 a ; varying vec3 kE ; varying vec3 kF ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 lu = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"vec4 lv = texture2D ( u_sampler , a ) ; gy ( lv . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lu . rgb = mix ( lu . rgb , lv . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lu . rgb *= mix ( vec3 ( 1.0 ) , lv . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"lu . a = lv . a ;".split(" ")}]}}]},{type:"textline",b:"lu . rgb *= kI ; vec3 lw = u_diffuse_intensity * lu . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"vec3 lx = u_emit * lu . rgb ; vec3 ly = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 lz = u_environment_energy * textureCube ( u_sky_texture , ly ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lA = 0.5 ; vec3 lz = u_environment_energy * mix ( u_horizon_color , u_zenith_color , lA ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lB = u_ambient * lz ; float lC = u_specular_params [ 0 ] ; vec2 lD = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 lE = lC * u_specular_color ; vec3 lF = normalize ( kE ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hw lG = jY ( lx , lB , lw , lE , kF , ly , lF , lD , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , 0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hw lG = kc ( lx , lB , lw ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lH = lG . a . rgb ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["vec3","lH","=","lw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gL ( lH , length ( cL ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"float lI = lu . a * ma ; gA ( lH ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( lH , lI ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lH , lI ) ; }".split(" ")}]};
a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float ma ; varying vec3 kI ; varying vec2 a ; varying vec3 kE ; varying vec3 kF ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float lw ( vec2 lu , vec2 lv ) { return ( atan ( lv . y , lv . x ) - atan ( lu . y , lu . x ) ) ; } void main ( ) { mb lx ; lx = mS ( ) ; float ly ; mat4 lz ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { ly = lx . e ; lz = z ( lx . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { ly = lx . e ; lz = k ( ) ; lz [ 3 ] = vec4 ( lx . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { ly = lx . e ; lz = o ( radians ( 90.0 ) ) ; lz [ 3 ] = vec4 ( lx . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { ly = lw ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + lx . e ; lz = m ( radians ( - 90.0 ) ) ; lz [ 3 ] = vec4 ( lx . b , 1.0 ) ; } vec4 lA = vec4 ( a_p_bb_vertex * 2.0 * lx . a * u_p_size , 0.0 , 1.0 ) ; vec4 lB = lz * q ( ly ) * lA ; vec4 lC = u_view_matrix * lB ; vec4 lD = u_proj_matrix * lC ; gl_Position = lD ; ma = lx . c ; kI = lx . d ; a = a_p_bb_vertex + 0.5 ; kF = lB . xyz ; kE = u_camera_eye - lB . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cL","=","lC",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 mT ; const float mU = 0.99 ; const float mV = 1.8 ; const int mW = 8 ; float nf ( vec3 mX , vec3 mY ) { float mZ = dot ( mY , mY ) ; float m_ = 2.0 * dot ( mY , mX ) ; float na = dot ( mX , mX ) - 1.0 ; float nb = m_ * m_ - 4.0 * mZ * na ; float nc = sqrt ( nb ) ; float nd = ( - m_ - nc ) / 2.0 ; float ne = na / nd ; return ne ; } float nm ( float ng , float nh ) { float ni = 3.0 * ( 1.0 - nh * nh ) ; float nj = 2.0 * ( 2.0 + nh * nh ) ; float nk = 1.0 + ng * ng ; float nl = pow ( 1.0 + nh * nh - 2.0 * nh * ng , 1.5 ) ; nl = max ( nl , 0.00001 ) ; return ( ni / nj ) * ( nk / nl ) ; } float nu ( vec3 nn , vec3 no , float np ) { float nq = dot ( no , - nn ) ; if ( nq < 0.0 ) { return 1.0 ; } vec3 nr = nn + nq * no ; if ( length ( nr ) < np ) { return 0.0 ; } else if ( length ( nr ) >= np ) { vec3 ns = normalize ( nr ) * np - nn ; float nt = acos ( dot ( normalize ( ns ) , no ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( nt * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 ny ( float nv , vec3 nw , float nx ) { return nw - nw * pow ( u_sky_color , vec3 ( nx / nv ) ) ; } void main ( ) { vec3 nz = normalize ( mT ) ; vec3 nA = u_sun_direction ; float nB = dot ( nz , nA ) ; float nC = nm ( nB , - 0.01 ) * u_rayleigh_brightness * nA . y ; float nD = nm ( nB - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - nA . y ) ; float nE = smoothstep ( 0.0 , 100.0 , nm ( nB , 0.9995 ) ) * u_spot_brightness ; vec3 nF = vec3 ( 0.0 , mU , 0.0 ) ; float nG = nf ( nF , nz ) ; float nH = nG / float ( mW ) ; float nI = nu ( nF , nz , mU - 0.3 ) ; vec3 nJ = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 nK = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int nL = 0 ; nL < mW ; nL ++ ) { float nM = nH * float ( nL ) ; vec3 nN = nF + nz * nM ; float nO = nu ( nN , nA , mU - 0.2 ) ; float nP = nf ( nN , nA ) ; vec3 nQ = ny ( nP , vec3 ( mV ) , u_scatter_strength ) * nO ; nJ += ny ( sqrt ( nM ) , u_sky_color * nQ , u_rayleigh_strength ) ; nK += ny ( nM , nQ , u_mie_strength ) ; } nJ = nJ * nI * pow ( nG , u_rayleigh_collection_power ) / float ( mW ) ; nK = ( nK * nI * pow ( nG , u_mie_collection_power ) ) / float ( mW ) ; vec3 nR = vec3 ( nE * nK + nD * nK + nC * nJ ) ; gA ( nR ) ; gl_FragColor = vec4 ( nR , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 mT ; void main ( ) { vec4 lu = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 lv = u_cube_view_matrix * lu ; mT = lv . xyz ; gl_Position = lu ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_sampler , a ) ; gA ( lu . rgb ) ; gD ( lu . rgb , lu . a ) ; gl_FragColor = lu ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { a = a_texcoord ; vec3 lu = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 lv = u_proj_matrix * u_view_matrix * vec4 ( lu , 0.0 ) ; lv . x /= lv . w ; lv . y /= lv . w ; lv += 99999.0 * step ( lv . z , 0.0 ) ; lv += 100.0 * ( step ( 1.0 , abs ( lv . x ) ) + step ( 1.0 , abs ( lv . y ) ) ) ; lv . x = - a_lf_dist * lv . x ; lv . y = - a_lf_dist * lv . y ; float lw = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 lx = vec2 ( a_lf_bb_vertex . x / lw , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float ly = 1.9 ; lx *= ( 1.0 + ly * length ( lv . xy ) ) ; } gl_Position = vec4 ( lv . xy + lx , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:["uniform","samplerCube","u_sky",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 mT ; void main ( ) { vec3 lu = textureCube ( u_sky , mT ) . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"gy ( lu . rgb ) ; float lv = u_camera_eye_frag . y - WATER_LEVEL ; lv = min ( - lv * 0.03 , 0.8 ) ; float lw = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; vec3 lx = normalize ( mT ) ; vec3 ly = vec3 ( 0.0 ) ; vec4 lz = u_underwater_fog_color_density ; lz . rgb = mix ( lz . rgb , ly , min ( - lx . y + lv , 1.0 ) ) * lw ; float lA = clamp ( sign ( lx . y - 0.05 * lv ) , 0.0 , 1.0 ) ; lu = mix ( lz . rgb , lu , lA ) ; gA ( lu . rgb ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( lu , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 mT ; void main ( ) { vec4 lu = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 lv = u_sky_vp_inverse * lu ; mT = lv . xyz ; gl_Position = lu ; }".split(" ")}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",
name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:"uniform float u_time ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float lu = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 kE ; varying vec3 kF ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kG",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 kH ; varying vec3 mU ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mV",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","&&","SHORE_SMOOTHING"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 nl ( in vec2 mY , in vec3 mZ , in vec3 m_ , in vec3 na , out float nb ) { vec3 nc = reflect ( - m_ , mZ ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nd = mY . xy + mZ . xz * REFL_BUMP / kJ ; nb = u_reflect_factor ; vec3 ne ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"ne = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ne = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"float nf = dot ( m_ , mZ ) ; nb *= max ( 1.0 - 1.0 / nf , 1.0 ) ; } else { ne = texture2D ( u_reflectmap , nd ) . rgb ; gy ( ne ) ; }".split(" ")}]}},
{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"nb = u_mirror_factor ; vec3 ne = na * textureCube ( u_mirrormap , nc ) . rgb ; gy ( ne ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nb = u_reflect_factor ; vec3 ne = na * vec3 ( 0.3 , 0.5 , 1.0 ) ; gy ( ne ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 ng = normalize ( nc + m_ ) ; float nh = 1.0 - dot ( m_ , ng ) ; float ni = u_fresnel_params [ 3 ] ; float nj = u_fresnel_params [ 2 ] ; float nk = ni + ( 1.0 - ni ) * pow ( nh , nj ) ; nb = min ( nb * nk , 1.0 ) ; return ne ; } void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 nm = mat3 ( kH , mU , kG ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nn = normalize ( kG ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 nm = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 nn = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","FOAM"],group:{type:"group",a:[{type:"textline",b:"float no = kF . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec2 np = vec2 ( mV . x , - mV . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 np = vec2 ( kF . x , - kF . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","np","=","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 nq = vec3 ( 0.0 ) ; vec3 nr = texture2D ( u_normalmap0 , np * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nq += nr ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"textline",b:"vec3 ns = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["ns","+=","nr",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"nr = texture2D ( u_normalmap0 , np * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nq += nr ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["ns","+=","nr",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"nr = texture2D ( u_normalmap0 , np * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nq += nr ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],
group:{type:"group",a:[{type:"textline",b:["ns","+=","nr",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"nr = texture2D ( u_normalmap0 , np * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nq += nr ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["ns",
"+=","nr",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nt = nm * ns ; if ( ! g ( nt , vec3 ( 0.0 ) ) ) nt = normalize ( nt ) ; vec3 nu = mix ( nn , nt , 0.2 ) ; nu = normalize ( nu ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"nn = mix ( nn , normalize ( nm * nq ) , 0.3 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"nn = mix ( nn , normalize ( nm * nq ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"nn = normalize ( nn ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nv = normalize ( kE ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nw = cK . xy / cK . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",
b:"float nx = kJ * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float ny = u_diffuse_color . a ; vec4 nz = texture2DProj ( u_scene_depth , cK ) ; float nA = cw ( nz ) ; float nB = max ( nA - kJ , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nC = nw + nn . xz * u_refr_bump / kJ ; float nD = ll ( nA , nC , nw ) ; float nE = max ( nD - kJ , 0.0 ) ; float nF = u_view_max_depth / ABSORB * nE ; float nG ; if ( u_cam_water_depth < 0.0 ) nG = 0.0 ; else nG = min ( ny * nF , 1.0 ) ; float nH = u_view_max_depth / ABSORB * nB ; ny = min ( 15.0 * ny * u_view_max_depth * nB , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float nH = u_view_max_depth / ABSORB * nB ; if ( u_cam_water_depth > 0.0 ) ny = min ( ny * nH , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ny *= min ( 5.0 * nx , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ny = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float nG = 1.0 - ny ; vec2 nC = nw + nn . xz * REFR_BUMP / kJ ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 nI = texture2D ( u_refractmap , nC ) . rgb ; gy ( nI ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nJ = pow ( min ( mW . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 nK = mix ( u_shallow_water_col , u_diffuse_color . rgb , nJ ) ; nJ = pow ( min ( mW . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; nK = mix ( u_shore_water_col , nK , nJ ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nK = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nL = max ( 1.0 - u_view_max_depth * nB , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nL = 1.0 - ny ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:"float nM = max ( no / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 nN = normalize ( vec3 ( mW . r , 0.0 , mW . g ) ) ; vec3 nO = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , nN , 0.8 ) ) ; float nP = 1.25 * max ( dot ( nu , nO ) - 0.2 , 0.0 ) ; nP += max ( dot ( nu , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; nL += nP * ( 1.0 - mW . b ) ; nM *= ( 1.0 - 0.95 * pow ( mW . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"nL += nM ; nL = min ( u_foam_factor * nL , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 nQ = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + np * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"float nR = u_specular_params [ 0 ] ; vec2 nS = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 nT = nR * u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 nU = u_environment_energy * textureCube ( u_sky_texture , nn ) . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nU = u_environment_energy * u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"vec3 nV = u_ambient * nU ; vec3 nW = nV + u_sun_intensity ; float nX ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 nY = nl ( nw , nn , nv , nW , nX ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nY = nl ( vec2 ( 0.0 ) , nn , nv , nW , nX ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 nZ = u_diffuse_intensity * nK ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hw n_ = jY ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , nZ , nT , kF , nn , nv , nS , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , 0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hw n_ = kc ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , nZ ) ;".split(" ")}]}}]},
{type:"textline",b:"nZ = n_ . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float oa = max ( dot ( u_sun_direction , - kG ) + SSS_WIDTH , 0.0 ) * max ( dot ( - nv , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; oa = clamp ( SSS_STRENGTH * oa , 0.0 , 1.0 ) ; nZ = mix ( nZ , u_shallow_water_col , oa ) ; nZ = mix ( nZ , u_shore_water_col , oa ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:"nZ = mix ( nI , nZ , nG ) ;".split(" ")}]}}]},{type:"textline",b:"nZ = mix ( nZ , nY , nX ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"float ob = mix ( nQ . g , nQ . r , max ( 4.0 * ( nL - 0.75 ) , 0.0 ) ) ; ob = mix ( nQ . b , ob , max ( 2.0 * nL - 1.0 , 0.0 ) ) ; ob = mix ( 0.0 , ob , nL ) ; nZ = mix ( nZ , nW , ob ) ;".split(" ")}]}}]},{type:"textline",b:"nZ += n_ . b ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 oc = gS ( u_cube_fog , nv ) ; vec4 od = vec4 ( oc , u_fog_color_density . a ) ; gy ( od . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","od","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { ht ( nZ , nx , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { gL ( nZ , nx , od ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( nZ , nx , od ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["gA","(","nZ",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"ny = max ( ny , n_ . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["ny","+=","ob",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gD ( nZ , ny ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 oe = fwidth ( mX ) ; vec3 of = smoothstep ( vec3 ( 0.0 ) , oe * lu , mX ) ; float og = min ( min ( of . x , of . y ) , of . z ) ; og = clamp ( og , 0.0 , 1.0 ) ; nZ = mix ( u_wireframe_edge_color , nZ , og ) ; ny = mix ( 1.0 , ny , og ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( nZ , ny ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",
b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 kE ; varying vec3 kF ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","kG",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 kH ; varying vec3 mU ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mV",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mW",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"vec3 lA ( in vec2 lu ) { vec2 lv = 0.5 + vec2 ( ( lu . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( lu . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; vec4 lw = texture2D ( u_shore_dist_map , lv ) ; const vec2 lx = vec2 ( 1.0 / 255.0 , 1.0 ) ; float ly = dot ( lw . ba , lx ) ; vec2 lz = normalize ( lw . rg * 2.0 - 1.0 ) ; return vec3 ( lz , ly ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},
{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void lR ( inout vec3 lB , in float lC , in vec3 lD ) { float lE = dM ( DST_NOISE_SCALE_0 * ( lB . xz + DST_NOISE_FREQ_0 * lC ) ) * dM ( DST_NOISE_SCALE_1 * ( lB . zx - DST_NOISE_FREQ_1 * lC ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float lF = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float lG = lD . b ; float lH = sqrt ( lG ) ; float lI = max ( lG , DIR_MIN_SHR_FAC ) * sin ( lH / lF + DIR_FREQ * lC ) ; float lJ = max ( dM ( DIR_NOISE_SCALE * ( lB . xz + DIR_NOISE_FREQ * lC ) ) , DIR_MIN_NOISE_FAC ) ; lI *= lJ ; float lK = WAVES_HEIGHT * mix ( lI , lE , max ( lH , DST_MIN_FAC ) ) ; vec2 lL = lD . rg ; float lM = WAVES_HOR_FAC * lI * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - lG ) , 0.0 ) ; vec2 lN = lM * lL ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float lK = WAVES_HEIGHT * lE ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"vec2 lO = 2.0 * ( lB . xz - 0.1 * lC ) ; vec2 lP = 1.3 * ( lB . zx + 0.03 * lC ) ; float lQ = dg ( 0.5 * lO ) . x + dg ( 0.5 * lP ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lB . xz += lN ; lQ *= lG ;".split(" ")}]}}]},{type:"textline",
b:"lK += SMALL_WAVES_FAC * lQ ;".split(" ")}]}}]},{type:"textline",b:"lB . y += lK ; }".split(" ")}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) mX = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) mX = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) mX = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["vec3","mY","=","a_position",
";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float mZ = abs ( mY . y ) ; vec2 m_ = u_camera_eye . xz - mod ( u_camera_eye . xz , mZ ) ; mY . y = WATER_LEVEL ; mY . xz += m_ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},{type:"textline",b:"d na = an ( mY , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC",
"&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"mV = na . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"mW = lA ( na . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float nb = length ( u_wind ) ; float nc = u_time ; nc *= nb ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["float",
"nd","=","mZ",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","nd","=","0.1",";"]}]}}]},{type:"textline",b:"vec3 ne = na . a + vec3 ( nd , 0.0 , 0.0 ) ; vec3 nf = na . a + vec3 ( 0.0 , 0.0 , nd ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 ng = lA ( ne . xz ) ; vec3 nh = lA ( nf . xz ) ; lR ( ne , nc , ng ) ; lR ( nf , nc , nh ) ; lR ( na . a , nc , mW ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"lR ( ne , nc , vec3 ( 0.0 ) ) ; lR ( nf , nc , vec3 ( 0.0 ) ) ; lR ( na . a , nc , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_position . y < 0.0 ) { na . a . y = WATER_LEVEL - 1.0 ; ne . y = na . a . y ; nf . y = na . a . y ; }".split(" ")}]}}]},{type:"textline",b:"vec3 ni = normalize ( ne - na . a ) ; vec3 nj = normalize ( nf - na . a ) ; kG = normalize ( cross ( nj , ni ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"kH = nj ; mU = cross ( kG , kH ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nk = dot ( kG , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float nl = clamp ( 0.8 - nk , 0.0 , 1.0 ) ; kG = mix ( kG , vec3 ( 0.0 , 1.0 , 0.0 ) , nl ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"kF = na . a ; kE = u_camera_eye - na . a ; vec4 nm = u_view_matrix * vec4 ( na . a , 1.0 ) ; vec4 nn = u_proj_matrix * nm ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float no = nn . x ; float np = nn . y ; float nq = nn . w ; cK . x = ( no + nq ) / 2.0 ; cK . y = ( np + nq ) / 2.0 ; cK . z = nq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"kJ = - nm . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["gl_Position","=","nn",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 mX ; const float lu = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 lv = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lv = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lw = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 lx = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 ly = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec3 lz = vec3 ( 0.0 ) ; float lA = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"vec3 lB = sign ( mX - vec3 ( 0.02 * lu ) ) ; if ( lB . x < 0.0 || lB . y < 0.0 || lB . z < 0.0 ) { lz = lv ; lA = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lB = sign ( mX - vec3 ( 0.02 * lu ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( lB . x < 0.0 || lB . y < 0.0 || lB . z < 0.0 ) lz = u_wireframe_edge_color ; else lz = ly ; lA = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( lB . x < 0.0 || lB . y < 0.0 || lB . z < 0.0 ) lA = 1.0 ; else lA = 0.0 ; lz = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( lB . x < 0.0 || lB . y < 0.0 || lB . z < 0.0 ) lz = u_wireframe_edge_color ; else if ( gl_FrontFacing ) lz = lw ; else lz = lx ; lA = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 lC = fwidth ( mX ) ; vec3 lD = smoothstep ( vec3 ( 0.0 ) , lC * lu , mX ) ; float lE = min ( min ( lD . x , lD . y ) , lD . z ) ; lE = clamp ( lE , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { lz = vec3 ( mix ( u_wireframe_edge_color , ly , lE ) ) ; lA = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { lz = u_wireframe_edge_color ; lA = mix ( 1.0 , 0.0 , lE ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) lz = mix ( u_wireframe_edge_color , lw , lE ) ; else lz = mix ( u_wireframe_edge_color , lx , lE ) ; lA = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["gA","(","lz",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gD ( lz , lA ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lz , lA ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",b:["varying","vec3","mX",";"]},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { if ( a_polyindex == 0.0 ) mX = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) mX = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) mX = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 lu = a_position ; vec3 lv = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"d lw = an ( lu , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"lu = mix ( lu , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 lx = vec3 ( 0.0 ) ; vec3 ly = vec3 ( 0.0 ) ; bt ( lu , lx , ly , lv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["vec3","lz","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lz = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d lw = gh ( lu , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lz , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lA = ( u_model_matrix * vec4 ( lz , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 lB = ag ( u_camera_eye , lA , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 lB = aa ( u_camera_eye , lA , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND",
"&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lC = ( u_model_matrix * vec4 ( lz , 1.0 ) ) . xyz ; lB = lB * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lC ) ;".split(" ")}]}}]},{type:"textline",b:"d lw = an ( lu - lz , lz , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lB ) ; lw . b = lA ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d lw = an ( lu , lz , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( lw . a , lw . b , lv ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 lD = u_view_matrix * vec4 ( lw . a , 1.0 ) ; gl_Position = u_proj_matrix * lD ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_sampler_left , a ) ; vec4 lv = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( lu [ 0 ] , lv [ 1 ] , lv [ 2 ] , lu [ 3 ] + lv [ 3 ] ) ; }".split(" ")}]};
a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 lx ( float lu , float lv ) { vec2 lw = a + vec2 ( lu , lv ) * u_texel_size ; return texture2D ( u_color , lw ) ; } float lB ( vec4 ly ) { vec3 lz = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lA = dot ( ly . rgb , lz ) ; return lA ; } vec4 m_ ( ) { vec4 lC = lx ( - 1.0 , - 1.0 ) ; vec4 lD = lx ( 1.0 , - 1.0 ) ; vec4 lE = lx ( - 1.0 , 1.0 ) ; vec4 lF = lx ( 1.0 , 1.0 ) ; vec4 lG = lx ( 0.0 , 0.0 ) ; float lH = lB ( lC ) ; float lI = lB ( lD ) ; float lJ = lB ( lE ) ; float lK = lB ( lF ) ; float lL = lB ( lG ) ; float lM = min ( lL , min ( min ( lH , lI ) , min ( lJ , lK ) ) ) ; float lN = max ( lL , max ( max ( lH , lI ) , max ( lJ , lK ) ) ) ; vec2 lO ; lO . x = - ( ( lH + lI ) - ( lJ + lK ) ) ; lO . y = ( ( lH + lJ ) - ( lI + lK ) ) ; float lP = max ( ( lH + lI + lJ + lK ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float lQ = 1.0 / ( min ( abs ( lO . x ) , abs ( lO . y ) ) + lP ) ; lO = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , lO * lQ ) ) * u_texel_size ; vec4 lR = 0.5 * ( texture2D ( u_color , a + lO * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + lO * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 mY = lR * 0.5 + 0.25 * ( texture2D ( u_color , a + lO * - 0.5 ) + texture2D ( u_color , a + lO * 0.5 ) ) ; float mZ = lB ( mY ) ; if ( ( mZ < lM ) || ( mZ > lN ) ) return lR ; else return mY ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 oL ( ) { vec2 na ; na . x = a . x ; na . y = a . y ; vec4 nb = texture2D ( u_color , na ) ; vec4 nc = lx ( 0.0 , 1.0 ) ; vec4 nd = lx ( 1.0 , 0.0 ) ; vec4 ne = lx ( 0.0 , - 1.0 ) ; vec4 nf = lx ( - 1.0 , 0.0 ) ; float ng = lB ( nc ) ; float nh = lB ( nd ) ; float ni = lB ( ne ) ; float nj = lB ( nf ) ; float nk = lB ( nb ) ; float nl = max ( ng , nk ) ; float nm = min ( ng , nk ) ; float nn = max ( nh , nl ) ; float no = min ( nh , nm ) ; float np = max ( ni , nj ) ; float nq = min ( ni , nj ) ; float nr = max ( np , nn ) ; float ns = min ( nq , no ) ; float nt = nr * FXAA_QUALITY_EDGE_THRESHOLD ; float nu = nr - ns ; float nv = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , nt ) ; bool nw = nu < nv ; if ( nw ) return nb ; vec4 nx = lx ( - 1.0 , - 1.0 ) ; vec4 ny = lx ( 1.0 , 1.0 ) ; vec4 nz = lx ( 1.0 , - 1.0 ) ; vec4 nA = lx ( - 1.0 , 1.0 ) ; float nB = lB ( nx ) ; float nC = lB ( ny ) ; float nD = lB ( nz ) ; float nE = lB ( nA ) ; float nF = ni + ng ; float nG = nj + nh ; float nH = 1.0 / nu ; float nI = nF + nG ; float nJ = ( - 2.0 * nk ) + nF ; float nK = ( - 2.0 * nk ) + nG ; float nL = nD + nC ; float nM = nB + nD ; float nN = ( - 2.0 * nh ) + nL ; float nO = ( - 2.0 * ni ) + nM ; float nP = nB + nE ; float nQ = nE + nC ; float nR = ( abs ( nJ ) * 2.0 ) + abs ( nN ) ; float nS = ( abs ( nK ) * 2.0 ) + abs ( nO ) ; float nT = ( - 2.0 * nj ) + nP ; float nU = ( - 2.0 * ng ) + nQ ; float nV = abs ( nT ) + nR ; float nW = abs ( nU ) + nS ; float nX = nP + nL ; float nY = u_texel_size . x ; bool nZ = nV >= nW ; float n_ = nI * 2.0 + nX ; if ( ! nZ ) ni = nj ; if ( ! nZ ) ng = nh ; if ( nZ ) nY = u_texel_size . y ; float oa = ( n_ * ( 1.0 / 12.0 ) ) - nk ; float ob = ni - nk ; float oc = ng - nk ; float od = ni + nk ; float oe = ng + nk ; bool of = abs ( ob ) >= abs ( oc ) ; float og = max ( abs ( ob ) , abs ( oc ) ) ; if ( of ) nY = - nY ; float oh = clamp ( abs ( oa ) * nH , 0.0 , 1.0 ) ; vec2 oi ; oi . x = na . x ; oi . y = na . y ; vec2 oj ; oj . x = ( ! nZ ) ? 0.0 : u_texel_size . x ; oj . y = ( nZ ) ? 0.0 : u_texel_size . y ; if ( ! nZ ) oi . x += nY * 0.5 ; if ( nZ ) oi . y += nY * 0.5 ; vec2 ok ; ok . x = oi . x - oj . x ; ok . y = oi . y - oj . y ; vec2 ol ; ol . x = oi . x + oj . x ; ol . y = oi . y + oj . y ; float om = ( ( - 2.0 ) * oh ) + 3.0 ; float on = lB ( texture2D ( u_color , ok ) ) ; float oo = oh * oh ; float op = lB ( texture2D ( u_color , ol ) ) ; if ( ! of ) od = oe ; float oq = og * 1.0 / 4.0 ; float or = nk - od * 0.5 ; float os = om * oo ; bool ot = or < 0.0 ; on -= od * 0.5 ; op -= od * 0.5 ; bool ou = abs ( on ) >= oq ; bool ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 1.5 ; if ( ! ou ) ok . y -= oj . y * 1.5 ; bool ow = ( ! ou ) || ( ! ov ) ; if ( ! ov ) ol . x += oj . x * 1.5 ; if ( ! ov ) ol . y += oj . y * 1.5 ; if ( ow ) { if ( ! ou ) on = lB ( texture2D ( u_color , ok . xy ) ) ; if ( ! ov ) op = lB ( texture2D ( u_color , ol . xy ) ) ; if ( ! ou ) on = on - od * 0.5 ; if ( ! ov ) op = op - od * 0.5 ; ou = abs ( on ) >= oq ; ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 2.0 ; if ( ! ou ) ok . y -= oj . y * 2.0 ; ow = ( ! ou ) || ( ! ov ) ; if ( ! ov ) ol . x += oj . x * 2.0 ; if ( ! ov ) ol . y += oj . y * 2.0 ; if ( ow ) { if ( ! ou ) on = lB ( texture2D ( u_color , ok . xy ) ) ; if ( ! ov ) op = lB ( texture2D ( u_color , ol . xy ) ) ; if ( ! ou ) on = on - od * 0.5 ; if ( ! ov ) op = op - od * 0.5 ; ou = abs ( on ) >= oq ; ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 2.0 ; if ( ! ou ) ok . y -= oj . y * 2.0 ; ow = ( ! ou ) || ( ! ov ) ; if ( ! ov ) ol . x += oj . x * 2.0 ; if ( ! ov ) ol . y += oj . y * 2.0 ; if ( ow ) { if ( ! ou ) on = lB ( texture2D ( u_color , ok . xy ) ) ; if ( ! ov ) op = lB ( texture2D ( u_color , ol . xy ) ) ; if ( ! ou ) on = on - od * 0.5 ; if ( ! ov ) op = op - od * 0.5 ; ou = abs ( on ) >= oq ; ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 4.0 ; if ( ! ou ) ok . y -= oj . y * 4.0 ; ow = ( ! ou ) || ( ! ov ) ; if ( ! ov ) ol . x += oj . x * 4.0 ; if ( ! ov ) ol . y += oj . y * 4.0 ; if ( ow ) { if ( ! ou ) on = lB ( texture2D ( u_color , ok . xy ) ) ; if ( ! ov ) op = lB ( texture2D ( u_color , ol . xy ) ) ; if ( ! ou ) on = on - od * 0.5 ; if ( ! ov ) op = op - od * 0.5 ; ou = abs ( on ) >= oq ; ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 2.0 ; if ( ! ou ) ok . y -= oj . y * 2.0 ; if ( ! ov ) ol . x += oj . x * 2.0 ; if ( ! ov ) ol . y += oj . y * 2.0 ; } } } } float ox = na . x - ok . x ; float oy = ol . x - na . x ; if ( ! nZ ) ox = na . y - ok . y ; if ( ! nZ ) oy = ol . y - na . y ; bool oz = ( on < 0.0 ) != ot ; float oA = ( oy + ox ) ; bool oB = ( op < 0.0 ) != ot ; float oC = 1.0 / oA ; bool oD = ox < oy ; float oE = min ( ox , oy ) ; bool oF = oD ? oz : oB ; float oG = os * os ; float oH = ( oE * ( - oC ) ) + 0.5 ; float oI = oG * FXAA_QUALITY_SUBPIX ; float oJ = oF ? oH : 0.0 ; float oK = max ( oJ , oI ) ; if ( ! nZ ) na . x += oK * nY ; if ( nZ ) na . y += oK * nY ; return texture2D ( u_color , na ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = m_ ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = oL ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 lu = vec2 ( 0.0 , 0.0 ) ; vec2 lv = u_texel_size ; vec4 lw = texture2D ( u_color , a ) ; gl_FragColor = lw * 0.0875447373698 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0858112354248 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0808139781061 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0731235112908 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0635705267419 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0530985673112 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0426125984122 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0328565115809 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * lw , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_main , a ) ; vec4 lv = texture2D ( u_bloom , a ) ; vec4 lw = lu ; lw += lv ; gl_FragColor = vec4 ( lw . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_color , a ) ; vec3 lv = lu . rgb ; if ( u_brightness < 0.0 ) lv = lv * ( 1.0 + u_brightness ) ; else lv = lv + ( ( 1.0 - lv ) * u_brightness ) ; lv = ( lv - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; lv *= u_exposure ; vec3 lw = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lx = dot ( lv , lw ) ; lv = mix ( vec3 ( lx ) , lv , u_saturation ) ; gl_FragColor = vec4 ( lv , lu . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cs ( clamp ( ne ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { vec4 nf = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { float ng = ne ( u_depth , a , u_camera_range ) ; ng *= u_view_max_depth ; float nh ; if ( ng < u_dof_dist ) nh = ( u_dof_dist - ng ) / u_dof_front ; else nh = ( ng - u_dof_dist ) / u_dof_rear ; nh = clamp ( nh , 0.0 , 1.0 ) ; vec4 ni = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( nf , ni , nh ) ; } else gl_FragColor = nf ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float lz ( float lu , float lv , float lw ) { vec2 lx = a + vec2 ( lu , lv ) * u_texel_size ; vec4 ly = texture2D ( u_sampler , lx ) * lw ; return cw ( ly ) ; } void main ( ) { float lA = ( lz ( - 1.0 , - 1.0 , - 1.0 ) + lz ( 0.0 , - 1.0 , - 1.0 ) + lz ( 1.0 , - 1.0 , - 1.0 ) + lz ( - 1.0 , 0.0 , - 1.0 ) + lz ( 0.0 , 0.0 , 8.0 ) + lz ( 1.0 , 0.0 , - 1.0 ) + lz ( - 1.0 , 1.0 , - 1.0 ) + lz ( 0.0 , 1.0 , - 1.0 ) + lz ( 1.0 , 1.0 , - 1.0 ) ) ; lA *= 1000.0 ; gl_FragColor = vec4 ( lA , lA , lA , 1.0 ) ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_glow_src ; uniform sampler2D u_glow_mask ; uniform sampler2D u_glow_mask_blurred ; uniform vec3 u_glow_color ; uniform float u_draw_glow ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_glow_src , a ) ; gl_FragColor = lu ; if ( u_draw_glow != 0.0 ) { vec4 lv = texture2D ( u_glow_mask , a ) ; vec4 lw = texture2D ( u_glow_mask_blurred , a ) ; float lx = lw . a - lv . a ; if ( lx != 0.0 ) { float ly = smoothstep ( 0.0 , 1.0 , lw . a ) ; if ( lv . a == 0.0 ) { vec3 lz = u_glow_color ; gA ( lz ) ; vec4 lA = vec4 ( clamp ( lz , 0.0 , 1.0 ) , ly ) ; gl_FragColor = mix ( lu , lA , ly ) ; } } } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float nf ; varying vec2 ng ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 nh ; void main ( ) { vec2 ni = ( nh . xy - a ) ; float nj = length ( ni ) ; vec2 nk = u_radial_blur_step * ni / nj ; float nl = nj / u_radial_blur_step ; nk *= min ( nl , STEPS_PER_PASS ) / STEPS_PER_PASS ; nl = max ( nl , STEPS_PER_PASS ) ; vec2 nm = a ; float nn = 0.0 ; for ( float no = 0.0 ; no < STEPS_PER_PASS ; no += 1.0 ) { if ( no <= nl ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"float np = ne ( u_input , nm , u_camera_range ) ; nn += max ( ( 1.0 - pow ( nj , 0.3 ) ) * step ( 0.9 , np ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 nq = texture2D ( u_input , nm ) ; nn += cw ( nq ) ;".split(" ")}]}}]},{type:"textline",b:"} nm += nk ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"vec2 nr = a + ng ; float ns = dg ( vec2 ( 2.5 * ( nr . x ) , 2.5 * ( nr . y ) + 1.0 * u_time ) ) . x + 0.75 * dg ( vec2 ( 5.0 * ( nr . x ) - 0.66 * u_time , 5.0 * ( nr . y ) + 0.66 * u_time ) ) . x + 0.5 * dM ( vec2 ( 7.5 * ( nr . x ) + 0.33 * u_time , 7.5 * ( nr . y ) - 0.33 * u_time ) ) ; ns *= clamp ( 1.2 - sqrt ( 0.2 * nj ) , 0.0 , 1.0 ) * nf ; nn = max ( ns , nn ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = cs ( nn / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform vec4 u_refl_plane ; varying float nf ; varying vec2 ng ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"varying vec2 a ; varying vec4 nh ; void lB ( in vec4 lu , in vec3 lv , out vec3 lw ) { float lx = lu . w * lv . x + lu . y * lv . z - lu . z * lv . y ; float ly = lu . w * lv . y + lu . z * lv . x - lu . x * lv . z ; float lz = lu . w * lv . z + lu . x * lv . y - lu . y * lv . x ; float lA = - lu . x * lv . x - lu . y * lv . y - lu . z * lv . z ; lw . x = lx * lu . w - lA * lu . x - ly * lu . z + lz * lu . y ; lw . y = ly * lu . w - lA * lu . y - lz * lu . x + lx * lu . z ; lw . z = lz * lu . w - lA * lu . z - lx * lu . y + ly * lu . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 lC = normalize ( u_sun_direction ) ; nh = u_proj_matrix * u_view_matrix * vec4 ( lC , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_camera_eye . y + a_bb_vertex . t < - u_refl_plane . w ) { nf = 1.0 ; vec3 lD = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 lE ; lB ( u_camera_quat , lD , lE ) ; lE = normalize ( lE ) ; float lF = dot ( lE , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lG = atan ( lE . x , lE . z ) ; ng = vec2 ( - lG , acos ( lF ) ) ; } else { nf = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"nh . x /= nh . w ; nh . y /= nh . w ; nh . x = 0.5 * ( nh . x + 1.0 ) ; nh . y = 0.5 * ( nh . y + 1.0 ) ; nh += 99999.0 * step ( nh . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_main , a ) ; vec3 lv = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; gy ( lu . rgb ) ; float lw = cw ( texture2D ( u_god_rays , a ) ) ; vec3 lx = lu . rgb + u_god_rays_intensity * vec3 ( lw ) * lv ; gA ( lx ) ; gl_FragColor . rgb = lx ; gl_FragColor . a = lu . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_color , a ) * 0.38026 ; lu += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; lu += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; lu += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; lu += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; lu += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; lu += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; lu += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; lu += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = lu ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_input , a ) ; float lv = dot ( lu . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( lv ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float lu ; float lv = 0.0 ; for ( float lw = 0.025 ; lw < 1.0 ; lw += 0.05 ) for ( float lx = 0.025 ; lx < 1.0 ; lx += 0.05 ) { lu = max ( texture2D ( u_input , vec2 ( lw , lx ) ) . r , 0.01 ) ; lv += log ( lu ) ; } float ly = exp ( lv / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( ly ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float ni ; void main ( ) { float nj = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float nk = texture2D ( u_luminance , a ) . r ; vec4 nl = texture2D ( u_main , a ) ; float nm = nk / nj ; float nn = u_bloom_edge_lum ; gl_FragColor = nl * max ( nm - nn , 0.0 ) * ni ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float ni ; const vec3 lu = vec3 ( 0.0 , 1.0 , 0.0 ) ; void lC ( in vec4 lv , in vec3 lw , out vec3 lx ) { float ly = lv . w * lw . x + lv . y * lw . z - lv . z * lw . y ; float lz = lv . w * lw . y + lv . z * lw . x - lv . x * lw . z ; float lA = lv . w * lw . z + lv . x * lw . y - lv . y * lw . x ; float lB = - lv . x * lw . x - lv . y * lw . y - lv . z * lw . z ; lx . x = ly * lv . w - lB * lv . x - lz * lv . z + lA * lv . y ; lx . y = lz * lv . w - lB * lv . y - lA * lv . x + ly * lv . z ; lx . z = lA * lv . w - lB * lv . z - ly * lv . y + lz * lv . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 lD ; lC ( u_camera_quat , lu , lD ) ; ni = dot ( - lD , u_sun_direction ) * u_bloom_key ; ni *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_mb_tex_curr , a ) ; vec4 lv = texture2D ( u_mb_tex_accum , a ) ; if ( length ( lu - lv ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * lu + u_motion_blur_exp * lv ; } else { gl_FragColor = lu ; } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"vec4 lu = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( lu . r + lu . g + lu . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lv = vec2 ( 0.0 , 0.0 ) ; vec2 lw = u_texel_size ; vec4 lx ; lx = texture2D ( u_color , a ) ; gl_FragColor = lx * 0.2270270270 ; lv += lw ; lx = texture2D ( u_color , a + lv ) ; gl_FragColor += lx * 0.1945945946 ; lx = texture2D ( u_color , a - lv ) ; gl_FragColor += lx * 0.1945945946 ; lv += lw ; lx = texture2D ( u_color , a + lv ) ; gl_FragColor += lx * 0.1216216216 ; lx = texture2D ( u_color , a - lv ) ; gl_FragColor += lx * 0.1216216216 ; lv += lw ; lx = texture2D ( u_color , a + lv ) ; gl_FragColor += lx * 0.0540540541 ; lx = texture2D ( u_color , a - lv ) ; gl_FragColor += lx * 0.0540540541 ; lv += lw ; lx = texture2D ( u_color , a + lv ) ; gl_FragColor += lx * 0.0162162162 ; lx = texture2D ( u_color , a - lv ) ; gl_FragColor += lx * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 lw = u_texel_size ; vec4 lx = texture2D ( u_color , a ) ; gl_FragColor = lx ; if ( lx . a == 0.0 ) { lx = texture2D ( u_color , a + lw ) ; if ( lx . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , lx . a ) ; else { lx = texture2D ( u_color , a - lw ) ; if ( lx . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , lx . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; varying vec2 a ; void main ( ) { a = a_bb_vertex + 0.5 ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","nj",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nk ; varying vec4 nl ; varying vec4 nm ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nn",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 nt ( vec2 no , sampler2D np ) { float nq = texture2D ( np , no ) . r ; float nr = texture2D ( np , nk . xy ) . r ; float ns = texture2D ( np , nk . zw ) . r ; return vec3 ( nq , nr , ns ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nz ( vec2 nu , sampler2D nv ) { vec3 nw = nt ( nu , nv ) ; vec2 nx = abs ( nw . xx - nw . yz ) ; vec2 ny = step ( SMAA_PREDICATION_THRESHOLD , nx ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * ny ) ; }".split(" ")}]}}]},{type:"textline",b:"void nD ( bvec2 nA , inout vec2 nB , vec2 nC ) { if ( nA . x ) nB . x = nC . x ; if ( nA . y ) nB . y = nC . y ; } void nD ( bvec4 nE , inout vec4 nF , vec4 nG ) { nD ( nE . xy , nF . xy , nG . xy ) ; nD ( nE . zw , nF . zw , nG . zw ) ; } vec2 nI ( vec2 nH ) { return sign ( nH ) * floor ( abs ( nH ) + .5 ) ; } vec4 nI ( vec4 nJ ) { return sign ( nJ ) * floor ( abs ( nJ ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 n_ ( vec2 nK , sampler2D nL".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","nM"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 nN = nz ( nK , nM ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 nN = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nO = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float nP = dot ( texture2D ( nL , nK ) . rgb , nO ) ; float nQ = dot ( texture2D ( nL , nk . xy ) . rgb , nO ) ; float nR = dot ( texture2D ( nL , nk . zw ) . rgb , nO ) ; vec4 nS ; nS . xy = abs ( nP - vec2 ( nQ , nR ) ) ; vec2 nT = step ( nN , nS . xy ) ; if ( dot ( nT , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float nU = dot ( texture2D ( nL , nl . xy ) . rgb , nO ) ; float nV = dot ( texture2D ( nL , nl . zw ) . rgb , nO ) ; nS . zw = abs ( nP - vec2 ( nU , nV ) ) ; vec2 nW = max ( nS . xy , nS . zw ) ; float nX = dot ( texture2D ( nL , nm . xy ) . rgb , nO ) ; float nY = dot ( texture2D ( nL , nm . zw ) . rgb , nO ) ; nS . zw = abs ( vec2 ( nQ , nR ) - vec2 ( nX , nY ) ) ; nW = max ( nW . xy , nS . zw ) ; float nZ = max ( nW . x , nW . y ) ; nT . xy *= step ( nZ , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * nS . xy ) ; return nT ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 ob ( vec2 oa ) { oa . r = oa . r * abs ( 5.0 * oa . r - 5.0 * 0.75 ) ; return nI ( oa ) ; } vec4 ob ( vec4 oc ) { oc . rb = oc . rb * abs ( 5.0 * oc . rb - 5.0 * 0.75 ) ; return nI ( oc ) ; } vec2 ok ( sampler2D od , vec2 oe , vec2 of , out vec2 og ) { vec4 oh = vec4 ( oe , - 1.0 , 1.0 ) ; vec3 oi = vec3 ( u_texel_size , 1.0 ) ; for ( int oj = 0 ; oj < SMAA_MAX_SEARCH_STEPS_DIAG ; oj ++ ) { if ( oh . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && oh . w > 0.9 ) { oh . xyz += oi * vec3 ( of , 1.0 ) ; og = texture2D ( od , oh . xy , 0.0 ) . rg ; oh . w = dot ( og , vec2 ( 0.5 , 0.5 ) ) ; } } return oh . zw ; } vec2 os ( sampler2D ol , vec2 om , vec2 on , out vec2 oo ) { vec4 op = vec4 ( om , - 1.0 , 1.0 ) ; op . x += 0.25 * u_texel_size . x ; vec3 oq = vec3 ( u_texel_size , 1.0 ) ; for ( int or = 0 ; or < SMAA_MAX_SEARCH_STEPS_DIAG ; or ++ ) { if ( op . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && op . w > 0.9 ) { op . xyz = oq * vec3 ( on , 1.0 ) + op . xyz ; oo = texture2D ( ol , op . xy , 0.0 ) . rg ; oo = ob ( oo ) ; op . w = dot ( oo , vec2 ( 0.5 , 0.5 ) ) ; } } return op . zw ; } vec2 oy ( sampler2D ot , vec2 ou , vec2 ov , float ow ) { vec2 ox = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * ov + ou ; ox = SMAA_AREATEX_PIXEL_SIZE * ox + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; ox . x += 0.5 ; ox . y += SMAA_AREATEX_SUBTEX_SIZE * ow ; return texture2D ( ot , ox , 0.0 ) . rg ; } vec2 oN ( sampler2D oz , sampler2D oA , vec2 oB , vec2 oC , vec4 oD ) { vec2 oE = vec2 ( 0.0 , 0.0 ) ; vec4 oF ; vec2 oG ; if ( oC . r > 0.0 ) { oF . xz = ok ( oz , oB , vec2 ( - 1.0 , 1.0 ) , oG ) ; oF . x += float ( oG . y > 0.9 ) ; } else oF . xz = vec2 ( 0.0 , 0.0 ) ; oF . yw = ok ( oz , oB , vec2 ( 1.0 , - 1.0 ) , oG ) ; if ( oF . x + oF . y > 2.0 ) { vec4 oH = vec4 ( - oF . x + 0.25 , oF . x , oF . y , - oF . y - 0.25 ) * u_texel_size . xyxy + oB . xyxy ; vec4 oI ; oI . xy = texture2D ( oz , oH . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; oI . zw = texture2D ( oz , oH . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; oI . yxwz = ob ( oI . xyzw ) ; vec2 oJ = vec2 ( 2.0 , 2.0 ) * oI . xz + oI . yw ; nD ( bvec2 ( step ( 0.9 , oF . zw ) ) , oJ , vec2 ( 0.0 , 0.0 ) ) ; oE += oy ( oA , oF . xy , oJ , oD . z ) ; } oF . xz = os ( oz , oB , vec2 ( - 1 , - 1 ) , oG ) ; if ( texture2D ( oz , oB + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { oF . yw = os ( oz , oB , vec2 ( 1 , 1 ) , oG ) ; oF . y += float ( oG . y > 0.9 ) ; } else oF . yw = vec2 ( 0.0 , 0.0 ) ; if ( oF . x + oF . y > 2.0 ) { vec4 oK = vec4 ( - oF . x , - oF . x , oF . y , oF . y ) * u_texel_size . xyxy + oB . xyxy ; vec4 oL ; oL . x = texture2D ( oz , oK . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; oL . y = texture2D ( oz , oK . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; oL . zw = texture2D ( oz , oK . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 oM = vec2 ( 2.0 , 2.0 ) * oL . xz + oL . yw ; nD ( bvec2 ( step ( 0.9 , oF . zw ) ) , oM , vec2 ( 0 , 0 ) ) ; oE += oy ( oA , oF . xy , oM , oD . w ) . gr ; } return oE ; }".split(" ")}]}}]},
{type:"textline",b:"float oT ( sampler2D oO , vec2 oP , float oQ ) { vec2 oR = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 oS = SMAA_SEARCHTEX_SIZE * vec2 ( oQ , 1.0 ) ; oR += vec2 ( - 1.0 , 1.0 ) ; oS += vec2 ( 0.5 , - 0.5 ) ; oR *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; oS *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( oO , oR * oP + oS , 0.0 ) . r ; } float pa ( sampler2D oU , sampler2D oV , vec2 oW , float oX ) { vec2 oY = vec2 ( 0.0 , 1.0 ) ; for ( int oZ = 0 ; oZ < SMAA_MAX_SEARCH_STEPS ; oZ ++ ) { if ( oW . x > oX && oY . g > 0.8281 && oY . r == 0.0 ) { oY = texture2D ( oU , oW , 0.0 ) . rg ; oW = - vec2 ( 2.0 , 0.0 ) * u_texel_size + oW ; } } float o_ = - ( 255.0 / 127.0 ) * oT ( oV , oY , 0.0 ) + 3.25 ; return u_texel_size . x * o_ + oW . x ; } float pi ( sampler2D pb , sampler2D pc , vec2 pd , float pe ) { vec2 pf = vec2 ( 0.0 , 1.0 ) ; for ( int pg = 0 ; pg < SMAA_MAX_SEARCH_STEPS ; pg ++ ) { if ( pd . x < pe && pf . g > 0.8281 && pf . r == 0.0 ) { pf = texture2D ( pb , pd , 0.0 ) . rg ; pd = vec2 ( 2.0 , 0.0 ) * u_texel_size + pd ; } } float ph = - ( 255.0 / 127.0 ) * oT ( pc , pf , 0.5 ) + 3.25 ; return - u_texel_size . x * ph + pd . x ; } float pq ( sampler2D pj , sampler2D pk , vec2 pl , float pm ) { vec2 pn = vec2 ( 1.0 , 0.0 ) ; for ( int po = 0 ; po < SMAA_MAX_SEARCH_STEPS ; po ++ ) { if ( pl . y > pm && pn . r > 0.8281 && pn . g == 0.0 ) { pn = texture2D ( pj , pl , 0.0 ) . rg ; pl = - vec2 ( 0.0 , 2.0 ) * u_texel_size + pl ; } } float pp = - ( 255.0 / 127.0 ) * oT ( pk , pn . gr , 0.0 ) + 3.25 ; return u_texel_size . y * pp + pl . y ; } float py ( sampler2D pr , sampler2D ps , vec2 pt , float pu ) { vec2 pv = vec2 ( 1.0 , 0.0 ) ; for ( int pw = 0 ; pw < SMAA_MAX_SEARCH_STEPS ; pw ++ ) { if ( pt . y < pu && pv . r > 0.8281 && pv . g == 0.0 ) { pv = texture2D ( pr , pt , 0.0 ) . rg ; pt = vec2 ( 0.0 , 2.0 ) * u_texel_size + pt ; } } float px = - ( 255.0 / 127.0 ) * oT ( ps , pv . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * px + pt . y ; } vec2 pF ( sampler2D pz , vec2 pA , float pB , float pC , float pD ) { vec2 pE = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * nI ( 4.0 * vec2 ( pB , pC ) ) + pA ; pE = SMAA_AREATEX_PIXEL_SIZE * pE + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; pE . y = SMAA_AREATEX_SUBTEX_SIZE * pD + pE . y ; return texture2D ( pz , pE , 0.0 ) . rg ; } void pN ( sampler2D pG , inout vec2 pH , vec4 pI , vec2 pJ ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pK = step ( pJ . xy , pJ . yx ) ; vec2 pL = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pK ; pL /= pK . x + pK . y ; vec2 pM = vec2 ( 1.0 , 1.0 ) ; pM . x -= pL . x * texture2D ( pG , pI . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; pM . x -= pL . y * texture2D ( pG , pI . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; pM . y -= pL . x * texture2D ( pG , pI . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; pM . y -= pL . y * texture2D ( pG , pI . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; pH *= clamp ( pM , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void pV ( sampler2D pO , inout vec2 pP , vec4 pQ , vec2 pR ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pS = step ( pR . xy , pR . yx ) ; vec2 pT = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pS ; pT /= pS . x + pS . y ; vec2 pU = vec2 ( 1.0 , 1.0 ) ; pU . x -= pT . x * texture2D ( pO , pQ . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; pU . x -= pT . y * texture2D ( pO , pQ . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; pU . y -= pT . x * texture2D ( pO , pQ . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; pU . y -= pT . y * texture2D ( pO , pQ . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; pP *= clamp ( pU , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qn ( vec2 pW , vec2 pX , sampler2D pY , sampler2D pZ , sampler2D p_ , vec4 qa ) { vec4 qb = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 qc = texture2D ( pY , pW ) . rg ; if ( qc . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"qb . rg = oN ( pY , pZ , pW , qc , qa ) ; if ( qb . r == - qb . g ) {".split(" ")}]}}]},
{type:"textline",b:"vec2 qd ; vec3 qe ; qe . x = pa ( pY , p_ , nk . xy , nm . x ) ; qe . y = nl . y ; qd . x = qe . x ; float qf = texture2D ( pY , qe . xy , 0.0 ) . r ; qe . z = pi ( pY , p_ , nk . zw , nm . y ) ; qd . y = qe . z ; qd = abs ( nI ( qd / u_texel_size . xx - pX . xx ) ) ; vec2 qg = sqrt ( qd ) ; float qh = texture2D ( pY , qe . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; qb . rg = pF ( pZ , qg , qf , qh , qa . y ) ; qe . y = pW . y ; pN ( pY , qb . rg , qe . xyzy , qd ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else qc . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( qc . r > 0.0 ) { vec2 qi ; vec3 qj ; qj . y = pq ( pY , p_ , nl . xy , nm . z ) ; qj . x = nk . x ; qi . x = qj . y ; float qk = texture2D ( pY , qj . xy , 0.0 ) . g ; qj . z = py ( pY , p_ , nl . zw , nm . w ) ; qi . y = qj . z ; qi = abs ( nI ( qi / u_texel_size . yy - pX . yy ) ) ; vec2 ql = sqrt ( qi ) ; float qm = texture2D ( pY , qj . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; qb . ba = pF ( pZ , ql , qk , qm , qa . x ) ; qj . x = pW . x ; pV ( pY , qb . ba , qj . xyxz , qi ) ; } return qb ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qE ( vec2 qo , sampler2D qp , sampler2D qq".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qr"]}]}}]},{type:"textline",b:") { vec4 qs ; qs . x = texture2D ( qq , nj . xy ) . a ; qs . y = texture2D ( qq , nj . zw ) . g ; qs . wz = texture2D ( qq , qo ) . xz ; if ( dot ( qs , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 qt = texture2D ( qp , qo , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qu = texture2D ( qr , a ) ; vec2 qv = 2.0 * cE ( qu ) - 1.0 ; qt . a = sqrt ( 2.0 * length ( qv ) ) ;".split(" ")}]}}]},{type:"textline",b:"return qt ; } else { bool qw = max ( qs . x , qs . z ) > max ( qs . y , qs . w ) ; vec4 qx = vec4 ( 0.0 , qs . y , 0.0 , qs . w ) ; vec2 qy = qs . yw ; nD ( bvec4 ( qw , qw , qw , qw ) , qx , vec4 ( qs . x , 0.0 , qs . z , 0.0 ) ) ; nD ( bvec2 ( qw , qw ) , qy , qs . xz ) ; qy /= dot ( qy , vec2 ( 1.0 , 1.0 ) ) ; vec4 qz = qx * vec4 ( u_texel_size , - u_texel_size ) + qo . xyxy ; vec4 qA = qy . x * texture2D ( qp , qz . xy , 0.0 ) ; qA += qy . y * texture2D ( qp , qz . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qB = texture2D ( qr , qz . xy ) ; vec2 qC = 2.0 * cE ( qB ) - 1.0 ; vec2 qD = qy . x * qC ; qB = texture2D ( qr , qz . zw ) ; qC = 2.0 * cE ( qB ) - 1.0 ; qD += qy . y * qC ; qA . a = sqrt ( 2.0 * length ( qD ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","qA",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qQ ( vec2 qF , sampler2D qG , sampler2D qH".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qI"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qJ = texture2D ( qI , a ) ; vec2 qK ; qK = 2.0 * cE ( qJ ) - 1.0 ; vec4 qL = texture2D ( qG , qF ) ; vec4 qM = texture2D ( qH , qF - qK ) ; float qN = abs ( qL . a * qL . a - qM . a * qM . a ) / 2.0 ; float qO = 0.5 * clamp ( 1.0 - sqrt ( qN ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 qP = mix ( qL , qM , qO ) ; qP . a = 1.0 ; return qP ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qL = texture2D ( qG , qF ) ; vec4 qM = texture2D ( qH , qF ) ; return mix ( qL , qM , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qR = vec4 ( n_ ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qR = qn ( a , nn , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qR = qE ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qR = vec4 ( qQ ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qR = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","qR",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","nj",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nk ; varying vec4 nl ; varying vec4 nm ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nn",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void lv ( vec2 lu ) { nk = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + lu . xyxy ; nl = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + lu . xyxy ; nm = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + lu . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void ly ( vec2 lw , out vec2 lx ) { lx = lw / u_texel_size ; nk = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + lw . xyxy ; nl = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + lw . xyxy ; nm = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( nk . xz , nl . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void lA ( vec2 lz ) { nj = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + lz . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = a_bb_vertex + 0.5 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["lv","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"ly ( a , nn ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["lA","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},{type:"define",
name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float np ( in vec2 no ) { return ne ( u_depth , no , u_camera_range ) ; } void main ( ) { float nq = texture2D ( u_color , a ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( nq , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"vec3 nr = normalize ( 2.0 * texture2D ( u_ssao_special_tex , a * 0.25 / u_texel_size ) . rgb - 1.0 ) ; float ns = np ( a ) ; float nt = ns * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_8"],group:{type:"group",a:[{type:"textline",b:"const float nu = 8.0 ; const int nv = 1 ;".split(" ")}]}},
{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"const float nu = 16.0 ; const int nv = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_24"],group:{type:"group",a:[{type:"textline",b:"const float nu = 24.0 ; const int nv = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"const float nu = 32.0 ; const int nv = 4 ;".split(" ")}]}}]},{type:"textline",b:"float nw = u_ssao_radius_increase * 0.001 ; const float nx = 1.0 + 2.4 / nu ; float ny = 0.0 ; for ( int nz = 0 ; nz < nv ; nz ++ ) for ( int nA = - 1 ; nA <= 1 ; nA += 2 ) for ( int nB = - 1 ; nB <= 1 ; nB += 2 ) for ( int nC = - 1 ; nC <= 1 ; nC += 2 ) { vec3 nD = reflect ( normalize ( vec3 ( nA , nB , nC ) ) , nr ) * ( nw *= nx ) ; vec3 nE = vec3 ( a , nt ) ; nE += vec3 ( nD . xy , nD . z * nt * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nE . z -= 1.4 * ( nE . z - nt ) * step ( nt , nE . z ) ;".split(" ")}]}}]},{type:"textline",b:"float nF = np ( nE . xy ) * ( u_camera_range . y - u_camera_range . x ) ; float nG = clamp ( ( nt - nF ) / nF , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"ny += mix ( 1.0 , nG , step ( nF , nE . z ) ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"ny += mix ( step ( nE . z , nF ) , 0.5 , nG ) ;".split(" ")}]}}]},{type:"textline",b:"} ny = ny / nu ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"ny = clamp ( ny * ny + 0.6 * ny , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ny = clamp ( ny * ny + ny , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"float nH = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * ns ) ; ny = mix ( 1.0 , ny , nH ) ; gl_FragColor = vec4 ( nq , ny , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float np ( in vec2 no ) { return ne ( u_depth , no , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float nq = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nr = np ( a ) ; float ns = 0.0 ; float nt = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"vec2 nu = vec2 ( - 2.0 ) ; for ( int nv = 0 ; nv < 4 ; ++ nv ) { for ( int nw = 0 ; nw < 4 ; ++ nw ) { vec2 nx = ( nu + vec2 ( float ( nv ) , float ( nw ) ) ) * u_texel_size ; float ny = texture2D ( u_ssao_mask , a + nx ) . g ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nz = np ( a + nx ) ; float nA = 1.0 - clamp ( abs ( nz - nr ) * nt , 0.0 , 1.0 ) ; nq += ny * nA ; ns += nA ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nq","+=","ny",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nq / ns , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nq / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { float lu = texture2D ( u_depth , a ) . x ; vec4 lv = vec4 ( a * 2.0 - 1.0 , 2.0 * lu - 1.0 , 1.0 ) ; vec4 lw = u_view_proj_inverse * lv ; vec4 lx = lw / lw . w ; vec4 ly = u_view_proj_prev * lx ; ly /= ly . w ; vec2 lz = ( lv . xy - ly . xy ) / 4.0 + 0.5 ; lz = clamp ( lz , 0.0 , 1.0 ) ; gl_FragColor = cs ( lz ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; float c = 1.0 ; struct d { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool g ( vec3 e , vec3 f ) { return any ( lessThan ( abs ( e - f ) , vec3 ( EPSILON ) ) ) ; } vec3 j ( in vec4 h , in vec3 i ) { return i + 2.0 * cross ( h . xyz , cross ( h . xyz , i ) + h . w * i ) ; } mat4 k ( ) { return mat4 ( c , b , b , b , b , c , b , b , b , b , c , b , b , b , b , c ) ; } mat4 m ( float l ) { return mat4 ( c , b , b , b , b , cos ( l ) , sin ( l ) , b , b , - sin ( l ) , cos ( l ) , b , b , b , b , c ) ; } mat4 o ( float n ) { return mat4 ( cos ( n ) , b , - sin ( n ) , b , b , c , b , b , sin ( n ) , b , cos ( n ) , b , b , b , b , c ) ; } mat4 q ( float p ) { return mat4 ( cos ( p ) , sin ( p ) , b , b , - sin ( p ) , cos ( p ) , b , b , b , b , c , b , b , b , b , c ) ; } d s ( in d r ) { return d ( r . a , r . b , normalize ( r . c ) , normalize ( r . d ) , normalize ( r . e ) , r . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 t = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 z ( vec3 u , mat4 v ) { vec3 w = vec3 ( v [ 0 ] [ 0 ] , v [ 1 ] [ 0 ] , v [ 2 ] [ 0 ] ) ; vec3 x = vec3 ( v [ 0 ] [ 1 ] , v [ 1 ] [ 1 ] , v [ 2 ] [ 1 ] ) ; vec3 y = vec3 ( v [ 0 ] [ 2 ] , v [ 1 ] [ 2 ] , v [ 2 ] [ 2 ] ) ; x = cross ( y , w ) ; return mat4 ( vec4 ( w , 0.0 ) , vec4 ( x , 0.0 ) , vec4 ( y , 0.0 ) , vec4 ( u , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 F ( vec3 A , vec3 B ) { vec3 C = A - B ; C . y = 0.0 ; C = normalize ( C ) ; vec3 D = normalize ( cross ( t , C ) ) ; vec3 E = normalize ( cross ( C , D ) ) ; return mat4 ( vec4 ( D , 0.0 ) , vec4 ( E , 0.0 ) , vec4 ( C , 0.0 ) , vec4 ( B , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 Q ( in vec3 G , float H , float I , float J , vec3 L ) { float M = fract ( length ( L ) / 0.17 ) ; float N = J + M / 10.0 ; float O = M ; if ( J != 0.0 ) O /= J ; G *= 1.0 + 0.5 * sin ( H ) ; float P = length ( G ) * I * sin ( 2.0 * 3.14 * H * N + O ) ; return q ( P ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 aa ( in vec3 R , in vec3 S , in mat4 T ) {".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 U = z ( S , T ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"float V = fract ( ( S . x * 1.43 + S . y * 0.123 + S . z * 6.1 ) ) ; float W = 2.0 * M_PI * V ; vec3 X = normalize ( vec3 ( T [ 0 ] [ 2 ] , 0.0 , T [ 2 ] [ 2 ] ) ) ; float Y = acos ( X [ 2 ] ) ; if ( X [ 0 ] < 0.0 ) Y = 2.0 * M_PI - Y ; float Z = Y - W ; if ( Z < 0.0 ) Z = 2.0 * M_PI + Z ; float _ = W ; if ( Z <= MAX_BILLBOARD_ANGLE ) _ += Z ; else if ( Z <= M_PI - MAX_BILLBOARD_ANGLE ) _ += MAX_BILLBOARD_ANGLE * ( 2.0 * Z - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( Z <= M_PI + MAX_BILLBOARD_ANGLE ) _ += Z - M_PI ; else if ( Z <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) _ += MAX_BILLBOARD_ANGLE * ( 2.0 * Z - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else _ += Z - 2.0 * M_PI ; mat4 U = o ( _ ) ; U [ 3 ] = vec4 ( S , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 U = F ( R , S ) ;".split(" ")}]}}]},{type:"textline",b:["return","U",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 ag ( in vec3 ab , in vec3 ac , in mat4 ad , mat4 ae ) { mat4 af = aa ( ab , ac , ad ) ; ae [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; af *= ae ; return af ; }".split(" ")}]}}]},{type:"textline",b:"d an ( in vec3 ah , in vec3 ai , in vec3 aj , in vec3 ak , in vec3 al , in mat4 am ) { ah = ( am * vec4 ( ah , 1.0 ) ) . xyz ; ai = ( am * vec4 ( ai , 1.0 ) ) . xyz ; aj = ( am * vec4 ( aj , 0.0 ) ) . xyz ; ak = ( am * vec4 ( ak , 0.0 ) ) . xyz ; al = ( am * vec4 ( al , 0.0 ) ) . xyz ; return s ( d ( ah , ai , aj , ak , al , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};
a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 aq ( vec2 ao , vec3 ap ) { return ( ao + 0.5 ) * ap . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 az ( in vec4 ar , in vec4 as , in float at ) { float au = ar [ 0 ] * as [ 0 ] + ar [ 1 ] * as [ 1 ] + ar [ 2 ] * as [ 2 ] + ar [ 3 ] * as [ 3 ] ; if ( au < 0.0 ) { as *= - 1.0 ; au = - au ; } if ( abs ( au ) >= 1.0 ) return ar ; float av = acos ( au ) ; float aw = sqrt ( 1.0 - au * au ) ; if ( abs ( aw ) < 0.001 ) return vec4 ( ar * 0.5 + as * 0.5 ) ; float ax = sin ( ( 1.0 - at ) * av ) / aw ; float ay = sin ( at * av ) / aw ; return ar * ax + as * ay ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aO ( in vec3 aA , in vec4 aB , in vec4 aC , in vec4 aD , in vec4 aE , in float aF ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aG = az ( aB , aC , aF ) ; vec4 aH = mix ( aD , aE , aF ) ; vec3 aI = j ( aG , aA ) ; vec3 aJ = aI * aH . w + aH . xyz ; return aJ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aK = j ( aB , aA ) ; vec3 aL = j ( aC , aA ) ; vec3 aM = aK * aD . w + aD . xyz ; vec3 aN = aL * aE . w + aE . xyz ; return mix ( aM , aN , aF ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aX ( in vec3 aP , in vec4 aQ , in vec4 aR , in float aS ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aT = az ( aQ , aR , aS ) ; vec3 aU = j ( aT , aP ) ; return aU ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aV = j ( aQ , aP ) ; vec3 aW = j ( aR , aP ) ; return mix ( aV , aW , aS ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 aO ( in vec3 aY , in vec4 aZ , in vec4 a_ ) { vec3 ba = j ( aZ , aY ) ; vec3 bb = ba * a_ . w + a_ . xyz ; return bb ; } vec3 aX ( in vec3 bc , in vec4 bd ) { vec3 be = j ( bd , bc ) ; return be ; }".split(" ")}]}}]},{type:"textline",b:"void bt ( inout vec3 bf , inout vec3 bg , inout vec3 bh , inout vec3 bi ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["float","bj","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { vec3 bk = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bl = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bm = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bn = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec4 bo = a_influence ; for ( int bp = 0 ; bp < 4 ; bp ++ ) { int bq = int ( bo [ bp ] ) ; float br = fract ( bo [ bp ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bk += br * aO ( bf , u_quatsb [ bq ] , u_quatsa [ bq ] , u_transb [ bq ] , u_transa [ bq ] , bj ) ; bl += br * aX ( bg , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ; bm += br * aX ( bh , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ; bn += br * aX ( bi , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bk += br * aO ( bf , u_quatsb [ bq ] , u_transb [ bq ] ) ; bl += br * aX ( bg , u_quatsb [ bq ] ) ; bm += br * aX ( bh , u_quatsb [ bq ] ) ; bn += br * aX ( bi , u_quatsb [ bq ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} bf = bk ; bg = bl ; bh = bm ; bi = bn ; } if ( ! ( a_influence . y > 0.0 ) ) { int bs = int ( a_influence [ 0 ] - 1.0 ) ; if ( bs > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bf = aO ( bf , u_quatsb [ bs ] , u_quatsa [ bs ] , u_transb [ bs ] , u_transa [ bs ] , bj ) ; bg = aX ( bg , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ; bh = aX ( bh , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ; bi = aX ( bi , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bf = aO ( bf , u_quatsb [ bs ] , u_transb [ bs ] ) ; bg = aX ( bg , u_quatsb [ bs ] ) ; bh = aX ( bh , u_quatsb [ bs ] ) ; bi = aX ( bi , u_quatsb [ bs ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bH ( inout vec3 bu , in vec3 bv , in float bw , in float bx , in float by , in vec3 bz , in float bA ) { float bB = length ( bv ) ; float bC = bx * ( 1.0 + 0.1 * fract ( bB ) ) ; float bD = bw * bA * ( 1.0 + sin ( 2.0 * 3.14 * by * bC + bB ) ) ; float bE = ( bu . y - bv . y ) * abs ( bD ) ; bE += 1.0 ; bE *= bE ; bE = bE * bE - bE ; vec3 bF = bu ; bF . xz += bz . xz * bE * sign ( bD ) ; float bG = length ( bu - bv ) ; bu = bv + normalize ( bF - bv ) * bG ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bJ ( vec4 bI ) { return bI * bI * ( 3.0 - 2.0 * bI ) ; } vec4 bL ( vec4 bK ) { return abs ( fract ( bK + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bN ( vec4 bM ) { return bJ ( bL ( bM ) ) ; } void cd ( inout vec3 bO , in float bP , in vec3 bQ , in vec3 bR , in vec3 bS , in float bT , in float bU , in float bV , in vec3 bW ) { float bX ; float bY ; float bZ ; vec2 b_ ; vec4 ca ; vec2 cb ; vec3 cc ; bX = dot ( bS , vec3 ( 1.0 ) ) ; bY = bX + bW . g ; bZ = dot ( bO , vec3 ( bW . g ) ) ; b_ = ( bP + vec2 ( bZ , bY ) ) ; ca = ( ( fract ( ( b_ . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bR ) * bT ; ca = bN ( ca ) ; cb = ca . xz + ca . yw ; cb . y = 0.5 - cb . y ; cc = cb . xyx * bW . rbr * vec3 ( bU * bQ . x , bV , bU * bQ . z ) ; bO += cc ; }".split(" ")}]}}]},
{type:"textline",b:"void ck ( inout vec3 ce , inout vec3 cf , in vec3 cg ) { vec3 ch = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vec3 ci = cf ; vec3 cj = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ci = ce ; vec3 cj = cf ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"cd ( ci , u_time , cg , ch , cj , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bH ( ci , cj , au_wind_bending_amp , au_wind_bending_freq , u_time , ch , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bH ( ci , cj , au_wind_bending_amp , au_wind_bending_freq , u_time , ch , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"ce += ci - cf ; cf = ci ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ce = ci ; cf = cj ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",
b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",
b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float cl = 255.0 ; float cm = 0.0 ; float cn = 1.0 ; vec4 cs ( const in float co ) { vec4 cp = vec4 ( cl * cl * cl , cl * cl , cl , cn ) ; vec4 cq = vec4 ( cm , cn / cl , cn / cl , cn / cl ) ; vec4 cr = fract ( co * cp ) ; cr -= cr . xxyz * cq ; return cr ; } float cw ( const in vec4 ct ) { float cu ; vec4 cv = vec4 ( cn / ( cl * cl * cl ) , cn / ( cl * cl ) , cn / cl , cn ) ; cu = dot ( ct , cv ) ; return cu ; } vec4 cs ( const in vec2 cx ) { vec2 cy = vec2 ( cl , cn ) ; vec2 cz = vec2 ( cm , cn / cl ) ; vec4 cA = fract ( cx . xxyy * cy . xyxy ) ; cA -= cA . xxzz * cz . xyxy ; if ( cx . r == cn ) cA . rg = vec2 ( cm , cn ) ; if ( cx . g == cn ) cA . ba = vec2 ( cm , cn ) ; return cA ; } vec2 cE ( const in vec4 cB ) { vec2 cC ; vec2 cD = vec2 ( cn / cl , cn ) ; cC . r = dot ( cB . rg , cD ) ; cC . g = dot ( cB . ba , cD ) ; return cC ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float cM = 0.0 ; float cN = 1.0 ; vec4 cP ( vec4 cO ) { return cO - floor ( cO * ( cN / 289.0 ) ) * 289.0 ; } vec3 cP ( vec3 cQ ) { return cQ - floor ( cQ * ( cN / 289.0 ) ) * 289.0 ; } vec2 cP ( vec2 cR ) { return cR - floor ( cR * ( cN / 289.0 ) ) * 289.0 ; } vec4 cT ( vec4 cS ) { return cS - floor ( cS * ( cN / 7.0 ) ) * 7.0 ; } vec4 cV ( vec4 cU ) { return cP ( ( 34.0 * cU + 5.0 ) * cU ) ; }".split(" ")},{type:"define",name:"K",
b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 dg ( vec2 cW ) { vec2 cX = cP ( floor ( cW ) ) ; vec2 cY = fract ( cW ) ; vec4 cZ = cY . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 c_ = cY . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 da = cV ( cX . x + vec4 ( cM , cN , cM , cN ) ) ; da = cV ( da + cX . y + vec4 ( cM , cM , cN , cN ) ) ; vec4 db = cT ( da ) * K + K2 ; vec4 dc = cT ( floor ( da * K ) ) * K + K2 ; vec4 dd = cZ + JITTER * db ; vec4 de = c_ + JITTER * dc ; vec4 df = dd * dd + de * de ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"df . xy = min ( df . xy , df . zw ) ; df . x = min ( df . x , df . y ) ; return df . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"df . xy = ( df . x < df . y ) ? df . xy : df . yx ; df . xz = ( df . x < df . z ) ? df . xz : df . zx ; df . xw = ( df . x < df . w ) ? df . xw : df . wx ; df . y = min ( df . y , df . z ) ; df . y = min ( df . y , df . w ) ; return sqrt ( df . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 dw ( vec2 dh , float di ) { vec2 dj = cP ( floor ( dh ) ) ; vec2 dk = fract ( dh ) ; vec4 dl = dk . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 dm = dk . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 dn = cV ( dj . x + vec4 ( cM , cN , cM , cN ) ) ; dn = cV ( dn + dj . y + vec4 ( cM , cM , cN , cN ) ) ; vec4 dp = cT ( dn ) * K + K2 ; vec4 dq = cT ( floor ( dn * K ) ) * K + K2 ; vec4 dr = dl + JITTER * dp ; vec4 ds = dm + JITTER * dq ; vec4 dt = dr * dr + ds * ds ; dr += di ; ds += di ; vec4 du = dr * dr + ds * ds ; dr += di ; ds += di ; vec4 dv = dr * dr + ds * ds ; dt . xy = min ( dt . xy , dt . zw ) ; dt . x = min ( dt . x , dt . y ) ; du . xy = min ( du . xy , du . zw ) ; du . x = min ( du . x , du . y ) ; dv . xy = min ( dv . xy , dv . zw ) ; dv . x = min ( dv . x , dv . y ) ; return mat3 ( dt . xx , cM , du . xx , cM , dv . xx , cM ) ; } vec3 dy ( vec3 dx ) { return cP ( ( ( dx * 34.0 ) + cN ) * dx ) ; } float dM ( vec2 dz ) { const vec4 dA = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 dB = floor ( dz + dot ( dz , dA . yy ) ) ; vec2 dC = dz - dB + dot ( dB , dA . xx ) ; vec2 dD ; dD = ( dC . x > dC . y ) ? vec2 ( cN , cM ) : vec2 ( cM , cN ) ; vec4 dE = dC . xyxy + dA . xxzz ; dE . xy -= dD ; dB = cP ( dB ) ; vec3 dF = dy ( dy ( dB . y + vec3 ( cM , dD . y , cN ) ) + dB . x + vec3 ( cM , dD . x , cN ) ) ; vec3 dG = max ( 0.5 - vec3 ( dot ( dC , dC ) , dot ( dE . xy , dE . xy ) , dot ( dE . zw , dE . zw ) ) , cM ) ; dG = dG * dG ; dG = dG * dG ; vec3 dH = 2.0 * fract ( dF * dA . www ) - cN ; vec3 dI = abs ( dH ) - 0.5 ; vec3 dJ = floor ( dH + 0.5 ) ; vec3 dK = dH - dJ ; dG *= 1.79284291400159 - 0.85373472095314 * ( dK * dK + dI * dI ) ; vec3 dL ; dL . x = dK . x * dC . x + dI . x * dC . y ; dL . yz = dK . yz * dE . xz + dI . yz * dE . yw ; return 130.0 * dot ( dG , dL ) ; } vec2 dS ( vec2 dN ) { float dO = dot ( dN , vec2 ( 12.9898 , 78.233 ) ) ; float dP = dot ( dN , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float dQ = fract ( sin ( dO ) * 43758.5453 ) * 2.0 - cN ; float dR = fract ( sin ( dP ) * 43758.5453 ) * 2.0 - cN ; return vec2 ( dQ , dR ) ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","dT",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"const float dU = 0.1 ; const float dV = 0.1 ; const float dW = - 0.01 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"const float dX = 0.05 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mat4 dY = mat4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 , 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 , - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 , - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; mat4 dZ = mat4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 , - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 , - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 , - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"bool eb ( vec2 d_ , float ea ) { return all ( lessThanEqual ( d_ , vec2 ( 1.0 + ea ) ) ) && all ( greaterThanEqual ( d_ , vec2 ( 0.0 - ea ) ) ) ; }".split(" ")}]}}]},{type:"textline",b:"float eo ( vec3 ec , sampler2D ed , float ee ) { float ef ; ec . z = clamp ( ec . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",
a:[{type:"textline",b:"ef = 0.0 ; float eg = dS ( ec . xy ) . x * M_PI ; float eh = cos ( eg ) ; float ei = sin ( eg ) ; mat2 ej = mat2 ( eh , ei , - ei , eh ) ; vec2 ek , el ; for ( int em = 0 ; em < 4 ; em ++ ) for ( int en = 0 ; en < 4 ; en ++ ) { el . x = dY [ em ] [ en ] ; el . y = dZ [ em ] [ en ] ; el = ej * el ; ek = ec . xy + el * ee / SHADOW_TEX_RES ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ! eb ( ek , dW ) ) ef += 1.0 ; else".split(" ")}]}}]},
{type:"textline",b:"ef += step ( ec . z , texture2D ( ed , ek ) . r ) ; } ef /= 16.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["ef","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( ef , 0.0 , 1.0 ) ; } float eG ( vec3 ep , sampler2D eq , vec3 er , sampler2D es , float et , float eu , float ev ) { float ew , ex ; ep . z = clamp ( ep . z , 0.0 , 1.0 ) ; er . z = clamp ( er . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],
group:{type:"group",a:[{type:"textline",b:"ew = 0.0 ; ex = 0.0 ; float ey = dS ( ep . xy ) . x * M_PI ; float ez = cos ( ey ) ; float eA = sin ( ey ) ; mat2 eB = mat2 ( ez , eA , - eA , ez ) ; vec2 eC , eD ; for ( int eE = 0 ; eE < 4 ; eE ++ ) for ( int eF = 0 ; eF < 4 ; eF ++ ) { eD . x = dY [ eE ] [ eF ] ; eD . y = dZ [ eE ] [ eF ] ; eD = eB * eD ; eC = ep . xy + eD * et / SHADOW_TEX_RES ; ew += step ( ep . z , texture2D ( eq , eC ) . r ) ; eC = er . xy + eD * eu / SHADOW_TEX_RES ; ex += step ( er . z , texture2D ( es , eC ) . r ) ; } ew = mix ( ew , ex , ev ) ; ew /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["ew","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( ew , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"float eK ( vec2 eH ) { float eI = min ( eH . x , eH . y ) ; float eJ = min ( 1.0 - eH . x , 1.0 - eH . y ) ; return min ( eI , eJ ) ; } float eN ( float eL , float eM ) { if ( eM >= 0.0 && eM <= dV ) eL = ( eL - 1.0 ) / dV * eM + 1.0 ; return eL ; } float eZ ( vec3 eO , vec3 eP , sampler2D eQ , sampler2D eR , float eS , float eT , float eU , float eV ) { float eW ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"float eX = eK ( eO . xy ) ; if ( - eV > eU && eX >= 0.0 && eX <= dU && eb ( eP . xy , 0.0 ) ) { float eY = 1.0 - eX / dU ; eW = eG ( eO , eQ , eP , eR , eS , eT , eY ) ; } else".split(" ")}]}}]},{type:"textline",b:"eW = eo ( eO , eQ , eS ) ; return eW ; } float fg ( vec3 e_ , sampler2D fa , float fb , float fc , float fd ) { float fe = eo ( e_ , fa , fb ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - fd > fc ) { float ff = eK ( e_ . xy ) ; fe = eN ( fe , ff ) ; }".split(" ")}]}}]},{type:"textline",b:"return fe ; } float fn ( float fh ) { float fi = 1.0 ; vec3 fj = cG . xyz / cG . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"vec3 fk = cH . xyz / cH . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:"vec3 fl = cI . xyz / cI . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"vec3 fm = cJ . xyz / cJ . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( eb ( fj . xy , 0.0 ) ) { fi = eZ ( fj , fk , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , fh ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( eb ( fj . xy , dX ) ) { fi = fg ( fj , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , fh ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fk . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"fi = eZ ( fk , fl , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , fh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"fi = fg ( fk , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , fh ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fl . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"fi = eZ ( fl , fm , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , fh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"fi = fg ( fl , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , fh ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fm . xy , 0.0 ) ) fi = fg ( fm , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , fh ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","fi",";","}"]}]}}]}]}}]},{type:"textline",b:"float fs ( inout vec3 fo ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 fp = texture2DProj ( u_shadow_mask , cK ) . rg ; vec3 fq = vec3 ( fp . r ) ; float fr = fp . g ; dT = vec4 ( fq , fr ) ; fo *= dT . a ; return dT . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return fn ( cL . z ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 fx ( vec3 ft , float fu , vec2 fv ) { vec2 fw = vec2 ( ( ft . x - fv . x ) / fu , - ( ft . z - fv . y ) / fu ) ; return fract ( fw ) ; } vec2 fB ( vec2 fy , float fz , vec2 fA ) { return vec2 ( fy . x * fz , - fy . y * fz ) + fA ; } d fC ( ) { return d ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } d gh ( vec3 fD , vec3 fE , vec3 fF , vec3 fG , vec3 fH , sampler2D fI , sampler2D fJ , vec3 fK , float fL , vec3 fM , vec4 fN , mat4 fO ) { vec3 fP = j ( fN , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float fQ = - fP . x ; float fR = - fP . z ; vec2 fS = vec2 ( fM . x + fL * ( - 1.0 - fQ ) / 2.0 , fM . z + fL * ( 1.0 - fR ) / 2.0 ) ; vec2 fT = fx ( fH , fL , fS ) ; float fU = fL / 2.0 ; vec2 fV = abs ( fB ( fT - vec2 ( 0.5 ) , fL , vec2 ( 0.0 ) ) ) ; float fW = fU * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( fV ) > fW ) return fC ( ) ; float fX = fL / fK . z ; vec2 fY = ( fT - vec2 ( 0.5 ) ) * fX + vec2 ( 0.5 ) ; vec3 fZ = fP * ( fL / fK . z - 1.0 ) / 2.0 ; fY . x += fZ . x ; fY . y -= fZ . z ; vec4 f_ = texture2D ( fJ , fY ) ; float ga = f_ . r ; if ( ga < u_scale_threshold ) return fC ( ) ; float gb = fK . y - fK . x ; float gc = fK . y - texture2D ( fI , fY ) . r * gb ; vec2 gd = fD . xz - fH . xz ; fH . xz = fB ( fT , fL , fS ) ; fH . y = gc ; fD . xz = fH . xz + gd ; fD . y *= ga ; fD . y += gc ; vec3 ge = f_ . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fD -= fH ; mat4 gf = aa ( fM , fH , fO ) ; d gg = an ( fD , fH , fE , fF , fG , gf ) ; gg . b = fH ; gg . f = ge ; return s ( gg ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return s ( d ( fD , fH , fE , fF , fG , ge ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"vec4 gn ( mat4 gi , vec4 gj ) { vec2 gk = ( gi * u_v_light_matrix [ 3 ] ) . xy ; float gl = SHADOW_TEX_RES / 2.0 ; gk = floor ( gk * gl + 0.5 ) / gl - gk ; vec4 gm = gi * gj ; gm . xy += gk ; gm = u_b_light_matrix * gm ; return gm ; } void gr ( vec3 go ) { vec3 gp = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ; vec4 gq = u_v_light_matrix * vec4 ( go + u_normal_offset * gp , 1.0 ) ; cG = gn ( u_p_light_matrix0 , gq ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cH = gn ( u_p_light_matrix1 , gq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cI = gn ( u_p_light_matrix2 , gq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cJ = gn ( u_p_light_matrix3 , gq ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void gr ( vec4 gs ) { float gt = gs . x ; float gu = gs . y ; float gv = gs . w ; cK . x = ( gt + gv ) / 2.0 ; cK . y = ( gu + gv ) / 2.0 ; cK . z = gv ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void gy ( inout vec3 gx ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"gx = max ( vec3 ( 0.0 ) , gx ) ; gx = pow ( gx , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gA ( inout vec3 gz ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"gz = max ( vec3 ( 0.0 ) , gz ) ; gz = pow ( gz , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gD ( inout vec3 gB , in float gC ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"gB = gB * gC ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void gL ( inout vec3 gG , in float gH , in vec4 gI ) { float gJ = gI . w * gH ; float gK = exp ( - gJ * gJ ) ; gK = clamp ( gK , 0.0 , 1.0 ) ; gG = mix ( gI . rgb , gG , gK ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 gS ( in mat4 gM , in vec3 gN ) { vec3 gO = mix ( gM [ 0 ] . rgb , gM [ 1 ] . rgb , max ( sign ( gN . x ) , 0.0 ) ) ; vec3 gP = mix ( gM [ 2 ] . rgb , gM [ 3 ] . rgb , max ( sign ( gN . z ) , 0.0 ) ) ; vec3 gQ = vec3 ( gM [ 0 ] . a , gM [ 1 ] . a , gM [ 2 ] . a ) ; vec3 gR = mix ( gO , gP , abs ( gN . z ) ) ; gR = mix ( gR , gQ , abs ( gN . y ) ) ; return gR ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void gU ( inout float gT ) { gT -= 0.5 ; gT = 4.0 * ( gT * gT * gT ) + 0.5 ; } void hk ( inout vec3 gV , in float gW , in vec3 gX , in float gY , in vec4 gZ , in vec4 g_ , in float ha , in float hb ) { float hc = g_ . w * gW ; float hd = exp ( - hc * hc ) ; hd = clamp ( hd , 0.0 , 1.0 ) ; float he = max ( gX . y , 0.0 ) ; gW = max ( gW - max ( gY / he , 0.0 ) , 0.0 ) ; float hf = gZ . w * gW ; float hg = 1.0 - hf ; hg = max ( hg , 0.0 ) ; gU ( hg ) ; hg += max ( ha - 0.5 , 0.0 ) ; if ( hg < hd ) { vec3 hh = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 hi = gZ . rgb ; gY = clamp ( - gY * 0.03 , 0.0 , 0.8 ) ; vec3 hj = mix ( hi , hh , min ( he , 1.0 ) ) ; hj = mix ( hj , vec3 ( 0.0 ) , gY ) * hb ; gV = mix ( hj , gV , hg ) ; } if ( hg >= hd ) { gV = mix ( g_ . rgb , gV , hd ) ; } } void ht ( inout vec3 hl , in float hm , in float hn , in vec4 ho , in float hp ) { float hq = ho . w * hm ; float hr = 1.0 - hq ; hr = clamp ( hr , 0.0 , 1.0 ) ; gU ( hr ) ; hn = clamp ( - hn * 0.03 , 0.0 , 0.8 ) ; vec3 hs = mix ( ho . rgb , vec3 ( 0.0 ) , hn ) * hp ; hl = mix ( hs , hl , hr ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"float hu = 0.0 ; float hv = 1.0 ; struct hw { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float hE ( vec3 hx , vec3 hy , vec3 hz , vec4 hA , float hB ) { vec3 hC = normalize ( hx + hy ) ; float hD = hA [ 0 ] * max ( dot ( hz , hC ) , hu ) + hA [ 1 ] ; return pow ( hD , hB ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hP ( vec3 hF , vec3 hG , vec3 hH , float hI ) { vec3 hJ = normalize ( hF + hG ) ; float hK = max ( dot ( hH , hJ ) , 0.001 ) ; float hL = max ( dot ( hH , hG ) , 0.01 ) ; float hM = max ( dot ( hH , hF ) , 0.01 ) ; float hN = tan ( acos ( hK ) ) ; float hO = max ( hI , 0.001 ) ; return hM * ( hv / ( 4.0 * M_PI * hO * hO ) ) * ( exp ( - ( hN * hN ) / ( hO * hO ) ) / ( sqrt ( hL * hM ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hX ( vec3 hQ , vec3 hR , vec3 hS , float hT , float hU ) { vec3 hV = normalize ( hQ + hR ) ; float hW = acos ( dot ( hV , hS ) ) ; if ( hW < hT ) return hv ; else if ( hW >= hT + hU || hU == hu ) return hu ; else return hv - ( hW - hT ) / hU ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void is ( float hY , vec3 hZ , vec3 h_ , vec3 ia , float ib , inout float ic ) { if ( ib > hu ) { float id = max ( dot ( hZ , ia ) , hu ) ; float ie = ib * ib ; float ig = hv - 0.5 * ( ie / ( ie + 0.33 ) ) ; vec3 ih = h_ - hY * hZ ; vec3 ii = ia - id * hZ ; if ( length ( ih ) == hu || length ( ii ) == hu || abs ( hY ) > hv || abs ( id ) > hv ) ic = ic * ig ; else { float ij = acos ( hY ) ; float ik = acos ( id ) ; vec3 il = normalize ( ih ) ; vec3 im = normalize ( ii ) ; float io , ip ; io = max ( ij , ik ) ; ip = min ( ij , ik ) ; ip *= 0.95 ; float iq = max ( dot ( il , im ) , hu ) ; float ir = 0.45 * ( ie / ( ie + 0.09 ) ) ; ic = ic * ( ig + ( ir * iq * sin ( io ) * tan ( ip ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void iz ( vec3 it , vec3 iu , float iv , float iw , out float ix ) { float iy ; if ( iv == hu ) { ix = hv ; } else { iy = hv + abs ( dot ( iu , it ) ) ; iy = iw + ( hv - iw ) * pow ( iy , iv ) ; ix = clamp ( iy , hu , hv ) ; } }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS","&&","NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"void jg ( inout hw iA , vec3 iB , vec3 iC , vec3 iD , vec3 iE , vec3 iF , vec2 iG , vec2 iH , float iI , vec3 iJ , vec3 iK , vec3 iL , vec4 iM , vec4 iN , float iO , vec4 iP ) { if ( iM . w + iN . w == hu ) return ; vec3 iQ = vec3 ( hu ) ; vec3 iR = iL * iI ; float iS = iN . z ; if ( iS != - hv ) { iQ = iJ - iD ; float iT = length ( iQ ) ; iR *= iS / ( iS + iT * iT ) ; iQ = normalize ( iQ ) ; float iU = iN . x ; float iV = iN . y ; if ( iU > - hv ) { float iW = dot ( iQ , iK ) ; iW *= smoothstep ( hu , hv , ( iW - iU ) / iV ) ; iR *= iW ; } } else iQ = iK ; float iX = hu ; if ( iM . w != hu ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"iz ( iE , iQ , iH [ 0 ] , iH [ 1 ] , iX ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float iY = max ( dot ( iE , iQ ) , hu ) ; iX = iM [ 0 ] * iY + iM [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"is ( iY , iE , iQ , iF , iH [ 0 ] , iX ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float iZ = hu ; if ( iN . w != hu ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"iZ = hE ( iQ , iF , iE , iM , iG [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"iZ = hP ( iQ , iF , iE , iG [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"iZ = hX ( iQ , iF , iE , iG [ 0 ] , iG [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["iZ","=","hu",";"]}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( iQ , iE ) * dot ( iF , iE ) < hu ) { float i_ = iP . x ; float ja = iP . y ; float jb = iP . z ; float jc = iP . w ; float jd = clamp ( abs ( dot ( iQ , iE ) ) , hu , hv ) ; float je = clamp ( dot ( iF , - iQ ) , hu , hv ) ; float jf = pow ( je , ja ) ; iA . a += iO * vec4 ( iR * jd * pow ( iB , vec3 ( i_ ) ) , hv ) ; iA . a += jb * mix ( vec4 ( iB , hv ) , vec4 ( hv ) , jc ) * iO * vec4 ( iR * jd * vec3 ( jf ) , hv ) ; } else { iA . b += iR * iC * iZ ; iA . a += vec4 ( iR * iB * iX , iZ ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"iA . b += iR * iC * iZ ; iA . a += vec4 ( iR * iB * iX , iZ ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hw jY ( vec3 jh , vec3 ji , vec3 jj , vec3 jk , vec3 jl , vec3 jm , vec3 jn , vec2 jo , vec2 jp , float jq , vec3 jr [ NUM_LIGHTS ] , vec3 js [ NUM_LIGHTS ] , vec3 jt [ NUM_LIGHTS ] , vec4 ju [ NUM_LIGHTS ] , vec4 jv [ NUM_LIGHTS ] , float jw , vec4 jx , int jy ) { hw jz ; jz . a = vec4 ( jh + jj * ji , hu ) ; jz . b = vec3 ( hu ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"textline",b:"float jA = hv ; if ( jy == 0 ) jA = jq ; jg ( jz , jj , jk , jl , jm , jn , jo , jp , jA , jr [ 0 ] , js [ 0 ] , jt [ 0 ] , ju [ 0 ] , jv [ 0 ] , jw , jx ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","1"],group:{type:"group",a:[{type:"textline",b:"float jB = hv ; if ( jy == 1 ) jB = jq ; jg ( jz , jj , jk , jl , jm , jn , jo , jp , jB , jr [ 1 ] , js [ 1 ] , jt [ 1 ] , ju [ 1 ] , jv [ 1 ] , jw , jx ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","2"],group:{type:"group",a:[{type:"textline",b:"float jC = hv ; if ( jy == 2 ) jC = jq ; jg ( jz , jj , jk , jl , jm , jn , jo , jp , jC , jr [ 2 ] , js [ 2 ] , jt [ 2 ] , ju [ 2 ] , jv [ 2 ] , jw , jx ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","3"],group:{type:"group",a:[{type:"textline",b:"float jD = hv ; if ( jy == 3 ) jD = jq ; jg ( jz , jj , jk , jl , jm , jn , jo , jp , jD , jr [ 3 ] , js [ 3 ] , jt [ 3 ] , ju [ 3 ] , jv [ 3 ] , jw , jx ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int jE = 0 ; jE < NUM_LIGHTS ; jE ++ ) { vec4 jF = ju [ jE ] ; vec4 jG = jv [ jE ] ; if ( jF . w + jG . w != hu ) { vec3 jH = vec3 ( hu ) ; vec3 jI = jt [ jE ] ; if ( jE == jy ) jI *= jq ; float jJ = jG . z ; if ( jJ != - hv ) { jH = jr [ jE ] - jl ; float jK = length ( jH ) ; jI *= jJ / ( jJ + jK * jK ) ; jH = normalize ( jH ) ; float jL = jG . x ; float jM = jG . y ; if ( jL > - hv ) { float jN = dot ( jH , js [ jE ] ) ; jN *= smoothstep ( hu , hv , ( jN - jL ) / jM ) ; jI *= jN ; } } else jH = js [ jE ] ; float jO = hu ; if ( jF . w != hu ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"iz ( jm , jH , jp [ 0 ] , jp [ 1 ] , jO ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float jP = max ( dot ( jm , jH ) , hu ) ; jO = jF [ 0 ] * jP + jF [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"is ( jP , jm , jH , jn , jp [ 0 ] , jO ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float jQ = hu ; if ( jG . w != hu ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"jQ = hE ( jH , jn , jm , jF , jo [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"jQ = hP ( jH , jn , jm , jo [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"jQ = hX ( jH , jn , jm , jo [ 0 ] , jo [ 1 ] ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( jH , jm ) * dot ( jn , jm ) < hu ) { float jR = jx . x ; float jS = jx . y ; float jT = jx . z ; float jU = jx . w ; float jV = clamp ( abs ( dot ( jH , jm ) ) , hu , hv ) ; float jW = clamp ( dot ( jn , - jH ) , hu , hv ) ; float jX = pow ( jW , jS ) ; jz . a += jw * vec4 ( jI * jV * pow ( jj , vec3 ( jR ) ) , hv ) ; jz . a += jT * mix ( vec4 ( jj , hv ) , vec4 ( hv ) , jU ) * jw * vec4 ( jI * jV * vec3 ( jX ) , hv ) ; } else { jz . b += jI * jk * jQ ; jz . a += vec4 ( jI * jj * jO , jQ ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"jz . b += jI * jk * jQ ; jz . a += vec4 ( jI * jj * jO , jQ ) ;".split(" ")}]}}]},{type:"textline",b:["}","}"]}]}}]},{type:"textline",b:["return","jz",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hw kc ( vec3 jZ , vec3 j_ , vec3 ka ) { hw kb ; kb . a = vec4 ( jZ + ka * j_ , hu ) ; kb . b = vec3 ( hu ) ; return kb ; }".split(" ")}]}}]}]};a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2",
"(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void kD ( inout vec3 kd , float ke , float kf , float kg , vec3 kh , vec3 ki , vec3 kj , vec4 kk , vec3 kl , float km ) { if ( km > CAUSTICS_VIEW_DISTANCE ) return ; vec4 kn = kk ; vec3 ko = kl + kh ; ko . xz = 10.0 * sin ( 0.1 * ko . xz ) ; vec3 kp = ko + 2.0 * cross ( - kn . xyz , cross ( - kn . xyz , ko ) + kn . w * ko ) ; vec2 kq = kp . xz ; vec3 kr = ki ; float ks = max ( dot ( kh , kr ) , 0.0 ) ; float kt = 0.025 ; kq . s += 0.5 * sin ( dot ( kl + kf , vec3 ( 1.0 ) ) ) ; kq . t += 0.7 * ( - sin ( dot ( kl - kf , vec3 ( - 0.7 ) ) ) ) ; kq . st += 0.23 * cos ( 4.0 * ke - CAUST_SPEED . x * kf ) ; kq . st += 3.0 * sin ( ke - 0.3 * CAUST_SPEED . y * kf ) ; float ku = CAUST_SCALE * ( 1.0 + max ( 0.1 * ke , 0.0 ) ) ; mat3 kv = dw ( ( kq / ku ) , kt ) ; float kw = ( kv * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; float kx = ( kv * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; float ky = ( kv * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; vec3 kz = CAUST_BRIGHT * vec3 ( kw , kx , ky ) ; float kA = kg * ks ; float kB = max ( sign ( ke ) , 0.0 ) ; kA = min ( kA + 0.5 * sign ( - kh . y ) * kB , 1.0 ) ; kA *= 1.0 - kB * ( 0.1 * ke ) ; kz *= kA ; kz *= kz ; float kC = min ( - ke + 10.0 , 1.0 ) ; kd += max ( ( 2.0 * kj * kz ) * kC , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float kR ( in vec3 kK , in vec3 kL , in float kM , in float kN ) { vec3 kO = normalize ( kL + kK ) ; float kP = 1.0 - dot ( kK , kO ) ; float kQ = kN + ( 1.0 - kN ) * pow ( kP , kM ) ; return kQ ; } void lf ( inout vec3 kS , in vec3 kT , in vec3 kU , in float kV , in float kW , in float kX ) { vec3 kY = reflect ( - kT , kU ) ; float kZ = 1.0 ; if ( kV != 0.0 ) kZ = kR ( kT , kY , kV , kW ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 k_ = u_refl_plane . xyz * dot ( kU , u_refl_plane . xyz ) ; vec3 la = kU - k_ ; vec2 lb = ( u_view_matrix_frag * vec4 ( la , 0.0 ) ) . xy ; vec2 lc = cK . xy / cK . z ; lc += lb * REFL_BUMP ; vec3 ld = texture2D ( u_reflectmap , lc ) . rgb ; gy ( ld . rgb ) ; kS = mix ( kS , ld , kX * kZ ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"vec3 le = textureCube ( u_mirrormap , kY ) . xyz ; gy ( le . rgb ) ; kS = mix ( kS , le , u_mirror_factor * kZ ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float ll ( in float lg , inout vec2 lh , in vec2 li ) { vec4 lj = texture2D ( u_scene_depth , lh ) ; float lk = cw ( lj ) ; if ( lk < kJ ) { lh = li ; return lg ; } else { return lk ; } return lg ; } vec3 lt ( in vec3 lm , in vec2 ln ) { vec2 lo = lm . xy / lm . z ; vec2 lp = lo + ln ; vec4 lq = texture2DProj ( u_scene_depth , lm ) ; float lr = cw ( lq ) ; ll ( lr , lp , lo ) ; vec3 ls = texture2D ( u_refractmap , lp ) . rgb ; gy ( ls ) ; return ls ; }".split(" ")}]}}]}]};
a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct mb { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mi ( inout float mc , float md , vec2 me , vec2 mf ) { float mg = mf . x - me . x ; float mh = ( md - me . x ) / mg ; mc = mix ( mc , mf . y , clamp ( mh , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mp ( inout vec3 mj , float mk , vec4 ml , vec4 mm ) { float mn = mm . x - ml . x ; float mo = ( mk - ml . x ) / mn ; mj = mix ( mj , mm . yzw , clamp ( mo , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float mw ( float mq , float mr , vec2 ms [ SIZE_RAMP_LENGTH ] ) { float mt = mq / mr ; float mu = ms [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mi ( mu , mt , ms [ 0 ] , ms [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mi ( mu , mt , ms [ 1 ] , ms [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mi ( mu , mt , ms [ 2 ] , ms [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mv = 1 ; mv < SIZE_RAMP_LENGTH ; mv ++ ) mi ( mu , mt , ms [ mv - 1 ] , ms [ mv ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mu",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 mD ( float mx , float my , vec4 mz [ COLOR_RAMP_LENGTH ] ) { float mA = mx / my ; vec3 mB = mz [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mp ( mB , mA , mz [ 0 ] , mz [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mp ( mB , mA , mz [ 1 ] , mz [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mp ( mB , mA , mz [ 2 ] , mz [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mC = 1 ; mC < COLOR_RAMP_LENGTH ; mC ++ ) mp ( mB , mA , mz [ mC - 1 ] , mz [ mC ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mB",";","}"]}]}}]},{type:"textline",b:"float mM ( float mE , float mF , float mG , float mH ) { float mI = max ( 0.01 , min ( mF , mG ) ) ; float mJ = max ( 0.01 , min ( mF , mH ) ) ; float mK = mF - mJ ; float mL = clamp ( mE / mI , 0.0 , 1.0 ) - step ( mK , mE ) * ( mE - mK ) / mJ ; return mL ; } mb mS ( ) { mb mN ; float mO ; if ( u_p_cyclic == 1 ) { mO = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( mO < 0.0 ) mO += u_p_length ; } if ( u_p_cyclic != 1 ) { mO = u_p_time - a_p_delay ; } if ( mO < 0.0 || mO >= a_p_lifetime ) { mN . a = 0.0001 ; mN . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( mO < 0.0 || mO >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mP = a_position ; vec3 mQ = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mP = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 mQ = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"mP += u_p_nfactor * mO * mQ ; mP += a_p_vels . xyz * mO ; mP . y -= u_p_gravity * mO * mO / 2.0 ; float mR = max ( u_p_mass , EPSILON ) ; mP += ( u_p_wind / mR ) * mO * mO / 2.0 ; mN . b = mP ; mN . e = a_p_vels . w * mO ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mN . a = mw ( mO , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mN . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mN . d = mD ( mO , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mN . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"mN . c = mM ( mO , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return mN ; }".split(" ")}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float ne ( in sampler2D mY , in vec2 mZ , in vec2 m_ ) { float na = texture2D ( mY , mZ ) . r ; float nb = m_ . x ; float nc = m_ . y ; float nd = 2.0 * nb / ( nb + nc - ( 2.0 * na - 1.0 ) * ( nc - nb ) ) ; return nd ; }".split(" ")}]}};b4w.module.__objects=function(a,q){function d(a){a={type:a,Rd:0,FC:[0,0],g:new Float32Array(3),quat:new Float32Array(4),qe:new Float32Array(8),N:new Float32Array(16),gu:new Float32Array(16),cb:new Float32Array(3),Zd:new Float32Array(3),ih:0,Le:0,Pl:!1,Yw:!1,R:0,Qp:1,Pp:1,Rp:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Gf:null,Qw:!1,Td:0,Wg:0,Ab:!1,Ra:null,Na:null,ab:null,As:!0,M:null,Kk:null,Ci:0,vi:0,zn:0,Ti:0,eg:0,fv:"",Wl:!1,hc:!1,Lb:!1,ic:!1,wc:!1,fc:!1,Uc:!1,Bf:!1,Ad:!1,tk:!1,Ee:!1,La:!1,
Xg:!1,Ki:!1,el:!1,qd:!1,pl:!1,Zk:!1,al:!1,Cj:0,Bd:0,of:0,Ce:0,Be:0,ze:0,de:"",Pb:null,$j:!1,Ld:!1,ji:"",Em:!1,Jf:0,time:0,Np:0,$w:0,Tc:0,Ai:!1,$l:!1,Pi:!1,we:!1,ve:1,pm:0,om:1,Tl:new Int8Array([-1,-1]),Ll:[],Cu:[],ow:[],vc:null,uc:null,Cc:null,Bc:null,Fc:null,gv:null,gg:null,Ui:null,Ub:null,Bm:null,zm:null,Am:null,Wa:null,Qc:null,Cb:null,zf:null,Af:null,scale:1,Oe:1E4};F.identity(a.quat);x.identity(a.qe);z.identity(a.N);z.identity(a.gu);return a}function b(a,b,c,d){var f=a.d.Ja,h;for(h in f){var g=
a.name+"_"+h;h in d||(d[h]=b.length,b.push(f[h][0]));c.push(g,d[h])}}var g=q("__animation"),c=q("__batch"),n=q("__boundings"),p=q("__camera"),k=q("__config"),y=q("__constraints"),m=q("__curve"),s=q("__lights"),B=q("__nla"),u=q("__particles");q("__print");var H=q("__scenes"),A=q("__transform"),x=q("__tsr"),f=q("__util"),F=q("quat"),h=q("vec3"),z=q("mat4"),D=k.p,I=0,r=new Float32Array(4);a.nk=d;a.Mp=function(a,k){var e;e=a.parent;if(!(e=e&&e.Mq)){if(!(e="ARMATURE"===a.type||"CAMERA"===a.type)&&(e="MESH"===
a.type)){var t=g.Xk(a),l=a.b4w_do_not_batch,F=a.b4w_dynamic_geometry,q=a.b4w_collision,C=a.b4w_vehicle,R=a.b4w_floating;e=a.b4w_character;var M=a.b4w_billboard,P=u.IC(a),S=B.Zt(a);if(!(t=t||l||F||q||C||R))a:{t=a.data;for(l=0;l<t.materials.length;l++)if("LENS_FLARES"===t.materials[l].name){t=!0;break a}t=!1}e=t||P||e||M||S}!e&&(e="EMPTY"===a.type)&&(e=g.Xk(a),M=B.Zt(a),e=e||M)}e=e?!0:!1;a.Mq=e;a.d=d("MESH"===a.type?e?"DYNAMIC":"STATIC":a.type);a.tb=null;a.te=[];a.Tb||(a.Tb=null);e=a.d;P=a.location;
M=a.scale[0];f.MD(a.rotation_quaternion,r);A.Zc(a,P);A.Yc(a,r);A.Ye(a,M);switch(a.type){case "ARMATURE":P=a.pose.bones;for(M=0;M<P.length;M++)S=P[M],t=S.bone,l=new Float32Array(t.matrix_local),F=new Float32Array(16),z.invert(l,F),q=new Float32Array(S.matrix_basis),C=new Float32Array(3),h.subtract(t.tail_local,t.head_local,C),f.YF(C,F,C),S.Qy=C,S.Ky=[S].concat(S.parent_recursive),S.Oq=x.Ss(l,x.create()),S.Nq=x.Ss(q,x.create()),S.km=x.create(),S.Sj=!1;P=g.Fz(a);e.Fc=P;P=g.vr(a,P);a.b4w_animation_mixing?
(e.vc=new Float32Array(P.va),e.uc=new Float32Array(P.va),e.Cc=new Float32Array(P.g),e.Bc=new Float32Array(P.g)):(e.vc=P.va,e.uc=P.va,e.Cc=P.g,e.Bc=P.g);e.gv=P;e.Jf=0;e.we=a.b4w_animation_mixing;break;case "MESH":e.qd=D.all_objs_selectable||a.b4w_selectable;e.pl=a.b4w_selectable;e.Ld=a.b4w_billboard;e.Az=a.b4w_pres_glob_orientation;e.ji="BASIC";e.Em="SPHERICAL"==a.b4w_billboard_geometry;e.Kk={AC:a.b4w_glow_settings.glow_duration,CC:a.b4w_glow_settings.glow_period,DC:a.b4w_glow_settings.glow_relapses};
e.qd&&(a.Lq=f.CB(I),I++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.$l=a.data.b4w_vertex_anim.length?!0:!1;if(M=g.Fi(a)){P=a.d;S=a.data.vertex_groups;if(S.length){t=M.data.bones;l=M.pose.bones;F=0;q={};for(C=0;C<t.length;C++){var R=t[C].name,Z=f.Kc("name",R,S);if(Z){var L=f.In(l,"name",R);q[R]={tr:C,si:F++,Ho:L,cx:Z.index}}}P.Fc=q;P.Tc=F;P.Pi=!0}P=a.d.Fc;P=g.vr(M,P);M.b4w_animation_mixing?(e.vc=new Float32Array(P.va),e.uc=new Float32Array(P.va),e.Cc=new Float32Array(P.g),e.Bc=new Float32Array(P.g)):
(e.vc=P.va,e.uc=P.va,e.Cc=P.g,e.Bc=P.g);e.gv=P;e.Jf=0}if(g.Tn(a)){M=a.d;P=a.data.materials;S=[];t=[];for(l=0;l<P.length;l++)if((F=P[l].node_tree)&&F.animation_data)for(C=F.animation_data,F={},(q=C.action)&&b(q,S,t,F),C=C.nla_tracks,R=0;R<C.length;R++)for(Z=C[R].strips,L=0;L<C[R].strips.length;L++)q=Z[L].action,b(q,S,t,F);M.gg=S;M.Ui=t}a.ga=[];e.hc=a.b4w_shadow_cast;e.Lb=a.b4w_shadow_receive;e.ic=a.b4w_shadow_cast_only&&e.hc;e.wc=a.b4w_reflexible;e.fc=a.b4w_reflexible_only&&e.wc;e.Uc=a.b4w_reflective;
e.Bf=a.b4w_caustics;e.Ad=a.b4w_wind_bending;e.Cj=a.b4w_wind_bending_angle;M=c.cG(a.b4w_wind_bending_angle,c.wz(a.data.b4w_bounding_box),a.scale[0]);e.Bd=M;e.of=a.b4w_wind_bending_freq;e.Ce=a.b4w_detail_bending_freq;e.Be=a.b4w_detail_bending_amp;e.ze=a.b4w_branch_bending_amp;e.Ki=!1;e.de=a.b4w_main_bend_stiffness_col;M=a.b4w_detail_bend_colors;e.Pb={};e.Pb.uu=M.leaves_stiffness_col;e.Pb.tu=M.leaves_phase_col;e.Pb.Mu=M.overall_stiffness_col;e.Xg=a.b4w_do_not_cull;e.tk=a.b4w_disable_fogging;e.Ee=a.b4w_dynamic_geometry;
if("MESH"!==a.type)throw"Wrong object";M=a.data.materials[0];e.Ci=M.physics.friction;e.vi=M.physics.elasticity;e.Ti=0;e.Oe=1E4;e.eg=a.b4w_lod_transition;e.el=!0;break;case "CAMERA":p.Lz(a);p.sz(a);break;case "LAMP":s.aD(a);break;case "CURVE":if(M=m.FA(a))a.Py=M;break;case "EMPTY":e.Ub=n.Cd(),M=n.Dj(),e.Qc=M}if(!k&&(a.parent&&"OBJECT"==a.parent_type?(P=e.g,S=e.quat,M=e.scale,y.Wq(a,a.parent,P,S,M)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(P=e.g,S=e.quat,M=e.scale,y.Vq(a,a.parent,
a.parent_bone,P,S,M)):a.Tb&&a.Tb.b4w_group_relative?(M=x.Vg(e.g,e.scale,e.quat),y.Wy(a,a.Tb,M)):a.Tb&&!a.Tb.b4w_group_relative&&(A.A(a),S=e.N,z.multiply(a.Tb.d.N,S,S),P=f.fg(S),M=f.gl(S),S=f.ee(S),A.Zc(a,P),A.Yc(a,S),A.Ye(a,M)),M=a.dupli_group))for(P=M.objects,M=0;M<P.length;M++)P[M].Tb=a;a.field&&(e.zn=a.field.strength,H.Vw(a));e.Wl=a.game.use_collision_compound;e.fv=a.game.physics_type;A.A(a)};a.JF=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.d||"DYNAMIC"!=c.d.type&&"CAMERA"!=c.d.type||
A.A(c);c.b4w_use_default_animation&&g.Xk(c)&&(g.um(c),c.D&&g.play(c,null,g.hm))}};a.ju=function(a){return"MESH"==a.type&&a.Mq?!0:!1};a.Fk=function(a){a=a.b4w_object_tags;return{title:a.title,description:a.description,jI:a.category}};a.ba=function(){I=0}};b4w.module.__camera=function(a,q){function d(b){switch(b){case "STATIC":return a.ci;case "TARGET":return a.fa;case "EYE":return a.kc;case "HOVER":return a.Xb;default:throw"Unknown move style";}}function b(b){var c={type:b,name:"",cf:1,width:0,height:0,Ie:null,Db:null,Ic:null,hb:0,Vd:0,Sa:0,Za:0,left:0,right:0,top:0,bottom:0,He:new Float32Array(3),Js:new Float32Array(3),quat:new Float32Array(4),oa:new Float32Array(16),gI:new Float32Array(16),ua:new Float32Array(16),$h:new Float32Array(16),LD:new Float32Array(16),
td:new Float32Array(16),iw:new Float32Array(16),Eg:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Gf:null,dof_on:0,An:{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Sa:new Float32Array([0,0,0,0]),Za:new Float32Array([0,0,0,0])},tj:0,wd:0,Jb:null,qi:null,cn:null,ms:new Float32Array(4),vl:new Float32Array(4)};if(b==a.sb)return c;switch(b){case a.Dc:n(c,40,.1,1E3);break;case a.Fd:n(c,2.5,.1,
1E3);break;case a.tf:break;case a.ei:break;case a.fi:break;case a.Nb:case a.Sb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function g(b,c,e){if(b.type!=a.Nb&&b.type!=a.Sb)throw"set_stereo_params(): wrong camera type";b.tj=c;b.wd=e;F(b,b.hb);if(N.ea())for(c=N.u(),b=c.d.sd,c=N.Fn(c).d.M,e=0;e<c.length;e++)r(c[e],b)}function c(a,b){var c=a.d,e=J.S(c.quat,J.rb,L),d=Math.asin(e[1]/C.length(e));0==e[0]&&0==e[2]?c=0:(Math.abs(d)>Math.PI/4&&(e=
0>=d?J.S(c.quat,J.qf,X):J.S(c.quat,J.jc,X)),c=Math.atan(Math.abs(e[0]/e[2])),0<e[2]&&(c=Math.PI-c),0<e[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=d;return b}function n(b,c,e,d,f){switch(b.type){case a.Dc:case a.Nb:case a.Sb:b.Vd=c;b.hb=1;break;case a.Fd:b.top=c;b.hb=1;break;case a.tf:delete b.Vd;b.Vd=c;b.hb=f/c;break;case a.ei:b.top=c;b.hb=f/c;break;default:l.error("set_frustum(): Unsupported camera type: "+b.type)}b.Sa=e;b.Za=d}function p(b,c){var e=c.d.g,d=c.d.quat,f=ha;S.rotateX(c.d.N,-Math.PI/2,f);S.invert(f,
b.oa);if(b.Jb){var f=b.Jb[0],l=b.Jb[1],g=b.Jb[2],k=b.Jb[3],m=ha;m[0]=1-2*f*f;m[1]=-2*f*l;m[2]=-2*f*g;m[3]=0;m[4]=-2*f*l;m[5]=1-2*l*l;m[6]=-2*l*g;m[7]=0;m[8]=-2*f*g;m[9]=-2*l*g;m[10]=1-2*g*g;m[11]=0;m[12]=-2*f*k;m[13]=-2*l*k;m[14]=-2*g*k;m[15]=1;S.multiply(b.oa,m,b.oa);F(b,b.hb,!0);f=ca;l=ha;S.invert(b.oa,l);S.transpose(l,l);R.transformMat4(b.Jb,l,f);l=w;l[0]=(J.sign(f[0])+b.ua[8])/b.ua[0];l[1]=(J.sign(f[1])+b.ua[9])/b.ua[5];l[2]=-1;l[3]=(1+b.ua[10])/b.ua[14];R.scale(f,2/(f[0]*l[0]+f[1]*l[1]+f[2]*
l[2]+f[3]*l[3]),f);b.ua[2]=f[0];b.ua[6]=f[1];b.ua[10]=f[2]+1;b.ua[14]=f[3]}b.type==a.Nb?b.oa[12]+=b.wd/2:b.type==a.Sb&&(b.oa[12]-=b.wd/2);S.multiply(b.ua,b.oa,b.Eg);z(b);h(b);C.copy(b.He,b.Js);C.copy(e,b.He);M.copy(d,b.quat)}function k(b,c,e,d){S.lookAt(c,e,d,b.oa);b.type==a.Nb?b.oa[12]+=b.wd/2:b.type==a.Sb&&(b.oa[12]-=b.wd/2);S.multiply(b.ua,b.oa,b.Eg);z(b);h(b);C.copy(c,b.He)}function y(a){var b=a.d.M;if(!b)throw"Wrong object";for(var c=a.d,e=0;e<b.length;e++){var d=b[e];p(d,a);J.Gs(d.Eg,d.An);
if(d.Gf)if(d.dof_on){var f=C.dist(c.g,d.Gf.location);d.dof_distance=f}else d.dof_distance=0}}function m(b){b=b.d;if(b.Ra){var c=L;b.R==a.fa?C.subtract(b.g,b.cb,c):J.S(b.quat,J.rb,c);c[1]=0;C.normalize(c,c);var e=-Math.acos(-c[2]);0>c[0]&&(e=-2*Math.PI-e);b.R==a.kc&&(e*=-1);b.Ra.left+=e;b.Ra.right+=e}}function s(b){b=b.d;if(b.Na){var c=L;b.R==a.fa?C.subtract(b.g,b.cb,c):J.S(b.quat,J.rb,c);C.normalize(c,c);c=Math.asin(c[1]);b.Na.eb+=c;b.Na.Ya+=c}}function B(a){a=a.d;if(a.Ra)if(a.Na){var b=J.vf(a.Na.eb+
Math.PI/2),c=J.vf(a.Na.Ya+Math.PI/2);if(c>Math.PI)a.Na={Ya:-Math.PI/2,eb:Math.PI/2};else if(b>Math.PI||b<c)a.Na.eb=Math.PI/2}else a.Na={Ya:-Math.PI/2,eb:Math.PI/2}}function u(b){var c=b.d;if(I(b)&&c.M[0].type===a.Fd){if(c.R===a.fa)var e=C.dist(c.g,c.cb),c=e/c.ih*c.Le;else c.Ab&&c.R===a.Xb?(e=f(b,L),e=C.len(e),c=e/c.ih*c.Le):c=c.Le;for(var d in b.d.M)e=b.d.M[d],e.top=c,F(e,e.hb);y(b)}}function H(a){a=J.S(a.d.quat,J.rb,L);C.normalize(a,a);return-Math.asin(a[1])}function A(a,b,c){if(b==c)return c-a;
a=J.vf(a);b=J.vf(b);c=J.vf(c);var e=Math.abs(b-c);if(.001>e||.001>Math.abs(e-2*Math.PI))return 0;b=2*Math.PI-b;c=J.vf(c+b);a=J.vf(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0}function x(a,b,c){a=a.d;var e=C.subtract(a.cb,a.g,L);b=M.setAxisAngle(b,c,V);C.transformQuat(e,b,e);C.subtract(a.cb,e,a.g);M.multiply(b,a.quat,a.quat)}function f(a,b){var c=a.d;if(c.Ab){var e=J.S(c.quat,J.rb,L);C.normalize(e,e);if(c.ab.eb-c.ab.Ya)var d=(-Math.asin(e[1])-c.ab.Ya)/(c.ab.eb-c.ab.Ya),d=Math.max(d,0);else d=0;
return C.scale(e,-(d*(c.Wg-c.Td)+c.Td),b)}return null}function F(b,c,e){switch(b.type){case a.Dc:if(!c)throw"No aspect ratio";b.hb=c;case a.tf:S.perspective(J.ND(b.Vd),b.hb,b.Sa,b.Za,b.ua);break;case a.Fd:if(!c)throw"No aspect ratio";b.hb=c;case a.ei:c=b.top*b.hb;S.ortho(-c,c,-b.top,b.top,b.Sa,b.Za,b.ua);break;case a.fi:S.ortho(b.left,b.right,b.bottom,b.top,b.Sa,b.Za,b.ua);break;case a.Nb:case a.Sb:if(!c)throw"No aspect ratio";b.hb=c;var d=Math.tan(b.Vd*Math.PI/360);c=b.Sa*d;var f=b.hb*b.tj*d;b.type==
a.Nb?(d=f-b.wd/2,f+=b.wd/2):(d=f+b.wd/2,f-=b.wd/2);d=-(b.Sa/b.tj*d);f*=b.Sa/b.tj;S.frustum(d,f,-c,c,b.Sa,b.Za,b.ua);b.left=d;b.right=f;break;case a.sb:return;default:throw"Wrong camera type: "+b.type;}e||(S.multiply(b.ua,b.oa,b.Eg),z(b),h(b))}function h(a){S.copy(a.oa,a.td);a.td[12]=0;a.td[13]=0;a.td[14]=0;a.td[15]=1;S.multiply(a.ua,a.td,a.td);S.invert(a.td,a.td)}function z(a){S.copy(a.oa,a.$h);S.multiply(a.ua,a.$h,a.$h);S.invert(a.$h,a.$h)}function D(b,c,e,d,f){d||(d=new Float32Array(24));c||(c=
b.Sa);e||(e=b.Za);var l,h,g,k,m,t,n,r;switch(b.type){case a.sb:throw"Extraction from NONE camera is not possible";case a.Dc:case a.tf:l=c*Math.tan(b.Vd*Math.PI/360);k=-l;h=l*b.hb;g=-h;m=e/c*l;r=-m;t=m*b.hb;n=-t;break;case a.Fd:case a.ei:g=b.top*b.hb;l=m=b.top;h=t=g;k=r=-b.top;g=n=-g;break;case a.fi:l=m=b.top;h=t=b.right;k=r=b.bottom;g=n=b.left;break;case a.Nb:case a.Sb:m=c/b.Sa;l=c*Math.tan(b.Vd*Math.PI/360);k=-l;h=b.right*m;g=b.left*m;n=e/c;m=l*n;r=-m;t=h*n;n*=g;break;default:throw"Wrong camera type: "+
b.type;}d[0]=g;d[1]=k;d[2]=-c;d[3]=h;d[4]=k;d[5]=-c;d[6]=h;d[7]=l;d[8]=-c;d[9]=g;d[10]=l;d[11]=-c;d[12]=n;d[13]=r;d[14]=-e;d[15]=n;d[16]=m;d[17]=-e;d[18]=t;d[19]=m;d[20]=-e;d[21]=t;d[22]=r;d[23]=-e;f&&(c=ha,S.invert(b.oa,c),J.Te(d,c,d,0));return d}function I(a){return"CAMERA"===a.type?!0:!1}function r(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.qi){var d=b.csm_num;a.qi=Array(d);for(var f=0;f<d;f++)a.qi[f]=new Float32Array(3);a.cn=new Float32Array(d)}for(d=0;d<c;d++){var f=0==d?a.Sa:v(b,a,d-1),l=v(b,
a,d),f=D(a,f,l,ba),f=e.iC(f);a.qi[d].set(f.w);a.cn[d]=f.za;a.ms[d]=C.length(f.w);a.vl[d]=E(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.vl[0]=b.first_cascade_blur_radius}function v(a,b,c){var e=a.csm_num,d=J.xa(a.csm_first_cascade_border,b.Sa,b.Za);a=J.xa(a.csm_last_cascade_border,b.Sa,b.Za);return J.xa(E(d,a,e,c),b.Sa,b.Za)}function E(a,b,c,e){switch(e){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,e/(c-1))}return a}var e=q("__boundings");q("__config");var t=
q("__constraints"),l=q("__print"),N=q("__scenes"),J=q("__util"),C=q("vec3"),R=q("vec4"),M=q("quat"),P=q("mat3"),S=q("mat4");a.sb=10;a.Dc=20;a.Fd=30;a.tf=40;a.ei=50;a.fi=60;a.Nb=70;a.Sb=80;a.ci=0;a.pq=1;a.fa=2;a.kc=3;a.Xb=4;var Z=new Float32Array(2),L=new Float32Array(3),X=new Float32Array(3),V=new Float32Array(4);new Float32Array(4);var ca=new Float32Array(4),w=new Float32Array(4),ea=new Float32Array(16),ha=new Float32Array(16),ba=new Float32Array(24);a.Lz=function(c){var e=c.d,f=c.data;switch(f.type){case "PERSP":var h=
b(a.Dc);if(f.angle_y)var g=f.angle_y/Math.PI*180;n(h,g,f.clip_start,f.clip_end);break;case "ORTHO":h=b(a.Fd),n(h,f.ortho_scale/2,f.clip_start,f.clip_end)}h.name=c.name;e.Qw=!1;e.R=d(f.b4w_move_style);e.dof_distance=c.data.dof_distance;e.Gf=c.data.dof_object;e.dof_front=c.data.b4w_dof_front;e.dof_rear=c.data.b4w_dof_rear;e.dof_power=c.data.b4w_dof_power;e.As=c.data.b4w_enable_hover_hor_rotation;e.M=[h];if(e.R==a.fa||e.R==a.kc||e.R==a.Xb)e.Qp=c.data.b4w_trans_velocity,e.Pp=c.data.b4w_rot_velocity,e.Rp=
c.data.b4w_zoom_velocity;e.R==a.fa&&e.cb.set(f.b4w_target);f=c.d;if(f.R===a.fa||f.R===a.kc||f.R===a.Xb)h=c.data,f.R===a.fa||f.R===a.kc?(h.b4w_use_horizontal_clamping&&(f.Ra={left:h.b4w_rotation_left_limit,right:h.b4w_rotation_right_limit}),h.b4w_use_vertical_clamping&&(f.Na={Ya:h.b4w_rotation_down_limit,eb:h.b4w_rotation_up_limit}),"LOCAL"==h.b4w_horizontal_clamping_type&&m(c),"LOCAL"==h.b4w_vertical_clamping_type&&s(c),B(c),h.b4w_use_panning&&(f.Yw=h.b4w_use_panning)):f.R===a.Xb&&(h.b4w_use_horizontal_clamping&&
h.b4w_horizontal_translation_min<=h.b4w_horizontal_translation_max&&(f.Ra={left:h.b4w_horizontal_translation_min,right:h.b4w_horizontal_translation_max}),h.b4w_use_vertical_clamping&&h.b4w_vertical_translation_min<=h.b4w_vertical_translation_max&&(f.Na={Ya:-h.b4w_vertical_translation_max,eb:-h.b4w_vertical_translation_min}),h.b4w_use_distance_limits&&h.b4w_hover_angle_min<=h.b4w_hover_angle_max&&(f.ab={Ya:h.b4w_hover_angle_min,eb:h.b4w_hover_angle_max})),f.Ab=h.b4w_use_distance_limits&&h.b4w_distance_min<=
h.b4w_distance_max,f.Ab&&(f.Td=h.b4w_distance_min,f.Wg=h.b4w_distance_max);f=c.d;if(f.R===a.Xb&&f.Ab)if(f.ab){var g=H(c),k=J.S(f.quat,J.jc,L),h=0;0<k[1]&&(h-=Math.asin(k[1]/C.len(k)));g>f.ab.eb?h+=g-f.ab.eb:g<f.ab.Ya&&(h+=f.ab.Ya-g);(h||0>g)&&l.warn("B4W Warning: Active hover camera has wrong orientation");h&&(g=J.S(f.quat,J.ad,X),h=M.setAxisAngle(g,-h,V),M.normalize(h,h),M.multiply(h,f.quat,f.quat));h=J.S(f.quat,J.rb,L);g=ca;g.set(J.Ba);g[3]=0;h=J.io(g,0,f.g,h,f.Zd);if(!h||100<C.len(h))f.Zd[0]=f.g[0],
f.Zd[1]=0,f.Zd[2]=f.g[2]}else f.Ab=!1;c=c.d;switch(c.R){case a.fa:c.ih=C.dist(c.g,c.cb);c.Le=c.M[0].top;break;case a.Xb:c.Ab&&(c.ih=C.dist(c.g,c.Zd),c.Le=c.M[0].top)}c=J.S(e.quat,J.jc,L);e.R==a.fa&&(e.Pl=0<c[1])};a.vb=b;a.lI=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.Db);case "DEPTH":return Boolean(a.Ic);case "SCREEN":return!Boolean(a.Db)&&!Boolean(a.Ic);default:throw"Wrong attachment type: "+b;}};a.Dl=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.Db=c;break;case "DEPTH":a.Ic=
c;break;case "SCREEN":a.Db=null;a.Ic=null;break;default:throw"Wrong attachment type: "+b;}};a.xJ=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.Db;case "DEPTH":return a.Ic;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.Bu=function(b,c){if(b.type!=a.Dc||c!=a.Nb&&c!=a.Sb)throw"make_stereo(): wrong camera type";b.type=c;g(b,6,.065)};a.EE=g;a.Cv=function(a,b){var c=a.d.quat,e=V,d=L;d[0]=0;d[1]=1;d[2]=0;M.setAxisAngle(d,b,e);M.multiply(e,c,c)};a.rL=function(a,b){var c=
a.d.quat,e=V,d=L;d[0]=1;d[1]=0;d[2]=0;M.setAxisAngle(d,b,e);M.multiply(e,c,c)};a.qL=function(a,b){var c=a.d.quat;M.invert(c,c);var e=V,d=L;d[0]=0;d[1]=0;d[2]=1;M.setAxisAngle(d,-b,e);M.multiply(e,c,c);M.invert(c,c)};a.Vo=function(a,b){var c=a.d.quat;M.invert(c,c);var e=V,d=L;d[0]=1;d[1]=0;d[2]=0;M.setAxisAngle(d,-b,e);M.multiply(e,c,c);M.invert(c,c)};a.Je=c;a.bp=n;a.xE=function(b,c,e,d,f,h,g){switch(b.type){case a.fi:b.left=c;b.right=e;b.bottom=d;b.top=f;b.Sa=h;b.Za=g;break;default:l.error("set_frustum_asymmetric(): Unsupported camera type: "+
b.type)}};a.Nf=function(a){return a.d.R};a.fM=p;a.gM=k;a.dw=function(a,b,c){var e=L;e[0]=0;e[1]=-1;e[2]=0;C.transformQuat(e,c,e);e[0]+=b[0];e[1]+=b[1];e[2]+=b[2];var d=X;d[0]=0;d[1]=0;d[2]=-1;C.transformQuat(d,c,d);k(a,b,e,d)};a.wL=function(a,b,c){if("CAMERA"!=a.type)throw"Wrong camera object";a=a.d;a.g.set(b);a.quat.set(c)};a.pB=function(a,b,c,e,d){e[0]=a[0];e[1]=a[1];e[2]=a[2];S.lookAt(a,b,c,ha);S.invert(ha,ha);S.rotateX(ha,Math.PI/2,ha);P.fromMat4(ha,ea);M.fromMat3(ea,d)};a.Tw=y;a.DF=function(b){var c=
b.d;c.R==a.fa&&(c.Ab?t.gE(c.g,c.quat,c.cb,c.Td,t.qx):t.fE(c.g,c.quat,c.cb));c.R!=a.fa&&c.R!=a.kc||t.Vm(b,J.Ba)};a.LC=m;a.aG=s;a.Sp=B;a.KF=u;a.$z=function(b){var e=b.d;if(e.R===a.fa||e.R===a.kc){if(e.Ra){var d=e.Ra.left,l=e.Ra.right,h=c(b,Z),h=h[0],h=e.R==a.fa?h-Math.PI:-1*h;if(h=A(h,d,l))e.R==a.fa?x(b,J.Ba,h):(h=M.setAxisAngle(J.rb,h,V),M.multiply(h,b.d.quat,b.d.quat))}e.Na&&(d=e.Na.Ya,l=e.Na.eb,h=c(b,Z),h=h[1],e.R==a.fa&&(h*=-1),h=0<J.S(e.quat,J.jc,L)[1]?J.sign(h)*Math.PI-h:h,h=A(h,d,l))&&(e.R==
a.fa?(d=J.S(b.d.quat,J.Ij,X),x(b,d,h)):(d=h,h=b.d,l=J.S(h.quat,J.ad,L),d=M.setAxisAngle(l,d,V),M.multiply(d,h.quat,h.quat)));e.R===a.fa&&(e.Ab&&(h=b.d,d=C.subtract(h.g,h.cb,L),l=C.length(d),l>h.Wg?(C.scale(d,h.Wg/l,d),C.add(h.cb,d,h.g)):l<h.Td&&(l=J.S(h.quat,J.rb,X),C.scale(l,100*h.Td,l),C.add(d,l,d),C.scale(d,-h.Td/C.length(d),d),C.add(h.cb,d,h.g))),u(b))}e.R===a.Xb&&(e=b.d,h=e.Ab?e.Zd:e.g,e.Ra&&(h[0]=J.xa(h[0],e.Ra.left,e.Ra.right)),e.Na&&(h[2]=J.xa(h[2],e.Na.Ya,e.Na.eb)),e=b.d,e.Ab&&(d=J.S(e.quat,
J.jc,L),h=0,0<d[1]&&(h=Math.asin(d[1]/C.len(d))),d=C.negate(c(b,Z),Z),d[1]<e.ab.Ya?h+=d[1]-e.ab.Ya:d[1]>e.ab.eb&&(h+=d[1]-e.ab.eb),h&&(d=J.S(e.quat,J.ad,X),C.normalize(d,d),h=M.setAxisAngle(d,h,V),M.normalize(h,h),M.multiply(h,e.quat,e.quat)),h=f(b,L),C.add(e.Zd,h,e.g),u(b)))};a.pt=H;a.kC=f;a.yK=function(b){switch(b.type){case a.Dc:case a.Fd:case a.Nb:case a.Sb:return!0;default:return!1}};a.RB=function(b){b=b.d.M[0];switch(b.type){case a.Dc:case a.tf:case a.Nb:case a.Sb:return Math.PI*b.Vd/180;default:return l.error("get_min_fov(): Unsupported camera type: "+
b.type),0}};a.xh=F;a.Iz=h;a.Jz=z;a.mB=D;a.sz=function(a){a=a.d;var b=e.Cd();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Ub=b;var c=e.Ym(1,[0,0,0]);a.Qc=c;a.zm=e.Zr(1,b);a.Bm=e.as(1,b);a.Am=e.$r(1,b)};a.Ne=I;a.yb=function(b){return I(b)&&b.d&&b.d.R==a.fa?!0:!1};a.lb=function(b){return I(b)&&b.d&&b.d.R==a.Xb?!0:!1};a.Uf=function(b){return I(b)&&b.d&&b.d.R==a.kc?!0:!1};a.Lp=r;a.LA=v};b4w.module.__constraints=function(a,q){function d(a){var b={};b.type=a;return b}function b(a,b){a.tb&&a.tb.X&&g(a.tb.X,a);if(b.X){var c=b.X;if(-1==c.te.indexOf(a))c.te.push(a);else throw"Descendant object override is forbidden";}a.tb=b}function g(a,b){var c=a.te.indexOf(b);if(-1!=c)a.te.splice(c,1);else throw"No descendant object";}function c(a,b,c){switch(b.type){case 1:var d=a.d.quat,g=b.X.d.N;c=b.X.d.quat;b.Ve?(H.copy(b.Ve,d),H.multiply(c,d,d)):H.copy(c,d);u.transformMat4(b.offset,g,a.d.g);a.d.scale=
b.Cl*b.X.d.scale;break;case 9:var r=a.d.g,d=a.d.quat,g=b.X.d.N;c=b.X.d.quat;H.multiply(H.invert(b.rg,b.rg),d,d);H.multiply(c,d,d);u.transformMat4(b.offset,g,r);H.copy(c,b.rg);break;case 10:r=a.d.g;d=a.d.quat;g=b.X.d.N;c=b.X.d.quat;H.multiply(H.invert(b.rg,b.rg),d,d);H.multiply(c,d,d);u.transformMat4(b.offset,g,r);H.copy(c,b.rg);var d=a.d.quat,r=b.X.d.quat,D=u.transformQuat(s.Ba,d,x),g=H.invert(r,z),B=u.transformQuat(D,g,f),q=F;q[0]=B[0];q[1]=0;q[2]=B[2];var S=u.length(q),g=-q[2]/S,g=Math.acos(g)*
s.sign(q[0]),S=S/u.length(B),S=Math.acos(S)*s.sign(B[1]),B=!1;g<-b.Hr&&(g=-b.Hr,B=!0);g>b.Jr&&(g=b.Jr,B=!0);S<-b.Kr&&(S=-b.Kr,B=!0);S>b.Gr&&(S=b.Gr,B=!0);B&&(b=Math.sin(S),S=Math.cos(S),B=Math.sin(g),g=Math.cos(g),q=f,q[0]=S*B,q[1]=b,q[2]=-S*g,u.transformQuat(q,r,q),b=H.rotationTo(D,q,z),H.multiply(b,d,d),H.normalize(d,d));"CAMERA"==a.d.type&&(b=u.transformQuat(s.Ba,c,f),k(a,b));break;case 12:r=a.d.g;d=a.d.quat;g=b.X.d.N;S=b.X.d.g;a=b.SE;B=x;D=z;u.transformMat4(b.offset,g,B);s.Ch(B,r,c,a,r);b=x;u.sub(S,
r,b);u.normalize(b,b);q=d;r=v;g=r.subarray(0,3);S=r.subarray(3,6);B=r.subarray(6,9);u.copy(b,S);u.negate(S,S);u.normalize(S,S);Boolean(.999999<Math.abs(u.dot(b,s.Ba)))?(b=A.fromQuat(H.normalize(q,D),E),u.copy(b.subarray(0,3),g)):u.cross(s.Ba,S,g);u.normalize(g,g);u.cross(g,S,B);u.normalize(B,B);H.fromMat3(r,D);H.normalize(D,D);s.rw(D,d,c,.16*a,d);break;case 2:d=a.d.quat;r=h;c=z;y(b.X,b.Ez,!0,r,c);b.Ve?(H.copy(b.Ve,d),H.multiply(c,d,d)):H.copy(c,d);a.d.scale=b.Cl*r[3];s.uj(b.offset,r[3],c,r,a.d.g);
break;case 3:r=a.d.g;d=a.d.quat;c=b.X.d.g;n(r,d,c);"CAMERA"==a.d.type&&k(a,s.Ba);break;case 4:r=a.d.g;d=a.d.quat;c=b.target;n(r,d,c);"CAMERA"==a.d.type&&k(a,s.Ba);break;case 5:r=a.d.g;d=a.d.quat;c=b.X.d.g;p(r,d,c,b.mg);d=u.dist(r,c);if(b=d>b.Yi?d-b.Yi:d<b.mg?d-b.mg:0)u.sub(c,r,x),u.normalize(x,x),u.scale(x,b,x),u.add(r,x,r);"CAMERA"==a.d.type&&k(a,s.Ba);break;case 6:r=a.d.g;d=a.d.quat;c=b.target;p(r,d,c,b.mg);d=u.dist(r,c);if(b=d>b.Yi?d-b.Yi:d<b.mg?d-b.mg:0)u.sub(c,r,x),u.normalize(x,x),u.scale(x,
b,x),u.add(r,x,r);"CAMERA"==a.d.type&&k(a,s.Ba);break;case 7:g=b.X.d.N;u.transformMat4(b.offset,g,a.d.g);break;case 8:S=b.X.d.g;r=a.d.g;u.add(S,b.offset,r);break;case 13:d=a.d.quat;g=b.X.d.N;c=b.X.d.quat;b.Ve?(H.copy(b.Ve,d),H.multiply(c,d,d)):H.copy(c,d);u.transformMat4(b.offset,g,a.d.g);break;case 11:c=b.X.d,c=m.Vg(c.g,c.scale,c.quat,I),m.multiply(c,b.Pw,c),r=a.d.g,r[0]=c[0],r[1]=c[1],r[2]=c[2],a.d.scale=c[3],d=a.d.quat,d[0]=c[4],d[1]=c[5],d[2]=c[6],d[3]=c[7]}}function n(a,b,c){var d=x;s.S(b,s.rb,
d);u.normalize(d,d);var g=f;u.subtract(c,a,g);u.normalize(g,g);a=h;s.Fv(d,g,a);H.multiply(a,b,b)}function p(a,b,c,d){var g=x;s.S(b,s.rb,g);u.normalize(g,g);var k=f;u.subtract(c,a,k);a=u.length(k);u.normalize(k,k);a>d-.001&&(d=s.Fv(g,k,h),H.multiply(d,b,b),H.normalize(b,b))}function k(a,b){var c=a.d,d=c.quat,h=s.S(c.quat,s.Ba,x);u.normalize(h,h);if(.999999<Math.abs(u.dot(b,h)))h=H.identity(z);else{var g=u.cross(b,h,f);u.normalize(g,g);c.R==B.fa?c.Pl&&(g[0]*=-1,g[1]*=-1,g[2]*=-1):0<s.S(c.quat,s.jc,
F)[1]&&(g[0]*=-1,g[1]*=-1,g[2]*=-1);c=s.S(c.quat,s.ad,F);u.normalize(c,c);var k=s.xa(u.dot(c,g),-1,1),m=Math.acos(k),h=-.999999>=k?H.setAxisAngle(h,m,z):H.rotationTo(c,g,z);H.normalize(h,h)}H.multiply(h,d,d)}function y(a,b,c,d,f){var g=a.d,k=g.Jf,n=g.Fc[b];b=n.si;a=a.pose.bones[n.Ho];var n=a.Oq,v=h,p=g.Cc,s=g.Bc,E=g.vc,y=g.uc,u=p[4*b+1],x=p[4*b+2],B=p[4*b+3],A=s[4*b+1],F=s[4*b+2],q=s[4*b+3];v[0]=(1-k)*p[4*b]+k*s[4*b];v[1]=(1-k)*u+k*A;v[2]=(1-k)*x+k*F;v[3]=(1-k)*B+k*q;p=z;s=D;p[0]=E[4*b];p[1]=E[4*
b+1];p[2]=E[4*b+2];p[3]=E[4*b+3];s[0]=y[4*b];s[1]=y[4*b+1];s[2]=y[4*b+2];s[3]=y[4*b+3];H.slerp(p,s,k,p);k=I;m.HE(v,k);m.cp(p,k);c?(c=r,m.translate(n,a.Qy,c),m.multiply(k,c,k)):m.multiply(k,n,k);m.multiply(g.qe,k,k);d[0]=k[0];d[1]=k[1];d[2]=k[2];d[3]=k[3];f&&(f[0]=k[4],f[1]=k[5],f[2]=k[6],f[3]=k[7])}var m=q("__tsr"),s=q("__util"),B=q("__camera"),u=q("vec3"),H=q("quat"),A=q("mat3");q("mat4");a.rG=1;a.qG=2;a.uG=3;a.vG=4;a.lG=5;a.mG=6;a.sG=7;a.kG=8;a.pG=9;a.oG=10;a.Dd=11;a.nG=12;a.tG=13;var x=new Float32Array(3),
f=new Float32Array(3),F=new Float32Array(3),h=new Float32Array(4),z=new Float32Array(4),D=new Float32Array(4),I=new Float32Array(16),r=new Float32Array(16),v=new Float32Array(9),E=new Float32Array(9),I=new Float32Array(8);a.qx=9*Math.PI/10;a.Wq=function(a,f,h,g,k){var m=d(1);m.X=f;m.offset=new Float32Array(h);m.Ve=g?new Float32Array(g):null;m.Cl=k;b(a,m);c(a,m,0)};a.Vq=function(a,f,h,g,k,m){var r=d(2);r.X=f;r.Ez=h;r.offset=new Float32Array(g);r.Ve=k?new Float32Array(k):null;r.Cl=m;b(a,r);c(a,r,0)};
a.dz=function(a,f,h,g){var k=d(9),m=a.d.quat,r=f.d.quat;k.X=f;k.offset=new Float32Array(h);k.rg=new Float32Array(r);g&&(H.copy(g,m),H.multiply(r,m,m));b(a,k);c(a,k,0)};a.cz=function(a,f,h,g,k,m,r,n){var v=d(10),p=a.d.quat,s=f.d.quat;v.X=f;v.offset=new Float32Array(h);v.rg=new Float32Array(s);v.Hr=k;v.Jr=m;v.Kr=r;v.Gr=n;g&&(H.copy(g,p),H.multiply(s,p,p));b(a,v);c(a,v,0)};a.bz=function(a,f,h,g){var k=d(12);k.X=f;k.offset=new Float32Array(h);k.SE=g;b(a,k);c(a,k,0)};a.gz=function(a,f,h,g){var k=d(13);
k.X=f;k.offset=new Float32Array(h);k.Cl=1;k.Ve=g?new Float32Array(g):null;b(a,k);c(a,k,0)};a.iz=function(a,f){var h=d(3);h.X=f;b(a,h);c(a,h,0)};a.jz=function(a,f){var h=d(4);h.target=new Float32Array(f);b(a,h);c(a,h,0)};a.Yy=function(a,f,h,g){var k=d(5);k.X=f;k.mg=h;k.Yi=g;b(a,k);c(a,k,0)};a.Zy=function(a,f,h,g){var k=d(6);k.target=new Float32Array(f);k.mg=h;k.Yi=g;b(a,k);c(a,k,0)};a.fz=function(a,f){var h=d(7);h.X=f;h.offset=new Float32Array([0,.5,0]);b(a,h);c(a,h,0)};a.Xy=function(a,f,h){var g=
d(8);g.X=f;g.offset=new Float32Array(h);b(a,g);c(a,g,0)};a.Wy=function(a,f,h){var g=d(11);g.X=f;g.Pw=new Float32Array(h);b(a,g);c(a,g,0)};a.EF=function(a,b){a.tb&&c(a,a.tb,b)};a.fE=n;a.gE=p;a.Vm=k;a.remove=function(a){a.tb.X&&g(a.tb.X,a);a.tb=null};a.Yd=function(a){return a.tb?a.tb.type:null};a.WJ=function(a){return a.tb&&a.tb.X?a.tb.X:null};a.Wd=function(a){return a.tb&&11==a.tb.type?a.tb.Pw:null};a.WB=y};b4w.module.__curve=function(a,q){function d(a,b,c,d,g){var s=d.length;g||(g=new Float32Array(s));for(var B=s+a,u=new Float32Array(B),q=1;q<=B-1;q++)u[q-1]=b>=c[q-1]&&b<c[q+1-1]?1:0;for(var A=2;A<=a;A++)for(q=1;q<=B-A;q++)u[q-1]=(0!=u[q-1]?(b-c[q-1])*u[q-1]/(c[q+A-1-1]-c[q-1]):0)+(0!=u[q+1-1]?(c[q+A-1]-b)*u[q+1-1]/(c[q+A-1]-c[q+1-1]):0);b==c[B-1]&&(u[s-1]=1);a=0;for(q=1;q<=s;q++)a+=u[q-1]*d[q-1];for(q=1;q<=s;q++)g[q-1]=0!=a?u[q-1]*d[q-1]/a:0;return g}function b(a){a=a.dl;return a[a.length-1]}function g(a){a=
a.os;return a[a.length-1]}var c=q("__util");a.FA=function(a){var b={},c=a.data;a=c.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var g=a.order_u;b.Se=g;a=a.points;var m=a.length/5,s=[],B=m+g,m=m+2;s[0]=0;for(var u=2;u<=B;u++)s[u-1]=u>g&&u<m?s[u-2]+1:s[u-2];b.dl=s;if("2D"==c.dimensions)b.Me=!1;else if("3D"==c.dimensions)b.Me=!0;else throw"Wrong curve dimensions";g=[];s=[];for(c=0;c<a.length;c+=5)g.push(a[c]),g.push(a[c+1]),g.push(a[c+2]),b.Me&&g.push(a[c+3]),s.push(a[c+4]);b.Wm=
g;b.Wp=s;a=[];for(var c=b.Wm,g=b.Me?4:3,s=b.Wp,B=b.dl,m=b.Se,u=c.length/g,q=u+m,A=0,x=B[q-1]/999,f=0;1E3>f;f++){5E-6>B[q-1]-A&&(A=B[q-1]);for(var F=d(m,A,B,s),h=0;h<g;h++)for(var z=a[g*f+h]=0;z<u;z++)a[g*f+h]+=F[z]*c[g*z+h];A+=x}g=b.Me?4:3;s=new Float32Array(1E3);s[0]=0;for(c=1;1E3>c;c+=1)B=a[(c-1)*g],m=a[(c-1)*g+1],u=a[(c-1)*g+2],q=a[c*g],A=a[c*g+1],x=a[c*g+2],s[c]=s[c-1]+Math.sqrt((q-B)*(q-B)+(A-m)*(A-m)+(x-u)*(x-u));b.os=s;return b};a.fF=function(a,c,g){g||(g=[]);var y=c,m=Math.max(y,0);c=m=Math.min(y,
b(a));var y=a.Wm,m=a.Me?4:3,s=a.Wp,B=a.dl,u=a.Se;a=y.length/m;var q=a+u;5E-6>B[q-1]-c&&(c=B[q-1]);q=new Float32Array(a);d(u,c,B,s,q);for(c=0;c<m;c++)for(s=g[c]=0;s<a;s++)g[c]+=q[s]*y[m*s+c]};a.cF=function(a,b,c){c||(c=[]);var d=a.Wm,g=a.Me?4:3,s=a.Wp,B=a.dl,u=a.Se;a=d.length/g;var q=a+u;5E-6>B[q-1]-b&&(b=B[q-1]);var q=new Float32Array(a),A=b;b=q;var x=s.length;b||(b=new Float32Array(x));var f=new Float32Array(x),F=new Float32Array(x),h=f,z=F;h||(h=new Float32Array(x));z||(z=new Float32Array(x));for(var D=
x+u,I=new Float32Array(D),r=new Float32Array(D),v=1;v<=D-1;v++)I[v-1]=A>=B[v-1]&&A<B[v+1-1]?1:0;A==B[D-1]&&(I[x-1]=1);for(var E=2;E<=u;E++)for(v=1;v<=D-E;v++){var e=0!=I[v-1]?I[v-1]/(B[v+E-1-1]-B[v-1]):0,t=0!=I[v+1-1]?-I[v+1-1]/(B[v+E-1]-B[v+1-1]):0,l=0!=r[v-1]?(A-B[v-1])*r[v-1]/(B[v+E-1-1]-B[v-1]):0,N=0!=r[v+1-1]?(B[v+E-1]-A)*r[v+1-1]/(B[v+E-1]-B[v+1-1]):0;I[v-1]=(0!=I[v-1]?(A-B[v-1])*I[v-1]/(B[v+E-1-1]-B[v-1]):0)+(0!=I[v+1-1]?(B[v+E-1]-A)*I[v+1-1]/(B[v+E-1]-B[v+1-1]):0);r[v-1]=e+t+l+N}for(v=1;v<=
x;v++)h[v-1]=I[v-1],z[v-1]=r[v-1];B=0;for(u=1;u<=x;u++)B+=f[u-1]*s[u-1];A=0;for(u=1;u<=x;u++)A+=F[u-1]*s[u-1];for(u=1;u<=x;u++)b[u-1]=0!=B?F[u-1]*s[u-1]/B+f[u-1]*s[u-1]*A/(B*B):0;for(s=0;s<g;s++)for(B=c[s]=0;B<a;B++)c[s]+=q[B]*d[g*B+s]};a.mM=b;a.eF=g;a.dF=function(a,d){if(0>=d)return 0;var k=b(a);if(d>=g(a))return k;var y=a.os,m=c.ak(y,d,0,y.length-1);return k*(m+(d-y[m])/(y[m+1]-y[m]))/1E3}};b4w.module.__lights=function(a,q){function d(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),Pg:new Float32Array(3),Eh:0,qp:0,MB:!1,aB:!1,Vh:!0,Wh:!0,xi:1,distance:25,eJ:"INVERSE_SQUARE"}}function b(a){a.Pg[0]=a.color[0]*a.xi;a.Pg[1]=a.color[1]*a.xi;a.Pg[2]=a.color[2]*a.xi}var g=q("__util"),c=q("vec3");a.qK=d;a.aD=function(a){var p=a.data,k=d(p.type);k.name=a.name;k.Vh=p.use_diffuse;k.Wh=p.use_specular;var y=g.S(a.d.quat,g.Ba,[]);c.normalize(y,y);k.direction[0]=
y[0];k.direction[1]=y[1];k.direction[2]=y[2];k.color[0]=p.color[0];k.color[1]=p.color[1];k.color[2]=p.color[2];k.xi=p.energy;b(k);k.distance=p.distance;if("POINT"===k.type||"SPOT"===k.type)k.distance=p.distance;"SPOT"===k.type&&(k.Eh=p.spot_size,k.qp=p.spot_blend);k.MB=p.b4w_generate_shadows;k.aB=p.b4w_dynamic_intensity;a.Bb=k};a.HL=function(a,c){a.color[0]=c[0];a.color[1]=c[1];a.color[2]=c[2];b(a)};a.ML=function(a,b){a.qp=b};a.JL=function(a,b){a.distance=b};a.NL=function(a,b){a.Eh=b};a.KL=function(a,
c){a.xi=c;b(a)};a.AK=function(a){return"LAMP"===a.type?!0:!1};a.HF=function(a){if("LAMP"!=a.type)throw"Wrong light object";var b=a.Bb;b&&g.S(a.d.quat,g.Ba,b.direction)}};b4w.module.__nla=function(a,q){function d(){return{type:"CLIP",W:0,ha:0,je:!1,paused:!1,xe:"",Ec:0,Qq:0,Sy:0,Es:0,Ds:0,Lh:!1}}function b(a,b){for(var c=a.b4w_nla_script,e=b.We,d=0;d<c.length;d++){var f=c[d];switch(f.type){case "PLAY":e.push({type:"PLAY",W:f.frame_range[0],ha:f.frame_range[1],Ke:!1});break;case "SELECT":case "SELECT_PLAY":var h=A.Gi(A.Kj,f.object,0),g=A.qC(a),k=g.indexOf(h);if(-1==k){H.error("NLA script error: non-selectable object");return}for(var f={type:f.type,qw:"SELECT"==f.type?
f.target_slot:d+1,RE:d+1,Xe:-1,oE:g.length,nE:k,W:f.frame_range[0],ha:f.frame_range[1],Ke:!1},k=[],m=0;m<g.length;m++)k.push(B.an(g[m],!0));B.J(h,"NLA_SELECT_"+d,B.cd,k,B.QA,function(a,c,e,d){if(!(b.Fb>=b.We.length)&&(e=b.We[b.Fb],"SELECT"==e.type||"SELECT_PLAY"==e.type&&!e.Ke)){for(e=0;e<d.oE;e++)if(B.Qb(a,c,e)&&e==d.nE){d.Xe=1;return}d.Xe=0}},f);e.push(f);break;case "JUMP":e.push({type:"JUMP",lp:f.target_slot});break;case "CONDJUMP":e.push({type:"CONDJUMP",lp:f.target_slot,dA:f.condition,jj:f.register1,
kj:f.register2,zo:f.number1,Ao:f.number2});break;case "REGSTORE":e.push({type:"REGSTORE",TD:f.registerd,yD:f.number1});break;case "MATH":e.push({type:"MATH",AD:f.operation,jj:f.register1,kj:f.register2,zo:f.number1,Ao:f.number2,sh:f.registerd});break;case "SHOW":case "HIDE":h=A.Gi(A.Kj,f.object,0);e.push({type:f.type,nl:h});break;case "REDIRECT":e.push({type:"REDIRECT",url:f.url});break;case "PAGEPARAM":e.push({type:"PAGEPARAM",BD:f.param_name,sh:f.registerd});break;case "NOOP":e.push({type:"NOOP"})}}}
function g(a,b,d,e){if(a.We.length){if(a.Fb>=a.We.length)if(a.Hc)a.Fb=0;else{a.Fa-=h.Ia*d;return}var k=n(a,b,e,!1),l=a.We[a.Fb];switch(l.type){case "PLAY":l.Ke?k>=l.ha&&(l.Ke=!1,a.Fb++,g(a,b,d,e)):(a.Fa+=l.W-k,l.Ke=!0,c(a,l));break;case "SELECT":case "SELECT_PLAY":-1<l.Xe?"SELECT"==l.type||"SELECT_PLAY"==l.type&&0==l.Xe?(a.Fb=l.Xe?l.qw:l.RE,l.Xe=-1,g(a,b,d,e)):l.Ke?k>=l.ha&&(l.Ke=!1,a.Fb=l.qw,l.Xe=-1,g(a,b,d,e)):(a.Fa+=l.W-k,l.Ke=!0,c(a,l)):a.Fa-=h.Ia*d;break;case "JUMP":a.Fb=l.lp;g(a,b,d,e);break;
case "CONDJUMP":var k=-1==l.jj?l.zo:a.pd[l.jj],m=-1==l.kj?l.Ao:a.pd[l.kj],p=!1;switch(l.dA){case "EQUAL":k==m&&(p=!0);break;case "NOTEQUAL":k!=m&&(p=!0);break;case "LESS":k<m&&(p=!0);break;case "GREATER":k>m&&(p=!0);break;case "LEQUAL":k<=m&&(p=!0);break;case "GEQUAL":k>=m&&(p=!0)}p?a.Fb=l.lp:a.Fb++;g(a,b,d,e);break;case "REGSTORE":a.pd[l.TD]=l.yD;a.Fb++;g(a,b,d,e);break;case "MATH":k=-1==l.jj?l.zo:a.pd[l.jj];m=-1==l.kj?l.Ao:a.pd[l.kj];switch(l.AD){case "ADD":a.pd[l.sh]=k+m;break;case "MUL":a.pd[l.sh]=
k*m;break;case "SUB":a.pd[l.sh]=k-m;break;case "DIV":0==m&&f.ma("Division by zero in NLA script"),a.pd[l.sh]=k/m}a.Fb++;g(a,b,d,e);break;case "SHOW":A.hp(l.nl);a.Fb++;g(a,b,d,e);break;case "HIDE":A.Uk(l.nl);a.Fb++;g(a,b,d,e);break;case "REDIRECT":window.location.href=l.url;a.We.length=0;break;case "PAGEPARAM":a:{k=location.href.toString();if(-1!=k.indexOf("?"))for(k=k.split("?")[1].split("&"),m=0;m<k.length;m++)if(p=k[m].split("="),1<p.length&&p[0]==l.BD){k=Number(p[1]);break a}k=0}a.pd[l.sh]=k;a.Fb++;
g(a,b,d,e);break;case "NOOP":a.Fb++,g(a,b,d,e)}}}function c(a,b){for(var c=a.We,d=0;d<c.length;d++){var f=c[d];f!=b&&(f.Xe=-1)}}function n(a,b,c,d){b=(b-c)*h.Ia+a.Fa-a.W;a.Hc&&d&&(b%=a.ha-a.W+1);return b+=a.W}function p(a,b){b?F.CD(a.name):(F.cE(a.name),F.GD(a.name))}function k(a,b){for(var c=[],e=0;e<a.length;e++){var f=a[e].strips;if(f)for(var h=0;h<f.length;h++){var g=f[h],k=d();k.type=g.type;k.W=g.frame_start;k.ha=g.frame_end;k.xe=g.action?g.action.name:"";k.Ec=b;k.Qq=g.action_frame_start;k.Sy=
g.action_frame_end;c.push(k)}}return c}function y(a){return x.ce(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}var m=q("__animation"),s=q("__camera"),B=q("__controls"),u=q("__config");q("__loader");q("__particles");var H=q("__print"),A=q("__scenes"),x=q("__sfx"),f=q("__util"),F=q("__textures"),h=u.Hd,z=u.p,D=[],I=-1;a.LF=function(a,c){var h={W:a.frame_start,ha:a.frame_end,Fa:0,Ri:-1,Hc:c,fe:[],aa:[],We:[],Fb:0,pd:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};b(a,h);for(var e=
A.Hb(a,"ALL",A.V),g=0;g<e.length;g++){var l=e[g],n=0,p=[],u=l.animation_data;if(u&&u.nla_tracks.length&&(u=u.nla_tracks,f.Tf(l)||s.Ne(l)||f.rc(l)||f.TC(l)||x.ce(l))){var B=k(u,n);B.length&&(p=p.concat(B),n++)}y(l)&&(u=l.data.animation_data.nla_tracks,B=k(u,n),B.length&&(p=p.concat(B),n++));if(m.Tn(l))for(var q=l.data.materials,F=0;F<q.length;F++)if(B=q[F].node_tree,u=B.animation_data,B&&u){for(var u=u.nla_tracks,B=k(u,-1),I=[],Z=0;Z<B.length;Z++)u=B[Z],-1==I.indexOf(u.xe)&&I.push(u.xe),u.Ec=n+I.indexOf(u.xe),
p.push(u);n+=I.length}for(F=0;F<l.particle_systems.length;F++)q=l.particle_systems[F],u=q.settings,"EMITTER"==u.type&&u.b4w_allow_nla&&(u=d(),u.type="CLIP",u.W=h.W,u.ha=h.ha+1,u.xe=q.name,u.Ec=n,p.push(u),n++);q=n+1;if(f.rc(l)&&l.data)for(F=0;F<l.data.b4w_vertex_anim.length;F++)B=l.data.b4w_vertex_anim[F],B.allow_nla&&(n=q,u=d(),u.type="CLIP",u.W=h.W,u.ha=h.ha+1,u.xe=B.name,u.Ec=n,p.push(u));p.length&&(l.jm=p,h.fe.push(l))}e=a.d.Zh;for(F=0;F<e.length;F++)if(g=e[F].d,g.gb||g.vh)u=d(),u.type="VIDEO",
l=1,z.Xc&&(l=g.Zb),u.W=Math.min(g.W*l,h.ha),u.ha=g.yg?h.ha:Math.min((g.ah+g.W+g.Fa)*l,h.ha),u.xe=e[F].name,g.Ny=u,h.aa.push(g);F=h.W;e=h.ha;for(g=0;g<h.fe.length;g++)for(l=h.fe[g],n=l.jm,p=0;p<n.length;p++)u=n[p],q=l.name+" ["+u.W+":"+u.ha+"]",u.W=Math.max(F,u.W),u.ha=Math.min(e+1,u.ha),u.W>u.ha&&(H.warn("NLA: out of scene range: "+q),n.splice(p,1),p--);for(F=0;F<h.fe.length;F++)for(e=h.fe[F].jm,g=0;g<e.length;g++){l=e[g];n=h.W;p=h.ha+1;for(u=0;u<e.length;u++)q=e[u],l.Ec==q.Ec&&(q.ha<=l.W&&(n=l.W),
q.W>=l.ha&&(p=Math.min(p,q.W)));l.Es=n;l.Ds=p}D.push(h)};a.start=function(){I=0};a.update=function(a,b){if(!(0>I)){0==I&&(I=a);for(var c=0;c<D.length;c++){var d=D[c];g(d,a,b,I);for(var f=n(d,a,I,!0),l=0;l<d.fe.length;l++){for(var k=d.fe[l],s=k.jm,u=0;u<s.length;u++){var z=s[u];"SOUND"==z.type&&f<d.Ri-1E-6&&(z.je=!1)}for(u=0;u<s.length;u++)switch(z=s[u],z.type){case "CLIP":if(z.Es<=f&&f<z.Ds&&!z.je){var B=k,y=z;m.apply(B,y.xe,y.Ec);m.El(B,m.dm,y.Ec);for(B=0;B<s.length;B++)s[B]!=z&&s[B].Ec==z.Ec&&(s[B].je=
!1);z.je=!0}z.je&&(B=k,m.$o(B,f-z.W+z.Qq,z.Ec),m.wj(B,0,z.Ec));break;case "SOUND":(f<d.Ri-1E-6||d.Ri<z.W)&&z.W<=f&&f<z.ha&&!z.je&&(x.play(k,(z.W-f)/h.Ia,(z.ha-z.W)/h.Ia),z.je=!0),d.Ri<z.ha&&z.ha<=f&&z.je&&(z.je=!1)}}for(l=0;l<d.aa.length;l++)z=d.aa[l].Ny,z.W<=Math.round(f)&&Math.round(f)<z.ha&&!z.Lh&&(p(d.aa[l],z.Lh),z.Lh=!0),z.ha<=Math.round(f)&&z.Lh&&(p(d.aa[l],z.Lh),z.Lh=!1);d.Ri=f}}};a.ba=function(){D.length=0;I=-1};a.Zt=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||y(a)||
m.Tn(a)?!0:!1}};b4w.module.__controls=function(a,q){function d(a){return{type:a,value:0,da:null,mo:null,lo:null,fl:null,Rc:!1,key:0,nc:"",Rm:null,vo:!1,Qm:function(){},Pm:null,Qr:function(){},ud:null,sp:new Float32Array(3),sn:new Float32Array(3),ko:!1,tv:function(){},axis:"",Ac:0,Sh:new Float32Array(3),yl:new Float32Array(4),threshold:0,ov:new Float32Array(4),Yj:0,Xj:0,Ev:0,Zj:0,Mc:0,repeat:!1,kr:!1,Qk:0,Pk:0,Ok:0,Sn:0,Rn:0,Qn:0}}function b(a,b){var c;if(a.fl){c=a.mo;for(var d=a.lo,e=0;e<c.length;e++)d[e]=c[e].value;
c=a.fl(d)}else c=!1;c||(a.value=Number(b))}function g(a){a=t.indexOf(a);-1<a?t.splice(a,1):F.error("Wrong object")}function c(a,b){for(var c=0,d=0;d<b.length;d++)for(var e=b[d].uf,f=0;f<e.length;f++)for(var h=e[f].rd,g=0;g<h.length;g++)h[g]===a&&c++;return c}function n(a,b){switch(a.type){case 80:h.Qo(a.Rm,a.nc,a.Qm);a.Rc=!0;break;case 90:h.Om(a.Pm);a.Rc=!0;break;case 100:h.Ro(a.ud,a.nc,a.sp,a.sn,a.ko);a.Rc=!0;break;case 130:a.Rc=!0}var c=b.indexOf(a);-1<c&&b.splice(c,1)}function p(a){for(var c=0;c<
l.length;c++){var d=l[c];20==d.type&&a.keyCode==d.key&&b(d,1)}Q&&a.preventDefault();Y&&Y(a)}function k(a){for(var c=0;c<l.length;c++){var d=l[c];20==d.type&&0==a.keyCode&&16==d.key&&b(d,0);20==d.type&&a.keyCode==d.key&&b(d,0)}Q&&a.preventDefault();Y&&Y(a)}function y(a){var c=!1,d=null;C=a.clientX;R=a.clientY;for(var e=0;e<l.length;e++){var f=l[e];50==f.type&&(b(f,1),f.da=a.which);160==f.type&&(c||(d=z.wl(a.clientX,a.clientY),c=!0),f.value=d==f.ud?1:0)}T&&a.preventDefault();K&&K(a)}function m(a){for(var c=
0;c<l.length;c++){var d=l[c];50==d.type&&b(d,0);160==d.type&&d.kr&&(d.value=0)}T&&!U&&a.preventDefault();K&&K(a)}function s(a){var c=a.clientX,d=a.clientY;C=c;R=d;for(var e=c-M,f=d-P,h=Math.sqrt(e*e+f*f),g=0;g<l.length;g++){var k=l[g];if(40===k.type)switch(k.axis){case "X":b(k,e);k.da=c;break;case "Y":b(k,f);k.da=d;break;case "XY":b(k,h),k.da[0]=c,k.da[1]=d}}T&&!U&&a.preventDefault();K&&K(a)}function B(a){var c=a.wheelDelta||-40*a.detail,c=c*E.qD;J+=c;for(c=0;c<l.length;c++){var d=l[c];30===d.type&&
b(d,J)}pa&&a.preventDefault();qa&&qa(a)}function u(a){var b=a.targetTouches;if(1==b.length){for(var c=b[0],b=c.pageX,c=c.pageY,d=!1,e=null,f=0;f<l.length;f++){var h=l[f];160==h.type&&(d||(e=z.wl(b,c),d=!0),h.value=e==h.ud)}L[0]=b;L[1]=-1;X[0]=c;X[1]=-1}else 1<b.length&&(w=ea=x(b),L[0]=b[0].pageX,L[1]=b[1].pageX,X[0]=b[0].pageY,X[1]=b[1].pageY);S.set(L);Z.set(X);oa&&oa(a)}function H(c){var d=c.targetTouches;if(0!==d.length){if(1===d.length){S[0]=d[0].pageX;S[1]=-1;Z[0]=d[0].pageY;Z[1]=-1;var d=S[0]-
L[0],e=Z[0]-X[0],f=Math.sqrt(d*d+e*e);if(-1!=L[1]&&-1!=X[1]){var h=S[0]-L[1],g=Z[0]-X[1],k=Math.sqrt(h*h+g*g);k<f&&(d=h,e=g,f=k)}for(k=0;k<l.length;k++){var m=l[k];if(60===m.type)switch(m.da=a.Nj,m.axis){case "X":b(m,d);break;case "Y":b(m,e);break;case "XY":b(m,f)}}}else if(1<d.length){S[0]=d[0].pageX;S[1]=d[1].pageX;Z[0]=d[0].pageY;Z[1]=d[1].pageY;w=x(d);f=w-ea;h=V;h[0]=(S[0]+S[1])/2;h[1]=(Z[0]+Z[1])/2;g=ca;g[0]=(L[0]+L[1])/2;g[1]=(X[0]+X[1])/2;var r,d=h[0],e=h[1],k=g[0],m=g[1];r=Math.sqrt((d-k)*
(d-k)+(e-m)*(e-m));for(k=0;k<l.length;k++)if(m=l[k],70===m.type&&Math.abs(r)<Math.abs(f)&&(m.da=a.Mj,b(m,f)),60===m.type&&Math.abs(r)>Math.abs(f))switch(m.da=a.Lj,m.axis){case "X":d=h[0]-g[0];b(m,d);break;case "Y":e=h[1]-g[1];b(m,e);break;case "XY":b(m,r)}}ma&&c.preventDefault();oa&&oa(c)}}function A(a){for(var c=0;c<l.length;c++){var d=l[c];if(170==d.type||180==d.type)d.Pk=a.beta,d.Qk=a.gamma,d.Ok=a.alpha,d.value||(d.Sn=a.gamma,d.Rn=a.beta,d.Qn=a.alpha,b(d,1))}}function x(a){var b=a[0],c=a[1];a=
b.pageX;var b=b.pageY,d=c.pageX,c=c.pageY;return Math.sqrt((a-d)*(a-d)+(b-c)*(b-c))}var f=q("__config"),F=q("__print"),h=q("__physics"),z=q("__scenes"),D=q("__time"),I=q("__util"),r=q("vec3"),v=q("quat"),E=f.controls,e=f.p,t=[],l=[],N={},J=0,C=0,R=0,M=0,P=0,S=new Float32Array(2),Z=new Float32Array(2),L=new Float32Array(2),X=new Float32Array(2),V=new Float32Array(2),ca=new Float32Array(2),w=0,ea=0,ha=!1,ba=0,Q=!1,T=!1,pa=!1,ma=!1,U=!1,Y=null,K=null,qa=null,oa=null;a.ca=10;a.fm=20;a.cd=30;a.bd=40;a.Nj=
0;a.Mj=1;a.Lj=2;a.update=function(c,d){for(var e=0;e<l.length;e++){var f=l[e],h=c,g=d;if(g)switch(f.type){case 110:var k=f.ud,m=k.d.g,k=k.d.quat,n=r.dist(f.Sh,m),p=f.ov;v.invert(f.yl,p);v.multiply(k,p,p);v.normalize(p,p);p=Math.abs(2*Math.acos(p[3]));n/=g;f.Yj=I.Mb(n,f.Yj,g,.3);f.da[0]=n;n=p/g;f.Xj=I.Mb(n,f.Xj,g,.3);f.da[1]=n;f.Yj>=f.threshold||f.Xj>=f.Ev?b(f,1):b(f,0);r.copy(m,f.Sh);v.copy(k,f.yl);f.Ac=h;break;case 120:k=f.ud;m=k.d.g;k=Math.abs(m[1]-f.Sh[1])/g;f.Zj=I.Mb(k,f.Zj,g,.3);f.da=k;f.Zj>=
f.threshold?b(f,1):b(f,0);r.copy(m,f.Sh);f.Ac=h;break;case 130:!f.Rc&&0<=f.Mc&&h-f.Ac>=f.Mc&&(b(f,1),f.repeat?f.Ac=h:f.Mc=-f.Mc);break;case 140:f.Ac||(f.Ac=h);b(f,h-f.Ac);f.Ac=h;break;case 150:b(f,h);break;case 170:f.da[0]=Math.PI*(f.Qk-f.Sn)/180;f.da[1]=Math.PI*(f.Pk-f.Rn)/180;f.da[2]=Math.PI*(f.Ok-f.Qn)/180;f.Sn=f.Qk;f.Rn=f.Pk;f.Qn=f.Ok;break;case 180:f.da[0]=Math.PI*f.Qk/180,f.da[1]=Math.PI*f.Pk/180,f.da[2]=Math.PI*f.Ok/180}}for(e=0;e<t.length;e++)for(g=t[e],f=g.uf,h=0;h<f.length;h++)if(m=f[h],
m.Uw!=ba){m.Uw=ba;for(var k=m,n=k.rd,p=k.qE,s=0;s<n.length;s++)p[s]=n[s].value;var k=k.cD(p),n=m,p=n.su,u=s=void 0;switch(n.type){case a.ca:k?u=s=1:1==p?u=s=-1:s=0;break;case a.fm:k&&-1==p?u=s=1:k||1!=p?s=0:u=s=-1;break;case a.cd:k&&-1==p?u=s=1:k||1!=p?s=0:(s=0,u=-1);break;case a.bd:s=n.ru!=k?1:0;break;default:I.ma("Wrong sensor manifold type: "+n.type)}u&&(n.su=u);if(n=s)if(p=g==N?null:g,ha=!1,m.callback(p,m.id,n,m.Kz),m.ru=k,ha){e=-1;break}}for(e=0;e<t.length;e++)for(g=t[e],f=g.uf,h=0;h<f.length;h++)for(m=
f[h],g=m.rd,m=0;m<g.length;m++)switch(k=g[m],k.type){case 30:b(k,0);break;case 40:b(k,0);break;case 60:b(k,0);break;case 70:b(k,0);break;case 130:b(k,0)}J=0;M=C;P=R;L.set(S);X.set(Z);ea=w;ba++};a.cs=function(a){var c=d(10);b(c,a);return c};a.Pa=function(a){var b=d(20);b.key=a;return b};a.Zm=function(a,c,e){if(!a||!a.l)return F.error("Wrong collision object"),null;var f=d(80);f.Rm=a;f.nc=c||"ANY";f.vo=e;f.Qm=function(a,c){b(f,a);a&&c&&e&&(f.da=f.da||new Float32Array(3),f.da[0]=c[0],f.da[1]=c[1],f.da[2]=
c[2])};f.Rc=!0;return f};a.bs=function(a){if(!a||!a.l)return F.error("Wrong collision impulse object"),null;var c=d(90);c.Pm=a;c.Qr=function(a){b(c,a)};c.Rc=!0;return c};a.hs=function(a,c,e,f,h){if(!a)return F.error("Wrong collision object"),null;var g=d(100);g.ud=a;g.sp=c;g.sn=e;g.ko=f;g.nc=h||"ANY";g.tv=function(a,c){b(g,a);a&&(g.da=c)};g.Rc=!0;return g};a.mk=function(){return d(50)};a.$m=function(){return d(30)};a.Ug=function(a){var b=d(40);b.axis=a||"XY";b.da="XY"==b.axis?new Float32Array(2):
0;return b};a.pi=function(a){var b=d(60);b.axis=a||"XY";b.da=0;return b};a.pk=function(){var a=d(70);a.da=0;return a};a.fs=function(a,b,c){if(!a)return F.error("Wrong collision object"),null;var e=d(110);e.ud=a;var f=a.d.g;a=a.d.quat;e.ov=new Float32Array(4);e.Sh=new Float32Array(f);e.yl=new Float32Array(a);e.Yj=0;e.Xj=0;e.threshold=b;e.Ev=c;e.Ac=0;e.da=new Float32Array([0,0]);return e};a.ls=function(a,b){if(!a)return F.error("Wrong collision object"),null;var c=d(120);c.ud=a;var e=a.d.quat;c.Sh=
new Float32Array(a.d.g);c.yl=new Float32Array(e);c.Zj=0;c.threshold=b;c.Ac=0;c.da=0;return c};a.ks=function(a,b){var c=d(130);c.Mc=a;c.repeat=b;c.Rc=!0;return c};a.zv=function(a,b,c,d){a=a||N;a=a.fd;if(!a||!a[b])return F.error("reset_timer_sensor(): wrong object"),null;b=a[b].rd[c];if(!b)return F.error("reset_timer_sensor(): sensor not found"),null;b.Ac=D.fh();b.Mc=d};a.Sg=function(){var a=d(140);a.Ac=0;return a};a.es=function(){var a=d(170);a.da=new Float32Array(3);return a};a.ds=function(){var a=
d(180);a.da=new Float32Array(3);return a};a.js=function(){return d(150)};a.an=function(a,b){var c=d(160);c.ud=a;c.kr=b;return c};a.pE=b;a.Qb=function(a,b,c){a=a||N;a=a.fd;if(!a||!a[b])return F.error("get_sensor_value(): wrong object"),null;b=a[b].rd[c];return b?b.value:(F.error("get_sensor_value(): sensor not found"),null)};a.Xd=function(a,b,c){a=a||N;a=a.fd;if(!a||!a[b])return F.error("get_sensor_payload(): wrong object"),null;b=a[b].rd[c];return b?b.da:(F.error("get_sensor_payload(): sensor not found"),
null)};a.ba=function(){t=[];l=[];N={}};a.Og=function(a,b){a=a||N;if(!a.fd)return!1;if(b&&a.fd[b])return!0;if(!b)for(var c in a.fd)return!0;return!1};a.ge=function(a,b){a=a||N;var d=a.fd;if(d){var e=a.uf;if(b){var f=d[b];if(f){for(var h=f.rd,k=0;k<h.length;k++)1===c(h[k],t)&&n(h[k],l);delete d[b];f=e.indexOf(f);-1<f?e.splice(f,1):I.ma("Incorrect manifolds array");Object.getOwnPropertyNames(d).length||g(a)}}else{for(b in d){f=d[b];h=f.rd;for(k=0;k<h.length;k++)1===c(h[k],t)&&n(h[k],l);delete d[b];f=
e.indexOf(f);-1<f?e.splice(f,1):I.ma("Incorrect manifolds array")}g(a);ha=!0}}};a.J=function(a,b,d,e,f,g,k){a=a||N;a.fd=a.fd||{};a.uf=a.uf||[];var m=a.fd,r=a.uf,p=m[b];if(p){e=p.rd;for(var v=0;v<e.length;v++)1===c(e[v],t)&&n(e[v],l);p=r.indexOf(p);-1<p?r.splice(p,1):I.ma("Incorrect manifolds array")}d={id:b,type:d,rd:e.slice(0),cD:f,qE:Array(e.length),callback:g,Kz:k,su:-1,ru:0,Uw:-1};m[b]=d;r.push(d);-1==t.indexOf(a)&&t.push(a);a=d.rd;for(b=0;b<a.length;b++){m=a[b];if(m.Rc){switch(m.type){case 80:h.qm(m.Rm,
m.nc,m.Qm,m.vo);break;case 90:h.tm(m.Pm,m.Qr);break;case 100:h.sm(m.ud,m.nc,m.sp,m.sn,m.ko,m.tv);break;case 130:m.Ac=D.fh(),0>m.Mc&&(m.Mc=-m.Mc)}m.Rc=!1}-1==l.indexOf(m)&&l.push(m)}ha=!0};a.ln=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.QA=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<t.length;a++){var b=t[a],c=b.fd,b=b.uf,d;for(d in c)delete c[d];b.splice(0,b.length)}for(a=0;a<l.length;a++)n(l[a],
l),a--;t.splice(0,t.length)};a.debug=function(){F.log(String(t.length)+" objects with manifolds",t);F.log(String(l.length)+" sensors",l);for(var a=[],b=[],c=0;c<l.length;c++){var d=l[c];80==d.type&&a.push(d);100==d.type&&b.push(d)}F.log(String(a.length)+" collision sensors",a);F.log(String(b.length)+" ray sensors",b)};a.Mo=function(a,b){a.addEventListener("keydown",p,!1);a.addEventListener("keyup",k,!1);Q=b};a.No=function(a,b,c){if(c)var d=window;else d=a,d.addEventListener("mouseout",m,!1);a.addEventListener("mousedown",
y,!1);d.addEventListener("mousemove",s,!1);d.addEventListener("mouseup",m,!1);T=b;U=c};a.Po=function(a,b){a.addEventListener("mousewheel",B,!1);a.addEventListener("DOMMouseScroll",B,!1);pa=b};a.Oo=function(a,b){a.addEventListener("touchstart",u,!1);a.addEventListener("touchmove",H,!1);document.addEventListener("touchstart",function(){});ma=b};a.Bl=function(){window.DeviceOrientationEvent&&e.Rk&&window.addEventListener("deviceorientation",A,!1)};a.Fp=function(a){a.removeEventListener("keydown",p,!1);
a.removeEventListener("keyup",k,!1)};a.Gp=function(a){a.removeEventListener("mousedown",y,!1);a.removeEventListener("mousemove",s,!1);a.removeEventListener("mouseout",m,!1);a.removeEventListener("mouseup",m,!1)};a.Ip=function(a){a.removeEventListener("mousewheel",B,!1);a.removeEventListener("DOMMouseScroll",B,!1)};a.Hp=function(a){a.removeEventListener("touchstart",u,!1);a.removeEventListener("touchmove",H,!1);document.removeEventListener("touchstart",function(){})};a.Sw=function(){window.DeviceOrientationEvent&&
e.Rk&&window.removeEventListener("deviceorientation",A,!1)};a.aI=function(a){Y=a};a.bI=function(a){K=a};a.dI=function(a){qa=a};a.cI=function(a){oa=a}};b4w.module.__physics=function(a,q){function d(a,b){for(var c=a.te,e=0;e<c.length;e++)c[e].d.Wl&&b.push(c[e]),d(c[e],b)}function b(a,b){if(Z)switch(a){case v.zx:I.log(b);break;case v.wx:I.error(b);break;case v.xx:r.zk.apply(this,b.slice(1));break;case v.Dx:var c=g(b.body_id);if(c){var d=b.trans,f=b.quat,h=b.linvel,k=b.angvel,c=c.l;c.dn=b.time;t.qj(d,1,f,c.en);J.copy(h,c.vu);J.copy(k,c.Uq)}break;case v.Bx:(d=g(b.chassis_hull_body_id))&&t.qj(b.trans,1,b.quat,d.i.gj[b.prop_ind]);break;case v.yx:if(c=
g(b[1]))d=b[4],c=c.Pc.bk[b[2]],e.Zc(c,b[3]),e.Yc(c,d),e.A(c);break;case v.Ex:if(c=g(b[1]))c.i.speed=b[2];break;case v.ux:for(var d=b.body_id_a,c=b.body_id_b,f=b.result,h=b.coll_point,d=parseInt(d),k=Z.l.o,m=0;m<k.length;m++)for(var n=k[m].zb,p=0;p<n.hd.length;p++){for(var s=n.hd[p],u=s.rl,z=!1,B=0;B<u.length;B++){var D=u[B];if(D[0]===d&&D[1]===c){s.cv[B]=f;z=!0;break}}if(z){u=s.cv;for(B=z=0;B<u.length;B++)z=z||u[B];s.callback(z,h)}}break;case v.vx:if(c=g(b[1]))c=c.l,c.kk&&c.kk(b[2]);break;case v.Cx:if(c=
g(b.body_id))for(c=c.l,f=b.from,h=b.to,k=b.local,m=b.body_id_b_hit,n=b.cur_result,p=0;p<c.Ue.length;p++)if(u=c.Ue[p],l.jk(u.P,f)&&l.jk(u.ka,h)&&u.local==k){for(d in u.he)u.he[d]=1;-1!=m&&(u.he[m]=n);for(var s=u.nc,B=u.callback,u=u.he,z=!1,D=1,y=0;y<Z.l.o.length;y++){var x=Z.l.o[y].zb;if(("ANY"==s||x.id==s)&&x.L in u&&1!==u[x.L]){z=!0;D=u[x.L];break}}B(z,D)}break;case v.Ax:console.log("Physics message ping: ",performance.now()-b[1]);break;default:I.error("Wrong message: "+a)}}function g(a){return X[a]||
null}function c(){V.body++;return V.body}function n(a){return{L:a,oo:0,Yk:!1,bf:!0,EK:!1,Li:!1,UC:!1,lk:null,id:"",CI:{},hd:[],kk:null,Ue:[],dn:0,en:new Float32Array([0,0,0,1,0,0,0,1]),vu:new Float32Array(3),Uq:new Float32Array(3),fk:new Float32Array(3),ek:new Float32Array(4)}}function p(a,b){switch(a){case "BOX":var c=b.Ub;break;case "CYLINDER":c=b.Bm;break;case "CONE":c=b.Am;break;case "SPHERE":c=b.Qc;break;case "CAPSULE":c=b.zm}return c}function k(a){if(!a)return null;var b={};"number"===typeof a.min_x&&
(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.w&&(b.center=a.w);"number"===typeof a.za&&(b.radius=a.za);"number"===typeof a.height&&(b.height=a.height);return b}function y(a,b,c,d){var e=a.d.g,f=b.d.N,h=new Float32Array(16);R.invert(f,h);f=new Float32Array(3);J.transformMat4(e,h,f);switch(b.i.type){case 10:b=
b.b4w_vehicle_settings;a=a.d.Ub;v.q(v.Px,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:v.q(v.Ox,c,f,a.pM)}}function m(a){return a.l&&a.l.lk?!0:!1}function s(a,b,c,d,e,f,h,g,l,k){var m;V.Xr++;m=V.Xr.toString(16);v.q(v.Wx,m,a,g,b.l.L,c,d,e.l.L,f,h,l,k);b.l.lk=m}function B(a){var b=a.l;if(b&&(0===b.oo||!0===b.Yk||!1===b.bf||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.g[0]!=a.l.fk[0]||a.d.g[1]!=a.l.fk[1]||a.d.g[2]!=a.l.fk[2]||a.d.quat[0]!=a.l.ek[0]||a.d.quat[1]!=
a.l.ek[1]||a.d.quat[2]!=a.l.ek[2])){a.l.fk.set(a.d.g);a.l.ek.set(a.d.quat);var b=a.l,c=v.st(v.Hg);c.msg_id=v.Hg;c.body_id=a.l.L;c.trans=a.d.g;"DYNAMIC"===b.type?(c.quat=w,C.identity(w)):c.quat=a.d.quat;v.q(v.Hg,c)}a=a.te;for(b=0;b<a.length;b++)B(a[b])}function u(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.quat;e[0]=b;e[1]=c;e[2]=d;J.transformQuat(e,a,e)}function H(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.l.o.length;e++){var f=b.l.o[e];if("ANY"==a||f.zb.id==a)f=f.zb.L,
c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function A(a,b){v.q(v.dd,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=l.er(e.P)+l.er(e.ka)+String(e.local);c[f]=c[f]||{P:e.P,ka:e.ka,local:e.local,sr:[]};var h=c[f].sr,g;for(g in e.he)-1==h.indexOf(g)&&h.push(g)}for(f in c)d=c[f].P,e=c[f].ka,g=c[f].local,h=c[f].sr,v.q(v.zq,a,d,e,g,h)}else v.q(v.zq,a,null,null,!1,null)}function x(a,b){if(b.Jh){var c=a.l.L,d=b.$g*b.Ps,e=b.ki*b.ur,f=-b.Ih*b.tp*2*Math.PI/b.Aw;b.hu&&(f*=-1);switch(b.type){case 10:v.q(v.dd,
c);v.q(v.Cy,c,d,e,f);break;case 20:v.q(v.dd,c),v.q(v.By,c,d,e,f)}}}function f(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function F(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function h(a){return a.b4w_character?!0:!1}function z(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}q("__camera");var D=q("__config");q("__constraints");var I=q("__print"),r=q("__debug"),v=q("__ipc");q("__renderer");var E=q("__scenes"),e=q("__transform"),
t=q("__tsr"),l=q("__util"),N=q("__version"),J=q("vec3"),C=q("quat"),R=q("mat4"),M=D.zb,P=D.p,S=null,Z=null,L=[],X=[],V={lx:0,body:0,Xr:0,shape:0},ca=new Float32Array(3),w=new Float32Array(4),ea=new Float32Array(4),ha=new Float32Array(16),ba=new Float32Array(8),Q=new Float32Array(8);a.NC=function(a){if(M.enabled){var c=M.Uh+N.timestamp();I.log("%cLOAD PHYSICS","color: #0a0",c,"Max FPS: "+M.Qe);S=new Worker(c);v.ac(S,b);v.q(v.ly,a,M.Qe)}};a.gr=function(a){var b;V.lx++;b=V.lx;v.q(v.ay,b);a.l={};a.l.gG=
b;a.l.o=[]};a.ba=function(){if(M.enabled){v.q(v.gy);Z=null;L.length=0;X.length=0;for(var a in V)V[a]=0}};a.Lg=function(a,b){Z=b;v.q(v.qy,b.l.gG);var e=a.d;if(!e)throw"No object render: "+a.name;if(a.parent&&e.Wl)return null;var g=[];e.Wl&&d(a,g);if(f(a)||F(a)||h(a)||z(a)||a.b4w_collision){var r,t=a,u=e.fv,B=t.d,D=t.game,A=c();if("CAMERA"==t.type)var q=D.use_collision_bounds?D.collision_bounds_type:"BOX",w=p(q,B),H=B.Ci,N=B.vi,H=.5,N=0;else"EMPTY"==t.type?(q="EMPTY",w=null,N=H=0):(q=D.use_collision_bounds?
D.collision_bounds_type:"BOX",w=p(q,B),H=B.Ci,N=B.vi);var M=B.g,P=B.quat,Q=D.use_ghost,S=D.use_sleep,V=D.mass,Qa=D.velocity_min,La=D.velocity_max,Ca=D.damping,lb=D.rotation_damping,ra=D.collision_group,ic=D.collision_mask,la=B.Qc.za,gb=k(w),ca=t.b4w_correct_bounding_offset,Aa;var ba=q;if(g.length){var sa=[],Ga={};Ga.quat=new Float32Array([0,0,0,1]);Ga.trans=new Float32Array(3);Ga.worker_bounding=gb;Ga.bounding_type=ba;sa.push(Ga);R.invert(B.N,ha);C.invert(B.quat,ea);for(var Na=0;Na<g.length;Na++){var mb=
{},Jb=g[Na],ob=Jb.game.collision_bounds_type,Tb=new Float32Array(4),cb=new Float32Array(3);J.transformMat4(Jb.d.g,ha,cb);C.multiply(ea,Jb.d.quat,Tb);mb.trans=cb;mb.quat=Tb;mb.bounding_type=ob;mb.worker_bounding=k(p(ob,Jb.d));sa.push(mb)}Aa=sa}else Aa=[];v.q(v.Sx,A,M,P,u,Q,S,V,Qa,La,Ca,lb,ra,ic,q,gb,la,H,N,Aa,ca);L.push(t);X[A]=t;var bc=n(A);bc.type=u;bc.oo=V;bc.Yk=Q;r=bc;a.l=r;var nc={n:null,zb:r};b.l.o.push(nc)}else for(var ib=a.ga||[],xa=0;xa<ib.length;xa++){var ya=ib[xa],zb;if(zb="PHYSICS"==ya.type){var Ub;
a:{for(var Ab=b.l.o,Fb=0;Fb<Ab.length;Fb++){var Kb=Ab[Fb].n;if(Kb&&Kb.id==ya.id){Ub=!0;break a}}Ub=!1}zb=!Ub}if(zb)if(ya.zc.I)if(ya.Fg&&b.d.Va){var Sa=ya,Sb=Z,Wa=E.qa(Sb,"MAIN_OPAQUE");v.q(v.$x,Wa.mf);if(Wa.Va&&Sa.bG){var Ja={};Ja.dst_noise_scale0=Sa.dst_noise_scale0;Ja.dst_noise_scale1=Sa.dst_noise_scale1;Ja.dst_noise_freq0=Sa.dst_noise_freq0;Ja.dst_noise_freq1=Sa.dst_noise_freq1;Ja.dir_min_shore_fac=Sa.dir_min_shore_fac;Ja.dir_freq=Sa.dir_freq;Ja.dir_noise_scale=Sa.dir_noise_scale;Ja.dir_noise_freq=
Sa.dir_noise_freq;Ja.dir_min_noise_fac=Sa.dir_min_noise_fac;Ja.dst_min_fac=Sa.dst_min_fac;Ja.waves_hor_fac=Sa.waves_hor_fac;var yb=Wa.nf,Pb=Wa.Gg;Wa.Yl?v.q(v.yq,Ja,Wa.af[0],Wa.af[1],Wa.$e[0],Wa.$e[1],Wa.nh,yb,Pb,Wa.zh,Sb.d.gp):v.q(v.yq,Ja,0,0,0,0,0,yb,Pb,0,null)}}else{var pb;if(ya.UF){var Va=a,Ya=ya,Da=c(),nb=Ya.zc;v.q(v.Yx,Da,nb.t[0].a_position,nb.ia||null,Va.d.g,Ya.Rr,Ya.Sr);var mc=n(Da);mc.Yk=!0;pb=mc}else{var va=a,tb=ya,da=c(),Gb=tb.zc;v.q(v.Zx,da,Gb.t[0].a_position,Gb.ia||null,va.d.g,tb.Ci,tb.vi,
tb.Rr,tb.Sr);pb=n(da)}r=pb;r.id=ya.nc;nc={n:ya,zb:r};b.l.o.push(nc)}else I.error("Object "+a.name+" has collision material with no assigned vertices")}if(f(a)||F(a)){var Ba=a,Ea=Ba.l.L;f(Ba)?(Ba.i.type=10,v.q(v.Tx,Ea,Ba.i.qF,Ba.i.sF,Ba.i.rF,Ba.i.eG,Ba.i.mD)):F(Ba)&&(Ba.i.type=20,v.q(v.Rx,Ea,Ba.i.wn,Ba.i.Up,Ba.i.Vp));if(Ba.i.sg){var Fa=Ba.i.sg;switch(Ba.i.type){case 10:y(Fa[1],Ba,Ea,!0);y(Fa[0],Ba,Ea,!0);y(Fa[3],Ba,Ea,!1);y(Fa[2],Ba,Ea,!1);break;case 20:for(var wb=0;wb<Fa.length;wb++)y(Fa[wb],Ba,Ea,
!1)}}Ba.l.id=Ba.b4w_vehicle_settings.name;x(a,a.i)}else if(h(a)){var xb=a.d,Ra=a.l,Hb=xb.Ub.max_y-xb.Ub.min_y,jb=Ra.L,Ib=a.b4w_character_settings,$b=Ib.walk_speed,xc=Ib.run_speed,Nb=Ib.step_height,Eb=Ib.jump_strength,jc=Ib.waterline,kc=l.XA(a);v.q(v.Ux,jb,kc,Hb,$b,xc,Nb,Eb,jc);Ra.Li=!0}else if(z(a)){var Ua=a,lc=Ua.l.L;v.q(v.Xx,lc,Ua.Pc.wn,Ua.Pc.Up,Ua.Pc.Vp);if(Ua.Pc.bk)for(var Ob=Ua.Pc.bk,bb=0;bb<Ob.length;bb++){var ac=Ob[bb],sb=ac.d.g,G=Ua.d.N,db=new Float32Array(16);R.invert(G,db);var Za=new Float32Array(3);
J.transformMat4(sb,db,Za);v.q(v.Qx,lc,Za,ac.Dz)}Ua.l.UC=!0}else a.b4w_collision&&(r.id=a.b4w_collision_id);for(xa=0;xa<L.length;xa++)if(a=L[xa],a.l){var $a=a;if(!m($a))for(var na=0;na<$a.constraints.length;na++){var W=$a.constraints[na],Oa=W.target,eb=W.pivot_type;if("RIGID_BODY_JOINT"==W.type&&Oa.l){var Ta=new Float32Array([W.pivot_x,W.pivot_y,W.pivot_z]),cc,oc=new Float32Array([W.axis_x,W.axis_y,W.axis_z]);cc=l.Ge(oc,new Float32Array(4));var dc=R.fromRotationTranslation(cc,Ta,new Float32Array(16)),
ec=R.multiply($a.d.N,dc,new Float32Array(16)),Vb=R.invert(Oa.d.N,new Float32Array(16)),pc=R.multiply(Vb,ec,Vb),qc=l.fg(pc),Ec=l.ee(pc),Ka=W,Ha={};Ha.use_limit_x=Ka.use_limit_x;Ha.use_limit_y=Ka.use_limit_y;Ha.use_limit_z=Ka.use_limit_z;Ha.use_angular_limit_x=Ka.use_angular_limit_x;Ha.use_angular_limit_y=Ka.use_angular_limit_y;Ha.use_angular_limit_z=Ka.use_angular_limit_z;Ha.limit_max_x=Ka.limit_max_x;Ha.limit_min_x=Ka.limit_min_x;Ha.limit_max_y=Ka.limit_max_y;Ha.limit_min_y=Ka.limit_min_y;Ha.limit_max_z=
Ka.limit_max_z;Ha.limit_min_z=Ka.limit_min_z;Ha.limit_angle_max_x=Ka.limit_angle_max_x;Ha.limit_angle_min_x=Ka.limit_angle_min_x;Ha.limit_angle_max_y=Ka.limit_angle_max_y;Ha.limit_angle_min_y=Ka.limit_angle_min_y;Ha.limit_angle_max_z=Ka.limit_angle_max_z;Ha.limit_angle_min_z=Ka.limit_angle_min_z;s(eb,$a,Ta,cc,Oa,qc,Ec,Ha,null,null)}}}};a.rB=g;a.update=function(){for(var a=0;a<L.length;a++){var b=L[a],c=b.l;if(c.bf&&c.dn){var d=performance.now()/1E3-c.dn,d=Math.min(d,10/60);P.tD&&(d=0);var f=ba;t.OC(c.en,
d,c.vu,c.Uq,ba);e.Zc(b,t.Ht(f));e.Yc(b,t.xt(f));e.A(b);B(b);if(b.i)for(var c=b,d=c.i.sg,f=c.d.qe,h=ba,g=0;g<d.length;g++){var k=d[g];t.multiply(f,c.i.gj[g],h);e.cw(k,h);e.A(k)}b.i&&b.i.Jh&&(c=b.i,d=c.Jh)&&(f=b.i.Bw,k=ha,h=b.d.g,g=b.d.quat,l.Cp(b.i.Cw,g,h,k),l.fg(k,d.d.g),l.ee(k,d.d.quat),k=w,l.Dp(f,g,h,k),f=ea,C.setAxisAngle(k,-c.Ih*c.tp*2*Math.PI,f),C.multiply(f,d.d.quat,d.d.quat),e.A(d));b.i&&b.i.pp&&(c=b.i,d=c.pp)&&(h=b.i.ww,f=ha,g=b.d.g,k=b.d.quat,l.Cp(b.i.xw,k,g,f),l.fg(f,d.d.g),l.ee(f,d.d.quat),
f=w,l.Dp(h,k,g,f),h=ea,g=Math.abs(c.speed)*c.vw,g>c.qo&&(g=c.qo),C.setAxisAngle(f,-g,h),C.multiply(h,d.d.quat,d.d.quat),e.A(d));b.i&&b.i.wp&&(c=b.i,d=c.wp)&&(f=b.i.Jw,k=ha,h=b.d.g,g=b.d.quat,l.Cp(b.i.Kw,g,h,k),l.fg(k,d.d.g),l.ee(k,d.d.quat),b=w,l.Dp(f,g,h,b),f=ea,C.setAxisAngle(b,-Math.abs(c.$g)*c.ts,f),C.multiply(f,d.d.quat,d.d.quat),e.A(d))}}if(a=Z)a=E.qa(a,"MAIN_OPAQUE"),a.Va&&0<a.Va.waves_height&&(b=J.length(a.Bj),v.q(v.Ay,a.time*b))};a.OB=function(){return Z};a.pause=function(){M.enabled&&v.q(v.my)};
a.ie=function(){M.enabled&&v.q(v.py)};a.Bs=function(a){a=a.l;if(!a)throw"No object physics";if(!a.bf){var b=a.L;a.bf=!0;v.q(v.ky,b)}};a.uk=function(a){a=a.l;if(!a)throw"No object physics";if(a.bf){var b=a.L;a.bf=!1;v.q(v.jy,b)}};a.B=function(a){return a.l?!0:!1};a.Wt=function(a){return(a=a.l)&&a.bf&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.oo&&0==a.Yk?!0:!1};a.Wn=function(a){return(a=a.l)&&a.bf?!0:!1};a.Uv=function(a,b){v.q(v.zy,a.l.L,b)};a.HC=m;a.Xq=s;a.Mr=function(a){a=a.l;v.q(v.oy,a.lk);
a.lk=null};a.nv=function(b,c,d,f,h,g){c=t.Vg(c,1,d,ba);h=t.Vg(h,1,g,Q);t.invert(c,c);t.multiply(h,c,c);e.vC(f,h);t.multiply(h,c,c);e.cw(b,c);e.A(b);a.Hl(b,b.d.g,b.d.quat)};a.Hl=function(a,b,c){t.qj(a.d.g,1,a.d.quat,a.l.en);var d=v.st(v.Hg);d.msg_id=v.Hg;d.body_id=a.l.L;d.trans=b;d.quat=c;v.q(v.dd,a.l.L);v.q(v.Hg,d)};a.T=B;a.cr=function(a,b,c,d){u(a,b,c,d,ca);a=a.l.L;v.q(v.dd,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(ca[0]),f=Math.abs(ca[1]),h=Math.abs(ca[2]);ca[0]=e?ca[0]/e*Math.max(e,
b):0;ca[1]=f?ca[1]/f*Math.max(f,c):0;ca[2]=h?ca[2]/h*Math.max(h,d):0;v.q(v.Aq,a,ca[0],ca[1],ca[2])};a.dr=function(a,b,c,d){a=a.l.L;v.q(v.dd,a);v.q(v.Aq,a,b,c,d)};a.Yq=function(a,b,c,d){u(a,b,c,d,ca);a=a.l.L;v.q(v.dd,a);v.q(v.by,a,ca[0],ca[1],ca[2])};a.br=function(a,b,c,d){u(a,b,c,d,ca);a=a.l.L;v.q(v.dd,a);v.q(v.dy,a,ca[0],ca[1],ca[2])};a.Yo=function(a,b,c){a=a.l.L;v.q(v.dd,a);v.q(v.ty,a,b,c)};a.Fl=function(a,b){v.q(v.uy,a.l.L,b)};a.Mv=function(a,b){v.q(v.yy,a.l.L,b)};a.Lv=function(a,b){v.q(v.wy,a.l.L,
b)};a.Iv=function(a,b){v.q(v.ry,a.l.L,b)};a.Ar=function(a){v.q(v.ey,a.l.L)};a.Br=function(a,b,c){v.q(v.fy,a.l.L,b,c)};a.Gl=function(a,b,c){v.q(v.vy,a.l.L,b,c)};a.Jv=function(a,b){v.q(v.sy,a.l.L,b)};a.Kv=function(a,b){v.q(v.xy,a.l.L,b)};a.rI=function(){return!1};a.pI=function(){return!1};a.Qz=function(){I.error("check_collision() deprecated");return!1};a.oI=function(){I.error("check_collision_any() deprecated");return!1};a.Uz=function(){I.error("check_ray_hit() deprecated");return!1};a.AM=function(){I.error("update_object_coords() deprecated")};
a.qm=function(a,b,c,d){var e=a.l,f=e.L;b=b||"ANY";for(var h=0;h<e.hd.length;h++){var g=e.hd[h];if(g.nc==b&&g.callback==c)return}h=[];a=a.l.L;g=[];H(b,Z,g,null);for(var l=0;l<g.length;l++){var k=g[l];a<k?h.push([a,k]):a>k&&h.push([k,a])}g={nc:b,callback:c,rl:h,cv:new Uint8Array(h.length),vo:d||!1};e.hd.push(g);v.q(v.dd,f);v.q(v.Vx,h,d)};a.Qo=function(a,b,c){a=a.l;b=b||"ANY";for(var d=0;d<a.hd.length;d++){var e=a.hd[d];if(e.nc==b&&e.callback==c){a.hd.splice(d,1);d--;for(var e=e.rl,f=Z.l.o,h=0;h<f.length;h++)for(var g=
f[h].zb,l=0;l<g.hd.length;l++)for(var k=g.hd[l],m=0;m<k.rl.length;m++)for(var r=k.rl[m],n=0;n<e.length;n++){var t=e[n];r[0]===t[0]&&r[1]===t[1]&&(e.splice(n,1),n--)}e.length&&v.q(v.ny,e)}}};a.tm=function(a,b){var c=a.l;c?(v.q(v.cy,c.L),c.kk=b):I.error("Object "+a.name+" has no physics")};a.Om=function(a){var b=a.l;b?(v.q(v.hy,b.L),b.kk=null):I.error("Object "+a.name+" has no physics")};a.sm=function(a,b,c,d,e,f){var h=a.l;if(h){a=h.L;b=b||"ANY";c={P:new Float32Array(c),ka:new Float32Array(d),local:e,
callback:f,nc:b,he:{}};H(b,Z,null,c.he);delete c.he[a];for(var g in c.he)c.he[g]=1;h.Ue.push(c);A(a,h.Ue)}else I.error("Object "+a.name+" has no physics")};a.Ro=function(a,b,c,d,e){if(b=a.l){a=b.L;for(var f=0;f<b.Ue.length;f++){var h=b.Ue[f];l.jk(h.P,c)&&l.jk(h.ka,d)&&h.local==e&&(b.Ue.splice(f,1),f--)}A(a,b.Ue)}else I.error("Object "+a.name+" has no physics")};a.Yh=function(a,b){var c=a.i;c.$g=b;x(a,c)};a.Xh=function(a,b){var c=a.i;c.Ih=b;x(a,c)};a.Op=function(a,b){var c=a.i;c.ki=b;x(a,c)};a.bc=
f;a.cc=F;a.SC=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.RC=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.VC=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.nu=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.mu=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==
a.b4w_vehicle_settings.part?!0:!1};a.ou=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.It=function(a){return a.i.speed};a.fG=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.Li=h;a.zK=z;a.KJ=function(){return 0};a.OA=function(){v.q(v.iy)};a.VD=function(a){var b=L.indexOf(a);-1!=b?(L.splice(b,1),a=X.indexOf(a),-1!=a&&X.splice(a,1)):I.error("Object ",a.name,
" doesn't have bounding physics")};a.reset=function(){S.terminate()}};b4w.module.__ipc=function(a){var q=a.ux=0;a.vx=1;a.wx=2;a.xx=3;a.yx=4;a.zx=5;var d=a.Bx=6,b=a.Cx=7,g=a.Dx=8;a.Ex=9;a.Ax=10;a.ly=11;a.dd=12;a.Ox=13;a.Px=14;a.Qx=15;a.Sx=16;a.Rx=17;a.Tx=18;a.Ux=19;a.Vx=20;a.Wx=21;a.Xx=22;a.Yx=23;a.Zx=24;a.$x=25;a.ay=26;a.by=27;a.cy=28;a.dy=29;a.ey=30;a.fy=31;a.gy=32;a.hy=33;a.jy=34;a.ky=35;a.my=36;a.zq=37;a.ny=38;a.oy=39;a.py=40;a.qy=41;a.ry=42;a.sy=43;a.ty=44;a.uy=45;a.vy=46;a.wy=47;a.xy=48;a.yy=49;a.zy=50;a.Aq=51;var c=a.Hg=52;a.Ay=53;a.yq=54;a.By=55;a.Cy=56;a.AH=
57;a.iy=58;for(var n=null,p=[],k=[],y=[],m=[],s=0;59>s;s++)p.push(null),k.push(null),y.push(null),m.push(null);k[g]={msg_id:0,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3)};k[d]={msg_id:0,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4)};k[b]={msg_id:0,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0};k[q]={msg_id:0,body_id_a:0,body_id_b:0,result:0,
coll_point:new Float32Array(3)};k[c]={msg_id:0,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4)};m[g]=["msg_id",1,"body_id",1,"time",1,"trans",3,"quat",4,"linvel",3,"angvel",3];m[d]=["msg_id",1,"chassis_hull_body_id",1,"prop_ind",1,"trans",3,"quat",4];m[b]=["msg_id",1,"body_id",1,"from",3,"to",3,"local",1,"body_id_b_hit",1,"cur_result",1];m[q]=["msg_id",1,"body_id_a",1,"body_id_b",1,"result",1,"coll_point",3];m[c]=["msg_id",1,"body_id",1,"trans",3,"quat",4];a.ac=function(a,b){a.addEventListener("message",
function(a){var c=a.data;a=c[0]|0;if(m[a]){for(var d=k[a],f=m[a],g=0,h=0;h<f.length;h+=2){var n=f[h],p=f[h+1];if(1==p)d[n]="msg_id"==n||"body_id"==n||"body_id_a"==n||"body_id_b"==n?c[g]|0:c[g];else for(var s=0;s<p;s++)d[n][s]=c[g+s];g+=p}c=d}b(a,c)},!1);n=a};a.ba=function(){n=null};a.q=function(){var a=arguments[0]|0;if(m[a]){var b=k[a],c=m[a],d=0;if(!y[a]){for(var g=0,f=1;f<c.length;f+=2)g+=c[f];y[a]=new Float32Array(g)}g=y[a];for(f=0;f<c.length;f+=2){var s=b[c[f]],h=c[f+1];1==h?g[d]=s:g.set(s,d);
d+=h}p[a]||(p[a]=g);a=p[a]}else for(b=arguments.length,p[a]||(p[a]=Array(b),p[a][0]=a),a=p[a],c=1;c<b;c++)a[c]=arguments[c];n.postMessage(a)};a.st=function(a){return k[a]}};b4w.module.__renderer=function(a,q){function d(a){if(a){var b=(a.la?A.COLOR_BUFFER_BIT:0)|(a.pa?A.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=s;break;case "DEPTH":a=B;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":a=u;break;case "GLOW_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=H;break;default:a=m.background_color}}else b=A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT,a=m.background_color;A.colorMask(!0,!0,!0,!0);A.depthMask(!0);A.clearColor(a[0],
a[1],a[2],a[3]);A.clear(b)}function b(a,b,c){A.bindBuffer(A.ARRAY_BUFFER,a.Cg);for(var d=0;d<b.length;d++){var g=b[d];A.enableVertexAttribArray(g.dg);A.vertexAttribPointer(g.dg,g.ig,A.FLOAT,!1,0,g.vz+g.wB*c)}a.$d?(A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,a.$d),A.drawElements(a.mode,a.count,a.Yn,0)):A.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)g=b[d],A.disableVertexAttribArray(g.dg)}function g(a){switch(a){case 0:return A.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return A.TEXTURE_CUBE_MAP_NEGATIVE_X;
case 2:return A.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return A.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return A.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return A.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function c(a){var b=a.vj,c=[],d=[],g={},k;for(k in b){var m=!1;switch(k){case "u_proj_matrix":var n=function(a,b,c,d,f,h){a.uniformMatrix4fv(b,!1,h.ua)},m=!0;break;case "u_view_matrix":case "u_view_matrix_frag":n=function(a,b,c,d,f,h){a.uniformMatrix4fv(b,!1,h.oa)};m=!0;break;case "u_shadow_cast_billboard_view_matrix":n=function(a,
b,c,d,f,h){a.uniformMatrix4fv(b,!1,h.iw)};m=!0;break;case "u_view_proj_prev":n=function(a,b,c,d,f,h){a.uniformMatrix4fv(b,!1,h.LD)};m=!0;break;case "u_view_proj_inverse":n=function(a,b,c,d,f,h){a.uniformMatrix4fv(b,!1,h.$h)};m=!0;break;case "u_sky_vp_inverse":n=function(a,b,c,d,f,h){a.uniformMatrix4fv(b,!1,h.td)};m=!0;break;case "u_camera_eye":case "u_camera_eye_frag":n=function(a,b,c,d,f,h){a.uniform3fv(b,h.He)};m=!0;break;case "u_camera_eye_last":n=function(a,b,c,d,f,h){a.uniform3fv(b,h.Js)};m=
!0;break;case "u_camera_quat":n=function(a,b,c,d,f,h){a.uniform4fv(b,h.quat)};m=!0;break;case "u_view_max_depth":n=function(a,b,c,d,f,h){a.uniform1f(b,h.Za)};m=!0;break;case "u_camera_range":n=function(a,b,c,d,f,h){a.uniform2f(b,h.Sa,h.Za)};break;case "u_csm_center_dists":n=function(a,b,c,d,f,h){a.uniform4fv(b,h.ms)};break;case "u_cam_water_depth":n=function(a,b,c){a.uniform1f(b,c.Km)};m=!0;break;case "u_waves_height":n=function(a,b,c){a.uniform1f(b,c.nf)};break;case "u_waves_length":n=function(a,
b,c){a.uniform1f(b,c.Gg)};break;case "u_fog_color_density":n=function(a,b,c){a.uniform4fv(b,c.Yb)};break;case "u_underwater_fog_color_density":n=function(a,b,c){a.uniform4fv(b,c.$c)};break;case "u_bloom_key":n=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":n=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":n=function(a,b,c){a.uniform1f(b,c.time)};m=!0;break;case "u_wind":n=function(a,b,c){a.uniform3fv(b,c.Bj)};break;case "u_horizon_color":n=function(a,
b,c){a.uniform3fv(b,c.Jc)};break;case "u_zenith_color":n=function(a,b,c){a.uniform3fv(b,c.Oc)};break;case "u_environment_energy":n=function(a,b,c){a.uniform1f(b,c.Fe)};break;case "u_sky_color":n=function(a,b,c){a.uniform3fv(b,c.Ah)};break;case "u_rayleigh_brightness":n=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":n=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":n=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":n=
function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":n=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":n=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":n=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":n=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":n=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;
case "u_light_positions":n=function(a,b,c){a.uniform3fv(b,c.bg)};break;case "u_light_directions":n=function(a,b,c){a.uniform3fv(b,c.Zf)};break;case "u_light_color_intensities":n=function(a,b,c){a.uniform3fv(b,c.Yf)};break;case "u_light_factors1":n=function(a,b,c){a.uniform4fv(b,c.$f)};break;case "u_light_factors2":n=function(a,b,c){a.uniform4fv(b,c.ag)};break;case "u_shadow_lamp_id":n=function(a,b,c){a.uniform1i(b,c.jw)};break;case "u_sun_quaternion":n=function(a,b,c){a.uniform4fv(b,c.Iw)};break;
case "u_sun_intensity":n=function(a,b,c){a.uniform3fv(b,c.Hw)};break;case "u_sun_direction":n=function(a,b,c){a.uniform3fv(b,c.Ol)};break;case "u_height":n=function(a,b,c,d,f,h){a.uniform1f(b,h.height)};m=!0;break;case "u_model_matrix":n=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.N)};m=!0;break;case "u_transb":n=function(a,b,c,d){a.uniform4fv(b,d.Cc)};m=!0;break;case "u_transa":n=function(a,b,c,d){a.uniform4fv(b,d.Bc)};m=!0;break;case "u_quat":n=function(a,b,c,d){a.uniform4fv(b,d.quat)};m=!0;break;
case "u_quatsb":n=function(a,b,c,d){a.uniform4fv(b,d.vc)};m=!0;break;case "u_quatsa":n=function(a,b,c,d){a.uniform4fv(b,d.uc)};m=!0;break;case "u_frame_factor":n=function(a,b,c,d){a.uniform1f(b,d.Jf)};m=!0;break;case "au_center_pos":n=function(){};m=!0;break;case "au_wind_bending_amp":n=function(a,b,c,d){a.uniform1f(b,d.Bd)};m=!0;break;case "au_wind_bending_freq":n=function(a,b,c,d){a.uniform1f(b,d.of)};m=!0;break;case "au_detail_bending_freq":n=function(a,b,c,d){a.uniform1f(b,d.Ce)};m=!0;break;case "au_detail_bending_amp":n=
function(a,b,c,d){a.uniform1f(b,d.Be)};m=!0;break;case "au_branch_bending_amp":n=function(a,b,c,d){a.uniform1f(b,d.ze)};m=!0;break;case "u_anim_values":n=function(a,b,c,d){a.uniform1fv(b,d.gg)};m=!0;break;case "u_diffuse_color":n=function(a,b,c,d,f){a.uniform4fv(b,f.kd)};m=!0;break;case "u_diffuse_intensity":n=function(a,b,c,d,f){a.uniform1f(b,f.qn)};m=!0;break;case "u_diffuse_params":n=function(a,b,c,d,f){a.uniform2fv(b,f.Sd)};m=!0;break;case "u_emit":n=function(a,b,c,d,f){a.uniform1f(b,f.xk)};m=
!0;break;case "u_ambient":n=function(a,b,c,d,f){a.uniform1f(b,f.Uj)};m=!0;break;case "u_specular_color":n=function(a,b,c,d,f){a.uniform3fv(b,f.np)};m=!0;break;case "u_specular_alpha":n=function(a,b,c,d,f){a.uniform1f(b,f.Dh)};m=!0;break;case "u_specular_params":n=function(a,b,c,d,f){a.uniform3fv(b,f.Ml)};m=!0;break;case "u_reflect_factor":n=function(a,b,c,d,f){a.uniform1f(b,f.uv)};m=!0;break;case "u_mirror_factor":n=function(a,b,c,d,f){a.uniform1f(b,f.so)};m=!0;break;case "u_grass_map_dim":n=function(a,
b,c,d,f){a.uniform3fv(b,f.$b)};m=!0;break;case "u_grass_size":n=function(a,b,c,d,f){a.uniform1f(b,f.Pn)};m=!0;break;case "u_scale_threshold":n=function(a,b,c,d,f){a.uniform1f(b,f.Mk)};m=!0;break;case "u_cube_fog":n=function(a,b,c,d,f){a.uniformMatrix4fv(b,!1,f.oc)};break;case "u_jitter_amp":n=function(a,b,c,d,f){a.uniform1f(b,f.bl)};m=!0;break;case "u_jitter_freq":n=function(a,b,c,d,f){a.uniform1f(b,f.cl)};m=!0;break;case "u_wireframe_mode":n=function(a,b,c,d,f){a.uniform1i(b,f.wireframe_mode)};break;
case "u_wireframe_edge_color":n=function(a,b,c,d,f){a.uniform3fv(b,f.wireframe_edge_color)};break;case "u_subpixel_jitter":n=function(a,b,c){a.uniform2fv(b,c.ZC)};m=!0;break;case "u_subsample_indices":n=function(a,b,c){a.uniform4fv(b,c.$C)};m=!0;break;case "u_refr_bump":n=function(a,b,c,d,f){a.uniform1f(b,f.vv)};m=!0;break;case "u_lamp_light_positions":n=function(a,b,c,d,f){a.uniform3fv(b,f.eo)};break;case "u_lamp_light_directions":n=function(a,b,c,d,f){a.uniform3fv(b,f.bo)};break;case "u_lamp_light_color_intensities":n=
function(a,b,c,d,f){a.uniform3fv(b,f.ao)};break;case "u_lamp_light_factors":n=function(a,b,c,d,f){a.uniform4fv(b,f.co)};break;case "u_halo_size":n=function(a,b,c,d,f){a.uniform1f(b,f.Tt)};m=!0;break;case "u_halo_hardness":n=function(a,b,c,d,f){a.uniform1f(b,f.Qt)};m=!0;break;case "u_halo_rings_color":n=function(a,b,c,d,f){a.uniform3fv(b,f.St)};m=!0;break;case "u_halo_lines_color":n=function(a,b,c,d,f){a.uniform3fv(b,f.Rt)};m=!0;break;case "u_halo_stars_blend":n=function(a,b,c,d,f){a.uniform1f(b,f.Ut)};
m=!0;break;case "u_halo_stars_height":n=function(a,b,c,d,f){a.uniform1f(b,f.Vt)};m=!0;break;case "u_fresnel_params":n=function(a,b,c,d,f){a.uniform4fv(b,f.Bi)};m=!0;break;case "u_texture_scale":n=function(a,b,c,d,f){a.uniform3fv(b,f.xd)};m=!0;break;case "u_parallax_scale":n=function(a,b,c,d,f){a.uniform1f(b,f.dv)};m=!0;break;case "u_color_id":n=function(a,b,c,d,f){a.uniform3fv(b,f.Tr)};m=!0;break;case "u_line_points":n=function(a,b,c,d,f){a.uniform3fv(b,f.JK)};m=!0;break;case "u_diffuse_color_factor":n=
function(a,b,c,d,f){a.uniform1f(b,f.pn)};m=!0;break;case "u_alpha_factor":n=function(a,b,c,d,f){a.uniform1f(b,f.nm)};m=!0;break;case "u_specular_color_factor":n=function(a,b,c,d,f){a.uniform1f(b,f.uw)};m=!0;break;case "u_normal_factor":n=function(a,b,c,d,f){a.uniform1f(b,f.Iu)};m=!0;break;case "u_normalmap0_scale":n=function(a,b,c,d,f){a.uniform2fv(b,f.hg[0])};m=!0;break;case "u_normalmap1_scale":n=function(a,b,c,d,f){a.uniform2fv(b,f.hg[1])};m=!0;break;case "u_normalmap2_scale":n=function(a,b,c,
d,f){a.uniform2fv(b,f.hg[2])};m=!0;break;case "u_normalmap3_scale":n=function(a,b,c,d,f){a.uniform2fv(b,f.hg[3])};m=!0;break;case "u_foam_factor":n=function(a,b,c,d,f){a.uniform1f(b,f.Ms)};m=!0;break;case "u_foam_uv_freq":n=function(a,b,c,d,f){a.uniform2fv(b,f.Os)};m=!0;break;case "u_foam_mag":n=function(a,b,c,d,f){a.uniform2fv(b,f.Ns)};m=!0;break;case "u_foam_scale":n=function(a,b,c,d,f){a.uniform2fv(b,f.xn)};m=!0;break;case "u_water_norm_uv_velocity":n=function(a,b,c,d,f){a.uniform1f(b,f.gx)};m=
!0;break;case "u_shallow_water_col":n=function(a,b,c,d,f){a.uniform3fv(b,f.kw)};m=!0;break;case "u_shore_water_col":n=function(a,b,c,d,f){a.uniform3fv(b,f.mw)};m=!0;break;case "u_water_shallow_col_fac":n=function(a,b,c,d,f){a.uniform1f(b,f.lw)};m=!0;break;case "u_water_shore_col_fac":n=function(a,b,c,d,f){a.uniform1f(b,f.nw)};m=!0;break;case "u_p_length":n=function(a,b,c,d,f){a.uniform1f(b,f.Vu)};m=!0;break;case "u_p_cyclic":n=function(a,b,c,d,f){a.uniform1i(b,f.Ru)};m=!0;break;case "u_p_max_lifetime":n=
function(a,b,c,d,f){a.uniform1f(b,f.Xu)};m=!0;break;case "u_p_fade_in":n=function(a,b,c,d,f){a.uniform1f(b,f.Su)};m=!0;break;case "u_p_fade_out":n=function(a,b,c,d,f){a.uniform1f(b,f.Tu)};m=!0;break;case "u_p_size":n=function(a,b,c,d,f){a.uniform1f(b,f.Co)};m=!0;break;case "u_p_alpha_start":n=function(a,b,c,d,f){a.uniform1f(b,f.Ou)};m=!0;break;case "u_p_alpha_end":n=function(a,b,c,d,f){a.uniform1f(b,f.Nu)};m=!0;break;case "u_p_nfactor":n=function(a,b,c,d,f){a.uniform1f(b,f.Bo)};m=!0;break;case "u_p_gravity":n=
function(a,b,c,d,f){a.uniform1f(b,f.Uu)};m=!0;break;case "u_p_mass":n=function(a,b,c,d,f){a.uniform1f(b,f.Wu)};m=!0;break;case "u_p_size_ramp":n=function(a,b,c,d,f){a.uniform2fv(b,f.Yu)};m=!0;break;case "u_p_color_ramp":n=function(a,b,c,d,f){a.uniform4fv(b,f.Pu)};m=!0;break;case "u_p_wind":n=function(a,b,c,d,f){a.uniform3fv(b,f.ql)};m=!0;break;case "u_texel_size":n=function(a,b,c,d,f){a.uniform2fv(b,f.yp)};m=!0;break;case "u_p_time":n=function(a,b,c,d,f){a.uniform1f(b,f.od.O.time)};m=!0;break;case "u_va_frame_factor":n=
function(a,b,c,d){a.uniform1f(b,d.$w)};m=!0;break;case "u_normal_offset":n=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":n=function(a,b,c,d,f,h){a.uniform4fv(b,h.vl)};break;case "u_v_light_matrix":n=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Zw)};m=!0;break;case "u_b_light_matrix":n=function(a,b,c){a.uniformMatrix4fv(b,!1,c.nr)};break;case "u_p_light_matrix0":n=function(a,b,c){a.uniformMatrix4fv(b,!1,c.qg[0])};m=!0;break;case "u_p_light_matrix1":n=function(a,
b,c){a.uniformMatrix4fv(b,!1,c.qg[1])};m=!0;break;case "u_p_light_matrix2":n=function(a,b,c){a.uniformMatrix4fv(b,!1,c.qg[2])};m=!0;break;case "u_p_light_matrix3":n=function(a,b,c){a.uniformMatrix4fv(b,!1,c.qg[3])};m=!0;break;case "u_motion_blur_exp":n=function(a,b,c){a.uniform1f(b,c.Eu)};m=!0;break;case "u_refl_plane":n=function(a,b,c){a.uniform4fv(b,c.Jb)};break;case "u_radial_blur_step":n=function(a,b,c){a.uniform1f(b,c.zl)};break;case "u_god_rays_intensity":n=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};
break;case "u_ssao_radius_increase":n=function(a,b,c){a.uniform1f(b,c.Hh)};break;case "u_ssao_blur_discard_value":n=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};m=!0;break;case "u_ssao_influence":n=function(a,b,c){a.uniform1f(b,c.Gh)};break;case "u_ssao_dist_factor":n=function(a,b,c){a.uniform1f(b,c.Fh)};break;case "u_dof_dist":n=function(a,b,c,d,f,h){a.uniform1f(b,h.dof_distance)};m=!0;break;case "u_dof_front":n=function(a,b,c,d,f,h){a.uniform1f(b,h.dof_front)};m=!0;break;case "u_dof_rear":n=
function(a,b,c,d,f,h){a.uniform1f(b,h.dof_rear)};m=!0;break;case "u_glow_intensity":n=function(a,b,c,d,f){a.uniform1f(b,f.gh)};m=!0;break;case "u_glow_color":n=function(a,b,c){a.uniform3fv(b,c.Ji)};break;case "u_draw_glow":n=function(a,b,c){a.uniform1f(b,c.rn)};m=!0;break;case "u_brightness":n=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":n=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":n=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":n=
function(a,b,c){a.uniform1f(b,c.saturation)};break;default:n=null}n&&(n={name:k,Bn:n,dg:b[k]},m?c.push(n):(d.push(n),g[k]=n))}a.Ow=c;a.aj=d;a.Eo=g}var n=q("__config"),p=q("__debug"),k=q("__textures"),y=q("__util"),m=n.p,s=[1,1,1,1],B=[1,1,1,1],u=[0,0,0,1],H=[0,0,0,0];new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var A=null,x=new Uint8Array(4);a.xc=function(a){var b=m.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);
a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);A=a};a.ui=function(a){if(a.Y){var k=a.j;A.bindFramebuffer(A.FRAMEBUFFER,k.Ie);if(a.xm){var h=k.Db;A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,h.Rb,h.Ua,0)}A.viewport(0,0,k.width,k.height);d(a);a.Da?A.enable(A.BLEND):A.disable(A.BLEND);a.Ob?A.enable(A.DEPTH_TEST):A.disable(A.DEPTH_TEST);if(a.Ha){for(var k=a.j,h=a.o,n=0;n<h.length;n++){var s=
h[n],u=s.n,r=u.gc;A.useProgram(r.fj);s=s.nb;r.aj.length||c(r);for(var r=r.aj,v=r.length;v--;){var B=r[v];B.Bn(A,B.dg,a,s,u,k)}}a.Ha=!1}switch(a.type){case "SHADOW_CAST":A.enable(A.POLYGON_OFFSET_FILL);A.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);A.cullFace(A.BACK);break;case "MAIN_REFLECT":A.disable(A.POLYGON_OFFSET_FILL);A.cullFace(A.FRONT);break;default:A.disable(A.POLYGON_OFFSET_FILL),A.cullFace(A.BACK)}k=a.j;h=a.o;for(n=0;n<h.length;n++)if(r=h[n],r.Y){var u=a,s=k,
v=r.nb,e=r.n,B=e.gc;A.useProgram(B.fj);for(var r=e.Gc,t=e.ir,l=B.Ow,y=l.length;y--;){var q=l[y];q.Bn(A,q.dg,u,v,e,s)}s=e.Ur;A.colorMask(s,s,s,s);A.depthMask(e.Z);e.wa?A.enable(A.CULL_FACE):A.disable(A.CULL_FACE);s=e.aa;for(e=0;e<s.length;e++)l=s[e],A.activeTexture(A.TEXTURE0+e),A.bindTexture(l.Rb,l.Ua);if("SKY"==u.type){s=u;B=B.vj;e=s.j.Db.Ua;l=s.ns;for(y=0;6>y;y++){q=g(y);if(m.Pr){var C=new Uint8Array([91.8,142.8,.96*255,255]);A.bindTexture(A.TEXTURE_CUBE_MAP,e);A.texImage2D(q,0,A.RGBA,1,1,0,A.RGBA,
A.UNSIGNED_BYTE,C)}else A.uniformMatrix4fv(B.u_cube_view_matrix,!1,l[y]),A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,q,e,0),b(r,t,v.Np);if(s.ll&&3!=y){var q=s,C=y,H=x;A.readPixels(191,191,1,1,A.RGBA,A.UNSIGNED_BYTE,H);255!=H[0]&&255!=H[1]&&255!=H[2]||A.readPixels(191,220,1,1,A.RGBA,A.UNSIGNED_BYTE,H);var M=H[0],P=H[1],H=H[2],M=M/255,P=P/255,H=H/255;2===C?(q.oc[3]=M,q.oc[7]=P,q.oc[11]=H):2>C?(q.oc[4*C]=M,q.oc[4*C+1]=P,q.oc[4*C+2]=H):(q.oc[4*(C-2)]=M,q.oc[4*(C-2)+1]=P,q.oc[4*(C-2)+2]=H)}}u.ri+=
6}else b(r,t,v.Np),u.ri++}p.Tz("draw subscene: "+a.type);A.bindFramebuffer(A.FRAMEBUFFER,null)}};a.clear=function(a){A.bindFramebuffer(A.FRAMEBUFFER,a.j.Ie);d(a)};a.rz=function(a){var b=a.ir;b.length=0;var c=a.Gc;a=a.gc;c&&a||y.ma("Incomplete batch");c=c.dj;a=a.attributes;for(var d in a){var g=c[d];b.push({dg:a[d],vz:4*g.offset,wB:1<g.frames?4*g.length:0,ig:g.ig})}};a.uz=c;a.fr=function(a){var b=a.gc,c=a.aa;a=a.oe;A.useProgram(b.fj);for(var d=0;d<c.length;d++)A.uniform1i(b.vj[a[d]],d)};a.PD=function(a,
b,c){var d,g,k;d||(d=1);g||(g=1);k||(k=new Uint8Array(4*d*g));k.length!=4*d*g&&y.ma("read_pixels(): Wrong storage");A.bindFramebuffer(A.FRAMEBUFFER,a);A.readPixels(b,c,d,g,A.RGBA,A.UNSIGNED_BYTE,k);A.bindFramebuffer(A.FRAMEBUFFER,null);return k};a.BF=function(a){var b=a.gc;A.useProgram(b.fj);b.aj.length||c(b);b=b.Eo.u_cube_fog;b.Bn(A,b.dg,null,null,a,null)};a.ZD=function(a,b){var c=A.createFramebuffer();A.bindFramebuffer(A.FRAMEBUFFER,c);if(a){var d=a,g=d.Ua,d=d.Rb==A.TEXTURE_CUBE_MAP?A.TEXTURE_CUBE_MAP_NEGATIVE_Z:
d.Rb;A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,d,g,0)}k.lu(b)?A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,b.lf):k.Qi(b)&&(d=b,g=d.Ua,d=d.Rb,A.framebufferTexture2D(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,d,g,0));p.Oz();A.bindFramebuffer(A.FRAMEBUFFER,null);return c};a.YD=function(a,b,c,d,g){null==a?(A.bindFramebuffer(A.FRAMEBUFFER,a),A.viewport(0,0,d,g),A.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT)):(k.Qi(b)&&A.deleteTexture(b.Ua),k.lu(c)?A.deleteRenderbuffer(c.lf):
k.Qi(c)&&A.deleteTexture(c.Ua),A.deleteFramebuffer(a))};a.oK=function(){};a.ba=function(){}};b4w.module.__transform=function(a,q){function d(a){var f=a.d;c.EF(a,h);g.DF(a);if("CAMERA"==a.type&&(g.$z(a),f.R==g.fa)){var u=s.S(f.quat,s.jc,x);f.Pl=0<u[1]}var u=f.g,r=f.scale,v=f.quat;m.qj(u,r,v,f.qe);var B=f.N;A.identity(B);A.fromQuat(v,B);"CAMERA"!=a.type&&s.iE(B,r,B);B[12]=u[0];B[13]=u[1];B[14]=u[2];A.invert(B,f.gu);a.D&&p.Sk(a)&&p.FF(a);f.Ub&&f.Wa&&(b.Fm(f.Ub,B,f.Wa),b.Hm(f.Qc,B,f.Cb),b.Gm(f.zf,f.qe,f.Af),f.hc&&k.Wo(k.u()));switch(a.type){case "SPEAKER":y.$E(a,h);break;case "CAMERA":g.Tw(a);
k.ea()&&k.Fn(k.u())==a&&y.bD(k.u(),u,v,h);break;case "LAMP":n.HF(a);k.ea()&&k.GF(a,k.u());break;case "EMPTY":a.field&&k.Vw(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!k.ea()||(f=k.u(),k.Wo(f),k.mE(f));a=a.te;for(f=0;f<a.length;f++)d(a[f])}var b=q("__boundings"),g=q("__camera"),c=q("__constraints"),n=q("__lights"),p=q("__particles"),k=q("__scenes"),y=q("__sfx"),m=q("__tsr"),s=q("__util"),B=q("vec3"),u=q("quat"),H=q("mat3"),A=q("mat4"),x=new Float32Array(3),f=new Float32Array(4),F=new Float32Array(9),h=0;
a.Iq=0;a.Oj=1;a.update=function(a){h=a};a.Zc=function(a,b){c.Yd(a)==c.Dd?m.GE(b,c.Wd(a)):a.d.g.set(b)};a.Sc=function(a,b){c.Yd(a)==c.Dd?B.copy(m.Ht(c.Wd(a)),b):B.copy(a.d.g,b)};a.Yc=function(a,b){c.Yd(a)==c.Dd?m.cp(b,c.Wd(a)):a.d.quat.set(b)};a.Hi=function(a,b){c.Yd(a)==c.Dd?u.copy(m.xt(c.Wd(a)),b):u.copy(a.d.quat,b)};a.dp=function(a,b){if(c.Yd(a)==c.Dd){var d=s.Ge(b,f);m.cp(d,c.Wd(a))}else s.Ge(b,a.d.quat)};a.Ye=function(a,b){c.Yd(a)==c.Dd?m.Ye(b,c.Wd(a)):a.d.scale=b};a.Hk=function(a){return c.Yd(a)==
c.Dd?m.Hk(c.Wd(a)):a.d.scale};a.vC=function(a,b){if(c.Yd(a)==c.Dd)m.copy(c.Wd(a),b);else{var d=a.d;m.qj(d.g,d.scale,d.quat,b)}};a.cw=function(a,b){if(c.Yd(a)==c.Dd)m.copy(b,c.Wd(a));else{var d=a.d;d.g[0]=b[0];d.g[1]=b[1];d.g[2]=b[2];d.scale=b[3];d.quat[0]=b[4];d.quat[1]=b[5];d.quat[2]=b[6];d.quat[3]=b[7]}};a.Jn=function(a){var b=a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.Gk=function(a,b,c){c||
(c=new Float32Array(3));b?(b=a.d,B.copy(b.Cb.w,c)):(b=a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,B.transformMat4(c,b.N,c));return c};a.tc=function(a,b,c,d){a=a.d;var f=x;f[0]=b;f[1]=c;f[2]=d;b=H.fromMat4(a.N,F);B.transformMat3(f,b,f);B.add(a.g,f,a.g)};a.A=d;a.distance=function(a,b){return B.dist(a.d.g,b.d.g)};a.zD=function(a,b){return B.dist(a.d.g,b)};a.tt=function(a){return{max_x:a.d.Wa.max_x,min_x:a.d.Wa.min_x,max_y:a.d.Wa.max_y,min_y:a.d.Wa.min_y,
max_z:a.d.Wa.max_z,min_z:a.d.Wa.min_z}}};b4w.module.__loader=function(a,q){function d(c,d,h,g){var k=x,m=u.create(),n;for(n in d){var p=b(d[n]);(g&&p.mb||!c&&p.Ib)&&B(p);u.v(m,p)}for(n in d)for(p=d[n],p.name=n,c=0;c<p.G.length;c++)u.m(m,d[p.G[c]],p,null);d=b({name:"out",Ta:a.tx,Xa:function(a,b,c,d,f){0===b.id&&(k.jv=!0);3!=b.status&&(b.status=2);b.zu(b.id,!0);f(b,c);H.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},pb:5});var s=[];if(h)for(h=u.Mn(m),c=0;c<h.length;c++)s.push(u.$a(m,h[c]));else u.U(m,function(a,b){b.jb||s.push(b)});
u.v(m,d);for(c=0;c<s.length;c++)d.G.push(s[c].name),u.m(m,s[c],d,null);return m}function b(a){a.jb=a.jb||!1;a.Ta||0===a.Ta||(a.Ta=a.ed);a.G=a.G||[];a.Mi=a.Mi||!1;a.jp=a.jp||!1;a.pb=a.pb||0;a.mb=a.mb||!1;a.Ib=a.Ib||!1;a.status=0;a.NK=0;a.jo=0;a.Cf=a.Cf||null;return a}function g(a,b){for(var c=[],d=[],g=0;g<b.length;g++){var k=b[g];u.$a(a.vd,k).Mi&&(u.jf(a.vd,k,function(d){var g=!0;u.pe(a.vd,d,function(a,b){if(!b.Mi)return g=!1,1});g&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(g))}for(g=
d.length-1;0<=g;g--)b.splice(d[g],1);return c}function c(a){function b(c,d){var h=u.$a(a.vd,c),e=u.$a(a.vd,d),g=e.Ta-h.Ta;0==g&&(g=h.jb-e.jb);return g}var c=[],d=a.ne,k=!1;do{var m=g(a,d);c.push.apply(c,d);0<m.length&&(k=!0);d=m}while(0<m.length);k&&c.sort(b);a.ne=c;return a.ne.length}function n(a,b,c){if(b.jp)return b.Mi=!0,k(a,b),!1;if(!b.Xa&&!b.Ng&&!b.mi)return k(a,b),!1;if(0==b.status&&(b.status++,b.Xa))return b.Xa(c,a,b,b.Cf,k,y),!0;if(1==b.status){if(b.Ng)return b.Ng(c,a,b,b.Cf,k,y),!0;b.status++}return 2==
b.status&&(b.status++,b.mi)?(b.mi(c,a,b,b.Cf,k,y),!0):!1}function p(a){if(0==a.Nl)return 100;var b=0;u.U(a.vd,function(c,d){a.do_not_load_resources&&d.mb||(b+=d.jo*d.pb)});return A.trunc(100*b/a.Nl)}function k(a,b){b.Mi=!0;b.status=3;m(a,b,1)}function y(a,b,c){1>c?m(a,b,c):b.status++}function m(a,b,c){var d=x;if(b.Xa||b.Ng||b.mi)if(b.jo=c,b=p(a),a.ps!=b||1==c)a.rp(b,performance.now()-a.Lw),a.ps=b,d.no=!0}function s(a,b){var c=null;u.U(a.vd,function(a,d){if(d.name==b)return c=d,1});return c}function B(a){a.jp=
!0;a.jo=1}var u=q("__graph"),H=q("__print"),A=q("__util");a.ed=0;a.pf=1;a.tx=2;var x=null;a.At=function(){return x};a.AA=function(){var a={zd:[],fn:0,lm:0,jv:!1,no:!1};return x=a};a.JA=function(a,b,c,g,k,m,n,p){var s=x,e={id:s.zd.length,status:0,r:b,or:"",zu:c||function(){},yu:p||!1,GM:m,Lw:0,ps:0,Nl:0,Uo:!1,rp:g||function(){},Wr:k||function(){},vd:null,ne:null,Xn:!1,Un:!1,Zn:!1};a=d(0===e.id,a,m,n);e.vd=a;b=[];c=u.rC(a);for(g=0;g<c.length;g++)b.push(c[g]);e.ne=b;u.U(a,function(a,b){!(b.Xa||b.Ng||
b.mi)||e.do_not_load_resources&&b.mb||(e.Nl+=b.pb)});s.zd.push(e);s.lm++;return e.id};a.MF=function(b){var d=x;if(d&&0!=x.lm)if(d.no)d.no=!1;else{var h=performance.now();do{var g=d.zd[d.fn],k=b[g.id];if(3!=g.status)if(0==g.status&&(g.status=1,g.Lw=performance.now(),g.rp(0,0)),c(g)){var m=g,p=m.ne.length;do{var s=u.$a(m.vd,m.ne[0]),B=n(m,s,k);s.Ta==a.pf&&(m.Uo=!0);s=m.ne.shift();m.ne.push(s);p--}while(!B&&0!=p)}else g.Wr(k,g),g.status=3,d.lm--,m=g,m.rp=null,m.Wr=null,m.vd=null,m.ne=null;d.jv&&(d.fn=
(d.fn+1)%d.zd.length);if(g.Uo){g.Uo=!1;break}}while(16>performance.now()-h)}};a.nM=y;a.pw=function(a,b){var c=s(a,b);null!==c&&B(c)};a.uF=function(a){return a&&3==a.status};a.be=function(a){var b=x;if(!b)return!1;a|=0;return b.zd[a]&&(3==b.zd[a].status||2==b.zd[a].status)};a.ba=function(){x=null}};b4w.module.__primitives=function(a,q){function d(a,b,c,d){for(var g=[],k=[],n=[],x=[],f=2*c/(a-1),q=2*d/(b-1),h=0;h<a;h++)for(var z=-c+h*f,D=0;D<b;D++)if(k.push(z,0,-d+D*q),n.push(0,1,0),x.push(h/(a-1),D/(b-1)),h&&D){var I=h*b+D,r=I-1,v=(h-1)*b+D,E=v-1;g.push(I,r,v);g.push(r,E,v)}a=p.Qd();a.a_position=new Float32Array(k);a.a_normal=new Float32Array(n);n=p.Eb("GRID_PLANE");n.t[0]=a;n.F.a_texcoord=new Float32Array(x);n.ia=new Uint32Array(g);n.I=k.length/3;return n}function b(a){var b=a.length;if(b%
4)throw"Wrong array";for(var d=[],g=[],k=0;k<b;k+=4){var n=a[k+1],A=a[k+2],x=a[k+3];c(a[k],g);c(n,g);c(A,g);c(x,g);d.push(k,k+1,k+2);d.push(k,k+2,k+3)}a=p.Qd();a.a_position=new Float32Array(g);b=p.Eb("FROM_QUADS");b.t[0]=a;b.ia=new Uint32Array(d);b.I=g.length/3;return b}function g(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function c(a,b){b.push(a[0],a[1],a[2])}var n=q("__geometry"),p=q("__util"),k=q("__config").p;a.rJ=function(a){for(var b=p.Eb("LINE"),c=[],d=0;d<2*a;d++)c.push(d);d=p.Qd();d.a_point=
new Float32Array(c);b.t[0]=d;b.ia=new Uint32Array(c);b.I=2*a;return b};a.sJ=function(a,b){var c=d(2,2,a,b);c.name="PLANE";return c};a.qJ=d;a.LB=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==x-1)||1==b%2&&(0==a||a==A-1)?!0:!1}var g=c/=Math.pow(2,a-1),q=c,A=b+1,x=b+1;b=[];c=[];for(var f=0,F=0,h=-1,z=[],D=0;D<a;D++){for(var I=2*g/(A-1),r=2*q/(x-1),v=[],E=[],e=0,t=0;t<A;t++){for(var l=-g+t*I,N=[],J=0;J<x;J++){var C=-q+J*r;if(l>-f&&l<f&&C>-F&&C<F)N.push(-1),e++;else{for(var R=null,M=0;M<z.length;M+=
3)if(l==z[M]&&C==z[M+1]){R=z[M+2];break}M=null!==R?R:h+1;d(t,J)?(N.push(-2),e++):(null==R&&(0==J||J==x-1||0==t||t==A-1?(R=D==a-1?I:2*I,v.push(l,C,M)):R=I,c.push(l,R,C),h++),N.push(M));if(t&&J)if(1==t)if(d(t-1,J)){if(1<J){var C=M-1,R=E[t-1][J+1],P=R-1;b.push(M,C,P)}else R=E[t-1][J+1],P=R-1;b.push(M,P,R)}else d(t,J)||(C=M-1,R=E[t-1][J],b.push(M,C,R));else if(t==A-1){if(!d(t,J))if(J==x-1)C=M-1,R=E[t-1][J-1],P=E[t-2][J],b.push(M,C,R),b.push(M,R,P);else{var C=M-1,R=E[t-1][J],P=R-1,S=R+1;b.push(M,C,P);
b.push(M,P,R);b.push(M,R,S);2==J&&(S=E[t-2][J-2],b.push(C,S,P))}}else 1==J?d(t,J-1)?(C=E[t-1][J],R=E[t-1][J-1],b.push(M,R,C)):(C=N[J-1],R=E[t-1][J],P=E[t-2][J-1],b.push(M,C,R),b.push(C,P,R)):J==x-1?d(t,J)||(C=N[J-1],R=E[t-1][J-1],P=E[t-2][J],b.push(M,C,R),b.push(M,R,P)):-1!=E[t-1][J]&&-1!=E[t-1][J-1]&&-1!=N[J-1]?(C=N[J-1],R=E[t-1][J],P=E[t-1][J-1],b.push(M,C,R),b.push(C,P,R),J==x-2&&d(t,J+1)&&(S=E[t-1][J+1],b.push(M,R,S))):J==x-2&&d(t,J+1)&&(R=E[t-1][J],S=E[t-1][J+1],b.push(M,R,S))}}E.push(N)}z=v;
f=g;F=q;g*=2;q*=2}2E4>f&&(a=-(2*f)/(A-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-f,a,-F),c.push(-f,a,F),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(f,a,-F),c.push(f,a,F),M=h+1,b.push(M+3,M+2,M+1,M+2,M+0,M+1,M+6,M+4,M+2,M+4,M+0,M+2,M+5,M+7,M+1,M+7,M+3,M+1,M+5,M+4,M+7,M+7,M+4,M+6));a=p.Qd();a.a_position=new Float32Array(c);g=p.Eb("multigrid_plane");g.t[0]=a;g.ia=new Uint32Array(b);g.I=c.length/3;k.kx&&(n.vp(g,1,!0),a.a_polyindex=n.Hs(g));return g};a.pJ=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var d=[],g=[],k=0;k<b;k+=3){var n=a[k+1],A=a[k+2];c(a[k],g);c(n,g);c(A,g);d.push(k,k+1,k+2)}a=p.Qd();a.a_position=new Float32Array(g);b=p.Eb("FROM_TRIANGLES");b.t[0]=a;b.ia=new Uint32Array(d);b.I=g.length/3;return b};a.oJ=b;a.IB=function(a){a=p.ZF(a);var c=[];c.push(a[0],a[1],a[2],a[3]);c.push(a[0],a[3],a[5],a[4]);c.push(a[3],a[2],a[6],a[5]);c.push(a[1],a[7],a[6],a[2]);c.push(a[0],a[4],a[7],a[1]);c.push(a[4],a[5],a[6],a[7]);a=b(c);a.name="FRUSTUM";return a};a.JB=function(){var a=p.Eb("BILLBOARD"),
b=p.Qd();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.t[0]=b;a.ia=new Uint32Array([0,2,1,1,2,3]);a.I=4;return a};a.Qa=function(){var a=p.Eb("BILLBOARD"),b=p.Qd();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.t[0]=b;a.ia=new Uint32Array([0,2,1,0,3,2]);a.I=4;return a};a.FB=function(){var a=p.Eb("CUBEMAP_BOARD"),b=p.Qd();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.t[0]=b;a.ia=new Uint32Array([0,2,1,0,3,2]);a.I=4;return a};a.Us=function(a,b){var d=p.Eb("UV_SPHERE"),
k,u,q=[],A=[],x=[];for(u=0;8>=u;u++)for(k=0;16>=k;k++){var f=k/16,F=u/8;A.push(-a*Math.cos(2*f*Math.PI)*Math.sin(F*Math.PI)+b[0],a*Math.cos(F*Math.PI)+b[1],a*Math.sin(2*f*Math.PI)*Math.sin(F*Math.PI)+b[2])}for(u=f=0;8>u;u++)for(k=0;16>k;k++){var F=g(A,17*u+k+1),h=g(A,17*u+k),z=g(A,17*(u+1)+k),D=g(A,17*(u+1)+k+1);Math.abs(F[1])==a+b[1]?(c(F,q),c(z,q),c(D,q),x.push(f,f+1,f+2),f+=3):Math.abs(z[1])==a+b[1]?(c(F,q),c(h,q),c(z,q),x.push(f,f+1,f+2),f+=3):(c(F,q),c(h,q),c(z,q),c(D,q),x.push(f,f+1,f+2),x.push(f,
f+2,f+3),f+=4)}k={};k.a_position=q;A=n.Hz(x,A,q);k.a_normal=n.Gz(x,q,A);k.a_tangent=[];d.F.a_influence=[];d.F.a_color=[];d.F.a_texcoord=[];d.t[0]=k;d.ia=x;d.I=q.length/3;return d}};b4w.module.__reformer=function(a,q){function d(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=
.5,b("node material",a,"specular_toon_size"));"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in
a||(a.diffuse_fresnel_factor=.5,b("node material",a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name=
"B4W_"+a.node_tree_name}}}function b(a,b,c){c=c+">>"+a;c in H||(H[c]={up:[],yv:"undefined",type:a});H[c].up.push(b.name)}function g(a,b){param_id in H||(H[param_id]={up:[],yv:"deprecated",type:a});H[param_id].up.push(b.name)}function c(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var h=y.Df(a);a.materials=c;a.submeshes=d;h.name=b;h.materials=a.materials.slice(0);h.submeshes=[];for(c=0;c<d.length;c++){var g=y.ni(d[c]);h.submeshes.push(g)}return h}var n=
q("__boundings"),p=q("__curve"),k=q("__print"),y=q("__util"),m=q("vec3"),s=q("vec4"),B=q("quat"),u=q("mat4"),H={};a.Pz=function(a){H={};var c=a.worlds;if(0==c.length){k.warn("WARNING Datablock world is missing, reexport scene");var f={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},b4w_fog_color:[.5,.5,.5],b4w_fog_density:0};c.push(f)}for(var c=a.worlds,m=0;m<c.length;m++){var f=c[m],h=f.b4w_shadow_settings;
"csm_resolution"in h||(b("world",f,"b4w_shadow_settings.csm_resolution"),h.csm_resolution=2048);"self_shadow_polygon_offset"in h||(b("world",f,"b4w_shadow_settings.self_shadow_polygon_offset"),h.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in h||(b("world",f,"b4w_shadow_settings.self_shadow_normal_offset"),h.self_shadow_normal_offset=.01);"b4w_enable_csm"in h||(b("world",f,"b4w_shadow_settings.b4w_enable_csm"),h.b4w_enable_csm=!1);"csm_num"in h||(b("world",f,"b4w_shadow_settings.csm_num"),
h.csm_num=1);"csm_first_cascade_border"in h||(b("world",f,"b4w_shadow_settings.csm_first_cascade_border"),h.csm_first_cascade_border=10);"first_cascade_blur_radius"in h||(b("world",f,"b4w_shadow_settings.first_cascade_blur_radius"),h.first_cascade_blur_radius=3);"csm_last_cascade_border"in h||(b("world",f,"b4w_shadow_settings.csm_last_cascade_border"),h.csm_last_cascade_border=100);"last_cascade_blur_radius"in h||(b("world",f,"b4w_shadow_settings.last_cascade_blur_radius"),h.last_cascade_blur_radius=
1.5);"fade_last_cascade"in h||(b("world",f,"b4w_shadow_settings.fade_last_cascade"),h.fade_last_cascade=!0);"blend_between_cascades"in h||(b("world",f,"b4w_shadow_settings.blend_between_cascades"),h.blend_between_cascades=!0);h=f.b4w_ssao_settings;"dist_factor"in h||(b("world",f,"b4w_ssao_settings.dist_factor"),h.dist_factor=0,h.samples=16);"hemisphere"in h||(b("world",f,"b4w_ssao_settings.hemisphere"),h.hemisphere=!1);"blur_depth"in h||(b("world",f,"b4w_ssao_settings.blur_depth"),h.blur_depth=!1);
"blur_discard_value"in h||(b("world",f,"b4w_ssao_settings.blur_discard_value"),h.blur_discard_value=1);"b4w_glow_color"in f||(f.b4w_glow_color=[1,1,1],b("object",f,"b4w_glow_color"));"b4w_glow_factor"in f||(f.b4w_glow_factor=1,b("object",f,"b4w_glow_factor"));"b4w_fog_density"in f||(b("world",f,"b4w_fog_density"),f.b4w_fog_density=0);"b4w_sky_settings"in f&&"rayleigh_brightness"in f.b4w_sky_settings||(b("world",f,"rayleigh_brightness"),f.b4w_sky_settings={procedural_skydome:!1,use_as_enviroment_map:!1,
color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"b4w_bloom_settings"in f?("blur"in f.b4w_bloom_settings||(b("world",f,"b4w_bloom_settings.blur"),f.b4w_bloom_settings.blur=4),"edge_lum"in f.b4w_bloom_settings||(b("world",f,"b4w_bloom_settings.edge_lum"),f.b4w_bloom_settings.edge_lum=1)):(b("world",f,"b4w_bloom_settings"),f.b4w_bloom_settings=
{key:.2,blur:4});"b4w_motion_blur_settings"in f?("motion_blur_factor"in f.b4w_motion_blur_settings||(b("world",f,"b4w_motion_blur_settings.motion_blur_factor"),f.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in f.b4w_motion_blur_settings||(b("world",f,"b4w_motion_blur_settings.motion_blur_decay_threshold"),f.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(b("world",f,"b4w_motion_blur_settings"),f.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});
"b4w_color_correction_settings"in f||(b("world",f,"b4w_color_correction_settings"),f.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in f.b4w_god_rays_settings||(b("world",f,"b4w_god_rays_settings.steps_per_pass"),f.b4w_god_rays_settings.steps_per_pass=10)}c=a.scenes;for(m=0;m<c.length;m++)f=c[m],"b4w_use_nla"in f||(f.b4w_use_nla=!1,b("scene",f,"b4w_use_nla")),"fps"in f||(f.fps=24,b("scene",f,"fps")),"b4w_nla_cyclic"in f||(f.b4w_nla_cyclic=!1,b("scene",
f,"b4w_nla_cyclic")),"b4w_nla_script"in f||(f.b4w_nla_script=[],b("scene",f,"b4w_nla_script")),"b4w_detect_collisions"in f&&(g("scene",f),delete f.b4w_detect_collisions),"audio_doppler_speed"in f||(f.audio_doppler_speed=343.3),"audio_doppler_factor"in f||(f.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in f||(f.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",f,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in f||(f.b4w_enable_convolution_engine=
!1),"b4w_enable_bloom"in f||(f.b4w_enable_bloom=!1,b("scene",f,"b4w_enable_bloom")),"b4w_enable_motion_blur"in f||(f.b4w_enable_motion_blur=!1,b("scene",f,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in f||(f.b4w_enable_color_correction=!1,b("scene",f,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in f||(f.b4w_enable_antialiasing=!0,b("scene",f,"b4w_enable_antialiasing")),"b4w_tags"in f||(f.b4w_tags={title:"",description:""},b("scene",f,"b4w_tags"));f=a.meshes;for(m=0;m<f.length;m++)for(h=
f[m],h.b4w_bounding_box||(b("mesh",h,"b4w_bounding_box"),h.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0}),h.uv_textures||(b("mesh",h,"uv_textures"),h.uv_textures=[]),h.b4w_bounding_sphere_center||(h.b4w_bounding_sphere_center=[0,0,0]),h.b4w_bounding_cylinder_center||(h.b4w_bounding_cylinder_center=[0,0,0]),h.b4w_bounding_ellipsoid_center||(h.b4w_bounding_ellipsoid_center=[0,0,0]),h.b4w_bounding_ellipsoid_axes||(c=h.b4w_bounding_box,h.b4w_bounding_ellipsoid_axes=[(c.max_x-c.min_x)/
2,(c.max_y-c.min_y)/2,(c.max_z-c.min_z)/2]),c=0;c<h.b4w_vertex_anim.length;c++){var n=h.b4w_vertex_anim[c];"allow_nla"in n||(b('mesh["b4w_vertex_anim"]',h,"allow_nla"),n.allow_nla=!0)}c=a.cameras;for(m=0;m<c.length;m++)f=c[m],f.type||(f.type="PERSP",b("camera",f,"type")),"b4w_eye_target_dist"in f&&(delete f.b4w_eye_target_dist,g("camera",f)),"b4w_trans_velocity"in f||(f.b4w_trans_velocity=1,b("camera",f,"b4w_trans_velocity")),"b4w_rot_velocity"in f||(f.b4w_rot_velocity=1,b("camera",f,"b4w_rot_velocity")),
"b4w_zoom_velocity"in f||(f.b4w_zoom_velocity=.1,b("camera",f,"b4w_zoom_velocity")),"b4w_use_distance_limits"in f||(f.b4w_use_distance_limits=!1,b("camera",f,"b4w_use_distance_limits")),"b4w_distance_min"in f||(f.b4w_distance_min=1,b("camera",f,"b4w_distance_min")),"b4w_distance_max"in f||(f.b4w_distance_max=100,b("camera",f,"b4w_distance_max")),"b4w_horizontal_translation_min"in f||(f.b4w_horizontal_translation_min=-100,b("camera",f,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in
f||(f.b4w_horizontal_translation_max=100,b("camera",f,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in f||(f.b4w_vertical_translation_min=-100,b("camera",f,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in f||(f.b4w_vertical_translation_max=100,b("camera",f,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in f||(f.b4w_use_horizontal_clamping=!1,b("camera",f,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in f||(f.b4w_rotation_left_limit=-Math.PI,
b("camera",f,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in f||(f.b4w_rotation_right_limit=Math.PI,b("camera",f,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in f||(f.b4w_horizontal_clamping_type="LOCAL",b("camera",f,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in f||(f.b4w_use_vertical_clamping=!1,b("camera",f,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in f||(f.b4w_rotation_down_limit=-Math.PI/2,b("camera",f,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in
f||(f.b4w_rotation_up_limit=Math.PI/2,b("camera",f,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in f||(f.b4w_vertical_clamping_type="LOCAL",b("camera",f,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in f||(f.b4w_hover_angle_min=Math.PI/6,b("camera",f,"b4w_hover_angle_min")),"b4w_hover_angle_max"in f||(f.b4w_hover_angle_max=Math.PI/6,b("camera",f,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in f||(f.b4w_enable_hover_hor_rotation=!0,b("camera",f,"b4w_enable_hover_hor_rotation")),
"b4w_use_panning"in f||(f.b4w_use_panning=!0,b("camera",f,"b4w_use_panning"));c=a.lamps;for(m=0;m<c.length;m++)f=c[m],"b4w_generate_shadows"in f||(f.b4w_generate_shadows=!1,b("lamp",f,"b4w_generate_shadows")),"b4w_dynamic_intensity"in f||(f.b4w_dynamic_intensity=!1,b("lamp",f,"b4w_dynamic_intensity")),"use_diffuse"in f||(f.use_diffuse=!0,b("lamp",f,"use_diffuse")),"use_specular"in f||(f.use_specular=!0,b("lamp",f,"use_specular"));c=a.speakers;for(m=0;m<c.length;m++)f=c[m],"b4w_behavior"in f||(f.b4w_behavior=
f.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in f||(f.b4w_disable_doppler=!1),"b4w_delay"in f||(f.b4w_delay=0),"b4w_delay_random"in f||(f.b4w_delay_random=0),"b4w_volume_random"in f||(f.b4w_volume_random=0),"b4w_pitch_random"in f||(f.b4w_pitch_random=0),"b4w_fade_in"in f||(f.b4w_fade_in=0),"b4w_fade_out"in f||(f.b4w_fade_out=0),"b4w_loop"in f||(f.b4w_loop=!1),"b4w_loop_count"in f||(f.b4w_loop_count=0),"b4w_loop_count_random"in f||(f.b4w_loop_count_random=0),"b4w_playlist_id"in
f||(f.b4w_playlist_id="");c=a.textures;for(m=0;m<c.length;m++)f=c[m],"b4w_anisotropic_filtering"in f||(f.b4w_anisotropic_filtering="OFF",b("texture",f,"b4w_anisotropic_filtering")),"b4w_water_foam"in f||(f.b4w_water_foam=!1,b("texture",f,"b4w_water_foam")),"b4w_foam_uv_freq"in f||(f.b4w_foam_uv_freq=[1,1],b("texture",f,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in f||(f.b4w_foam_uv_magnitude=[1,1],b("texture",f,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in f||(f.b4w_parallax_steps=5,b("material",
f,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in f||(f.b4w_parallax_lod_dist=10,b("material",f,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in f||(f.b4w_shore_dist_map=!1,b("texture",f,"b4w_shore_dist_map")),"b4w_shore_boundings"in f||(f.b4w_shore_boundings=new Float32Array(4),f.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",f,"b4w_shore_boundings")),"b4w_max_shore_dist"in f||(f.b4w_max_shore_dist=100,b("texture",f,"b4w_max_shore_dist")),"b4w_disable_compression"in f||(f.b4w_disable_compression=
!1,b("texture",f,"b4w_disable_compression")),"b4w_source_type"in f||(f.b4w_source_type="",b("texture",f,"b4w_source_type")),"b4w_source_id"in f||(f.b4w_source_id="",b("texture",f,"b4w_source_id")),"b4w_source_size"in f||(f.b4w_source_size=1024,b("texture",f,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in f||(f.b4w_enable_canvas_mipmapping=!0,b("texture",f,"b4w_enable_canvas_mipmapping"));f=a.materials;for(m=0;m<f.length;m++){h=f[m];"b4w_node_mat_type"in h&&g("material",h);"b4w_skydome"in h&&
g("material",h);"b4w_procedural_skydome"in h&&g("material",h);h.b4w_water&&("b4w_water_shore_smoothing"in h||(h.b4w_water_shore_smoothing=!1,b("material",h,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in h||(h.b4w_water_dynamic=!1,b("material",h,"b4w_water_dynamic")),"b4w_waves_height"in h||(h.b4w_waves_height=1,b("material",h,"b4w_waves_height")),"b4w_waves_length"in h||(h.b4w_waves_length=1,b("material",h,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in h||(h.b4w_water_dst_noise_scale0=.05,
b("material",h,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in h||(h.b4w_water_dst_noise_scale1=.03,b("material",h,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in h||(h.b4w_water_dst_noise_freq0=1.3,b("material",h,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in h||(h.b4w_water_dst_noise_freq1=1,b("material",h,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in h||(h.b4w_water_dir_min_shore_fac=.4,b("material",h,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in
h||(h.b4w_water_dir_freq=.5,b("material",h,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in h||(h.b4w_water_dir_noise_scale=.05,b("material",h,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in h||(h.b4w_water_dir_noise_freq=.07,b("material",h,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in h||(h.b4w_water_dir_min_noise_fac=.5,b("material",h,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in h||(h.b4w_water_dst_min_fac=.2,b("material",h,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in
h||(h.b4w_water_waves_hor_fac=5,b("material",h,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in h||(h.b4w_water_absorb_factor=6,b("material",h,"b4w_water_absorb_factor")),"b4w_water_fog_color"in h||(h.b4w_water_fog_color=new Float32Array(3),h.b4w_water_fog_color=[.5,.7,.7],b("material",h,"b4w_water_fog_color")),"b4w_foam_factor"in h||(h.b4w_foam_factor=5,b("material",h,"b4w_foam_factor")),"b4w_generated_mesh"in h||(h.b4w_generated_mesh=!1,b("material",h,"b4w_generated_mesh")),"b4w_water_num_cascads"in
h||(h.b4w_water_num_cascads=5,b("material",h,"b4w_water_num_cascads")),"b4w_water_subdivs"in h||(h.b4w_water_subdivs=64,b("material",h,"b4w_water_subdivs")),"b4w_water_detailed_dist"in h||(h.b4w_water_detailed_dist=1E3,b("material",h,"b4w_water_detailed_dist")));"b4w_dynamic_grass_size"in h||(h.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in h||(h.b4w_dynamic_grass_color="");"diffuse_intensity"in h||(h.diffuse_intensity=1,b("material",h,"diffuse_intensity"));"b4w_use_ghost"in h||(h.b4w_use_ghost=
!1);"b4w_collision_group"in h||(h.b4w_collision_group=128,b("material",h,"b4w_collision_group"));"b4w_collision_mask"in h||(h.b4w_collision_mask=127,b("material",h,"b4w_collision_mask"));"b4w_do_not_render"in h||(h.b4w_do_not_render=!1,b("material",h,"b4w_do_not_render"));"HALO"!=h.type||"b4w_halo_sky_stars"in h||(h.b4w_halo_sky_stars=!1,b("material",h,"b4w_halo_sky_stars"));"HALO"!=h.type||"b4w_halo_stars_blend_height"in h||(h.b4w_halo_stars_blend_height=10,b("material",h,"b4w_halo_stars_blend_height"));
"HALO"!=h.type||"b4w_halo_stars_min_height"in h||(h.b4w_halo_stars_min_height=0,b("material",h,"b4w_halo_stars_min_height"));"specular_shader"in h||(h.specular_shader="COOKTORR",b("material",h,"specular_shader"));"diffuse_shader"in h||(h.diffuse_shader="LAMBERT",b("material",h,"diffuse_shader"));"roughness"in h||(h.roughness=.5,b("material",h,"roughness"));"diffuse_fresnel"in h||(h.diffuse_fresnel=.1,b("material",h,"diffuse_fresnel"));"diffuse_fresnel_factor"in h||(h.diffuse_fresnel_factor=.5,b("material",
h,"diffuse_fresnel_factor"));"specular_slope"in h||(h.specular_slope=.2,b("material",h,"specular_slope"));"specular_toon_size"in h||(h.specular_toon_size=.5,b("material",h,"specular_toon_size"));"specular_toon_smooth"in h||(h.specular_toon_smooth=.1,b("material",h,"specular_toon_smooth"));"specular_alpha"in h||(h.specular_alpha=1,b("material",h,"specular_alpha"));"b4w_wettable"in h||(h.b4w_wettable=!1,b("material",h,"b4w_wettable"));"b4w_refractive"in h||(h.b4w_refractive=!1,b("material",h,"b4w_refractive"));
"b4w_refr_bump"in h||(h.b4w_refr_bump=0,b("material",h,"b4w_refr_bump"));"b4w_shallow_water_col"in h||(h.b4w_shallow_water_col=[0,.8,.3],b("material",h,"b4w_shallow_water_col"));"b4w_shore_water_col"in h||(h.b4w_shore_water_col=[0,.9,.2],b("material",h,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in h||(h.b4w_shallow_water_col_fac=1,b("material",h,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in h||(h.b4w_shore_water_col_fac=.5,b("material",h,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in
h||(h.b4w_water_sss_strength=5.9,b("material",h,"b4w_water_sss_strength"));"b4w_water_sss_width"in h||(h.b4w_water_sss_width=.45,b("material",h,"b4w_water_sss_width"));"b4w_render_above_all"in h||(h.b4w_render_above_all=!1,b("material",h,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in h||(h.b4w_water_norm_uv_velocity=.05,b("material",h,"b4w_water_norm_uv_velocity"));n=h.texture_slots;for(c=0;c<n.length;c++){var p=n[c];"blend_type"in p||(p.blend_type="MIX",b("texture_slot",p,"blend_type"))}if(h.node_tree)for(h=
h.node_tree.nodes,c=0;c<h.length;c++)d(h[c])}f=a.node_groups;for(m=0;m<f.length;m++)for(h=f[m].node_tree.nodes,c=0;c<h.length;c++)d(h[c]);f=a.objects;for(m=0;m<f.length;m++){h=f[m];switch(h.type){case "MESH":"b4w_dynamic_geometry"in h||(h.b4w_dynamic_geometry=!1);"b4w_reflexible"in h||(h.b4w_reflexible=!1);"b4w_reflexible_only"in h||(h.b4w_reflexible_only=!1);"b4w_reflective"in h||(h.b4w_reflective=!1);"b4w_wind_bending"in h||(h.b4w_wind_bending=!1,b("object",h,"b4w_wind_bending"));"b4w_wind_bending_angle"in
h||(h.b4w_wind_bending_angle=10,h.b4w_wind_bending_freq=.25,b("object",h,"wind bending params"));"b4w_detail_bending_amp"in h||(h.b4w_detail_bending_amp=.1,h.b4w_branch_bending_amp=.3,b("object",h,"detail bending params"));"b4w_detail_bending_freq"in h||(h.b4w_detail_bending_freq=1,b("object",h,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in h||(h.b4w_main_bend_stiffness_col="",b("object",h,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in h||(h.b4w_detail_bend_colors={leaves_stiffness_col:"",
leaves_phase_col:"",overall_stiffness_col:""},b("object",h,"b4w_detail_bend_colors"));"b4w_caustics"in h||(h.b4w_caustics=!1);"vertex_groups"in h&&h.vertex_groups.length&&h.data&&0==h.data.vertex_groups.length&&(h.data.vertex_groups=h.vertex_groups,delete h.vertex_groups,b("object",h,"vertex_groups"));"b4w_vertex_anim"in h&&h.b4w_vertex_anim.length&&h.data&&0==h.data.b4w_vertex_anim.length&&(h.data.b4w_vertex_anim=h.b4w_vertex_anim,delete h.b4w_vertex_anim,b("object",h,"b4w_vertex_anim"));"b4w_do_not_render"in
h||(h.b4w_do_not_render=!1);"use_ghost"in h.game||(h.game.use_ghost=!1);"use_sleep"in h.game||(h.game.use_sleep=!1);"velocity_min"in h.game||(h.game.velocity_min=0);"velocity_max"in h.game||(h.game.velocity_max=0);"collision_group"in h.game||(h.game.collision_group=1);"collision_mask"in h.game||(h.game.collision_mask=255);"b4w_vehicle_settings"in h?h.b4w_vehicle_settings&&("steering_ratio"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.steering_ratio=10),"steering_max"in h.b4w_vehicle_settings||
(h.b4w_vehicle_settings.steering_max=1),"inverse_control"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.inverse_control=!1),"force_max"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.force_max=1500),"brake_max"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.brake_max=100),"speed_ratio"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in h.b4w_vehicle_settings||
(h.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.roll_influence=
.1),"max_suspension_travel_cm"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.floating_factor=3),"floating_factor"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in h.b4w_vehicle_settings||(h.b4w_vehicle_settings.water_rot_damp=.9)):(h.b4w_vehicle_settings=null,b("object",h,"b4w_vehicle_settings"));
"b4w_floating_settings"in h?h.b4w_floating_settings&&("floating_factor"in h.b4w_floating_settings||(h.b4w_floating_settings.floating_factor=3),"water_lin_damp"in h.b4w_floating_settings||(h.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in h.b4w_floating_settings||(h.b4w_floating_settings.water_rot_damp=.8)):(h.b4w_floating_settings=null,b("object",h,"b4w_floating_settings"));"b4w_character_settings"in h?h.b4w_character_settings&&("walk_speed"in h.b4w_character_settings||(h.b4w_character_settings.walk_speed=
4),"run_speed"in h.b4w_character_settings||(h.b4w_character_settings.run_speed=8),"step_height"in h.b4w_character_settings||(h.b4w_character_settings.step_height=.25),"jump_strength"in h.b4w_character_settings||(h.b4w_character_settings.jump_strength=5),"waterline"in h.b4w_character_settings||(h.b4w_character_settings.waterline=0)):(h.b4w_character_settings=null,b("object",h,"b4w_character_settings"));"b4w_selectable"in h||(h.b4w_selectable=!1,b("object",h,"b4w_selectable"));"b4w_billboard"in h||
(h.b4w_billboard=!1,b("object",h,"b4w_billboard"));"b4w_billboard_geometry"in h||(h.b4w_billboard_geometry="SPHERICAL",b("object",h,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in h||(h.b4w_pres_glob_orientation=!1,b("object",h,"b4w_pres_glob_orientation"));"b4w_glow_settings"in h||(h.b4w_glow_settings={},h.b4w_glow_settings.glow_duration=1,h.b4w_glow_settings.glow_period=1,h.b4w_glow_settings.glow_relapses=0,b("object",h,"b4w_glow_settings"));"b4w_lod_transition"in h||(h.b4w_lod_transition=
.01,b("object",h,"b4w_lod_transition"));"lod_levels"in h||(h.lod_levels=[],b("object",h,"lod_levels"));"b4w_animation_mixing"in h||(h.b4w_animation_mixing=!1,b("object",h,"b4w_animation_mixing"));break;case "EMPTY":"b4w_group_relative"in h||(h.b4w_group_relative=!1,b("object",h,"b4w_group_relative"))}"b4w_anim_behavior"in h||(h.b4w_anim_behavior=h.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",h,"b4w_anim_behavior"));if(!("rotation_quaternion"in h)){c=[0,0,0,1];y.Ge(h.rotation_euler,c);var n=
c,p=c[0],s=c[1],r=c[2];n[0]=c[3];n[1]=p;n[2]=s;n[3]=r;h.rotation_quaternion=c;b("object",h,"rotation_quaternion")}"webgl_do_not_batch"in h&&(h.b4w_do_not_batch=h.webgl_do_not_batch)&&g("object",h);"b4w_shadow_cast_only"in h||(h.b4w_shadow_cast_only=!1,b("object",h,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in h||(h.b4w_correct_bounding_offset="AUTO",b("object",h,"b4w_correct_bounding_offset"));n=h.particle_systems;for(c=0;c<n.length;c++)p=n[c],s=p.settings,"use_whole_group"in s||(s.use_whole_group=
!1,b("object",s,"use_whole_group")),p.transforms||(p.transforms=new Float32Array,b("particle_system",p,"transforms")),"b4w_billboard_align"in s||(s.b4w_billboard_align="VIEW",b("particle_settings",s,"b4w_billboard_align")),"b4w_dynamic_grass"in s||(s.b4w_dynamic_grass=!1,b("object",s,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in s||(s.b4w_dynamic_grass_scale_threshold=.01,b("object",s,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in s||(s.b4w_initial_rand_rotation=
!1,b("particle_settings",s,"b4w_initial_rand_rotation")),"b4w_rotation_type"in s||(s.b4w_rotation_type="Z",b("particle_settings",s,"b4w_rotation_type")),"b4w_rand_rotation_strength"in s||(s.b4w_rand_rotation_strength=1,b("particle_settings",s,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in s||(s.b4w_hair_billboard=!1,b("particle_settings",s,"b4w_hair_billboard")),"b4w_hair_billboard_type"in s||(s.b4w_hair_billboard_type="BASIC",b("particle_settings",s,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in
s||(s.b4w_hair_billboard_jitter_amp=0,b("particle_settings",s,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in s||(s.b4w_hair_billboard_jitter_freq=0,b("particle_settings",s,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in s||(s.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",s,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in s||(s.b4w_wind_bend_inheritance="PARENT",b("particle_settings",s,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in
s||(s.b4w_shadow_inheritance="PARENT",b("particle_settings",s,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in s||(s.b4w_reflection_inheritance="PARENT",b("particle_settings",s,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in s||(s.b4w_vcol_from_name="",b("particle_settings",s,"b4w_vcol_from_name")),"b4w_vcol_to_name"in s||(s.b4w_vcol_to_name="",b("particle_settings",s,"b4w_vcol_to_name")),"b4w_coordinate_system"in s||(s.b4w_coordinate_system="LOCAL",b("particle_settings",s,"b4w_coordinate_system")),
"b4w_allow_nla"in s||(s.b4w_allow_nla=!0,b("particle_settings",s,"b4w_allow_nla"));"constraints"in h||(h.constraints=[],b("object",h,"constraints"));n=h.modifiers;for(c=0;c<n.length;c++){a:{p=n[c];switch(p.type){case "ARRAY":if(!("fit_type"in p)){k.error("WARNING Incomplete modifier "+String(p.type)+' for "'+h.name+'", reexport '+(h.library?"library"+h.library.split("/").slice(-1)[0]:"main scene"));p=!1;break a}}p=!0}p||(n.splice(c,1),c--)}"animation_data"in h||(h.animation_data={action:null,nla_tracks:[]},
b("object",h,"animation_data"));if(h.animation_data)for(("action"in h.animation_data)||(h.animation_data.action=null,k.warn("B4W Warning: no action in animation data "+h.name)),("nla_tracks"in h.animation_data)||(h.animation_data.nla_tracks=[],k.warn("B4W Warning: no NLA in animation data "+h.name)),n=h.animation_data.nla_tracks,c=0;c<n.length;c++)for(p=n[c],s=0;s<p.strips.length;s++)r=p.strips[s],"action"in r||(r.action=null,k.warn("B4W Warning: no action in NLA strip "+h.name)),"action_frame_start"in
r||(r.action_frame_start=0,k.warn("B4W Warning: no action_frame_start in NLA strip "+h.name)),"action_frame_end"in r||(r.action_frame_end=r.frame_end-r.frame_start,k.warn("B4W Warning: no action_frame_start in NLA strip "+h.name));"b4w_collision_id"in h||(h.b4w_collision_id="",b("material",h,"b4w_collision_id"));c=h.scale;0==c[0]&&0==c[1]&&0==c[2]?c=!0:(n=Math.abs((c[1]-c[2])/c[1]),c=.001>Math.abs((c[0]-c[1])/c[0])&&.001>n);c||k.warn("B4W Warning: non-uniform scale for object "+h.name)}for(var u in H)m=
H[u],c=u.match(/.*?(?=>>|$)/i)[0],k.warn("WARNING "+String(c)+" is "+m.yv+" for "+m.type+", reexport "+a.b4w_filepath_blend)};a.mz=function(a){var b;a:{b=a.modifiers;for(var d=0;d<b.length;d++){var g=b[d].type;if("ARRAY"==g||"CURVE"==g){b=!0;break a}}b=!1}if(!b)return null;b=c(a.data,a.data.name+"_MOD");a=a.modifiers;for(d=0;d<a.length;d++){var h=a[d];switch(h.type){case "ARRAY":for(var g=b,k=h,q=0,H=0,r=0,v=new Float32Array(16),h=[],E=1;E<k.count;E++){k.use_constant_offset&&(q+=k.constant_offset_displace[0],
H+=k.constant_offset_displace[1],r+=k.constant_offset_displace[2]);if(k.use_relative_offset)var e=g.b4w_bounding_box,q=q+(e.max_x-e.min_x)*k.relative_offset_displace[0],H=H+(e.max_y-e.min_y)*k.relative_offset_displace[1],r=r+(e.max_z-e.min_z)*k.relative_offset_displace[2];y.wF(q,H,r,v);for(var t=e=c(g),l=v,N=0;N<t.submeshes.length;N++){var J=t.submeshes[N];y.Te(J.position,l,J.position,0);y.$F(J.normal,l,J.normal);y.tF(J.tangent,l,J.tangent)}h.push(e)}for(E=0;E<h.length;E++)for(k=g,q=h[E],H=0;H<k.submeshes.length;H++){r=
k.submeshes[H];v=q.submeshes[H];e=r.base_length;t=r.indices.length;r.base_length+=v.base_length;for(var C in r)if("base_length"!=C)if("indices"==C)for(r[C]=y.zF(r[C],v[C]),l=t;l<r.indices.length;l++)r.indices[l]+=e;else r[C]=y.tB(r[C],v[C])}break;case "CURVE":for(var g=b,E=h.object.Py,k=new Float32Array(16),H=E.Me?4:3,q=new Float32Array(H),H=new Float32Array(H),r=new Float32Array(3),v=new Float32Array(4),e=new Float32Array(4),t=new Float32Array(3),l=new Float32Array(3),N=new Float32Array(3),J=new Float32Array(4),
R=new Float32Array(4),M=0;M<g.submeshes.length;M++){var P=g.submeshes[M],S=P.position,Z=P.normal,P=P.tangent,L;a:switch(L=h.deform_axis,L){case "POS_X":case "NEG_X":L=0;break a;case "POS_Y":case "NEG_Y":L=1;break a;case "POS_Z":case "NEG_Z":L=2;break a;default:throw"Wrong deform axis value "+L;}t[0]=0;t[1]=0;t[2]=0;t[L]=1;for(var X=p.eF(E),V=0;V<S.length/3;V++){N[0]=S[3*V];N[1]=S[3*V+1];N[2]=S[3*V+2];var ca=N[L],w=p.dF(E,ca);p.fF(E,w,q);r[0]=q[0];r[1]=q[1];r[2]=q[2];p.cF(E,w,H);l[0]=H[0];l[1]=0;l[2]=
H[2];m.normalize(l,l);B.rotationTo(t,l,v);0>ca?(q[0]=l[0],q[1]=l[1],q[2]=l[2],m.scale(q,ca,q),m.add(r,q,r)):ca>X&&(q[0]=l[0],q[1]=l[1],q[2]=l[2],m.scale(q,ca-X,q),m.add(r,q,r));u.fromRotationTranslation(v,r,k);E.Me&&(B.setAxisAngle(t,q[3],e),m.transformQuat(N,e,N));N[L]=0;m.transformMat4(N,k,N);S[3*V]=N[0];S[3*V+1]=N[1];S[3*V+2]=N[2];Z.length&&(J[0]=Z[3*V],J[1]=Z[3*V+1],J[2]=Z[3*V+2],J[3]=0,s.transformMat4(J,k,J),Z[3*V]=J[0],Z[3*V+1]=J[1],Z[3*V+2]=J[2]);P.length&&(R[0]=P[3*V],R[1]=P[3*V+1],R[2]=P[3*
V+2],R[3]=0,s.transformMat4(R,k,R),P[3*V]=R[0],P[3*V+1]=R[1],P[3*V+2]=R[2])}}}n.QD(b)}return b};a.GI=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,
b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,
b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.tz=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_use_nla)for(var d=d.b4w_nla_script,h=0;h<d.length;h++){var g=d[h];switch(g.type){case "SELECT":case "SELECT_PLAY":for(var k=0;k<a.length;k++){var m=a[k];m.name==g.object&&(m.b4w_selectable=!0)}break;case "SHOW":case "HIDE":for(k=0;k<a.length;k++)m=a[k],m.name==g.object&&(m.b4w_do_not_batch=
!0)}}}}};b4w.module.__scenegraph=function(a,q){function d(a){a=Ma.Ea(a);a.Ie=null;a.Db=null;a.Ic=null;return a}function b(a,b){var d=[];O.hf(a,function(b,e,f){-1<d.indexOf(f)?O.$D(a,b,e,f,c(f)):d.push(f)});O.U(a,function(e,f){for(var h=0;h<f.ja.length;h++){var g=f.ja[h];b||"MAIN_REFLECT"!=f.type||(g.zg=!0);-1<d.indexOf(g)?f.ja[h]=c(g):d.push(g)}"ANTIALIASING"==f.type&&O.pe(a,e,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.ja.length;c++){var d=b.ja[c];d.ta=ka.C;d.sa=ka.C}});b||O.pe(a,e,function(a,
b,c){"DEPTH"==c.P&&(c.zg=!0)})});O.U(a,function(b){var c={};g(a,b,c);for(var d in c){b=c[d];for(var e=b[0],f=0;f<b.length;f++)if(b[f].ta==ka.C){e=b[f];break}for(var h=b[0],f=0;f<b.length;f++)if(b[f].sa==ka.C){h=b[f];break}for(var k=b[0],f=0;f<b.length;f++)if(!b[f].zg){k=b[f];break}for(f=0;f<b.length;f++)b[f].ta=e.ta,b[f].sa=h.sa,b[f].zg=k.zg}})}function g(a,b,c){O.pe(a,b,function(b,d,e){e.Ka&&e.P==e.ka&&(c[e.P]=c[e.P]||[],-1==c[e.P].indexOf(e)&&c[e.P].push(e),g(a,b,c))});O.jf(a,b,function(a,b,d){d.Ka&&
(c[d.P]=c[d.P]||[],-1==c[d.P].indexOf(d)&&c[d.P].push(d))});b=O.$a(a,b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.ja.length;d++){var e=b.ja[d];c[e.P].push(e)}}function c(a){if(a.na)throw"Failed to clone slink with attached texture";return Ma.Df(a)}function n(a){var b=O.Ap(a),c=[];O.U(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var e=[];break;default:e=c}for(var f=0;f<d.ja.length;f++){var h=d.ja[f],g=s(e,h,k(h));h.na=g;
d.yd[f]=g}for(f=0;f<d.yd.length;f++)g=d.yd[f],m(e,g);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":e=[]}O.jf(b,a,function(c,d,f){if(!f.na){if((c=y(b,a,f.P))&&f.Ka&&!f.na){d=e;for(var h=c,g=0;g<d.length;g++){var l=d[g];l.xp===h&&l.hj++}}else c=s(e,f,k(f));f.na=c}});O.pe(b,a,function(a,b,c){m(e,c.na)});O.jf(b,a,function(a,b,c){c.na&&"NONE"==c.ka&&m(e,c.na)})})}function p(a){u(a,function(b,c,d){b.Th&&(ma(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&
"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||ma(a,d,"ANTIALIASING"))&&(b.cf*=za.resolution_factor)})}function k(a){a=Ma.Df(a);delete a.ka;delete a.Ka;delete a.na;return JSON.stringify(a)}function y(a,b,c){var d=null;O.pe(a,b,function(a,b,e){if(e.Ka&&e.P==e.ka&&e.P==c&&e.na)return d=e.na,!0});O.jf(a,b,function(a,b,e){if(e.Ka&&e.P==c&&e.na)return d=e.na,!0});return d}function m(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.xp===b&&d.hj&&d.hj--}}function s(a,b,c){for(var d=null,e=0;e<a.length;e++){var f=a[e];
if(f.id==c&&0===f.hj){d=f;break}}if(d)return d.hj++,d.xp;b=B(b);a.push({id:c,hj:1,xp:b});return b}function B(a){var b=a.cf*a.size;switch(a.P){case "COLOR":var c=ka.ok("COLOR",ka.Kg);ka.resize(c,b,b);ka.ap(c,a.ta,a.sa);return c;case "DEPTH":return a.zg?(c=ka.ok("DEPTH_RBUF",ka.Jg),ka.resize(c,b,b)):(c=ka.ok("DEPTH_TEX",ka.di),ka.resize(c,b,b),ka.ap(c,a.ta,a.sa)),c;case "CUBEMAP":return c=ka.oA(b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.P;}}function u(a,b){var c=!1;O.hf(a,function(d,
e,f){if(f&&(d=O.$a(a,d),e=O.$a(a,e),b(f,!1,d,e)))return c=!0});c||O.U(a,function(a,c){for(var d=0;d<c.ja.length;d++)if(b(c.ja[d],!0,c,null))return!0})}function H(a){O.U(a,function(b,c){if("SINK"!=c.type){var d=c.j;O.jf(a,b,function(a,b,c){c.Ka&&c.na&&(fa.Dl(d,c.P,c.na),c.P==c.ka&&b.j&&fa.Dl(b.j,c.P,c.na))});for(var e=0;e<c.ja.length;e++){var f=c.ja[e];f.Ka&&f.P==f.ka&&fa.Dl(d,f.P,c.yd[e])}!d.Db&&!d.Ic||d.Ie||(d.Ie=ua.ZD(d.Db,d.Ic))}})}function A(a){var b=null,c=0;O.U(a,function(a,d){if(d.type==ta.pF){if(c==
ta.oF)return b=d,!0;c++}});return b}function x(a,b){var c=O.qh(a,b),d=D("NONE"),e=O.v(a,d),f=O.Mn(a)[0];O.hf(a,function(b,c){c==f&&O.RD(a,b,f,b,e)});O.hf(a,function(e,f,g){if(e==c)return O.m(a,b,d,h(ta.QE,"u_color",g.size,g.cf,g.Th)),!0});O.ye(a,e,f,h("SCREEN","NONE",.5,.5,!0))}function f(a,b){var c=F("SHADOW_CAST");c.bn=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.fo){case "SPOT":case "POINT":c.j=fa.vb(fa.Dc);fa.bp(c.j,180*b.Eh/Math.PI,.1,2*b.distance);break;default:c.j=fa.vb(fa.fi)}return c}
function F(a){return{type:a,Da:!1,$u:!1,xm:!1,ll:!1,ri:0,time:0,j:null,ns:null,Jb:null,o:[],ja:[],yd:[],Bj:new Float32Array(3),nx:new Float32Array(3),$b:new Float32Array(3),Yb:new Float32Array(4),oc:new Float32Array(16),Fe:0,jg:0,jw:0,Zf:null,bg:null,Yf:null,$f:null,ag:null,Jc:new Float32Array(3),Oc:new Float32Array(3),Hw:new Float32Array([0,0,0]),Ol:new Float32Array(3),Iw:new Float32Array(4),Bh:null,Lk:0,rn:0,Ni:!1,Ji:new Float32Array(3),Fg:0,Va:null,Yl:!1,$e:new Float32Array(2),af:new Float32Array(2),
zh:0,nh:0,Km:0,$c:null,nf:0,Gg:0,mf:0,Bf:!1,xr:0,yr:new Float32Array(2),wr:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,Ah:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,Hh:0,Gh:0,Fh:0,yw:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,
mh:0,zl:0,Kh:0,bn:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,Zw:null,nr:null,qg:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,rr:0,Fs:0,hl:0,il:0,Eu:0,ej:"",ZC:new Float32Array(2),Y:!0,qc:!0,la:!0,pa:!0,Ob:!0,Ha:!0}}function h(a,b,c,d,e){return{P:a,ka:b,size:c,cf:d,Th:e,Ka:!0,na:null,zg:!1,ta:ka.Ed,sa:ka.Ed}}function z(){var a=F("GRASS_MAP");a.j=fa.vb(fa.ei);return a}function D(a){var b=F("POSTPROCESSING");b.la=!1;b.pa=!1;b.Ob=!1;b.j=fa.vb(fa.sb);b.ej=a;return b}function I(a){var b=
F("BLOOM_BLUR");b.la=!1;b.pa=!1;b.Ob=!1;b.j=fa.vb(fa.sb);b.ej=a;return b}function r(a,b,c,d,e,f,h,g,k){var l=F("MAIN_"+a);if("OPAQUE"===a)l.la=!0,l.pa=c,l.Da=!1;else if("BLEND"===a)l.la=!1,l.pa=!1,l.Da=!0;else if("XRAY"===a)l.la=!1,l.pa=!0,l.Da=!0;else if("REFLECT"===a)l.la=!0,l.pa=!0,l.Da=!1;else throw"wrong main subscene type";l.Da&&g&&(l.self_shadow_normal_offset=g.self_shadow_normal_offset);l.j=b;l.Jc.set(h.Jc);l.Oc.set(h.Oc);l.Fe=h.Fe;l.Bh=h.Bh;l.Yb=f;d&&(l.Va=d,d.Yb&&(l.$c=new Float32Array(d.Yb)),
l.nf=d.waves_height,l.Gg=d.waves_length,l.mf=d.mf,d.gk&&k&&(l.Bf=!0,l.xr=d.gk,l.yr.set(d.Mm),l.wr=d.Lm),d.Kl&&(l.Yl=!0,a=d.OE,l.$e[0]=(a[0]+a[1])/2,l.$e[1]=(a[2]+a[3])/2,l.af[0]=a[0]-a[1],l.af[1]=a[2]-a[3],l.zh=d.zh,l.nh=d.nh));l.Zf=new Float32Array(3*e);l.bg=new Float32Array(3*e);l.Yf=new Float32Array(3*e);l.$f=new Float32Array(4*e);l.ag=new Float32Array(4*e);return l}function v(a,b){var c=F("COLOR_PICKING");b&&(c.type+="_XRAY",c.la=!1,c.pa=!0);c.qc=!1;c.j=a;return c}function E(a){var b=F("WIREFRAME");
b.Y=!1;b.la=!1;b.pa=!1;b.j=a;return b}function e(a,b){var c=F("DEPTH");c.j=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function t(a){var b=F("DEPTH_PACK");b.la=!1;b.pa=!1;b.j=a;return b}function l(a,b,c){var d=F("SSAO");d.la=!1;d.pa=!1;d.Ob=!1;d.j=a;d.Yb=b;d.$c=new Float32Array(b);d.Hh=c.radius_increase;d.ssao_hemisphere=c.KC;d.Gh=c.influence;d.Fh=c.dist_factor;d.yw=c.hE;return d}function N(a,b){var c=F("SSAO_BLUR");c.la=!1;c.pa=!1;c.Ob=!1;c.ssao_blur_depth=b.Cz;c.ssao_blur_discard_value=
b.qr;c.j=a;return c}function J(){var a=F("ANTIALIASING");a.la=!1;a.pa=!1;a.Ob=!1;a.j=fa.vb(fa.sb);return a}function C(a){var b=F(a);b.la="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.pa=!1;b.Ob=!1;b.j=fa.vb(fa.sb);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.$C=new Float32Array(4));return b}function R(a,b,c,d){var e=F("COMPOSITING");e.la=!1;e.pa=!1;e.Ob=!1;e.j=fa.vb(fa.sb);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function M(a,b){var c=F("MOTION_BLUR");
c.la=!1;c.pa=!1;c.Ob=!1;c.j=fa.vb(fa.sb);c.xm=!0;c.hl=a;c.il=b;return c}function P(a){var b=F("DOF");b.la=!1;b.pa=!1;b.Ob=!1;b.j=a;return b}function S(a){var b=F("GLOW_MASK");b.j=a;b.Ob=!1;return b}function Z(a){var b=F("GLOW");b.Ji.set(a.Ji);b.Lk=a.Lk;b.Fs=5;b.rr=3;b.Ob=!1;b.j=fa.vb(fa.sb);return b}function L(){var a=F("REFRACT");a.la=!1;a.pa=!1;a.Ob=!1;a.j=fa.vb(fa.sb);return a}function X(a,b,c,d,e,f,h){var g=F("GOD_RAYS");g.la=!1;g.pa=!1;g.Ob=!1;g.Jc[0]=1;g.Jc[1]=1;g.Jc[2]=1;g.Oc[0]=1;g.Oc[1]=
1;g.Oc[2]=1;g.Fe=1;g.$u=d;g.Fg=b;g.zl=e;g.mh=c;g.Kh=h;g.j=a;g.jg=f;g.Zf=new Float32Array(3*f);g.bg=new Float32Array(3*f);g.Yf=new Float32Array(3*f);g.$f=new Float32Array(4*f);g.ag=new Float32Array(4*f);return g}function V(a,b){var c=F("GOD_RAYS_COMBINE");c.la=!1;c.pa=!1;c.Ob=!1;c.j=fa.vb(fa.sb);c.god_rays_intensity=a;c.jg=b;c.Zf=new Float32Array(3*b);c.bg=new Float32Array(3*b);c.Yf=new Float32Array(3*b);c.$f=new Float32Array(4*b);c.ag=new Float32Array(4*b);return c}function ca(a,b){var c=F("SKY");
c.qc=!1;c.la=!1;c.pa=!1;c.Ob=!1;var d=fa.vb(fa.sb);d.width=Xa.qk;d.height=Xa.qk;c.j=d;c.ns=Ma.GB();c.jg=a;c.Zf=new Float32Array(3*a);c.bg=new Float32Array(3*a);c.Yf=new Float32Array(3*a);c.$f=new Float32Array(4*a);c.ag=new Float32Array(4*a);c.Jc[0]=1;c.Jc[1]=1;c.Jc[2]=1;c.Oc[0]=1;c.Oc[1]=1;c.Oc[2]=1;c.Fe=1;c.Ah.set(b.Ah);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;
c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function w(){var a=F("COPY");a.la=!1;a.pa=!1;a.j=fa.vb(fa.sb);return a}function ea(){var a=F("ANAGLYPH");a.la=!1;a.pa=!1;a.j=fa.vb(fa.sb);return a}function ha(){var a=F("LUMINANCE");a.la=!1;a.pa=!1;a.j=fa.vb(fa.sb);
return a}function ba(){var a=F("AVERAGE_LUMINANCE");a.la=!1;a.pa=!1;a.j=fa.vb(fa.sb);return a}function Q(a,b,c,d){var e=F("LUMINANCE_TRUNCED");e.la=!1;e.pa=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.j=d;e.Zf=new Float32Array(3*c);e.bg=new Float32Array(3*c);e.Yf=new Float32Array(3*c);e.$f=new Float32Array(4*c);e.ag=new Float32Array(4*c);return e}function T(a){var b=F("BLOOM");b.la=!1;b.pa=!1;b.j=fa.vb(fa.sb);b.bloom_blur=a;return b}function pa(){var a=F("SINK");a.qc=!1;return a}function ma(a,b,c){if(b.type===
c)return!0;b=qa(a,b);for(var d=0;d<b.length;d++)if(ma(a,b[d],c))return!0;return!1}function U(a,b,c){if(b.type===c)return!0;b=K(a,b);for(var d=0;d<b.length;d++)if(U(a,b[d],c))return!0;return!1}function Y(a,b,c){if(b.type===c)return b;b=K(a,b);for(var d=0;d<b.length;d++){var e=Y(a,b[d],c);if(e)return e}return null}function K(a,b){var c=O.qh(a,b);if(c==O.qq)throw"Subscene not in graph";for(var d=[],e=O.cu(a,c),f=0;f<e;f++){var h=O.Ek(a,c,f);h!=c&&d.push(O.$a(a,h))}return d}function qa(a,b){var c=O.qh(a,
b);if(c==O.qq)throw"Subscene not in graph";for(var d=[],e=O.rh(a,c),f=0;f<e;f++){var h=O.eh(a,c,f);h!=c&&d.push(O.$a(a,h))}return d}function oa(a){var b=[],c=[];u(a,function(a){a.na&&-1==b.indexOf(a.na)&&(b.push(a.na),c.push(a.na,b.length-1))});return c}function ja(a,b){var c;c=""+(a.P+"\\n");c+="NONE"!=a.ka?a.ka+"\\n":"";c+="(";if(a.Th){var d=a.cf;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.P){c+=" ";if(a.zg)c+="RR";else{var d=a.ta,e=a.sa,
f="";d==ka.C?f+="L":d==ka.Ed&&(f+="N");e==ka.C?f+="L":e==ka.Ed&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.na&&(c+=" "+b[d+1])}return c+")\\n"}var fa=q("__camera"),aa=q("__config"),ia=q("__debug"),O=q("__graph"),ua=q("__renderer"),ka=q("__textures"),Ma=q("__util");q("vec4");var ta=aa.kn,za=aa.p,Xa=aa.oj;a.Xz=function(a){switch(a.ka){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;default:return!0}};a.yF=u;a.yA=function(a,c,g){function k(b,e){var f=d(Da[e]);
c.M.push(f);f=r(b,f,!1,oa,ja,Kb,Fb,Sa,a.Mh);u.push(f);O.v(m,f);O.m(m,s[e],f,q[e]);O.m(m,s[e],f,y[e]);Fa&&(O.m(m,Fa,f,wb),O.m(m,Fa,f,xb));if(Va){for(var g=0;g<aa.length;g++)O.m(m,aa[g],f,qa[g]);g=B[e];if("DEPTH_PACK"==g.type){var l=h("COLOR","u_scene_depth",1,1,!0);l.ta=ka.Ed;l.sa=ka.Ed}else l=h("DEPTH","u_scene_depth",1,1,!0),l.ta=ka.C,l.sa=ka.C;O.m(m,g,f,l)}F.length&&(O.m(m,F[e],f,K[e]),f.Jb=xa[0]);U.length&&O.m(m,U[e],f,Y[e]);return f}var m=O.create(),s=[],u=[],B=[],q=[],y=[],F=[],K=[],U=[],Y=[],
aa=[],qa=[],ja=a.qu,oa=a.Va,ma=a.To,bc=a.ef,nc=a.hh,ib=a.jD,xa=a.SD,ya=a.Mg,zb=a.oh,Ub=a.Rg,Ab=a.antialiasing,Fb=a.hG,Kb=a.Yb,Sa=a.sd,Sb=a.nD,Wa=a.Bz,Ja=a.Mz,yb=a.EC,Pb=a.BC,pb=a.Yg,Va=a.VA,Ya=Boolean(g.length),Da=[];if(a.anaglyph_use&&!Ya){var nb=c.M[0],ua=d(nb);fa.Bu(nb,fa.Nb);fa.Bu(ua,fa.Sb);Da.push(nb,ua);c.M.push(ua)}else{var va=c.M[0];Da.push(va)}if(ma){fa.Lp(Da[0],Sa);for(var tb=Sa.csm_num,da=0;da<tb;da++){var Gb=f(da,Sa);O.v(m,Gb);aa.push(Gb);var Ba=Sa.csm_resolution,va=Gb.j;va.width=Ba;va.height=
Ba;Gb.la=!1;qa.push(h("DEPTH","u_shadow_map"+da,Ba,1,!1));(ia.Cr()||za.Ls)&&Gb.ja.push(h("COLOR","COLOR",Ba,1,!1))}}if(0<xa.length&&!Ya)for(da=0;da<Da.length;da++){va=d(Da[da]);c.M.push(va);var Ea=r("REFLECT",va,!1,oa,ja,Kb,Fb,null,a.Mh);Ea.Jb=xa[0];Ea.j.Jb=xa[0];O.v(m,Ea);F.push(Ea);K.push(h("COLOR","u_reflectmap",1,za.ij,!0));Ea.ja.push(h("DEPTH","DEPTH",1,za.ij,!0))}s=[];u=[];if(a.La){var Fa=z();O.v(m,Fa);Ba=Xa.Nk;Fa.j.width=Ba;Fa.j.height=Ba;var wb=h("DEPTH","u_grass_map_depth",Ba,1,!1);wb.ta=
ka.C;wb.sa=ka.C;var xb=h("COLOR","u_grass_map_color",Ba,1,!1);xb.ta=ka.C;xb.sa=ka.C}else xb=wb=Fa=null;for(da=0;da<Da.length;da++){var va=Da[da],Ra={};y.push(h("DEPTH","DEPTH",1,1,!0));if(Va){var Hb=d(va);c.M.push(Hb);if(ma){Ra=e(Hb,Sa);O.v(m,Ra);for(var jb=0;jb<aa.length;jb++)Gb=aa[jb],O.m(m,Gb,Ra,qa[jb]);var Ib=h("COLOR","u_color",1,1,!0),$b=h("DEPTH","u_depth",1,1,!0);if(bc){var xc=d(va);c.M.push(xc);var Nb=a.hF,Eb=l(xc,Kb,Nb);O.v(m,Eb);var jc=h("COLOR","u_ssao_mask",1,1,!0);O.m(m,Ra,Eb,Ib);O.m(m,
Ra,Eb,$b);var kc=d(va);c.M.push(kc);var Ua=N(kc,Nb);O.v(m,Ua);var lc=h("COLOR","u_shadow_mask",1,1,!0);O.m(m,Eb,Ua,jc);O.m(m,Ra,Ua,$b)}var Ob=d(Hb);c.M.push(Ob);var bb=t(Ob)}else Ra=e(Hb,Sa),O.v(m,Ra),ia.Cr()&&Ra.ja.push(h("COLOR","COLOR",1,1,!0)),Ob=d(Hb),c.M.push(Ob),bb=t(Ob);O.v(m,bb);O.m(m,Ra,bb,h("DEPTH","u_depth",1,1,!0));B.push(bb);Fa&&(O.m(m,Fa,Ra,wb),O.m(m,Fa,Ra,xb))}Ea=r("OPAQUE",va,!Va,oa,ja,Kb,Fb,null,a.Mh);O.v(m,Ea);u.push(Ea);Va&&(O.m(m,Ra,Ea,y[da]),jc?O.m(m,Ua,Ea,lc):O.m(m,Ra,Ea,h("COLOR",
"u_shadow_mask",1,1,!0)));var ac=h("COLOR","u_color",1,1,!0);q.push(h("COLOR","COLOR",1,1,!0));Fa&&(O.m(m,Fa,Ea,wb),O.m(m,Fa,Ea,xb));F.length&&(O.m(m,F[da],Ea,K[da]),Ea.Jb=xa[0])}s=u;u=[];if(!Ya&&a.Vr){va=d(s[0].j);c.M.push(va);var sb=v(va,!1);O.v(m,sb);if(a.re){va=d(s[0].j);c.M.push(va);var G=v(va,!0);O.v(m,G);O.m(m,sb,G,h("COLOR","COLOR",1,1,!0));O.m(m,sb,G,h("DEPTH","DEPTH",1,1,!0))}}else sb=null;if(ib.Vc&&!Ya)for(da=0;da<Da.length;da++){var db=L();O.v(m,db);O.m(m,s[da],db,ac);U.push(db);Y.push(h("COLOR",
"u_refractmap",1,1,!0))}for(var Za=[],da=0;da<Da.length;da++)Ea=k("BLEND",da),Za.push(Ea);s=u;u=[];if(a.re){for(da=0;da<Da.length;da++)k("XRAY",da);s=u;u=[]}if(za.wireframe_debug){for(da=0;da<Da.length;da++){va=Ma.Ea(Da[da]);c.M.push(va);var $a=E(va);u.push($a);O.v(m,$a);O.m(m,s[da],$a,q[da]);O.m(m,s[da],$a,y[da]);Fa&&(O.m(m,Fa,$a,wb),O.m(m,Fa,$a,xb))}s=u;u=[]}if(nc&&Va&&!Ya){for(da=0;da<Da.length;da++){var na=yb.mh,W=yb.PC,Oa=yb.Kh,eb=s[da],Ta=oa?1:0,cc=h("DEPTH","u_input",1,1,!0);cc.ta=ka.C;cc.sa=
ka.C;var oc=h("COLOR","u_input",1,.25,!0);oc.ta=ka.C;oc.sa=ka.C;var dc=na/Oa,ec=d(Da[da]);c.M.push(ec);var Vb=X(ec,Ta,na,!0,dc,ja,Oa);O.v(m,Vb);O.m(m,eb,Vb,cc);var dc=na/Oa*.5,pc=d(Da[da]);c.M.push(pc);var qc=X(pc,Ta,na,!1,dc,ja,Oa);O.v(m,qc);O.m(m,Vb,qc,oc);var dc=na/Oa*.25,Ec=d(Da[da]);c.M.push(Ec);var Ka=X(Ec,Ta,na,!1,dc,ja,Oa);O.v(m,Ka);O.m(m,qc,Ka,oc);F.length&&(Vb.Jb=xa[0],qc.Jb=xa[0],Ka.Jb=xa[0]);var Ha=V(W,ja);u.push(Ha);O.v(m,Ha);O.m(m,eb,Ha,h("COLOR","u_main",1,1,!0));O.m(m,Ka,Ha,h("COLOR",
"u_god_rays",1,1,!0))}s=u;u=[]}if(ya&&!Ya){for(da=0;da<Da.length;da++){var eb=s[da],Yc=ha();O.v(m,Yc);O.m(m,eb,Yc,h("COLOR","u_input",1,1,!0));var qb=ba();O.v(m,qb);qb.j.width=1;qb.j.height=1;var Wb=h("COLOR","u_input",1,.25,!0);Wb.ta=ka.C;Wb.sa=ka.C;var Xb=h("COLOR","u_luminance",1,.25,!0);Xb.ta=ka.C;Xb.sa=ka.C;O.m(m,Yc,qb,Wb);var kd=Wa.key,Qb=Wa.bB,fc=d(Da[da]);c.M.push(fc);var Yb=Q(kd,Qb,ja,fc);O.v(m,Yb);O.m(m,eb,Yb,h("COLOR","u_main",1,1,!0));O.m(m,Yc,Yb,Xb);O.m(m,qb,Yb,h("COLOR","u_average_lum",
1,1,!1));var kb=h("COLOR","u_color",1,.25,!0);kb.ta=ka.C;kb.sa=ka.C;var Bb=I("X_BLUR");O.v(m,Bb);O.m(m,Yb,Bb,kb);var yc=I("Y_BLUR");O.v(m,yc);O.m(m,Bb,yc,kb);var zc=T(Wa.blur);O.v(m,zc);var rc=h("COLOR","u_bloom",1,.25,!0);rc.ta=ka.C;rc.sa=ka.C;O.m(m,yc,zc,rc);O.m(m,eb,zc,h("COLOR","u_main",1,1,!0));u.push(zc)}s=u;u=[]}if(zb&&!Ya){for(da=0;da<s.length;da++){var Zb=s[da],sc=M(Sb.hl,Sb.il);u.push(sc);O.v(m,sc);O.m(m,Zb,sc,h("COLOR","u_mb_tex_curr",1,1,!0));sc.ja.push(h("COLOR","u_mb_tex_accum",1,1,
!0))}s=u;u=[]}if(pb&&Va&&!Ya){for(da=0;da<s.length;da++){var eb=s[da],Lb=d(Da[da]);c.M.push(Lb);kb=h("COLOR","u_color",1,1,!0);kb.ta=ka.C;kb.sa=ka.C;var rb=D("X_BLUR");O.v(m,rb);O.m(m,eb,rb,kb);var Cb=D("Y_BLUR");O.v(m,Cb);O.m(m,rb,Cb,kb);var Ra=Za[da],gc=P(Lb);Lb.dof_distance=c.dof_distance;Lb.Gf=c.Gf;Lb.dof_front=c.dof_front;Lb.dof_rear=c.dof_rear;Lb.dof_power=c.dof_power;Lb.dof_on=1;u.push(gc);O.v(m,gc);O.m(m,eb,gc,h("COLOR","u_sharp",1,1,!0));O.m(m,Cb,gc,h("COLOR","u_blurred",1,1,!0));O.m(m,Ra,
gc,h("DEPTH","u_depth",1,1,!0))}s=u;u=[]}if(!Ya&&a.glow){for(da=0;da<Da.length;da++){var eb=s[da],ub=d(Da[da]);c.M.push(ub);var Kc=S(ub);O.v(m,Kc);var Ac=D("X_EXTEND"),nd=h("COLOR","u_color",1,1,!0),Lc=h("COLOR","u_glow_mask",1,1,!0);Ac.Ni=!0;O.v(m,Ac);O.m(m,Kc,Ac,nd);var Bc=h("COLOR","u_color",1,.5,!0);Bc.ta=ka.C;Bc.sa=ka.C;var Gc=D("Y_EXTEND");Gc.Ni=!0;O.v(m,Gc);O.m(m,Ac,Gc,Bc);rb=D("X_BLUR");rb.Ni=!0;O.v(m,rb);O.m(m,Gc,rb,Bc);var Db=h("COLOR","u_color",1,.25,!0);Db.ta=ka.C;Db.sa=ka.C;var Zc=h("COLOR",
"u_glow_mask_blurred",1,.25,!0);Zc.ta=ka.C;Zc.sa=ka.C;Cb=D("Y_BLUR");Cb.Ni=!0;O.v(m,Cb);O.m(m,rb,Cb,Db);var Hc=Z(Pb);O.v(m,Hc);O.m(m,eb,Hc,h("COLOR","u_glow_src",1,1,!0));O.m(m,Kc,Hc,Lc);O.m(m,Cb,Hc,Zc);u.push(Hc)}s=u;u=[]}if(Ub&&!Ya){for(da=0;da<s.length;da++){var eb=s[da],Mc=R(Ja.brightness,Ja.contrast,Ja.exposure,Ja.saturation);O.v(m,Mc);O.m(m,eb,Mc,h("COLOR","u_color",1,1,!0));u.push(Mc)}s=u;u=[]}if(Ab){for(da=0;da<s.length;da++)if(eb=s[da],za.smaa){var Cc=h("COLOR","u_color",1,1,!0);Cc.ta=ka.C;
Cc.sa=ka.C;var fb=C("SMAA_EDGE_DETECTION");O.v(m,fb);O.m(m,eb,fb,Cc);var hc=C("SMAA_BLENDING_WEIGHT_CALCULATION");O.v(m,hc);O.m(m,fb,hc,Cc);var Nc=h("COLOR","u_search_tex",1,1,!1),Ic=h("COLOR","u_area_tex",1,1,!1);Nc.ta=ka.C;Nc.sa=ka.C;Ic.ta=ka.C;Ic.sa=ka.C;hc.ja.push(Nc);hc.ja.push(Ic);var Oc=C("SMAA_NEIGHBORHOOD_BLENDING");O.v(m,Oc);O.m(m,eb,Oc,Cc);var Pc=h("COLOR","u_blend",1,1,!0);Pc.ta=ka.C;Pc.sa=ka.C;O.m(m,hc,Oc,Pc);u.push(Oc)}else{var Qc=J();O.v(m,Qc);var Rc=h("COLOR","u_color",1,1,!0);Rc.ta=
ka.C;Rc.sa=ka.C;O.m(m,eb,Qc,Rc);if(1<za.resolution_factor){var $c=D("NONE");O.v(m,$c);O.m(m,Qc,$c,Rc);u.push($c)}else u.push(Qc)}s=u;u=[]}if(a.anaglyph_use&&!Ya){var Sc=ea();O.v(m,Sc);O.m(m,s[0],Sc,h("COLOR","u_sampler_left",1,1,!0));O.m(m,s[1],Sc,h("COLOR","u_sampler_right",1,1,!0));u.push(Sc)}else u.push(s[0]);var fd=O.qh(m,s[0]),tc=!1;O.pe(m,fd,function(a,b,c){if(c.P==c.ka)return tc=!0});if(tc){var Mb=w();O.v(m,Mb);O.m(m,s[0],Mb,h("COLOR","u_color",1,1,!0));s=u;u=[];u.push(Mb)}sb&&(G?u.push(G):
u.push(sb));if(!Ya&&a.kp.procedural_skydome){var uc=ca(ja,a.kp);O.v(m,uc);u.push(uc)}var vc=pa();O.v(m,vc);for(da=0;da<u.length;da++)switch(u[da].type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":O.m(m,u[da],vc,h("COLOR","NONE",1,1,!0));O.m(m,u[da],vc,h("DEPTH","NONE",1,1,!0));break;case "SKY":O.m(m,uc,vc,h("CUBEMAP","u_sky",Xa.qk,1,!1));break;default:if(Ya){var ad=g[0].d,Dc=h("COLOR","OFFSCREEN",1,1,!0);Dc.na=ad;O.m(m,u[da],vc,Dc);for(jb=1;jb<g.length;jb++){var bd=g[jb].d,Mb=w();O.v(m,Mb);O.m(m,
u[da],Mb,h("COLOR","u_color",1,1,!0));Dc=h("COLOR","OFFSCREEN",1,bd.xg/ad.xg,!0);Dc.na=bd;O.m(m,Mb,vc,Dc)}}else O.m(m,u[da],vc,h("SCREEN","NONE",1,1,!0))}if(Va)for(var Tc=O.Mn(m),da=0;da<Tc.length;da++)for(var cd=Tc[da],jb=0;jb<B.length;jb++)Ra=B[jb],O.$a(m,cd)==Ra&&O.uh(m,cd);if(ta.enabled){var Rb=A(m);Rb&&x(m,Rb)}b(m,Va);1<za.resolution_factor&&p(m);n(m);H(m);return m};a.rK=F;a.hJ=function(a){var b=null;O.U(a,function(a,c){return c.j&&null===c.j.Ie?(b=c,!0):!1});return b};a.wb=function(a,b,c){a=
K(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.lK=ma;a.JC=U;a.sB=Y;a.rt=K;a.VJ=qa;a.kb=function(a,b){var c=null;O.U(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.MA=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=oa(a);O.U(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(f+=" ("+d.ej.replace(/_/g,
" ")+")");if(d.j){for(var f=f+"\\n",h=0;h<c.length;h+=2)c[h]==d.j.Db&&(f+="C"+c[h+1]+" ");for(h=0;h<c.length;h+=2)c[h]==d.j.Ic&&(f+="D"+c[h+1])}d.ja.length&&(f+="\\n-----\\n");for(h=0;h<d.ja.length;h++)f+=ja(d.ja[h],c);h="SINK"==d.type?"dotted":d.qc?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(h+",bold")+'"];\n')});O.hf(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+ja(e,c)+'" style="'+(e.Ka?"solid":"dotted")+'"];\n'});return b+="}"};a.zA=function(a){a=
O.vF(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.qc&&b.push(d)}return b}};b4w.module.__hud=function(a,q){function d(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function b(a){g(' SCENE "'+a.name+'"');if(a.d){var b=0,c=0;k.U(a.d.xb,function(a,d){if("SINK"==d.type)g(" (F)",d.type);else{var k=d.type,f=Math.round(d.j.width)+"x"+Math.round(d.j.height),m=d.o.length,h=d.ri,n=d.qc&&d.Y;n?g(" (A)",k,d.jg,f,h,"of",m):g(" (P)",k,d.jg,f,h,"of",m);d.ri=0;n&&(b+=m,c+=h)}});return[b,c]}g("No INFO")}function g(){for(var a=80+20*m[0],b=[5,18,3,
10,4,3,5],c=arguments[0],d=1;d<arguments.length;d++){for(var g="",k=0;k<b[d]-String(arguments[d]).length;k++)g+=" ";c+=g+arguments[d]}m[0]++;y.fillText(c,30,a)}function c(a,b,c){b*=a.Aa;c.x=a.x+b;c.y=a.y;c.Aa=a.Aa-2*b;c.ra=a.ra}function n(a){return a.x+a.Aa/2}function p(a){var b=y,d={x:0,y:0,Aa:0,ra:0},g=b.canvas.width,b=b.canvas.height;d.x=0;d.y=0;d.Aa=g;d.ra=b;c(d,.01,d);g=.02*d.ra;d.x=d.x;d.y+=g;d.Aa=d.Aa;d.ra-=2*g;g=d.Aa/8;d.x+=g*a;d.y=d.y;d.Aa=g;d.ra=d.ra;c(d,.02,d);return d}var k=q("__graph"),
y=null,m=[0,0];a.ac=function(a){a=a.getContext("2d");d(a);return y=a};a.Th=function(){y&&d(y)};a.reset=function(){var a=y;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),m[0]=0,m[1]=0)};a.PE=function(a,c){var d=y;if(d){d.textAlign="left";d.fillStyle="rgba(0,255,0,255)";g(" FPS",(1/c).toFixed(2));m[0]++;for(var k=d=0,n=0;n<a.length;n++){var p=b(a[n]),d=d+p[0],k=k+p[1];m[0]++}g(" ---------------------------------------------");
g("    ","TOTAL ACTIVE","","",k,"of",d)}};a.print=function(){var a=y;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",g.apply(Math,arguments))};a.eL=function(a,b,c,d,g,k,f){var m=y;if(m){b=p(b);var h=b.ra/5;b.x=b.x;b.y+=4*h;b.Aa=b.Aa;b.ra=h;m.textAlign="center";m.fillStyle="#00FF00";y.fillText(a,n(b),b.y-10);m.strokeStyle="#00FF00";m.lineWidth=.5;m.beginPath();m.moveTo(b.x,b.y);m.lineTo(b.x+b.Aa,b.y);m.lineTo(b.x+b.Aa,b.y+b.ra);m.lineTo(b.x,b.y+b.ra);m.closePath();m.stroke();if(!k&&!f)for(k=
1E6,f=-1E6,a=0;a<c.length;a++)k=Math.min(k,c[a]),f=Math.max(f,c[a]);m.textAlign="right";y.fillText(String(k),b.x-10,b.y+b.ra);y.fillText(String(f),b.x-10,b.y);m.textAlign="center";y.fillText(String(d),b.x,b.y+b.ra+15);y.fillText(String(g),b.x+b.Aa,b.y+b.ra+15);m.strokeStyle="#FF0000";m.lineWidth=1.5;m.beginPath();d=b.Aa/(c.length-1);f=b.ra/(f-k);for(a=0;a<c.length;a++)g=b.x+d*a,h=b.y+b.ra-(c[a]-k)*f,0==a?m.moveTo(g,h):m.lineTo(g,h);m.stroke()}};a.WI=function(a,b,c,d,g,k,f){var m=y;if(m)for(m.textAlign=
"center",m.fillStyle="#00FF00",m.font="bold 12px Courier",c=p(c),y.fillText(b?"["+a+"]":a,n(c),c.y),0<=k&&y.fillText(k?"[M]":"[ ]",n(c)-15,c.y+30),0<=f&&y.fillText(f?"[S]":"[ ]",n(c)+15,c.y+30),a={x:0,y:0,Aa:0,ra:0},b=0;b<d.length;b++){k=d[b];var h="VOLUME"==k[0];if(h){f=c.y+350;var q=c.Aa,D=a;D.x=c.x;D.y=f;D.Aa=q;D.ra=250}else{f=c.y+10+50*b;var q=c.Aa,D=c.ra,I=a;I.x=c.x;I.y=f;I.Aa=q;I.ra=D}f=m;var q=a,I=b==g,r=k[0],D=k[1],v=k[2],E=k[3],e=(E-v)/k[4],e=1>e?Math.floor(1/e-1E-5).toFixed(0).length:0;
k=k[5]?Math.log(D/v)/Math.log(E/v):(D-v)/(E-v);f.textAlign="center";I?f.fillText("["+r+"]",n(q),q.y):f.fillText(r,n(q),q.y);f.strokeStyle="#00FF00";f.lineWidth=h?3:1;h?(f.textAlign="right",f.fillText(E.toFixed(e),n(q)-10,q.y+15),f.textAlign="right",f.fillText(v.toFixed(e),n(q)-10,q.y+q.ra-15)):(f.textAlign="right",f.fillText(v.toFixed(e),q.x+28,q.y+15),f.textAlign="left",f.fillText(E.toFixed(e),q.x+q.Aa-28,q.y+15));f.beginPath();if(h){var t=q.y+15+(q.ra-30)*(1-k);f.moveTo(n(q),q.y+15);f.lineTo(n(q),
q.y+q.ra-15);f.moveTo(n(q)-5,q.y+15);f.lineTo(n(q)+5,q.y+15);f.moveTo(n(q)-5,q.y+q.ra-15);f.lineTo(n(q)+5,q.y+q.ra-15);f.moveTo(n(q)-5,t);f.lineTo(n(q)+5,t)}else{var l=q.x+30+(q.Aa-60)*k;f.moveTo(q.x+30,q.y+15);f.lineTo(q.x+q.Aa-30,q.y+15);f.moveTo(q.x+30,q.y+15-5);f.lineTo(q.x+30,q.y+15+5);f.moveTo(q.x+q.Aa-30,q.y+15-5);f.lineTo(q.x+q.Aa-30,q.y+15+5);f.moveTo(l,q.y+15-5);f.lineTo(l,q.y+15+5)}f.stroke();"EQ_Q"==r?(k=Math.log(1+1/(2*D*D)+Math.sqrt((2+1/(D*D))*(2+1/(D*D))/4-1))/Math.log(2),h?(f.textAlign=
"left",f.fillText(D.toFixed(e),n(q)+10,t),f.textAlign="left",f.fillText("("+k.toFixed(e+1)+")",n(q)+10,t+10)):(f.textAlign="right",f.fillText(D.toFixed(e),l,q.y+30),f.textAlign="left",f.fillText("("+k.toFixed(e+1)+")",l,q.y+30))):h?(f.textAlign="left",f.fillText(D.toFixed(e),n(q)+10,t)):(f.textAlign="center",f.fillText(D.toFixed(e),l,q.y+30))}}};b4w.module.__prerender=function(a,q){var d=q("__config"),b=q("__debug"),g=q("__geometry"),c=q("__util"),n=q("__renderer"),p=q("vec3"),k=d.p,y="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH GLOW_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.Io=function(a){if(-1<y.indexOf(a.type)){for(var d=!1,q=a.o,u=0;u<q.length;u++){var H=q[u],A=H,x=a,f=A.nb,F=x.j;A.Y=!0;f.al=!1;if(f)if(f.Ki)A.Y=!1;else{var h=F.He,z=f.Cb.w,D=f.Oe,h=Math.sqrt((z[0]-h[0])*(z[0]-h[0])+(z[1]-h[1])*(z[1]-
h[1])+(z[2]-h[2])*(z[2]-h[2])),z=f.eg*f.Cb.za;h>=f.Ti&&h<D+z?(f.al=!0,"GLOW_MASK"!=x.type||Boolean(A.n.gh)?(F=F.An,f.Xg?f=!1:"STATIC"===f.type?(D=f.Cb,f=D.w,f=c.bF(f,F,D.za)):(D=f.Af,f=D.w,f=c.eB(f,F,D.wf,D.xf,D.yf)),f?A.Y=!1:"WIREFRAME"==x.type&&(A.Y=A.n.wireframe_mode==b.Jq.WM_DEBUG_SPHERES?A.n.jn:!A.n.jn)):A.Y=!1):A.Y=!1}else A.Y=!1;H.Y&&(d=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||d?a.Y=!0:(a.Y&&n.clear(a),a.Y=!1)}}if("MAIN_BLEND"==a.type&&(d=
a.j.He,p.dist(d,a.nx)>k.alpha_sort_threshold&&k.alpha_sort&&a.o)){for(q=0;q<a.o.length;q++)H=a.o[q],A=H.n,u=H.nb.N,A&&A.Da&&A.se!=g.Gd&&(A=A.Gc)&&H.Y&&(H=A.Vk)&&H.type==g.Kq&&g.CF(A,u,d);a.nx.set(d)}}};b4w.module.camera=function(a,q){function d(a,d){b.yb(a)?(y.copy(d,a.d.cb),p.A(a),g.T(a)):c.error("set_pivot(): Wrong object or camera move style")}var b=q("__camera");q("__config");var g=q("__physics"),c=q("__print"),n=q("__constraints"),p=q("__transform"),k=q("__util"),y=q("vec3"),m=q("vec4"),s=q("quat"),B=q("mat3"),u=q("mat4"),H=new Float32Array(2),A=new Float32Array(3),x=new Float32Array(3),f=new Float32Array(4),F=new Float32Array(4),h=new Float32Array(4),z=new Float32Array(9);a.ci=b.ci;a.pq=b.pq;
a.zH=b.fa;a.fa=b.fa;a.kc=b.kc;a.Xb=b.Xb;a.Ne=function(a){return b.Ne(a)};a.PL=function(a,b){a.d.R=b};a.Nf=function(a){return b.Ne(a)?b.Nf(a):(c.error("get_move_style(): Wrong object"),null)};a.IE=function(a,d){if(b.yb(a)||b.Uf(a)||b.lb(a)){var f=a.d;f.Qp=d[0];f.Pp=d[1];f.Rp=d[2]}else c.error("set_velocity_params(): Wrong object or camera move style")};a.Ii=function(a,d){if(!b.yb(a)&&!b.Uf(a)&&!b.lb(a))return c.error("get_velocity_params(): Wrong object or camera move style"),null;d||(d=new Float32Array(3));
var f=a.d;d[0]=f.Qp;d[1]=f.Pp;d[2]=f.Rp;return d};a.kI=function(){c.error("change_eye_target_dist() deprecated")};a.OL=function(a,c,d,f){var h=a.d;b.pB(c,d,f,h.g,h.quat);p.A(a);g.T(a)};a.it=function(a,d){if(b.Ne(a))return d||(d=new Float32Array(3)),y.copy(a.d.g,d),d;c.error("get_eye(): Wrong object")};a.WL=d;a.dM=function(a,d,f){b.yb(a)?(y.copy(d,a.d.g),y.copy(f,a.d.cb),p.A(a),g.T(a)):c.error("set_trans_pivot(): Wrong object or camera move style")};a.Kn=function(a,d){if(b.yb(a))return d||(d=new Float32Array(3)),
y.copy(a.d.cb,d),d;c.error("get_pivot(): Wrong object or camera move style")};a.vg=function(a,d,h){if(b.yb(a)){var m=a.d,n=b.Je(a,H);0<k.S(m.quat,k.jc,A)[1]&&(n[1]=k.sign(n[1])*Math.PI-n[1]);n=Math.abs(n[1]+h)%(2*Math.PI);m.Pl=n>Math.PI/2&&n<3*Math.PI/2;A[0]=1;A[1]=0;A[2]=0;y.transformQuat(A,m.quat,A);s.setAxisAngle(A,h,f);A[0]=0;A[1]=1;A[2]=0;h=k.S(m.quat,k.rb,x);.999999>Math.abs(y.dot(h,A))&&(s.setAxisAngle(A,d,F),s.multiply(F,f,f));k.eE(m.g,m.cb,f,m.g);p.A(a);g.T(a)}else c.error("rotate_pivot(): wrong object")};
a.rD=function(a,d,f){if(b.yb(a)){var h=a.d;if(h.Yw){var k=B.fromMat4(h.N,z),e=y.subtract(h.g,h.cb,x);A[0]=d;A[1]=0;A[2]=f;y.scale(A,y.len(e),A);y.transformMat3(A,k,A);y.add(h.cb,A,h.cb);y.add(h.g,A,h.g);p.A(a);g.T(a)}}else c.error("move_pivot(): wrong object")};a.Dv=function(a,d){if(b.lb(a)){var h=a.d;if(h.Ab&&h.As&&d){var m=s.setAxisAngle(k.Ba,d,f);s.normalize(m,m);s.multiply(m,h.quat,h.quat);p.A(a);g.T(a)}}else c.error("rotate_hover_cam(): wrong object")};a.Dk=function(a){return b.lb(a)?b.pt(a):
(c.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.zE=function(a,d){if(b.lb(a)){var h=a.d;if(h.Ab){var m=k.S(h.quat,k.ad,A),n=b.pt(a)-d,m=s.setAxisAngle(m,n,f),h=s.multiply(m,h.quat,f);p.Yc(a,h);p.A(a);g.T(a)}else c.warn("set_hover_cam_angle(): undefined without distance limits")}else c.error("set_hover_cam_angle(): wrong object or camera move style")};a.jC=function(a,d){if(b.lb(a))return a.d.ab?(d||(d=new Float32Array(2)),d[0]=a.d.ab.eb,d[1]=a.d.ab.Ya):c.warn("get_hover_angle_limits(): camera hasn't angle limits"),
d;c.error("get_hover_angle_limits(): wrong object")};a.XB=function(a){var d;if(b.lb(a)||b.yb(a))return a.d.Ab?(d||(d=new Float32Array(2)),d[0]=a.d.Wg,d[1]=a.d.Td):c.warn("get_cam_dist_limits(): camera hasn't distance limits"),d;c.error("get_cam_dist_limits(): wrong object")};a.Ep=function(a,d){if(b.lb(a)){var f=a.d;f.Ab?y.copy(d,f.Zd):p.Zc(a,d);p.A(a);g.T(a)}else c.error("translate_hover_cam_v(): wrong object")};a.qt=function(a,d){if(!b.lb(a))return c.error("get_hover_cam_pivot(): wrong object"),
null;d||(d=new Float32Array(3));y.copy(a.d.Zd,d);return d};a.Tk=function(a){return b.yb(a)||b.lb(a)?a.d.Ab:(c.error("has_distance_limits(): wrong object"),null)};a.WH=function(a,d,f,h){if(b.yb(a)||b.Uf(a)){var k=a.d;k.Na={Ya:d,eb:f};h==p.Oj&&b.aG(a);b.Sp(a)}else if(b.lb(a)){if(d>f){c.error("apply_vertical_limits(): wrong horizontal limits");return}k=a.d;k.Na={Ya:-f,eb:-d}}else{c.error("apply_vertical_limits(): wrong object");return}p.A(a);g.T(a)};a.AI=function(a){a.d.Na=null;(b.yb(a)||b.Uf(a))&&b.Sp(a)};
a.UH=function(a,d,f,h){if(b.yb(a)||b.Uf(a)){var k=a.d;k.Ra={left:d,right:f};h==p.Oj&&b.LC(a);b.Sp(a)}else if(b.lb(a)){if(d>f){c.error("apply_horizontal_limits(): wrong horizontal limits");return}k=a.d;k.Ra={left:d,right:f}}else{c.error("apply_horizontal_limits(): wrong object");return}p.A(a);g.T(a)};a.wI=function(a){a.d.Ra=null};a.ot=function(a){var d;if(b.yb(a)||b.Uf(a)||b.lb(a)){if(a=a.d,d=d||new Float32Array(2),a.Ra)return d[0]=a.Ra.left,d[1]=a.Ra.right,d}else c.error("get_horizontal_limits(): wrong object")};
a.Yt=function(a){if(b.yb(a)||b.Uf(a)||b.lb(a))return Boolean(a.d.Ra);c.error("has_horizontal_limits(): wrong object")};a.VH=function(a,d,f){b.lb(a)?d>f?c.error("apply_hover_angle_limits(): wrong vertical limits"):(a.d.ab={Ya:d,eb:f},p.A(a),g.T(a)):c.error("apply_hover_angle_limits(): wrong object")};a.xI=function(a){b.lb(a)?a.d.ab=null:c.error("clear_hover_angle_limits(): wrong object")};a.SH=function(a,d,f){if(b.yb(a)||b.lb(a))if(d>f)c.error("apply_distance_limits(): wrong distance limits");else{var h=
a.d;h.Ab=!0;h.Td=d;h.Wg=f;p.A(a);g.T(a)}else c.error("apply_distance_limits(): wrong object")};a.uI=function(a){b.yb(a)||b.lb(a)?a.d.Ab=!1:c.error("clear_distance_limits(): wrong object")};a.DL=function(a,c,d){s.identity(a.d.quat);b.Vo(a,Math.PI/2);b.Cv(a,c);b.Vo(a,-d);p.A(a);g.T(a)};a.BK=function(a){k.S(a.d.quat,k.rb,A);return 0<=A[1]?!0:!1};a.rotate=function(a,c,d){b.Cv(a,c);b.Vo(a,-d);p.A(a);g.T(a)};a.Je=function(a,c){c||(c=new Float32Array(2));b.Je(a,c);return c};a.$v=function(a,c){for(var d=
a.d.M,f=0;f<d.length;f++){var h=d[f];h.type!=b.Nb&&h.type!=b.Sb||b.EE(h,c,h.wd)}};a.Gt=function(a){a=a.d.M;for(var c=0;c<a.length;c++){var d=a[c];if(d.type==b.Nb||d.type==b.Sb)return d.tj}return 0};a.DK=function(a){return a.d.Qw};a.tM=function(a,c,d,f){a=a.d.M;for(var h=0;h<a.length;h++){var e=a[h];e.Jb||b.xh(e,e.hb);var g=A;g[0]=-c;g[1]=-d;g[2]=0;u.translate(e.ua,g,e.ua);u.rotateZ(e.ua,f,e.ua);u.multiply(e.ua,e.oa,e.Eg);b.Jz(e);b.Iz(e)}};a.Vm=function(a,b){b||(b=k.Ba);n.Vm(a,b)};a.HM=function(a,
f){if(b.yb(a)){p.Gk(f,!1,A);d(a,A);p.A(a);var h=p.Jn(f),k=b.RB(a)/2,h=h/Math.sin(k),k=p.zD(a,A);p.tc(a,0,h-k,0);p.A(a);g.T(a)}else c.error("zoom_object(): wrong object")};a.VL=function(d,f){if(b.Ne(d)){var h=d.d;if(b.yb(d)){var g=y.dist(h.g,h.cb);h.Le=f/2*h.ih/g}else b.lb(d)&&a.Tk(d)?(g=b.kC(d),g=y.len(g),h.Le=f/2*h.ih/g):h.Le=f/2;b.KF(d)}else c.error("set_ortho_scale(): wrong object")};a.UJ=function(a){if(b.Ne(a))return a.d.M[0].type==b.Fd?2*a.d.M[0].top:0;c.error("get_ortho_scale(): wrong object")};
a.CK=function(a){if(b.Ne(a))return a.d.M[0].type==b.Fd;c.error("is_ortho_camera(): wrong object")};a.hI=function(a,d,f,g){g||(g=new Float32Array(3));var k=a.d.M[0];switch(k.type){case b.Dc:case b.tf:case b.Nb:case b.Sb:var e=Math.tan(k.Vd*Math.PI/360);h[0]=(2*d/k.width-1)*e*k.hb;h[1]=-1;h[2]=(2*f/k.height-1)*e;h[3]=0;m.transformMat4(h,a.d.N,h);g[0]=h[0];g[1]=h[1];g[2]=h[2];y.normalize(g,g);return g;default:return c.error("Non-compatible camera"),g}};a.fL=function(a,d,f){f||(f=new Float32Array(2));
var g=a.d.M[0];switch(g.type){case b.Dc:case b.tf:case b.Nb:case b.Sb:return p.Sc(a,A),y.subtract(d,A,A),h.set(A),h[3]=0,m.transformMat4(h,g.Eg,h),a=-h[1]/h[3],f[0]=(h[0]/h[3]+1)/2*g.width|0,f[1]=(a+1)/2*g.height|0,f;default:return c.error("Non-compatible camera"),f}}};b4w.module.config=function(a,q){var d=q("__config");a.sf=d.sf;a.rf=d.rf;a.Ig=d.Ig;a.Bq=d.Bq;a.set=d.set;a.get=d.get;a.reset=d.reset;a.Ft=d.Ft};b4w.module.constraints=function(a,q){var d=q("__constraints"),b=q("__physics"),g=q("__transform");a.PH=function(a,n,p,k,q){q=q||1;n instanceof Array&&2==n.length?d.Vq(a,n[0],n[1],p,k,q):d.Wq(a,n,p,k,q);g.A(a);b.T(a)};a.NH=function(a,n,p,k){d.dz(a,n,p,k);g.A(a);b.T(a)};a.OH=function(a,n,p,k,q,m,s,B){d.cz(a,n,p,k,q,m,s,B);g.A(a);b.T(a)};a.MH=function(a,n,p,k){if(!k||0>k)k=.25;d.bz(a,n,p,k);g.A(a);b.T(a)};a.ez=function(a,n){d.fz(a,n);g.A(a);b.T(a)};a.KH=function(a,n,p){d.Xy(a,n,p);g.A(a);b.T(a)};a.QH=
function(a,n,p,k){d.gz(a,n,p,k);g.A(a);b.T(a)};a.RH=function(a,n){3==n.length?d.jz(a,n):d.iz(a,n);g.A(a);b.T(a)};a.LH=function(a,n,p,k){3==n.length?d.Zy(a,n,p,k):d.Yy(a,n,p,k);g.A(a);b.T(a)};a.remove=function(a){a.tb&&d.remove(a)}};b4w.module.controls=function(a,q){var d=q("__controls");q("__print");a.ca=d.ca;a.fm=d.fm;a.cd=d.cd;a.bd=d.bd;a.JG=8;a.tH=9;a.RG=13;a.qH=16;a.NG=17;a.HG=18;a.mH=19;a.LG=20;a.TG=27;a.sH=32;a.kq=37;a.nq=38;a.lq=39;a.jq=40;a.bH=96;a.cH=97;a.dH=98;a.eH=99;a.fH=100;a.gH=101;a.hH=102;a.iH=103;a.jH=104;a.kH=105;a.hq=65;a.IG=66;a.Fx=67;a.iq=68;a.QG=69;a.Gx=70;a.VG=71;a.XG=72;a.YG=73;a.ZG=74;a.Hx=75;a.Ix=76;a.$G=77;a.aH=78;a.lH=79;a.Kx=80;a.oH=81;a.Lx=82;a.mq=83;a.Nx=84;a.uH=85;a.vH=86;a.oq=87;a.wH=88;a.xH=
89;a.yH=90;a.yG=49;a.zG=50;a.AG=51;a.BG=52;a.CG=53;a.DG=54;a.EG=55;a.FG=56;a.GG=57;a.PG=110;a.pH=186;a.SG=187;a.MG=188;a.OG=189;a.nH=190;a.UG=191;a.WG=192;a.Jx=219;a.KG=220;a.Mx=221;a.rH=222;a.Nj=d.Nj;a.Mj=d.Mj;a.Lj=d.Lj;a.cs=d.cs;a.Pa=d.Pa;a.Zm=d.Zm;a.bs=d.bs;a.hs=d.hs;a.mk=d.mk;a.$m=d.$m;a.Ug=d.Ug;a.pi=d.pi;a.pk=d.pk;a.fs=d.fs;a.ls=d.ls;a.ds=d.ds;a.es=d.es;a.ks=function(a,g){return d.ks(a,g||!1)};a.zv=d.zv;a.Sg=d.Sg;a.js=d.js;a.an=function(a,g){return d.an(a,g||!1)};a.zL=function(a,g){d.pE(a,g)};
a.GJ=function(a){return a.value};a.Qb=d.Qb;a.Xd=d.Xd;a.vL=function(){throw"Deprecated method execution";};a.uL=function(){throw"Deprecated method execution";};a.II=function(a,g,c){a.mo=g.slice(0);a.lo=Array(g.length);a.fl=c||d.ln};a.jL=function(a){a.mo=null;a.lo=null;a.fl=null};a.J=function(a,g,c,n,p,k,q){p=p||d.ln;d.J(a,g,c,n,p,k,void 0===q?null:q)};a.Tg=function(a,g,c,n,p){var k;n=d.Pa(n);d.J(a,g,c,[n],d.ln,p,void 0===k?null:k)};a.qI=function(a){return d.Og(a,null)};a.Og=d.Og;a.kL=function(a){d.ge(a,
null)};a.ge=d.ge;a.reset=d.reset;a.Mo=d.Mo;a.No=function(a,g,c){d.No(a,g,!!c)};a.Po=d.Po;a.Oo=d.Oo;a.Bl=d.Bl;a.Fp=d.Fp;a.Gp=d.Gp;a.Ip=d.Ip;a.Sw=d.Bl;a.Hp=d.Hp};b4w.module.data=function(a,q){var d=q("__data");q("__print");var b=q("__util");a.load=d.load;a.Vl=function(a){d.Vl(a|0)};a.Ov=d.Ov;a.be=d.be;a.KK=d.load;a.zJ=function(){b.ma("get_bpy_world() deprecated");return null};a.ba=a.Vl};b4w.module.__data=function(a,q){function d(a,b){for(var c=V(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}la[b.id]=null;gb[b.id]=null}function b(a,b,c){var d;a instanceof ArrayBuffer&&(a=pa.Mt(a));d=a.width;a=a.height;ja.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(wa)&&c&&ja.warn("B4W Warning: image",b,"is not from app root.")}function g(a,b,c,d,e,f){d=b.r;if(!d)throw"Nothing requested";Y.qc([[d,Y.aq,d]],
function(d,f,h,g){if(d){ja.log("%cLOAD METADATA","color: #616",g);f=d.b4w_format_version;if(Number(f)<La.Du)throw"Incompatible file version: "+f+". Required: "+La.Du;for(var k in d)a[k]=d[k];(d=a.binaries[0].binfile)?b.or=d:(U.pw(b,"load_binaries"),U.pw(b,"prepare_bindata"));if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)ja.error("EXPORT ERROR:",a.b4w_export_errors[d]);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)ja.warn("EXPORT WARNING:",a.b4w_export_warnings[d]);
e(b,c)}else b.zu(b.id,!1)},null,function(a){f(b,c,a)})}function c(a,b,c,d,e,f){d=Z(b.r)+b.or;if(!d)throw"Binary data is missing";Y.qc([[d,Y.Ej,d]],function(d,f,h,g){d&&(ja.log("%cLOAD BINARY","color: #616",g),a.bin_data=d,e(b,c))},null,function(a){f(b,c,a)})}function n(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],h=a.objects,g=a.meshes;a=a.actions;for(var k=za.Rz(),m=["indices"],l=["normal","tangent"],n=["color","group"],s=["position","texcoord","texcoord2"],r=0;r<g.length;r++)for(var u=g[r].submeshes,
q=0;q<u.length;q++)for(var t in u[q]){var v=u[q][t][1];if(-1!=m.indexOf(t)){var B=4*u[q][t][0]+f["int"],y=u[q],x=t,A=d;if(k)var z=new Uint32Array(A,B,v);else for(var z=new Uint32Array(v),A=new DataView(A),w=0;w<v;w++)z[w]=A.getUint32(B+4*w,!0);y[x]=z}else if(-1!=s.indexOf(t))B=4*u[q][t][0]+f["float"],u[q][t]=p(d,B,v,k);else if(-1!=l.indexOf(t)){B=2*u[q][t][0]+f["short"];y=u[q];x=t;A=d;z=new Float32Array(v);A=new DataView(A);for(w=0;w<v;w++)z[w]=A.getInt16(B+2*w,!0)/32767;y[x]=z}else if(-1!=n.indexOf(t)){B=
2*u[q][t][0]+f.ushort;y=u[q];x=t;A=d;z=new Float32Array(v);A=new DataView(A);for(w=0;w<v;w++)z[w]=A.getUint16(B+2*w,!0)/65535;y[x]=z}}for(t=0;t<h.length;t++)for(g=h[t].particle_systems,m=0;m<g.length;m++)l=g[m],l.transforms=p(d,4*l.transforms[0]+f["float"],l.transforms[1],k);for(h=0;h<a.length;h++){t=a[h];var g=t.fcurves,l=t.frame_range,m=l[0],l=l[1],n=ha.UB(m,l),s=null,u=r=!1,C;for(C in g)r|=-1<C.indexOf("rotation_euler"),u|=-1<C.indexOf("rotation_quaternion");for(C in g)if(r&&u&&-1<C.indexOf("rotation_euler"))delete g[C];
else{var q=g[C],F;for(F in q)v=q[F],B=p(d,f["float"]+4*v.bin_data_pos[0],v.bin_data_pos[1],k),y=new Float32Array(n),null===s&&(s=new Int8Array(n)),ha.oz(v,B,y,s,m,l),v.mc=y;-1<C.indexOf("rotation_euler")&&ha.qB(g,C)}t.Jy=s}e(b,c)}function p(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function k(a,b,c,d,e){var f=a.cameras,h=a.groups,g=a.materials,k=a.meshes,m=a.node_groups,l=a.objects,n=a.particles,p=
a.scenes,s=a.speakers,r=a.textures,q=a.worlds;m||(ja.warn('B4W Warning: "node_groups" datablock undefined. reexport main scene.'),m=a.node_groups=[]);for(var t="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),B={},y=0;y<t.length;y++)for(var x=a[t[y]],A=0;A<x.length;A++){var z=x[A];B[z.uuid]=z}for(var w=0;w<p.length;w++){for(var C=p[w],F=C.objects,D=0;D<F.length;D++)H(F,D,B);C.camera&&H(C,"camera",
B);C.world&&H(C,"world",B)}for(w=0;w<h.length;w++)for(var K=h[w].objects,D=0;D<K.length;D++)H(K,D,B);for(w=0;w<l.length;w++){var I=l[w];I.dupli_group&&H(I,"dupli_group",B);I.parent&&H(I,"parent",B);if(I.animation_data){var J=I.animation_data;J.action&&H(J,"action",B);if(J.nla_tracks)for(D=0;D<J.nla_tracks.length;D++)for(var L=J.nla_tracks[D],M=0;M<L.strips.length;M++)L.strips[M].action&&H(L.strips[M],"action",B)}switch(I.type){case "MESH":if(!I.data)throw"mesh not found for object "+I.name;H(I,"data",
B);for(var N=I.modifiers,D=0;D<N.length;D++){var O=N[D];"ARMATURE"==O.type?H(O,"object",B):"CURVE"==O.type&&H(O,"object",B)}var P=I.particle_systems;if(P)for(D=0;D<P.length;D++)H(P[D],"settings",B);break;case "ARMATURE":H(I,"data",B);for(var Q=I.pose.bones,ka=I.data.bones,D=0;D<Q.length;D++){var U=Q[D];U.bone=ka[U.bone];for(var R=U.parent_recursive,M=0;M<R.length;M++)R[M]=Q[R[M]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":H(I,"data",B)}var Y=I.constraints;if(Y)for(D=0;D<Y.length;D++){var S=
Y[D];S.target&&H(S,"target",B)}var T=I.lod_levels;if(T)for(D=0;D<T.length;D++){var ta=T[D];ta.object&&H(ta,"object",B)}}for(w=0;w<k.length;w++)for(var Z=k[w].materials,D=0;D<Z.length;D++)H(Z,D,B);for(w=0;w<g.length;w++){for(var aa=g[w],X=aa.texture_slots,D=0;D<X.length;D++)H(X[D],"texture",B);var ba=aa.node_tree;ba&&u(ba,B)}for(w=0;w<m.length;w++)(ba=m[w].node_tree)&&u(ba,B);for(w=0;w<r.length;w++){var ea=r[w],G=ea.type;"IMAGE"!=G&&"ENVIRONMENT_MAP"!=G||H(ea,"image",B)}for(w=0;w<f.length;w++){var la=
f[w];la.dof_object&&H(la,"dof_object",B)}for(w=0;w<s.length;w++){var ma=s[w];ma.sound&&H(ma,"sound",B);if(ma.animation_data&&(J=ma.animation_data,J.action&&H(J,"action",B),J.nla_tracks))for(D=0;D<J.nla_tracks.length;D++)for(L=J.nla_tracks[D],M=0;M<L.strips.length;M++)L.strips[M].action&&H(L.strips[M],"action",B)}for(w=0;w<n.length;w++){for(var pa=n[w],X=pa.texture_slots,D=0;D<X.length;D++)H(X[D],"texture",B);pa.dupli_group&&H(pa,"dupli_group",B);pa.dupli_object&&H(pa,"dupli_object",B)}for(w=0;w<q.length;w++)if(X=
q[w].texture_slots)for(D=0;D<X.length;D++)H(X[D],"texture",B);fa.Pz(a);Aa=0===b.id;Ia||(Ia=a.scenes[0]);for(var na=a.textures,W=Aa?a.scenes[0].b4w_anisotropic_filtering:Ia.b4w_anisotropic_filtering,wa=0;wa<na.length;wa++)Aa||"SCENE"!=na[wa].b4w_source_type||(na[wa].b4w_source_id=""),Ma.IA(na[wa],W,a.scenes);for(var sa={},Ca=a.objects,ua=0;ua<Ca.length;ua++){var Ga=Ca[ua];if("MESH"===Ga.type&&!Ga.particle_systems.length)for(var Na=Ga.data,gb=Na.name,lb=Na.submeshes,mb=Na.materials,cb=0;cb<lb.length;cb++)0!==
lb[cb].base_length||sa[gb]||(mb[cb]&&ja.warn('B4W Warning: material "'+mb[cb].name+'" is not assigned to any face (object "'+Ga.name+'").'),sa[gb]=!0)}for(var ob=a.meshes,Ka=0;Ka<ob.length;Ka++){var Ha=ob[Ka];Ha.materials.length||Ha.uv_textures.length&&ja.warn('B4W Warning: mesh "'+Ha.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},
raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",
b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});for(var ic=a.meshes,qb=za.Kc("name","DEFAULT",a.materials),Wb=0;Wb<ic.length;Wb++){var Xb=ic[Wb];0==Xb.materials.length&&
Xb.materials.push(qb)}for(var Tb=a.actions,Qb=b.id,fc=0;fc<Tb.length;fc++){var Yb=Tb[fc];Yb.Ly=Qb;ha.Vy(Yb)}for(var kb=a.scenes,Bb=0;Bb<kb.length;Bb++){for(var yc=kb[Bb],zc=ia.Sm(yc,"ALL"),rc=[],Zb=0;Zb<zc.length;Zb++)for(var sc=zc[Zb].particle_systems,Lb=0;Lb<sc.length;Lb++){var rb=sc[Lb].settings;if("HAIR"==rb.type)if("OBJECT"==rb.render_type)qa.Mp(rb.dupli_object,!0);else if("GROUP"==rb.render_type){for(var Cb=rb.dupli_group,gc=ia.Sm(yc,"EMPTY"),ub=0;ub<gc.length;ub++)gc[ub].dupli_group==Cb&&rc.push(gc[ub]);
for(ub=0;ub<Cb.objects.length;ub++)qa.Mp(Cb.objects[ub],!0)}else ja.warn("B4W Warning: render type",rb.render_type,"not supported for particle systems ("+rb.name+").")}for(Zb=0;Zb<rc.length;Zb++)E(rc[Zb],[yc])}ca(a,b.id);for(var Kc=a.scenes,Ac=0;Ac<Kc.length;Ac++){for(var nd=Kc[Ac],Lc=[],Bc=[],Gc=Kc[Ac].objects,Db=0;Db<Gc.length;Db++){var Zc=Gc[Db];v(Gc,Zc,Lc,Bc);var Hc=Zc.dupli_group;if(Hc)for(var Mc=Hc.objects,Cc=0;Cc<Mc.length;Cc++)v(Mc,Mc[Cc],Lc,Bc)}for(Db=0;Db<Bc.length;Db++)E(Bc[Db],[nd]);for(Db=
0;Db<Lc.length;Db++)za.kz(Lc[Db][0],Lc[Db][1])}ca(a,b.id);var fb=V(a,b.id);fa.tz(fb,a.scenes);for(wa=0;wa<fb.length;wa++){var hc=fb[wa];!Aa&&hc.parent&&-1<Jb.indexOf(hc.parent.type)&&(hc.parent="");qa.Mp(hc,!1);hc.d.Rd=b.id}for(var Nc=0;Nc<fb.length;Nc++){var Ic=fb[Nc];if("MESH"==Ic.type){var Oc=ha.Fi(Ic);if(Oc){var Pc=Oc.d;if(Pc.we){var Qc=Ic.d.Fc,Rc=[],$c;for($c in Qc){var Sc=Qc[$c];Rc.push(4*Sc.si,4*Sc.tr)}Pc.Cu.push(Rc)}Pc.Ll.push(Ic.d)}}}for(var fd=-1,tc=0;tc<fb.length;tc++){var Mb=fb[tc],uc=
Mb.d;if(za.rc(Mb)&&uc.Pi){var vc=uc.Tc;vc>fd&&(fd=vc)}}for(tc=0;tc<fb.length;tc++)if(Mb=fb[tc],uc=Mb.d,za.rc(Mb)&&uc.Pi){uc.Tc=fd;var ad=Mb,Dc=uc.Tc,bd=La.Tc,Tc=ad.d;Dc>2*bd?za.ma('B4W Error: too many bones for "'+ad.name+'"'):Dc>bd?(ja.warn('B4W Warning: too many bones for "'+ad.name+'" / '+Dc+" bones (max "+bd+"). Blending between frames will be disabled."),Tc.Ai=!1):Tc.Ai=!0;Tc.Ai=Tc.Ai&&!ra.Rs}for(var cd=0;cd<fb.length;cd++){var Rb=fb[cd];if(za.rc(Rb)){var td=Rb.lod_levels.length;if(td)for(var ed=
Rb,Fc=0;Fc<td;Fc++){var Jc=Rb.lod_levels[Fc].object;if(!Jc){ed.d.el=!0;ed.d.Oe=Rb.lod_levels[Fc].distance;break}Jc.d.eg=Rb.d.eg;ed.d.Oe=Rb.lod_levels[Fc].distance;Jc.d.Ti=Rb.lod_levels[Fc].distance;if(Rb.lod_levels[Fc+1])Jc.d.Oe=Rb.lod_levels[Fc+1].distance;else{Jc.d.el=!0;Jc.d.Oe=1E4;break}ed.d.el=!1;ed=Jc}}}for(var md=0;md<fb.length;md++){var ga=fb[md];if(ga.b4w_vehicle){var ab=ga.b4w_vehicle_settings;if("CHASSIS"==ab.part){ga.i={};ga.i.Ps=ab.force_max;ga.i.ur=ab.brake_max;ga.i.qF=ab.suspension_compression;
ga.i.sF=ab.suspension_stiffness;ga.i.rF=ab.suspension_damping;ga.i.eG=ab.wheel_friction;ga.i.pL=ab.roll_influence;ga.i.mD=ab.max_suspension_travel_cm;ga.i.$g=0;ga.i.ki=1;ga.i.Ih=0;ga.i.speed=0;ga.i.sg=[];ga.i.gj=[];ga.i.Jh=null;for(var ud=ga.Tb?ga.Tb.dupli_group.objects:fb,Uc=0;Uc<ud.length;Uc++){var Pa=ud[Uc];if(Pa.b4w_vehicle){var hb=Pa.b4w_vehicle_settings;if(oa.SC(Pa)&&ab.name==hb.name){var vd=oa.fG(Pa.b4w_vehicle_settings.part);ga.i.sg[vd]=Pa;ga.i.gj[vd]=new Float32Array(8)}else if(oa.nu(Pa)&&
ab.name==hb.name){ga.i.Jh=Pa;ga.i.tp=hb.steering_max;ga.i.Aw=hb.steering_ratio;ga.i.hu=hb.inverse_control;var vb=Qa.invert(ga.d.N,new Float32Array(16)),gd=Qa.multiply(vb,Pa.d.N,vb);ga.i.Cw=gd;var Vc=new Float32Array([1,0,0,0]);Xa.transformMat4(Vc,gd,Vc);ga.i.Bw=Vc}else if(oa.mu(Pa)&&ab.name==hb.name){ga.i.pp=Pa;ga.i.vw=hb.speed_ratio;ga.i.qo=hb.max_speed_angle;var vb=Qa.invert(ga.d.N,new Float32Array(16)),hd=Qa.multiply(vb,Pa.d.N,vb);ga.i.xw=hd;var Wc=new Float32Array([1,0,0,0]);Xa.transformMat4(Wc,
hd,Wc);ga.i.ww=Wc}else if(oa.ou(Pa)&&ab.name==hb.name){ga.i.wp=Pa;ga.i.ts=hb.delta_tach_angle;var vb=Qa.invert(ga.d.N,new Float32Array(16)),id=Qa.multiply(vb,Pa.d.N,vb);ga.i.Kw=id;var Xc=new Float32Array([1,0,0,0]);Xa.transformMat4(Xc,id,Xc);ga.i.Jw=Xc}}}if(4!=ga.i.sg.length)throw"Not enough wheels for chassis "+ga.name;}else if("HULL"==ab.part){ga.i={};ga.i.sg=[];ga.i.gj=[];ga.i.Ps=ab.force_max;ga.i.ur=ab.brake_max;ga.i.wn=ab.floating_factor;ga.i.Up=ab.water_lin_damp;ga.i.Vp=ab.water_rot_damp;ga.i.$g=
0;ga.i.ki=1;ga.i.Ih=0;ga.i.speed=0;ga.i.Jh=null;for(var wd=ga.Tb?ga.Tb.dupli_group.objects:fb,Uc=0;Uc<wd.length;Uc++)Pa=wd[Uc],Pa.b4w_vehicle&&(hb=Pa.b4w_vehicle_settings,oa.RC(Pa)&&ab.name==hb.name?(ga.i.sg.push(Pa),ga.i.gj.push(new Float32Array(8))):oa.nu(Pa)&&ab.name==hb.name?(ga.i.Jh=Pa,ga.i.tp=hb.steering_max,ga.i.Aw=hb.steering_ratio,ga.i.hu=hb.inverse_control,vb=Qa.invert(ga.d.N,new Float32Array(16)),gd=Qa.multiply(vb,Pa.d.N,vb),ga.i.Cw=gd,Vc=new Float32Array([1,0,0,0]),Xa.transformMat4(Vc,
gd,Vc),ga.i.Bw=Vc):oa.mu(Pa)&&ab.name==hb.name?(ga.i.pp=Pa,ga.i.vw=hb.speed_ratio,ga.i.qo=hb.max_speed_angle,vb=Qa.invert(ga.d.N,new Float32Array(16)),hd=Qa.multiply(vb,Pa.d.N,vb),ga.i.xw=hd,Wc=new Float32Array([1,0,0,0]),Xa.transformMat4(Wc,hd,Wc),ga.i.ww=Wc):oa.ou(Pa)&&ab.name==hb.name&&(ga.i.wp=Pa,ga.i.ts=hb.delta_tach_angle,vb=Qa.invert(ga.d.N,new Float32Array(16)),id=Qa.multiply(vb,Pa.d.N,vb),ga.i.Kw=id,Xc=new Float32Array([1,0,0,0]),Xa.transformMat4(Xc,id,Xc),ga.i.Jw=Xc))}}}for(var od=0;od<
fb.length;od++){var wc=fb[od];if(wc.b4w_floating){var jd=wc.b4w_floating_settings;if("MAIN_BODY"==jd.part){wc.Pc={};wc.Pc.wn=jd.floating_factor;wc.Pc.Up=jd.water_lin_damp;wc.Pc.Vp=jd.water_rot_damp;wc.Pc.bk=[];for(var xd=wc.Tb?wc.Tb.dupli_group.objects:fb,pd=0;pd<xd.length;pd++){var dd=xd[pd];if(dd.b4w_floating){var yd=dd.b4w_floating_settings;oa.VC(dd)&&jd.name==yd.name&&(wc.Pc.bk.push(dd),dd.Dz=dd.b4w_floating_settings.synchronize_position)}}}}}e(b,c)}function y(a,b,c,d,e){!Aa&&1<a.scenes.length&&
(a.scenes=[a.scenes[0]],ja.warn("B4W Warning: loading data contains multiple scenes.","Only the first one will be loaded."));-1==ra.Ia&&Aa&&(ra.Ia=a.scenes[0].fps);for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];if(Aa&&!f.camera)throw"Scene check failed: No camera";for(var h=ia.Sm(f,"MESH"),g=0;g<h.length;g++){var k=h[g],m=fa.mz(k);m&&(a.meshes.push(m),k.data=m)}for(var g=V(a,b.id),k=a.meshes,m=k.slice(0),l=0;l<g.length;l++){var n=g[l];"MESH"==n.type&&(n=m.indexOf(n.data),-1<n&&m.splice(n,1))}for(l=
0;l<m.length;l++)k.splice(k.indexOf(m[l]),1);Aa?(ia.az(f,a.textures),f.d.Zh.length&&(b.Xn=!0),lb.enabled&&f.b4w_enable_physics&&oa.gr(f),f.b4w_enable_audio&&ua.hr(f),g=ia.Hn(f),k=f.b4w_batch_grid_size):(ia.hz(f,Ia,a.textures),lb.enabled&&f.b4w_enable_physics&&!Ia.l&&oa.gr(Ia),f.b4w_enable_audio&&!Ia.h&&ua.hr(Ia),g=ia.Hn(Ia),k=Ia.b4w_batch_grid_size);h=ba.KB(g,k,h,f.world,Ia.d.qu);Aa?(ia.Sq(f,h),ia.EB(g)):ia.Sq(Ia,h)}d=a.materials;if(Ca.hn&&La.Xw)for(a=0;a<d.length;a++){f=d[a];k=f.texture_slots;for(h=
0;h<k.length;h++)if(m=k[h],l=m.texture,"IMAGE"==l.type||"ENVIRONMENT_MAP"==l.type)g=l.image,g.lc||(-1<g.filepath.indexOf(".dds")?g.lc=!0:(g.lc=!l.b4w_disable_compression&&!m.use_map_normal&&"ENVIRONMENT_MAP"!=l.type&&!l.b4w_shore_dist_map&&"MOVIE"!=g.source,g.lc&&(g.filepath+=".dds")));if(h=f.node_tree)for(k=h.nodes,h=0;h<k.length;h++)g=k[h],"TEXTURE"==g.type&&((m=g.texture)?(g=m.image)&&!g.lc&&(g.lc=m.d.Tj&&!m.b4w_disable_compression&&"MOVIE"!=g.source,g.lc&&(g.filepath+=".dds")):ja.warn("B4W Warning: material ",
f.name," has empty textures."))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],f.lc=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));e(b,c)}function m(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},h={},g={},k={},m=0;m<d.length;m++){var l=d[m];f[l.uuid]=l;g[l.uuid]=l}for(m=0;m<a.length;m++)l=a[m],h[l.uuid]=l,k[l.uuid]=l;s(a,null,k,g);for(var n in g)n in f||d.push(g[n]);for(n in k)n in h||a.push(k[n]);e(b,c)}function s(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var h=a[f],g=c[h.uuid];if(h=g.proxy){b&&
-1==e.indexOf(h.uuid)&&e.push(h.uuid);for(var k=c[h.uuid],m=k.constraints,h=0;h<m.length;h++){var l=za.Df(m[h]);l.name+="_CLONE";g.constraints.push(l)}"b4w_proxy_inherit_anim"in g&&!g.b4w_proxy_inherit_anim||(g.animation_data&&(k.animation_data=za.Df(g.animation_data)),k.b4w_use_default_animation=g.b4w_use_default_animation,k.b4w_auto_skel_anim=g.b4w_auto_skel_anim,k.b4w_anim_behavior=g.b4w_anim_behavior,k.b4w_cyclic_animation=g.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)g=za.In(a,"uuid",e[f]),
-1<g&&a.splice(g,1);e={};for(f=0;f<a.length;f++)h=a[f],g=c[h.uuid],b&&(m=za.Df(g),g="origin_name"in g?g.origin_name:g.name,m.name=b+"*"+g,m.origin_name=g,B(m),c[m.uuid]=m,e[h.uuid]=m.uuid,h.uuid=m.uuid),g=c[h.uuid],g.dupli_group&&(h=g.dupli_group,m=d[h.uuid],k=za.Df(m),k.name=za.Ul(m.name+"_CLONE"),k.uuid=K.au("Group"+k.name),d[k.uuid]=k,h.uuid=k.uuid,s(k.objects,g.name,c,d));if(b)for(f=0;f<a.length;f++){h=a[f];g=c[h.uuid];g.parent&&g.parent.uuid in e?g.parent.uuid=e[g.parent.uuid]:g.parent&&(ja.warn("B4W Warning: Object's \""+
g.name+'" parent is not in dupli group. Disabling parenting.'),g.parent=null);m=g.constraints;for(h=0;h<m.length;h++)b=m[h],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=g.modifiers;for(h=0;h<b.length;h++)d=b[h],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((g=g.lod_levels)&&g.length)for(h=0;h<g.length;h++)b=g[h],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var n in e)sa[n]=e[n]}function B(a){a.uuid=K.au("Object"+a.name)}function u(a,b){for(var c=
a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&H(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in sa&&(e.lamp.uuid=sa[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&H(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var f=e[d];A(f,"from_node",c);A(f,"to_node",c);x(f,"from_socket",f.from_node.outputs);x(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&H(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],
f=0;f<e.strips.length;f++)e.strips[f].action&&H(e.strips[f],"action",b)}function H(a,b,c){(c=c[a[b].uuid])||ja.error("Dangling link found:",b,a);a[b]=c}function A(a,b,c){c=za.Kc("name",a[b].name,c);a[b]=c}function x(a,b,c){c=za.Kc("identifier",a[b].identifier,c);a[b]=c}function f(a,c,d,e,f,h){if(!La.do_not_load_resources){for(var g=Z(c.r),k=a.images,m={},l=[],n=0;n<k.length;n++){var p=k[n],s=p.uuid;if("FILE"===p.source||"MOVIE"===p.source){var r=F(p,a.textures);if(!r.length)ja.warn("B4W Warning: image ",
p.name," has no users.");else if(!(r[0].b4w_shore_dist_map||"MOVIE"===p.source&&La.Ks)){r=X(g+p.filepath);if("FILE"===p.source){var u=p.lc?Y.Ej:Y.Fj;Ca.ro&&La.Xl&&(r=Y.sj(r),"dds"==r[1]?(r=Y.sj(r[0]),r=r[0]+".min50."+r[1]+".dds"):r=r[0]+".min50."+r[1])}else"MOVIE"===p.source&&(La.Xc?(r=Y.sj(r),r=r[0]+".altconv.seq",u=Y.Gj):(r=Y.sj(r),u=ua.on(r[1]),r=u!=r[1]?r[0]+".altconv."+u:r[0]+"."+u,u=Y.Hj));l.push([s,u,r]);m[s]=p}}}l.length?(e.bu=0,Y.qc(l,function(f,g,k,n){if(f){if(k==Y.Hj||k==Y.Gj){if(k==Y.Hj)var p=
f.videoWidth,s=f.videoHeight;else p=f.images[0].width,s=f.images[0].height;ja.log("%cLOAD VIDEO "+p+"x"+s,"color: #"+(2048<p||2048<s?"a00":1024<p||1024<s?"aa0":"0a0"),n);-1==n.indexOf(wa)&&ja.warn("B4W Warning: video",n,"is not from app root.")}else b(f,n,!0);g=m[g];n=F(g,a.textures);for(p=0;p<n.length;p++){var s=n[p],r=s.image.filepath;k==Y.Gj?(s.d.Gv=f.Zb,Ma.xj(s.d,f.images,g.lc,r)):Ma.xj(s.d,f,g.lc,r)}}f=++e.bu/l.length;h(c,d,f)},function(){ja.log("%cLOADED ALL IMAGES","color: #0a0");f(c,d)})):
f(c,d)}}function F(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function h(a,b,c,d,e,f){if(!La.do_not_load_resources){a=V(a,b.id);for(var h=Z(b.r),g=[],k={},m=0;m<a.length;m++){var l=a[m];if(z(l)){var n=l.data.sound,p=n.uuid;"BACKGROUND_MUSIC"==ua.On(l)?(p=za.DB(),b.Un=!0):"NONE"!=ua.On(l)&&La.eu&&(b.Zn=!0);if(!(p in k)){k[p]=[];n=X(h+n.filepath);switch(ua.sw(l)){case ua.em:var s=Y.Zp;break;case ua.Xp:s=Y.$p}var n=Y.sj(n),r=ua.nn(n[1]),n=r!=n[1]?n[0]+".altconv."+
r:n[0]+"."+r;g.push([p,s,n])}k[p].push(l)}}g.length?Y.qc(g,function(a,e,h,m){if(a)for(ja.log("%cLOAD SOUND","color: #0aa",m),-1==m.indexOf(wa)&&ja.warn("B4W Warning: sound",m,"is not from app root."),e=k[e],h=0;h<e.length;h++)ua.PF(e[h],a);a=++d.WE/g.length;f(b,c,a)},function(){ja.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)}):e(b,c)}}function z(a){return ua.ce(a)&&ua.sw(a)!=ua.Yp?!0:!1}function D(a,b){for(var c=ia.Hb(a,"SPEAKER",ia.V),d=0;d<c.length;d++){var e=c[d];ua.ce(e)&&(ua.jh(e)||b)&&ua.Fo(e)}}
function I(a){a=a.d.Zh;for(var b=0;b<a.length;b++)La.Xc&&a[b].use_auto_refresh?a[b].d.wh=!0:a[b].d.gb&&a[b].use_auto_refresh&&a[b].d.gb.play()}function r(a,b,c,d,e){O.start();ja.log("%cSTART NLA","color: #0a0");e(b,c)}function v(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,f=0;f<e;f++){var h=b.lod_levels[f],g=h.object;if(g){var k=za.ni(g);k.name=b.name+"_LOD_"+String(f+1);B(k);k.lod_levels=[];c.push([a,k]);d.push(g);h.object=k}}}function E(a,b){for(var c=0;c<b.length;c++){for(var d=
b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=f.objects,h=f.indexOf(a),-1<h&&f.splice(h,1))}var h=d.indexOf(a);-1<h&&d.splice(h,1)}}function e(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d],h=Aa?f.b4w_enable_physics:Ia.b4w_enable_physics||f.b4w_enable_physics;Aa||(f=Ia);for(var g=0;g<ob.length;g++)for(var k=ia.Hb(f,ob[g],ia.V),m=0;m<k.length;m++){var l=k[m];l.d.Rd==b.id&&lb.enabled&&h&&(oa.Lg(l,f),b.yu&&oa.B(l)&&oa.uk(l))}}e(b,c)}function t(a,c,d,e,f){var h={};e=[];for(var g=
a.scenes,k=0;k<a.scenes.length;k++){var m=g[k];if(m.d.Va&&(m=m.d.Va.Kl)&&"FILE"===m.source){var l=m.uuid,n=X(Z(c.r)+m.filepath);e.push([l,m.lc?Y.Ej:Y.Fj,n]);h[l]=m}}e.length?Y.qc(e,function(c,d,e,f){if(c){b(c,f,!0);d=h[d];f=F(d,a.textures);for(e=0;e<f.length;e++){var k=f[e];Ma.xj(k.d,c,d.lc,k.image.filepath)}for(e=0;e<g.length;e++)if(f=g[e],f.d.Va.Kl===d){var m=c,l=d,n=document.createElement("canvas"),k=l.size[0],l=l.size[1];n.width=k;n.height=l;n=n.getContext("2d");n.drawImage(m,0,0);m=n.getImageData(0,
0,k,l).data;n=new Float32Array(4);n[0]=1/16581375;n[1]=1/65025;n[2]=1/255;n[3]=1;for(var k=k*l,l=new Float32Array(k),p=0;p<k;p++)l[p]=n[1]*m[4*p+2]+n[2]*m[4*p+3];f.d.gp=l}}},function(){f(c,d)}):f(c,d)}function l(a,c,d,e,f){if(La.antialiasing&&La.smaa){e=a.scenes[0];a=[];for(var h=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],g=0;g<h.length;g++){var k=ia.qa(e,h[g]);k&&a.push(k)}if(a.length){e=[];g=Y.Fj;e.push(["SEARCH_TEXTURE",g,Q.dc.smaa_search_texture_path]);
e.push(["AREA_TEXTURE",g,Q.dc.smaa_area_texture_path]);for(g=0;g<a.length;g++)if(h=a[g],"SMAA_BLENDING_WEIGHT_CALCULATION"==h.type){a=h.ja;for(g=0;g<a.length;g++)if(h=a[g],"u_search_tex"==h.ka)var m=h.na;else if("u_area_tex"==h.ka)var l=h.na;break}e.length?Y.qc(e,function(a,c,d,e){a&&(b(a,e,!1),c="SEARCH_TEXTURE"==c?m:l,c.source="IMAGE",c.mr=!0,Ma.xj(c,a,-1!=e.indexOf(".dds")?1:0,e),Ma.ap(c,Ma.C,Ma.C))},function(){f(c,d)}):f(c,d)}else f(c,d)}else f(c,d)}function N(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=
a.scenes[c];Aa||(e=Ia);for(var f=ia.Hb(e,"ALL",ia.V),h=0;h<f.length;h++){var g=f[h];g.d.Rd==b.id&&(b.yu&&za.rc(g)&&ia.Uk(g),d.Tq.push({kE:e,nl:g}))}}}function J(a,b,c,d,e,f){a=d.Tq;var h=d.Lu;a.length?(e=a[h].nl,h=a[h].kE,ia.Lg(h,e),-1!=Tb.indexOf(e.type)&&h.b4w_enable_audio&&ua.Lg(e,h),d=++d.Lu/a.length):d=1;f(b,c,d)}function C(a,b,c,d,e){if(Aa){d=ia.oC();for(var f=d[d.length-1],h=0;h<d.length;h++){var g=d[h];ia.UE(g);ia.OF(g);ia.KD(g,f);g.b4w_use_nla&&O.LF(g,g.b4w_nla_cyclic)}ia.Xo(f)}else ia.Ww(Ia);
a=V(a,b.id);qa.JF(a);e(b,c)}function R(a,b,c,d,e){if(Aa)for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||I(a.scenes[d]),D(a.scenes[d]);else a.scenes[0].b4w_use_nla||I(Ia),D(Ia);e(b,c)}function M(a,b,c,d,e){La.Vf&&(b.Xn||b.Un||b.Zn)?Ga||P(a,e,b,c):e(b,c)}function P(a,b,c,d){var e=cb.canvas.parentElement;mb=e.style.zIndex;e.style.zIndex="999";Ga=document.createElement("div");Ga.style.position="relative";Ga.style.height="88px";Ga.style.width="88px";var f=Math.round(cb.canvas.offsetWidth/2-44);
Ga.style.top=Math.round(cb.canvas.offsetHeight/2-44).toString()+"px";Ga.style.left=f.toString()+"px";Ga.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAYAAABxlTA0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAhOSURBVHic7Z1tjFxVGcd/z1AKsbzotoW0IQqFhpSXFlugxbbGRkNSLJEQLVJttH7VEl8+oCYYExLFDxilJib6AWshtlterN20hkBKsNitpFVapB9YIzGBWEq3+IKCLf374Tx3587szGxn5577Mt1fcnN37r1zznP+c/a55557znOMkiDJgLnAADDT9+ktOQYwChwHTvh+tGl7zcyUp/3tsCIzlzQdWAwsA24CLs4o6X8ALwDDwEEz+19G6XZN7gJLugi4mSDqh4HzUqffBN6gXkPT++RvaKzhM5v2lwCzUmm+C/yRIPYfzOyfMcrVjlwE9n//lcAngQVALXV6hFD435vZ3zLK74PARwg/4lWpU6eBI8Au4Lk83Eh0gSUtBDYA8/3QaeAlYB8wbGbHIuc/myD0LcB11H/cEeBhM3sxZv7RBJZ0OfBF4EY/9CawDdhrZv+Kle8ENl0IrADuou5GDhKE/muMPDMXWNIs4PPAxz39t4FBYGeRN5s0fnO9HVgLzAAE7AG2ZP0flZnAkmrAOuBOYDpwEhgCBouqsRPhNXotsAY4l2DzDoLQ72WRRyYCS7oAuJfQKohWG2Lhfno9sIqgySHg+6WoGJIuk/QzSUOSHpF0TdE2TRZJ13gZhiT93FsjhRq0RNI2N2iTpEsKNSgDJM2S9GMv06CkGyf+Vnsm7SIk3QF8idDs2Qc8aGbv9GJMWZB0HvBVQttdhFbGE5NJq2uBJU0DvgJ8wg9tBR4ty7N /lkhaS/DNBjwDbDKzU7Ez/bL/+zwh6aNRMysBkpZK2u5l/lrszNZ4Ro9LujpqZiVC0ryUyHfGyuQGSTsk7ZS0PEomJcZr8k7ferrxtUp8rqSt/guuyzTxCiFpbap1cUZNuNpEF0iaAXwHuAB4HvhVb2ZWFzMbBH4HvA+4z58EO9JRYH/8vRe4DPgL8MN+bC10yY8IWswBviXpnE4XT1SDP0d44/AWcL+ZvZuJiRXGNbifoMlCQjOueyTNlvSk+5zrMrSxL/DH6p2u0ex213WqwesJPUzPm9lLmVtYcczsZUKn1rl0qMUtBZZ0BaFn6RSwOYaBfcIWQhfnKtdsHO1q8AbC4+Fvzez1SMZVHu+OHSJotaHVNeMElrSIcGP7L6GfIRqSdklaEDOPHBgkvLVZ7No10CCwv/1NfonHzeytyMatBg5JekjSwIRXlxDvlB/0jxtcw9ZIWumthl9KOj+2cWrkuKSN3ltXKSRNl/QL125l+lyzi7jV91sL6NsdAB4i1OjVOefdE/4yd5t/vDV9bkxgfyS+HngPeC4368azANhVQf+8lzDm43rXEmiswUuAacCfzezfORvXikr5Z/fFLxM0vCk5nhb4Ft8P52jXREwDNgKvVMQ/J9olWgaB3fAlfmx/zkadCVXxz4nAS3xwy1gNXkjognvVzI4WYdkZUmr/bGZ/B14FzgdugLrAy3xfJvfQiTL750TDZQA1bxgvbTpZBcrqnxMXu1SS1QijDGcCo2Y2Upxdk6Zs/nmEMFj8YmBOjSAuQNU7dUrhn/2NT6LlzBqNE0v6gTL450TLvhQYivfPiZYD/SpwQlH++awROCFv/9wgcHKTO97m4n4iL/+caHnW1OA0efjnlje5s6EGp4npnxtq8BQRqZGqzkUaUgCjwD3AQjPbnXHaiZajaYHL1mkSi1PAJmC+mcUasT7mdqdxdtXg3cA3zOxI5HwSLU+kBe7nGnyEIGzWrqAdYzW4RuqOl1PmeRLTz3 ZirOnbrzX4FPBT4LtmVkT7vq8FzsvPdqKlwHMLMiYr8vaznUi0PF4DjhH88ICkq9p/p7QU5Wdb4hoOEOIGvV7zHvix90iFWdY9ebRnJ0PyAnm/mSl5VB5uOll2dhNq7D0F3cQ60fCGPhH4EPAf4IqSz5g/AtxmZrcVfBNriaRLgcuBd4A/gQvs/14H/LoyuolS+dkOJNodSMLnpHvT9vm+TG6irH62HYl2iZakO5sPEAp0raQZZvZ2npa1oAzt2TPGZ31eS9DwheT4WA12QQ8TRF+Rt4EpSu1nO7AcOAc4nK6czR3uT/n+7mR0YI5Uxc+Ow7X6rH98Kn2uWeC9hKE/s4BPxTcNqJ6fbcXtBM1GCBq2R9Ki1JT9i2JaVfQwpyyQdKHqgaE6T+MC8FiOBwnjhe+OaVwF/WwrkuiBB1vFwWz30vNhQrSl1ZLmRDSu0vgk8DV4ZKpW17QU2ANl7iG0KL4Qy8A+IJkwv6ddcNFOr+2Tic4rpsIZjEchwuEqgkZb2l3XVmCf6Pykf/ymQlTVKRhzDd8mTALf0SlG50QDTx4hhOd+PyFGTd5t49KhEBXwPoImhwkataWjwGZ2GngAeA24EogbmK3k+HyWrwPzgKPA9zJptytEWE3aenf1nGBFkbTONdgu6UNZJ75Y0m88Tk0ZuzSjImm56oHp4pRf0h3+Cz4maV6UTEqIpCu9zEOSPtPNd7saXWlmvwaeJsxk/IGkm7v5fhXxMj5AKPOzZra9m+/3Gt5WwGYze6zbdKqApE8THrSS8LY/MbOT3aSRVYDmPYTYuqVYZaBXvDm6kfAg0VOA5l4NSYcYf7CE84a7RtKAlyWTEONZGJQOkr9ZFY4rLOlqL0NmQfJjLfPwLGGZhzeySD82PlRhPfAxMl7mYWqhkiosVJJGU0vtNJDnYlHHgEcJi0UVshyEQiy4FYSwvUnE1GotFtWMxi93dhJ4kTDgcH/ssWXeslnq2yKCK4CqL3eWRu0X7BPwC mGg3HDGC/Yt820+9XL234J9zajzkpNHCcEsTlBfZvJE02eoLzf5Ad/Sn+cCl6bS7P8lJ9uhqUVT80N9uuzv/wFReZvk3/McjgAAAABJRU5ErkJggg==')";
Na=document.createElement("div");Na.style.position="relative";Na.style.height=cb.canvas.offsetHeight.toString()+"px";Na.style.width=cb.canvas.offsetWidth.toString()+"px";Na.style.background="rgba(0, 0, 0, 0.5)";Na.style.zIndex="999";e.appendChild(Na);Na.appendChild(Ga);Ga.addEventListener("click",function(){c.Xn&&(Ma.play(),Ma.pause(),Ma.reset());if(c.Un){if(Aa)for(var e=0;e<a.scenes.length;e++)D(a.scenes[e],!0);else D(Ia,!0);ua.pause()}c.Zn&&ua.FD();S();b(c,d)},!1)}function S(){if(Ga){var a=cb.canvas.parentElement;
a.style.zIndex=mb;Na.removeChild(Ga);a.removeChild(Na);Ga=Na=null;mb=0}}function Z(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function L(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function X(a){var b=a.split("://",2);return 1<
b.length?(b[1]=L(b[1]),b.join("://")):L(a)}function V(a,b){gb[b]||ca(a,b);return gb[b]}function ca(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)w(c[e].objects,0,d);gb[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var h=c[f],g=0;g<h.length;g++)gb[b].push(h[g])}function w(a,b,c){c[b]=c[b]||[];for(var d=c[b],e=0;e<a.length;e++){var f=a[e],h=ea(f);d[h]=d[h]||[];(Aa||-1==Jb.indexOf(f.type))&&-1==d[h].indexOf(f)&&d[h].push(f);(f=f.dupli_group)&&w(f.objects,b+1,c)}}function ea(a){return(a=
a.parent||ha.Fi(a))?1+ea(a):0}var ha=q("__animation"),ba=q("__batch"),Q=q("__config"),T=q("__controls"),pa=q("__dds"),ma=q("__extensions");q("__lights");var U=q("__loader"),Y=q("__assets"),K=q("__md5"),qa=q("__objects"),oa=q("__physics"),ja=q("__print"),fa=q("__reformer"),aa=q("__renderer"),ia=q("__scenes"),O=q("__nla"),ua=q("__sfx"),ka=q("__shaders"),Ma=q("__textures"),ta=q("__nodemat"),za=q("__util"),Xa=q("vec4"),Qa=q("mat4"),La=Q.p,Ca=Q.Jd,lb=Q.zb,ra=Q.Hd,ic=Q.me,la=null,gb=null,wa="",Aa=!1,Ia=
null,sa={},Ga=null,Na=null,mb=0,Jb=["LAMP","CAMERA"],ob=["MESH","CAMERA","EMPTY"],Tb=["SPEAKER"],cb=null;a.be=function(a){return U.be(a)};a.update=function(){U.MF(la)};a.xc=function(a){cb=a};a.IF=function(a,b){if(Ga){Na.style.height=b.toString()+"px";Na.style.width=a.toString()+"px";var c=Math.round(a/2-44);Ga.style.top=Math.round(b/2-44).toString()+"px";Ga.style.left=c.toString()+"px"}};a.load=function(a,b,p,s,u){var q={load_main:{Ta:U.pf,jb:!1,G:[],mb:!1,pb:500,Ib:!1,Xa:g},duplicate_objects:{Ta:U.ed,
jb:!1,G:["load_main"],mb:!1,pb:50,Ib:!1,Xa:m},load_binaries:{Ta:U.pf,jb:!1,G:["load_main"],mb:!1,pb:500,Ib:!1,Xa:c},prepare_bindata:{Ta:U.ed,jb:!1,G:["duplicate_objects","load_binaries"],mb:!1,pb:0,Ib:!1,Xa:n},prepare_root_datablocks:{Ta:U.ed,jb:!1,G:["duplicate_objects","prepare_bindata"],mb:!1,pb:150,Ib:!1,Xa:k},prepare_root_scenes:{Ta:U.ed,jb:!1,G:["prepare_root_datablocks"],mb:!1,pb:350,Ib:!1,Xa:y},load_smaa_textures:{Ta:U.pf,jb:!0,G:["prepare_root_scenes"],mb:!1,pb:10,Ib:!0,Xa:l},load_shoremap:{Ta:U.pf,
jb:!0,G:["prepare_root_scenes"],mb:!1,pb:10,Ib:!0,Xa:t},load_textures:{Ta:U.pf,jb:!0,G:["prepare_root_scenes"],mb:!0,pb:500,Ib:!1,Xa:f,Cf:{bu:0}},add_physics_objects:{Ta:U.ed,jb:!1,G:["load_shoremap"],mb:!1,pb:20,Ib:!1,Xa:e},add_objects:{Ta:U.ed,jb:!1,G:["add_physics_objects"],mb:!1,pb:800,Ib:!1,Xa:N,Ng:J,mi:C,Cf:{Tq:[],Lu:0}},load_speakers:{Ta:U.pf,jb:!0,G:["add_objects"],mb:!0,pb:30,Ib:!1,Xa:h,Cf:{WE:0}},mobile_media_start:{Ta:U.ed,jb:!La.Vf,G:["load_textures","load_speakers"],mb:!0,pb:5,Ib:!1,
Xa:M,Ng:M},synchronize_media:{Ta:U.ed,jb:!0,G:["mobile_media_start"],mb:!0,pb:70,Ib:!1,Xa:R},start_nla:{Ta:U.ed,jb:!0,G:["mobile_media_start"],mb:!1,pb:5,Ib:!1,Xa:r}},v=U.At();v||(v=U.AA(),la=[],gb=[],sa={});la[v.zd.length]={};return U.JA(q,a,b,p,d,s||ic.jr,La.do_not_load_resources,u)};a.Vl=function(a){var b=U.At();if(!b||!b.zd.length||a&&!U.uF(b.zd[a]))ja.error("Unable to unload data!");else{if(0==a)ja.log("%cUNLOAD ALL","color: #00a"),ha.ba(),ua.ba(),O.ba(),ia.ba(),U.ba(),oa.ba(),qa.ba(),za.ba(),
aa.ba(),ta.ba(),ka.ba(),T.ba(),ma.ba(),Y.ba(),Ma.ba(),gb=null,sa={},Aa=!1,la=Ia=null;else{ja.log("%cUNLOAD DATA "+a,"color: #00a");ha.UD(a);for(var b=ia.Ck(),c=0;c<b.length;c++)for(var d=b[c],e=ia.Hb(d,"ALL",ia.V),f=e.length-1;0<=f;f--){var h=e[f];if(h.d.Rd==a){var g=d,k=h;ha.Ga(k)&&ha.remove(k);ia.hk(k);oa.B(k)&&(oa.uk(k),oa.VD(k));T.Og(k)&&T.ge(k);ia.XD(g,k);ua.ce(k)&&ua.YE(k);e.splice(f,1);g=ia.Hb(d,h.type,ia.V);h=g.indexOf(h);-1!=h&&g.splice(h,1)}}}S()}};a.Ov=function(a){wa=a}};b4w.module.__md5=function(a){function q(a,k){var n=a[0],m=a[1],s=a[2],q=a[3],n=b(n,m,s,q,k[0],7,-680876936),q=b(q,n,m,s,k[1],12,-389564586),s=b(s,q,n,m,k[2],17,606105819),m=b(m,s,q,n,k[3],22,-1044525330),n=b(n,m,s,q,k[4],7,-176418897),q=b(q,n,m,s,k[5],12,1200080426),s=b(s,q,n,m,k[6],17,-1473231341),m=b(m,s,q,n,k[7],22,-45705983),n=b(n,m,s,q,k[8],7,1770035416),q=b(q,n,m,s,k[9],12,-1958414417),s=b(s,q,n,m,k[10],17,-42063),m=b(m,s,q,n,k[11],22,-1990404162),n=b(n,m,s,q,k[12],7,1804603682),q=b(q,n,m,s,
k[13],12,-40341101),s=b(s,q,n,m,k[14],17,-1502002290),m=b(m,s,q,n,k[15],22,1236535329),n=g(n,m,s,q,k[1],5,-165796510),q=g(q,n,m,s,k[6],9,-1069501632),s=g(s,q,n,m,k[11],14,643717713),m=g(m,s,q,n,k[0],20,-373897302),n=g(n,m,s,q,k[5],5,-701558691),q=g(q,n,m,s,k[10],9,38016083),s=g(s,q,n,m,k[15],14,-660478335),m=g(m,s,q,n,k[4],20,-405537848),n=g(n,m,s,q,k[9],5,568446438),q=g(q,n,m,s,k[14],9,-1019803690),s=g(s,q,n,m,k[3],14,-187363961),m=g(m,s,q,n,k[8],20,1163531501),n=g(n,m,s,q,k[13],5,-1444681467),q=
g(q,n,m,s,k[2],9,-51403784),s=g(s,q,n,m,k[7],14,1735328473),m=g(m,s,q,n,k[12],20,-1926607734),n=d(m^s^q,n,m,k[5],4,-378558),q=d(n^m^s,q,n,k[8],11,-2022574463),s=d(q^n^m,s,q,k[11],16,1839030562),m=d(s^q^n,m,s,k[14],23,-35309556),n=d(m^s^q,n,m,k[1],4,-1530992060),q=d(n^m^s,q,n,k[4],11,1272893353),s=d(q^n^m,s,q,k[7],16,-155497632),m=d(s^q^n,m,s,k[10],23,-1094730640),n=d(m^s^q,n,m,k[13],4,681279174),q=d(n^m^s,q,n,k[0],11,-358537222),s=d(q^n^m,s,q,k[3],16,-722521979),m=d(s^q^n,m,s,k[6],23,76029189),n=
d(m^s^q,n,m,k[9],4,-640364487),q=d(n^m^s,q,n,k[12],11,-421815835),s=d(q^n^m,s,q,k[15],16,530742520),m=d(s^q^n,m,s,k[2],23,-995338651),n=c(n,m,s,q,k[0],6,-198630844),q=c(q,n,m,s,k[7],10,1126891415),s=c(s,q,n,m,k[14],15,-1416354905),m=c(m,s,q,n,k[5],21,-57434055),n=c(n,m,s,q,k[12],6,1700485571),q=c(q,n,m,s,k[3],10,-1894986606),s=c(s,q,n,m,k[10],15,-1051523),m=c(m,s,q,n,k[1],21,-2054922799),n=c(n,m,s,q,k[8],6,1873313359),q=c(q,n,m,s,k[15],10,-30611744),s=c(s,q,n,m,k[6],15,-1560198380),m=c(m,s,q,n,k[13],
21,1309151649),n=c(n,m,s,q,k[4],6,-145523070),q=c(q,n,m,s,k[11],10,-1120210379),s=c(s,q,n,m,k[2],15,718787259),m=c(m,s,q,n,k[9],21,-343485551);a[0]=n+a[0]&4294967295;a[1]=m+a[1]&4294967295;a[2]=s+a[2]&4294967295;a[3]=q+a[3]&4294967295}function d(a,b,c,d,g,n){b=(b+a&4294967295)+(d+n&4294967295)&4294967295;return(b<<g|b>>>32-g)+c&4294967295}function b(a,b,c,g,n,q,u){return d(b&c|~b&g,a,b,n,q,u)}function g(a,b,c,g,n,q,u){return d(b&g|c&~g,a,b,n,q,u)}function c(a,b,c,g,n,q,u){return d(c^(b|~g),a,b,n,
q,u)}var n="0123456789abcdef".split("");a.au=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var g=b.substring(d-64,d),B=[],u=void 0,u=0;64>u;u+=4)B[u>>2]=g.charCodeAt(u)+(g.charCodeAt(u+1)<<8)+(g.charCodeAt(u+2)<<16)+(g.charCodeAt(u+3)<<24);q(a,B)}b=b.substring(d-64);g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)g[d>>2]|=b.charCodeAt(d)<<(d%4<<3);g[d>>2]|=128<<(d%4<<3);if(55<d)for(q(a,g),d=0;16>d;d++)g[d]=0;g[14]=8*
c;q(a,g);for(b=0;b<a.length;b++){c=a[b];d="";for(g=0;4>g;g++)d+=n[c>>8*g+4&15]+n[c>>8*g&15];a[b]=d}return a.join("")}};b4w.module.debug=function(a,q){q("__batch");var d=q("__print"),b=q("__controls"),g=q("__debug"),c=q("__physics"),n=q("__scenegraph"),p=q("__scenes"),k=q("__sfx"),y=q("__textures"),m=q("__util");q("__config");var s=q("vec3");a.dL=function(){c.OA()};a.cL=function(a){d.log("O",c.rB(a));for(var b=c.OB().l.o,g=0;g<b.length;g++){var k=b[g];k.zb.L==a&&d.log("B",k)}};a.FM=function(){for(var a=p.u(),b=p.Hb(a,"MESH",p.V),a=p.qa(a,"MAIN_OPAQUE").o,c=0;c<b.length;c++){var g=b[c],k=g.d;if("DYNAMIC"==k.type)for(var f=
0;f<a.length;f++){var m=a[f];if(m.Y&&m.nb==k){d.log(g.name,g);break}}}};a.XK=function(a){for(var b=p.u(),c=p.Hb(b,"MESH",p.V),g=0;g<c.length;g++){var k=c[g];if(k.name==a){d.log("Object",k);for(var f=p.Dn(b),m=0;m<f.length;m++){for(var h=f[m],n=h.o,s=[],q=0;q<n.length;q++)n[q].nb==k.d&&s.push(n[q]);d.log("Subscene "+h.type,s)}}}};a.YK=function(){var a=p.u();console.log("Armatures: "+p.Hb(a,"ARMATURE",p.V).length);console.log("Cameras: "+p.Hb(a,"CAMERA",p.V).length);console.log("Curves: "+p.Hb(a,"CURVE",
p.V).length);console.log("Empties: "+p.Hb(a,"EMPTY",p.V).length);console.log("Lamps: "+p.Hb(a,"LAMP",p.V).length);console.log("Meshes: "+p.Hb(a,"MESH",p.V).length);console.log("Speakers: "+p.Hb(a,"SPEAKER",p.V).length)};a.Wi=function(){for(var a=0,b=p.u(),b=[p.qa(b,"MAIN_OPAQUE"),p.qa(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.o,g=0;g<d.length;g++){var f=d[g].n;f&&(a+=f.Wi)}}return a};a.kg=function(){for(var a=0,b=p.u(),b=[p.qa(b,"MAIN_OPAQUE"),p.qa(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=
b[c];if(d)for(var d=d.o,g=0;g<d.length;g++){var f=d[g].n;f&&(a+=f.kg)}}return a};a.TK=function(){var a=p.u(),a=[p.qa(a,"MAIN_OPAQUE"),p.qa(a,"MAIN_BLEND")];return a[0].o.length+a[1].o.length};a.tJ=function(){for(var a=p.u(),b=p.Dn(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var g=d.o,f=0;f<g.length;f++){var k=g[f].n,h=g[f].nb;k&&("COLOR_PICKING"!=d.type&&"GLOW_MASK"!=d.type||h.pl)&&(a[k.id]=k)}}var g=d=c=b=0,m;for(m in a)k=a[m],k=k.Gc,k.rk&&(d++,g+=k.rk/1048576),
b++,c+=k.rs/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:g}};a.VK=function(){for(var a=[],b=0,c=p.u(),c=[p.qa(c,"MAIN_OPAQUE"),p.qa(c,"MAIN_BLEND")],d=0;d<c.length;d++){var g=c[d];if(g)for(var g=g.o,f=0;f<g.length;f++){var k=g[f].n;if(k)for(var k=k.aa,h=0;h<k.length;h++){var m=k[h];if("IMAGE"===m.source||"ENVIRONMENT_MAP"===m.source){var n=m.Ua;-1===a.indexOf(n)&&(a.push(n),m=m.width*m.height*4/1048576/m.Tm,m*=1.3333,b+=m)}}}}return{number:a.length,memory:b}};a.UK=function(){for(var a=
[],b=0,c=p.u(),c=p.Dn(c),d=0;d<c.length;d++){var g=c[d];if("SINK"!=g.type){var f=g.j,k=[f.Db,f.Ic];k.push.apply(k,g.yd);for(g=0;g<k.length;g++){var h=k[g];y.Qi(h)&&-1==a.indexOf(h)&&(a.push(h),b+=f.width*f.height*y.uC(h))}}}return{number:a.length,memory:b/1024/1024}};a.eD=function(){var a=p.u();(a=p.qa(a,"MAIN_OPAQUE"))&&p.Au(a.j,a,[1,1,0])};a.hD=function(){var a=p.u(),b=p.qa(a,"MAIN_OPAQUE"),a=p.nF(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],g;switch(c){case 0:g=[1,0,0];break;
case 1:g=[0,1,0];break;case 2:g=[0,0,1];break;default:g=[1,0,1]}p.Au(d.j,b,g)}};a.sL=function(){for(var a=p.Ck(),b=0;b<a.length;b++)d.log(n.MA(p.Hn(a[b])))};a.tL=function(){};a.DI=b.debug;a.WK=function(a,b){return s.dist(a.d.g,b.d.g)};a.Fu=g.Fu;a.zk=g.zk;a.kv=g.kv;a.Go=g.Go;a.fJ=function(a,b){function c(){g.zk("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.XH=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),g=new Float32Array([0,
0,1]),f=new Float32Array([-1,0,0]),k=new Float32Array([0,-1,0]),h=new Float32Array([0,0,-1]);if(!m.Ae(a,m.Iy))throw"Wrong VEC3_IDENT";if(!m.Ae(b,m.Dy))throw"Wrong QUAT4_IDENT";if(!m.Ae(c,m.ad))throw"Wrong AXIS_X";if(!m.Ae(d,m.Ba))throw"Wrong AXIS_Y";if(!m.Ae(g,m.jc))throw"Wrong AXIS_Z";if(!m.Ae(f,m.Ij))throw"Wrong AXIS_MX";if(!m.Ae(k,m.rb))throw"Wrong AXIS_MY";if(!m.Ae(h,m.qf))throw"Wrong AXIS_MZ";};a.SK=function(){for(var a=k.Ik(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==k.On(c)&&k.Vi(c,
!0)}};a.Dr=function(a){g.Dr(a)};a.BL=function(a){var b=p.u();if(b=p.qa(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&p.LE(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&p.KE(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.IJ=function(){return d.fC()};a.hK=function(){return d.xC()};a.Nr=function(){return d.Nr()}};b4w.module.main=function(a,q){function d(){}function b(){}function g(){}function c(){window.performance||(F.log("Apply performance workaround"),window.performance={});var a=Date.now();if(window.performance.now)b=a-performance.now();else{F.log("Apply performance.now() workaround");window.performance.now=function(){return Date.now()-a};var b=a}M.aw(0);return b}function n(a,c){a.addEventListener("webglcontextlost",function(a){a.preventDefault();F.error("B4W Error: WebGL context lost");m()},!1);I.xc(c);
var d=I.yt();d&&F.log("%cRENDERER INFO:","color: #00a",c.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+c.getParameter(d.UNMASKED_RENDERER_WEBGL));l.xc(c);r.xc(c);R.xc(c);C.xc(c);D.xc(c);z.xc(c);N.gw(a.width,a.height,1,p("x"),p("y"));J.ac();b=H();B()}function p(a){if("x"==a)var b=V.offsetLeft;else if("y"==a)b=V.offsetTop;else return 0;return k(b,V,a)}function k(a,b,c){a=a||0;if(b=b.offsetParent){if("x"==c)var d=b.offsetLeft;else"y"==c&&(d=b.offsetTop);a=k(a+d,b,c)}return a}function y(){d=function(){}}
function m(){s()||(ea=performance.now()/1E3,J.pause(),t.pause(),R.pause())}function s(){return ha<ea}function B(){ma(B);var a=performance.now()/1E3;w||(w=a);var c=a-w;if(!(c<1/X.Qe)){for(var d=M.fh(),f=0;f<ba.length;f++)ba[f](d,c);s()||(ha>w&&(c-=ha-Math.max(ea,w)),d+=c,M.aw(d),D.update(),e.update(),z.update(),u(d,c),b(c));w=a}}function u(a,b){z.be()&&(v.reset(),P.update(b),E.update(a,b),J.update(a,b),A.update(b),z.be()&&(t.update(a,b),z.be()&&(d(b,a),z.be()&&(h.update(a,b),z.be()&&(N.update(a,b),
Q&&(Q(V.toDataURL()),Q=null))))))}function H(){var a=60,b=0,c=0,d=X.vB,e=X.uB;return function(f){a=S.Mb(1/f,a,f,d);b=S.Mb(0,b,f,d);c=(c+1)%e;0==c&&g(Math.round(a),Math.round(b))}}var A=q("__animation"),x=q("__compat"),f=q("__config"),F=q("__print"),h=q("__controls"),z=q("__data"),D=q("__debug"),I=q("__extensions"),r=q("__geometry"),v=q("__hud"),E=q("__nla"),e=q("__assets"),t=q("__physics"),l=q("__renderer"),N=q("__scenes"),J=q("__sfx"),C=q("__shaders"),R=q("__textures"),M=q("__time"),P=q("__transform"),
S=q("__util"),Z=q("__version"),L=f.context,X=f.p,V=null,ca=null,w=0,ea=0,ha=0,ba=[],Q=null,T=["webgl","experimental-webgl"],pa=null,ma=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/X.Qe)}}();a.ac=function(a,b){f.CE();F.JE(X.console_verbose);var d=Z.version()+" "+Z.type()+" ("+Z.gn()+")";F.log("%cINIT B4W ENGINE","color: #00a",
d);if(!window.WebGLRenderingContext)return null;d=c();V=a;x.lz();var e;e=null;for(var g=0;g<T.length;g++){var h=T[g];try{e=a.getContext(h,L)}catch(k){}if(e)break}if(!e)return null;pa=e;n(V,e);f.nz();x.yE(e);F.log("%cSET PRECISION:","color: #00a",X.precision);b?(v.ac(b),ca=b):(f.p.show_hud_debug_info=!1,f.me.kl=!1);t.NC(d);return e};a.Zo=function(a){D.Zo(a)};a.resize=function(a,b,c){!1!==c&&(V.style.width=a+"px",V.style.height=b+"px",ca&&(ca.style.width=a+"px",ca.style.height=b+"px"));ca&&(ca.width=
a,ca.height=b,v.Th());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))X.canvas_resolution_factor=1;c=a*X.canvas_resolution_factor;b*=X.canvas_resolution_factor;X.allow_hidpi&&1<window.devicePixelRatio&&(c*=window.devicePixelRatio,b*=window.devicePixelRatio);V.width=c;V.height=b;if(c>pa.drawingBufferWidth||b>pa.drawingBufferHeight){F.warn("B4W Warning: canvas size exceeds platform limits, downscaling");var d=Math.min(pa.drawingBufferWidth/
c,pa.drawingBufferHeight/b);c*=d;b*=d;V.width=c;V.height=b}N.gw(c,b,c/a,p("x"),p("y"));u(M.fh(),0);z.IF(V.width,V.height)};a.vE=function(a){g=a};a.vI=function(){g=function(){}};a.RL=function(a){d=a};a.BE=function(a){d=a};a.yI=function(){y()};a.zI=function(){y()};a.zC=function(){return M.fh()};a.gL=function(){u(M.fh(),0)};a.pause=m;a.ie=function(){s()&&(ha=performance.now()/1E3,J.ie(),t.ie(),R.play(!0))};a.$k=s;a.reset=function(){z.Vl(0);t.reset();ca=V=null;ha=ea=w=0;g=function(){};b=function(){};
d=function(){};ba.length=0;pa=null;M.reset()};a.iI=function(a){Q=a};a.CJ=function(){return V};a.cM=function(){S.ma("set_texture_quality() deprecated")};a.$L=function(){S.ma("set_shaders_dir() deprecated")};a.us=function(){return x.us()};a.$y=function(a){for(var b=0;b<ba.length;b++)if(ba[b]==a)return;ba.push(a)};a.WD=function(a){for(var b=0;b<ba.length;b++)if(ba[b]==a){ba.splice(b,1);break}}};b4w.module.physics=function(a,q){var d=q("__print"),b=q("__physics"),g=q("__util");a.px=0;a.jG=1;a.iG=2;a.cq=3;a.Bs=function(a){b.B(a)?b.Bs(a):d.error("No physics for object "+a.name)};a.uk=function(a){b.B(a)?b.uk(a):d.error("No physics for object "+a.name)};a.B=function(a){return b.B(a)};a.Wn=function(a){return b.Wn(a)};a.Wt=function(a){return b.Wt(a)};a.Uv=function(a,g){b.B(a)?b.Uv(a,g):d.error("No physics for object "+a.name)};a.AL=function(a,g,p){b.B(a)?b.q("set_damping",a.l.L,g,p):d.error("No physics for object "+
a.name)};a.mL=function(a){if(b.B(a)){var g=a.game;b.q("set_damping",a.l.L,g.damping,g.rotation_damping)}else d.error("No physics for object "+a.name)};a.Hl=function(a,g,p){b.B(a)?b.Hl.apply(this,arguments):d.error("No physics for object "+a.name)};a.T=function(a){b.B(a)?b.T(a):d.error("No physics for object "+a.name)};a.cr=function(a){b.B(a)?b.cr.apply(this,arguments):d.error("No physics for object "+a.name)};a.dr=function(a){b.B(a)?b.dr.apply(this,arguments):d.error("No physics for object "+a.name)};
a.Yq=function(a,g,p,k){b.B(a)?b.Yq.apply(this,arguments):d.error("No physics for object "+a.name)};a.br=function(a,g,p,k){b.B(a)?b.br.apply(this,arguments):d.error("No physics for object "+a.name)};a.Yh=function(a,n){b.B(a)?(b.bc(a)||b.cc(a)||d.error("Wrong object"),b.Yh(a,g.xa(n,-1,1))):d.error("No physics for object "+a.name)};a.EM=function(a,n,p){if(b.B(a)){b.bc(a)||b.cc(a)||d.error("Wrong object");n=g.xa(n,0,1);var k=a.i.$g;-1==p||1==p?k=Math.max(-1,Math.min(k+p*n,1)):0==p&&0<=k?(k-=n,k=Math.max(0,
k)):0==p&&0>k?(k+=n,k=Math.min(0,k)):d.error("Wrong steering direction");b.Yh(a,g.xa(k,-1,1))}else d.error("No physics for object "+a.name)};a.Xh=function(a,n){b.B(a)?(b.bc(a)||b.cc(a)||d.error("Wrong object"),b.Xh(a,g.xa(n,-1,1))):d.error("No physics for object "+a.name)};a.DM=function(a,n,p){if(b.B(a)){b.bc(a)||b.cc(a)||d.error("Wrong object");n=g.xa(n,0,1);var k=a.i.Ih;-1==p||1==p?k=Math.max(-1,Math.min(k+p*n,1)):0==p&&0<=k?(k-=n,k=Math.max(0,k)):0==p&&0>k?(k+=n,k=Math.min(0,k)):d.error("Wrong steering direction");
b.Xh(a,g.xa(k,-1,1))}else d.error("No physics for object "+a.name)};a.Op=function(a,n){b.B(a)?(b.bc(a)||b.cc(a)||d.error("Wrong object"),b.Op(a,g.xa(n,0,1))):d.error("No physics for object "+a.name)};a.CM=function(a,n){if(b.B(a)){b.bc(a)||b.cc(a)||d.error("Wrong object");n=g.xa(n,-1,1);var p=a.i.ki;b.Op(a,g.xa(p+p*n,0,1))}else d.error("No physics for object "+a.name)};a.bc=function(a){return b.bc(a)};a.cc=function(a){return b.cc(a)};a.dK=function(a){if(!b.B(a))return d.error("No physics for object "+
a.name),null;if(b.bc(a)||b.cc(a))return a.b4w_vehicle_settings.name;d.error("Wrong object");return null};a.fK=function(a){if(!b.B(a))return d.error("No physics for object "+a.name),null;if(b.bc(a)||b.cc(a))return a.i.$g;d.error("Wrong object")};a.eK=function(a){if(!b.B(a))return d.error("No physics for object "+a.name),null;if(b.bc(a)||b.cc(a))return a.i.Ih;d.error("Wrong object")};a.cK=function(a){if(!b.B(a))return d.error("No physics for object "+a.name),null;if(b.bc(a)||b.cc(a))return a.i.ki;d.error("Wrong object")};
a.It=function(a){if(!b.B(a))return d.error("No physics for object "+a.name),null;if(b.bc(a)||b.cc(a))return b.It(a);d.error("Wrong object")};a.Li=function(a){return b.Li(a)};a.Yo=function(a,g,p){b.B(a)?b.Yo(a,g,p):d.error("No physics for object "+a.name)};a.Fl=function(a,g){b.B(a)?b.Fl(a,g):d.error("No physics for object "+a.name)};a.xL=function(){d.warn("Function set_character_dist_to_water() is deprecated")};a.Mv=function(a,g){b.B(a)?b.Mv(a,g):d.error("No physics for object "+a.name)};a.Lv=function(a,
g){b.B(a)?b.Lv(a,g):d.error("No physics for object "+a.name)};a.Iv=function(a,g){b.B(a)?b.Iv(a,g):d.error("No physics for object "+a.name)};a.Ar=function(a){b.B(a)?b.Ar(a):d.error("No physics for object "+a.name)};a.Br=function(a,g,p){b.B(a)?b.Br(a,g,p):d.error("No physics for object "+a.name)};a.sE=function(a,g){b.B(a)?b.sE(a,g):d.error("No physics for object "+a.name)};a.Gl=function(a,g,p){b.B(a)?b.Gl(a,g,p):d.error("No physics for object "+a.name)};a.Kv=function(a,g){b.B(a)?b.Kv(a,g):d.error("No physics for object "+
a.name)};a.Jv=function(a,g){b.B(a)?b.Jv(a,g):d.error("No physics for object "+a.name)};a.qm=function(a,g,p,k){b.B(a)?b.qm(a,g,p,k):d.error("No physics for object "+a.name)};a.Qo=function(a,g){b.B(a)?b.Qo(a,g):d.error("No physics for object "+a.name)};a.tm=function(a,g){b.B(a)?b.tm(a,g):d.error("No physics for object "+a.name)};a.Om=function(a){b.B(a)?b.Om(a):d.error("No physics for object "+a.name)};a.sm=function(a,g,p,k,q,m){b.B(a)?b.sm(a,g,p,k,q,m):d.error("No physics for object "+a.name)};a.Ro=
function(a,g,p,k,q){b.B(a)?b.Ro(a,g,p,k,q):d.error("No physics for object "+a.name)};a.Xq=function(a,g,p,k,q,m,s,B,u,H){b.B(g)&&b.B(q)?b.Xq(a,g,p,k,q,m,s,B,u,H):d.error("Wrong objects")};a.Mr=function(a){b.B(a)&&b.HC(a)?b.Mr(a):d.error("Wrong object")};a.nv=function(a,g,p,k,q,m){b.B(a)&&b.B(k)?b.nv(a,g,p,k,q,m):d.error("Wrong objects")}};b4w.module.scenes=function(a,q){var d=q("__batch"),b=q("__camera"),g=q("__graph"),c=q("__objects"),n=q("__print"),p=q("__physics"),k=q("__scenes"),y=q("__util");a.V=k.V;a.Xo=function(a){var b=k.Ck();k.Xo(y.Kc("name",a,b))};a.u=function(){return k.ea()?k.u().name:""};a.XJ=function(){for(var a=k.Ck(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.Bk=function(){if(k.ea())return k.Fn(k.u());n.error("No active scene");return!1};a.PJ=function(a,b){return k.Gi(k.Kj,a,b|0)};a.mC=function(a,b,c){return k.Gi(k.fq,
a,b,c|0)};a.NJ=function(a,b){return k.Gi(k.gq,a,b|0)};a.OJ=function(b,c,d){n.warn("get_object_by_empty_name() deprecated, use get_object_by_dupli_name() instead");return a.mC(b,c,d)};a.ut=function(a){return k.ut(a)};a.wl=k.wl;a.GL=function(a,b){for(var c=0;c<a.ga.length;c++){var d=a.ga[c];"COLOR_ID"==d.type&&(d.gh=b)}};a.vm=function(a,b,c,d){a.d&&a.d.qd&&k.vm(a,b,c,d)};a.TH=function(a){if(a.d&&a.d.qd){var b=a.d.Kk;k.vm(a,b.AC,b.CC,b.DC)}};a.hk=function(a){a.d&&a.d.qd&&k.hk(a)};a.FL=function(a){var b=
k.u();if(b=k.qa(b,"GLOW"))b.Ji.set(a),b.Ha=!0};a.ZJ=function(){if(!k.ea())return n.error("No active scene"),!1;var a=k.u(),b=k.qa(a,"SHADOW_CAST");if(!b)return null;var c=a.d.sd,d=k.qa(a,"MAIN_OPAQUE"),g=k.qa(a,"DEPTH"),p={};p.csm_resolution=c.csm_resolution;p.self_shadow_polygon_offset=b.self_shadow_polygon_offset;g&&(p.self_shadow_normal_offset=g.self_shadow_normal_offset);p.enable_csm=c.enable_csm;p.csm_num=c.csm_num;p.csm_first_cascade_border=c.csm_first_cascade_border;p.first_cascade_blur_radius=
c.first_cascade_blur_radius;p.csm_last_cascade_border=c.csm_last_cascade_border;p.last_cascade_blur_radius=c.last_cascade_blur_radius;p.fade_last_cascade=c.fade_last_cascade;p.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(p.csm_borders=k.$B(a,d.j),p.blur_radii=new Float32Array(c.csm_num),p.blur_radii.set(d.j.vl.subarray(0,c.csm_num))):(p.csm_borders=null,p.blur_radii=null);return p};a.aM=function(a){if(!k.ea())return n.error("No active scene"),!1;var c=k.u();"number"==typeof a.self_shadow_polygon_offset&&
g.U(c.d.xb,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var p=k.qa(c,"DEPTH");p&&("number"==typeof a.self_shadow_normal_offset&&(p.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(p.pcf_blur_radius=a.pcf_blur_radius));var q=k.qa(c,"MAIN_BLEND");q&&("number"==typeof a.self_shadow_normal_offset&&(q.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(q.pcf_blur_radius=
a.pcf_blur_radius),q.Ha=!0);q=c.d.sd;"number"==typeof a.csm_first_cascade_border&&(q.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(q.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(q.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(q.last_cascade_blur_radius=a.last_cascade_blur_radius);if(p){for(var y=p.o,A=0;A<y.length;A++){var x=y[A];x.nb.Lb&&
(x=x.n,d.wm(x,q),d.Wb(x))}p.Ha=!0}p=c.camera.d.M;for(A=0;A<p.length;A++)b.Lp(p[A],q);k.Wo(c)};a.ht=function(){if(!k.ea())return n.error("No active scene"),!1;var a=k.u();return k.ht(a)};a.Qv=function(a,b,c){if(!k.ea())return n.error("No active scene"),!1;var d=k.u();k.Qv(d,parseFloat(a),b,c)};a.mt=function(a){if(!k.ea())return n.error("No active scene"),!1;var b=k.u();return k.mt(b,a)};a.Sv=function(a){if(!k.ea())return n.error("No active scene"),!1;var b=k.u();k.Sv(b,a)};a.Et=function(){if(!k.ea())return n.error("No active scene"),
!1;var a=k.u();return k.Et(a)};a.Zv=function(a){if(!k.ea())return n.error("No active scene"),!1;var b=k.u();k.Zv(b,a)};a.DJ=function(){if(!k.ea())return n.error("No active scene"),null;var a=k.u(),a=k.qa(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.yL=function(a){if(!k.ea())return n.error("No active scene"),null;var b=k.u(),b=k.qa(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&
(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.Ha=!0};a.Ct=function(){if(!k.ea())return n.error("No active scene"),!1;var a=k.u();return k.Ct(a)};a.Xv=function(a){if(!k.ea())return n.error("No active scene"),!1;var b=k.u();k.Xv(b,a)};a.et=function(){if(!k.ea())return n.error("No active scene"),!1;var a=k.u();return k.qa(a,"DOF")?k.et(a):null};a.Pv=function(a){if(!k.ea())return n.error("No active scene"),
!1;var b=k.u();k.Pv(b,a)};a.nt=function(){if(!k.ea())return n.error("No active scene"),!1;var a=k.u();return k.qa(a,"GOD_RAYS")?k.nt(a):null};a.Tv=function(a){if(!k.ea())return n.error("No active scene"),!1;var b=k.u();k.Tv(b,a)};a.at=function(){if(!k.ea())return n.error("No active scene"),!1;var a=k.u();return k.qa(a,"BLOOM")?k.at(a):null};a.Hv=function(a){if(!k.ea())return n.error("No active scene"),!1;var b=k.u();k.Hv(b,a)};a.Nt=function(){return k.Nt()};a.fw=function(a){if(!k.ea())return n.error("No active scene"),
!1;var b=k.u();k.fw(b,a)};a.Lt=k.Lt;a.ew=function(a){if(!k.ea())return n.error("No active scene"),!1;var b=k.u();k.ew(b,a)};a.Kt=function(a){if(!k.ea())return n.error("No active scene"),!1;var b=k.u();k.Kt(b,a)};a.BM=function(){if(!k.ea())return n.error("No active scene"),!1;var a=k.u();k.Ww(a)};a.Uk=function(a){c.ju(a)?k.Uk(a):n.error("B4W Error: show/hide is only supported for dynamic meshes")};a.hp=function(a){c.ju(a)?k.hp(a):n.error("B4W Error: show/hide is only supported for dynamic meshes")};
a.al=function(a){return a.d.al};a.Er=function(a){return k.ea()?k.Er(a,k.u()):(n.error("No active scene"),!1)};a.QB=function(a,b){var c=k.u();a||(a="ALL");b||0===b||(b=k.V);return k.Hb(c,a,b)};a.wJ=function(b,c){n.warn("get_appended_objs() deprecated, use get_all_objects() instead");return a.QB(b,c)};a.SJ=function(a){return a?a.name:(n.error("Wrong object name"),"")};a.TJ=function(a){return a&&a.type?a.type:(n.error("Wrong object ID"),"UNDEFINED")};a.RJ=function(a){return a.Tb};a.QJ=function(a){return a.te.slice(0)};
a.gC=function(){for(var a=k.Hb(k.u(),"MESH",k.V),b=0;b<a.length;b++){var c=a[b];if(p.Li(c))return c}return null};a.Bt=function(a,b){b||0===b||(b=1);return k.Bt(a,b)};a.bt=function(){return k.bt()};a.bK=function(a){return"MESH"==a.type?a.d.type:null};a.Fk=function(){if(!k.ea())return n.error("No active scene"),!1;var a=k.u();return k.Fk(a)};a.Lg=function(){y.ma('Method "append_object" is deprecated')};a.FH=function(){y.ma('Method "add_object" is deprecated')};a.iL=function(){y.ma('Method "remove_object" is deprecated')};
a.YJ=function(){y.ma("get_screen_scenes() deprecated")};a.LL=function(){y.ma("set_light_pos() deprecated, use lights module instead")};a.IL=function(){y.ma("set_light_direction() deprecated, use lights module instead")};a.CL=function(){y.ma("set_dir_light_color() deprecated, use lights module instead")};a.MJ=function(){y.ma("get_lights_names() deprecated, use lights module instead")};a.hL=function(){y.ma("remove_all() deprecated, use lights module instead")};a.Qz=function(){y.ma("check_collision() deprecated, use lights module instead")};
a.Uz=function(){y.ma("check_ray_hit() deprecated, use lights module instead")}};b4w.module.transform=function(a,q){var d=q("__print"),b=q("__physics"),g=q("__transform"),c=q("__util"),n=new Float32Array(3),p=new Float32Array(4);a.Oj=g.Oj;a.Iq=g.Iq;a.Zc=function(a,c,d,p){n[0]=c;n[1]=d;n[2]=p;g.Zc(a,n);g.A(a);b.T(a)};a.ep=function(a,c){g.Zc(a,c);g.A(a);b.T(a)};a.eM=function(a,d,m,p,q){n[0]=d;n[1]=m;n[2]=p;c.uj(n,1,q.d.quat,q.d.g,n);g.Zc(a,n);g.A(a);b.T(a)};a.Sc=function(a,b){b||(b=new Float32Array(3));g.Sc(a,b);return b};a.Yc=function(a,c,d,n,q){p[0]=c;p[1]=d;p[2]=n;p[3]=q;g.Yc(a,
p);g.A(a);b.T(a)};a.YL=a.Yc;a.DE=function(a,c){g.Yc(a,c);g.A(a);b.T(a)};a.ZL=a.DE;a.Hi=function(a,b){b||(b=new Float32Array(4));g.Hi(a,b);return b};a.Ln=a.Hi;a.dp=function(a,c,d,p){n[0]=c;n[1]=d;n[2]=p;g.dp(a,n);g.A(a);b.T(a)};a.XL=function(a,c){g.dp(a,c);g.A(a);b.T(a)};a.Ye=function(a,b){g.Ye(a,b);g.A(a)};a.Hk=function(a){return g.Hk(a)};a.YI=function(a){if("EMPTY"!=a.type)return d.error("Wrong object: "+a.name),!1;g.Zc(a,[0,0,0]);g.Yc(a,[0,0,0,1]);g.Ye(a,1);g.A(a);b.T(a)};a.Jn=function(a){return c.rc(a)?
g.Jn(a):(d.error("Wrong object: "+a.name),0)};a.Gk=function(a,b,m){return c.rc(a)?g.Gk(a,b,m):(d.error("Wrong object: "+a.name),null)};a.tc=function(a,c,d,n){g.tc(a,c,d,n);g.A(a);b.T(a)};a.tt=function(a){return g.tt(a)}};b4w.module.util=function(a,q){var d=q("__print"),b=q("__util"),g=q("vec3");q("mat4");a.ad=new Float32Array([1,0,0]);a.Ba=new Float32Array([0,1,0]);a.jc=new Float32Array([0,0,1]);a.Ij=new Float32Array([-1,0,0]);a.rb=new Float32Array([0,-1,0]);a.qf=new Float32Array([0,0,-1]);a.pu=b.pu;a.Kc=b.Kc;a.ee=function(a){return b.ee(a)};a.Ge=function(a,d){d||(d=new Float32Array(4));return b.Ge(a,d)};a.qv=function(a,d){d||(d=new Float32Array(3));return b.qv(a,d)};a.sign=b.sign;a.xa=b.xa;a.S=b.S;a.iK=function(a,
d){return b.Jo(a,b.rb,b.Ba,b.qf,d)};a.Jm=function(a,d){return b.Jm(a,d)};a.Jo=function(a,n,p,k,q){return 0!=g.dot(p,k)?(d.error("Wrong in-plane direction"),null):b.Jo(a,n,p,k,q)};a.$t=b.$t;a.Mb=b.Mb;a.Ch=b.Ch;a.Xf=b.Xf;a.Um=b.Um;a.pv=b.pv;a.sv=b.sv;a.mx=b.mx;a.io=b.io;a.rc=b.rc};b4w.module.camera_anim=function(a,q){function d(a){var c=b.Nf(a),d=b.ot(a);a=b.Je(a,y)[0];a=c==b.fa?a-Math.PI:-1*a;return.3*Math.min(1,(d[1]-a)/.2,(a-d[0])/.2)}var b=q("camera"),g=q("controls"),c=q("print"),n=q("scenes"),p=q("transform"),k=q("util"),y=new Float32Array(2),m=new Float32Array(3),s=new Float32Array(3),B=new Float32Array(3),u=new Float32Array(4),H=q("vec3"),A=q("quat");a.qM=function(a,c,d,h,n,q,y,r){if(a&&c){if(k.Xf(c))var v=c;else v=B,p.Gk(c,!1,v);c=d||1;d=h||2;var E=n||1;n=q||1;s[0]=
0;s[1]=-1;s[2]=0;var e=p.Ln(a);q=k.S(e,s);h=b.Je(a);var t=p.Sc(a);H.subtract(v,t,m);H.normalize(m,m);var l=A.rotationTo(q,m,A.create());A.multiply(l,e,u);k.Um(u,!1);H.subtract(v,t,s);var N=H.length(s)*(1-1/d),v=Math.asin(m[1]);d=Math.acos(-m[2]/Math.abs(Math.cos(v)));0<m[0]&&(d=2*Math.PI-d);var J=d-h[0],C=v-h[1];B[0]=0;B[1]=0;B[2]=-1;d=p.Ln(a);0>k.S(d,B)[1]?(C=0<q[1]?v-Math.PI+h[1]:v+Math.PI+h[1],J=0<J?-Math.PI+J:Math.PI+J):Math.abs(J)>Math.PI&&(J=0<J?J-2*Math.PI:J+2*Math.PI);var C=-C,R=0,v=g.Sg();
q=Math.abs(J/c);c=Math.abs(C/c);var M=q>c?q:c,P=M+E,S=P+n,Z=S+E,L=J,X=C,V=N;g.J(a,"TRACK_TO_TARGET",g.ca,[v],null,function(a,c,d){if(d)if(d=g.Qb(a,c,0),R+=d,R<M){var e=J/M*d;d*=C/M;c=R/M;c=6*c*(1-c);e*=c;d*=c;L-=e;X-=d;b.rotate(a,e,d)}else R<P?(L&&(b.rotate(a,L,X),L=0,r&&r()),c=(R-M)/E,d=-N*d/E,V-=e,p.tc(a,0,6*d*c*(1-c),0)):R<S?V&&(p.tc(a,0,V,0),V=0):R<Z?(c=(R-S)/E,d=N*d/E,d=6*d*c*(1-c),p.tc(a,0,d,0)):(p.ep(a,t),g.ge(a,c),y&&y())})}};a.lr=function(a){function f(a,c,d){if(1==d)if(p!=b.Xb&&b.Yt(a)){c=
g.Qb(a,c,0);d=b.Nf(a);var e=b.ot(a),f=b.Je(a,y)[0],h=Math.min(.2,(e[1]-e[0])/2),f=d==b.fa?f-Math.PI:-1*f;e[1]-f>h&&f-e[0]>h?q=.3*k.sign(q):e[1]-f<h?q-=Math.pow(.3,2)/.4*c:f-e[0]<h&&(q+=Math.pow(.3,2)/.4*c);switch(d){case b.fa:b.vg(a,c*q,0);break;case b.kc:b.rotate(a,c*q,0)}}else switch(c=g.Qb(a,c,0),b.Nf(a)){case b.fa:b.vg(a,.3*c,0);break;case b.kc:b.rotate(a,.3*c,0);break;case b.Xb:b.Dv(a,.3*c)}}function m(){g.ge(h,"AUTO_ROTATE");g.ge(h,"DISABLE_AUTO_ROTATE");a()}a=a||function(){};var h=n.Bk(),p=
b.Nf(h);if(p==b.ci)c.error("auto_rotate(): wrong camera type");else{if(b.Yt(h))var q=d(h);if(g.Og(h,"AUTO_ROTATE"))m();else{var s=g.Ug("X"),r=g.Ug("Y"),u=g.mk(),A=g.pi(),e=g.pk(),t=g.Sg();g.J(h,"DISABLE_AUTO_ROTATE",g.bd,[s,r,u,A,e],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]},m);g.J(h,"AUTO_ROTATE",g.ca,[t],function(a){return a[0]},f)}}};a.QC=function(){var a=n.Bk();return g.Og(a,"AUTO_ROTATE")}};b4w.module.sfx=function(a,q){var d=q("__scenes"),b=q("__sfx"),g=q("__print");a.play=function(a,d,g){b.play(a,d,g)};a.Fo=function(a){b.Fo(a)};a.Oi=function(a){return b.Oi(a)};a.jM=function(a,d,g,k){b.Hc(a,d);k&&b.cj(a,k);b.play(a,0,g)};a.lM=function(a){b.stop(a)};a.stop=function(a){b.stop(a)};a.pause=function(a){b.XE(a)};a.ie=function(a){b.ZE(a)};a.kM=function(a,d){b.cj(a,d)};a.cj=function(a,d){b.cj(a,d)};a.vt=function(a){return b.vt(a)};a.Hc=function(a,d){b.Hc(a,d)};a.jh=function(a){return b.jh(a)};
a.xu=function(a,d){b.xu(a,d)};a.tw=function(a,d,g){b.tw(a,d,g)};a.Jt=function(a){return a&&"object"===typeof a?b.Jt(a):b.lC()};a.fp=function(a,d){a&&"object"===typeof a?b.fp(a,d):b.AE(d)};a.Vi=function(a,d){a&&"object"===typeof a?b.Vi(a,d):b.sD(d)};a.ku=function(a){return a&&"object"===typeof a?b.ku(a):b.YC()};a.Ik=function(){return b.Ik().slice(0)};a.aK=function(){return a.Ik()};a.Nm=b.Nm;a.Nv=function(a){b.Nv(d.u(),a)};a.ct=function(){return b.ct(d.u())};a.xs=function(a,d,g){a&&"object"===typeof a?
b.xs(a,d,g):b.$A(d,g)};a.Rw=function(a){a&&"object"===typeof a?b.Rw(a):b.AF()};a.Zq=b.Zq;a.Or=b.Or;a.nn=b.nn;a.on=b.on;a.Vv=b.Vv;a.wt=b.wt;a.Rv=b.Rv;a.kt=b.kt;a.jt=b.jt;a.ft=function(a){if(a&&b.ce(a))return b.ft(a);g.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.storage=function(a,q){function d(a){c=a;try{n=window.localStorage}catch(b){g.warn("Applying chrome localStorage bug workaround"),n=null}n||(g.warn("localStorage is not available, initializing temporary storage"),n={})}function b(){return n[c]?JSON.parse(n[c]):{}}var g=q("__print"),c="",n=null;a.ac=d;a.set=function(a,d){var g=b();g[a]=String(d);n[c]=JSON.stringify(g)};a.ba=function(){delete n[c]};a.get=function(a){var c=b();return c[a]?c[a]:""};a.debug=function(){g.log(b())};d("b4w")};"object"==typeof module&&module.tn&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,q){var d=q("__version");a.version=d.version;a.type=d.type;a.gn=d.gn};"object"==typeof module&&module.tn&&b4w.module.version(exports);b4w.register("embed_main",function(a,q){function d(a,d){T=document.querySelector("#circle_container");pa=document.querySelector("#preloader_caption");ma=document.querySelector("#first_stage");U=document.querySelector("#second_stage");Y=document.querySelector("#third_stage");K=document.querySelector("#load_container");qa=document.querySelector("#preloader_container");oa=document.querySelector("#opened_button");ja=document.querySelector("#logo_container");fa=document.querySelector("#buttons_container");
aa=document.querySelector("#quality_buttons_container");ia=document.querySelector("#help_info_container");O=document.querySelector("#help_button");if(d){S.pause();var e=document.querySelector("#rel_version");X.version()&&(e.innerHTML=X.version());e=document.querySelector("#fullscreen_on_button");J.Sz()||e.parentElement.removeChild(e);e=L.get("quality");e&&"CUSTOM"!=e||(e="HIGH",L.set("quality",e));aa.className="control_panel_button";switch(e){case "LOW":aa.className="control_panel_button low_mode_button";
break;case "HIGH":aa.className="control_panel_button high_mode_button";break;case "ULTRA":aa.className="control_panel_button ultra_mode_button"}b();if(e=c())n(e),J.gB(a),window.addEventListener("resize",r,!1),r()}else if((e=J.Jk(!0))&&e.fallback_image){var f=document.createElement("div");f.className="image_wrapper";document.body.appendChild(f);qa.style.display="none";f.style.backgroundImage="url("+e.fallback_image+")"}else if(e&&e.fallback_video){var f=document.createElement("div"),g=document.createElement("video");
f.className="video_wrapper";f.appendChild(g);g.autoplay=!0;for(var h=0;h<e.fallback_video.length;h++){var k=document.createElement("source");k.src=e.fallback_video[h];g.appendChild(k)}document.body.appendChild(f);qa.style.display="none"}else N("Browser could not initialize WebGL")}function b(){window.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1};g();for(var a=0;a<ua.length;a++){var b=ua[a],c=document.getElementById(b.id);p(c);switch(b.type){case "simple_button":c&&c.addEventListener("mouseup",
b.callback,!1);break;case "menu_button":c&&c.addEventListener("mouseup",function(a){b.callback(a,b)},!1);break;case "trigger_button":(function(a){c&&c.addEventListener("mouseup",function(b){a.callback(b)},!1)})(b)}}}function g(){for(var a=document.querySelectorAll(".control_panel_button a"),b=0;b<a.length;b++){var c=a[b];c.hasAttribute("href")&&(c.href+=document.location.href);p(c.parentNode)}}function c(){var a=R.get("built_in_module_name");if(b4w.module_check(a)){var a=q(a).data.main_file,b=document.getElementById("built_in_scripts");
b.parentElement.removeChild(b);return a}a=J.Jk();ja.style.display="block";if(a&&a.load)return a=a.load;N("Please specify a scene to load");return null}function n(a){l(ja,"opacity",300,1,0,"","",function(){pa.style.display="block";l(pa,"opacity",300,1,0,"","",function(){S.ie();P.load(a,v,E,!1)})})}function p(a){a&&(F()?(a.addEventListener("touchstart",function(){a.className+=" hover";D()},!1),a.addEventListener("touchend",function(){a.className=a.className.replace(" hover","");z()},!1)):(a.addEventListener("mouseenter",
function(){a.className+=" hover"},!1),a.addEventListener("mouseout",function(){a.className=a.className.replace(" hover","")},!1)))}function k(a){if(!h()){var b=a?a.target:document.querySelector("#auto_rotate_on_button");C.lr(function(){b&&B(b)});b&&B(b);S.$k()&&(m(),u())}}function y(a){h()||(C.lr(),a&&B(a.target))}function m(a){h()||(S.ie(),a&&B(a.target))}function s(){H()||z()}function B(a){var b=a.id,c;a:{for(c=0;c<ua.length;c++)if(ua[c].id==a.id){c=ua[c];break a}c=null}var d=c.callback;a.id=c.id=
c.mj;c.mj=b;c.callback=c.lj;c.lj=d}function u(){var a=document.querySelector("#play_button")||document.querySelector("#pause_button");a&&B(a)}function H(){var a=!1;if(document.querySelectorAll)for(var b=document.querySelectorAll(":hover"),c=0;c<b.length;c++)if("buttons_container"==b[c].id){a=!0;break}return a}function A(){if(!h()){fa.removeEventListener("mouseleave",z);fa.removeEventListener("mouseenter",D);document.body.removeEventListener("touchmove",z);I();var a=document.querySelector("#help_button"),
b=document.querySelector("#tw_button"),c=function(a){ha=!0;l(a,"marginRight",50,-45,0,"","px");l(a,"opacity",50,0,1,"","",function(){a.nextElementSibling&&"opened_button"!=a.nextElementSibling.id?c(a.nextElementSibling):setTimeout(function(){w=ha=!1;f()},100)})},d=function(a){ea=!0;l(a,"marginBottom",50,-45,0,"","px");l(a,"opacity",50,0,1,"","",function(){a.nextElementSibling&&"opened_button"!=a.nextElementSibling.id?d(a.nextElementSibling):setTimeout(function(){ca=ea=!1;f()},100)})};c(a);d(b)}}function x(){D();
if(!h())if(oa.removeEventListener("mouseup",x),ca||w)A();else{var a=document.querySelector("#fullscreen_on_button")||document.querySelector("#fullscreen_off_button")||document.querySelector("#quality_buttons_container"),b=document.querySelector("#vk_button"),c=function(a){ha=!0;a.style.marginRight="-45px";"help_button"==a.id&&Q?setTimeout(function(){ha=!1;w=!0;f()},100):(a.style.display="block",l(a,"marginRight",50,0,-45,"","px",function(){a.previousElementSibling?c(a.previousElementSibling):setTimeout(function(){ha=
!1;w=!0;f()},100)}),l(a,"opacity",50,1,0,"",""))},d=function(a){ea=!0;a.style.marginBottom="-45px";a.style.display="block";l(a,"marginBottom",50,0,-45,"","px",function(){a.previousElementSibling?d(a.previousElementSibling):setTimeout(function(){ea=!1;ca=!0;f()},100)});l(a,"opacity",50,1,0,"","")};c(a);d(b);fa.addEventListener("mouseleave",z,!1);fa.addEventListener("mouseenter",D,!1);document.body.addEventListener("touchmove",z,!1)}}function f(){h()||(oa.addEventListener("mouseup",x,!1),(!H()&&(ca||
w)||F()&&(ca||w))&&z())}function F(){return!!("ontouchstart"in window&&!isFinite(navigator.kD)||navigator.kD)}function h(){return ea||ha}function z(){h()||(D(),V=setTimeout(A,2E3))}function D(){clearTimeout(V)}function I(a){if(!h()&&ba){ba=!1;a?(a.stopPropagation(),a=a.target):a=document.querySelectorAll(".active_elem")[0];aa.style.marginRight="0px";for(var b=0,c=aa.children;b<c.length;b++)c[b].style.display="none",c[b].style.opacity=0;aa.className="control_panel_button "+a.id}}function r(){S.resize(window.innerWidth,
window.innerHeight)}function v(a,b){if(b){J.fB();S.BE(e);r();var c=J.Jk();c&&"autorotate"in c&&k();c=M.Fk();c.title&&(document.title=c.title)}else N("Could not load the scene")}function E(a){pa.innerHTML=a+"%";33>a?(T.style.display="block",ma.style.width=4.7*a+"px",T.style.webkitTransform="rotate("+(3.6*a-503)+"deg)",T.style.transform="rotate("+(3.6*a-503)+"deg)"):66>a?(ma.style.width="142px",U.style.backgroundColor="#000",U.style.marginTop="135px",0<135-4.5*(a-33)&&(U.style.marginTop=135-3.5*(a-
33)+"px"),T.style.webkitTransform="rotate("+(3.6*a-503)+"deg)",T.style.transform="rotate("+(3.6*a-503)+"deg)"):100!=a&&(U.style.marginTop="0px",Y.style.backgroundColor="#000",Y.style.height="0px",75<a&&(Y.style.height=.1*a+"px"),T.style.webkitTransform="rotate("+(3.6*a-503)+"deg)",T.style.transform="rotate("+(3.6*a-503)+"deg)");100==a&&(Z.Nm()||(a=document.querySelector("#sound_on_button"),a.parentElement.removeChild(a)),ma.parentElement.removeChild(ma),U.parentElement.removeChild(U),Y.parentElement.removeChild(Y),
T.parentElement.removeChild(T),K.style.backgroundColor="#000",l(pa,"opacity",300,0,1,"","",function(){l(K,"opacity",300,0,1,"","",function(){l(ja,"opacity",300,0,1,"","",function(){l(qa,"opacity",300,0,1,"","",function(){qa.parentElement.removeChild(qa);x()})});oa.style.display="block";l(oa,"transform",300,1,0,"scale(",")")})}))}function e(){}function t(a){if(R.get("quality")!=a){switch(a){case R.sf:var b="LOW";break;case R.rf:b="HIGH";break;case R.Ig:b="ULTRA"}L.set("quality",b);setTimeout(function(){window.location.reload()},
100)}}function l(a,b,c,d,e,f,g,h){a=a||null;b=b||null;c=c||1E3;d=isFinite(d)?d:1;e=isFinite(e)?e:0;f=f||"";g=g||"";h=h||null;if(a&&b){var k=a instanceof Array?a[0]:a;void 0==k.style[b]&&(void 0!=k.style["webkit"+b.charAt(0).toUpperCase()+b.slice(1)]?b="webkit"+b.charAt(0).toUpperCase()+b.slice(1):void 0!=k.style["ms"+b.charAt(0).toUpperCase()+b.slice(1)]&&(b="ms"+b.charAt(0).toUpperCase()+b.slice(1)));var l=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/60)},m=(new Date).getTime(),n=d-e,p=function(){var k=(new Date).getTime()-m;if(k>=c){if(a instanceof Array)for(k=0;k<a.length;k++)a[k].style[b]=f+d+g;else a.style[b]=f+d+g;h&&h()}else{var q=e+k/c*n;if(a instanceof Array)for(k=0;k<a.length;k++)a[k].style[b]=f+q+g;else a.style[b]=f+q+g;l(p)}};l(p)}}function N(a){var b=document.querySelector("#error_name"),c=document.querySelector("#error_info"),
d=document.querySelector("#error_container");T.style.display="none";b.innerHTML=a;c.innerHTML="For more info visit <a href=https://www.blend4web.com/troubleshooting>"+"https://www.blend4web.com/troubleshooting".replace("https://www.","")+"</a>";d.style.display="block";ja.style.opacity=1;ja.style.marginTop="-90px"}var J=q("app"),C=q("camera_anim"),R=q("config"),M=q("scenes"),P=q("data"),S=q("main"),Z=q("sfx"),L=q("storage"),X=q("version"),V=null,ca=!1,w=!1,ea=!1,ha=!1,ba=!1,Q=!1,T,pa,ma,U,Y,K,qa,oa,
ja,fa,aa,ia,O,ua=[{type:"simple_button",id:"opened_button",callback:x},{type:"simple_button",id:"help_button",callback:function(){h()||(ia.className=F()?"touch":"",ia.style.display="block",O.style.display="none",Q=!0)}},{type:"simple_button",id:"close_help",callback:function(){Q&&(ia.style.display="none",O.style.display="block",Q=!1)}},{type:"trigger_button",id:"fullscreen_on_button",callback:function(a){h()||(J.bE(s,s),a&&B(a.target))},mj:"fullscreen_off_button",lj:function(a){h()||(J.iB(),a&&B(a.target))}},
{type:"trigger_button",id:"pause_button",callback:function(a){h()||(S.pause(),a&&B(a.target),C.QC()&&(y(),(a=document.querySelector("#auto_rotate_on_button")||document.querySelector("#auto_rotate_off_button"))&&B(a)))},mj:"play_button",lj:m},{type:"trigger_button",id:"auto_rotate_on_button",callback:k,mj:"auto_rotate_off_button",lj:y},{type:"trigger_button",id:"sound_on_button",callback:function(a){h()||(Z.Vi(null,!0),B(a.target))},mj:"sound_off_button",lj:function(a){h()||(Z.Vi(null,!1),B(a.target))}},
{type:"menu_button",id:"quality_buttons_container",callback:function(a,b){if(!h()){ba=!0;aa.style.marginRight="-30px";for(var c=b.Zz,d=b.Yz,e=0;e<c.length;e++){var f=document.getElementById(c[e]);0>aa.className.indexOf(c[e])?f.addEventListener("mouseup",d[e],!1):(f.className="active_elem",f.addEventListener("mouseup",I,!1))}aa.className="quality_buttons_container";e=0;for(c=aa.children;e<c.length;e++)c[e].style.display="block",c[e].style.opacity=1}},Zz:["low_mode_button","high_mode_button","ultra_mode_button"],
Yz:[function(){t(R.sf)},function(){t(R.rf)},function(){t(R.Ig)}]}];a.ac=function(){R.set("background_color",[.224,.224,.224,1]);var a="DEBUG"==X.type(),b=!1,c=!1,e=!1,f=J.Jk();f&&"compressed_textures"in f&&!h&&!a&&(e=c=!0);f&&"show_fps"in f&&(b=!0);f&&f.load?L.ac("b4w_webplayer:"+f.load):L.ac("b4w_webplayer:"+window.location.href);f=L.get("quality");f&&"CUSTOM"!=f||(f="HIGH",L.set("quality",f));switch(f){case "LOW":var g=R.sf;break;case "HIGH":g=R.rf;break;case "ULTRA":g=R.Ig}R.set("quality",g);var h=
b4w.module_check(R.get("built_in_module_name"));J.ac({canvas_container_id:"main_canvas_container",callback:d,gl_debug:a,physics_enabled:!h,show_fps:b,report_init_failure:!1,console_verbose:a,error_purge_elements:["control_panel"],alpha:!1,key_pause_enabled:!1,fps_elem_id:"fps_container",fps_wrapper_id:"fps_wrapper",assets_dds_available:c,assets_min50_available:e})}});window.addEventListener("load",function(){b4w.require("embed_main").ac()},!1);var rd=["b4w","$","jQuery"],sd=[],zd;for(zd in window)-1!=rd.indexOf(zd)||zd in ld||sd.push(zd);sd.length&&console.error("globals detected:",sd);
