var qd={},ud;for(ud in window)qd[ud]=!0;var b4w=function(a){var w={};a.module=w;var e={};a.register=function(a,e){if(w[a])throw Error('Module "'+a+'" already registered');w[a]=e};a.require=function(a,q){if(!w[a])throw Error('Module "'+a+'" not found');q=q||"__B4W_DEF_NS";e[q]||(e[q]=function(a){return function(b){var p=w[b];if(!p)throw Error('Module "'+b+'" not found');p.yi||(p.yi={});p.yi[a]||(p.yi[a]={},p(p.yi[a],e[a]));return p.yi[a]}}(q));return e[q](a)};a.module_check=function(a){return w[a]?!0:!1};return a}({});b4w.module.app=function(a,w){function e(){var a=x.pl();document.addEventListener("visibilitychange",function(){document.hidden?(a=x.pl(),x.pause()):a||x.hd()},!1)}function b(a,b,c,r){var f=document.createElement("canvas");f.style.position="absolute";b?(b=document.createElement("canvas"),b.style.position="absolute",b.style.zIndex="2",b.style.pointerEvents="none"):b=null;if(!x.Ob(f,b))return c&&J("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",
r),null;F=f;c=document.getElementById(a);c||(E.error('Warning: canvas container "'+a+'" not found, appending to body'),c=document.body);c.appendChild(f);b&&c.appendChild(b);return c}function q(a,b){a?(b&&(document.getElementById(b).style.display="block"),f=document.getElementById(a)):(f=document.createElement("div"),f.innerHTML=0,f.style.cssText="position:absolute;top: 23px;right: 20px;font-size: 45px;line-height: 50px;font-weight: bold;color: #000;z-index: 1;",document.body.appendChild(f))}function d(a,
b){var c=String(a);b&&(c+="/"+String(b));f.innerHTML=c}function h(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function p(){x.resize(L.clientWidth,L.clientHeight,!0)}function g(a,b,c){if(y.vo(a))var f=k.zd(a,V),e=y.GC(a,R),f=r.subtract(f,e,V),f=Math.max(r.len(f),1);else f=10;e=k.Se(a,X);b=u.ka(e,b,V);b[1]=0;r.normalize(b,b);r.scale(b,f*c,b);f=k.zd(a,R);r.add(f,b,f);y.zo(a,f)}function v(a,b){if(y.vo(a)){var c=y.FC(a,N);if(0>c[1]-c[0]){var f=y.bd(a,P)[1],
c=(c[0]-f)/(c[0]-c[1]),f=y.qC(a),c=Math.max(c,2/f[0]);y.Gg(a,0,c*b)}}else c=k.zd(a,V),f=r.scale(u.ta,-b,R),r.add(c,f,c),y.zo(a,c)}function m(a,b,c,f){k.vc(a,5*b,5*c,5*f)}function t(a,b,c){var f=k.zd(a,V),e=y.lo(a,R),f=r.dist(f,e),e=Math.abs(b);c=Math.pow(e*c,1-Math.pow(e*c,.15));k.vc(a,0,0>b?.001<f?-f*c:0:c/(1-c)*f,0)}function z(a,b,c,f){for(var r=c*b;0<a;--a)c+=r,f+=r,r=c*b;return f}function C(a,b,c,f,k){k?(k=y.lo(a,V),a=y.Et(a),a=r.dist(k,a)+f,f=0<b?z(b,-c,a,f):z(-b,c/(1-c),a,f)):f-=2*b*c;return f}
function J(a,b,c,f){var r=document.createElement("div"),k=document.createElement("div"),e=document.createElement("div");if(f)for(var u=0;u<f.length;u++){var d=document.getElementById(f[u]);d&&d.parentNode.removeChild(d)}r.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";k.style.cssText="color:#fff;font-size:24px;";e.style.cssText="color:#fff;font-size:20px;";k.innerHTML=a;e.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+
c+'">'+c.replace("https://www.","")+"</a>";r.appendChild(k);r.appendChild(e);document.body.appendChild(r)}function D(a,b,c,f){function r(e){e=1E3*e-k;f(a+e*(b-a)/c);e>=c&&x.uE(r)}var k=1E3*x.UC();x.rr(r)}w("animation");var y=w("camera"),n=w("config"),l=w("constraints"),c=w("controls"),M=w("data"),I=w("debug"),x=w("main"),B=w("physics"),E=w("print"),K=w("scenes"),k=w("transform"),u=w("util"),r=w("vec3");w("quat");var L=null,F=null,f=null,N=new Float32Array(2),P=new Float32Array(2),V=new Float32Array(3),
R=new Float32Array(3),ea=new Float32Array(3),U=new Float32Array(3),X=new Float32Array(4);a.Ob=function(a){function f(){var a=b(u,y,H,h);a?(L=a,p(),x.Ep(g),aa&&(q(m,v),x.VE(d)),B&&e(),l&&x.rr(function(){var a=L.clientWidth,H=L.clientHeight;a==F.clientWidth&&H==F.clientHeight||x.resize(a,H,!0)}),k(F,!0)):k(F,!1)}function r(a){a.keyCode==c.dy&&(x.pl()?x.hd():x.pause())}function k(){}a=a||{};var u=null,l=!1,g=!1,h=null,m=null,v=null,N=!0,t=!1,B=!0,H=!0,aa=!1,na=!1,P;for(P in a)switch(P){case "canvas_container_id":u=
a.canvas_container_id;break;case "callback":k=a.callback;break;case "autoresize":l=a.autoresize;break;case "do_not_use_onload":break;case "gl_debug":g=a.gl_debug;break;case "show_hud_debug_info":na=a.show_hud_debug_info;break;case "sfx_mix_mode":t=a.sfx_mix_mode;break;case "show_fps":aa=a.show_fps;break;case "fps_wrapper_id":v=a.fps_wrapper_id;break;case "fps_elem_id":m=a.fps_elem_id;break;case "error_purge_elements":h=a.error_purge_elements;break;case "report_init_failure":H=a.report_init_failure;
break;case "pause_invisible":B=a.pause_invisible;break;case "key_pause_enabled":N=a.key_pause_enabled;break;default:n.set(P,a[P])}N&&document.addEventListener("keydown",r,!1);n.set("show_hud_debug_info",na);n.set("sfx_mix_mode",t);var y=na||t||null;"complete"==document.readyState?window.setTimeout(f,0):window.addEventListener("load",f,!1);window.addEventListener("unload",function(){M.Y()},!1)};a.UL=p;a.aK=function(){return L};a.uM=function(a,b){var c=h(a);c.addEventListener("mouseup",function(){b(c.value)},
!1)};a.tM=function(a,b){var c=h(a);c.addEventListener("change",function(){var a=c.checked;b(void 0!=a?a:c.value)},!1)};a.vM=function(a,b){var c=h(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.AB=function(){function a(H,b,f,r){if(1==f){var aa=L?.003*p[0]:.003*p[1];f=c.Nb(H,b,0);c.ke(H,b,0)===c.dk?(Na+="X"==r?-f*aa:0,sa+="Y"==r?-f*aa:0):c.ke(H,b,0)===c.bk&&(H=L?.003*p[1]:7.5E-4*p[0],Oa+="X"==r?-f*H:0,ra+="Y"==r?-f*H:0)}}function b(a,H,f,r){if(1==f){f=c.Nb(a,H,1);y.Zi(a,p);
if(L)aa=.003*p[0],e=7.5E-4*p[1];else var aa=.003*p[1],e=7.5E-4*p[0];if(1===c.ke(a,H,0))Ja+="X"==r?-f*aa:0,X+="Y"==r?-f*aa:0;else if(2===c.ke(a,H,0)||3===c.ke(a,H,0))wa+="X"==r?-f*e:0,ab+="Y"==r?-f*e:0}}function f(a){return a[0]&&(a[1]||a[2])}function e(a,b,f){if(!q||!c.Nb(a,"CAMERA_COLLISION",1)){if(1==f)switch(f=c.Nb(a,b,0),y.Zi(a,p),b){case "FORWARD":h?H[0]=1:L?(b=y.bd(a,P)[1],b=Math.abs(b)>=Math.PI/4?u.Bf:u.$b,g(a,b,.5*p[0]*f)):n?t(a,-p[2],f):m(a,0,-p[0]*f,0);break;case "BACKWARD":h?H[0]=-1:L?
(b=y.bd(a,P)[1],b=Math.abs(b)>=Math.PI/4?u.nd:u.ta,g(a,b,.5*p[0]*f)):n?t(a,p[2],f):m(a,0,p[0]*f,0);break;case "UP":L?v(a,30*-p[2]*f):h||m(a,0,0,-p[0]*f);break;case "DOWN":L?v(a,30*p[2]*f):h||m(a,0,0,p[0]*f);break;case "LEFT":h?H[1]=1:L?g(a,u.Am,.5*p[0]*f):m(a,-p[0]*f,0,0);break;case "RIGHT":h?H[1]=-1:L?g(a,u.Ee,.5*p[0]*f):m(a,p[0]*f,0,0);break;case "ROT_LEFT":n?y.ue(a,2*-p[1]*f,0):y.Uc(a,2*p[1]*f,0);break;case "ROT_RIGHT":n?y.ue(a,2*p[1]*f,0):y.Uc(a,2*-p[1]*f,0);break;case "ROT_UP":n?y.ue(a,0,2*-p[1]*
f):y.Uc(a,0,2*p[1]*f);break;case "ROT_DOWN":n?y.ue(a,0,2*p[1]*f):y.Uc(a,0,2*-p[1]*f)}else switch(b){case "FORWARD":case "BACKWARD":h&&(H[0]=0);break;case "LEFT":case "RIGHT":h&&(H[1]=0)}h&&(B.Dp(h,H[0],H[1]),a=y.Xk(a,N),B.Wl(h,a[0],a[1]))}}var d=K.Uk(),n=!1,h=null,L=!1;switch(y.$f(d)){case y.qa:n=!0;break;case y.Jb:h=K.BC();break;case y.Ug:return;case y.vb:L=!0}var p=y.Zi(d,U),F=c.kh();if(B.xo(d)){var q=c.yn(d,null,!0);c.L(d,"CAMERA_COLLISION",c.ba,[F,q],null,function(a,H,b){if(1==b){H=c.ke(a,H,1);
b=k.zd(a,V);var f=R;r.sub(b,H,f);r.normalize(f,f);r.scale(f,.01,f);r.add(b,f,b);k.Kp(a,b)}})}if(h){var x=k.zd(d),z=k.Se(d),z=u.hn(z);x[1]-=.5;B.Xl(h,x,z);l.yz(d,h);var H=new Float32Array(2),aa=!0;B.Vl(h,B.Eq);c.lh(d,"TOGGLE_CHAR_MOVE_TYPE",c.pd,c.Zx,function(){aa=!aa;B.Vl(h,aa?B.Eq:B.Jx)})}var x=c.Qa(c.Pq),z=c.Qa(c.Nq),na=c.Qa(c.Iq),D=c.Qa(c.Jq),W=c.Qa(c.ey),ba=c.Qa(c.$x),M=c.Qa(c.Oq),J=c.Qa(c.Kq),O=c.Qa(c.Lq),I=c.Qa(c.Mq);L||(c.L(d,"FORWARD",c.ba,[F,x],null,e),c.L(d,"BACKWARD",c.ba,[F,z],null,e));
n?(c.L(d,"ROT_UP",c.ba,[F,M,W],f,e),c.L(d,"ROT_DOWN",c.ba,[F,J,ba],f,e),c.L(d,"ROT_LEFT",c.ba,[F,O,na],f,e),c.L(d,"ROT_RIGHT",c.ba,[F,I,D],f,e)):L?(c.L(d,"LEFT",c.ba,[F,O,na],f,e),c.L(d,"RIGHT",c.ba,[F,I,D],f,e),c.L(d,"FORWARD",c.ba,[F,M,x],f,e),c.L(d,"BACKWARD",c.ba,[F,J,z],f,e),c.L(d,"UP",c.ba,[F,ba],f,e),c.L(d,"DOWN",c.ba,[F,W],f,e)):(c.L(d,"UP",c.ba,[F,W],f,e),c.L(d,"DOWN",c.ba,[F,ba],f,e),c.L(d,"LEFT",c.ba,[F,na],f,e),c.L(d,"RIGHT",c.ba,[F,D],f,e),c.L(d,"ROT_UP",c.ba,[F,M],f,e),c.L(d,"ROT_DOWN",
c.ba,[F,J],f,e),c.L(d,"ROT_LEFT",c.ba,[F,O],f,e),c.L(d,"ROT_RIGHT",c.ba,[F,I],f,e));var E=0,x=c.zn(),w=0,z=c.Ik();c.L(d,"MOUSE_WHEEL",c.od,[x],null,function(a,H,b){1==b&&(H=c.Nb(a,H,0),y.Zi(a,p),n||L?E=C(a,H,p[2],E,n):(p[0]*=1+H*p[2],y.gF(a,p)))});c.L(d,"TOUCH_ZOOM",c.od,[z],null,function(a,H,b){1==b&&(b=c.Nb(a,H,0),y.Zi(a,p),c.ke(a,H,0)===c.ck&&(w=C(a,b,.03*p[2],w,n)))});c.L(d,"ZOOM_INTERPOL",c.ba,[F],null,function(a,H,b){if(1==b&&(n||L))if(1E-5<Math.abs(E)||1E-5<Math.abs(w)){H=c.Nb(a,H,0);b=u.Ib(E,
0,H,.1);E-=b;var f=u.Ib(w,0,H,.15);w-=f;if(!q||!c.Nb(a,"CAMERA_COLLISION",1))if(L)v(a,-(b+f));else{H=y.lo(a,V);var aa=y.Et(a,R);.001<r.dist(H,aa)+b+f?k.vc(a,0,b+f,0):(b=r.subtract(aa,H,R),f=r.normalize(b,ea),r.scale(f,.001,f),r.add(H,f,b),k.Kp(a,b),w=E=0)}}else w=E=0});var Ja=0,X=0,wa=0,ab=0,x=c.mh("X"),z=c.mh("Y"),na=c.Fk();c.L(d,"MOUSE_X",c.od,[na,x],null,b,"X");c.L(d,"MOUSE_Y",c.od,[na,z],null,b,"Y");var Na=0,sa=0,Oa=0,ra=0,x=c.Gi("X"),z=c.Gi("Y");c.L(d,"TOUCH_X",c.od,[x],null,a,"X");c.L(d,"TOUCH_Y",
c.od,[z],null,a,"Y");c.L(d,"ROT_TRANS_INTERPOL",c.ba,[F],null,function(a,H,b){if(1==b&&(.001<Math.abs(Ja)||.001<Math.abs(X)||.001<Math.abs(Na)||.001<Math.abs(sa)||.001<Math.abs(wa)||.001<Math.abs(ab)||1E-5<Math.abs(Oa)||1E-5<Math.abs(ra))){var f=c.Nb(a,H,0),r=u.Ib(Ja,0,f,.08);H=u.Ib(X,0,f,.08);Ja-=r;X-=H;var aa=u.Ib(Na,0,f,.12);b=u.Ib(sa,0,f,.12);Na-=aa;sa-=b;var e=u.Ib(wa,0,f,.08),k=u.Ib(ab,0,f,.08);wa-=e;ab-=k;var d=u.Ib(Oa,0,f,.12),f=u.Ib(ra,0,f,.12);Oa-=d;ra-=f;n?(y.ue(a,r+aa,H+b),y.PD(a,e+d,
k+f)):L?(r+aa&&g(a,u.Ee,.2*(r+aa)),H+b&&(r=y.bd(a,P)[1],g(a,Math.abs(r)>Math.PI/4?u.nd:u.ta,.2*(H+b))),y.Gg(a,e+d,0)):(y.Uc(a,.5*(r+aa),.5*(H+b)),h&&(a=y.Xk(a,N),B.Wl(h,a[0],a[1])))}});c.lh(d,"DEC_STEREO_DIST",c.pd,c.cy,function(a){y.yw(a,.9*y.Zt(a))});c.lh(d,"INC_STEREO_DIST",c.pd,c.fy,function(a){y.yw(a,1.1*y.Zt(a))})};a.sJ=function(){for(var a=K.Uk(),b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL".split(" "),
f=0;f<b.length;f++)c.se(a,b[f])};a.AJ=function(a){function b(a){return a[0]&&(a[1]||a[2])}function f(a,b,e){if(1==e)switch(e=c.Nb(a,b,0),b){case "FORWARD":r?B.ri(a,1):k.vc(a,0,0,1*e);break;case "BACKWARD":r?B.ri(a,-1):k.vc(a,0,0,-1*e);break;case "LEFT":r?B.qi(a,-1):k.vc(a,1*e,0,0);break;case "RIGHT":r?B.qi(a,1):k.vc(a,-1*e,0,0)}else switch(b){case "FORWARD":case "BACKWARD":r&&B.ri(a,0);break;case "LEFT":case "RIGHT":r&&B.qi(a,0)}}var r=B.fc(a)||B.gc(a),e=c.kh(),d=c.Qa(c.Pq),u=c.Qa(c.Nq),l=c.Qa(c.Iq),
n=c.Qa(c.Jq),h=c.Qa(c.Oq),g=c.Qa(c.Kq),p=c.Qa(c.Lq),L=c.Qa(c.Mq);c.L(a,"FORWARD",c.ba,[e,d,h],b,f);c.L(a,"BACKWARD",c.ba,[e,u,g],b,f);c.L(a,"LEFT",c.ba,[e,l,p],b,f);c.L(a,"RIGHT",c.ba,[e,n,L],b,f)};a.uJ=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],f=0;f<b.length;f++)c.se(a,b[f])};a.BB=function(){c.tp(document,!1);c.up(F,!0);c.wp(F,!0);c.vp(F,!0);c.Rl()};a.tJ=function(){c.hq(document);c.iq(F);c.kq(F);c.jq(F);c.lx()};a.zJ=function(){c.lh(null,"CAMERA_SHOT",c.pd,c.ay,function(){I.CD()});
c.lh(null,"LIGHT_SHOT",c.pd,c.by,function(){I.FD()});c.lh(null,"TELEMETRY",c.pd,c.gy,function(){I.lp()})};a.BE=function(a,b){var f=document.body;function c(){document.fullscreenElement===f||document.webkitFullScreenElement===f||document.mozFullScreenElement===f||document.webkitIsFullScreen||document.msFullscreenElement===f?a():(document.removeEventListener("fullscreenchange",c,!1),document.removeEventListener("webkitfullscreenchange",c,!1),document.removeEventListener("mozfullscreenchange",c,!1),
document.removeEventListener("MSFullscreenChange",c,!1),b())}a=a||function(){};b=b||function(){};document.addEventListener("fullscreenchange",c,!1);document.addEventListener("webkitfullscreenchange",c,!1);document.addEventListener("mozfullscreenchange",c,!1);document.addEventListener("MSFullscreenChange",c,!1);f.requestFullScreen=f.requestFullScreen||f.webkitRequestFullScreen||f.mozRequestFullScreen||f.msRequestFullscreen;f.requestFullScreen==f.webkitRequestFullScreen?f.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):
f.requestFullScreen()};a.DB=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.mA=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?!0:!1};a.SL=J;a.cl=function(a){a=!!a;var b=location.href.toString();if(-1==
b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),f={},c=0;c<b.length;c++){var r=b[c].split("="),e=r[0];1<r.length?(r=r[1],a?e in f?f[e].push(r):f[e]=[r]:f[e]=r):a?e in f||(f[e]=[]):f[e]=""}return f};a.jJ=function(a,b,f,c,r,e,k){D(f,c,r,function(r){var d=r;e&&(d+=e);a.style[b]=d;(f>c&&r<=c||f<c&&r>=c)&&k()})}};b4w.module.animation=function(a,w){var e=w("__animation"),b=w("__constraints");w("__physics");var q=w("__print"),d=w("__util");a.Pa=e.Pa;a.ar=e.ar;a.br=e.br;a.cr=e.cr;a.dr=e.dr;a.er=e.er;a.fr=e.fr;a.Em=e.Em;a.Fm=e.Fm;a.Rq=e.Rq;a.Tq=e.Tq;a.Wq=e.Wq;a.Vq=e.Vq;a.Uq=e.Uq;a.Sq=e.Sq;a.wm=e.wm;a.xm=e.xm;a.ym=e.ym;var h=new Float32Array(4);a.Ia=function(a){return e.Ia(a)};a.WJ=function(){q.error("get_actions() deprecated, use get_anim_names() instead");for(var a=[],b=e.jC(),d=0;d<b.length;d++)a.push(e.HF(b[d].name));
return a};a.eK=function(b,e){q.error("get_current_action() deprecated, use get_current_anim_name() instead");return a.vC(b,e)};a.st=function(a){return e.ml(a)?e.st(a):[]};a.vC=function(a,b){if(!e.Ia(a))return null;b=b||e.Pa;return e.wC(a,b)};a.apply=function(a,b,d){if(d>e.Em)q.error("Can't apply animation to slot "+d+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{d=d||e.Pa;if(e.Ia(a)){var h=e.mo(a,b);if(-1!=h&&h!=d){q.error('Animation "'+b+'" is already applied to object "'+
a.name+'" (slot "'+h+'").');return}}e.xG(a,b)?e.apply(a,b,d):q.error('No fcurves in action "'+b+'"')}};a.remove=function(a){e.remove(a)};a.Wv=function(a,b){e.Ia(a)&&(b=b||e.Pa,e.Wv(a,b))};a.Tm=function(a){e.Tm(a)};a.play=function(a,b,d){e.Ia(a)?(d=d||e.Pa,e.play(a,b,d),e.om(a,0,d)):q.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){e.Ia(a)&&(b=b||e.Pa,e.stop(a,b))};a.ej=function(a,b){if(!e.Ia(a))return!1;b=b||e.Pa;return e.ej(a,b)};a.Fp=function(b,e,d){q.error("set_current_frame_float() deprecated, use set_frame() instead");
a.WE(b,e,d)};a.fo=function(b,e){q.error("get_current_frame_float() deprecated, use get_frame() instead");return a.CC(b,e)};a.WE=function(a,b,d){e.Ia(a)&&(d=d||e.Pa,e.Fp(a,b,d),e.om(a,0,d))};a.CC=function(a,b){if(!e.Ia(a))return 0;b=b||e.Pa;return e.fo(a,b)};a.ww=function(a,b,d){e.Ia(a)&&(d=d||e.Pa,e.ww(a,b||1,d))};a.Wt=function(a,b){if(!e.Ia(a))return 0;b=b||e.Pa;return a.w[b]?e.Wt(a,b):0};a.lK=function(a,b){q.error("get_frame_range() deprecated, use get_anim_start_frame() and get_anim_length() instead");
if(e.Ia(a)){b=b||e.Pa;var d=a.w[b];if(d)return[d.start,d.start+d.length]}return null};a.tt=function(a,b){return e.Ia(a)&&(b=b||e.Pa,a.w[b])?e.tt(a,b):-1};a.rt=function(a,b){return e.Ia(a)&&(b=b||e.Pa,a.w[b])?e.rt(a,b):-1};a.Mc=function(b,d,h){q.error("cyclic() deprecated, use set_behavior() instead");a.Ul(b,d?e.wm:e.xm,h)};a.Ch=function(a,b){q.error("is_cyclic() deprecated, use get_behavior() instead");if(!e.Ia(a))return!1;b=b||e.Pa;return e.Ch(a,b)};a.Ul=function(a,b,d){e.Ia(a)&&(d=d||e.Pa,e.Ul(a,
b,d))};a.wt=function(a,b){if(!e.Ia(a))return null;b=b||e.Pa;return e.wt(a,b)};a.xr=function(a,b,d,h){h=h||e.Pa;e.Ia(a)&&e.xr(a,b,d,h)};a.om=function(a,b,d){e.Ia(a)&&(d=d||e.Pa,e.om(a,b||0,d))};a.it=function(a){return e.it(a)};a.$J=function(a,e,q){if(!d.gg(a))return null;q||(q=new Float32Array(3));b.pC(a,e,!1,h,null);q[0]=h[0];q[1]=h[1];q[2]=h[2];return q};a.Xi=function(a){return d.ec(a)?e.Xi(a):null};a.mo=function(a,b){return e.Ia(a)&&b?e.mo(a,b):null};a.YJ=function(a,b){if(!e.Ia(a))return null;b=
b||e.Pa;return e.lC(a,b)};a.ut=function(a,b){return e.Ia(a)?e.ut(a,b):null};a.yr=function(a,b){return e.yr(a,b)};a.EK=function(a){return a.d.Ge};a.uw=function(a,b,h){d.gg(a)?(b=Math.min(Math.max(b,0),1),a.d.Ge!=b&&e.uw(a,b,h||0)):q.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.__animation=function(a,w){function e(a,b){var f=a.w[b];f&&f.Vn&&f.Ri&&(f.Ri=!1,f.Vn(a))}function b(a,b,f){f=a.w[f];f.type=30;var c=b.frame_start,r=b.frame_end-c+1;f.start=c;f.length=r;f.rc=c;f.Ie=b.name;for(r=c=0;r<a.data.b4w_vertex_anim.length;r++){var e=a.data.b4w_vertex_anim[r];if(e==b)break;else c+=e.frame_end-e.frame_start+1}f.vx=c}function q(a,b,f){a=a.w[f];a.type=50;a.Ie=b.name;f=b.settings;a.start=f.frame_start;a.length=f.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=f.lifetime);
a.xc=b}function d(a){return a.replace(/_B4W_BAKED$/,"")}function h(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:Q.sa("Wrong animation behavior")}}function p(a){var b=[];a=a.data.materials;for(var f=0;f<a.length;f++){var c=a[f].node_tree;c&&g(c,b)}return b}function g(a,b){if(a.animation_data){var f=a.animation_data.action;f&&Q.je(f.fcurves)&&b.push(f)}for(var f=a.nodes,c=0;c<f.length;c++){var r=f[c];r.node_group&&(r=r.node_group.node_tree)&&
g(r,b)}}function v(a){return Q.ec(a)&&a.d.tm?!0:!1}function m(a){a=a.modifiers;for(var b=0;b<a.length;b++){var f=a[b];if("ARMATURE"==f.type)return f.object}return null}function t(a,b,f){if(-1==b)for(b=0;8>b;b++){var c=a[b];c&&f(c)}else(c=a[b])&&f(c)}function z(a,b,f){M(a,b,f);e(a,f);a.d.He&&(B(a,b),x(a,b))}function C(a,b,f){var r=b.frame_range,e=b.d,k=a.w[f];k.Ie=b.name;k.kr=r;k.nz=e.bE;k.lz=e.Sz;k.start=r[0];k.length=r[1]-r[0];k.rc=r[0];r=Q.je(e.sk);if(Q.gg(a)&&r){k.type=10;var d=J(a,b);d||(d=E(a,
b,n(a)),a.Ud.push(b,d));k.g=d.g;k.xa=d.xa;var k=a.d,d=k.em,u=a.w[f],e=u.Op,h;a:{h=k.Iw;for(var L=0;L<h.length;L+=2)if(b==h[L]){h=h[L+1];break a}h=null}if(h)u.Op=h;else{for(u=0;u<d.length;u++)h=E(a,b,d[u].Lc),e.push(h);k.Iw.push(b,e)}k.He&&(b=k.lm,f>b[1]?(k=b[1],b[1]=f,b[0]=k):f>b[0]&&f<b[1]&&(b[0]=f),D(a))}else if(ea.pe(a)&&(e.Sa.volume||e.Sa.pitch))k.volume=e.Sa.volume||null,k.pitch=e.Sa.pitch||null,k.type=40;else if("MESH"==a.type&&c(b)){k.type=60;e=J(a,b);if(!e){e=[];u=[];h=[];var L=[],F=b.d,q=
a.d.vl,g=a.d.wl;for(d in F.Sa){var m=b.name+"%join%"+d;l(d,m,F,u,e,q);l(d,m,F,L,h,g)}e={wG:e,values:u,DE:h,EE:L};a.Ud.push(b,e)}k.dv=e.wG;k.fv=e.values;k.cv=e.DE;k.ev=e.EE}else if(d=e.Sa.tsr){k.type=20;e=J(a,b);if(!e){e=b.d.iv;u=[];h=[];for(L=0;L<e;L++)u.push(d.subarray(8*L,8*L+4)),h.push(d.subarray(8*L+4,8*L+8));e={g:u,xa:h};a.Ud.push(b,e)}k.g=e.g;k.xa=e.xa;P.wo(a)&&P.pG(a,k.g,k.xa)}else return R.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;Q.gg(a)&&!r&&y(a,
f);return!0}function J(a,b){for(var f=a.Ud,c=0;c<f.length;c+=2)if(b==f[c])return f[c+1];return null}function D(a){var b=a.d.lm;if(-1!=b[0]&&-1!=b[1]){var f=a.w;a=f[b[1]].rc;var c=Math.floor(a),r=a-c,b=f[b[0]];a=b.rc;c=Math.floor(a);b.rc=c+r}}function y(a,b){var f=a.d.lm,c=f[1];f[0]=-1;f[1]=-1;if(-1!=b)for(var r=a.w;0<=c;c--){var e=r[c];if(e&&10==e.type)if(c>f[1])f[1]=c;else{c>f[0]&&(f[1]=c);break}}}function n(a){var b=a.data.bones;a=a.pose.bones;for(var f={},c=0;c<b.length;c++){var r=b[c].name;f[r]=
{Rr:c,Ki:c,mp:Q.jo(a,"name",r),xx:-1}}return f}function l(a,b,f,c,r,e){for(var k=0;k<e.length;k+=2)if(b==e[k]){r.push(e[k+1]);c.push(new Float32Array(f.Sa[a]));break}}function c(a){a=a.d;for(var b in a.Sa)if(-1!=b.indexOf("nodes"))return!0;return!1}function M(a,b,f){if((f=a.w[f])&&null!=f.type&&(f.play||0==b)){var c=a.d,r=f.rc,e=f.start,k=f.length,r=r+f.speed*b*fa.La,d=f.type,u=f.speed;if(0<=u&&r>=e+k||0>u&&r<e)switch(f.Ri=!0,f.behavior){case 10:r=0<=u?(r-e)%k+e:e+k-1E-6;break;case 20:r=0<=u?e:e+
k-1E-6;f.play=!1;break;case 30:r=0<=u?e+k-1E-6:e,f.play=!1}f.rc=r;switch(d){case 10:if(!c.He){r=I(f,r,da);b=r[0];e=r[1];r=r[2];c.zc=f.xa[b];c.yc=f.xa[e];c.Hc=f.g[b];c.Gc=f.g[e];c.Wf=r;c=c.em;f=f.Op;for(k=0;k<c.length;k++)d=c[k],u=f[k],d.zc=u.xa[b],d.yc=u.xa[e],d.Hc=u.g[b],d.Gc=u.g[e],d.Wf=r;U.F(a)}break;case 20:d=r=I(f,r,da);(c=ca)||(c=new Float32Array(4));var e=d[0],k=d[1],d=d[2],u=f.g,h=u[e][1],l=u[e][2],n=u[k][1],L=u[k][2];c[0]=(1-d)*u[e][0]+d*u[k][0];c[1]=(1-d)*h+d*n;c[2]=(1-d)*l+d*L;e=r;(k=oa)||
(k=new Float32Array(4));d=f.xa;A.slerp(d[e[0]].subarray(0,4),d[e[1]].subarray(0,4),e[2],k);e=k;k=r[2];d=f.g;r=(1-k)*d[r[0]][3]+k*d[r[1]][3];f.eq&&(k=Z,U.zd(a,k),Q.Yh(c,k,b,f.eq,c));f.rp&&(k=la,U.Se(a,k),Q.Lw(e,k,b,f.rp,e));U.kd(a,c);U.Fd(a,e);U.gf(a,r);U.F(a);V.T(a);break;case 30:(a=da)||(a=Array(3));e=r-f.start;0>e&&(e=0);e>=f.length&&(e=f.length);b=Math.floor(e);r=b+1;e-=b;10!=f.behavior&&r==f.length&&(r=--b,e=1);f=f.vx;a[0]=b+f;a[1]=r+f;a[2]=e;r=da;c.oq=r[0];c.ux=r[2];break;case 40:r=I(f,r,da);
b=r[0];c=r[1];r=r[2];f.volume&&ea.Lp(a,(1-r)*f.volume[b]+r*f.volume[c]);f.pitch&&ea.sj(a,(1-r)*f.pitch[b]+r*f.pitch[c]);break;case 50:P.dF(f.xc,r/fa.La);break;case 60:r=I(f,r,da);b=r[0];c=r[1];r=r[2];u=f.fv;h=f.dv;e=f.ev;f=f.cv;for(k=0;k<h.length;k++)l=u[k],d=h[k],a.d.Ye[d]=(1-r)*l[b]+r*l[c];for(k=0;k<f.length;k++)u=e[k],d=f[k],u=ka.lerp(u.subarray(3*b,3*b+3),u.subarray(3*c,3*c+3),r,ca),a.d.Ad[d]=u[0],a.d.Ad[d+1]=u[1],a.d.Ad[d+2]=u[2];break;default:Q.sa("Unknown animation type:"+d)}}}function I(a,
b,f){f||(f=Array(3));var c=a.kr[0],r=a.kr[1]-c;b-=c;0>b&&(b=0);b>=r&&(b=r);b/=a.nz;r=Math.floor(b);a=a.lz[r]?b-r:0;f[0]=r;f[1]=r+1;f[2]=a;return f}function x(a,b){var f=a.d,c=f.Ge,r=f.lm,e=r[0],r=r[1];if(-1!=r){if(-1!=e){var k=a.w[e];if(k.play||0==b)var d=I(k,k.rc,da),u=d[0],h=d[1],d=d[2],l=k.xa[u],n=k.xa[h],u=k.g[u],h=k.g[h];else c=1}else c=1;r=a.w[r];if(r.play||0==b)var d=I(r,r.rc,da),L=d[0],F=d[1],d=d[2];else if(-1!=e&&k.play)c=0;else return;e=r.xa[L];k=r.xa[F];L=r.g[L];r=r.g[F];if(1==c)f.zc.set(e),
f.yc.set(k),f.Hc.set(L),f.Gc.set(r);else if(0==c)f.zc.set(l),f.yc.set(n),f.Hc.set(u),f.Gc.set(h);else{for(F=0;F<l.length;F+=4){for(var q=oa,g=la,m=0;4>m;m++)q[m]=l[F+m],g[m]=e[F+m];A.slerp(q,g,c,q);for(m=0;4>m;m++)f.zc[F+m]=q[m];for(m=0;4>m;m++)q[m]=n[F+m],g[m]=k[F+m];A.slerp(q,g,c,q);for(m=0;4>m;m++)f.yc[F+m]=q[m]}Q.Nr(u,L,c,f.Hc);Q.Nr(h,r,c,f.Gc)}U.F(a);c=f.em;l=f.$u;for(F=0;F<c.length;F++){n=c[F];u=l[F];for(h=0;h<u.length;h+=2)for(L=u[h],e=u[h+1],k=0;4>k;k++)n.zc[L+k]=f.zc[e+k],n.yc[L+k]=f.yc[e+
k],n.Hc[L+k]=f.Hc[e+k],n.Gc[L+k]=f.Gc[e+k];n.Wf=d}}}function B(a,b){var f=a.d,c=f.Ge,r=f.Om;if(0!=r){var c=f.Nm-c,e=r*b;Q.sign(c)==Q.sign(r)&&Math.abs(e)<Math.abs(c)?f.Ge+=e:(f.Ge=f.Nm,f.Om=0)}}function E(a,b,f){for(var c=a.pose.bones,r=[],e=[],k=b.d.iv,d=0;d<k;d++){for(var u=0;u<c.length;u++){var h=c[u],l=X.create(),n=b.d.sk[h.name];n&&X.copy(n.subarray(8*d,8*d+8),l);h.ir=l;h.ik=!1}u=K(a,f);r.push(u.g);e.push(u.xa)}return{g:r,xa:e}}function K(a,b){var f=[],c=[],r=a.pose.bones,e=new Float32Array(4),
k=new Float32Array(4),d;for(d in b){var u=b[d],h=u.Ki,l=r[u.mp],u=e,n=k,L=l.dz,F=L[L.length-1],m=F.Jm;F.ik||X.identity(m);for(F=L.length-1;0<=F;F--){var l=L[F],q=l.Jm;if(l.ik)m=q;else{var g=l.jr,N=l.ir;X.invert(g,ma);X.multiply(N,ma,ma);X.multiply(g,ma,ma);X.multiply(m,ma,q);m=q;l.ik=!0}}l=l.Jm;u[0]=l[0];u[1]=l[1];u[2]=l[2];u[3]=l[3];n[0]=l[4];n[1]=l[5];n[2]=l[6];n[3]=l[7];A.normalize(n,n);for(u=0;4>u;u++)n=4*h+u,f[n]=e[u],c[n]=k[u]}f=new Float32Array(f);c=new Float32Array(c);return{g:f,xa:c}}function k(a,
b,f,c,r,e,d){var l=a+(b-a)/2,h=u(l,c,r,e,d)-f;return.02>Math.abs(h)?l:0<h?k(a,l,f,c,r,e,d):k(l,b,f,c,r,e,d)}function u(a,b,f,c,r){var e=1-a;return b*e*e*e+3*f*e*e*a+3*c*e*a*a+r*a*a*a}function r(a,b){if(!a.w.length)for(var f=0;8>f;f++)a.w.push(null);a.w[b]={type:null,Ie:null,xa:null,g:null,Op:[],play:!1,behavior:20,rc:0,start:0,length:0,eq:0,rp:0,Ri:!1,vx:null,speed:1,volume:null,pitch:null,fv:[],dv:[],ev:[],cv:[]};a.Ud=a.Ud||[];-1==ha.indexOf(a)&&ha.push(a)}function L(a,b){U.F(a);V.T(a);z(a,0,b)}
function F(a,f,c){c=c||0;if(Q.ec(a)){var e=Q.Xb("name",f,a.data.b4w_vertex_anim);if(e)return r(a,c),b(a,e,c),L(a,c),!0;if((e=Q.Xb("name",f,a.particle_systems))&&"EMITTER"==e.settings.type)return r(a,c),q(a,e,c),L(a,c),!0}if(e=Q.Xb("name",f,pa)||Q.Xb("name",f+"_B4W_BAKED",pa)){r(a,c);if(C(a,e,c))return L(a,c),!0;a.w[c]=null}R.error('Unsupported object: "',a.name,'" or animation name: "',f,'"');return!1}function f(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<
a.length;b++){var f=a[b],c=f.node_tree;if(f.use_nodes&&c&&c.animation_data)return!0}return!1}var N=w("__config"),P=w("__particles"),V=w("__physics"),R=w("__print");w("__scenes");var ea=w("__sfx"),U=w("__transform"),X=w("__tsr"),Q=w("__util"),S=w("__reformer");w("mat4");var A=w("quat");w("vec4");var ka=w("vec3"),fa=N.Wd;a.Rq=10;a.Tq=20;a.Wq=30;a.Vq=40;a.Uq=50;a.Sq=60;a.Pa=0;a.ar=1;a.br=2;a.cr=3;a.dr=4;a.er=5;a.fr=6;a.Em=7;a.Fm=-1;a.wm=10;a.xm=20;a.ym=30;var da=Array(3),ca=new Float32Array(3),Z=new Float32Array(3),
oa=new Float32Array(4),la=new Float32Array(4),ma=new Float32Array(8);new Float32Array(16);var ha=[],pa=[];a.it=function(a){return a/fa.La};a.update=function(a){for(var b=0;b<ha.length;b++){for(var f=ha[b],c=0;8>c;c++)M(f,a,c);f.d.He&&(B(f,a),x(f,a))}for(b=0;b<ha.length;b++)for(f=ha[b],c=0;8>c&&f.w.length;c++)e(f,c)};a.jC=function(){return pa};a.wC=function(a,b){var f=a.w[b];return f&&f.Ie?d(f.Ie):null};a.st=function(a){var b=[];if(v(a))for(var f=0;f<a.data.b4w_vertex_anim.length;f++)b.push(a.data.b4w_vertex_anim[f].name);
var r,f=[];for(r=0;r<pa.length;r++){var e=pa[r],k=e.d;Q.je(e.d.sk)?"ARMATURE"==a.type&&f.push(e):k.Sa.volume||k.Sa.pitch?ea.pe(a)&&f.push(e):!c(e)&&e.fcurves.length&&f.push(e)}"MESH"==a.type&&(f=f.concat(p(a)));r=f;for(f=0;f<r.length;f++)b.push(d(r[f].name));if(P.wo(a)&&P.so(a))for(f=0;f<a.particle_systems.length;f++)b.push(a.particle_systems[f].name);return b};a.HF=d;a.ut=function(a,b){var f=a.w[b];return f?f.type:null};a.Tm=function(a){var f=0,c,e=[];if((c=a.animation_data)&&c.action&&(c=c.action,
Q.je(c.fcurves))){var k=Q.je(c.d.sk);"ARMATURE"!=a.type&&k||e.push(c)}ea.pe(a)&&a.data.animation_data&&a.data.animation_data.action&&e.push(a.data.animation_data.action);"MESH"==a.type&&(e=e.concat(p(a)));c=e;for(e=0;e<c.length;e++)k=c[e],r(a,f),C(a,k,f)?(L(a,f),a.w[f].behavior=h(a.b4w_anim_behavior),f++):a.w[f]=null;c=a.particle_systems;for(e=0;e<c.length;e++){var k=c[e],d=k.settings;"EMITTER"==d.type&&(r(a,f),q(a,k,f),L(a,f),a.w[f].behavior=h(a.b4w_anim_behavior),d.b4w_cyclic&&(a.w[f].behavior=
10),f++)}v(a)&&(r(a,f),b(a,a.data.b4w_vertex_anim[0],f),L(a,f),a.w[f].behavior=h(a.b4w_anim_behavior))};a.Xi=m;a.play=function(a,b,f){t(a.w,f,function(a){a.play=!0;a.Vn=b?b:null;a.Ri=!1});a.d.He&&D(a)};a.stop=function(a,b){t(a.w,b,function(a){a.play=!1;a.Vn=null;a.Ri=!1})};a.ej=function(a,b){var f=a.w[b];return f?f.play:!1};a.Fp=function(a,b,f){var c=a.w;if(-1==f)for(f=0;8>f;f++){var r=c[f];r&&(r.rc=b,z(a,0,f))}else if(r=c[f])r.rc=b,z(a,0,f)};a.fo=function(a,b){var f=a.w[b];return f&&f.rc?f.rc:0};
a.Ch=function(a,b){var f=a.w[b];return f&&10==f.behavior};a.Ul=function(a,b,f){t(a.w,f,function(a){a.behavior=b})};a.wt=function(a,b){var f=a.w[b];return f&&f.behavior};a.xr=function(a,b,f,c){t(a.w,c,function(a){a.eq=b||0;a.rp=f||0})};a.Wv=function(a,b){if(-1==b)for(var f=0;8>f;f++)a.w[f]=null;else a.w[b]=null;a.d.He&&y(a,b)};a.om=z;a.ml=function(a){if("ARMATURE"==a.type||m(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||
P.wo(a)&&P.so(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||f(a)?!0:!1};a.Ia=function(a){return Boolean(a.w.length)};a.Zz=n;a.Tr=K;a.pz=function(a){function b(a,f){for(var H=0;H<f;H++){var c=a.subarray(8*H+4,8*H+8);A.normalize(c,c)}}function f(a,b){if(-1<a.indexOf("location"))var H=0,c=b;else-1<a.indexOf("rotation_quaternion")?(H=4,c=0==b?3:b-1):-1<a.indexOf("scale")?(H=3,c=0):(H=0,c=b);return H+c}function c(a,b,f,H,r){if(-1<f.search(e)){a=b;f=f.split('"')[1];var d=k}else 8==r?(f="tsr",d=k):
d=1<r?new Float32Array(r):0;if(!a[f]){r=a;b=f;if("object"==typeof d&&d.length)for(var u=d.length,h=new Float32Array(H*u),l=0;l<H;l++)for(var n=0;n<u;n++)h[l*u+n]=d[n];else if("number"==typeof d)for(h=new Float32Array(H),l=0;l<H;l++)h[l]=d;else Q.sa("Wrong storage default value");r[b]=h}return a[f]}a.d={};var r=a.d;r.bE=1/fa.Xf;var e=new RegExp(/pose.bones\[\".+\"\]/g),k=X.create(),d=a.fcurves,u={},l={},h=0,n;for(n in d){var L=d[n],F;for(F in L){var m=L[F],q=m.nc;S.gA(m,a);m=m.num_channels;h||(h=q.length);
for(var m=c(u,l,n,h,m),g=m.length/h,N=f(n,F|0),p=0;p<h;p++)m[p*g+N]=q[p]}}for(var v in u)"tsr"==v&&b(u[v],h);for(var Z in l)b(l[Z],h);r.Sa=u;r.sk=l;r.Sz=a.cz;r.iv=h;pa.push(a)};a.nC=function(a,b){return(b-a)*fa.Xf+1};a.Iz=function(a,b,f,c,r,e){var d,l,h=new Float32Array(2),n=new Float32Array(2),L=new Float32Array(2),F=new Float32Array(2),m=b[1],q=b[2],g=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var N=0,p=0,v=null;r<=e;r++)if(r<m)for(var Z=0;Z<fa.Xf;Z++)f[N++]=q;else if(r>g)for(Z=0;Z<
fa.Xf;Z++)f[N++]=a;else{var t=b[p],B=3;0===t&&(B+=2);0===v&&(B+=2);var x=2===t?0:1;if(b[p+1]==b[p+B+1])v=t,p+=B;else{Z=0;r==b[p+1]&&(x&&(c[N]=1),f[N]=b[p+2],N++,Z++);if(r==g)for(;Z<fa.Xf;Z++)f[N++]=a;else for(h[0]=b[p+1],h[1]=b[p+2],0!==t?(n[0]=0,n[1]=0):0===v?(n[0]=b[p+5],n[1]=b[p+6]):(n[0]=b[p+3],n[1]=b[p+4]),0!==t?(L[0]=0,L[1]=0):(L[0]=b[p+B+3],L[1]=b[p+B+4]),F[0]=b[p+B+1],F[1]=b[p+B+2];Z<fa.Xf;Z++){var P=r+Z/fa.Xf;switch(t){case 0:d=h;l=n;var z=L,y=F,K=[],D=[],C=void 0,oa=void 0,ca=void 0,C=void 0;
K[0]=d[0]-l[0];K[1]=d[1]-l[1];D[0]=y[0]-z[0];D[1]=y[1]-z[1];ca=y[0]-d[0];C=Math.abs(K[0]);oa=Math.abs(D[0]);0!=C+oa&&C+oa>ca&&(C=ca/(C+oa),l[0]=d[0]-C*K[0],l[1]=d[1]-C*K[1],z[0]=y[0]-C*D[0],z[1]=y[1]-C*D[1]);x&&(c[N]=1);f[N]=u(k(0,1,P,h[0],n[0],L[0],F[0]),h[1],n[1],L[1],F[1]);N++;break;case 1:l=h[0];z=h[1];d=y=(F[1]-z)/(F[0]-l);l=z-y*l;x&&(c[N]=1);f[N]=d*P+l;N++;break;case 2:x&&(c[N]=1);f[N]=b[p+2];N++;break;default:Q.sa("Unknown keyframe intepolation mode: "+t)}}r+1==b[p+B+1]&&(v=t,p+=B)}}};a.KJ=
function(a){for(var b=0;b<a.length;b++)if(a[b].cI)return a[b];return!1};a.apply=F;a.xG=function(a,b){var f=Q.Xb("name",b,pa)||Q.Xb("name",b+"_B4W_BAKED",pa);return f?Q.je(f.fcurves)?!0:!1:Q.Xb("name",b,a.particle_systems)?!0:!1};a.mo=function(a,b){for(var f=a.w,c=0;c<f.length;c++){var r=f[c];if(r&&d(r.Ie)==d(b))return c}return-1};a.lC=function(a,b){var f=a.w[b];return f&&f.Ie?d(f.Ie):null};a.remove=function(a){a.w.length=0;a=ha.indexOf(a);-1!=a&&ha.splice(a,1)};a.sE=function(a){for(var b=pa.length-
1;0<=b;b--)pa[b].ez==a&&pa.splice(b,1)};a.yr=function(a,b){if(!a.w.length)return F(a,b,0)?0:-1;for(var f=0;f<a.w.length;f++)if(!a.w[f])return F(a,b,f)?f:-1};a.uw=function(a,b,f){a.d.Om=(b-a.d.Ge)/f;a.d.Nm=b};a.ww=function(a,b,f){t(a.w,f,function(a){a.speed=b})};a.Wt=function(a,b){return a.w[b].speed};a.tt=function(a,b){return a.w[b].start};a.rt=function(a,b){return a.w[b].length};a.qu=f;a.Y=function(){ha.length=0;pa.length=0};a.MB=function(a,b){var f=a[b],c=(f[0]||f[1]||f[2]).nc.length,r=oa,e=ca,
k=Boolean(f[0]);k||(f[0]={nc:new Float32Array(c),num_channels:8});var d=Boolean(f[1]);d||(f[1]={nc:new Float32Array(c),num_channels:8});var u=Boolean(f[2]);u||(f[2]={nc:new Float32Array(c),num_channels:8});f[3]={nc:new Float32Array(c),num_channels:8};for(var l=0;l<c;l++)e[0]=k?f[0].nc[l]:0,e[1]=d?f[1].nc[l]:0,e[2]=u?f[2].nc[l]:0,Q.Qe(e,r),f[0].nc[l]=r[3],f[1].nc[l]=r[0],f[2].nc[l]=r[1],f[3].nc[l]=r[2];c=b.replace("euler","quaternion");a[c]=f;delete a[b]}};b4w.module.__config=function(a,w){function e(){return b4w.module_check(a.Yb.tk)}function b(){for(var b=a.Yb,e=null,d=document.getElementsByTagName("script"),v=0;v<d.length;v++){for(var m=d[v].src,t=0;t<b.Nu.length;t++)if(0<=m.indexOf(b.Nu[t])){e=m;break}if(null!==e)break}e||(q.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),e=document.location.href);b=e.indexOf("?");0<=b&&(e=e.substring(0,b));return e.substring(0,e.lastIndexOf("/")+1)}var q=w("__print"),
d=w("__util");a.Df=1;a.Cf=2;a.Wg=3;a.$q=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.BA=d.za(a.context);a.p={alpha_sort:!0,alpha_sort_threshold:.1,Xo:"5.02",Ze:1E4,console_verbose:!1,do_not_load_resources:!1,qm:!1,QB:1.5,PB:10,background_color:[0,0,0,0],force_selectable:!1,all_objs_selectable:!1,qg:.01,resolution_factor:1,canvas_resolution_factor:1,im:3,allow_cors:!1,Yn:!1,kk:!0,show_hud_debug_info:!1,pJ:!0,hf:"DEPTH",anaglyph_use:!1,Ql:!0,zj:.5,fd:!0,glow:!0,of:!0,ph:!0,zh:!0,dh:!0,
Jh:!0,jh:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,Ex:!1,Si:!0,pj:!0,bb:!0,Ml:!0,water_dynamic:!0,Uh:!0,am:!0,Bd:1024,Uo:512,dd:53,rx:!0,precision:"highp",quality:a.Cf,Mm:!0,RD:!1,Gw:!1,Qs:!1,wx:!1,hg:!1,zu:!1,on:!1,dt:!1,JM:!1,jd:!1,allow_hidpi:!1,jl:!1,et:!1};a.lB=d.za(a.p);a.Wd={La:-1,jt:!1,Xf:1};a.controls={OD:1/120};a.Xd={dir:"ASSETS=../../assets/",JD:15,Gv:!0,Wo:!1,Hn:!1};a.Kz=d.za(a.Xd);a.Yb={shaders_dir:"",lF:"include/",tk:"built_in_data",Nu:["b4w.min.js","b4w.full.min.js","src/b4w.js",
"webplayer.min.js"],Zv:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.Bb={enabled:!0,Ze:60,Qj:""};a.aE=d.za(a.Bb);a.Gj={fl:1024,Jk:384};a.LE=d.za(a.Gj);a.ld={wq:!0,zl:!1,Hr:!1,es:!1,Rs:!1};a.kF=d.za(a.ld);a.In={enabled:!1,OF:"MAIN_OPAQUE",NF:0,oF:"COLOR"};a.hB=d.za(a.In);a.Hz=function(){var b=a.p,e=a.Bb,d=a.Gj;switch(b.quality){case a.Wg:b.hf="DEPTH";b.Uh=!0;b.glow=!0;b.of=!0;b.ph=!0;b.zh=!0;b.dh=!0;b.Ql=!0;b.zj=1;b.fd=!0;b.Si=!0;b.pj=!0;b.bb=!0;b.Ml=!0;b.resolution_factor=1.75;d.fl=
2048;b.im=3;b.kk=!0;b.qm=!1;b.dd=53;b.precision="highp";b.water_dynamic=!0;b.am=!0;b.antialiasing=!0;b.smaa=!0;b.jh=!0;b.Jh=!0;b.allow_hidpi=!0;e.Ze=120;break;case a.Cf:b.hf="DEPTH";b.Uh=!0;b.glow=!0;b.of=!0;b.ph=!0;b.zh=!0;b.dh=!0;b.Ql=!0;b.zj=.5;b.fd=!0;b.Si=!0;b.pj=!0;b.bb=!0;b.Ml=!0;b.resolution_factor=1;d.fl=1024;b.im=3;b.kk=!0;b.qm=!1;b.dd=53;b.precision="highp";b.water_dynamic=!0;b.am=!0;b.antialiasing=!0;b.smaa=!1;b.jh=!0;b.Jh=!0;b.allow_hidpi=!1;e.Ze=60;break;case a.Df:b.hf="NONE",b.Uh=!1,
b.glow=!1,b.of=!1,b.ph=!1,b.zh=!1,b.dh=!1,b.Ql=!1,b.zj=.5,b.fd=!1,b.Si=!1,b.pj=!1,b.bb=!1,b.Ml=!1,b.resolution_factor=1,d.fl=512,b.im=2,b.kk=!1,b.qm=!0,b.dd=53,b.precision="mediump",b.water_dynamic=!1,b.am=!1,b.antialiasing=!1,b.smaa=!1,b.jh=!1,b.Jh=!1,b.allow_hidpi=!1,e.Ze=60}};a.set=function(b,e){switch(b){case "all_objs_selectable":a.p.all_objs_selectable=e;break;case "allow_cors":a.p.allow_cors=e;break;case "allow_hidpi":a.p.allow_hidpi=e;break;case "alpha":a.context.alpha=e;break;case "alpha_sort":a.p.alpha_sort=
e;break;case "alpha_sort_threshold":a.p.alpha_sort_threshold=e;break;case "anaglyph_use":a.p.anaglyph_use=e;break;case "animation_framerate":a.Wd.La=e;break;case "antialiasing":a.p.antialiasing=e;break;case "assets_dds_available":a.Xd.Hn=e;break;case "assets_min50_available":a.Xd.Wo=e;break;case "audio":a.ld.wq=e;break;case "background_color":a.p.background_color=e;break;case "built_in_module_name":a.Yb.tk=e;break;case "canvas_resolution_factor":a.p.canvas_resolution_factor=e;break;case "console_verbose":a.p.console_verbose=
e;break;case "context_antialias":a.context.antialias=e;break;case "do_not_load_resources":a.p.do_not_load_resources=e;break;case "force_selectable":a.p.force_selectable=e;break;case "gyro_use":a.p.jl=e;break;case "glow":a.p.glow=e;break;case "physics_enabled":a.Bb.enabled=e;break;case "physics_uranium_path":a.Bb.Qj=e;break;case "precision":a.p.precision=e;break;case "quality":a.p.quality=e;break;case "resolution_factor":a.p.resolution_factor=e;break;case "sfx_mix_mode":a.ld.zl=e;break;case "shaders_dir":a.Yb.shaders_dir=
e;break;case "show_hud_debug_info":a.p.show_hud_debug_info=e;break;case "smaa":a.p.smaa=e;break;case "smaa_search_texture_path":a.Yb.smaa_search_texture_path=e;break;case "smaa_area_texture_path":a.Yb.smaa_area_texture_path=e;break;case "wireframe_debug":a.p.wireframe_debug=e;break;default:q.error("Unknown config property: "+b)}};a.get=function(b){switch(b){case "all_objs_selectable":return a.p.all_objs_selectable;case "allow_cors":return a.p.allow_cors;case "allow_hidpi":return a.p.allow_hidpi;case "alpha":return a.context.alpha;
case "alpha_sort":return a.p.alpha_sort;case "alpha_sort_threshold":return a.p.alpha_sort_threshold;case "anaglyph_use":return a.p.anaglyph_use;case "animation_framerate":return a.Wd.La;case "antialiasing":return a.p.antialiasing;case "assets_dds_available":return a.Xd.Hn;case "assets_min50_available":return a.Xd.Wo;case "audio":return a.ld.wq;case "background_color":return a.p.background_color;case "built_in_module_name":return a.Yb.tk;case "canvas_resolution_factor":return a.p.canvas_resolution_factor;
case "console_verbose":return a.p.console_verbose;case "context_antialias":return a.context.antialias;case "do_not_load_resources":return a.p.do_not_load_resources;case "force_selectable":return a.p.force_selectable;case "gyro_use":return a.p.jl;case "glow":return a.p.glow;case "physics_enabled":return a.Bb.enabled;case "physics_uranium_path":return a.Bb.Qj;case "precision":return a.p.precision;case "quality":return a.p.quality;case "resolution_factor":return a.p.resolution_factor;case "sfx_mix_mode":return a.ld.zl;
case "shaders_dir":return a.Yb.shaders_dir;case "show_hud_debug_info":return a.p.show_hud_debug_info;case "smaa":return a.p.smaa;case "smaa_search_texture_path":return a.Yb.smaa_search_texture_path;case "smaa_area_texture_path":return a.Yb.smaa_area_texture_path;case "wireframe_debug":return a.p.wireframe_debug;default:q.error("Unknown config property: "+b)}};a.reset=function(){a.context=d.za(a.BA);a.p=d.za(a.lB);a.Xd=d.za(a.Kz);a.Bb=d.za(a.aE);a.Gj=d.za(a.LE);a.ld=d.za(a.kF);a.In=d.za(a.hB)};a.Du=
e;a.$E=function(){var d=a.Yb,q=a.Bb;e()||""!=d.shaders_dir||(d.shaders_dir=b()+"../shaders/");if(e())d.smaa_search_texture_path="smaa_search_texture.png",d.smaa_area_texture_path="smaa_area_texture.png";else if(""==d.smaa_search_texture_path||""==d.smaa_area_texture_path){var g=b()+d.Zv;d.smaa_search_texture_path=d.smaa_search_texture_path||g+"smaa_search_texture.png";d.smaa_area_texture_path=d.smaa_area_texture_path||g+"smaa_area_texture.png"}q.enabled&&""==q.Qj&&(g=b()+d.Zv,q.Qj=g+"uranium.js")};
a.Yt=function(){return a.Xd.dir.replace("ASSETS=","")}};b4w.module.__print=function(a){function w(a,b){var e=[];-1<a[0].indexOf("%c")?e.push(a[0].replace("%c","%c"+b+": ")):e.push(b+": "+a[0]);for(var q=1;q<a.length;q++)e.push(a[q]);return e}var e=!1,b=0,q=0;a.hF=function(a){e=a};a.log=function(){if(e){var a=w(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=function(){b++;var a=w(arguments,"B4W ERROR");console.error.apply(console,a)};a.warn=function(){q++;var a=w(arguments,"B4W WARN");console.warn.apply(console,a)};a.info=function(){var a=
w(arguments,"B4W INFO");console.info.apply(console,a)};a.FB=function(){b++;var a=w(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.GB=function(){q++;var a=w(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){e&&console.time.apply(console,arguments)};a.timeEnd=function(){e&&console.timeEnd.apply(console,arguments)};a.group=function(){e&&console.group.apply(console,arguments)};a.groupCollapsed=function(){e&&console.groupCollapsed.apply(console,arguments)};
a.groupEnd=function(){e&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.SC=function(){return q};a.AC=function(){return b};a.ks=function(){b=q=0}};b4w.module.print=b4w.module.__print;b4w.module.__util=function(a,w){function e(a,b,f){for(var c=[],r=f.length,e=0;e<r;e++){var k=f[e];k[a]==b&&c.push(k)}return c}function b(a,f){var c=a instanceof Array?[]:{},r;for(r in a)c[r]=!a[r]||"object"!=typeof a[r]||-1!=f.indexOf(a[r])||a[r]instanceof Float32Array?a[r]:b(a[r],f);return c}function q(a){var b=a[0],f=a[1],c=a[2],r=a[3],e=Math.sqrt(b*b+f*f+c*c),e=1/e;a[0]=b*e;a[1]=f*e;a[2]=c*e;a[3]=r*e}function d(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function h(a,b){var f=b;switch(typeof a){case "number":return p(a,
f);case "string":return g(a,f);case "boolean":return p(a|0,f);case "function":case "undefined":return p(0,f);case "object":if(a){var c=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(c=0;c<a.length;c++)f=p(a[c],f);else if(c)for(c=0;c<a.length;c++)f=h(a[c],f);else for(var r in a)f=h(a[r],f)}else f=p(0,f)}return f}function p(a,b){var f=b;N[0]=a;f=(f<<5)-f+P[0];f&=f;f=(f<<5)-f+P[1];return f&f}function g(a,b){for(var f=b,c=0;c<a.length;c++)f=(f<<5)-f+a.charCodeAt(c),
f&=f;return f}function v(a){return(34*a+1)*a%289}function m(a){return a-Math.floor(a)}function t(a){return z((34*a+5)*a)}function z(a){return a-289*Math.floor(a/289)}function C(a){return a-7*Math.floor(a/7)}function J(a,b,f){a-=b;f-=b;return b+(a-Math.floor(a/f)*f)}function D(a,b){if(a&&b){var f=a instanceof Array,c=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,r=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(f!=b instanceof Array||c!=r)return!1;if(f){if(a.length!=b.length)return!1;
for(f=0;f<a.length;f++)if(!y(a[f],b[f]))return!1}else if(c){if(a.length!=b.length)return!1;for(f=0;f<a.length;f++)if(a[f]!=b[f])return!1}else{for(var e in a)if(!y(a[e],b[e]))return!1;for(e in b)if(!(e in a))return!1}return!0}return!(a||b)}function y(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return D(a,b);default:return!0}}var n=w("__print"),l=w("vec3"),c=w("vec4"),M=w("quat"),I=w("mat3"),x=w("mat4"),B=0,E={},K=new Float32Array(3),
k=new Float32Array(3),u=new Float32Array(4),r=new Float32Array(4),L=new Float32Array(9),F=new Float32Array(16),f=new Float32Array(16),N=new Float64Array(1),P=new Uint32Array(N.buffer),V=new Float32Array([0,0,0]),R=new Float32Array([0,0,0,1]),ea=new Float32Array([0,0,0,1,0,0,0,1]),U=new Float32Array([1,0,0]),X=new Float32Array([0,1,0]),Q=new Float32Array([0,0,1]),S=new Float32Array([-1,0,0]),A=new Float32Array([0,-1,0]),ka=new Float32Array([0,0,-1]),fa=Math.floor(44488.07041494893);a.bz=V;a.Xy=R;a.$H=
ea;a.Ee=U;a.ta=X;a.nd=Q;a.Am=S;a.$b=A;a.Bf=ka;a.Ou=e;a.OB=function(a,b){var f=a.length,c=new Float32Array(f+b.length);c.set(a);c.set(b,f);return c};a.YF=function(a,b){var f=a.length,c=new Uint32Array(f+b.length);c.set(a);c.set(b,f);return c};a.lA=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.Jz=function(a,b){var f=[],c={},r=b.length,e,k;for(e=0;e<r;e++)c[b[e]]=!0;r=a.length;for(e=0;e<r;e++)k=a[e],k in c&&f.push(k);return f};a.sign=function(a){return 0<
a?1:0>a?-1:0};a.kL=function(a,b,f){for(var c=f.length,r=0;r<c;r++)if(f[r][a]==b)return!0;return!1};a.Xb=function(a,b,f){for(var c=0;c<f.length;c++){var r=f[c];if(r[a]===b)return r}return null};a.jL=function(a,b,f,c,r){for(var e=0;e<r.length;e++){var k=r[e];if(k[a]==b&&k[f]==c)return k}return null};a.jo=function(a,b,f){for(var c=0;c<a.length;c++)if(a[c][b]==f)return c;return-1};a.Ez=function(a,b){for(var f=0;f<a.length;f++)if(a[f]==b)return;a.push(b)};a.TI=function(a){for(var b=0;b<a.length-1;b++)for(var f=
a[b],c=b+1;c<a.length;c++)if(f==a[c])return!1;return!0};a.HL=function(a,b){for(var f=[],c=0;c<a.length;c++){var r=a[c];r.type==b&&f.push(r)}return f};a.FL=function(a,b){var f=e("name",b,a);1<f.length&&n.error("obj_by_name(): name resolution ambiguity");return f};a.GL=function(a,b){var f=e("name",b,a),c=f.length;1<c&&n.error("obj_by_name(): name resolution ambiguity");if(0>=c)return[];for(var r=[],k=0;k<c;k++){var d=f[k];if("EMPTY"==d.type&&d.dupli_group)for(var d=d.dupli_group.objects,H=0;H<d.length;H++)r.push(d[H])}return f=
f.concat(r)};a.VF=function(a,b,f,c){c||(c=new Float32Array(16));x.identity(c);c[12]=a;c[13]=b;c[14]=f};var da=1;a.nE=function(){da=(69069*da+5)%Math.pow(2,32);return Math.round(da/65536)%32768/32767};a.FF=function(a){da=a};a.Tc=function(a){var b=a[0]%fa*48271-3399*Math.floor(a[0]/fa);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.ll=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.Qe=function(a,b){var f=Math.cos(a[1]/2),c=Math.cos(a[2]/2),r=Math.cos(a[0]/2),e=Math.sin(a[1]/2),k=Math.sin(a[2]/
2),H=Math.sin(a[0]/2);b[0]=e*k*r+f*c*H;b[1]=e*c*r+f*k*H;b[2]=f*k*r-e*c*H;b[3]=f*c*r-e*k*H;return b};a.CB=function(a){var b=I.create(),f=Math.cos(a[0]),c=Math.cos(a[1]),r=Math.cos(a[2]),e=Math.sin(a[0]),k=Math.sin(a[1]);a=Math.sin(a[2]);var H=f*r,d=f*a,u=e*r,l=e*a;b[0]=c*r;b[1]=c*a;b[2]=-k;b[3]=k*u-d;b[4]=k*l+H;b[5]=c*e;b[6]=k*H+l;b[7]=k*d-u;b[8]=c*f;return b};a.Ov=function(a,b){var f=a[0],c=a[1],r=a[2],e=a[3],k=r*r,H=f*c+r*e;.499999<H?(b[0]=0,b[1]=2*Math.atan2(f,e),b[2]=Math.PI/2):-.499999>H?(b[0]=
0,b[1]=-2*Math.atan2(f,e),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*f*e-2*c*r,1-2*f*f-2*k),b[1]=Math.atan2(2*c*e-2*f*r,1-2*c*c-2*k),b[2]=Math.asin(2*f*c+2*r*e));return b};a.ka=function(a,b,f){f||(f=new Float32Array(3));l.transformQuat(b,a,f);return f};a.rJ=function(a,b,f){f||(f=new Float32Array(4));a=l.normalize(a,K);var c=l.dot(b,a);a=l.cross(b,a,k);c=Math.acos(c);f[0]=a[0]*Math.sin(c/2);f[1]=a[1]*Math.sin(c/2);f[2]=a[2]*Math.sin(c/2);f[3]=Math.cos(c/2);return f};a.WF=function(a,b,f,c){c||(c=new Float32Array(4));
l.transformQuat(f,b,c);c[3]=-l.dot(a,c)};a.rB=function(a){var b=a.d.quat;switch(a.type){case "CAMERA":K[0]=0;K[1]=-1;K[2]=0;l.transformQuat(K,b,K);k[0]=0;k[1]=0;k[2]=-1;break;case "MESH":K[0]=0;K[1]=0;K[2]=1;l.transformQuat(K,b,K);k[0]=0;k[1]=0;k[2]=1;break;case "EMPTY":K[0]=0,K[1]=1,K[2]=0,l.transformQuat(K,b,K),k[0]=0,k[1]=1,k[2]=0}K[1]=0;l.normalize(K,K);a=l.dot(K,k);return Math.acos(a)*(0<-K[0]*k[2]?-1:1)};a.Nr=function(a,b,f,c){if(0!=f){c=c||[];for(var r=0;r<a.length;r++)c[r]=(1-f)*a[r]+f*b[r]}};
a.XM=function(){B++;return B.toString(16)};a.mm=function(a){E[a]||(E[a]=0);var b=a+E[a];E[a]++;return b};a.$c=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.mb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,J:0,ca:null,u:[],G:b}};a.Nf=function(a){return JSON.parse(JSON.stringify(a))};a.bJ=function(a,f){var c=[],r;for(r in f){var e=f[r];if(e)for(var k=0;k<e.length;k++)c.push(e[k])}return b(a,
c)};a.za=function(b){var f=b instanceof Array?[]:{},c;for(c in b)f[c]=b[c]&&"object"==typeof b[c]?b[c]instanceof Float32Array?new Float32Array(b[c]):b[c]instanceof Uint32Array?new Uint32Array(b[c]):b[c]instanceof Uint16Array?new Uint16Array(b[c]):a.za(b[c]):b[c];return f};a.zk=function(a){var b=a instanceof Array?[]:{},f;for(f in a)b[f]=a[f]&&"object"==typeof a[f]?a[f]instanceof Float32Array?new Float32Array(a[f]):a[f]instanceof Uint32Array?new Uint32Array(a[f]):a[f]instanceof Uint16Array?new Uint16Array(a[f]):
a[f]instanceof Array?a[f].slice(0):a[f]:a[f];return b};a.ec=function(a){return"MESH"===a.type?!0:!1};a.nD=function(a){return"EMPTY"===a.type?!0:!1};a.gg=function(a){return"ARMATURE"===a.type?!0:!1};a.re=function(a,b){b||(b=new Float32Array(4));I.fromMat4(a,L);var f=L[0],c=L[3],r=L[6],e=L[1],k=L[4],H=L[7],d=L[2],u=L[5],l=L[8],f=Math.sqrt(f*f+c*c+r*r)||1,e=Math.sqrt(e*e+k*k+H*H)||1,d=Math.sqrt(d*d+u*u+l*l)||1;L[0]/=f;L[3]/=f;L[6]/=f;L[1]/=e;L[4]/=e;L[7]/=e;L[2]/=d;L[5]/=d;L[8]/=d;M.fromMat3(L,b);return b};
a.rg=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.ul=function(a){u[0]=.577350269189626;u[1]=.577350269189626;u[2]=.577350269189626;u[3]=0;c.transformMat4(u,a,u);return c.length(u)};a.$s=function(a,b){var f=b.left,c=b.right,r=b.top,e=b.bottom,k=b.Ra,H=b.cb;f[0]=a[3]+a[0];f[1]=a[7]+a[4];f[2]=a[11]+a[8];f[3]=a[15]+a[12];c[0]=a[3]-a[0];c[1]=a[7]-a[4];c[2]=a[11]-a[8];c[3]=a[15]-a[12];r[0]=a[3]-a[1];r[1]=a[7]-a[5];r[2]=a[11]-a[9];r[3]=a[15]-a[13];e[0]=a[3]+a[1];
e[1]=a[7]+a[5];e[2]=a[11]+a[9];e[3]=a[15]+a[13];k[0]=a[3]+a[2];k[1]=a[7]+a[6];k[2]=a[11]+a[10];k[3]=a[15]+a[14];H[0]=a[3]-a[2];H[1]=a[7]-a[6];H[2]=a[11]-a[10];H[3]=a[15]-a[14];q(f);q(c);q(r);q(e);q(k);q(H)};a.AF=function(a,b,f){return f<-d(a,b.left)||f<-d(a,b.right)||f<-d(a,b.top)||f<-d(a,b.bottom)||f<-d(a,b.Ra)||f<-d(a,b.cb)?!0:!1};a.zB=function(a,b,f,c,r){e=l.dot(f,b.cb);k=l.dot(c,b.cb);H=l.dot(r,b.cb);e=Math.sqrt(e*e+k*k+H*H);if(e<-d(a,b.Ra)||e<-d(a,b.cb))return!0;var e=l.dot(f,b.left),k=l.dot(c,
b.left),H=l.dot(r,b.left);if(Math.sqrt(e*e+k*k+H*H)<-d(a,b.left))return!0;e=l.dot(f,b.right);k=l.dot(c,b.right);H=l.dot(r,b.right);if(Math.sqrt(e*e+k*k+H*H)<-d(a,b.right))return!0;e=l.dot(f,b.top);k=l.dot(c,b.top);H=l.dot(r,b.top);if(Math.sqrt(e*e+k*k+H*H)<-d(a,b.top))return!0;e=l.dot(f,b.bottom);k=l.dot(c,b.bottom);H=l.dot(r,b.bottom);return Math.sqrt(e*e+k*k+H*H)<-d(a,b.bottom)?!0:!1};a.bf=function(a,b,f,c){c||(c=0);for(var r=a.length,e=0;e<r;e+=3){var k=a[e],H=a[e+1],d=a[e+2];f[c+e]=b[0]*k+b[4]*
H+b[8]*d+b[12];f[c+e+1]=b[1]*k+b[5]*H+b[9]*d+b[13];f[c+e+2]=b[2]*k+b[6]*H+b[10]*d+b[14]}};a.AG=function(a,b,f){for(var c=0,c=0,r=a.length,e=0;e<r;e+=3){var k=a[e],H=a[e+1],d=a[e+2];f[c+e]=b[0]*k+b[4]*H+b[8]*d;f[c+e+1]=b[1]*k+b[5]*H+b[9]*d;f[c+e+2]=b[2]*k+b[6]*H+b[10]*d}};a.SF=function(a,b,f){for(var c=0,c=0,r=a.length,e=0;e<r;e+=4){var k=a[e],H=a[e+1],d=a[e+2];f[c+e]=b[0]*k+b[4]*H+b[8]*d;f[c+e+1]=b[1]*k+b[5]*H+b[9]*d;f[c+e+2]=b[2]*k+b[6]*H+b[10]*d;f[c+e+3]=a[e+3]}};a.yG=function(a,b,f){f||(f=new Float32Array(3));
u[0]=a[0];u[1]=a[1];u[2]=a[2];u[3]=0;c.transformMat4(u,b,u);f[0]=u[0];f[1]=u[1];f[2]=u[2]};a.LJ=function(a,b){var f=a.length;if(!f)throw"flatten(): Wrong or empty array";var c=a[0].length;if(!c)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(f*c));for(var r=0;r<f;r++)for(var e=0;e<c;e++)b[r*c+e]=a[r][e];return b};a.zG=function(a){for(var b=[],f=0;f<a.length;f+=3){var c=new Float32Array([a[f],a[f+1],a[f+2]]);b[f/3]=c}return b};a.qk=function(b,f,c,r){if(r<c)return c;var e=c+Math.floor((r-
c)/2);return b[e]>f?a.qk(b,f,c,e-1):b[e]<f?a.qk(b,f,e+1,r):e};a.Me=function(a,b){for(var f=0;f<a.length;f++)if(a[f]!=b[f])return!1;return!0};a.Ak=function(a,b){for(var f=0;f<a.length;f++)if(1E-7<Math.abs(a[f]-b[f]))return!1;return!0};a.JE=function(a,b,f){f||(f=new Float32Array(16));for(var c=0;12>c;c++)f[c]=a[c]*b;f[12]=a[12];f[13]=a[13];f[14]=a[14];f[15]=a[15]};a.fq=function(a,b,f,c){c||(c=new Float32Array(16));b=x.fromRotationTranslation(b,f,F);x.multiply(b,a,c)};a.Nj=function(a,b,c,r,e){e||(e=
new Float32Array(3));c=x.fromRotationTranslation(c,r,F);1!==b&&(r=x.identity(f),b=l.set(b,b,b,K),x.scale(r,b,r),x.multiply(c,r,c));l.transformMat4(a,c,e);return e};a.gq=function(a,b,f,r){r||(r=new Float32Array(4));b=x.fromRotationTranslation(b,f,F);c.transformMat4(a,b,r)};a.ZK=function(a,b,f,c,r){r||(r=new Float32Array(3));b=x.fromRotationTranslation(f,c,F);x.invert(b,b);l.transformMat4(a,b,r);return r};a.SM=function(a,b,f){f||(f=new Float32Array(16));x.fromRotationTranslation(b,a,f);a=a[3];for(b=
0;12>b;b++)f[b]*=a;return f};a.uL=function(b,f,c){a.rg(b,f);f[3]=a.ul(b);a.re(b,c)};a.Cr=function(a){for(var b=[],f=0;f<a.length;f++)b.push(a[f]);return JSON.stringify(b)};a.FE=function(a,b,f,c){c||(c=new Float32Array(3));l.subtract(b,a,K);l.transformQuat(K,f,K);l.subtract(b,K,c)};a.aC=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),f=new Float32Array(16),c=new Float32Array(16),r=new Float32Array(16),e=new Float32Array(16),k=new Float32Array(16);x.lookAt(a,[-1,0,0],[0,-1,0],b);x.scale(b,
[-1,1,1],b);x.scale(b,[-1,1,-1],f);x.lookAt(a,[0,-1,0],[0,0,-1],c);x.scale(c,[1,1,-1],c);x.scale(c,[1,-1,-1],r);x.lookAt(a,[0,0,-1],[0,-1,0],e);x.scale(e,[-1,1,1],e);x.scale(e,[-1,1,-1],k);return[b,f,c,r,e,k]};a.eh=function(a,b){return h(a,b)};a.uu=h;a.SK=g;a.tL=function(a,b,f){var c=b[0],r=b[1];b=b[2];var e,k,H,d,u,l,n,L,F,h,m,q;if(!f||a===f)return a[12]=a[0]*c+a[4]*r+a[8]*b+a[12],a[13]=a[1]*c+a[5]*r+a[9]*b+a[13],a[14]=a[2]*c+a[6]*r+a[10]*b+a[14],a[15]=a[3]*c+a[7]*r+a[11]*b+a[15],a;e=a[0];k=a[1];
H=a[2];d=a[3];u=a[4];l=a[5];n=a[6];L=a[7];F=a[8];h=a[9];m=a[10];q=a[11];f[0]=e;f[1]=k;f[2]=H;f[3]=d;f[4]=u;f[5]=l;f[6]=n;f[7]=L;f[8]=F;f[9]=h;f[10]=m;f[11]=q;f[12]=e*c+u*r+F*b+a[12];f[13]=k*c+l*r+h*b+a[13];f[14]=H*c+n*r+m*b+a[14];f[15]=d*c+L*r+q*b+a[15];return f};a.GD=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.Nv=function(a,b){b||(b=a);var f=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];
0<f?(b[3]=2*Math.acos(a[3]),f=1/Math.sqrt(f),b[0]=a[0]*f,b[1]=a[1]*f,b[2]=a[2]*f):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.mE=function(a){return a*Math.PI/180};a.nJ=function(a){return 180*a/Math.PI};a.Sp=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],f=Math.floor(a[0]+b),c=Math.floor(a[1]+b),r=.211324865405187*f+.211324865405187*c,b=a[0]-f+r;a=a[1]-c+r;var e=b>a?1:0,k=1-e,r=b+.211324865405187-e,H=a+.211324865405187-
k,d=b+-.577350269189626,u=a+-.577350269189626,f=f%289,c=c%289,l=v(v(c)+f),k=v(v(c+k)+f+e),n=v(v(c+1)+f+1),f=Math.max(.5-(b*b+a*a),0),c=Math.max(.5-(r*r+H*H),0),e=Math.max(.5-(d*d+u*u),0),L=2*m(.024390243902439*l)-1,F=2*m(.024390243902439*k)-1,h=2*m(.024390243902439*n)-1,l=Math.abs(L)-.5,k=Math.abs(F)-.5,n=Math.abs(h)-.5,L=L-Math.floor(L+.5),F=F-Math.floor(F+.5),h=h-Math.floor(h+.5),f=f*f*f*f*(1.79284291400159-.85373472095314*(L*L+l*l)),c=c*c*c*c*(1.79284291400159-.85373472095314*(F*F+k*k)),e=e*e*
e*e*(1.79284291400159-.85373472095314*(h*h+n*n));return 130*(f*(L*b+l*a)+c*(F*r+k*H)+e*(h*d+n*u))};a.Xr=function(a){var b=1/7,f=b/2,c=z(Math.floor(a[0])),r=z(Math.floor(a[1])),e=m(a[0]);a=m(a[1]);var k=e-.5,H=e-1.5,e=a-.5;a-=1.5;var d=t(c),u=t(c+1),l=d,c=u,d=t(d+r),u=t(u+r),l=t(l+r+1),c=t(c+r+1),r=k+.7*(C(d)*b+f),n=H+.7*(C(u)*b+f),k=k+.7*(C(l)*b+f),H=H+.7*(C(c)*b+f),d=e+.7*(C(Math.floor(d*b))*b+f),e=e+.7*(C(Math.floor(u*b))*b+f),l=a+.7*(C(Math.floor(l*b))*b+f),b=a+.7*(C(Math.floor(c*b))*b+f);return Math.min(r*
r+d*d,n*n+e*e,k*k+l*l,H*H+b*b)};a.qp=function(a,b,f,c,r){r||(r=new Float32Array(4));a=l.transformQuat(b,a,K);b=f[0];var e=f[1];f=f[2];L[0]=e*e+f*f;L[1]=-e*b;L[2]=-f*b;L[3]=-b*e;L[4]=b*b+f*f;L[5]=-f*e;L[6]=-b*f;L[7]=-e*f;L[8]=b*b+e*e;l.transformMat3(a,L,a);l.normalize(a,a);M.rotationTo(c,a,r);return r};a.hn=function(a,b){b||(b=new Float32Array(4));var f=u,c=r,f=M.setAxisAngle([0,1,0],Math.PI,M.create()),c=M.setAxisAngle([1,0,0],Math.PI/2,M.create());M.multiply(f,c,f);M.multiply(a,f,b);return b};a.Y=
function(){B=0;E={}};a.ra=function(a,b,f){return Math.min(Math.max(a,b),f)};a.Ib=function(a,b,f,c){f=Math.exp(-f/c);return(1-f)*a+f*b};a.Yh=function(a,b,f,c,r){r||(r=new Float32Array(a.length));f=Math.exp(-f/c);for(c=0;c<r.length;c++)r[c]=(1-f)*a[c]+f*b[c];return r};a.Lw=function(a,b,f,c,r){r||(r=new Float32Array(a.length));M.slerp(a,b,Math.exp(-f/c),r)};a.$K=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.jg=function(a,b){if(a instanceof Array||a.buffer&&
a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.un=function(a,b){var f=I.fromQuat(a,L);k[0]=0;k[1]=1;k[2]=0;K[0]=f[3];K[1]=f[4];K[2]=f[5];var c=l.cross(k,K,K);l.normalize(c,c);var e=f[7];!b&&0<e&&(c[0]*=-1,c[1]*=-1,c[2]*=-1);k[0]=f[0];k[1]=f[1];k[2]=f[2];l.normalize(k,k);M.rotationTo(k,c,r);M.multiply(r,a,a)};a.vt=function(a,b,f,c){f=f*b-.5;var r=c*b-.5;c=f-Math.floor(f);var e=r-Math.floor(r);f=Math.floor(f);var r=Math.floor(r),k=b-1,H=a[r*b+f],d=a[r*b+Math.min(f+1,k)],
u=a[Math.min(r+1,k)*b+f];a=a[Math.min(r+1,k)*b+Math.min(f+1,k)];return(H*(1-c)+d*c)*(1-e)+(u*(1-c)+a*c)*e};a.Fg=function(a){for(var b=0,f=0;3>f;f++)0<(a&1<<f)&&b++;return b};a.$v=function(a){for(var b=[0,0,0],f=0;3>f;f++)0<(a&1<<f)&&(b[2-f]=1);return b};a.Fj=function(a,b){var f=0;(1==b||2==b)&&0<(a&4)&&f++;2==b&&0<(a&2)&&f++;return f};a.nt=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.je=function(a){var b=
0,f;for(f in a)a.hasOwnProperty(f)&&b++;return b};a.Qv=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.Gx=function(a,b,f){f||(f=new Float32Array(3));f[0]=a[0]-b[0];f[1]=0;f[2]=a[2]-b[2];l.normalize(f,f)};a.TM=function(a,b,f){var c=a[0],r=a[1];a=a[2];var e=b[0],k=b[1],H=b[2];b=b[3];var d=k*a-H*r,u=H*c-e*a,l=e*r-k*c,n=k*l-H*u,H=H*d-e*l,e=e*u-k*d;f[0]=c+2*d*b+2*n;f[1]=r+2*u*b+2*H;f[2]=a+2*l*b+2*e;return f};a.sa=function(a){a&&n.error.apply(n,arguments);throw"panic: see above for possible error messages";
};a.Ff=J;a.oc=function(a){return J(a,0,2*Math.PI)};a.ho=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.Xw=function(a,b){for(var f in a){var c=!0,r=a[f],e=b[f];switch(typeof r){case "number":case "string":case "boolean":c=r==e;break;case "object":c=D(r,e)}if(!c)return!1}return!0};a.lE=function(a,b){var f=a[0],c=a[2],r=a[3];b[0]=a[1];b[1]=c;b[2]=r;b[3]=f};a.lt=function(a){a+=1;132651<a&&n.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var f=Math.floor(a/51);return new Float32Array([b/
51,f/51,a%51/51])};a.Mo=function(a,b,f,e,k){u.set(a);u[3]=b;r.set(e);r[3]=0;a=c.dot(u,r);if(0==a)return null;r.set(f);r[3]=1;a=-c.dot(u,r)/a;k[0]=f[0]+a*e[0];k[1]=f[1]+a*e[1];k[2]=f[2]+a*e[2];return k};a.eJ=function(a,b){for(var f=0;f<a.length;f++)b[f]=a[f];return b};a.cw=function(a,b,f){var c=l.dot(a,b);-.9999999>c?(l.cross(U,a,K),1E-6>l.length(K)&&l.cross(X,a,K),l.normalize(K,K),M.setAxisAngle(K,Math.PI,f)):(l.cross(a,b,K),f.set(K),f[3]=1+c,M.normalize(f,f));return f}};b4w.module.vec3=function(a){var w="undefined"!==typeof Float32Array?Float32Array:Array,e=Math.random;a.create=function(){var a=new w(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var e=new w(3);e[0]=a[0];e[1]=a[1];e[2]=a[2];return e};a.fromValues=function(a,e,d){var h=new w(3);h[0]=a;h[1]=e;h[2]=d;return h};a.copy=function(a,e){e[0]=a[0];e[1]=a[1];e[2]=a[2];return e};a.set=function(a,e,d,h){h[0]=a;h[1]=e;h[2]=d;return h};a.add=function(a,e,d){d[0]=a[0]+e[0];d[1]=a[1]+e[1];d[2]=a[2]+e[2];return d};
a.subtract=function(a,e,d){d[0]=a[0]-e[0];d[1]=a[1]-e[1];d[2]=a[2]-e[2];return d};a.sub=a.subtract;a.multiply=function(a,e,d){d[0]=a[0]*e[0];d[1]=a[1]*e[1];d[2]=a[2]*e[2];return d};a.mul=a.multiply;a.divide=function(a,e,d){d[0]=a[0]/e[0];d[1]=a[1]/e[1];d[2]=a[2]/e[2];return d};a.div=a.divide;a.min=function(a,e,d){d[0]=Math.min(a[0],e[0]);d[1]=Math.min(a[1],e[1]);d[2]=Math.min(a[2],e[2]);return d};a.max=function(a,e,d){d[0]=Math.max(a[0],e[0]);d[1]=Math.max(a[1],e[1]);d[2]=Math.max(a[2],e[2]);return d};
a.scale=function(a,e,d){d[0]=a[0]*e;d[1]=a[1]*e;d[2]=a[2]*e;return d};a.scaleAndAdd=function(a,e,d,h){h[0]=a[0]+e[0]*d;h[1]=a[1]+e[1]*d;h[2]=a[2]+e[2]*d;return h};a.distance=function(a,e){var d=e[0]-a[0],h=e[1]-a[1],p=e[2]-a[2];return Math.sqrt(d*d+h*h+p*p)};a.dist=a.distance;a.squaredDistance=function(a,e){var d=e[0]-a[0],h=e[1]-a[1],p=e[2]-a[2];return d*d+h*h+p*p};a.sqrDist=a.squaredDistance;a.length=function(a){var e=a[0],d=a[1];a=a[2];return Math.sqrt(e*e+d*d+a*a)};a.len=a.length;a.squaredLength=
function(a){var e=a[0],d=a[1];a=a[2];return e*e+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,e){e[0]=-a[0];e[1]=-a[1];e[2]=-a[2];return e};a.inverse=function(a,e){e[0]=1/a[0];e[1]=1/a[1];e[2]=1/a[2];return e};a.normalize=function(a,e){var d=a[0],h=a[1],p=a[2],d=d*d+h*h+p*p;0<d&&(d=1/Math.sqrt(d),e[0]=a[0]*d,e[1]=a[1]*d,e[2]=a[2]*d);return e};a.dot=function(a,e){return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]};a.cross=function(a,e,d){var h=a[0],p=a[1];a=a[2];var g=e[0],v=e[1];e=e[2];d[0]=p*e-a*v;d[1]=
a*g-h*e;d[2]=h*v-p*g;return d};a.lerp=function(a,e,d,h){var p=a[0],g=a[1];a=a[2];h[0]=p+d*(e[0]-p);h[1]=g+d*(e[1]-g);h[2]=a+d*(e[2]-a);return h};a.random=function(a,q){a=a||1;var d=2*e()*Math.PI,h=2*e()-1,p=Math.sqrt(1-h*h)*a;q[0]=Math.cos(d)*p;q[1]=Math.sin(d)*p;q[2]=h*a;return q};a.transformMat4=function(a,e,d){var h=a[0],p=a[1];a=a[2];var g=e[3]*h+e[7]*p+e[11]*a+e[15],g=g||1;d[0]=(e[0]*h+e[4]*p+e[8]*a+e[12])/g;d[1]=(e[1]*h+e[5]*p+e[9]*a+e[13])/g;d[2]=(e[2]*h+e[6]*p+e[10]*a+e[14])/g;return d};a.transformMat3=
function(a,e,d){var h=a[0],p=a[1];a=a[2];d[0]=h*e[0]+p*e[3]+a*e[6];d[1]=h*e[1]+p*e[4]+a*e[7];d[2]=h*e[2]+p*e[5]+a*e[8];return d};a.transformQuat=function(a,e,d){var h=a[0],p=a[1],g=a[2];a=e[0];var v=e[1],m=e[2];e=e[3];var t=e*h+v*g-m*p,z=e*p+m*h-a*g,C=e*g+a*p-v*h,h=-a*h-v*p-m*g;d[0]=t*e+h*-a+z*-m-C*-v;d[1]=z*e+h*-v+C*-a-t*-m;d[2]=C*e+h*-m+t*-v-z*-a;return d};a.rotateX=function(a,e,d,h){var p=[],g=[];p[0]=a[0]-e[0];p[1]=a[1]-e[1];p[2]=a[2]-e[2];g[0]=p[0];g[1]=p[1]*Math.cos(d)-p[2]*Math.sin(d);g[2]=
p[1]*Math.sin(d)+p[2]*Math.cos(d);h[0]=g[0]+e[0];h[1]=g[1]+e[1];h[2]=g[2]+e[2];return h};a.rotateY=function(a,e,d,h){var p=[],g=[];p[0]=a[0]-e[0];p[1]=a[1]-e[1];p[2]=a[2]-e[2];g[0]=p[2]*Math.sin(d)+p[0]*Math.cos(d);g[1]=p[1];g[2]=p[2]*Math.cos(d)-p[0]*Math.sin(d);h[0]=g[0]+e[0];h[1]=g[1]+e[1];h[2]=g[2]+e[2];return h};a.rotateZ=function(a,e,d,h){var p=[],g=[];p[0]=a[0]-e[0];p[1]=a[1]-e[1];p[2]=a[2]-e[2];g[0]=p[0]*Math.cos(d)-p[1]*Math.sin(d);g[1]=p[0]*Math.sin(d)+p[1]*Math.cos(d);g[2]=p[2];h[0]=g[0]+
e[0];h[1]=g[1]+e[1];h[2]=g[2]+e[2];return h};a.forEach=function(){var b=a.create();return function(a,e,h,p,g,v){e||(e=3);h||(h=0);for(p=p?Math.min(p*e+h,a.length):a.length;h<p;h+=e)b[0]=a[h],b[1]=a[h+1],b[2]=a[h+2],g(b,v,b),a[h]=b[0],a[h+1]=b[1],a[h+2]=b[2];return a}}();a.eI=function(b,e){var d=a.fromValues(b[0],b[1],b[2]),h=a.fromValues(e[0],e[1],e[2]);a.normalize(d,d);a.normalize(h,h);d=a.dot(d,h);return 1<d?0:Math.acos(d)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==
typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a){var w="undefined"!==typeof Float32Array?Float32Array:Array,e=Math.random;a.create=function(){var a=new w(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var e=new w(4);e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=a[3];return e};a.fromValues=function(a,e,d,h){var p=new w(4);p[0]=a;p[1]=e;p[2]=d;p[3]=h;return p};a.copy=function(a,e){e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=a[3];return e};a.set=function(a,e,d,h,p){p[0]=a;p[1]=e;p[2]=d;p[3]=h;return p};a.add=function(a,e,d){d[0]=
a[0]+e[0];d[1]=a[1]+e[1];d[2]=a[2]+e[2];d[3]=a[3]+e[3];return d};a.subtract=function(a,e,d){d[0]=a[0]-e[0];d[1]=a[1]-e[1];d[2]=a[2]-e[2];d[3]=a[3]-e[3];return d};a.sub=a.subtract;a.multiply=function(a,e,d){d[0]=a[0]*e[0];d[1]=a[1]*e[1];d[2]=a[2]*e[2];d[3]=a[3]*e[3];return d};a.mul=a.multiply;a.divide=function(a,e,d){d[0]=a[0]/e[0];d[1]=a[1]/e[1];d[2]=a[2]/e[2];d[3]=a[3]/e[3];return d};a.div=a.divide;a.min=function(a,e,d){d[0]=Math.min(a[0],e[0]);d[1]=Math.min(a[1],e[1]);d[2]=Math.min(a[2],e[2]);d[3]=
Math.min(a[3],e[3]);return d};a.max=function(a,e,d){d[0]=Math.max(a[0],e[0]);d[1]=Math.max(a[1],e[1]);d[2]=Math.max(a[2],e[2]);d[3]=Math.max(a[3],e[3]);return d};a.scale=function(a,e,d){d[0]=a[0]*e;d[1]=a[1]*e;d[2]=a[2]*e;d[3]=a[3]*e;return d};a.scaleAndAdd=function(a,e,d,h){h[0]=a[0]+e[0]*d;h[1]=a[1]+e[1]*d;h[2]=a[2]+e[2]*d;h[3]=a[3]+e[3]*d;return h};a.distance=function(a,e){var d=e[0]-a[0],h=e[1]-a[1],p=e[2]-a[2],g=e[3]-a[3];return Math.sqrt(d*d+h*h+p*p+g*g)};a.dist=a.distance;a.squaredDistance=
function(a,e){var d=e[0]-a[0],h=e[1]-a[1],p=e[2]-a[2],g=e[3]-a[3];return d*d+h*h+p*p+g*g};a.sqrDist=a.squaredDistance;a.length=function(a){var e=a[0],d=a[1],h=a[2];a=a[3];return Math.sqrt(e*e+d*d+h*h+a*a)};a.len=a.length;a.squaredLength=function(a){var e=a[0],d=a[1],h=a[2];a=a[3];return e*e+d*d+h*h+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,e){e[0]=-a[0];e[1]=-a[1];e[2]=-a[2];e[3]=-a[3];return e};a.inverse=function(a,e){e[0]=1/a[0];e[1]=1/a[1];e[2]=1/a[2];e[3]=1/a[3];return e};a.normalize=
function(a,e){var d=a[0],h=a[1],p=a[2],g=a[3],d=d*d+h*h+p*p+g*g;0<d&&(d=1/Math.sqrt(d),e[0]=a[0]*d,e[1]=a[1]*d,e[2]=a[2]*d,e[3]=a[3]*d);return e};a.dot=function(a,e){return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]+a[3]*e[3]};a.lerp=function(a,e,d,h){var p=a[0],g=a[1],v=a[2];a=a[3];h[0]=p+d*(e[0]-p);h[1]=g+d*(e[1]-g);h[2]=v+d*(e[2]-v);h[3]=a+d*(e[3]-a);return h};a.random=function(b,q){b=b||1;q[0]=e();q[1]=e();q[2]=e();q[3]=e();a.normalize(q,q);a.scale(q,b,q);return q};a.transformMat4=function(a,e,d){var h=a[0],
p=a[1],g=a[2];a=a[3];d[0]=e[0]*h+e[4]*p+e[8]*g+e[12]*a;d[1]=e[1]*h+e[5]*p+e[9]*g+e[13]*a;d[2]=e[2]*h+e[6]*p+e[10]*g+e[14]*a;d[3]=e[3]*h+e[7]*p+e[11]*g+e[15]*a;return d};a.transformQuat=function(a,e,d){var h=a[0],p=a[1],g=a[2],v=e[0],m=e[1],t=e[2];e=e[3];var z=e*h+m*g-t*p,C=e*p+t*h-v*g,J=e*g+v*p-m*h,h=-v*h-m*p-t*g;d[0]=z*e+h*-v+C*-t-J*-m;d[1]=C*e+h*-m+J*-v-z*-t;d[2]=J*e+h*-t+z*-m-C*-v;d[3]=a[3];return d};a.forEach=function(){var b=a.create();return function(a,e,h,p,g,v){e||(e=4);h||(h=0);for(p=p?Math.min(p*
e+h,a.length):a.length;h<p;h+=e)b[0]=a[h],b[1]=a[h+1],b[2]=a[h+2],b[3]=a[h+3],g(b,v,b),a[h]=b[0],a[h+1]=b[1],a[h+2]=b[2],a[h+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,w){var e=w("vec3"),b=w("vec4"),q=w("mat3"),d="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new d(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=e.create(),d=e.fromValues(1,0,0),g=e.fromValues(0,1,0);return function(v,m,t){var z=e.dot(v,m);if(-.9999999>z)return e.cross(d,v,b),1E-6>e.length(b)&&e.cross(g,v,b),e.normalize(b,b),a.setAxisAngle(b,Math.PI,t),t;if(.9999999<z)return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t;e.cross(v,
m,b);t[0]=b[0];t[1]=b[1];t[2]=b[2];t[3]=1+z;return a.normalize(t,t)}}();a.setAxes=function(){var b=q.create();return function(e,d,v,m){b[0]=d[0];b[3]=d[1];b[6]=d[2];b[1]=v[0];b[4]=v[1];b[7]=v[2];b[2]=-e[0];b[5]=-e[1];b[8]=-e[2];return a.normalize(a.fromMat3(b,m),m)}}();a.clone=b.clone;a.fromValues=b.fromValues;a.copy=b.copy;a.set=b.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,e){b*=.5;var d=Math.sin(b);e[0]=d*a[0];e[1]=d*a[1];e[2]=d*a[2];e[3]=Math.cos(b);
return e};a.add=b.add;a.multiply=function(a,b,e){var d=a[0],m=a[1],t=a[2];a=a[3];var z=b[0],C=b[1],q=b[2];b=b[3];e[0]=d*b+a*z+m*q-t*C;e[1]=m*b+a*C+t*z-d*q;e[2]=t*b+a*q+d*C-m*z;e[3]=a*b-d*z-m*C-t*q;return e};a.mul=a.multiply;a.scale=b.scale;a.rotateX=function(a,b,e){b*=.5;var d=a[0],m=a[1],t=a[2];a=a[3];var z=Math.sin(b);b=Math.cos(b);e[0]=d*b+a*z;e[1]=m*b+t*z;e[2]=t*b-m*z;e[3]=a*b-d*z;return e};a.rotateY=function(a,b,e){b*=.5;var d=a[0],m=a[1],t=a[2];a=a[3];var z=Math.sin(b);b=Math.cos(b);e[0]=d*
b-t*z;e[1]=m*b+a*z;e[2]=t*b+d*z;e[3]=a*b-m*z;return e};a.rotateZ=function(a,b,e){b*=.5;var d=a[0],m=a[1],t=a[2];a=a[3];var z=Math.sin(b);b=Math.cos(b);e[0]=d*b+m*z;e[1]=m*b-d*z;e[2]=t*b+a*z;e[3]=a*b-t*z;return e};a.calculateW=function(a,b){var e=a[0],d=a[1],m=a[2];b[0]=e;b[1]=d;b[2]=m;b[3]=Math.sqrt(Math.abs(1-e*e-d*d-m*m));return b};a.dot=b.dot;a.lerp=b.lerp;a.slerp=function(a,b,e,d){var m=a[0],t=a[1],z=a[2];a=a[3];var C=b[0],q=b[1],D=b[2];b=b[3];var y,n,l;n=m*C+t*q+z*D+a*b;0>n&&(n=-n,C=-C,q=-q,
D=-D,b=-b);1E-6<1-n?(y=Math.acos(n),l=Math.sin(y),n=Math.sin((1-e)*y)/l,e=Math.sin(e*y)/l):n=1-e;d[0]=n*m+e*C;d[1]=n*t+e*q;d[2]=n*z+e*D;d[3]=n*a+e*b;return d};a.invert=function(a,b){var e=a[0],d=a[1],m=a[2],t=a[3],z=e*e+d*d+m*m+t*t,z=z?1/z:0;b[0]=-e*z;b[1]=-d*z;b[2]=-m*z;b[3]=t*z;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=b.length;a.len=a.length;a.squaredLength=b.squaredLength;a.sqrLen=a.squaredLength;a.normalize=b.normalize;a.fromMat3=function(a,
b){var e=a[0]+a[4]+a[8];if(0<e)e=Math.sqrt(e+1),b[3]=.5*e,e=.5/e,b[0]=(a[5]-a[7])*e,b[1]=(a[6]-a[2])*e,b[2]=(a[1]-a[3])*e;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var m=(d+1)%3,t=(d+2)%3,e=Math.sqrt(a[3*d+d]-a[3*m+m]-a[3*t+t]+1);b[d]=.5*e;e=.5/e;b[3]=(a[3*m+t]-a[3*t+m])*e;b[m]=(a[3*m+d]+a[3*d+m])*e;b[t]=(a[3*t+d]+a[3*d+t])*e}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a){var w="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new w(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new w(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=
a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var q=a[1],d=a[2],h=a[5];b[1]=a[3];b[2]=a[6];b[3]=q;b[5]=a[7];b[6]=d;b[7]=h}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var q=a[0],d=a[1],h=a[2],p=a[3],g=a[4],v=a[5],m=a[6],t=a[7],z=a[8],C=z*g-v*t,J=-z*p+v*m,D=
t*p-g*m,y=q*C+d*J+h*D;if(!y)return null;y=1/y;b[0]=C*y;b[1]=(-z*d+h*t)*y;b[2]=(v*d-h*g)*y;b[3]=J*y;b[4]=(z*q-h*m)*y;b[5]=(-v*q+h*p)*y;b[6]=D*y;b[7]=(-t*q+d*m)*y;b[8]=(g*q-d*p)*y;return b};a.adjoint=function(a,b){var q=a[0],d=a[1],h=a[2],p=a[3],g=a[4],v=a[5],m=a[6],t=a[7],z=a[8];b[0]=g*z-v*t;b[1]=h*t-d*z;b[2]=d*v-h*g;b[3]=v*m-p*z;b[4]=q*z-h*m;b[5]=h*p-q*v;b[6]=p*t-g*m;b[7]=d*m-q*t;b[8]=q*g-d*p;return b};a.determinant=function(a){var b=a[3],q=a[4],d=a[5],h=a[6],p=a[7],g=a[8];return a[0]*(g*q-d*p)+a[1]*
(-g*b+d*h)+a[2]*(p*b-q*h)};a.multiply=function(a,b,q){var d=a[0],h=a[1],p=a[2],g=a[3],v=a[4],m=a[5],t=a[6],z=a[7];a=a[8];var C=b[0],J=b[1],D=b[2],y=b[3],n=b[4],l=b[5],c=b[6],M=b[7];b=b[8];q[0]=C*d+J*g+D*t;q[1]=C*h+J*v+D*z;q[2]=C*p+J*m+D*a;q[3]=y*d+n*g+l*t;q[4]=y*h+n*v+l*z;q[5]=y*p+n*m+l*a;q[6]=c*d+M*g+b*t;q[7]=c*h+M*v+b*z;q[8]=c*p+M*m+b*a;return q};a.mul=a.multiply;a.translate=function(a,b,q){var d=a[0],h=a[1],p=a[2],g=a[3],v=a[4],m=a[5],t=a[6],z=a[7];a=a[8];var C=b[0];b=b[1];q[0]=d;q[1]=h;q[2]=p;
q[3]=g;q[4]=v;q[5]=m;q[6]=C*d+b*g+t;q[7]=C*h+b*v+z;q[8]=C*p+b*m+a;return q};a.rotate=function(a,b,q){var d=a[0],h=a[1],p=a[2],g=a[3],v=a[4],m=a[5],t=a[6],z=a[7];a=a[8];var C=Math.sin(b);b=Math.cos(b);q[0]=b*d+C*g;q[1]=b*h+C*v;q[2]=b*p+C*m;q[3]=b*g-C*d;q[4]=b*v-C*h;q[5]=b*m-C*p;q[6]=t;q[7]=z;q[8]=a;return q};a.scale=function(a,b,q){var d=b[0];b=b[1];q[0]=d*a[0];q[1]=d*a[1];q[2]=d*a[2];q[3]=b*a[3];q[4]=b*a[4];q[5]=b*a[5];q[6]=a[6];q[7]=a[7];q[8]=a[8];return q};a.VB=function(a,b){b[0]=1;b[1]=0;b[2]=
0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.TB=function(a,b){var q=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=q;b[2]=0;b[3]=-q;b[4]=d;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.UB=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var q=a[0],d=a[1],h=a[2],p=a[3],g=q+q,v=d+d,m=h+h,q=q*g,t=d*g,d=d*v,z=h*g,C=
h*v,h=h*m,g=p*g,v=p*v,p=p*m;b[0]=1-d-h;b[3]=t-p;b[6]=z+v;b[1]=t+p;b[4]=1-q-h;b[7]=C-g;b[2]=z-v;b[5]=C+g;b[8]=1-q-d;return b};a.normalFromMat4=function(a,b){var q=a[0],d=a[1],h=a[2],p=a[3],g=a[4],v=a[5],m=a[6],t=a[7],z=a[8],C=a[9],J=a[10],D=a[11],y=a[12],n=a[13],l=a[14],c=a[15],M=q*v-d*g,I=q*m-h*g,x=q*t-p*g,B=d*m-h*v,E=d*t-p*v,K=h*t-p*m,k=z*n-C*y,u=z*l-J*y,z=z*c-D*y,r=C*l-J*n,C=C*c-D*n,J=J*c-D*l,D=M*J-I*C+x*r+B*z-E*u+K*k;if(!D)return null;D=1/D;b[0]=(v*J-m*C+t*r)*D;b[1]=(m*z-g*J-t*u)*D;b[2]=(g*C-v*
z+t*k)*D;b[3]=(h*C-d*J-p*r)*D;b[4]=(q*J-h*z+p*u)*D;b[5]=(d*z-q*C-p*k)*D;b[6]=(n*K-l*E+c*B)*D;b[7]=(l*x-y*K-c*I)*D;b[8]=(y*E-n*x+c*M)*D;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.SB=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a){var w="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new w(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new w(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];b[1]=
a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var q=a[1],d=a[2],h=a[3],p=a[6],g=a[7],v=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=q;b[6]=a[9];b[7]=a[13];b[8]=d;b[9]=p;b[11]=a[14];b[12]=h;b[13]=g;
b[14]=v}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var q=a[0],d=a[1],h=a[2],p=a[3],g=a[4],v=a[5],m=a[6],t=a[7],z=a[8],C=a[9],J=a[10],D=a[11],y=a[12],n=a[13],l=a[14],c=a[15],M=q*v-d*g,I=q*m-h*g,x=q*t-p*g,B=d*m-h*v,E=d*t-p*v,K=h*t-p*m,k=z*n-C*y,u=z*l-J*y,r=z*c-D*y,L=C*l-J*n,F=C*c-D*n,f=J*c-D*l,N=M*f-I*F+x*L+B*r-E*u+K*k;if(!N)return null;
N=1/N;b[0]=(v*f-m*F+t*L)*N;b[1]=(h*F-d*f-p*L)*N;b[2]=(n*K-l*E+c*B)*N;b[3]=(J*E-C*K-D*B)*N;b[4]=(m*r-g*f-t*u)*N;b[5]=(q*f-h*r+p*u)*N;b[6]=(l*x-y*K-c*I)*N;b[7]=(z*K-J*x+D*I)*N;b[8]=(g*F-v*r+t*k)*N;b[9]=(d*r-q*F-p*k)*N;b[10]=(y*E-n*x+c*M)*N;b[11]=(C*x-z*E-D*M)*N;b[12]=(v*u-g*L-m*k)*N;b[13]=(q*L-d*u+h*k)*N;b[14]=(n*I-y*B-l*M)*N;b[15]=(z*B-C*I+J*M)*N;return b};a.adjoint=function(a,b){var q=a[0],d=a[1],h=a[2],p=a[3],g=a[4],v=a[5],m=a[6],t=a[7],z=a[8],C=a[9],J=a[10],D=a[11],y=a[12],n=a[13],l=a[14],c=a[15];
b[0]=v*(J*c-D*l)-C*(m*c-t*l)+n*(m*D-t*J);b[1]=-(d*(J*c-D*l)-C*(h*c-p*l)+n*(h*D-p*J));b[2]=d*(m*c-t*l)-v*(h*c-p*l)+n*(h*t-p*m);b[3]=-(d*(m*D-t*J)-v*(h*D-p*J)+C*(h*t-p*m));b[4]=-(g*(J*c-D*l)-z*(m*c-t*l)+y*(m*D-t*J));b[5]=q*(J*c-D*l)-z*(h*c-p*l)+y*(h*D-p*J);b[6]=-(q*(m*c-t*l)-g*(h*c-p*l)+y*(h*t-p*m));b[7]=q*(m*D-t*J)-g*(h*D-p*J)+z*(h*t-p*m);b[8]=g*(C*c-D*n)-z*(v*c-t*n)+y*(v*D-t*C);b[9]=-(q*(C*c-D*n)-z*(d*c-p*n)+y*(d*D-p*C));b[10]=q*(v*c-t*n)-g*(d*c-p*n)+y*(d*t-p*v);b[11]=-(q*(v*D-t*C)-g*(d*D-p*C)+z*
(d*t-p*v));b[12]=-(g*(C*l-J*n)-z*(v*l-m*n)+y*(v*J-m*C));b[13]=q*(C*l-J*n)-z*(d*l-h*n)+y*(d*J-h*C);b[14]=-(q*(v*l-m*n)-g*(d*l-h*n)+y*(d*m-h*v));b[15]=q*(v*J-m*C)-g*(d*J-h*C)+z*(d*m-h*v);return b};a.determinant=function(a){var b=a[0],q=a[1],d=a[2],h=a[3],p=a[4],g=a[5],v=a[6],m=a[7],t=a[8],z=a[9],C=a[10],J=a[11],D=a[12],y=a[13],n=a[14];a=a[15];return(b*g-q*p)*(C*a-J*n)-(b*v-d*p)*(z*a-J*y)+(b*m-h*p)*(z*n-C*y)+(q*v-d*g)*(t*a-J*D)-(q*m-h*g)*(t*n-C*D)+(d*m-h*v)*(t*y-z*D)};a.multiply=function(a,b,q){var d=
a[0],h=a[1],p=a[2],g=a[3],v=a[4],m=a[5],t=a[6],z=a[7],C=a[8],J=a[9],D=a[10],y=a[11],n=a[12],l=a[13],c=a[14];a=a[15];var M=b[0],I=b[1],x=b[2],B=b[3];q[0]=M*d+I*v+x*C+B*n;q[1]=M*h+I*m+x*J+B*l;q[2]=M*p+I*t+x*D+B*c;q[3]=M*g+I*z+x*y+B*a;M=b[4];I=b[5];x=b[6];B=b[7];q[4]=M*d+I*v+x*C+B*n;q[5]=M*h+I*m+x*J+B*l;q[6]=M*p+I*t+x*D+B*c;q[7]=M*g+I*z+x*y+B*a;M=b[8];I=b[9];x=b[10];B=b[11];q[8]=M*d+I*v+x*C+B*n;q[9]=M*h+I*m+x*J+B*l;q[10]=M*p+I*t+x*D+B*c;q[11]=M*g+I*z+x*y+B*a;M=b[12];I=b[13];x=b[14];B=b[15];q[12]=M*d+
I*v+x*C+B*n;q[13]=M*h+I*m+x*J+B*l;q[14]=M*p+I*t+x*D+B*c;q[15]=M*g+I*z+x*y+B*a;return q};a.mul=a.multiply;a.translate=function(a,b,q){var d=b[0],h=b[1];b=b[2];var p,g,v,m,t,z,C,J,D,y,n,l;a===q?(q[12]=a[0]*d+a[4]*h+a[8]*b+a[12],q[13]=a[1]*d+a[5]*h+a[9]*b+a[13],q[14]=a[2]*d+a[6]*h+a[10]*b+a[14],q[15]=a[3]*d+a[7]*h+a[11]*b+a[15]):(p=a[0],g=a[1],v=a[2],m=a[3],t=a[4],z=a[5],C=a[6],J=a[7],D=a[8],y=a[9],n=a[10],l=a[11],q[0]=p,q[1]=g,q[2]=v,q[3]=m,q[4]=t,q[5]=z,q[6]=C,q[7]=J,q[8]=D,q[9]=y,q[10]=n,q[11]=l,
q[12]=p*d+t*h+D*b+a[12],q[13]=g*d+z*h+y*b+a[13],q[14]=v*d+C*h+n*b+a[14],q[15]=m*d+J*h+l*b+a[15]);return q};a.scale=function(a,b,q){var d=b[0],h=b[1];b=b[2];q[0]=a[0]*d;q[1]=a[1]*d;q[2]=a[2]*d;q[3]=a[3]*d;q[4]=a[4]*h;q[5]=a[5]*h;q[6]=a[6]*h;q[7]=a[7]*h;q[8]=a[8]*b;q[9]=a[9]*b;q[10]=a[10]*b;q[11]=a[11]*b;q[12]=a[12];q[13]=a[13];q[14]=a[14];q[15]=a[15];return q};a.rotate=function(a,b,q,d){var h=q[0],p=q[1];q=q[2];var g=Math.sqrt(h*h+p*p+q*q),v,m,t,z,C,J,D,y,n,l,c,M,I,x,B,E,K,k,u,r;if(1E-7>Math.abs(g))return null;
g=1/g;h*=g;p*=g;q*=g;v=Math.sin(b);m=Math.cos(b);t=1-m;b=a[0];g=a[1];z=a[2];C=a[3];J=a[4];D=a[5];y=a[6];n=a[7];l=a[8];c=a[9];M=a[10];I=a[11];x=h*h*t+m;B=p*h*t+q*v;E=q*h*t-p*v;K=h*p*t-q*v;k=p*p*t+m;u=q*p*t+h*v;r=h*q*t+p*v;h=p*q*t-h*v;p=q*q*t+m;d[0]=b*x+J*B+l*E;d[1]=g*x+D*B+c*E;d[2]=z*x+y*B+M*E;d[3]=C*x+n*B+I*E;d[4]=b*K+J*k+l*u;d[5]=g*K+D*k+c*u;d[6]=z*K+y*k+M*u;d[7]=C*K+n*k+I*u;d[8]=b*r+J*h+l*p;d[9]=g*r+D*h+c*p;d[10]=z*r+y*h+M*p;d[11]=C*r+n*h+I*p;a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);
return d};a.rotateX=function(a,b,q){var d=Math.sin(b);b=Math.cos(b);var h=a[4],p=a[5],g=a[6],v=a[7],m=a[8],t=a[9],z=a[10],C=a[11];a!==q&&(q[0]=a[0],q[1]=a[1],q[2]=a[2],q[3]=a[3],q[12]=a[12],q[13]=a[13],q[14]=a[14],q[15]=a[15]);q[4]=h*b+m*d;q[5]=p*b+t*d;q[6]=g*b+z*d;q[7]=v*b+C*d;q[8]=m*b-h*d;q[9]=t*b-p*d;q[10]=z*b-g*d;q[11]=C*b-v*d;return q};a.rotateY=function(a,b,q){var d=Math.sin(b);b=Math.cos(b);var h=a[0],p=a[1],g=a[2],v=a[3],m=a[8],t=a[9],z=a[10],C=a[11];a!==q&&(q[4]=a[4],q[5]=a[5],q[6]=a[6],
q[7]=a[7],q[12]=a[12],q[13]=a[13],q[14]=a[14],q[15]=a[15]);q[0]=h*b-m*d;q[1]=p*b-t*d;q[2]=g*b-z*d;q[3]=v*b-C*d;q[8]=h*d+m*b;q[9]=p*d+t*b;q[10]=g*d+z*b;q[11]=v*d+C*b;return q};a.rotateZ=function(a,b,q){var d=Math.sin(b);b=Math.cos(b);var h=a[0],p=a[1],g=a[2],v=a[3],m=a[4],t=a[5],z=a[6],C=a[7];a!==q&&(q[8]=a[8],q[9]=a[9],q[10]=a[10],q[11]=a[11],q[12]=a[12],q[13]=a[13],q[14]=a[14],q[15]=a[15]);q[0]=h*b+m*d;q[1]=p*b+t*d;q[2]=g*b+z*d;q[3]=v*b+C*d;q[4]=m*b-h*d;q[5]=t*b-p*d;q[6]=z*b-g*d;q[7]=C*b-v*d;return q};
a.VB=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.UB=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.TB=function(a,b,q){var d=b[0],h=b[1];b=b[2];var p=Math.sqrt(d*d+h*h+b*b),g;if(1E-7>Math.abs(p))return null;p=1/p;d*=p;h*=p;b*=p;p=Math.sin(a);a=Math.cos(a);g=1-a;q[0]=d*d*g+a;q[1]=h*d*g+b*
p;q[2]=b*d*g-h*p;q[3]=0;q[4]=d*h*g-b*p;q[5]=h*h*g+a;q[6]=b*h*g+d*p;q[7]=0;q[8]=d*b*g+h*p;q[9]=h*b*g-d*p;q[10]=b*b*g+a;q[11]=0;q[12]=0;q[13]=0;q[14]=0;q[15]=1;return q};a.NJ=function(a,b){var q=Math.sin(a),d=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=d;b[6]=q;b[7]=0;b[8]=0;b[9]=-q;b[10]=d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.OJ=function(a,b){var q=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=0;b[2]=-q;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=q;b[9]=0;b[10]=d;b[11]=0;b[12]=0;b[13]=0;
b[14]=0;b[15]=1;return b};a.PJ=function(a,b){var q=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=q;b[2]=0;b[3]=0;b[4]=-q;b[5]=d;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,q){var d=a[0],h=a[1],p=a[2],g=a[3],v=d+d,m=h+h,t=p+p;a=d*v;var z=d*m,d=d*t,C=h*m,h=h*t,p=p*t,v=g*v,m=g*m,g=g*t;q[0]=1-(C+p);q[1]=z+g;q[2]=d-m;q[3]=0;q[4]=z-g;q[5]=1-(a+p);q[6]=h+v;q[7]=0;q[8]=d+m;q[9]=h-v;q[10]=1-(a+C);q[11]=0;q[12]=b[0];q[13]=b[1];q[14]=b[2];
q[15]=1;return q};a.fromQuat=function(a,b){var q=a[0],d=a[1],h=a[2],p=a[3],g=q+q,v=d+d,m=h+h,q=q*g,t=d*g,d=d*v,z=h*g,C=h*v,h=h*m,g=p*g,v=p*v,p=p*m;b[0]=1-d-h;b[1]=t+p;b[2]=z-v;b[3]=0;b[4]=t-p;b[5]=1-q-h;b[6]=C+g;b[7]=0;b[8]=z+v;b[9]=C-g;b[10]=1-q-d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,q,d,h,p,g){var v=1/(b-a),m=1/(d-q),t=1/(h-p);g[0]=2*h*v;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2*h*m;g[6]=0;g[7]=0;g[8]=(b+a)*v;g[9]=(d+q)*m;g[10]=(p+h)*t;g[11]=-1;g[12]=0;g[13]=0;g[14]=
p*h*2*t;g[15]=0;return g};a.perspective=function(a,b,q,d,h){a=1/Math.tan(a/2);var p=1/(q-d);h[0]=a/b;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=a;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=(d+q)*p;h[11]=-1;h[12]=0;h[13]=0;h[14]=2*d*q*p;h[15]=0;return h};a.KL=function(a,b,q,d){var h=Math.tan(a.YM*Math.PI/180),p=Math.tan(a.vJ*Math.PI/180),g=Math.tan(a.mL*Math.PI/180);a=Math.tan(a.VL*Math.PI/180);var v=2/(g+a),m=2/(h+p);d[0]=v;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=m;d[6]=0;d[7]=0;d[8]=-((g-a)*v*.5);d[9]=(h-p)*m*.5;d[10]=q/
(b-q);d[11]=-1;d[12]=0;d[13]=0;d[14]=q*b/(b-q);d[15]=0;return d};a.ortho=function(a,b,q,d,h,p,g){var v=1/(a-b),m=1/(q-d),t=1/(h-p);g[0]=-2*v;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=-2*m;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=2*t;g[11]=0;g[12]=(a+b)*v;g[13]=(d+q)*m;g[14]=(p+h)*t;g[15]=1;return g};a.lookAt=function(e,b,q,d){var h,p,g,v,m,t,z,C,J=e[0],D=e[1];e=e[2];g=q[0];v=q[1];p=q[2];z=b[0];q=b[1];h=b[2];if(1E-7>Math.abs(J-z)&&1E-7>Math.abs(D-q)&&1E-7>Math.abs(e-h))return a.identity(d);b=J-z;q=D-q;z=e-h;C=1/Math.sqrt(b*
b+q*q+z*z);b*=C;q*=C;z*=C;h=v*z-p*q;p=p*b-g*z;g=g*q-v*b;(C=Math.sqrt(h*h+p*p+g*g))?(C=1/C,h*=C,p*=C,g*=C):g=p=h=0;v=q*g-z*p;m=z*h-b*g;t=b*p-q*h;(C=Math.sqrt(v*v+m*m+t*t))?(C=1/C,v*=C,m*=C,t*=C):t=m=v=0;d[0]=h;d[1]=v;d[2]=b;d[3]=0;d[4]=p;d[5]=m;d[6]=q;d[7]=0;d[8]=g;d[9]=t;d[10]=z;d[11]=0;d[12]=-(h*J+p*D+g*e);d[13]=-(v*J+m*D+t*e);d[14]=-(b*J+q*D+z*e);d[15]=1;return d};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.SB=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.__particles=function(a,w){function e(){throw"_rand() undefined";}function b(a,b,e,d,l,c,m){var h=a.S.Kn,g=a.S.xd,t=a.S.time;a=a.S.Fv;for(var p=b?4:1,K=0;K<h.length;K+=p){var k=h[K];if(k>a&&k<=t)for(k=0;8>k;k++)g[8*K+k]=l[k];for(k=0;8>k;k++)z[k]=g[8*K+k];k=C;k[0]=e[3*K];k[1]=e[3*K+1];k[2]=e[3*K+2];v.Nj(k,z,k);c[3*K]=k[0];c[3*K+1]=k[1];c[3*K+2]=k[2];var u=C;u[0]=d[3*K];u[1]=d[3*K+1];u[2]=d[3*K+2];v.jm(u,z,u);m[3*K]=u[0];m[3*K+1]=u[1];m[3*K+2]=u[2];if(b)for(k=1;4>k;k++)c[3*(K+k)]=c[3*K],c[3*
(K+k)+1]=c[3*K+1],c[3*(K+k)+2]=c[3*K+2],m[3*(K+k)]=u[0],m[3*(K+k)+1]=u[1],m[3*(K+k)+2]=u[2]}}function q(a){a?(g.FF(a),e=function(){return g.nE()}):e=function(){return Math.random()}}var d=w("__config"),h=w("__geometry"),p=w("__scenes"),g=w("__util"),v=w("__tsr"),m=w("vec3"),t=d.Wd,z=new Float32Array(8),C=new Float32Array(3);a.wo=function(a){return 0<a.particle_systems.length?!0:!1};a.so=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.PK=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.cD=function(a){for(var b=0;b<a.particle_systems.length;b++){var e=a.particle_systems[b].settings;if("HAIR"==e.type&&e.b4w_dynamic_grass)return!0}return!1};a.bC=function(a,d,v,n){v.S=v.S||{};var l=h.KB(d),c=v.settings.count,z=v.settings.frame_start/t.La,p=v.settings.frame_end/t.La,x=v.settings.lifetime/t.La,B=v.settings.lifetime_random,C=v.settings.emit_from,K=
v.settings.factor_random,k=v.settings.angular_velocity_mode,u=v.settings.angular_velocity_factor,r=v.settings.b4w_randomize_emission,L=v.settings.b4w_cyclic;q(v.seed);var F=v.S.vG="WORLD"==v.settings.b4w_coordinate_system?!0:!1;v.S.frame=0;if(d=!a.cg){var f;f=[];for(var N=0;N<c;N++)f.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);f=new Float32Array(f);for(var N=[],P=0;P<c;P++)N.push(4*P,4*P+2,4*P+1,4*P,4*P+3,4*P+2);N=new Uint16Array(N)}switch(C){case "VERT":for(var P=l.u[0].a_position,l=l.u[0].a_normal,V=P.length/
3,C=[],R=0;R<c;R++){var w=Math.round((V-1)*e());C.push(w);d&&(C.push(w),C.push(w),C.push(w))}V=[];for(R=0;R<C.length;R++)V.push(P[3*C[R]]),V.push(P[3*C[R]+1]),V.push(P[3*C[R]+2]);P=new Float32Array(V);V=[];for(R=0;R<C.length;R++)V.push(l[3*C[R]]),V.push(l[3*C[R]+1]),V.push(l[3*C[R]+2]);C=new Float32Array(V);break;case "FACE":P=[];C=[];R=[];g.ll(0,R);V=h.bo(l,c,!1,R);g.ll(0,R);l=h.bo(l,c,!0,R);for(R=0;R<V.length;R++)P.push(V[R][0],V[R][1],V[R][2]),d&&(P.push(V[R][0],V[R][1],V[R][2]),P.push(V[R][0],
V[R][1],V[R][2]),P.push(V[R][0],V[R][1],V[R][2])),C.push(l[R][0],l[R][1],l[R][2]),d&&(C.push(l[R][0],l[R][1],l[R][2]),C.push(l[R][0],l[R][1],l[R][2]),C.push(l[R][0],l[R][1],l[R][2]));P=new Float32Array(P);C=new Float32Array(C);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}C=[P,C];l=C[0];C=C[1];v.S.uj=new Float32Array(l);v.S.UD=new Float32Array(C);v.S.eE=new Float32Array(l.length);v.S.VD=new Float32Array(C.length);v.S.time=0;v.S.Fv=
-1;P=[];p=(p-z)/c;for(V=0;V<c;V++)R=r?p*V+10*p*(.5-e()):p*V,L||(R+=z),P.push(R),d&&(P.push(R),P.push(R),P.push(R));z=new Float32Array(P);v.S.Kn=new Float32Array(z);v.S.Ns=new Float32Array(z);v.S.xd=new Float32Array(8*z.length);for(r=0;r<8*z.length;r++)for(L=0;8>L;L++)v.S.xd[8*r+L]=n[L];F&&b(v,d,l,C,n,l,C);v=[];n=x*B;for(B=0;B<c;B++)F=n*e(),v.push(x-F),d&&(v.push(x-F),v.push(x-F),v.push(x-F));x=new Float32Array(v);v=[];for(n=0;n<c;n++){B=[e()-.5,e()-.5,e()-.5];m.normalize(B,B);v.push(K*B[0]);v.push(K*
B[1]);v.push(K*B[2]);switch(k){case "NONE":v.push(0);break;case "SPIN":case "VELOCITY":v.push(u);break;case "RAND":v.push(2*u*(e()-.5));break;default:throw"Undefined velocity factor";}if(d)for(B=v.slice(-4),F=0;12>F;F++)v.push(B[F%4])}c=new Float32Array(v);K=g.mb("EMITTER_PARTICLES");k=g.$c();k.a_position=l;k.a_normal=C;K.u[0]=k;d?K.ca=N:(a.de=h.Cm,K.ca=new Uint16Array(0));K.J=l.length/3;K.G.a_p_delay=z;K.G.a_p_lifetime=x;K.G.a_p_vels=c;d&&(K.G.a_p_bb_vertex=f);return K};a.fG=function(a){for(var e=
a.q,d=0;d<e.length;d++){var n=e[d],l=e[d].xc;if(l){var c=n.$a;if(!l.S.vG)break;var m=l.S.eE,v=l.S.VD;b(l,!n.cg,l.S.uj,l.S.UD,a.d.Be,m,v);h.ED(c);h.lq(c,"a_position",3,m);h.lq(c,"a_normal",3,v)}}};a.UE=function(a,b,e){var d=b.settings.lifetime/t.La,l=b.settings.normal_factor,c=9.81*b.settings.effector_weights.gravity,m=b.settings.effector_weights.wind,h=b.settings.mass,v=b.settings.b4w_fade_in/t.La,g=b.settings.b4w_fade_out/t.La,z=b.settings.b4w_cyclic;a.tv=b.settings.frame_end/t.La-b.settings.frame_start/
t.La;a.pv=z?1:0;a.gp=l;a.sv=c;l=p.TC();a.El[0]=l[0]*m;a.El[1]=l[1]*m;a.El[2]=l[2]*m;a.vv=d;a.uv=h;a.qv=v;a.rv=g;a.cg?(d=e.halo.size,m=e.halo.hardness,30>m?(m=.5,h=.9):40>m?(m=.1,h=1):50>m?(m=0,h=.8):(m=0,h=.5)):(d=b.settings.particle_size,h=m=1);a.hp=d;a.mv=m;a.lv=h;d=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;m=Math.min(2*d.length,b.length);for(h=0;h<m;h+=2)v=
d[h/2],b[h]=v.position,b[h+1]=(v.color[0]+v.color[1]+v.color[2])/3;a.xv=d.length}a.wv.set(b);b=e.texture_slots;e=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;m=Math.min(4*d.length,e.length);for(h=0;h<m;h+=4)v=d[h/4],e[h]=v.position,e[h+1]=v.color[0],e[h+2]=v.color[1],e[h+3]=v.color[2];a.ov=d.length}a.nv.set(e)};a.dF=function(a,b){a.S.Fv=a.S.time;a.S.time=b};a.gE=
function(a){for(var b=a.J,e=a.u[0].a_position,d=a.G.a_texcoord,l=[],c=[],m=0;m<b;m++)c.push(e[3*m]),c.push(e[3*m+1]),l.push(e[3*m+2]);l=new Float32Array(l);c=new Float32Array(c);a.G.a_lf_dist=l;a.G.a_lf_bb_vertex=c;a.G.a_texcoord=d;return a};a.CM=function(a,b,e){a=a.q;for(var d=0;d<a.length;d++){var l=a[d],c=l.xc;c&&c.name==b&&(l.hp=e)}};a.rM=function(a,b,e){a=a.q;for(var d=0;d<a.length;d++){var l=a[d],c=l.xc;c&&c.name==b&&(l.gp=e)}};a.fM=function(a,b,e){a=a.q;for(var d=0;d<a.length;d++){var l=a[d],
c=l.xc;if(c&&c.name==b){var m=c.S.Kn;if(1==e)c=m;else if(0==e)for(var v=!l.cg,g=v?4:1,c=c.S.Ns,t=0;t<c.length;t+=g)c[t]=1E4,v&&(c[t+1]=c[t],c[t+2]=c[t],c[t+3]=c[t]);else for(var z=1/e,c=c.S.Ns,g=(v=!l.cg)?4:1,C=0,t=0;t<c.length;t+=g)t>=C?(c[t]=m[t],C+=z):c[t]=1E4,v&&(c[t+1]=c[t],c[t+2]=c[t],c[t+3]=c[t]);h.lq(l.$a,"a_p_delay",1,c)}}};a.pG=function(a,b,e){a=a.particle_systems;for(var d=0;d<a.length;d++){var l=a[d];if("EMITTER"==l.settings.type)for(var c=l.S.Kn,d=0;d<8*c.length;d++)l.S.xd[8*d]=b[0],
l.S.xd[8*d+1]=b[1],l.S.xd[8*d+2]=b[2],l.S.xd[8*d+3]=b[3],l.S.xd[8*d+4]=e[0],l.S.xd[8*d+5]=e[1],l.S.xd[8*d+6]=e[2],l.S.xd[8*d+7]=e[3]}}};b4w.module.__geometry=function(a,w){function e(a){return 65536<a.J?x.Ct()?!1:!0:!1}function b(a){return 0<a.ca.length?!0:!1}function q(a,e,k){if(!b(a))return a;k||c.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.J*(e||1)+", will use drawArrays","color: #aa0");e=a.ca;k=a.J;var f=a.G,u=a.u,l;for(l in f){var n=f[l],m=C(n,k);f[l]=d(e,n,m)}for(f=0;f<u.length;f++){var h=u[f];for(l in h)n=h[l],m=C(n,k),h[l]=d(e,n,m)}a.J=e.length;a.ca=new Uint16Array(0);return a}function d(a,b,c){if(0==
b.length)return new Float32Array(0);for(var f=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var d=a[e],k=0;k<c;k++)f[c*e+k]=b[c*d+k];return f}function h(a,b){var c=a.vf,f=a.tj[b];if(f)return c.subarray(f.offset,f.offset+f.length);throw"extract_array() failed; invalid name: "+b;}function p(b,c){var e,f;switch(c){case a.vi:case a.ak:e=u.TRIANGLES;f=u.STATIC_DRAW;break;case a.Cm:e=u.POINTS;f=u.STATIC_DRAW;break;case a.Fq:e=u.TRIANGLES;f=u.DYNAMIC_DRAW;break;case a.Lx:e=u.POINTS;f=u.DYNAMIC_DRAW;
break;case a.Mx:e=u.LINES;f=u.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=e;b.Rj=f}function g(a){a.dg?(a.me||(a.me=u.createBuffer()),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a.me),u.bufferData(u.ELEMENT_ARRAY_BUFFER,a.dg,a.Rj),a.Kk=a.dg.byteLength):a.Kk=0;a.Og||(a.Og=u.createBuffer());u.bindBuffer(u.ARRAY_BUFFER,a.Og);u.bufferData(u.ARRAY_BUFFER,a.vf,a.Rj);a.Ms=a.vf.byteLength}function v(a){for(var b=I.mb("JOIN_"+a.length+"_SUBMESHES"),c=0,f=0;f<a.length;f++)c+=a[f].ca.length;b.ca=new Uint32Array(c);
for(f=c=0;f<a.length;f++)c+=a[f].J;b.J=c;var e=a[0],d;for(d in e.G){for(f=c=0;f<a.length;f++)c+=a[f].G[d].length;b.G[d]=new Float32Array(c)}for(d in e.u[0]){for(f=c=0;f<a.length;f++)c+=a[f].u[0][d].length;for(f=0;f<e.u.length;f++)b.u[f]=b.u[f]||{},b.u[f][d]=new Float32Array(c)}for(e=f=c=0;e<a.length;e++){d=a[e];for(var k=d.ca,u=d.J,l=d.G,n=0;n<k.length;n++)b.ca[c+n]=k[n]+f;var c=c+k.length,m;for(m in l){var k=l[m],h=f*C(k,u);b.G[m].set(k,h)}for(n=0;n<d.u.length;n++){var l=d.u[n],v=b.u[n];for(m in l)k=
l[m],h=f*C(k,u),v[m].set(k,h)}f+=u}return b}function m(a,b,e,f,d,k){var u=I.mb("SUBMESH_"+a.name+"_"+b),l=a.submeshes[b],m=l.base_length,h=a.materials[b];u.J=m;if(t(e,"a_texcoord")){var v=null,g=a.materials[b];b=a.submeshes[b];if(g.texture_slots.length)switch(g=g.texture_slots[0],g.texture_coords){case "UV":g=a.uv_textures.indexOf(g.uv_layer);-1==g||0==g?v=new Float32Array(b.texcoord):1==g&&(v=new Float32Array(b.texcoord2));break;case "ORCO":for(var C=a.b4w_bounding_box,v=new Float32Array(2*b.base_length),
g=(C.max_x+C.min_x)/2,p=(C.max_z+C.min_z)/2,x=C.max_x-C.min_x,C=C.max_z-C.min_z,D=0,y=0;y<b.position.length;y+=3)v[D++]=(b.position[y]-g)/x+.5,v[D++]=(p-b.position[y+2])/C+.5}null===v&&(v=new Float32Array(b.texcoord));b=v}else b=new Float32Array(0);var M,v=l.group;if(t(e,"a_influence")&&f){g=new Float32Array(4*m);p=v.length/m;x=new Float32Array(p);for(C=0;C<p;C++)for(M in x[C]=-1,f)if(D=f[M],D.xx===C){x[C]=D.Ki;break}y=3<p?p:4;f=new Float32Array(y);M=new Uint32Array(y);for(var C=new Float32Array(4),
D=new Float32Array(y),y=new Uint32Array(y),J=new Float32Array(4),w=0;w<m;w++)f.set(D),M.set(y),C.set(J),g.set(z(v,p,w,m,x,f,M,C),4*w)}else g=new Float32Array(0);M=g;f=d?I.za(d):{};f.a_color={Zf:!0};f.a_color.src=t(e,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,Rc:7}]:[];d={a_texcoord:b,a_influence:M};M=l.vertex_colors;b=l.color;v=a.name;g=[];for(p=0;p<M.length;p++)g.push(M[p].name);for(var la in f)if(p=f[la].src,p.length){for(C=x=0;C<p.length;C++)x+=I.Fg(p[C].Rc);d[la]=new Float32Array(x*
m);for(C=D=0;C<p.length;C++){var ma=p[C].name,y=p[C].Rc,J=I.$v(y),ha=g.indexOf(ma);-1==ha&&I.sa('vertex color "'+ma+'" for mesh "'+v+'" not found.');var w=M[ha].mask,pa=I.Fg(w);(y&w)!==y&&c.error("Wrong color extraction from "+ma+" to "+la+".");for(var H=ma=0;H<ha;H++)ma+=I.Fg(M[H].mask);ha=ma*m;for(ma=0;ma<m;ma++)for(H=0;3>H;H++)J[H]&&(d[la][ma*x+(D+I.Fj(y,H))]=b[ha+ma*pa+I.Fj(w,H)]);D+=pa}}else d[la]=new Float32Array(0);la=a.uv_textures;f=l.texcoord;M=l.texcoord2;b=a.name;if(k)for(var aa in k){v=
la.indexOf(aa);-1==v&&I.sa('uv map "'+aa+'" for mesh "'+b+'" not found');if(0==v)var na=new Float32Array(f);else 1==v&&(na=new Float32Array(M));d[k[aa]]=na}u.G=d;u.ca=new Uint32Array(l.indices);k=l.position.length/m/3;na=(aa=t(e,"a_normal")&&l.normal.length?!0:!1)&&t(e,"a_tangent")&&l.tangent.length?!0:!1;la=aa&&h.texture_slots.length&&t(e,"a_tangent")&&"ORCO"==h.texture_slots[0].texture_coords?!0:!1;for(d=0;d<k;d++){h={};f=new Float32Array(3*m);M=new Float32Array(aa?3*m:0);b=new Float32Array(na||
la?4*m:0);v=d*m*3;g=v+3*m;f.set(l.position.subarray(v,g),0);aa&&(v=d*m*3,g=v+3*m,M.set(l.normal.subarray(v,g),0));if(na)v=d*m*4,g=v+4*m,b.set(l.tangent.subarray(v,g),0);else if(la)for(v=M,g=b,p=m,c.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+a.name+'". Please add a UV-map.'),x=0;x<p;x++)C=E,D=K,C[0]=v[3*x],C[1]=v[3*x+1],C[2]=v[3*x+2],B.cross(C,I.nd,D),0==B.length(D)&&B.cross(C,I.Ee,D),B.normalize(D,D),g[4*x]=D[0],g[4*x+1]=D[1],g[4*x+2]=D[2],
g[4*x+3]=1;else if(aa&&t(e,"a_tangent"))for(b=new Float32Array(4*m),d=0;d<b.length;d++)b[d]=1;h.a_position=f;h.a_normal=M;h.a_tangent=b;u.u.push(h)}if(1<k){a=u.u[0];var h={},Fa;for(Fa in a)h[Fa]=new Float32Array(a[Fa]);u.u.push(h)}t(e,"a_polyindex")&&(q(u,1,!0),u.G.a_polyindex=n(u));return u}function t(a,b){return-1<a.indexOf(b)?!0:!1}function z(a,b,c,f,e,d,k,u){for(var l=!0,n=0;n<b;n++){var m=a[n*f+c];if(-1!==m){var v=e[n];-1!==v&&(d[n]=m,k[n]=v,l=!1)}}if(l)return u;J(d,k,!1);for(n=a=0;4>n;n++)a+=
d[n];if(.01>a)return u;for(n=0;4>n;n++)d[n]/=a;if(.01>Math.abs(d[0]-1))u[0]=k[0]+1;else for(n=0;4>n;n++)u[n]=k[n]+d[n];return u}function C(a,b){if(0==b)return 0;var c=a.length,f=c/b;if(f!=Math.floor(f))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return f}function J(a,b,c){var f=a.length,e=f,d=!1;for(c=c?-1:1;1<e||d;){1<e&&(e=Math.floor(e/1.247330950103979));for(var d=!1,k=0;e+k<f;k++)0>c*(a[k]-a[k+e])&&(d=a[k],a[k]=a[k+e],a[k+e]=d,d=b[k],b[k]=b[k+e],
b[k+e]=d,d=!0)}}function D(a,b,c){var f=[],e=[];B.subtract(b,a,f);B.subtract(c,a,e);B.normalize(f,f);B.normalize(e,e);return Math.acos(B.dot(f,e))}function y(a,c,e){c||(c=[]);e=e?a.u[0].a_normal:a.u[0].a_position;if(b(a)){a=a.ca;for(var f=a.length/3,d=0;d<f;d++){var k=new Float32Array(9),u=a[3*d];k[0]=e[3*u];k[1]=e[3*u+1];k[2]=e[3*u+2];u=a[3*d+1];k[3]=e[3*u];k[4]=e[3*u+1];k[5]=e[3*u+2];u=a[3*d+2];k[6]=e[3*u];k[7]=e[3*u+1];k[8]=e[3*u+2];c[d]=k}}else for(d=0;d<e.length;d++)k=new Float32Array(9),k[0]=
e[9*d],k[1]=e[9*d+1],k[2]=e[9*d+2],k[3]=e[9*d+3],k[4]=e[9*d+4],k[5]=e[9*d+5],k[6]=e[9*d+6],k[7]=e[9*d+7],k[8]=e[9*d+8],c[d]=k;return c}function n(a){for(var b=new Float32Array(a.J),c=0;c<a.J;c++)b[c]=c%3;return b}function l(a,b,c){var f=B.dist(a,b);a=B.dist(a,c);b=B.dist(b,c);c=(f+a+b)/2;return c*(c-f)*(c-a)*(c-b)}var c=w("__print"),M=w("__tsr"),I=w("__util"),x=w("__extensions"),B=w("vec3"),E=new Float32Array(3),K=new Float32Array(3),k=new Float32Array(3);a.Td=10;a.hr=20;a.bI=30;a.ak=10;a.Cm=20;a.Fq=
30;a.Lx=40;a.Mx=50;a.vi=a.ak;var u=null;a.Bc=function(a){u=a};a.oJ=function(a){var b=_buffers[a];u.deleteBuffer(b.me);u.deleteBuffer(b.Og);delete _buffers[a]};a.LF=function(c,d,k,f){e(c)&&q(c);var l=c.ca,n=c.J,m=c.u,v={},h;for(h in c.G)h in f&&!f[h].Zf||(v[h]=c.G[h]);f={dg:null,vf:null,Ao:0,count:0,tj:{},mode:0,Rj:0,Kk:0,Ms:0,Og:null,me:null,kl:null};if(l.length)if(h=l.length,65536>=n)var t=new Uint16Array(l),B=u.UNSIGNED_SHORT;else t=new Uint32Array(l),B=u.UNSIGNED_INT;else h=n,t=null;var z=0,x=
m.length,K;for(K in m[0])var D=m[0][K],z=z+D.length*x;for(K in v)D=v[K],z+=D.length;K=new Float32Array(z);var z=0,x={},y;for(y in v){var M=v[y];if(D=M.length)K.set(M,z),x[y]={CI:y,vg:C(M,n),offset:z,frames:1,length:D},z+=D}v=m.length;for(y in m[0])if(M=m[0][y],D=M.length,M=C(M,n),D){x[y]={vg:M,offset:z,frames:v,length:D};1<v&&(x[y+"_next"]={vg:M,offset:z+D,frames:v,length:D});for(var E=0;E<v;E++)M=m[E][y],K.set(M,z),z+=D}f.count=h;f.dg=t;f.vf=K;f.Ao=B;f.tj=x;p(f,k);g(f);d!=a.Td&&b(c)&&(f.kl={MD:new Float32Array(l.length),
ND:new Float32Array(l.length),tB:new Float32Array(l.length/3),type:d});return f};a.rD=e;a.qD=b;a.Zp=q;a.$M=function(a,b,c){p(a,b);a.count=c.length;a.dg=c;a.Ao=c instanceof Uint16Array?u.UNSIGNED_SHORT:u.UNSIGNED_INT;return a};a.lq=function(a,b,c,f){var e=a.vf,d=a.tj,k=d[b];k?(c&&k.vg!=c&&I.sa('invalid num_comp for "'+b+'"'),e.set(f,k.offset)):(e=e.length,k=new Float32Array(e+f.length),k.set(a.vf),k.set(f,e),a.vf=k,d[b]={vg:c,offset:e});g(a)};a.CJ=h;a.sL=function(a){a.Rj=u.STATIC_DRAW};a.ED=function(a){a.Rj=
u.DYNAMIC_DRAW};a.gG=g;a.hs=function(a){a.me&&u.deleteBuffer(a.me);a.Og&&u.deleteBuffer(a.Og)};a.su=function(a,b){return a.submeshes[b].base_length?!1:!0};a.Zw=function(a,b){for(var c=0;c<a.u.length;c++){var f=a.u[c].a_position;M.km(f,b,f,0);f=a.u[c].a_normal;0<f.length&&M.fx(f,b,f,0);f=a.u[c].a_tangent;0<f.length&&M.gx(f,b,f,0)}(c=a.G.au_center_pos)&&c.length&&M.km(c,b,c,0);return a};a.JF=function(a,b){var c=a.G.au_center_pos;if(c&&c.length){var f=new Float32Array(c);M.km(f,b,f,0);for(var e=0;e<
a.u.length;e++)for(var d=0;d<f.length;d++)a.u[e].a_position[d]+=f[d]-c[d];c.set(f)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.IF=function(a,b){var c=a.J,f;for(f in b){var e=b[f].length;a.G[f]=new Float32Array(e*c);for(var d=0;d<c;d++)for(var k=0;k<e;k++)a.G[f][d*e+k]=b[f][k]}};a.KF=v;a.DD=function(a,b,c){if(!a.J)return I.mb("EMPTY");var f=c.length;65536<a.J*f&&!x.Ct()&&q(a,f);var e=a.ca,d=a.J,k=a.G;a=a.u;for(var u in b){var l=b[u].length,n=l*d;k[u]=new Float32Array(n);
for(var m=0;m<d;m++)for(n=0;n<l;n++)k[u][m*l+n]=b[u][n]}b=I.mb("CLONE_"+f+"_SUBMESHES");b.J=d*f;b.ca=new Uint32Array(e.length*f);for(m=0;m<f;m++)for(l=e.length*m,u=d*m,n=0;n<e.length;n++)b.ca[l+n]=e[n]+u;for(var v in k)for(e=k[v],n=e.length*f,l=C(e,d),b.G[v]=new Float32Array(n),m=0;m<f;m++)u=d*l*m,b.G[v].set(e,u);for(v in a[0])for(m=0;m<a.length;m++)for(e=a[m][v],n=e.length*f,l=C(e,d),b.u[m]=b.u[m]||{},b.u[m][v]=new Float32Array(n),n=0;n<f;n++)switch(k=c[n],u=d*l*n,v){case "a_position":M.km(e,k,b.u[m][v],
u);break;case "a_normal":M.fx(e,k,b.u[m][v],u);break;case "a_tangent":M.gx(e,k,b.u[m][v],u);break;default:throw"Wrong attribute name: "+v;}return b};a.bt=m;a.JB=function(a){var b=a.J,c=a.u[0].a_position,f=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint16Array(4*a.ca.length);for(var d=0;d<b;d++)f[12*d]=c[3*d],f[12*d+1]=c[3*d+1],f[12*d+2]=c[3*d+2],f[12*d+3]=c[3*d],f[12*d+4]=c[3*d+1],f[12*d+5]=c[3*d+2],f[12*d+6]=c[3*d],f[12*d+7]=c[3*d+1],f[12*d+8]=c[3*d+2],f[12*d+9]=c[3*d],f[12*d+10]=c[3*d+
1],f[12*d+11]=c[3*d+2],e[8*d]=-.5,e[8*d+1]=-.5,e[8*d+2]=-.5,e[8*d+3]=.5,e[8*d+4]=.5,e[8*d+5]=.5,e[8*d+6]=.5,e[8*d+7]=-.5,a[6*d]=4*d+2,a[6*d+1]=4*d+1,a[6*d+2]=4*d,a[6*d+3]=4*d+2,a[6*d+4]=4*d,a[6*d+5]=4*d+3;c=I.mb("HALO");c.u=[];c.u[0]={};c.J=4*b;c.u[0].a_position=f;c.G.a_halo_bb_vertex=e;c.ca=a;return c};a.aD=t;a.KB=function(a){for(var b=["a_position","a_normal"],c=[],f=0;f<a.submeshes.length;f++){var d=m(a,f,b,null,null,null);d.J&&c.push(d)}return 0==c.length?I.mb("EMPTY"):1==c.length?c[0]:v(c)};
a.cG=function(a,b,c){for(var f=a.dg,d=h(a,"a_position"),e=a.kl,k=e.MD,l=e.ND,e=e.tB,n=f,m=n.length/3,v=0;v<m;v++){var g=n[3*v],t=n[3*v+1],C=n[3*v+2],z=d[3*g+1],B=d[3*g+2],x=d[3*t+1],p=d[3*t+2],K=d[3*C+1],D=d[3*C+2];k[3*v]=(d[3*g]+d[3*t]+d[3*C])/3;k[3*v+1]=(z+x+K)/3;k[3*v+2]=(B+p+D)/3}I.bf(k,b,l);b=k.length/3;for(d=0;d<b;d++)l=k[3*d]-c[0],n=k[3*d+1]-c[1],m=k[3*d+2]-c[2],e[d]=l*l+n*n+m*m;c=f;f=e.length;if(!(2>f))for(k=f,d=!1;1<k||d;)for(1<k&&(k=Math.floor(k/1.247330950103979)),d=!1,b=0;k+b<f;b++)0>
e[b]-e[b+k]&&(d=e[b],e[b]=e[b+k],e[b+k]=d,d=c,l=b,n=b+k,m=d[3*l],v=d[3*l+1],g=d[3*l+2],d[3*l]=d[3*n],d[3*l+1]=d[3*n+1],d[3*l+2]=d[3*n+2],d[3*n]=m,d[3*n+1]=v,d[3*n+2]=g,d=!0);f=c;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a.me);u.bufferData(u.ELEMENT_ARRAY_BUFFER,f,u.DYNAMIC_DRAW)};a.tF=J;a.$z=function(a,b,c){for(var f=b.length/3,d=a.length/3,e=[],k=Array(3),u=Array(3),l=Array(3),n=0;n<d;n++){for(var m=a[3*n],v=a[3*n+1],h=a[3*n+2],g=0;3>g;g++)k[g]=b[3*m+g],u[g]=b[3*v+g],l[g]=b[3*h+g];if(c)var g=D(k,u,l),
t=D(u,l,k),C=Math.PI-g-t;else C=t=g=1;var z=e,x;x=k;var p=l,K=[],y=[],q=[];B.subtract(u,x,K);B.subtract(p,x,y);B.cross(K,y,q);B.normalize(q,q);x=q;for(p=0;3>p;p++)K=3*v+p,y=3*h+p,z[3*m+p]=g*x[p],z[K]=t*x[p],z[y]=C*x[p]}if(c)for(var M in c)for(n=c[M],a=0;3>a;a++){b=3*n[0]+a;for(d=1;d<n.length;d++)k=3*n[d]+a,e[b]+=e[k];for(d=1;d<n.length;d++)k=3*n[d]+a,e[k]=e[b]}for(n=0;n<f;n++){c=n;M=e;a=new Float32Array(3);for(b=0;3>b;b++)d=3*c+b,a[b]=M[d];B.normalize(a,a);for(b=0;3>b;b++)d=3*c+b,M[d]=a[b]}return e};
a.aA=function(a,b,c){for(var f={},d=b.length/3,e=0;e<d;e++){var k=String(b[3*e])+String(b[3*e+1])+String(b[3*e+2]);f[k]=[]}d=a.length;for(e=0;e<d;e++)b=a[e],k=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),k in f&&f[k].push(b);return f};a.bo=function(a,b,c,f){var d=y(a,null,!1);if(c)var e=y(a,null,!0);var u=d.length,n=new Float32Array(u),m=E,v=K;for(a=0;a<u;a++){var h=d[a];m.set(h.subarray(0,3));v.set(h.subarray(3,6));k.set(h.subarray(6));n[a]=Math.sqrt(l(m,v,k))}m=new Float32Array(u);m[0]=n[0];
for(a=1;a<u;a++)m[a]=m[a-1]+n[a];u=m[n.length-1];n=[];for(a=0;a<b;a++){var v=u*I.Tc(f),v=I.qk(m,v,0,m.length-1),h=c?e[v]:d[v],v=a,g=h,t=f,h=void 0,h=new Float32Array(3),C=g[0],z=g[1],x=g[2],p=g[3],B=g[4],D=g[5],q=g[6],M=g[7],J=g[8],g=I.Tc(t),t=I.Tc(t);1<g+t&&(g=1-g,t=1-t);var w=1-g-t,z=w*z+g*B+t*M,x=w*x+g*D+t*J;h[0]=w*C+g*p+t*q;h[1]=z;h[2]=x;n[v]=h}return n};a.DJ=y;a.at=n;a.WM=l;a.JC=function(a,b,c,f){var d=b[0]-a[0],e=c[0]-a[0],k=b[1]-a[1],u=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];f[0]=k*a-b*u;f[1]=e*
b-d*a;f[2]=d*u-k*e;return f};a.KE=function(a,b,c){a=a.u[0].a_position;for(var f=0;f<a.length;f+=3)a[f]=(a[f]-c[0])*b[0]+c[0],a[f+1]=(a[f+1]-c[1])*b[1]+c[1],a[f+2]=(a[f+2]-c[2])*b[2]+c[2]}};b4w.module.__tsr=function(a,w){function e(a,b,d,e){e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=b;e[4]=d[0];e[5]=d[1];e[6]=d[2];e[7]=d[3]}function b(a,b,d){var e=b[0],h=b[1],g=b[2],p=b[3],y=b[4],n=b[5],l=b[6];b=b[7];var c=a[0]*p,q=a[1]*p,I=a[2]*p;a=b*c+n*I-l*q;var p=b*q+l*c-y*I,x=b*I+y*q-n*c,c=-y*c-n*q-l*I;d[0]=a*b+c*-y+p*-l-x*-n;d[1]=p*b+c*-n+x*-y-a*-l;d[2]=x*b+c*-l+a*-n-p*-y;d[0]+=e;d[1]+=h;d[2]+=g;return d}var q=w("__util"),d=w("vec3"),h=w("quat");w("mat4");var p=new Float32Array(3),g=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.nh=function(a,b,d,h){h||(h=new Float32Array(8));e(a,b,d,h);return h};a.Ij=e;a.eF=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.gf=function(a,b){b[3]=a};a.fF=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.Ip=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.$t=function(a){return a.subarray(0,
3)};a.al=function(a){return a[3]};a.Pt=function(a){return a.subarray(4)};a.invert=function(a,b){var d=1/a[3];if(!d)return null;var e=a[0],C=a[1],p=a[2];g[0]=a[4];g[1]=a[5];g[2]=a[6];g[3]=a[7];h.invert(g,g);var D=g[0],y=g[1],n=g[2],l=g[3],e=e*d,C=C*d,c=p*d,p=l*e+y*c-n*C,q=l*C+n*e-D*c,I=l*c+D*C-y*e,e=-D*e-y*C-n*c;b[0]=-(p*l+e*-D+q*-n-I*-y);b[1]=-(q*l+e*-y+I*-D-p*-n);b[2]=-(I*l+e*-n+p*-y-q*-D);b[3]=d;b[4]=D;b[5]=y;b[6]=n;b[7]=l;return b};a.kt=function(a,b){var d=q.rg(a,p),h=q.ul(a),C=q.re(a,g);e(d,h,
C,b);return b};a.multiply=function(a,d,e){b(d,a,e);e[3]=a[3]*d[3];var h=a[4],g=a[5],p=a[6];a=a[7];var D=d[4],y=d[5],n=d[6];d=d[7];e[4]=h*d+a*D+g*n-p*y;e[5]=g*d+a*y+p*D-h*n;e[6]=p*d+a*n+h*y-g*D;e[7]=a*d-h*D-g*y-p*n;return e};a.Nj=b;a.km=function(a,b,d,e){e||(e=0);var h=a.length,g=b[0],p=b[1],y=b[2],n=b[3],l=b[4],c=b[5],q=b[6];b=b[7];for(var I=0;I<h;I+=3){var x=a[I]*n,B=a[I+1]*n,E=a[I+2]*n,K=b*x+c*E-q*B,k=b*B+q*x-l*E,u=b*E+l*B-c*x,x=-l*x-c*B-q*E;d[e+I]=K*b+x*-l+k*-q-u*-c;d[e+I+1]=k*b+x*-c+u*-l-K*-q;
d[e+I+2]=u*b+x*-q+K*-c-k*-l;d[e+I]+=g;d[e+I+1]+=p;d[e+I+2]+=y}};a.fx=function(a,b,d,e){e||(e=0);var h=a.length,g=b[3],p=b[4],y=b[5],n=b[6];b=b[7];for(var l=0;l<h;l+=3){var c=a[l]*g,q=a[l+1]*g,I=a[l+2]*g,x=b*c+y*I-n*q,B=b*q+n*c-p*I,E=b*I+p*q-y*c,c=-p*c-y*q-n*I;d[e+l]=x*b+c*-p+B*-n-E*-y;d[e+l+1]=B*b+c*-y+E*-p-x*-n;d[e+l+2]=E*b+c*-n+x*-y-B*-p}};a.jm=function(a,b,d){var e=b[3],h=b[4],g=b[5],p=b[6];b=b[7];var y=a[0]*e,n=a[1]*e,l=a[2]*e;a=b*y+g*l-p*n;var e=b*n+p*y-h*l,c=b*l+h*n-g*y,y=-h*y-g*n-p*l;d[0]=
a*b+y*-h+e*-p-c*-g;d[1]=e*b+y*-g+c*-h-a*-p;d[2]=c*b+y*-p+a*-g-e*-h};a.gx=function(a,b,d,e){e||(e=0);var h=a.length,g=b[3],p=b[4],y=b[5],n=b[6];b=b[7];for(var l=0;l<h;l+=4){var c=a[l]*g,q=a[l+1]*g,I=a[l+2]*g,x=b*c+y*I-n*q,B=b*q+n*c-p*I,E=b*I+p*q-y*c,c=-p*c-y*q-n*I;d[e+l]=x*b+c*-p+B*-n-E*-y;d[e+l+1]=B*b+c*-y+E*-p-x*-n;d[e+l+2]=E*b+c*-n+x*-y-B*-p;d[e+l+3]=a[l+3]}};a.translate=function(a,b,d){var e=a[3],h=a[4],g=a[5],p=a[6],y=a[7],n=b[0]*e,l=b[1]*e,c=b[2]*e;b=y*n+g*c-p*l;var e=y*l+p*n-h*c,q=y*c+h*l-g*
n,n=-h*n-g*l-p*c;d[0]=a[0]+b*y+n*-h+e*-p-q*-g;d[1]=a[1]+e*y+n*-g+q*-h-b*-p;d[2]=a[2]+q*y+n*-p+b*-g-e*-h;d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];return d};a.YK=function(a,b,e,g){g||(g=new Float32Array(8));d.lerp(a.subarray(0,3),b.subarray(0,3),e,g.subarray(0,3));var p=a[3];g[3]=p+e*(b[3]-p);h.slerp(a.subarray(4),b.subarray(4),e,g.subarray(4));return g};a.EJ=function(a,b,d,e){e||(e=new Float32Array(8));var g=a.subarray(0,3),p=b.subarray(0,3),q=e.subarray(0,3);q[0]=p[0]*(d+1)-g[0]*d;q[1]=p[1]*
(d+1)-g[1]*d;q[2]=p[2]*(d+1)-g[2]*d;e[3]=b[3]*(d+1)-a[3]*d;a=a.subarray(4);b=b.subarray(4);g=e.subarray(4);g[0]=b[0]*(d+1)-a[0]*d;g[1]=b[1]*(d+1)-a[1]*d;g[2]=b[2]*(d+1)-a[2]*d;g[3]=b[3]*(d+1)-a[3]*d;h.normalize(g,g);return e};a.iD=function(a,b,d,e,g){var p=a.subarray(0,3),q=g.subarray(0,3);q[0]=p[0]+b*d[0];q[1]=p[1]+b*d[1];q[2]=p[2]+b*d[2];g[3]=a[3];a=a.subarray(4);g=g.subarray(4);d=e[0];p=e[1];e=e[2];var q=a[0],y=a[1],n=a[2],l=a[3];g[0]=.5*(d*l+p*n-e*y);g[1]=.5*(p*l+e*q-d*n);g[2]=.5*(e*l+d*y-p*q);
g[3]=.5*(-d*q-p*y-e*n);g[0]=a[0]+g[0]*b;g[1]=a[1]+g[1]*b;g[2]=a[2]+g[2]*b;g[3]=a[3]+g[3]*b;h.normalize(g,g)}};b4w.module.__extensions=function(a,w){function e(a){if(a in d)return d[a];var e=q.getExtension(a)||null;d[a]=e;b.log("%cGET EXTENSION","color: #"+(e?"0a0":"a00"),a);return e}var b=w("__print"),q=null,d={};a.Bc=function(a){q=a};a.Rt=function(){return e("WEBGL_compressed_texture_s3tc")||e("WEBKIT_WEBGL_compressed_texture_s3tc")||e("MOZ_WEBGL_compressed_texture_s3tc")};a.yC=function(){return e("WEBGL_depth_texture")||e("WEBKIT_WEBGL_depth_texture")||e("MOZ_WEBGL_depth_texture")};a.mC=function(){return e("EXT_texture_filter_anisotropic")||
e("WEBKIT_EXT_texture_filter_anisotropic")||e("MOZ_EXT_texture_filter_anisotropic")};a.xC=function(){return e("WEBGL_debug_shaders")};a.Qt=function(){return e("WEBGL_debug_renderer_info")};a.Ct=function(){return e("OES_element_index_uint")};a.NC=function(){return e("OES_standard_derivatives")};a.Y=function(){d={}}};b4w.module.__scenes=function(a,w){function e(){if(!jb)for(var a=0;a<Ba.length;a++){var b=Ba[a];if(!b.Vd.length){jb=b;break}}return jb}function b(){if(!Ia)throw"No active scene available";return Ia}function q(a,b,f,c){for(var d=null,e=0;e<b.length;e++){var k=b[e];if((f?k.origin_name:k.name)==a&&k.d.vd==c){d=k;break}}return d}function d(a,b){b||(b="ALL");var f=[];h(a.objects,b,f);return f}function h(a,b,f){for(var c=0;c<a.length;c++){var d=a[c];"ALL"!=b&&b!=d.type||f.push(d);(d=d.dupli_group)&&h(d.objects,
b,f)}}function p(b){if("NONE"==qa.hf||!b.b4w_render_shadows)return!1;var f=!1,c=!1;if(0==S(b,"LAMP",a.O).length)return!1;b=S(b,"MESH",a.O);for(var d=0;d<b.length;d++){var e=b[d];e.b4w_shadow_cast&&(f=!0);e.b4w_shadow_receive&&(c=!0);if(f&&c)return!0}return!1}function g(a){if(!a.ua)return!1;a=a.ua.LAMP;for(var b=0;b<a.length;b++)if("SUN"==a[b].Ya.type)return!0;return!1}function v(a){if(!qa.Uh)return!1;a=A(a);for(var b=0;b<a.length;b++){var f=a[b];if(f.b4w_water&&f.b4w_water_shore_smoothing)return!0}return!1}
function m(b){var f=A(b),c=[];b=S(b,"MESH",a.O);for(var d=0;d<f.length;d++){var e=f[d];if(e.b4w_water){for(var k={},H=0;H<b.length;H++)for(var r=b[H],u=r.data.materials,l=0;l<u.length;l++)u[l]==e&&(k.xf=r.location[1]);if(qa.Lk)for(k.ac=e.b4w_water_fog_color.slice(0),k.ac.push(e.b4w_water_fog_density),e.b4w_water_dynamic?(k.qh=!0,k.waves_height=e.b4w_waves_height,k.waves_length=e.b4w_waves_length,k.dst_noise_scale0=e.b4w_water_dst_noise_scale0,k.dst_noise_scale1=e.b4w_water_dst_noise_scale1,k.dst_noise_freq0=
e.b4w_water_dst_noise_freq0,k.dst_noise_freq1=e.b4w_water_dst_noise_freq1,k.dir_min_shore_fac=e.b4w_water_dir_min_shore_fac,k.dir_freq=e.b4w_water_dir_freq,k.dir_noise_scale=e.b4w_water_dir_noise_scale,k.dir_noise_freq=e.b4w_water_dir_noise_freq,k.dir_min_noise_fac=e.b4w_water_dir_min_noise_fac,k.dst_min_fac=e.b4w_water_dst_min_fac,k.waves_hor_fac=e.b4w_water_waves_hor_fac):(k.qh=!1,k.waves_height=0,k.waves_length=0),k.wk=null,k.kn=null,k.ln=new Float32Array(2),k.dm=null,e=e.texture_slots,H=0;H<e.length;H++)r=
e[H].texture,"VORONOI"==r.type&&(k.wk=r.noise_scale,k.ln.set([.3,.7]),k.kn=r.noise_intensity),!0===r.b4w_shore_dist_map&&(k.dm=r.image,k.Vh=r.image.size[0],k.mF=r.b4w_shore_boundings,k.Hh=r.b4w_max_shore_dist);else k.waves_height=0,k.waves_length=0,k.wk=null,k.kn=null,k.ln=null,k.ac=null,k.qh=!1;c.push(k)}}if(0<c.length){k=c[0];if(!k.qh)for(d=0;d<c.length;d++)c[d].qh&&(k=c[d]);return k}return null}function t(a){function b(a){if(a){a=a.nodes;for(var c=0;c<a.length;c++){var d=a[c];"GROUP"==d.type&&
d.node_group&&b(d.node_group.node_tree);"GROUP"==d.type&&"B4W_REFRACTION"==d.node_tree_name&&(f.fd=!0)}}}var f={};a=A(a);for(var c=0;c<a.length;c++){var d=a[c];d.b4w_refractive&&(f.fd=!0);d.node_tree&&b(d.node_tree)}return f}function z(b){if(!qa.Ql||!b.b4w_render_reflections)return!1;var f=[];b=S(b,"MESH",a.O);for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_reflective){var e;a:{d=d.constraints;for(e=0;e<d.length;e++){var k=d[e];if("LOCKED_TRACK"==k.type&&"REFLECTION PLANE"==k.name){e=k.target;break a}}e=
null}e&&(d=e.location,e=e.d.quat,k=new Float32Array(4),va.WF(d,e,va.ta,k),f.push(k))}}return f}function C(a,b){var f={},c=a.world.b4w_sky_settings;f.procedural_skydome=c.procedural_skydome&&b;f.use_as_environment_lighting=c.use_as_environment_lighting;f.Wh=c.color;f.rayleigh_brightness=c.rayleigh_brightness;f.mie_brightness=c.mie_brightness;f.spot_brightness=c.spot_brightness;f.scatter_strength=c.scatter_strength;f.rayleigh_strength=c.rayleigh_strength;f.mie_strength=c.mie_strength;f.rayleigh_collection_power=
c.rayleigh_collection_power;f.mie_collection_power=c.mie_collection_power;f.mie_distribution=c.mie_distribution;!b&&c.procedural_skydome&&sa.warn("There is no sun on the scene. Procedural sky won't be rendered");return f}function J(a){var b={};a=a.world.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.fD=a.hemisphere;b.Wz=a.blur_depth;b.Or=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.IE=a.samples;return b}function D(a){var b={};a=a.world.b4w_bloom_settings;b.blur=
a.blur;b.wB=a.edge_lum;b.key=a.key;return b}function y(a){var b={};a=a.world.b4w_motion_blur_settings;b.xl=a.motion_blur_decay_threshold;b.yl=a.motion_blur_factor;return b}function n(a){var b={};a=a.world.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function l(a){var b={};a=a.world.b4w_god_rays_settings;b.jD=a.intensity;b.Gh=a.max_ray_length;b.gi=a.steps_per_pass;return b}function c(a){var b={};a=a.world;b.yh=
a.b4w_glow_color;b.el=a.b4w_glow_factor;return b}function M(a){var b=a.world;a=[0,0,0];var f=[0,0,0],c=b.light_settings,d=b.texture_slots;if(c.use_environment_light)if("SKY_COLOR"==c.environment_color||"SKY_TEXTURE"==c.environment_color)a=b.horizon_color.slice(0),f=b.zenith_color.slice(0);else if("PLAIN"==c.environment_color)a=[1,1,1],f=[1,1,1];else throw"Unsupported world environment color"+c.environment_color;b={};b.Pe=c.environment_energy;b.Qc=a;b.Wc=f;b.Xh=d;return b}function I(b){if(!qa.bb)return!1;
var f=!1,c=!1;b=S(b,"MESH",a.O);for(var d=0;d<b.length;d++){for(var e=b[d],k=e.data.materials,H=0;H<k.length;H++)k[H].b4w_terrain&&(f=!0);e=e.particle_systems;for(H=0;H<e.length;H++)k=e[H].settings,"HAIR"==k.type&&k.b4w_dynamic_grass&&(c=!0);if(f&&c)return!0}return!1}function x(b){b=S(b,"MESH",a.O);for(var f=0;f<b.length;f++)if(b[f].d.Dd)return!0;return!1}function B(b){b=S(b,"MESH",a.O);for(var f=0;f<b.length;f++)for(var c=b[f].data.materials,d=0;d<c.length;d++){var e=c[d],k=e.game_settings.alpha_blend;
if(e.b4w_render_above_all&&"OPAQUE"!=k&&"CLIP"!=k)return!0}return!1}function E(b){b=S(b,"EMPTY",a.O);for(var f=0;f<b.length;f++){var c=b[f];if(c.b4w_anchor&&c.b4w_anchor.detect_visibility)return!0}return!1}function K(a,b,f){var c=xa.Mh(a,b);xa.Ae(a,c,function(a,b,c){if(c.Ma){switch(c.M){case "COLOR":case "CUBEMAP":a=b.j.Db;break;case "DEPTH":a=b.j.Nc;break;case "SCREEN":a=null;break;default:throw"Wrong slink";}switch(c.ea){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;
default:if(!a)throw"Connection of SCREEN is forbidden";if(a.wf)throw"Batch texture can't use renderbuffer";ja.bs(f.kc,c.ea)&&W.lk(f,a,c.ea)}}});for(a=0;a<b.na.length;a++){var c=b.na[a],d=b.Ld[a];switch(c.ea){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(d.wf)throw"Batch texture can't use renderbuffer";ja.bs(f.kc,c.ea)&&W.lk(f,d,c.ea)}}}function k(a,b,c,d,e){switch(a.type){case "MAIN_OPAQUE":u(a,b,c,"OPAQUE",d,e);break;case "MAIN_BLEND":u(a,b,
c,"BLEND",d,e);break;case "MAIN_XRAY":u(a,b,c,"XRAY",d,e);break;case "MAIN_REFLECT":for(var k=b.d,H=b.q,l=0;l<H.length;l++){var n=H[l];if(("MAIN"==n.type||"NODES"==n.type||"PARTICLES"==n.type)&&n.Pc){if(!e){r(n,a,b,c,"REFLECT",d);var g=n.tb;ja.B(g,"DISABLE_FOG",0);ja.B(g,"WATER_EFFECTS",0);"special_skydome.glslf"==ja.Ht(g)&&ja.B(g,"REFLECTION_PASS",1);ja.B(g,"SHADOW_SRC","SHADOW_SRC_NONE");ja.B(g,"TEXTURE_NORM",0);F(d,n);W.Rb(n);f(n)}a.o.push({aa:!0,qb:k,n:n})}}break;case "DEPTH":k=b.d;b=b.q;for(H=
0;H<b.length;H++)if(l=b[H],"DEPTH"==l.type&&!l.lc&&!l.Pc){if(!e){var n=l,h=a,g=k,aa=c,m=d,p=n.tb;if(ra.eD(aa,h,"SHADOW_CAST"))if(n.Qb){if("DEPTH"!=qa.hf)throw"Wrong shadows type";ja.B(p,"SHADOW_SRC","SHADOW_SRC_DEPTH");ja.B(p,"SHADOW_DST","SHADOW_DST_MASK");W.Vm(n,m.d.Gd);ra.HC(aa,h)}else ja.B(p,"SHADOW_SRC","SHADOW_SRC_NONE"),ja.B(p,"SHADOW_DST","SHADOW_DST_MASK");else ja.B(p,"SHADOW_SRC","SHADOW_SRC_NONE"),ja.B(p,"SHADOW_DST","SHADOW_DST_NONE");n.bb&&(h=ra.Oa(aa,"GRASS_MAP"))&&P(n,h,g);W.Rb(n);
f(n)}a.o.push({aa:!0,qb:k,n:l});K(c,a,l);N(l)}break;case "SHADOW_CAST":k=!1;H=b.d;b=b.q;l=ra.Oa(c,"GRASS_MAP");for(n=0;n<b.length;n++)if(g=b[n],"DEPTH"==g.type&&g.Pc){k=!0;if(!e){if("DEPTH"!=qa.hf)throw"Wrong shadows type";ja.B(g.tb,"SHADOW_SRC","SHADOW_SRC_NONE");ja.B(g.tb,"SHADOW_DST","SHADOW_DST_DEPTH");g.bb&&l&&P(g,l,H);W.xe(g,"SHADOW_TEX_RES",ja.N(d.d.Gd.csm_resolution));W.Rb(g);f(g)}a.o.push({aa:!0,qb:H,n:g})}k&&R(a,ra.Oa(c,"MAIN_OPAQUE"),a.o,d,!0);break;case "COLOR_PICKING":U(a,b,e);break;
case "COLOR_PICKING_XRAY":U(a,b,e);break;case "GRASS_MAP":c=b.d;d=b.q;for(b=0;b<d.length;b++)k=d[b],"GRASS_MAP"==k.type&&(e||(W.Rb(k),f(k)),a.o.push({aa:!0,qb:c,n:k}),k=a.j,g=c.Za,H=a.cc[0],l=a.cc[1],n=a.cc[2],0==H&&0==l?(H=g.min_y,l=g.max_y):(H=Math.min(H,g.min_y),l=Math.max(l,g.max_y)),g=1E-4*(l-H),a.cc[0]=H-g,a.cc[1]=l+g,ta.Hp(k,n/2,-l,-H,n/2),ta.Th(k));break;case "GLOW_MASK":c=b.d;d=b.q;for(b=0;b<d.length;b++)k=d[b],k.Pc&&"COLOR_ID"==k.type&&(e||(W.xe(k,"USE_GLOW",1),W.Rb(k),f(k)),a.o.push({aa:!0,
qb:c,n:k}));break;case "WIREFRAME":for(d=b.d,b=b.q,k=0;k<b.length;k++)H=b[k],"WIREFRAME"==H.type&&(e||(H.bb&&(l=ra.Oa(c,"GRASS_MAP"))&&P(H,l,d),W.Rb(H),f(H)),a.o.push({aa:!0,qb:d,n:H}),K(c,a,H),N(H))}}function u(a,b,c,d,e,k){for(var H=b.d,u=b.q,l=0;l<u.length;l++){var n=u[l];n.lc||n.jc||n.Pc||"MAIN"!=n.type&&"NODES"!=n.type&&"PARTICLES"!=n.type||"OPAQUE"===d&&n.Ga||!("BLEND"!==d&&"XRAY"!==d||n.Ga&&"XRAY"==d==n.Ce)||(k||(r(n,a,b,c,d,e),F(e,n),W.Rb(n),f(n)),a.o.push({aa:!0,qb:H,n:n}),K(c,a,n),N(n))}a.o.sort(function(a,
b){var f;if(a.n&&b.n){f=a.n.Ga;var c=b.n.Ga;(f=f==c?0:f>c?1:-1)||(f=a.n.yg,c=b.n.yg,f=f==c?0:f>c?1:-1)}else f=0;return f})}function r(a,b,f,c,d,e){var k=f.d;if("OPAQUE"===d)f=ra.Oa(c,"SHADOW_CAST")&&a.Qb?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE";else if("BLEND"===d||"XRAY"===d)if(ra.Oa(c,"SHADOW_CAST")&&a.Qb)switch(qa.hf){case "DEPTH":f="SHADOW_SRC_DEPTH";break;default:throw"Wrong shadows type";}else f="SHADOW_SRC_NONE";else if("REFLECT"===d)f="SHADOW_SRC_NONE";else throw"Wrong main subscene type";d=a.tb;
var H=e.d.Gd;ja.B(d,"SHADOW_SRC",f);W.Vm(a,H);f=b.wg;ja.B(d,"NUM_LIGHTS",f);ja.B(d,"NUM_LFACTORS",0==f%2?f/2:Math.floor(f/2)+1);"special_skydome.glslf"==ja.Ht(d)&&ja.B(d,"REFLECTION_PASS",0);ja.B(d,"SSAO_ONLY",0);b.Xa&&b.md?ja.B(d,"WATER_EFFECTS",1):ja.B(d,"WATER_EFFECTS",0);b.Xa&&b.Lf&&k.Lf?(ja.B(d,"CAUSTICS",1),ja.B(d,"CAUST_SCALE",b.Vr),ja.B(d,"CAUST_SPEED",ja.N(b.Wr,2)),ja.B(d,"CAUST_BRIGHT",b.Ur)):ja.B(d,"CAUSTICS",0);b.Xa&&(ja.B(d,"WAVES_HEIGHT",ja.N(b.yf)),ja.B(d,"WAVES_LENGTH",ja.N(b.Sg)),
ja.B(d,"WATER_LEVEL",ja.N(b.xf)));a.ed&&ra.Oa(c,"MAIN_REFLECT")&&-1===a.Vc.indexOf("u_mirrormap")?ja.B(d,"REFLECTIVE",1):ja.B(d,"REFLECTIVE",0);(H=ra.Oa(c,"SKY"))?a.Jv?(f=H.j.Db,W.lk(a,f,"u_sky")):qa.Ml?(a.qc=H.qc,ja.B(d,"PROCEDURAL_FOG",1)):ja.B(d,"PROCEDURAL_FOG",0):ja.B(d,"PROCEDURAL_FOG",0);if("SKY_TEXTURE"==e.world.light_settings.environment_color){f=null;if(e.d.Qp.procedural_skydome&&e.world.b4w_sky_settings.use_as_environment_lighting)f=H.j.Db;else for(H=0;H<b.Xh.length;H++)if(b.Xh[H].texture.b4w_use_as_environment_lighting){f=
W.oC(b.Xh[H],!1);break}f?(ja.B(d,"SKY_TEXTURE",1),W.lk(a,f,"u_sky_texture")):sa.warn("environment lighting is set to 'Sky Texture', but there is no world texture with environment map")}a.bb&&(f=ra.Oa(c,"GRASS_MAP"))&&P(a,f,k);a.sp?"NODES"==a.type?(ja.B(d,"REFRACTIVE",1),e.d.fd?ja.B(d,"USE_REFRACTION",1):ja.B(d,"USE_REFRACTION",0)):e.d.fd?ja.B(d,"REFRACTIVE",1):ja.B(d,"REFRACTIVE",0):(ja.B(d,"REFRACTIVE",0),ja.B(d,"USE_REFRACTION",0));a.Rg&&(a.Cx&&ra.Oa(c,"DEPTH")?ja.B(d,"SHORE_SMOOTHING",1):ja.B(d,
"SHORE_SMOOTHING",0),a.water_dynamic&&b.Xa&&b.yf?ja.B(d,"DYNAMIC",1):ja.B(d,"DYNAMIC",0));"PARTICLES"==a.type&&(ja.B(d,"SIZE_RAMP_LENGTH",a.xv),ja.B(d,"COLOR_RAMP_LENGTH",a.ov));if(!a.Pc)for(b=a.X,c=0;c<b.length;c++)if(f=b[c],"SCENE"==f.source)for(k=0;k<Ba.length;k++)for(var H=Ba[k],r=Ba[k].Vd,u=0;u<r.length;u++)r[u].d==f&&xa.m(Nb,H,e,null);if(a.Dh){b=0;for(var l in a.Dh)b++;a.Io=new Float32Array(3*b);a.Go=new Float32Array(3*b);a.Fo=new Float32Array(3*b);a.Ho=new Float32Array(4*b);ja.B(d,"NUM_LAMP_LIGHTS",
b);for(c=0;c<e.ua.LAMP.length;c++)L(a,e.ua.LAMP[c])}}function L(a,b){var f=b.uuid;if(f in a.Dh){f=a.Dh[f];a.Io.set(b.d.g,3*f);a.Go.set(b.Ya.direction,3*f);a.Fo.set(b.Ya.hh,3*f);var c=Vb,d=b.Ya;c[0]=-1;c[1]=-1;c[2]=-1;c[3]=d.uf?1:0;switch(d.type){case "POINT":c[2]=d.distance;break;case "SPOT":c[2]=d.distance;var e=c[0]=Math.cos(d.ye/2);c[1]=d.ai*(1-e)}a.Ho.set(c,4*f)}}function F(b,f){var c=S(b,"LAMP",a.O);f.tb.Lo=[];for(var d=ea(c)||c[0],e=0;e<c.length;e++){var k=c[e].Ya;if("SPOT"==k.type)var H=Math.cos(k.ye/
2),r=k.ai*(1-H);var u=k.index;f.tb.Lo.push({type:k.type,index:u,yD:Math.floor(u/2),xD:0==u%2?"rg":"ba",ye:H,ai:r,distance:k.distance,tD:k.Kg||k.uf,XB:u==d.Ya.index})}}function f(a){var b=a.kc.attributes,f=a.$a.tj,c;for(c in b)f[c]||va.sa('missing data for "'+c+'" attribute');if("MAIN"==a.type||"NODES"==a.type)b=ja.RC(a.kc.yx),10<b&&("MAIN"==a.type&&sa.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.Fh.join(", ")+'"'),"NODES"==a.type&&(c=f=0,a.Ng&&(f=va.je(a.Ng)),a.gb&&(c=va.je(a.gb)),
sa.warn("Varying limit exceeded for node shader - "+b+", uv: "+f+", vc: "+c+', materials: "'+a.Fh.join(", ")+'"')))}function N(a){8<a.X.length&&sa.warn("too many textures used - "+a.X.length+' (max 8), materials "'+a.Fh.join(", ")+'"')}function P(a,b,f){a.cc=b.cc;var c=b.cc[0],d=b.cc[1],e=b.cc[2];f=f.Ub;f=Math.max(f.max_x-f.min_x,f.max_z-f.min_z);e=0==e?f:Math.max(e,f);b.cc[2]=e;b=b.j;ta.Hp(b,e/2,-d,-c,e/2);ta.Th(b);c=a.oo||0;c=0==c?f:Math.max(c,f);a.oo=c}function V(a){var b=ca(a,"MAIN_OPAQUE"),f=
!0;xa.U(a.d.Ab,function(c,d){"SHADOW_CAST"===d.type&&(R(d,b,d.o,a,f),f=!1)})}function R(b,f,c,d,e){if(0!=c.length){var k=b.j;f=f.j;var H=S(d,"LAMP",a.O),H=ea(H)||H[0],r=H.d;ta.Cw(k,r.g,r.quat);Ga.copy(f.Re,k.Re);za.copy(f.pa,k.Hw);if("SPOT"==H.Ya.type||"POINT"==H.Ya.type)ta.Th(k,k.jb);else{H=Fb;ba.Qd(H);for(r=0;r<c.length;r++){var u=c[r].qb;0==r?ba.ts(u.Za,H):ba.Ws(H,u.Za)}c=ba.HB(H,La);va.bf(c,k.pa,c);if(d.d.Gd.enable_csm){d=Ga.copy(f.Hi[b.Bn],hb);H=za.invert(f.pa,qb);va.bf(d,H,d);va.bf(d,k.pa,d);
b=f.Cn[b.Bn];if(e)for(Ob=0,e=2;e<c.length;e+=3)Ob=Math.min(Ob,c[e]);e=Fb;e.max_x=d[0]+b;e.max_y=d[1]+b;e.max_z=0;e.min_x=d[0]-b;e.min_y=d[1]-b;e.min_z=Ob}else{b=e=Fb;f=ya;f.set(c);d=Gb/9;c=za.identity(qb);za.rotate(c,d,va.Bf,c);r=H=-1;for(u=0;10>u;u++){var l=ba.Rz(f,wb),n=(l.max_x-l.min_x)*(l.max_y-l.min_y);if(-1==H||n<H)H=n,r=u,ba.ts(l,b);va.bf(f,c,f)}b=r*d;0<b&&(f=za.identity(qb),za.rotate(f,b,va.Bf,f),za.multiply(f,k.pa,k.pa));b=e.max_x-e.min_x;f=e.max_y-e.min_y;b&&f&&(d=Math.abs(b-f)/2,2<b/f?
(e.max_y+=d,e.min_y-=d):2<f/b&&(e.max_x+=d,e.min_x-=d));e.max_x+=.005;e.max_y+=.005;e.max_z+=.005;e.min_x-=.005;e.min_y-=.005;e.min_z-=.005}ta.XE(k,e.min_x,e.max_x,e.min_y,e.max_y,-e.max_z,-e.min_z);ta.Th(k)}va.$s(k.Qg,k.$n)}}function ea(a){for(var b=0;b<a.length;b++){var f=a[b];if(f.data.b4w_generate_shadows)return f}return!1}function U(a,b,c){var d=b.d;b=b.q;for(var e="COLOR_PICKING_XRAY"==a.type,k=0;k<b.length;k++){var H=b[k];H.Ce!=e||H.Pc||"COLOR_ID"!=H.type||(c||(W.xe(H,"USE_GLOW",0),W.Rb(H),
f(H)),a.o.push({aa:!0,qb:d,n:H}))}}function X(a,b){for(var f=da(b,cc),c=a.Ya,d=a.d,e=c.index,k=0;k<f.length;k++){var H=f[k];H.ng.set(d.g,3*e);H.lg.set(c.direction,3*e);H.kg.set(c.hh,3*e);switch(c.type){case "SUN":if(H.bx.set(d.quat),H.ax=c.hh,"SKY"===H.type){var r=hb;r[0]=r[1]=r[2]=1;var u=Math.acos(Ga.dot(H.gm,r)),r=Math.acos(Ga.dot(c.direction,r));H.Al=Math.floor(u/.025)!=Math.floor(r/.025)?!0:!1;Ga.copy(c.direction,H.gm);Q(b,H)}else Ga.copy(c.direction,H.gm);case "HEMI":case "POINT":case "SPOT":break;
default:sa.error("unknown light type: "+c.type)}u=xb;u[0]=c.Kg?1:0;u[1]=c.uf?1:0;H.mg.set(u,2*e);H.Ja=!0;for(u=0;u<H.o.length;u++)r=H.o[u].n,r.Dh&&L(r,a)}}function Q(a,b){Oa.Ni(b);if(b.Al)for(var f=da(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY"]),c=0;c<f.length;c++)for(var d=f[c].o,e=0;e<d.length;e++){var k=d[e];k.aa&&(k=k.n,W.hA(k)&&Oa.bG(k))}}function S(b,f,c){if(!b.ua)throw"Access to uninitialized scene";b=b.ua[f];if(c==a.O)return b;f=[];for(var d=0;d<b.length;d++){var e=b[d];e.d.vd==c&&f.push(e)}return f}
function A(b){var f=[];b=S(b,"MESH",a.O);for(var c=0;c<b.length;c++)for(var d=b[c].data,e=0;e<d.materials.length;e++){var k=d.materials[e];-1==f.indexOf(k)&&f.push(k)}return f}function ka(a,b,f){for(var c=a.d,d=a.camera.d.K,e=0;e<d.length;e++){var k=d[e];ta.Th(k,b/f);c.zp&&ta.mq(k,c.Gd)}c.zp&&(c.Bl=!0,ca(a,"DEPTH").Ja=!0,ca(a,"MAIN_BLEND").Ja=!0);ta.mx(a.camera);ra.XF(c.Ab,function(c,d,e){if(c.pi){var k=c.mf*b,H=c.mf*f;if(d)for(d=0;d<e.na.length;d++)e.na[d]==c&&Ya.resize(c.oa,k,H);else Ya.gj(c.oa)&&
Ya.resize(c.oa,k,H),c=e.j,c.width=k,c.height=H,"DOF"==e.type&&Z(a,{dof_power:e.j.dof_power,dof_on:e.j.dof_on}),fa(e,1/b,1/f)}})}function fa(a,b,f){a=a.o;for(var c=0;c<a.length;c++){var d=a[c].n;d&&W.Jj(d,b,f)}}function da(a,b){for(var f=[],c=0;c<b.length;c++){var d=b[c];xa.U(a.d.Ab,function(a,b){b.type==d&&f.push(b)})}return f}function ca(a,b){return ra.Oa(a.d.Ab,b)}function Z(a,b){var f=ca(a,"DOF");if(!f)return sa.error("DOF is not enabled on scene. Check camera settings"),0;var c=a.d.Ab;"boolean"==
typeof b.dof_on&&(f.j.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(f.j.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(f.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(f.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){f.j.dof_power=b.dof_power;for(var d=ra.yb(c,f,"POSTPROCESSING"),c=ra.yb(c,d,"POSTPROCESSING"),d=[d,c],c=0;c<d.length;c++){var e=d[c].o[0].n;e&&(W.Hg(e,f.j.dof_power),fa(d[c],1/f.j.width,1/f.j.height))}}f.Ja=!0}function oa(a,b){var f=ca(Ia,
"MAIN_OPAQUE");if(!f||!f.Xa)return sa.error("get_water_surface_level() - no water parameters on this scene"),0;var c=f.yf,d=f.Sg,e=f.xf,k=f.Xa;if(!c||!k.qh)return k.xf;var H=Ga.length(f.Uj),r=f.time;H&&(r*=H);var u=xb;u[0]=20/d*(a-.25*r);u[1]=20/d*(b-.25*r);H=va.Xr(u);u[0]=17/d*(b+.1*r);u[1]=17/d*(a+.1*r);var u=va.Xr(u),H=H+u-1,l=k.dst_noise_scale0,u=k.dst_noise_scale1,n=k.dst_noise_freq0,g=k.dst_noise_freq1,h=xb;h[0]=l*(a+n*r);h[1]=l*(b+n*r);l=va.Sp(h);h[0]=u*(b-g*r);h[1]=u*(a-g*r);u=va.Sp(h);u*=
c*l;if(f.rm)if(g=(a-f.jf[0])/f.kf[0],h=(f.jf[1]+b)/f.kf[1],g+=.5,h+=.5,1<g||0>g||1<h||0>h)c=u;else var g=va.vt(Ia.d.Mp,f.Vh,g,h),l=k.dir_freq,aa=k.dir_noise_scale,m=k.dir_noise_freq,n=k.dir_min_noise_fac,h=k.dst_min_fac,f=d/f.Hh/Math.PI,aa=[aa/d*(a+m*r),aa/d*(b+m*r)],d=Math.sqrt(g),c=c*Math.max(g,k.dir_min_shore_fac)*Math.sin(d/f+l*r)*Math.max(va.Sp(aa),n),k=Math.max(d,h),c=c*(1-k)+u*k,H=H*g;else c=u;return e+(c+.05*H)}function la(a,b){a.dj&&"POSTPROCESSING"==a.type&&b.aa!=a.aa&&(a.aa=b.aa);b.aa||
"GLOW"!=a.type||(a.On=0)}function ma(a,b,f,c){var d=xa.nb(a,b);ta.Tl(d.j,f,c);d.Wm=!0;xa.tf(a,b,function(b,d,e){e.Ma&&e.M==f&&ra.qA(e)&&ha(a,b,e.ea,c)});xa.Ae(a,b,function(b,d,e){e.Ma&&e.M==f&&e.M==e.ea&&ma(a,b,f,c)})}function ha(a,b,f,c){a=xa.nb(a,b).o;for(b=0;b<a.length;b++)W.AE(a[b].n,c,f)}function pa(a){var b=ca(a,"GRASS_MAP");if(b){var f=b.j,c=a.camera.d,d=c.g;a=hb;a[0]=0;a[1]=-b.cc[2]/2;a[2]=0;Ga.transformQuat(a,c.quat,a);a[0]+=d[0];a[1]=0;a[2]+=d[2];b=kb;b[0]=0;b[1]=0;b[2]=0;b[3]=1;ta.Cw(f,
a,b)}}function H(a,b){xa.U(a,function(f,c){if("MOTION_BLUR"==c.type){if(!c.na[0]||!c.Ld[0])throw"Wrong MOTION_BLUR subscene";var d=c.na[0],e=c.Ld[0];c.Ld[0]=c.j.Db;xa.tf(a,f,function(b,f,c){c.Ma&&ha(a,b,c.ea,e)});ma(a,f,d.M,e);ha(a,f,d.ea,c.Ld[0]);c.av=Math.exp(-b/c.yl)}})}function aa(b,f){var c=0,d=b.fz;0==d.cq&&(d.cq=f);var e=f-d.cq;if(d.Uv&&e/d.Sc>=d.Uv)a.xk(b);else{e%=d.Sc;if(e<d.hu)switch(d=e/(d.hu/5),e=Math.floor(d),e){case 0:c=(d-e)/2;break;case 1:c=(d-e)/2+.5;break;case 2:c=1;break;case 3:c=
1-(d-e)/2;break;case 4:c=.5-(d-e)/2}b.d.bg=c}}function na(a){xa.U(a.d.Ab,function(a,b){b.Ja=!0})}function Fa(a){if("WIND"==a.field.type){a=a.d;va.ka(a.quat,va.ta,ua);Ga.normalize(ua,ua);Ga.scale(ua,a.Zn,ua);a=Ba;for(var b=0;b<a.length;b++)for(var f=da(a[b],Wb),c=0;c<f.length;c++)f[c].Uj.set(ua)}}var W=w("__batch"),ba=w("__boundings"),ta=w("__camera"),Bb=w("__config"),O=w("__data"),bb=w("__debug"),ga=w("__geometry"),xa=w("__graph"),Ja=w("__hud"),ib=w("__objects");w("__particles");var wa=w("__physics"),
ab=w("__prerender"),Na=w("__primitives"),sa=w("__print"),Oa=w("__renderer"),ra=w("__scenegraph"),mc=w("__sfx"),ja=w("__shaders"),Ya=w("__textures"),va=w("__util"),Ga=w("vec3"),za=w("mat4"),qa=Bb.p,db=Bb.Wd,Aa="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),Ma=["ARMATURE","EMPTY","MESH","SPEAKER"],Cb="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GLOW_MASK WIREFRAME".split(" ");a.YH=Cb;var cc="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),
Kb=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],Wb="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS GLOW_MASK WIREFRAME".split(" "),rb=["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],sb=0,jb=null,Ia=null,Ba=[],Nb=null,Ta=[],lb=0,cb=0,Pb=1,Ra=0,Ua=0,Gb=Math.PI/2;a.Tg=0;a.Gq=1;a.Hq=2;a.O=-1;var xb=new Float32Array(2),hb=new Float32Array(3);new Float32Array(4);var Vb=new Float32Array(4),kb=new Float32Array(4),qb=new Float32Array(16),
La=new Float32Array(24),ya=new Float32Array(24),Fb=ba.Qd(),wb=ba.Qd(),ua=new Float32Array(3),Ob=null;a.Cp=function(a){Ia=a;mc.RE(a)};a.iE=function(a,b){var f=a.d,c=ra.VA(f.Ab);if(a==b){ka(a,lb,cb);for(var d=0;d<c.length;d++)a.d.Eg.push(c[d])}else for(d=a.Vd[0],ka(a,d.d.Ig,d.d.Ig),d=0;d<c.length;d++)b.d.Eg.push(c[d]);c=da(a,Wb);for(d=0;d<c.length;d++)c[d].Uj.set(ua);for(d=0;d<f.Eg.length;d++)"SHADOW_CAST"==f.Eg[d].type&&Oa.Ni(f.Eg[d])};a.Zk=e;a.v=b;a.fa=function(){return Ia?!0:!1};a.Wk=function(a){return a.camera};
a.Vk=function(){return Ba};a.KC=function(){if(1==Ba.length)return Ba;for(var a=[],b=0;b<Ba.length;b++){var f=Ba[b];if(!f.Vd.length){b=xa.Mh(Nb,f);b=xa.Yw(Nb,b,xa.Dq);b=xa.dq(b);xa.U(b,function(b,f){a.push(f)});break}}return a};a.ag=function(b,f,c,d){for(var e=Ba,k=null,H=0;H<e.length;H++){var r=S(e[H],"ALL",a.O);switch(b){case a.Tg:k=q(f,r,!1,c);break;case a.Gq:k=null;(r=q(f,r,!1,d))&&r.dupli_group&&(k=q(c,r.dupli_group.objects,!0,d));break;case a.Hq:for(var k=null,u=0;u<f.length;u++)if((k=q(f[u],
r,0!=u,c))&&k.dupli_group)r=k.dupli_group.objects;else break}if(k)break}return k};a.Bz=function(a,b,f){for(var c in Ma){var e=Ma[c],k=d(a,e),H=b.d.si,r=!1;for(c=0;c<f.length;c++)if(r=!0,f[c].d&&f[c].d.ig){for(var u=0;u<H.length;u++)H[u]==f[c]&&(r=!1);r&&H.push(f[c])}e in b.ua||(b.ua[e]=[]);for(u=0;u<k.length;u++)va.gg(k[u])&&k[u].proxy||(b.ua.ALL.push(k[u]),b.ua[e].push(k[u]))}};a.uz=function(b,f){b.ua={ALL:[]};for(var e in Aa){var k=Aa[e],H=d(b,k);b.ua[k]=[];for(var r=0;r<H.length;r++)va.gg(H[r])&&
H[r].proxy||(b.ua.ALL.push(H[r]),b.ua[k].push(H[r]))}b.Vd=b.Vd||[];b.d=b.d||{};k=b.d;H=b.camera.d;e=b.world.b4w_shadow_settings;r=k.Gd={};e.csm_resolution>qa.Bd?(r.csm_resolution=qa.Bd,sa.error("Shadow map texture has unsupported size. Changed to "+qa.Bd+".")):r.csm_resolution=e.csm_resolution;r.self_shadow_polygon_offset=e.self_shadow_polygon_offset;r.self_shadow_normal_offset=e.self_shadow_normal_offset;r.enable_csm=e.b4w_enable_csm;var u=S(b,"LAMP",a.O);if(u=ea(u)||u[0])r.Jo=u.Ya.type,r.ye=u.Ya.ye,
r.distance=u.Ya.distance,"SPOT"!=r.Jo&&"POINT"!=r.Jo||!r.enable_csm||(sa.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),r.enable_csm=!1);r.enable_csm?(r.csm_num=e.csm_num,r.csm_first_cascade_border=e.csm_first_cascade_border,r.first_cascade_blur_radius=e.first_cascade_blur_radius,r.csm_last_cascade_border=e.csm_last_cascade_border,r.last_cascade_blur_radius=e.last_cascade_blur_radius,r.fade_last_cascade=e.fade_last_cascade,r.blend_between_cascades=e.blend_between_cascades):
(r.csm_num=1,r.csm_first_cascade_border=e.csm_first_cascade_border,r.first_cascade_blur_radius=e.first_cascade_blur_radius,r.csm_last_cascade_border=e.csm_last_cascade_border,r.last_cascade_blur_radius=e.last_cascade_blur_radius,r.fade_last_cascade=!1,r.blend_between_cascades=!1);k.si=[];for(e=0;e<f.length;e++)f[e].d&&f[e].d.ig&&k.si.push(f[e]);e=b.world.b4w_fog_color;k.ac=new Float32Array([e[0],e[1],e[2],b.world.b4w_fog_density]);k.ii=g(b);k.Qp=C(b,k.ii);k.GG=M(b);k.Pu=S(b,"LAMP",a.O).length;k.Xa=
m(b);k.HD=t(b);k.qs=x(b)||qa.force_selectable;k.Ce=B(b);k.oz=E(b);k.hv=0;H.K[0].type!=ta.Ic&&qa.anaglyph_use?(sa.warn("Anaglyph stereo is disabled for the non-perspective camera"),e=!1):e=qa.anaglyph_use;k.anaglyph_use=e;k.zp=qa.Lk&&p(b);k.MJ=b.world.b4w_fog_color;k.Uh=v(b);k.qE=z(b);k.Vz=D(b);k.LD=y(b);k.fA=n(b);k.ZC=l(b);k.WC=c(b);k.ph=qa.ph&&(0<H.dof_distance||H.Tf);k.bb=I(b);k.Jh=qa.Jh&&b.b4w_enable_motion_blur;k.jh=qa.jh&&b.b4w_enable_color_correction;k.antialiasing=qa.antialiasing&&b.b4w_enable_antialiasing;
k.dh=qa.dh&&b.b4w_enable_bloom&&k.ii;k.of=qa.of&&b.b4w_enable_ssao;k.GF=J(b);k.zh=qa.zh&&b.b4w_enable_god_rays&&k.ii;k.fd=qa.fd&&b.b4w_render_refractions;k.glow=qa.glow?k.qs:!1;k.pB=qa.Lk;e=b.Vd.sort(function(a,b){return b.d.Ig-a.d.Ig});k.Ab=ra.UA(k,H,e);k.Eg=[];k.Bl=!1;k.ap=!1;Ba.push(b);Nb||(Nb=xa.create());xa.A(Nb,b)};a.sn=d;a.io=function(a){return a.d.Ab};a.YB=function(a){xa.U(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=W.Cs(c.vj);break;case "SSAO":d=W.aB(c);break;case "SSAO_BLUR":d=
W.bB(c);W.Jj(d,1/c.j.width,1/c.j.height);break;case "DEPTH_PACK":d=W.LA();break;case "REFRACT":case "COPY":d=W.Cs("NONE");break;case "GOD_RAYS":ra.yb(a,c,"WIREFRAME")||ra.yb(a,c,"MAIN_BLEND")||ra.yb(a,c,"GOD_RAYS");d=W.OA(c.yv|0,(c.Hb&&c.Rg)|0,c.gi);break;case "GOD_RAYS_COMBINE":ra.yb(a,c,"WIREFRAME")||ra.yb(a,c,"MAIN_BLEND");ra.yb(a,c,"GOD_RAYS");d=W.PA();break;case "MOTION_BLUR":d=W.TA(c.xl);break;case "DOF":d=W.MA();W.Hg(d,c.j.dof_power);for(var e=ra.yb(a,c,"POSTPROCESSING"),k=ra.yb(a,e,"POSTPROCESSING"),
H=[e,k],r=0;r<H.length;r++){var u=H[r].o;(e=u[0].n)&&W.Hg(e,c.j.dof_power)}break;case "GLOW":H=ra.yb(a,c,"POSTPROCESSING");r=ra.yb(a,H,"POSTPROCESSING");e=ra.yb(a,r,"POSTPROCESSING");k=ra.yb(a,e,"POSTPROCESSING");d=W.NA();H=[r,H];for(r=0;r<H.length;r++)u=H[r].o,(u=u[0].n)&&W.Hg(u,c.Pr);H=[k,e];for(r=0;r<H.length;r++)u=H[r].o,(u=u[0].n)&&W.Hg(u,c.Zs*c.el);break;case "COMPOSITING":d=W.JA();break;case "ANTIALIASING":d=W.FA();break;case "LANCZOS":d=W.QA(c.lL);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=
W.ZA(c.type);break;case "ANAGLYPH":d=W.DA();break;case "SKY":d=W.YA();W.Jj(d,1/c.j.width,1/c.j.height);break;case "LUMINANCE":d=W.RA();break;case "AVERAGE_LUMINANCE":d=W.GA();break;case "LUMINANCE_TRUNCED":d=W.SA();break;case "BLOOM_BLUR":d=W.HA(c.vj);W.Jj(d,1/c.j.width,1/c.j.height);break;case "BLOOM":d=ra.yb(a,c,"BLOOM_BLUR");H=[ra.yb(a,d,"BLOOM_BLUR"),d];for(r=0;r<H.length;r++)u=H[r].o,(u=u[0].n)&&W.Hg(u,c.bloom_blur);d=W.IA();break;case "VELOCITY":d=W.eB();break;case "ANCHOR_VISIBILITY":d=W.EA()}d&&
(e={aa:!0,qb:ib.Gk("NONE"),n:d},f(d),c.o.push(e),K(a,c,d),N(d))})};a.Ke=function(a,b,f){switch(b.type){case "MESH":var c=a.d.Ab,d=b.d;!ra.Oa(c,"SHADOW_CAST")&&d.Qb&&(d.Qb=!1);d=da(a,Cb);f&&(wa.D(b)&&wa.Ke(b,a),a.ua.ALL.push(b),a.ua[b.type].push(b),b.ya&&b.ya.Pn.wc&&(b.IL=b.name,b.ya.dupli_group.objects.push(b)));for(var e=0;e<d.length;e++)k(d[e],b,c,a,f);break;case "LAMP":b.Ya.index=a.d.hv++;f=da(a,cc);for(c=0;c<f.length;c++)f[c].wg++;X(b,a)}};a.Vv=function(a){if(!a.d.Do)return!1;var f=b();O.hE(f,
a,!1);var c=f.ua.ALL.indexOf(a);-1!=c&&f.ua.ALL.splice(c,1);c=f.ua[a.type].indexOf(a);-1!=c&&f.ua[a.type].splice(c,1);a.ya&&a.ya.Pn.wc&&(c=a.ya.Pn.wc.indexOf(a),-1!=c&&a.ya.Pn.wc.splice(c,1));return!0};a.dI=k;a.Bp=function(a){a.d.Bl=!0};a.uC=function(a,b){for(var f=a.d.Gd,c=new Float32Array(f.csm_num),d=0;d<f.csm_num;d++)c[d]=ta.fB(f,b,d);return c};a.aj=function(a){a.d.$i=!0};a.Np=function(a){a.d.$i=!1};a.vE=function(a,b,f){b=b.d;a=da(a,Cb);for(var c=0;c<a.length;c++)for(var d=a[c].o,e=d.length-1;0<=
e;e--){var k=d[e];k.qb==b&&(k.n&&f&&ga.hs(k.n.$a),d.splice(e,1))}};a.as=function(a,b){return b.ua[a.type]&&-1<b.ua[a.type].indexOf(a)?!0:!1};a.sF=function(a){var b=a.ua.LAMP;if(b.length==a.d.hv){for(var f=[],c=0;c<b.length;c++)f[b[c].Ya.index]=c;for(c=0;c<f.length-1;c++)for(var d=c+1;d<f.length;d++){var e=b[f[c]].Ya,k=b[f[d]].Ya;if(k.Kg&&k.uf&&(!e.Kg||!e.uf)||!e.Kg&&(k.Kg||!e.uf&&k.uf))e=f[c],f[c]=f[d],f[d]=e}for(c=0;c<f.length;c++)b[f[c]].Ya.index=c,X(b[f[c]],a)}};a.hG=X;a.Y=function(){for(var a=
0;a<Ba.length;a++){var b=Ba[a];xa.U(b.d.Ab,function(a,b){if("SINK"!=b.type){var f=b.j;Oa.xE(f.he,f.Db,f.Nc,f.width,f.height);for(var f=b.o,c=0;c<f.length;c++){var d=f[c].n;d&&W.uA(d)}}});b.d.Ab=[];b.d.Eg=[]}Ia=jb=null;Ba.length=0;Nb=null;Ta.length=0;ua[0]=0;ua[1]=0;ua[2]=0};a.Yu=function(a,b,f){a=ta.IB(a,a.Ra,a.cb,null,!0);var c=Na.cC(a);a=ib.Gk("DYNAMIC");a.Za=a.Ub={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.Cb=a.Zc=ba.Tz();var d=a.Cb.Ca;a.Kf=a.Jf=ba.wn([d,0,0],[0,d,
0],[0,0,d],a.Cb.C);f=W.XA(c,f);b.o.push({aa:!0,qb:a,n:f})};a.zb=S;a.BK=function(a){return[a.frame_start,a.frame_end]};a.Fw=function(a,b,f,c,d){lb=a;cb=b;Pb=f;Ra=d;Ua=c;Ia&&ka(Ia,a,b)};a.Jj=fa;a.MF=da;a.ja=ca;a.Dt=function(a){a=da(a,cc)[0];var b=a.Qc,f=a.Wc,c=[],d=[];c[0]=b[0];c[1]=b[1];c[2]=b[2];d[0]=f[0];d[1]=f[1];d[2]=f[2];return[a.Pe,c,d]};a.ow=function(a,b,f,c){a=da(a,cc);for(var d=0;d<a.length;d++){var e=a[d];isNaN(b)||(e.Pe=b);f&&e.Qc.set(f);c&&e.Wc.set(c);e.Ja=!0}};a.Vt=function(a){if(a=ca(a,
"SKY")){var b={};b.color=Array(3);Ga.copy(a.Wh,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=
a.mie_distribution;return b}return null};a.vw=function(a,b){var f=ca(a,"SKY");f&&("number"==typeof b.procedural_skydome&&(f.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(f.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&f.Wh.set(b.color),"number"==typeof b.rayleigh_brightness&&(f.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(f.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&
(f.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(f.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(f.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(f.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(f.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(f.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(f.mie_distribution=
b.mie_distribution),f.Ja=!0,f.Al=!0,Q(a,f))};a.It=function(a,b){var f=b||[],c=da(a,Kb)[0].ac;f[0]=c[0];f[1]=c[1];f[2]=c[2];f[3]=c[3];return f};a.qw=function(a,b){for(var f=da(a,Kb),c=0;c<f.length;c++){var d=f[c];d.ac.set(b);d.Ja=!0}};a.Xt=function(a){var b=ca(a,"SSAO");a=ca(a,"SSAO_BLUR");if(!b)return null;var f=b.o[0].n,c={};c.ssao_quality=W.eo(f,"SSAO_QUALITY")[1];c.ssao_hemisphere=b.ssao_hemisphere;c.ssao_blur_depth=a.ssao_blur_depth;c.Or=a.ssao_blur_discard_value;c.radius_increase=b.di;c.influence=
b.ci;c.dist_factor=b.bi;c.ssao_only=b.ssao_only;c.ssao_white=W.eo(f,"SSAO_WHITE")[1];return c};a.xw=function(a,b){var f=ca(a,"SSAO"),c=ca(a,"SSAO_BLUR");if(!f)return sa.error("SSAO is not enabled on scene"),0;if("string"==typeof b.ssao_quality){var d=f.o[0].n;W.xe(d,"SSAO_QUALITY",b.ssao_quality);W.Rb(d,!0)}"number"==typeof b.ssao_hemisphere&&(d=f.o[0].n,W.xe(d,"SSAO_HEMISPHERE",b.ssao_hemisphere),W.Rb(d,!0));"number"==typeof b.ssao_blur_depth&&(d=c.o[0].n,W.xe(d,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),
W.Rb(d,!0));"number"==typeof b.ssao_blur_discard_value&&(c.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.di&&(f.di=b.di);"number"==typeof b.ci&&(f.ci=b.ci);"number"==typeof b.bi&&(f.bi=b.bi);if("number"==typeof b.ssao_only){f=ca(a,"MAIN_OPAQUE");f.ssao_only=b.ssao_only;for(var e=0;e<f.o.length;e++)d=f.o[e].n,W.xe(d,"SSAO_ONLY",b.ssao_only),W.Rb(d,!0)}"number"==typeof b.ssao_white&&(d=f.o[0].n,W.xe(d,"SSAO_WHITE",b.ssao_white),W.Rb(d,!0));f.Ja=!0;c.Ja=!0};a.At=function(a){a=
ca(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=a.j.dof_front;b.dof_rear=a.j.dof_rear;b.dof_power=a.j.dof_power;return b};a.nw=Z;a.Jt=function(a){var b=da(a,["GOD_RAYS"]);a=ca(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var f={};f.god_rays_max_ray_length=b[0].Gh;f.god_rays_intensity=a.god_rays_intensity;f.god_rays_steps=W.eo(b[0].o[0].n,"STEPS_PER_PASS")[1];return f};a.rw=function(a,b){var f=da(a,["GOD_RAYS"]),c=ca(a,"GOD_RAYS_COMBINE");if(!f||!c)return sa.error("God Rays are not enabled on scene"),
0;"number"==typeof b.god_rays_intensity&&(c.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var d=b.god_rays_max_ray_length,e=0;e<f.length;e++)f[e].Gh=d,f[e].Ol=d/f[e].gi/(e+1),f[e].Ja=!0;if("number"==typeof b.god_rays_steps)for(var k=ja.N(b.god_rays_steps,1),d=f[0].Gh,e=0;e<f.length;e++){f[e].gi=k;f[e].Ol=d/k/(e+1);f[e].Ja=!0;var H=f[e].o[0].n;W.xe(H,"STEPS_PER_PASS",k);W.Rb(H,!0)}c.Ja=!0};a.xt=function(a){var b=ca(a,["LUMINANCE_TRUNCED"]);a=ca(a,"BLOOM");
if(!b||!a)return null;var f={};f.bloom_key=b.bloom_key;f.bloom_edge_lum=b.bloom_edge_lum;f.bloom_blur=a.bloom_blur;return f};a.fw=function(a,b){var f=ca(a,"LUMINANCE_TRUNCED"),c=ca(a,"BLOOM");if(!f||!c)return sa.error("Bloom is not enabled on scene"),0;"number"==typeof b.bloom_key&&(f.bloom_key=b.bloom_key,f.Ja=!0);"number"==typeof b.bloom_edge_lum&&(f.bloom_edge_lum=b.bloom_edge_lum,f.Ja=!0);if("number"==typeof b.bloom_blur)for(var d=a.d.Ab,f=ra.yb(d,c,"BLOOM_BLUR"),d=ra.yb(d,f,"BLOOM_BLUR"),f=[f,
d],d=0;d<f.length;d++){var e=f[d].o[0].n;e&&(W.Hg(e,b.bloom_blur),fa(f[d],1/c.j.width,1/c.j.height))}};a.gu=function(){var a=ua,b=Ga.length(a);if(0==b)return null;var f={};f.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;f.wind_strength=b;return f};a.Ew=function(b,f){for(var c=S(b,"ALL",a.O),d=0;d<c.length;d++){var e=c[d];if("EMPTY"===e.type&&e.field&&"WIND"===e.field.type)var k=e}if(!k)return sa.error("There is no wind on the scene"),0;c=k.d;"number"==typeof f.wind_dir&&(hb=[0,f.wind_dir/180*Math.PI,
-Math.PI/2],va.Qe(hb,kb),c.quat.set(kb),Fa(k));"number"==typeof f.wind_strength&&(c.Zn=f.wind_strength,Fa(k));na(b)};a.ME=function(a){a.d.ap=!0};a.eu=oa;a.du=function(a,b){var f=ca(a,"MAIN_OPAQUE");if(f&&(b.waves_height=f.yf,b.waves_length=f.Sg,f.md)){b.water_fog_density=f.md[3];var c=b.water_fog_color=[];c[0]=f.md[0];c[1]=f.md[1];c[2]=f.md[2]}};a.Dw=function(a,b){var f=ca(a,"MAIN_OPAQUE");if(!f||!f.Xa)return sa.error("set_water_params() - no water parameters on this scene"),null;f=f.Xa;"number"==
typeof b.dst_noise_scale0&&(f.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(f.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(f.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(f.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(f.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(f.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(f.dir_noise_scale=b.dir_noise_scale);"number"==
typeof b.dir_noise_freq&&(f.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(f.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(f.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(f.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(f.qh=b.water_dynamic);for(var c=da(a,rb),d=0;d<c.length;d++){var e=c[d];"number"==typeof b.water_fog_density&&f.ac&&(e.md[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&f.ac&&e.md.set(b.water_fog_color);
"number"==typeof b.waves_height&&(e.yf=b.waves_height);"number"==typeof b.waves_length&&(e.Sg=b.waves_length);e.Ja=!0}};a.Tt=function(a,b){var f=ca(Ia,"MAIN_OPAQUE");if(!f.rm)return 100;var c=f.Hh,d=f.xf,e=(a[0]-f.jf[0])/f.kf[0],k=(f.jf[1]+a[2])/f.kf[1],e=e+.5,k=k+.5;if(1<e||0>e||1<k||0>k)d=1;else return f=c*va.vt(Ia.d.Mp,f.Vh,e,k),d=(d-a[1])*b,d=Math.sqrt(f*f+d*d)};a.update=function(a,f){for(var c=b().camera.d,d=0;d<Ba.length;d++){var e=Ba[d],k=e.d.Ab;if(e.d.Xa)var r=c.g[1]-oa(c.g[0],c.g[2]);for(var u=
e.d.si,l=0;l<u.length;l++){var n=u[l].d,g=n.hb,h=n.th+n.Ha;if(g){var m=Math.round(g.currentTime*n.bc),p=n.Ha/n.bc;if(m<n.Ha-(qa.hg?5:0)||u[l].d.Jg&&m>h)g.currentTime=p;!n.Jg&&m>h&&g.pause();2<=g.readyState&&!g.paused&&Ya.qG(n)}else if(n.Rh){g=Math.min(n.Rh.length,n.th+n.Ha);if(n.we<n.Ha||n.Jg&&n.we>=g)n.we=n.Ha;!n.Jg&&n.we>=g&&(n.Sh=!1);g=Math.round(a*db.La/n.bc)*n.ew;g!=sb&&n.Sh&&(Ya.nG(n),n.we++);sb=g}}xa.U(k,function(b,f){-1<Wb.indexOf(f.type)&&(f.time=a);-1<rb.indexOf(f.type)&&e.d.Xa&&(f.jn=r)})}for(d=
0;d<Ba.length;d++)if(e=Ba[d],l=e.d,c=l.Eg,l.Bl&&(V(e),l.Bl=!1),l.ap&&(pa(e),l.ap=!1),c.length){e.b4w_enable_motion_blur&&H(l.Ab,f);if(l.glow){for(var L=0,d=0;d<e.ua.MESH.length;d++)l=e.ua.MESH[d],L+=l.d.bg,-1!=Ta.indexOf(l)&&aa(l,a);xa.U(e.d.Ab,function(a,b){"GLOW"===b.type&&(b.On=L)})}k=null;for(l=0;l<c.length;l++)"GLOW_MASK"==c[l].type&&(k=l);for(l=0;l<c.length;l++)u=c[l],ab.np(u),null!==k&&la(u,c[k]),Oa.Ni(u)}qa.show_hud_debug_info&&Ja.nF(Ba,f)};a.co=function(a){var b=[];xa.U(a.d.Ab,function(a,
f){b.push(f)});return b};a.Um=function(a,b,f,c){a.fz={cq:0,hu:b,Sc:f,Uv:c};-1==Ta.indexOf(a)&&Ta.push(a)};a.xk=function(a){a.d.bg=0;a=Ta.indexOf(a);-1!=a&&Ta.splice(a,1)};a.UI=function(){Ta=[]};a.yt=function(){var a=ca(Ia,"MAIN_BLEND"),b=Ia;return a||b.d.Xa?a.jn:null};a.Mt=function(a){return a.d.vd};a.qx=na;a.jF=function(a,b){switch(b){case "WM_NONE":a.aa=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var f=0;f<a.o.length;f++)a.o[f].n.wireframe_mode=
bb.gr[b];a.aa=!0}a.Ga="WM_TRANSPARENT_WIREFRAME"==b;a.Ja=!0};a.iF=function(a,b){for(var f=0;f<a.o.length;f++)a.o[f].n.wireframe_edge_color=b,a.Ja=!0};a.nr=function(a,b){for(var f=0;f<b.length;f++)a.ua.ALL.push(b[f]),a.ua.MESH.push(b[f])};a.ox=Fa;a.Ll=function(b,f){var c=e();if(!c)return sa.error("No active scene"),null;var d=ca(c,"COLOR_PICKING");if(d){b-=Ua;f-=Ra;b*=Pb;f*=Pb;ab.np(d);Oa.Ni(d);var k=ca(c,"COLOR_PICKING_XRAY");k?(ab.np(k),Oa.Ni(k),d=k.j):d=d.j;f=d.height-f;d=Oa.Sv(d.he,b,f);c=S(c,
"MESH",a.O);for(k=0;k<c.length;k++){var H=c[k].d.Ck;if(H&&3>Math.abs(255*H[0]-d[0])&&3>Math.abs(255*H[1]-d[1])&&3>Math.abs(255*H[2]-d[2]))return c[k]}}else sa.error("Color picking is not available");return null};a.TC=function(){return ua};a.LC=function(b){var f=[];b=S(b,"MESH",a.O);for(var c=0;c<b.length;c++){var d=b[c];d.d.Dd&&f.push(d)}return f};a.Yi=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};a.ZM=function(){for(var b=
Ia,f=S(b,"MESH",a.O),c=0;c<f.length;c++)for(var d=f[c].q,e=0;e<d.length;e++){var k=d[e];if("MAIN"==k.type||"NODES"==k.type)F(b,k),W.Rb(k)}};a.bu=function(){return Pb}};b4w.module.__batch=function(a,w){function e(a){a={type:a,id:0,wE:0,Nh:"",X:[],Vc:[],Fh:[],Of:[],Ng:null,gb:{},kc:null,tb:null,Gr:[],xc:null,$a:null,Lc:null,Ji:!1,Ls:!1,wireframe_mode:0,fp:0,lj:0,Lu:0,Mu:0,iu:0,oo:0,cc:new Float32Array(3),qc:new Float32Array(16),Ga:!1,ps:!1,Z:!1,Ce:!1,Da:!1,Mg:!1,ee:!1,Cc:!1,lc:!1,Qb:!1,Ac:!1,jc:!1,ed:!1,bb:!1,Jv:!1,de:R.vi,De:R.Td,ni:0,bq:new Float32Array(2),t:new Float32Array(2),Pc:!1,pp:"",HM:"",ju:!1,nu:0,ku:0,ou:0,pu:0,mu:new Float32Array(3),lu:new Float32Array(3),
cg:!1,ah:0,rh:0,Mi:1,Pl:0,Ow:0,Zh:1,Gl:0,Li:0,Ai:1,gv:0,Yo:0,yg:0,Tv:0,ce:Array(2),$h:new Float32Array(3),rf:new Float32Array(3),Kj:new Float32Array(3),Oc:new Float32Array(4),Yf:new Float32Array(4),Dh:null,Io:null,Go:null,Fo:null,Ho:null,Rg:!1,water_dynamic:!1,Cx:!1,Ax:!1,Bx:0,Dx:0,zx:0,vm:.1,Zl:0,cm:0,Sk:0,gt:new Float32Array(2),ft:new Float32Array(2),Xn:new Float32Array(2),Yl:new Float32Array(3),bm:new Float32Array(3),ug:null,sp:!1,tv:0,pv:0,gp:0,sv:0,vv:0,uv:0,qv:0,rv:0,hp:0,mv:0,lv:0,xv:0,ov:0,
El:new Float32Array(3),wv:new Float32Array(8),nv:new Float32Array(16)};a.Oc[3]=1;a.ps=!0;a.Z=!0;a.ni=1;return a}function b(a,b){for(var f=[],c=ka.Oa(b,"SHADOW_CAST"),d=ka.Oa(b,"MAIN_REFLECT"),e=ka.Oa(b,"GLOW_MASK"),r=0;r<a.q.length;r++){var u=a.q[r],l=null;"DEPTH"==u.type&&c&&u.Cc&&(l=q(u));"MAIN"!=u.type&&"NODES"!=u.type&&"PARTICLES"!=u.type||!d||u.Ga||!u.Ac||(l=q(u));"COLOR_ID"==u.type&&e&&(l=q(u));l&&(l.Pc=!0,k(l,a.d.id),f.push(l))}a.q.push.apply(a.q,f)}function q(a){var b=a.$a,f=a.xc;a.$a=null;
a.xc=null;var c=X.CA(a);a.$a=b;c.$a=b;a.xc=f;c.xc=f;return c}function d(a,b,c){for(var d=[],e=0;e<a.length;e++){var k=a[e],r=k.d,u=g(k.data.b4w_bounding_box),l=k.data.b4w_bounding_cylinder_radius,n=k.data.b4w_bounding_sphere_radius,h=k.data.b4w_bounding_sphere_center,m=k.data.b4w_bounding_ellipsoid_axes,L=k.data.b4w_bounding_ellipsoid_center;if(r.Zd){var n=Math.max(Math.abs(u.max_x),Math.abs(u.min_x)),l=Math.max(Math.abs(u.max_y),Math.abs(u.min_y)),v=Math.max(Math.abs(u.max_z),Math.abs(u.min_z)),
v=Math.sqrt(n*n+l*l+v*v),n=Math.sqrt(n*n+l*l);u.max_x=u.max_y=u.max_z=v;u.min_x=u.min_y=u.min_z=-v;l=n;n=v;h[0]=h[1]=h[2]=0;m[0]=m[1]=m[2]=v;L[0]=L[1]=L[2]=0}r.Ub=u;v=f.dn(u,r.R);r.Za=v;var v=r,F=l;v.$m=f.ws(F,u);v.Ym=f.us(l,u);v.Zm=f.vs(F,u);h=f.xn(n,h);r.Zc=h;h=f.fn(h,r.R);r.Cb=h;m=f.wn([m[0],0,0],[0,m[1],0],[0,0,m[2]],L);r.Jf=m;m=f.en(m,r.Be);r.Kf=m;d=d.concat(p(k,r,b,c))}return d}function h(a,b,c,d){for(var e=[],r=[],u={},l=0;l<a.length;l++){var n=a[l],h=n.d,m=g(n.data.b4w_bounding_box),L=f.dn(m,
h.R),v=f.xn(n.data.b4w_bounding_sphere_radius,n.data.b4w_bounding_sphere_center),F=f.fn(v,h.R),x=n.data.b4w_bounding_ellipsoid_axes,x=f.wn([x[0],0,0],[0,x[1],0],[0,0,x[2]],n.data.b4w_bounding_ellipsoid_center),B=f.en(x,h.Be);h.Ub=m;h.Za=L;h.Zc=v;h.Cb=F;h.Jf=x;h.Kf=B;m={};m.Cc=h.Cc;m.lc=h.lc;m.Qb=h.Qb;m.Dd=h.Dd;m.Dl=h.Dl;m.dl=h.dl;m.Ac=h.Ac;m.jc=h.jc;m.ed=h.ed;m.Lf=h.Lf;m.Od=h.Od;m.qe=h.qe;m.Mb=h.Mb;m.Zd=h.Zd;m.Ci=h.Ci;m.bb=h.bb;m.oh=h.oh;m.Mk=h.Mk;m.Ye=h.Ye;m.tg=h.tg;m.vl=h.vl;m.Ad=h.Ad;m.sg=h.sg;
m.wl=h.wl;m.ee=h.ee;L=h.Cb.C;m.$C=0==c?[0,0]:[Math.floor(L[0]/c),Math.floor(L[2]/c)];m.Xe=h.Xe;m.jj=h.jj;m.qg=h.qg;h=JSON.stringify(m);u[h]=u[h]||[];u[h].push(n)}for(var t in u){m=JSON.parse(t);c=u[t];var n=X.Gk("STATIC"),C;for(C in m)n[C]=m[C];n.vd=a[0].d.vd;n.Pd=0;n.zf=0;n.Oe=0;n.Ne=0;n.Le=0;n.$i=!1;for(l=0;l<c.length;l++)h=c[l],0==l?(n.Za=Z.za(h.d.Za),n.Cb=Z.za(h.d.Cb),n.Jf=Z.za(h.d.Jf),n.Kf=Z.za(h.d.Kf)):(f.Ws(n.Za,h.d.Za),f.EB(n.Cb,h.d.Cb));n.Ub=Z.za(n.Za);n.Zc=Z.za(n.Cb);r.push({Zb:n,wc:c})}for(a=
0;a<r.length;a++)for(u=r[a].Zb,l=r[a].wc,t=0;t<l.length;t++){C=l[t];c=p(C,u,b,d);n=K(C.d)||K(u);h={};u.Od&&(h.au_center_pos=[n[0],n[1],n[2]],h.au_wind_bending_amp=[C.d.Pd],h.au_wind_bending_freq=[C.b4w_wind_bending_freq],h.au_detail_bending_amp=[C.b4w_detail_bending_amp],h.au_detail_bending_freq=[C.b4w_detail_bending_freq],h.au_branch_bending_amp=[C.b4w_branch_bending_amp]);for(m=0;m<c.length;m++)F=c[m].Zb,L=c[m].Ec,v=c[m].n,F.ol?F.Zd?R.JF(L,n):R.Zw(L,n):("COLOR_ID"==v.type?(F=c[m].Zb=C.d,F.type=
"DYNAMIC",v.Nh=C.uuid,M(v,F),k(v,Z.eh(F,0))):L=R.Zw(L,n),R.IF(L,h));e=e.concat(c)}return e}function p(a,b,f,c){for(var d=[],r=v(f,b),u=Z.eh(b,0),l=a.data,n=l.materials,h=0;h<r.length;h++){var g=r[h];if(!a.b4w_do_not_render||"PHYSICS"==g)for(var p=0;p<n.length;p++){var L=n[p];if(("LENS_FLARES"!=L.name||0!=c)&&!R.su(l,p)){var F=e(g);if(m(F,L,!0)){F.de=l.de||R.vi;M(F,b);for(var B=F,t=a.particle_systems,C=0;C<t.length;C++){var K=t[C].settings.b4w_vcol_from_name,N=t[C].settings.b4w_vcol_to_name;""!==K&&
""!==N&&(B.gb[K]={Zf:!1,src:[{name:K,Rc:7}]})}"DYNAMIC"==b.type&&(F.Nh=a.uuid);k(F,u);B=R.bt(l,p,F.Of,F.Lc,F.gb,F.Ng);"LENS_FLARES"==L.name&&(B=Q.gE(B));d.push({n:F,Ec:B,uc:[L.name],Zb:b,gd:[a]})}}}}r=a.particle_systems;if(0<r.length&&d.length){c=!0;for(h=0;h<r.length;h++)if(r[h].settings.use_render_emitter){c=!1;break}h=d[0].n;r=d[0].Ec;l=[];n=a.particle_systems;g=a.data;for(p=0;p<n.length;p++)if(L=n[p],F=L.settings,F.count)if("EMITTER"==F.type){if("DYNAMIC"==b.type){B=e("PARTICLES");t=g.materials;
C=L.settings.material-1;C>=t.length&&(P.warn('Wrong material used for rendering particle system "'+L.name+'"'),C=0);t=t[C];"HALO"===L.settings.render_type&&(B.cg=!0);m(B,t);M(B,b);C=B;K=L;switch(K.settings.b4w_billboard_align){case "VIEW":x(C,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":x(C,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":x(C,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":x(C,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";
}x(C,"BILLBOARD",0);fa.B(C.tb,"WORLD_SPACE","WORLD"==K.settings.b4w_coordinate_system?1:0);B.ee=!0;B.Nh=a.name+"_"+F.uuid;B.pp=L.name;k(B,u);B.xc=L;F=Q.bC(B,g,L,a.d.Be);Q.UE(B,L,t);l.push({n:B,Ec:F,uc:[t.name],Zb:b,gd:[a]})}}else if("HAIR"==F.type){B=Z.ll(L.seed);F.b4w_dynamic_grass&&(b.oh=!0);if(L.transforms.length)var y=L.transforms;else for(var t=R.bo(r,F.count,!1,B),y=new Float32Array(4*t.length),z=0;z<t.length;z++)C=.75+.5*Z.Tc(B),y[4*z]=t[z][0],y[4*z+1]=t[z][1],y[4*z+2]=t[z][2],y[4*z+3]=C;t=
ka.Oa(f,"GRASS_MAP")?!0:!1;if("OBJECT"==F.render_type)C=[v(f,F.dupli_object.d)],L=E(a,b,h,r,[F.dupli_object],C,[y],F,L,t,B,!1),l=l.concat(L);else if("GROUP"==F.render_type){K=F.dupli_group.objects;N=!1;C=[];for(z=0;z<K.length;z++){var q=v(f,F.dupli_group.objects[z].d);C.push(q)}if(F.use_whole_group){N=y;y=K;z={};for(q=0;q<N.length;q+=4)for(var D=0;D<y.length;D++){var I=oa.create();oa.scale(y[D].d.g,y[D].d.scale,I);var A=oa.clone([N[q],N[q+1],N[q+2]]);oa.add(A,I,A);z[D]||(z[D]=new Float32Array(N.length));
z[D][q]=A[0];z[D][q+1]=A[1];z[D][q+2]=A[2];z[D][q+3]=N[q+3]}y=z;N=!0}else if(F.use_group_count){for(var A=K,J=F.dupli_weights,z=B,q={},D=[],I=0;I<A.length;I++)for(var pa=A[I],pa=pa.origin_name||pa.name,ma=0;ma<J.length;ma++){var w=J[ma];pa==w.name.split(": ")[0]&&D.push(w)}J.length!=D.length&&P.error("dupli weights match failed");for(I=0;I<y.length;I+=4){var ha,J=D;ha=[0];for(A=0;A<J.length;A++)ha[A+1]=ha[A]+J[A].count;J=ha[ha.length-1]*Z.Tc(z);for(A=pa=0;A<ha.length;A++)if(J>=ha[A]&&J<ha[A+1]){pa=
A;break}ha=pa;q[ha]=q[ha]||[];q[ha].push(y[I],y[I+1],y[I+2],y[I+3])}for(ha in q)q[ha]=new Float32Array(q[ha]);y=q}else{z=B;q=K.length;D={};for(I=0;I<y.length;I+=4){var V=Math.floor(q*Z.Tc(z));D[V]=D[V]||[];D[V].push(y[I],y[I+1],y[I+2],y[I+3])}for(V in D)D[V]=new Float32Array(D[V]);y=D}L=E(a,b,h,r,K,C,y,F,L,t,B,N);l=l.concat(L)}"INSTANCE"==F.b4w_wind_bend_inheritance&&(a.d.Pd=0)}else throw"Unknown particle settings type";a=l;d=c?a:d.concat(a)}return d}function g(a){return{max_x:a.max_x,min_x:a.min_x,
max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function v(a,b){var f=["MAIN","NODES"];b.Dd&&(ka.Oa(a,"COLOR_PICKING")||ka.Oa(a,"GLOW_MASK"))&&f.push("COLOR_ID");ka.Oa(a,"WIREFRAME")&&f.push("WIREFRAME");f.push("PHYSICS");(ka.Oa(a,"DEPTH")||ka.Oa(a,"SHADOW_CAST"))&&f.push("DEPTH");ka.Oa(a,"GRASS_MAP")&&f.push("GRASS_MAP");if(b.lc||b.jc){var c=null;b.lc&&(c=["MAIN","NODES","COLOR_ID","PHYSICS","WIREFRAME"]);if(b.jc)var d=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],c=null!==c?Z.Jz(c,d):d;for(d=
0;d<c.length;d++){var e=f.indexOf(c[d]);-1!==e&&f.splice(e,1)}}return f}function m(a,b,f){var c,d;switch(a.type){case "MAIN":if(b.b4w_do_not_render||b.use_nodes)a=!1;else{z(a,b);var e=b.game_settings.alpha_blend;a.Ce=b.b4w_render_above_all&&"OPAQUE"!=e&&"CLIP"!=e;a.yg=b.offset_z;a.rf.set([1,1,1]);var k=b.texture_slots;la.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Oc);switch(b.name){case "LENS_FLARES":r(a,"special_lens_flares.glslv","special_lens_flares.glslf");I(a,"a_position");
I(a,"a_texcoord");var u=f?[1,1,1,0]:null,u=C(k[0],u);L(a,u);break;default:r(a,"main.glslv","main.glslf");var h=J("use_map_color_diffuse",k),g=J("use_map_color_spec",k),m=J("use_map_normal",k),p=J("use_map_mirror",k),F=J("use_stencil",k),e=h[0],g=g[0],m=m[0],p=p[0],h=h[1],k=F[0]&&J("use_rgb_to_intensity",k)[0];if(e){switch(e.blend_type){case "MIX":x(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":x(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}u="IMAGE"==e.texture.d.source&&
f?[a.Oc[0],a.Oc[1],a.Oc[2],1]:"ENVIRONMENT_MAP"==e.texture.d.source&&f?[.8,.8,.8,1]:null;u=C(e,u);L(a,u,"u_colormap0");a.Li=e.diffuse_color_factor;a.Ai=e.use_map_alpha?e.alpha_factor:0;a.rf.set(e.scale)}F=e&&e==g;g&&(F||(u=f?[.5,.5,.5,1]:null,u=C(g,u),L(a,u,"u_specmap0")),a.Ow=g.specular_color_factor);if(m){I(a,"a_normal");I(a,"a_tangent");u=f?[.5,.5,1,1]:null;u=C(m,u);L(a,u,"u_normalmap0");a.gv=m.normal_factor;var v=m.texture;if(v.b4w_use_map_parallax&&ha.pj){var u=fa.N(v.b4w_parallax_steps),B=fa.N(v.b4w_parallax_lod_dist);
x(a,"PARALLAX",1);x(a,"PARALLAX_STEPS",u);x(a,"PARALLAX_LOD_DIST",B);a.Gl=v.b4w_parallax_scale}}p&&(u=f?[0,0,.5,1]:null,u=C(p,u),L(a,u,"u_mirrormap"),a.Yo=p.mirror_factor);if(v=e&&h&&k?1:0)u=f?[.8,.8,.8,1]:null,u=C(h,u),L(a,u,"u_colormap1"),u=f?[.5,.5,.5,1]:null,u=C(k,u),L(a,u,"u_stencil0");(f=e||g||m)&&a.rf.set(f.scale);x(a,"TEXTURE_SPEC",void 0==g?0:1);x(a,"TEXTURE_MIRROR",void 0==p?0:1);x(a,"ALPHA_AS_SPEC",F?1:0);x(a,"TEXTURE_STENCIL_ALPHA_MASK",v);I(a,"a_position");I(a,"a_normal");(e||g||m)&&
I(a,"a_texcoord");if(b.b4w_water){a.Rg=!0;a.Cx=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;f=b.texture_slots;r(a,"special_water.glslv","special_water.glslf");I(a,"a_position");I(a,"a_texcoord");I(a,"a_normal");I(a,"a_tangent");ha.Ex?(I(a,"a_polyindex"),a.Z=!0,a.wireframe_edge_color=[0,0,0],x(a,"DEBUG_WIREFRAME",1)):x(a,"DEBUG_WIREFRAME",0);F=J("use_map_normal",f);p=J("use_map_mirror",f)[0];F.length&&(v=C(F[0]),L(a,v,"u_normalmap0"),a.vm=b.b4w_water_norm_uv_velocity);x(a,"NUM_NORMALMAPS",
F.length);a.ug=Array(F.length);for(v=0;v<F.length;v++)a.ug[v]=new Float32Array(2),a.ug[v].set([F[v].scale[0],F[v].scale[1]]);p?(x(a,"TEXTURE_MIRROR",1),F=C(p),L(a,F,"u_mirrormap"),a.Yo=p.mirror_factor):x(a,"TEXTURE_MIRROR",0);p=null;for(v=0;v<f.length;v++)if(c=f[v],!0===c.texture.b4w_water_foam){p=c;break}p&&ha.Si?(x(a,"FOAM",1),F=C(p),L(a,F,"u_foam"),a.Sk=b.b4w_foam_factor,a.gt.set(p.texture.b4w_foam_uv_freq),a.ft.set(p.texture.b4w_foam_uv_magnitude),a.Xn[0]=p.scale[0],a.Xn[1]=p.scale[1]):x(a,"FOAM",
0);for(v=0;v<f.length;v++)if(c=f[v],!0===c.texture.b4w_shore_dist_map){d=c;break}d&&ha.Mm?(d=C(d),L(a,d,"u_shore_dist_map"),x(a,"SHORE_PARAMS",1),d=c.texture.b4w_shore_boundings,x(a,"MAX_SHORE_DIST",fa.N(c.texture.b4w_max_shore_dist)),x(a,"SHORE_MAP_SIZE_X",fa.N(d[0]-d[1])),x(a,"SHORE_MAP_SIZE_Y",fa.N(d[2]-d[3])),x(a,"SHORE_MAP_CENTER_X",fa.N((d[0]+d[1])/2)),x(a,"SHORE_MAP_CENTER_Y",fa.N((d[2]+d[3])/2))):x(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&ha.Lk?(x(a,"GENERATED_MESH",1),a.Ax=!0,a.Bx=b.b4w_water_num_cascads,
a.Dx=b.b4w_water_subdivs,a.zx=b.b4w_water_detailed_dist):x(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){c=fa.N(b.b4w_water_dst_noise_scale0);d=fa.N(b.b4w_water_dst_noise_scale1);f=fa.N(b.b4w_water_dst_noise_freq0);var p=fa.N(b.b4w_water_dst_noise_freq1),F=fa.N(b.b4w_water_dir_min_shore_fac),v=fa.N(b.b4w_water_dir_freq),u=fa.N(b.b4w_water_dir_noise_scale),B=fa.N(b.b4w_water_dir_noise_freq),K=fa.N(b.b4w_water_dir_min_noise_fac),N=fa.N(b.b4w_water_dst_min_fac),q=fa.N(b.b4w_water_waves_hor_fac);x(a,
"DST_NOISE_SCALE_0",c);x(a,"DST_NOISE_SCALE_1",d);x(a,"DST_NOISE_FREQ_0",f);x(a,"DST_NOISE_FREQ_1",p);x(a,"DIR_MIN_SHR_FAC",F);x(a,"DIR_FREQ",v);x(a,"DIR_NOISE_SCALE",u);x(a,"DIR_NOISE_FREQ",B);x(a,"DIR_MIN_NOISE_FAC",K);x(a,"DST_MIN_FAC",N);x(a,"WAVES_HOR_FAC",q)}y(a,b);n(a,b);a.Yl.set(b.b4w_shallow_water_col);a.bm.set(b.b4w_shore_water_col);a.Zl=b.b4w_shallow_water_col_fac;a.cm=b.b4w_shore_water_col_fac;x(a,"ABSORB",fa.N(b.b4w_water_absorb_factor));x(a,"SSS_STRENGTH",fa.N(b.b4w_water_sss_strength));
x(a,"SSS_WIDTH",fa.N(b.b4w_water_sss_width));c=a.tb;d=a.Of;a.tb=c;a.Of=d}"HALO"===b.type&&(c=b.halo,r(a,"halo.glslv","halo.glslf"),x(a,"NUM_RINGS",c.ring_count),x(a,"NUM_LINES",c.line_count),x(a,"NUM_STARS",c.star_tip_count),x(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.Of=["a_position"],a.nu=c.size,a.ku=c.hardness/20,a.mu.set(c.b4w_halo_rings_color),a.lu.set(c.b4w_halo_lines_color),a.ou=1/b.b4w_halo_stars_blend_height,a.pu=b.b4w_halo_stars_min_height,a.ju=!0);x(a,"TEXCOORD",0);x(a,"NORMAL_TEXCOORD",
0);e&&t(a,e,"TEXTURE_COLOR0_CO");h&&t(a,h,"TEXTURE_COLOR1_CO");k&&t(a,k,"TEXTURE_STENCIL_ALPHA_MASK_CO");g&&t(a,g,"TEXTURE_SPEC_CO");m&&t(a,m,"TEXTURE_NORM_CO");x(a,"SHADELESS",b.use_shadeless?1:0);a.Mg=b.use_shadeless}e=b.game_settings.alpha_blend;x(a,"ALPHA","OPAQUE"===e?0:1);x(a,"ALPHA_CLIP","CLIP"===e?1:0);x(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(x(a,"VERTEX_COLOR",1),I(a,"a_color")):x(a,"VERTEX_COLOR",0);a.ah=b.ambient;a.Mi=b.diffuse_intensity;a.rh=
b.emit;a.Kj.set(b.specular_color);a.Zh=b.specular_alpha;y(a,b);n(a,b);b.b4w_wettable?x(a,"WETTABLE",1):x(a,"WETTABLE",0);D(a,b);a.sp=b.b4w_refractive;a.Tv=b.b4w_refr_bump;a=!0}break;case "NODES":a=l(a,b);break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)a=!1;else if(z(a,b),a.Ga)a=!1;else{r(a,"depth.glslv","depth.glslf");I(a,"a_position");I(a,"a_normal");e=b.game_settings.alpha_blend;x(a,"ALPHA","OPAQUE"===e?0:1);a.rf.set([1,1,1]);if((b=J("use_map_color_diffuse",
b.texture_slots)[0])&&"CLIP"===e){a.rf.set(b.scale);x(a,"TEXTURE_COLOR",1);I(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)e=C(b),L(a,e,"u_colormap0");"NONE"==b.texture.d.source&&(e=C(b),L(a,e,"u_colormap0"))}else x(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.uG=b.b4w_use_ghost,a.pc=b.b4w_collision_id,a.ns=b.b4w_collision_group,a.os=b.b4w_collision_mask,a.Ui=b.physics.friction,a.Oi=b.physics.elasticity,a=!0):b.b4w_water?(a.Rg=!0,a.BG=b.b4w_water_dynamic,
a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;
break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_do_not_render||"HALO"===b.type)a=!1;else{z(a,b);a.De=R.Td;a.Z=!0;a.Ga=!1;e=b.game_settings.alpha_blend;a.Ce=b.b4w_render_above_all&&"OPAQUE"!=e&&"CLIP"!=e;r(a,"color_id.glslv","color_id.glslf");I(a,"a_position");e=b.game_settings.alpha_blend;x(a,"ALPHA","OPAQUE"===e?0:1);a.rf.set([1,1,1]);if((b=J("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===e){a.rf.set(b.scale);x(a,"TEXTURE_COLOR",1);I(a,"a_texcoord");if("IMAGE"==b.texture.d.source||
"ENVIRONMENT_MAP"==b.texture.d.source)e=C(b),L(a,e,"u_colormap0");"NONE"==b.texture.d.source&&(e=C(b),L(a,e,"u_colormap0"))}else x(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?a=!1:(z(a,b),a.Ga=!1,a.De=R.Td,a.Z=!0,r(a,"grass_map.glslv","grass_map.glslf"),I(a,"a_position"),e=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.gb.a_grass_size={Zf:!0,src:[]},e?(a.gb.a_grass_size.src.push({name:e,Rc:4}),
x(a,"DYNAMIC_GRASS_SIZE",1)):x(a,"DYNAMIC_GRASS_SIZE",0),a.gb.a_grass_color={Zf:!0,src:[]},b?(a.gb.a_grass_color.src.push({name:b,Rc:7}),x(a,"DYNAMIC_GRASS_COLOR",1)):x(a,"DYNAMIC_GRASS_COLOR",0),a=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?a=!1:(r(a,"wireframe.glslv","wireframe.glslf"),I(a,"a_position"),I(a,"a_normal"),I(a,"a_polyindex"),a.Z=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],a=!0);break;case "PARTICLES":if(b.b4w_do_not_render)a=
!1;else{e=b.texture_slots;if(a.cg)r(a,"particles_color.glslv","particles_color.glslf");else if(r(a,"particles_texture.glslv","particles_texture.glslf"),e=J("use_map_color_diffuse",e)[0]){x(a,"TEXTURE_COLOR",1);switch(e.blend_type){case "MIX":x(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":x(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Li=e.diffuse_color_factor;a.Ai=e.use_map_alpha?e.alpha_factor:0;e=C(e);L(a,e)}la.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],
b.alpha,a.Oc);a.ah=b.ambient;a.Mi=b.diffuse_intensity;a.rh=b.emit;a.Kj.set(b.specular_color);a.Zh=b.specular_alpha;I(a,"a_position");I(a,"a_normal");e=b.game_settings.alpha_blend;x(a,"ALPHA","OPAQUE"===e?0:1);x(a,"ALPHA_CLIP","CLIP"===e?1:0);x(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);y(a,b);n(a,b);z(a,b);e=b.game_settings.alpha_blend;a.Ce=b.b4w_render_above_all&&"OPAQUE"!=e&&"CLIP"!=e;a.yg=b.offset_z;a=!0}break;default:throw"Wrong batch type: "+a.type;}return a}function t(a,b,f){switch(b.texture_coords){case "UV":case "ORCO":x(a,
f,"TEXTURE_COORDS_UV_ORCO");x(a,"TEXCOORD",1);break;case "NORMAL":x(a,f,"TEXTURE_COORDS_NORMAL");x(a,"NORMAL_TEXCOORD",1);break;default:x(a,f,0)}}function z(a,b){var f=b.game_settings,c=f.alpha_blend;switch(c){case "ALPHA_SORT":a.Ga=!0;a.De=R.hr;a.Z=!0;break;case "ALPHA":a.Ga=!0;a.De=R.Td;a.Z=!0;break;case "CLIP":a.Ga=!1;a.De=R.Td;a.Z=!0;break;case "ADD":a.Ga=!0;a.De=R.Td;a.Z=!1;break;case "OPAQUE":a.Ga=!1;a.De=R.Td;a.Z=!0;break;default:throw Error("Unknown alpha blend mode: "+c);}a.Da=f.use_backface_culling}
function C(a,b){var f=a.texture,c=f.d,f=f.image;c&&b&&f&&da.Pj(c,b,f.mc,f.filepath);return c}function J(a,b){for(var f=[],c=b.length,d=0;d<c;d++){var e=b[d];1==e[a]&&e.texture&&e.texture.d&&f.push(e)}return f}function D(a,b){var f=b.raytrace_transparency;a.Yf[0]=f.fresnel;a.Yf[1]=1-f.fresnel_factor/5;f=b.raytrace_mirror;a.Pl=f.reflect_factor;a.Yf[2]=f.fresnel;a.Yf[3]=1-f.fresnel_factor/5}function y(a,b){var f,c=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":x(a,"SPECULAR_SHADER","SPECULAR_PHONG");
f=b.specular_hardness;break;case "WARDISO":x(a,"SPECULAR_SHADER","SPECULAR_WARDISO");f=b.specular_slope;break;case "TOON":x(a,"SPECULAR_SHADER","SPECULAR_TOON");f=b.specular_toon_size;c=b.specular_toon_smooth;break;default:P.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),f=b.specular_hardness}a.$h[0]=b.specular_intensity;a.$h[1]=f;a.$h[2]=c}function n(a,b){switch(b.diffuse_shader){case "LAMBERT":x(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.ce[0]=0;a.ce[1]=0;break;
case "OREN_NAYAR":x(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.ce[0]=b.roughness;a.ce[1]=0;break;case "FRESNEL":x(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.ce[0]=b.diffuse_fresnel;a.ce[1]=b.diffuse_fresnel_factor;break;default:P.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.ce[0]=0,a.ce[1]=0}}function l(a,b){if(!b.use_nodes||b.b4w_do_not_render)return!1;var f=U.vA(b.node_tree,b.uuid,!1,b.name);if(!f)return P.error('Failed to create node graph for material "'+b.name+
'", disable nodes'),c(a,b),!0;r(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;x(a,"ALPHA","OPAQUE"===d?0:1);x(a,"ALPHA_CLIP","CLIP"===d?1:0);x(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);I(a,"a_position");z(a,b);a.yg=b.offset_z;d=b.game_settings.alpha_blend;a.Ce=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;la.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Oc);a.rh=b.emit;a.ah=b.ambient;D(a,b);b.b4w_wettable?x(a,"WETTABLE",1):x(a,"WETTABLE",
0);a.tb.cp=U.wA(f);var e=!1;ea.U(f,function(b,f){switch(f.type){case "GEOMETRY_UV":var c=f.data.name,d=f.data.value;a.Ng||(a.Ng={});a.Ng[d]=c;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":c=f.data.name;a.gb[c]={Zf:!0,src:[{name:f.data.value}]};d=0;if("GEOMETRY_VC"==f.type)d=7;else for(var k=0;k<f.fb.length;k++){var r="RGB".indexOf(f.fb[k].identifier);-1<r&&(d|=1<<2-r)}a.gb[c].src[0].Rc=d;break;case "GEOMETRY_NO":I(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":c=
f.data.value;I(a,"a_normal");x(a,"DIFFUSE_SHADER","DIFFUSE_"+c.qB);x(a,"SPECULAR_SHADER","SPECULAR_"+c.zF);x(a,"SHADELESS_MAT",c.Mg?1:0);a.Mg=c.Mg;a.Zh=c.Zh;e=!0;break;case "TEXTURE_COLOR":case "TEXTURE_COLOR2":case "TEXTURE_COLOR3":case "TEXTURE_COLOR4":case "TEXTURE_ENVIRONMENT":c=f.data.name;d=f.data.value;!1!==d.d.jk&&(d.d.jk="TEXTURE_ENVIRONMENT"!=f.type?!0:!1);L(a,d.d,c);break;case "TEXTURE_NORMAL":case "TEXTURE_NORMAL2":case "TEXTURE_NORMAL3":case "TEXTURE_NORMAL4":case "B4W_PARALLAX":x(a,
"CALC_TBN_SPACE",1);I(a,"a_normal");I(a,"a_tangent");c=f.data.name;d=f.data.value;d.d.jk=!1;L(a,d.d,c);break;case "LAMP":f.data&&(a.Dh=f.data);break;case "B4W_REFRACTION":a.sp=!0}});e||(a.Mg=!0);return!0}function c(a,b){r(a,"main.glslv","main.glslf");var f=b.game_settings.alpha_blend;x(a,"ALPHA","OPAQUE"===f?0:1);x(a,"ALPHA_CLIP","CLIP"===f?1:0);x(a,"SHADELESS",1);I(a,"a_position");I(a,"a_normal");la.set(1,0,1,1,a.Oc);x(a,"VERTEX_COLOR",0);a.yg=b.offset_z;z(a,b)}function M(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==
b.type?(b.ol?x(a,"AU_QUALIFIER","attribute"):x(a,"AU_QUALIFIER","uniform"),x(a,"STATIC_BATCH",0)):(x(a,"AU_QUALIFIER","attribute"),x(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(V.NC()?x(a,"WIREFRAME_QUALITY",1):x(a,"WIREFRAME_QUALITY",0),a.Ji?(x(a,"DEBUG_SPHERE",1),a.Ls?x(a,"DEBUG_SPHERE_DYNAMIC",1):x(a,"DEBUG_SPHERE_DYNAMIC",0)):x(a,"DEBUG_SPHERE",0),x(a,"ALPHA",1));b.Od?(""!==b.qe?(a.gb.a_bending_col_main={Zf:!0,src:[{name:b.qe,Rc:4}]},I(a,"a_bending_col_main"),""!==b.Mb.Tu&&""!==b.Mb.Su&&""!==b.Mb.kv?
(a.gb.a_bending_col_detail={Zf:!0,src:[{name:b.Mb.Tu,Rc:4},{name:b.Mb.Su,Rc:2},{name:b.Mb.kv,Rc:1}]},I(a,"a_bending_col_detail"),I(a,"a_normal"),x(a,"DETAIL_BEND",1)):x(a,"DETAIL_BEND",0),x(a,"MAIN_BEND_COL",1)):x(a,"MAIN_BEND_COL",0),x(a,"WIND_BEND",1)):x(a,"WIND_BEND",0);b.pk?x(a,"BEND_CENTER_ONLY",1):x(a,"BEND_CENTER_ONLY",0);x(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.Uz|0);b.Zd?x(a,"BILLBOARD",1):x(a,"BILLBOARD",0);b.Zd&&b.ol?x(a,"HAIR_BILLBOARD",1):x(a,"HAIR_BILLBOARD",0);b.cn?x(a,"BILLBOARD_SPHERICAL",
1):x(a,"BILLBOARD_SPHERICAL",0);switch(b.Ci){case "RANDOM":x(a,"BILLBOARD_RANDOM",1);x(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":x(a,"BILLBOARD_RANDOM",0);x(a,"BILLBOARD_JITTERED",1);break;default:x(a,"BILLBOARD_RANDOM",0),x(a,"BILLBOARD_JITTERED",0)}b.bb&&ha.Mm?x(a,"DYNAMIC_GRASS",1):x(a,"DYNAMIC_GRASS",0);a.bb=b.bb;a.ee=b.ee;a.Cc=b.Cc;a.lc=b.lc;a.Qb=b.Qb&&!a.Mg&&!(a.Ga&&ha.Qs);a.Ac=b.Ac;a.jc=b.jc;a.ed=b.ed;b.fj?(I(a,"a_influence"),x(a,"SKINNED",1),b.Ti?x(a,"FRAMES_BLENDING",1):x(a,"FRAMES_BLENDING",
0),x(a,"MAX_BONES",b.dd)):(x(a,"SKINNED",0),x(a,"FRAMES_BLENDING",0));b.tm?(x(a,"VERTEX_ANIM",1),ha.wx?x(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):x(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):x(a,"VERTEX_ANIM",0);if(b.fj&&b.tm)throw"Skinning and vertex animation are mutually exlusive";b.Mk?x(a,"DISABLE_FOG",1):x(a,"DISABLE_FOG",0);b.Lc&&(a.Lc=b.Lc);if("NODES"==a.type){for(var f=a.tb.cp,c=b.tg,d=b.sg,e=0;e<f.length;e++){var k=f[e];switch(k.id){case "VALUE":var r=k.Hl[0];if(r)for(var u=0;u<
c.length;u+=2)if(c[u]==r){k.Rf.push(["VALUE_IND",c[u+1]]);break}break;case "RGB":if(r=k.Hl[0])for(u=0;u<d.length;u+=2)if(d[u]==r){k.Rf.push(["RGB_IND",d[u+1]]);break}}}x(a,"NUM_VALUES",b.Ye.length);x(a,"NUM_RGBS",b.Ad.length)}}}function I(a,b){var f=a.Of;-1==f.indexOf(b)&&f.push(b)}function x(a,b,f){fa.B(a.tb,b,f)}function B(a,b){if("PHYSICS"==a.type)a.Ec=b;else{var f=a.De,c=a.de;a.ju&&(b=R.JB(b));a.Ax&&(b=S.fC(a.Bx,a.Dx,a.zx));f=R.LF(b,f,c,a.gb);a.ee||f.kl||(f.dg=null,f.vf=null);a.$a=f;f=b.u.length;
a.fp=b.J*f;a:switch(a.de){case R.vi:case R.ak:case R.Fq:c=!0;break a;default:c=!1}c?R.qD(b)?a.lj=b.ca.length/3*f:a.lj=b.J/3*f:a.lj=0}}function E(a,b,f,c,d,r,u,l,n,h,g,p){var L=[],v=l.b4w_dynamic_grass;if(!h&&v)return L;for(var F="INSTANCE"==l.b4w_wind_bend_inheritance,B="INSTANCE"==l.b4w_shadow_inheritance,x="INSTANCE"==l.b4w_reflection_inheritance,t=[],C=[],K=0;K<d.length;K++){var N=d[K],y=Z.zk(b);y.Zd=l.b4w_hair_billboard;y.Ci=l.b4w_hair_billboard_type;y.cn="SPHERICAL"==l.b4w_hair_billboard_geometry;
y.bb=v;y.ol=!0;y.Ye=N.d.Ye;y.tg=N.d.tg;y.Ad=N.d.Ad;y.sg=N.d.sg;F?(y.Od=N.d.Od,y.Vj=N.d.Vj,y.zf=N.d.zf,y.Oe=N.d.Oe,y.qe=N.d.qe,y.Ne=N.d.Ne,y.Le=N.d.Le,y.Pd=N.d.Pd,y.Mb=N.d.Mb,y.pk=!1):(y.Od=a.d.Od,y.Vj=a.d.Vj,y.zf=a.d.zf,y.Oe=a.d.Oe,y.qe=a.d.qe,y.Ne=a.d.Ne,y.Le=a.d.Le,y.Pd=a.d.Pd,y.Mb=a.d.Mb,y.pk=!0);B?(y.Cc=N.d.Cc,y.lc=N.d.lc,y.Qb=N.d.Qb):(y.Cc=a.d.Cc,y.lc=a.d.lc,y.Qb=a.d.Qb);x?(y.Ac=N.d.Ac,y.jc=N.d.jc,y.ed=N.d.ed):(y.Ac=a.d.Ac,y.jc=a.d.jc,y.ed=a.d.ed);t.push(y);var z=u[K];z||(z=new Float32Array);
p&&Z.ll(n.seed,g);for(var q=new Float32Array(3),D=new Float32Array([0,0,0,1]),I=[],E=0;E<z.length;E+=4){q[0]=z[E];q[1]=z[E+1];q[2]=z[E+2];var A=z[E+3];if(l.b4w_initial_rand_rotation){switch(l.b4w_rotation_type){case "XYZ":var J=new Float32Array([Z.Tc(g),Z.Tc(g),Z.Tc(g)]);oa.normalize(J,J);break;case "Z":J=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+l.b4w_rotation_type;}ma.setAxisAngle(J,l.b4w_rand_rotation_strength*(2*Math.PI*Z.Tc(g)-Math.PI),D)}var pa=ca.nh(q,
A,D);I.push(pa)}C.push(I)}for(var w={},K=0;K<d.length;K++){var ha=r[K],y=t[K],V=Z.eh(y,0),I=C[K];if(I.length)for(var U=d[K].data,ea=U.materials,E=0;E<ea.length;E++)if(!R.su(U,E))for(var sb=0;sb<ha.length;sb++){var Q=ha[sb];if("COLOR_ID"!==Q){var S=e(Q),Ba=ea[E];if(m(S,Ba,!0)){S.de=U.de||R.vi;M(S,y);S.Nh=l.uuid;"JITTERED"==l.b4w_hair_billboard_type&&(S.Lu=l.b4w_hair_billboard_jitter_amp,S.Mu=l.b4w_hair_billboard_jitter_freq);v&&(S.iu=l.b4w_dynamic_grass_scale_threshold);F||(delete S.gb.a_bending_col_main,
delete S.gb.a_bending_col_detail);k(S,V);var da=R.bt(U,E,S.Of,S.Lc,S.gb,S.Ng),Ta=[];if(y.Od||y.bb||y.Zd)Ta.au_wind_bending_amp=[y.Pd],Ta.au_wind_bending_freq=[y.zf],Ta.au_detail_bending_freq=[y.Oe],Ta.au_detail_bending_amp=[y.Ne],Ta.au_branch_bending_amp=[y.Le];var lb=R.DD(da,Ta,I),X=lb,fa=I;X.G.au_center_pos=new Float32Array(3*X.J);for(var ka=fa.length,Ua=X.J/ka,Gb=0;Gb<ka;Gb++)for(var xb=fa[Gb],hb=3*Ua*Gb,Vb=0;Vb<Ua;Vb++)X.G.au_center_pos[hb+3*Vb]=xb[0],X.G.au_center_pos[hb+3*Vb+1]=xb[1],X.G.au_center_pos[hb+
3*Vb+2]=xb[2];lb=X;if(y.pk){var kb=lb,qb=a.d.R;kb.G.a_emitter_center=new Float32Array(3*kb.J);var La=la.fromValues(0,0,0,1);la.transformMat4(La,qb,La);for(var ya=0;ya<kb.J;ya++)kb.G.a_emitter_center[3*ya]=La[0],kb.G.a_emitter_center[3*ya+1]=La[1],kb.G.a_emitter_center[3*ya+2]=La[2];lb=kb}var Fb=l.b4w_vcol_from_name,wb=l.b4w_vcol_to_name,ua=S,Ob=f,Y=!F,gb=U,Pa=[];if(""!==Fb&&""!==wb){var Da,Sa=wb,Db=ua.gb,Ib=[],ac=void 0;for(ac in Db)for(var Eb=Db[ac].src,Qa=0,Tb=0;Tb<Eb.length;Tb++){var Jb=Eb[Tb].Rc;
Sa==Eb[Tb].name&&Ib.push(ac,Jb,Qa);Qa+=Z.Fg(Jb)}Da=Ib;if(0<Da.length)for(var bc=0;bc<Da.length;bc+=3)Pa.push({Pi:Fb,Qk:7,Il:Da[bc],Jl:Da[bc+1],Ok:Da[bc+2]});else R.aD(ua.Of,"a_color")&&wb==gb.active_vcol_name&&Pa.push({Pi:Fb,Qk:7,Il:"a_color",Jl:7,Ok:0})}Y&&("a_bending_col_main"in Ob.gb&&Pa.push({Pi:"a_bending_col_main",Qk:4,Il:"a_bending_col_main",Jl:4,Ok:0}),"a_bending_col_detail"in Ob.gb&&Pa.push({Pi:"a_bending_col_detail",Qk:7,Il:"a_bending_col_detail",Jl:7,Ok:0}));for(var Ub=lb,nc=I,yb=c,mb=
Pa,oc=S.gb,kc=!1,eb=0;eb<mb.length;eb++){var pc=mb[eb].Pi,G=yb.G[pc];if(G&&0<G.length){kc=!0;break}}if(kc){var Lb,tb=a.d.Ub,Ea=yb.u[0].a_position,nb=nc,T=w,Va=new Float32Array(3),ob=new Float32Array(3),dc=new Uint32Array(nb.length);if(!("verts_indices"in T)){T.ae=new Float32Array(3);T.Yd=new Float32Array(3);T.tq=new Uint32Array(Ea.length/3);T.mj=new Uint32Array(Ea.length/3);T.ae[0]=(tb.max_x-tb.min_x)/20;T.ae[1]=(tb.max_y-tb.min_y)/20;T.ae[2]=(tb.max_z-tb.min_z)/20;T.Yd[0]=tb.min_x;T.Yd[1]=tb.min_y;
T.Yd[2]=tb.min_z;for(var Wa=0;Wa<Ea.length/3;Wa++){var ec=Z.trunc((Ea[3*Wa]-T.Yd[0])/T.ae[0]),Za=Z.trunc((Ea[3*Wa+1]-T.Yd[1])/T.ae[1]),vc=Z.trunc((Ea[3*Wa+2]-T.Yd[2])/T.ae[2]),ec=Z.ra(ec,0,19),Za=Z.ra(Za,0,19),vc=Z.ra(vc,0,19);T.tq[Wa]=Wa;T.mj[Wa]=vc*Math.pow(20,2)+20*Za+ec}R.tF(T.mj,T.tq,!0);T.Pg=new Uint32Array(Math.pow(20,3));for(Wa=0;Wa<T.mj.length;Wa++)T.Pg[T.mj[Wa]]++;delete T.mj;for(Wa=1;Wa<T.Pg.length;Wa++)T.Pg[Wa]+=T.Pg[Wa-1]}for(var Xb=0;Xb<nb.length;Xb++){Va[0]=nb[Xb][0];Va[1]=nb[Xb][1];
Va[2]=nb[Xb][2];for(var fc=1E10,gc=-1,Ec=Z.trunc((Va[0]-T.Yd[0])/T.ae[0]),Ha=Z.trunc((Va[1]-T.Yd[1])/T.ae[1]),Ca=Z.trunc((Va[2]-T.Yd[2])/T.ae[2]),Ec=Z.ra(Ec,0,19),Ha=Z.ra(Ha,0,19),Ca=Z.ra(Ca,0,19),Fc=Ca*Math.pow(20,2)+20*Ha+Ec,pd=T.Pg[Fc],pb=0==Fc?0:T.Pg[Fc-1];pb<pd;pb++){var wc=T.tq[pb];ob[0]=Ea[3*wc];ob[1]=Ea[3*wc+1];ob[2]=Ea[3*wc+2];oa.sub(ob,Va,ob);var qc=oa.sqrLen(ob);qc<=fc&&(fc=qc,gc=wc)}if(-1==gc)for(pb=0;pb<Ea.length/3;pb++)ob[0]=Ea[3*pb],ob[1]=Ea[3*pb+1],ob[2]=Ea[3*pb+2],oa.sub(ob,Va,ob),
qc=oa.sqrLen(ob),qc<=fc&&(fc=qc,gc=pb);dc[Xb]=gc}Lb=dc;for(var Gc=Ub.J/nc.length,eb=0;eb<mb.length;eb++){var Hb=mb[eb].Il,Hc=mb[eb].Jl,pc=mb[eb].Pi,id=mb[eb].Qk,G=yb.G[pc];switch(Hb){case "a_bending_col_main":var Yb=1;break;case "a_bending_col_detail":Yb=3;break;case "a_color":Yb=3;break;default:for(var Qb=Yb=0;Qb<oc[Hb].src.length;Qb++)Yb+=Z.Fg(oc[Hb].src[Qb].Rc)}if(G&&0<G.length){var rc=Z.Fg(id),Mb=Z.Fg(Hc),sc=id&Hc,xc=Z.$v(sc);sc!=Hc&&P.error("Wrong color extraction from "+pc+" to "+Hb+".");if("a_bending_col_main"==
Hb||"a_bending_col_detail"==Hb)Ub.G[Hb]=new Float32Array(Ub.J*Mb);for(Qb=0;Qb<nc.length;Qb++){var lc=Lb[Qb],Zb=lc*rc,Xc=Qb*Gc*Yb;if(-1!=lc)for(var hc=0;hc<Gc;hc++)for(var ub=hc*Yb,vb=0;vb<xc.length;vb++)xc[vb]&&(Ub.G[Hb][Xc+ub+(mb[eb].Ok+Z.Fj(Hc,vb))]=G[Zb+Z.Fj(id,vb)])}}else Ub.G[Hb]=new Float32Array(0)}}lb=Ub;L.push({n:S,Ec:lb,uc:[Ba.name],Zb:y,gd:[a]})}}}}return L}function K(a){return ca.nh(a.g,a.scale,a.quat)}function k(a,b){for(var f=null,c=null,d=0;d<a.X.length;d++){var e=a.X[d].$d;e&&(f||(f=
{}),f[d]=e,a.X[d].$d=null);if(e=a.X[d].hb)c||(c={}),c[d]=e,a.X[d].hb=null}a.id=0;a.wE=b;a.id=Z.eh(a,b);if(f)for(var k in f)a.X[k].$d=f[k];if(c)for(k in c)a.X[k].hb=c[k]}function u(a,b,f,c,d){var u=e("WIREFRAME");r(u,"wireframe.glslv","wireframe.glslf");u.wireframe_mode=0;u.Ji=!0;u.Z=!0;u.Nh=f;d&&(u.Ls=!0);M(u,b);k(u,Z.eh(b,0));c?(b=S.pt(1,a.C),R.KE(b,[a.Gf[0],a.Hf[1],a.If[2]],a.C)):b=S.pt(a.Ca,a.C);R.Zp(b,1,!0);b.G.a_polyindex=R.at(b);B(u,b);return u}function r(a,b,f){a.tb={sm:b,Tk:f,Qf:[],Lo:[],
cp:[]};fa.TE(a.tb)}function L(a,b,f){1==a.X.length&&0==a.Vc.length&&a.Vc.push("default0");f=f||"default"+String(a.X.length);-1==a.Vc.indexOf(f)&&(a.X.push(b),a.Vc.push(f));a.kc&&A.Dr(a)}function F(a){if(!a.tb)throw"No shaders info for batch "+a.name;a.kc=fa.rC(a.tb);A.Oz(a.kc);A.Lz(a);A.Dr(a)}var f=w("__boundings"),N=w("__config"),P=w("__print"),V=w("__extensions"),R=w("__geometry"),ea=w("__graph"),U=w("__nodemat"),X=w("__objects"),Q=w("__particles"),S=w("__primitives");w("__reformer");var A=w("__renderer"),
ka=w("__scenegraph"),fa=w("__shaders"),da=w("__textures"),ca=w("__tsr"),Z=w("__util"),oa=w("vec3"),la=w("vec4"),ma=w("quat"),ha=N.p,pa=["MAIN","NODES"];a.VK=e;a.eC=function(a,c,k,l,n,g){for(var m=[],p=[],v=[],F=0;F<k.length;F++){var x=k[F];X.cd(x)?p.push(x):v.push(x)}F=[];F=F.concat(d(p,a,g));p=F=F.concat(h(v,a,c,g));F=[];x=[];v={};for(c=0;c<p.length;c++){var t=p[c].n,K=p[c].Zb,y=null;if(t.id in v){var N=v[t.id],z=x[N].n,q=x[N].Zb,D=null,M=null;for(g=0;g<t.X.length;g++){var E=t.X[g].$d;E&&(D||(D=
{}),D[g]=E,t.X[g].$d=null);if(E=t.X[g].hb)M||(M={}),M[g]=E,t.X[g].hb=null}Z.Xw(t,z)&&Z.Xw(K,q)&&(y=x[N]);if(D)for(g in D)t.X[g].$d=D[g];if(M)for(g in M)t.X[g].hb=M[g];if(!y){do t.id++;while(v[t.id])}}y||(y={n:t,Zb:p[c].Zb,gd:[],$w:[],uc:[]},v[t.id]=x.length,x.push(y));y.gd=y.gd.concat(p[c].gd);p[c].Ec&&p[c].Ec.J&&y.$w.push(p[c].Ec);if(y.uc.length)for(g=0;g<p[c].uc.length;g++)t=p[c].uc[g],-1==y.uc.indexOf(t)&&y.uc.push(t);else y.uc=p[c].uc}for(c=0;c<x.length;c++){p=x[c].$w;if(0==p.length)g=Z.mb(Z.mm("%empty"));
else if(1==p.length)g=p[0];else{v=[];for(g=0;g<p.length;g++)R.rD(p[g])||v.push(g);if(v.length<p.length)for(g=0;g<v.length;g++)R.Zp(p[v[g]]);g=R.KF(p)}F.push({n:x[c].n,Zb:x[c].Zb,Ec:g,uc:x[c].uc,gd:x[c].gd})}m.push.apply(m,F);for(F=0;F<m.length;F++)B(m[F].n,m[F].Ec),m[F].n.Fh=m[F].uc;for(F=0;F<m.length;F++)if(c=m[F].n,"STATIC"==m[F].Zb.type)x=X.yu(Z.mm("%meta"),"MESH",!0),x.d=m[F].Zb,x.q=[c],n.push(x);else for(p=[],g=0;g<m[F].gd.length;g++)if(x=m[F].gd[g],-1==p.indexOf(x.name)){for(v=0;v<x.q.length;v++)if(x.q[v]==
c)throw"Batch already exist in object";x.q.push(c);p.push(x.name)}if(ha.wireframe_debug){for(F=0;F<m.length;F++)if(c=m[F].Zb,"DYNAMIC"==c.type&&(x=m[F].gd[0],-1<pa.indexOf(m[F].n.type))){p=!1;for(g=0;g<x.q.length;g++)x.q[g].Ji&&(p=!0);p||(c=u(c.Jf,c,x.name,!0,!0),x.q.push(c))}for(F=0;F<n.length;F++)x=n[F],c=x.d,-1<pa.indexOf(x.q[0].type)&&(c=u(c.Zc,c,x.name,!1),x.q.push(c))}m=null;if(l.texture_slots)for(F=0;F<l.texture_slots.length;F++)if(l.texture_slots[F].texture.b4w_use_as_skydome){m=C(l.texture_slots[F],
null);break}if(l.b4w_sky_settings.procedural_skydome||m)c=e("MAIN"),r(c,"special_skydome.glslv","special_skydome.glslf"),l.b4w_sky_settings.procedural_skydome?c.Jv=!0:L(c,m,"u_sky"),l.b4w_sky_settings.reflexible&&(c.Ac=!0,l.b4w_sky_settings.reflexible_only&&(c.jc=!0)),I(c,"a_position"),c.yg=99999,l=S.dC(),B(c,l),x=X.yu(Z.mm("%meta"),"MESH",!0),x.d=X.Gk("DYNAMIC"),x.d.oh=!0,x.d.Ub=f.Qd(),x.d.Zc=f.Wj(),x.d.Za=f.Qd(),x.d.Cb=f.Wj(),x.q=[c],n.push(x);for(F=0;F<k.length;F++)b(k[F],a);for(F=0;F<n.length;F++)b(n[F],
a)};a.CG=function(a,b,f){if(b)b=f*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.Qz=g;a.oC=C;a.Vm=function(a,b){x(a,"CSM_SECTION0",0);x(a,"CSM_SECTION1",0);x(a,"CSM_SECTION2",0);x(a,"CSM_SECTION3",0);for(var f=0;f<b.csm_num;f++)x(a,"CSM_SECTION"+String(f),1);x(a,"SHADOW_TEX_RES",fa.N(b.csm_resolution));x(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);x(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?
1:0)};a.xe=x;a.eo=function(a,b){return fa.zC(a.tb,b)};a.aG=k;a.lk=L;a.AE=function(a,b,f){f=a.Vc.indexOf(f);-1<f&&(a.X[f]=b)};a.XA=function(a,b){var f=e("MAIN");f.Ga=!0;la.set(b[0],b[1],b[2],.5,f.Oc);f.de=R.ak;B(f,a);r(f,"main.glslv","main.glslf");x(f,"SHADELESS",1);F(f);return f};a.Rb=F;a.hA=function(a){return a.kc.qj.length?a.kc.jp.u_cube_fog?!0:!1:!1};a.LA=function(){var a=e("DEPTH_PACK");a.Da=!0;a.Z=!1;var b=S.eb();B(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");
F(a);return a};a.Cs=function(a){var b=e("POSTPROCESSING");r(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":x(b,"POST_EFFECT","POST_EFFECT_NONE");b.t[0]=1;b.t[1]=1;break;case "GRAYSCALE":x(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");b.t[0]=1;b.t[1]=1;break;case "X_BLUR":x(b,"POST_EFFECT","POST_EFFECT_X_BLUR");b.t[0]=1;b.t[1]=0;break;case "Y_BLUR":x(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");b.t[0]=0;b.t[1]=1;break;case "X_EXTEND":x(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");
b.t[0]=1;b.t[1]=0;break;case "Y_EXTEND":x(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");b.t[0]=0;b.t[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}b.Da=!0;b.Z=!1;a=S.eb();B(b,a);F(b);return b};a.fJ=function(){var a=e("EDGE");a.Z=!1;a.Da=!0;a.t[0]=1;a.t[1]=1;var b=S.eb();B(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");F(a);return a};a.aB=function(a){var b=e("SSAO");b.Z=!1;b.Da=!0;b.t[0]=1;b.t[1]=1;var f=S.eb();B(b,f);r(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");
x(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.Sw);x(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:da.hC(a)};f={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=C(a,f);L(b,a,"u_ssao_special_tex");F(b);return b};a.bB=function(a){var b=e("SSAO_BLUR");b.Z=!1;b.Da=!0;b.t[0]=1;b.t[1]=1;var f=S.eb();B(b,f);r(b,"postprocessing/postprocessing.glslv",
"postprocessing/ssao_blur.glslf");x(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);F(b);return b};a.MA=function(){var a=e("DOF");a.Z=!1;a.Da=!0;a.t[0]=1;a.t[1]=1;var b=S.eb();B(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");x(a,"DEPTH_RGBA",1);F(a);return a};a.NA=function(){var a=e("GLOW");a.Z=!1;a.Da=!0;a.t[0]=1;a.t[1]=1;var b=S.eb();B(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");F(a);return a};a.OA=function(a,b,f){var c=e("GOD_RAYS");c.Z=!1;
c.Da=!0;c.t[0]=1;c.t[1]=1;var d=S.ZB();B(c,d);r(c,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");x(c,"DEPTH_RGBA",a);x(c,"WATER_EFFECTS",b);x(c,"STEPS_PER_PASS",fa.N(f,1));F(c);return c};a.PA=function(){var a=e("GOD_RAYS_COM");a.Z=!1;a.Da=!0;a.t[0]=1;a.t[1]=1;var b=S.eb();B(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");F(a);return a};a.YA=function(){var a=e("SKY");a.Z=!1;a.Da=!0;a.t[0]=1;a.t[1]=1;var b=S.$B();B(a,b);r(a,"procedural_skydome.glslv",
"procedural_skydome.glslf");x(a,"WATER_EFFECTS",1);F(a);return a};a.FA=function(){var a=e("ANTIALIASING");a.Z=!1;a.Da=!0;a.t[0]=1;a.t[1]=1;a.ni=1/ha.resolution_factor;var b=S.eb();B(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");x(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");F(a);return a};a.ZA=function(a){var b=e("SMAA"),f=S.eb();B(b,f);r(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");x(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");x(b,"SMAA_PASS",a);x(b,"SMAA_PREDICATION",
0);x(b,"SMAA_REPROJECTION",0);F(b);b.Z=!1;b.Da=!0;b.t[0]=1;b.t[1]=1;b.ni=1/ha.resolution_factor;return b};a.QA=function(a){var b=e("LANCZOS");b.Z=!1;b.Da=!0;b.ni=1/ha.resolution_factor;"LANCZOS_X"==a?(b.t[0]=1,b.t[1]=0):"LANCZOS_Y"==a&&(b.t[0]=0,b.t[1]=1);a=S.eb();B(b,a);r(b,"postprocessing/postprocessing.glslv","postprocessing/lanczos.glslf");F(b);return b};a.JA=function(){var a=e("COMPOSITING");a.Z=!1;a.Da=!0;a.t[0]=1;a.t[1]=1;var b=S.eb();B(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");
F(a);return a};a.TA=function(a){var b=e("MOTION_BLUR");b.Da=!0;b.Z=!1;var f=S.eb();B(b,f);r(b,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");x(b,"BLUR_DECAY_THRESHOLD",fa.N(a));F(b);return b};a.DA=function(){var a=e("ANAGLYPH");a.Da=!0;a.Z=!1;var b=S.eb();B(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");F(a);return a};a.RA=function(){var a=e("LUMINANCE");a.Z=!1;a.Da=!0;a.t[0]=1;a.t[1]=1;var b=S.eb();B(a,b);r(a,"postprocessing/postprocessing.glslv",
"postprocessing/luminance.glslf");F(a);return a};a.GA=function(){var a=e("LUMINANCE");a.Z=!1;a.Da=!0;a.t[0]=1;a.t[1]=1;var b=S.eb();B(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");F(a);return a};a.SA=function(){var a=e("LUMINANCE_X_BLUR");a.Z=!1;a.Da=!0;a.t[0]=1;a.t[1]=1;var b=S.eb();B(a,b);r(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");F(a);return a};a.HA=function(a){var b=e("POSTPROCESSING");switch(a){case "X_BLUR":b.t[0]=
1;b.t[1]=0;break;case "Y_BLUR":b.t[0]=0;b.t[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}b.Da=!0;b.Z=!1;a=S.eb();B(b,a);r(b,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");F(b);return b};a.IA=function(){var a=e("BLOOM");a.Z=!1;a.Da=!0;a.t[0]=1;a.t[1]=1;var b=S.eb();B(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");F(a);return a};a.eB=function(){var a=e("VELOCITY");a.Z=!1;a.Da=!0;a.t[0]=1;a.t[1]=1;var b=S.eb();
B(a,b);r(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");F(a);return a};a.EA=function(){var a=e("ANCHOR_VISIBILITY");a.Z=!0;a.Da=!0;a.t[0]=1;a.t[1]=1;a.de=R.Cm;r(a,"anchors.glslv","anchors.glslf");var b=S.ot(1);B(a,b);x(a,"ANCHOR_NUM",1);F(a);a.uj=new Float32Array(0);return a};a.$F=function(a,b){var f=b.length/3;if(f!=a.uj.length/3){var c=S.ot(f);B(a,c);x(a,"ANCHOR_NUM",f);F(a)}a.uj=b};a.Jj=function(a,b,f){var c=a.ni;a.bq[0]=b*a.t[0]*c;a.bq[1]=f*a.t[1]*c};a.Hg=function(a,
b){a.ni=b};a.HJ=function(a,b,f){for(var c=0;c<a.q.length;c++)if(a.q[c].type==f&&!a.q[c].Pc&&-1!=a.q[c].Fh.indexOf(b))return a.q[c];return null};a.IJ=function(a,b,f){for(var c=0;c<a.q.length;c++)if(a.q[c].type==f&&a.q[c].Pc&&-1!=a.q[c].Fh.indexOf(b))return a.q[c];return null};a.pM=function(a,b){a.Oc.set(b.Oc);a.Mi=b.Mi;a.Kj.set(b.Kj);a.$h.set(b.$h);a.rh=b.rh;a.ah=b.ah;a.Li=b.Li;a.Ai=b.Ai;a.Pl=b.Pl;a.Yf.set(b.Yf);a.Gl=b.Gl;a.Yl.set(b.Yl);a.Zl=b.Zl;a.bm.set(b.bm);a.cm=b.cm;a.Sk=b.Sk;a.vm=b.vm};a.JI=
function(a,b){for(var f=a.q,c=0;c<f.length;c++)if(f[c].type==b)return!0;return!1};a.uA=function(a){for(var b=a.X,f=0;f<b.length;f++)da.oB(b[f].Wa);R.hs(a.$a)}};b4w.module.__boundings=function(a,w){function e(a,b){for(var d=a[0],e=a[1],n=a[2],l=a[0],c=a[1],g=a[2],h=3;h<a.length;h+=3)var m=a[h],p=a[h+1],v=a[h+2],d=Math.max(d,m),e=Math.max(e,p),n=Math.max(n,v),l=Math.min(l,m),c=Math.min(c,p),g=Math.min(g,v);b.max_x=d;b.max_y=e;b.max_z=n;b.min_x=l;b.min_y=c;b.min_z=g;return b}function b(a,b){b||(b=new Float32Array(24));var d=a.max_x,e=a.max_y,n=a.max_z,l=a.min_x,c=a.min_y,g=a.min_z;b[0]=l;b[1]=c;b[2]=g;b[3]=d;b[4]=c;b[5]=g;b[6]=d;b[7]=e;b[8]=g;b[9]=l;b[10]=
e;b[11]=g;b[12]=l;b[13]=c;b[14]=n;b[15]=d;b[16]=c;b[17]=n;b[18]=d;b[19]=e;b[20]=n;b[21]=l;b[22]=e;b[23]=n;return b}function q(a,b,d){g.add(b,d,a.C);g.scale(a.C,.5,a.C);a.Ca=g.distance(a.C,b);return a}var d=w("__geometry"),h=w("__util"),p=w("__tsr"),g=w("vec3"),v=new Float32Array(24),m=new Float32Array(3),t=new Float32Array(3),z=new Float32Array(3);a.ts=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.DI=function(){return{max_x:1E12,min_x:-1E12,
max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.Qd=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.Ws=function(a,b){var d=a.max_y,e=a.max_z,n=a.min_x,l=a.min_y,c=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,d);a.max_z=Math.max(b.max_z,e);a.min_x=Math.min(b.min_x,n);a.min_y=Math.min(b.min_y,l);a.min_z=Math.min(b.min_z,c)};a.Rz=e;a.dn=function(d,g,m){m||(m=a.Qd());d=b(d,v);h.bf(d,g,d);return e(d,m)};a.HB=b;a.IM=function(b,d,e){e||
(e=a.Qd());var g=d.min_x,n=d.max_x,l=d.min_y,c=d.max_y,h=d.min_z;d=d.max_z;if(g>=b.max_x||n<=b.min_x||l>=b.max_y||c<=b.min_y||h>=b.max_z||d<=b.min_z)return e.min_x=-.1,e.max_x=.1,e.min_y=-.1,e.max_y=.1,e.min_z=-.2,e.max_z=-.1,e;e.min_x=Math.max(b.min_x,g);e.max_x=Math.min(b.max_x,n);e.min_y=Math.max(b.min_y,l);e.max_y=Math.min(b.max_y,c);e.min_z=Math.max(b.min_z,h);e.max_z=Math.min(b.max_z,d);return e};a.PM=function(b,d,e){e||(e=a.Qd());var g=b.max_x-b.min_x,n=b.max_y-b.min_y,l=b.max_z-b.min_z;e.min_x=
b.min_x-.5*(d-1)*g;e.max_x=b.max_x+.5*(d-1)*g;e.min_y=b.min_y-.5*(d-1)*n;e.max_y=b.max_y+.5*(d-1)*n;e.min_z=b.min_z-.5*(d-1)*l;e.max_z=b.max_z+.5*(d-1)*l;return e};a.fn=function(b,d,e){e||(e=a.Wj());g.transformMat4(b.C,d,e.C);e.Ca=b.Ca*h.ul(d);return e};a.en=function(a,b,d){d||(d={Gf:new Float32Array(3),Hf:new Float32Array(3),If:new Float32Array(3),C:new Float32Array([0,0,0])});p.Nj(a.C,b,d.C);g.copy(a.Gf,d.Gf);g.copy(a.Hf,d.Hf);g.copy(a.If,d.If);p.jm(d.Gf,b,d.Gf);p.jm(d.Hf,b,d.Hf);p.jm(d.If,b,d.If);
return d};a.xn=function(a,b){return{Ca:a,C:new Float32Array(b)}};a.Wj=function(){return{C:new Float32Array([0,0,0]),Ca:0}};a.wn=function(a,b,d,e){return{Gf:new Float32Array(a),Hf:new Float32Array(b),If:new Float32Array(d),C:new Float32Array([e[0],e[1],e[2]])}};a.Tz=function(){return{C:new Float32Array([0,0,0]),Ca:1E12}};a.EB=function(a,b){var d=g.subtract(b.C,a.C,g.create());0==g.length(d)&&g.set(1,0,0,d);var e=g.normalize(d,g.create()),d=g.scale(e,a.Ca,g.create());g.add(d,a.C,d);var n=g.scale(e,
-a.Ca,g.create());g.add(n,a.C,n);var l=g.scale(e,b.Ca,g.create());g.add(l,b.C,l);var c=g.scale(e,-b.Ca,g.create());g.add(c,b.C,c);d=[d,n,l,c];e=g.normalize(e,g.create());n=d[0];l=d[0];for(c=1;c<d.length;c++){var h=g.dot(d[c],e);h<g.dot(n,e)&&(n=d[c]);h>g.dot(l,e)&&(l=d[c])}e=[n,l];d=e[0];e=e[1];a.C=g.scale(g.add(d,e,g.create()),.5,g.create());a.Ca=g.length(g.subtract(e,d,g.create()))/2};a.us=function(a,b){var d=b.max_y,e=b.min_y,n=Math.max(0,d-e-2*a);return{Ca:a,height:n,C:new Float32Array([0,(d+
e)/2,0])}};a.ws=function(a,b){var d=b.max_y,e=b.min_y,n=Math.max(0,d-e);return{Ca:a,height:n,C:new Float32Array([0,(d+e)/2,0])}};a.vs=function(a,b){var d=b.max_y,e=b.min_y,n=Math.max(0,d-e);return{Ca:a,height:n,C:new Float32Array([0,(d+e)/2,0])}};a.KI=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.oE=function(a){for(var b=0,d=0,e=0,n=0,l=0,c=0,g=0,h=0,m=0;m<a.submeshes.length;m++){var p=a.submeshes[m];if(p.position.length){b=
n=p.position[0];d=l=p.position[1];e=c=p.position[2];break}}for(m=0;m<a.submeshes.length;m++)for(var p=a.submeshes[m],p=p.position,v=0;v<p.length/3;v++)var t=p[3*v],k=p[3*v+1],u=p[3*v+2],b=Math.max(t,b),d=Math.max(k,d),e=Math.max(u,e),n=Math.min(t,n),l=Math.min(k,l),c=Math.min(u,c),g=Math.max(Math.sqrt(t*t+k*k+u*u),g),h=Math.max(Math.sqrt(t*t+u*u),h);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=n;a.b4w_bounding_box.max_y=d;a.b4w_bounding_box.min_y=l;a.b4w_bounding_box.max_z=e;a.b4w_bounding_box.min_z=
c;a.b4w_bounding_sphere_radius=g;a.b4w_bounding_cylinder_radius=h};a.DC=function(b){var e=b.subarray(0,3),h=b.subarray(6,9),p=b.subarray(12,15),n=b.subarray(18,21);b=g.subtract(h,e,m);g.normalize(b,b);var l=d.JC(e,h,p,t),l=g.cross(l,b,l);g.normalize(l,l);var c=g.create(),v=g.create();g.subtract(h,e,z);v[0]=g.dot(z,b);v[1]=g.dot(z,l);h=g.create();g.subtract(p,e,z);h[0]=g.dot(z,b);h[1]=g.dot(z,l);p=g.create();g.subtract(n,e,z);p[0]=g.dot(z,b);p[1]=g.dot(z,l);n=a.Wj();p=[c,v,h,p];c=q(n,p[0],p[1]);for(n=
2;n<p.length;n++)if(g.distance(c.C,p[n])>c.Ca){for(var I=c,c=p,v=p[n],h=n-1,I=q(I,v,c[0]),x=1;x<=h;x++)if(g.distance(I.C,c[x])>I.Ca){for(var B=I,I=c,E=v,K=c[x],k=x-1,B=q(B,E,K),u=0;u<=k;u++)if(g.distance(B.C,I[u])>B.Ca){var r=E,L=K,F=I[u],f=g.subtract(L,F,z),f=g.squaredLength(f),N=g.subtract(r,F,z),P=g.squaredLength(N),N=g.subtract(r,L,z),w=g.squaredLength(N),N=f*(P+w-f),R=P*(w+f-P),f=w*(f+P-w),P=N+R+f;g.copy(r,B.C);g.scale(B.C,N/P,B.C);g.scaleAndAdd(B.C,L,R/P,B.C);g.scaleAndAdd(B.C,F,f/P,B.C);B.Ca=
g.distance(B.C,r)}I=B}c=I}n=c;b=g.scale(b,n.C[0],z);g.scaleAndAdd(b,l,n.C[1],b);g.add(b,e,n.C);return n}};b4w.module.__graph=function(a){function w(a,b,c){c||(c=null);if(e(a,b))throw"Graph already has node with given ID";a.Ka.push(b,c)}function e(a,b){for(var c=a.Ka,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function b(a,b,c,d){d||(d=null);if(e(a,b)&&e(a,c))a.ma.push(b,c,d);else throw"Wrong node IDs";}function q(a,b){if(!e(a,b))throw"Node not found";for(var c=a.Ka,d=0;d<c.length;d+=2)c[d]==b&&(c.splice(d,2),d-=2)}function d(a){a=a.Ka;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}
function h(a,b){for(var c=a.Ka,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function p(a){var b=[],c={};g(a,c);for(var d=a.Ka,e=0;e<d.length;e+=2)0==l(a,d[e])&&v(a,d[e],c,b);return{Ka:b,ma:a.ma.slice(0)}}function g(a,b){for(var c=a.Ka,d=0;d<c.length;d+=2)b[c[d]]=!1}function v(a,b,d,e){if(!d[b]){d[b]=!0;for(var l=0;l<n(a,b);l++)v(a,c(a,b,l),d,e);e.unshift(b,y(a,b))}}function m(a,b,d,e){if(!d[b]){d[b]=!0;if(10==e||30==e)for(var g=0;g<n(a,b);g++){var f=c(a,b,g);m(a,f,d,e)}if(20==e||30==e)for(g=
0;g<l(a,b);g++)f=M(a,b,g),m(a,f,d,e)}}function t(a){var b=a.Ka;a=a.ma;for(var c=[],d=[],e=[],f=0;f<b.length;f++)e[b[2*f]]=f,c.push(f,b[2*f+1]);for(f=0;f<a.length;f+=3)d.push(e[a[f]],e[a[f+1]],a[f+2]);return{Ka:c,ma:d}}function z(a,b,d){if(d.ud==d.$e){for(var e=0,g=0;e<d.$e;e++)-1!=d.be[e]&&(a[g]=e,b[g]=d.be[e],g++);return!0}if(d.$e>d.Lh||d.pf>d.qf||d.ki>d.mi||d.ji>d.li)return!1;for(var g=e=-1,f=!1;!f&&C(d,K,e,g);)if(e=K[0],g=K[1],J(d,e,g)){var h;h=d;f={};f.Vi=h.Vi;f.Wi=h.Wi;f.bp=h.bp;f.Pk=h.Pk;f.$e=
h.$e;f.Lh=h.Lh;f.af=h.af;f.ud=f.Cl=h.ud;f.ji=h.ji;f.ki=h.ki;f.pf=h.pf;f.li=h.li;f.mi=h.mi;f.qf=h.qf;f.zi=-1;f.be=h.be;f.Pf=h.Pf;f.eg=h.eg;f.fg=h.fg;f.zg=h.zg;f.Ag=h.Ag;f.$l=h.$l;h.$l[0]+=1;var f=h=f,m=e,p=g,v=f.Vi,x=f.Wi,t=f.$e,B=f.Lh,y=f.be,q=f.Pf,I=f.eg,E=f.fg,w=f.zg,da=f.Ag;D(m<t);D(p<B);D(f.ud<t);D(f.ud<B);t=++f.ud;f.zi=m;I[m]||(I[m]=t,f.ji++,w[m]&&f.pf++);w[m]||(w[m]=t,f.ki++,I[m]&&f.pf++);E[p]||(E[p]=t,f.li++,da[p]&&f.qf++);da[p]||(da[p]=t,f.mi++,E[p]&&f.qf++);y[m]=p;q[p]=m;for(y=0;y<l(v,m);y++)q=
M(v,m,y),I[q]||(I[q]=t,f.ji++,w[q]&&f.pf++);for(y=0;y<n(v,m);y++)q=c(v,m,y),w[q]||(w[q]=t,f.ki++,I[q]&&f.pf++);for(y=0;y<l(x,p);y++)q=M(x,p,y),E[q]||(E[q]=t,f.li++,da[q]&&f.qf++);for(y=0;y<n(x,p);y++)q=c(x,p,y),da[q]||(da[q]=t,f.mi++,E[q]&&f.qf++);f=z(a,b,h);D(1>=h.ud-h.Cl);D(-1!=h.zi);q=h.Vi;m=h.Wi;p=h.ud;v=h.zi;x=h.be;I=h.Pf;t=h.eg;E=h.fg;B=h.zg;w=h.Ag;if(h.Cl<p){t[v]==p&&(t[v]=0);for(da=0;da<l(q,v);da++)y=M(q,v,da),t[y]==p&&(t[y]=0);B[v]==p&&(B[v]=0);for(da=0;da<n(q,v);da++)y=c(q,v,da),B[y]==p&&
(B[y]=0);q=x[v];E[q]==p&&(E[q]=0);for(da=0;da<l(m,q);da++)y=M(m,q,da),E[y]==p&&(E[y]=0);w[q]==p&&(w[q]=0);for(da=0;da<n(m,q);da++)y=c(m,q,da),w[y]==p&&(w[y]=0);x[v]=-1;I[q]=-1;h.ud=h.Cl;h.zi=-1}}return f}function C(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var e=a.pf,f=a.qf,l=a.ki,n=a.mi,g=a.ji,h=a.li,m=a.ud,p=a.$e,v=a.Lh,x=a.be,t=a.Pf,B=a.eg,K=a.fg,q=a.zg,y=a.Ag;if(e>m&&f>m)for(;c<p&&(-1!=x[c]||0==q[c]||0==B[c]);)c++,d=0;else if(l>m&&n>m)for(;c<p&&(-1!=x[c]||0==q[c]);)c++,d=0;else if(g>m&&h>m)for(;c<p&&
(-1!=x[c]||0==B[c]);)c++,d=0;else if(0==c&&0!=a.af){for(B=0;B<p&&-1!=x[c=a.af[B]];)B++;B==p&&(c=p)}else for(;c<p&&-1!=x[c];)c++,d=0;if(e>m&&f>m)for(;d<v&&(-1!=t[d]||0==y[d]||0==K[d]);)d++;else if(l>m&&n>m)for(;d<v&&(-1!=t[d]||0==y[d]);)d++;else if(g>m&&h>m)for(;d<v&&(-1!=t[d]||0==K[d]);)d++;else for(;d<v&&-1!=t[d];)d++;return c<p&&d<v?(b[0]=c,b[1]=d,!0):!1}function J(a,b,d){var e=a.Vi,g=a.Wi,f=a.Lh,h=a.be,m=a.Pf,p=a.eg,v=a.fg,t=a.zg,B=a.Ag;D(b<a.$e);D(d<f);D(-1==h[b]);D(-1==m[d]);if(!(0,a.bp)(y(e,
b),y(g,d)))return!1;for(var K=f=0,q=0,z=0,C=0,E=0,w=0;w<n(e,b);w++){var J=c(e,b,w);if(-1!=h[J]){var ca=h[J];if(!I(g,d,ca)||!x(a.Pk,e,b,J,g,d,ca))return!1}else p[J]&&q++,t[J]&&f++,p[J]||t[J]||C++}for(w=0;w<l(e,b);w++)if(J=M(e,b,w),-1!=h[J]){if(ca=h[J],!I(g,ca,d)||!x(a.Pk,e,J,b,g,ca,d))return!1}else p[J]&&q++,t[J]&&f++,p[J]||t[J]||C++;for(w=0;w<n(g,d);w++)if(ca=c(g,d,w),-1!=m[ca]){if(J=m[ca],!I(e,b,J))return!1}else v[ca]&&z++,B[ca]&&K++,v[ca]||B[ca]||E++;for(w=0;w<l(g,d);w++)if(ca=M(g,d,w),-1!=m[ca]){if(J=
m[ca],!I(e,J,b))return!1}else v[ca]&&z++,B[ca]&&K++,v[ca]||B[ca]||E++;return q<=z&&f<=K&&C<=E}function D(a){if(!a)throw"Assertion failed";}function y(a,b){for(var c=a.Ka,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function n(a,b){for(var c=a.ma,d=0,e=0;e<c.length;e+=3)c[e]==b&&d++;return d}function l(a,b){for(var c=a.ma,d=0,e=0;e<c.length;e+=3)c[e+1]==b&&d++;return d}function c(a,b,c){a=a.ma;for(var d=0,e=0;e<a.length;e+=3)if(a[e]==b){if(d==c)return a[e+1];d++}return-1}function M(a,b,
c){a=a.ma;for(var d=0,e=0;e<a.length;e+=3)if(a[e+1]==b){if(d==c)return a[e];d++}return-1}function I(a,b,c){a=a.ma;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function x(a,b,c,d,e,f,l){for(var n=B(b,c,d),g=B(e,f,l),h=0;h<n;h++){for(var m=!1,p=0;p<g;p++)if(a(E(b,c,d,h),E(e,f,l,p))){m=!0;break}if(!m)return!1}return!0}function B(a,b,c){var d=0;a=a.ma;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&d++;return d}function E(a,b,c,d){a=a.ma;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==
b&&a[f+1]==c){if(e==d)return a[f+2];e++}return null}var K=[-1,-1];a.Qq=-1;a.WG=10;a.Dq=20;a.aI=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var e=a[d];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:c.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{Ka:b,ma:c}};a.hJ=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)d.push(b[e][0],b[e][1],b[e][2]);return{Ka:c,ma:d}};a.Qm=w;a.RK=e;a.Je=
b;a.Cj=q;a.Qh=function(a,b,c,d){if(!I(a,b,c))throw"Edge not found";a=a.ma;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(-1==d)a.splice(f,3);else{if(d==e){a.splice(f,3);break}e++}f-=3}};a.A=function(a,b){if(-1==h(a,b)){var c=d(a);w(a,c,b);return c}throw"Non-unique attribute";};a.zE=function(a,b,c,d,e){a=a.ma;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&a[f+2]==d&&(a[f+2]=e)};a.mt=d;a.Mh=h;a.m=function(a,c,d,e){c=h(a,c);d=h(a,d);if(-1!=c&&-1!=d)b(a,c,d,e);else throw"Attributes not found";
};a.U=function(a,b){for(var c=a.Ka,d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};a.sf=function(a,b){for(var c=a.ma,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.Ae=function(a,b,c){for(var d=a.ma,e=0;e<d.length;e+=3)if(d[e+1]==b){var f=d[e];if(c(f,y(a,f),d[e+2]))break}};a.tf=function(a,b,c){for(var d=a.ma,e=0;e<d.length;e+=3)if(d[e]==b){var f=d[e+1];if(c(f,y(a,f),d[e+2]))break}};a.dq=p;a.UF=function(a){a=p(a).Ka;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.aL=function(){};a.Yw=function(a,
b,c){if(!e(a,b))throw"No such node";var d={};g(a,d);m(a,b,d,c);b=[];for(var l in d)d[l]&&(l=Number(l),b.push(l,y(a,l)));a={Ka:b,ma:a.ma.slice(0)};d=a.ma;for(l=0;l<d.length;l+=3)b=d[l+1],e(a,d[l])&&e(a,b)||(d.splice(l,3),l-=3);return a};a.MC=function(a){for(var b=[],c=a.Ka,d=0;d<c.length;d+=2){var e=c[d];l(a,e)||b.push(e)}return b};a.Ut=function(a){for(var b=[],c=a.Ka,d=0;d<c.length;d+=2){var e=c[d];n(a,e)||b.push(e)}return b};a.match=function(a,b,c,d){var e={};e.Vi=t(a);e.Wi=t(b);e.bp=c||function(a,
b){return a==b};e.Pk=d||function(a,b){return a==b};d=a.Ka.length/2;var f=b.Ka.length/2;e.$e=d;e.Lh=f;e.af=0;e.ud=e.Cl=0;e.pf=e.ji=e.ki=0;e.qf=e.li=e.mi=0;e.zi=-1;e.be=Array(d);e.Pf=Array(f);e.eg=Array(d);e.fg=Array(f);e.zg=Array(d);e.Ag=Array(f);e.$l=[1];for(c=0;c<d;c++)e.be[c]=-1,e.eg[c]=0,e.zg[c]=0;for(c=0;c<f;c++)e.Pf[c]=-1,e.fg[c]=0,e.Ag[c]=0;f=Array(d);d=Array(d);if(z(f,d,e)){for(c=0;c<f.length;c++)f[c]=a.Ka[2*f[c]],d[c]=b.Ka[2*d[c]];return[f,d]}return null};a.nb=y;a.Oh=n;a.xu=l;a.wh=c;a.Yk=
M;a.gK=B;a.vh=E;a.replace=function(a,b,c){for(var e=a.ma,l=d(a),f=0;f<b.length;f++){var n=b[f];q(a,n);for(var g=0;g<e.length;g+=3)e[g]==n&&(e[g]=l),e[g+1]==n&&(e[g+1]=l),e[g]==e[g+1]&&(e.splice(g,3),g-=3)}w(a,l,c)};a.pE=function(a,b,c,d,e){if(!I(a,b,c))throw"Edge not found";a=a.ma;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&(a[f]=d,a[f+1]=e)};a.kJ=function(a,b){var c=a.Ka,d=a.ma,e;e="digraph debug {\n    node [shape=box];\n";for(var f=0;f<c.length;f+=2){var l=c[f],n=c[f+1],n=b?b(l,n):String(l);
e+="    ";e+=String(l)+' [label="'+n.replace(/\"/g,'\\"')+'"];\n'}for(f=0;f<d.length;f+=3)c=d[f],l=d[f+1],e+="    ",e+=String(c)+" -> "+String(l)+";\n";return e+="}"}};b4w.module.__nodemat=function(a,w){function e(a,c,e,k){if(c in oa)return oa[c];for(var r=Q.create(),u=a.nodes,l=a.links,n=a.animation_data,g=0;g<u.length;g++)if(!y(r,u[g],0,n,k))return oa[c]=null;if(e&&-1==J(a,r,"GROUP_OUTPUT","group"))return null;g=f(r);if(!N(r,l,g))return null;if(e)return r;for(g=0;g<l.length;g++)for(e=l[g],k=h(e.from_node,r),u=h(e.to_node,r),n=0;n<k.length;n++)for(var m=0;m<u.length;m++){for(var x=k[n],B=u[m],K=Q.nb(r,x),q=Q.nb(r,B),z=r,F=q,q=[],L=e.from_socket.identifier,E=e.to_socket.identifier,
I=K.fb,K=0;K<I.length;K++)if(I[K].identifier==L){q.push(K);break}F=F.I;for(K=0;K<F.length;K++)if(F[K].identifier==E){q.push(K);break}2==q.length&&Q.Je(z,x,B,q)}d(r);a=J(a,r,"OUTPUT","material");if(-1==a)return oa[c]=null;p(r);r=Q.Yw(r,a,Q.Dq);b(r);v(r);t(r);C(r);return oa[c]=r}function b(a){Q.U(a,function(b,f){for(var c=f.I,d=f.fb,e=0;e<c.length;e++)q(a,c[e],b,e,1);for(e=0;e<d.length;e++)q(a,d[e],b,e,0)})}function q(a,b,f,c,d){if(b.ne){var e=!0;Q.sf(a,function(a,b,k){if(!d&&a==f&&k[0]==c||d&&b==f&&
k[1]==c)e=!1});e&&(b.ne=!1)}}function d(a){var b=[];Q.U(a,function(f,c){switch(c.type){case "B4W_TRANSLUCENCY":Q.sf(a,function(a,d,e){a==f&&"Translucency"==c.fb[e[0]].name&&b.push(a,d,[e[0]+1,e[1]+1])})}});for(var f=0;f<b.length;f+=3)Q.Je(a,b[f],b[f+1],b[f+2])}function h(a,b){var f=[];Q.U(b,function(b,c){c.name==a.name&&f.push(b)});if(f.length)return f;throw"Node not found";}function p(a){var b=[];Q.U(a,function(a,f){"B4W_PARALLAX"!=f.type&&"REROUTE"!=f.type||b.push(a,f)});for(var f=0;f<b.length;f+=
2){var c=b[f],d=b[f+1];if("B4W_PARALLAX"==d.type){var e=g(a,c);if(-1!=e){var k=Q.Yk(a,e,0);Q.Qh(a,e,c,-1);-1!=k&&Q.Qh(a,k,e,-1);c=Q.nb(a,e);d.data=c.data;d.Sa[0]=c.Sa[0];Q.Cj(a,e)}d.I.splice(1,1)}else if("REROUTE"==d.type){for(var d=Q.Yk(a,c,0),r=Q.Oh(a,c),e=[],k=[],u=[],l=0;l<r;l++){var n=Q.wh(a,c,l),h=k.indexOf(n);-1!=h?u[h]+=1:(k.push(n),u.push(1),e.push(c,n))}if(-1!=d)for(r=Q.vh(a,d,c,0)[0],l=0;l<k.length;l++)for(n=0;n<u[l];n++)h=Q.vh(a,c,k[l],n)[1],Q.Je(a,d,k[l],[r,h]);for(l=0;l<e.length;l+=
2)Q.Qh(a,e[l],e[l+1],-1)}}}function g(a,b){for(var f=a.ma,c=0;c<f.length;c+=3)if(f[c+1]==b&&1==f[c+2][1])return f[c];return-1}function v(a){var b=[];Q.U(a,function(a,f){"GEOMETRY_VC"!=f.type&&"GEOMETRY_UV"!=f.type&&"GEOMETRY_NO"!=f.type&&"GEOMETRY_FB"!=f.type&&"GEOMETRY_VW"!=f.type&&"GEOMETRY_GL"!=f.type||b.push(a,f)});for(var f=[],c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],k=!0,r=0;r<f.length;r++){var l=f[r];if(z(e,l.Fa)){k=[];r=Q.Oh(a,d);for(g=0;g<r;g++){var u=Q.wh(a,d,g),n=Q.vh(a,d,u,0);k.push(d,
u,n);Q.Je(a,l.id,u,n)}for(var g=0;g<k.length;g+=3)Q.Qh(a,k[g],k[g+1],0);Q.Cj(a,d);k=!1;break}}k&&(l={id:d,Fa:e},f.push(l))}}function m(a){for(var b={},f=0;f<a.Ka.length;f+=2){var c=a.Ka[f];b[c]=[]}for(f=0;f<a.ma.length;f+=3){var d=a.ma[f],e=a.ma[f+1];b[e].push(d);b[e].push(b[d])}for(c in b)b[c]=JSON.stringify(b[c]).match(/\d+/g)||[],b[c]=b[c].map(function(a){return parseInt(a)});return b}function t(a){var b=[];Q.U(a,function(a,f){"TEXTURE_COLOR"!=f.type&&"TEXTURE_NORMAL"!=f.type||b.push(a,f)});if(b.length){for(var f=
m(a),c=[],d=0;d<b.length;d+=2){for(var e=b[d],k=b[d+1],r=!0,l=0;l<c.length;l++){var u=c[l];if(!(3<=u.Ih.length||!z(k,u.Fa)||-1<f[e].indexOf(u.id)||-1<f[u.id].indexOf(e))){for(var n=!1,g=0;g<u.Ih.length;g++){var h=u.Ih[g].id;if(-1<f[e].indexOf(h)||-1<f[h].indexOf(e)){n=!0;break}}if(!n){l=[];n=Q.xu(a,e);r={};for(g=0;g<n;g++){var p=Q.Yk(a,e,g);p in r||(r[p]=0);h=Q.vh(a,p,e,r[p]++);l.push(p,e,h)}for(var n=[],r=Q.Oh(a,e),v={},g=0;g<r;g++)p=Q.wh(a,e,g),p in v||(v[p]=0),h=Q.vh(a,e,p,v[p]++),n.push(e,p,h);
r=l.concat(n);for(g=0;g<r.length;g+=3)Q.Qh(a,r[g],r[g+1],0);Q.Cj(a,e);g={id:e,Fa:k,xB:l,yB:n};u.Ih.push(g);r=!1;break}}}r&&(u={id:e,Fa:k,Ih:[]},c.push(u))}for(d=0;d<c.length;d++){u=c[d];f=u.Ih.length;n=u.Fa.I.length;r=u.Fa.fb.length;for(l=0;l<f;l++){k=u.Ih[l];g=k.Fa;e=k.xB;k=k.yB;u.Fa.I=u.Fa.I.concat(g.I);u.Fa.fb=u.Fa.fb.concat(g.fb);for(g=0;g<u.Fa.I.length;g++)u.Fa.I[g].identifier+=A.trunc(g/n)+1;for(g=0;g<u.Fa.fb.length;g++)u.Fa.fb[g].identifier+=A.trunc(g/r)+1;for(g=0;g<e.length;g+=3)p=e[g],h=
e[g+2],h[1]+=(l+1)*n,Q.Je(a,p,u.id,h);for(g=0;g<k.length;g+=3)p=k[g+1],h=k[g+2],h[0]+=(l+1)*r,Q.Je(a,u.id,p,h)}switch(f){case 1:u.Fa.type+="2";break;case 2:u.Fa.type+="3";break;case 3:u.Fa.type+="4"}Q.Cj(a,u.id);Q.Qm(a,u.id,u.Fa)}}}function z(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==
b.data.value;default:return!1}}function C(a){var b=[];Q.U(a,function(a,f){"GEOMETRY_VC"==f.type&&b.push(a,f)});for(var f=0;f<b.length;f+=2){for(var c=b[f],d=b[f+1],e=!1,k=[],r=[],u=[[],[],[]],l=Q.Oh(a,c),n=0;n<l;n++){var g=Q.wh(a,c,n);if("SEPRGB"!=Q.nb(a,g).type){e=!1;break}k.push(c,g);for(var h={},m=Q.Oh(a,g),e=0;e<m;e++){var p=Q.wh(a,g,e);p in h||(h[p]=0);var v=Q.vh(a,g,p,h[p]++);k.push(g,p);u[v[0]].push(c,p,v)}r.push(g);e=!0}if(e){for(n=c=l=0;n<u.length;n++)u[n].length&&(l++,c|=1<<2-n);if(l){d.type+=
l;d.fb=[];for(n=0;n<u.length;n++)if(u[n].length)for(d.fb.push({Vb:0,identifier:"RGB"[n],ne:!0,name:"RGB"[n]}),e=0;e<u[n].length;e+=3)u[n][e+2][0]=A.Fj(c,n);for(n=0;n<k.length;n+=2)Q.Qh(a,k[n],k[n+1],0);for(n=0;n<r.length;n++)Q.Cj(a,r[n]);for(n=0;n<u.length;n++)for(e=0;e<u[n].length;e+=3)Q.Je(a,u[n][e],u[n][e+1],u[n][e+2])}}}}function J(a,b,f,c){a=a.nodes;for(var d=null,e=0;e<a.length;e++){var k=a[e];k.type==f&&(d=k)}return d?h(d,b)[0]:(X.error('No "'+f+'" node in node '+c),-1)}function D(a,b,f,c){return{name:a,
type:b,inputs:f,outputs:c}}function y(a,b,f,c,d){var e=b.name,g=b.type,h=[],m=[],p=[],v=[],t=null,K=[];switch(g){case "CAMERA":m=[];p=r(b);break;case "COMBRGB":case "COMBHSV":m=u(b);p=r(b);break;case "GEOMETRY":a:{for(var g=b.outputs,q=0;q<g.length;q++)if(g[q].is_linked){g=!0;break a}g=!1}if(!g)return!0;g=I(b,f);if(!g)return X.error("Geometry output is not supported"),!1;switch(g){case "GEOMETRY_UV":if(!b.uv_layer)return X.error('Missing uv layer in node "',b.name,'"'),!1;t=M("param_GEOMETRY_UV_a");
q=M("param_GEOMETRY_UV_v");h.push(L(t));h.push(L(q));p.push(E(b,"UV"));v.push(L(q));t={name:t,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return X.error("Missing vertex color layer in node ",b.name),!1;t=M("param_GEOMETRY_VC_a");q=M("param_GEOMETRY_VC_v");h.push(L(t));h.push(L(q));p.push(E(b,"Vertex Color"));v.push(L(q));t={name:t,value:b.color_layer};break;case "GEOMETRY_NO":p.push(E(b,"Normal"));break;case "GEOMETRY_FB":p.push(E(b,"Front/Back"));break;case "GEOMETRY_VW":p.push(E(b,
"View"));break;case "GEOMETRY_GL":p.push(E(b,"Global"))}break;case "GROUP":q=b.node_tree_name;switch(q){case "B4W_LINEAR_TO_SRGB":if(!n(b,[1],[1])){t=l(b,d);break}g="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!n(b,[1],[1])){t=l(b,d);break}g="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!n(b,[1],[1])){t=l(b,d);break}g="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!n(b,[1,1],[1])){t=l(b,d);break}g="B4W_REFLECT";break;case "B4W_REFRACTION":if(!n(b,[1,0],[1])){t=
l(b,d);break}g="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!n(b,[1,1,0,0,0],[1])){t=l(b,d);break}var g="B4W_PARALLAX",z=M("temp_texture");v.push(L(z));break;case "B4W_CLAMP":if(!n(b,[1],[1])){t=l(b,d);break}g="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!n(b,[0,0,0,0,0],[0])){t=l(b,d);break}g="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!n(b,[],[0])){t=l(b,d);break}g="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!n(b,[0,0,0],[0])){t=l(b,d);break}g="B4W_SMOOTHSTEP";break;default:t=l(b,d)}m=u(b);p=r(b);
"B4W_TRANSLUCENCY"==q&&(q=k("TranslucencyParams","TranslucencyParams",[0,0,0,0]),q.ne=p[0].ne,p.push(q));break;case "LAMP":t=b.lamp;if(!t)return X.error("There is no lamp in node: "+b.name),!1;p.push(E(b,"Color"));p.push(E(b,"Light Vector"));p.push(E(b,"Distance"));p.push(E(b,"Visibility Factor"));t.uuid in la?v.push(L(M("param_LAMP_lamp_index"),la[t.uuid],1)):(la[t.uuid]=ma,v.push(L(M("param_LAMP_lamp_index"),ma++,1)));t=la;break;case "NORMAL":m=u(b);p=r(b);q=E(b,"Normal");v.push(L(M("param_NORMAL_Normal"),
q.Vb,3));break;case "MAPPING":q=b.vector_type;g="MAPPING";m.push(B(b,"Vector"));p.push(E(b,"Vector"));var z=b.rotation,F=b.scale,N=b.translation,C=da.create(),D=A.CB(z),P=new Float32Array([F[0],0,0,0,F[1],0,0,0,F[2]]);da.multiply(D,P,C);C=A.GD(C,ca.create());switch(q){case "POINT":C[12]=N[0];C[13]=N[1];C[14]=N[2];break;case "TEXTURE":C[12]=N[0];C[13]=N[1];C[14]=N[2];C=ca.invert(C,C);break;case "NORMAL":ca.invert(C,C),ca.transpose(C,C)}switch(q){case "NORMAL":K.push(["MAPPING_IS_NORMAL",1]);case "TEXTURE":K.push(["MAPPING_TRS_MATRIX",
S.N(C,16)]);break;case "POINT":0!==fa.length(z)?K.push(["MAPPING_TRS_MATRIX",S.N(C,16)]):(0!==fa.length(F)&&K.push(["MAPPING_SCALE",S.N(F,3)]),0!==fa.length(N)&&K.push(["MAPPING_TRANSLATION",S.N(N,3)]));break;case "VECTOR":0!==fa.length(z)?K.push(["MAPPING_TRS_MATRIX",S.N(C,16)]):0!==fa.length(F)&&K.push(["MAPPING_SCALE",S.N(F,3)])}b.use_min&&K.push(["MAPPING_MIN_CLIP",S.N(b.min,3)]);b.use_max&&K.push(["MAPPING_MAX_CLIP",S.N(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":t=B(b,"Color");t.Vb.splice(3);
m.push(t);(t=B(b,"Alpha"))?m.push(t):m.push(k("Alpha","Alpha",1));t=B(b,"Spec");t.Vb.splice(3);m.push(t);q=B(b,"Normal");q.Vb.splice(3);m.push(q);p.push(E(b,"Color"));p.push(E(b,"Alpha"));p.push(E(b,"Normal"));"MATERIAL_EXT"==g&&((t=B(b,"Emit"))?m.push(t):m.push(k("Emit","Emit",0)),t=B(b,"Translucency"),t.Vb=0,t.name="Translucency",t.identifier="Translucency",t?m.push(t):m.push(k(t.name,t.identifier,t.Vb)),t=B(b,"Translucency"),t.Vb=[0,0,0,0],t.name="TranslucencyParams",t.identifier="TranslucencyParams",
t?m.push(t):m.push(k(t.name,t.identifier,t.Vb)),t=B(b,"Reflectivity"),z=B(b,"Ray Mirror"),t?z="Reflectivity":z?(t=z,z="Ray Mirror"):z="Reflectivity",t?m.push(t):m.push(k(z,z,0)),(t=B(b,"SpecTra"))?m.push(t):m.push(k("SpecTra","SpecTra",0)),p.push(E(b,"Diffuse")),p.push(E(b,"Spec")));z=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":t=b.specular_hardness;break;case "WARDISO":t=b.specular_slope;break;case "TOON":t=b.specular_toon_size;z=b.specular_toon_smooth;break;default:X.error("unsupported specular shader: "+
b.specular_shader+' (material "'+b.material_name+'")'),t=b.specular_hardness}switch(b.diffuse_shader){case "LAMBERT":N=F=0;break;case "OREN_NAYAR":F=b.roughness;N=0;break;case "FRESNEL":F=b.diffuse_fresnel;N=b.diffuse_fresnel_factor;break;default:X.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),N=F=0}v.push(L(M("param_MATERIAL_diffuse"),[F,N],2));v.push(L(M("param_MATERIAL_spec"),[b.specular_intensity,t,z],3));t={name:b.name,value:{zF:b.specular_shader,
qB:b.diffuse_shader,Mg:b.use_shadeless,Zh:b.specular_alpha}};q.ne&&K.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&K.push(["USE_MATERIAL_DIFFUSE",1]);b.use_specular&&K.push(["USE_MATERIAL_SPECULAR",1]);break;case "MATH":switch(b.operation){case "ADD":g="MATH_ADD";break;case "SUBTRACT":g="MATH_SUBTRACT";break;case "MULTIPLY":g="MATH_MULTIPLY";break;case "DIVIDE":g="MATH_DIVIDE";break;case "SINE":g="MATH_SINE";break;case "COSINE":g="MATH_COSINE";break;case "TANGENT":g="MATH_TANGENT";break;case "ARCSINE":g=
"MATH_ARCSINE";break;case "ARCCOSINE":g="MATH_ARCCOSINE";break;case "ARCTANGENT":g="MATH_ARCTANGENT";break;case "POWER":g="MATH_POWER";break;case "LOGARITHM":g="MATH_LOGARITHM";break;case "MINIMUM":g="MATH_MINIMUM";break;case "MAXIMUM":g="MATH_MAXIMUM";break;case "ROUND":g="MATH_ROUND";break;case "LESS_THAN":g="MATH_LESS_THAN";break;case "GREATER_THAN":g="MATH_GREATER_THAN";break;case "MODULO":g="MATH_MODULO";break;case "ABSOLUTE":g="MATH_ABSOLUTE";break;default:return X.error("Unsupported MATH operation: "+
b.operation),!1}K.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);m=u(b);p=r(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":g="MIX_RGB_MIX";break;case "ADD":g="MIX_RGB_ADD";break;case "MULTIPLY":g="MIX_RGB_MULTIPLY";break;case "SUBTRACT":g="MIX_RGB_SUBTRACT";break;case "SCREEN":g="MIX_RGB_SCREEN";break;case "DIVIDE":g="MIX_RGB_DIVIDE";break;case "DIFFERENCE":g="MIX_RGB_DIFFERENCE";break;case "DARKEN":g="MIX_RGB_DARKEN";break;case "LIGHTEN":g="MIX_RGB_LIGHTEN";break;case "OVERLAY":g="MIX_RGB_OVERLAY";
break;case "DODGE":g="MIX_RGB_DODGE";break;case "BURN":g="MIX_RGB_BURN";break;case "HUE":g="MIX_RGB_HUE";break;case "SATURATION":g="MIX_RGB_SATURATION";break;case "VALUE":g="MIX_RGB_VALUE";break;case "COLOR":g="MIX_RGB_COLOR";break;case "SOFT_LIGHT":g="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":g="MIX_RGB_LINEAR_LIGHT";break;default:return X.error("Unsupported MIX_RGB blend type: "+b.blend_type),!1}K.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);m=u(b);p=r(b);break;case "OUTPUT":m=u(b);p=[];
break;case "RGB":q=d+"%join%"+b.name;q={name:"-1",value:q};v.push(q);p.push(E(b,"Color"));break;case "SEPRGB":case "SEPHSV":m=u(b);p=r(b);break;case "TEXTURE":g=x(b);if("TEXTURE_EMPTY"==g)p.push(E(b,"Color")),p.push(E(b,"Normal")),p.push(E(b,"Value"));else{m.push(B(b,"Vector"));if("TEXTURE_COLOR"==g||"TEXTURE_ENVIRONMENT"==g)p.push(E(b,"Color")),p.push(E(b,"Value"));if("TEXTURE_NORMAL"==g){if("ENVIRONMENT_MAP"==b.texture.type)return X.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),!1;
p.push(E(b,"Normal"));p.push(E(b,"Value"))}z=M("param_TEXTURE_texture");v.push(L(z));t={name:z,value:b.texture}}break;case "VALUE":g="VALUE";q=d+"%join%"+b.name;q={name:"-1",value:q};v.push(q);p.push(E(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":g="VECT_MATH_ADD";break;case "SUBTRACT":g="VECT_MATH_SUBTRACT";break;case "AVERAGE":g="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":g="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":g="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":g=
"VECT_MATH_NORMALIZE";break;default:return X.error("Unsupported VECT_MATH operation: "+b.operation),!1}m=u(b);p=r(b);break;default:m=u(b),p=r(b)}e={name:e,type:g,Tj:h,I:m,fb:p,Sa:v,data:t,Rf:K};Q.Qm(a,Q.mt(a),e);if(e="GEOMETRY"==b.type)a:{e=b.outputs;for(m=h=0;m<e.length;m++)if(e[m].is_linked&&h++>f){e=!0;break a}e=!1}return e&&!y(a,b,++f,c,d)?!1:!0}function n(a,b,f){for(var c=a.inputs,d=a.outputs,e=a.node_tree_name,k=0;k<b.length;k++){var r=c[k],u=b[k];if(!r||r.default_value instanceof Array!=u)return X.warn('Wrong inputs for custom node group "'+
a.name+'" of type: "',e,'".Processing as general node group.'),!1}for(k=0;k<f.length;k++)if(b=d[k],c=f[k],!b||b.default_value instanceof Array!=c)return X.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',e,'".Processing as general node group.'),!1;return!0}function l(a,b){var f=a.node_group.node_tree,d={},k;for(k in f)if("links"==k||"nodes"==k){d[k]=[];for(var r=0;r<f[k].length;r++){d[k][r]={};for(var u in f[k][r])if("links"==k){d[k][r][u]={};for(var l in f[k][r][u])d[k][r][u][l]=
c(f[k][r][u][l])}else d[k][r][u]=c(f[k][r][u])}}else d[k]=c(f[k]);f=a.node_tree_name;if("B4W_REPLACE"==f||"B4W_LEVELS_OF_QUALITY"==f)k=D("Group input","GROUP_INPUT",[],a.inputs),r=D("Group output","GROUP_OUTPUT",a.outputs,[]),u=null,u="B4W_REPLACE"==f||"B4W_LEVELS_OF_QUALITY"==f&&(ha.quality==ka.Df||ha.Yn)?{from_node:k,from_socket:k.outputs[1],to_node:r,to_socket:r.inputs[0]}:{from_node:k,from_socket:k.outputs[0],to_node:r,to_socket:r.inputs[0]},d.nodes=[k,r],d.links=[u];f=a.name;k=d.nodes;r=d.links;
for(u=0;u<k.length;u++)k[u].name=F(k[u].type,f,k[u].name);for(u=0;u<r.length;u++)r[u].from_node.name=F(r[u].from_node.type,f,r[u].from_node.name),r[u].to_node.name=F(r[u].to_node.type,f,r[u].to_node.name);return{SD:e(d,a.node_group.uuid,!0,b),TD:d.links}}function c(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?A.zk(a):a}function M(a){Z[a]||(Z[a]=0);var b=a+Z[a],b=b.replace(/ /g,"_").replace(/\//g,"_");Z[a]++;return b}function I(a,b){for(var f=a.outputs,c=0,d=0;d<f.length;d++){var e=
f[d];if(e.is_linked&&!(c++<b))switch(e.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";default:return null}}}function x(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,f=!1,c=!1,d=!1,e=0;e<b.length;e++){var k=b[e];if(k.is_linked)switch(k.identifier){case "Color":f=!0;break;case "Normal":c=!0;break;case "Value":d=!0;break;
default:throw"Unknown texture output";}}if(f)return c&&X.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(c)return"TEXTURE_NORMAL";if(d)return"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function B(a,b){for(var f=a.inputs,c=0;c<f.length;c++){var d=f[c];if(d.identifier==b)return K(d)}return null}function E(a,b){for(var f=a.outputs,c=0;c<f.length;c++){var d=f[c];if(d.identifier==
b)return K(d)}return null}function K(a){var b=a.name,f=a.identifier,c=a.is_linked;a=a.default_value;a=A.jg(a)?a.slice(0):a;return{name:b,identifier:f,ne:c,Vb:a}}function k(a,b,f){return{name:a,identifier:b,ne:!1,Vb:f}}function u(a){for(var b=[],f=0;f<a.inputs.length;f++){var c=K(a.inputs[f]);c.Vb.length&&c.Vb.splice(3);b.push(c)}return b}function r(a){for(var b=[],f=0;f<a.outputs.length;f++){var c=K(a.outputs[f]);b.push(c)}return b}function L(a,b,f){b=null===b||void 0===b?null:S.N(b,f);return{name:a,
value:b}}function F(a,b,f){return"GROUP_INPUT"==a?b+"*GI*"+f:"GROUP_OUTPUT"==a?b+"*GO*"+f:b+"%join%"+f}function f(a){var b=[];Q.U(a,function(a,f){"GROUP"==f.type&&b.push(f)});return b}function N(a,b,f){for(var c=0;c<f.length;c++){var d=f[c].data.SD,e=f[c].data.TD;if(!d)return!1;Q.U(d,function(b,f){Q.Qm(a,Q.mt(a),f)});for(d=0;d<e.length;d++)b.push(e[d]);U(f[c],b,a)}return!0}function P(a,b,f,c,d,e){switch(a.type){case "GROUP":a.name==b&&c.push(f);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||d.push(f);
break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||e.push(f)}}function V(a,b,f){for(var c=[],d=0;d<f.length;d++){for(var e=f[d],k=null,r=0;r<b.length;r++)if(e.from_socket.identifier==b[r].to_socket.identifier){k=b[r];break}k?(e.from_node=k.from_node,e.from_socket=k.from_socket):c.push(e)}for(d=0;d<b.length;d++)a.splice(a.indexOf(b[d]),1);return c}function R(a,b){if(b.length)for(var f=b[0].from_node.name,c=0;c<a.length;c++)a[c].from_node.name==f&&b.push(a[c])}function ea(a,b,f,c){for(var d=0;d<c.length;d++){for(var e=
c[d],k,r=0;r<f.I.length;r++)if(e.from_socket.identifier==f.I[r].identifier){k=f.I[r].Vb;break}for(var r=e,u=b,l=k,n=h(r.to_node,u),g=0;g<n.length;g++)for(var m=Q.nb(u,n[g]),p=0;p<m.I.length;p++)if(m.I[p].identifier==r.to_socket.identifier){m.I[p].Vb=l;break}e=a.indexOf(e);-1!=e&&a.splice(e,1)}}function U(a,b,f){for(var c=a.name,d=[],e=[],k=[],r=[],u=0;u<b.length;u++){var l=b[u];P(l.from_node,c,l,d,k,r);P(l.to_node,c,l,e,k,r)}e=V(b,e,k);d=V(b,r,d);R(b,e);ea(b,f,a,e);if(d.length){var n;Q.U(f,function(a,
b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(c+"*GO*")||(n=b)});ea(b,f,n,d)}}var X=w("__print"),Q=w("__graph"),S=w("__shaders"),A=w("__util"),ka=w("__config"),fa=w("vec3");w("vec4");var da=w("mat3"),ca=w("mat4"),Z={},oa={},la={},ma=0;new Float32Array(4);var ha=ka.p;a.vA=e;a.wA=function(a){var b=[],f={};Z={};var c=Q.dq(a);Q.U(c,function(a,c){var d;d=[];for(var e=[],k=[],r=[],u=[],l=[],n=0;n<c.I.length;n++){var g=c.I[n];if(g.ne)d.push(null),e.push(null);else{d.push(M("in_"+c.type+"_"+g.identifier));var h=
S.N(g.Vb,0);ha.Gw&&(0<=c.type.indexOf("MIX_RGB_")&&("Color1"==g.identifier||"Color2"==g.identifier||"Fac"==g.identifier)||0<=c.type.indexOf("MATH_")&&("Value"==g.identifier||"Value_001"==g.identifier)||0<=c.type.indexOf("VECT_MATH_")&&"Vector_001"==g.identifier)&&(g=h,g=g.replace(/(,)/g,"$1 "),g=g.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),g=g.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),h=g=g.replace(/\s+/g,""));e.push(h)}}for(n=0;n<c.fb.length;n++)g=
c.fb[n],g.ne?k.push(null):k.push(M("out_"+c.type+"_"+g.identifier));for(n=0;n<c.Sa.length;n++)g=c.Sa[n],r.push(g.name),u.push(g.value);for(n=0;n<c.Tj.length;n++)l.push(c.Tj[n].name);d={id:c.type,I:d,Co:e,fb:k,Sa:r,Hl:u,Tj:l,Rf:JSON.parse(JSON.stringify(c.Rf))};b.push(d);f[a]=d});Q.sf(c,function(a,b,d){var e=Q.nb(c,a);Q.nb(c,b);var k=e.fb[d[0]];a=f[a].fb;b=f[b].I;e=a[d[0]]||M("out_"+e.type+"_"+k.identifier);a[d[0]]=e;b[d[1]]=e});return b};a.Y=function(){for(var a in oa)delete oa[a];for(var b in la)delete la[b];
ma=0}};b4w.module.__shaders=function(a,w){function e(a,c,d){var e=a.Qf;"string"==typeof d&&(a=b(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==c){e[a][1]=d;return}e.push([c,d])}function b(a,b){for(var c=a.Qf,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function q(a,b){var c=a+b;if(M[c])return M[c];if(n){var d=n[b];if(!d)return null}else{d=D.OC(a+b);if(!d)return null;d=l.Cv.parse(d)}return M[c]=d}function d(a,b,c){function d(b){b=b.a;for(var c=0;c<b.length;c++){var m=b[c];switch(m.type){case "condition":a:for(var m=
m.a,K=0;K<m.length;K++){var I=m[K];switch(I.type){case "if":case "elif":var E=I.c;try{var P=e(E)}catch(ma){throw"Failed to process #"+I.type+" expression: "+E.join(" ");}if(P){d(I.group);break a}break;case "else":d(I.group);break a;case "ifdef":I.name in g&&d(I.group);break;case "ifndef":I.name in g||d(I.group)}}break;case "include":m=q(y.shaders_dir,y.lF+m.file);d(m);break;case "var":case "export":case "import":break;case "define":K=m.name;g[K]=m.b;m.Sa&&(p[K]=m.Sa);break;case "error":throw"Shader error: #error "+
m.b.join(" ");case "line":break;case "pragma":f.push("#pragma "+m.name+" "+m.b.join(" "));break;case "undef":m=m.name;delete g[m];delete p[m];break;case "warning":z.warn("Shader warning: #warning "+m.b.join(" "));break;case "extension":f.push("#extension "+h(m.b,g,p,!1));break;case "#":break;case "node":t[m.name]=m;break;case "nodes_global":m=l;for(K=0;K<m.length;K++)if(I=m[K],E=t[I.id])for(var w=0,J=0;J<E.k.length;J++){var H=E.k[J];"node_param"==H.type&&(H=H.qualifier.join(" ")+" ","vert"==a?H+=
I.Tj[w]:"frag"==a&&(H+=I.Sa[w],null!==I.Hl[w]&&(H+=" = "+I.Hl[w])),H+=";",f.push(H),w++)}break;case "nodes_main":m=l;for(K=0;K<m.length;K++)if(I=m[K],E=t[I.id]){w={};J={};for(H=0;H<I.Rf.length;H++)J[I.Rf[H][0]]=[I.Rf[H][1]];A=M=D=0;for(var H=I,aa=E.k,na=w,Fa=J,W=0;W<aa.length;W++){var ba=aa[W];switch(ba.type){case "node_in":var ta=H.I[D];if(null!==H.Co[D]){if(("MATERIAL"==H.id&&3===D||"MATERIAL_EXT"==H.id&&3===D)&&ba.e){na[ba.name]=H.Co[D];D++;continue}var X=ba.qualifier.join(" ")+" ",X=X+ta,X=X+
(" = "+H.Co[D]),X=X+";";f.push(X)}na[ba.name]=ta;D++;break;case "node_out":ta=H.fb[M];if(!ba.e||-1<C.indexOf(ta))X=ba.qualifier.join(" ")+" ",X+=ta,X+=";",f.push(X),na[ba.name]=ta;-1<C.indexOf(ta)&&(Fa["USE_OUT_"+ba.name]=[1]);M++;break;case "node_param":"vert"==a?ta=H.Tj[A]:"frag"==a&&(ta=H.Sa[A]),na[ba.name]=ta,A++}}r(I,E.f,w,J)}break;case "lamp":x[m.name]=m;break;case "lamps_main":m=n;for(K=0;K<m.length;K++)if(I=m[K],I.tD)for(E=x[I.type].f,w=0;w<E.length;w++){J=E[w];H=[];for(aa=0;aa<J.b.length;aa++){na=
J.b[aa];switch(na){case "LAMP_IND":na=I.index;break;case "LAMP_LIGHT_FACT_IND":na=I.yD;break;case "LAMP_FAC_CHANNELS":na=I.xD;break;case "LAMP_SPOT_SIZE":na=v(I.ye);break;case "LAMP_SPOT_BLEND":na=v(I.ai||.01);break;case "LAMP_LIGHT_DIST":na=v(I.distance);break;case "LAMP_SHADOW_MAP_IND":na=I.XB?1:0}H.push(na)}f.push(H.join(" "))}break;case "textline":f.push(h(m.b,g,p,!1));break;default:throw"Unknown element type: "+m.type;}}}function e(a,b){var f=h(a,g,p,!0,b);return J.Cv.parse(f)}function r(a,b,
c,d){for(var k=0;k<b.length;k++){var l=b[k];switch(l.type){case "node_condition":a:for(var n=a,l=l.a,m=c,v=d,t=0;t<l.length;t++){var x=l[t];switch(x.type){case "node_if":case "node_elif":var K=x.c;try{var q=e(K,v)}catch(B){throw"Failed to process #"+x.type+" expression: "+K.join(" ");}if(q){r(n,x.f,m,v);break a}break;case "node_else":r(n,x.f,m,v);break a;case "node_ifdef":(x.name in g||x.name in v)&&r(n,x.f,m,v);break;case "node_ifndef":x.name in g||x.name in v||r(n,x.f,m,v)}}break;case "textline":n=
[];for(m=0;m<l.b.length;m++)v=l.b[m],v in c?n.push(c[v]):n.push(v);f.push(h(n,g,p,!0,d))}}}var l=c.cp,n=c.Lo;c=c.Qf||[];for(var f=[],g={},m=0;m<c.length;m++)g[c[m][0]]=[c[m][1]];for(m=0;m<l.length;m++)g["USE_NODE_"+l[m].id]=[1];var p={},t={},x={},C=[];for(m in l)for(var I in l[m].I)C.push(l[m].I[I]);d(b);var D=0,M=0,A=0;return f.join("\n")}function h(a,b,c,d,e){var r=[];p(a,b,c,d,r,e);return r.join(" ")}function p(a,b,c,d,e,r){for(var l=0;l<a.length;l++){var n=a[l];n in b||r&&n in r?(n=r&&r[n]||b[n],
0==n.length&&d?e.push(0):p(n,b,c,d,e,r)):e.push(n)}}function g(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);C.oA(d,b,c);return d}function v(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return m(a);case 2:return"vec2("+m(a[0])+","+m(a[1])+")";case 3:return"vec3("+m(a[0])+","+m(a[1])+","+m(a[2])+")";case 4:return"vec4("+m(a[0])+","+m(a[1])+","+m(a[2])+","+m(a[3])+")";case 9:return"mat3("+m(a[0])+","+m(a[1])+","+m(a[2])+","+m(a[3])+","+m(a[4])+","+m(a[5])+","+m(a[6])+
","+m(a[7])+","+m(a[8])+")";case 16:return"mat4("+m(a[0])+","+m(a[1])+","+m(a[2])+","+m(a[3])+","+m(a[4])+","+m(a[5])+","+m(a[6])+","+m(a[7])+","+m(a[8])+","+m(a[9])+","+m(a[10])+","+m(a[11])+","+m(a[12])+","+m(a[13])+","+m(a[14])+","+m(a[15])+")";default:throw"Wrong glsl value dimension";}}function m(a){return a%1?String(a):String(a)+".0"}var t=w("__config"),z=w("__print"),C=w("__debug"),J=w("__gpp_eval"),D=w("__assets");w("__util");var y=t.Yb;if(b4w.module_check("shader_texts"))var n=w("shader_texts"),
l=null;else n=null,l=w("__gpp_parser");var c={},M={},I=[],x=null;a.Bc=function(a){x=a};a.B=e;a.zC=b;a.bL=function(a,b){for(var c=a.Qf,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.TE=function(a){a.Qf=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE USE_REFRACTION SHORE_SMOOTHING SKINNED SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
c=0;c<b.length;c++){var d=b[c],u;switch(d){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "USE_REFRACTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":u=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":u=1;break;case "SHADOW_TEX_RES":u=v(2048);break;case "AA_METHOD":u="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":u="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":u="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":u="POST_EFFECT_NONE";break;case "SHADOW_SRC":u="SHADOW_SRC_NONE";break;case "SHADOW_DST":u=
"SHADOW_DST_NONE";break;case "SSAO_QUALITY":u="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":u="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":u="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":u=t.p.precision;break;case "EPSILON":u="highp"==t.p.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":u="u_va_frame_factor";break;default:z.error("Unknown directive ("+a.sm+", "+a.Tk+"): "+d)}e(a,d,u)}};a.MK=function(a){return a.sm};a.Ht=function(a){return a.Tk};a.UK=function(a,c){for(var d=
c.Qf,k=0;k<d.length;k++){var u=d[k][0],r=d[k][1];b(a,u)&&e(a,u,r)}};a.rC=function(a){var b=JSON.stringify(a),e=c[b];if(e)return e;var k=a.Tk,e=q(y.shaders_dir,a.sm),k=q(y.shaders_dir,k);if(!e||!k)return null;var u=d("vert",e,a),r=d("frag",k,a),e=x,l=g(e,b,u,e.VERTEX_SHADER),n=g(e,b,r,e.FRAGMENT_SHADER),k=e.createProgram();e.attachShader(k,l);e.attachShader(k,n);e.linkProgram(k);e.validateProgram(k);e.getProgramParameter(k,e.VALIDATE_STATUS)==e.VG&&z.error("shader program is not valid",b);C.pA(k,b,
l,n,u,r);a={yx:l,WB:n,wj:k,attributes:{},Oj:{},qj:[],jp:{},hx:[],tb:a};r=e.getProgramParameter(k,e.ACTIVE_ATTRIBUTES);for(u=0;u<r;u++)l=e.getActiveAttrib(k,u).name,a.attributes[l]=e.getAttribLocation(k,l);r=e.getProgramParameter(k,e.ACTIVE_UNIFORMS);for(u=0;u<r;u++)l=e.getActiveUniform(k,u).name.split("[0]").join(""),a.Oj[l]=e.getUniformLocation(k,l);return c[b]=e=a};a.lJ=function(){return I};a.sC=function(){return c};a.Y=function(){for(var a in c){var b=c[a];x.deleteProgram(b.wj);x.deleteShader(b.yx);
x.deleteShader(b.WB);delete c[a]}for(var d in M)delete M[d];for(var e in I)delete I[e]};a.mJ=function(a){var b=a.Qf;z.log("Shader: "+a.sm+" "+a.Tk+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)z.log("  "+b[a][0],b[a][1])};a.N=v;a.bs=function(a,b){return b in a.Oj?!0:!1};a.RC=function(a){return(x.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__debug=function(a,w){function e(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function b(a,b){typeof a!=typeof b&&p.sa("Structure assertion failed: incompatible types");for(var c in a)c in b||p.sa("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||p.sa("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&p.sa("Structure assertion failed: incompatible types for key "+c)}var q=
w("__extensions"),d=w("__print"),h=w("__textures"),p=w("__util"),g=null,v={},m=!1,t={},z=[],C=-1,J=null,D=!1;a.gr={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.Bc=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(v[a[d]]=d)}g=a};a.nA=function(a){if(m){var b=g.getError();b!=g.NO_ERROR&&(b in v?p.sa("GL Error: "+b+", gl."+v[b]+" ("+
a+")"):p.sa("Unknown GL error: "+b+" ("+a+")"))}};a.iA=function(){if(m)switch(g.checkFramebufferStatus(g.FRAMEBUFFER)){case g.FRAMEBUFFER_COMPLETE:break;case g.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:d.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case g.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:d.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case g.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:d.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case g.FRAMEBUFFER_UNSUPPORTED:d.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:d.error("FRAMEBUFFER CHECK FAILED")}};a.kA=function(){if(-1!=C)return C;g.bindFramebuffer(g.FRAMEBUFFER,g.createFramebuffer());var a=h.Hk("DEBUG",h.wi);h.resize(a,1,1);g.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,a.Sb,a.Wa,0);g.checkFramebufferStatus(g.FRAMEBUFFER)!=g.FRAMEBUFFER_COMPLETE?(C=!0,d.warn("depth-only issue was found")):C=!1;g.bindFramebuffer(g.FRAMEBUFFER,null);return C};
a.oA=function(a,b,c){if(m&&!g.getShaderParameter(a,g.COMPILE_STATUS))throw c=e(c),d.error("shader compilation failed:\n"+c+"\n"+g.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.pA=function(a,b,c,h,p,v){if(m&&!g.getProgramParameter(a,g.LINK_STATUS)){var t=q.xC();t&&(p=t.getTranslatedShaderSource(c),v=t.getTranslatedShaderSource(h));p=e(p);v=e(v);d.error("shader linking failed:\n"+p+"\n\n\n"+v+"\n"+g.getProgramInfoLog(a)+" ("+b+")");throw"Engine failed: see above for error messages";
}};a.Ep=function(a){m=a};a.BJ=function(a){t[a]=a in t?t[a]+1:1};a.update=function(){for(var a in t)d.log(a,t[a]),t[a]=0};a.Rk=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(p.jg(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}z.push(a)};a.bv=function(){for(var a=1,b=0;b<z.length;b++){var c=z[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],p.jg(a))for(var d=0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);
z.push(c)};var y=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.Iv=function(a){a||(a=1);for(var b=0,c={},e=Math.max(0,performance.now()-1E3*a),g=0;g<z.length;g++){var h=z[g];a=h[0];if(!(a<e)){var m=String(h[1]);c[m]||(c[m]=y[b++%y.length]);a=["%c"+(a/1E3).toFixed(6),c[m],m];for(m=2;m<h.length;m++)a.push(h[m]);d.log.apply(this,a)}}z.splice(0)};a.lp=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-1E3*a),e=0;e<z.length;e++){var g=z[e];a=g[0];
if(!(a<c))for(var h=2;h<g.length;h++){var m=String(g[1]);3<g.length&&(m+="_"+String(h-2));b[m]||(b[m]=m+"\n");b[m]+=String(a)+" "+g[h]+"\n"}}a="";for(m in b)a+=b[m]+"\n\n";d.log(a);z.splice(0)};a.LI=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&b("trident")&&b("msie");case "opera":return b("opera")&&
b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.$r=function(a){if(p.jg(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.vI=function(a,b){typeof a!=b&&p.sa("Type assertion failed: value type is not a {"+b+"}:",a)};a.tI=b;a.uI=function(a){D?b(a,J):D=!0;J=a}};b4w.module.__textures=function(a,w){function e(){return{name:"",type:0,source:"",width:0,height:0,tn:1,jk:!0,Ig:1024,Us:!1,$d:null,hb:null,Rh:null,ew:1,we:0,Sh:!1,um:!1,ig:!1,V:0,Ha:0,th:0,tG:!1,Jg:!1,Zo:0,bc:0,Sb:0,Wa:null,wf:null}}function b(b,c,d){var r=b.type,g=new Uint8Array([204,204,204,255]),h=e();switch(r){case "DATA_TEX2D":case "IMAGE":var f=B.createTexture(),m=B.TEXTURE_2D;B.bindTexture(m,f);B.texImage2D(m,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,g);b.image&&"MOVIE"==b.image.source&&(h.ig=
!0,h.V=b.frame_start,h.Ha=b.frame_offset,h.th=b.frame_duration,h.tG=b.use_auto_refresh,h.Jg=b.use_cyclic,h.Zo=b.movie_length,0!=h.Ha&&J.warn('Frame offset for texture "'+b.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":f=B.createTexture();m=B.TEXTURE_2D;B.bindTexture(m,f);if("NONE"==b.b4w_source_type)return null;if("SCENE"==b.b4w_source_type)if(b.b4w_source_id&&(d=n.Xb("name",b.b4w_source_id,d)))h.Ig=b.b4w_source_size,d.Vd=d.Vd||[],d.Vd.push(b),
B.texImage2D(m,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,g);else return null;break;case "ENVIRONMENT_MAP":f=B.createTexture();m=B.TEXTURE_CUBE_MAP;B.bindTexture(m,f);d="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var p=0;6>p;p++)B.texImage2D(B["TEXTURE_CUBE_MAP_"+d[p]],0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,g);break;case "VORONOI":case "BLEND":return null;default:return J.error('texture "'+b.name+'" has unsupported type "'+r+'"'),null}("NONE"!=r||b.b4w_enable_canvas_mipmapping&&
"CANVAS"==b.b4w_source_type)&&"DATA_TEX2D"!=r?B.texParameteri(m,B.TEXTURE_MIN_FILTER,E[l.im]):B.texParameteri(m,B.TEXTURE_MIN_FILTER,B.LINEAR);B.texParameteri(m,B.TEXTURE_MAG_FILTER,B.LINEAR);g=m;d=b.b4w_anisotropic_filtering;"DEFAULT"===d&&(d=c);"OFF"!==d&&l.kk&&(c=y.mC())&&(d=parseFloat(d.split("x")[0]),B.texParameterf(g,c.TEXTURE_MAX_ANISOTROPY_EXT,d));"REPEAT"!=b.extension||b.b4w_shore_dist_map?(B.texParameteri(m,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(m,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE)):
(B.texParameteri(m,B.TEXTURE_WRAP_S,B.REPEAT),B.texParameteri(m,B.TEXTURE_WRAP_T,B.REPEAT));h.type=a.Yg;h.width=1;h.height=1;h.Wa=f;h.Sb=m;"CANVAS"==b.b4w_source_type&&"NONE"==r?(r=b.b4w_source_id,f=b.b4w_source_size,h.Us=b.b4w_enable_canvas_mipmapping,h.name=r,h.source="CANVAS",m=document.createElement("canvas"),m.setAttribute("id",r),m.width=f,m.height=f,h.$d=m.getContext("2d"),I[r]=h,q(h)):"SCENE"==b.b4w_source_type&&"NONE"==r?(h.name=b.b4w_source_id,h.source="SCENE"):(h.name=b.name,h.source=r,
B.generateMipmap(m),B.bindTexture(m,null));return b.d=h}function q(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Sb;B.bindTexture(b,a.Wa);var c=g(a),d=v(a),e=a.$d.canvas;B.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,!0);B.texImage2D(b,0,c,c,d,e);B.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,!1);a.Us&&B.generateMipmap(b);B.bindTexture(b,null);a.width=e.width;a.height=e.height}function d(a){var b=a.Sb;B.bindTexture(b,a.Wa);B.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,!0);B.texImage2D(b,0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,a.Rh[a.we]);
B.bindTexture(b,null)}function h(a){B.texParameteri(a,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE);B.texParameteri(a,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE);B.texParameteri(a,B.TEXTURE_MAG_FILTER,B.LINEAR);B.texParameteri(a,B.TEXTURE_MIN_FILTER,B.LINEAR)}function p(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function g(b){switch(b.type){case a.Yg:b=B.RGBA;break;case a.Hm:b=B.RGB;break;case a.fk:b=B.RGBA;break;case a.gk:b=B.RGB;break;case a.wi:b=B.DEPTH_COMPONENT;
break;default:throw"Wrong texture type";}return b}function v(b){switch(b.type){case a.Yg:b=B.UNSIGNED_BYTE;break;case a.Hm:b=B.UNSIGNED_BYTE;break;case a.fk:b=B.FLOAT;break;case a.gk:b=B.FLOAT;break;case a.wi:b=B.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function m(a){return a in x?(l.jd?x[a].Sh=!0:x[a].hb.play(),!0):null}function t(a){return a in x?(a=x[a],l.jd?(a.we=a.Ha,d(a),a.we++):a.hb.currentTime=a.Ha/a.bc,!0):null}function z(a){return a in x?(l.jd?x[a].Sh=!1:x[a].hb.pause(),
!0):null}var C=w("__config"),J=w("__print"),D=w("__dds"),y=w("__extensions"),n=w("__util"),l=C.p,c=C.Wd,M=C.ld;a.Sd=0;a.H=0;a.az=0;a.Zy=0;a.$y=0;a.Yy=0;a.Yg=10;a.Hm=20;a.fk=30;a.gk=40;a.wi=50;a.Xg=60;var I={},x={},B=null,E;a.Bc=function(b){E=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.Sd=b.NEAREST;a.H=b.LINEAR;a.az=b.NEAREST_MIPMAP_NEAREST;a.Zy=b.LINEAR_MIPMAP_NEAREST;a.$y=b.NEAREST_MIPMAP_LINEAR;a.Yy=b.LINEAR_MIPMAP_LINEAR;B=b};a.bK=function(a){return a in
I?I[a].$d:null};a.aN=function(a){return a in I?(q(I[a]),!0):!1};a.Hk=function(b,c){var d=e();d.name=b;d.type=c;d.source="NONE";if(c==a.Xg)d.wf=B.createRenderbuffer();else{var r=B.TEXTURE_2D,l=B.createTexture();B.bindTexture(r,l);B.texParameteri(r,B.TEXTURE_MAG_FILTER,B.LINEAR);B.texParameteri(r,B.TEXTURE_MIN_FILTER,B.LINEAR);B.texParameteri(r,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE);B.texParameteri(r,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE);B.bindTexture(r,null);d.Sb=r;d.Wa=l}return d};a.KA=function(b){var c=B.createTexture(),
d=B.TEXTURE_CUBE_MAP;B.bindTexture(d,c);B.texParameteri(d,B.TEXTURE_MAG_FILTER,B.LINEAR);B.texParameteri(d,B.TEXTURE_MIN_FILTER,B.LINEAR);B.texParameteri(d,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE);B.texParameteri(d,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE);for(var r="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),l=0;6>l;l++)B.texImage2D(B[r[l]],0,B.RGBA,b,b,0,B.RGBA,B.UNSIGNED_BYTE,
null);B.bindTexture(d,null);d=e();d.name="CUBEMAP";d.type=a.Yg;d.source="NONE";d.width=3*b;d.height=2*b;d.tn=1;d.Wa=c;d.Sb=B.TEXTURE_CUBE_MAP;return d};a.Gp=function(b,c,d){if(b.type!=a.Xg){var e=b.Sb;B.bindTexture(e,b.Wa);c&&B.texParameteri(e,B.TEXTURE_MIN_FILTER,c);d&&B.texParameteri(e,B.TEXTURE_MAG_FILTER,d);B.bindTexture(e,null)}};a.iK=function(b){if(b.type==a.Xg)return{min:a.Sd,BD:a.Sd};var c=b.Sb;B.bindTexture(c,b.Wa);b=B.getTexParameter(c,B.TEXTURE_MIN_FILTER);var d=B.getTexParameter(c,B.TEXTURE_MAG_FILTER);
B.bindTexture(c,null);return{min:b,BD:d}};a.resize=function(b,c,d){c=Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.Xg)B.bindRenderbuffer(B.RENDERBUFFER,b.wf),B.renderbufferStorage(B.RENDERBUFFER,B.DEPTH_COMPONENT16,c,d),B.bindRenderbuffer(B.RENDERBUFFER,null);else{var e=b.Sb;B.bindTexture(e,b.Wa);var n=g(b),h=v(b);B.texImage2D(e,0,n,c,d,0,n,h,null);B.bindTexture(e,null)}c>l.Bd||d>l.Bd?J.error('Slink texture "'+b.name+'" has unsupported size'):(b.width=c,b.height=d)}};a.cB=
b;a.qG=function(a){var b=a.Sb;B.bindTexture(b,a.Wa);B.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,!0);4!=a.hb.length?B.texImage2D(b,0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,a.hb):B.texImage2D(b,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,a.hb);B.bindTexture(b,null)};a.nG=d;a.Pj=function(a,b,d,e){var g=a.source,n=a.Sb;B.bindTexture(n,a.Wa);if(4==b.length){var f=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==g)if(f)B.texImage2D(n,0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(d){d=
D.fu(b);if(d.width>l.Bd||d.height>l.Bd){J.error("texture has unsupported size",e);return}D.sG(B,y.Rt(),b,!0);p(d.width,d.height)&&(a.Kr||J.warn("using NPOT texture",e),h(n));a.width=d.width;a.height=d.height;a.tn=D.tC(b)}else{B.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>l.Bd||b.height>l.Bd){J.error("texture has unsupported size",e);return}a.ig?l.jd?b&&(x[a.name]=a,a.Rh=b,a.bc=a.Zo/b.length,a.th=Math.round(a.th/a.bc),a.Ha=Math.round(a.Ha/a.bc),a.V=Math.round(a.V/a.bc),a.we=a.Ha,B.texImage2D(n,
0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,a.Rh[0])):(a.hb=b,a.hb.loop=a.Jg,b&&(x[a.name]=a),a.bc=c.La,b.duration&&(a.bc=a.Zo/b.duration),M.Rs||(b.playbackRate=c.La/a.bc,M.es&&2<b.playbackRate&&(b.playbackRate=2)),B.texImage2D(n,0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,a.hb)):B.texImage2D(n,0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,b);l.jd&&a.ig?(a.width=b[0].width,a.height=b[0].height):(a.width=b.width,a.height=b.height);p(b.width,b.height)?(a.Kr||(a.ig?J.warn("using NPOT video texture",e):J.warn("using NPOT texture",e)),h(n)):
a.ig||B.generateMipmap(n)}else if("ENVIRONMENT_MAP"==g)if(d=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],f){for(f=0;6>f;f++)g=d[f],B.texImage2D(B["TEXTURE_CUBE_MAP_"+g[0]],0,B.RGBA,1,1,0,B.RGBA,B.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{B.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,!1);var m=b.width/3;if(m>l.Uo||m>l.Uo){J.error("cubemap has unsupported size",e);return}for(f=0;6>f;f++){var g=d[f],v=document.createElement("canvas");v.width=
m;v.height=m;var t=v.getContext("2d");"POSITIVE_Y"==g[0]||"NEGATIVE_Y"==g[0]?(t.translate(0,m),t.scale(1,-1)):(t.translate(m,0),t.scale(-1,1));t.drawImage(b,g[1]*m,g[2]*m,m,m,0,0,m,m);B.texImage2D(B["TEXTURE_CUBE_MAP_"+g[0]],0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,v)}a.width=3*m;a.height=2*m;p(b.width/3,b.height/2)?(J.warn("using NPOT cube map texture",e),h(n)):B.generateMipmap(n)}else"DATA_TEX2D"==g&&(B.texImage2D(n,0,B.RGBA,b.width,b.height,0,B.RGBA,B.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);
B.bindTexture(n,null)};a.oB=function(a){B.deleteTexture(a)};a.gj=function(a){return a&&a.name&&(a.Wa||a.wf)?!0:!1};a.Hu=function(a){return a&&a.name&&a.wf?!0:!1};a.cL=function(b){return b.type==a.fk||b.type==a.gk?!0:!1};a.PC=function(b){var c=0;switch(b.type){case a.Yg:case a.Hm:c=4;break;case a.fk:case a.gk:c=16;break;case a.wi:c=3;break;case a.Xg:c=2}return c};a.hC=function(a){var c=null,c={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};b(c,null,
a);c.image={filepath:null};return c};a.Y=function(){I={};x={}};a.dE=m;a.CE=t;a.$D=z;a.pause=function(){for(var a in x)l.jd&&!x[a].Sh||!l.jd&&x[a].hb.paused||(z(a),x[a].um=!0)};a.reset=function(){for(var a in x)t(a),x[a].um=!1};a.play=function(a){for(var b in x)if(!a||x[b].um)m(b),x[b].um=!1}};b4w.module.__dds=function(a,w){function e(a,b,d,e){var g=new Uint16Array(4),m=new Uint16Array(d*e),n=0,l=0,c=0,h=l=n=0,p=0,v=0,q=0,E=d/4;e/=4;for(var K=0;K<e;K++)for(var k=0;k<E;k++)c=b+4*(K*E+k),g[0]=a[c],g[1]=a[c+1],n=g[0]&31,l=g[0]&2016,h=g[0]&63488,p=g[1]&31,v=g[1]&2016,q=g[1]&63488,g[2]=5*n+3*p>>3|5*l+3*v>>3&2016|5*h+3*q>>3&63488,g[3]=5*p+3*n>>3|5*v+3*l>>3&2016|5*q+3*h>>3&63488,n=a[c+2],l=4*K*d+4*k,m[l]=g[n&3],m[l+1]=g[n>>2&3],m[l+2]=g[n>>4&3],m[l+3]=g[n>>6&3],l+=d,m[l]=g[n>>8&3],m[l+1]=g[n>>
10&3],m[l+2]=g[n>>12&3],m[l+3]=g[n>>14],n=a[c+3],l+=d,m[l]=g[n&3],m[l+1]=g[n>>2&3],m[l+2]=g[n>>4&3],m[l+3]=g[n>>6&3],l+=d,m[l]=g[n>>8&3],m[l+1]=g[n>>10&3],m[l+2]=g[n>>12&3],m[l+3]=g[n>>14];return m}function b(a,b,d,q){var D=new Int32Array(d,0,31),y,n,l,c,M,I;if(542327876!=D[0])return p.error("Invalid magic number in DDS header"),0;if(!D[20]&4)return p.error("Unsupported format, must contain a FourCC code"),0;y=D[21];switch(y){case g:n=8;l=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case v:n=16;l=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case m:n=16;l=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return p.error("Unsupported FourCC code:",h(y)),null}I=1;D[2]&131072&&!1!==q&&(I=Math.max(1,D[7]));c=D[4];M=D[3];D=D[1]+4;if(b)for(y=0;y<I;++y)q=Math.max(4,c)/4*Math.max(4,M)/4*n,b=new Uint8Array(d,D,q),a.compressedTexImage2D(a.TEXTURE_2D,y,l,c,M,0,b),D+=q,c=Math.max(.5*c,1),M=Math.max(.5*M,1);else if(y==g)Math.max(4,c),Math.max(4,M),b=new Uint16Array(d),d=e(b,D/2,c,M),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,c,M,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,d),q&&a.generateMipmap(a.TEXTURE_2D);else return p.error("No manual decoder for",h(y),"and no native support"),0;return I}function q(a,d,e,g,m,h){var n=new XMLHttpRequest;n.open("GET",e,!0);n.responseType="arraybuffer";n.onload=function(){if(200==n.status){a.bindTexture(a.TEXTURE_2D,g);var e=b(a,d,n.response,m);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<e?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}h&&
h(g)};n.send(null);return g}function d(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function h(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var p=w("__print"),g=d("DXT1"),v=d("DXT3"),m=d("DXT5");a.xJ=e;a.sG=b;a.fu=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.tC=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case g:b=6;break;case v:case m:b=4;break;default:p.error("Unsupported FourCC code:",h(a))}return b};
a.qL=q;a.pL=function(a,b,d,e){var g=a.createTexture();q(a,b,d,g,!0,e);return g}};b4w.module.__gpp_eval=function(a){a.Cv=function(){function a(e,b,q,d,h,p){this.message=e;this.offset=d;this.ij=h;this.ih=p;this.name="SyntaxError"}(function(a,b){function q(){this.constructor=a}q.prototype=b.prototype;a.prototype=new q})(a,Error);return{SyntaxError:a,parse:function(e){function b(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function q(a){if(Lb!==a){Lb>a&&(Lb=0,tb={ij:1,ih:1,Hj:!1});var b=tb,f,c;for(f=
Lb;f<a;f++)c=e.charAt(f),"\n"===c?(b.Hj||b.ij++,b.ih=1,b.Hj=!1):"\r"===c||"\u2028"===c||"\u2029"===c?(b.ij++,b.ih=1,b.Hj=!0):(b.ih++,b.Hj=!1);Lb=a}return tb}function d(a){G<Ea||(G>Ea&&(Ea=G,nb=[]),nb.push(a))}function h(){var a,b,f;a=G;b=U();b!==A?(b=p(),b!==A?(f=U(),f!==A?(T++,10===e.charCodeAt(G)?(f=nc,G++):(f=A,0===T&&d(yb)),f===A&&(e.substr(G,2)===mb?(f=mb,G+=2):(f=A,0===T&&d(oc)),f===A&&(13===e.charCodeAt(G)?(f=kc,G++):(f=A,0===T&&d(eb)))),T--,f===A&&0===T&&d(Ub),f===A&&(f=null),f!==A?a=b:(G=
a,a=A)):(G=a,a=A)):(G=a,a=A)):(G=a,a=A);return a}function p(){var a,b,f,c,k,r,u,l;a=G;b=g();if(b!==A){f=[];c=G;k=U();k!==A?(44===e.charCodeAt(G)?(r=da,G++):(r=A,0===T&&d(ca)),r!==A?(u=U(),u!==A?(l=g(),l!==A?c=k=[k,r,u,l]:(G=c,c=A)):(G=c,c=A)):(G=c,c=A)):(G=c,c=A);for(;c!==A;)f.push(c),c=G,k=U(),k!==A?(44===e.charCodeAt(G)?(r=da,G++):(r=A,0===T&&d(ca)),r!==A?(u=U(),u!==A?(l=g(),l!==A?c=k=[k,r,u,l]:(G=c,c=A)):(G=c,c=A)):(G=c,c=A)):(G=c,c=A);f!==A?a=b=0==f.length?b:f[f.length-1]:(G=a,a=A)}else G=a,a=
A;return a}function g(){var a,b,c,f;a=G;b=v();b!==A?(c=U(),c!==A?(63===e.charCodeAt(G)?(c=Z,G++):(c=A,0===T&&d(oa)),c!==A?(c=U(),c!==A?(c=p(),c!==A?(f=U(),f!==A?(58===e.charCodeAt(G)?(f=la,G++):(f=A,0===T&&d(ma)),f!==A?(f=U(),f!==A?(f=p(),f!==A?a=b?c:f:(G=a,a=A)):(G=a,a=A)):(G=a,a=A)):(G=a,a=A)):(G=a,a=A)):(G=a,a=A)):(G=a,a=A)):(G=a,a=A)):(G=a,a=A);a===A&&(a=v());return a}function v(){var a,b,c,f,d,e,k,r;a=G;b=m();if(b!==A){c=[];f=G;d=U();d!==A?(e=ea(),e!==A?(k=U(),k!==A?(r=m(),r!==A?f=d=[d,e,k,r]:
(G=f,f=A)):(G=f,f=A)):(G=f,f=A)):(G=f,f=A);for(;f!==A;)c.push(f),f=G,d=U(),d!==A?(e=ea(),e!==A?(k=U(),k!==A?(r=m(),r!==A?f=d=[d,e,k,r]:(G=f,f=A)):(G=f,f=A)):(G=f,f=A)):(G=f,f=A);if(c!==A)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else G=a,a=A}else G=a,a=A;return a}function m(){var a,b,f,c,d,e,k,r;a=G;b=t();if(b!==A){f=[];c=G;d=U();d!==A?(e=R(),e!==A?(k=U(),k!==A?(r=t(),r!==A?c=d=[d,e,k,r]:(G=c,c=A)):(G=c,c=A)):(G=c,c=A)):(G=c,c=A);for(;c!==A;)f.push(c),c=G,d=U(),d!==A?(e=R(),e!==A?(k=U(),k!==A?(r=t(),
r!==A?c=d=[d,e,k,r]:(G=c,c=A)):(G=c,c=A)):(G=c,c=A)):(G=c,c=A);if(f!==A)for(a=b,b=0;b<f.length;b++)a=a&&f[b][3];else G=a,a=A}else G=a,a=A;return a}function t(){var a,b,c,f,d,e,k,r;a=G;b=z();if(b!==A){c=[];f=G;d=U();d!==A?(e=V(),e!==A?(k=U(),k!==A?(r=z(),r!==A?f=d=[d,e,k,r]:(G=f,f=A)):(G=f,f=A)):(G=f,f=A)):(G=f,f=A);for(;f!==A;)c.push(f),f=G,d=U(),d!==A?(e=V(),e!==A?(k=U(),k!==A?(r=z(),r!==A?f=d=[d,e,k,r]:(G=f,f=A)):(G=f,f=A)):(G=f,f=A)):(G=f,f=A);if(c!==A)for(a=b,b=0;b<c.length;b++)a|=c[b][3];else G=
a,a=A}else G=a,a=A;return a}function z(){var a,b,f,c,d,e,k,r;a=G;b=C();if(b!==A){f=[];c=G;d=U();d!==A?(e=P(),e!==A?(k=U(),k!==A?(r=C(),r!==A?c=d=[d,e,k,r]:(G=c,c=A)):(G=c,c=A)):(G=c,c=A)):(G=c,c=A);for(;c!==A;)f.push(c),c=G,d=U(),d!==A?(e=P(),e!==A?(k=U(),k!==A?(r=C(),r!==A?c=d=[d,e,k,r]:(G=c,c=A)):(G=c,c=A)):(G=c,c=A)):(G=c,c=A);if(f!==A)for(a=b,b=0;b<f.length;b++)a^=f[b][3];else G=a,a=A}else G=a,a=A;return a}function C(){var a,b,c,f,d,e,k,r;a=G;b=J();if(b!==A){c=[];f=G;d=U();d!==A?(e=N(),e!==A?
(k=U(),k!==A?(r=J(),r!==A?f=d=[d,e,k,r]:(G=f,f=A)):(G=f,f=A)):(G=f,f=A)):(G=f,f=A);for(;f!==A;)c.push(f),f=G,d=U(),d!==A?(e=N(),e!==A?(k=U(),k!==A?(r=J(),r!==A?f=d=[d,e,k,r]:(G=f,f=A)):(G=f,f=A)):(G=f,f=A)):(G=f,f=A);if(c!==A)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else G=a,a=A}else G=a,a=A;return a}function J(){var a,b,c,d,e,k,r,g;a=G;b=D();if(b!==A){c=[];d=G;e=U();e!==A?(k=f(),k!==A?(r=U(),r!==A?(g=D(),g!==A?d=e=[e,k,r,g]:(G=d,d=A)):(G=d,d=A)):(G=d,d=A)):(G=d,d=A);for(;d!==A;)c.push(d),d=G,e=U(),
e!==A?(k=f(),k!==A?(r=U(),r!==A?(g=D(),g!==A?d=e=[e,k,r,g]:(G=d,d=A)):(G=d,d=A)):(G=d,d=A)):(G=d,d=A);if(c!==A)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else G=a,a=A}else G=a,a=A;return a}function D(){var a,b,f,c,d,e,k,r;a=G;b=y();if(b!==A){f=[];c=G;d=U();d!==A?(e=F(),e!==A?(k=U(),k!==A?(r=y(),r!==A?c=d=[d,e,k,r]:(G=c,c=A)):(G=c,c=A)):(G=c,c=A)):(G=c,c=A);for(;c!==A;)f.push(c),c=G,d=U(),d!==A?(e=F(),e!==A?(k=U(),k!==A?(r=y(),r!==A?c=d=[d,e,k,r]:
(G=c,c=A)):(G=c,c=A)):(G=c,c=A)):(G=c,c=A);if(f!==A)for(a=b,b=0;b<f.length;b++)switch(f[b][1]){case "<=":a=a<=f[b][3];break;case ">=":a=a>=f[b][3];break;case "<":a=a<f[b][3];break;case ">":a=a>f[b][3]}else G=a,a=A}else G=a,a=A;return a}function y(){var a,b,c,f,d,e,k,r;a=G;b=n();if(b!==A){c=[];f=G;d=U();d!==A?(e=L(),e!==A?(k=U(),k!==A?(r=n(),r!==A?f=d=[d,e,k,r]:(G=f,f=A)):(G=f,f=A)):(G=f,f=A)):(G=f,f=A);for(;f!==A;)c.push(f),f=G,d=U(),d!==A?(e=L(),e!==A?(k=U(),k!==A?(r=n(),r!==A?f=d=[d,e,k,r]:(G=f,
f=A)):(G=f,f=A)):(G=f,f=A)):(G=f,f=A);if(c!==A)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else G=a,a=A}else G=a,a=A;return a}function n(){var a,b,f,c,d,e,k,g;a=G;b=l();if(b!==A){f=[];c=G;d=U();d!==A?(e=r(),e!==A?(k=U(),k!==A?(g=l(),g!==A?c=d=[d,e,k,g]:(G=c,c=A)):(G=c,c=A)):(G=c,c=A)):(G=c,c=A);for(;c!==A;)f.push(c),c=G,d=U(),d!==A?(e=r(),e!==A?(k=U(),k!==A?(g=l(),g!==A?c=d=[d,e,k,g]:(G=c,c=A)):(G=c,c=A)):(G=c,c=A)):(G=c,c=A);if(f!==A)for(a=b,b=0;b<
f.length;b++)switch(f[b][1]){case "+":a+=f[b][3];break;case "-":a-=f[b][3]}else G=a,a=A}else G=a,a=A;return a}function l(){var a,b,f,d,e,k,r,g;a=G;b=c();if(b!==A){f=[];d=G;e=U();e!==A?(k=u(),k!==A?(r=U(),r!==A?(g=c(),g!==A?d=e=[e,k,r,g]:(G=d,d=A)):(G=d,d=A)):(G=d,d=A)):(G=d,d=A);for(;d!==A;)f.push(d),d=G,e=U(),e!==A?(k=u(),k!==A?(r=U(),r!==A?(g=c(),g!==A?d=e=[e,k,r,g]:(G=d,d=A)):(G=d,d=A)):(G=d,d=A)):(G=d,d=A);if(f!==A)for(a=b,b=0;b<f.length;b++)switch(f[b][1]){case "*":a*=f[b][3];break;case "/":a=
Math.floor(a/f[b][3]);break;case "%":a%=f[b][3]}else G=a,a=A}else G=a,a=A;return a}function c(){var a,f,k;a=G;e.substr(G,7)===ha?(f=ha,G+=7):(f=A,0===T&&d(pa));f!==A?(k=U(),k!==A?(k=I(),k!==A?a=k:(G=a,a=A)):(G=a,a=A)):(G=a,a=A);if(a===A){a=G;f=M();if(f!==A)if(k=U(),k!==A)if(e.substr(G,2)===Ya?(k=Ya,G+=2):(k=A,0===T&&d(va)),k===A&&(e.substr(G,2)===Ga?(k=Ga,G+=2):(k=A,0===T&&d(za))),k!==A){a:{a=f;switch(k){case "++":f=++a;break a;case "--":f=--a;break a}f=void 0}a=f}else G=a,a=A;else G=a,a=A;else G=
a,a=A;a===A&&(a=M());a===A&&(a=G,e.substr(G,2)===Ya?(f=Ya,G+=2):(f=A,0===T&&d(va)),f===A&&(e.substr(G,2)===Ga?(f=Ga,G+=2):(f=A,0===T&&d(za)),f===A&&(43===e.charCodeAt(G)?(f=qa,G++):(f=A,0===T&&d(db)),f===A&&(45===e.charCodeAt(G)?(f=Aa,G++):(f=A,0===T&&d(Ma)),f===A&&(126===e.charCodeAt(G)?(f=Cb,G++):(f=A,0===T&&d(cc)),f===A&&(33===e.charCodeAt(G)?(f=Kb,G++):(f=A,0===T&&d(Wb))))))),f!==A?(k=U(),k!==A?(k=c(),k!==A?a=f=b(f,k):(G=a,a=A)):(G=a,a=A)):(G=a,a=A))}return a}function M(){var a,b,f;T++;var c;
a=G;48===e.charCodeAt(G)?(b=ba,G++):(b=A,0===T&&d(ta));if(b!==A)if(xa.test(e.charAt(G))?(b=e.charAt(G),G++):(b=A,0===T&&d(Ja)),b!==A){b=G;f=[];c=B();if(c!==A)for(;c!==A;)f.push(c),c=B();else f=A;b=f!==A?e.substring(b,G):f;b!==A?a=b=parseInt("0x"+b):(G=a,a=A)}else G=a,a=A;else G=a,a=A;if(a===A){a=G;48===e.charCodeAt(G)?(b=ba,G++):(b=A,0===T&&d(ta));if(b===A)if(b=G,bb.test(e.charAt(G))?(f=e.charAt(G),G++):(f=A,0===T&&d(ga)),f!==A){var k;c=[];k=x();if(k!==A)for(;k!==A;)c.push(k),k=x();else c=A;c===A&&
(c=null);c!==A?b=f=[f,c]:(G=b,b=A)}else G=b,b=A;a=b!==A?e.substring(a,G):b;a!==A&&(a=parseInt(a))}T--;a===A&&0===T&&d(W);a===A&&(b=E(),b!==A&&(b=0),a=b,a===A&&(a=G,40===e.charCodeAt(G)?(b=H,G++):(b=A,0===T&&d(aa)),b!==A?(b=U(),b!==A?(b=p(),b!==A?(f=U(),f!==A?(41===e.charCodeAt(G)?(f=na,G++):(f=A,0===T&&d(Fa)),f!==A?a=b:(G=a,a=A)):(G=a,a=A)):(G=a,a=A)):(G=a,a=A)):(G=a,a=A)));return a}function I(){var a,b,f,c,k;b=E();b!==A&&(b=0);a=b;if(a===A){b=[];c=f=G;T++;40===e.charCodeAt(G)?(k=H,G++):(k=A,0===
T&&d(aa));k===A&&(41===e.charCodeAt(G)?(k=na,G++):(k=A,0===T&&d(Fa)));T--;k===A?c=void 0:(G=c,c=A);c!==A?(k=Q(),k!==A?f=c=[c,k]:(G=f,f=A)):(G=f,f=A);if(f!==A)for(;f!==A;)b.push(f),c=f=G,T++,40===e.charCodeAt(G)?(k=H,G++):(k=A,0===T&&d(aa)),k===A&&(41===e.charCodeAt(G)?(k=na,G++):(k=A,0===T&&d(Fa))),T--,k===A?c=void 0:(G=c,c=A),c!==A?(k=Q(),k!==A?f=c=[c,k]:(G=f,f=A)):(G=f,f=A);else b=A;b!==A&&(b=1);a=b;a===A&&(a=G,40===e.charCodeAt(G)?(b=H,G++):(b=A,0===T&&d(aa)),b!==A?(f=U(),f!==A?(c=I(),c!==A?(k=
U(),k!==A?(41===e.charCodeAt(G)?(b=na,G++):(b=A,0===T&&d(Fa)),b!==A?a=c:(G=a,a=A)):(G=a,a=A)):(G=a,a=A)):(G=a,a=A)):(G=a,a=A))}return a}function x(){var a;Bb.test(e.charAt(G))?(a=e.charAt(G),G++):(a=A,0===T&&d(O));return a}function B(){var a;ib.test(e.charAt(G))?(a=e.charAt(G),G++):(a=A,0===T&&d(wa));return a}function E(){var a,b;T++;b=a=G;T++;var f,c,r,g;f=G;e.substr(G,7)===ha?(c=ha,G+=7):(c=A,0===T&&d(pa));c!==A?(r=G,T++,g=k(),T--,g===A?r=void 0:(G=r,r=A),r!==A?f=c=[c,r]:(G=f,f=A)):(G=f,f=A);T--;
f===A?b=void 0:(G=b,b=A);if(b!==A){T++;b=G;f=K();if(f!==A){c=[];for(r=k();r!==A;)c.push(r),r=k();c!==A?b=f+=c.join(""):(G=b,b=A)}else G=b,b=A;T--;b===A&&0===T&&d(ab);b!==A?a=b:(G=a,a=A)}else G=a,a=A;T--;a===A&&0===T&&d(ab);return a}function K(){var a;mc.test(e.charAt(G))?(a=e.charAt(G),G++):(a=A,0===T&&d(ja));a===A&&(36===e.charCodeAt(G)?(a=Na,G++):(a=A,0===T&&d(sa)),a===A&&(95===e.charCodeAt(G)?(a=Oa,G++):(a=A,0===T&&d(ra))));return a}function k(){var a;a=K();a===A&&(a=x());return a}function u(){var a,
b,f,c;a=G;42===e.charCodeAt(G)?(b=rb,G++):(b=A,0===T&&d(sb));b===A&&(47===e.charCodeAt(G)?(b=jb,G++):(b=A,0===T&&d(Ia)),b===A&&(37===e.charCodeAt(G)?(b=Ba,G++):(b=A,0===T&&d(Nb))));b!==A?(f=G,T++,61===e.charCodeAt(G)?(c=Ta,G++):(c=A,0===T&&d(lb)),T--,c===A?f=void 0:(G=f,f=A),f!==A?a=b:(G=a,a=A)):(G=a,a=A);return a}function r(){var a,b,f;a=G;43===e.charCodeAt(G)?(b=qa,G++):(b=A,0===T&&d(db));b!==A?(b=G,T++,43===e.charCodeAt(G)?(f=qa,G++):(f=A,0===T&&d(db)),f===A&&(61===e.charCodeAt(G)?(f=Ta,G++):(f=
A,0===T&&d(lb))),T--,f===A?b=void 0:(G=b,b=A),b!==A?a="+":(G=a,a=A)):(G=a,a=A);a===A&&(a=G,45===e.charCodeAt(G)?(b=Aa,G++):(b=A,0===T&&d(Ma)),b!==A?(b=G,T++,45===e.charCodeAt(G)?(f=Aa,G++):(f=A,0===T&&d(Ma)),f===A&&(61===e.charCodeAt(G)?(f=Ta,G++):(f=A,0===T&&d(lb))),T--,f===A?b=void 0:(G=b,b=A),b!==A?a="-":(G=a,a=A)):(G=a,a=A));return a}function L(){var a;e.substr(G,2)===cb?(a=cb,G+=2):(a=A,0===T&&d(Pb));a===A&&(e.substr(G,2)===Ra?(a=Ra,G+=2):(a=A,0===T&&d(Ua)));return a}function F(){var a;e.substr(G,
2)===Gb?(a=Gb,G+=2):(a=A,0===T&&d(xb));a===A&&(e.substr(G,2)===hb?(a=hb,G+=2):(a=A,0===T&&d(Vb)),a===A&&(60===e.charCodeAt(G)?(a=kb,G++):(a=A,0===T&&d(qb)),a===A&&(62===e.charCodeAt(G)?(a=La,G++):(a=A,0===T&&d(ya)))));return a}function f(){var a;e.substr(G,2)===Fb?(a=Fb,G+=2):(a=A,0===T&&d(wb));a===A&&(e.substr(G,2)===ua?(a=ua,G+=2):(a=A,0===T&&d(Ob)));return a}function N(){var a,b,f;a=G;38===e.charCodeAt(G)?(b=Y,G++):(b=A,0===T&&d(gb));b!==A?(b=G,T++,38===e.charCodeAt(G)?(f=Y,G++):(f=A,0===T&&d(gb)),
T--,f===A?b=void 0:(G=b,b=A),b!==A?a="&":(G=a,a=A)):(G=a,a=A);return a}function P(){var a,b,f;a=G;94===e.charCodeAt(G)?(b=Pa,G++):(b=A,0===T&&d(Da));b!==A?(b=G,T++,94===e.charCodeAt(G)?(f=Pa,G++):(f=A,0===T&&d(Da)),T--,f===A?b=void 0:(G=b,b=A),b!==A?a="^":(G=a,a=A)):(G=a,a=A);return a}function V(){var a,b,f;a=G;124===e.charCodeAt(G)?(b=Sa,G++):(b=A,0===T&&d(Db));b!==A?(b=G,T++,124===e.charCodeAt(G)?(f=Sa,G++):(f=A,0===T&&d(Db)),T--,f===A?b=void 0:(G=b,b=A),b!==A?a="|":(G=a,a=A)):(G=a,a=A);return a}
function R(){var a;e.substr(G,2)===Ib?(a=Ib,G+=2):(a=A,0===T&&d(ac));a!==A&&(a="&&");return a}function ea(){var a;e.substr(G,2)===Eb?(a=Eb,G+=2):(a=A,0===T&&d(Qa));a!==A&&(a="||");return a}function U(){var a,b;a=[];for(b=X();b!==A;)a.push(b),b=X();return a}function X(){var a;T++;Jb.test(e.charAt(G))?(a=e.charAt(G),G++):(a=A,0===T&&d(bc));T--;a===A&&0===T&&d(Tb);return a}function Q(){var a;e.length>G?(a=e.charAt(G),G++):(a=A,0===T&&d(pc));return a}var S=1<arguments.length?arguments[1]:{},A={},ka={start:h},
fa=h,da=",",ca={type:"literal",value:",",description:'","'},Z="?",oa={type:"literal",value:"?",description:'"?"'},la=":",ma={type:"literal",value:":",description:'":"'},ha="defined",pa={type:"literal",value:"defined",description:'"defined"'},H="(",aa={type:"literal",value:"(",description:'"("'},na=")",Fa={type:"literal",value:")",description:'")"'},W={type:"other",description:"number"},ba="0",ta={type:"literal",value:"0",description:'"0"'},Bb=/^[0-9]/,O={type:"class",value:"[0-9]",description:"[0-9]"},
bb=/^[1-9]/,ga={type:"class",value:"[1-9]",description:"[1-9]"},xa=/^[xX]/,Ja={type:"class",value:"[xX]",description:"[xX]"},ib=/^[0-9a-fA-F]/,wa={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},ab={type:"other",description:"identifier"},Na="$",sa={type:"literal",value:"$",description:'"$"'},Oa="_",ra={type:"literal",value:"_",description:'"_"'},mc=/^[a-zA-Z]/,ja={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},Ya="++",va={type:"literal",value:"++",description:'"++"'},Ga="--",za=
{type:"literal",value:"--",description:'"--"'},qa="+",db={type:"literal",value:"+",description:'"+"'},Aa="-",Ma={type:"literal",value:"-",description:'"-"'},Cb="~",cc={type:"literal",value:"~",description:'"~"'},Kb="!",Wb={type:"literal",value:"!",description:'"!"'},rb="*",sb={type:"literal",value:"*",description:'"*"'},jb="/",Ia={type:"literal",value:"/",description:'"/"'},Ba="%",Nb={type:"literal",value:"%",description:'"%"'},Ta="=",lb={type:"literal",value:"=",description:'"="'},cb="<<",Pb={type:"literal",
value:"<<",description:'"<<"'},Ra=">>",Ua={type:"literal",value:">>",description:'">>"'},Gb="<=",xb={type:"literal",value:"<=",description:'"<="'},hb=">=",Vb={type:"literal",value:">=",description:'">="'},kb="<",qb={type:"literal",value:"<",description:'"<"'},La=">",ya={type:"literal",value:">",description:'">"'},Fb="==",wb={type:"literal",value:"==",description:'"=="'},ua="!=",Ob={type:"literal",value:"!=",description:'"!="'},Y="&",gb={type:"literal",value:"&",description:'"&"'},Pa="^",Da={type:"literal",
value:"^",description:'"^"'},Sa="|",Db={type:"literal",value:"|",description:'"|"'},Ib="&&",ac={type:"literal",value:"&&",description:'"&&"'},Eb="||",Qa={type:"literal",value:"||",description:'"||"'},Tb={type:"other",description:"whitespace"},Jb=/^[\t\x0B\f ]/,bc={type:"class",value:"[\\t\\v\\f ]",description:"[\\t\\v\\f ]"},Ub={type:"other",description:"end of line"},nc="\n",yb={type:"literal",value:"\n",description:'"\\n"'},mb="\r\n",oc={type:"literal",value:"\r\n",description:'"\\r\\n"'},kc="\r",
eb={type:"literal",value:"\r",description:'"\\r"'},pc={type:"any",description:"any character"},G=0,Lb=0,tb={ij:1,ih:1,Hj:!1},Ea=0,nb=[],T=0,Va;if("startRule"in S){if(!(S.Tw in ka))throw Error("Can't start parsing from rule \""+S.Tw+'".');fa=ka[S.Tw]}Va=fa();if(Va!==A&&G===e.length)return Va;Va!==A&&G<e.length&&d({type:"end",description:"end of input"});throw function(b,f,c){function d(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-
1]===a[b]?a.splice(b,1):b++}function k(a,b){function f(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,function(a){return"\\u"+
b(a)})}var c=Array(a.length),d;for(d=0;d<a.length;d++)c[d]=a[d].description;c=1<a.length?c.slice(0,-1).join(", ")+" or "+c[a.length-1]:c[0];d=b?'"'+f(b)+'"':"end of input";return"Expected "+c+" but "+d+" found."}var r=q(c),g=c<e.length?e.charAt(c):null;null!==f&&d(f);return new a(null!==b?b:k(f,g),0,0,c,r.ij,r.ih)}(null,nb,Ea);}}}()};b4w.module.__assets=function(a,w){function e(){return D.Du()?w(D.Yb.tk).data:null}function b(){var a={hk:null,iz:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.hk=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=e();b&&a.hk in b&&(a.status=200,b[a.hk]&&(a.response=a.iz(b[a.hk])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function q(b){for(var c=0,e=0;e<b.length;e++){var n=b[e];20===n.state&&c++;if(c>=I.JD)break;if(10===n.state)switch(n.state=20,c++,n.type){case a.Xj:d(n,"arraybuffer");break;case a.Cq:d(n,"json");break;case a.Ix:d(n,"text");break;case a.Aq:h(n);break;case a.Yj:p(n);break;case a.Bq:g(n);break;case a.$j:v(n);break;
case a.Zj:m(n);break;default:l.sa("Wrong asset type: "+n.type)}}}function d(a,c){var d=e(),g=d&&a.s in d?new b:new XMLHttpRequest;g.open("GET",a.s,!0);"text"==c?(g.overrideMimeType("text/plain"),g.responseType="text"):"json"==c?(g.overrideMimeType("application/json"),g.responseType="text"):g.responseType=c;g.onreadystatechange=function(){if(40!=a.state&&4==g.readyState){if(200==g.status||0==g.status){var b=g.response;if(b){if("json"==c&&"string"==typeof b)try{b=JSON.parse(b)}catch(f){a.kb(null,a.uri,
a.type,a.s,a.rb);y.error(f+" (parsing JSON "+a.s+")");return}a.kb(b,a.uri,a.type,a.s,a.rb)}else a.kb(null,a.uri,a.type,a.s,a.rb),y.error("empty responce when trying to get "+a.s)}else a.kb(null,a.uri,a.type,a.s,a.rb),y.error(g.status+" when trying to get "+a.s);a.state=30}};g.addEventListener("progress",function(b){b.lengthComputable&&a.Kv(b.loaded/b.total)},!1);g.send(null)}function h(a){var c=e(),d=c&&a.s in c?new b:new XMLHttpRequest;d.open("GET",a.s,!0);d.responseType="arraybuffer";d.onreadystatechange=
function(){if(40!=a.state&&4==d.readyState)if(200==d.status||0==d.status){var b=d.response;b?n.jB(b,function(b){a.kb(b,a.uri,a.type,a.s,a.rb);a.state=30},function(){a.kb(null,a.uri,a.type,a.s,a.rb);y.error("failed to decode "+a.s);a.state=30}):(a.kb(null,a.uri,a.type,a.s,a.rb),y.error("empty responce when trying to get "+a.s),a.state=30)}else a.kb(null,a.uri,a.type,a.s,a.rb),y.error(d.status+" when trying to get "+a.s),a.state=30};d.send(null)}function p(a){var b=document.createElement("img");x.allow_cors&&
(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.kb(b,a.uri,a.type,a.s,a.rb),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.kb(null,a.uri,a.type,a.s,a.rb),y.error("could not load image: "+a.s),a.state=30)},!1);var c=e();if(c&&a.s in c)if(c[a.s]){var d=z(a.s);b.src="data:"+d+";base64,"+c[a.s]}else M.Eo()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.s}function g(a){var b=document.createElement("audio");
x.allow_cors&&(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=a.state&&(a.kb(b,a.uri,a.type,a.s,a.rb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.kb(null,a.uri,a.type,a.s,a.rb),y.error("could not load sound: "+a.s),a.state=30)},!1);var c=e();if(c&&a.s in c)if(c[a.s]){var d=C(a.s);b.src="data:"+d+";base64,"+c[a.s];40!=a.state&&(a.kb(b,a.uri,a.type,a.s,a.rb),a.state=30)}else M.Eo()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",
!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.s,x.hg&&b.load();setTimeout(function(){b.rF=1},5E3)}function v(a){var b=document.createElement("video");b.muted=!0;if(x.allow_cors||x.hg)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.kb(b,a.uri,a.type,a.s,a.rb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.kb(null,a.uri,a.type,a.s),y.error("could not load video: "+a.s,a.rb),a.state=30)},!1);var c=e();if(c&&a.s in
c)if(c[a.s]){var d=J(a.s);b.src="data:"+d+";base64,"+c[a.s];40!=a.state&&(a.kb(b,a.uri,a.type,a.s,a.rb),a.state=30)}else M.Eo()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.s,x.hg&&b.load();setTimeout(function(){b.rF=1},1E4)}function m(a){function c(b){a.kb(b,a.uri,a.type,a.s,a.rb)}var d=e(),g=d&&a.s in d?new b:new XMLHttpRequest;g.open("GET",a.s,!0);g.responseType="arraybuffer";g.onreadystatechange=function(){if(40!=
a.state&&4==g.readyState){if(200==g.status||0==g.status){var b=g.response;b?t(b,c):(a.kb(null,a.uri,a.type,a.s,a.rb),y.error("empty responce when trying to get "+a.s))}else a.kb(null,a.uri,a.type,a.s,a.rb),y.error(g.status+" when trying to get "+a.s);a.state=30}};g.addEventListener("progress",function(b){b.lengthComputable&&a.Kv(b.loaded/b.total)},!1);g.send(null)}function t(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],f={images:[],bc:c[4]},g=20,l=0;l<e;l++){var n=c[g/4],m=document.createElement("img");
m.src=window.URL.createObjectURL(new Blob([d.subarray(g+4,g+4+n)],{type:"image/jpg"}));f.images.push(m);g+=n+8-n%4}m.onload=function(){b(f)}}function z(a){var b="image";switch(l.ho(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function C(a){var b="audio";switch(l.ho(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function J(a){var b="video";switch(l.ho(a).toLowerCase()){case "ogv":b+=
"/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var D=w("__config"),y=w("__print"),n=w("__sfx"),l=w("__util"),c=w("__version"),M=w("__compat"),I=D.Xd,x=D.p;a.Xj=10;a.Cq=20;a.Ix=30;a.Aq=40;a.Yj=50;a.Bq=60;a.$j=70;a.Zj=80;var B=[],E=0,K={};a.Lj=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.OC=function(a){if(K[a])return K[a];var b=I.Gv?a+c.timestamp():a,d=new XMLHttpRequest;d.overrideMimeType("text/plain");d.open("GET",
b,!1);d.send(null);if(200==d.status||0==d.status){b=d.responseText;if(b.length)return K[a]=b;l.sa("Error XHR: responce is empty, GET "+a)}else l.sa("Error XHR: "+d.status+", GET "+a)};a.Y=function(){for(var a=0;a<B.length;a++)B[a].state=40;B=[];E=0;K={}};a.sc=function(a,b,d,g){for(var l=0;l<a.length;l++){var f=a[l],f={uri:f[0],type:f[1],s:f[2],rb:f[3],state:10,kb:b||function(){},zv:d||function(){},Kv:g||function(){},Av:E};if(I.Gv){var n=e();n&&f.s in n||(f.s+=c.timestamp())}B.push(f)}q(B);E++};a.update=
function(){q(B);for(var a=B,b=0,c=!0,d=0;d<a.length;d++){var e=a[d];e.Av===a[b].Av?30!==e.state&&(c=!1):(c&&(a[d-1].zv(),c=d-b,a.splice(b,c),d-=c),b=d,c=30===a[d].state?!0:!1);d===a.length-1&&c&&(a[d].zv(),a.splice(b))}}};b4w.module.__sfx=function(a,w){function e(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;y.warn("deprecated WebAudio implementation");return null}y.warn("WebAudio is not supported");return null}function b(a,b,c){var d=a.h;if("NONE"!=d.behavior){c||(c=0);var e=d.loop,r=d.pitch;if(d.src&&(e||0<=c)){d.Xm=Math.floor(5E4*Math.random());var l=k.currentTime+b;d.Dc=l;d.state=20;q(a);"POSITIONAL"==d.behavior||"BACKGROUND_SOUND"==d.behavior?(b=k.createBufferSource(),
b.buffer=d.src,b.playbackRate.value=r,e?(d.ub&&d.ub.disconnect(),b.loop=!0,b.start(l),d.duration=0):(e=b.buffer?b.buffer.duration:0,c>e?(e=l+c+d.fe,b.loop=!0,b.start(l),b.stop(e),d.duration=c):(b.loop=!1,b.start(l),d.duration=e)),b.connect(d.ic),d.ub=b,h(d),p(d)):"BACKGROUND_MUSIC"==d.behavior&&(n.yk(d.an),n.yk(d.bn),c=function(){var b=a.h,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.ub=b.ub||k.createMediaElementSource(c),b.ub.connect(b.ic),20==b.state&&(c.currentTime&&(c.currentTime=0),c.play()))},0==
b?c():d.an=n.Aw(c,1E3*b),d.duration=e?0:J(a));g(d,l)}}}function q(a){var b=a.h;if(!b.ic){var c=a.d.g;a=a.d.quat;if(M.zl){var d=k.createBiquadFilter();d.type="peaking"}else d=null;var e=k.createGain();switch(b.behavior){case "POSITIONAL":var r=k.createPanner();"string"!=typeof r.panningModel?(r.panningModel=r.EQUALPOWER,r.distanceModel=r.INVERSE_DISTANCE):(r.panningModel="equalpower",r.distanceModel="inverse");r.setPosition(c[0],c[1],c[2]);b.Ko.set(c);c=I;l.ka(a,l.$b,c);r.setOrientation(c[0],c[1],
c[2]);b.direction.set(c);r.refDistance=b.dist_ref;r.maxDistance=b.dist_max;r.rolloffFactor=b.attenuation;r.coneInnerAngle=b.yA;r.coneOuterAngle=b.zA;r.coneOuterGain=b.AA;var g=k.createGain();g.gain.value=C(b);d?(r.connect(d),d.connect(g)):r.connect(g);g.connect(e);b.ic=r;if(b.ui){var n=k.createGain();e.connect(n);n.connect(k?u.h.ic:null)}else n=null,e.connect(k?u.h.ic:null);break;case "BACKGROUND_SOUND":r=null;g=k.createGain();g.gain.value=C(b);d?(b.ic=d,d.connect(g)):b.ic=g;g.connect(e);b.ui?(n=
k.createGain(),e.connect(n),n.connect(k?u.h.ic:null)):(n=null,e.connect(k?u.h.ic:null));break;case "BACKGROUND_MUSIC":n=r=null,g=k.createGain(),g.gain.value=C(b),d?(b.ic=d,d.connect(g)):b.ic=g,g.connect(e),e.connect(k?u.h.ic:null)}b.oj=r;b.yd=d;b.uh=g;b.Vf=e;b.Pv=n}}function d(a){var c=a.h,d=c.duration,c=c.mB+c.nB*Math.random();b(a,c,d)}function h(a){a.ui&&a.Pv.gain.cancelScheduledValues(a.Dc);a.rj&&a.ub.playbackRate.cancelScheduledValues(a.Dc);a.Sj=a.Dc}function p(a){if(a.ui||a.rj){var b=a.Pv,c=
a.ub,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Dc;L[0]=a.Xm;for(var k=0;5>k;){var r=a.pitch+a.rj*l.Tc(L);if(e>=a.Sj){if(a.ui){var g=1-l.ra(a.ui,0,1)*Math.random();b.gain.setValueAtTime(g,e)}a.rj&&c.playbackRate.setValueAtTime(r,e);k++}e+=d/r}a.Sj=e-.001}}}function g(a,b){if(a.Un||a.fe){var c=a.Vf;c.gain.cancelScheduledValues(b);a.Un?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.Un)):c.gain.setValueAtTime(1,b);a.fe&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,
b+a.duration+a.fe))}}function v(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.h;if(20==b.state||40==b.state){var c=b.Vf,d=k.currentTime;b.fe&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.fe));"BACKGROUND_MUSIC"==b.behavior?b.src&&(n.yk(b.an),n.yk(b.bn),b.bn=n.Aw(function(){var b=a.h.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.fe)):(c=b.ub,b.duration<c.buffer.duration?b.fe&&20==b.state?c.stop(d+b.fe):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),
b.Dc=0,b.ip=0,b.gn=0);b.state=30}}function m(a){a=a.h;if(20==a.state){var b=k.currentTime;a.ip=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.Dc){L[0]=a.Xm;for(var d=a.ub.buffer.duration,e=a.Dc;e<b;)c=a.pitch+a.rj*l.Tc(L),e+=d/c;c*=d/c-(e-b)}else c=0;a.gn=c;a.ub.stop(0);a.ub.disconnect();h(a)}a.state=40}}function t(a){var b=a.h;if(40==b.state){var c=k.currentTime;b.Dc+=c-b.ip;if("BACKGROUND_MUSIC"==b.behavior)b.src.play();else{a=a.h;var d=k.createBufferSource();d.loop=a.ub.loop;
d.buffer=a.ub.buffer;d.playbackRate.value=a.ub.playbackRate.value;a.oj?d.connect(a.oj):d.connect(a.uh);a.ub=d;b.Sj=c;b.ub.start(b.Dc,b.gn);p(b)}g(b,b.Dc);b.state=20}}function z(a){return!a.h||20!=a.h.state&&40!=a.h.state&&30!=a.h.state?!1:!0}function C(a){return a.muted?0:a.volume}function J(a){a=a.h;return(a=a.src)?a.duration:0}var D=w("__config"),y=w("__print"),n=w("__time"),l=w("__util"),c=w("vec3"),M=D.ld;a.zq=10;a.zm=20;a.yq=30;var I=new Float32Array(3),x=new Float32Array(3),B=new Float32Array(3),
E=[],K=[],k=null,u=null,r=[],L=[1],F=null;a.Ob=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(E.push("ogg"),E.push("ogv")),""!=a.canPlayType("audio/mpeg")&&E.push("mp3"),""!=a.canPlayType("audio/mp4")&&(E.push("mp4"),E.push("m4v")),""!=a.canPlayType("audio/webm")&&E.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&K.push("ogv"),""!=b.canPlayType("video/mp4")&&K.push("m4v"),""!=b.canPlayType("video/webm")&&
K.push("webm"));(k=M.wq?e():null)&&y.log("%cINIT WEBAUDIO: "+k.sampleRate+"Hz","color: #00a")};a.Fr=function(a){var b={og:new Float32Array(3),Vu:new Float32Array(3),Eh:new Float32Array(3)};a.h=b;if(k){var c=k.createGain(),d=k.createGain();b.uh=c;b.Vf=d;c.connect(d);d.connect(k.destination);if(a.b4w_enable_dynamic_compressor){var d=k.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=
e.release;d.connect(c);b.Fi=d;b.ic=d}else b.Fi=null,b.ic=c;c=k.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=!1;b.volume=1;b.Uf=0}};a.RE=function(a){u=a};a.Ln=function(a){a||(a="ogg");return-1<E.indexOf(a)?a:"ogg"==a&&-1<E.indexOf("mp4")?"mp4":"mp3"==a&&-1<E.indexOf("ogg")?"ogg":"mp4"==a&&-1<E.indexOf("ogg")?"ogg":"ogv"==a&&-1<E.indexOf("m4v")?"m4v":"webm"==a&&-1<E.indexOf("m4v")?"m4v":"m4v"==a&&-1<E.indexOf("webm")?"webm":""};a.Mn=function(a){a||(a=
"webm");return-1<K.indexOf(a)?a:"ogv"==a&&-1<K.indexOf("m4v")?"m4v":"webm"==a&&-1<K.indexOf("m4v")?"m4v":"m4v"==a&&-1<K.indexOf("webm")?"webm":""};a.Ke=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.h={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.h.behavior=k?b.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var c=a.h,d;k?(window.MediaElementAudioSourceNode?d=!0:(y.warn("MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):
d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.h.behavior="NONE");a.h.sB=b.b4w_disable_doppler;a.h.muted=b.muted;a.h.volume=b.volume;a.h.pitch=b.pitch;a.h.attenuation=b.attenuation;a.h.dist_ref=b.distance_reference;a.h.dist_max=b.distance_max||1E4;a.h.yA=b.cone_angle_inner;a.h.zA=b.cone_angle_outer;a.h.AA=b.cone_volume_outer;a.h.Mc=b.b4w_cyclic_play;a.h.loop=b.b4w_loop;a.h.mB=b.b4w_delay;a.h.nB=b.b4w_delay_random;a.h.ui=b.b4w_volume_random;a.h.rj=b.b4w_pitch_random;
a.h.Un=b.b4w_fade_in;a.h.fe=b.b4w_fade_out;a.h.Dc=0;a.h.ip=0;a.h.gn=0;a.h.duration=0;a.h.Sj=0;a.h.Xm=1;a.h.src=null;a.h.state=10;a.h.Ko=new Float32Array(3);a.h.direction=new Float32Array(3);a.h.Tp=new Float32Array(3);a.h.an=-1;a.h.bn=-1;a.h.Uf=0;r.push(a)};a.Mw=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.h.behavior){case "POSITIONAL":return a.zm;case "BACKGROUND_SOUND":return a.zm;case "BACKGROUND_MUSIC":return a.yq;case "NONE":return a.zq;default:throw"Wrong speaker behavior";
}};a.oG=function(a,b){var c=a.h;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.cE=function(){var a=k.createBufferSource();a.buffer=k.createBuffer(1,22050,22050);a.connect(k.destination);a.start(0)};a.jB=function(a,b,c){k?k.decodeAudioData(a,b,c):c()};a.wF=function(a){v(a);delete a.h;r.splice(r.indexOf(a),1)};a.Y=function(){for(var a=0;a<r.length;a++){var b=r[a].h;"BACKGROUND_MUSIC"==b.behavior?
(b=b.src)&&b.pause():b.ub&&b.ub.disconnect()}u&&u.h&&(a=u.h,a.og[0]=0,a.og[1]=0,a.og[2]=0,a.Eh[0]=0,a.Eh[1]=0,a.Eh[2]=0);u=null;r.splice(0);F=null};a.update=function(a){if(k&&0!=r.length){for(var b=0;b<r.length;b++){var c=r[b],e=c.h,g=k.currentTime;k&&!e.loop&&e.Mc&&20==e.state&&e.duration&&e.Dc+e.duration<g&&d(c);20==e.state&&3>e.Sj-g&&p(e)}F&&(-1==F.Ma||a>F.mr+F.Ts[F.Ma])&&(b=F,-1<b.Ma&&v(b.nf[b.Ma]),-1==b.Ma&&b.random?c=Math.round(Math.random()*(b.nf.length-1)):b.random?(c=1+Math.round(Math.random()*
(b.nf.length-2)),c=(b.Ma+c)%b.nf.length):c=(b.Ma+1)%b.nf.length,d(b.nf[c]),b.Ma=c,b.mr=a)}};a.play=b;a.kp=d;a.stop=v;a.ej=function(a){return 20==a.h.state};a.vF=m;a.xF=t;a.sj=function(a,b){var c=a.h;c.pitch=b;!z(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.ub.playbackRate.value=b,h(c),p(c))};a.Nt=function(a){return a.h.pitch};a.Mc=function(a,b){a.h.Mc=Boolean(b)};a.Ch=function(a){return a.h.Mc};a.zD=function(a,b,d,e){if(k&&a.h){var r=I;r[0]=0;r[1]=-1;r[2]=0;c.transformQuat(r,d,
r);x[0]=0;x[1]=0;x[2]=-1;c.transformQuat(x,d,x);d=k.listener;d.setPosition(b[0],b[1],b[2]);d.setOrientation(r[0],r[1],r[2],x[0],x[1],x[2]);a.h.Vu.set(r);e&&(B[0]=(b[0]-a.h.og[0])/e,B[1]=(b[1]-a.h.og[1])/e,B[2]=(b[2]-a.h.og[2])/e,l.Yh(B,a.h.Eh,e,.3,B),d.setVelocity(B[0],B[1],B[2]),a.h.Eh.set(B));a.h.og.set(b)}};a.Wu=function(a,b){if(k&&u.h){var d=I;b?d.set(b):d.set(u.h.Vu);c.scale(d,a,d);k.listener.setVelocity(d[0],d[1],d[2]);u.h.Eh.set(d)}};a.yF=function(a,b){var c=a.h;if(z(a)&&"POSITIONAL"==c.behavior){var d=
a.d.g,e=c.oj;e.setPosition(d[0],d[1],d[2]);var k=I;l.ka(a.d.quat,l.$b,k);e.setOrientation(k[0],k[1],k[2]);k=c.Ko;!c.sB&&b&&(x[0]=(d[0]-k[0])/b,x[1]=(d[1]-k[1])/b,x[2]=(d[2]-k[2])/b,l.Yh(x,c.Tp,b,.3,x),e.setVelocity(x[0],x[1],x[2]),c.Tp.set(x));k.set(d)}};a.Nw=function(a,b,d){var e=a.h;if(z(a)&&"POSITIONAL"==e.behavior){var k=I;d?k.set(d):k.set(e.direction);c.scale(k,b,k);e.oj.setVelocity(k[0],k[1],k[2]);e.Tp.set(k);e.Ko.set(a.d.g)}};a.pe=function(a){return a.h?!0:!1};a.no=function(a){return a.h.behavior};
a.mn=function(){for(var a=0;a<r.length;a++)if(z(r[a]))return!0;return!1};a.ZE=function(a){var b=u.h;b&&(b.volume=a,k&&(b.uh.gain.value=C(b)))};a.IC=function(){var a=u.h;return a?a.volume:0};a.Lp=function(a,b){var c=a.h;c.volume=b;z(a)&&(c.uh.gain.value=C(c))};a.cu=function(a){return a.h.volume};a.kj=function(a,b){a.h.muted=Boolean(b);z(a)&&(a.h.uh.gain.value=C(a.h))};a.Fu=function(a){return a.h.muted};a.QD=function(a){var b=u.h;b&&(b.muted=Boolean(a),k&&(b.uh.gain.value=C(b)))};a.sD=function(){var a=
u.h;return a?a.muted:!1};a.bl=function(){return r};a.pause=function(){for(var a=0;a<r.length;a++)m(r[a])};a.hd=function(){for(var a=0;a<r.length;a++)t(r[a])};a.lw=function(a,b){if(a.h&&a.h.Fi){var c=a.h.Fi;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.zt=function(a){if(!a.h||!a.h.Fi)return null;a=a.h.Fi;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};
a.Ss=function(a,b,c){if(z(a)){a=a.h;var d=a.Vf,e=k.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.Uf=c}};a.kx=function(a){if(z(a)){a=a.h;var b=a.Vf,c=k.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Uf);a.Uf=0}};a.uB=function(a,b){if(k){var c=u.h,d=c.Vf,e=k.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.Uf=b}};a.ZF=function(){if(k){var a=u.h,b=a.Vf,c=k.currentTime;b.gain.setValueAtTime(b.gain.value,
c);b.gain.linearRampToValueAtTime(1,c+a.Uf);a.Uf=0}};a.wr=function(a,b,c){F={Ma:-1,mr:0,random:c,nf:[],Ts:[]};for(c=0;c<a.length;c++){var d=a[c],e=J(d);0==e?y.warn("Ignoring speaker with zero duration: "+d.name):(v(d),d.h.Mc=!1,F.nf.push(d),F.Ts.push(e+b))}};a.Bt=J;a.ls=function(){if(F)for(var a=F.nf,b=0;b<a.length;b++)v(a[b]);F=null};a.Ot=function(a){return(a=a.h)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.tw=function(a,b){var c=a.h;if(c&&
"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.oj;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.pw=function(a,b){var c=a.h;c&&c.yd&&(c.yd.frequency.value=b.freq,c.yd.Q.value=b.Q,c.yd.gain.value=b.gain)};a.Gt=function(a){return(a=a.h)&&a.yd?{freq:a.yd.frequency.value,Q:a.yd.Q.value,gain:a.yd.gain.value}:null};a.Ft=function(a,b,c,d){a=a.h;if(!a||!a.yd)return null;a.yd.getFrequencyResponse(b,c,d)}};b4w.module.__time=function(a,w){w("__util");var e=0,b=0,q=[],d=0,h=[];a.zw=function(a){e=a;b=performance.now();for(a=0;a<q.length;a++){var d=q[a];e>d.Sn&&(q.splice(a,1),a--,d.callback())}for(a=0;a<h.length;a++){var d=h[a],v=1-(d.Sn-e)/d.duration,v=Math.min(v,1);d.callback(d.M+v*(d.ea-d.M));1==v&&(h.splice(a,1),a--)}};a.xh=function(){return e};a.Aw=function(a,g){var h;d++;h=d;q.push({id:h,callback:a,Sn:e+(performance.now()-b+g)/1E3});return h};a.yk=function(a){for(var b=0;b<q.length;b++)if(q[b].id==
a){q.splice(b,1);break}};a.pr=function(a,b,d){h.push({callback:d,M:a,ea:b,Sn:e+.2,duration:.2});d(a)};a.reset=function(){b=e=0;d=q.length=0}};"object"==typeof module&&module.Tn&&(GLOBAL.b4w={module:{}});b4w.module.__version=function(a){function w(){return"26.03.2015 05:28:45"}a.version=function(){return"15.03"};a.type=function(){return"RELEASE"};a.Gn=w;a.timestamp=function(){var a=w(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.Tn&&b4w.module.__version(exports);b4w.module.__compat=function(a,w){function e(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function b(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function q(){return!window.ActiveXObject&&"ActiveXObject"in window}var d=w("__config"),h=w("__extensions"),p=w("__print"),
g=w("__util");a.YE=function(a){var m=d.Wd,t=d.p,z=d.context,C=d.Gj,w=d.ld;t.Bd=a.getParameter(a.MAX_TEXTURE_SIZE);t.Uo=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var D=Boolean(h.yC());e("Firefox")&&d.Du()&&(p.warn("Firefox detected for single HTML version, disable video textures."),t.dt=!0);e("Firefox/28.0")&&(e("Linux")||e("Macintosh"))&&(p.warn("Firefox 28 detected, applying depth hack"),D=!1);e("iPad")||e("iPhone")?(p.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
z.alpha||(t.background_color[3]=1),t.wx=!0,t.smaa=!1,t.of=!1,t.precision="highp",t.zu=!0):e("Mac OS X")&&e("Safari")&&!e("Chrome")&&(p.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),w.Hr=!0,w.es=!0);e("Windows")&&(e("Chrome/40")||e("Firefox/33")||e("Firefox/34")||e("Firefox/35")||e("Firefox/36"))&&(p.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),t.on=!0);b()&&(p.warn("Mobile detected, applying various hacks for video textures."),
t.hg=!0,e("iPad")||e("iPhone")||(p.warn("Mobile (not iOS) detected, disable playback rate for video textures."),w.Rs=!0));(e("Firefox/35.0")||e("Firefox/36.0"))&&e("Windows")&&(p.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),t.et=!0);if(e("iPhone")||q())p.warn("iPhone or IE11 detected. Enable sequential video fallback for video textures."),t.jd=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(p.warn("Not enough varyings, disable shadows on blend objects"),t.Qs=!0);if(z=h.Qt())e("Macintosh")&&
-1<a.getParameter(z.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(p.warn("OS X / Intel HD 3000 detected, applying depth hack"),D=!1),-1<a.getParameter(z.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(z.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(p.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),D=!1,m.jt=!0),-1<a.getParameter(z.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(z.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(p.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),
t.precision="highp",t.hf="NONE"),-1<a.getParameter(z.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(z.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(p.warn("ARM Mali-T760 detected, disable SSAO."),t.of=!1),-1<a.getParameter(z.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&-1<a.getParameter(z.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(p.warn("Qualcomm Adreno detected, applying shader constants hack."),t.Gw=!0,-1<a.getParameter(z.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(p.warn('Qualcomm Adreno305 detected, set "highp" precision.'),
t.precision="highp"),-1<a.getParameter(z.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(p.warn('Qualcomm Adreno330 detected, set "highp" precision.'),t.precision="highp")),-1<a.getParameter(z.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(z.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&(p.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),t.Yn=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(p.warn("Vertex textures are not allowed. Disabling vertex textures"),
t.Mm=!1);t.allow_hidpi&&1<window.devicePixelRatio&&(p.log("%cENABLE HIDPI MODE","color: #00a"),t.resolution_factor=1,t.smaa=!1);D||(t.Si=!1,t.pj=!1,t.bb=!1,t.water_dynamic=!1,t.Uh=!1,t.am=!1,t.fd=!1,t.smaa=!1);t.rx=Boolean(h.Rt());t.Lk=D;m=g.ra(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),128,Infinity);t.dd=g.trunc((m-50)/4);t.vL=g.trunc((m-50)/2);0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(t.precision="mediump");q()&&(p.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),
C.Jk=512);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(p.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),t.Yn=!0)};a.Ps=b;a.Fz=function(){e("Firefox/35.0")&&e("Windows")&&(p.warn("Windows/Firefox 35 detected, forcing context's alpha"),d.context.alpha=!0)};a.Eo=q};b4w.module.shader_texts=function(a){a["anchors.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",a:[{type:"var",name:"ANCHOR_NUM",b:["0"]},{type:"textline",b:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec4 a = u_view_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_Position = u_proj_matrix * a ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_glow_intensity",";"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_glow_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",
a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",
a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",
b:"void main ( ) { vec3 cl = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"cl = mix ( cl , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 cm = vec3 ( 0.0 ) ; vec3 cn = vec3 ( 0.0 ) ; vec3 co = vec3 ( 0.0 ) ; bt ( cl , cm , cn , co ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",
a:[{type:"textline",b:["vec3","cp","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cp = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 cq = ( u_model_matrix * vec4 ( cp , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 cr = ag ( u_camera_eye , cq , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 cr = aa ( u_camera_eye , cq , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 cs = ( u_model_matrix * vec4 ( cp , 1.0 ) ) . xyz ; cr = cr * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , cs ) ;".split(" ")}]}}]},{type:"textline",b:"d ct = an ( cl - cp , cp , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , cr ) ; ct . b = cq ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"d ct = an ( cl , cp , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","cu","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cu = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ck ( ct . a , ct . b , cu ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( ct . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ;".split(" ")}]}}]},{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"shadow.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:"float ft = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ft = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( ft < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cs ( cF ) ;".split(" ")}]}},
{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( fn ( cL . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"WIND_BEND && MAIN_BEND_COL && DETAIL_BEND || SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:"BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},
{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 gw = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"gw = mix ( gw , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 gx = vec3 ( 0.0 ) ; vec3 gy = vec3 ( 0.0 ) ; vec3 gz = vec3 ( 0.0 ) ; bt ( gw , gx , gy , gz ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","gA","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d gB = gh ( gw , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gA , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gC = ( u_model_matrix * vec4 ( gA , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! HAIR_BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["mat4","gD","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["mat4","gD",
"=","u_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 gE = ag ( u_camera_eye , gC , gD , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gE = aa ( u_camera_eye , gC , gD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 gF = ( u_model_matrix * vec4 ( gA , 1.0 ) ) . xyz ; gE = gE * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , gF ) ;".split(" ")}]}}]},
{type:"textline",b:"d gB = an ( gw - gA , gA , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gE ) ; gB . b = gC ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d gB = an ( gw , gA , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","gG","=","a_normal",
";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gG = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ck ( gB . a , gB . b , gG ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gH = u_view_matrix * vec4 ( gB . a , 1.0 ) ; vec4 gI = u_proj_matrix * gH ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"gI . xy += u_subpixel_jitter * gI . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gr ( gB . a ) ; cL = gH ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"cF = - gH . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 gJ = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; float gK = SHADOW_TEX_RES / 2.0 ; gJ = floor ( gJ * gK + 0.5 ) / gK - gJ ; gI . xy += gJ ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gI",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gw",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gw",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( gw , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , gw ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",
b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gw",";"]}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gw",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gx = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 gy = aa ( u_camera_eye , gx , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"gy = gy * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"d gz = an ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gy ) ; gz . b = gx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d gz = an ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gA = u_proj_matrix * u_view_matrix * vec4 ( gz . a , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gw = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["gw","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gw","=","a_grass_color",";"]}]}}]}]}}]},
{type:"textline",b:["gl_Position","=","gA",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 gE ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float gF ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",
">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int gG = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int gG = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float gI ( float gH ) { return gH - floor ( gH * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void gR ( inout float gJ , in float gK [ gG ] , in float gL ) { for ( int gM = 0 ; gM < NUM_RINGS ; gM ++ ) { float gN = 40.0 * gK [ gM ] ; float gO = 300.0 * ( gI ( gN ) - 0.005 ) ; float gP = gN ; float gQ = abs ( gP * ( u_halo_size * gO - gL ) ) ; gJ += 1.0 - min ( gQ , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void g_ ( inout float gS , in float gT [ gG ] , in float gU ) { for ( int gV = 0 ; gV < NUM_LINES ; gV ++ ) { float gW = gT [ gV ] ; float gX = gW ; float gY = 1000.0 * ( gI ( gW ) - 0.005 ) ; float gZ = 20.0 * abs ( gX * a . x + gY * a . y ) ; gS += 1.0 - min ( gZ , 1.0 ) ; } gS *= gU ; }".split(" ")}]}}]},{type:"textline",b:"void hg ( inout float ha , in vec2 hb ) { float hc , hd ; hd = atan ( hb . y , hb . x ) ; hd *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float he = cos ( hd ) ; float hf = sin ( hd ) ; hd = ( he * hb . x + hf * hb . y ) * ( he * hb . y - hf * hb . x ) ; hc = abs ( hd ) ; if ( hc < 1.0 ) { hc = ( 0.01 * u_halo_size ) / ( hc ) ; ha *= sqrt ( min ( hc , 1.0 ) ) ; } } void main ( ) { float hh = ( a . x * a . x + a . y * a . y ) ; float hi = sqrt ( hh ) ; hh = max ( 1.0 - hh , 0.0 ) ; hh = pow ( hh , u_halo_hardness ) ; float hj = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hk [ gG ] ; for ( int hl = 0 ; hl < gG ; hl ++ ) { hk [ hl ] = fract ( gF / ( float ( hl ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"float hm = 0.0 ; gR ( hm , hk , hi ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hn = 0.0 ; g_ ( hn , hk , hh ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"hg ( hh , a ) ;".split(" ")}]}}]},{type:"textline",b:"hh *= hj ; vec3 ho = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"hm *= hh ; ho += u_halo_rings_color * hm ; hh += hm ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"hn *= hj ; ho += u_halo_lines_color * hn ; hh += hn ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"hh *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float hp = u_halo_stars_blend * ( gE . y - u_halo_stars_height ) ; hh *= clamp ( hp , 0.0 , 1.0 ) ; hh *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"gA ( ho ) ; gD ( ho , hh ) ; gl_FragColor = vec4 ( ho , hh ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float gF ;".split(" ")},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gE",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 gG = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; a = a_halo_bb_vertex * 2.0 ; gF = fract ( gG . x + gG . y + gG . z ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",
a:[{type:"textline",b:"mat4 gH = z ( gG , u_view_matrix ) ; mat4 gI = u_view_matrix ; gI [ 3 ] [ 0 ] = 0.0 ; gI [ 3 ] [ 1 ] = 0.0 ; gI [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gH = z ( gG , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gJ = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 gK = gH * gJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"vec4 gL = u_proj_matrix * gI * gK ; gL . z = 0.99999 * gL . w ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["gE","=","gK",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 gL = u_proj_matrix * u_view_matrix * gK ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gL",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};
a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 gG = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( gG , 1.0 ) ; }".split(" ")}]};a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",
name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NORMAL_TEXCOORD","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",
b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",
";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_reflect_factor ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 kJ ; varying vec3 kK ; varying vec3 kL ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kM",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kN",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kO",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],
group:{type:"group",a:[{type:"textline",b:"float lz = kK . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["vec2","lA","=","a",";"]}]}}]},{type:"textline",b:["vec3","lB","=","kL",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) lB = lB ; else lB = - lB ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:"vec3 lC = cross ( lB , kM . xyz ) * kM . w ; mat3 lD = mat3 ( kM . xyz , lC , lB ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float lE = length ( cL ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"vec2 lF = normalize ( u_view_matrix_frag * vec4 ( kL , 0.0 ) ) . st ; lF = lF * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( lE < PARALLAX_LOD_DIST ) { float lG = clamp ( 0.5 * ( PARALLAX_LOD_DIST - lE ) , 0.0 , 1.0 ) ; float lH = u_parallax_scale * lG ; vec3 lI = normalize ( kJ * lD ) ; float lJ = 1.0 / PARALLAX_STEPS ; vec2 lK = lI . xy * lH / ( PARALLAX_STEPS * lI . z ) ; float lL = 1.0 ; float lM ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:["vec2","lN","=","lF",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","lN","=","lA",";"]}]}}]},{type:"textline",b:"lM = texture2D ( u_normalmap0 , lN ) . a ; for ( float lO = 1.0 ; lO <= PARALLAX_STEPS ; lO ++ ) { if ( lM < lL ) { lL -= lJ ; lN -= lK ; lM = texture2D ( u_normalmap0 , lN ) . a ; } } vec2 lP = lN + lK ; float lQ = texture2D ( u_normalmap0 , lP ) . a - ( lL + lJ ) ; float lR = lM - lL ; float lS = lR / ( lR - lQ ) ; lN = lS * lP + ( 1.0 - lS ) * lN ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lA += lN - lF ;".split(" ")}]}}]},{type:"textline",b:["lF","=","lN",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lF += lN - lA ;".split(" ")}]}}]},{type:"textline",b:["lA","=","lN",";"]}]}}]},{type:"textline",
b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["vec4","lT",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lT = texture2D ( u_normalmap0 , lF ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lT = texture2D ( u_normalmap0 , lA ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lU = lT . rgb - 0.5 ; lU = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , lU , u_normal_factor ) ; vec3 lV = lD * lU ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","lV","=","lB",";"]}]}}]},{type:"textline",b:"lV = normalize ( lV ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lF = normalize ( u_view_matrix_frag * vec4 ( lV , 0.0 ) ) . st ; lF = lF * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lW = normalize ( kJ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],
group:{type:"group",a:[{type:"textline",b:"vec3 lX = kN ; gy ( lX ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec4 lY = vec4 ( lX , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","lY","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["float","lZ","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:"vec4 l_ = texture2D ( u_colormap0 , lF ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec4 l_ = texture2D ( u_colormap0 , lA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"gy ( l_ . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","ma",
";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"ma = texture2D ( u_colormap1 , lF ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ma = texture2D ( u_colormap1 , lA ) ;".split(" ")}]}}]},{type:"textline",b:"gy ( ma . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec4 mb = texture2D ( u_stencil0 , lF ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 mb = texture2D ( u_stencil0 , lA ) ;".split(" ")}]}}]},{type:"textline",b:"l_ = mix ( l_ , ma , mb . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lY . rgb = mix ( lY . rgb , l_ . rgb , u_diffuse_color_factor ) ; float mc = u_alpha_factor * l_ . a ; mc += ( 1.0 - step ( 0.0 , mc ) ) ; lY . a = mix ( mc , 1.0 , u_diffuse_color . a ) ; lZ = l_ . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lY . rgb *= mix ( vec3 ( 1.0 ) , l_ . rgb , u_diffuse_color_factor ) ; lY . a = l_ . a ; lZ = l_ . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 md = u_diffuse_intensity * lY . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["vec3","me","=","md",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float mf = 0.5 * lV . y + 0.5 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 mg = u_environment_energy * textureCube ( u_sky_texture , lV ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mg = u_environment_energy * mix ( u_horizon_color , u_zenith_color , mf ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 mh = u_ambient * mg ; float mi = fs ( md ) ; vec3 mj = u_emit * lY . rgb ; vec3 mk = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"vec3 ml = vec3 ( lZ ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 ml = texture2D ( u_specmap0 , lF ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ml = texture2D ( u_specmap0 , lA ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"gy ( ml . rgb ) ; mk = mix ( mk , ml , u_specular_color_factor ) ;".split(" ")}]}}]},
{type:"textline",b:"float mm = u_specular_params [ 0 ] ; vec2 mn = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 mo = mm * mk ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS","==","0"],group:{type:"group",a:[{type:"textline",b:"hx mp = kh ( mj , mh , md ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hx mp = kc ( mj , mh , md , mo , kK , lV , lW , mn , u_diffuse_params , mi , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 me = mp . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["float","mq","=","u_reflect_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","mq","=","0.0",";"]}]}}]},{type:"textline",b:"lk ( me , lW , lV , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , mq ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"me += mp . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"me = max ( me - sqrt ( 0.01 * - min ( lz , 0.0 ) ) , 0.5 * me ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"kI ( me , lz , u_time , mi , lV , u_sun_direction , u_sun_intensity , u_sun_quaternion , kK , lE ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"float mr = lY . a ; if ( mr <= 0.5 ) discard ; mr = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float mr = lY . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"mr += mp . a . a * mo . r * u_specular_alpha ;".split(" ")}]}}]}]}}]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["float","mr","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"me = mix ( ly ( cK , lV . xz * u_refr_bump ) , me , mr ) ; mr = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float ms = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 mt = gS ( u_cube_fog , lW ) ; vec4 mu = vec4 ( mt , u_fog_color_density . a ) ; gy ( mu . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 mu = u_fog_color_density ; mu . rgb *= ms ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"hk ( me , lE , lW , u_cam_water_depth , u_underwater_fog_color_density , mu , lz , ms ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( me , lE , mu ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),group:{type:"group",a:[{type:"textline",b:"me = vec3 ( dT . a ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","me",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"gD ( me , mr ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( me , mr ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 kJ ; varying vec3 kK ; varying vec3 kL ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kM",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kN",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kO",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 lz = a_position ; vec3 lA = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec3 lB = vec3 ( a_tangent ) ; vec3 lC = a_tangent [ 3 ] * cross ( lA , lB ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 lD = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 lE = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vec3 lF = lD - u_camera_eye ; vec3 lC = cross ( lF , lE ) ; vec3 lB = cross ( lE , lC ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lB = vec3 ( 0.0 ) ; vec3 lC = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"lz = mix ( lz , a_position_next , u_va_frame_factor ) ; lA = mix ( lA , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vec3 lG = vec3 ( a_tangent ) ; vec3 lH = a_tangent_next [ 3 ] * cross ( a_normal_next , lG ) ; lB = mix ( lB , lG , u_va_frame_factor ) ; lC = mix ( lC , lH , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bt ( lz , lB , lC , lA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","lI","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lI = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d lJ = gh ( lz , lB , lC , lA , lI , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lK = ( u_model_matrix * vec4 ( lI , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 lL = ag ( u_camera_eye , lK , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 lL = aa ( u_camera_eye , lK , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lM = ( u_model_matrix * vec4 ( lI , 1.0 ) ) . xyz ; lL = lL * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lM ) ;".split(" ")}]}}]},{type:"textline",b:"d lJ = an ( lz - lI , lI , lB , lC , lA , lL ) ; lJ . b = lK ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d lJ = an ( lz , lI , lB , lC , lA , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"float lN = ( dot ( cross ( lJ . e , lJ . c ) , lJ . d ) < 0.0 ) ? - 1.0 : 1.0 ; kM = vec4 ( lJ . c , lN ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( lJ . a , lJ . b , lA ) ;".split(" ")}]}}]},{type:"textline",b:"kK = lJ . a ; kL = lJ . e ; kJ = u_camera_eye - lJ . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",
a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kN = lJ . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["kN","=","a_color",";"]}]}}]},{type:"textline",b:"vec4 lO = u_view_matrix * vec4 ( lJ . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),
group:{type:"group",a:[{type:"textline",b:["cL","=","lO",";"]}]}}]},{type:"textline",b:"vec4 lP = u_proj_matrix * lO ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"lP . xy += u_subpixel_jitter * lP . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gr","(","lP",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",
b:"gr ( lJ . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:"float lQ = lP . x ; float lR = lP . y ; float lS = lP . w ; cK . x = ( lQ + lS ) / 2.0 ; cK . y = ( lR + lS ) / 2.0 ; cK . z = lS ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kO = - lO . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position",
"=","lP",";","}"]}]};a["nodes.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",
")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",
file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_reflectmap ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 kK ; varying vec4 cL ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","kL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kM",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION",
"&&","USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["varying","float","kO",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 lz = vec3 ( ZERO_VALUE_NODES ) ; vec3 lA = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",
a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 lE ( in vec3 lB , in float lC ) { vec3 lD = lz ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"lD = ly ( cK , lB . xz * lC ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lD = texture2D ( u_refractmap , cK . xy / cK . z ) . rgb ; gy ( lD ) ;".split(" ")}]}}]},{type:"textline",b:["return","lD",";","}"]}]}}]},{type:"textline",b:"vec3 lH ( float lF , vec3 lG ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , lG ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return mix ( u_horizon_color , u_zenith_color , lF ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec3 lO ( vec3 lI ) { vec4 lJ = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; vec4 lK = mix ( vec4 ( lI . bg , lJ . wz ) , vec4 ( lI . gb , lJ . xy ) , step ( lI . b , lI . g ) ) ; vec4 lL = mix ( vec4 ( lK . xyw , lI . r ) , vec4 ( lI . r , lK . yzx ) , step ( lK . x , lI . r ) ) ; float lM = lL . x - min ( lL . w , lL . y ) ; float lN = 1.0e-10 ; return vec3 ( abs ( lL . z + ( lL . w - lL . y ) / ( 6.0 * lM + lN ) ) , lM / ( lL . x + lN ) , lL . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 lS ( vec3 lP ) { vec4 lQ = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; vec3 lR = abs ( fract ( vec3 ( lP . r , lP . r , lP . r ) + lQ . xyz ) * 6.0 - lQ . www ) ; return lP . b * mix ( lQ . xxx , clamp ( lR - lQ . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , lP . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_B4W_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 lU ( vec2 lT ) { return vec3 ( lT * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_TEXTURE_COLOR || USE_NODE_TEXTURE_NORMAL || USE_NODE_TEXTURE_COLOR2 || USE_NODE_TEXTURE_NORMAL2 || USE_NODE_TEXTURE_COLOR3 || USE_NODE_TEXTURE_NORMAL3 || USE_NODE_TEXTURE_NORMAL4 || USE_NODE_TEXTURE_COLOR4 || USE_NODE_B4W_PARALLAX".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lW ( vec3 lV ) { return vec2 ( lV . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},{type:"node",name:"CAMERA",k:[{type:"node_out",name:"mB",qualifier:["vec3"],e:!0},{type:"node_out",name:"mC",qualifier:["float"],e:!0},{type:"node_out",name:"mD",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mB"],f:[{type:"textline",b:"mB = normalize ( mr . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_mC"],f:[{type:"textline",b:"mC = abs ( mr . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mD"],f:[{type:"textline",b:"mD = length ( mr . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",k:[{type:"node_in",name:"mE",qualifier:["float"],e:!1},{type:"node_in",name:"mF",qualifier:["float"],e:!1},{type:"node_in",name:"mG",qualifier:["float"],e:!1},{type:"node_out",name:"mH",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mH = vec3 ( mE , mF , mG ) ;".split(" ")}]},
{type:"node",name:"COMBHSV",k:[{type:"node_in",name:"mI",qualifier:["float"],e:!1},{type:"node_in",name:"mJ",qualifier:["float"],e:!1},{type:"node_in",name:"mK",qualifier:["float"],e:!1},{type:"node_out",name:"mL",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mL = lS ( vec3 ( mI , mJ , mK ) ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_out",name:"mM",qualifier:["vec3"],e:!1},{type:"node_param",name:"lX",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"mM = lU ( lX ) ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC",k:[{type:"node_out",name:"mN",qualifier:["vec3"],e:!1},{type:"node_param",name:"lY",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["mN","=","lY",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_out",name:"mO",qualifier:["float"],e:!1},{type:"node_param",name:"lZ",qualifier:["varying","float"]}],f:[{type:"textline",b:["mO","=","lZ",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_out",name:"mP",qualifier:["float"],e:!1},{type:"node_out",name:"mQ",
qualifier:["float"],e:!1},{type:"node_param",name:"l_",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"mP = l_ [ 0 ] ; mQ = l_ [ 1 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_out",name:"mR",qualifier:["float"],e:!1},{type:"node_out",name:"mS",qualifier:["float"],e:!1},{type:"node_out",name:"mT",qualifier:["float"],e:!1},{type:"node_param",name:"ma",qualifier:["varying","vec3"]}],f:[{type:"textline",b:"mR = ma [ 0 ] ; mS = ma [ 1 ] ; mT = ma [ 2 ] ;".split(" ")}]},{type:"node",
name:"GEOMETRY_NO",k:[{type:"node_out",name:"mU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mU","=","mk",";"]}]},{type:"node",name:"GEOMETRY_FB",k:[{type:"node_out",name:"mV",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mV = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",k:[{type:"node_out",name:"mW",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mW","=","mp",";"]}]},{type:"node",name:"GEOMETRY_GL",k:[{type:"node_out",name:"mX",
qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mX = vec3 ( mq . r , - mq . b , mq . g ) ;".split(" ")}]},{type:"node",name:"HUE_SAT",k:[{type:"node_in",name:"mY",qualifier:["float"],e:!1},{type:"node_in",name:"mZ",qualifier:["float"],e:!1},{type:"node_in",name:"m_",qualifier:["float"],e:!1},{type:"node_in",name:"na",qualifier:["float"],e:!1},{type:"node_in",name:"nb",qualifier:["vec3"],e:!1},{type:"node_out",name:"nc",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ vec3 nd = lO ( nb ) ; nd [ 0 ] += ( mY - 0.5 ) ; if ( nd [ 0 ] > UNITY_VALUE_NODES ) nd [ 0 ] -= UNITY_VALUE_NODES ; else if ( nd [ 0 ] < ZERO_VALUE_NODES ) nd [ 0 ] += UNITY_VALUE_NODES ; nd *= vec3 ( UNITY_VALUE_NODES , mZ , m_ ) ; nd = mix ( lA , mix ( lz , nd , step ( lz , nd ) ) , step ( nd , lA ) ) ; nc = mix ( nb , lS ( nd ) , na ) ; }".split(" ")}]},
{type:"node",name:"INVERT",k:[{type:"node_in",name:"ne",qualifier:["float"],e:!1},{type:"node_in",name:"nf",qualifier:["vec3"],e:!1},{type:"node_out",name:"ng",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ng = mix ( nf , lA - nf , ne ) ;".split(" ")}]},{type:"node",name:"LAMP",k:[{type:"node_out",name:"nh",qualifier:["vec3"],e:!1},{type:"node_out",name:"ni",qualifier:["vec3"],e:!1},{type:"node_out",name:"nj",qualifier:["float"],e:!1},{type:"node_out",name:"nk",qualifier:["float"],e:!1},{type:"node_param",
name:"mb",qualifier:["const","float"]}],f:[{type:"textline",b:"{ const int nl = int ( mb ) ; nh = u_lamp_light_color_intensities [ nl ] ; vec4 nm = u_lamp_light_factors [ nl ] ; vec3 nn = u_lamp_light_directions [ nl ] ; vec3 no = u_lamp_light_positions [ nl ] ; float np = nm . z ; if ( np != - UNITY_VALUE_NODES ) { ni = no - kK ; nj = length ( ni ) ; ni = normalize ( ni ) ; nk = np / ( np + nj * nj ) ; float nq = nm . x ; float nr = nm . y ; if ( nq > - UNITY_VALUE_NODES ) { float ns = dot ( ni , nn ) ; ns *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( ns - nq ) / nr ) ; nk *= ns ; } } else { ni = nn ; nj = length ( no - kK ) ; nk = UNITY_VALUE_NODES ; } }".split(" ")}]},
{type:"node",name:"NORMAL",k:[{type:"node_in",name:"nt",qualifier:["vec3"],e:!1},{type:"node_out",name:"nu",qualifier:["vec3"],e:!0},{type:"node_out",name:"nv",qualifier:["float"],e:!0},{type:"node_param",name:"mc",qualifier:["vec3"]}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nu"],f:[{type:"textline",b:["nu","=","mc",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nv"],f:[{type:"textline",b:"nv = - dot ( nt , mc ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",
k:[{type:"node_in",name:"nw",qualifier:["vec3"],e:!1},{type:"node_out",name:"nx",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"nx = - ( u_view_matrix_frag * vec4 ( nw , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"MAPPING",k:[{type:"node_in",name:"ny",qualifier:["vec3"],e:!1},{type:"node_out",name:"nz",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["nz","=","ny",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",f:[{type:"textline",b:"nz = ( MAPPING_TRS_MATRIX * vec4 ( nz , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_SCALE",f:[{type:"textline",b:"nz = nz * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",f:[{type:"textline",b:"nz = nz + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",f:[{type:"textline",b:"nz = max ( nz , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",f:[{type:"textline",
b:"nz = min ( nz , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],f:[{type:"textline",b:"nz = normalize ( nz ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",k:[{type:"node_in",name:"nA",qualifier:["float"],e:!1},{type:"node_in",name:"nB",qualifier:["float"],e:!1},{type:"node_out",name:"nC",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nC = nA + nB ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",
b:"nC = clamp ( nC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",k:[{type:"node_in",name:"nD",qualifier:["float"],e:!1},{type:"node_in",name:"nE",qualifier:["float"],e:!1},{type:"node_out",name:"nF",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nF = nD - nE ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nF = clamp ( nF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_MULTIPLY",k:[{type:"node_in",name:"nG",qualifier:["float"],e:!1},{type:"node_in",name:"nH",qualifier:["float"],e:!1},{type:"node_out",name:"nI",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nI = nG * nH ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nI = clamp ( nI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",k:[{type:"node_in",name:"nJ",qualifier:["float"],e:!1},{type:"node_in",name:"nK",
qualifier:["float"],e:!1},{type:"node_out",name:"nL",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nL = ( nK != ZERO_VALUE_NODES ) ? nJ / nK : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nL = clamp ( nL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SINE",k:[{type:"node_in",name:"nM",qualifier:["float"],e:!1},{type:"node_in",name:"nN",qualifier:["float"],e:!1},{type:"node_out",name:"nO",
qualifier:["float"],e:!1}],f:[{type:"textline",b:"nO = sin ( nM ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nO = clamp ( nO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nN",";"]}]},{type:"node",name:"MATH_COSINE",k:[{type:"node_in",name:"nP",qualifier:["float"],e:!1},{type:"node_in",name:"nQ",qualifier:["float"],e:!1},{type:"node_out",name:"nR",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nR = cos ( nP ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nR = clamp ( nR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nQ",";"]}]},{type:"node",name:"MATH_TANGENT",k:[{type:"node_in",name:"nS",qualifier:["float"],e:!1},{type:"node_in",name:"nT",qualifier:["float"],e:!1},{type:"node_out",name:"nU",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nU = tan ( nS ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],
f:[{type:"textline",b:"nU = clamp ( nU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nT",";"]}]},{type:"node",name:"MATH_ARCSINE",k:[{type:"node_in",name:"nV",qualifier:["float"],e:!1},{type:"node_in",name:"nW",qualifier:["float"],e:!1},{type:"node_out",name:"nX",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nX = ( nV <= UNITY_VALUE_NODES && nV >= - UNITY_VALUE_NODES ) ? asin ( nV ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nX = clamp ( nX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nW",";"]}]},{type:"node",name:"MATH_ARCCOSINE",k:[{type:"node_in",name:"nY",qualifier:["float"],e:!1},{type:"node_in",name:"nZ",qualifier:["float"],e:!1},{type:"node_out",name:"n_",qualifier:["float"],e:!1}],f:[{type:"textline",b:"n_ = ( nY <= UNITY_VALUE_NODES && nY >= - UNITY_VALUE_NODES ) ? acos ( nY ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"n_ = clamp ( n_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nZ",";"]}]},{type:"node",name:"MATH_ARCTANGENT",k:[{type:"node_in",name:"oa",qualifier:["float"],e:!1},{type:"node_in",name:"ob",qualifier:["float"],e:!1},{type:"node_out",name:"oc",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oc = atan ( oa ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",
b:"oc = clamp ( oc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["ob",";"]}]},{type:"node",name:"MATH_POWER",k:[{type:"node_in",name:"od",qualifier:["float"],e:!1},{type:"node_in",name:"oe",qualifier:["float"],e:!1},{type:"node_out",name:"of",qualifier:["float"],e:!1}],f:[{type:"textline",b:"if ( od < ZERO_VALUE_NODES || od == ZERO_VALUE_NODES && oe == ZERO_VALUE_NODES ) of = ZERO_VALUE_NODES ; else of = pow ( od , oe ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"of = clamp ( of , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",k:[{type:"node_in",name:"og",qualifier:["float"],e:!1},{type:"node_in",name:"oh",qualifier:["float"],e:!1},{type:"node_out",name:"oi",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oi = ( og > ZERO_VALUE_NODES && oh > ZERO_VALUE_NODES ) ? log2 ( og ) / log2 ( oh ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oi = clamp ( oi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",k:[{type:"node_in",name:"oj",qualifier:["float"],e:!1},{type:"node_in",name:"ok",qualifier:["float"],e:!1},{type:"node_out",name:"ol",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ol = min ( oj , ok ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ol = clamp ( ol , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MAXIMUM",k:[{type:"node_in",name:"om",qualifier:["float"],e:!1},{type:"node_in",name:"on",qualifier:["float"],e:!1},{type:"node_out",name:"oo",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oo = max ( om , on ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oo = clamp ( oo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",k:[{type:"node_in",name:"op",qualifier:["float"],e:!1},
{type:"node_in",name:"oq",qualifier:["float"],e:!1},{type:"node_out",name:"or",qualifier:["float"],e:!1}],f:[{type:"textline",b:"or = floor ( op + 0.5 ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"or = clamp ( or , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oq",";"]}]},{type:"node",name:"MATH_LESS_THAN",k:[{type:"node_in",name:"os",qualifier:["float"],e:!1},{type:"node_in",name:"ot",qualifier:["float"],e:!1},
{type:"node_out",name:"ou",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ou = ( os < ot ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ou = clamp ( ou , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",k:[{type:"node_in",name:"ov",qualifier:["float"],e:!1},{type:"node_in",name:"ow",qualifier:["float"],e:!1},{type:"node_out",name:"ox",qualifier:["float"],
e:!1}],f:[{type:"textline",b:"ox = ( ov > ow ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ox = clamp ( ox , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",k:[{type:"node_in",name:"oy",qualifier:["float"],e:!1},{type:"node_in",name:"oz",qualifier:["float"],e:!1},{type:"node_out",name:"oA",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oA = abs ( oz ) > 0.000001 ? mod ( oy , oz ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oA = clamp ( oA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ABSOLUTE",k:[{type:"node_in",name:"oB",qualifier:["float"],e:!1},{type:"node_in",name:"oC",qualifier:["float"],e:!1},{type:"node_out",name:"oD",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oD = abs ( oB ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oD = clamp ( oD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["oC",";"]}]},{type:"node",name:"MIX_RGB_MIX",k:[{type:"node_in",name:"oE",qualifier:["float"],e:!1},{type:"node_in",name:"oF",qualifier:["vec3"],e:!1},{type:"node_in",name:"oG",qualifier:["vec3"],e:!1},{type:"node_out",name:"oH",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oI = clamp ( oE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oH = mix ( oF , oG , oI ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oH = clamp ( oH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_ADD",k:[{type:"node_in",name:"oJ",qualifier:["float"],e:!1},{type:"node_in",name:"oK",qualifier:["vec3"],e:!1},{type:"node_in",name:"oL",qualifier:["vec3"],e:!1},{type:"node_out",name:"oM",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oN = clamp ( oJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oM = mix ( oK , oK + oL , oN ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oM = clamp ( oM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_MULTIPLY",k:[{type:"node_in",name:"oO",qualifier:["float"],e:!1},{type:"node_in",name:"oP",qualifier:["vec3"],e:!1},{type:"node_in",name:"oQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"oR",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oS = clamp ( oO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oR = mix ( oP , oP * oQ , oS ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oR = clamp ( oR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SUBTRACT",k:[{type:"node_in",name:"oT",qualifier:["float"],e:!1},{type:"node_in",name:"oU",qualifier:["vec3"],e:!1},{type:"node_in",name:"oV",qualifier:["vec3"],e:!1},{type:"node_out",name:"oW",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oX = clamp ( oT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oW = mix ( oU , oU - oV , oX ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oW = clamp ( oW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SCREEN",k:[{type:"node_in",name:"oY",qualifier:["float"],e:!1},{type:"node_in",name:"oZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"o_",qualifier:["vec3"],e:!1},{type:"node_out",name:"pa",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pb = clamp ( oY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pc = UNITY_VALUE_NODES - pb ; pa = lA - ( vec3 ( pc ) + pb * ( lA - o_ ) ) * ( lA - oZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pa = clamp ( pa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DIVIDE",k:[{type:"node_in",name:"pd",qualifier:["float"],e:!1},{type:"node_in",name:"pe",qualifier:["vec3"],e:!1},{type:"node_in",name:"pf",qualifier:["vec3"],e:!1},{type:"node_out",name:"pg",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float ph = clamp ( pd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pi = UNITY_VALUE_NODES - ph ; pf += step ( pf , lz ) ; pg = pi * pe + ph * pe / pf ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pg = clamp ( pg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",k:[{type:"node_in",name:"pj",qualifier:["float"],e:!1},{type:"node_in",name:"pk",qualifier:["vec3"],e:!1},{type:"node_in",name:"pl",qualifier:["vec3"],e:!1},{type:"node_out",name:"pm",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pn = clamp ( pj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pm = mix ( pk , abs ( pk - pl ) , pn ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pm = clamp ( pm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DARKEN",k:[{type:"node_in",name:"po",qualifier:["float"],e:!1},{type:"node_in",name:"pp",qualifier:["vec3"],e:!1},{type:"node_in",name:"pq",qualifier:["vec3"],e:!1},{type:"node_out",name:"pr",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float ps = clamp ( po , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pr = min ( pp . rgb , pq . rgb * ps ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pr = clamp ( pr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_LIGHTEN",k:[{type:"node_in",name:"pt",qualifier:["float"],e:!1},{type:"node_in",name:"pu",qualifier:["vec3"],e:!1},{type:"node_in",name:"pv",qualifier:["vec3"],e:!1},{type:"node_out",name:"pw",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float px = clamp ( pt , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pw = max ( pu . rgb , pv . rgb * px ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pw = clamp ( pw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_OVERLAY",k:[{type:"node_in",name:"py",qualifier:["float"],e:!1},{type:"node_in",name:"pz",qualifier:["vec3"],e:!1},{type:"node_in",name:"pA",qualifier:["vec3"],e:!1},{type:"node_out",name:"pB",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pC = clamp ( py , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pD = vec3 ( UNITY_VALUE_NODES - pC ) ; pB = mix ( pz * ( pD + 2.0 * pC * pA ) , lA - ( pD + 2.0 * pC * ( lA - pA ) ) * ( lA - pz ) , step ( 0.5 , pz ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pB = clamp ( pB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DODGE",k:[{type:"node_in",name:"pE",qualifier:["float"],e:!1},{type:"node_in",name:"pF",qualifier:["vec3"],e:!1},{type:"node_in",name:"pG",qualifier:["vec3"],e:!1},{type:"node_out",name:"pH",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pI = clamp ( pE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pJ = lA - pI * pG ; vec3 pK = clamp ( pF / pJ , 0.0 , 1.0 ) ; pH = mix ( mix ( pK , lA , step ( pJ , lz ) ) , pF , step ( pF , lz ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pH = clamp ( pH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_BURN",k:[{type:"node_in",name:"pL",qualifier:["float"],e:!1},{type:"node_in",name:"pM",qualifier:["vec3"],e:!1},{type:"node_in",name:"pN",qualifier:["vec3"],e:!1},{type:"node_out",name:"pO",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pP = clamp ( pL , 0.0 , 1.0 ) ; vec3 pQ = vec3 ( 1.0 - pP ) ; vec3 pR = pQ + pP * pN ; vec3 pS = clamp ( lA - ( lA - pM ) / pR , 0.0 , 1.0 ) ; pO = mix ( pS , lz , step ( pR , lz ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pO = clamp ( pO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_HUE",k:[{type:"node_in",name:"pT",qualifier:["float"],e:!1},{type:"node_in",name:"pU",qualifier:["vec3"],e:!1},{type:"node_in",name:"pV",qualifier:["vec3"],e:!1},{type:"node_out",name:"pW",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pX = clamp ( pT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pY , pZ , p_ ; pW = pU ; pZ = lO ( pV ) ; if ( pZ . y != ZERO_VALUE_NODES ) { pY = lO ( pW ) ; pY . x = pZ . x ; p_ = lS ( pY ) ; pW = mix ( pW , p_ , pX ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pW = clamp ( pW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SATURATION",k:[{type:"node_in",name:"qa",qualifier:["float"],e:!1},{type:"node_in",name:"qb",qualifier:["vec3"],e:!1},{type:"node_in",name:"qc",qualifier:["vec3"],e:!1},{type:"node_out",name:"qd",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qe = clamp ( qa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qf = UNITY_VALUE_NODES - qe ; qd = qb ; vec3 qg , qh ; qg = lO ( qd ) ; if ( qg . y != ZERO_VALUE_NODES ) { qh = lO ( qc ) ; qg . y = qf * qg . y + qe * qh . y ; qd = lS ( qg ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qd = clamp ( qd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_VALUE",k:[{type:"node_in",name:"qi",qualifier:["float"],e:!1},{type:"node_in",name:"qj",qualifier:["vec3"],e:!1},{type:"node_in",name:"qk",qualifier:["vec3"],e:!1},{type:"node_out",name:"ql",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qm = clamp ( qi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qn = UNITY_VALUE_NODES - qm ; vec3 qo , qp ; qo = lO ( qj ) ; qp = lO ( qk ) ; qo . z = qn * qo . z + qm * qp . z ; ql = lS ( qo ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"ql = clamp ( ql , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_COLOR",k:[{type:"node_in",name:"qq",qualifier:["float"],e:!1},{type:"node_in",name:"qr",qualifier:["vec3"],e:!1},{type:"node_in",name:"qs",qualifier:["vec3"],e:!1},{type:"node_out",name:"qt",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qu = clamp ( qq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qv , qw , qx ; qt = qr ; qw = lO ( qs ) ; if ( qw . y != ZERO_VALUE_NODES ) { qv = lO ( qt ) ; qv . x = qw . x ; qv . y = qw . y ; qx = lS ( qv ) ; qt = mix ( qt , qx , qu ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qt = clamp ( qt , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",k:[{type:"node_in",name:"qy",qualifier:["float"],e:!1},{type:"node_in",name:"qz",qualifier:["vec3"],e:!1},{type:"node_in",name:"qA",qualifier:["vec3"],e:!1},{type:"node_out",name:"qB",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qC = clamp ( qy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qD = UNITY_VALUE_NODES - qC ; vec3 qE = qA + qz - qA * qz ; qB = qz * ( vec3 ( qD ) + vec3 ( qC ) * ( ( lA - qz ) * qA + qE ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qB = clamp ( qB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",k:[{type:"node_in",name:"qF",qualifier:["float"],e:!1},{type:"node_in",name:"qG",qualifier:["vec3"],e:!1},{type:"node_in",name:"qH",qualifier:["vec3"],e:!1},{type:"node_out",name:"qI",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qJ = clamp ( qF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qI = qG + qJ * ( 2.0 * qH - lA ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qI = clamp ( qI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"OUTPUT",k:[{type:"node_in",name:"qK",qualifier:["vec3"],e:!1},{type:"node_in",name:"qL",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mv = qK ; mA = qL ;".split(" ")}]},{type:"node",name:"MATERIAL",k:[{type:"node_in",name:"qM",qualifier:["vec3"],e:!1},{type:"node_in",name:"qN",qualifier:["float"],
e:!1},{type:"node_in",name:"qO",qualifier:["vec3"],e:!1},{type:"node_in",name:"qP",qualifier:["vec3"],e:!0},{type:"node_out",name:"qQ",qualifier:["vec3"],e:!0},{type:"node_out",name:"qR",qualifier:["float"],e:!0},{type:"node_out",name:"qS",qualifier:["vec3"],e:!0},{type:"node_param",name:"md",qualifier:["const","vec2"]},{type:"node_param",name:"me",qualifier:["const","vec3"]}],f:[{type:"textline",b:"{ vec3 qT = clamp ( qM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qU = me [ 0 ] * clamp ( qO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"vec3 qV = normalize ( qP ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["vec3","qV","=","mk",";"]}]}]},{type:"textline",b:["hx","qW",";"]},{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT"],f:[{type:"textline",b:"vec3 qX = ms * qT ; float qY = 0.5 * qV . y + 0.5 ; vec3 qZ = mu * u_environment_energy * lH ( qY , qV ) ; float q_ = fs ( qT ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"vec2 ra = vec2 ( md [ 0 ] , md [ 1 ] ) ; vec2 rb = vec2 ( me [ 1 ] , me [ 2 ] ) ; qW = kc ( qX , qZ , qT , qU , mq , qV , mp , rb , ra , q_ , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:"qW = kh ( qX , qZ , qT ) ;".split(" ")}]}]},{type:"textline",b:["mz","=","q_",";"]}]},{type:"node_else",f:[{type:"textline",
b:"qW . a = vec4 ( qT , ZERO_VALUE_NODES ) ; qW . b = lz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qQ"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"qQ = qW . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["qQ","=","lz",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"qQ += qW . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_qR"],f:[{type:"textline",b:"qR = clamp ( qN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"qR += qW . a . a * qU . r * mt ; qR = clamp ( qR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qS"],f:[{type:"textline",b:["qS","=","qV",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",
b:"mw = qW . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["mw","=","lz",";"]}]}]},{type:"textline",b:["mx","=","qV",";","}"]}]},{type:"node",name:"MATERIAL_EXT",k:[{type:"node_in",name:"rc",qualifier:["vec3"],e:!1},{type:"node_in",name:"rd",qualifier:["float"],e:!1},{type:"node_in",name:"re",qualifier:["vec3"],e:!1},{type:"node_in",name:"rf",qualifier:["vec3"],e:!0},{type:"node_in",name:"rg",qualifier:["float"],e:!1},{type:"node_in",name:"rh",qualifier:["float"],e:!1},{type:"node_in",
name:"ri",qualifier:["vec4"],e:!1},{type:"node_in",name:"rj",qualifier:["float"],e:!1},{type:"node_in",name:"rk",qualifier:["float"],e:!1},{type:"node_out",name:"rl",qualifier:["vec3"],e:!0},{type:"node_out",name:"rm",qualifier:["float"],e:!0},{type:"node_out",name:"rn",qualifier:["vec3"],e:!0},{type:"node_out",name:"ro",qualifier:["vec3"],e:!0},{type:"node_out",name:"rp",qualifier:["vec3"],e:!0},{type:"node_param",name:"mf",qualifier:["const","vec2"]},{type:"node_param",name:"mg",qualifier:["const",
"vec3"]}],f:[{type:"textline",b:"{ vec3 rq = clamp ( rc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 rr = mg [ 0 ] * clamp ( re , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"vec3 rs = normalize ( rf ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["vec3","rs","=","mk",";"]}]}]},{type:"textline",b:["hx","rt",";"]},{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT"],f:[{type:"textline",
b:"float ru = fs ( rq ) ; vec3 rv = rg * rq ; float rw = 0.5 * rs . y + 0.5 ; vec3 rx = mu * u_environment_energy * lH ( rw , rs ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"vec2 ry = vec2 ( mf [ 0 ] , mf [ 1 ] ) ; vec2 rz = vec2 ( mg [ 1 ] , mg [ 2 ] ) ; rt = kc ( rv , rx , rq , rr , mq , rs , mp , rz , ry , ru , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , rh , ri ) ;".split(" ")}]},{type:"node_else",
f:[{type:"textline",b:"rt = kh ( rv , rx , rq ) ;".split(" ")}]}]},{type:"textline",b:["mz","=","ru",";"]}]},{type:"node_else",f:[{type:"textline",b:"rt . a = vec4 ( rq , ZERO_VALUE_NODES ) ; rt . b = lz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rl"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"rl = rt . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["rl","=","lz",";"]}]}]},{type:"node_condition",a:[{type:"node_if",
c:["REFLECTIVE","||","TEXTURE_MIRROR"],f:[{type:"textline",b:"lk ( rl , mp , rs , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , rj ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"rl += rt . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rm"],f:[{type:"textline",b:"rm = clamp ( rd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],
f:[{type:"textline",b:"rm += rt . a . a * rr . r * rk ; rm = clamp ( rm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rn"],f:[{type:"textline",b:["rn","=","rs",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ro"],f:[{type:"textline",b:"ro = rt . a . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rp"],f:[{type:"textline",b:"rp = rt . b ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"mw = rt . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["mw","=","lz",";"]}]}]},{type:"textline",b:["mx","=","rs",";","}"]}]},{type:"node",name:"RGB",k:[{type:"node_out",name:"rA",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rA = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",k:[{type:"node_in",name:"rB",qualifier:["vec3"],e:!1},{type:"node_out",name:"rC",qualifier:["float"],e:!1}],f:[{type:"textline",b:"rC = rB . r * 0.35 + rB . g * 0.45 + rB . b * 0.2 ;".split(" ")}]},
{type:"node",name:"SEPRGB",k:[{type:"node_in",name:"rD",qualifier:["vec3"],e:!1},{type:"node_out",name:"rE",qualifier:["float"],e:!0},{type:"node_out",name:"rF",qualifier:["float"],e:!0},{type:"node_out",name:"rG",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rE"],f:[{type:"textline",b:"rE = rD . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rF"],f:[{type:"textline",b:"rF = rD . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_rG"],f:[{type:"textline",b:"rG = rD . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",k:[{type:"node_in",name:"rH",qualifier:["vec3"],e:!1},{type:"node_out",name:"rI",qualifier:["float"],e:!0},{type:"node_out",name:"rJ",qualifier:["float"],e:!0},{type:"node_out",name:"rK",qualifier:["float"],e:!0}],f:[{type:"textline",b:"{ vec3 rL = lO ( rH ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rI"],f:[{type:"textline",b:"rI = rL . r ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_rJ"],f:[{type:"textline",b:"rJ = rL . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rK"],f:[{type:"textline",b:"rK = rL . b ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"SQUEEZE",k:[{type:"node_in",name:"rM",qualifier:["float"],e:!1},{type:"node_in",name:"rN",qualifier:["float"],e:!1},{type:"node_in",name:"rO",qualifier:["float"],e:!1},{type:"node_out",name:"rP",qualifier:["float"],e:!1}],f:[{type:"textline",b:"rP = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( rM - rO ) * rN ) ) ) ;".split(" ")}]},
{type:"node",name:"B4W_SRGB_TO_LINEAR",k:[{type:"node_in",name:"rQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"rR",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rR = max ( lz , rQ ) ; rR = pow ( rR , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",k:[{type:"node_in",name:"rS",qualifier:["vec3"],e:!1},{type:"node_out",name:"rT",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rT = max ( lz , rS ) ; rT = pow ( rT , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",
name:"TEXTURE_EMPTY",k:[{type:"node_out",name:"rU",qualifier:["vec3"],e:!1},{type:"node_out",name:"rV",qualifier:["vec3"],e:!1},{type:"node_out",name:"rW",qualifier:["float"],e:!1}],f:[{type:"textline",b:"{ rW = rU [ 0 ] = rU [ 1 ] = rU [ 2 ] = rV [ 0 ] = rV [ 1 ] = rV [ 2 ] = 0.0 ; }".split(" ")}]},{type:"node",name:"TEXTURE_COLOR",k:[{type:"node_in",name:"rX",qualifier:["vec3"],e:!1},{type:"node_out",name:"rY",qualifier:["vec3"],e:!1},{type:"node_out",name:"rZ",qualifier:["float"],e:!1},{type:"node_param",
name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 r_ = texture2D ( node_TEXTURE_COLOR_var_texture , lW ( rX ) ) ; rY = r_ . xyz ; gy ( rY ) ; rZ = r_ . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_NORMAL",k:[{type:"node_in",name:"sa",qualifier:["vec3"],e:!1},{type:"node_out",name:"sb",qualifier:["vec3"],e:!1},{type:"node_out",name:"sc",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],
f:[{type:"textline",b:"{ vec4 sd = texture2D ( node_TEXTURE_NORMAL_var_texture , lW ( sa ) ) ; my = sd . xyz - 0.5 ; sb = normalize ( mn * my ) ; sc = sd . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_ENVIRONMENT",k:[{type:"node_in",name:"se",qualifier:["vec3"],e:!1},{type:"node_out",name:"sf",qualifier:["vec3"],e:!0},{type:"node_out",name:"sg",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]}],f:[{type:"textline",b:"{ vec4 sh = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , se ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sf"],f:[{type:"textline",b:"sf = sh . xyz ; gy ( sf ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sg"],f:[{type:"textline",b:"sg = sh . w ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"TEXTURE_COLOR2",k:[{type:"node_in",name:"si",qualifier:["vec3"],e:!1},{type:"node_in",name:"sj",qualifier:["vec3"],e:!1},{type:"node_out",name:"sk",qualifier:["vec3"],e:!1},{type:"node_out",name:"sl",qualifier:["float"],
e:!1},{type:"node_out",name:"sm",qualifier:["vec3"],e:!1},{type:"node_out",name:"sn",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_COLOR2_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 so = texture2D ( node_TEXTURE_COLOR2_var_texture , lW ( si ) ) ; sk = so . xyz ; gy ( sk ) ; sl = so . w ; so = texture2D ( node_TEXTURE_COLOR2_var_texture , lW ( sj ) ) ; sm = so . xyz ; gy ( sm ) ; sn = so . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_NORMAL2",
k:[{type:"node_in",name:"sp",qualifier:["vec3"],e:!1},{type:"node_in",name:"sq",qualifier:["vec3"],e:!1},{type:"node_out",name:"sr",qualifier:["vec3"],e:!1},{type:"node_out",name:"ss",qualifier:["float"],e:!1},{type:"node_out",name:"st",qualifier:["vec3"],e:!1},{type:"node_out",name:"su",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL2_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sv = texture2D ( node_TEXTURE_NORMAL2_var_texture , lW ( sp ) ) ; my = sv . xyz - 0.5 ; sr = normalize ( mn * my ) ; ss = sv . w ; sv = texture2D ( node_TEXTURE_NORMAL2_var_texture , lW ( sq ) ) ; my = sv . xyz - 0.5 ; st = normalize ( mn * my ) ; su = sv . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_COLOR3",k:[{type:"node_in",name:"sw",qualifier:["vec3"],e:!1},{type:"node_in",name:"sx",qualifier:["vec3"],e:!1},{type:"node_in",name:"sy",qualifier:["vec3"],e:!1},{type:"node_out",name:"sz",qualifier:["vec3"],e:!1},{type:"node_out",name:"sA",qualifier:["float"],e:!1},{type:"node_out",name:"sB",qualifier:["vec3"],e:!1},{type:"node_out",name:"sC",qualifier:["float"],e:!1},{type:"node_out",name:"sD",qualifier:["vec3"],e:!1},{type:"node_out",name:"sE",qualifier:["float"],e:!1},
{type:"node_param",name:"node_TEXTURE_COLOR3_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sF = texture2D ( node_TEXTURE_COLOR3_var_texture , lW ( sw ) ) ; sz = sF . xyz ; gy ( sz ) ; sA = sF . w ; sF = texture2D ( node_TEXTURE_COLOR3_var_texture , lW ( sx ) ) ; sB = sF . xyz ; gy ( sB ) ; sC = sF . w ; sF = texture2D ( node_TEXTURE_COLOR3_var_texture , lW ( sy ) ) ; sD = sF . xyz ; gy ( sD ) ; sE = sF . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_COLOR4",k:[{type:"node_in",
name:"sG",qualifier:["vec3"],e:!1},{type:"node_in",name:"sH",qualifier:["vec3"],e:!1},{type:"node_in",name:"sI",qualifier:["vec3"],e:!1},{type:"node_in",name:"sJ",qualifier:["vec3"],e:!1},{type:"node_out",name:"sK",qualifier:["vec3"],e:!1},{type:"node_out",name:"sL",qualifier:["float"],e:!1},{type:"node_out",name:"sM",qualifier:["vec3"],e:!1},{type:"node_out",name:"sN",qualifier:["float"],e:!1},{type:"node_out",name:"sO",qualifier:["vec3"],e:!1},{type:"node_out",name:"sP",qualifier:["float"],e:!1},
{type:"node_out",name:"sQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"sR",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_COLOR4_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sS = texture2D ( node_TEXTURE_COLOR4_var_texture , lW ( sG ) ) ; sK = sS . xyz ; gy ( sK ) ; sL = sS . w ; sS = texture2D ( node_TEXTURE_COLOR4_var_texture , lW ( sH ) ) ; sM = sS . xyz ; gy ( sM ) ; sN = sS . w ; sS = texture2D ( node_TEXTURE_COLOR4_var_texture , lW ( sI ) ) ; sO = sS . xyz ; gy ( sO ) ; sP = sS . w ; sS = texture2D ( node_TEXTURE_COLOR4_var_texture , lW ( sJ ) ) ; sQ = sS . xyz ; gy ( sQ ) ; sR = sS . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_NORMAL3",k:[{type:"node_in",name:"sT",qualifier:["vec3"],e:!1},{type:"node_in",name:"sU",qualifier:["vec3"],e:!1},{type:"node_in",name:"sV",qualifier:["vec3"],e:!1},{type:"node_out",name:"sW",qualifier:["vec3"],e:!1},{type:"node_out",name:"sX",qualifier:["float"],e:!1},{type:"node_out",name:"sY",qualifier:["vec3"],e:!1},{type:"node_out",name:"sZ",qualifier:["float"],e:!1},{type:"node_out",name:"s_",qualifier:["vec3"],e:!1},{type:"node_out",name:"ta",qualifier:["float"],
e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL3_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 tb = texture2D ( node_TEXTURE_NORMAL3_var_texture , lW ( sT ) ) ; my = tb . xyz - 0.5 ; sW = normalize ( mn * my ) ; sX = tb . w ; tb = texture2D ( node_TEXTURE_NORMAL3_var_texture , lW ( sU ) ) ; my = tb . xyz - 0.5 ; sY = normalize ( mn * my ) ; sZ = tb . w ; tb = texture2D ( node_TEXTURE_NORMAL3_var_texture , lW ( sV ) ) ; my = tb . xyz - 0.5 ; s_ = normalize ( mn * my ) ; ta = tb . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_NORMAL4",k:[{type:"node_in",name:"tc",qualifier:["vec3"],e:!1},{type:"node_in",name:"td",qualifier:["vec3"],e:!1},{type:"node_in",name:"te",qualifier:["vec3"],e:!1},{type:"node_in",name:"tf",qualifier:["vec3"],e:!1},{type:"node_out",name:"tg",qualifier:["vec3"],e:!1},{type:"node_out",name:"th",qualifier:["float"],e:!1},{type:"node_out",name:"ti",qualifier:["vec3"],e:!1},{type:"node_out",name:"tj",qualifier:["float"],e:!1},{type:"node_out",name:"tk",qualifier:["vec3"],e:!1},
{type:"node_out",name:"tl",qualifier:["float"],e:!1},{type:"node_out",name:"tm",qualifier:["vec3"],e:!1},{type:"node_out",name:"tn",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL4_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 to = texture2D ( node_TEXTURE_NORMAL4_var_texture , lW ( tc ) ) ; my = to . xyz - 0.5 ; tg = normalize ( mn * my ) ; th = to . w ; to = texture2D ( node_TEXTURE_NORMAL4_var_texture , lW ( td ) ) ; my = to . xyz - 0.5 ; ti = normalize ( mn * my ) ; tj = to . w ; to = texture2D ( node_TEXTURE_NORMAL4_var_texture , lW ( te ) ) ; my = to . xyz - 0.5 ; tk = normalize ( mn * my ) ; tl = to . w ; to = texture2D ( node_TEXTURE_NORMAL4_var_texture , lW ( tf ) ) ; my = to . xyz - 0.5 ; tm = normalize ( mn * my ) ; tn = to . w ; }".split(" ")}]},
{type:"node",name:"VALUE",k:[{type:"node_out",name:"tp",qualifier:["float"],e:!1}],f:[{type:"textline",b:"tp = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",k:[{type:"node_in",name:"tq",qualifier:["vec3"],e:!1},{type:"node_in",name:"tr",qualifier:["vec3"],e:!1},{type:"node_out",name:"ts",qualifier:["vec3"],e:!1},{type:"node_out",name:"tt",qualifier:["float"],e:!0}],f:[{type:"textline",b:"ts = tq + tr ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tt"],
f:[{type:"textline",b:"tt = ( abs ( ts [ 0 ] ) + abs ( ts [ 1 ] ) + abs ( ts [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_SUBTRACT",k:[{type:"node_in",name:"tu",qualifier:["vec3"],e:!1},{type:"node_in",name:"tv",qualifier:["vec3"],e:!1},{type:"node_out",name:"tw",qualifier:["vec3"],e:!1},{type:"node_out",name:"tx",qualifier:["float"],e:!0}],f:[{type:"textline",b:"tw = tu - tv ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tx"],f:[{type:"textline",b:"tx = ( abs ( tw [ 0 ] ) + abs ( tw [ 1 ] ) + abs ( tw [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_AVERAGE",k:[{type:"node_in",name:"ty",qualifier:["vec3"],e:!1},{type:"node_in",name:"tz",qualifier:["vec3"],e:!1},{type:"node_out",name:"tA",qualifier:["vec3"],e:!1},{type:"node_out",name:"tB",qualifier:["float"],e:!0}],f:[{type:"textline",b:"tA = ty + tz ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tB"],f:[{type:"textline",b:"tB = length ( tA ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tA"],f:[{type:"textline",b:"tA = normalize ( tA ) ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_DOT_PRODUCT",k:[{type:"node_in",name:"tC",qualifier:["vec3"],e:!1},{type:"node_in",name:"tD",qualifier:["vec3"],e:!1},{type:"node_out",name:"tE",qualifier:["vec3"],e:!1},{type:"node_out",name:"tF",qualifier:["float"],e:!0}],f:[{type:"textline",b:["tE","=","lz",";"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tF"],f:[{type:"textline",b:"tF = dot ( tC , tD ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",k:[{type:"node_in",name:"tG",qualifier:["vec3"],
e:!1},{type:"node_in",name:"tH",qualifier:["vec3"],e:!1},{type:"node_out",name:"tI",qualifier:["vec3"],e:!1},{type:"node_out",name:"tJ",qualifier:["float"],e:!0}],f:[{type:"textline",b:"tI = cross ( tG , tH ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tJ"],f:[{type:"textline",b:"tJ = length ( tI ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",k:[{type:"node_in",name:"tK",qualifier:["vec3"],e:!1},{type:"node_in",name:"tL",qualifier:["vec3"],e:!1},{type:"node_out",
name:"tM",qualifier:["vec3"],e:!1},{type:"node_out",name:"tN",qualifier:["float"],e:!0}],f:[{type:"textline",b:"tM = normalize ( tK ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tN"],f:[{type:"textline",b:"tN = length ( tK ) ;".split(" ")}]}]},{type:"textline",b:["tL",";"]}]},{type:"node",name:"B4W_REFLECT",k:[{type:"node_in",name:"tO",qualifier:["vec3"],e:!1},{type:"node_in",name:"tP",qualifier:["vec3"],e:!1},{type:"node_out",name:"tQ",qualifier:["vec3"],e:!1}],f:[{type:"textline",
b:"tQ = reflect ( - tO , tP ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",k:[{type:"node_in",name:"tR",qualifier:["vec3"],e:!1},{type:"node_in",name:"tS",qualifier:["float"],e:!1},{type:"node_in",name:"tT",qualifier:["const","float"],e:!1},{type:"node_in",name:"tU",qualifier:["const","float"],e:!1},{type:"node_out",name:"tV",qualifier:["vec3"],e:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ float tW = length ( mr ) ; if ( tW < tU ) { vec2 tX = lW ( tR ) ; float tY = clamp ( 0.5 * ( tU - tW ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float tZ = tS * tY ; vec3 t_ = normalize ( mp * mn ) ; float ua = UNITY_VALUE_NODES / tT ; vec2 ub = t_ . xy * tZ / ( tT * t_ . z ) ; float uc = UNITY_VALUE_NODES ; float ud = texture2D ( node_B4W_PARALLAX_var_texture , tX ) . a ; for ( float ue = 1.0 ; ue <= tT ; ue ++ ) { if ( ud < uc ) { uc -= ua ; tX -= ub ; ud = texture2D ( node_B4W_PARALLAX_var_texture , tX ) . a ; } } vec2 uf = tX + ub ; float ug = texture2D ( node_B4W_PARALLAX_var_texture , uf ) . a - ( uc + ua ) ; float uh = ud - uc ; float ui = uh / ( uh - ug ) ; tX = ui * uf + ( UNITY_VALUE_NODES - ui ) * tX ; tV = lU ( tX ) ; } else tV = tR ; }".split(" ")}]},
{type:"node",name:"B4W_CLAMP",k:[{type:"node_in",name:"uj",qualifier:["vec3"],e:!1},{type:"node_out",name:"uk",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"uk = clamp ( uj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",k:[{type:"node_in",name:"ul",qualifier:["vec3"],e:!1},{type:"node_in",name:"um",qualifier:["float"],e:!1},{type:"node_out",name:"un",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"un = lE ( ul , um ) ;".split(" ")}]},{type:"node",
name:"B4W_TRANSLUCENCY",k:[{type:"node_in",name:"uo",qualifier:["float"],e:!1},{type:"node_in",name:"up",qualifier:["float"],e:!1},{type:"node_in",name:"uq",qualifier:["float"],e:!1},{type:"node_in",name:"ur",qualifier:["float"],e:!1},{type:"node_in",name:"us",qualifier:["float"],e:!1},{type:"node_out",name:"ut",qualifier:["float"],e:!0},{type:"node_out",name:"uu",qualifier:["vec4"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ut"],f:[{type:"textline",b:["ut","=","uo",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_uu"],f:[{type:"textline",b:"uu = vec4 ( up , uq , ur , us ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",k:[{type:"node_out",name:"uv",qualifier:["float"],e:!1}],f:[{type:"textline",b:["uv","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",k:[{type:"node_in",name:"uw",qualifier:["float"],e:!1},{type:"node_in",name:"ux",qualifier:["float"],e:!1},{type:"node_in",name:"uy",qualifier:["float"],e:!1},{type:"node_out",name:"uz",qualifier:["float"],
e:!1}],f:[{type:"textline",b:"uz = smoothstep ( ux , uy , uw ) ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mh","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float mi = kK . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mj","=","kL",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) mj = mj ; else mj = - mj ;".split(" ")}]}}]},{type:"textline",b:"vec3 mk = normalize ( mj ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",
a:[{type:"textline",b:"vec3 ml = cross ( mj , kM . xyz ) * kM . w ; mat3 mm = mat3 ( kM . xyz , ml , mj ) ; mat3 mn = mm ;".split(" ")}]}}]},{type:"textline",b:"vec3 mo = u_camera_eye_frag - kK ; vec3 mp = normalize ( mo ) ; vec3 mq = kK ; vec4 mr = cL ; float ms = u_emit ; float mt = u_specular_alpha ; float mu = u_ambient ; vec3 mv ; vec3 mw ; vec3 mx ; vec3 my ; float mz ; float mA ;".split(" ")},{type:"nodes_main"},{type:"textline",b:"vec3 uA = mv ; float uB = mA ;".split(" ")},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"uA = max ( uA - sqrt ( 0.01 * - min ( mi , ZERO_VALUE_NODES ) ) , 0.5 * uA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"kI ( uA , mi , u_time , mz , mx , u_sun_direction , mh , u_sun_quaternion , kK , length ( cL ) ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),
group:{type:"group",a:[{type:"textline",b:"float uC = clamp ( length ( u_sun_intensity ) + u_environment_energy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 uD = gS ( u_cube_fog , mp ) ; vec4 uE = vec4 ( uD , u_fog_color_density . a ) ; gy ( uE . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec4 uE = u_fog_color_density ; uE . rgb *= uC ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"hk ( uA , length ( cL ) , mp , u_cam_water_depth , u_underwater_fog_color_density , uE , mi , uC ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( uA , length ( cL ) , uE ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( uB < 0.5 ) discard ; uB = UNITY_VALUE_NODES ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 uF = texture2DProj ( u_shadow_mask , cK ) . rg ; float uG = uF . g ; uA = vec3 ( uG ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","uA",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( uA , uB ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( uA , uB ) ; }".split(" ")}]};
a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",
b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",
b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",
";"]}]}}]},{type:"textline",b:"varying vec3 kK ; varying vec4 cL ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kM",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kO",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"lX",qualifier:["varying",
"vec2"]}],f:[{type:"textline",b:["lX","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",k:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"mb",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["mb","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"mc",
qualifier:["varying","float"]}],f:[{type:"textline",b:["mc","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"md",qualifier:["varying","vec2"]}],f:[{type:"textline",b:["md","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute",
"vec3"]},{type:"node_param",name:"me",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["me","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec3 mf = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mg = a_normal ; vec3 mh = vec3 ( a_tangent ) ; vec3 mi = a_tangent [ 3 ] * cross ( mg , mh ) ;".split(" ")}]}},{type:"elif",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec3 mg = a_normal ; vec3 mh = vec3 ( 0.0 ) ; vec3 mi = vec3 ( 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mg = vec3 ( 0.0 ) ; vec3 mh = vec3 ( 0.0 ) ; vec3 mi = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"mf = mix ( mf , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"mg = mix ( mg , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mj = vec3 ( a_tangent ) ; vec3 mk = a_tangent_next [ 3 ] * cross ( a_normal_next , mj ) ; mh = mix ( mh , mj , u_va_frame_factor ) ; mi = mix ( mi , mk , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",
b:"bt ( mf , mh , mi , mg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","ml","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ml = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 mm = ( u_model_matrix * vec4 ( ml , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],
group:{type:"group",a:[{type:"textline",b:"mat4 mn = ag ( u_camera_eye , mm , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 mn = aa ( u_camera_eye , mm , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 mo = ( u_model_matrix * vec4 ( ml , 1.0 ) ) . xyz ; mn = mn * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , mo ) ;".split(" ")}]}}]},
{type:"textline",b:"d mp = an ( mf - ml , ml , mh , mi , mg , mn ) ; mp . b = mm ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d mp = an ( mf , ml , mh , mi , mg , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( mp . a , mp . b , mg ) ;".split(" ")}]}}]},{type:"textline",b:"kK = mp . a ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"kL = mp . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"float mq = ( dot ( cross ( mp . e , mp . c ) , mp . d ) < 0.0 ) ? - 1.0 : 1.0 ; kM = vec4 ( mp . c , mq ) ;".split(" ")}]}}]},{type:"textline",b:"cL = u_view_matrix * vec4 ( mp . a , 1.0 ) ; vec4 mr = u_proj_matrix * cL ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"mr . xy += u_subpixel_jitter * mr . w ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gr","(","mr",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gr ( mp . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_B4W_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:"float ms = mr . x ; float mt = mr . y ; float mu = mr . w ; cK . x = ( ms + mu ) / 2.0 ; cK . y = ( mt + mu ) / 2.0 ; cK . z = mu ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kO = - cL . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},{type:"textline",b:["gl_Position","=","mr",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float mf ; varying vec3 kN ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cL",";"]}]}}]},{type:"textline",b:"void main ( ) { float mg = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; float mh = smoothstep ( u_p_alpha_start , u_p_alpha_end , mg ) ; float mi = u_diffuse_color . a * mf * ( 1.0 - clamp ( mh , 0.0 , 1.0 ) ) ; vec3 mj = kN * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gL ( mj , length ( cL ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","mj",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( mj , mi ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( mj , mi ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",
b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",
b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float mf ; varying vec3 kN ; varying vec3 cL ;".split(" ")},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { mg mW ; mW = mV ( ) ; vec4 mX = u_view_matrix * vec4 ( mW . b , 1.0 ) ; gl_Position = u_proj_matrix * mX ; mf = mW . c ; kN = mW . d ; cL = mX . xyz ; float mY = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = mW . a * mY ; }".split(" ")}]};
a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],
group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float mf ; varying vec3 kN ; varying vec2 a ; varying vec3 kJ ; varying vec3 kK ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 lz = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"vec4 lA = texture2D ( u_sampler , a ) ; gy ( lA . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lz . rgb = mix ( lz . rgb , lA . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lz . rgb *= mix ( vec3 ( 1.0 ) , lA . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"lz . a = lA . a ;".split(" ")}]}}]},{type:"textline",b:"lz . rgb *= kN ; vec3 lB = u_diffuse_intensity * lz . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"vec3 lC = u_emit * lz . rgb ; vec3 lD = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 lE = u_environment_energy * textureCube ( u_sky_texture , lD ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lF = 0.5 ; vec3 lE = u_environment_energy * mix ( u_horizon_color , u_zenith_color , lF ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lG = u_ambient * lE ; float lH = u_specular_params [ 0 ] ; vec2 lI = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 lJ = lH * u_specular_color ; vec3 lK = normalize ( kJ ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hx lL = kc ( lC , lG , lB , lJ , kK , lD , lK , lI , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hx lL = kh ( lC , lG , lB ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lM = lL . a . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["vec3","lM","=","lB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gL ( lM , length ( cL ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"float lN = lz . a * mf ; gA ( lM ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( lM , lN ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lM , lN ) ; }".split(" ")}]};
a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float mf ; varying vec3 kN ; varying vec2 a ; varying vec3 kJ ; varying vec3 kK ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float lB ( vec2 lz , vec2 lA ) { return ( atan ( lA . y , lA . x ) - atan ( lz . y , lz . x ) ) ; } void main ( ) { mg lC ; lC = mV ( ) ; float lD ; mat4 lE ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { lD = lC . e ; lE = z ( lC . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { lD = lC . e ; lE = k ( ) ; lE [ 3 ] = vec4 ( lC . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { lD = lC . e ; lE = o ( radians ( 90.0 ) ) ; lE [ 3 ] = vec4 ( lC . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { lD = lB ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + lC . e ; lE = m ( radians ( - 90.0 ) ) ; lE [ 3 ] = vec4 ( lC . b , 1.0 ) ; } vec4 lF = vec4 ( a_p_bb_vertex * 2.0 * lC . a * u_p_size , 0.0 , 1.0 ) ; vec4 lG = lE * q ( lD ) * lF ; vec4 lH = u_view_matrix * lG ; vec4 lI = u_proj_matrix * lH ; gl_Position = lI ; mf = lC . c ; kN = lC . d ; a = a_p_bb_vertex + 0.5 ; kK = lG . xyz ; kJ = u_camera_eye - lG . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cL","=","lH",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 mW ; const float mX = 0.99 ; const float mY = 1.8 ; const int mZ = 8 ; float ni ( vec3 m_ , vec3 na ) { float nb = dot ( na , na ) ; float nc = 2.0 * dot ( na , m_ ) ; float nd = dot ( m_ , m_ ) - 1.0 ; float ne = nc * nc - 4.0 * nb * nd ; float nf = sqrt ( ne ) ; float ng = ( - nc - nf ) / 2.0 ; float nh = nd / ng ; return nh ; } float np ( float nj , float nk ) { float nl = 3.0 * ( 1.0 - nk * nk ) ; float nm = 2.0 * ( 2.0 + nk * nk ) ; float nn = 1.0 + nj * nj ; float no = pow ( 1.0 + nk * nk - 2.0 * nk * nj , 1.5 ) ; no = max ( no , 0.00001 ) ; return ( nl / nm ) * ( nn / no ) ; } float nx ( vec3 nq , vec3 nr , float ns ) { float nt = dot ( nr , - nq ) ; if ( nt < 0.0 ) { return 1.0 ; } vec3 nu = nq + nt * nr ; if ( length ( nu ) < ns ) { return 0.0 ; } else if ( length ( nu ) >= ns ) { vec3 nv = normalize ( nu ) * ns - nq ; float nw = acos ( dot ( normalize ( nv ) , nr ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( nw * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 nB ( float ny , vec3 nz , float nA ) { return nz - nz * pow ( u_sky_color , vec3 ( nA / ny ) ) ; } void main ( ) { vec3 nC = normalize ( mW ) ; vec3 nD = u_sun_direction ; float nE = dot ( nC , nD ) ; float nF = np ( nE , - 0.01 ) * u_rayleigh_brightness * nD . y ; float nG = np ( nE - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - nD . y ) ; float nH = smoothstep ( 0.0 , 100.0 , np ( nE , 0.9995 ) ) * u_spot_brightness ; vec3 nI = vec3 ( 0.0 , mX , 0.0 ) ; float nJ = ni ( nI , nC ) ; float nK = nJ / float ( mZ ) ; float nL = nx ( nI , nC , mX - 0.3 ) ; vec3 nM = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 nN = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int nO = 0 ; nO < mZ ; nO ++ ) { float nP = nK * float ( nO ) ; vec3 nQ = nI + nC * nP ; float nR = nx ( nQ , nD , mX - 0.2 ) ; float nS = ni ( nQ , nD ) ; vec3 nT = nB ( nS , vec3 ( mY ) , u_scatter_strength ) * nR ; nM += nB ( sqrt ( nP ) , u_sky_color * nT , u_rayleigh_strength ) ; nN += nB ( nP , nT , u_mie_strength ) ; } nM = nM * nL * pow ( nJ , u_rayleigh_collection_power ) / float ( mZ ) ; nN = ( nN * nL * pow ( nJ , u_mie_collection_power ) ) / float ( mZ ) ; vec3 nU = vec3 ( nH * nN + nG * nN + nF * nM ) ; gA ( nU ) ; gl_FragColor = vec4 ( nU , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 mW ; void main ( ) { vec4 lz = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 lA = u_cube_view_matrix * lz ; mW = lA . xyz ; gl_Position = lz ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_sampler , a ) ; gA ( lz . rgb ) ; gD ( lz . rgb , lz . a ) ; gl_FragColor = lz ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { a = a_texcoord ; vec3 lz = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 lA = u_proj_matrix * u_view_matrix * vec4 ( lz , 0.0 ) ; lA . x /= lA . w ; lA . y /= lA . w ; lA += 99999.0 * step ( lA . z , 0.0 ) ; lA += 100.0 * ( step ( 1.0 , abs ( lA . x ) ) + step ( 1.0 , abs ( lA . y ) ) ) ; lA . x = - a_lf_dist * lA . x ; lA . y = - a_lf_dist * lA . y ; float lB = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 lC = vec2 ( a_lf_bb_vertex . x / lB , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float lD = 1.9 ; lC *= ( 1.0 + lD * length ( lA . xy ) ) ; } gl_Position = vec4 ( lA . xy + lC , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:["uniform","samplerCube","u_sky",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 mW ; void main ( ) { vec3 lz = textureCube ( u_sky , mW ) . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"gy ( lz . rgb ) ; float lA = u_camera_eye_frag . y - WATER_LEVEL ; lA = min ( - lA * 0.03 , 0.8 ) ; float lB = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; vec3 lC = normalize ( mW ) ; vec3 lD = vec3 ( 0.0 ) ; vec4 lE = u_underwater_fog_color_density ; lE . rgb = mix ( lE . rgb , lD , min ( - lC . y + lA , 1.0 ) ) * lB ; float lF = clamp ( sign ( lC . y - 0.05 * lA ) , 0.0 , 1.0 ) ; lz = mix ( lE . rgb , lz , lF ) ; gA ( lz . rgb ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( lz , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 mW ; void main ( ) { vec4 lz = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 lA = u_sky_vp_inverse * lz ; mW = lA . xyz ; gl_Position = lz ; }".split(" ")}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",
name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:"uniform float u_time ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",
b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float lz = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 kJ ; varying vec3 kK ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],
group:{type:"group",a:[{type:"textline",b:["varying","vec3","kL",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 kM ; varying vec3 mX ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mY",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mZ",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","kO",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","m_",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE",
"&&","SHORE_SMOOTHING"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 no ( in vec2 na , in vec3 nb , in vec3 nc , in vec3 nd , out float ne ) { vec3 nf = reflect ( - nc , nb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 ng = na . xy + nb . xz * REFL_BUMP / kO ; ne = u_reflect_factor ; vec3 nh ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG",
"&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"nh = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nh = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"float ni = dot ( nc , nb ) ; ne *= max ( 1.0 - 1.0 / ni , 1.0 ) ; } else { nh = texture2D ( u_reflectmap , ng ) . rgb ; gy ( nh ) ; }".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"ne = u_mirror_factor ; vec3 nh = nd * textureCube ( u_mirrormap , nf ) . rgb ; gy ( nh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ne = u_reflect_factor ; vec3 nh = nd * vec3 ( 0.3 , 0.5 , 1.0 ) ; gy ( nh ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nj = normalize ( nf + nc ) ; float nk = 1.0 - dot ( nc , nj ) ; float nl = u_fresnel_params [ 3 ] ; float nm = u_fresnel_params [ 2 ] ; float nn = nl + ( 1.0 - nl ) * pow ( nk , nm ) ; ne = min ( ne * nn , 1.0 ) ; return nh ; } void main ( ) {".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 np = mat3 ( kM , mX , kL ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nq = normalize ( kL ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 np = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nq = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","FOAM"],group:{type:"group",a:[{type:"textline",b:"float nr = kK . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec2 ns = vec2 ( mY . x , - mY . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec2 ns = vec2 ( kK . x , - kK . z ) + 0.5 ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","ns","=","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 nt = vec3 ( 0.0 ) ; vec3 nu = texture2D ( u_normalmap0 , ns * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nt += nu ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nv = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["nv","+=","nu",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"nu = texture2D ( u_normalmap0 , ns * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nt += nu ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",
a:[{type:"textline",b:["nv","+=","nu",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"nu = texture2D ( u_normalmap0 , ns * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nt += nu ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["nv","+=","nu",";"]}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"nu = texture2D ( u_normalmap0 , ns * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nt += nu ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["nv","+=","nu",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",
">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nw = np * nv ; if ( ! g ( nw , vec3 ( 0.0 ) ) ) nw = normalize ( nw ) ; vec3 nx = mix ( nq , nw , 0.2 ) ; nx = normalize ( nx ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"nq = mix ( nq , normalize ( np * nt ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nq = mix ( nq , normalize ( np * nt ) , 0.5 ) ;".split(" ")}]}}]},
{type:"textline",b:"nq = normalize ( nq ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 ny = normalize ( kJ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nz = cK . xy / cK . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float nA = kO * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],
group:{type:"group",a:[{type:"textline",b:"float nB = u_diffuse_color . a ; vec4 nC = texture2DProj ( u_scene_depth , cK ) ; float nD = cw ( nC ) ; float nE = max ( nD - kO , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nF = nz + nq . xz * u_refr_bump / kO ; float nG = lq ( nD , nF , nz ) ; float nH = max ( nG - kO , 0.0 ) ; float nI = u_view_max_depth / ABSORB * nH ; float nJ ; if ( u_cam_water_depth < 0.0 ) nJ = 0.0 ; else nJ = min ( nB * nI , 1.0 ) ; float nK = u_view_max_depth / ABSORB * nE ; nB = min ( 15.0 * nB * u_view_max_depth * nE , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float nK = u_view_max_depth / ABSORB * nE ; if ( u_cam_water_depth > 0.0 ) nB = min ( nB * nK , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"nB *= min ( 5.0 * nA , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nB = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float nJ = 1.0 - nB ; vec2 nF = nz + nq . xz * REFR_BUMP / kO ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 nL = texture2D ( u_refractmap , nF ) . rgb ; gy ( nL ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nM = pow ( min ( mZ . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 nN = mix ( u_shallow_water_col , u_diffuse_color . rgb , nM ) ; nM = pow ( min ( mZ . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; nN = mix ( u_shore_water_col , nN , nM ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nN = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nO = max ( 1.0 - u_view_max_depth * nE , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nO = 1.0 - nB ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:"float nP = max ( nr / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 nQ = normalize ( vec3 ( mZ . r , 0.0 , mZ . g ) ) ; vec3 nR = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , nQ , 0.8 ) ) ; float nS = 1.25 * max ( dot ( nx , nR ) - 0.2 , 0.0 ) ; nS += max ( dot ( nx , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; nO += nS * ( 1.0 - mZ . b ) ; nP *= ( 1.0 - 0.95 * pow ( mZ . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"nO += nP ; nO = min ( u_foam_factor * nO , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 nT = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + ns * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"float nU = u_specular_params [ 0 ] ; vec2 nV = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 nW = nU * u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 nX = u_environment_energy * textureCube ( u_sky_texture , nq ) . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nX = u_environment_energy * u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"vec3 nY = u_ambient * nX ; vec3 nZ = nY + u_sun_intensity ; float n_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 oa = no ( nz , nq , ny , nZ , n_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 oa = no ( vec2 ( 0.0 ) , nq , ny , nZ , n_ ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 ob = u_diffuse_intensity * nN ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hx oc = kc ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , ob , nW , kK , nq , ny , nV , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hx oc = kh ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , ob ) ;".split(" ")}]}}]},
{type:"textline",b:"ob = oc . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float od = max ( dot ( u_sun_direction , - kL ) + SSS_WIDTH , 0.0 ) * max ( dot ( - ny , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; od = clamp ( SSS_STRENGTH * od , 0.0 , 1.0 ) ; ob = mix ( ob , u_shallow_water_col , od ) ; ob = mix ( ob , u_shore_water_col , od ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:"ob = mix ( nL , ob , nJ ) ;".split(" ")}]}}]},{type:"textline",b:"ob = mix ( ob , oa , n_ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"float oe = mix ( nT . g , nT . r , max ( 4.0 * ( nO - 0.75 ) , 0.0 ) ) ; oe = mix ( nT . b , oe , max ( 2.0 * nO - 1.0 , 0.0 ) ) ; oe = mix ( 0.0 , oe , nO ) ; ob = mix ( ob , nZ , oe ) ;".split(" ")}]}}]},{type:"textline",b:"ob += oc . b ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 of = gS ( u_cube_fog , ny ) ; vec4 og = vec4 ( of , u_fog_color_density . a ) ; gy ( og . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","og","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { ht ( ob , nA , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { gL ( ob , nA , og ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( ob , nA , og ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["gA","(","ob",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"nB = max ( nB , oc . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["nB","+=","oe",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gD ( ob , nB ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 oh = fwidth ( m_ ) ; vec3 oi = smoothstep ( vec3 ( 0.0 ) , oh * lz , m_ ) ; float oj = min ( min ( oi . x , oi . y ) , oi . z ) ; oj = clamp ( oj , 0.0 , 1.0 ) ; ob = mix ( u_wireframe_edge_color , ob , oj ) ; nB = mix ( 1.0 , nB , oj ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( ob , nB ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",
b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 kJ ; varying vec3 kK ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","kL",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 kM ; varying vec3 mX ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mY",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mZ",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","kO",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","m_",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"vec3 lF ( in vec2 lz ) { vec2 lA = 0.5 + vec2 ( ( lz . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( lz . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; vec4 lB = texture2D ( u_shore_dist_map , lA ) ; const vec2 lC = vec2 ( 1.0 / 255.0 , 1.0 ) ; float lD = dot ( lB . ba , lC ) ; vec2 lE = normalize ( lB . rg * 2.0 - 1.0 ) ; return vec3 ( lE , lD ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},
{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void lW ( inout vec3 lG , in float lH , in vec3 lI ) { float lJ = dM ( DST_NOISE_SCALE_0 * ( lG . xz + DST_NOISE_FREQ_0 * lH ) ) * dM ( DST_NOISE_SCALE_1 * ( lG . zx - DST_NOISE_FREQ_1 * lH ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float lK = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float lL = lI . b ; float lM = sqrt ( lL ) ; float lN = max ( lL , DIR_MIN_SHR_FAC ) * sin ( lM / lK + DIR_FREQ * lH ) ; float lO = max ( dM ( DIR_NOISE_SCALE * ( lG . xz + DIR_NOISE_FREQ * lH ) ) , DIR_MIN_NOISE_FAC ) ; lN *= lO ; float lP = WAVES_HEIGHT * mix ( lN , lJ , max ( lM , DST_MIN_FAC ) ) ; vec2 lQ = lI . rg ; float lR = WAVES_HOR_FAC * lN * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - lL ) , 0.0 ) ; vec2 lS = lR * lQ ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float lP = WAVES_HEIGHT * lJ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"vec2 lT = 2.0 * ( lG . xz - 0.1 * lH ) ; vec2 lU = 1.3 * ( lG . zx + 0.03 * lH ) ; float lV = dg ( 0.5 * lT ) . x + dg ( 0.5 * lU ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lG . xz += lS ; lV *= lL ;".split(" ")}]}}]},{type:"textline",
b:"lP += SMALL_WAVES_FAC * lV ;".split(" ")}]}}]},{type:"textline",b:"lG . y += lP ; }".split(" ")}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) m_ = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) m_ = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) m_ = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["vec3","na","=","a_position",
";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float nb = abs ( na . y ) ; vec2 nc = u_camera_eye . xz - mod ( u_camera_eye . xz , nb ) ; na . y = WATER_LEVEL ; na . xz += nc ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},{type:"textline",b:"d nd = an ( na , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC",
"&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"mY = nd . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"mZ = lF ( nd . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float ne = length ( u_wind ) ; float nf = u_time ; nf *= ne ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["float",
"ng","=","nb",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","ng","=","0.1",";"]}]}}]},{type:"textline",b:"vec3 nh = nd . a + vec3 ( ng , 0.0 , 0.0 ) ; vec3 ni = nd . a + vec3 ( 0.0 , 0.0 , ng ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 nj = lF ( nh . xz ) ; vec3 nk = lF ( ni . xz ) ; lW ( nh , nf , nj ) ; lW ( ni , nf , nk ) ; lW ( nd . a , nf , mZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"lW ( nh , nf , vec3 ( 0.0 ) ) ; lW ( ni , nf , vec3 ( 0.0 ) ) ; lW ( nd . a , nf , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_position . y < 0.0 ) { nd . a . y = WATER_LEVEL - 1.0 ; nh . y = nd . a . y ; ni . y = nd . a . y ; }".split(" ")}]}}]},{type:"textline",b:"vec3 nl = normalize ( nh - nd . a ) ; vec3 nm = normalize ( ni - nd . a ) ; kL = normalize ( cross ( nm , nl ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"kM = nm ; mX = cross ( kL , kM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nn = dot ( kL , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float no = clamp ( 0.8 - nn , 0.0 , 1.0 ) ; kL = mix ( kL , vec3 ( 0.0 , 1.0 , 0.0 ) , no ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"kK = nd . a ; kJ = u_camera_eye - nd . a ; vec4 np = u_view_matrix * vec4 ( nd . a , 1.0 ) ; vec4 nq = u_proj_matrix * np ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float nr = nq . x ; float ns = nq . y ; float nt = nq . w ; cK . x = ( nr + nt ) / 2.0 ; cK . y = ( ns + nt ) / 2.0 ; cK . z = nt ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"kO = - np . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["gl_Position","=","nq",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 m_ ; const float lz = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 lA = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lA = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lB = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 lC = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 lD = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec3 lE = vec3 ( 0.0 ) ; float lF = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"vec3 lG = sign ( m_ - vec3 ( 0.02 * lz ) ) ; if ( lG . x < 0.0 || lG . y < 0.0 || lG . z < 0.0 ) { lE = lA ; lF = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lG = sign ( m_ - vec3 ( 0.02 * lz ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( lG . x < 0.0 || lG . y < 0.0 || lG . z < 0.0 ) lE = u_wireframe_edge_color ; else lE = lD ; lF = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( lG . x < 0.0 || lG . y < 0.0 || lG . z < 0.0 ) lF = 1.0 ; else lF = 0.0 ; lE = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( lG . x < 0.0 || lG . y < 0.0 || lG . z < 0.0 ) lE = u_wireframe_edge_color ; else if ( gl_FrontFacing ) lE = lB ; else lE = lC ; lF = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 lH = fwidth ( m_ ) ; vec3 lI = smoothstep ( vec3 ( 0.0 ) , lH * lz , m_ ) ; float lJ = min ( min ( lI . x , lI . y ) , lI . z ) ; lJ = clamp ( lJ , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { lE = vec3 ( mix ( u_wireframe_edge_color , lD , lJ ) ) ; lF = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { lE = u_wireframe_edge_color ; lF = mix ( 1.0 , 0.0 , lJ ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) lE = mix ( u_wireframe_edge_color , lB , lJ ) ; else lE = mix ( u_wireframe_edge_color , lC , lJ ) ; lF = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["gA","(","lE",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gD ( lE , lF ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lE , lF ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",b:["varying","vec3","m_",";"]},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { if ( a_polyindex == 0.0 ) m_ = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) m_ = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) m_ = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 lz = a_position ; vec3 lA = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"d lB = an ( lz , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"lz = mix ( lz , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 lC = vec3 ( 0.0 ) ; vec3 lD = vec3 ( 0.0 ) ; bt ( lz , lC , lD , lA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["vec3","lE","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lE = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d lB = gh ( lz , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lE , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lF = ( u_model_matrix * vec4 ( lE , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 lG = ag ( u_camera_eye , lF , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 lG = aa ( u_camera_eye , lF , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND",
"&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lH = ( u_model_matrix * vec4 ( lE , 1.0 ) ) . xyz ; lG = lG * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lH ) ;".split(" ")}]}}]},{type:"textline",b:"d lB = an ( lz - lE , lE , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lG ) ; lB . b = lF ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d lB = an ( lz , lE , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( lB . a , lB . b , lA ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 lI = u_view_matrix * vec4 ( lB . a , 1.0 ) ; gl_Position = u_proj_matrix * lI ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_sampler_left , a ) ; vec4 lA = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( lz [ 0 ] , lA [ 1 ] , lA [ 2 ] , lz [ 3 ] + lA [ 3 ] ) ; }".split(" ")}]};
a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 lC ( float lz , float lA ) { vec2 lB = a + vec2 ( lz , lA ) * u_texel_size ; return texture2D ( u_color , lB ) ; } float lG ( vec4 lD ) { vec3 lE = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lF = dot ( lD . rgb , lE ) ; return lF ; } vec4 nc ( ) { vec4 lH = lC ( - 1.0 , - 1.0 ) ; vec4 lI = lC ( 1.0 , - 1.0 ) ; vec4 lJ = lC ( - 1.0 , 1.0 ) ; vec4 lK = lC ( 1.0 , 1.0 ) ; vec4 lL = lC ( 0.0 , 0.0 ) ; float lM = lG ( lH ) ; float lN = lG ( lI ) ; float lO = lG ( lJ ) ; float lP = lG ( lK ) ; float lQ = lG ( lL ) ; float lR = min ( lQ , min ( min ( lM , lN ) , min ( lO , lP ) ) ) ; float lS = max ( lQ , max ( max ( lM , lN ) , max ( lO , lP ) ) ) ; vec2 lT ; lT . x = - ( ( lM + lN ) - ( lO + lP ) ) ; lT . y = ( ( lM + lO ) - ( lN + lP ) ) ; float lU = max ( ( lM + lN + lO + lP ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float lV = 1.0 / ( min ( abs ( lT . x ) , abs ( lT . y ) ) + lU ) ; lT = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , lT * lV ) ) * u_texel_size ; vec4 lW = 0.5 * ( texture2D ( u_color , a + lT * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + lT * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 na = lW * 0.5 + 0.25 * ( texture2D ( u_color , a + lT * - 0.5 ) + texture2D ( u_color , a + lT * 0.5 ) ) ; float nb = lG ( na ) ; if ( ( nb < lR ) || ( nb > lS ) ) return lW ; else return na ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 oO ( ) { vec2 nd ; nd . x = a . x ; nd . y = a . y ; vec4 ne = texture2D ( u_color , nd ) ; vec4 nf = lC ( 0.0 , 1.0 ) ; vec4 ng = lC ( 1.0 , 0.0 ) ; vec4 nh = lC ( 0.0 , - 1.0 ) ; vec4 ni = lC ( - 1.0 , 0.0 ) ; float nj = lG ( nf ) ; float nk = lG ( ng ) ; float nl = lG ( nh ) ; float nm = lG ( ni ) ; float nn = lG ( ne ) ; float no = max ( nj , nn ) ; float np = min ( nj , nn ) ; float nq = max ( nk , no ) ; float nr = min ( nk , np ) ; float ns = max ( nl , nm ) ; float nt = min ( nl , nm ) ; float nu = max ( ns , nq ) ; float nv = min ( nt , nr ) ; float nw = nu * FXAA_QUALITY_EDGE_THRESHOLD ; float nx = nu - nv ; float ny = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , nw ) ; bool nz = nx < ny ; if ( nz ) return ne ; vec4 nA = lC ( - 1.0 , - 1.0 ) ; vec4 nB = lC ( 1.0 , 1.0 ) ; vec4 nC = lC ( 1.0 , - 1.0 ) ; vec4 nD = lC ( - 1.0 , 1.0 ) ; float nE = lG ( nA ) ; float nF = lG ( nB ) ; float nG = lG ( nC ) ; float nH = lG ( nD ) ; float nI = nl + nj ; float nJ = nm + nk ; float nK = 1.0 / nx ; float nL = nI + nJ ; float nM = ( - 2.0 * nn ) + nI ; float nN = ( - 2.0 * nn ) + nJ ; float nO = nG + nF ; float nP = nE + nG ; float nQ = ( - 2.0 * nk ) + nO ; float nR = ( - 2.0 * nl ) + nP ; float nS = nE + nH ; float nT = nH + nF ; float nU = ( abs ( nM ) * 2.0 ) + abs ( nQ ) ; float nV = ( abs ( nN ) * 2.0 ) + abs ( nR ) ; float nW = ( - 2.0 * nm ) + nS ; float nX = ( - 2.0 * nj ) + nT ; float nY = abs ( nW ) + nU ; float nZ = abs ( nX ) + nV ; float n_ = nS + nO ; float oa = u_texel_size . x ; bool ob = nY >= nZ ; float oc = nL * 2.0 + n_ ; if ( ! ob ) nl = nm ; if ( ! ob ) nj = nk ; if ( ob ) oa = u_texel_size . y ; float od = ( oc * ( 1.0 / 12.0 ) ) - nn ; float oe = nl - nn ; float of = nj - nn ; float og = nl + nn ; float oh = nj + nn ; bool oi = abs ( oe ) >= abs ( of ) ; float oj = max ( abs ( oe ) , abs ( of ) ) ; if ( oi ) oa = - oa ; float ok = clamp ( abs ( od ) * nK , 0.0 , 1.0 ) ; vec2 ol ; ol . x = nd . x ; ol . y = nd . y ; vec2 om ; om . x = ( ! ob ) ? 0.0 : u_texel_size . x ; om . y = ( ob ) ? 0.0 : u_texel_size . y ; if ( ! ob ) ol . x += oa * 0.5 ; if ( ob ) ol . y += oa * 0.5 ; vec2 on ; on . x = ol . x - om . x ; on . y = ol . y - om . y ; vec2 oo ; oo . x = ol . x + om . x ; oo . y = ol . y + om . y ; float op = ( ( - 2.0 ) * ok ) + 3.0 ; float oq = lG ( texture2D ( u_color , on ) ) ; float or = ok * ok ; float os = lG ( texture2D ( u_color , oo ) ) ; if ( ! oi ) og = oh ; float ot = oj * 1.0 / 4.0 ; float ou = nn - og * 0.5 ; float ov = op * or ; bool ow = ou < 0.0 ; oq -= og * 0.5 ; os -= og * 0.5 ; bool ox = abs ( oq ) >= ot ; bool oy = abs ( os ) >= ot ; if ( ! ox ) on . x -= om . x * 1.5 ; if ( ! ox ) on . y -= om . y * 1.5 ; bool oz = ( ! ox ) || ( ! oy ) ; if ( ! oy ) oo . x += om . x * 1.5 ; if ( ! oy ) oo . y += om . y * 1.5 ; if ( oz ) { if ( ! ox ) oq = lG ( texture2D ( u_color , on . xy ) ) ; if ( ! oy ) os = lG ( texture2D ( u_color , oo . xy ) ) ; if ( ! ox ) oq = oq - og * 0.5 ; if ( ! oy ) os = os - og * 0.5 ; ox = abs ( oq ) >= ot ; oy = abs ( os ) >= ot ; if ( ! ox ) on . x -= om . x * 2.0 ; if ( ! ox ) on . y -= om . y * 2.0 ; oz = ( ! ox ) || ( ! oy ) ; if ( ! oy ) oo . x += om . x * 2.0 ; if ( ! oy ) oo . y += om . y * 2.0 ; if ( oz ) { if ( ! ox ) oq = lG ( texture2D ( u_color , on . xy ) ) ; if ( ! oy ) os = lG ( texture2D ( u_color , oo . xy ) ) ; if ( ! ox ) oq = oq - og * 0.5 ; if ( ! oy ) os = os - og * 0.5 ; ox = abs ( oq ) >= ot ; oy = abs ( os ) >= ot ; if ( ! ox ) on . x -= om . x * 2.0 ; if ( ! ox ) on . y -= om . y * 2.0 ; oz = ( ! ox ) || ( ! oy ) ; if ( ! oy ) oo . x += om . x * 2.0 ; if ( ! oy ) oo . y += om . y * 2.0 ; if ( oz ) { if ( ! ox ) oq = lG ( texture2D ( u_color , on . xy ) ) ; if ( ! oy ) os = lG ( texture2D ( u_color , oo . xy ) ) ; if ( ! ox ) oq = oq - og * 0.5 ; if ( ! oy ) os = os - og * 0.5 ; ox = abs ( oq ) >= ot ; oy = abs ( os ) >= ot ; if ( ! ox ) on . x -= om . x * 4.0 ; if ( ! ox ) on . y -= om . y * 4.0 ; oz = ( ! ox ) || ( ! oy ) ; if ( ! oy ) oo . x += om . x * 4.0 ; if ( ! oy ) oo . y += om . y * 4.0 ; if ( oz ) { if ( ! ox ) oq = lG ( texture2D ( u_color , on . xy ) ) ; if ( ! oy ) os = lG ( texture2D ( u_color , oo . xy ) ) ; if ( ! ox ) oq = oq - og * 0.5 ; if ( ! oy ) os = os - og * 0.5 ; ox = abs ( oq ) >= ot ; oy = abs ( os ) >= ot ; if ( ! ox ) on . x -= om . x * 2.0 ; if ( ! ox ) on . y -= om . y * 2.0 ; if ( ! oy ) oo . x += om . x * 2.0 ; if ( ! oy ) oo . y += om . y * 2.0 ; } } } } float oA = nd . x - on . x ; float oB = oo . x - nd . x ; if ( ! ob ) oA = nd . y - on . y ; if ( ! ob ) oB = oo . y - nd . y ; bool oC = ( oq < 0.0 ) != ow ; float oD = ( oB + oA ) ; bool oE = ( os < 0.0 ) != ow ; float oF = 1.0 / oD ; bool oG = oA < oB ; float oH = min ( oA , oB ) ; bool oI = oG ? oC : oE ; float oJ = ov * ov ; float oK = ( oH * ( - oF ) ) + 0.5 ; float oL = oJ * FXAA_QUALITY_SUBPIX ; float oM = oI ? oK : 0.0 ; float oN = max ( oM , oL ) ; if ( ! ob ) nd . x += oN * oa ; if ( ob ) nd . y += oN * oa ; return texture2D ( u_color , nd ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = nc ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = oO ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 lz = vec2 ( 0.0 , 0.0 ) ; vec2 lA = u_texel_size ; vec4 lB = texture2D ( u_color , a ) ; gl_FragColor = lB * 0.0875447373698 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0858112354248 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0808139781061 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0731235112908 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0635705267419 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0530985673112 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0426125984122 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0328565115809 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * lB , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_main , a ) ; vec4 lA = texture2D ( u_bloom , a ) ; vec4 lB = lz ; lB += lA ; gl_FragColor = vec4 ( lB . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_color , a ) ; vec3 lA = lz . rgb ; if ( u_brightness < 0.0 ) lA = lA * ( 1.0 + u_brightness ) ; else lA = lA + ( ( 1.0 - lA ) * u_brightness ) ; lA = ( lA - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; lA *= u_exposure ; vec3 lB = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lC = dot ( lA , lB ) ; lA = mix ( vec3 ( lC ) , lA , u_saturation ) ; gl_FragColor = vec4 ( lA , lz . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cs ( clamp ( nh ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { vec4 ni = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { float nj = nh ( u_depth , a , u_camera_range ) ; nj *= u_view_max_depth ; float nk ; if ( nj < u_dof_dist ) nk = ( u_dof_dist - nj ) / u_dof_front ; else nk = ( nj - u_dof_dist ) / u_dof_rear ; nk = clamp ( nk , 0.0 , 1.0 ) ; vec4 nl = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( ni , nl , nk ) ; } else gl_FragColor = ni ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float lE ( float lz , float lA , float lB ) { vec2 lC = a + vec2 ( lz , lA ) * u_texel_size ; vec4 lD = texture2D ( u_sampler , lC ) * lB ; return cw ( lD ) ; } void main ( ) { float lF = ( lE ( - 1.0 , - 1.0 , - 1.0 ) + lE ( 0.0 , - 1.0 , - 1.0 ) + lE ( 1.0 , - 1.0 , - 1.0 ) + lE ( - 1.0 , 0.0 , - 1.0 ) + lE ( 0.0 , 0.0 , 8.0 ) + lE ( 1.0 , 0.0 , - 1.0 ) + lE ( - 1.0 , 1.0 , - 1.0 ) + lE ( 0.0 , 1.0 , - 1.0 ) + lE ( 1.0 , 1.0 , - 1.0 ) ) ; lF *= 1000.0 ; gl_FragColor = vec4 ( lF , lF , lF , 1.0 ) ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_glow_src ; uniform sampler2D u_glow_mask ; uniform sampler2D u_glow_mask_blurred ; uniform vec3 u_glow_color ; uniform float u_draw_glow ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_glow_src , a ) ; gl_FragColor = lz ; if ( u_draw_glow != 0.0 ) { vec4 lA = texture2D ( u_glow_mask , a ) ; vec4 lB = texture2D ( u_glow_mask_blurred , a ) ; float lC = lB . a - lA . a ; if ( lC != 0.0 ) { float lD = smoothstep ( 0.0 , 1.0 , lB . a ) ; if ( lA . a == 0.0 ) { vec3 lE = u_glow_color ; gA ( lE ) ; vec4 lF = vec4 ( clamp ( lE , 0.0 , 1.0 ) , lD ) ; gl_FragColor = mix ( lz , lF , lD ) ; } } } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float ni ; varying vec2 nj ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 nk ; void main ( ) { vec2 nl = ( nk . xy - a ) ; float nm = length ( nl ) ; vec2 nn = u_radial_blur_step * nl / nm ; float no = nm / u_radial_blur_step ; nn *= min ( no , STEPS_PER_PASS ) / STEPS_PER_PASS ; no = max ( no , STEPS_PER_PASS ) ; vec2 np = a ; float nq = 0.0 ; for ( float nr = 0.0 ; nr < STEPS_PER_PASS ; nr += 1.0 ) { if ( nr <= no ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"float ns = nh ( u_input , np , u_camera_range ) ; nq += max ( ( 1.0 - pow ( nm , 0.3 ) ) * step ( 0.9 , ns ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 nt = texture2D ( u_input , np ) ; nq += cw ( nt ) ;".split(" ")}]}}]},{type:"textline",b:"} np += nn ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"vec2 nu = a + nj ; float nv = dg ( vec2 ( 2.5 * ( nu . x ) , 2.5 * ( nu . y ) + 1.0 * u_time ) ) . x + 0.75 * dg ( vec2 ( 5.0 * ( nu . x ) - 0.66 * u_time , 5.0 * ( nu . y ) + 0.66 * u_time ) ) . x + 0.5 * dM ( vec2 ( 7.5 * ( nu . x ) + 0.33 * u_time , 7.5 * ( nu . y ) - 0.33 * u_time ) ) ; nv *= clamp ( 1.2 - sqrt ( 0.2 * nm ) , 0.0 , 1.0 ) * ni ; nq = max ( nv , nq ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = cs ( nq / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform vec4 u_refl_plane ; varying float ni ; varying vec2 nj ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"varying vec2 a ; varying vec4 nk ; void lG ( in vec4 lz , in vec3 lA , out vec3 lB ) { float lC = lz . w * lA . x + lz . y * lA . z - lz . z * lA . y ; float lD = lz . w * lA . y + lz . z * lA . x - lz . x * lA . z ; float lE = lz . w * lA . z + lz . x * lA . y - lz . y * lA . x ; float lF = - lz . x * lA . x - lz . y * lA . y - lz . z * lA . z ; lB . x = lC * lz . w - lF * lz . x - lD * lz . z + lE * lz . y ; lB . y = lD * lz . w - lF * lz . y - lE * lz . x + lC * lz . z ; lB . z = lE * lz . w - lF * lz . z - lC * lz . y + lD * lz . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 lH = normalize ( u_sun_direction ) ; nk = u_proj_matrix * u_view_matrix * vec4 ( lH , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_camera_eye . y + a_bb_vertex . t < - u_refl_plane . w ) { ni = 1.0 ; vec3 lI = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 lJ ; lG ( u_camera_quat , lI , lJ ) ; lJ = normalize ( lJ ) ; float lK = dot ( lJ , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lL = atan ( lJ . x , lJ . z ) ; nj = vec2 ( - lL , acos ( lK ) ) ; } else { ni = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"nk . x /= nk . w ; nk . y /= nk . w ; nk . x = 0.5 * ( nk . x + 1.0 ) ; nk . y = 0.5 * ( nk . y + 1.0 ) ; nk += 99999.0 * step ( nk . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_main , a ) ; vec3 lA = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; gy ( lz . rgb ) ; float lB = cw ( texture2D ( u_god_rays , a ) ) ; vec3 lC = lz . rgb + u_god_rays_intensity * vec3 ( lB ) * lA ; gA ( lC ) ; gl_FragColor . rgb = lC ; gl_FragColor . a = lz . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_color , a ) * 0.38026 ; lz += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; lz += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; lz += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; lz += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; lz += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; lz += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; lz += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; lz += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = lz ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_input , a ) ; float lA = dot ( lz . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( lA ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float lz ; float lA = 0.0 ; for ( float lB = 0.025 ; lB < 1.0 ; lB += 0.05 ) for ( float lC = 0.025 ; lC < 1.0 ; lC += 0.05 ) { lz = max ( texture2D ( u_input , vec2 ( lB , lC ) ) . r , 0.01 ) ; lA += log ( lz ) ; } float lD = exp ( lA / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( lD ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float nl ; void main ( ) { float nm = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float nn = texture2D ( u_luminance , a ) . r ; vec4 no = texture2D ( u_main , a ) ; float np = nn / nm ; float nq = u_bloom_edge_lum ; gl_FragColor = no * max ( np - nq , 0.0 ) * nl ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float nl ; const vec3 lz = vec3 ( 0.0 , 1.0 , 0.0 ) ; void lH ( in vec4 lA , in vec3 lB , out vec3 lC ) { float lD = lA . w * lB . x + lA . y * lB . z - lA . z * lB . y ; float lE = lA . w * lB . y + lA . z * lB . x - lA . x * lB . z ; float lF = lA . w * lB . z + lA . x * lB . y - lA . y * lB . x ; float lG = - lA . x * lB . x - lA . y * lB . y - lA . z * lB . z ; lC . x = lD * lA . w - lG * lA . x - lE * lA . z + lF * lA . y ; lC . y = lE * lA . w - lG * lA . y - lF * lA . x + lD * lA . z ; lC . z = lF * lA . w - lG * lA . z - lD * lA . y + lE * lA . x ; } void main ( ) { a = 2.0 * a_position ; vec3 lI ; lH ( u_camera_quat , lz , lI ) ; nl = dot ( - lI , u_sun_direction ) * u_bloom_key ; nl *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_mb_tex_curr , a ) ; vec4 lA = texture2D ( u_mb_tex_accum , a ) ; if ( length ( lz - lA ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * lz + u_motion_blur_exp * lA ; } else { gl_FragColor = lz ; } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"vec4 lz = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( lz . r + lz . g + lz . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lA = vec2 ( 0.0 , 0.0 ) ; vec2 lB = u_texel_size ; vec4 lC ; lC = texture2D ( u_color , a ) ; gl_FragColor = lC * 0.2270270270 ; lA += lB ; lC = texture2D ( u_color , a + lA ) ; gl_FragColor += lC * 0.1945945946 ; lC = texture2D ( u_color , a - lA ) ; gl_FragColor += lC * 0.1945945946 ; lA += lB ; lC = texture2D ( u_color , a + lA ) ; gl_FragColor += lC * 0.1216216216 ; lC = texture2D ( u_color , a - lA ) ; gl_FragColor += lC * 0.1216216216 ; lA += lB ; lC = texture2D ( u_color , a + lA ) ; gl_FragColor += lC * 0.0540540541 ; lC = texture2D ( u_color , a - lA ) ; gl_FragColor += lC * 0.0540540541 ; lA += lB ; lC = texture2D ( u_color , a + lA ) ; gl_FragColor += lC * 0.0162162162 ; lC = texture2D ( u_color , a - lA ) ; gl_FragColor += lC * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 lB = u_texel_size ; vec4 lC = texture2D ( u_color , a ) ; gl_FragColor = lC ; if ( lC . a == 0.0 ) { lC = texture2D ( u_color , a + lB ) ; if ( lC . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , lC . a ) ; else { lC = texture2D ( u_color , a - lB ) ; if ( lC . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , lC . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; varying vec2 a ; void main ( ) { a = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","nm",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nn ; varying vec4 no ; varying vec4 np ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nq",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 nw ( vec2 nr , sampler2D ns ) { float nt = texture2D ( ns , nr ) . r ; float nu = texture2D ( ns , nn . xy ) . r ; float nv = texture2D ( ns , nn . zw ) . r ; return vec3 ( nt , nu , nv ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nC ( vec2 nx , sampler2D ny ) { vec3 nz = nw ( nx , ny ) ; vec2 nA = abs ( nz . xx - nz . yz ) ; vec2 nB = step ( SMAA_PREDICATION_THRESHOLD , nA ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * nB ) ; }".split(" ")}]}}]},{type:"textline",b:"void nG ( bvec2 nD , inout vec2 nE , vec2 nF ) { if ( nD . x ) nE . x = nF . x ; if ( nD . y ) nE . y = nF . y ; } void nG ( bvec4 nH , inout vec4 nI , vec4 nJ ) { nG ( nH . xy , nI . xy , nJ . xy ) ; nG ( nH . zw , nI . zw , nJ . zw ) ; } vec2 nL ( vec2 nK ) { return sign ( nK ) * floor ( abs ( nK ) + .5 ) ; } vec4 nL ( vec4 nM ) { return sign ( nM ) * floor ( abs ( nM ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 oc ( vec2 nN , sampler2D nO".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","nP"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 nQ = nC ( nN , nP ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 nQ = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nR = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float nS = dot ( texture2D ( nO , nN ) . rgb , nR ) ; float nT = dot ( texture2D ( nO , nn . xy ) . rgb , nR ) ; float nU = dot ( texture2D ( nO , nn . zw ) . rgb , nR ) ; vec4 nV ; nV . xy = abs ( nS - vec2 ( nT , nU ) ) ; vec2 nW = step ( nQ , nV . xy ) ; if ( dot ( nW , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float nX = dot ( texture2D ( nO , no . xy ) . rgb , nR ) ; float nY = dot ( texture2D ( nO , no . zw ) . rgb , nR ) ; nV . zw = abs ( nS - vec2 ( nX , nY ) ) ; vec2 nZ = max ( nV . xy , nV . zw ) ; float n_ = dot ( texture2D ( nO , np . xy ) . rgb , nR ) ; float oa = dot ( texture2D ( nO , np . zw ) . rgb , nR ) ; nV . zw = abs ( vec2 ( nT , nU ) - vec2 ( n_ , oa ) ) ; nZ = max ( nZ . xy , nV . zw ) ; float ob = max ( nZ . x , nZ . y ) ; nW . xy *= step ( ob , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * nV . xy ) ; return nW ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 oe ( vec2 od ) { od . r = od . r * abs ( 5.0 * od . r - 5.0 * 0.75 ) ; return nL ( od ) ; } vec4 oe ( vec4 of ) { of . rb = of . rb * abs ( 5.0 * of . rb - 5.0 * 0.75 ) ; return nL ( of ) ; } vec2 on ( sampler2D og , vec2 oh , vec2 oi , out vec2 oj ) { vec4 ok = vec4 ( oh , - 1.0 , 1.0 ) ; vec3 ol = vec3 ( u_texel_size , 1.0 ) ; for ( int om = 0 ; om < SMAA_MAX_SEARCH_STEPS_DIAG ; om ++ ) { if ( ok . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && ok . w > 0.9 ) { ok . xyz += ol * vec3 ( oi , 1.0 ) ; oj = texture2D ( og , ok . xy , 0.0 ) . rg ; ok . w = dot ( oj , vec2 ( 0.5 , 0.5 ) ) ; } } return ok . zw ; } vec2 ov ( sampler2D oo , vec2 op , vec2 oq , out vec2 or ) { vec4 os = vec4 ( op , - 1.0 , 1.0 ) ; os . x += 0.25 * u_texel_size . x ; vec3 ot = vec3 ( u_texel_size , 1.0 ) ; for ( int ou = 0 ; ou < SMAA_MAX_SEARCH_STEPS_DIAG ; ou ++ ) { if ( os . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && os . w > 0.9 ) { os . xyz = ot * vec3 ( oq , 1.0 ) + os . xyz ; or = texture2D ( oo , os . xy , 0.0 ) . rg ; or = oe ( or ) ; os . w = dot ( or , vec2 ( 0.5 , 0.5 ) ) ; } } return os . zw ; } vec2 oB ( sampler2D ow , vec2 ox , vec2 oy , float oz ) { vec2 oA = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * oy + ox ; oA = SMAA_AREATEX_PIXEL_SIZE * oA + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; oA . x += 0.5 ; oA . y += SMAA_AREATEX_SUBTEX_SIZE * oz ; return texture2D ( ow , oA , 0.0 ) . rg ; } vec2 oQ ( sampler2D oC , sampler2D oD , vec2 oE , vec2 oF , vec4 oG ) { vec2 oH = vec2 ( 0.0 , 0.0 ) ; vec4 oI ; vec2 oJ ; if ( oF . r > 0.0 ) { oI . xz = on ( oC , oE , vec2 ( - 1.0 , 1.0 ) , oJ ) ; oI . x += float ( oJ . y > 0.9 ) ; } else oI . xz = vec2 ( 0.0 , 0.0 ) ; oI . yw = on ( oC , oE , vec2 ( 1.0 , - 1.0 ) , oJ ) ; if ( oI . x + oI . y > 2.0 ) { vec4 oK = vec4 ( - oI . x + 0.25 , oI . x , oI . y , - oI . y - 0.25 ) * u_texel_size . xyxy + oE . xyxy ; vec4 oL ; oL . xy = texture2D ( oC , oK . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; oL . zw = texture2D ( oC , oK . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; oL . yxwz = oe ( oL . xyzw ) ; vec2 oM = vec2 ( 2.0 , 2.0 ) * oL . xz + oL . yw ; nG ( bvec2 ( step ( 0.9 , oI . zw ) ) , oM , vec2 ( 0.0 , 0.0 ) ) ; oH += oB ( oD , oI . xy , oM , oG . z ) ; } oI . xz = ov ( oC , oE , vec2 ( - 1 , - 1 ) , oJ ) ; if ( texture2D ( oC , oE + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { oI . yw = ov ( oC , oE , vec2 ( 1 , 1 ) , oJ ) ; oI . y += float ( oJ . y > 0.9 ) ; } else oI . yw = vec2 ( 0.0 , 0.0 ) ; if ( oI . x + oI . y > 2.0 ) { vec4 oN = vec4 ( - oI . x , - oI . x , oI . y , oI . y ) * u_texel_size . xyxy + oE . xyxy ; vec4 oO ; oO . x = texture2D ( oC , oN . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; oO . y = texture2D ( oC , oN . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; oO . zw = texture2D ( oC , oN . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 oP = vec2 ( 2.0 , 2.0 ) * oO . xz + oO . yw ; nG ( bvec2 ( step ( 0.9 , oI . zw ) ) , oP , vec2 ( 0 , 0 ) ) ; oH += oB ( oD , oI . xy , oP , oG . w ) . gr ; } return oH ; }".split(" ")}]}}]},
{type:"textline",b:"float oW ( sampler2D oR , vec2 oS , float oT ) { vec2 oU = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 oV = SMAA_SEARCHTEX_SIZE * vec2 ( oT , 1.0 ) ; oU += vec2 ( - 1.0 , 1.0 ) ; oV += vec2 ( 0.5 , - 0.5 ) ; oU *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; oV *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( oR , oU * oS + oV , 0.0 ) . r ; } float pd ( sampler2D oX , sampler2D oY , vec2 oZ , float o_ ) { vec2 pa = vec2 ( 0.0 , 1.0 ) ; for ( int pb = 0 ; pb < SMAA_MAX_SEARCH_STEPS ; pb ++ ) { if ( oZ . x > o_ && pa . g > 0.8281 && pa . r == 0.0 ) { pa = texture2D ( oX , oZ , 0.0 ) . rg ; oZ = - vec2 ( 2.0 , 0.0 ) * u_texel_size + oZ ; } } float pc = - ( 255.0 / 127.0 ) * oW ( oY , pa , 0.0 ) + 3.25 ; return u_texel_size . x * pc + oZ . x ; } float pl ( sampler2D pe , sampler2D pf , vec2 pg , float ph ) { vec2 pi = vec2 ( 0.0 , 1.0 ) ; for ( int pj = 0 ; pj < SMAA_MAX_SEARCH_STEPS ; pj ++ ) { if ( pg . x < ph && pi . g > 0.8281 && pi . r == 0.0 ) { pi = texture2D ( pe , pg , 0.0 ) . rg ; pg = vec2 ( 2.0 , 0.0 ) * u_texel_size + pg ; } } float pk = - ( 255.0 / 127.0 ) * oW ( pf , pi , 0.5 ) + 3.25 ; return - u_texel_size . x * pk + pg . x ; } float pt ( sampler2D pm , sampler2D pn , vec2 po , float pp ) { vec2 pq = vec2 ( 1.0 , 0.0 ) ; for ( int pr = 0 ; pr < SMAA_MAX_SEARCH_STEPS ; pr ++ ) { if ( po . y > pp && pq . r > 0.8281 && pq . g == 0.0 ) { pq = texture2D ( pm , po , 0.0 ) . rg ; po = - vec2 ( 0.0 , 2.0 ) * u_texel_size + po ; } } float ps = - ( 255.0 / 127.0 ) * oW ( pn , pq . gr , 0.0 ) + 3.25 ; return u_texel_size . y * ps + po . y ; } float pB ( sampler2D pu , sampler2D pv , vec2 pw , float px ) { vec2 py = vec2 ( 1.0 , 0.0 ) ; for ( int pz = 0 ; pz < SMAA_MAX_SEARCH_STEPS ; pz ++ ) { if ( pw . y < px && py . r > 0.8281 && py . g == 0.0 ) { py = texture2D ( pu , pw , 0.0 ) . rg ; pw = vec2 ( 0.0 , 2.0 ) * u_texel_size + pw ; } } float pA = - ( 255.0 / 127.0 ) * oW ( pv , py . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * pA + pw . y ; } vec2 pI ( sampler2D pC , vec2 pD , float pE , float pF , float pG ) { vec2 pH = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * nL ( 4.0 * vec2 ( pE , pF ) ) + pD ; pH = SMAA_AREATEX_PIXEL_SIZE * pH + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; pH . y = SMAA_AREATEX_SUBTEX_SIZE * pG + pH . y ; return texture2D ( pC , pH , 0.0 ) . rg ; } void pQ ( sampler2D pJ , inout vec2 pK , vec4 pL , vec2 pM ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pN = step ( pM . xy , pM . yx ) ; vec2 pO = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pN ; pO /= pN . x + pN . y ; vec2 pP = vec2 ( 1.0 , 1.0 ) ; pP . x -= pO . x * texture2D ( pJ , pL . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; pP . x -= pO . y * texture2D ( pJ , pL . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; pP . y -= pO . x * texture2D ( pJ , pL . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; pP . y -= pO . y * texture2D ( pJ , pL . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; pK *= clamp ( pP , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void pY ( sampler2D pR , inout vec2 pS , vec4 pT , vec2 pU ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pV = step ( pU . xy , pU . yx ) ; vec2 pW = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pV ; pW /= pV . x + pV . y ; vec2 pX = vec2 ( 1.0 , 1.0 ) ; pX . x -= pW . x * texture2D ( pR , pT . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; pX . x -= pW . y * texture2D ( pR , pT . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; pX . y -= pW . x * texture2D ( pR , pT . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; pX . y -= pW . y * texture2D ( pR , pT . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; pS *= clamp ( pX , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qq ( vec2 pZ , vec2 p_ , sampler2D qa , sampler2D qb , sampler2D qc , vec4 qd ) { vec4 qe = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 qf = texture2D ( qa , pZ ) . rg ; if ( qf . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"qe . rg = oQ ( qa , qb , pZ , qf , qd ) ; if ( qe . r == - qe . g ) {".split(" ")}]}}]},
{type:"textline",b:"vec2 qg ; vec3 qh ; qh . x = pd ( qa , qc , nn . xy , np . x ) ; qh . y = no . y ; qg . x = qh . x ; float qi = texture2D ( qa , qh . xy , 0.0 ) . r ; qh . z = pl ( qa , qc , nn . zw , np . y ) ; qg . y = qh . z ; qg = abs ( nL ( qg / u_texel_size . xx - p_ . xx ) ) ; vec2 qj = sqrt ( qg ) ; float qk = texture2D ( qa , qh . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; qe . rg = pI ( qb , qj , qi , qk , qd . y ) ; qh . y = pZ . y ; pQ ( qa , qe . rg , qh . xyzy , qg ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else qf . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( qf . r > 0.0 ) { vec2 ql ; vec3 qm ; qm . y = pt ( qa , qc , no . xy , np . z ) ; qm . x = nn . x ; ql . x = qm . y ; float qn = texture2D ( qa , qm . xy , 0.0 ) . g ; qm . z = pB ( qa , qc , no . zw , np . w ) ; ql . y = qm . z ; ql = abs ( nL ( ql / u_texel_size . yy - p_ . yy ) ) ; vec2 qo = sqrt ( ql ) ; float qp = texture2D ( qa , qm . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; qe . ba = pI ( qb , qo , qn , qp , qd . x ) ; qm . x = pZ . x ; pY ( qa , qe . ba , qm . xyxz , ql ) ; } return qe ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qH ( vec2 qr , sampler2D qs , sampler2D qt".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qu"]}]}}]},{type:"textline",b:") { vec4 qv ; qv . x = texture2D ( qt , nm . xy ) . a ; qv . y = texture2D ( qt , nm . zw ) . g ; qv . wz = texture2D ( qt , qr ) . xz ; if ( dot ( qv , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 qw = texture2D ( qs , qr , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qx = texture2D ( qu , a ) ; vec2 qy = 2.0 * cE ( qx ) - 1.0 ; qw . a = sqrt ( 2.0 * length ( qy ) ) ;".split(" ")}]}}]},{type:"textline",b:"return qw ; } else { bool qz = max ( qv . x , qv . z ) > max ( qv . y , qv . w ) ; vec4 qA = vec4 ( 0.0 , qv . y , 0.0 , qv . w ) ; vec2 qB = qv . yw ; nG ( bvec4 ( qz , qz , qz , qz ) , qA , vec4 ( qv . x , 0.0 , qv . z , 0.0 ) ) ; nG ( bvec2 ( qz , qz ) , qB , qv . xz ) ; qB /= dot ( qB , vec2 ( 1.0 , 1.0 ) ) ; vec4 qC = qA * vec4 ( u_texel_size , - u_texel_size ) + qr . xyxy ; vec4 qD = qB . x * texture2D ( qs , qC . xy , 0.0 ) ; qD += qB . y * texture2D ( qs , qC . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qE = texture2D ( qu , qC . xy ) ; vec2 qF = 2.0 * cE ( qE ) - 1.0 ; vec2 qG = qB . x * qF ; qE = texture2D ( qu , qC . zw ) ; qF = 2.0 * cE ( qE ) - 1.0 ; qG += qB . y * qF ; qD . a = sqrt ( 2.0 * length ( qG ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","qD",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qT ( vec2 qI , sampler2D qJ , sampler2D qK".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qL"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qM = texture2D ( qL , a ) ; vec2 qN ; qN = 2.0 * cE ( qM ) - 1.0 ; vec4 qO = texture2D ( qJ , qI ) ; vec4 qP = texture2D ( qK , qI - qN ) ; float qQ = abs ( qO . a * qO . a - qP . a * qP . a ) / 2.0 ; float qR = 0.5 * clamp ( 1.0 - sqrt ( qQ ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 qS = mix ( qO , qP , qR ) ; qS . a = 1.0 ; return qS ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qO = texture2D ( qJ , qI ) ; vec4 qP = texture2D ( qK , qI ) ; return mix ( qO , qP , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qU = vec4 ( oc ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qU = qq ( a , nq , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qU = qH ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qU = vec4 ( qT ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qU = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","qU",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","nm",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nn ; varying vec4 no ; varying vec4 np ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nq",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void lA ( vec2 lz ) { nn = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + lz . xyxy ; no = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + lz . xyxy ; np = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + lz . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void lD ( vec2 lB , out vec2 lC ) { lC = lB / u_texel_size ; nn = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + lB . xyxy ; no = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + lB . xyxy ; np = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( nn . xz , no . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void lF ( vec2 lE ) { nm = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + lE . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = 2.0 * a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["lA","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"lD ( a , nq ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["lF","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},
{type:"define",name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float ns ( in vec2 nr ) { return nh ( u_depth , nr , u_camera_range ) ; } void main ( ) { float nt = texture2D ( u_color , a ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( nt , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"vec3 nu = normalize ( 2.0 * texture2D ( u_ssao_special_tex , a * 0.25 / u_texel_size ) . rgb - 1.0 ) ; float nv = ns ( a ) ; float nw = nv * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_8"],group:{type:"group",a:[{type:"textline",b:"const float nx = 8.0 ; const int ny = 1 ;".split(" ")}]}},
{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"const float nx = 16.0 ; const int ny = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_24"],group:{type:"group",a:[{type:"textline",b:"const float nx = 24.0 ; const int ny = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"const float nx = 32.0 ; const int ny = 4 ;".split(" ")}]}}]},{type:"textline",b:"float nz = u_ssao_radius_increase * 0.001 ; const float nA = 1.0 + 2.4 / nx ; float nB = 0.0 ; for ( int nC = 0 ; nC < ny ; nC ++ ) for ( int nD = - 1 ; nD <= 1 ; nD += 2 ) for ( int nE = - 1 ; nE <= 1 ; nE += 2 ) for ( int nF = - 1 ; nF <= 1 ; nF += 2 ) { vec3 nG = reflect ( normalize ( vec3 ( nD , nE , nF ) ) , nu ) * ( nz *= nA ) ; vec3 nH = vec3 ( a , nw ) ; nH += vec3 ( nG . xy , nG . z * nw * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nH . z -= 1.4 * ( nH . z - nw ) * step ( nw , nH . z ) ;".split(" ")}]}}]},{type:"textline",b:"float nI = ns ( nH . xy ) * ( u_camera_range . y - u_camera_range . x ) ; float nJ = clamp ( ( nw - nI ) / nI , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nB += mix ( 1.0 , nJ , step ( nI , nH . z ) ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"nB += mix ( step ( nH . z , nI ) , 0.5 , nJ ) ;".split(" ")}]}}]},{type:"textline",b:"} nB = nB / nx ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nB = clamp ( nB * nB + 0.6 * nB , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nB = clamp ( nB * nB + nB , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"float nK = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * nv ) ; nB = mix ( 1.0 , nB , nK ) ; gl_FragColor = vec4 ( nt , nB , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float ns ( in vec2 nr ) { return nh ( u_depth , nr , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float nt = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nu = ns ( a ) ; float nv = 0.0 ; float nw = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"vec2 nx = vec2 ( - 2.0 ) ; for ( int ny = 0 ; ny < 4 ; ++ ny ) { for ( int nz = 0 ; nz < 4 ; ++ nz ) { vec2 nA = ( nx + vec2 ( float ( ny ) , float ( nz ) ) ) * u_texel_size ; float nB = texture2D ( u_ssao_mask , a + nA ) . g ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nC = ns ( a + nA ) ; float nD = 1.0 - clamp ( abs ( nC - nu ) * nw , 0.0 , 1.0 ) ; nt += nB * nD ; nv += nD ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nt","+=","nB",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nt / nv , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nt / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { float lz = texture2D ( u_depth , a ) . x ; vec4 lA = vec4 ( a * 2.0 - 1.0 , 2.0 * lz - 1.0 , 1.0 ) ; vec4 lB = u_view_proj_inverse * lA ; vec4 lC = lB / lB . w ; vec4 lD = u_view_proj_prev * lC ; lD /= lD . w ; vec2 lE = ( lA . xy - lD . xy ) / 4.0 + 0.5 ; lE = clamp ( lE , 0.0 , 1.0 ) ; gl_FragColor = cs ( lE ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; float c = 1.0 ; struct d { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool g ( vec3 e , vec3 f ) { return any ( lessThan ( abs ( e - f ) , vec3 ( EPSILON ) ) ) ; } vec3 j ( in vec4 h , in vec3 i ) { return i + 2.0 * cross ( h . xyz , cross ( h . xyz , i ) + h . w * i ) ; } mat4 k ( ) { return mat4 ( c , b , b , b , b , c , b , b , b , b , c , b , b , b , b , c ) ; } mat4 m ( float l ) { return mat4 ( c , b , b , b , b , cos ( l ) , sin ( l ) , b , b , - sin ( l ) , cos ( l ) , b , b , b , b , c ) ; } mat4 o ( float n ) { return mat4 ( cos ( n ) , b , - sin ( n ) , b , b , c , b , b , sin ( n ) , b , cos ( n ) , b , b , b , b , c ) ; } mat4 q ( float p ) { return mat4 ( cos ( p ) , sin ( p ) , b , b , - sin ( p ) , cos ( p ) , b , b , b , b , c , b , b , b , b , c ) ; } d s ( in d r ) { return d ( r . a , r . b , normalize ( r . c ) , normalize ( r . d ) , normalize ( r . e ) , r . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 t = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 z ( vec3 u , mat4 v ) { vec3 w = vec3 ( v [ 0 ] [ 0 ] , v [ 1 ] [ 0 ] , v [ 2 ] [ 0 ] ) ; vec3 x = vec3 ( v [ 0 ] [ 1 ] , v [ 1 ] [ 1 ] , v [ 2 ] [ 1 ] ) ; vec3 y = vec3 ( v [ 0 ] [ 2 ] , v [ 1 ] [ 2 ] , v [ 2 ] [ 2 ] ) ; x = cross ( y , w ) ; return mat4 ( vec4 ( w , 0.0 ) , vec4 ( x , 0.0 ) , vec4 ( y , 0.0 ) , vec4 ( u , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 F ( vec3 A , vec3 B ) { vec3 C = A - B ; C . y = 0.0 ; C = normalize ( C ) ; vec3 D = normalize ( cross ( t , C ) ) ; vec3 E = normalize ( cross ( C , D ) ) ; return mat4 ( vec4 ( D , 0.0 ) , vec4 ( E , 0.0 ) , vec4 ( C , 0.0 ) , vec4 ( B , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 Q ( in vec3 G , float H , float I , float J , vec3 L ) { float M = fract ( length ( L ) / 0.17 ) ; float N = J + M / 10.0 ; float O = M ; if ( J != 0.0 ) O /= J ; G *= 1.0 + 0.5 * sin ( H ) ; float P = length ( G ) * I * sin ( 2.0 * 3.14 * H * N + O ) ; return q ( P ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 aa ( in vec3 R , in vec3 S , in mat4 T ) {".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 U = z ( S , T ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"float V = fract ( ( S . x * 1.43 + S . y * 0.123 + S . z * 6.1 ) ) ; float W = 2.0 * M_PI * V ; vec3 X = normalize ( vec3 ( T [ 0 ] [ 2 ] , 0.0 , T [ 2 ] [ 2 ] ) ) ; float Y = acos ( X [ 2 ] ) ; if ( X [ 0 ] < 0.0 ) Y = 2.0 * M_PI - Y ; float Z = Y - W ; if ( Z < 0.0 ) Z = 2.0 * M_PI + Z ; float _ = W ; if ( Z <= MAX_BILLBOARD_ANGLE ) _ += Z ; else if ( Z <= M_PI - MAX_BILLBOARD_ANGLE ) _ += MAX_BILLBOARD_ANGLE * ( 2.0 * Z - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( Z <= M_PI + MAX_BILLBOARD_ANGLE ) _ += Z - M_PI ; else if ( Z <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) _ += MAX_BILLBOARD_ANGLE * ( 2.0 * Z - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else _ += Z - 2.0 * M_PI ; mat4 U = o ( _ ) ; U [ 3 ] = vec4 ( S , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 U = F ( R , S ) ;".split(" ")}]}}]},{type:"textline",b:["return","U",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 ag ( in vec3 ab , in vec3 ac , in mat4 ad , mat4 ae ) { mat4 af = aa ( ab , ac , ad ) ; ae [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; af = af * ae ; return af ; }".split(" ")}]}}]},{type:"textline",b:"d an ( in vec3 ah , in vec3 ai , in vec3 aj , in vec3 ak , in vec3 al , in mat4 am ) { ah = ( am * vec4 ( ah , 1.0 ) ) . xyz ; ai = ( am * vec4 ( ai , 1.0 ) ) . xyz ; aj = ( am * vec4 ( aj , 0.0 ) ) . xyz ; ak = ( am * vec4 ( ak , 0.0 ) ) . xyz ; al = ( am * vec4 ( al , 0.0 ) ) . xyz ; return s ( d ( ah , ai , aj , ak , al , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};
a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 aq ( vec2 ao , vec3 ap ) { return ( ao + 0.5 ) * ap . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 az ( in vec4 ar , in vec4 as , in float at ) { float au = ar [ 0 ] * as [ 0 ] + ar [ 1 ] * as [ 1 ] + ar [ 2 ] * as [ 2 ] + ar [ 3 ] * as [ 3 ] ; if ( au < 0.0 ) { as *= - 1.0 ; au = - au ; } if ( abs ( au ) >= 1.0 ) return ar ; float av = acos ( au ) ; float aw = sqrt ( 1.0 - au * au ) ; if ( abs ( aw ) < 0.001 ) return vec4 ( ar * 0.5 + as * 0.5 ) ; float ax = sin ( ( 1.0 - at ) * av ) / aw ; float ay = sin ( at * av ) / aw ; return ar * ax + as * ay ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aO ( in vec3 aA , in vec4 aB , in vec4 aC , in vec4 aD , in vec4 aE , in float aF ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aG = az ( aB , aC , aF ) ; vec4 aH = mix ( aD , aE , aF ) ; vec3 aI = j ( aG , aA ) ; vec3 aJ = aI * aH . w + aH . xyz ; return aJ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aK = j ( aB , aA ) ; vec3 aL = j ( aC , aA ) ; vec3 aM = aK * aD . w + aD . xyz ; vec3 aN = aL * aE . w + aE . xyz ; return mix ( aM , aN , aF ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aX ( in vec3 aP , in vec4 aQ , in vec4 aR , in float aS ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aT = az ( aQ , aR , aS ) ; vec3 aU = j ( aT , aP ) ; return aU ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aV = j ( aQ , aP ) ; vec3 aW = j ( aR , aP ) ; return mix ( aV , aW , aS ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 aO ( in vec3 aY , in vec4 aZ , in vec4 a_ ) { vec3 ba = j ( aZ , aY ) ; vec3 bb = ba * a_ . w + a_ . xyz ; return bb ; } vec3 aX ( in vec3 bc , in vec4 bd ) { vec3 be = j ( bd , bc ) ; return be ; }".split(" ")}]}}]},{type:"textline",b:"void bt ( inout vec3 bf , inout vec3 bg , inout vec3 bh , inout vec3 bi ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["float","bj","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { vec3 bk = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bl = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bm = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bn = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec4 bo = a_influence ; for ( int bp = 0 ; bp < 4 ; bp ++ ) { int bq = int ( bo [ bp ] ) ; float br = fract ( bo [ bp ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bk += br * aO ( bf , u_quatsb [ bq ] , u_quatsa [ bq ] , u_transb [ bq ] , u_transa [ bq ] , bj ) ; bl += br * aX ( bg , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ; bm += br * aX ( bh , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ; bn += br * aX ( bi , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bk += br * aO ( bf , u_quatsb [ bq ] , u_transb [ bq ] ) ; bl += br * aX ( bg , u_quatsb [ bq ] ) ; bm += br * aX ( bh , u_quatsb [ bq ] ) ; bn += br * aX ( bi , u_quatsb [ bq ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} bf = bk ; bg = bl ; bh = bm ; bi = bn ; } if ( ! ( a_influence . y > 0.0 ) ) { int bs = int ( a_influence [ 0 ] - 1.0 ) ; if ( bs > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bf = aO ( bf , u_quatsb [ bs ] , u_quatsa [ bs ] , u_transb [ bs ] , u_transa [ bs ] , bj ) ; bg = aX ( bg , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ; bh = aX ( bh , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ; bi = aX ( bi , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bf = aO ( bf , u_quatsb [ bs ] , u_transb [ bs ] ) ; bg = aX ( bg , u_quatsb [ bs ] ) ; bh = aX ( bh , u_quatsb [ bs ] ) ; bi = aX ( bi , u_quatsb [ bs ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bH ( inout vec3 bu , in vec3 bv , in float bw , in float bx , in float by , in vec3 bz , in float bA ) { float bB = length ( bv ) ; float bC = bx * ( 1.0 + 0.1 * fract ( bB ) ) ; float bD = bw * bA * ( 1.0 + sin ( 2.0 * 3.14 * by * bC + bB ) ) ; float bE = ( bu . y - bv . y ) * abs ( bD ) ; bE += 1.0 ; bE *= bE ; bE = bE * bE - bE ; vec3 bF = bu ; bF . xz += bz . xz * bE * sign ( bD ) ; float bG = length ( bu - bv ) ; bu = bv + normalize ( bF - bv ) * bG ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bJ ( vec4 bI ) { return bI * bI * ( 3.0 - 2.0 * bI ) ; } vec4 bL ( vec4 bK ) { return abs ( fract ( bK + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bN ( vec4 bM ) { return bJ ( bL ( bM ) ) ; } void cd ( inout vec3 bO , in float bP , in vec3 bQ , in vec3 bR , in vec3 bS , in float bT , in float bU , in float bV , in vec3 bW ) { float bX ; float bY ; float bZ ; vec2 b_ ; vec4 ca ; vec2 cb ; vec3 cc ; bX = dot ( bS , vec3 ( 1.0 ) ) ; bY = bX + bW . g ; bZ = dot ( bO , vec3 ( bW . g ) ) ; b_ = ( bP + vec2 ( bZ , bY ) ) ; ca = ( ( fract ( ( b_ . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bR ) * bT ; ca = bN ( ca ) ; cb = ca . xz + ca . yw ; cb . y = 0.5 - cb . y ; cc = cb . xyx * bW . rbr * vec3 ( bU * bQ . x , bV , bU * bQ . z ) ; bO += cc ; }".split(" ")}]}}]},
{type:"textline",b:"void ck ( inout vec3 ce , inout vec3 cf , in vec3 cg ) { vec3 ch = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vec3 ci = cf ; vec3 cj = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ci = ce ; vec3 cj = cf ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"cd ( ci , u_time , cg , ch , cj , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bH ( ci , cj , au_wind_bending_amp , au_wind_bending_freq , u_time , ch , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bH ( ci , cj , au_wind_bending_amp , au_wind_bending_freq , u_time , ch , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"ce += ci - cf ; cf = ci ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ce = ci ; cf = cj ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",
b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",
b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float cl = 255.0 ; float cm = 0.0 ; float cn = 1.0 ; vec4 cs ( const in float co ) { vec4 cp = vec4 ( cl * cl * cl , cl * cl , cl , cn ) ; vec4 cq = vec4 ( cm , cn / cl , cn / cl , cn / cl ) ; vec4 cr = fract ( co * cp ) ; cr -= cr . xxyz * cq ; return cr ; } float cw ( const in vec4 ct ) { float cu ; vec4 cv = vec4 ( cn / ( cl * cl * cl ) , cn / ( cl * cl ) , cn / cl , cn ) ; cu = dot ( ct , cv ) ; return cu ; } vec4 cs ( const in vec2 cx ) { vec2 cy = vec2 ( cl , cn ) ; vec2 cz = vec2 ( cm , cn / cl ) ; vec4 cA = fract ( cx . xxyy * cy . xyxy ) ; cA -= cA . xxzz * cz . xyxy ; if ( cx . r == cn ) cA . rg = vec2 ( cm , cn ) ; if ( cx . g == cn ) cA . ba = vec2 ( cm , cn ) ; return cA ; } vec2 cE ( const in vec4 cB ) { vec2 cC ; vec2 cD = vec2 ( cn / cl , cn ) ; cC . r = dot ( cB . rg , cD ) ; cC . g = dot ( cB . ba , cD ) ; return cC ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float cM = 0.0 ; float cN = 1.0 ; vec4 cP ( vec4 cO ) { return cO - floor ( cO * ( cN / 289.0 ) ) * 289.0 ; } vec3 cP ( vec3 cQ ) { return cQ - floor ( cQ * ( cN / 289.0 ) ) * 289.0 ; } vec2 cP ( vec2 cR ) { return cR - floor ( cR * ( cN / 289.0 ) ) * 289.0 ; } vec4 cT ( vec4 cS ) { return cS - floor ( cS * ( cN / 7.0 ) ) * 7.0 ; } vec4 cV ( vec4 cU ) { return cP ( ( 34.0 * cU + 5.0 ) * cU ) ; }".split(" ")},{type:"define",name:"K",
b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 dg ( vec2 cW ) { vec2 cX = cP ( floor ( cW ) ) ; vec2 cY = fract ( cW ) ; vec4 cZ = cY . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 c_ = cY . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 da = cV ( cX . x + vec4 ( cM , cN , cM , cN ) ) ; da = cV ( da + cX . y + vec4 ( cM , cM , cN , cN ) ) ; vec4 db = cT ( da ) * K + K2 ; vec4 dc = cT ( floor ( da * K ) ) * K + K2 ; vec4 dd = cZ + JITTER * db ; vec4 de = c_ + JITTER * dc ; vec4 df = dd * dd + de * de ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"df . xy = min ( df . xy , df . zw ) ; df . x = min ( df . x , df . y ) ; return df . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"df . xy = ( df . x < df . y ) ? df . xy : df . yx ; df . xz = ( df . x < df . z ) ? df . xz : df . zx ; df . xw = ( df . x < df . w ) ? df . xw : df . wx ; df . y = min ( df . y , df . z ) ; df . y = min ( df . y , df . w ) ; return sqrt ( df . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 dw ( vec2 dh , float di ) { vec2 dj = cP ( floor ( dh ) ) ; vec2 dk = fract ( dh ) ; vec4 dl = dk . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 dm = dk . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 dn = cV ( dj . x + vec4 ( cM , cN , cM , cN ) ) ; dn = cV ( dn + dj . y + vec4 ( cM , cM , cN , cN ) ) ; vec4 dp = cT ( dn ) * K + K2 ; vec4 dq = cT ( floor ( dn * K ) ) * K + K2 ; vec4 dr = dl + JITTER * dp ; vec4 ds = dm + JITTER * dq ; vec4 dt = dr * dr + ds * ds ; dr += di ; ds += di ; vec4 du = dr * dr + ds * ds ; dr += di ; ds += di ; vec4 dv = dr * dr + ds * ds ; dt . xy = min ( dt . xy , dt . zw ) ; dt . x = min ( dt . x , dt . y ) ; du . xy = min ( du . xy , du . zw ) ; du . x = min ( du . x , du . y ) ; dv . xy = min ( dv . xy , dv . zw ) ; dv . x = min ( dv . x , dv . y ) ; return mat3 ( dt . xx , cM , du . xx , cM , dv . xx , cM ) ; } vec3 dy ( vec3 dx ) { return cP ( ( ( dx * 34.0 ) + cN ) * dx ) ; } float dM ( vec2 dz ) { const vec4 dA = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 dB = floor ( dz + dot ( dz , dA . yy ) ) ; vec2 dC = dz - dB + dot ( dB , dA . xx ) ; vec2 dD ; dD = ( dC . x > dC . y ) ? vec2 ( cN , cM ) : vec2 ( cM , cN ) ; vec4 dE = dC . xyxy + dA . xxzz ; dE . xy -= dD ; dB = cP ( dB ) ; vec3 dF = dy ( dy ( dB . y + vec3 ( cM , dD . y , cN ) ) + dB . x + vec3 ( cM , dD . x , cN ) ) ; vec3 dG = max ( 0.5 - vec3 ( dot ( dC , dC ) , dot ( dE . xy , dE . xy ) , dot ( dE . zw , dE . zw ) ) , cM ) ; dG = dG * dG ; dG = dG * dG ; vec3 dH = 2.0 * fract ( dF * dA . www ) - cN ; vec3 dI = abs ( dH ) - 0.5 ; vec3 dJ = floor ( dH + 0.5 ) ; vec3 dK = dH - dJ ; dG *= 1.79284291400159 - 0.85373472095314 * ( dK * dK + dI * dI ) ; vec3 dL ; dL . x = dK . x * dC . x + dI . x * dC . y ; dL . yz = dK . yz * dE . xz + dI . yz * dE . yw ; return 130.0 * dot ( dG , dL ) ; } vec2 dS ( vec2 dN ) { float dO = dot ( dN , vec2 ( 12.9898 , 78.233 ) ) ; float dP = dot ( dN , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float dQ = fract ( sin ( dO ) * 43758.5453 ) * 2.0 - cN ; float dR = fract ( sin ( dP ) * 43758.5453 ) * 2.0 - cN ; return vec2 ( dQ , dR ) ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","dT",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"const float dU = 0.1 ; const float dV = 0.1 ; const float dW = - 0.01 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"const float dX = 0.05 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mat4 dY = mat4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 , 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 , - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 , - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; mat4 dZ = mat4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 , - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 , - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 , - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"bool eb ( vec2 d_ , float ea ) { return all ( lessThanEqual ( d_ , vec2 ( 1.0 + ea ) ) ) && all ( greaterThanEqual ( d_ , vec2 ( 0.0 - ea ) ) ) ; }".split(" ")}]}}]},{type:"textline",b:"float eo ( vec3 ec , sampler2D ed , float ee ) { float ef ; ec . z = clamp ( ec . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",
a:[{type:"textline",b:"ef = 0.0 ; float eg = dS ( ec . xy ) . x * M_PI ; float eh = cos ( eg ) ; float ei = sin ( eg ) ; mat2 ej = mat2 ( eh , ei , - ei , eh ) ; vec2 ek , el ; for ( int em = 0 ; em < 4 ; em ++ ) for ( int en = 0 ; en < 4 ; en ++ ) { el . x = dY [ em ] [ en ] ; el . y = dZ [ em ] [ en ] ; el = ej * el ; ek = ec . xy + el * ee / SHADOW_TEX_RES ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ! eb ( ek , dW ) ) ef += 1.0 ; else".split(" ")}]}}]},
{type:"textline",b:"ef += step ( ec . z , texture2D ( ed , ek ) . r ) ; } ef /= 16.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["ef","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( ef , 0.0 , 1.0 ) ; } float eG ( vec3 ep , sampler2D eq , vec3 er , sampler2D es , float et , float eu , float ev ) { float ew , ex ; ep . z = clamp ( ep . z , 0.0 , 1.0 ) ; er . z = clamp ( er . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],
group:{type:"group",a:[{type:"textline",b:"ew = 0.0 ; ex = 0.0 ; float ey = dS ( ep . xy ) . x * M_PI ; float ez = cos ( ey ) ; float eA = sin ( ey ) ; mat2 eB = mat2 ( ez , eA , - eA , ez ) ; vec2 eC , eD ; for ( int eE = 0 ; eE < 4 ; eE ++ ) for ( int eF = 0 ; eF < 4 ; eF ++ ) { eD . x = dY [ eE ] [ eF ] ; eD . y = dZ [ eE ] [ eF ] ; eD = eB * eD ; eC = ep . xy + eD * et / SHADOW_TEX_RES ; ew += step ( ep . z , texture2D ( eq , eC ) . r ) ; eC = er . xy + eD * eu / SHADOW_TEX_RES ; ex += step ( er . z , texture2D ( es , eC ) . r ) ; } ew = mix ( ew , ex , ev ) ; ew /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["ew","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( ew , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"float eK ( vec2 eH ) { float eI = min ( eH . x , eH . y ) ; float eJ = min ( 1.0 - eH . x , 1.0 - eH . y ) ; return min ( eI , eJ ) ; } float eN ( float eL , float eM ) { if ( eM >= 0.0 && eM <= dV ) eL = ( eL - 1.0 ) / dV * eM + 1.0 ; return eL ; } float eZ ( vec3 eO , vec3 eP , sampler2D eQ , sampler2D eR , float eS , float eT , float eU , float eV ) { float eW ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"float eX = eK ( eO . xy ) ; if ( - eV > eU && eX >= 0.0 && eX <= dU && eb ( eP . xy , 0.0 ) ) { float eY = 1.0 - eX / dU ; eW = eG ( eO , eQ , eP , eR , eS , eT , eY ) ; } else".split(" ")}]}}]},{type:"textline",b:"eW = eo ( eO , eQ , eS ) ; return eW ; } float fg ( vec3 e_ , sampler2D fa , float fb , float fc , float fd ) { float fe = eo ( e_ , fa , fb ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - fd > fc ) { float ff = eK ( e_ . xy ) ; fe = eN ( fe , ff ) ; }".split(" ")}]}}]},{type:"textline",b:"return fe ; } float fn ( float fh ) { float fi = 1.0 ; vec3 fj = cG . xyz / cG . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"vec3 fk = cH . xyz / cH . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:"vec3 fl = cI . xyz / cI . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"vec3 fm = cJ . xyz / cJ . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( eb ( fj . xy , 0.0 ) ) { fi = eZ ( fj , fk , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , fh ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( eb ( fj . xy , dX ) ) { fi = fg ( fj , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , fh ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fk . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"fi = eZ ( fk , fl , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , fh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"fi = fg ( fk , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , fh ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fl . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"fi = eZ ( fl , fm , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , fh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"fi = fg ( fl , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , fh ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fm . xy , 0.0 ) ) fi = fg ( fm , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , fh ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","fi",";","}"]}]}}]}]}}]},{type:"textline",b:"float fs ( inout vec3 fo ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 fp = texture2DProj ( u_shadow_mask , cK ) . rg ; vec3 fq = vec3 ( fp . r ) ; float fr = fp . g ; dT = vec4 ( fq , fr ) ; fo *= dT . a ; return dT . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return fn ( cL . z ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 fx ( vec3 ft , float fu , vec2 fv ) { vec2 fw = vec2 ( ( ft . x - fv . x ) / fu , - ( ft . z - fv . y ) / fu ) ; return fract ( fw ) ; } vec2 fB ( vec2 fy , float fz , vec2 fA ) { return vec2 ( fy . x * fz , - fy . y * fz ) + fA ; } d fC ( ) { return d ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } d gh ( vec3 fD , vec3 fE , vec3 fF , vec3 fG , vec3 fH , sampler2D fI , sampler2D fJ , vec3 fK , float fL , vec3 fM , vec4 fN , mat4 fO ) { vec3 fP = j ( fN , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float fQ = - fP . x ; float fR = - fP . z ; vec2 fS = vec2 ( fM . x + fL * ( - 1.0 - fQ ) / 2.0 , fM . z + fL * ( 1.0 - fR ) / 2.0 ) ; vec2 fT = fx ( fH , fL , fS ) ; float fU = fL / 2.0 ; vec2 fV = abs ( fB ( fT - vec2 ( 0.5 ) , fL , vec2 ( 0.0 ) ) ) ; float fW = fU * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( fV ) > fW ) return fC ( ) ; float fX = fL / fK . z ; vec2 fY = ( fT - vec2 ( 0.5 ) ) * fX + vec2 ( 0.5 ) ; vec3 fZ = fP * ( fL / fK . z - 1.0 ) / 2.0 ; fY . x += fZ . x ; fY . y -= fZ . z ; vec4 f_ = texture2D ( fJ , fY ) ; float ga = f_ . r ; if ( ga < u_scale_threshold ) return fC ( ) ; float gb = fK . y - fK . x ; float gc = fK . y - texture2D ( fI , fY ) . r * gb ; vec2 gd = fD . xz - fH . xz ; fH . xz = fB ( fT , fL , fS ) ; fH . y = gc ; fD . xz = fH . xz + gd ; fD . y *= ga ; fD . y += gc ; vec3 ge = f_ . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fD -= fH ; mat4 gf = aa ( fM , fH , fO ) ; d gg = an ( fD , fH , fE , fF , fG , gf ) ; gg . b = fH ; gg . f = ge ; return s ( gg ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return s ( d ( fD , fH , fE , fF , fG , ge ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"vec4 gn ( mat4 gi , vec4 gj ) { vec2 gk = ( gi * u_v_light_matrix [ 3 ] ) . xy ; float gl = SHADOW_TEX_RES / 2.0 ; gk = floor ( gk * gl + 0.5 ) / gl - gk ; vec4 gm = gi * gj ; gm . xy += gk ; gm = u_b_light_matrix * gm ; return gm ; } void gr ( vec3 go ) { vec3 gp = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ; vec4 gq = u_v_light_matrix * vec4 ( go + u_normal_offset * gp , 1.0 ) ; cG = gn ( u_p_light_matrix0 , gq ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cH = gn ( u_p_light_matrix1 , gq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cI = gn ( u_p_light_matrix2 , gq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cJ = gn ( u_p_light_matrix3 , gq ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void gr ( vec4 gs ) { float gt = gs . x ; float gu = gs . y ; float gv = gs . w ; cK . x = ( gt + gv ) / 2.0 ; cK . y = ( gu + gv ) / 2.0 ; cK . z = gv ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void gy ( inout vec3 gx ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"gx = max ( vec3 ( 0.0 ) , gx ) ; gx = pow ( gx , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gA ( inout vec3 gz ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"gz = max ( vec3 ( 0.0 ) , gz ) ; gz = pow ( gz , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gD ( inout vec3 gB , in float gC ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"gB = gB * gC ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void gL ( inout vec3 gG , in float gH , in vec4 gI ) { float gJ = gI . w * gH ; float gK = exp ( - gJ * gJ ) ; gK = clamp ( gK , 0.0 , 1.0 ) ; gG = mix ( gI . rgb , gG , gK ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 gS ( in mat4 gM , in vec3 gN ) { vec3 gO = mix ( gM [ 0 ] . rgb , gM [ 1 ] . rgb , max ( sign ( gN . x ) , 0.0 ) ) ; vec3 gP = mix ( gM [ 2 ] . rgb , gM [ 3 ] . rgb , max ( sign ( gN . z ) , 0.0 ) ) ; vec3 gQ = vec3 ( gM [ 0 ] . a , gM [ 1 ] . a , gM [ 2 ] . a ) ; vec3 gR = mix ( gO , gP , abs ( gN . z ) ) ; gR = mix ( gR , gQ , abs ( gN . y ) ) ; return gR ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void gU ( inout float gT ) { gT -= 0.5 ; gT = 4.0 * ( gT * gT * gT ) + 0.5 ; } void hk ( inout vec3 gV , in float gW , in vec3 gX , in float gY , in vec4 gZ , in vec4 g_ , in float ha , in float hb ) { float hc = g_ . w * gW ; float hd = exp ( - hc * hc ) ; hd = clamp ( hd , 0.0 , 1.0 ) ; float he = max ( gX . y , 0.0 ) ; gW = max ( gW - max ( gY / he , 0.0 ) , 0.0 ) ; float hf = gZ . w * gW ; float hg = 1.0 - hf ; hg = max ( hg , 0.0 ) ; gU ( hg ) ; hg += max ( ha - 0.5 , 0.0 ) ; if ( hg < hd ) { vec3 hh = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 hi = gZ . rgb ; gY = clamp ( - gY * 0.03 , 0.0 , 0.8 ) ; vec3 hj = mix ( hi , hh , min ( he , 1.0 ) ) ; hj = mix ( hj , vec3 ( 0.0 ) , gY ) * hb ; gV = mix ( hj , gV , hg ) ; } if ( hg >= hd ) { gV = mix ( g_ . rgb , gV , hd ) ; } } void ht ( inout vec3 hl , in float hm , in float hn , in vec4 ho , in float hp ) { float hq = ho . w * hm ; float hr = 1.0 - hq ; hr = clamp ( hr , 0.0 , 1.0 ) ; gU ( hr ) ; hn = clamp ( - hn * 0.03 , 0.0 , 0.8 ) ; vec3 hs = mix ( ho . rgb , vec3 ( 0.0 ) , hn ) * hp ; hl = mix ( hs , hl , hr ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",
b:"float hu = 0.0 ; float hv = 1.0 ; float hw = 0.5 ; struct hx { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float hF ( vec3 hy , vec3 hz , vec3 hA , float hB , float hC ) { vec3 hD = normalize ( hy + hz ) ; float hE = ( hv - hB ) * max ( dot ( hA , hD ) , hu ) + hB ; return pow ( hE , hC ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hQ ( vec3 hG , vec3 hH , vec3 hI , float hJ ) { vec3 hK = normalize ( hG + hH ) ; float hL = max ( dot ( hI , hK ) , 0.001 ) ; float hM = max ( dot ( hI , hH ) , 0.01 ) ; float hN = max ( dot ( hI , hG ) , 0.01 ) ; float hO = tan ( acos ( hL ) ) ; float hP = max ( hJ , 0.001 ) ; return hN * ( hv / ( 4.0 * M_PI * hP * hP ) ) * ( exp ( - ( hO * hO ) / ( hP * hP ) ) / ( sqrt ( hM * hN ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hY ( vec3 hR , vec3 hS , vec3 hT , float hU , float hV ) { vec3 hW = normalize ( hR + hS ) ; float hX = acos ( dot ( hW , hT ) ) ; if ( hX < hU ) return hv ; else if ( hX >= hU + hV || hV == hu ) return hu ; else return hv - ( hX - hU ) / hV ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void it ( float hZ , vec3 h_ , vec3 ia , vec3 ib , float ic , inout float id ) { if ( ic > hu ) { float ie = max ( dot ( h_ , ib ) , hu ) ; float ig = ic * ic ; float ih = hv - hw * ( ig / ( ig + 0.33 ) ) ; vec3 ii = ia - hZ * h_ ; vec3 ij = ib - ie * h_ ; if ( length ( ii ) == hu || length ( ij ) == hu || abs ( hZ ) > hv || abs ( ie ) > hv ) id = id * ih ; else { float ik = acos ( hZ ) ; float il = acos ( ie ) ; vec3 im = normalize ( ii ) ; vec3 io = normalize ( ij ) ; float ip , iq ; ip = max ( ik , il ) ; iq = min ( ik , il ) ; iq *= 0.95 ; float ir = max ( dot ( im , io ) , hu ) ; float is = 0.45 * ( ig / ( ig + 0.09 ) ) ; id = id * ( ih + ( is * ir * sin ( ip ) * tan ( iq ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void iA ( vec3 iu , vec3 iv , float iw , float ix , out float iy ) { float iz ; if ( iw == hu ) { iy = hv ; } else { iz = hv + abs ( dot ( iv , iu ) ) ; iz = ix + ( hv - ix ) * pow ( iz , iw ) ; iy = clamp ( iz , hu , hv ) ; } }".split(" ")}]}}]},{type:"textline",b:"void iI ( vec3 iB , vec3 iC , vec3 iD , vec2 iE , const float iF , out float iG ) {".split(" ")},{type:"condition",
a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"iA ( iB , iC , iE [ 0 ] , iE [ 1 ] , iG ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float iH = max ( dot ( iB , iC ) , hu ) ; iG = ( hv - iF ) * iH + iF ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"it ( iH , iB , iC , iD , iE [ 0 ] , iG ) ;".split(" ")}]}}]}]}}]},{type:"textline",
b:"} void iP ( vec3 iJ , vec3 iK , vec3 iL , float iM , vec2 iN , out float iO ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"iO = hF ( iJ , iK , iL , iM , iN [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"iO = hQ ( iJ , iK , iL , iN [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER",
"==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"iO = hY ( iJ , iK , iL , iN [ 0 ] , iN [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["iO","=","hu",";"]}]}}]},{type:"textline",b:"} void jl ( vec3 iQ , vec3 iR , vec3 iS , vec2 iT , vec4 iU , vec3 iV , vec3 iW , vec3 iX , inout hx iY , float iZ , vec2 i_ , vec2 ja , float jb ) { float jc = hu ; if ( iT . r != hu ) iI ( iS , iR , iQ , i_ , jb , jc ) ; float jd = hu ; if ( iT . g != hu ) iP ( iR , iQ , iS , jb , ja , jd ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( iR , iS ) * dot ( iQ , iS ) < hu ) { float je = iU . x ; float jf = iU . y ; float jg = iU . z ; float jh = iU . w ; float ji = clamp ( abs ( dot ( iR , iS ) ) , hu , hv ) ; float jj = clamp ( dot ( iQ , - iR ) , hu , hv ) ; float jk = pow ( jj , jf ) ; iY . a += iZ * vec4 ( iX * ji * pow ( iV , vec3 ( je ) ) , hv ) ; iY . a += jg * mix ( vec4 ( iV , hv ) , vec4 ( hv ) , jh ) * iZ * vec4 ( iX * ji * vec3 ( jk ) , hv ) ; } else { iY . b += iX * iW * jd ; iY . a += vec4 ( iX * iV * jc , jd ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"iY . b += iX * iW * jd ; iY . a += vec4 ( iX * iV * jc , jd ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"lamp",name:"POINT",f:[{type:"textline",b:"{ vec2 jD = jz [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; vec3 jE = jw [ LAMP_IND ] ; vec3 jF = jy [ LAMP_IND ] ; float jG = hu ;".split(" ")},{type:"textline",b:"vec3 jH = jF ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) jH *= jv ; vec3 jI = jE - jq ;".split(" ")},{type:"textline",b:"float jJ = length ( jI ) ; jH *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + jJ * jJ ) ; jI = normalize ( jI ) ; jl ( js , jI , jr , jD , jB , jo , jp , jH , jC , jA , ju , jt , jG ) ; }".split(" ")}]},
{type:"lamp",name:"SPOT",f:[{type:"textline",b:"{ vec2 jK = jz [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; vec3 jL = jw [ LAMP_IND ] ; vec3 jM = jy [ LAMP_IND ] ; vec3 jN = jx [ LAMP_IND ] ; float jO = hu ;".split(" ")},{type:"textline",b:"vec3 jP = jM ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) jP *= jv ; vec3 jQ = jL - jq ;".split(" ")},{type:"textline",b:"float jR = length ( jQ ) ; jP *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + jR * jR ) ; jQ = normalize ( jQ ) ;".split(" ")},{type:"textline",b:"float jS = dot ( jQ , jN ) ; jS *= smoothstep ( hu , hv , ( jS - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; jP *= jS ; jl ( js , jQ , jr , jK , jB , jo , jp , jP , jC , jA , ju , jt , jO ) ; }".split(" ")}]},
{type:"lamp",name:"SUN",f:[{type:"textline",b:"{ vec2 jT = jz [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; vec3 jU = jy [ LAMP_IND ] ; vec3 jV = jx [ LAMP_IND ] ; float jW = hu ;".split(" ")},{type:"textline",b:"vec3 jX = jU ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) jX *= jv ; jl ( js , jV , jr , jT , jB , jo , jp , jX , jC , jA , ju , jt , jW ) ; }".split(" ")}]},{type:"lamp",name:"HEMI",f:[{type:"textline",b:"{ vec2 jY = jz [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; vec3 jZ = jy [ LAMP_IND ] ; vec3 j_ = jx [ LAMP_IND ] ; float ka = hw ;".split(" ")},
{type:"textline",b:"vec3 kb = jZ ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) kb *= jv ; jl ( js , j_ , jr , jY , jB , jo , jp , kb , jC , jA , ju , jt , ka ) ; }".split(" ")}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hx kc ( vec3 jm , vec3 jn , vec3 jo , vec3 jp , vec3 jq , vec3 jr , vec3 js , vec2 jt , vec2 ju , float jv , vec3 jw [ NUM_LIGHTS ] , vec3 jx [ NUM_LIGHTS ] , vec3 jy [ NUM_LIGHTS ] , vec4 jz [ NUM_LFACTORS ] , float jA , vec4 jB ) { hx jC ; jC . a = vec4 ( jm + jo * jn , hu ) ; jC . b = vec3 ( hu ) ;".split(" ")},
{type:"lamps_main"},{type:"textline",b:["return","jC",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hx kh ( vec3 kd , vec3 ke , vec3 kf ) { hx kg ; kg . a = vec4 ( kd + kf * ke , hu ) ; kg . b = vec3 ( hu ) ; return kg ; }".split(" ")}]}}]}]};a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},
{type:"textline",b:"void kI ( inout vec3 ki , float kj , float kk , float kl , vec3 km , vec3 kn , vec3 ko , vec4 kp , vec3 kq , float kr ) { if ( kr > CAUSTICS_VIEW_DISTANCE ) return ; vec4 ks = kp ; vec3 kt = kq + km ; kt . xz = 10.0 * sin ( 0.1 * kt . xz ) ; vec3 ku = kt + 2.0 * cross ( - ks . xyz , cross ( - ks . xyz , kt ) + ks . w * kt ) ; vec2 kv = ku . xz ; vec3 kw = kn ; float kx = max ( dot ( km , kw ) , 0.0 ) ; float ky = 0.025 ; kv . s += 0.5 * sin ( dot ( kq + kk , vec3 ( 1.0 ) ) ) ; kv . t += 0.7 * ( - sin ( dot ( kq - kk , vec3 ( - 0.7 ) ) ) ) ; kv . st += 0.23 * cos ( 4.0 * kj - CAUST_SPEED . x * kk ) ; kv . st += 3.0 * sin ( kj - 0.3 * CAUST_SPEED . y * kk ) ; float kz = CAUST_SCALE * ( 1.0 + max ( 0.1 * kj , 0.0 ) ) ; mat3 kA = dw ( ( kv / kz ) , ky ) ; float kB = ( kA * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; float kC = ( kA * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; float kD = ( kA * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; vec3 kE = CAUST_BRIGHT * vec3 ( kB , kC , kD ) ; float kF = kl * kx ; float kG = max ( sign ( kj ) , 0.0 ) ; kF = min ( kF + 0.5 * sign ( - km . y ) * kG , 1.0 ) ; kF *= 1.0 - kG * ( 0.1 * kj ) ; kE *= kF ; kE *= kE ; float kH = min ( - kj + 10.0 , 1.0 ) ; ki += max ( ( 2.0 * ko * kE ) * kH , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float kW ( in vec3 kP , in vec3 kQ , in float kR , in float kS ) { vec3 kT = normalize ( kQ + kP ) ; float kU = 1.0 - dot ( kP , kT ) ; float kV = kS + ( 1.0 - kS ) * pow ( kU , kR ) ; return kV ; } void lk ( inout vec3 kX , in vec3 kY , in vec3 kZ , in float k_ , in float la , in float lb ) { vec3 lc = reflect ( - kY , kZ ) ; float ld = 1.0 ; if ( k_ != 0.0 ) ld = kW ( kY , lc , k_ , la ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 le = u_refl_plane . xyz * dot ( kZ , u_refl_plane . xyz ) ; vec3 lf = kZ - le ; vec2 lg = ( u_view_matrix_frag * vec4 ( lf , 0.0 ) ) . xy ; vec2 lh = cK . xy / cK . z ; lh += lg * REFL_BUMP ; vec3 li = texture2D ( u_reflectmap , lh ) . rgb ; gy ( li . rgb ) ; kX = mix ( kX , li , lb * ld ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"vec3 lj = textureCube ( u_mirrormap , lc ) . xyz ; gy ( lj . rgb ) ; kX = mix ( kX , lj , u_mirror_factor * ld ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float lq ( in float ll , inout vec2 lm , in vec2 ln ) { vec4 lo = texture2D ( u_scene_depth , lm ) ; float lp = cw ( lo ) ; if ( lp < kO ) { lm = ln ; return ll ; } else { return lp ; } return ll ; } vec3 ly ( in vec3 lr , in vec2 ls ) { vec2 lt = lr . xy / lr . z ; vec2 lu = lt + ls ; vec4 lv = texture2DProj ( u_scene_depth , lr ) ; float lw = cw ( lv ) ; lq ( lw , lu , lt ) ; vec3 lx = texture2D ( u_refractmap , lu ) . rgb ; gy ( lx ) ; return lx ; }".split(" ")}]}}]}]};
a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct mg { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mn ( inout float mh , float mi , vec2 mj , vec2 mk ) { float ml = mk . x - mj . x ; float mm = ( mi - mj . x ) / ml ; mh = mix ( mh , mk . y , clamp ( mm , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mu ( inout vec3 mo , float mp , vec4 mq , vec4 mr ) { float ms = mr . x - mq . x ; float mt = ( mp - mq . x ) / ms ; mo = mix ( mo , mr . yzw , clamp ( mt , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float mA ( float mv , float mw , vec2 mx [ SIZE_RAMP_LENGTH ] ) { float my = mv / mw ; float mz = mx [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mn ( mz , my , mx [ 0 ] , mx [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mn ( mz , my , mx [ 1 ] , mx [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",b:"mn ( mz , my , mx [ 2 ] , mx [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",
b:["return","mz",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 mG ( float mB , float mC , vec4 mD [ COLOR_RAMP_LENGTH ] ) { float mE = mB / mC ; vec3 mF = mD [ 0 ] . yzw ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mu ( mF , mE , mD [ 0 ] , mD [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],group:{type:"group",
a:[{type:"textline",b:"mu ( mF , mE , mD [ 1 ] , mD [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",b:"mu ( mF , mE , mD [ 2 ] , mD [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mF",";","}"]}]}}]},{type:"textline",b:"float mP ( float mH , float mI , float mJ , float mK ) { float mL = max ( 0.01 , min ( mI , mJ ) ) ; float mM = max ( 0.01 , min ( mI , mK ) ) ; float mN = mI - mM ; float mO = clamp ( mH / mL , 0.0 , 1.0 ) - step ( mN , mH ) * ( mH - mN ) / mM ; return mO ; } mg mV ( ) { mg mQ ; float mR ; if ( u_p_cyclic == 1 ) { mR = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( mR < 0.0 ) mR += u_p_length ; } if ( u_p_cyclic != 1 ) { mR = u_p_time - a_p_delay ; } if ( mR < 0.0 || mR >= a_p_lifetime ) { mQ . a = 0.0001 ; mQ . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( mR < 0.0 || mR >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mS = a_position ; vec3 mT = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mS = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 mT = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"mS += u_p_nfactor * mR * mT ; mS += a_p_vels . xyz * mR ; mS . y -= u_p_gravity * mR * mR / 2.0 ; float mU = max ( u_p_mass , EPSILON ) ; mS += ( u_p_wind / mU ) * mR * mR / 2.0 ; mQ . b = mS ; mQ . e = a_p_vels . w * mR ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mQ . a = mA ( mR , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mQ . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mQ . d = mG ( mR , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mQ . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"mQ . c = mP ( mR , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return mQ ; }".split(" ")}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float nh ( in sampler2D na , in vec2 nb , in vec2 nc ) { float nd = texture2D ( na , nb ) . r ; float ne = nc . x ; float nf = nc . y ; float ng = 2.0 * ne / ( ne + nf - ( 2.0 * nd - 1.0 ) * ( nf - ne ) ) ; return ng ; }".split(" ")}]}};b4w.module.__objects=function(a,w){function e(a){a={type:a,vd:0,$C:[0,0],g:new Float32Array(3),quat:new Float32Array(4),Be:new Float32Array(8),R:new Float32Array(16),Au:new Float32Array(16),Pb:new Float32Array(3),tc:new Float32Array(3),Ah:0,Bh:0,Do:!1,Ck:null,bg:0,hm:!1,sx:!1,ga:0,rq:1,qq:1,sq:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Tf:null,jx:!1,wd:0,Sf:0,Va:!1,dc:null,Nd:null,Wb:null,Qn:!0,K:null,dl:null,Ui:0,Oi:0,Zn:0,jj:0,qg:0,Dv:"",pm:!1,Cc:!1,Qb:!1,lc:!1,Ac:!1,jc:!1,ed:!1,Lf:!1,
Od:!1,Mk:!1,ee:!1,bb:!1,oh:!1,$i:!1,sl:!1,Dd:!1,Dl:!1,ol:!1,ql:!1,Vj:0,Pd:0,zf:0,Oe:0,Ne:0,Le:0,qe:"",Mb:null,pk:!1,Zd:!1,Ci:"",cn:!1,Wf:0,time:0,oq:0,ux:0,dd:0,Ti:!1,tm:!1,fj:!1,He:!1,Ge:1,Om:0,Nm:1,lm:new Int8Array([-1,-1]),em:[],$u:[],Iw:[],zc:null,yc:null,Hc:null,Gc:null,Lc:null,Ev:null,Ye:null,tg:null,vl:null,Ad:null,sg:null,wl:null,Ub:null,$m:null,Ym:null,Zm:null,Za:null,Zc:null,Cb:null,Jf:null,Kf:null,scale:1,Xe:1E4};K.identity(a.quat);B.identity(a.Be);u.identity(a.R);u.identity(a.Au);return a}
function b(a){var b=a.parent;if(b&&b.$g)return!0;switch(a.type){case "MESH":var d=m.ml(a),e=a.b4w_do_not_batch,k=a.b4w_collision,r=a.b4w_vehicle,g=a.b4w_floating,b=a.b4w_character,l=a.b4w_billboard,n=M.cD(a),u=c.tu(a);if(!(d=d||e||k||r||g))a:{a=a.data;for(d=0;d<a.materials.length;d++)if("LENS_FLARES"===a.materials[d].name){d=!0;break a}d=!1}return d||n||b||l||u;case "EMPTY":return b=m.ml(a),l=c.tu(a),a=a.b4w_do_not_batch,b||l||a;default:return!0}}function q(a,b,c,e,k,r,g,l,n){for(var u=0;u<a.nodes.length;u++){var m=
a.nodes[u];if("VALUE"==m.type){var h=b+m.name;e.push(m.outputs[0].default_value);k.push(h,k.length/2)}else"RGB"==m.type?(h=b+m.name,m=m.outputs[0].default_value.slice(0,3),g.push(m[0],m[1],m[2]),l.push(h,l.length/2)):"GROUP"==m.type&&(h=m.node_group.node_tree,q(h,b+m.name+"%join%",h.animation_data,e,k,r,g,l,n))}if(c)for((a=c.action)&&d(a,b,r,k,n,l),c=c.nla_tracks,e=0;e<c.length;e++)for(g=c[e].strips,u=0;u<c[e].strips.length;u++)a=g[u].action,d(a,b,r,k,n,l)}function d(a,b,c,d,e,k){var r=a.d.Sa,g;for(g in r){var l=
b+g.match(/"(.*?)"/)[1],r=h(d,l);null!=r?(l=a.name+"%join%"+g,c.push(l,r)):(r=h(k,l),null!=r&&(l=a.name+"%join%"+g,e.push(l,r)))}}function h(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function p(a,b,c){return{name:a,type:b,modifiers:[],particle_systems:[],constraints:[],data:null,parent:null,b4w_vehicle_settings:null,b4w_floating_settings:null,b4w_character_settings:null,b4w_vehicle:!1,b4w_character:!1,b4w_floating:!1,q:[],gz:c,Jc:[],Fe:[],Ud:[],Xc:null,ib:null,Kc:null,
i:null,w:[],l:null,h:null,Ya:null}}function g(a){return a instanceof Array?a.slice():a}function v(a){if("object"!=typeof a||null===a)return a;var b=a instanceof Array?[]:{},c=null,d=null;a.X&&(c=a.X,a.X=null);a.Vc&&(d=a.Vc,a.Vc=null);for(var e in a)b[e]=a[e]&&"object"==typeof a[e]?a[e]instanceof Float32Array?new Float32Array(a[e]):a[e]instanceof Uint32Array?new Uint32Array(a[e]):a[e]instanceof Uint16Array?new Uint16Array(a[e]):a[e]instanceof WebGLUniformLocation?a[e]:a[e]instanceof WebGLProgram?a[e]:
a[e]instanceof WebGLShader?a[e]:a[e]instanceof WebGLBuffer?null:v(a[e]):a[e];c&&(b.X=c,a.X=c);d&&(b.Vc=d,a.Vc=d);return b}var m=w("__animation"),t=w("__batch"),z=w("__boundings"),C=w("__camera"),J=w("__config"),D=w("__constraints"),y=w("__curve"),n=w("__geometry"),l=w("__lights"),c=w("__nla"),M=w("__particles"),I=w("__scenes"),x=w("__transform"),B=w("__tsr"),E=w("__util"),K=w("quat"),k=w("vec3"),u=w("mat4"),r=J.p,L=0,F=new Float32Array(4);a.Gk=e;a.nq=function(a,c){var d=b(a);a.$g=d;a.d=e("MESH"===
a.type?d?"DYNAMIC":"STATIC":a.type);a.gz=!1;a.ib=null;a.Jc=[];a.w=[];a.l=null;a.h=null;a.Ya=null;a.ya||(a.ya=null);var d=a.d,g=a.location,n=a.scale[0];E.lE(a.rotation_quaternion,F);x.kd(a,g);x.Fd(a,F);x.gf(a,n);switch(a.type){case "ARMATURE":g=a.pose.bones;for(n=0;n<g.length;n++){var h=g[n],p=h.bone,v=new Float32Array(p.matrix_local),M=new Float32Array(16);u.invert(v,M);var K=new Float32Array(h.matrix_basis),A=new Float32Array(3);k.subtract(p.tail_local,p.head_local,A);E.yG(A,M,A);h.kz=A;h.dz=[h].concat(h.parent_recursive);
h.jr=B.kt(v,B.create());h.ir=B.kt(K,B.create());h.Jm=B.create();h.ik=!1}g=m.Zz(a);d.Lc=g;g=m.Tr(a,g);a.b4w_animation_mixing?(d.zc=new Float32Array(g.xa),d.yc=new Float32Array(g.xa),d.Hc=new Float32Array(g.g),d.Gc=new Float32Array(g.g)):(d.zc=g.xa,d.yc=g.xa,d.Hc=g.g,d.Gc=g.g);d.Ev=g;d.Wf=0;d.He=a.b4w_animation_mixing;break;case "MESH":d.Dd=r.all_objs_selectable||a.b4w_selectable;d.Dl=a.b4w_selectable;d.Zd=a.b4w_billboard;d.Uz=a.b4w_pres_glob_orientation;d.Ci="BASIC";d.cn="SPHERICAL"==a.b4w_billboard_geometry;
d.dl={VC:a.b4w_glow_settings.glow_duration,XC:a.b4w_glow_settings.glow_period,YC:a.b4w_glow_settings.glow_relapses};d.Dd&&(a.d.Ck=E.lt(L),L++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.tm=a.data.b4w_vertex_anim.length?!0:!1;if(n=m.Xi(a)){g=a.d;h=a.data.vertex_groups;if(h.length){p=n.data.bones;v=n.pose.bones;M=0;K={};for(A=0;A<p.length;A++){var w=p[A].name,J=E.Xb("name",w,h);if(J){var da=E.jo(v,"name",w);K[w]={Rr:A,Ki:M++,mp:da,xx:J.index}}}g.Lc=K;g.dd=M;g.fj=!0}g=a.d.Lc;g=m.Tr(n,g);
n.b4w_animation_mixing?(d.zc=new Float32Array(g.xa),d.yc=new Float32Array(g.xa),d.Hc=new Float32Array(g.g),d.Gc=new Float32Array(g.g)):(d.zc=g.xa,d.yc=g.xa,d.Hc=g.g,d.Gc=g.g);d.Ev=g;d.Wf=0}n=a.d;g=a.data.materials;h=[];p=[];v=[];M=[];K=[];A=[];for(w=0;w<g.length;w++)J=g[w],(da=J.node_tree)&&q(da,J.name+"%join%",da.animation_data,h,p,v,M,K,A);n.Ye=h;n.tg=p;n.vl=v;n.Ad=M;n.sg=K;n.wl=A;a.q=[];d.Cc=a.b4w_shadow_cast;d.Qb=a.b4w_shadow_receive;d.lc=a.b4w_shadow_cast_only&&d.Cc;d.Ac=a.b4w_reflexible;d.jc=
a.b4w_reflexible_only&&d.Ac;d.ed=a.b4w_reflective;d.Lf=a.b4w_caustics;d.Od=a.b4w_wind_bending;d.Vj=a.b4w_wind_bending_angle;n=t.CG(a.b4w_wind_bending_angle,t.Qz(a.data.b4w_bounding_box),a.scale[0]);d.Pd=n;d.zf=a.b4w_wind_bending_freq;d.Oe=a.b4w_detail_bending_freq;d.Ne=a.b4w_detail_bending_amp;d.Le=a.b4w_branch_bending_amp;d.$i=!1;d.qe=a.b4w_main_bend_stiffness_col;n=a.b4w_detail_bend_colors;d.Mb={};d.Mb.Tu=n.leaves_stiffness_col;d.Mb.Su=n.leaves_phase_col;d.Mb.kv=n.overall_stiffness_col;d.oh=a.b4w_do_not_cull;
d.Mk=a.b4w_disable_fogging;d.ee=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";n=a.data.materials[0];d.Ui=n.physics.friction;d.Oi=n.physics.elasticity;d.jj=0;d.Xe=1E4;d.qg=a.b4w_lod_transition;d.sl=!0;break;case "CAMERA":C.eA(a);C.Mz(a);break;case "LAMP":l.wD(a);break;case "CURVE":if(n=y.$A(a))a.jz=n;break;case "EMPTY":d.Ub=z.Qd(),n=z.Wj(),d.Zc=n}if(!c&&(a.parent&&"OBJECT"==a.parent_type?(g=d.g,h=d.quat,n=d.scale,D.tr(a,a.parent,g,h,n)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==
a.parent.type?(g=d.g,h=d.quat,n=d.scale,D.sr(a,a.parent,a.parent_bone,g,h,n)):a.ya&&a.ya.b4w_group_relative?(n=B.nh(d.g,d.scale,d.quat),D.qz(a,a.ya,n)):a.ya&&!a.ya.b4w_group_relative&&(x.F(a),h=d.R,u.multiply(a.ya.d.R,h,h),g=E.rg(h),n=E.ul(h),h=E.re(h),x.kd(a,g),x.Fd(a,h),x.gf(a,n)),n=a.dupli_group))for(g=n.objects,n=0;n<g.length;n++)g[n].ya=a;a.field&&(d.Zn=a.field.strength,I.ox(a));d.pm=a.game.use_collision_compound;d.Dv=a.game.physics_type;x.F(a)};a.kG=function(a){for(var b=0;b<a.length;b++){var c=
a[b];!c.d||"DYNAMIC"!=c.d.type&&"CAMERA"!=c.d.type||x.F(c);c.b4w_use_default_animation&&m.ml(c)&&(m.Tm(c),c.w.length&&m.play(c,null,m.Fm))}};a.cd=function(a){return a.$g?!0:!1};a.Eu=function(a){return"MESH"==a.type&&a.$g?!0:!1};a.Yi=function(a){a=a.b4w_object_tags;return{title:a?a.title:"",description:a?a.description:"",HI:a?a.category:""}};a.Y=function(){L=0};a.BL=function(a){return a.d.ee};a.yu=p;a.copy=function(a,b,c){b=p(b,a.type,!1);var d=[];if(c){for(var e=0;e<a.q.length;e++)a.q[e].Pc||(b.q.push(v(a.q[e])),
d.push(a.q[e].$a));for(e=0;e<a.q.length;e++)if(a.q[e].Pc){var k=v(a.q[e]);b.q.push(k);for(var r=0;r<d.length;r++)d[r]==a.q[e].$a&&(k.$a=b.q[r].$a)}}else b.q=g(a.q);b.d=v(a.d);a.$g&&(b.$g=a.$g);a.ya&&(b.ya=a.ya);a.Ud&&(b.Ud=g(a.Ud));!a.l||a.b4w_vehicle||a.b4w_character||a.b4w_floating||(b.l=v(a.l));b.game=v(a.game);b.b4w_collision_id=a.b4w_collision_id;b.b4w_correct_bounding_offset=a.b4w_correct_bounding_offset;b.b4w_collision=a.b4w_collision;b.data=a.data;b.particle_systems=c?v(a.particle_systems):
g(a.particle_systems);if(c)for(e=0;e<b.q.length;e++){b.q[e].$a&&n.gG(b.q[e].$a);if("PARTICLES"==b.q[e].type&&b.q[e].pp)for(r=0;r<b.JL.length;r++)if(b.particle_systems[r].name==b.q[e].pp){b.q[e].xc=b.particle_systems[r];break}b.q[e].Nh=b.uuid;t.aG(b.q[e],E.eh(b.d,0))}b.uuid=E.nt();b.d.Do=!0;b.d.Ck=E.lt(L);L++;return b};a.CA=v;a.HK=function(a,b){for(var c=a.d.tg,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null};a.zK=function(a,b){for(var c=a.d.sg,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];
return null}};b4w.module.__camera=function(a,w){function e(b){switch(b){case "STATIC":return a.Ug;case "TARGET":return a.qa;case "EYE":return a.Jb;case "HOVER":return a.vb;default:throw"Unknown move style";}}function b(b){var c={type:b,name:"",mf:1,width:0,height:0,he:null,Db:null,Nc:null,jb:0,ge:0,Ra:0,cb:0,left:0,right:0,top:0,bottom:0,Re:new Float32Array(3),ct:new Float32Array(3),quat:new Float32Array(4),pa:new Float32Array(16),EI:new Float32Array(16),wa:new Float32Array(16),ti:new Float32Array(16),kE:new Float32Array(16),
Hd:new Float32Array(16),Hw:new Float32Array(16),Qg:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Tf:null,dof_on:0,$n:{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Ra:new Float32Array([0,0,0,0]),cb:new Float32Array([0,0,0,0])},Mj:0,Kd:0,Hb:null,Hi:null,Cn:null,Hs:new Float32Array(4),Kl:new Float32Array(4)};if(b==a.wb)return c;switch(b){case a.Ic:h(c,40,.1,1E3);break;case a.sd:h(c,2.5,.1,
1E3);break;case a.Ef:break;case a.Zg:break;case a.xi:break;case a.Kb:case a.Tb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function q(b,c,d){if(b.type!=a.Kb&&b.type!=a.Tb)throw"set_stereo_params(): wrong camera type";b.Mj=c;b.Kd=d;l(b,b.jb);if(F.fa())for(c=F.v(),b=c.d.Gd,c=F.Wk(c).d.K,d=0;d<c.length;d++)E(c[d],b)}function d(a,b){var c=a.d,d=f.ka(c.quat,f.ta,Q),c=f.ka(c.quat,f.nd,S),e=-Math.asin(d[1]/N.length(d)),d=Math.abs(e)>Math.PI/
4?N.scale(c,-f.sign(e),A):N.scale(d,-f.sign(c[1]),A),k=Math.atan(Math.abs(d[0]/d[2]));0<c[1]&&(e=f.sign(e)*Math.PI-e);c=k;0>d[2]&&(c=Math.PI-c);0>d[0]&&(c=2*Math.PI-c);b[0]=c;b[1]=e;return b}function h(b,c,d,e,f){switch(b.type){case a.Ic:case a.Kb:case a.Tb:b.ge=c;b.jb=1;break;case a.sd:b.top=c;b.jb=1;break;case a.Ef:delete b.ge;b.ge=c;b.jb=f/c;break;case a.Zg:b.top=c;b.jb=f/c;break;default:L.error("set_frustum(): Unsupported camera type: "+b.type)}b.Ra=d;b.cb=e}function p(b,d){var e=d.d.g,k=d.d.quat,
r=oa;ea.rotateX(d.d.R,-Math.PI/2,r);ea.invert(r,b.pa);if(b.Hb){var r=b.Hb[0],g=b.Hb[1],n=b.Hb[2],u=b.Hb[3],m=oa;m[0]=1-2*r*r;m[1]=-2*r*g;m[2]=-2*r*n;m[3]=0;m[4]=-2*r*g;m[5]=1-2*g*g;m[6]=-2*g*n;m[7]=0;m[8]=-2*r*n;m[9]=-2*g*n;m[10]=1-2*n*n;m[11]=0;m[12]=-2*r*u;m[13]=-2*g*u;m[14]=-2*n*u;m[15]=1;ea.multiply(b.pa,m,b.pa);l(b,b.jb,!0);r=da;g=oa;ea.invert(b.pa,g);ea.transpose(g,g);P.transformMat4(b.Hb,g,r);g=ca;g[0]=(f.sign(r[0])+b.wa[8])/b.wa[0];g[1]=(f.sign(r[1])+b.wa[9])/b.wa[5];g[2]=-1;g[3]=(1+b.wa[10])/
b.wa[14];P.scale(r,2/(r[0]*g[0]+r[1]*g[1]+r[2]*g[2]+r[3]*g[3]),r);b.wa[2]=r[0];b.wa[6]=r[1];b.wa[10]=r[2]+1;b.wa[14]=r[3]}b.type==a.Kb?b.pa[12]+=b.Kd/2:b.type==a.Tb&&(b.pa[12]-=b.Kd/2);ea.multiply(b.wa,b.pa,b.Qg);M(b);c(b);N.copy(b.Re,b.ct);N.copy(e,b.Re);V.copy(k,b.quat)}function g(b,d,e,f){ea.lookAt(d,e,f,b.pa);b.type==a.Kb?b.pa[12]+=b.Kd/2:b.type==a.Tb&&(b.pa[12]-=b.Kd/2);ea.multiply(b.wa,b.pa,b.Qg);M(b);c(b);N.copy(d,b.Re)}function v(a){var b=a.d.K;if(!b)throw"Wrong object";for(var c=a.d,d=0;d<
b.length;d++){var e=b[d];p(e,a);f.$s(e.Qg,e.$n);if(e.Tf)if(e.dof_on){var k=N.dist(c.g,e.Tf.location);e.dof_distance=k}else e.dof_distance=0}}function m(b,c){var e=b.d,k=e.dc;!k||e.ga!=a.Jb&&e.ga!=a.qa||(c&&(e=d(b,U),k.left+=e[0],k.right+=e[0]),k.left=f.oc(k.left),k.right=f.oc(k.right))}function t(b,c){var e=b.d,k=e.Nd;!k||e.ga!=a.Jb&&e.ga!=a.qa||(c&&(e=d(b,U),k.Ua+=e[1],k.Na+=e[1]),k.Ua=f.Ff(k.Ua,-Math.PI,Math.PI),k.Na=f.Ff(k.Na,-Math.PI,Math.PI))}function z(a,b,c){if(b==c)return c-a;a=f.oc(a);b=
f.oc(b);c=f.oc(c);var d=Math.abs(b-c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-b;c=f.oc(c+b);a=f.oc(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0}function C(a,b,c,e,k){var r=a.d,g=b,l=c;if(e||k)a=d(a,X),e&&(g=b-a[0]),k&&(l=c-a[1]);if(g||l)b=V.identity(ka),g&&(g=V.setAxisAngle(f.ta,g,fa),V.multiply(b,g,b)),l&&(g=f.ka(r.quat,f.Ee,Q),l=V.setAxisAngle(g,l,fa),V.normalize(l,l),V.multiply(b,l,b)),V.multiply(b,r.quat,r.quat)}function J(a,b,c,e,k){var r=a.d,g=b,l=c;if(e||k){var n=d(a,
X);e&&(g=b-n[0]);k&&(l=c-n[1])}y(a,a.d.Pb,g,l);a=d(a,X);a=f.Ff(a[1],-Math.PI,Math.PI);r.hm=Math.abs(a)>Math.PI/2}function D(a,b,c,e,f){var k=a.d,g=b,r=c;if(e||f){var l=d(a,X);e&&(g=b-l[0]);f&&(r=c-l[1])}k.Qn||(g=0);y(a,k.tc,g,r);r&&n(a)}function y(a,b,c,d){var e=a.d;if(c||d){var k=V.identity(ka);c&&(c=V.setAxisAngle(f.ta,c,fa),V.multiply(k,c,k));a=B(a);d&&(!a||a&&e.Va)&&(a=f.ka(e.quat,f.Ee,Q),d=V.setAxisAngle(a,d,fa),V.normalize(d,d),V.multiply(k,d,k));f.FE(e.g,b,k,e.g);V.multiply(k,e.quat,e.quat)}}
function n(a){var b=a.d;if(b.Va){var c=d(a,U)[1];a=a.d;a.Wb.Na-a.Wb.Ua?(c=(a.Wb.Na-c)/(a.Wb.Na-a.Wb.Ua),c=Math.max(c,0)):c=0;c=c*(a.Sf-a.wd)+a.wd;a=f.ka(b.quat,f.$b,Q);N.normalize(a,a);N.scale(a,c,a);N.subtract(b.tc,a,b.g)}}function l(b,d,e){switch(b.type){case a.Ic:if(!d)throw"No aspect ratio";b.jb=d;case a.Ef:ea.perspective(f.mE(b.ge),b.jb,b.Ra,b.cb,b.wa);break;case a.sd:if(!d)throw"No aspect ratio";b.jb=d;case a.Zg:d=b.top*b.jb;ea.ortho(-d,d,-b.top,b.top,b.Ra,b.cb,b.wa);break;case a.xi:ea.ortho(b.left,
b.right,b.bottom,b.top,b.Ra,b.cb,b.wa);break;case a.Kb:case a.Tb:if(!d)throw"No aspect ratio";b.jb=d;var k=Math.tan(b.ge*Math.PI/360);d=b.Ra*k;var g=b.jb*b.Mj*k;b.type==a.Kb?(k=g-b.Kd/2,g+=b.Kd/2):(k=g+b.Kd/2,g-=b.Kd/2);k=-(b.Ra/b.Mj*k);g*=b.Ra/b.Mj;ea.frustum(k,g,-d,d,b.Ra,b.cb,b.wa);b.left=k;b.right=g;break;case a.wb:return;default:throw"Wrong camera type: "+b.type;}e||(ea.multiply(b.wa,b.pa,b.Qg),M(b),c(b))}function c(a){ea.copy(a.pa,a.Hd);a.Hd[12]=0;a.Hd[13]=0;a.Hd[14]=0;a.Hd[15]=1;ea.multiply(a.wa,
a.Hd,a.Hd);ea.invert(a.Hd,a.Hd)}function M(a){ea.copy(a.pa,a.ti);ea.multiply(a.wa,a.ti,a.ti);ea.invert(a.ti,a.ti)}function I(b,c,d,e,k){e||(e=new Float32Array(24));c||(c=b.Ra);d||(d=b.cb);var g,r,l,n,u,m,h,p;switch(b.type){case a.wb:throw"Extraction from NONE camera is not possible";case a.Ic:case a.Ef:g=c*Math.tan(b.ge*Math.PI/360);n=-g;r=g*b.jb;l=-r;u=d/c*g;p=-u;m=u*b.jb;h=-m;break;case a.sd:case a.Zg:l=b.top*b.jb;g=u=b.top;r=m=l;n=p=-b.top;l=h=-l;break;case a.xi:g=u=b.top;r=m=b.right;n=p=b.bottom;
l=h=b.left;break;case a.Kb:case a.Tb:u=c/b.Ra;g=c*Math.tan(b.ge*Math.PI/360);n=-g;r=b.right*u;l=b.left*u;h=d/c;u=g*h;p=-u;m=r*h;h*=l;break;default:throw"Wrong camera type: "+b.type;}e[0]=l;e[1]=n;e[2]=-c;e[3]=r;e[4]=n;e[5]=-c;e[6]=r;e[7]=g;e[8]=-c;e[9]=l;e[10]=g;e[11]=-c;e[12]=h;e[13]=p;e[14]=-d;e[15]=h;e[16]=u;e[17]=-d;e[18]=m;e[19]=u;e[20]=-d;e[21]=m;e[22]=p;e[23]=-d;k&&(c=oa,ea.invert(b.pa,c),f.bf(e,c,e,0));return e}function x(a){return"CAMERA"===a.type?!0:!1}function B(b){return x(b)&&b.d&&b.d.ga==
a.vb?!0:!1}function E(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.Hi){var d=b.csm_num;a.Hi=Array(d);for(var e=0;e<d;e++)a.Hi[e]=new Float32Array(3);a.Cn=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.Ra:K(b,a,d-1),f=K(b,a,d),e=I(a,e,f,la),e=u.DC(e);a.Hi[d].set(e.C);a.Cn[d]=e.Ca;a.Hs[d]=N.length(e.C);a.Kl[d]=k(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.Kl[0]=b.first_cascade_blur_radius}function K(a,b,c){var d=a.csm_num,e=f.ra(a.csm_first_cascade_border,b.Ra,b.cb);a=f.ra(a.csm_last_cascade_border,
b.Ra,b.cb);return f.ra(k(e,a,d,c),b.Ra,b.cb)}function k(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var u=w("__boundings");w("__config");var r=w("__constraints"),L=w("__print"),F=w("__scenes"),f=w("__util"),N=w("vec3"),P=w("vec4"),V=w("quat"),R=w("mat3"),ea=w("mat4");a.wb=10;a.Ic=20;a.sd=30;a.Ef=40;a.Zg=50;a.xi=60;a.Kb=70;a.Tb=80;a.Ug=0;a.Dm=1;a.qa=2;a.Jb=3;a.vb=4;var U=new Float32Array(2),X=new Float32Array(2),Q=new Float32Array(3),S=new Float32Array(3),
A=new Float32Array(3),ka=new Float32Array(4),fa=new Float32Array(4),da=new Float32Array(4),ca=new Float32Array(4),Z=new Float32Array(16),oa=new Float32Array(16),la=new Float32Array(24);a.eA=function(c){var k=c.d,g=c.data;switch(g.type){case "PERSP":var r=b(a.Ic);if(g.angle_y)var l=g.angle_y/Math.PI*180;h(r,l,g.clip_start,g.clip_end);break;case "ORTHO":r=b(a.sd),h(r,g.ortho_scale/2,g.clip_start,g.clip_end)}r.name=c.name;k.jx=!1;k.ga=e(g.b4w_move_style);k.dof_distance=c.data.dof_distance;k.Tf=c.data.dof_object;
k.dof_front=c.data.b4w_dof_front;k.dof_rear=c.data.b4w_dof_rear;k.dof_power=c.data.b4w_dof_power;k.Qn=c.data.b4w_enable_hover_hor_rotation;k.K=[r];if(k.ga==a.qa||k.ga==a.Jb||k.ga==a.vb)k.rq=c.data.b4w_trans_velocity,k.qq=c.data.b4w_rot_velocity,k.sq=c.data.b4w_zoom_velocity;k.ga==a.qa&&(k.Pb.set(g.b4w_target),g=f.ka(k.quat,f.nd,Q),k.hm=0<g[1]);g=c.d;l=g.ga;if(l===a.qa||l===a.Jb||l===a.vb){var u=c.data,p=null,v=null,x=null;l===a.qa||l===a.Jb?(u.b4w_use_panning&&(g.sx=u.b4w_use_panning),u.b4w_use_horizontal_clamping&&
(p={left:u.b4w_rotation_left_limit,right:u.b4w_rotation_right_limit}),u.b4w_use_vertical_clamping&&(v={Na:u.b4w_rotation_down_limit,Ua:u.b4w_rotation_up_limit}),l===a.qa&&(g.Va=u.b4w_use_distance_limits&&u.b4w_distance_min<=u.b4w_distance_max,g.Va&&(g.wd=u.b4w_distance_min,g.Sf=u.b4w_distance_max))):l===a.vb&&(u.b4w_use_horizontal_clamping&&u.b4w_horizontal_translation_min<=u.b4w_horizontal_translation_max&&(p={left:u.b4w_horizontal_translation_min,right:u.b4w_horizontal_translation_max}),u.b4w_use_vertical_clamping&&
u.b4w_vertical_translation_min<=u.b4w_vertical_translation_max&&(v={Na:u.b4w_vertical_translation_min,Ua:u.b4w_vertical_translation_max}),g.Va=u.b4w_use_distance_limits&&u.b4w_hover_angle_min<=u.b4w_hover_angle_max&&u.b4w_distance_min<=u.b4w_distance_max,g.Va&&(x={Na:u.b4w_hover_angle_min,Ua:u.b4w_hover_angle_max},g.wd=u.b4w_distance_min,g.Sf=u.b4w_distance_max));var q=p;q&&l==a.Jb&&(q.left*=-1,q.right*=-1);if(q=v)switch(l){case a.qa:q.Na*=-1;q.Ua*=-1;break;case a.vb:var y=-q.Na;q.Na=-q.Ua;q.Ua=y}(q=
x)&&l==a.vb&&(q.Na*=-1,q.Ua*=-1);g.dc=p;g.Nd=v;g.Wb=x;m(c,"LOCAL"==u.b4w_horizontal_clamping_type);t(c,"LOCAL"==u.b4w_vertical_clamping_type)}if(k.ga===a.vb)if(k=c.d,k.Va){g=c.d;l=f.ka(g.quat,f.$b,Q);u=da;u.set(f.ta);u[3]=0;l=f.Mo(u,0,g.g,l,g.tc);if(!l||100<N.len(l))g.tc[0]=g.g[0],g.tc[1]=0,g.tc[2]=g.g[2];g=d(c,U);k=z(g[1],k.Wb.Ua,k.Wb.Na);0<g[1]&&L.warn("Active hover camera has wrong orientation");k?D(c,0,k):n(c)}else k.Qn=!1;if(r.type==a.sd)switch(c=c.d,c.ga){case a.qa:c.Ah=N.dist(c.g,c.Pb);c.Bh=
c.K[0].top;break;case a.vb:c.Va&&(c.Ah=N.dist(c.g,c.tc),c.Bh=c.K[0].top)}};a.xb=b;a.II=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.Db);case "DEPTH":return Boolean(a.Nc);case "SCREEN":return!Boolean(a.Db)&&!Boolean(a.Nc);default:throw"Wrong attachment type: "+b;}};a.Tl=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.Db=c;break;case "DEPTH":a.Nc=c;break;case "SCREEN":a.Db=null;a.Nc=null;break;default:throw"Wrong attachment type: "+b;}};a.ZJ=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.Db;
case "DEPTH":return a.Nc;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.Zu=function(b,c){if(b.type!=a.Ic||c!=a.Kb&&c!=a.Tb)throw"make_stereo(): wrong camera type";b.type=c;q(b,6,.065)};a.cF=q;a.bd=d;a.Xk=function(a,b){d(a,b);b[0]=f.oc(b[0]+Math.PI);b[1]*=-1;return b};a.qt=function(a,b){var c=a.d,d=f.ka(c.quat,f.$b,Q),e=Math.asin(d[1]/N.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?f.ka(c.quat,f.Bf,S):f.ka(c.quat,f.nd,S)),c=Math.atan(Math.abs(d[0]/d[2])),
0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b};a.Hp=h;a.XE=function(b,c,d,e,f,k,g){switch(b.type){case a.xi:b.left=c;b.right=d;b.bottom=e;b.top=f;b.Ra=k;b.cb=g;break;default:L.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.$f=function(a){return a.d.ga};a.FM=p;a.GM=g;a.Cw=function(a,b,c){var d=Q;d[0]=0;d[1]=-1;d[2]=0;N.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=S;e[0]=0;e[1]=0;e[2]=-1;N.transformQuat(e,c,e);g(a,b,d,e)};a.LB=function(a,
b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];ea.lookAt(a,b,c,oa);ea.invert(oa,oa);ea.rotateX(oa,Math.PI/2,oa);R.fromMat4(oa,Z);V.fromMat3(Z,e)};a.mx=v;a.dG=function(b){var c=b.d;switch(c.ga){case a.qa:c.Va?r.HE(c.g,c.quat,c.Pb,c.wd,r.Kx):r.GE(c.g,c.quat,c.Pb);r.Ek(b,f.ta);break;case a.Jb:r.Ek(b,f.ta)}};a.fE=m;a.jE=t;a.px=function(b){var c=b.d;if(x(b)&&c.K[0].type===a.sd){if(c.ga===a.qa)var d=N.dist(c.g,c.Pb),c=d/c.Ah*c.Bh;else c.Va&&c.ga===a.vb?(d=N.distance(c.g,c.tc),c=d/c.Ah*c.Bh):c=b.d.K[0].top;for(var e in b.d.K)d=
b.d.K[e],d.top=c,l(d,d.jb);v(b)}};a.tA=function(b){var c=b.d;if(c.ga===a.qa||c.ga===a.Jb){if(c.dc){var e=c.dc.left,k=c.dc.right,g=d(b,U);(g=c.ga==a.qa?z(g[0],e,k):z(g[0],k,e))&&(c.ga==a.qa?J(b,g,0):C(b,g,0))}c.Nd&&(e=c.Nd.Na,k=c.Nd.Ua,g=d(b,U),(g=c.ga==a.qa?z(g[1],k,e):z(g[1],e,k))&&(c.ga==a.qa?J(b,0,g):C(b,0,g)));c.ga===a.qa&&c.Va&&(g=b.d,e=N.subtract(g.g,g.Pb,Q),k=N.length(e),k>g.Sf?(N.scale(e,g.Sf/k,e),N.add(g.Pb,e,g.g)):k<g.wd&&(k=f.ka(g.quat,f.$b,S),N.scale(k,100*g.wd,k),N.add(e,k,e),N.scale(e,
-g.wd/N.length(e),e),N.add(g.Pb,e,g.g)))}c.ga===a.vb&&(c=b.d,g=c.Va?c.tc:c.g,c.dc&&(e=f.ra(g[0],c.dc.left,c.dc.right)-g[0],g[0]+=e,c.Va&&(c.g[0]+=e)),c.Nd&&(e=f.ra(g[2],c.Nd.Na,c.Nd.Ua)-g[2],g[2]+=e,c.Va&&(c.g[2]+=e)),c=b.d,c.Va&&(g=d(b,U)[1],g=z(g,c.Wb.Ua,c.Wb.Na),f.ka(c.quat,f.$b,Q),g&&D(b,0,g)))};a.Uc=C;a.ue=J;a.Gg=D;a.gD=n;a.dL=function(b){switch(b.type){case a.Ic:case a.sd:case a.Kb:case a.Tb:return!0;default:return!1}};a.kC=function(b){b=b.d.K[0];switch(b.type){case a.Ic:case a.Ef:case a.Kb:case a.Tb:return Math.PI*
b.ge/180;default:return L.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.Th=l;a.bA=c;a.cA=M;a.IB=I;a.Mz=function(a){a=a.d;var b=u.Qd();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Ub=b;var c=u.xn(1,[0,0,0]);a.Zc=c;a.Ym=u.us(1,b);a.$m=u.ws(1,b);a.Zm=u.vs(1,b)};a.Ve=x;a.Fb=function(b){return x(b)&&b.d&&b.d.ga==a.qa?!0:!1};a.We=function(b){return x(b)&&b.d&&b.d.ga==a.Jb?!0:!1};a.ob=B;a.mq=E;a.fB=K;a.op=function(b,c,d){b=b.d.K[0];switch(b.type){case a.Ic:case a.Ef:case a.sd:case a.Zg:case a.Kb:case a.Tb:var e=
da;e.set(c);e[3]=1;P.transformMat4(e,b.Qg,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return L.error("Non-compatible camera"),d}};a.jK=function(a){return a.d.K[0]}};b4w.module.__constraints=function(a,w){function e(a){var b={};b.type=a;return b}function b(a,b){a.ib&&a.ib.W&&d(a.ib.W,a);b.W&&q(b.W,a);a.ib=b}function q(a,b){if(-1==a.Jc.indexOf(b))a.Jc.push(b);else throw"Descendant object override is forbidden";}function d(a,b){var c=a.Jc.indexOf(b);if(-1!=c)a.Jc.splice(c,1);else throw"No descendant object";}function h(a,b,d){switch(b.type){case 1:var e=a.d.quat,f=b.W.d.R;d=b.W.d.quat;b.df?(D.copy(b.df,e),D.multiply(d,e,e)):D.copy(d,e);J.transformMat4(b.offset,
f,a.d.g);a.d.scale=b.Sl*b.W.d.scale;break;case 9:var h=a.d.g,e=a.d.quat,f=b.W.d.R;d=b.W.d.quat;D.multiply(D.invert(b.Cg,b.Cg),e,e);D.multiply(d,e,e);J.transformMat4(b.offset,f,h);D.copy(d,b.Cg);break;case 10:h=a.d.g;e=a.d.quat;f=b.W.d.R;d=b.W.d.quat;D.multiply(D.invert(b.Cg,b.Cg),e,e);D.multiply(d,e,e);J.transformMat4(b.offset,f,h);D.copy(d,b.Cg);var e=a.d.quat,h=b.W.d.quat,x=J.transformQuat(z.ta,e,n),f=D.invert(h,I),q=J.transformQuat(x,f,l),C=c;C[0]=q[0];C[1]=0;C[2]=q[2];var E=J.length(C),f=-C[2]/
E,f=Math.acos(f)*z.sign(C[0]),E=E/J.length(q),E=Math.acos(E)*z.sign(q[1]),q=!1;f<-b.ds&&(f=-b.ds,q=!0);f>b.fs&&(f=b.fs,q=!0);E<-b.gs&&(E=-b.gs,q=!0);E>b.cs&&(E=b.cs,q=!0);q&&(b=Math.sin(E),E=Math.cos(E),q=Math.sin(f),f=Math.cos(f),C=l,C[0]=E*q,C[1]=b,C[2]=-E*f,J.transformQuat(C,h,C),b=D.rotationTo(x,C,I),D.multiply(b,e,e),D.normalize(e,e));"CAMERA"==a.d.type&&(b=J.transformQuat(z.ta,d,l),v(a,b));break;case 12:h=a.d.g;e=a.d.quat;f=b.W.d.R;E=b.W.d.g;a=b.qF;q=n;x=I;J.transformMat4(b.offset,f,q);z.Yh(q,
h,d,a,h);b=n;J.sub(E,h,b);J.normalize(b,b);C=e;h=K;f=h.subarray(0,3);E=h.subarray(3,6);q=h.subarray(6,9);J.copy(b,E);J.negate(E,E);J.normalize(E,E);Boolean(.999999<Math.abs(J.dot(b,z.ta)))?(b=y.fromQuat(D.normalize(C,x),k),J.copy(b.subarray(0,3),f)):J.cross(z.ta,E,f);J.normalize(f,f);J.cross(f,E,q);J.normalize(q,q);D.fromMat3(h,x);D.normalize(x,x);z.Lw(x,e,d,.16*a,e);break;case 2:e=a.d.quat;h=M;d=I;m(b.W,b.Yz,!0,h,d);b.df?(D.copy(b.df,e),D.multiply(d,e,e)):D.copy(d,e);a.d.scale=b.Sl*h[3];z.Nj(b.offset,
h[3],d,h,a.d.g);break;case 3:h=a.d.g;e=a.d.quat;d=b.W.d.g;p(h,e,d);"CAMERA"==a.d.type&&v(a,z.ta);break;case 4:h=a.d.g;e=a.d.quat;d=b.target;p(h,e,d);"CAMERA"==a.d.type&&v(a,z.ta);break;case 5:h=a.d.g;e=a.d.quat;d=b.W.d.g;g(h,e,d,b.xg);e=J.dist(h,d);if(b=e>b.nj?e-b.nj:e<b.xg?e-b.xg:0)J.sub(d,h,n),J.normalize(n,n),J.scale(n,b,n),J.add(h,n,h);"CAMERA"==a.d.type&&v(a,z.ta);break;case 6:h=a.d.g;e=a.d.quat;d=b.target;g(h,e,d,b.xg);e=J.dist(h,d);if(b=e>b.nj?e-b.nj:e<b.xg?e-b.xg:0)J.sub(d,h,n),J.normalize(n,
n),J.scale(n,b,n),J.add(h,n,h);"CAMERA"==a.d.type&&v(a,z.ta);break;case 7:f=b.W.d.R;J.transformMat4(b.offset,f,a.d.g);break;case 8:E=b.W.d.g;h=a.d.g;J.add(E,b.offset,h);break;case 13:e=a.d.quat;f=b.W.d.R;d=b.W.d.quat;b.df?(D.copy(b.df,e),D.multiply(d,e,e)):D.copy(d,e);J.transformMat4(b.offset,f,a.d.g);break;case 11:d=b.W.d,d=t.nh(d.g,d.scale,d.quat,B),t.multiply(d,b.ix,d),h=a.d.g,h[0]=d[0],h[1]=d[1],h[2]=d[2],a.d.scale=d[3],e=a.d.quat,e[0]=d[4],e[1]=d[5],e[2]=d[6],e[3]=d[7]}}function p(a,b,c){var d=
n;z.ka(b,z.$b,d);J.normalize(d,d);var e=l;J.subtract(c,a,e);J.normalize(e,e);a=M;z.cw(d,e,a);D.multiply(a,b,b)}function g(a,b,c,d){var e=n;z.ka(b,z.$b,e);J.normalize(e,e);var k=l;J.subtract(c,a,k);a=J.length(k);J.normalize(k,k);a>d-.001&&(d=z.cw(e,k,M),D.multiply(d,b,b),D.normalize(b,b))}function v(a,b){var d=a.d,e=d.quat,f=z.ka(d.quat,z.ta,n);J.normalize(f,f);if(.999999<Math.abs(J.dot(b,f)))f=D.identity(I);else{var k=J.cross(b,f,l);J.normalize(k,k);d.ga==C.qa?d.hm&&(k[0]*=-1,k[1]*=-1,k[2]*=-1):0<
z.ka(d.quat,z.nd,c)[1]&&(k[0]*=-1,k[1]*=-1,k[2]*=-1);d=z.ka(d.quat,z.Ee,c);J.normalize(d,d);var g=z.ra(J.dot(d,k),-1,1),h=Math.acos(g),f=-.999999>=g?D.setAxisAngle(f,h,I):D.rotationTo(d,k,I);D.normalize(f,f)}D.multiply(f,e,e)}function m(a,b,c,d,e){var k=a.d,g=k.Wf,l=k.Lc[b];b=l.Ki;a=a.pose.bones[l.mp];var l=a.jr,n=M,h=k.Hc,m=k.Gc,p=k.zc,v=k.yc,q=h[4*b+1],y=h[4*b+2],z=h[4*b+3],C=m[4*b+1],K=m[4*b+2],w=m[4*b+3];n[0]=(1-g)*h[4*b]+g*m[4*b];n[1]=(1-g)*q+g*C;n[2]=(1-g)*y+g*K;n[3]=(1-g)*z+g*w;h=I;m=x;h[0]=
p[4*b];h[1]=p[4*b+1];h[2]=p[4*b+2];h[3]=p[4*b+3];m[0]=v[4*b];m[1]=v[4*b+1];m[2]=v[4*b+2];m[3]=v[4*b+3];D.slerp(h,m,g,h);g=B;t.fF(n,g);t.Ip(h,g);c?(c=E,t.translate(l,a.kz,c),t.multiply(g,c,g)):t.multiply(g,l,g);t.multiply(k.Be,g,g);d[0]=g[0];d[1]=g[1];d[2]=g[2];d[3]=g[3];e&&(e[0]=g[4],e[1]=g[5],e[2]=g[6],e[3]=g[7])}var t=w("__tsr"),z=w("__util"),C=w("__camera"),J=w("vec3"),D=w("quat"),y=w("mat3");w("mat4");a.QG=1;a.PG=2;a.TG=3;a.UG=4;a.KG=5;a.LG=6;a.RG=7;a.JG=8;a.OG=9;a.NG=10;a.Rd=11;a.MG=12;a.SG=
13;var n=new Float32Array(3),l=new Float32Array(3),c=new Float32Array(3),M=new Float32Array(4),I=new Float32Array(4),x=new Float32Array(4),B=new Float32Array(16),E=new Float32Array(16),K=new Float32Array(9),k=new Float32Array(9),B=new Float32Array(8);a.Kx=9*Math.PI/10;a.tr=function(a,c,d,k,f){var g=e(1);g.W=c;g.offset=new Float32Array(d);g.df=k?new Float32Array(k):null;g.Sl=f;b(a,g);h(a,g,0)};a.sr=function(a,c,d,g,f,k){var l=e(2);l.W=c;l.Yz=d;l.offset=new Float32Array(g);l.df=f?new Float32Array(f):
null;l.Sl=k;b(a,l);h(a,l,0)};a.xz=function(a,c,d,g){var f=e(9),k=a.d.quat,l=c.d.quat;f.W=c;f.offset=new Float32Array(d);f.Cg=new Float32Array(l);g&&(D.copy(g,k),D.multiply(l,k,k));b(a,f);h(a,f,0)};a.wz=function(a,c,d,g,f,k,l,n){var m=e(10),p=a.d.quat,v=c.d.quat;m.W=c;m.offset=new Float32Array(d);m.Cg=new Float32Array(v);m.ds=f;m.fs=k;m.gs=l;m.cs=n;g&&(D.copy(g,p),D.multiply(v,p,p));b(a,m);h(a,m,0)};a.vz=function(a,c,d,g){var f=e(12);f.W=c;f.offset=new Float32Array(d);f.qF=g;b(a,f);h(a,f,0)};a.Az=
function(a,c,d,g){var f=e(13);f.W=c;f.offset=new Float32Array(d);f.Sl=1;f.df=g?new Float32Array(g):null;b(a,f);h(a,f,0)};a.yI=q;a.PL=d;a.Cz=function(a,c){var d=e(3);d.W=c;b(a,d);h(a,d,0)};a.Dz=function(a,c){var d=e(4);d.target=new Float32Array(c);b(a,d);h(a,d,0)};a.sz=function(a,c,d,g){var f=e(5);f.W=c;f.xg=d;f.nj=g;b(a,f);h(a,f,0)};a.tz=function(a,c,d,g){var f=e(6);f.target=new Float32Array(c);f.xg=d;f.nj=g;b(a,f);h(a,f,0)};a.zz=function(a,c){var d=e(7);d.W=c;d.offset=new Float32Array([0,.5,0]);
b(a,d);h(a,d,0)};a.rz=function(a,c,d){var g=e(8);g.W=c;g.offset=new Float32Array(d);b(a,g);h(a,g,0)};a.qz=function(a,c,d){var g=e(11);g.W=c;g.ix=new Float32Array(d);b(a,g);h(a,g,0)};a.eG=function(a,b){a.ib&&h(a,a.ib,b)};a.GE=p;a.HE=g;a.Ek=v;a.remove=function(a){a.ib.W&&d(a.ib.W,a);a.ib=null};a.le=function(a){return a.ib?a.ib.type:null};a.yK=function(a){return a.ib&&a.ib.W?a.ib.W:null};a.ie=function(a){return a.ib&&11==a.ib.type?a.ib.ix:null};a.pC=m};b4w.module.__curve=function(a,w){function e(a,b,d,e,m){var t=e.length;m||(m=new Float32Array(t));for(var q=t+a,C=new Float32Array(q),w=1;w<=q-1;w++)C[w-1]=b>=d[w-1]&&b<d[w+1-1]?1:0;for(var D=2;D<=a;D++)for(w=1;w<=q-D;w++)C[w-1]=(0!=C[w-1]?(b-d[w-1])*C[w-1]/(d[w+D-1-1]-d[w-1]):0)+(0!=C[w+1-1]?(d[w+D-1]-b)*C[w+1-1]/(d[w+D-1]-d[w+1-1]):0);b==d[q-1]&&(C[t-1]=1);a=0;for(w=1;w<=t;w++)a+=C[w-1]*e[w-1];for(w=1;w<=t;w++)m[w-1]=0!=a?C[w-1]*e[w-1]/a:0;return m}function b(a){a=a.rl;return a[a.length-1]}function q(a){a=
a.Js;return a[a.length-1]}var d=w("__util");a.$A=function(a){var b={},d=a.data;a=d.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var v=a.order_u;b.af=v;a=a.points;var m=a.length/5,t=[],q=m+v,m=m+2;t[0]=0;for(var C=2;C<=q;C++)t[C-1]=C>v&&C<m?t[C-2]+1:t[C-2];b.rl=t;if("2D"==d.dimensions)b.Ue=!1;else if("3D"==d.dimensions)b.Ue=!0;else throw"Wrong curve dimensions";v=[];t=[];for(d=0;d<a.length;d+=5)v.push(a[d]),v.push(a[d+1]),v.push(a[d+2]),b.Ue&&v.push(a[d+3]),t.push(a[d+4]);b.vn=
v;b.xq=t;a=[];for(var d=b.vn,v=b.Ue?4:3,t=b.xq,q=b.rl,m=b.af,C=d.length/v,w=C+m,D=0,y=q[w-1]/999,n=0;1E3>n;n++){5E-6>q[w-1]-D&&(D=q[w-1]);for(var l=e(m,D,q,t),c=0;c<v;c++)for(var M=a[v*n+c]=0;M<C;M++)a[v*n+c]+=l[M]*d[v*M+c];D+=y}v=b.Ue?4:3;t=new Float32Array(1E3);t[0]=0;for(d=1;1E3>d;d+=1)q=a[(d-1)*v],m=a[(d-1)*v+1],C=a[(d-1)*v+2],w=a[d*v],D=a[d*v+1],y=a[d*v+2],t[d]=t[d-1]+Math.sqrt((w-q)*(w-q)+(D-m)*(D-m)+(y-C)*(y-C));b.Js=t;return b};a.EF=function(a,d,g){g||(g=[]);var v=d,m=Math.max(v,0);d=m=Math.min(v,
b(a));var v=a.vn,m=a.Ue?4:3,t=a.xq,q=a.rl,C=a.af;a=v.length/m;var w=a+C;5E-6>q[w-1]-d&&(d=q[w-1]);w=new Float32Array(a);e(C,d,q,t,w);for(d=0;d<m;d++)for(t=g[d]=0;t<a;t++)g[d]+=w[t]*v[m*t+d]};a.BF=function(a,b,d){d||(d=[]);var e=a.vn,m=a.Ue?4:3,t=a.xq,q=a.rl,C=a.af;a=e.length/m;var w=a+C;5E-6>q[w-1]-b&&(b=q[w-1]);var w=new Float32Array(a),D=b;b=w;var y=t.length;b||(b=new Float32Array(y));var n=new Float32Array(y),l=new Float32Array(y),c=n,M=l;c||(c=new Float32Array(y));M||(M=new Float32Array(y));for(var I=
y+C,x=new Float32Array(I),B=new Float32Array(I),E=1;E<=I-1;E++)x[E-1]=D>=q[E-1]&&D<q[E+1-1]?1:0;D==q[I-1]&&(x[y-1]=1);for(var K=2;K<=C;K++)for(E=1;E<=I-K;E++){var k=0!=x[E-1]?x[E-1]/(q[E+K-1-1]-q[E-1]):0,u=0!=x[E+1-1]?-x[E+1-1]/(q[E+K-1]-q[E+1-1]):0,r=0!=B[E-1]?(D-q[E-1])*B[E-1]/(q[E+K-1-1]-q[E-1]):0,L=0!=B[E+1-1]?(q[E+K-1]-D)*B[E+1-1]/(q[E+K-1]-q[E+1-1]):0;x[E-1]=(0!=x[E-1]?(D-q[E-1])*x[E-1]/(q[E+K-1-1]-q[E-1]):0)+(0!=x[E+1-1]?(q[E+K-1]-D)*x[E+1-1]/(q[E+K-1]-q[E+1-1]):0);B[E-1]=k+u+r+L}for(E=1;E<=
y;E++)c[E-1]=x[E-1],M[E-1]=B[E-1];q=0;for(C=1;C<=y;C++)q+=n[C-1]*t[C-1];D=0;for(C=1;C<=y;C++)D+=l[C-1]*t[C-1];for(C=1;C<=y;C++)b[C-1]=0!=q?l[C-1]*t[C-1]/q+n[C-1]*t[C-1]*D/(q*q):0;for(t=0;t<m;t++)for(q=d[t]=0;q<a;q++)d[t]+=w[q]*e[m*q+t]};a.NM=b;a.DF=q;a.CF=function(a,e){if(0>=e)return 0;var g=b(a);if(e>=q(a))return g;var v=a.Js,m=d.qk(v,e,0,v.length-1);return g*(m+(e-v[m])/(v[m+1]-v[m]))/1E3}};b4w.module.__lights=function(a,w){function e(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),hh:new Float32Array(3),ye:0,ai:0,gC:!1,vB:!1,Kg:!0,uf:!0,Qi:1,distance:25,FJ:"INVERSE_SQUARE"}}function b(a){a.hh[0]=a.color[0]*a.Qi;a.hh[1]=a.color[1]*a.Qi;a.hh[2]=a.color[2]*a.Qi}var q=w("__util"),d=w("vec3");a.WK=e;a.wD=function(a){var p=a.data,g=e(p.type);g.name=a.name;g.Kg=p.use_diffuse;g.uf=p.use_specular;var v=q.ka(a.d.quat,q.ta,[]);d.normalize(v,v);g.direction[0]=
v[0];g.direction[1]=v[1];g.direction[2]=v[2];g.color[0]=p.color[0];g.color[1]=p.color[1];g.color[2]=p.color[2];g.Qi=p.energy;b(g);g.distance=p.distance;if("POINT"===g.type||"SPOT"===g.type)g.distance=p.distance;"SPOT"===g.type&&(g.ye=p.spot_size,g.ai=p.spot_blend);g.gC=p.b4w_generate_shadows;g.vB=p.b4w_dynamic_intensity;a.Ya=g};a.jM=function(a,d){a.color[0]=d[0];a.color[1]=d[1];a.color[2]=d[2];b(a)};a.mM=function(a,b){a.ai=b};a.kM=function(a,b){a.distance=b};a.nM=function(a,b){a.ye=b};a.lM=function(a,
d){a.Qi=d;b(a)};a.fL=function(a){return"LAMP"===a.type?!0:!1};a.iG=function(a){if("LAMP"!=a.type)throw"Wrong light object";var b=a.Ya;b&&q.ka(a.d.quat,q.ta,b.direction)}};b4w.module.__nla=function(a,w){function e(){return{type:"CLIP",V:0,ia:0,ve:!1,paused:!1,Bi:"",Yc:0,lr:0,mz:0,Ys:0,Xs:0,hi:!1}}function b(a,b){for(var c=a.b4w_nla_script,d=b.ef,e=0;e<c.length;e++){var g=c[e];switch(g.type){case "PLAY":d.push({type:"PLAY",V:g.frame_range[0],ia:g.frame_range[1],Te:!1});break;case "SELECT":case "SELECT_PLAY":var l=D.ag(D.Tg,g.object,0),n=D.LC(a),f=n.indexOf(l);if(-1==f){J.error("NLA script error: non-selectable object");return}for(var g={type:g.type,Kw:"SELECT"==g.type?
g.target_slot:e+1,pF:e+1,ff:-1,OE:n.length,NE:f,V:g.frame_range[0],ia:g.frame_range[1],Te:!1},f=[],m=0;m<n.length;m++)f.push(z.An(n[m],!0));z.L(l,"NLA_SELECT_"+e,z.pd,f,z.kB,function(a,c,d,e){if(!(b.Eb>=b.ef.length)&&(d=b.ef[b.Eb],"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.Te)){for(d=0;d<e.OE;d++)if(z.Nb(a,c,d)&&d==e.NE){e.ff=1;return}e.ff=0}},g);d.push(g);break;case "JUMP":d.push({type:"JUMP",Rp:g.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",Rp:g.target_slot,xA:g.condition,Aj:g.register1,
Bj:g.register2,dp:g.number1,ep:g.number2});break;case "REGSTORE":d.push({type:"REGSTORE",rE:g.registerd,WD:g.number1});break;case "MATH":d.push({type:"MATH",YD:g.operation,Aj:g.register1,Bj:g.register2,dp:g.number1,ep:g.number2,Ph:g.registerd});break;case "SHOW":case "HIDE":l=D.ag(D.Tg,g.object,0);d.push({type:g.type,hc:l});break;case "REDIRECT":d.push({type:"REDIRECT",url:g.url});break;case "PAGEPARAM":d.push({type:"PAGEPARAM",ZD:g.param_name,Ph:g.registerd});break;case "NOOP":d.push({type:"NOOP"})}}}
function q(a,b,e,g){if(a.ef.length){if(a.Eb>=a.ef.length)if(a.Mc)a.Eb=0;else{a.Ha-=c.La*e;return}var l=h(a,b,g,!1),r=a.ef[a.Eb];switch(r.type){case "PLAY":r.Te?l>=r.ia&&(r.Te=!1,a.Eb++,q(a,b,e,g)):(a.Ha+=r.V-l,r.Te=!0,d(a,r));break;case "SELECT":case "SELECT_PLAY":-1<r.ff?"SELECT"==r.type||"SELECT_PLAY"==r.type&&0==r.ff?(a.Eb=r.ff?r.Kw:r.pF,r.ff=-1,q(a,b,e,g)):r.Te?l>=r.ia&&(r.Te=!1,a.Eb=r.Kw,r.ff=-1,q(a,b,e,g)):(a.Ha+=r.V-l,r.Te=!0,d(a,r)):a.Ha-=c.La*e;break;case "JUMP":a.Eb=r.Rp;q(a,b,e,g);break;
case "CONDJUMP":var l=-1==r.Aj?r.dp:a.Cd[r.Aj],m=-1==r.Bj?r.ep:a.Cd[r.Bj],p=!1;switch(r.xA){case "EQUAL":l==m&&(p=!0);break;case "NOTEQUAL":l!=m&&(p=!0);break;case "LESS":l<m&&(p=!0);break;case "GREATER":l>m&&(p=!0);break;case "LEQUAL":l<=m&&(p=!0);break;case "GEQUAL":l>=m&&(p=!0)}p?a.Eb=r.Rp:a.Eb++;q(a,b,e,g);break;case "REGSTORE":a.Cd[r.rE]=r.WD;a.Eb++;q(a,b,e,g);break;case "MATH":l=-1==r.Aj?r.dp:a.Cd[r.Aj];m=-1==r.Bj?r.ep:a.Cd[r.Bj];switch(r.YD){case "ADD":a.Cd[r.Ph]=l+m;break;case "MUL":a.Cd[r.Ph]=
l*m;break;case "SUB":a.Cd[r.Ph]=l-m;break;case "DIV":0==m&&n.sa("Division by zero in NLA script"),a.Cd[r.Ph]=l/m}a.Eb++;q(a,b,e,g);break;case "SHOW":D.Np(r.hc);a.Eb++;q(a,b,e,g);break;case "HIDE":D.aj(r.hc);a.Eb++;q(a,b,e,g);break;case "REDIRECT":window.location.href=r.url;a.ef.length=0;break;case "PAGEPARAM":a:{l=location.href.toString();if(-1!=l.indexOf("?"))for(l=l.split("?")[1].split("&"),m=0;m<l.length;m++)if(p=l[m].split("="),1<p.length&&p[0]==r.ZD){l=Number(p[1]);break a}l=0}a.Cd[r.Ph]=l;a.Eb++;
q(a,b,e,g);break;case "NOOP":a.Eb++,q(a,b,e,g)}}}function d(a,b){for(var c=a.ef,d=0;d<c.length;d++){var e=c[d];e!=b&&(e.ff=-1)}}function h(a,b,d,e){b=(b-d)*c.La+a.Ha-a.V;a.Mc&&e&&(b%=a.ia-a.V+1);return b+=a.V}function p(a,b){b?l.$D(a.name):(l.CE(a.name),l.dE(a.name))}function g(a,b){for(var c=[],d=0;d<a.length;d++){var g=a[d].strips;if(g)for(var l=0;l<g.length;l++){var n=g[l],m=e();m.type=n.type;m.V=n.frame_start;m.ia=n.frame_end;m.Bi=n.action?n.action.name:"";m.Yc=b;m.lr=n.action_frame_start;m.mz=
n.action_frame_end;c.push(m)}}return c}function v(a){return y.pe(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}var m=w("__animation"),t=w("__camera"),z=w("__controls"),C=w("__config");w("__loader");w("__particles");var J=w("__print"),D=w("__scenes"),y=w("__sfx"),n=w("__util"),l=w("__textures"),c=C.Wd,M=C.p,I=[],x=-1;a.lG=function(a,c){var d={V:a.frame_start,ia:a.frame_end,Ha:0,hj:-1,Mc:c,wc:[],X:[],ef:[],Eb:0,Cd:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};b(a,d);for(var k=
D.zb(a,"ALL",D.O),l=0;l<k.length;l++){var r=k[l],h=0,p=[],f=r.animation_data;f&&f.nla_tracks.length&&(f=f.nla_tracks,n.gg(r)||t.Ve(r)||n.ec(r)||n.nD(r)||y.pe(r))&&(f=g(f,h),f.length&&(p=p.concat(f),h++));v(r)&&(f=r.data.animation_data.nla_tracks,f=g(f,h),f.length&&(p=p.concat(f),h++));if(m.qu(r))for(var q=r.data.materials,x=0;x<q.length;x++){var z=q[x].node_tree,f=z.animation_data;z&&f&&(f=f.nla_tracks,f=g(f,h),f.length&&(p=p.concat(f),h++))}for(x=0;x<r.particle_systems.length;x++)f=r.particle_systems[x],
q=f.settings,"EMITTER"==q.type&&q.b4w_allow_nla&&(q=e(),q.type="CLIP",q.V=d.V,q.ia=d.ia+1,q.Bi=f.name,q.Yc=h,p.push(q),h++);f=h+1;if(n.ec(r)&&r.data)for(x=0;x<r.data.b4w_vertex_anim.length;x++)z=r.data.b4w_vertex_anim[x],z.allow_nla&&(h=f,q=e(),q.type="CLIP",q.V=d.V,q.ia=d.ia+1,q.Bi=z.name,q.Yc=h,p.push(q));p.length&&(r.Im=p,d.wc.push(r))}k=a.d.si;for(x=0;x<k.length;x++)if(l=k[x].d,l.hb||l.Rh)q=e(),q.type="VIDEO",r=1,M.jd&&(r=l.bc),q.V=Math.min(l.V*r,d.ia),q.ia=l.Jg?d.ia:Math.min((l.th+l.V+l.Ha)*
r,d.ia),q.Bi=k[x].name,l.hz=q,d.X.push(l);x=d.V;k=d.ia;for(l=0;l<d.wc.length;l++)for(r=d.wc[l],h=r.Im,p=0;p<h.length;p++)q=h[p],f=r.name+" ["+q.V+":"+q.ia+"]",q.V=Math.max(x,q.V),q.ia=Math.min(k+1,q.ia),q.V>q.ia&&(J.warn("NLA: out of scene range: "+f),h.splice(p,1),p--);for(x=0;x<d.wc.length;x++)for(k=d.wc[x].Im,l=0;l<k.length;l++){r=k[l];h=d.V;p=d.ia+1;for(q=0;q<k.length;q++)f=k[q],r.Yc==f.Yc&&(f.ia<=r.V&&(h=r.V),f.V>=r.ia&&(p=Math.min(p,f.V)));r.Ys=h;r.Xs=p}I.push(d)};a.start=function(){x=0};a.update=
function(a,b){if(!(0>x)){0==x&&(x=a);for(var d=0;d<I.length;d++){var e=I[d];q(e,a,b,x);for(var g=h(e,a,x,!0),l=0;l<e.wc.length;l++){for(var n=e.wc[l],v=n.Im,f=0;f<v.length;f++){var t=v[f];"SOUND"==t.type&&g<e.hj-1E-6&&(t.ve=!1)}for(f=0;f<v.length;f++)switch(t=v[f],t.type){case "CLIP":if(t.Ys<=g&&g<t.Xs&&!t.ve){var z=n,C=t;m.apply(z,C.Bi,C.Yc);m.Ul(z,m.ym,C.Yc);for(z=0;z<v.length;z++)v[z]!=t&&v[z].Yc==t.Yc&&(v[z].ve=!1);t.ve=!0}if(t.ve){var z=n,C=g-t.V+t.lr,D=m.fo(z,t.Yc);1E-6<Math.abs(C-D)&&m.Fp(z,
C,t.Yc)}break;case "SOUND":(g<e.hj-1E-6||e.hj<t.V)&&t.V<=g&&g<t.ia&&!t.ve&&(y.play(n,(t.V-g)/c.La,(t.ia-t.V)/c.La),t.ve=!0),e.hj<t.ia&&t.ia<=g&&t.ve&&(t.ve=!1)}}for(l=0;l<e.X.length;l++)t=e.X[l].hz,t.V<=Math.round(g)&&Math.round(g)<t.ia&&!t.hi&&(p(e.X[l],t.hi),t.hi=!0),t.ia<=Math.round(g)&&t.hi&&(p(e.X[l],t.hi),t.hi=!1);e.hj=g}}};a.Y=function(){I.length=0;x=-1};a.tu=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||v(a)||m.qu(a)?!0:!1}};b4w.module.__controls=function(a,w){function e(a){return{type:a,value:0,da:null,Ro:null,Qo:null,tl:null,ad:!1,key:0,pc:"",rn:null,$o:!1,qn:function(){},pn:null,ms:function(){},Id:null,Wp:new Float32Array(3),Rn:new Float32Array(3),Po:!1,Rv:function(){},axis:"",Fc:0,oi:new Float32Array(3),Nl:new Float32Array(4),threshold:0,Mv:new Float32Array(4),nk:0,mk:0,bw:0,ok:0,Sc:0,repeat:!1,Ir:!1,il:0,hl:0,gl:0,ro:0,qo:0,po:0}}function b(a,b){var c;if(a.tl){c=a.Ro;for(var d=a.Qo,e=0;e<c.length;e++)d[e]=c[e].value;
c=a.tl(d)}else c=!1;c||(a.value=Number(b))}function q(a){a=u.indexOf(a);-1<a?u.splice(a,1):l.error("Wrong object")}function d(a,b){for(var c=0,d=0;d<b.length;d++)for(var e=b[d].Fe,f=0;f<e.length;f++)for(var g=e[f].Ed,k=0;k<g.length;k++)g[k]===a&&c++;return c}function h(a,b){switch(a.type){case 80:c.xp(a.rn,a.pc,a.qn);a.ad=!0;break;case 90:c.nn(a.pn);a.ad=!0;break;case 100:c.yp(a.Id,a.pc,a.Wp,a.Rn,a.Po);a.ad=!0;break;case 130:a.ad=!0}var d=b.indexOf(a);-1<d&&b.splice(d,1)}function p(a){for(var c=0;c<
r.length;c++){var d=r[c];20==d.type&&a.keyCode==d.key&&b(d,1)}ca&&a.preventDefault();ha&&ha(a)}function g(a){for(var c=0;c<r.length;c++){var d=r[c];20==d.type&&0==a.keyCode&&16==d.key&&b(d,0);20==d.type&&a.keyCode==d.key&&b(d,0)}ca&&a.preventDefault();ha&&ha(a)}function v(a){var c=!1,d=null;f=a.clientX;N=a.clientY;for(var e=0;e<r.length;e++){var g=r[e];50==g.type&&(b(g,1),g.da=a.which);160==g.type&&(c||(d=M.Ll(a.clientX,a.clientY),c=!0),g.value=d==g.Id?1:0)}Z&&a.preventDefault();pa&&pa(a)}function m(a){for(var c=
0;c<r.length;c++){var d=r[c];50==d.type&&b(d,0);160==d.type&&d.Ir&&(d.value=0)}Z&&!ma&&a.preventDefault();pa&&pa(a)}function t(a){var c=a.clientX,d=a.clientY;f=c;N=d;for(var e=c-P,g=d-V,k=Math.sqrt(e*e+g*g),l=0;l<r.length;l++){var n=r[l];if(40===n.type)switch(n.axis){case "X":b(n,e);n.da=c;break;case "Y":b(n,g);n.da=d;break;case "XY":b(n,k),n.da[0]=c,n.da[1]=d}}Z&&!ma&&a.preventDefault();pa&&pa(a)}function z(a){var c=a.wheelDelta||-40*a.detail,c=c*K.OD;F+=c;for(c=0;c<r.length;c++){var d=r[c];30===
d.type&&b(d,F)}oa&&a.preventDefault();H&&H(a)}function C(a){var b=a.targetTouches;if(1==b.length){for(var c=b[0],b=c.pageX,c=c.pageY,d=!1,e=null,f=0;f<r.length;f++){var g=r[f];160==g.type&&(d||(e=M.Ll(b,c),d=!0),g.value=e==g.Id)}U[0]=b;U[1]=-1;X[0]=c;X[1]=-1}else 1<b.length&&(A=ka=y(b),U[0]=b[0].pageX,U[1]=b[1].pageX,X[0]=b[0].pageY,X[1]=b[1].pageY);R.set(U);ea.set(X);aa&&aa(a)}function J(c){var d=c.targetTouches;if(0!==d.length){if(1===d.length){R[0]=d[0].pageX;R[1]=-1;ea[0]=d[0].pageY;ea[1]=-1;
var d=R[0]-U[0],e=ea[0]-X[0],f=Math.sqrt(d*d+e*e);if(-1!=U[1]&&-1!=X[1]){var g=R[0]-U[1],k=ea[0]-X[1],l=Math.sqrt(g*g+k*k);l<f&&(d=g,e=k,f=l)}for(l=0;l<r.length;l++){var n=r[l];if(60===n.type)switch(n.da=a.dk,n.axis){case "X":b(n,d);break;case "Y":b(n,e);break;case "XY":b(n,f)}}}else if(1<d.length){R[0]=d[0].pageX;R[1]=d[1].pageX;ea[0]=d[0].pageY;ea[1]=d[1].pageY;A=y(d);f=A-ka;g=Q;g[0]=(R[0]+R[1])/2;g[1]=(ea[0]+ea[1])/2;k=S;k[0]=(U[0]+U[1])/2;k[1]=(X[0]+X[1])/2;var m,d=g[0],e=g[1],l=k[0],n=k[1];m=
Math.sqrt((d-l)*(d-l)+(e-n)*(e-n));for(l=0;l<r.length;l++)if(n=r[l],70===n.type&&Math.abs(m)<Math.abs(f)&&(n.da=a.ck,b(n,f)),60===n.type&&Math.abs(m)>Math.abs(f))switch(n.da=a.bk,n.axis){case "X":d=g[0]-k[0];b(n,d);break;case "Y":e=g[1]-k[1];b(n,e);break;case "XY":b(n,m)}}la&&c.preventDefault();aa&&aa(c)}}function D(a){for(var c=0;c<r.length;c++){var d=r[c];if(170==d.type||180==d.type)d.hl=a.beta,d.il=a.gamma,d.gl=a.alpha,d.value||(d.ro=a.gamma,d.qo=a.beta,d.po=a.alpha,b(d,1))}}function y(a){var b=
a[0],c=a[1];a=b.pageX;var b=b.pageY,d=c.pageX,c=c.pageY;return Math.sqrt((a-d)*(a-d)+(b-c)*(b-c))}var n=w("__config"),l=w("__print"),c=w("__physics"),M=w("__scenes"),I=w("__time"),x=w("__util"),B=w("vec3"),E=w("quat"),K=n.controls,k=n.p,u=[],r=[],L={},F=0,f=0,N=0,P=0,V=0,R=new Float32Array(2),ea=new Float32Array(2),U=new Float32Array(2),X=new Float32Array(2),Q=new Float32Array(2),S=new Float32Array(2),A=0,ka=0,fa=!1,da=0,ca=!1,Z=!1,oa=!1,la=!1,ma=!1,ha=null,pa=null,H=null,aa=null;a.ba=10;a.Bm=20;
a.pd=30;a.od=40;a.dk=0;a.ck=1;a.bk=2;a.update=function(c,d){for(var e=0;e<r.length;e++){var g=r[e],k=c,l=d;if(l)switch(g.type){case 110:var n=g.Id,m=n.d.g,n=n.d.quat,h=B.dist(g.oi,m),p=g.Mv;E.invert(g.Nl,p);E.multiply(n,p,p);E.normalize(p,p);p=Math.abs(2*Math.acos(p[3]));h/=l;g.nk=x.Ib(h,g.nk,l,.3);g.da[0]=h;h=p/l;g.mk=x.Ib(h,g.mk,l,.3);g.da[1]=h;g.nk>=g.threshold||g.mk>=g.bw?b(g,1):b(g,0);B.copy(m,g.oi);E.copy(n,g.Nl);g.Fc=k;break;case 120:n=g.Id;m=n.d.g;n=Math.abs(m[1]-g.oi[1])/l;g.ok=x.Ib(n,g.ok,
l,.3);g.da=n;g.ok>=g.threshold?b(g,1):b(g,0);B.copy(m,g.oi);g.Fc=k;break;case 130:!g.ad&&0<=g.Sc&&k-g.Fc>=g.Sc&&(b(g,1),g.repeat?g.Fc=k:g.Sc=-g.Sc);break;case 140:g.Fc||(g.Fc=k);b(g,k-g.Fc);g.Fc=k;break;case 150:b(g,k);break;case 170:g.da[0]=Math.PI*(g.il-g.ro)/180;g.da[1]=Math.PI*(g.hl-g.qo)/180;g.da[2]=Math.PI*(g.gl-g.po)/180;g.ro=g.il;g.qo=g.hl;g.po=g.gl;break;case 180:g.da[0]=Math.PI*g.il/180,g.da[1]=Math.PI*g.hl/180,g.da[2]=Math.PI*g.gl/180}}for(e=0;e<u.length;e++)for(l=u[e],g=l.Fe,k=0;k<g.length;k++)if(m=
g[k],m.nx!=da){m.nx=da;for(var n=m,h=n.Ed,p=n.QE,v=0;v<h.length;v++)p[v]=h[v].value;var n=n.AD(p),h=m,p=h.Ru,q=v=void 0;switch(h.type){case a.ba:n?q=v=1:1==p?q=v=-1:v=0;break;case a.Bm:n&&-1==p?q=v=1:n||1!=p?v=0:q=v=-1;break;case a.pd:n&&-1==p?q=v=1:n||1!=p?v=0:(v=0,q=-1);break;case a.od:v=h.Qu!=n?1:0;break;default:x.sa("Wrong sensor manifold type: "+h.type)}q&&(h.Ru=q);if(h=v)if(p=l==L?null:l,fa=!1,m.callback(p,m.id,h,m.dA),m.Qu=n,fa){e=-1;break}}for(e=0;e<u.length;e++)for(l=u[e],g=l.Fe,k=0;k<g.length;k++)for(m=
g[k],l=m.Ed,m=0;m<l.length;m++)switch(n=l[m],n.type){case 30:b(n,0);break;case 40:b(n,0);break;case 60:b(n,0);break;case 70:b(n,0);break;case 130:b(n,0)}F=0;P=f;V=N;U.set(R);X.set(ea);ka=A;da++};a.ys=function(a){var c=e(10);b(c,a);return c};a.Qa=function(a){var b=e(20);b.key=a;return b};a.yn=function(a,c,d){if(!a||!a.l)return l.error("Wrong collision object"),null;var f=e(80);f.rn=a;f.pc=c||"ANY";f.$o=d;f.qn=function(a,c){b(f,a);a&&c&&d&&(f.da=f.da||new Float32Array(3),f.da[0]=c[0],f.da[1]=c[1],f.da[2]=
c[2])};f.ad=!0;return f};a.xs=function(a){if(!a||!a.l)return l.error("Wrong collision impulse object"),null;var c=e(90);c.pn=a;c.ms=function(a){b(c,a)};c.ad=!0;return c};a.Ds=function(a,c,d,f,g){if(!a)return l.error("Wrong collision object"),null;var k=e(100);k.Id=a;k.Wp=c;k.Rn=d;k.Po=f;k.pc=g||"ANY";k.Rv=function(a,c){b(k,a);a&&(k.da=c)};k.ad=!0;return k};a.Fk=function(){return e(50)};a.zn=function(){return e(30)};a.mh=function(a){var b=e(40);b.axis=a||"XY";b.da="XY"==b.axis?new Float32Array(2):
0;return b};a.Gi=function(a){var b=e(60);b.axis=a||"XY";b.da=0;return b};a.Ik=function(){var a=e(70);a.da=0;return a};a.Bs=function(a,b,c){if(!a)return l.error("Wrong collision object"),null;var d=e(110);d.Id=a;var f=a.d.g;a=a.d.quat;d.Mv=new Float32Array(4);d.oi=new Float32Array(f);d.Nl=new Float32Array(a);d.nk=0;d.mk=0;d.threshold=b;d.bw=c;d.Fc=0;d.da=new Float32Array([0,0]);return d};a.Gs=function(a,b){if(!a)return l.error("Wrong collision object"),null;var c=e(120);c.Id=a;var d=a.d.quat;c.oi=
new Float32Array(a.d.g);c.Nl=new Float32Array(d);c.ok=0;c.threshold=b;c.Fc=0;c.da=0;return c};a.Fs=function(a,b){var c=e(130);c.Sc=a;c.repeat=b;c.ad=!0;return c};a.Yv=function(a,b,c,d){a=a||L;a=a.Xc;if(!a||!a[b])return l.error("reset_timer_sensor(): wrong object"),null;b=a[b].Ed[c];if(!b)return l.error("reset_timer_sensor(): sensor not found"),null;b.Fc=I.xh();b.Sc=d};a.kh=function(){var a=e(140);a.Fc=0;return a};a.As=function(){var a=e(170);a.da=new Float32Array(3);return a};a.zs=function(){var a=
e(180);a.da=new Float32Array(3);return a};a.Es=function(){return e(150)};a.An=function(a,b){var c=e(160);c.Id=a;c.Ir=b;return c};a.PE=b;a.Nb=function(a,b,c){a=a||L;a=a.Xc;if(!a||!a[b])return l.error("get_sensor_value(): wrong object"),null;b=a[b].Ed[c];return b?b.value:(l.error("get_sensor_value(): sensor not found"),null)};a.ke=function(a,b,c){a=a||L;a=a.Xc;if(!a||!a[b])return l.error("get_sensor_payload(): wrong object"),null;b=a[b].Ed[c];return b?b.da:(l.error("get_sensor_payload(): sensor not found"),
null)};a.Y=function(){u=[];r=[];L={}};a.gh=function(a,b){a=a||L;if(!a.Xc)return!1;if(b&&a.Xc[b])return!0;if(!b)for(var c in a.Xc)return!0;return!1};a.se=function(a,b){a=a||L;var c=a.Xc;if(c){var e=a.Fe;if(b){var f=c[b];if(f){for(var g=f.Ed,k=0;k<g.length;k++)1===d(g[k],u)&&h(g[k],r);delete c[b];f=e.indexOf(f);-1<f?e.splice(f,1):x.sa("Incorrect manifolds array");Object.getOwnPropertyNames(c).length||q(a)}}else{for(b in c){f=c[b];g=f.Ed;for(k=0;k<g.length;k++)1===d(g[k],u)&&h(g[k],r);delete c[b];f=
e.indexOf(f);-1<f?e.splice(f,1):x.sa("Incorrect manifolds array")}q(a);fa=!0}}};a.L=function(a,b,e,f,g,k,l){a=a||L;a.Xc=a.Xc||{};a.Fe=a.Fe||[];var n=a.Xc,m=a.Fe,p=n[b];if(p){f=p.Ed;for(var v=0;v<f.length;v++)1===d(f[v],u)&&h(f[v],r);p=m.indexOf(p);-1<p?m.splice(p,1):x.sa("Incorrect manifolds array")}e={id:b,type:e,Ed:f.slice(0),AD:g,QE:Array(f.length),callback:k,dA:l,Ru:-1,Qu:0,nx:-1};n[b]=e;m.push(e);-1==u.indexOf(a)&&u.push(a);a=e.Ed;for(b=0;b<a.length;b++){n=a[b];if(n.ad){switch(n.type){case 80:c.Pm(n.rn,
n.pc,n.qn,n.$o);break;case 90:c.Sm(n.pn,n.ms);break;case 100:c.Rm(n.Id,n.pc,n.Wp,n.Rn,n.Po,n.Rv);break;case 130:n.Fc=I.xh(),0>n.Sc&&(n.Sc=-n.Sc)}n.ad=!1}-1==r.indexOf(n)&&r.push(n)}fa=!0};a.Jn=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.kB=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<u.length;a++){var b=u[a],c=b.Xc,b=b.Fe,d;for(d in c)delete c[d];b.splice(0,b.length)}for(a=0;a<r.length;a++)h(r[a],
r),a--;u.splice(0,u.length)};a.debug=function(){l.log(String(u.length)+" objects with manifolds",u);l.log(String(r.length)+" sensors",r);for(var a=[],b=[],c=0;c<r.length;c++){var d=r[c];80==d.type&&a.push(d);100==d.type&&b.push(d)}l.log(String(a.length)+" collision sensors",a);l.log(String(b.length)+" ray sensors",b)};a.tp=function(a,b){a.addEventListener("keydown",p,!1);a.addEventListener("keyup",g,!1);ca=b};a.up=function(a,b,c){if(c)var d=window;else d=a,d.addEventListener("mouseout",m,!1);a.addEventListener("mousedown",
v,!1);d.addEventListener("mousemove",t,!1);d.addEventListener("mouseup",m,!1);Z=b;ma=c};a.wp=function(a,b){a.addEventListener("mousewheel",z,!1);a.addEventListener("DOMMouseScroll",z,!1);oa=b};a.vp=function(a,b){a.addEventListener("touchstart",C,!1);a.addEventListener("touchmove",J,!1);document.addEventListener("touchstart",function(){});la=b};a.Rl=function(){window.DeviceOrientationEvent&&k.jl&&window.addEventListener("deviceorientation",D,!1)};a.hq=function(a){a.removeEventListener("keydown",p,
!1);a.removeEventListener("keyup",g,!1)};a.iq=function(a){a.removeEventListener("mousedown",v,!1);a.removeEventListener("mousemove",t,!1);a.removeEventListener("mouseout",m,!1);a.removeEventListener("mouseup",m,!1)};a.kq=function(a){a.removeEventListener("mousewheel",z,!1);a.removeEventListener("DOMMouseScroll",z,!1)};a.jq=function(a){a.removeEventListener("touchstart",C,!1);a.removeEventListener("touchmove",J,!1);document.removeEventListener("touchstart",function(){})};a.lx=function(){window.DeviceOrientationEvent&&
k.jl&&window.removeEventListener("deviceorientation",D,!1)};a.wI=function(a){ha=a};a.xI=function(a){pa=a};a.AI=function(a){H=a};a.zI=function(a){aa=a}};b4w.module.__physics=function(a,w){function e(a,b){for(var c=a.Jc,d=0;d<c.length;d++)c[d].d.pm&&b.push(c[d]),e(c[d],b)}function b(a,b){if(ea)switch(a){case E.Tx:x.log(b);break;case E.Qx:x.error(b);break;case E.Rx:B.Rk.apply(this,b.slice(1));break;case E.Xx:var c=q(b.body_id);if(c){var d=b.trans,e=b.quat,f=b.linvel,g=b.angvel,c=c.l;c.Dn=b.time;u.Ij(d,1,e,c.En);F.copy(f,c.Uu);F.copy(g,c.or)}break;case E.Vx:(d=q(b.chassis_hull_body_id))&&u.Ij(b.trans,1,b.quat,d.i.xj[b.prop_ind]);break;case E.Sx:if(c=
q(b[1]))d=b[4],c=c.Kc.rk[b[2]],k.kd(c,b[3]),k.Fd(c,d),k.F(c);break;case E.Yx:if(c=q(b[1]))c.i.speed=b[2];break;case E.Ox:for(var d=b.body_id_a,c=b.body_id_b,e=b.result,f=b.coll_point,d=parseInt(d),g=ea.l.o,l=0;l<g.length;l++)for(var n=g[l].Bb,m=0;m<n.td.length;m++){for(var h=n.td[m],p=h.Fl,v=!1,t=0;t<p.length;t++){var y=p[t];if(y[0]===d&&y[1]===c){h.Bv[t]=e;v=!0;break}}if(v){p=h.Bv;for(t=v=0;t<p.length;t++)v=v||p[t];h.callback(v,f)}}break;case E.Px:if(c=q(b[1]))c=c.l,c.Bk&&c.Bk(b[2]);break;case E.Wx:if(c=
q(b.body_id))for(c=c.l,e=b.from,f=b.to,g=b.local,l=b.body_id_b_hit,n=b.cur_result,m=0;m<c.cf.length;m++)if(p=c.cf[m],r.Ak(p.M,e)&&r.Ak(p.ea,f)&&p.local==g){for(d in p.te)p.te[d]=1;-1!=l&&(p.te[l]=n);for(var h=p.pc,t=p.callback,p=p.te,v=!1,y=1,z=0;z<ea.l.o.length;z++){var C=ea.l.o[z].Bb;if(("ANY"==h||C.id==h)&&C.P in p&&1!==p[C.P]){v=!0;y=p[C.P];break}}t(v,y)}break;case E.Ux:console.log("Physics message ping: ",performance.now()-b[1]);break;default:x.error("Wrong message: "+a)}}function q(a){return X[a]||
null}function d(){Q.body++;return Q.body}function h(a){return{P:a,To:0,nl:!1,lf:!0,iL:!1,bj:!1,oD:!1,Dk:null,id:"",cJ:{},td:[],Bk:null,cf:[],Dn:0,En:new Float32Array([0,0,0,1,0,0,0,1]),Uu:new Float32Array(3),or:new Float32Array(3),vk:new Float32Array(3),uk:new Float32Array(4)}}function p(a,b){switch(a){case "BOX":var c=b.Ub;break;case "CYLINDER":c=b.$m;break;case "CONE":c=b.Zm;break;case "SPHERE":c=b.Zc;break;case "CAPSULE":c=b.Ym}return c}function g(a){if(!a)return null;var b={};"number"===typeof a.min_x&&
(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.C&&(b.center=a.C);"number"===typeof a.Ca&&(b.radius=a.Ca);"number"===typeof a.height&&(b.height=a.height);return b}function v(a,b,c,d){var e=a.d.g,f=b.d.R,g=new Float32Array(16);N.invert(f,g);f=new Float32Array(3);F.transformMat4(e,g,f);switch(b.i.type){case 10:b=
b.b4w_vehicle_settings;a=a.d.Ub;E.r(E.iy,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:E.r(E.hy,c,f,a.QM)}}function m(a){return a.l&&a.l.Dk?!0:!1}function t(a,b,c,d,e,f,g,k,l,n){var r;Q.ss++;r=Q.ss.toString(16);E.r(E.py,r,a,k,b.l.P,c,d,e.l.P,f,g,l,n);b.l.Dk=r}function z(a){var b=a.l;if(b&&(0===b.To||!0===b.nl||!1===b.lf||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.g[0]!=a.l.vk[0]||a.d.g[1]!=a.l.vk[1]||a.d.g[2]!=a.l.vk[2]||a.d.quat[0]!=a.l.uk[0]||a.d.quat[1]!=
a.l.uk[1]||a.d.quat[2]!=a.l.uk[2])){a.l.vk.set(a.d.g);a.l.uk.set(a.d.quat);var b=a.l,c=E.Kt(E.Vg);c.msg_id=E.Vg;c.body_id=a.l.P;c.trans=a.d.g;"DYNAMIC"===b.type?(c.quat=A,f.identity(A)):c.quat=a.d.quat;E.r(E.Vg,c)}a=a.Jc;for(b=0;b<a.length;b++)z(a[b])}function C(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.quat;e[0]=b;e[1]=c;e[2]=d;F.transformQuat(e,a,e)}function J(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.l.o.length;e++){var f=b.l.o[e];if("ANY"==a||f.Bb.id==a)f=f.Bb.P,
c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function D(a,b){E.r(E.qd,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=r.Cr(e.M)+r.Cr(e.ea)+String(e.local);c[f]=c[f]||{M:e.M,ea:e.ea,local:e.local,Qr:[]};var g=c[f].Qr,k;for(k in e.te)-1==g.indexOf(k)&&g.push(k)}for(f in c)d=c[f].M,e=c[f].ea,k=c[f].local,g=c[f].Qr,E.r(E.Yq,a,d,e,k,g)}else E.r(E.Yq,a,null,null,!1,null)}function y(a,b){if(b.fi){var c=a.l.P,d=b.sh*b.ht,e=b.Di*b.Sr,f=-b.ei*b.Xp*2*Math.PI/b.Uw;b.Bu&&(f*=-1);switch(b.type){case 10:E.r(E.qd,
c);E.r(E.Wy,c,d,e,f);break;case 20:E.r(E.qd,c),E.r(E.Vy,c,d,e,f)}}}function n(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function l(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function c(a){return a.b4w_character?!0:!1}function M(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}var I=w("__config");w("__constraints");var x=w("__print"),B=w("__debug"),E=w("__ipc");w("__renderer");var K=w("__scenes"),k=w("__transform"),u=w("__tsr"),
r=w("__util"),L=w("__version"),F=w("vec3"),f=w("quat"),N=w("mat4"),P=I.Bb,V=I.p,R=null,ea=null,U=[],X=[],Q={Fx:0,body:0,ss:0,shape:0},S=new Float32Array(3),A=new Float32Array(4),ka=new Float32Array(4),fa=new Float32Array(16),da=new Float32Array(8),ca=new Float32Array(8);a.hD=function(a){if(P.enabled){var c=P.Qj+L.timestamp();x.log("%cLOAD PHYSICS","color: #0a0",c,"Max FPS: "+P.Ze);R=new Worker(c);E.Ob(R,b);E.r(E.Fy,a,P.Ze)}};a.Er=function(a){var b;Q.Fx++;b=Q.Fx;E.r(E.uy,b);a.l={};a.l.FG=b;a.l.o=[]};
a.Y=function(){if(P.enabled){E.r(E.Ay);ea=null;U.length=0;X.length=0;for(var a in Q)Q[a]=0}};a.Ke=function(a,b){ea=b;E.r(E.Ky,b.l.FG);var k=a.d;if(!k)throw"No object render: "+a.name;if(a.parent&&k.pm)return null;var u=[];k.pm&&e(a,u);if(n(a)||l(a)||c(a)||M(a)||a.b4w_collision){var q,z=a,C=k.Dv,I=z.d,B=z.game,D=d();if("CAMERA"==z.type)var w=B.use_collision_bounds?B.collision_bounds_type:"BOX",A=p(w,I),L=I.Ui,J=I.Oi,L=.5,J=0;else"EMPTY"==z.type?(w="EMPTY",A=null,J=L=0):(w=B.use_collision_bounds?B.collision_bounds_type:
"BOX",A=p(w,I),L=I.Ui,J=I.Oi);var O=I.g,P=I.quat,R=B.use_ghost,Q=B.use_sleep,S=B.mass,V=B.velocity_min,ca=B.velocity_max,ab=B.damping,Na=B.rotation_damping,sa=B.collision_group,Oa=B.collision_mask,ra=I.Zc.Ca,mc=g(A),ja=z.b4w_correct_bounding_offset,Ya;var da=w;if(u.length){var Ga=[],za={};za.quat=new Float32Array([0,0,0,1]);za.trans=new Float32Array(3);za.worker_bounding=mc;za.bounding_type=da;Ga.push(za);N.invert(I.R,fa);f.invert(I.quat,ka);for(var qa=0;qa<u.length;qa++){var db={},Aa=u[qa],Ma=Aa.game.collision_bounds_type,
Cb=new Float32Array(4),cc=new Float32Array(3);F.transformMat4(Aa.d.g,fa,cc);f.multiply(ka,Aa.d.quat,Cb);db.trans=cc;db.quat=Cb;db.bounding_type=Ma;db.worker_bounding=g(p(Ma,Aa.d));Ga.push(db)}Ya=Ga}else Ya=[];E.r(E.ly,D,O,P,C,R,Q,S,V,ca,ab,Na,sa,Oa,w,mc,ra,L,J,Ya,ja);U.push(z);X[D]=z;var Kb=h(D);Kb.type=C;Kb.To=S;Kb.nl=R;q=Kb;a.l=q;var Wb={n:null,Bb:q};b.l.o.push(Wb)}else for(var rb=a.q||[],sb=0;sb<rb.length;sb++){var jb=rb[sb],Ia;if(Ia="PHYSICS"==jb.type){var Ba;a:{for(var Nb=b.l.o,Ta=0;Ta<Nb.length;Ta++){var lb=
Nb[Ta].n;if(lb&&lb.id==jb.id){Ba=!0;break a}}Ba=!1}Ia=!Ba}if(Ia)if(jb.Ec.J)if(jb.Rg&&b.d.Xa){var cb=jb,Pb=ea,Ra=K.ja(Pb,"MAIN_OPAQUE");E.r(E.ty,Ra.xf);if(Ra.Xa&&cb.BG){var Ua={};Ua.dst_noise_scale0=cb.dst_noise_scale0;Ua.dst_noise_scale1=cb.dst_noise_scale1;Ua.dst_noise_freq0=cb.dst_noise_freq0;Ua.dst_noise_freq1=cb.dst_noise_freq1;Ua.dir_min_shore_fac=cb.dir_min_shore_fac;Ua.dir_freq=cb.dir_freq;Ua.dir_noise_scale=cb.dir_noise_scale;Ua.dir_noise_freq=cb.dir_noise_freq;Ua.dir_min_noise_fac=cb.dir_min_noise_fac;
Ua.dst_min_fac=cb.dst_min_fac;Ua.waves_hor_fac=cb.waves_hor_fac;var Gb=Ra.yf,xb=Ra.Sg;Ra.rm?E.r(E.Xq,Ua,Ra.kf[0],Ra.kf[1],Ra.jf[0],Ra.jf[1],Ra.Hh,Gb,xb,Ra.Vh,Pb.d.Mp):E.r(E.Xq,Ua,0,0,0,0,0,Gb,xb,0,null)}}else{var hb;if(jb.uG){var Vb=a,kb=jb,qb=d(),La=kb.Ec;E.r(E.ry,qb,La.u[0].a_position,La.ca||null,Vb.d.g,kb.ns,kb.os);var ya=h(qb);ya.nl=!0;hb=ya}else{var Fb=a,wb=jb,ua=d(),Ob=wb.Ec;E.r(E.sy,ua,Ob.u[0].a_position,Ob.ca||null,Fb.d.g,wb.Ui,wb.Oi,wb.ns,wb.os);hb=h(ua)}q=hb;q.id=jb.pc;Wb={n:jb,Bb:q};b.l.o.push(Wb)}else x.error("Object "+
a.name+" has collision material with no assigned vertices")}if(n(a)||l(a)){var Y=a,gb=Y.l.P;n(Y)?(Y.i.type=10,E.r(E.my,gb,Y.i.PF,Y.i.RF,Y.i.QF,Y.i.DG,Y.i.KD)):l(Y)&&(Y.i.type=20,E.r(E.ky,gb,Y.i.Wn,Y.i.uq,Y.i.vq));if(Y.i.Dg){var Pa=Y.i.Dg;switch(Y.i.type){case 10:v(Pa[1],Y,gb,!0);v(Pa[0],Y,gb,!0);v(Pa[3],Y,gb,!1);v(Pa[2],Y,gb,!1);break;case 20:for(var Da=0;Da<Pa.length;Da++)v(Pa[Da],Y,gb,!1)}}Y.l.id=Y.b4w_vehicle_settings.name;y(a,a.i)}else if(c(a)){var Sa=a.d,Db=a.l,Ib=Sa.Ub.max_y-Sa.Ub.min_y,ac=
Db.P,Eb=a.b4w_character_settings,Qa=Eb.walk_speed,Tb=Eb.run_speed,Jb=Eb.step_height,bc=Eb.jump_strength,Ub=Eb.waterline,nc=r.rB(a);E.r(E.ny,ac,nc,Ib,Qa,Tb,Jb,bc,Ub);Db.bj=!0}else if(M(a)){var yb=a,mb=yb.l.P;E.r(E.qy,mb,yb.Kc.Wn,yb.Kc.uq,yb.Kc.vq);if(yb.Kc.rk)for(var oc=yb.Kc.rk,kc=0;kc<oc.length;kc++){var eb=oc[kc],pc=eb.d.g,G=yb.d.R,Lb=new Float32Array(16);N.invert(G,Lb);var tb=new Float32Array(3);F.transformMat4(pc,Lb,tb);E.r(E.jy,mb,tb,eb.Xz)}yb.l.oD=!0}else a.b4w_collision&&(q.id=a.b4w_collision_id);
for(sb=0;sb<U.length;sb++)if(a=U[sb],a.l){var Ea=a;if(!m(Ea))for(var nb=0;nb<Ea.constraints.length;nb++){var T=Ea.constraints[nb],Va=T.target,ob=T.pivot_type;if("RIGID_BODY_JOINT"==T.type&&Va.l){var dc=new Float32Array([T.pivot_x,T.pivot_y,T.pivot_z]),Wa,ec=new Float32Array([T.axis_x,T.axis_y,T.axis_z]);Wa=r.Qe(ec,new Float32Array(4));var Za=N.fromRotationTranslation(Wa,dc,new Float32Array(16)),vc=N.multiply(Ea.d.R,Za,new Float32Array(16)),Xb=N.invert(Va.d.R,new Float32Array(16)),fc=N.multiply(Xb,
vc,Xb),gc=r.rg(fc),Ec=r.re(fc),Ha=T,Ca={};Ca.use_limit_x=Ha.use_limit_x;Ca.use_limit_y=Ha.use_limit_y;Ca.use_limit_z=Ha.use_limit_z;Ca.use_angular_limit_x=Ha.use_angular_limit_x;Ca.use_angular_limit_y=Ha.use_angular_limit_y;Ca.use_angular_limit_z=Ha.use_angular_limit_z;Ca.limit_max_x=Ha.limit_max_x;Ca.limit_min_x=Ha.limit_min_x;Ca.limit_max_y=Ha.limit_max_y;Ca.limit_min_y=Ha.limit_min_y;Ca.limit_max_z=Ha.limit_max_z;Ca.limit_min_z=Ha.limit_min_z;Ca.limit_angle_max_x=Ha.limit_angle_max_x;Ca.limit_angle_min_x=
Ha.limit_angle_min_x;Ca.limit_angle_max_y=Ha.limit_angle_max_y;Ca.limit_angle_min_y=Ha.limit_angle_min_y;Ca.limit_angle_max_z=Ha.limit_angle_max_z;Ca.limit_angle_min_z=Ha.limit_angle_min_z;t(ob,Ea,dc,Wa,Va,gc,Ec,Ca,null,null)}}}};a.NB=q;a.update=function(){for(var a=0;a<U.length;a++){var b=U[a],c=b.l;if(c.lf&&c.Dn){var d=performance.now()/1E3-c.Dn,d=Math.min(d,10/60);V.RD&&(d=0);var e=da;u.iD(c.En,d,c.Uu,c.or,da);k.kd(b,u.$t(e));k.Fd(b,u.Pt(e));k.F(b);z(b);if(b.i)for(var c=b,d=c.i.Dg,e=c.d.Be,g=da,
l=0;l<d.length;l++){var n=d[l];u.multiply(e,c.i.xj[l],g);k.Bw(n,g);k.F(n)}b.i&&b.i.fi&&(c=b.i,d=c.fi)&&(e=b.i.Vw,n=fa,g=b.d.g,l=b.d.quat,r.fq(b.i.Ww,l,g,n),r.rg(n,d.d.g),r.re(n,d.d.quat),n=A,r.gq(e,l,g,n),e=ka,f.setAxisAngle(n,-c.ei*c.Xp*2*Math.PI,e),f.multiply(e,d.d.quat,d.d.quat),k.F(d));b.i&&b.i.Up&&(c=b.i,d=c.Up)&&(g=b.i.Qw,e=fa,l=b.d.g,n=b.d.quat,r.fq(b.i.Rw,n,l,e),r.rg(e,d.d.g),r.re(e,d.d.quat),e=A,r.gq(g,n,l,e),g=ka,l=Math.abs(c.speed)*c.Pw,l>c.Vo&&(l=c.Vo),f.setAxisAngle(e,-l,g),f.multiply(g,
d.d.quat,d.d.quat),k.F(d));b.i&&b.i.$p&&(c=b.i,d=c.$p)&&(e=b.i.cx,n=fa,g=b.d.g,l=b.d.quat,r.fq(b.i.dx,l,g,n),r.rg(n,d.d.g),r.re(n,d.d.quat),b=A,r.gq(e,l,g,b),e=ka,f.setAxisAngle(b,-Math.abs(c.sh)*c.Os,e),f.multiply(e,d.d.quat,d.d.quat),k.F(d))}}if(a=ea)a=K.ja(a,"MAIN_OPAQUE"),a.Xa&&0<a.Xa.waves_height&&(b=F.length(a.Uj),E.r(E.Uy,a.time*b))};a.iC=function(){return ea};a.pause=function(){P.enabled&&E.r(E.Gy)};a.hd=function(){P.enabled&&E.r(E.Jy)};a.Vs=function(a){a=a.l;if(!a)throw"No object physics";
if(!a.lf){var b=a.P;a.lf=!0;E.r(E.Ey,b)}};a.Nk=function(a){a=a.l;if(!a)throw"No object physics";if(a.lf){var b=a.P;a.lf=!1;E.r(E.Dy,b)}};a.D=function(a){return a.l?!0:!1};a.ru=function(a){return(a=a.l)&&a.lf&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.To&&0==a.nl?!0:!1};a.xo=function(a){return(a=a.l)&&a.lf?!0:!1};a.sw=function(a,b){E.r(E.Ty,a.l.P,b)};a.bD=m;a.ur=t;a.js=function(a){a=a.l;E.r(E.Iy,a.Dk);a.Dk=null};a.Lv=function(b,c,d,e,f,g){c=u.nh(c,1,d,da);f=u.nh(f,1,g,ca);u.invert(c,c);u.multiply(f,
c,c);k.QC(e,f);u.multiply(f,c,c);k.Bw(b,c);k.F(b);a.Xl(b,b.d.g,b.d.quat)};a.Xl=function(a,b,c){u.Ij(a.d.g,1,a.d.quat,a.l.En);var d=E.Kt(E.Vg);d.msg_id=E.Vg;d.body_id=a.l.P;d.trans=b;d.quat=c;E.r(E.qd,a.l.P);E.r(E.Vg,d)};a.T=z;a.Ar=function(a,b,c,d){C(a,b,c,d,S);a=a.l.P;E.r(E.qd,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(S[0]),f=Math.abs(S[1]),g=Math.abs(S[2]);S[0]=e?S[0]/e*Math.max(e,b):0;S[1]=f?S[1]/f*Math.max(f,c):0;S[2]=g?S[2]/g*Math.max(g,d):0;E.r(E.Zq,a,S[0],S[1],S[2])};a.Br=
function(a,b,c,d){a=a.l.P;E.r(E.qd,a);E.r(E.Zq,a,b,c,d)};a.vr=function(a,b,c,d){C(a,b,c,d,S);a=a.l.P;E.r(E.qd,a);E.r(E.vy,a,S[0],S[1],S[2])};a.zr=function(a,b,c,d){C(a,b,c,d,S);a=a.l.P;E.r(E.qd,a);E.r(E.xy,a,S[0],S[1],S[2])};a.Dp=function(a,b,c){a=a.l.P;E.r(E.qd,a);E.r(E.Ny,a,b,c)};a.Vl=function(a,b){E.r(E.Oy,a.l.P,b)};a.kw=function(a,b){E.r(E.Sy,a.l.P,b)};a.jw=function(a,b){E.r(E.Qy,a.l.P,b)};a.gw=function(a,b){E.r(E.Ly,a.l.P,b)};a.Yr=function(a){E.r(E.yy,a.l.P)};a.Zr=function(a,b,c){E.r(E.zy,a.l.P,
b,c)};a.Wl=function(a,b,c){E.r(E.Py,a.l.P,b,c)};a.hw=function(a,b){E.r(E.My,a.l.P,b)};a.iw=function(a,b){E.r(E.Ry,a.l.P,b)};a.SI=function(){return!1};a.OI=function(){return!1};a.MI=function(){x.error("check_collision() deprecated");return!1};a.NI=function(){x.error("check_collision_any() deprecated");return!1};a.QI=function(){x.error("check_ray_hit() deprecated");return!1};a.bN=function(){x.error("update_object_coords() deprecated")};a.Pm=function(a,b,c,d){var e=a.l,f=e.P;b=b||"ANY";for(var g=0;g<
e.td.length;g++){var k=e.td[g];if(k.pc==b&&k.callback==c)return}g=[];a=a.l.P;k=[];J(b,ea,k,null);for(var l=0;l<k.length;l++){var n=k[l];a<n?g.push([a,n]):a>n&&g.push([n,a])}k={pc:b,callback:c,Fl:g,Bv:new Uint8Array(g.length),$o:d||!1};e.td.push(k);E.r(E.qd,f);E.r(E.oy,g,d)};a.xp=function(a,b,c){a=a.l;b=b||"ANY";for(var d=0;d<a.td.length;d++){var e=a.td[d];if(e.pc==b&&e.callback==c){a.td.splice(d,1);d--;for(var e=e.Fl,f=ea.l.o,g=0;g<f.length;g++)for(var k=f[g].Bb,l=0;l<k.td.length;l++)for(var n=k.td[l],
r=0;r<n.Fl.length;r++)for(var m=n.Fl[r],h=0;h<e.length;h++){var u=e[h];m[0]===u[0]&&m[1]===u[1]&&(e.splice(h,1),h--)}e.length&&E.r(E.Hy,e)}}};a.Sm=function(a,b){var c=a.l;c?(E.r(E.wy,c.P),c.Bk=b):x.error("Object "+a.name+" has no physics")};a.nn=function(a){var b=a.l;b?(E.r(E.By,b.P),b.Bk=null):x.error("Object "+a.name+" has no physics")};a.Rm=function(a,b,c,d,e,f){var g=a.l;if(g){a=g.P;b=b||"ANY";c={M:new Float32Array(c),ea:new Float32Array(d),local:e,callback:f,pc:b,te:{}};J(b,ea,null,c.te);delete c.te[a];
for(var k in c.te)c.te[k]=1;g.cf.push(c);D(a,g.cf)}else x.error("Object "+a.name+" has no physics")};a.yp=function(a,b,c,d,e){if(b=a.l){a=b.P;for(var f=0;f<b.cf.length;f++){var g=b.cf[f];r.Ak(g.M,c)&&r.Ak(g.ea,d)&&g.local==e&&(b.cf.splice(f,1),f--)}D(a,b.cf)}else x.error("Object "+a.name+" has no physics")};a.ri=function(a,b){var c=a.i;c.sh=b;y(a,c)};a.qi=function(a,b){var c=a.i;c.ei=b;y(a,c)};a.pq=function(a,b){var c=a.i;c.Di=b;y(a,c)};a.fc=n;a.gc=l;a.mD=function(a){if(!a.b4w_vehicle)return!1;a=
a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.lD=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.pD=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.Ju=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.Iu=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.Ku=function(a){return a.b4w_vehicle&&
"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.au=function(a){return a.i.speed};a.EG=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.bj=c;a.eL=M;a.kK=function(){return 0};a.iB=function(){E.r(E.Cy)};a.tE=function(a){var b=U.indexOf(a);-1!=b?(U.splice(b,1),a=X.indexOf(a),-1!=a&&X.splice(a,1)):x.error("Object ",a.name," doesn't have bounding physics")};a.reset=function(){R.terminate()}};b4w.module.__ipc=function(a){var w=a.Ox=0;a.Px=1;a.Qx=2;a.Rx=3;a.Sx=4;a.Tx=5;var e=a.Vx=6,b=a.Wx=7,q=a.Xx=8;a.Yx=9;a.Ux=10;a.Fy=11;a.qd=12;a.hy=13;a.iy=14;a.jy=15;a.ly=16;a.ky=17;a.my=18;a.ny=19;a.oy=20;a.py=21;a.qy=22;a.ry=23;a.sy=24;a.ty=25;a.uy=26;a.vy=27;a.wy=28;a.xy=29;a.yy=30;a.zy=31;a.Ay=32;a.By=33;a.Dy=34;a.Ey=35;a.Gy=36;a.Yq=37;a.Hy=38;a.Iy=39;a.Jy=40;a.Ky=41;a.Ly=42;a.My=43;a.Ny=44;a.Oy=45;a.Py=46;a.Qy=47;a.Ry=48;a.Sy=49;a.Ty=50;a.Zq=51;var d=a.Vg=52;a.Uy=53;a.Xq=54;a.Vy=55;a.Wy=56;a.ZH=
57;a.Cy=58;for(var h=null,p=[],g=[],v=[],m=[],t=0;59>t;t++)p.push(null),g.push(null),v.push(null),m.push(null);g[q]={msg_id:0,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3)};g[e]={msg_id:0,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4)};g[b]={msg_id:0,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0};g[w]={msg_id:0,body_id_a:0,body_id_b:0,result:0,
coll_point:new Float32Array(3)};g[d]={msg_id:0,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4)};m[q]=["msg_id",1,"body_id",1,"time",1,"trans",3,"quat",4,"linvel",3,"angvel",3];m[e]=["msg_id",1,"chassis_hull_body_id",1,"prop_ind",1,"trans",3,"quat",4];m[b]=["msg_id",1,"body_id",1,"from",3,"to",3,"local",1,"body_id_b_hit",1,"cur_result",1];m[w]=["msg_id",1,"body_id_a",1,"body_id_b",1,"result",1,"coll_point",3];m[d]=["msg_id",1,"body_id",1,"trans",3,"quat",4];a.Ob=function(a,b){a.addEventListener("message",
function(a){var d=a.data;a=d[0]|0;if(m[a]){for(var e=g[a],n=m[a],l=0,c=0;c<n.length;c+=2){var h=n[c],p=n[c+1];if(1==p)e[h]="msg_id"==h||"body_id"==h||"body_id_a"==h||"body_id_b"==h?d[l]|0:d[l];else for(var v=0;v<p;v++)e[h][v]=d[l+v];l+=p}d=e}b(a,d)},!1);h=a};a.Y=function(){h=null};a.r=function(){var a=arguments[0]|0;if(m[a]){var b=g[a],d=m[a],e=0;if(!v[a]){for(var q=0,n=1;n<d.length;n+=2)q+=d[n];v[a]=new Float32Array(q)}q=v[a];for(n=0;n<d.length;n+=2){var l=b[d[n]],c=d[n+1];1==c?q[e]=l:q.set(l,e);
e+=c}p[a]||(p[a]=q);a=p[a]}else for(b=arguments.length,p[a]||(p[a]=Array(b),p[a][0]=a),a=p[a],d=1;d<b;d++)a[d]=arguments[d];h.postMessage(a)};a.Kt=function(a){return g[a]}};b4w.module.__renderer=function(a,w){function e(a){if(a){var b=(a.ha?y.COLOR_BUFFER_BIT:0)|(a.la?y.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=t;break;case "DEPTH":a=z;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=C;break;case "GLOW_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=J;break;default:a=m.background_color}}else b=y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT,a=m.background_color;y.colorMask(!0,!0,!0,!0);y.depthMask(!0);
y.clearColor(a[0],a[1],a[2],a[3]);y.clear(b)}function b(a,b,d){y.bindBuffer(y.ARRAY_BUFFER,a.Og);for(var e=0;e<b.length;e++){var g=b[e];y.enableVertexAttribArray(g.pg);y.vertexAttribPointer(g.pg,g.vg,y.FLOAT,!1,0,g.Pz+g.RB*d)}a.me?(y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,a.me),y.drawElements(a.mode,a.count,a.Ao,0)):y.drawArrays(a.mode,0,a.count);for(e=0;e<b.length;e++)g=b[e],y.disableVertexAttribArray(g.pg)}function q(a){switch(a){case 0:return y.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return y.TEXTURE_CUBE_MAP_NEGATIVE_X;
case 2:return y.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return y.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return y.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return y.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function d(a){var b=a.Oj,d=[],e=[],g={},n;for(n in b){var m=!1;switch(n){case "u_proj_matrix":var h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.wa)},m=!0;break;case "u_view_matrix":case "u_view_matrix_frag":h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.pa)};m=!0;break;case "u_shadow_cast_billboard_view_matrix":h=function(a,
b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Hw)};m=!0;break;case "u_view_proj_prev":h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.kE)};m=!0;break;case "u_view_proj_inverse":h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.ti)};m=!0;break;case "u_sky_vp_inverse":h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Hd)};m=!0;break;case "u_camera_eye":case "u_camera_eye_frag":h=function(a,b,c,d,e,f){a.uniform3fv(b,f.Re)};m=!0;break;case "u_camera_eye_last":h=function(a,b,c,d,e,f){a.uniform3fv(b,f.ct)};m=
!0;break;case "u_camera_quat":h=function(a,b,c,d,e,f){a.uniform4fv(b,f.quat)};m=!0;break;case "u_view_max_depth":h=function(a,b,c,d,e,f){a.uniform1f(b,f.cb)};m=!0;break;case "u_camera_range":h=function(a,b,c,d,e,f){a.uniform2f(b,f.Ra,f.cb)};break;case "u_csm_center_dists":h=function(a,b,c,d,e,f){a.uniform4fv(b,f.Hs)};break;case "u_cam_water_depth":h=function(a,b,c){a.uniform1f(b,c.jn)};m=!0;break;case "u_waves_height":h=function(a,b,c){a.uniform1f(b,c.yf)};break;case "u_waves_length":h=function(a,
b,c){a.uniform1f(b,c.Sg)};break;case "u_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.ac)};break;case "u_underwater_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.md)};break;case "u_bloom_key":h=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":h=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":h=function(a,b,c){a.uniform1f(b,c.time)};m=!0;break;case "u_wind":h=function(a,b,c){a.uniform3fv(b,c.Uj)};break;case "u_horizon_color":h=function(a,
b,c){a.uniform3fv(b,c.Qc)};break;case "u_zenith_color":h=function(a,b,c){a.uniform3fv(b,c.Wc)};break;case "u_environment_energy":h=function(a,b,c){a.uniform1f(b,c.Pe)};break;case "u_sky_color":h=function(a,b,c){a.uniform3fv(b,c.Wh)};break;case "u_rayleigh_brightness":h=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":h=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":h=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":h=
function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":h=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":h=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":h=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":h=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":h=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;
case "u_light_positions":h=function(a,b,c){a.uniform3fv(b,c.ng)};break;case "u_light_directions":h=function(a,b,c){a.uniform3fv(b,c.lg)};break;case "u_light_color_intensities":h=function(a,b,c){a.uniform3fv(b,c.kg)};break;case "u_light_factors":h=function(a,b,c){a.uniform4fv(b,c.mg)};break;case "u_sun_quaternion":h=function(a,b,c){a.uniform4fv(b,c.bx)};break;case "u_sun_intensity":h=function(a,b,c){a.uniform3fv(b,c.ax)};break;case "u_sun_direction":h=function(a,b,c){a.uniform3fv(b,c.gm)};break;case "u_height":h=
function(a,b,c,d,e,f){a.uniform1f(b,f.height)};m=!0;break;case "u_model_matrix":h=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.R)};m=!0;break;case "u_transb":h=function(a,b,c,d){a.uniform4fv(b,d.Hc)};m=!0;break;case "u_transa":h=function(a,b,c,d){a.uniform4fv(b,d.Gc)};m=!0;break;case "u_quat":h=function(a,b,c,d){a.uniform4fv(b,d.quat)};m=!0;break;case "u_quatsb":h=function(a,b,c,d){a.uniform4fv(b,d.zc)};m=!0;break;case "u_quatsa":h=function(a,b,c,d){a.uniform4fv(b,d.yc)};m=!0;break;case "u_frame_factor":h=
function(a,b,c,d){a.uniform1f(b,d.Wf)};m=!0;break;case "au_center_pos":h=function(){};m=!0;break;case "au_wind_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.Pd)};m=!0;break;case "au_wind_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.zf)};m=!0;break;case "au_detail_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.Oe)};m=!0;break;case "au_detail_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.Ne)};m=!0;break;case "au_branch_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.Le)};m=!0;break;case "u_node_values":h=
function(a,b,c,d){a.uniform1fv(b,d.Ye)};m=!0;break;case "u_node_rgbs":h=function(a,b,c,d){a.uniform3fv(b,d.Ad)};m=!0;break;case "u_diffuse_color":h=function(a,b,c,d,e){a.uniform4fv(b,e.Oc)};m=!0;break;case "u_diffuse_intensity":h=function(a,b,c,d,e){a.uniform1f(b,e.Mi)};m=!0;break;case "u_diffuse_params":h=function(a,b,c,d,e){a.uniform2fv(b,e.ce)};m=!0;break;case "u_emit":h=function(a,b,c,d,e){a.uniform1f(b,e.rh)};m=!0;break;case "u_ambient":h=function(a,b,c,d,e){a.uniform1f(b,e.ah)};m=!0;break;case "u_specular_color":h=
function(a,b,c,d,e){a.uniform3fv(b,e.Kj)};m=!0;break;case "u_specular_alpha":h=function(a,b,c,d,e){a.uniform1f(b,e.Zh)};m=!0;break;case "u_specular_params":h=function(a,b,c,d,e){a.uniform3fv(b,e.$h)};m=!0;break;case "u_reflect_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.Pl)};m=!0;break;case "u_mirror_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.Yo)};m=!0;break;case "u_grass_map_dim":h=function(a,b,c,d,e){a.uniform3fv(b,e.cc)};m=!0;break;case "u_grass_size":h=function(a,b,c,d,e){a.uniform1f(b,e.oo)};
m=!0;break;case "u_scale_threshold":h=function(a,b,c,d,e){a.uniform1f(b,e.iu)};m=!0;break;case "u_cube_fog":h=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.qc)};break;case "u_jitter_amp":h=function(a,b,c,d,e){a.uniform1f(b,e.Lu)};m=!0;break;case "u_jitter_freq":h=function(a,b,c,d,e){a.uniform1f(b,e.Mu)};m=!0;break;case "u_wireframe_mode":h=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":h=
function(a,b,c){a.uniform2fv(b,c.uD)};m=!0;break;case "u_subsample_indices":h=function(a,b,c){a.uniform4fv(b,c.vD)};m=!0;break;case "u_refr_bump":h=function(a,b,c,d,e){a.uniform1f(b,e.Tv)};m=!0;break;case "u_lamp_light_positions":h=function(a,b,c,d,e){a.uniform3fv(b,e.Io)};break;case "u_lamp_light_directions":h=function(a,b,c,d,e){a.uniform3fv(b,e.Go)};break;case "u_lamp_light_color_intensities":h=function(a,b,c,d,e){a.uniform3fv(b,e.Fo)};break;case "u_lamp_light_factors":h=function(a,b,c,d,e){a.uniform4fv(b,
e.Ho)};break;case "u_halo_size":h=function(a,b,c,d,e){a.uniform1f(b,e.nu)};m=!0;break;case "u_halo_hardness":h=function(a,b,c,d,e){a.uniform1f(b,e.ku)};m=!0;break;case "u_halo_rings_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.mu)};m=!0;break;case "u_halo_lines_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.lu)};m=!0;break;case "u_halo_stars_blend":h=function(a,b,c,d,e){a.uniform1f(b,e.ou)};m=!0;break;case "u_halo_stars_height":h=function(a,b,c,d,e){a.uniform1f(b,e.pu)};m=!0;break;case "u_fresnel_params":h=
function(a,b,c,d,e){a.uniform4fv(b,e.Yf)};m=!0;break;case "u_texture_scale":h=function(a,b,c,d,e){a.uniform3fv(b,e.rf)};m=!0;break;case "u_parallax_scale":h=function(a,b,c,d,e){a.uniform1f(b,e.Gl)};m=!0;break;case "u_color_id":h=function(a,b,c,d){a.uniform3fv(b,d.Ck)};m=!0;break;case "u_line_points":h=function(a,b,c,d,e){a.uniform3fv(b,e.nL)};m=!0;break;case "u_diffuse_color_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.Li)};m=!0;break;case "u_alpha_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.Ai)};
m=!0;break;case "u_specular_color_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.Ow)};m=!0;break;case "u_normal_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.gv)};m=!0;break;case "u_normalmap0_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.ug[0])};m=!0;break;case "u_normalmap1_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.ug[1])};m=!0;break;case "u_normalmap2_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.ug[2])};m=!0;break;case "u_normalmap3_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.ug[3])};m=!0;
break;case "u_foam_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.Sk)};m=!0;break;case "u_foam_uv_freq":h=function(a,b,c,d,e){a.uniform2fv(b,e.gt)};m=!0;break;case "u_foam_mag":h=function(a,b,c,d,e){a.uniform2fv(b,e.ft)};m=!0;break;case "u_foam_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.Xn)};m=!0;break;case "u_water_norm_uv_velocity":h=function(a,b,c,d,e){a.uniform1f(b,e.vm)};m=!0;break;case "u_shallow_water_col":h=function(a,b,c,d,e){a.uniform3fv(b,e.Yl)};m=!0;break;case "u_shore_water_col":h=
function(a,b,c,d,e){a.uniform3fv(b,e.bm)};m=!0;break;case "u_water_shallow_col_fac":h=function(a,b,c,d,e){a.uniform1f(b,e.Zl)};m=!0;break;case "u_water_shore_col_fac":h=function(a,b,c,d,e){a.uniform1f(b,e.cm)};m=!0;break;case "u_p_length":h=function(a,b,c,d,e){a.uniform1f(b,e.tv)};m=!0;break;case "u_p_cyclic":h=function(a,b,c,d,e){a.uniform1i(b,e.pv)};m=!0;break;case "u_p_max_lifetime":h=function(a,b,c,d,e){a.uniform1f(b,e.vv)};m=!0;break;case "u_p_fade_in":h=function(a,b,c,d,e){a.uniform1f(b,e.qv)};
m=!0;break;case "u_p_fade_out":h=function(a,b,c,d,e){a.uniform1f(b,e.rv)};m=!0;break;case "u_p_size":h=function(a,b,c,d,e){a.uniform1f(b,e.hp)};m=!0;break;case "u_p_alpha_start":h=function(a,b,c,d,e){a.uniform1f(b,e.mv)};m=!0;break;case "u_p_alpha_end":h=function(a,b,c,d,e){a.uniform1f(b,e.lv)};m=!0;break;case "u_p_nfactor":h=function(a,b,c,d,e){a.uniform1f(b,e.gp)};m=!0;break;case "u_p_gravity":h=function(a,b,c,d,e){a.uniform1f(b,e.sv)};m=!0;break;case "u_p_mass":h=function(a,b,c,d,e){a.uniform1f(b,
e.uv)};m=!0;break;case "u_p_size_ramp":h=function(a,b,c,d,e){a.uniform2fv(b,e.wv)};m=!0;break;case "u_p_color_ramp":h=function(a,b,c,d,e){a.uniform4fv(b,e.nv)};m=!0;break;case "u_p_wind":h=function(a,b,c,d,e){a.uniform3fv(b,e.El)};m=!0;break;case "u_texel_size":h=function(a,b,c,d,e){a.uniform2fv(b,e.bq)};m=!0;break;case "u_p_time":h=function(a,b,c,d,e){a.uniform1f(b,e.xc.S.time)};m=!0;break;case "u_position":h=function(a,b,c,d,e){a.uniform3fv(b,e.uj)};m=!0;break;case "u_va_frame_factor":h=function(a,
b,c,d){a.uniform1f(b,d.ux)};m=!0;break;case "u_normal_offset":h=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":h=function(a,b,c,d,e,f){a.uniform4fv(b,f.Kl)};break;case "u_v_light_matrix":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.tx)};m=!0;break;case "u_b_light_matrix":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Lr)};break;case "u_p_light_matrix0":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Bg[0])};m=!0;break;case "u_p_light_matrix1":h=function(a,b,c){a.uniformMatrix4fv(b,
!1,c.Bg[1])};m=!0;break;case "u_p_light_matrix2":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Bg[2])};m=!0;break;case "u_p_light_matrix3":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Bg[3])};m=!0;break;case "u_motion_blur_exp":h=function(a,b,c){a.uniform1f(b,c.av)};m=!0;break;case "u_refl_plane":h=function(a,b,c){a.uniform4fv(b,c.Hb)};break;case "u_radial_blur_step":h=function(a,b,c){a.uniform1f(b,c.Ol)};break;case "u_god_rays_intensity":h=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;
case "u_ssao_radius_increase":h=function(a,b,c){a.uniform1f(b,c.di)};break;case "u_ssao_blur_discard_value":h=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};m=!0;break;case "u_ssao_influence":h=function(a,b,c){a.uniform1f(b,c.ci)};break;case "u_ssao_dist_factor":h=function(a,b,c){a.uniform1f(b,c.bi)};break;case "u_dof_dist":h=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_distance)};m=!0;break;case "u_dof_front":h=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_front)};m=!0;break;case "u_dof_rear":h=
function(a,b,c,d,e,f){a.uniform1f(b,f.dof_rear)};m=!0;break;case "u_glow_intensity":h=function(a,b,c,d){a.uniform1f(b,d.bg)};m=!0;break;case "u_glow_color":h=function(a,b,c){a.uniform3fv(b,c.yh)};break;case "u_draw_glow":h=function(a,b,c){a.uniform1f(b,c.On)};m=!0;break;case "u_brightness":h=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":h=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":h=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":h=
function(a,b,c){a.uniform1f(b,c.saturation)};break;default:h=null}h&&(h={name:n,ao:h,pg:b[n]},m?d.push(h):(e.push(h),g[n]=h))}a.hx=d;a.qj=e;a.jp=g}var h=w("__config"),p=w("__debug"),g=w("__textures"),v=w("__util"),m=h.p,t=[1,1,1,1],z=[1,1,1,1],C=[0,0,0,1],J=[0,0,0,0],D=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var y=null,n=new Uint8Array(4);a.Bc=function(a){var b=m.background_color;a.clearColor(b[0],
b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);y=a};a.Ni=function(a){if(a.aa){var c=a.j;y.bindFramebuffer(y.FRAMEBUFFER,c.he);if(a.Wm){var g=c.Db;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,g.Sb,g.Wa,0)}y.viewport(0,0,c.width,c.height);e(a);a.Ga?y.enable(y.BLEND):y.disable(y.BLEND);a.Lb?y.enable(y.DEPTH_TEST):y.disable(y.DEPTH_TEST);if(a.Ja){for(var c=
a.j,g=a.o,h=0;h<g.length;h++){var v=g[h],t=v.n,z=t.kc;y.useProgram(z.wj);v=v.qb;z.qj.length||d(z);for(var z=z.qj,C=z.length;C--;){var k=z[C];k.ao(y,k.pg,a,v,t,c)}}a.Ja=!1}switch(a.type){case "SHADOW_CAST":y.enable(y.POLYGON_OFFSET_FILL);y.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);y.cullFace(y.BACK);break;case "MAIN_REFLECT":y.disable(y.POLYGON_OFFSET_FILL);y.cullFace(y.FRONT);break;default:y.disable(y.POLYGON_OFFSET_FILL),y.cullFace(y.BACK)}c=a.j;g=a.o;for(h=0;h<g.length;h++)if(z=
g[h],z.aa){var t=a,v=c,k=z.qb,u=z.n,C=u.kc;y.useProgram(C.wj);for(var z=u.$a,r=u.Gr,w=C.hx,J=w.length;J--;){var f=w[J];f.ao(y,f.pg,t,k,u,v)}v=u.ps;y.colorMask(v,v,v,v);y.depthMask(u.Z);u.Da?y.enable(y.CULL_FACE):y.disable(y.CULL_FACE);v=u.X;for(u=0;u<v.length;u++)w=v[u],y.activeTexture(y.TEXTURE0+u),y.bindTexture(w.Sb,w.Wa);if("SKY"==t.type){v=t;C=C.Oj;u=v.j.Db.Wa;w=v.Is;for(J=0;6>J;J++)if(f=q(J),m.on?(y.bindTexture(y.TEXTURE_CUBE_MAP,u),y.texImage2D(f,0,y.RGBA,1,1,0,y.RGBA,y.UNSIGNED_BYTE,D)):(y.uniformMatrix4fv(C.u_cube_view_matrix,
!1,w[J]),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,f,u,0),b(z,r,k.oq)),v.Al&&3!=J){var f=v,N=J,P=n;m.on?P.set(D):(y.readPixels(191,191,1,1,y.RGBA,y.UNSIGNED_BYTE,P),255!=P[0]&&255!=P[1]&&255!=P[2]||y.readPixels(191,220,1,1,y.RGBA,y.UNSIGNED_BYTE,P));var V=P[0],R=P[1],P=P[2],V=V/255,R=R/255,P=P/255;2===N?(f.qc[3]=V,f.qc[7]=R,f.qc[11]=P):2>N?(f.qc[4*N]=V,f.qc[4*N+1]=R,f.qc[4*N+2]=P):(f.qc[4*(N-2)]=V,f.qc[4*(N-2)+1]=R,f.qc[4*(N-2)+2]=P)}t.Ii+=6}else b(z,r,k.oq),t.Ii++}p.nA("draw subscene: "+
a.type);y.bindFramebuffer(y.FRAMEBUFFER,null)}};a.clear=function(a){y.bindFramebuffer(y.FRAMEBUFFER,a.j.he);e(a)};a.Lz=function(a){var b=a.Gr;b.length=0;var d=a.$a;a=a.kc;d&&a||v.sa("Incomplete batch");d=d.tj;a=a.attributes;for(var e in a){var g=d[e];b.push({pg:a[e],Pz:4*g.offset,RB:1<g.frames?4*g.length:0,vg:g.vg})}};a.Oz=d;a.Dr=function(a){var b=a.kc,d=a.X;a=a.Vc;y.useProgram(b.wj);for(var e=0;e<d.length;e++)y.uniform1i(b.Oj[a[e]],e)};a.Sv=function(a,b,d,e,g,n){e||(e=1);g||(g=1);n||(n=new Uint8Array(4*
e*g));n.length!=4*e*g&&v.sa("read_pixels(): Wrong storage");y.bindFramebuffer(y.FRAMEBUFFER,a);y.readPixels(b,d,e,g,y.RGBA,y.UNSIGNED_BYTE,n);y.bindFramebuffer(y.FRAMEBUFFER,null);return n};a.bG=function(a){var b=a.kc;y.useProgram(b.wj);b.qj.length||d(b);b=b.jp.u_cube_fog;b.ao(y,b.pg,null,null,a,null)};a.yE=function(a,b){var d=y.createFramebuffer();y.bindFramebuffer(y.FRAMEBUFFER,d);if(a){var e=a,n=e.Wa,e=e.Sb==y.TEXTURE_CUBE_MAP?y.TEXTURE_CUBE_MAP_NEGATIVE_Z:e.Sb;y.framebufferTexture2D(y.FRAMEBUFFER,
y.COLOR_ATTACHMENT0,e,n,0)}g.Hu(b)?y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,b.wf):g.gj(b)&&(e=b,n=e.Wa,e=e.Sb,y.framebufferTexture2D(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,e,n,0));p.iA();y.bindFramebuffer(y.FRAMEBUFFER,null);return d};a.xE=function(a,b,d,e,n){null==a?(y.bindFramebuffer(y.FRAMEBUFFER,a),y.viewport(0,0,e,n),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT)):(g.gj(b)&&y.deleteTexture(b.Wa),g.Hu(d)?y.deleteRenderbuffer(d.wf):g.gj(d)&&y.deleteTexture(d.Wa),y.deleteFramebuffer(a))};
a.TK=function(){};a.Y=function(){}};b4w.module.__transform=function(a,w){function e(a){var n=a.d;d.eG(a,c);if("CAMERA"==a.type&&(q.dG(a),q.tA(a),q.px(a),n.ga==q.qa)){var l=t.ka(n.quat,t.nd,y);n.hm=0<l[1]}var l=n.g,z=n.scale,C=n.quat;m.Ij(l,z,C,n.Be);var w=n.R;D.identity(w);D.fromQuat(C,w);"CAMERA"!=a.type&&t.JE(w,z,w);w[12]=l[0];w[13]=l[1];w[14]=l[2];D.invert(w,n.Au);a.w.length&&p.so(a)&&p.fG(a);n.Ub&&n.Za&&(b.dn(n.Ub,w,n.Za),b.fn(n.Zc,w,n.Cb),b.en(n.Jf,n.Be,n.Kf),n.Cc&&g.Bp(g.v()));switch(a.type){case "SPEAKER":v.yF(a,c);break;case "CAMERA":q.mx(a);
g.fa()&&g.Wk(g.v())==a&&v.zD(g.v(),l,C,c);break;case "LAMP":h.iG(a);g.fa()&&g.hG(a,g.v());break;case "EMPTY":a.field&&g.ox(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!g.fa()||(n=g.v(),g.Bp(n),g.ME(n));a=a.Jc;for(n=0;n<a.length;n++)e(a[n])}var b=w("__boundings"),q=w("__camera"),d=w("__constraints"),h=w("__lights"),p=w("__particles"),g=w("__scenes"),v=w("__sfx"),m=w("__tsr"),t=w("__util"),z=w("vec3"),C=w("quat"),J=w("mat3"),D=w("mat4"),y=new Float32Array(3),n=new Float32Array(4),l=new Float32Array(9),c=0;
a.Gm=0;a.ek=1;a.update=function(a){c=a};a.kd=function(a,b){d.le(a)==d.Rd?m.eF(b,d.ie(a)):a.d.g.set(b)};a.zd=function(a,b){d.le(a)==d.Rd?z.copy(m.$t(d.ie(a)),b):z.copy(a.d.g,b)};a.Fd=function(a,b){d.le(a)==d.Rd?m.Ip(b,d.ie(a)):a.d.quat.set(b)};a.Se=function(a,b){d.le(a)==d.Rd?C.copy(m.Pt(d.ie(a)),b):C.copy(a.d.quat,b)};a.Jp=function(a,b){if(d.le(a)==d.Rd){var c=t.Qe(b,n);m.Ip(c,d.ie(a))}else t.Qe(b,a.d.quat)};a.gf=function(a,b){d.le(a)==d.Rd?m.gf(b,d.ie(a)):a.d.scale=b};a.al=function(a){return d.le(a)==
d.Rd?m.al(d.ie(a)):a.d.scale};a.QC=function(a,b){if(d.le(a)==d.Rd)m.copy(d.ie(a),b);else{var c=a.d;m.Ij(c.g,c.scale,c.quat,b)}};a.Bw=function(a,b){if(d.le(a)==d.Rd)m.copy(b,d.ie(a));else{var c=a.d;c.g[0]=b[0];c.g[1]=b[1];c.g[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}};a.ko=function(a){var b=a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.$k=function(a,b,c){c||
(c=new Float32Array(3));b?(b=a.d,z.copy(b.Cb.C,c)):(b=a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,z.transformMat4(c,b.R,c));return c};a.vc=function(a,b,c,d){a=a.d;var e=y;e[0]=b;e[1]=c;e[2]=d;b=J.fromMat4(a.R,l);z.transformMat3(e,b,e);z.add(a.g,e,a.g)};a.F=e;a.distance=function(a,b){return z.dist(a.d.g,b.d.g)};a.XD=function(a,b){return z.dist(a.d.g,b)};a.Lt=function(a){return{max_x:a.d.Za.max_x,min_x:a.d.Za.min_x,max_y:a.d.Za.max_y,min_y:a.d.Za.min_y,
max_z:a.d.Za.max_z,min_z:a.d.Za.min_z}}};b4w.module.__loader=function(a,w){function e(d,e,c,g){var m=y,h=C.create(),p;for(p in e){var v=b(e[p]);(g&&v.pb||!d&&v.Gb)&&z(v);C.A(h,v)}for(p in e)for(v=e[p],v.name=p,d=0;d<v.I.length;d++)C.m(h,e[v.I[d]],v,null);e=b({name:"out",Ta:a.Nx,ab:function(a,b,c,d,e){0===b.id&&(m.Hv=!0);3!=b.status&&(b.status=2);b.Xu(b.id,!0);e(b,c);J.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},sb:5});var q=[];if(c)for(c=C.Ut(h),d=0;d<c.length;d++)q.push(C.nb(h,c[d]));else C.U(h,function(a,b){b.lb||q.push(b)});
C.A(h,e);for(d=0;d<q.length;d++)e.I.push(q[d].name),C.m(h,q[d],e,null);return h}function b(a){a.lb=a.lb||!1;a.Ta||0===a.Ta||(a.Ta=a.rd);a.I=a.I||[];a.cj=a.cj||!1;a.Pp=a.Pp||!1;a.sb=a.sb||0;a.pb=a.pb||!1;a.Gb=a.Gb||!1;a.status=0;a.rL=0;a.Oo=0;a.Mf=a.Mf||null;return a}function q(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var g=b[e];C.nb(a.Jd,g).cj&&(C.tf(a.Jd,g,function(d){var e=!0;C.Ae(a.Jd,d,function(a,b){if(!b.cj)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=
d.length-1;0<=e;e--)b.splice(d[e],1);return c}function d(a){function b(c,d){var e=C.nb(a.Jd,c),g=C.nb(a.Jd,d),l=g.Ta-e.Ta;0==l&&(l=e.lb-g.lb);return l}var c=[],d=a.ze,e=!1;do{var g=q(a,d);c.push.apply(c,d);0<g.length&&(e=!0);d=g}while(0<g.length);e&&c.sort(b);a.ze=c;return a.ze.length}function h(a,b,c){if(b.Pp)return b.cj=!0,g(a,b),!1;if(!b.ab&&!b.fh&&!b.Ei)return g(a,b),!1;if(0==b.status&&(b.status++,b.ab))return b.ab(c,a,b,b.Mf,g,v),!0;if(1==b.status){if(b.fh)return b.fh(c,a,b,b.Mf,g,v),!0;b.status++}return 2==
b.status&&(b.status++,b.Ei)?(b.Ei(c,a,b,b.Mf,g,v),!0):!1}function p(a){if(0==a.fm)return 100;var b=0;C.U(a.Jd,function(c,d){a.do_not_load_resources&&d.pb||(b+=d.Oo*d.sb)});return D.trunc(100*b/a.fm)}function g(a,b){b.cj=!0;b.status=3;m(a,b,1)}function v(a,b,c){1>c?m(a,b,c):b.status++}function m(a,b,c){var d=y;if(b.ab||b.fh||b.Ei)if(b.Oo=c,b=p(a),a.Ks!=b||1==c)a.Vp(b,performance.now()-a.ex),a.Ks=b,d.So=!0}function t(a,b){var c=null;C.U(a.Jd,function(a,d){if(d.name==b)return c=d,1});return c}function z(a){a.Pp=
!0;a.Oo=1}var C=w("__graph"),J=w("__print"),D=w("__util");a.rd=0;a.Af=1;a.Nx=2;var y=null;a.St=function(){return y};a.WA=function(){var a={Md:[],Fn:0,Km:0,Hv:!1,So:!1};return y=a};a.dB=function(a,b,c,d,g,m,h,p){var v=y,k={id:v.Md.length,status:0,s:b,Mr:"",Xu:c||function(){},No:p||!1,hN:m,ex:0,Ks:0,fm:0,Ap:!1,Vp:d||function(){},rs:g||function(){},Jd:null,ze:null,yo:!1,uo:!1,Bo:!1};a=e(0===k.id,a,m,h);k.Jd=a;b=[];c=C.MC(a);for(d=0;d<c.length;d++)b.push(c[d]);k.ze=b;C.U(a,function(a,b){!(b.ab||b.fh||
b.Ei)||k.do_not_load_resources&&b.pb||(k.fm+=b.sb)});v.Md.push(k);v.Km++;return k.id};a.mG=function(b){var e=y;if(e&&0!=y.Km)if(e.So)e.So=!1;else{var c=performance.now();do{var g=e.Md[e.Fn],m=b[g.id];if(3!=g.status)if(0==g.status&&(g.status=1,g.ex=performance.now(),g.Vp(0,0)),d(g)){var p=g,v=p.ze.length;do{var q=C.nb(p.Jd,p.ze[0]),t=h(p,q,m);q.Ta==a.Af&&(p.Ap=!0);q=p.ze.shift();p.ze.push(q);v--}while(!t&&0!=v)}else g.rs(m,g),g.status=3,e.Km--,p=g,p.Vp=null,p.rs=null,p.Jd=null,p.ze=null;e.Hv&&(e.Fn=
(e.Fn+1)%e.Md.length);if(g.Ap){g.Ap=!1;break}}while(16>performance.now()-c)}};a.OM=v;a.Jw=function(a,b){var c=t(a,b);null!==c&&z(c)};a.TF=function(a){return a&&3==a.status};a.oe=function(a){var b=y;if(!b)return!1;a|=0;return b.Md[a]&&(3==b.Md[a].status||2==b.Md[a].status)};a.Y=function(){y=null}};b4w.module.__primitives=function(a,w){function e(a,b,d,e){for(var g=[],h=[],q=[],y=[],n=2*d/(a-1),l=2*e/(b-1),c=0;c<a;c++)for(var w=-d+c*n,I=0;I<b;I++)if(h.push(w,0,-e+I*l),q.push(0,1,0),y.push(c/(a-1),I/(b-1)),c&&I){var x=c*b+I,B=x-1,E=(c-1)*b+I,K=E-1;g.push(x,B,E);g.push(B,K,E)}a=p.$c();a.a_position=new Float32Array(h);a.a_normal=new Float32Array(q);q=p.mb("GRID_PLANE");q.u[0]=a;q.G.a_texcoord=new Float32Array(y);q.ca=new Uint32Array(g);q.J=h.length/3;return q}function b(a){var b=a.length;if(b%
4)throw"Wrong array";for(var e=[],g=[],h=0;h<b;h+=4){var q=a[h+1],w=a[h+2],y=a[h+3];d(a[h],g);d(q,g);d(w,g);d(y,g);e.push(h,h+1,h+2);e.push(h,h+2,h+3)}a=p.$c();a.a_position=new Float32Array(g);b=p.mb("FROM_QUADS");b.u[0]=a;b.ca=new Uint32Array(e);b.J=g.length/3;return b}function q(a,b){var d=3*b;return[a[d],a[d+1],a[d+2]]}function d(a,b){b.push(a[0],a[1],a[2])}var h=w("__geometry"),p=w("__util"),g=w("__config").p;a.TJ=function(a){for(var b=p.mb("LINE"),d=[],e=0;e<2*a;e++)d.push(e);e=p.$c();e.a_point=
new Float32Array(d);b.u[0]=e;b.ca=new Uint32Array(d);b.J=2*a;return b};a.UJ=function(a,b){var d=e(2,2,a,b);d.name="PLANE";return d};a.SJ=e;a.fC=function(a,b,d){function e(a,b){return 1==a%2&&(0==b||b==y-1)||1==b%2&&(0==a||a==D-1)?!0:!1}var q=d/=Math.pow(2,a-1),w=d,D=b+1,y=b+1;b=[];d=[];for(var n=0,l=0,c=-1,M=[],I=0;I<a;I++){for(var x=2*q/(D-1),B=2*w/(y-1),E=[],K=[],k=0,u=0;u<D;u++){for(var r=-q+u*x,L=[],F=0;F<y;F++){var f=-w+F*B;if(r>-n&&r<n&&f>-l&&f<l)L.push(-1),k++;else{for(var N=null,P=0;P<M.length;P+=
3)if(r==M[P]&&f==M[P+1]){N=M[P+2];break}P=null!==N?N:c+1;e(u,F)?(L.push(-2),k++):(null==N&&(0==F||F==y-1||0==u||u==D-1?(N=I==a-1?x:2*x,E.push(r,f,P)):N=x,d.push(r,N,f),c++),L.push(P));if(u&&F)if(1==u)if(e(u-1,F)){if(1<F){var f=P-1,N=K[u-1][F+1],V=N-1;b.push(P,f,V)}else N=K[u-1][F+1],V=N-1;b.push(P,V,N)}else e(u,F)||(f=P-1,N=K[u-1][F],b.push(P,f,N));else if(u==D-1){if(!e(u,F))if(F==y-1)f=P-1,N=K[u-1][F-1],V=K[u-2][F],b.push(P,f,N),b.push(P,N,V);else{var f=P-1,N=K[u-1][F],V=N-1,R=N+1;b.push(P,f,V);
b.push(P,V,N);b.push(P,N,R);2==F&&(R=K[u-2][F-2],b.push(f,R,V))}}else 1==F?e(u,F-1)?(f=K[u-1][F],N=K[u-1][F-1],b.push(P,N,f)):(f=L[F-1],N=K[u-1][F],V=K[u-2][F-1],b.push(P,f,N),b.push(f,V,N)):F==y-1?e(u,F)||(f=L[F-1],N=K[u-1][F-1],V=K[u-2][F],b.push(P,f,N),b.push(P,N,V)):-1!=K[u-1][F]&&-1!=K[u-1][F-1]&&-1!=L[F-1]?(f=L[F-1],N=K[u-1][F],V=K[u-1][F-1],b.push(P,f,N),b.push(f,V,N),F==y-2&&e(u,F+1)&&(R=K[u-1][F+1],b.push(P,N,R))):F==y-2&&e(u,F+1)&&(N=K[u-1][F],R=K[u-1][F+1],b.push(P,N,R))}}K.push(L)}M=E;
n=q;l=w;q*=2;w*=2}2E4>n&&(a=-(2*n)/(D-1),d.push(-2E4,a,-2E4),d.push(-2E4,a,2E4),d.push(-n,a,-l),d.push(-n,a,l),d.push(2E4,a,-2E4),d.push(2E4,a,2E4),d.push(n,a,-l),d.push(n,a,l),P=c+1,b.push(P+3,P+2,P+1,P+2,P+0,P+1,P+6,P+4,P+2,P+4,P+0,P+2,P+5,P+7,P+1,P+7,P+3,P+1,P+5,P+4,P+7,P+7,P+4,P+6));a=p.$c();a.a_position=new Float32Array(d);q=p.mb("multigrid_plane");q.u[0]=a;q.ca=new Uint32Array(b);q.J=d.length/3;g.Ex&&(h.Zp(q,1,!0),a.a_polyindex=h.at(q));return q};a.RJ=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var e=[],g=[],h=0;h<b;h+=3){var q=a[h+1],w=a[h+2];d(a[h],g);d(q,g);d(w,g);e.push(h,h+1,h+2)}a=p.$c();a.a_position=new Float32Array(g);b=p.mb("FROM_TRIANGLES");b.u[0]=a;b.ca=new Uint32Array(e);b.J=g.length/3;return b};a.QJ=b;a.cC=function(a){a=p.zG(a);var d=[];d.push(a[0],a[1],a[2],a[3]);d.push(a[0],a[3],a[5],a[4]);d.push(a[3],a[2],a[6],a[5]);d.push(a[1],a[7],a[6],a[2]);d.push(a[0],a[4],a[7],a[1]);d.push(a[4],a[5],a[6],a[7]);a=b(d);a.name="FRUSTUM";return a};a.eb=function(){var a=p.mb("FULLSCREEN_TRI"),
b=p.$c();b.a_position=new Float32Array([0,0,1,0,0,1]);a.u[0]=b;a.ca=new Uint32Array([0,1,2]);a.J=3;return a};a.dC=function(){var a=p.mb("FULLSCREEN_QUAD"),b=p.$c();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.u[0]=b;a.ca=new Uint32Array([0,2,1,1,2,3]);a.J=4;return a};a.ZB=function(){var a=p.mb("BILLBOARD"),b=p.$c();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.u[0]=b;a.ca=new Uint32Array([0,2,1,0,3,2]);a.J=4;return a};a.$B=function(){var a=p.mb("CUBEMAP_BOARD"),b=p.$c();
b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.u[0]=b;a.ca=new Uint32Array([0,2,1,0,3,2]);a.J=4;return a};a.pt=function(a,b){var e=p.mb("UV_SPHERE"),g,C,w=[],D=[],y=[];for(C=0;8>=C;C++)for(g=0;16>=g;g++){var n=g/16,l=C/8;D.push(-a*Math.cos(2*n*Math.PI)*Math.sin(l*Math.PI)+b[0],a*Math.cos(l*Math.PI)+b[1],a*Math.sin(2*n*Math.PI)*Math.sin(l*Math.PI)+b[2])}for(C=n=0;8>C;C++)for(g=0;16>g;g++){var l=q(D,17*C+g+1),c=q(D,17*C+g),M=q(D,17*(C+1)+g),I=q(D,17*(C+1)+g+1);Math.abs(l[1])==a+b[1]?(d(l,w),
d(M,w),d(I,w),y.push(n,n+1,n+2),n+=3):Math.abs(M[1])==a+b[1]?(d(l,w),d(c,w),d(M,w),y.push(n,n+1,n+2),n+=3):(d(l,w),d(c,w),d(M,w),d(I,w),y.push(n,n+1,n+2),y.push(n,n+2,n+3),n+=4)}g={};g.a_position=w;D=h.aA(y,D,w);g.a_normal=h.$z(y,w,D);g.a_tangent=[];e.G.a_influence=[];e.G.a_color=[];e.G.a_texcoord=[];e.u[0]=g;e.ca=y;e.J=w.length/3;return e};a.ot=function(a){var b=p.mb("INDEX"),d=p.$c();d.a_index=new Float32Array(a);for(var e=0;e<a;e++)d.a_index[e]=e;b.u[0]=d;b.ca=new Uint16Array(0);b.J=a;return b}};b4w.module.__reformer=function(a,w){function e(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=
.5,b("node material",a,"specular_toon_size"));"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in
a||(a.diffuse_fresnel_factor=.5,b("node material",a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name=
"B4W_"+a.node_tree_name}}}function b(a,b,d){d=d+">>"+a;d in J||(J[d]={Yp:[],Xv:"undefined",type:a});J[d].Yp.push(b.name)}function q(a,b){param_id in J||(J[param_id]={Yp:[],Xv:"deprecated",type:a});J[param_id].Yp.push(b.name)}function d(a,b){b||(b=a.name+"_COPY");var d=a.materials,e=a.submeshes;a.materials=null;a.submeshes=null;var c=v.Nf(a);a.materials=d;a.submeshes=e;c.name=b;c.materials=a.materials.slice(0);c.submeshes=[];for(d=0;d<e.length;d++){var g=v.zk(e[d]);c.submeshes.push(g)}return c}var h=
w("__boundings"),p=w("__curve"),g=w("__print"),v=w("__util"),m=w("vec3"),t=w("vec4"),z=w("quat"),C=w("mat4"),J={};a.jA=function(a){J={};var d=a.worlds;if(0==d.length){g.warn("WARNING Datablock world is missing, reexport scene");var h={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},b4w_fog_color:[.5,.5,.5],b4w_fog_density:0};d.push(h)}for(var d=a.worlds,l=0;l<d.length;l++){var h=d[l],c=h.b4w_shadow_settings;
"csm_resolution"in c||(b("world",h,"b4w_shadow_settings.csm_resolution"),c.csm_resolution=2048);"self_shadow_polygon_offset"in c||(b("world",h,"b4w_shadow_settings.self_shadow_polygon_offset"),c.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in c||(b("world",h,"b4w_shadow_settings.self_shadow_normal_offset"),c.self_shadow_normal_offset=.01);"b4w_enable_csm"in c||(b("world",h,"b4w_shadow_settings.b4w_enable_csm"),c.b4w_enable_csm=!1);"csm_num"in c||(b("world",h,"b4w_shadow_settings.csm_num"),
c.csm_num=1);"csm_first_cascade_border"in c||(b("world",h,"b4w_shadow_settings.csm_first_cascade_border"),c.csm_first_cascade_border=10);"first_cascade_blur_radius"in c||(b("world",h,"b4w_shadow_settings.first_cascade_blur_radius"),c.first_cascade_blur_radius=3);"csm_last_cascade_border"in c||(b("world",h,"b4w_shadow_settings.csm_last_cascade_border"),c.csm_last_cascade_border=100);"last_cascade_blur_radius"in c||(b("world",h,"b4w_shadow_settings.last_cascade_blur_radius"),c.last_cascade_blur_radius=
1.5);"fade_last_cascade"in c||(b("world",h,"b4w_shadow_settings.fade_last_cascade"),c.fade_last_cascade=!0);"blend_between_cascades"in c||(b("world",h,"b4w_shadow_settings.blend_between_cascades"),c.blend_between_cascades=!0);c=h.b4w_ssao_settings;"dist_factor"in c||(b("world",h,"b4w_ssao_settings.dist_factor"),c.dist_factor=0,c.samples=16);"hemisphere"in c||(b("world",h,"b4w_ssao_settings.hemisphere"),c.hemisphere=!1);"blur_depth"in c||(b("world",h,"b4w_ssao_settings.blur_depth"),c.blur_depth=!1);
"blur_discard_value"in c||(b("world",h,"b4w_ssao_settings.blur_discard_value"),c.blur_discard_value=1);"b4w_glow_color"in h||(h.b4w_glow_color=[1,1,1],b("object",h,"b4w_glow_color"));"b4w_glow_factor"in h||(h.b4w_glow_factor=1,b("object",h,"b4w_glow_factor"));"b4w_fog_density"in h||(b("world",h,"b4w_fog_density"),h.b4w_fog_density=0);"b4w_sky_settings"in h&&"rayleigh_brightness"in h.b4w_sky_settings||(b("world",h,"rayleigh_brightness"),h.b4w_sky_settings={procedural_skydome:!1,use_as_enviroment_map:!1,
color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"b4w_bloom_settings"in h?("blur"in h.b4w_bloom_settings||(b("world",h,"b4w_bloom_settings.blur"),h.b4w_bloom_settings.blur=4),"edge_lum"in h.b4w_bloom_settings||(b("world",h,"b4w_bloom_settings.edge_lum"),h.b4w_bloom_settings.edge_lum=1)):(b("world",h,"b4w_bloom_settings"),h.b4w_bloom_settings=
{key:.2,blur:4});"b4w_motion_blur_settings"in h?("motion_blur_factor"in h.b4w_motion_blur_settings||(b("world",h,"b4w_motion_blur_settings.motion_blur_factor"),h.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in h.b4w_motion_blur_settings||(b("world",h,"b4w_motion_blur_settings.motion_blur_decay_threshold"),h.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(b("world",h,"b4w_motion_blur_settings"),h.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});
"b4w_color_correction_settings"in h||(b("world",h,"b4w_color_correction_settings"),h.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in h.b4w_god_rays_settings||(b("world",h,"b4w_god_rays_settings.steps_per_pass"),h.b4w_god_rays_settings.steps_per_pass=10)}d=a.scenes;for(l=0;l<d.length;l++)h=d[l],"b4w_use_nla"in h||(h.b4w_use_nla=!1,b("scene",h,"b4w_use_nla")),"fps"in h||(h.fps=24,b("scene",h,"fps")),"b4w_nla_cyclic"in h||(h.b4w_nla_cyclic=!1,b("scene",
h,"b4w_nla_cyclic")),"b4w_nla_script"in h||(h.b4w_nla_script=[],b("scene",h,"b4w_nla_script")),"b4w_detect_collisions"in h&&(q("scene",h),delete h.b4w_detect_collisions),"audio_doppler_speed"in h||(h.audio_doppler_speed=343.3),"audio_doppler_factor"in h||(h.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in h||(h.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",h,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in h||(h.b4w_enable_convolution_engine=
!1),"b4w_enable_bloom"in h||(h.b4w_enable_bloom=!1,b("scene",h,"b4w_enable_bloom")),"b4w_enable_motion_blur"in h||(h.b4w_enable_motion_blur=!1,b("scene",h,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in h||(h.b4w_enable_color_correction=!1,b("scene",h,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in h||(h.b4w_enable_antialiasing=!0,b("scene",h,"b4w_enable_antialiasing")),"b4w_tags"in h||(h.b4w_tags={title:"",description:""},b("scene",h,"b4w_tags"));h=a.meshes;for(l=0;l<h.length;l++)for(c=
h[l],c.b4w_bounding_box||(b("mesh",c,"b4w_bounding_box"),c.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0}),c.uv_textures||(b("mesh",c,"uv_textures"),c.uv_textures=[]),c.b4w_bounding_sphere_center||(c.b4w_bounding_sphere_center=[0,0,0]),c.b4w_bounding_cylinder_center||(c.b4w_bounding_cylinder_center=[0,0,0]),c.b4w_bounding_ellipsoid_center||(c.b4w_bounding_ellipsoid_center=[0,0,0]),c.b4w_bounding_ellipsoid_axes||(d=c.b4w_bounding_box,c.b4w_bounding_ellipsoid_axes=[(d.max_x-d.min_x)/
2,(d.max_y-d.min_y)/2,(d.max_z-d.min_z)/2]),d=0;d<c.b4w_vertex_anim.length;d++){var m=c.b4w_vertex_anim[d];"allow_nla"in m||(b('mesh["b4w_vertex_anim"]',c,"allow_nla"),m.allow_nla=!0)}d=a.cameras;for(l=0;l<d.length;l++)h=d[l],h.type||(h.type="PERSP",b("camera",h,"type")),"b4w_eye_target_dist"in h&&(delete h.b4w_eye_target_dist,q("camera",h)),"b4w_trans_velocity"in h||(h.b4w_trans_velocity=1,b("camera",h,"b4w_trans_velocity")),"b4w_rot_velocity"in h||(h.b4w_rot_velocity=1,b("camera",h,"b4w_rot_velocity")),
"b4w_zoom_velocity"in h||(h.b4w_zoom_velocity=.1,b("camera",h,"b4w_zoom_velocity")),"b4w_use_distance_limits"in h||(h.b4w_use_distance_limits=!1,b("camera",h,"b4w_use_distance_limits")),"b4w_distance_min"in h||(h.b4w_distance_min=1,b("camera",h,"b4w_distance_min")),"b4w_distance_max"in h||(h.b4w_distance_max=100,b("camera",h,"b4w_distance_max")),"b4w_horizontal_translation_min"in h||(h.b4w_horizontal_translation_min=-100,b("camera",h,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in
h||(h.b4w_horizontal_translation_max=100,b("camera",h,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in h||(h.b4w_vertical_translation_min=-100,b("camera",h,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in h||(h.b4w_vertical_translation_max=100,b("camera",h,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in h||(h.b4w_use_horizontal_clamping=!1,b("camera",h,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in h||(h.b4w_rotation_left_limit=-Math.PI,
b("camera",h,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in h||(h.b4w_rotation_right_limit=Math.PI,b("camera",h,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in h||(h.b4w_horizontal_clamping_type="LOCAL",b("camera",h,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in h||(h.b4w_use_vertical_clamping=!1,b("camera",h,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in h||(h.b4w_rotation_down_limit=-Math.PI/2,b("camera",h,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in
h||(h.b4w_rotation_up_limit=Math.PI/2,b("camera",h,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in h||(h.b4w_vertical_clamping_type="LOCAL",b("camera",h,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in h||(h.b4w_hover_angle_min=Math.PI/6,b("camera",h,"b4w_hover_angle_min")),"b4w_hover_angle_max"in h||(h.b4w_hover_angle_max=Math.PI/6,b("camera",h,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in h||(h.b4w_enable_hover_hor_rotation=!0,b("camera",h,"b4w_enable_hover_hor_rotation")),
"b4w_use_panning"in h||(h.b4w_use_panning=!0,b("camera",h,"b4w_use_panning"));d=a.lamps;for(l=0;l<d.length;l++)h=d[l],"b4w_generate_shadows"in h||(h.b4w_generate_shadows=!1,b("lamp",h,"b4w_generate_shadows")),"b4w_dynamic_intensity"in h||(h.b4w_dynamic_intensity=!1,b("lamp",h,"b4w_dynamic_intensity")),"use_diffuse"in h||(h.use_diffuse=!0,b("lamp",h,"use_diffuse")),"use_specular"in h||(h.use_specular=!0,b("lamp",h,"use_specular"));d=a.speakers;for(l=0;l<d.length;l++)h=d[l],"b4w_behavior"in h||(h.b4w_behavior=
h.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in h||(h.b4w_disable_doppler=!1),"b4w_delay"in h||(h.b4w_delay=0),"b4w_delay_random"in h||(h.b4w_delay_random=0),"b4w_volume_random"in h||(h.b4w_volume_random=0),"b4w_pitch_random"in h||(h.b4w_pitch_random=0),"b4w_fade_in"in h||(h.b4w_fade_in=0),"b4w_fade_out"in h||(h.b4w_fade_out=0),"b4w_loop"in h||(h.b4w_loop=!1),"b4w_loop_count"in h||(h.b4w_loop_count=0),"b4w_loop_count_random"in h||(h.b4w_loop_count_random=0),"b4w_playlist_id"in
h||(h.b4w_playlist_id="");d=a.textures;for(l=0;l<d.length;l++)h=d[l],"b4w_anisotropic_filtering"in h||(h.b4w_anisotropic_filtering="OFF",b("texture",h,"b4w_anisotropic_filtering")),"b4w_water_foam"in h||(h.b4w_water_foam=!1,b("texture",h,"b4w_water_foam")),"b4w_foam_uv_freq"in h||(h.b4w_foam_uv_freq=[1,1],b("texture",h,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in h||(h.b4w_foam_uv_magnitude=[1,1],b("texture",h,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in h||(h.b4w_parallax_steps=5,b("material",
h,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in h||(h.b4w_parallax_lod_dist=10,b("material",h,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in h||(h.b4w_shore_dist_map=!1,b("texture",h,"b4w_shore_dist_map")),"b4w_shore_boundings"in h||(h.b4w_shore_boundings=new Float32Array(4),h.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",h,"b4w_shore_boundings")),"b4w_max_shore_dist"in h||(h.b4w_max_shore_dist=100,b("texture",h,"b4w_max_shore_dist")),"b4w_disable_compression"in h||(h.b4w_disable_compression=
!1,b("texture",h,"b4w_disable_compression")),"b4w_source_type"in h||(h.b4w_source_type="",b("texture",h,"b4w_source_type")),"b4w_source_id"in h||(h.b4w_source_id="",b("texture",h,"b4w_source_id")),"b4w_source_size"in h||(h.b4w_source_size=1024,b("texture",h,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in h||(h.b4w_enable_canvas_mipmapping=!0,b("texture",h,"b4w_enable_canvas_mipmapping"));h=a.materials;for(l=0;l<h.length;l++){c=h[l];"b4w_node_mat_type"in c&&q("material",c);"b4w_skydome"in c&&
q("material",c);"b4w_procedural_skydome"in c&&q("material",c);c.b4w_water&&("b4w_water_shore_smoothing"in c||(c.b4w_water_shore_smoothing=!1,b("material",c,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in c||(c.b4w_water_dynamic=!1,b("material",c,"b4w_water_dynamic")),"b4w_waves_height"in c||(c.b4w_waves_height=1,b("material",c,"b4w_waves_height")),"b4w_waves_length"in c||(c.b4w_waves_length=1,b("material",c,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in c||(c.b4w_water_dst_noise_scale0=.05,
b("material",c,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in c||(c.b4w_water_dst_noise_scale1=.03,b("material",c,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in c||(c.b4w_water_dst_noise_freq0=1.3,b("material",c,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in c||(c.b4w_water_dst_noise_freq1=1,b("material",c,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in c||(c.b4w_water_dir_min_shore_fac=.4,b("material",c,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in
c||(c.b4w_water_dir_freq=.5,b("material",c,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in c||(c.b4w_water_dir_noise_scale=.05,b("material",c,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in c||(c.b4w_water_dir_noise_freq=.07,b("material",c,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in c||(c.b4w_water_dir_min_noise_fac=.5,b("material",c,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in c||(c.b4w_water_dst_min_fac=.2,b("material",c,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in
c||(c.b4w_water_waves_hor_fac=5,b("material",c,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in c||(c.b4w_water_absorb_factor=6,b("material",c,"b4w_water_absorb_factor")),"b4w_water_fog_color"in c||(c.b4w_water_fog_color=new Float32Array(3),c.b4w_water_fog_color=[.5,.7,.7],b("material",c,"b4w_water_fog_color")),"b4w_foam_factor"in c||(c.b4w_foam_factor=5,b("material",c,"b4w_foam_factor")),"b4w_generated_mesh"in c||(c.b4w_generated_mesh=!1,b("material",c,"b4w_generated_mesh")),"b4w_water_num_cascads"in
c||(c.b4w_water_num_cascads=5,b("material",c,"b4w_water_num_cascads")),"b4w_water_subdivs"in c||(c.b4w_water_subdivs=64,b("material",c,"b4w_water_subdivs")),"b4w_water_detailed_dist"in c||(c.b4w_water_detailed_dist=1E3,b("material",c,"b4w_water_detailed_dist")));"b4w_dynamic_grass_size"in c||(c.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in c||(c.b4w_dynamic_grass_color="");"diffuse_intensity"in c||(c.diffuse_intensity=1,b("material",c,"diffuse_intensity"));"b4w_use_ghost"in c||(c.b4w_use_ghost=
!1);"b4w_collision_group"in c||(c.b4w_collision_group=128,b("material",c,"b4w_collision_group"));"b4w_collision_mask"in c||(c.b4w_collision_mask=127,b("material",c,"b4w_collision_mask"));"b4w_do_not_render"in c||(c.b4w_do_not_render=!1,b("material",c,"b4w_do_not_render"));"HALO"!=c.type||"b4w_halo_sky_stars"in c||(c.b4w_halo_sky_stars=!1,b("material",c,"b4w_halo_sky_stars"));"HALO"!=c.type||"b4w_halo_stars_blend_height"in c||(c.b4w_halo_stars_blend_height=10,b("material",c,"b4w_halo_stars_blend_height"));
"HALO"!=c.type||"b4w_halo_stars_min_height"in c||(c.b4w_halo_stars_min_height=0,b("material",c,"b4w_halo_stars_min_height"));"specular_shader"in c||(c.specular_shader="COOKTORR",b("material",c,"specular_shader"));"diffuse_shader"in c||(c.diffuse_shader="LAMBERT",b("material",c,"diffuse_shader"));"roughness"in c||(c.roughness=.5,b("material",c,"roughness"));"diffuse_fresnel"in c||(c.diffuse_fresnel=.1,b("material",c,"diffuse_fresnel"));"diffuse_fresnel_factor"in c||(c.diffuse_fresnel_factor=.5,b("material",
c,"diffuse_fresnel_factor"));"specular_slope"in c||(c.specular_slope=.2,b("material",c,"specular_slope"));"specular_toon_size"in c||(c.specular_toon_size=.5,b("material",c,"specular_toon_size"));"specular_toon_smooth"in c||(c.specular_toon_smooth=.1,b("material",c,"specular_toon_smooth"));"specular_alpha"in c||(c.specular_alpha=1,b("material",c,"specular_alpha"));"b4w_wettable"in c||(c.b4w_wettable=!1,b("material",c,"b4w_wettable"));"b4w_refractive"in c||(c.b4w_refractive=!1,b("material",c,"b4w_refractive"));
"b4w_refr_bump"in c||(c.b4w_refr_bump=0,b("material",c,"b4w_refr_bump"));"b4w_shallow_water_col"in c||(c.b4w_shallow_water_col=[0,.8,.3],b("material",c,"b4w_shallow_water_col"));"b4w_shore_water_col"in c||(c.b4w_shore_water_col=[0,.9,.2],b("material",c,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in c||(c.b4w_shallow_water_col_fac=1,b("material",c,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in c||(c.b4w_shore_water_col_fac=.5,b("material",c,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in
c||(c.b4w_water_sss_strength=5.9,b("material",c,"b4w_water_sss_strength"));"b4w_water_sss_width"in c||(c.b4w_water_sss_width=.45,b("material",c,"b4w_water_sss_width"));"b4w_render_above_all"in c||(c.b4w_render_above_all=!1,b("material",c,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in c||(c.b4w_water_norm_uv_velocity=.05,b("material",c,"b4w_water_norm_uv_velocity"));m=c.texture_slots;for(d=0;d<m.length;d++){var p=m[d];"blend_type"in p||(p.blend_type="MIX",b("texture_slot",p,"blend_type"))}if(c.node_tree)for(c=
c.node_tree.nodes,d=0;d<c.length;d++)e(c[d])}h=a.node_groups;for(l=0;l<h.length;l++)for(c=h[l].node_tree.nodes,d=0;d<c.length;d++)e(c[d]);h=a.objects;for(l=0;l<h.length;l++){c=h[l];switch(c.type){case "MESH":"b4w_dynamic_geometry"in c||(c.b4w_dynamic_geometry=!1);"b4w_reflexible"in c||(c.b4w_reflexible=!1);"b4w_reflexible_only"in c||(c.b4w_reflexible_only=!1);"b4w_reflective"in c||(c.b4w_reflective=!1);"b4w_wind_bending"in c||(c.b4w_wind_bending=!1,b("object",c,"b4w_wind_bending"));"b4w_wind_bending_angle"in
c||(c.b4w_wind_bending_angle=10,c.b4w_wind_bending_freq=.25,b("object",c,"wind bending params"));"b4w_detail_bending_amp"in c||(c.b4w_detail_bending_amp=.1,c.b4w_branch_bending_amp=.3,b("object",c,"detail bending params"));"b4w_detail_bending_freq"in c||(c.b4w_detail_bending_freq=1,b("object",c,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in c||(c.b4w_main_bend_stiffness_col="",b("object",c,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in c||(c.b4w_detail_bend_colors={leaves_stiffness_col:"",
leaves_phase_col:"",overall_stiffness_col:""},b("object",c,"b4w_detail_bend_colors"));"b4w_caustics"in c||(c.b4w_caustics=!1);"vertex_groups"in c&&c.vertex_groups.length&&c.data&&0==c.data.vertex_groups.length&&(c.data.vertex_groups=c.vertex_groups,delete c.vertex_groups,b("object",c,"vertex_groups"));"b4w_vertex_anim"in c&&c.b4w_vertex_anim.length&&c.data&&0==c.data.b4w_vertex_anim.length&&(c.data.b4w_vertex_anim=c.b4w_vertex_anim,delete c.b4w_vertex_anim,b("object",c,"b4w_vertex_anim"));"b4w_do_not_render"in
c||(c.b4w_do_not_render=!1);"use_ghost"in c.game||(c.game.use_ghost=!1);"use_sleep"in c.game||(c.game.use_sleep=!1);"velocity_min"in c.game||(c.game.velocity_min=0);"velocity_max"in c.game||(c.game.velocity_max=0);"collision_group"in c.game||(c.game.collision_group=1);"collision_mask"in c.game||(c.game.collision_mask=255);"b4w_vehicle_settings"in c?c.b4w_vehicle_settings&&("steering_ratio"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.steering_ratio=10),"steering_max"in c.b4w_vehicle_settings||
(c.b4w_vehicle_settings.steering_max=1),"inverse_control"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.inverse_control=!1),"force_max"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.force_max=1500),"brake_max"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.brake_max=100),"speed_ratio"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in c.b4w_vehicle_settings||
(c.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.roll_influence=
.1),"max_suspension_travel_cm"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.floating_factor=3),"floating_factor"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in c.b4w_vehicle_settings||(c.b4w_vehicle_settings.water_rot_damp=.9)):(c.b4w_vehicle_settings=null,b("object",c,"b4w_vehicle_settings"));
"b4w_floating_settings"in c?c.b4w_floating_settings&&("floating_factor"in c.b4w_floating_settings||(c.b4w_floating_settings.floating_factor=3),"water_lin_damp"in c.b4w_floating_settings||(c.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in c.b4w_floating_settings||(c.b4w_floating_settings.water_rot_damp=.8)):(c.b4w_floating_settings=null,b("object",c,"b4w_floating_settings"));"b4w_character_settings"in c?c.b4w_character_settings&&("walk_speed"in c.b4w_character_settings||(c.b4w_character_settings.walk_speed=
4),"run_speed"in c.b4w_character_settings||(c.b4w_character_settings.run_speed=8),"step_height"in c.b4w_character_settings||(c.b4w_character_settings.step_height=.25),"jump_strength"in c.b4w_character_settings||(c.b4w_character_settings.jump_strength=5),"waterline"in c.b4w_character_settings||(c.b4w_character_settings.waterline=0)):(c.b4w_character_settings=null,b("object",c,"b4w_character_settings"));"b4w_selectable"in c||(c.b4w_selectable=!1,b("object",c,"b4w_selectable"));"b4w_billboard"in c||
(c.b4w_billboard=!1,b("object",c,"b4w_billboard"));"b4w_billboard_geometry"in c||(c.b4w_billboard_geometry="SPHERICAL",b("object",c,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in c||(c.b4w_pres_glob_orientation=!1,b("object",c,"b4w_pres_glob_orientation"));"b4w_glow_settings"in c||(c.b4w_glow_settings={},c.b4w_glow_settings.glow_duration=1,c.b4w_glow_settings.glow_period=1,c.b4w_glow_settings.glow_relapses=0,b("object",c,"b4w_glow_settings"));"b4w_lod_transition"in c||(c.b4w_lod_transition=
.01,b("object",c,"b4w_lod_transition"));"lod_levels"in c||(c.lod_levels=[],b("object",c,"lod_levels"));"b4w_animation_mixing"in c||(c.b4w_animation_mixing=!1,b("object",c,"b4w_animation_mixing"));break;case "EMPTY":"b4w_group_relative"in c||(c.b4w_group_relative=!1,b("object",c,"b4w_group_relative")),"b4w_anchor"in c||(c.b4w_anchor=null,b("object",c,"b4w_anchor"))}"b4w_anim_behavior"in c||(c.b4w_anim_behavior=c.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",c,"b4w_anim_behavior"));if(!("rotation_quaternion"in
c)){d=[0,0,0,1];v.Qe(c.rotation_euler,d);var m=d,p=d[0],t=d[1],z=d[2];m[0]=d[3];m[1]=p;m[2]=t;m[3]=z;c.rotation_quaternion=d;b("object",c,"rotation_quaternion")}"webgl_do_not_batch"in c&&(c.b4w_do_not_batch=c.webgl_do_not_batch)&&q("object",c);"b4w_shadow_cast_only"in c||(c.b4w_shadow_cast_only=!1,b("object",c,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in c||(c.b4w_correct_bounding_offset="AUTO",b("object",c,"b4w_correct_bounding_offset"));m=c.particle_systems;for(d=0;d<m.length;d++)p=
m[d],t=p.settings,"use_whole_group"in t||(t.use_whole_group=!1,b("object",t,"use_whole_group")),p.transforms||(p.transforms=new Float32Array,b("particle_system",p,"transforms")),"b4w_billboard_align"in t||(t.b4w_billboard_align="VIEW",b("particle_settings",t,"b4w_billboard_align")),"b4w_dynamic_grass"in t||(t.b4w_dynamic_grass=!1,b("object",t,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in t||(t.b4w_dynamic_grass_scale_threshold=.01,b("object",t,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in
t||(t.b4w_initial_rand_rotation=!1,b("particle_settings",t,"b4w_initial_rand_rotation")),"b4w_rotation_type"in t||(t.b4w_rotation_type="Z",b("particle_settings",t,"b4w_rotation_type")),"b4w_rand_rotation_strength"in t||(t.b4w_rand_rotation_strength=1,b("particle_settings",t,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in t||(t.b4w_hair_billboard=!1,b("particle_settings",t,"b4w_hair_billboard")),"b4w_hair_billboard_type"in t||(t.b4w_hair_billboard_type="BASIC",b("particle_settings",t,"b4w_hair_billboard_type")),
"b4w_hair_billboard_jitter_amp"in t||(t.b4w_hair_billboard_jitter_amp=0,b("particle_settings",t,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in t||(t.b4w_hair_billboard_jitter_freq=0,b("particle_settings",t,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in t||(t.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",t,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in t||(t.b4w_wind_bend_inheritance="PARENT",b("particle_settings",t,"b4w_wind_bend_inheritance")),
"b4w_shadow_inheritance"in t||(t.b4w_shadow_inheritance="PARENT",b("particle_settings",t,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in t||(t.b4w_reflection_inheritance="PARENT",b("particle_settings",t,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in t||(t.b4w_vcol_from_name="",b("particle_settings",t,"b4w_vcol_from_name")),"b4w_vcol_to_name"in t||(t.b4w_vcol_to_name="",b("particle_settings",t,"b4w_vcol_to_name")),"b4w_coordinate_system"in t||(t.b4w_coordinate_system="LOCAL",b("particle_settings",
t,"b4w_coordinate_system")),"b4w_allow_nla"in t||(t.b4w_allow_nla=!0,b("particle_settings",t,"b4w_allow_nla"));"constraints"in c||(c.constraints=[],b("object",c,"constraints"));m=c.modifiers;for(d=0;d<m.length;d++){a:{p=m[d];switch(p.type){case "ARRAY":if(!("fit_type"in p)){g.error("WARNING Incomplete modifier "+String(p.type)+' for "'+c.name+'", reexport '+(c.library?"library"+c.library.split("/").slice(-1)[0]:"main scene"));p=!1;break a}}p=!0}p||(m.splice(d,1),d--)}"animation_data"in c||(c.animation_data=
{action:null,nla_tracks:[]},b("object",c,"animation_data"));if(c.animation_data)for(("action"in c.animation_data)||(c.animation_data.action=null,g.warn("no action in animation data "+c.name)),("nla_tracks"in c.animation_data)||(c.animation_data.nla_tracks=[],g.warn("no NLA in animation data "+c.name)),m=c.animation_data.nla_tracks,d=0;d<m.length;d++)for(p=m[d],t=0;t<p.strips.length;t++)z=p.strips[t],"action"in z||(z.action=null,g.warn("no action in NLA strip "+c.name)),"action_frame_start"in z||(z.action_frame_start=
0,g.warn("no action_frame_start in NLA strip "+c.name)),"action_frame_end"in z||(z.action_frame_end=z.frame_end-z.frame_start,g.warn("no action_frame_start in NLA strip "+c.name));"b4w_collision_id"in c||(c.b4w_collision_id="",b("material",c,"b4w_collision_id"));d=c.scale;0==d[0]&&0==d[1]&&0==d[2]?d=!0:(m=Math.abs((d[1]-d[2])/d[1]),d=.001>Math.abs((d[0]-d[1])/d[0])&&.001>m);d||g.warn("non-uniform scale for object "+c.name)}for(var C in J)l=J[C],d=C.match(/.*?(?=>>|$)/i)[0],g.warn("WARNING "+String(d)+
" is "+l.Xv+" for "+l.type+", reexport "+a.b4w_filepath_blend)};a.gA=function(a,b){"num_channels"in a||(a.num_channels=1,g.warn('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport '+(b.library?"library"+b.library.split("/").slice(-1)[0]:"main scene")))};a.Gz=function(a){var b;a:{b=a.modifiers;for(var e=0;e<b.length;e++){var g=b[e].type;if("ARRAY"==g||"CURVE"==g){b=!0;break a}}b=!1}if(!b)return null;b=d(a.data,a.data.name+"_MOD");a=a.modifiers;for(e=0;e<a.length;e++){var c=
a[e];switch(c.type){case "ARRAY":for(var g=b,q=c,w=0,x=0,B=0,E=new Float32Array(16),c=[],J=1;J<q.count;J++){q.use_constant_offset&&(w+=q.constant_offset_displace[0],x+=q.constant_offset_displace[1],B+=q.constant_offset_displace[2]);if(q.use_relative_offset)var k=g.b4w_bounding_box,w=w+(k.max_x-k.min_x)*q.relative_offset_displace[0],x=x+(k.max_y-k.min_y)*q.relative_offset_displace[1],B=B+(k.max_z-k.min_z)*q.relative_offset_displace[2];v.VF(w,x,B,E);for(var u=k=d(g),r=E,L=0;L<u.submeshes.length;L++){var F=
u.submeshes[L];v.bf(F.position,r,F.position,0);v.AG(F.normal,r,F.normal);v.SF(F.tangent,r,F.tangent)}c.push(k)}for(J=0;J<c.length;J++)for(q=g,w=c[J],x=0;x<q.submeshes.length;x++){B=q.submeshes[x];E=w.submeshes[x];k=B.base_length;u=B.indices.length;B.base_length+=E.base_length;for(var f in B)if("base_length"!=f)if("indices"==f)for(B[f]=v.YF(B[f],E[f]),r=u;r<B.indices.length;r++)B.indices[r]+=k;else"vertex_colors"!=f&&(B[f]=v.OB(B[f],E[f]))}break;case "CURVE":for(var g=b,J=c.object.jz,q=new Float32Array(16),
x=J.Ue?4:3,w=new Float32Array(x),x=new Float32Array(x),B=new Float32Array(3),E=new Float32Array(4),k=new Float32Array(4),u=new Float32Array(3),r=new Float32Array(3),L=new Float32Array(3),F=new Float32Array(4),N=new Float32Array(4),P=0;P<g.submeshes.length;P++){var V=g.submeshes[P],R=V.position,ea=V.normal,V=V.tangent,U;a:switch(U=c.deform_axis,U){case "POS_X":case "NEG_X":U=0;break a;case "POS_Y":case "NEG_Y":U=1;break a;case "POS_Z":case "NEG_Z":U=2;break a;default:throw"Wrong deform axis value "+
U;}u[0]=0;u[1]=0;u[2]=0;u[U]=1;for(var X=p.DF(J),Q=0;Q<R.length/3;Q++){L[0]=R[3*Q];L[1]=R[3*Q+1];L[2]=R[3*Q+2];var S=L[U],A=p.CF(J,S);p.EF(J,A,w);B[0]=w[0];B[1]=w[1];B[2]=w[2];p.BF(J,A,x);r[0]=x[0];r[1]=0;r[2]=x[2];m.normalize(r,r);z.rotationTo(u,r,E);0>S?(w[0]=r[0],w[1]=r[1],w[2]=r[2],m.scale(w,S,w),m.add(B,w,B)):S>X&&(w[0]=r[0],w[1]=r[1],w[2]=r[2],m.scale(w,S-X,w),m.add(B,w,B));C.fromRotationTranslation(E,B,q);J.Ue&&(z.setAxisAngle(u,w[3],k),m.transformQuat(L,k,L));L[U]=0;m.transformMat4(L,q,L);
R[3*Q]=L[0];R[3*Q+1]=L[1];R[3*Q+2]=L[2];ea.length&&(F[0]=ea[3*Q],F[1]=ea[3*Q+1],F[2]=ea[3*Q+2],F[3]=0,t.transformMat4(F,q,F),ea[3*Q]=F[0],ea[3*Q+1]=F[1],ea[3*Q+2]=F[2]);V.length&&(N[0]=V[3*Q],N[1]=V[3*Q+1],N[2]=V[3*Q+2],N[3]=0,t.transformMat4(N,q,N),V[3*Q]=N[0],V[3*Q+1]=N[1],V[3*Q+2]=N[2])}}}h.oE(b)}return b};a.gJ=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,
fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,
elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.Nz=function(a,b){for(var d=0;d<b.length;d++){var e=b[d];if(e.b4w_use_nla)for(var e=e.b4w_nla_script,c=0;c<e.length;c++){var g=e[c];switch(g.type){case "SELECT":case "SELECT_PLAY":for(var h=
0;h<a.length;h++){var m=a[h];m.name==g.object&&(m.b4w_selectable=!0)}break;case "SHOW":case "HIDE":for(h=0;h<a.length;h++)m=a[h],m.name==g.object&&(m.b4w_do_not_batch=!0)}}}}};b4w.module.__scenegraph=function(a,w){function e(a){a=xa.za(a);a.he=null;a.Db=null;a.Nc=null;return a}function b(a,b){var c=[];O.sf(a,function(b,e,f){-1<c.indexOf(f)?O.zE(a,b,e,f,d(f)):c.push(f)});O.U(a,function(e,f){for(var g=0;g<f.na.length;g++){var h=f.na[g];b||"MAIN_REFLECT"!=f.type||(h.Lg=!0);-1<c.indexOf(h)?f.na[g]=d(h):c.push(h)}"ANTIALIASING"==f.type&&O.Ae(a,e,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.na.length;c++){var d=b.na[c];d.Ba=ga.H;d.Aa=ga.H}});b||O.Ae(a,e,function(a,
b,c){"DEPTH"==c.M&&(c.Lg=!0)})});O.U(a,function(b){var c={};q(a,b,c);for(var d in c){b=c[d];for(var e=b[0],f=0;f<b.length;f++)if(b[f].Ba==ga.H){e=b[f];break}for(var g=b[0],f=0;f<b.length;f++)if(b[f].Aa==ga.H){g=b[f];break}for(var h=b[0],f=0;f<b.length;f++)if(!b[f].Lg){h=b[f];break}for(f=0;f<b.length;f++)b[f].Ba=e.Ba,b[f].Aa=g.Aa,b[f].Lg=h.Lg}})}function q(a,b,c){O.Ae(a,b,function(b,d,e){e.Ma&&e.M==e.ea&&(c[e.M]=c[e.M]||[],-1==c[e.M].indexOf(e)&&c[e.M].push(e),q(a,b,c))});O.tf(a,b,function(a,b,d){d.Ma&&
(c[d.M]=c[d.M]||[],-1==c[d.M].indexOf(d)&&c[d.M].push(d))});b=O.nb(a,b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.na.length;d++){var e=b.na[d];c[e.M].push(e)}}function d(a){if(a.oa)throw"Failed to clone slink with attached texture";return xa.Nf(a)}function h(a){var b=O.dq(a),c=[];O.U(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var e=[];break;default:e=c}for(var f=0;f<d.na.length;f++){var h=d.na[f],k=t(e,h,g(h));h.oa=k;
d.Ld[f]=k}for(f=0;f<d.Ld.length;f++)k=d.Ld[f],m(e,k);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":e=[]}O.tf(b,a,function(c,d,f){if(!f.oa){if((c=v(b,a,f.M))&&f.Ma&&!f.oa){d=e;for(var h=c,k=0;k<d.length;k++){var m=d[k];m.aq===h&&m.yj++}}else c=t(e,f,g(f));f.oa=c}});O.Ae(b,a,function(a,b,c){m(e,c.oa)});O.tf(b,a,function(a,b,c){c.oa&&"NONE"==c.ea&&m(e,c.oa)})})}function p(a){C(a,function(b,c,d){b.pi&&(ha(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&
"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||ha(a,d,"ANTIALIASING")||"ANCHOR_VISIBILITY"==d.type)&&(b.mf*=ib.resolution_factor)})}function g(a){a=xa.Nf(a);delete a.ea;delete a.Ma;delete a.oa;return JSON.stringify(a)}function v(a,b,c){var d=null;O.Ae(a,b,function(a,b,e){if(e.Ma&&e.M==e.ea&&e.M==c&&e.oa)return d=e.oa,!0});O.tf(a,b,function(a,b,e){if(e.Ma&&e.M==c&&e.oa)return d=e.oa,!0});return d}function m(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.aq===b&&d.yj&&d.yj--}}function t(a,b,c){for(var d=null,
e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===f.yj){d=f;break}}if(d)return d.yj++,d.aq;b=z(b);a.push({id:c,yj:1,aq:b});return b}function z(a){var b=a.mf*a.size;switch(a.M){case "COLOR":var c=ga.Hk("COLOR",ga.Yg);ga.resize(c,b,b);ga.Gp(c,a.Ba,a.Aa);return c;case "DEPTH":return a.Lg?(c=ga.Hk("DEPTH_RBUF",ga.Xg),ga.resize(c,b,b)):(c=ga.Hk("DEPTH_TEX",ga.wi),ga.resize(c,b,b),ga.Gp(c,a.Ba,a.Aa)),c;case "CUBEMAP":return c=ga.KA(b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.M;}}function C(a,
b){var c=!1;O.sf(a,function(d,e,f){if(f&&(d=O.nb(a,d),e=O.nb(a,e),b(f,!1,d,e)))return c=!0});c||O.U(a,function(a,c){for(var d=0;d<c.na.length;d++)if(b(c.na[d],!0,c,null))return!0})}function J(a){O.U(a,function(b,c){if("SINK"!=c.type){var d=c.j;O.tf(a,b,function(a,b,c){c.Ma&&c.oa&&(ba.Tl(d,c.M,c.oa),c.M==c.ea&&b.j&&ba.Tl(b.j,c.M,c.oa))});for(var e=0;e<c.na.length;e++){var f=c.na[e];f.Ma&&f.M==f.ea&&ba.Tl(d,f.M,c.Ld[e])}!d.Db&&!d.Nc||d.he||(d.he=bb.yE(d.Db,d.Nc))}})}function D(a){var b=null,c=0;O.U(a,
function(a,d){if(d.type==Ja.OF){if(c==Ja.NF)return b=d,!0;c++}});return b}function y(a,b){var d=O.Mh(a,b),e=x("NONE"),f=O.A(a,e),g=O.Ut(a)[0];O.sf(a,function(b,c){c==g&&O.pE(a,b,g,b,f)});O.sf(a,function(f,g,h){if(f==d)return O.m(a,b,e,c(Ja.oF,"u_color",h.size,h.mf,h.pi)),!0});O.Je(a,f,g,c("SCREEN","NONE",.5,.5,!0))}function n(a,b){var c=l("SHADOW_CAST");c.Bn=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.Jo){case "SPOT":case "POINT":c.j=ba.xb(ba.Ic);ba.Hp(c.j,180*b.ye/Math.PI,
.1,2*b.distance);break;default:c.j=ba.xb(ba.xi)}return c}function l(a){return{type:a,Ga:!1,yv:!1,Wm:!1,Al:!1,Ii:0,time:0,j:null,Is:null,Hb:null,o:[],na:[],Ld:[],Uj:new Float32Array(3),Hx:new Float32Array(3),cc:new Float32Array(3),ac:new Float32Array(4),qc:new Float32Array(16),Pe:0,wg:0,lg:null,ng:null,kg:null,mg:null,Qc:new Float32Array(3),Wc:new Float32Array(3),ax:new Float32Array([0,0,0]),gm:new Float32Array(3),bx:new Float32Array(4),Xh:null,el:0,On:0,dj:!1,yh:new Float32Array(3),Rg:0,Xa:null,rm:!1,
jf:new Float32Array(2),kf:new Float32Array(2),Vh:0,Hh:0,jn:0,md:null,yf:0,Sg:0,xf:0,Lf:!1,Vr:0,Wr:new Float32Array(2),Ur:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,Wh:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,di:0,ci:0,bi:0,Sw:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,
exposure:0,saturation:0,god_rays_intensity:0,Gh:0,Ol:0,gi:0,Bn:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,tx:null,Lr:null,Bg:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,Pr:0,Zs:0,xl:0,yl:0,av:0,vj:"",uD:new Float32Array(2),aa:!0,sc:!0,ha:!0,la:!0,Lb:!0,Ja:!0}}function c(a,b,c,d,e){return{M:a,ea:b,size:c,mf:d,pi:e,Ma:!0,oa:null,Lg:!1,Ba:ga.Sd,Aa:ga.Sd}}function M(a,b){for(var c=0,d=aa(a,b),e=0;e<d.length;e++){var f=d[e];"SHADOW_CAST"==f.type&&(f=H(a,f,"SHADOW_CAST").j,b.tx=f.pa,
b.Lr=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.Bg=b.Bg||[],b.Bg[c]=f.wa,c++)}}function I(){var a=l("GRASS_MAP");a.j=ba.xb(ba.Zg);return a}function x(a){var b=l("POSTPROCESSING");b.ha=!1;b.la=!1;b.Lb=!1;b.j=ba.xb(ba.wb);b.vj=a;return b}function B(a){var b=l("BLOOM_BLUR");b.ha=!1;b.la=!1;b.Lb=!1;b.j=ba.xb(ba.wb);b.vj=a;return b}function E(a,b,c,d,e,f,g,h,k){var m=l("MAIN_"+a);if("OPAQUE"===a)m.ha=!0,m.la=c,m.Ga=!1;else if("BLEND"===a)m.ha=!1,m.la=!1,m.Ga=!0;else if("XRAY"===a)m.ha=
!1,m.la=!0,m.Ga=!0;else if("REFLECT"===a)m.ha=!0,m.la=!0,m.Ga=!1;else throw"wrong main subscene type";m.Ga&&h&&(m.self_shadow_normal_offset=h.self_shadow_normal_offset);m.j=b;m.Qc.set(g.Qc);m.Wc.set(g.Wc);m.Pe=g.Pe;m.Xh=g.Xh;m.ac=f;d&&(m.Xa=d,d.ac&&(m.md=new Float32Array(d.ac)),m.yf=d.waves_height,m.Sg=d.waves_length,m.xf=d.xf,d.wk&&k&&(m.Lf=!0,m.Vr=d.wk,m.Wr.set(d.ln),m.Ur=d.kn),d.dm&&(m.rm=!0,a=d.mF,m.jf[0]=(a[0]+a[1])/2,m.jf[1]=(a[2]+a[3])/2,m.kf[0]=a[0]-a[1],m.kf[1]=a[2]-a[3],m.Vh=d.Vh,m.Hh=d.Hh));
m.lg=new Float32Array(3*e);m.ng=new Float32Array(3*e);m.kg=new Float32Array(3*e);m.mg=new Float32Array(0==e%2?2*e:2*e+2);return m}function K(a,b){var c=l("COLOR_PICKING");b&&(c.type+="_XRAY",c.ha=!1,c.la=!0);c.sc=!1;c.j=a;return c}function k(a){var b=l("WIREFRAME");b.aa=!1;b.ha=!1;b.la=!1;b.j=a;return b}function u(a){var b=l("ANCHOR_VISIBILITY");b.ha=!0;b.la=!1;b.j=a;return b}function r(a,b){var c=l("DEPTH");c.j=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function L(a){var b=
l("DEPTH_PACK");b.ha=!1;b.la=!1;b.j=a;return b}function F(a,b,c){var d=l("SSAO");d.ha=!1;d.la=!1;d.Lb=!1;d.j=a;d.ac=b;d.md=new Float32Array(b);d.di=c.radius_increase;d.ssao_hemisphere=c.fD;d.ci=c.influence;d.bi=c.dist_factor;d.Sw=c.IE;return d}function f(a,b){var c=l("SSAO_BLUR");c.ha=!1;c.la=!1;c.Lb=!1;c.ssao_blur_depth=b.Wz;c.ssao_blur_discard_value=b.Or;c.j=a;return c}function N(){var a=l("ANTIALIASING");a.ha=!1;a.la=!1;a.Lb=!1;a.j=ba.xb(ba.wb);return a}function P(a){var b=l(a);b.ha="SMAA_BLENDING_WEIGHT_CALCULATION"==
a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.la=!1;b.Lb=!1;b.j=ba.xb(ba.wb);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.vD=new Float32Array(4));return b}function V(a,b,c,d){var e=l("COMPOSITING");e.ha=!1;e.la=!1;e.Lb=!1;e.j=ba.xb(ba.wb);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function R(a,b){var c=l("MOTION_BLUR");c.ha=!1;c.la=!1;c.Lb=!1;c.j=ba.xb(ba.wb);c.Wm=!0;c.xl=a;c.yl=b;return c}function ea(a){var b=l("DOF");b.ha=!1;b.la=!1;b.Lb=!1;b.j=a;return b}function U(a){var b=l("GLOW_MASK");
b.j=a;b.Lb=!1;return b}function X(a){var b=l("GLOW");b.yh.set(a.yh);b.el=a.el;b.Zs=5;b.Pr=3;b.Lb=!1;b.j=ba.xb(ba.wb);return b}function Q(){var a=l("REFRACT");a.ha=!1;a.la=!1;a.Lb=!1;a.j=ba.xb(ba.wb);return a}function S(a,b,c,d,e,f,g){var h=l("GOD_RAYS");h.ha=!1;h.la=!1;h.Lb=!1;h.Qc[0]=1;h.Qc[1]=1;h.Qc[2]=1;h.Wc[0]=1;h.Wc[1]=1;h.Wc[2]=1;h.Pe=1;h.yv=d;h.Rg=b;h.Ol=e;h.Gh=c;h.gi=g;h.j=a;h.wg=f;h.lg=new Float32Array(3*f);h.ng=new Float32Array(3*f);h.kg=new Float32Array(3*f);h.mg=new Float32Array(0==f%
2?2*f:2*f+2);return h}function A(a,b){var c=l("GOD_RAYS_COMBINE");c.ha=!1;c.la=!1;c.Lb=!1;c.j=ba.xb(ba.wb);c.god_rays_intensity=a;c.wg=b;c.lg=new Float32Array(3*b);c.ng=new Float32Array(3*b);c.kg=new Float32Array(3*b);c.mg=new Float32Array(0==b%2?2*b:2*b+2);return c}function ka(a,b){var c=l("SKY");c.sc=!1;c.ha=!1;c.la=!1;c.Lb=!1;var d=ba.xb(ba.wb);d.width=wa.Jk;d.height=wa.Jk;c.j=d;c.Is=xa.aC();c.wg=a;c.lg=new Float32Array(3*a);c.ng=new Float32Array(3*a);c.kg=new Float32Array(3*a);c.mg=new Float32Array(0==
a%2?2*a:2*a+2);c.Qc[0]=1;c.Qc[1]=1;c.Qc[2]=1;c.Wc[0]=1;c.Wc[1]=1;c.Wc[2]=1;c.Pe=1;c.Wh.set(b.Wh);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;
c.mie_distribution=b.mie_distribution;return c}function fa(){var a=l("COPY");a.ha=!1;a.la=!1;a.j=ba.xb(ba.wb);return a}function da(){var a=l("ANAGLYPH");a.ha=!1;a.la=!1;a.j=ba.xb(ba.wb);return a}function ca(){var a=l("LUMINANCE");a.ha=!1;a.la=!1;a.j=ba.xb(ba.wb);return a}function Z(){var a=l("AVERAGE_LUMINANCE");a.ha=!1;a.la=!1;a.j=ba.xb(ba.wb);return a}function oa(a,b,c,d){var e=l("LUMINANCE_TRUNCED");e.ha=!1;e.la=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.j=d;e.lg=new Float32Array(3*c);e.ng=new Float32Array(3*
c);e.kg=new Float32Array(3*c);e.mg=new Float32Array(0==c%2?2*c:2*c+2);return e}function la(a){var b=l("BLOOM");b.ha=!1;b.la=!1;b.j=ba.xb(ba.wb);b.bloom_blur=a;return b}function ma(){var a=l("SINK");a.sc=!1;return a}function ha(a,b,c){if(b.type===c)return!0;b=na(a,b);for(var d=0;d<b.length;d++)if(ha(a,b[d],c))return!0;return!1}function pa(a,b,c){if(b.type===c)return!0;b=aa(a,b);for(var d=0;d<b.length;d++)if(pa(a,b[d],c))return!0;return!1}function H(a,b,c){if(b.type===c)return b;b=aa(a,b);for(var d=
0;d<b.length;d++){var e=H(a,b[d],c);if(e)return e}return null}function aa(a,b){var c=O.Mh(a,b);if(c==O.Qq)throw"Subscene not in graph";for(var d=[],e=O.xu(a,c),f=0;f<e;f++){var g=O.Yk(a,c,f);g!=c&&d.push(O.nb(a,g))}return d}function na(a,b){var c=O.Mh(a,b);if(c==O.Qq)throw"Subscene not in graph";for(var d=[],e=O.Oh(a,c),f=0;f<e;f++){var g=O.wh(a,c,f);g!=c&&d.push(O.nb(a,g))}return d}function Fa(a){var b=[],c=[];C(a,function(a){a.oa&&-1==b.indexOf(a.oa)&&(b.push(a.oa),c.push(a.oa,b.length-1))});return c}
function W(a,b){var c;c=""+(a.M+"\\n");c+="NONE"!=a.ea?a.ea+"\\n":"";c+="(";if(a.pi){var d=a.mf;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.M){c+=" ";if(a.Lg)c+="RR";else{var d=a.Ba,e=a.Aa,f="";d==ga.H?f+="L":d==ga.Sd&&(f+="N");e==ga.H?f+="L":e==ga.Sd&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.oa&&(c+=" "+b[d+1])}return c+")\\n"}var ba=w("__camera"),ta=w("__config"),Bb=w("__debug"),O=w("__graph"),bb=w("__renderer"),ga=w("__textures"),
xa=w("__util");w("vec4");var Ja=ta.In,ib=ta.p,wa=ta.Gj;a.qA=function(a){switch(a.ea){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;default:return!0}};a.XF=C;a.UA=function(a,d,g){function m(b,f){var g=e(ya[f]);d.K.push(g);g=E(b,g,!1,na,bb,Pb,cb,Ra,a.ii);t.push(g);O.A(l,g);O.m(l,q[f],g,z[f]);O.m(l,q[f],g,C[f]);Sa&&(O.m(l,Sa,g,Db),O.m(l,Sa,g,Ib));if(qb){for(var h=0;h<pa.length;h++)O.m(l,pa[h],g,W[h]);var h=v[f],k=c("COLOR","u_scene_depth",1,1,!0);k.Ba=ga.Sd;
k.Aa=ga.Sd;O.m(l,h,g,k)}w.length&&(O.m(l,w[f],g,H[f]),g.Hb=Ia[0]);ha.length&&O.m(l,ha[f],g,aa[f]);return g}var l=O.create(),q=[],t=[],v=[],z=[],C=[],w=[],H=[],ha=[],aa=[],pa=[],W=[],bb=a.Pu,na=a.Xa,ta=a.zp,Fa=a.of,sb=a.zh,jb=a.HD,Ia=a.qE,Ba=a.dh,Nb=a.Jh,Ta=a.jh,lb=a.antialiasing,cb=a.GG,Pb=a.ac,Ra=a.Gd,Ua=a.LD,Gb=a.Vz,xb=a.fA,hb=a.ZC,Vb=a.WC,kb=a.ph,qb=a.pB,La=Boolean(g.length),ya=[];if(a.anaglyph_use&&!La){var Fb=d.K[0],wb=e(Fb);ba.Zu(Fb,ba.Kb);ba.Zu(wb,ba.Tb);ya.push(Fb,wb);d.K.push(wb)}else{var ua=
d.K[0];ya.push(ua)}if(ta){ba.mq(ya[0],Ra);for(var Ob=Ra.csm_num,Y=0;Y<Ob;Y++){var gb=n(Y,Ra);O.A(l,gb);pa.push(gb);var Pa=Ra.csm_resolution,ua=gb.j;ua.width=Pa;ua.height=Pa;gb.ha=!1;W.push(c("DEPTH","u_shadow_map"+Y,Pa,1,!1));(Bb.kA()||ib.et)&&gb.na.push(c("COLOR","COLOR",Pa,1,!1))}}if(0<Ia.length&&!La)for(Y=0;Y<ya.length;Y++){ua=e(ya[Y]);d.K.push(ua);var Da=E("REFLECT",ua,!1,na,bb,Pb,cb,null,a.ii);Da.Hb=Ia[0];Da.j.Hb=Ia[0];O.A(l,Da);w.push(Da);H.push(c("COLOR","u_reflectmap",1,ib.zj,!0));Da.na.push(c("DEPTH",
"DEPTH",1,ib.zj,!0))}q=[];t=[];if(a.bb){var Sa=I();O.A(l,Sa);Pa=wa.fl;Sa.j.width=Pa;Sa.j.height=Pa;var Db=c("DEPTH","u_grass_map_depth",Pa,1,!1);Db.Ba=ga.H;Db.Aa=ga.H;var Ib=c("COLOR","u_grass_map_color",Pa,1,!1);Ib.Ba=ga.H;Ib.Aa=ga.H}else Ib=Db=Sa=null;for(var ac=[],Eb=[],Y=0;Y<ya.length;Y++){var ua=ya[Y],Qa={};C.push(c("DEPTH","DEPTH",1,1,!0));if(qb){var Tb=e(ua);d.K.push(Tb);if(ta){Qa=r(Tb,Ra);O.A(l,Qa);Eb.push(Qa);for(var Jb=0;Jb<pa.length;Jb++)gb=pa[Jb],O.m(l,gb,Qa,W[Jb]);var bc=c("COLOR","u_color",
1,1,!0),Ub=c("DEPTH","u_depth",1,1,!0);if(Fa){var nc=e(ua);d.K.push(nc);var yb=a.GF,mb=F(nc,Pb,yb);O.A(l,mb);var oc=c("COLOR","u_ssao_mask",1,1,!0);O.m(l,Qa,mb,bc);O.m(l,Qa,mb,Ub);var kc=e(ua);d.K.push(kc);var eb=f(kc,yb);O.A(l,eb);var pc=c("COLOR","u_shadow_mask",1,1,!0);O.m(l,mb,eb,oc);O.m(l,Qa,eb,Ub)}var G=e(Tb);d.K.push(G);var Lb=L(G);O.A(l,Lb);O.m(l,Qa,Lb,c("DEPTH","u_depth",1,1,!0));v.push(Lb)}else Qa=r(Tb,Ra),O.A(l,Qa),v.push(Qa);Sa&&(O.m(l,Sa,Qa,Db),O.m(l,Sa,Qa,Ib))}Da=E("OPAQUE",ua,!qb,na,
bb,Pb,cb,null,a.ii);O.A(l,Da);t.push(Da);qb&&(O.m(l,Qa,Da,C[Y]),oc?O.m(l,eb,Da,pc):ta&&O.m(l,Qa,Da,c("COLOR","u_shadow_mask",1,1,!0)));var tb=c("COLOR","u_color",1,1,!0);z.push(c("COLOR","COLOR",1,1,!0));Sa&&(O.m(l,Sa,Da,Db),O.m(l,Sa,Da,Ib));w.length&&(O.m(l,w[Y],Da,H[Y]),Da.Hb=Ia[0])}q=t;t=[];if(!La&&a.qs){ua=e(q[0].j);d.K.push(ua);var Ea=K(ua,!1);O.A(l,Ea);if(a.Ce){ua=e(q[0].j);d.K.push(ua);var nb=K(ua,!0);O.A(l,nb);O.m(l,Ea,nb,c("COLOR","COLOR",1,1,!0));O.m(l,Ea,nb,c("DEPTH","DEPTH",1,1,!0))}}else Ea=
null;if(jb.fd&&!La)for(Y=0;Y<ya.length;Y++){var T=Q();O.A(l,T);O.m(l,q[Y],T,tb);ha.push(T);aa.push(c("COLOR","u_refractmap",1,1,!0))}for(Y=0;Y<ya.length;Y++)Da=m("BLEND",Y),ac.push(Da);q=t;t=[];if(a.Ce){for(Y=0;Y<ya.length;Y++)m("XRAY",Y);q=t;t=[]}if(ib.wireframe_debug){for(Y=0;Y<ya.length;Y++){ua=xa.za(ya[Y]);d.K.push(ua);var Va=k(ua);t.push(Va);O.A(l,Va);O.m(l,q[Y],Va,z[Y]);O.m(l,q[Y],Va,C[Y]);Sa&&(O.m(l,Sa,Va,Db),O.m(l,Sa,Va,Ib))}q=t;t=[]}if(!La&&a.oz){ua=xa.za(ya[0]);d.K.push(ua);var ob=u(ua);
O.A(l,ob);O.m(l,q[0],ob,C[0])}if(sb&&qb&&!La){for(Y=0;Y<ya.length;Y++){var dc=hb.Gh,Wa=hb.jD,ec=hb.gi,Za=q[Y],vc=na?1:0,Xb=c("DEPTH","u_input",1,1,!0);Xb.Ba=ga.H;Xb.Aa=ga.H;var fc=c("COLOR","u_input",1,.25,!0);fc.Ba=ga.H;fc.Aa=ga.H;var gc=dc/ec,Ec=e(ya[Y]);d.K.push(Ec);var Ha=S(Ec,vc,dc,!0,gc,bb,ec);O.A(l,Ha);O.m(l,Za,Ha,Xb);var gc=dc/ec*.5,Ca=e(ya[Y]);d.K.push(Ca);var Fc=S(Ca,vc,dc,!1,gc,bb,ec);O.A(l,Fc);O.m(l,Ha,Fc,fc);var gc=dc/ec*.25,pd=e(ya[Y]);d.K.push(pd);var pb=S(pd,vc,dc,!1,gc,bb,ec);O.A(l,
pb);O.m(l,Fc,pb,fc);w.length&&(Ha.Hb=Ia[0],Fc.Hb=Ia[0],pb.Hb=Ia[0]);var wc=A(Wa,bb);t.push(wc);O.A(l,wc);O.m(l,Za,wc,c("COLOR","u_main",1,1,!0));O.m(l,pb,wc,c("COLOR","u_god_rays",1,1,!0))}q=t;t=[]}if(Ba&&!La){for(Y=0;Y<ya.length;Y++){var Za=q[Y],qc=ca();O.A(l,qc);O.m(l,Za,qc,c("COLOR","u_input",1,1,!0));var Gc=Z();O.A(l,Gc);Gc.j.width=1;Gc.j.height=1;var Hb=c("COLOR","u_input",1,.25,!0);Hb.Ba=ga.H;Hb.Aa=ga.H;var Hc=c("COLOR","u_luminance",1,.25,!0);Hc.Ba=ga.H;Hc.Aa=ga.H;O.m(l,qc,Gc,Hb);var id=Gb.key,
Yb=Gb.wB,Qb=e(ya[Y]);d.K.push(Qb);var rc=oa(id,Yb,bb,Qb);O.A(l,rc);O.m(l,Za,rc,c("COLOR","u_main",1,1,!0));O.m(l,qc,rc,Hc);O.m(l,Gc,rc,c("COLOR","u_average_lum",1,1,!1));var Mb=c("COLOR","u_color",1,.25,!0);Mb.Ba=ga.H;Mb.Aa=ga.H;var sc=B("X_BLUR");O.A(l,sc);O.m(l,rc,sc,Mb);var xc=B("Y_BLUR");O.A(l,xc);O.m(l,sc,xc,Mb);var lc=la(Gb.blur);O.A(l,lc);var Zb=c("COLOR","u_bloom",1,.25,!0);Zb.Ba=ga.H;Zb.Aa=ga.H;O.m(l,xc,lc,Zb);O.m(l,Za,lc,c("COLOR","u_main",1,1,!0));t.push(lc)}q=t;t=[]}if(Nb&&!La){for(Y=
0;Y<q.length;Y++){var Xc=q[Y],hc=R(Ua.xl,Ua.yl);t.push(hc);O.A(l,hc);O.m(l,Xc,hc,c("COLOR","u_mb_tex_curr",1,1,!0));hc.na.push(c("COLOR","u_mb_tex_accum",1,1,!0))}q=t;t=[]}if(kb&&qb&&!La){for(Y=0;Y<q.length;Y++){var Za=q[Y],ub=e(ya[Y]);d.K.push(ub);Mb=c("COLOR","u_color",1,1,!0);Mb.Ba=ga.H;Mb.Aa=ga.H;var vb=x("X_BLUR");O.A(l,vb);O.m(l,Za,vb,Mb);var ic=x("Y_BLUR");O.A(l,ic);O.m(l,vb,ic,Mb);var Qa=ac[Y],Rb=ea(ub);ub.dof_distance=d.dof_distance;ub.Tf=d.Tf;ub.dof_front=d.dof_front;ub.dof_rear=d.dof_rear;
ub.dof_power=d.dof_power;ub.dof_on=1;t.push(Rb);O.A(l,Rb);O.m(l,Za,Rb,c("COLOR","u_sharp",1,1,!0));O.m(l,ic,Rb,c("COLOR","u_blurred",1,1,!0));O.m(l,Qa,Rb,c("DEPTH","u_depth",1,1,!0))}q=t;t=[]}if(!La&&a.glow){for(Y=0;Y<ya.length;Y++){var Za=q[Y],Yc=e(ya[Y]);d.K.push(Yc);var Jc=U(Yc);O.A(l,Jc);var Zc=x("X_EXTEND"),Pc=c("COLOR","u_color",1,1,!0),$c=c("COLOR","u_glow_mask",1,1,!0);Zc.dj=!0;O.A(l,Zc);O.m(l,Jc,Zc,Pc);var Kc=c("COLOR","u_color",1,.5,!0);Kc.Ba=ga.H;Kc.Aa=ga.H;var zb=x("Y_EXTEND");zb.dj=!0;
O.A(l,zb);O.m(l,Zc,zb,Kc);vb=x("X_BLUR");vb.dj=!0;O.A(l,vb);O.m(l,zb,vb,Kc);var ad=c("COLOR","u_color",1,.25,!0);ad.Ba=ga.H;ad.Aa=ga.H;var bd=c("COLOR","u_glow_mask_blurred",1,.25,!0);bd.Ba=ga.H;bd.Aa=ga.H;ic=x("Y_BLUR");ic.dj=!0;O.A(l,ic);O.m(l,vb,ic,ad);var yc=X(Vb);O.A(l,yc);O.m(l,Za,yc,c("COLOR","u_glow_src",1,1,!0));O.m(l,Jc,yc,$c);O.m(l,ic,yc,bd);t.push(yc)}q=t;t=[]}if(Ta&&!La){for(Y=0;Y<q.length;Y++){var Za=q[Y],Qc=V(xb.brightness,xb.contrast,xb.exposure,xb.saturation);O.A(l,Qc);O.m(l,Za,Qc,
c("COLOR","u_color",1,1,!0));t.push(Qc)}q=t;t=[]}if(lb){for(Y=0;Y<q.length;Y++)if(Za=q[Y],ib.smaa){var Xa=c("COLOR","u_color",1,1,!0);Xa.Ba=ga.H;Xa.Aa=ga.H;var zc=P("SMAA_EDGE_DETECTION");O.A(l,zc);O.m(l,Za,zc,Xa);var Ac=P("SMAA_BLENDING_WEIGHT_CALCULATION");O.A(l,Ac);O.m(l,zc,Ac,Xa);var Lc=c("COLOR","u_search_tex",1,1,!1),cd=c("COLOR","u_area_tex",1,1,!1);Lc.Ba=ga.H;Lc.Aa=ga.H;cd.Ba=ga.H;cd.Aa=ga.H;Ac.na.push(Lc);Ac.na.push(cd);var Mc=P("SMAA_NEIGHBORHOOD_BLENDING");O.A(l,Mc);O.m(l,Za,Mc,Xa);var dd=
c("COLOR","u_blend",1,1,!0);dd.Ba=ga.H;dd.Aa=ga.H;O.m(l,Ac,Mc,dd);t.push(Mc)}else{var Rc=N();O.A(l,Rc);var Sc=c("COLOR","u_color",1,1,!0);Sc.Ba=ga.H;Sc.Aa=ga.H;O.m(l,Za,Rc,Sc);if(1<ib.resolution_factor){var ed=x("NONE");O.A(l,ed);O.m(l,Rc,ed,Sc);t.push(ed)}else t.push(Rc)}q=t;t=[]}if(a.anaglyph_use&&!La){var Nc=da();O.A(l,Nc);O.m(l,q[0],Nc,c("COLOR","u_sampler_left",1,1,!0));O.m(l,q[1],Nc,c("COLOR","u_sampler_right",1,1,!0));t.push(Nc)}else t.push(q[0]);var Bc=O.Mh(l,q[0]),Cc=!1;O.Ae(l,Bc,function(a,
b,c){if(c.M==c.ea)return Cc=!0});if(Cc){var Sb=fa();O.A(l,Sb);O.m(l,q[0],Sb,c("COLOR","u_color",1,1,!0));q=t;t=[];t.push(Sb)}Ea&&(nb?t.push(nb):t.push(Ea));ob&&t.push(ob);if(!La&&a.Qp.procedural_skydome){var kd=ka(bb,a.Qp);O.A(l,kd);t.push(kd)}var jc=ma();O.A(l,jc);for(Y=0;Y<t.length;Y++){var Dc=t[Y];switch(Dc.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":O.m(l,Dc,jc,c("COLOR","NONE",1,1,!0));O.m(l,Dc,jc,c("DEPTH","NONE",1,1,!0));break;case "SKY":O.m(l,Dc,jc,c("CUBEMAP","u_sky",wa.Jk,1,!1));
break;case "ANCHOR_VISIBILITY":O.m(l,Dc,jc,c("COLOR","NONE",1,1,!0));break;default:if(La){var fd=g[0].d,tc=c("COLOR","OFFSCREEN",1,1,!0);tc.oa=fd;O.m(l,t[Y],jc,tc);for(Jb=1;Jb<g.length;Jb++){var gd=g[Jb].d,Sb=fa();O.A(l,Sb);O.m(l,t[Y],Sb,c("COLOR","u_color",1,1,!0));tc=c("COLOR","OFFSCREEN",1,gd.Ig/fd.Ig,!0);tc.oa=gd;O.m(l,Sb,jc,tc)}}else O.m(l,t[Y],jc,c("SCREEN","NONE",1,1,!0))}}if(Ja.enabled){var $b=D(l);$b&&y(l,$b)}b(l,qb);1<ib.resolution_factor&&p(l);h(l);J(l);for(Y=0;Y<Eb.length;Y++)M(l,Eb[Y]);
for(Y=0;Y<ac.length;Y++)M(l,ac[Y]);return l};a.XK=l;a.JJ=function(a){var b=null;O.U(a,function(a,c){return c.j&&null===c.j.he?(b=c,!0):!1});return b};a.yb=function(a,b,c){a=aa(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.QK=ha;a.eD=pa;a.HC=aa;a.xK=na;a.Oa=function(a,b){var c=null;O.U(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.gB=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+
'node [shape=box margin="0.25,0.055"];\n',c=Fa(a);O.U(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(f+=" ("+d.vj.replace(/_/g," ")+")");if(d.j){for(var f=f+"\\n",g=0;g<c.length;g+=2)c[g]==d.j.Db&&(f+="C"+c[g+1]+" ");for(g=0;g<c.length;g+=2)c[g]==d.j.Nc&&(f+="D"+c[g+1])}d.na.length&&(f+="\\n-----\\n");for(g=0;g<d.na.length;g++)f+=W(d.na[g],c);g="SINK"==d.type?"dotted":d.sc?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(g+",bold")+
'"];\n')});O.sf(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+W(e,c)+'" style="'+(e.Ma?"solid":"dotted")+'"];\n'});return b+="}"};a.VA=function(a){a=O.UF(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.sc&&b.push(d)}return b}};b4w.module.__data=function(a,w){function e(a,b){for(var c=A(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}Ya[b.id]=null;va[b.id]=null}function b(a,b,c){var d;a instanceof ArrayBuffer&&(a=ha.fu(a));d=a.width;a=a.height;ba.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(Ga)&&c&&ba.warn("image",b,"is not from app root.")}function q(a,b,c,d,e,f){d=b.s;if(!d)throw"Nothing requested";aa.sc([[d,aa.Cq,d]],function(d,
f,g,l){if(d){ba.log("%cLOAD METADATA","color: #616",l);h(d);for(var m in d)a[m]=d[m];(d=a.binaries[0].binfile)?b.Mr=d:(H.Jw(b,"load_binaries"),H.Jw(b,"prepare_bindata"));if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)ba.FB(a.b4w_export_errors[d]);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)ba.GB(a.b4w_export_warnings[d]);e(b,c)}else b.Xu(b.id,!1)},null,function(a){f(b,c,a)})}function d(a,b,c,d,e,f){d=U(b.s)+b.Mr;if(!d)throw"Binary data is missing";aa.sc([[d,
aa.Xj,d]],function(d,f,g,h){d&&(ba.log("%cLOAD BINARY","color: #616",h),a.bin_data=d,e(b,c))},null,function(a){f(b,c,a)})}function h(a){var b=sa.Xo.split(".").map(function(a){return a|0}),c=a.b4w_format_version.split(".").map(function(a){return a|0});c[0]<b[0]&&wa.sa("Incompatible file version: "+a.b4w_format_version+", required: "+sa.Xo+". Reexport scene with the latest B4W addon to fix it.");c[1]<b[1]&&ba.warn("Version mismatch. File version: "+ +a.b4w_format_version+", required: "+sa.Xo+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.")}
function p(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],h=a.objects,l=a.meshes;a=a.actions;for(var m=wa.lA(),k=["indices"],n=["normal","tangent"],r=["color","group"],p=["position","texcoord","texcoord2"],q=0;q<l.length;q++)for(var t=l[q].submeshes,v=0;v<t.length;v++)for(var u in t[v]){var x=t[v][u][1];if(-1!=k.indexOf(u)){var z=4*t[v][u][0]+f["int"],C=t[v],w=u,y=d;if(m)var B=new Uint32Array(y,z,x);else for(var B=new Uint32Array(x),y=new DataView(y),A=0;A<x;A++)B[A]=y.getUint32(z+4*A,!0);C[w]=B}else if(-1!=
p.indexOf(u))z=4*t[v][u][0]+f["float"],t[v][u]=g(d,z,x,m);else if(-1!=n.indexOf(u)){z=2*t[v][u][0]+f["short"];C=t[v];w=u;y=d;B=new Float32Array(x);y=new DataView(y);for(A=0;A<x;A++)B[A]=y.getInt16(z+2*A,!0)/32767;C[w]=B}else if(-1!=r.indexOf(u)){z=2*t[v][u][0]+f.ushort;C=t[v];w=u;y=d;B=new Float32Array(x);y=new DataView(y);for(A=0;A<x;A++)B[A]=y.getUint16(z+2*A,!0)/65535;C[w]=B}}for(u=0;u<h.length;u++)for(l=h[u].particle_systems,k=0;k<l.length;k++)n=l[k],n.transforms=g(d,4*n.transforms[0]+f["float"],
n.transforms[1],m);for(h=0;h<a.length;h++){u=a[h];var l=u.fcurves,n=u.frame_range,k=n[0],n=n[1],r=Z.nC(k,n),p=null,t=q=!1,D;for(D in l)q|=-1<D.indexOf("rotation_euler"),t|=-1<D.indexOf("rotation_quaternion");for(D in l)if(q&&t&&-1<D.indexOf("rotation_euler"))delete l[D];else{var v=l[D],I;for(I in v)x=v[I],z=g(d,f["float"]+4*x.bin_data_pos[0],x.bin_data_pos[1],m),C=new Float32Array(r),null===p&&(p=new Int8Array(r)),Z.Iz(x,z,C,p,k,n),x.nc=C;-1<D.indexOf("rotation_euler")&&Z.MB(l,D)}u.cz=p}e(b,c)}function g(a,
b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function v(a,b,c,d,e){var f=a.cameras,g=a.groups,h=a.materials,l=a.meshes,m=a.node_groups,n=a.objects,r=a.particles,p=a.scenes,q=a.speakers,t=a.textures,v=a.worlds;m||(ba.warn('"node_groups" datablock undefined. reexport main scene.'),m=a.node_groups=[]);for(var u="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),
x={},z=0;z<u.length;z++)for(var C=a[u[z]],y=0;y<C.length;y++){var w=C[y];x[w.uuid]=w}for(var B=0;B<p.length;B++){for(var I=p[B],E=I.objects,M=0;M<E.length;M++)D(E,M,x);I.camera&&D(I,"camera",x);I.world&&D(I,"world",x)}for(B=0;B<g.length;B++)for(var H=g[B].objects,M=0;M<H.length;M++)D(H,M,x);for(B=0;B<n.length;B++){var F=n[B];F.dupli_group&&D(F,"dupli_group",x);F.parent&&D(F,"parent",x);if(F.animation_data){var L=F.animation_data;L.action&&D(L,"action",x);if(L.nla_tracks)for(M=0;M<L.nla_tracks.length;M++)for(var N=
L.nla_tracks[M],P=0;P<N.strips.length;P++)N.strips[P].action&&D(N.strips[P],"action",x)}switch(F.type){case "MESH":if(!F.data)throw"mesh not found for object "+F.name;D(F,"data",x);for(var R=F.modifiers,M=0;M<R.length;M++){var Q=R[M];"ARMATURE"==Q.type?D(Q,"object",x):"CURVE"==Q.type&&D(Q,"object",x)}var ga=F.particle_systems;if(ga)for(M=0;M<ga.length;M++)D(ga[M],"settings",x);break;case "ARMATURE":D(F,"data",x);for(var S=F.pose.bones,V=F.data.bones,M=0;M<S.length;M++){var U=S[M];U.bone=V[U.bone];
for(var ha=U.parent_recursive,P=0;P<ha.length;P++)ha[P]=S[ha[P]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":D(F,"data",x)}var aa=F.constraints;if(aa)for(M=0;M<aa.length;M++){var pa=aa[M];pa.target&&D(pa,"target",x)}var ca=F.lod_levels;if(ca)for(M=0;M<ca.length;M++){var da=ca[M];da.object&&D(da,"object",x)}}for(B=0;B<l.length;B++)for(var X=l[B].materials,M=0;M<X.length;M++)D(X,M,x);for(B=0;B<h.length;B++){for(var ea=h[B],G=ea.texture_slots,M=0;M<G.length;M++)D(G[M],"texture",x);var fa=
ea.node_tree;fa&&J(fa,x)}for(B=0;B<m.length;B++)(fa=m[B].node_tree)&&J(fa,x);for(B=0;B<t.length;B++){var bb=t[B],ja=bb.type;"IMAGE"!=ja&&"ENVIRONMENT_MAP"!=ja||D(bb,"image",x)}for(B=0;B<f.length;B++){var xa=f[B];xa.dof_object&&D(xa,"dof_object",x)}for(B=0;B<q.length;B++){var T=q[B];T.sound&&D(T,"sound",x);if(T.animation_data&&(L=T.animation_data,L.action&&D(L,"action",x),L.nla_tracks))for(M=0;M<L.nla_tracks.length;M++)for(N=L.nla_tracks[M],P=0;P<N.strips.length;P++)N.strips[P].action&&D(N.strips[P],
"action",x)}for(B=0;B<r.length;B++){for(var na=r[B],G=na.texture_slots,M=0;M<G.length;M++)D(G[M],"texture",x);na.dupli_group&&D(na,"dupli_group",x);na.dupli_object&&D(na,"dupli_object",x)}for(B=0;B<v.length;B++)if(G=v[B].texture_slots)for(M=0;M<G.length;M++)D(G[M],"texture",x);ta.jA(a);za=0===b.id;qa||(qa=a.scenes[0]);for(var la=a.textures,oa=za?a.scenes[0].b4w_anisotropic_filtering:qa.b4w_anisotropic_filtering,ma=0;ma<la.length;ma++)za||"SCENE"!=la[ma].b4w_source_type||(la[ma].b4w_source_id=""),
Ja.cB(la[ma],oa,a.scenes);for(var ra={},va=a.objects,ib=0;ib<va.length;ib++){var Aa=va[ib];if("MESH"===Aa.type&&!Aa.particle_systems.length)for(var Ga=Aa.data,Oa=Ga.name,Ya=Ga.submeshes,Ha=Ga.materials,Ca=0;Ca<Ya.length;Ca++)0!==Ya[Ca].base_length||ra[Oa]||(Ha[Ca]&&ba.warn('material "'+Ha[Ca].name+'" is not assigned to any face (object "'+Aa.name+'").'),ra[Oa]=!0)}for(var Ma=a.meshes,db=0;db<Ma.length;db++){var pb=Ma[db];pb.materials.length||pb.uv_textures.length&&ba.warn('mesh "'+pb.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",
use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,
b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});
for(var rb=a.meshes,Bb=wa.Xb("name","DEFAULT",a.materials),Cb=0;Cb<rb.length;Cb++){var Hb=rb[Cb];0==Hb.materials.length&&Hb.materials.push(Bb)}for(var Kb=a.actions,Wb=b.id,Yb=0;Yb<Kb.length;Yb++){var Qb=Kb[Yb];Qb.ez=Wb;Z.pz(Qb)}for(var rc=a.scenes,Mb=0;Mb<rc.length;Mb++){for(var sc=rc[Mb],xc=O.sn(sc,"ALL"),lc=[],Zb=0;Zb<xc.length;Zb++)for(var Xc=xc[Zb].particle_systems,hc=0;hc<Xc.length;hc++){var ub=Xc[hc].settings;if("HAIR"==ub.type)if("OBJECT"==ub.render_type)Fa.nq(ub.dupli_object,!0);else if("GROUP"==
ub.render_type){for(var vb=ub.dupli_group,ic=O.sn(sc,"EMPTY"),Rb=0;Rb<ic.length;Rb++)ic[Rb].dupli_group==vb&&lc.push(ic[Rb]);for(Rb=0;Rb<vb.objects.length;Rb++)Fa.nq(vb.objects[Rb],!0)}else ba.warn("render type",ub.render_type,"not supported for particle systems ("+ub.name+").")}for(Zb=0;Zb<lc.length;Zb++)k(lc[Zb],[sc])}ka(a,b.id);for(var Yc=a.scenes,Jc=0;Jc<Yc.length;Jc++){for(var Zc=Yc[Jc],Pc=[],$c=[],Kc=Yc[Jc].objects,zb=0;zb<Kc.length;zb++){var ad=Kc[zb];K(Kc,ad,Pc,$c);var bd=ad.dupli_group;if(bd)for(var yc=
bd.objects,Qc=0;Qc<yc.length;Qc++)K(yc,yc[Qc],Pc,$c)}for(zb=0;zb<$c.length;zb++)k($c[zb],[Zc]);for(zb=0;zb<Pc.length;zb++)wa.Ez(Pc[zb][0],Pc[zb][1])}ka(a,b.id);var Xa=A(a,b.id);ta.Nz(Xa,a.scenes);for(ma=0;ma<Xa.length;ma++){var zc=Xa[ma];!za&&zc.parent&&-1<cc.indexOf(zc.parent.type)&&(zc.parent="");Fa.nq(zc,!1);zc.d.vd=b.id}for(var Ac=0;Ac<Xa.length;Ac++){var Lc=Xa[Ac];if("MESH"==Lc.type){var cd=Z.Xi(Lc);if(cd){var Mc=cd.d;if(Mc.He){var dd=Lc.d.Lc,Rc=[],Sc;for(Sc in dd){var ed=dd[Sc];Rc.push(4*ed.Ki,
4*ed.Rr)}Mc.$u.push(Rc)}Mc.em.push(Lc.d)}}}for(var Nc=-1,Bc=0;Bc<Xa.length;Bc++){var Cc=Xa[Bc],Sb=Cc.d;if(wa.ec(Cc)&&Sb.fj){var kd=Sb.dd;kd>Nc&&(Nc=kd)}}for(Bc=0;Bc<Xa.length;Bc++)if(Cc=Xa[Bc],Sb=Cc.d,wa.ec(Cc)&&Sb.fj){Sb.dd=Nc;var jc=Cc,Dc=Sb.dd,fd=sa.dd,tc=jc.d;Dc>2*fd?wa.sa('too many bones for "'+jc.name+'"'):Dc>fd?(ba.warn('too many bones for "'+jc.name+'" / '+Dc+" bones (max "+fd+"). Blending between frames will be disabled."),tc.Ti=!1):tc.Ti=!0;tc.Ti=tc.Ti&&!mc.jt}for(var gd=0;gd<Xa.length;gd++){var $b=
Xa[gd];if(wa.ec($b)){var xd=$b.lod_levels.length;if(xd)for(var jd=$b,Ic=0;Ic<xd;Ic++){var Oc=$b.lod_levels[Ic].object;if(!Oc){jd.d.sl=!0;jd.d.Xe=$b.lod_levels[Ic].distance;break}Oc.d.qg=$b.d.qg;jd.d.Xe=$b.lod_levels[Ic].distance;Oc.d.jj=$b.lod_levels[Ic].distance;if($b.lod_levels[Ic+1])Oc.d.Xe=$b.lod_levels[Ic+1].distance;else{Oc.d.sl=!0;Oc.d.Xe=1E4;break}jd.d.sl=!1;jd=Oc}}}for(var rd=0;rd<Xa.length;rd++){var ia=Xa[rd];if(ia.b4w_vehicle){var $a=ia.b4w_vehicle_settings;if("CHASSIS"==$a.part){ia.i=
{};ia.i.ht=$a.force_max;ia.i.Sr=$a.brake_max;ia.i.PF=$a.suspension_compression;ia.i.RF=$a.suspension_stiffness;ia.i.QF=$a.suspension_damping;ia.i.DG=$a.wheel_friction;ia.i.WL=$a.roll_influence;ia.i.KD=$a.max_suspension_travel_cm;ia.i.sh=0;ia.i.Di=1;ia.i.ei=0;ia.i.speed=0;ia.i.Dg=[];ia.i.xj=[];ia.i.fi=null;for(var yd=ia.ya?ia.ya.dupli_group.objects:Xa,Tc=0;Tc<yd.length;Tc++){var Ka=yd[Tc];if(Ka.b4w_vehicle){var fb=Ka.b4w_vehicle_settings;if(W.mD(Ka)&&$a.name==fb.name){var zd=W.EG(Ka.b4w_vehicle_settings.part);
ia.i.Dg[zd]=Ka;ia.i.xj[zd]=new Float32Array(8)}else if(W.Ju(Ka)&&$a.name==fb.name){ia.i.fi=Ka;ia.i.Xp=fb.steering_max;ia.i.Uw=fb.steering_ratio;ia.i.Bu=fb.inverse_control;var Ab=Na.invert(ia.d.R,new Float32Array(16)),ld=Na.multiply(Ab,Ka.d.R,Ab);ia.i.Ww=ld;var Uc=new Float32Array([1,0,0,0]);ab.transformMat4(Uc,ld,Uc);ia.i.Vw=Uc}else if(W.Iu(Ka)&&$a.name==fb.name){ia.i.Up=Ka;ia.i.Pw=fb.speed_ratio;ia.i.Vo=fb.max_speed_angle;var Ab=Na.invert(ia.d.R,new Float32Array(16)),md=Na.multiply(Ab,Ka.d.R,Ab);
ia.i.Rw=md;var Vc=new Float32Array([1,0,0,0]);ab.transformMat4(Vc,md,Vc);ia.i.Qw=Vc}else if(W.Ku(Ka)&&$a.name==fb.name){ia.i.$p=Ka;ia.i.Os=fb.delta_tach_angle;var Ab=Na.invert(ia.d.R,new Float32Array(16)),nd=Na.multiply(Ab,Ka.d.R,Ab);ia.i.dx=nd;var Wc=new Float32Array([1,0,0,0]);ab.transformMat4(Wc,nd,Wc);ia.i.cx=Wc}}}if(4!=ia.i.Dg.length)throw"Not enough wheels for chassis "+ia.name;}else if("HULL"==$a.part){ia.i={};ia.i.Dg=[];ia.i.xj=[];ia.i.ht=$a.force_max;ia.i.Sr=$a.brake_max;ia.i.Wn=$a.floating_factor;
ia.i.uq=$a.water_lin_damp;ia.i.vq=$a.water_rot_damp;ia.i.sh=0;ia.i.Di=1;ia.i.ei=0;ia.i.speed=0;ia.i.fi=null;for(var Ad=ia.ya?ia.ya.dupli_group.objects:Xa,Tc=0;Tc<Ad.length;Tc++)Ka=Ad[Tc],Ka.b4w_vehicle&&(fb=Ka.b4w_vehicle_settings,W.lD(Ka)&&$a.name==fb.name?(ia.i.Dg.push(Ka),ia.i.xj.push(new Float32Array(8))):W.Ju(Ka)&&$a.name==fb.name?(ia.i.fi=Ka,ia.i.Xp=fb.steering_max,ia.i.Uw=fb.steering_ratio,ia.i.Bu=fb.inverse_control,Ab=Na.invert(ia.d.R,new Float32Array(16)),ld=Na.multiply(Ab,Ka.d.R,Ab),ia.i.Ww=
ld,Uc=new Float32Array([1,0,0,0]),ab.transformMat4(Uc,ld,Uc),ia.i.Vw=Uc):W.Iu(Ka)&&$a.name==fb.name?(ia.i.Up=Ka,ia.i.Pw=fb.speed_ratio,ia.i.Vo=fb.max_speed_angle,Ab=Na.invert(ia.d.R,new Float32Array(16)),md=Na.multiply(Ab,Ka.d.R,Ab),ia.i.Rw=md,Vc=new Float32Array([1,0,0,0]),ab.transformMat4(Vc,md,Vc),ia.i.Qw=Vc):W.Ku(Ka)&&$a.name==fb.name&&(ia.i.$p=Ka,ia.i.Os=fb.delta_tach_angle,Ab=Na.invert(ia.d.R,new Float32Array(16)),nd=Na.multiply(Ab,Ka.d.R,Ab),ia.i.dx=nd,Wc=new Float32Array([1,0,0,0]),ab.transformMat4(Wc,
nd,Wc),ia.i.cx=Wc))}}}for(var sd=0;sd<Xa.length;sd++){var uc=Xa[sd];if(uc.b4w_floating){var od=uc.b4w_floating_settings;if("MAIN_BODY"==od.part){uc.Kc={};uc.Kc.Wn=od.floating_factor;uc.Kc.uq=od.water_lin_damp;uc.Kc.vq=od.water_rot_damp;uc.Kc.rk=[];for(var Bd=uc.ya?uc.ya.dupli_group.objects:Xa,td=0;td<Bd.length;td++){var hd=Bd[td];if(hd.b4w_floating){var Cd=hd.b4w_floating_settings;W.pD(hd)&&od.name==Cd.name&&(uc.Kc.rk.push(hd),hd.Xz=hd.b4w_floating_settings.synchronize_position)}}}}}e(b,c)}function m(a,
b,c,d,e){!za&&1<a.scenes.length&&(a.scenes=[a.scenes[0]],ba.warn("loading data contains multiple scenes.","Only the first one will be loaded."));-1==mc.La&&za&&(mc.La=a.scenes[0].fps);for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];if(za&&!f.camera)throw"Scene check failed: No camera";for(var g=O.sn(f,"MESH"),h=0;h<g.length;h++){var l=g[h],m=ta.Gz(l);m&&(a.meshes.push(m),l.data=m)}for(var h=A(a,b.id),l=a.meshes,m=l.slice(0),k=0;k<h.length;k++){var n=h[k];"MESH"==n.type&&(n=m.indexOf(n.data),-1<n&&
m.splice(n,1))}for(k=0;k<m.length;k++)l.splice(l.indexOf(m[k]),1);za?(O.uz(f,a.textures),f.d.si.length&&(b.yo=!0),ra.enabled&&f.b4w_enable_physics&&W.Er(f),f.b4w_enable_audio&&ga.Fr(f),h=O.io(f),l=f.b4w_batch_grid_size):(O.Bz(f,qa,a.textures),ra.enabled&&f.b4w_enable_physics&&!qa.l&&W.Er(qa),f.b4w_enable_audio&&!qa.h&&ga.Fr(qa),h=O.io(qa),l=qa.b4w_batch_grid_size);m=[];oa.eC(h,l,g,f.world,m,qa.d.Pu);za?(O.nr(f,m),O.YB(h)):O.nr(qa,m)}d=a.materials;if(Oa.Hn&&sa.rx)for(a=0;a<d.length;a++){h=d[a];l=h.texture_slots;
for(f=0;f<l.length;f++)if(m=l[f],k=m.texture,"IMAGE"==k.type||"ENVIRONMENT_MAP"==k.type)g=k.image,g.mc||(-1<g.filepath.indexOf(".dds")?g.mc=!0:(g.mc=!k.b4w_disable_compression&&!m.use_map_normal&&"ENVIRONMENT_MAP"!=k.type&&!k.b4w_shore_dist_map&&"MOVIE"!=g.source,g.mc&&(g.filepath+=".dds")));if(f=h.node_tree)for(h=f.nodes,f=0;f<h.length;f++)g=h[f],"TEXTURE"==g.type&&(l=g.texture)&&(g=l.image)&&!g.mc&&(g.mc=l.d.jk&&!l.b4w_disable_compression&&"MOVIE"!=g.source,g.mc&&(g.filepath+=".dds"))}else for(a=
a.images,d=0;d<a.length;d++)f=a[d],f.mc=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));e(b,c)}function t(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},g={},h={},l={},m=0;m<d.length;m++){var k=d[m];f[k.uuid]=k;h[k.uuid]=k}for(m=0;m<a.length;m++)k=a[m],g[k.uuid]=k,l[k.uuid]=k;z(a,null,l,h);for(var n in h)n in f||d.push(h[n]);for(n in l)n in g||a.push(l[n]);e(b,c)}function z(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=c[g.uuid];if(g=h.proxy){b&&-1==e.indexOf(g.uuid)&&e.push(g.uuid);
for(var l=c[g.uuid],m=l.constraints,g=0;g<m.length;g++){var k=wa.Nf(m[g]);k.name+="_CLONE";h.constraints.push(k)}"b4w_proxy_inherit_anim"in h&&!h.b4w_proxy_inherit_anim||(h.animation_data&&(l.animation_data=wa.Nf(h.animation_data)),l.b4w_use_default_animation=h.b4w_use_default_animation,l.b4w_auto_skel_anim=h.b4w_auto_skel_anim,l.b4w_anim_behavior=h.b4w_anim_behavior,l.b4w_cyclic_animation=h.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)h=wa.jo(a,"uuid",e[f]),-1<h&&a.splice(h,1);e={};for(f=0;f<a.length;f++)g=
a[f],h=c[g.uuid],b&&(m=wa.Nf(h),h="origin_name"in h?h.origin_name:h.name,m.name=b+"*"+h,m.origin_name=h,C(m),c[m.uuid]=m,e[g.uuid]=m.uuid,g.uuid=m.uuid),h=c[g.uuid],h.dupli_group&&(g=h.dupli_group,m=d[g.uuid],l=wa.Nf(m),l.name=wa.mm(m.name+"_CLONE"),l.uuid=na.vu("Group"+l.name),d[l.uuid]=l,g.uuid=l.uuid,z(l.objects,h.name,c,d));if(b)for(f=0;f<a.length;f++){g=a[f];h=c[g.uuid];h.parent&&h.parent.uuid in e?h.parent.uuid=e[h.parent.uuid]:h.parent&&(ba.warn("Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),
h.parent=null);m=h.constraints;for(g=0;g<m.length;g++)b=m[g],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=h.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(g=0;g<h.length;g++)b=h[g],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var n in e)db[n]=e[n]}function C(a){a.uuid=na.vu("Object"+a.name)}function J(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&
e.texture&&D(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in db&&(e.lamp.uuid=db[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&D(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var f=e[d];y(f,"from_node",c);y(f,"to_node",c);n(f,"from_socket",f.from_node.outputs);n(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&D(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],f=0;f<e.strips.length;f++)e.strips[f].action&&
D(e.strips[f],"action",b)}function D(a,b,c){(c=c[a[b].uuid])||ba.error("Dangling link found:",b,a);a[b]=c}function y(a,b,c){c=wa.Xb("name",a[b].name,c);a[b]=c}function n(a,b,c){c=wa.Xb("identifier",a[b].identifier,c);a[b]=c}function l(a,d,e,f,g,h){if(!sa.do_not_load_resources){for(var l=U(d.s),m=a.images,k={},n=[],r=0;r<m.length;r++){var p=m[r],q=p.uuid;if("FILE"===p.source||"MOVIE"===p.source){var t=c(p,a.textures);if(!t.length)ba.warn("image ",p.name," has no users.");else if(!(t[0].b4w_shore_dist_map||
"MOVIE"===p.source&&sa.dt)){t=Q(l+p.filepath);if("FILE"===p.source){var v=p.mc?aa.Xj:aa.Yj;Oa.Wo&&sa.qm&&(t=aa.Lj(t),"dds"==t[1]?(t=aa.Lj(t[0]),t=t[0]+".min50."+t[1]+".dds"):t=t[0]+".min50."+t[1])}else"MOVIE"===p.source&&(sa.jd?(t=aa.Lj(t),t=t[0]+".altconv.seq",v=aa.Zj):(t=aa.Lj(t),v=ga.Mn(t[1]),t=v!=t[1]?t[0]+".altconv."+v:t[0]+"."+v,v=aa.$j));n.push([q,v,t]);k[q]=p}}}n.length?(f.wu=0,aa.sc(n,function(g,l,m,r){if(g){if(m==aa.$j||m==aa.Zj){if(m==aa.$j)var p=g.videoWidth,q=g.videoHeight;else p=g.images[0].width,
q=g.images[0].height;ba.log("%cLOAD VIDEO "+p+"x"+q,"color: #"+(2048<p||2048<q?"a00":1024<p||1024<q?"aa0":"0a0"),r);-1==r.indexOf(Ga)&&ba.warn("video",r,"is not from app root.")}else b(g,r,!0);l=k[l];r=c(l,a.textures);for(p=0;p<r.length;p++){var q=r[p],t=q.image.filepath;m==aa.Zj?(q.d.ew=g.bc,Ja.Pj(q.d,g.images,l.mc,t)):Ja.Pj(q.d,g,l.mc,t)}}g=++f.wu/n.length;h(d,e,g)},function(){ba.log("%cLOADED ALL IMAGES","color: #0a0");g(d,e)})):g(d,e)}}function c(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];
e.image===a&&c.push(e)}return c}function M(a,b,c,d,e,f){if(!sa.do_not_load_resources){a=A(a,b.id);for(var g=U(b.s),h=[],l={},m=0;m<a.length;m++){var k=a[m];if(I(k)){var n=k.data.sound,r=n.uuid;"BACKGROUND_MUSIC"==ga.no(k)?(r=wa.nt(),b.uo=!0):"NONE"!=ga.no(k)&&sa.zu&&(b.Bo=!0);if(!(r in l)){l[r]=[];n=Q(g+n.filepath);switch(ga.Mw(k)){case ga.zm:var p=aa.Aq;break;case ga.yq:p=aa.Bq}var n=aa.Lj(n),q=ga.Ln(n[1]),n=q!=n[1]?n[0]+".altconv."+q:n[0]+"."+q;h.push([r,p,n])}l[r].push(k)}}h.length?aa.sc(h,function(a,
e,g,m){if(a)for(ba.log("%cLOAD SOUND","color: #0aa",m),-1==m.indexOf(Ga)&&ba.warn("sound",m,"is not from app root."),e=l[e],g=0;g<e.length;g++)ga.oG(e[g],a);a=++d.uF/h.length;f(b,c,a)},function(){ba.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)}):e(b,c)}}function I(a){return ga.pe(a)&&ga.Mw(a)!=ga.zq?!0:!1}function x(a,b){for(var c=O.zb(a,"SPEAKER",O.O),d=0;d<c.length;d++){var e=c[d];ga.pe(e)&&(ga.Ch(e)||b)&&ga.kp(e)}}function B(a){a=a.d.si;for(var b=0;b<a.length;b++)sa.jd&&a[b].use_auto_refresh?
a[b].d.Sh=!0:a[b].d.hb&&a[b].use_auto_refresh&&a[b].d.hb.play()}function E(a,b,c,d,e){bb.start();ba.log("%cSTART NLA","color: #0a0");e(b,c)}function K(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,f=0;f<e;f++){var g=b.lod_levels[f],h=g.object;if(h){var l=wa.zk(h);l.name=b.name+"_LOD_"+String(f+1);C(l);l.lod_levels=[];c.push([a,l]);d.push(h);g.object=l}}}function k(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=
f.objects,g=f.indexOf(a),-1<g&&f.splice(g,1))}var g=d.indexOf(a);-1<g&&d.splice(g,1)}}function u(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d],g=za?f.b4w_enable_physics:qa.b4w_enable_physics||f.b4w_enable_physics;za||(f=qa);for(var h=0;h<Kb.length;h++)for(var l=O.zb(f,Kb[h],O.O),m=0;m<l.length;m++){var k=l[m];k.d.vd==b.id&&ra.enabled&&g&&(W.Ke(k,f),b.No&&W.D(k)&&W.Nk(k))}}e(b,c)}function r(a,d,e,f,g){var h={};f=[];for(var l=a.scenes,m=0;m<a.scenes.length;m++){var k=l[m];if(k.d.Xa&&(k=
k.d.Xa.dm)&&"FILE"===k.source){var n=k.uuid,r=Q(U(d.s)+k.filepath);f.push([n,k.mc?aa.Xj:aa.Yj,r]);h[n]=k}}f.length?aa.sc(f,function(d,e,f,g){if(d){b(d,g,!0);e=h[e];g=c(e,a.textures);for(f=0;f<g.length;f++){var m=g[f];Ja.Pj(m.d,d,e.mc,m.image.filepath)}for(f=0;f<l.length;f++)if(g=l[f],g.d.Xa.dm===e){var k=d,n=document.createElement("canvas"),m=e.size[0],r=e.size[1];n.width=m;n.height=r;n=n.getContext("2d");n.drawImage(k,0,0);k=n.getImageData(0,0,m,r).data;n=new Float32Array(4);n[0]=1/16581375;n[1]=
1/65025;n[2]=1/255;n[3]=1;for(var m=m*r,r=new Float32Array(m),p=0;p<m;p++)r[p]=n[1]*k[4*p+2]+n[2]*k[4*p+3];g.d.Mp=r}}},function(){g(d,e)}):g(d,e)}function L(a,c,d,e,f){if(sa.antialiasing&&sa.smaa){e=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],h=0;h<g.length;h++){var l=O.ja(e,g[h]);l&&a.push(l)}if(a.length){e=[];h=aa.Yj;e.push(["SEARCH_TEXTURE",h,la.Yb.smaa_search_texture_path]);e.push(["AREA_TEXTURE",h,la.Yb.smaa_area_texture_path]);
for(h=0;h<a.length;h++)if(g=a[h],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.na;for(h=0;h<a.length;h++)if(g=a[h],"u_search_tex"==g.ea)var m=g.oa;else if("u_area_tex"==g.ea)var k=g.oa;break}e.length?aa.sc(e,function(a,c,d,e){a&&(b(a,e,!1),c="SEARCH_TEXTURE"==c?m:k,c.source="IMAGE",c.Kr=!0,Ja.Pj(c,a,-1!=e.indexOf(".dds")?1:0,e),Ja.Gp(c,Ja.H,Ja.H))},function(){f(c,d)}):f(c,d)}else f(c,d)}else f(c,d)}function F(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];za||(e=qa);for(var f=O.zb(e,
"LAMP",O.O),g=0;g<f.length;g++){var h=f[g];h.d.vd==b.id&&(b.No&&wa.ec(h)&&O.aj(h),d.Lm.push({dw:e,hc:h}))}f=O.zb(e,"ALL",O.O);for(g=0;g<f.length;g++)h=f[g],"LAMP"!=h.type&&h.d.vd==b.id&&(b.No&&wa.ec(h)&&O.aj(h),d.Lm.push({dw:e,hc:h}))}}function f(a,b,c,d,e,f){e=d.Lm;var g=d.jv;e.length?(a=e[g].hc,g=e[g].dw,O.Ke(g,a,!1),-1!=Wb.indexOf(a.type)&&g.b4w_enable_audio&&ga.Ke(a,g),ca.Cu(a)&&ca.append(a),d=++d.jv/e.length,"LAMP"==a.type&&O.sF(g)):d=1;f(b,c,d)}function N(a,b,c,d,e){if(za){d=O.KC();for(var f=
O.Zk(),g=0;g<d.length;g++){var h=d[g];O.iE(h,f);h.b4w_use_nla&&bb.lG(h,h.b4w_nla_cyclic)}O.Cp(f)}else O.qx(qa);a=A(a,b.id);Fa.kG(a);e(b,c)}function P(a,b,c,d,e){if(za)for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||B(a.scenes[d]),x(a.scenes[d]);else a.scenes[0].b4w_use_nla||B(qa),x(qa);e(b,c)}function V(a,b,c,d,e){sa.hg&&(b.yo||b.uo||b.Bo)?Aa||R(a,e,b,c):e(b,c)}function R(a,b,c,d){var e=rb.canvas.parentElement;Cb=e.style.zIndex;e.style.zIndex="999";Aa=document.createElement("div");Aa.style.position=
"relative";Aa.style.height="88px";Aa.style.width="88px";var f=Math.round(rb.canvas.offsetWidth/2-44);Aa.style.top=Math.round(rb.canvas.offsetHeight/2-44).toString()+"px";Aa.style.left=f.toString()+"px";Aa.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAYAAABxlTA0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAhOSURBVHic7Z1tjFxVGcd/z1AKsbzotoW0IQqFhpSXFlugxbbGRkNSLJEQLVJttH7VEl8+oCYYExLFDxilJib6AWshtlterN20hkBKsNitpFVapB9YIzGBWEq3+IKCLf374Tx3587szGxn5577Mt1fcnN37r1zznP+c/a55557znOMkiDJgLnAADDT9+ktOQYwChwHTvh+tGl7zcyUp/3tsCIzlzQdWAwsA24CLs4o6X8ALwDDwEEz+19G6XZN7gJLugi4mSDqh4HzUqffBN6gXkPT++RvaKzhM5v2lwCzUmm+C/yRIPYfzOyfMcrVjlwE9n//lcAngQVALXV6hFD435vZ3zLK74PARwg/4lWpU6eBI8Au4Lk83Eh0gSUtBDYA8/3QaeAlYB8wbGbHIuc/myD0LcB11H/cEeBhM3sxZv7RBJZ0OfBF4EY/9CawDdhrZv+Kle8ENl0IrADuou5GDhKE/muMPDMXWNIs4PPAxz39t4FBYGeRN5s0fnO9HVgLzAAE7AG2ZP0flZnAkmrAOuBOYDpwEhgCBouqsRPhNXotsAY4l2DzDoLQ72WRRyYCS7oAuJfQKohWG2Lhfno9sIqgySHg+6WoGJIuk/QzSUOSHpF0TdE2TRZJ13gZhiT93FsjhRq0RNI2N2iTpEsKNSgDJM2S9GMv06CkGyf+Vnsm7SIk3QF8idDs2Qc8aGbv9GJMWZB0HvBVQttdhFbGE5NJq2uBJU0DvgJ8wg9tBR4ty7N /lkhaS/DNBjwDbDKzU7Ez/bL/+zwh6aNRMysBkpZK2u5l/lrszNZ4Ro9LujpqZiVC0ryUyHfGyuQGSTsk7ZS0PEomJcZr8k7ferrxtUp8rqSt/guuyzTxCiFpbap1cUZNuNpEF0iaAXwHuAB4HvhVb2ZWFzMbBH4HvA+4z58EO9JRYH/8vRe4DPgL8MN+bC10yY8IWswBviXpnE4XT1SDP0d44/AWcL+ZvZuJiRXGNbifoMlCQjOueyTNlvSk+5zrMrSxL/DH6p2u0ex213WqwesJPUzPm9lLmVtYcczsZUKn1rl0qMUtBZZ0BaFn6RSwOYaBfcIWQhfnKtdsHO1q8AbC4+Fvzez1SMZVHu+OHSJotaHVNeMElrSIcGP7L6GfIRqSdklaEDOPHBgkvLVZ7No10CCwv/1NfonHzeytyMatBg5JekjSwIRXlxDvlB/0jxtcw9ZIWumthl9KOj+2cWrkuKSN3ltXKSRNl/QL125l+lyzi7jV91sL6NsdAB4i1OjVOefdE/4yd5t/vDV9bkxgfyS+HngPeC4368azANhVQf+8lzDm43rXEmiswUuAacCfzezfORvXikr5Z/fFLxM0vCk5nhb4Ft8P52jXREwDNgKvVMQ/J9olWgaB3fAlfmx/zkadCVXxz4nAS3xwy1gNXkjognvVzI4WYdkZUmr/bGZ/B14FzgdugLrAy3xfJvfQiTL750TDZQA1bxgvbTpZBcrqnxMXu1SS1QijDGcCo2Y2Upxdk6Zs/nmEMFj8YmBOjSAuQNU7dUrhn/2NT6LlzBqNE0v6gTL450TLvhQYivfPiZYD/SpwQlH++awROCFv/9wgcHKTO97m4n4iL/+caHnW1OA0efjnlje5s6EGp4npnxtq8BQRqZGqzkUaUgCjwD3AQjPbnXHaiZajaYHL1mkSi1PAJmC+mcUasT7mdqdxdtXg3cA3zOxI5HwSLU+kBe7nGnyEIGzWrqAdYzW4RuqOl1PmeRLTz3 ZirOnbrzX4FPBT4LtmVkT7vq8FzsvPdqKlwHMLMiYr8vaznUi0PF4DjhH88ICkq9p/p7QU5Wdb4hoOEOIGvV7zHvix90iFWdY9ebRnJ0PyAnm/mSl5VB5uOll2dhNq7D0F3cQ60fCGPhH4EPAf4IqSz5g/AtxmZrcVfBNriaRLgcuBd4A/gQvs/14H/LoyuolS+dkOJNodSMLnpHvT9vm+TG6irH62HYl2iZakO5sPEAp0raQZZvZ2npa1oAzt2TPGZ31eS9DwheT4WA12QQ8TRF+Rt4EpSu1nO7AcOAc4nK6czR3uT/n+7mR0YI5Uxc+Ow7X6rH98Kn2uWeC9hKE/s4BPxTcNqJ6fbcXtBM1GCBq2R9Ki1JT9i2JaVfQwpyyQdKHqgaE6T+MC8FiOBwnjhe+OaVwF/WwrkuiBB1vFwWz30vNhQrSl1ZLmRDSu0vgk8DV4ZKpW17QU2ANl7iG0KL4Qy8A+IJkwv6ddcNFOr+2Tic4rpsIZjEchwuEqgkZb2l3XVmCf6Pykf/ymQlTVKRhzDd8mTALf0SlG50QDTx4hhOd+PyFGTd5t49KhEBXwPoImhwkataWjwGZ2GngAeA24EogbmK3k+HyWrwPzgKPA9zJptytEWE3aenf1nGBFkbTONdgu6UNZJ75Y0m88Tk0ZuzSjImm56oHp4pRf0h3+Cz4maV6UTEqIpCu9zEOSPtPNd7saXWlmvwaeJsxk/IGkm7v5fhXxMj5AKPOzZra9m+/3Gt5WwGYze6zbdKqApE8THrSS8LY/MbOT3aSRVYDmPYTYuqVYZaBXvDm6kfAg0VOA5l4NSYcYf7CE84a7RtKAlyWTEONZGJQOkr9ZFY4rLOlqL0NmQfJjLfPwLGGZhzeySD82PlRhPfAxMl7mYWqhkiosVJJGU0vtNJDnYlHHgEcJi0UVshyEQiy4FYSwvUnE1GotFtWMxi93dhJ4kTDgcH/ssWXeslnq2yKCK4CqL3eWRu0X7BPwC mGg3HDGC/Yt820+9XL234J9zajzkpNHCcEsTlBfZvJE02eoLzf5Ad/Sn+cCl6bS7P8lJ9uhqUVT80N9uuzv/wFReZvk3/McjgAAAABJRU5ErkJggg==')";
Ma=document.createElement("div");Ma.style.position="relative";Ma.style.height=rb.canvas.offsetHeight.toString()+"px";Ma.style.width=rb.canvas.offsetWidth.toString()+"px";Ma.style.background="rgba(0, 0, 0, 0.5)";Ma.style.zIndex="999";e.appendChild(Ma);Ma.appendChild(Aa);Aa.addEventListener("click",function(){c.yo&&(Ja.play(),Ja.pause(),Ja.reset());if(c.uo){if(za)for(var e=0;e<a.scenes.length;e++)x(a.scenes[e],!0);else x(qa,!0);ga.pause()}c.Bo&&ga.cE();ea();b(c,d)},!1)}function ea(){if(Aa){var a=rb.canvas.parentElement;
a.style.zIndex=Cb;Ma.removeChild(Aa);a.removeChild(Ma);Aa=Ma=null;Cb=0}}function U(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function X(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function Q(a){var b=a.split("://",2);return 1<
b.length?(b[1]=X(b[1]),b.join("://")):X(a)}function S(a,b,c){Z.Ia(b)&&Z.remove(b);O.xk(b);W.D(b)&&(W.Nk(b),W.tE(b));ma.gh(b)&&ma.se(b);O.vE(a,b,c);ga.pe(b)&&ga.wF(b);ca.Cu(b)&&ca.remove(b)}function A(a,b){va[b]||ka(a,b);return va[b]}function ka(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)fa(c[e].objects,0,d);va[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var g=c[f],h=0;h<g.length;h++)va[b].push(g[h])}function fa(a,b,c){c[b]=c[b]||[];for(var d=c[b],e=0;e<a.length;e++){var f=
a[e],g=da(f);d[g]=d[g]||[];(za||-1==cc.indexOf(f.type))&&-1==d[g].indexOf(f)&&d[g].push(f);(f=f.dupli_group)&&fa(f.objects,b+1,c)}}function da(a){return(a=a.parent||Z.Xi(a))?1+da(a):0}var ca=w("__anchors"),Z=w("__animation"),oa=w("__batch"),la=w("__config"),ma=w("__controls"),ha=w("__dds"),pa=w("__extensions");w("__lights");var H=w("__loader"),aa=w("__assets"),na=w("__md5"),Fa=w("__objects"),W=w("__physics"),ba=w("__print"),ta=w("__reformer"),Bb=w("__renderer"),O=w("__scenes"),bb=w("__nla"),ga=w("__sfx"),
xa=w("__shaders"),Ja=w("__textures"),ib=w("__nodemat"),wa=w("__util"),ab=w("vec4"),Na=w("mat4"),sa=la.p,Oa=la.Xd,ra=la.Bb,mc=la.Wd,ja=la.ld,Ya=null,va=null,Ga="",za=!1,qa=null,db={},Aa=null,Ma=null,Cb=0,cc=["LAMP","CAMERA"],Kb=["MESH","CAMERA","EMPTY"],Wb=["SPEAKER"],rb=null;a.oe=function(a){return H.oe(a)};a.update=function(){H.mG(Ya)};a.Bc=function(a){rb=a};a.jG=function(a,b){if(Aa){Ma.style.height=b.toString()+"px";Ma.style.width=a.toString()+"px";var c=Math.round(a/2-44);Aa.style.top=Math.round(b/
2-44).toString()+"px";Aa.style.left=c.toString()+"px"}};a.load=function(a,b,c,g,h){var k={load_main:{Ta:H.Af,lb:!1,I:[],pb:!1,sb:500,Gb:!1,ab:q},duplicate_objects:{Ta:H.rd,lb:!1,I:["load_main"],pb:!1,sb:50,Gb:!1,ab:t},load_binaries:{Ta:H.Af,lb:!1,I:["load_main"],pb:!1,sb:500,Gb:!1,ab:d},prepare_bindata:{Ta:H.rd,lb:!1,I:["duplicate_objects","load_binaries"],pb:!1,sb:0,Gb:!1,ab:p},prepare_root_datablocks:{Ta:H.rd,lb:!1,I:["duplicate_objects","prepare_bindata"],pb:!1,sb:150,Gb:!1,ab:v},prepare_root_scenes:{Ta:H.rd,
lb:!1,I:["prepare_root_datablocks"],pb:!1,sb:350,Gb:!1,ab:m},load_smaa_textures:{Ta:H.Af,lb:!0,I:["prepare_root_scenes"],pb:!1,sb:10,Gb:!0,ab:L},load_shoremap:{Ta:H.Af,lb:!0,I:["prepare_root_scenes"],pb:!1,sb:10,Gb:!0,ab:r},load_textures:{Ta:H.Af,lb:!0,I:["prepare_root_scenes"],pb:!0,sb:500,Gb:!1,ab:l,Mf:{wu:0}},add_physics_objects:{Ta:H.rd,lb:!1,I:["load_shoremap"],pb:!1,sb:20,Gb:!1,ab:u},add_objects:{Ta:H.rd,lb:!1,I:["add_physics_objects"],pb:!1,sb:800,Gb:!1,ab:F,fh:f,Ei:N,Mf:{Lm:[],jv:0}},load_speakers:{Ta:H.Af,
lb:!0,I:["add_objects"],pb:!0,sb:30,Gb:!1,ab:M,Mf:{uF:0}},mobile_media_start:{Ta:H.rd,lb:!sa.hg,I:["load_textures","load_speakers"],pb:!0,sb:5,Gb:!1,ab:V,fh:V},synchronize_media:{Ta:H.rd,lb:!0,I:["mobile_media_start"],pb:!0,sb:70,Gb:!1,ab:P},start_nla:{Ta:H.rd,lb:!0,I:["mobile_media_start"],pb:!1,sb:5,Gb:!1,ab:E}},n=H.St();n||(n=H.WA(),Ya=[],va=[],db={});Ya[n.Md.length]={};return H.dB(k,a,b,c,e,g||ja.Hr,sa.do_not_load_resources,h)};a.nm=function(a){var b=H.St();if(!b||!b.Md.length||a&&!H.TF(b.Md[a]))ba.error("Unable to unload data!");
else{if(0==a)ba.log("%cUNLOAD ALL","color: #00a"),ca.Y(),Z.Y(),ga.Y(),bb.Y(),O.Y(),H.Y(),W.Y(),Fa.Y(),wa.Y(),Bb.Y(),ib.Y(),xa.Y(),ma.Y(),pa.Y(),aa.Y(),Ja.Y(),va=null,db={},za=!1,Ya=qa=null;else{ba.log("%cUNLOAD DATA "+a,"color: #00a");Z.sE(a);for(var b=O.Vk(),c=0;c<b.length;c++)for(var d=b[c],e=O.zb(d,"ALL",O.O),f=e.length-1;0<=f;f--){var g=e[f];if(g.d.vd==a){S(d,g,!0);e.splice(f,1);var h=O.zb(d,g.type,O.O),g=h.indexOf(g);-1!=g&&h.splice(g,1)}}}ea()}};a.hE=S;a.mw=function(a){Ga=a}};b4w.module.__anchors=function(a,w){function e(a){var c=document.createElement("div"),e=c.style;e.position="absolute";e.backgroundColor="black";e.borderRadius="20px 20px 20px 0px";e.boxShadow="0px 0px 10px rgb(180, 180, 200)";e.opacity=1;e.padding="8px 12px";e.lineHeight="15px";e.visibility="hidden";var g=D.parentElement;g.appendChild(c);var h=v.Yi(a),l=document.createElement("span"),m=l.style;l.innerHTML=h.title||a.name;m.fontWeight="bold";m.fontSize="12px";m.lineHeight="15px";m.color="#fff";m.fontFamily=
"Arial";d(l);c.appendChild(l);var n=h.description;if(n){a=document.createElement("div");var p=a.style;p.position="absolute";p.bottom="0px";p.left="0px";p.backgroundColor="#000";p.borderRadius="20px 20px 20px 0px";p.boxShadow="0px 0px 10px rgb(180, 180, 200)";p.visibility="hidden";p.padding="8px 12px";p.overflow="hidden";p.lineHeight="15px";p.fontSize="12px";p.zIndex="2";c.appendChild(a);var h=document.createElement("span"),t=h.style;h.innerHTML=n;t.fontSize="12px";t.fontFamily="Arial";t.fontWeight=
"bold";t.lineHeight="15px";t.color="#fff";t.visibility="hidden";a.appendChild(h);var f=!1,z=!1;g.addEventListener("click",function(a){if(!(f||z||y))if(a.target!=l&&a.target!=c||"hidden"!=p.visibility||1!=e.opacity)"visible"==p.visibility&&(e.visibility="visible",m.visibility="visible",p.visibility="hidden",t.visibility="hidden");else{e.visibility="hidden";m.visibility="hidden";p.visibility="visible";f=z=!0;a=c.offsetWidth;var d=c.offsetHeight,g=Math.min(250,b(n)),h=q(n,g);g>a?C.pr(a,g,function(a){a==
g&&("visible"==p.visibility&&(t.visibility="visible"),f=!1);p.width=a+"px"}):f=!1;h>d?C.pr(d,h,function(a){a==h&&("visible"==p.visibility&&(t.visibility="visible"),z=!1);p.height=a+"px"}):z=!1}},!1)}return c}function b(a){var b=document.createElement("div"),c=document.createElement("span"),d=b.style;c.innerHTML=a;c.style.fontSize="12px";c.style.fontFamily="Arial";c.style.fontWeight="bold";c.style.color="#fff";c.style.visibility="hidden";d.lineHeight="15px";b.appendChild(c);d.position="absolute";d.visibility=
"hidden";d.fontSize="12px";d.display="inline-block";d.lineHeight="15px";document.body.appendChild(b);a=b.offsetWidth+1;document.body.removeChild(b);return a}function q(a,b){var c=document.createElement("div"),d=document.createElement("span"),e=c.style;d.innerHTML=a;d.style.fontSize="12px";d.style.fontFamily="Arial";d.style.fontWeight="bold";d.style.color="#fff";d.style.visibility="hidden";e.lineHeight="15px";c.appendChild(d);e.position="absolute";e.visibility="hidden";e.fontSize="12px";e.display=
"inline-block";e.width=b+"px";e.lineHeight="15px";document.body.appendChild(c);d=c.offsetHeight;document.body.removeChild(c);return d}function d(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]="none";a.style.cursor="default"}function h(){for(var a=0,b=0;b<n.length;b++)n[b].Nn&&a++;l=new Float32Array(3*a)}var p=w("__batch"),g=w("__camera"),
v=w("__objects"),m=w("__print"),t=w("__renderer"),z=w("__scenes"),C=w("__time");w("__util");var J=w("__config").p,D=null,y=!1,n=[],l=new Float32Array(0),c=new Uint8Array(16),M=new Float32Array(3);a.Ob=function(a){D=a};a.append=function(a){var b;a:{for(b=0;b<n.length;b++)if(n[b].hc==a){b=!0;break a}b=!1}if(!b){b={type:a.b4w_anchor.type,hc:a,x:0,y:0,depth:0,bh:"out",Nn:a.b4w_anchor.detect_visibility,element:null,Kh:null,qr:0};switch(b.type){case "ANNOTATION":b.element=e(a);b.qr=b.element.offsetHeight;
break;case "ELEMENT":b.element=document.getElementById(a.b4w_anchor.element_id),b.element||(m.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}n.push(b);h()}};a.remove=function(a){for(var b=0;b<n.length;b++){var c=n[b];if(c.hc==a){"ANNOTATION"==c.type&&D.parentElement.removeChild(c.element);n.splice(b,1);h();break}}};a.update=function(){for(var a=0,b=0;b<n.length;b++){var c=n[b];c.Nn&&(l.set(c.hc.d.g,3*a),a++);var d,e=c,h=M;d=z.Wk(z.Zk());h=g.op(d,e.hc.d.g,h);h[0]/=J.resolution_factor;
h[1]/=J.resolution_factor;e=z.bu();h[0]/=e;h[1]/=e;d=h;h=d[0];e=d[1];d=d[2];if(h!=c.x||e!=c.y||d!=c.depth){switch(c.type){case "ANNOTATION":var m=c.element;m.style.left=Math.floor(h)+"px";m.style.top=Math.floor(e-c.qr)+"px";break;case "ELEMENT":m=c.element,m.style.left=Math.floor(h-m.offsetWidth/2)+"px",m.style.top=Math.floor(e-m.offsetHeight/2)+"px"}c.x=h;c.y=e;c.depth=d;c.Kh&&c.Kh(h,e,c.bh,c.hc,m)}}0<a&&(a=z.ja(z.Zk(),"ANCHOR_VISIBILITY").o[0].n,p.$F(a,l))};a.rG=function(){for(var a=0;a<n.length;a++){var b=
n[a],d=b.x,e=b.y,g=b.depth,g=0>d||0>e||0>g||1<g||d>=D.clientWidth||e>=D.clientHeight?"out":"visible";if(b.Nn&&"out"!=g){var g=b,h=z.ja(z.Zk(),"ANCHOR_VISIBILITY");if(h){var l=z.bu(),m=g.x*l,l=g.y*l,m=m*J.resolution_factor,l=l*J.resolution_factor,h=h.j;t.Sv(h.he,m,h.height-l,2,2,c);g=1020==c[0]+c[4]+c[8]+c[12]?"visible":"out"==g.bh||0==c[0]+c[4]+c[8]+c[12]?"covered":g.bh}else g=void 0}if(g!=b.bh){switch(b.type){case "ANNOTATION":case "ELEMENT":var p=b.element;if(!p)break;"out"==g?(p.style.visibility=
"hidden",p.children.length&&(p.children[0].style.visibility="hidden"),"ANNOTATION"==b.type&&1<p.children.length&&(m=p.children[1],m.style.visibility="hidden",m.children.length&&(m.children[0].style.visibility="hidden"))):"visible"==g?(p.style.visibility="visible",p.children.length&&(p.children[0].style.visibility="visible"),p.style.opacity=1):(p.style.visibility="visible",p.style.opacity=.1,p.children.length&&(p.children[0].style.visibility="visible"),"ANNOTATION"==b.type&&1<p.children.length&&(m=
p.children[1],m.style.visibility="hidden",m.children.length&&(m.children[0].style.visibility="hidden")))}b.bh=g;b.Kh&&b.Kh(d,e,b.bh,b.hc,p)}}};a.BI=function(a,b){for(var c=0;c<n.length;c++)n[c].hc==a&&(n[c].Kh=b)};a.qJ=function(a){for(var b=0;b<n.length;b++)n[b].hc==a&&(n[b].Kh=null)};a.Y=function(){for(var a=0;a<n.length;a++){var b=n[a];"ANNOTATION"==b.type&&D.parentElement.removeChild(b.element)}n.length=0};a.Cu=function(a){return a.b4w_anchor?!0:!1};a.pause=function(){y=!0};a.hd=function(){y=!1}};b4w.module.__md5=function(a){function w(a,g){var h=a[0],m=a[1],t=a[2],z=a[3],h=b(h,m,t,z,g[0],7,-680876936),z=b(z,h,m,t,g[1],12,-389564586),t=b(t,z,h,m,g[2],17,606105819),m=b(m,t,z,h,g[3],22,-1044525330),h=b(h,m,t,z,g[4],7,-176418897),z=b(z,h,m,t,g[5],12,1200080426),t=b(t,z,h,m,g[6],17,-1473231341),m=b(m,t,z,h,g[7],22,-45705983),h=b(h,m,t,z,g[8],7,1770035416),z=b(z,h,m,t,g[9],12,-1958414417),t=b(t,z,h,m,g[10],17,-42063),m=b(m,t,z,h,g[11],22,-1990404162),h=b(h,m,t,z,g[12],7,1804603682),z=b(z,h,m,t,
g[13],12,-40341101),t=b(t,z,h,m,g[14],17,-1502002290),m=b(m,t,z,h,g[15],22,1236535329),h=q(h,m,t,z,g[1],5,-165796510),z=q(z,h,m,t,g[6],9,-1069501632),t=q(t,z,h,m,g[11],14,643717713),m=q(m,t,z,h,g[0],20,-373897302),h=q(h,m,t,z,g[5],5,-701558691),z=q(z,h,m,t,g[10],9,38016083),t=q(t,z,h,m,g[15],14,-660478335),m=q(m,t,z,h,g[4],20,-405537848),h=q(h,m,t,z,g[9],5,568446438),z=q(z,h,m,t,g[14],9,-1019803690),t=q(t,z,h,m,g[3],14,-187363961),m=q(m,t,z,h,g[8],20,1163531501),h=q(h,m,t,z,g[13],5,-1444681467),z=
q(z,h,m,t,g[2],9,-51403784),t=q(t,z,h,m,g[7],14,1735328473),m=q(m,t,z,h,g[12],20,-1926607734),h=e(m^t^z,h,m,g[5],4,-378558),z=e(h^m^t,z,h,g[8],11,-2022574463),t=e(z^h^m,t,z,g[11],16,1839030562),m=e(t^z^h,m,t,g[14],23,-35309556),h=e(m^t^z,h,m,g[1],4,-1530992060),z=e(h^m^t,z,h,g[4],11,1272893353),t=e(z^h^m,t,z,g[7],16,-155497632),m=e(t^z^h,m,t,g[10],23,-1094730640),h=e(m^t^z,h,m,g[13],4,681279174),z=e(h^m^t,z,h,g[0],11,-358537222),t=e(z^h^m,t,z,g[3],16,-722521979),m=e(t^z^h,m,t,g[6],23,76029189),h=
e(m^t^z,h,m,g[9],4,-640364487),z=e(h^m^t,z,h,g[12],11,-421815835),t=e(z^h^m,t,z,g[15],16,530742520),m=e(t^z^h,m,t,g[2],23,-995338651),h=d(h,m,t,z,g[0],6,-198630844),z=d(z,h,m,t,g[7],10,1126891415),t=d(t,z,h,m,g[14],15,-1416354905),m=d(m,t,z,h,g[5],21,-57434055),h=d(h,m,t,z,g[12],6,1700485571),z=d(z,h,m,t,g[3],10,-1894986606),t=d(t,z,h,m,g[10],15,-1051523),m=d(m,t,z,h,g[1],21,-2054922799),h=d(h,m,t,z,g[8],6,1873313359),z=d(z,h,m,t,g[15],10,-30611744),t=d(t,z,h,m,g[6],15,-1560198380),m=d(m,t,z,h,g[13],
21,1309151649),h=d(h,m,t,z,g[4],6,-145523070),z=d(z,h,m,t,g[11],10,-1120210379),t=d(t,z,h,m,g[2],15,718787259),m=d(m,t,z,h,g[9],21,-343485551);a[0]=h+a[0]&4294967295;a[1]=m+a[1]&4294967295;a[2]=t+a[2]&4294967295;a[3]=z+a[3]&4294967295}function e(a,b,d,e,h,q){b=(b+a&4294967295)+(e+q&4294967295)&4294967295;return(b<<h|b>>>32-h)+d&4294967295}function b(a,b,d,h,q,z,C){return e(b&d|~b&h,a,b,q,z,C)}function q(a,b,d,h,q,z,C){return e(b&h|d&~h,a,b,q,z,C)}function d(a,b,d,h,q,z,C){return e(d^(b|~h),a,b,q,
z,C)}var h="0123456789abcdef".split("");a.vu=function(a){var b=a,d=b.length;a=[1732584193,-271733879,-1732584194,271733878];var e;for(e=64;e<=b.length;e+=64){for(var q=b.substring(e-64,e),z=[],C=void 0,C=0;64>C;C+=4)z[C>>2]=q.charCodeAt(C)+(q.charCodeAt(C+1)<<8)+(q.charCodeAt(C+2)<<16)+(q.charCodeAt(C+3)<<24);w(a,z)}b=b.substring(e-64);q=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<b.length;e++)q[e>>2]|=b.charCodeAt(e)<<(e%4<<3);q[e>>2]|=128<<(e%4<<3);if(55<e)for(w(a,q),e=0;16>e;e++)q[e]=0;q[14]=8*
d;w(a,q);for(b=0;b<a.length;b++){d=a[b];e="";for(q=0;4>q;q++)e+=h[d>>8*q+4&15]+h[d>>8*q&15];a[b]=e}return a.join("")}};b4w.module.__hud=function(a,w){function e(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function b(a){q(' SCENE "'+a.name+'"');if(a.d){var b=0,d=0;g.U(a.d.Ab,function(a,e){if("SINK"==e.type)q(" (F)",e.type);else{var g=e.type,h=Math.round(e.j.width)+"x"+Math.round(e.j.height),l=e.o.length,c=e.Ii,m=e.sc&&e.aa;m?q(" (A)",g,e.wg,h,c,"of",l):q(" (P)",g,e.wg,h,c,"of",l);e.Ii=0;m&&(b+=l,d+=c)}});return[b,d]}q("No INFO")}function q(){for(var a=80+20*m[0],b=[5,18,
3,10,4,3,5],d=arguments[0],e=1;e<arguments.length;e++){for(var g="",h=0;h<b[e]-String(arguments[e]).length;h++)g+=" ";d+=g+arguments[e]}m[0]++;v.fillText(d,30,a)}function d(a,b,d){b*=a.Ea;d.x=a.x+b;d.y=a.y;d.Ea=a.Ea-2*b;d.va=a.va}function h(a){return a.x+a.Ea/2}function p(a){var b=v,e={x:0,y:0,Ea:0,va:0},g=b.canvas.width,b=b.canvas.height;e.x=0;e.y=0;e.Ea=g;e.va=b;d(e,.01,e);g=.02*e.va;e.x=e.x;e.y+=g;e.Ea=e.Ea;e.va-=2*g;g=e.Ea/8;e.x+=g*a;e.y=e.y;e.Ea=g;e.va=e.va;d(e,.02,e);return e}var g=w("__graph"),
v=null,m=[0,0];a.Ob=function(a){a=a.getContext("2d");e(a);return v=a};a.pi=function(){v&&e(v)};a.reset=function(){var a=v;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),m[0]=0,m[1]=0)};a.nF=function(a,d){var e=v;if(e){e.textAlign="left";e.fillStyle="rgba(0,255,0,255)";q(" FPS",(1/d).toFixed(2));m[0]++;for(var g=e=0,h=0;h<a.length;h++){var p=b(a[h]),e=e+p[0],g=g+p[1];m[0]++}q(" ---------------------------------------------");
q("    ","TOTAL ACTIVE","","",g,"of",e)}};a.print=function(){var a=v;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",q.apply(Math,arguments))};a.NL=function(a,b,d,e,g,m,n){var l=v;if(l){b=p(b);var c=b.va/5;b.x=b.x;b.y+=4*c;b.Ea=b.Ea;b.va=c;l.textAlign="center";l.fillStyle="#00FF00";v.fillText(a,h(b),b.y-10);l.strokeStyle="#00FF00";l.lineWidth=.5;l.beginPath();l.moveTo(b.x,b.y);l.lineTo(b.x+b.Ea,b.y);l.lineTo(b.x+b.Ea,b.y+b.va);l.lineTo(b.x,b.y+b.va);l.closePath();l.stroke();if(!m&&!n)for(m=
1E6,n=-1E6,a=0;a<d.length;a++)m=Math.min(m,d[a]),n=Math.max(n,d[a]);l.textAlign="right";v.fillText(String(m),b.x-10,b.y+b.va);v.fillText(String(n),b.x-10,b.y);l.textAlign="center";v.fillText(String(e),b.x,b.y+b.va+15);v.fillText(String(g),b.x+b.Ea,b.y+b.va+15);l.strokeStyle="#FF0000";l.lineWidth=1.5;l.beginPath();e=b.Ea/(d.length-1);n=b.va/(n-m);for(a=0;a<d.length;a++)g=b.x+e*a,c=b.y+b.va-(d[a]-m)*n,0==a?l.moveTo(g,c):l.lineTo(g,c);l.stroke()}};a.wJ=function(a,b,d,e,g,m,n){var l=v;if(l)for(l.textAlign=
"center",l.fillStyle="#00FF00",l.font="bold 12px Courier",d=p(d),v.fillText(b?"["+a+"]":a,h(d),d.y),0<=m&&v.fillText(m?"[M]":"[ ]",h(d)-15,d.y+30),0<=n&&v.fillText(n?"[S]":"[ ]",h(d)+15,d.y+30),a={x:0,y:0,Ea:0,va:0},b=0;b<e.length;b++){m=e[b];var c="VOLUME"==m[0];if(c){n=d.y+350;var q=d.Ea,w=a;w.x=d.x;w.y=n;w.Ea=q;w.va=250}else{n=d.y+10+50*b;var q=d.Ea,w=d.va,x=a;x.x=d.x;x.y=n;x.Ea=q;x.va=w}n=l;var q=a,x=b==g,B=m[0],w=m[1],E=m[2],K=m[3],k=(K-E)/m[4],k=1>k?Math.floor(1/k-1E-5).toFixed(0).length:0;
m=m[5]?Math.log(w/E)/Math.log(K/E):(w-E)/(K-E);n.textAlign="center";x?n.fillText("["+B+"]",h(q),q.y):n.fillText(B,h(q),q.y);n.strokeStyle="#00FF00";n.lineWidth=c?3:1;c?(n.textAlign="right",n.fillText(K.toFixed(k),h(q)-10,q.y+15),n.textAlign="right",n.fillText(E.toFixed(k),h(q)-10,q.y+q.va-15)):(n.textAlign="right",n.fillText(E.toFixed(k),q.x+28,q.y+15),n.textAlign="left",n.fillText(K.toFixed(k),q.x+q.Ea-28,q.y+15));n.beginPath();if(c){var u=q.y+15+(q.va-30)*(1-m);n.moveTo(h(q),q.y+15);n.lineTo(h(q),
q.y+q.va-15);n.moveTo(h(q)-5,q.y+15);n.lineTo(h(q)+5,q.y+15);n.moveTo(h(q)-5,q.y+q.va-15);n.lineTo(h(q)+5,q.y+q.va-15);n.moveTo(h(q)-5,u);n.lineTo(h(q)+5,u)}else{var r=q.x+30+(q.Ea-60)*m;n.moveTo(q.x+30,q.y+15);n.lineTo(q.x+q.Ea-30,q.y+15);n.moveTo(q.x+30,q.y+15-5);n.lineTo(q.x+30,q.y+15+5);n.moveTo(q.x+q.Ea-30,q.y+15-5);n.lineTo(q.x+q.Ea-30,q.y+15+5);n.moveTo(r,q.y+15-5);n.lineTo(r,q.y+15+5)}n.stroke();"EQ_Q"==B?(m=Math.log(1+1/(2*w*w)+Math.sqrt((2+1/(w*w))*(2+1/(w*w))/4-1))/Math.log(2),c?(n.textAlign=
"left",n.fillText(w.toFixed(k),h(q)+10,u),n.textAlign="left",n.fillText("("+m.toFixed(k+1)+")",h(q)+10,u+10)):(n.textAlign="right",n.fillText(w.toFixed(k),r,q.y+30),n.textAlign="left",n.fillText("("+m.toFixed(k+1)+")",r,q.y+30))):c?(n.textAlign="left",n.fillText(w.toFixed(k),h(q)+10,u)):(n.textAlign="center",n.fillText(w.toFixed(k),r,q.y+30))}}};b4w.module.__prerender=function(a,w){var e=w("__config"),b=w("__debug"),q=w("__geometry"),d=w("__util"),h=w("__renderer"),p=w("vec3"),g=e.p,v="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH GLOW_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.np=function(a){if(-1<v.indexOf(a.type)){for(var e=!1,w=a.o,C=0;C<w.length;C++){var J=w[C],D=J,y=a,n=D.qb,l=y.j;D.aa=!0;n.ql=!1;if(n)if(n.$i)D.aa=!1;else{var c=l.Re,M=n.Cb.C,I=n.Xe,c=Math.sqrt((M[0]-c[0])*(M[0]-c[0])+(M[1]-c[1])*
(M[1]-c[1])+(M[2]-c[2])*(M[2]-c[2])),M=n.qg*n.Cb.Ca;c>=n.jj&&c<I+M?(n.ql=!0,"GLOW_MASK"!=y.type||Boolean(n.bg)?(l=l.$n,n.oh?n=!1:"STATIC"===n.type?(I=n.Cb,n=I.C,n=d.AF(n,l,I.Ca)):(I=n.Kf,n=I.C,n=d.zB(n,l,I.Gf,I.Hf,I.If)),n?D.aa=!1:"WIREFRAME"==y.type&&(D.aa=D.n.wireframe_mode==b.gr.WM_DEBUG_SPHERES?D.n.Ji:!D.n.Ji)):D.aa=!1):D.aa=!1}else D.aa=!1;J.aa&&(e=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||e?a.aa=!0:(a.aa&&h.clear(a),a.aa=!1)}}if("MAIN_BLEND"==
a.type&&(e=a.j.Re,p.dist(e,a.Hx)>g.alpha_sort_threshold&&g.alpha_sort&&a.o)){for(w=0;w<a.o.length;w++)J=a.o[w],D=J.n,C=J.qb.R,D&&D.Ga&&D.De!=q.Td&&(D=D.$a)&&J.aa&&(J=D.kl)&&J.type==q.hr&&q.cG(D,C,e);a.Hx.set(e)}}};b4w.module.camera=function(a,w){function e(a,c){b.Fb(a)?(v.copy(c,a.d.Pb),p.F(a),q.T(a)):d.error("set_pivot(): Wrong object or camera move style")}var b=w("__camera");w("__config");var q=w("__physics"),d=w("__print"),h=w("__constraints"),p=w("__transform"),g=w("__util"),v=w("vec3"),m=w("vec4");w("quat");var t=w("mat3"),z=w("mat4"),C=new Float32Array(2),J=new Float32Array(3),D=new Float32Array(3),y=new Float32Array(4),n=new Float32Array(9);a.Ug=b.Ug;a.Dm=b.Dm;a.qa=b.qa;a.Jb=b.Jb;a.vb=b.vb;a.Ve=b.Ve;
a.Fb=b.Fb;a.We=b.We;a.ob=b.ob;a.qM=function(a,b){a.d.ga=b};a.$f=function(a){return b.Ve(a)?b.$f(a):(d.error("get_move_style(): Wrong object"),null)};a.gF=function(a,c){if(b.Fb(a)||b.We(a)||b.ob(a)){var e=a.d;e.rq=c[0];e.qq=c[1];e.sq=c[2]}else d.error("set_velocity_params(): Wrong object or camera move style")};a.Zi=function(a,c){if(!b.Fb(a)&&!b.We(a)&&!b.ob(a))return d.error("get_velocity_params(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));var e=a.d;c[0]=e.rq;c[1]=e.qq;c[2]=
e.sq;return c};a.oM=function(a,c,d,e){var g=a.d;b.LB(c,d,e,g.g,g.quat);p.F(a);q.T(a)};a.Et=function(a,c){if(b.Ve(a))return c||(c=new Float32Array(3)),v.copy(a.d.g,c),c;d.error("get_eye(): Wrong object")};a.xM=e;a.DM=function(a,c,e){b.Fb(a)?(v.copy(c,a.d.g),v.copy(e,a.d.Pb),p.F(a),q.T(a)):d.error("set_trans_pivot(): Wrong object or camera move style")};a.lo=function(a,c){if(b.Fb(a))return c||(c=new Float32Array(3)),v.copy(a.d.Pb,c),c;d.error("get_pivot(): Wrong object or camera move style")};a.YL=
function(b,c,e){d.error("rotate_pivot() deprecated, use rotate_camera() or rotate_target_camera() instead");a.ue(b,c,e)};a.PD=function(a,c,e){if(b.Fb(a)){var g=a.d;if(g.sx){var h=t.fromMat4(g.R,n),m=v.subtract(g.g,g.Pb,D);J[0]=c;J[1]=0;J[2]=e;v.scale(J,v.len(m),J);v.transformMat3(J,h,J);v.add(g.Pb,J,g.Pb);v.add(g.g,J,g.g);p.F(a);q.T(a)}}else d.error("move_pivot(): wrong object")};a.XL=function(b,c){d.error("rotate_hover_cam() deprecated, use rotate_camera() or rotate_hover_camera() instead");a.Gg(b,
c,0)};a.oK=function(a){d.error("get_hover_cam_angle() deprecated, use get_camera_angles() instead");return b.ob(a)?-b.bd(a,C)[1]:(d.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.iM=function(a,c){d.error("set_hover_cam_angle() deprecated, use rotate_camera() or rotate_hover_camera() instead");if(b.ob(a))if(a.d.Va){var e=b.bd(a,C);(e=-c-e[1])&&b.Gg(a,0,e);p.F(a);q.T(a)}else d.error("set_hover_cam_angle(): distance/hover_angle limits are not defined or disabled");else d.error("set_hover_cam_angle(): wrong object or camera move style")};
a.FC=function(a,c){if(b.ob(a))return a.d.Wb?(c||(c=new Float32Array(2)),c[0]=a.d.Wb.Na,c[1]=a.d.Wb.Ua):d.error("get_hover_angle_limits(): camera hasn't angle limits"),c;d.error("get_hover_angle_limits(): wrong object")};a.qC=function(a){var c;if(b.ob(a)||b.Fb(a))return a.d.Va?(c||(c=new Float32Array(2)),c[0]=a.d.Sf,c[1]=a.d.wd):d.error("get_cam_dist_limits(): camera hasn't distance limits"),c;d.error("get_cam_dist_limits(): wrong object")};a.UM=function(b,c){d.error("translate_hover_cam_v() deprecated, use hover_cam_set_translation() instead");
a.zo(b,c)};a.zo=function(a,c){if(b.ob(a)){var e=a.d;if(e.Va){var g=v.subtract(c,e.g,J);v.add(g,e.tc,e.tc)}p.kd(a,c);p.F(a);q.T(a)}else d.error("hover_cam_set_translation(): wrong object")};a.GC=function(a,c){if(!b.ob(a))return d.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));v.copy(a.d.tc,c);return c};a.vo=function(a){return b.Fb(a)||b.ob(a)?a.d.Va:(d.error("has_distance_limits(): wrong object"),null)};a.rI=function(a,c,e,g){switch(b.$f(a)){case b.qa:case b.Jb:g|=p.Gm;
break;case b.vb:if(c>e){d.error("apply_vertical_limits(): wrong vertical limits");return}break;default:d.error("apply_vertical_limits(): wrong object");return}a.d.Nd={Na:c,Ua:e};b.jE(a,g==p.ek);p.F(a);q.T(a)};a.aJ=function(a){a.d.Nd=null};a.pI=function(a,c,e,g){switch(b.$f(a)){case b.qa:case b.Jb:break;case b.vb:if(c>e){d.error("apply_horizontal_limits(): wrong horizontal limits");return}break;default:d.error("apply_horizontal_limits(): wrong object");return}a.d.dc={left:c,right:e};b.fE(a,g==p.ek);
p.F(a);q.T(a)};a.XI=function(a){a.d.dc=null};a.EC=function(a,c){if(b.Fb(a)||b.We(a)||b.ob(a)){var e=a.d;c=c||new Float32Array(2);if(e.dc)return c[0]=e.dc.left,c[1]=e.dc.right,c}else d.error("get_horizontal_limits(): wrong object")};a.dD=function(a){if(b.Fb(a)||b.We(a)||b.ob(a))return Boolean(a.d.dc);d.error("has_horizontal_limits(): wrong object")};a.qI=function(a,c,e){b.ob(a)?c<e?d.error("apply_hover_angle_limits(): wrong hover angle limits"):(c=g.Ff(c,-Math.PI,Math.PI),e=g.Ff(e,-Math.PI,Math.PI),
c=g.ra(c,-Math.PI/2,0),e=g.ra(e,-Math.PI/2,0),a.d.Wb={Na:c,Ua:e},b.gD(a),p.F(a),q.T(a)):d.error("apply_hover_angle_limits(): wrong object")};a.YI=function(a){b.ob(a)?a.d.Wb=null:d.error("clear_hover_angle_limits(): wrong object")};a.nI=function(a,c,e){if(b.Fb(a)||b.ob(a))if(c>e)d.error("apply_distance_limits(): wrong distance limits");else{var g=a.d;g.Va=!0;g.wd=c;g.Sf=e;p.F(a);q.T(a)}else d.error("apply_distance_limits(): wrong object")};a.VI=function(a){b.Fb(a)||b.ob(a)?a.d.Va=!1:d.error("clear_distance_limits(): wrong object")};
a.eM=function(b,c,e){d.error("set_eye_params() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.Uc(b,c,Math.PI/2-e)};a.gL=function(a){g.ka(a.d.quat,g.$b,J);return 0<=J[1]?!0:!1};a.aw=function(e,c){switch(a.$f(e)){case b.Ug:case b.Dm:break;case b.qa:b.ue(e,c,0,void 0,void 0);break;case b.Jb:b.Uc(e,c,0,void 0,void 0);break;case b.vb:b.Gg(e,c,0,void 0,void 0);break;default:d.error("rotate_camera(): Wrong object")}p.F(e);q.T(e)};a.ue=function(a,c,e,g,h){b.Fb(a)?(b.ue(a,c,e,g,h),p.F(a),
q.T(a)):d.error("rotate_target_camera(): wrong object")};a.Uc=function(a,c,e,g,h){b.We(a)?(b.Uc(a,c,e,g,h),p.F(a),q.T(a)):d.error("rotate_eye_camera(): wrong object")};a.Gg=function(a,c,e,g,h){b.ob(a)?(b.Gg(a,c,e,g,h),p.F(a),q.T(a)):d.error("rotate_hover_camera(): wrong object")};a.rotate=function(b,c,e){d.error("rotate() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.Uc(b,c,-e)};a.bd=function(a,c){c||(c=new Float32Array(2));b.bd(a,c);return c};a.Xk=function(a,c){c||(c=new Float32Array(2));
b.Xk(a,c);return c};a.qt=function(a,c){d.error("get_angles() deprecated, use get_camera_angles() instead");c||(c=new Float32Array(2));b.qt(a,c);return c};a.yw=function(a,c){for(var d=a.d.K,e=0;e<d.length;e++){var g=d[e];g.type!=b.Kb&&g.type!=b.Tb||b.cF(g,c,g.Kd)}};a.Zt=function(a){a=a.d.K;for(var c=0;c<a.length;c++){var d=a[c];if(d.type==b.Kb||d.type==b.Tb)return d.Mj}return 0};a.hL=function(a){d.error("is_underwater() deprecated, always returns false");return a.d.jx};a.VM=function(a,c,d,e){a=a.d.K;
for(var g=0;g<a.length;g++){var h=a[g];h.Hb||b.Th(h,h.jb);var m=J;m[0]=-c;m[1]=-d;m[2]=0;z.translate(h.wa,m,h.wa);z.rotateZ(h.wa,e,h.wa);z.multiply(h.wa,h.pa,h.Qg);b.cA(h);b.bA(h)}};a.Ek=function(a,b){b||(b=g.ta);h.Ek(a,b)};a.iN=function(a,c){if(b.Fb(a)){p.$k(c,!1,J);e(a,J);p.F(a);var g=p.ko(c),h=b.kC(a)/2,g=g/Math.sin(h),h=p.XD(a,J);p.vc(a,0,g-h,0);p.F(a);q.T(a)}else d.error("zoom_object(): wrong object")};a.wM=function(e,c){if(b.Ve(e)&&a.Gu(e)){var g=e.d;if(b.Fb(e)){var h=v.dist(g.g,g.Pb);g.Bh=
c/2*g.Ah/h}else b.ob(e)&&a.vo(e)?(h=v.distance(g.g,g.tc),g.Bh=c/2*g.Ah/h):e.d.K[0].top=c/2;b.px(e)}else d.error("set_ortho_scale(): wrong object")};a.wK=function(e){if(b.Ve(e)&&a.Gu(e))return 2*e.d.K[0].top;d.error("get_ortho_scale(): wrong object")};a.Gu=function(a){if(b.Ve(a))return a.d.K[0].type==b.sd;d.error("is_ortho_camera(): wrong object")};a.FI=function(a,c,e,g){g||(g=new Float32Array(3));var h=a.d.K[0];switch(h.type){case b.Ic:case b.Ef:case b.Kb:case b.Tb:var n=Math.tan(h.ge*Math.PI/360);
y[0]=(2*c/h.width-1)*n*h.jb;y[1]=-1;y[2]=(2*e/h.height-1)*n;y[3]=0;m.transformMat4(y,a.d.R,y);g[0]=y[0];g[1]=y[1];g[2]=y[2];v.normalize(g,g);return g;default:return d.error("Non-compatible camera"),g}};a.op=function(a,c,d){d||(d=new Float32Array(2));return b.op(a,c,d)}};b4w.module.config=function(a,w){var e=w("__config");a.Df=e.Df;a.Cf=e.Cf;a.Wg=e.Wg;a.$q=e.$q;a.set=e.set;a.get=e.get;a.reset=e.reset;a.Yt=e.Yt};b4w.module.constraints=function(a,w){var e=w("__constraints"),b=w("__physics"),q=w("__transform");a.kI=function(a,h,p,g,v){v=v||1;h instanceof Array&&2==h.length?e.sr(a,h[0],h[1],p,g,v):e.tr(a,h,p,g,v);q.F(a);b.T(a)};a.iI=function(a,h,p,g){e.xz(a,h,p,g);q.F(a);b.T(a)};a.jI=function(a,h,p,g,v,m,t,w){e.wz(a,h,p,g,v,m,t,w);q.F(a);b.T(a)};a.hI=function(a,h,p,g){if(!g||0>g)g=.25;e.vz(a,h,p,g);q.F(a);b.T(a)};a.yz=function(a,h){e.zz(a,h);q.F(a);b.T(a)};a.fI=function(a,h,p){e.rz(a,h,p);q.F(a);b.T(a)};a.lI=
function(a,h,p,g){e.Az(a,h,p,g);q.F(a);b.T(a)};a.mI=function(a,h){3==h.length?e.Dz(a,h):e.Cz(a,h);q.F(a);b.T(a)};a.gI=function(a,h,p,g){3==h.length?e.tz(a,h,p,g):e.sz(a,h,p,g);q.F(a);b.T(a)};a.remove=function(a){a.ib&&e.remove(a)}};b4w.module.controls=function(a,w){var e=w("__controls"),b=w("__print");a.ba=e.ba;a.Bm=e.Bm;a.pd=e.pd;a.od=e.od;a.hH=8;a.SH=9;a.pH=13;a.PH=16;a.lH=17;a.fH=18;a.LH=19;a.jH=20;a.rH=27;a.RH=32;a.Lq=37;a.Oq=38;a.Mq=39;a.Kq=40;a.AH=96;a.BH=97;a.CH=98;a.DH=99;a.EH=100;a.FH=101;a.GH=102;a.HH=103;a.IH=104;a.JH=105;a.Iq=65;a.gH=66;a.Zx=67;a.Jq=68;a.oH=69;a.$x=70;a.tH=71;a.vH=72;a.wH=73;a.xH=74;a.ay=75;a.by=76;a.yH=77;a.zH=78;a.KH=79;a.dy=80;a.NH=81;a.ey=82;a.Nq=83;a.gy=84;a.TH=85;a.UH=86;a.Pq=87;a.VH=88;a.WH=
89;a.XH=90;a.XG=49;a.YG=50;a.ZG=51;a.$G=52;a.aH=53;a.bH=54;a.cH=55;a.dH=56;a.eH=57;a.nH=110;a.OH=186;a.qH=187;a.kH=188;a.mH=189;a.MH=190;a.sH=191;a.uH=192;a.cy=219;a.iH=220;a.fy=221;a.QH=222;a.dk=e.dk;a.ck=e.ck;a.bk=e.bk;a.ys=e.ys;a.Qa=e.Qa;a.yn=e.yn;a.xs=e.xs;a.Ds=e.Ds;a.Fk=e.Fk;a.zn=e.zn;a.mh=e.mh;a.Gi=e.Gi;a.Ik=e.Ik;a.Bs=e.Bs;a.Gs=e.Gs;a.zs=e.zs;a.As=e.As;a.Fs=function(a,b){return e.Fs(a,b||!1)};a.Yv=e.Yv;a.kh=e.kh;a.Es=e.Es;a.An=function(a,b){return e.An(a,b||!1)};a.bM=function(a,b){e.PE(a,b)};
a.fK=function(a){return a.value};a.Nb=e.Nb;a.ke=e.ke;a.iJ=function(a,d,h){b.error("create_sensor_lock() deprecated");a.Ro=d.slice(0);a.Qo=Array(d.length);a.tl=h||e.Jn};a.QL=function(a){b.error("remove_sensor_lock() deprecated");a.Ro=null;a.Qo=null;a.tl=null};a.L=function(a,b,h,p,g,v,m){g=g||e.Jn;e.L(a,b,h,p,g,v,void 0===m?null:m)};a.lh=function(a,b,h,p,g){var v;p=e.Qa(p);e.L(a,b,h,[p],e.Jn,g,void 0===v?null:v)};a.RI=function(a){return e.gh(a,null)};a.gh=e.gh;a.RL=function(a){b.error("remove_sensor_manifolds() deprecated, use remove_sensor_manifold() instead");
e.se(a,null)};a.se=e.se;a.reset=e.reset;a.tp=e.tp;a.up=function(a,b,h){e.up(a,b,!!h)};a.wp=e.wp;a.vp=e.vp;a.Rl=e.Rl;a.hq=e.hq;a.iq=e.iq;a.kq=e.kq;a.lx=e.Rl;a.jq=e.jq};b4w.module.data=function(a,w){var e=w("__data");w("__print");w("__util");a.load=e.load;a.nm=function(a){e.nm(a|0)};a.mw=e.mw;a.oe=e.oe;a.oL=e.load;a.Y=a.nm};b4w.module.debug=function(a,w){w("__batch");w("__config");var e=w("__controls"),b=w("__debug"),q=w("__physics"),d=w("__print"),h=w("__scenegraph"),p=w("__scenes"),g=w("__shaders"),v=w("__sfx"),m=w("__textures"),t=w("__util"),z=w("vec3");a.ML=function(){q.iB()};a.LL=function(a){d.log("O",q.NB(a));for(var b=q.iC().l.o,e=0;e<b.length;e++){var g=b[e];g.Bb.P==a&&d.log("B",g)}};a.gN=function(){for(var a=p.v(),b=p.zb(a,"MESH",p.O),a=p.ja(a,"MAIN_OPAQUE").o,e=0;e<b.length;e++){var g=b[e],h=g.d;if("DYNAMIC"==
h.type)for(var m=0;m<a.length;m++){var c=a[m];if(c.aa&&c.qb==h){d.log(g.name,g);break}}}};a.DL=function(a){for(var b=p.v(),e=p.zb(b,"MESH",p.O),g=0;g<e.length;g++){var h=e[g];if(h.name==a){d.log("Object",h);for(var m=p.co(b),c=0;c<m.length;c++){for(var q=m[c],t=q.o,v=[],w=0;w<t.length;w++)t[w].qb==h.d&&v.push(t[w]);d.log("Subscene "+q.type,v)}}}};a.EL=function(){var a=p.v();console.log("Armatures: "+p.zb(a,"ARMATURE",p.O).length);console.log("Cameras: "+p.zb(a,"CAMERA",p.O).length);console.log("Curves: "+
p.zb(a,"CURVE",p.O).length);console.log("Empties: "+p.zb(a,"EMPTY",p.O).length);console.log("Lamps: "+p.zb(a,"LAMP",p.O).length);console.log("Meshes: "+p.zb(a,"MESH",p.O).length);console.log("Speakers: "+p.zb(a,"SPEAKER",p.O).length)};a.fp=function(){for(var a=0,b=p.v(),b=[p.ja(b,"MAIN_OPAQUE"),p.ja(b,"MAIN_BLEND")],d=0;d<b.length;d++){var e=b[d];if(e)for(var e=e.o,g=0;g<e.length;g++){var h=e[g].n;h&&(a+=h.fp)}}return a};a.lj=function(){for(var a=0,b=p.v(),b=[p.ja(b,"MAIN_OPAQUE"),p.ja(b,"MAIN_BLEND")],
d=0;d<b.length;d++){var e=b[d];if(e)for(var e=e.o,g=0;g<e.length;g++){var h=e[g].n;h&&(a+=h.lj)}}return a};a.xL=function(){var a=p.v(),a=[p.ja(a,"MAIN_OPAQUE"),p.ja(a,"MAIN_BLEND")];return a[0].o.length+a[1].o.length};a.zL=function(){return t.je(g.sC())};a.VJ=function(){for(var a=p.v(),b=p.co(a),a={},d=0;d<b.length;d++){var e=b[d];if("SINK"!=e.type&&"WIREFRAME"!=e.type)for(var g=e.o,h=0;h<g.length;h++){var c=g[h].n,m=g[h].qb;c&&("COLOR_PICKING"!=e.type&&"GLOW_MASK"!=e.type||m.Dl)&&(a[c.id]=c)}}var g=
e=d=b=0,q;for(q in a)c=a[q],c=c.$a,c.Kk&&(e++,g+=c.Kk/1048576),b++,d+=c.Ms/1048576;return{vbo_number:b,vbo_memory:d,ibo_number:e,ibo_memory:g}};a.AL=function(){for(var a=[],b=0,d=p.v(),d=[p.ja(d,"MAIN_OPAQUE"),p.ja(d,"MAIN_BLEND")],e=0;e<d.length;e++){var g=d[e];if(g)for(var g=g.o,h=0;h<g.length;h++){var c=g[h].n;if(c)for(var c=c.X,m=0;m<c.length;m++){var q=c[m];if("IMAGE"===q.source||"ENVIRONMENT_MAP"===q.source){var t=q.Wa;-1===a.indexOf(t)&&(a.push(t),q=q.width*q.height*4/1048576/q.tn,q*=1.3333,
b+=q)}}}}return{number:a.length,memory:b}};a.yL=function(){for(var a=[],b=0,d=p.v(),d=p.co(d),e=0;e<d.length;e++){var g=d[e];if("SINK"!=g.type){var h=g.j,c=[h.Db,h.Nc];c.push.apply(c,g.Ld);for(g=0;g<c.length;g++){var q=c[g];m.gj(q)&&-1==a.indexOf(q)&&(a.push(q),b+=h.width*h.height*m.PC(q))}}}return{number:a.length,memory:b/1024/1024}};a.CD=function(){var a=p.v();(a=p.ja(a,"MAIN_OPAQUE"))&&p.Yu(a.j,a,[1,1,0])};a.FD=function(){var a=p.v(),b=p.ja(a,"MAIN_OPAQUE"),a=p.MF(a,["SHADOW_CAST"]);if(b)for(var d=
0;d<a.length;d++){var e=a[d],g;switch(d){case 0:g=[1,0,0];break;case 1:g=[0,1,0];break;case 2:g=[0,0,1];break;default:g=[1,0,1]}p.Yu(e.j,b,g)}};a.ZL=function(){for(var a=p.Vk(),b=0;b<a.length;b++)d.log("\n"+h.gB(p.io(a[b])))};a.$L=function(){};a.dJ=e.debug;a.CL=function(a,b){return z.dist(a.d.g,b.d.g)};a.bv=b.bv;a.Rk=b.Rk;a.Iv=b.Iv;a.lp=b.lp;a.GJ=function(a,d){function e(){b.Rk("FBRES",a());setTimeout(e,d)}d||(d=16);e()};a.sI=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),d=new Float32Array([1,
0,0]),e=new Float32Array([0,1,0]),g=new Float32Array([0,0,1]),h=new Float32Array([-1,0,0]),c=new Float32Array([0,-1,0]),m=new Float32Array([0,0,-1]);if(!t.Me(a,t.bz))throw"Wrong VEC3_IDENT";if(!t.Me(b,t.Xy))throw"Wrong QUAT4_IDENT";if(!t.Me(d,t.Ee))throw"Wrong AXIS_X";if(!t.Me(e,t.ta))throw"Wrong AXIS_Y";if(!t.Me(g,t.nd))throw"Wrong AXIS_Z";if(!t.Me(h,t.Am))throw"Wrong AXIS_MX";if(!t.Me(c,t.$b))throw"Wrong AXIS_MY";if(!t.Me(m,t.Bf))throw"Wrong AXIS_MZ";};a.wL=function(){for(var a=v.bl(),b=0;b<a.length;b++){var d=
a[b];"BACKGROUND_MUSIC"==v.no(d)&&v.kj(d,!0)}};a.$r=function(a){b.$r(a)};a.dM=function(a){var b=p.v();if(b=p.ja(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&p.jF(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&p.iF(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.hK=function(){return d.AC()};a.NK=function(){return d.SC()};a.ks=function(){return d.ks()}};b4w.module.main=function(a,w){function e(){}function b(){}function q(){}function d(){window.performance||(c.log("Apply performance workaround"),window.performance={});var a=Date.now();if(window.performance.now)b=a-performance.now();else{c.log("Apply performance.now() workaround");window.performance.now=function(){return Date.now()-a};var b=a}V.zw(0);return b}function h(a,d){a.addEventListener("webglcontextlost",function(a){a.preventDefault();c.error("WebGL context lost");m()},!1);B.Bc(d);var e=B.Qt();
e&&c.log("%cRENDERER INFO:","color: #00a",d.getParameter(e.UNMASKED_VENDOR_WEBGL)+", "+d.getParameter(e.UNMASKED_RENDERER_WEBGL));L.Bc(d);E.Bc(d);P.Bc(d);N.Bc(d);x.Bc(d);I.Bc(d);F.Fw(a.width,a.height,1,p("x"),p("y"));f.Ob();b=J();z()}function p(a){if("x"==a)var b=S.offsetLeft;else if("y"==a)b=S.offsetTop;else return 0;return g(b,S,a)}function g(a,b,c){a=a||0;if(b=b.offsetParent){if("x"==c)var d=b.offsetLeft;else"y"==c&&(d=b.offsetTop);a=g(a+d,b,c)}return a}function v(){e=function(){}}function m(){t()||
(fa=performance.now()/1E3,f.pause(),r.pause(),P.pause(),D.pause())}function t(){return da<fa}function z(){ma(z);var a=performance.now()/1E3;ka||(ka=a);var c=a-ka;if(!(c<1/Q.Ze)){for(var d=V.xh(),e=0;e<ca.length;e++)ca[e](d,c);t()||(da>ka&&(c-=da-Math.max(fa,ka)),d+=c,V.zw(d),x.update(),u.update(),I.update(),C(d,c),b(c));ka=a}}function C(a,b){I.oe()&&(K.reset(),R.update(b),k.update(a,b),f.update(a,b),y.update(b),I.oe()&&(r.update(a,b),I.oe()&&(e(b,a),I.oe()&&(M.update(a,b),I.oe()&&(D.update(),F.update(a,
b),D.rG(),Z&&(Z(S.toDataURL()),Z=null))))))}function J(){var a=60,b=0,c=0,d=Q.QB,e=Q.PB;return function(f){a=ea.Ib(1/f,a,f,d);b=ea.Ib(0,b,f,d);c=(c+1)%e;0==c&&q(Math.round(a),Math.round(b))}}var D=w("__anchors"),y=w("__animation"),n=w("__compat"),l=w("__config"),c=w("__print"),M=w("__controls"),I=w("__data"),x=w("__debug"),B=w("__extensions"),E=w("__geometry"),K=w("__hud"),k=w("__nla"),u=w("__assets"),r=w("__physics"),L=w("__renderer"),F=w("__scenes"),f=w("__sfx"),N=w("__shaders"),P=w("__textures"),
V=w("__time"),R=w("__transform"),ea=w("__util"),U=w("__version"),X=l.context,Q=l.p,S=null,A=null,ka=0,fa=0,da=0,ca=[],Z=null,oa=["webgl","experimental-webgl"],la=null,ma=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/Q.Ze)}}();a.Ob=function(a,b){l.$E();c.hF(Q.console_verbose);var e=U.version()+" "+U.type()+" ("+U.Gn()+")";c.log("%cINIT ENGINE",
"color: #00a",e);if(!window.WebGLRenderingContext)return null;e=d();S=a;n.Fz();var f;f=null;for(var g=0;g<oa.length;g++){var m=oa[g];try{f=a.getContext(m,X)}catch(k){}if(f)break}if(!f)return null;la=f;h(S,f);l.Hz();n.YE(f);c.log("%cSET PRECISION:","color: #00a",Q.precision);b?(K.Ob(b),A=b):(l.p.show_hud_debug_info=!1,l.ld.zl=!1);r.hD(e);D.Ob(a);return f};a.Ep=function(a){x.Ep(a)};a.resize=function(a,b,d){!1!==d&&(S.style.width=a+"px",S.style.height=b+"px",A&&(A.style.width=a+"px",A.style.height=b+
"px"));A&&(A.width=a,A.height=b,K.pi());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))Q.canvas_resolution_factor=1;d=a*Q.canvas_resolution_factor;b*=Q.canvas_resolution_factor;Q.allow_hidpi&&1<window.devicePixelRatio&&(d*=window.devicePixelRatio,b*=window.devicePixelRatio);S.width=d;S.height=b;if(d>la.drawingBufferWidth||b>la.drawingBufferHeight){c.warn("Canvas size exceeds platform limits, downscaling");var e=Math.min(la.drawingBufferWidth/
d,la.drawingBufferHeight/b);d*=e;b*=e;S.width=d;S.height=b}F.Fw(d,b,d/a,p("x"),p("y"));C(V.xh(),0);I.jG(S.width,S.height)};a.VE=function(a){q=a};a.WI=function(){q=function(){}};a.sM=function(a){c.error("set_on_before_render_callback() deprecated, use set_render_callback() instead");e=a};a.aF=function(a){e=a};a.ZI=function(){c.error("clear_on_before_render_callback() deprecated, use clear_render_callback() instead");v()};a.$I=function(){v()};a.UC=function(){return V.xh()};a.OL=function(){c.error("redraw() deprecated");
C(V.xh(),0)};a.pause=m;a.hd=function(){t()&&(da=performance.now()/1E3,f.hd(),r.hd(),P.play(!0),D.hd())};a.pl=t;a.reset=function(){I.nm(0);r.reset();A=S=null;da=fa=ka=0;q=function(){};b=function(){};e=function(){};ca.length=0;la=null;V.reset()};a.GI=function(a){Z=a};a.cK=function(){return S};a.Ps=function(){return n.Ps()};a.rr=function(a){for(var b=0;b<ca.length;b++)if(ca[b]==a)return;ca.push(a)};a.uE=function(a){for(var b=0;b<ca.length;b++)if(ca[b]==a){ca.splice(b,1);break}}};b4w.module.physics=function(a,w){var e=w("__print"),b=w("__physics"),q=w("__util");a.Jx=0;a.IG=1;a.HG=2;a.Eq=3;a.Vs=function(a){b.D(a)?b.Vs(a):e.error("No physics for object "+a.name)};a.Nk=function(a){b.D(a)?b.Nk(a):e.error("No physics for object "+a.name)};a.D=function(a){return b.D(a)};a.xo=function(a){return b.xo(a)};a.ru=function(a){return b.ru(a)};a.sw=function(a,h){b.D(a)?b.sw(a,h):e.error("No physics for object "+a.name)};a.cM=function(a,h,p){b.D(a)?b.r("set_damping",a.l.P,h,p):e.error("No physics for object "+
a.name)};a.TL=function(a){if(b.D(a)){var h=a.game;b.r("set_damping",a.l.P,h.damping,h.rotation_damping)}else e.error("No physics for object "+a.name)};a.Xl=function(a,h,p){b.D(a)?b.Xl.apply(this,arguments):e.error("No physics for object "+a.name)};a.T=function(a){b.D(a)?b.T(a):e.error("No physics for object "+a.name)};a.Ar=function(a){b.D(a)?b.Ar.apply(this,arguments):e.error("No physics for object "+a.name)};a.Br=function(a){b.D(a)?b.Br.apply(this,arguments):e.error("No physics for object "+a.name)};
a.vr=function(a,h,p,g){b.D(a)?b.vr.apply(this,arguments):e.error("No physics for object "+a.name)};a.zr=function(a,h,p,g){b.D(a)?b.zr.apply(this,arguments):e.error("No physics for object "+a.name)};a.ri=function(a,h){b.D(a)?(b.fc(a)||b.gc(a)||e.error("Wrong object"),b.ri(a,q.ra(h,-1,1))):e.error("No physics for object "+a.name)};a.fN=function(a,h,p){if(b.D(a)){b.fc(a)||b.gc(a)||e.error("Wrong object");h=q.ra(h,0,1);var g=a.i.sh;-1==p||1==p?g=Math.max(-1,Math.min(g+p*h,1)):0==p&&0<=g?(g-=h,g=Math.max(0,
g)):0==p&&0>g?(g+=h,g=Math.min(0,g)):e.error("Wrong steering direction");b.ri(a,q.ra(g,-1,1))}else e.error("No physics for object "+a.name)};a.qi=function(a,h){b.D(a)?(b.fc(a)||b.gc(a)||e.error("Wrong object"),b.qi(a,q.ra(h,-1,1))):e.error("No physics for object "+a.name)};a.eN=function(a,h,p){if(b.D(a)){b.fc(a)||b.gc(a)||e.error("Wrong object");h=q.ra(h,0,1);var g=a.i.ei;-1==p||1==p?g=Math.max(-1,Math.min(g+p*h,1)):0==p&&0<=g?(g-=h,g=Math.max(0,g)):0==p&&0>g?(g+=h,g=Math.min(0,g)):e.error("Wrong steering direction");
b.qi(a,q.ra(g,-1,1))}else e.error("No physics for object "+a.name)};a.pq=function(a,h){b.D(a)?(b.fc(a)||b.gc(a)||e.error("Wrong object"),b.pq(a,q.ra(h,0,1))):e.error("No physics for object "+a.name)};a.dN=function(a,h){if(b.D(a)){b.fc(a)||b.gc(a)||e.error("Wrong object");h=q.ra(h,-1,1);var p=a.i.Di;b.pq(a,q.ra(p+p*h,0,1))}else e.error("No physics for object "+a.name)};a.fc=function(a){return b.fc(a)};a.gc=function(a){return b.gc(a)};a.JK=function(a){if(!b.D(a))return e.error("No physics for object "+
a.name),null;if(b.fc(a)||b.gc(a))return a.b4w_vehicle_settings.name;e.error("Wrong object");return null};a.LK=function(a){if(!b.D(a))return e.error("No physics for object "+a.name),null;if(b.fc(a)||b.gc(a))return a.i.sh;e.error("Wrong object")};a.KK=function(a){if(!b.D(a))return e.error("No physics for object "+a.name),null;if(b.fc(a)||b.gc(a))return a.i.ei;e.error("Wrong object")};a.IK=function(a){if(!b.D(a))return e.error("No physics for object "+a.name),null;if(b.fc(a)||b.gc(a))return a.i.Di;e.error("Wrong object")};
a.au=function(a){if(!b.D(a))return e.error("No physics for object "+a.name),null;if(b.fc(a)||b.gc(a))return b.au(a);e.error("Wrong object")};a.bj=function(a){return b.bj(a)};a.Dp=function(a,h,p){b.D(a)?b.Dp(a,h,p):e.error("No physics for object "+a.name)};a.Vl=function(a,h){b.D(a)?b.Vl(a,h):e.error("No physics for object "+a.name)};a.kw=function(a,h){b.D(a)?b.kw(a,h):e.error("No physics for object "+a.name)};a.jw=function(a,h){b.D(a)?b.jw(a,h):e.error("No physics for object "+a.name)};a.gw=function(a,
h){b.D(a)?b.gw(a,h):e.error("No physics for object "+a.name)};a.Yr=function(a){b.D(a)?b.Yr(a):e.error("No physics for object "+a.name)};a.Zr=function(a,h,p){b.D(a)?b.Zr(a,h,p):e.error("No physics for object "+a.name)};a.SE=function(a,h){b.D(a)?b.SE(a,h):e.error("No physics for object "+a.name)};a.Wl=function(a,h,p){b.D(a)?b.Wl(a,h,p):e.error("No physics for object "+a.name)};a.iw=function(a,h){b.D(a)?b.iw(a,h):e.error("No physics for object "+a.name)};a.hw=function(a,h){b.D(a)?b.hw(a,h):e.error("No physics for object "+
a.name)};a.Pm=function(a,h,p,g){b.D(a)?b.Pm(a,h,p,g):e.error("No physics for object "+a.name)};a.xp=function(a,h){b.D(a)?b.xp(a,h):e.error("No physics for object "+a.name)};a.Sm=function(a,h){b.D(a)?b.Sm(a,h):e.error("No physics for object "+a.name)};a.nn=function(a){b.D(a)?b.nn(a):e.error("No physics for object "+a.name)};a.Rm=function(a,h,p,g,q,m){b.D(a)?b.Rm(a,h,p,g,q,m):e.error("No physics for object "+a.name)};a.yp=function(a,h,p,g,q){b.D(a)?b.yp(a,h,p,g,q):e.error("No physics for object "+a.name)};
a.ur=function(a,h,p,g,q,m,t,w,C,J){b.D(h)&&b.D(q)?b.ur(a,h,p,g,q,m,t,w,C,J):e.error("Wrong objects")};a.js=function(a){b.D(a)&&b.bD(a)?b.js(a):e.error("Wrong object")};a.Lv=function(a,h,p,g,q,m){b.D(a)&&b.D(g)?b.Lv(a,h,p,g,q,m):e.error("Wrong objects")}};b4w.module.scenes=function(a,w){var e=w("__batch"),b=w("__camera"),q=w("__graph"),d=w("__objects"),h=w("__print"),p=w("__physics"),g=w("__scenes"),v=w("__util");a.O=g.O;a.Cp=function(a){var b=g.Vk();g.Cp(v.Xb("name",a,b))};a.v=function(){return g.fa()?g.v().name:""};a.CK=function(){for(var a=g.Vk(),b=[],d=0;d<a.length;d++)b.push(a[d].name);return b};a.Uk=function(){if(g.fa())return g.Wk(g.v());h.error("No active scene");return!1};a.rK=function(a,b){var d=g.ag(g.Tg,a,b|0);if(d)return d;h.error("get object "+
a+": not found")};a.pK=function(a,b,d){if(a=g.ag(g.Gq,a,b,d|0))return a;h.error("get object "+b+": not found")};a.qK=function(a,b){var d=g.ag(g.Hq,a,b|0);if(d)return d;h.error("get object "+a+": not found")};a.Mt=function(a){return g.Mt(a)};a.Ll=g.Ll;a.hM=function(a,b){a.d.bg=b};a.nK=function(a){return a.d.bg};a.Um=function(a,b,d,e){a.d&&a.d.Dd&&g.Um(a,b,d,e)};a.oI=function(a){if(a.d&&a.d.Dd){var b=a.d.dl;g.Um(a,b.VC,b.XC,b.YC)}};a.xk=function(a){a.d&&a.d.Dd&&g.xk(a)};a.gM=function(a){var b=g.v();
if(b=g.ja(b,"GLOW"))b.yh.set(a),b.Ja=!0};a.mK=function(a){var b=g.v();if(b=g.ja(b,"GLOW"))return a=a||new Float32Array(3),a.set(b.yh),a};a.DK=function(){if(!g.fa())return h.error("No active scene"),!1;var a=g.v(),b=g.ja(a,"SHADOW_CAST");if(!b)return null;var d=a.d.Gd,e=g.ja(a,"MAIN_OPAQUE"),p=g.ja(a,"DEPTH"),q={};q.csm_resolution=d.csm_resolution;q.self_shadow_polygon_offset=b.self_shadow_polygon_offset;p&&(q.self_shadow_normal_offset=p.self_shadow_normal_offset);q.enable_csm=d.enable_csm;q.csm_num=
d.csm_num;q.csm_first_cascade_border=d.csm_first_cascade_border;q.first_cascade_blur_radius=d.first_cascade_blur_radius;q.csm_last_cascade_border=d.csm_last_cascade_border;q.last_cascade_blur_radius=d.last_cascade_blur_radius;q.fade_last_cascade=d.fade_last_cascade;q.blend_between_cascades=d.blend_between_cascades;d.enable_csm?(q.csm_borders=g.uC(a,e.j),q.blur_radii=new Float32Array(d.csm_num),q.blur_radii.set(e.j.Kl.subarray(0,d.csm_num))):(q.csm_borders=null,q.blur_radii=null);return q};a.BM=function(a){if(!g.fa())return h.error("No active scene"),
!1;var d=g.v();"number"==typeof a.self_shadow_polygon_offset&&q.U(d.d.Ab,function(b,d){"SHADOW_CAST"===d.type&&(d.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var p=g.ja(d,"DEPTH");p&&("number"==typeof a.self_shadow_normal_offset&&(p.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(p.pcf_blur_radius=a.pcf_blur_radius));var v=g.ja(d,"MAIN_BLEND");v&&("number"==typeof a.self_shadow_normal_offset&&(v.self_shadow_normal_offset=a.self_shadow_normal_offset),
"number"==typeof a.pcf_blur_radius&&(v.pcf_blur_radius=a.pcf_blur_radius),v.Ja=!0);v=d.d.Gd;"number"==typeof a.csm_first_cascade_border&&(v.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(v.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(v.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(v.last_cascade_blur_radius=a.last_cascade_blur_radius);if(p){for(var w=
p.o,D=0;D<w.length;D++){var y=w[D];y.qb.Qb&&(y=y.n,e.Vm(y,v),e.Rb(y))}p.Ja=!0}p=d.camera.d.K;for(D=0;D<p.length;D++)b.mq(p[D],v);g.Bp(d)};a.Dt=function(){if(!g.fa())return h.error("No active scene"),!1;var a=g.v();return g.Dt(a)};a.ow=function(a,b,d){if(!g.fa())return h.error("No active scene"),!1;var e=g.v();g.ow(e,parseFloat(a),b,d)};a.It=function(a){if(!g.fa())return h.error("No active scene"),!1;var b=g.v();return g.It(b,a)};a.qw=function(a){if(!g.fa())return h.error("No active scene"),!1;var b=
g.v();g.qw(b,a)};a.Xt=function(){if(!g.fa())return h.error("No active scene"),!1;var a=g.v();return g.Xt(a)};a.xw=function(a){if(!g.fa())return h.error("No active scene"),!1;var b=g.v();g.xw(b,a)};a.dK=function(){if(!g.fa())return h.error("No active scene"),null;var a=g.v(),a=g.ja(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.aM=function(a){if(!g.fa())return h.error("No active scene"),null;var b=
g.v(),b=g.ja(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.Ja=!0};a.Vt=function(){if(!g.fa())return h.error("No active scene"),!1;var a=g.v();return g.Vt(a)};a.vw=function(a){if(!g.fa())return h.error("No active scene"),!1;var b=g.v();g.vw(b,a)};a.At=function(){if(!g.fa())return h.error("No active scene"),
!1;var a=g.v();return g.ja(a,"DOF")?g.At(a):null};a.nw=function(a){if(!g.fa())return h.error("No active scene"),!1;var b=g.v();g.nw(b,a)};a.Jt=function(){if(!g.fa())return h.error("No active scene"),!1;var a=g.v();return g.ja(a,"GOD_RAYS")?g.Jt(a):null};a.rw=function(a){if(!g.fa())return h.error("No active scene"),!1;var b=g.v();g.rw(b,a)};a.xt=function(){if(!g.fa())return h.error("No active scene"),!1;var a=g.v();return g.ja(a,"BLOOM")?g.xt(a):null};a.fw=function(a){if(!g.fa())return h.error("No active scene"),
!1;var b=g.v();g.fw(b,a)};a.gu=function(){return g.gu()};a.Ew=function(a){if(!g.fa())return h.error("No active scene"),!1;var b=g.v();g.Ew(b,a)};a.eu=g.eu;a.Dw=function(a){if(!g.fa())return h.error("No active scene"),!1;var b=g.v();g.Dw(b,a)};a.du=function(a){if(!g.fa())return h.error("No active scene"),!1;var b=g.v();g.du(b,a)};a.cN=function(){if(!g.fa())return h.error("No active scene"),!1;var a=g.v();g.qx(a)};a.aj=function(a){d.Eu(a)?g.aj(a):h.error("show/hide is only supported for dynamic meshes")};
a.Np=function(a){d.Eu(a)?g.Np(a):h.error("show/hide is only supported for dynamic meshes")};a.ql=function(a){return a.d.ql};a.as=function(a){return g.fa()?g.as(a,g.v()):(h.error("No active scene"),!1)};a.XJ=function(a,b){var d=g.v();a||(a="ALL");b||0===b||(b=g.O);return g.zb(d,a,b)};a.uK=function(a){return a?a.name:(h.error("Wrong object name"),"")};a.vK=function(a){return a&&a.type?a.type:(h.error("Wrong object ID"),"UNDEFINED")};a.tK=function(a){return a.ya};a.sK=function(a){return a.Jc.slice(0)};
a.BC=function(){for(var a=g.zb(g.v(),"MESH",g.O),b=0;b<a.length;b++){var d=a[b];if(p.bj(d))return d}return null};a.Tt=function(a,b){b||0===b||(b=1);return g.Tt(a,b)};a.yt=function(){return g.yt()};a.GK=function(a){return"MESH"==a.type?a.d.type:null};a.Yi=function(){if(!g.fa())return h.error("No active scene"),!1;var a=g.v();return g.Yi(a)};a.Ke=function(a){if(!a.d.Do)return h.error('object "'+a.name+'" has been created not by coping.'),!1;var b=a.name;if(g.ag(g.Tg,a.name,0))for(var d=1;;){b=a.name+
(3>String(d).length?"."+("000"+String(d)).slice(-3):"."+String(d));if(!g.ag(g.Tg,b,0)){a.name=b;h.error('object "'+a.name+'" already exists. Name was replaced by "'+b+'".');break}d++}g.Ke(g.v(),a,!0)};a.Vv=function(a){g.Vv(a)||h.error('object "'+a.name+'" was not copied.')}};b4w.module.transform=function(a,w){var e=w("__print"),b=w("__physics"),q=w("__transform"),d=w("__util"),h=w("__objects"),p=new Float32Array(3),g=new Float32Array(4);a.ek=q.ek;a.Gm=q.Gm;a.kd=function(a,d,g,w){h.cd(a)?(p[0]=d,p[1]=g,p[2]=w,q.kd(a,p),q.F(a),b.T(a)):e.error('Wrong object: "'+a.name+'" is not dynamic.')};a.Kp=function(a,d){h.cd(a)?(q.kd(a,d),q.F(a),b.T(a)):e.error('Wrong object: "'+a.name+'" is not dynamic.')};a.EM=function(a,g,t,w,C){h.cd(a)?(p[0]=g,p[1]=t,p[2]=w,d.Nj(p,1,C.d.quat,C.d.g,
p),q.kd(a,p),q.F(a),b.T(a)):e.error('Wrong object: "'+a.name+'" is not dynamic.')};a.zd=function(a,b){b||(b=new Float32Array(3));q.zd(a,b);return b};a.Fd=function(a,d,p,w,C){h.cd(a)?(g[0]=d,g[1]=p,g[2]=w,g[3]=C,q.Fd(a,g),q.F(a),b.T(a)):e.error('Wrong object: "'+a.name+'" is not dynamic.')};a.zM=function(){e.error("set_rotation_quat() deprecated, use set_rotation() instead");return a.Fd};a.bF=function(a,d){h.cd(a)?(q.Fd(a,d),q.F(a),b.T(a)):e.error('Wrong object: "'+a.name+'" is not dynamic.')};a.AM=
function(){e.error("set_rotation_quat_v() deprecated, use set_rotation_v() instead");return a.bF};a.Se=function(a,b){b||(b=new Float32Array(4));q.Se(a,b);return b};a.AK=function(){e.error("get_rotation_quat() deprecated, use get_rotation() instead");return a.Se};a.Jp=function(a,d,g,w){h.cd(a)?(p[0]=d,p[1]=g,p[2]=w,q.Jp(a,p),q.F(a),b.T(a)):e.error('Wrong object: "'+a.name+'" is not dynamic.')};a.yM=function(a,d){h.cd(a)?(q.Jp(a,d),q.F(a),b.T(a)):e.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.gf=function(a,b){h.cd(a)?(q.gf(a,b),q.F(a)):e.error('Wrong object: "'+a.name+'" is not dynamic.')};a.al=function(a){return q.al(a)};a.yJ=function(a){if("EMPTY"!=a.type)return e.error("Wrong object: "+a.name),!1;for(var d=0;d<a.Jc.length;d++)if(!h.cd(a.Jc[d])){e.error('Wrong object: "'+a.Jc[d].name+'" is not dynamic.');return}q.kd(a,[0,0,0]);q.Fd(a,[0,0,0,1]);q.gf(a,1);q.F(a);b.T(a)};a.ko=function(a){return d.ec(a)?q.ko(a):(e.error("Wrong object: "+a.name),0)};a.$k=function(a,b,g){return d.ec(a)?
q.$k(a,b,g):(e.error("Wrong object: "+a.name),null)};a.vc=function(a,d,g,p){h.cd(a)?(q.vc(a,d,g,p),q.F(a),b.T(a)):e.error('Wrong object: "'+a.name+'" is not dynamic.')};a.Lt=function(a){return q.Lt(a)}};b4w.module.util=function(a,w){var e=w("__print"),b=w("__util"),q=w("vec3");w("mat4");a.Ee=new Float32Array([1,0,0]);a.ta=new Float32Array([0,1,0]);a.nd=new Float32Array([0,0,1]);a.Am=new Float32Array([-1,0,0]);a.$b=new Float32Array([0,-1,0]);a.Bf=new Float32Array([0,0,-1]);a.Ou=b.Ou;a.Xb=b.Xb;a.re=function(a){return b.re(a)};a.Qe=function(a,e){e||(e=new Float32Array(4));return b.Qe(a,e)};a.Ov=function(a,e){e||(e=new Float32Array(3));return b.Ov(a,e)};a.sign=b.sign;a.ra=b.ra;a.ka=b.ka;a.OK=function(a,
e){return b.qp(a,b.$b,b.ta,b.Bf,e)};a.hn=function(a,e){return b.hn(a,e)};a.qp=function(a,h,p,g,v){return 0!=q.dot(p,g)?(e.error("Wrong in-plane direction"),null):b.qp(a,h,p,g,v)};a.uu=b.uu;a.Ib=b.Ib;a.Yh=b.Yh;a.jg=b.jg;a.un=b.un;a.Nv=b.Nv;a.Qv=b.Qv;a.Gx=b.Gx;a.Mo=b.Mo;a.ec=b.ec;a.oc=b.oc;a.Ff=b.Ff};b4w.module.camera_anim=function(a,w){function e(a,b,d,e){b=g.oc(a-b);a=g.oc(d-a);if(1E-6>Math.abs(b)||1E-6>2*Math.PI-Math.abs(b))b=0;if(1E-6>Math.abs(a)||1E-6>2*Math.PI-Math.abs(a))a=0;e[0]=b;e[1]=a;return e}var b=w("camera"),q=w("controls"),d=w("print"),h=w("scenes"),p=w("transform"),g=w("util"),v=new Float32Array(2),m=new Float32Array(2),t=new Float32Array(3),z=new Float32Array(3),C=new Float32Array(3),J=new Float32Array(4),D=new Float32Array(2),y=new Float32Array(2),n=w("vec3"),l=w("quat");a.RM=
function(a,e,h,m,w,y,D,k){if(!b.We(a))d.error("track_to_target(): wrong object");else if(a&&e){if(g.jg(e))var u=e;else u=C,p.$k(e,!1,u);e=h||1;h=m||2;var r=w||1;w=y||1;z[0]=0;z[1]=-1;z[2]=0;var L=p.Se(a);y=g.ka(L,z);m=b.bd(a,v);var F=p.zd(a);n.subtract(u,F,t);n.normalize(t,t);var f=l.rotationTo(y,t,l.create());l.multiply(f,L,J);g.un(J,!1);n.subtract(u,F,z);var N=n.length(z)*(1-1/h),u=Math.asin(t[1]);h=Math.acos(-t[2]/Math.abs(Math.cos(u)));0<t[0]&&(h=2*Math.PI-h);var P=h-m[0],V=u-m[1];C[0]=0;C[1]=
0;C[2]=-1;h=p.Se(a);0>g.ka(h,C)[1]?(V=0<y[1]?u-Math.PI+m[1]:u+Math.PI+m[1],P=0<P?-Math.PI+P:Math.PI+P):Math.abs(P)>Math.PI&&(P=0<P?P-2*Math.PI:P+2*Math.PI);var R=0,u=q.kh();y=Math.abs(P/e);e=Math.abs(V/e);var ea=y>e?y:e,U=ea+r,X=U+w,Q=X+r,S=P,A=V,ka=N;q.L(a,"TRACK_TO_TARGET",q.ba,[u],null,function(a,c,d){if(d)if(d=q.Nb(a,c,0),R+=d,R<ea){var e=P/ea*d;d*=V/ea;c=R/ea;c=6*c*(1-c);e*=c;d*=c;S-=e;A-=d;b.Uc(a,e,d)}else R<U?(S&&(b.Uc(a,S,A),S=0,k&&k()),c=(R-ea)/r,d=-N*d/r,ka-=e,p.vc(a,0,6*d*c*(1-c),0)):R<
X?ka&&(p.vc(a,0,ka,0),ka=0):R<Q?(c=(R-X)/r,d=N*d/r,d=6*d*c*(1-c),p.vc(a,0,d,0)):(p.Kp(a,F),q.se(a,c),D&&D())})}};a.Jr=function(a){function l(a,c,d){if(1==d)if(t!=b.vb&&b.dD(a)){d=b.EC(a,y);if(null===w||d[0]!=w[0]||d[1]!=w[1]){w=w||D;w.set(d);z=Math.min(.2,g.oc(w[1]-w[0])/2);d=w;var f=b.bd(p,v)[0];d=e(f,d[0],d[1],m);k=.3*Math.min(1,d[0]/.2,d[1]/.2)}c=q.Nb(a,c,0);d=b.bd(a,v)[0];d=e(d,w[0],w[1],m);d[1]>z&&d[0]>z?k=.3*g.sign(k):d[1]<z?k-=Math.pow(.3,2)/.4*c:d[0]<z&&(k+=Math.pow(.3,2)/.4*c);b.aw(a,c*k)}else w=
null,c=q.Nb(a,c,0),b.aw(a,.3*c)}function n(){q.se(p,"AUTO_ROTATE");q.se(p,"DISABLE_AUTO_ROTATE");a()}a=a||function(){};var p=h.Uk(),t=b.$f(p);if(t==b.Ug)d.error("auto_rotate(): wrong camera type");else{var w=null,z=0,k=0;if(q.gh(p,"AUTO_ROTATE"))n();else{var u=q.mh("X"),r=q.mh("Y"),C=q.Fk(),F=q.Gi(),f=q.Ik(),J=q.kh();q.L(p,"DISABLE_AUTO_ROTATE",q.od,[u,r,C,F,f],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]},n);q.L(p,"AUTO_ROTATE",q.ba,[J],function(a){return a[0]},l)}}};a.kD=function(){var a=
h.Uk();return q.gh(a,"AUTO_ROTATE")}};b4w.module.sfx=function(a,w){var e=w("__scenes"),b=w("__sfx"),q=w("__print");a.play=function(a,e,p){b.play(a,e,p)};a.kp=function(a){b.kp(a)};a.ej=function(a){return b.ej(a)};a.KM=function(a,e,p,g){q.error("speaker_play() deprecated, use play() or play_def() instead");b.Mc(a,e);g&&b.sj(a,g);b.play(a,0,p)};a.MM=function(a){q.error("speaker_stop() deprecated, use stop() instead");b.stop(a)};a.stop=function(a){b.stop(a)};a.pause=function(a){b.vF(a)};a.hd=function(a){b.xF(a)};a.LM=function(a,e){q.error("speaker_playback_rate() deprecated, use playrate() instead");
b.sj(a,e)};a.sj=function(a,e){b.sj(a,e)};a.Nt=function(a){return b.Nt(a)};a.Mc=function(a,e){b.Mc(a,e)};a.Ch=function(a){return b.Ch(a)};a.Wu=function(a,e){b.Wu(a,e)};a.Nw=function(a,e,p){b.Nw(a,e,p)};a.cu=function(a){return a&&"object"===typeof a?b.cu(a):b.IC()};a.Lp=function(a,e){a&&"object"===typeof a?b.Lp(a,e):b.ZE(e)};a.kj=function(a,e){a&&"object"===typeof a?b.kj(a,e):b.QD(e)};a.Fu=function(a){return a&&"object"===typeof a?b.Fu(a):b.sD()};a.bl=function(){return b.bl().slice(0)};a.FK=function(){q.error("get_speakers() deprecated, use get_speaker_objects() instead");
return a.bl()};a.mn=b.mn;a.lw=function(a){b.lw(e.v(),a)};a.zt=function(){return b.zt(e.v())};a.Ss=function(a,e,p){a&&"object"===typeof a?b.Ss(a,e,p):b.uB(e,p)};a.kx=function(a){a&&"object"===typeof a?b.kx(a):b.ZF()};a.wr=b.wr;a.ls=b.ls;a.Ln=b.Ln;a.Mn=b.Mn;a.tw=b.tw;a.Ot=b.Ot;a.pw=b.pw;a.Gt=b.Gt;a.Ft=b.Ft;a.Bt=function(a){if(a&&b.pe(a))return b.Bt(a);q.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.storage=function(a,w){function e(a){d=a;try{h=window.localStorage}catch(b){q.warn("Applying chrome localStorage bug workaround"),h=null}h||(q.warn("localStorage is not available, initializing temporary storage"),h={})}function b(){return h[d]?JSON.parse(h[d]):{}}var q=w("__print"),d="",h=null;a.Ob=e;a.set=function(a,e){var q=b();q[a]=String(e);h[d]=JSON.stringify(q)};a.Y=function(){delete h[d]};a.get=function(a){var d=b();return d[a]?d[a]:""};a.debug=function(){q.log(b())};e("b4w")};"object"==typeof module&&module.Tn&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,w){var e=w("__version");a.version=e.version;a.type=e.type;a.Gn=e.Gn};"object"==typeof module&&module.Tn&&b4w.module.version(exports);b4w.register("embed_main",function(a,w){function e(a,c){Z=document.querySelector("#circle_container");oa=document.querySelector("#preloader_caption");la=document.querySelector("#first_stage");ma=document.querySelector("#second_stage");ha=document.querySelector("#third_stage");pa=document.querySelector("#load_container");H=document.querySelector("#preloader_container");aa=document.querySelector("#opened_button");na=document.querySelector("#logo_container");Fa=document.querySelector("#buttons_container");
W=document.querySelector("#quality_buttons_container");ba=document.querySelector("#help_info_container");ta=document.querySelector("#help_button");if(c){R.pause();var e=document.querySelector("#rel_version");X.version()&&(e.innerHTML=X.version());e=document.querySelector("#fullscreen_on_button");F.mA()||e.parentElement.removeChild(e);e=U.get("quality");e&&"CUSTOM"!=e||(e="HIGH",U.set("quality",e));W.className="control_panel_button";switch(e){case "LOW":W.className="control_panel_button low_mode_button";
break;case "HIGH":W.className="control_panel_button high_mode_button";break;case "ULTRA":W.className="control_panel_button ultra_mode_button"}b();if(e=d())h(e),F.BB(),window.addEventListener("resize",B,!1),B()}else if((e=F.cl(!0))&&e.fallback_image){var f=document.createElement("div");f.className="image_wrapper";document.body.appendChild(f);H.style.display="none";f.style.backgroundImage="url("+e.fallback_image+")"}else if(e&&e.fallback_video){var f=document.createElement("div"),g=document.createElement("video");
f.className="video_wrapper";f.appendChild(g);g.autoplay=!0;for(var k=0;k<e.fallback_video.length;k++){var l=document.createElement("source");l.src=e.fallback_video[k];g.appendChild(l)}document.body.appendChild(f);H.style.display="none"}else L("Browser could not initialize WebGL")}function b(){window.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1};q();for(var a=0;a<Bb.length;a++){var b=Bb[a],c=document.getElementById(b.id);p(c);switch(b.type){case "simple_button":c&&c.addEventListener("mouseup",
b.callback,!1);break;case "menu_button":c&&c.addEventListener("mouseup",function(a){b.callback(a,b)},!1);break;case "trigger_button":(function(a){c&&c.addEventListener("mouseup",function(b){a.callback(b)},!1)})(b)}}}function q(){for(var a=document.querySelectorAll(".control_panel_button a"),b=0;b<a.length;b++){var c=a[b];c.hasAttribute("href")&&(c.href+=document.location.href);p(c.parentNode)}}function d(){var a=N.get("built_in_module_name");if(b4w.module_check(a)){var a=w(a).data.main_file,b=document.getElementById("built_in_scripts");
b.parentElement.removeChild(b);return a}a=F.cl();na.style.display="block";if(a&&a.load)return a=a.load;L("Please specify a scene to load");return null}function h(a){r(na,"opacity",300,1,0,"","",function(){oa.style.display="block";r(oa,"opacity",300,1,0,"","",function(){R.hd();V.load(a,E,K,!1)})})}function p(a){a&&(l()?(a.addEventListener("touchstart",function(){a.className+=" hover";I()},!1),a.addEventListener("touchend",function(){a.className=a.className.replace(" hover","");M()},!1)):(a.addEventListener("mouseenter",
function(){a.className+=" hover"},!1),a.addEventListener("mouseout",function(){a.className=a.className.replace(" hover","")},!1)))}function g(a){if(!c()){var b=a?a.target:document.querySelector("#auto_rotate_on_button");f.Jr(function(){b&&z(b)});b&&z(b);R.pl()&&(m(),C())}}function v(a){c()||(f.Jr(),a&&z(a.target))}function m(a){c()||(R.hd(),a&&z(a.target))}function t(){J("buttons_container")||M();var a=document.querySelector("#fullscreen_on_button")||document.querySelector("#fullscreen_off_button");
a&&z(a)}function z(a){var b=a.id,c;a:{for(c=0;c<Bb.length;c++)if(Bb[c].id==a.id){c=Bb[c];break a}c=null}var d=c.callback;a.id=c.id=c.Ej;c.Ej=b;J(a.id)||(a.className=a.className.replace(" hover",""));c.callback=c.Dj;c.Dj=d}function C(){var a=document.querySelector("#play_button")||document.querySelector("#pause_button");a&&z(a)}function J(a){var b=!1;if(document.querySelectorAll)for(var c=document.querySelectorAll(":hover"),d=0;d<c.length;d++)if(c[d].id==a){b=!0;break}return b}function D(){if(!c()){Fa.removeEventListener("mouseleave",
M);Fa.removeEventListener("mouseenter",I);document.body.removeEventListener("touchmove",M);x();var a=document.querySelector("#help_button"),b=document.querySelector("#tw_button"),d=function(a){fa=!0;r(a,"marginRight",50,-45,0,"","px");r(a,"opacity",50,0,1,"","",function(){a.nextElementSibling&&"opened_button"!=a.nextElementSibling.id?d(a.nextElementSibling):setTimeout(function(){A=fa=!1;n()},100)})},e=function(a){ka=!0;r(a,"marginBottom",50,-45,0,"","px");r(a,"opacity",50,0,1,"","",function(){a.nextElementSibling&&
"opened_button"!=a.nextElementSibling.id?e(a.nextElementSibling):setTimeout(function(){S=ka=!1;n()},100)})};d(a);e(b)}}function y(){I();if(!c())if(aa.removeEventListener("mouseup",y),S||A)D();else{var a=document.querySelector("#fullscreen_on_button")||document.querySelector("#fullscreen_off_button")||document.querySelector("#quality_buttons_container"),b=document.querySelector("#vk_button"),d=function(a){fa=!0;a.style.marginRight="-45px";"help_button"==a.id&&ca?setTimeout(function(){fa=!1;A=!0;n()},
100):(a.style.display="block",r(a,"marginRight",50,0,-45,"","px",function(){a.previousElementSibling?d(a.previousElementSibling):setTimeout(function(){fa=!1;A=!0;n()},100)}),r(a,"opacity",50,1,0,"",""))},e=function(a){ka=!0;a.style.marginBottom="-45px";a.style.display="block";r(a,"marginBottom",50,0,-45,"","px",function(){a.previousElementSibling?e(a.previousElementSibling):setTimeout(function(){ka=!1;S=!0;n()},100)});r(a,"opacity",50,1,0,"","")};d(a);e(b);Fa.addEventListener("mouseleave",M,!1);Fa.addEventListener("mouseenter",
I,!1);document.body.addEventListener("touchmove",M,!1)}}function n(){c()||(aa.addEventListener("mouseup",y,!1),(!J("buttons_container")&&(S||A)||l()&&(S||A))&&M())}function l(){return!!("ontouchstart"in window&&!isFinite(navigator.ID)||navigator.ID)}function c(){return ka||fa}function M(){c()||(I(),Q=setTimeout(D,2E3))}function I(){clearTimeout(Q)}function x(a){if(!c()&&da){da=!1;a?(a.stopPropagation(),a=a.target):a=document.querySelectorAll(".active_elem")[0];W.style.marginRight="0px";for(var b=
0,d=W.children;b<d.length;b++)d[b].style.display="none",d[b].style.opacity=0;W.className="control_panel_button "+a.id}}function B(){R.resize(window.innerWidth,window.innerHeight)}function E(a,b){if(b){F.AB();R.aF(k);B();var c=F.cl();c&&"autorotate"in c&&g();c=P.Yi();c.title&&(document.title=c.title)}else L("Could not load the scene")}function K(a){oa.innerHTML=a+"%";33>a?(Z.style.display="block",la.style.width=4.7*a+"px",Z.style.webkitTransform="rotate("+(3.6*a-503)+"deg)",Z.style.transform="rotate("+
(3.6*a-503)+"deg)"):66>a?(la.style.width="142px",ma.style.backgroundColor="#000",ma.style.marginTop="135px",0<135-4.5*(a-33)&&(ma.style.marginTop=135-3.5*(a-33)+"px"),Z.style.webkitTransform="rotate("+(3.6*a-503)+"deg)",Z.style.transform="rotate("+(3.6*a-503)+"deg)"):100!=a&&(ma.style.marginTop="0px",ha.style.backgroundColor="#000",ha.style.height="0px",75<a&&(ha.style.height=.1*a+"px"),Z.style.webkitTransform="rotate("+(3.6*a-503)+"deg)",Z.style.transform="rotate("+(3.6*a-503)+"deg)");100==a&&(ea.mn()||
(a=document.querySelector("#sound_on_button"),a.parentElement.removeChild(a)),la.parentElement.removeChild(la),ma.parentElement.removeChild(ma),ha.parentElement.removeChild(ha),Z.parentElement.removeChild(Z),pa.style.backgroundColor="#000",r(oa,"opacity",300,0,1,"","",function(){r(pa,"opacity",300,0,1,"","",function(){r(na,"opacity",300,0,1,"","",function(){r(H,"opacity",300,0,1,"","",function(){H.parentElement.removeChild(H);y()})});aa.style.display="block";r(aa,"transform",300,1,0,"scale(",")")})}))}
function k(){}function u(a){if(N.get("quality")!=a){switch(a){case N.Df:var b="LOW";break;case N.Cf:b="HIGH";break;case N.Wg:b="ULTRA"}U.set("quality",b);setTimeout(function(){window.location.reload()},100)}}function r(a,b,c,d,e,f,g,h){a=a||null;b=b||null;c=c||1E3;d=isFinite(d)?d:1;e=isFinite(e)?e:0;f=f||"";g=g||"";h=h||null;if(a&&b){var k=a instanceof Array?a[0]:a;void 0==k.style[b]&&(void 0!=k.style["webkit"+b.charAt(0).toUpperCase()+b.slice(1)]?b="webkit"+b.charAt(0).toUpperCase()+b.slice(1):void 0!=
k.style["ms"+b.charAt(0).toUpperCase()+b.slice(1)]&&(b="ms"+b.charAt(0).toUpperCase()+b.slice(1)));var l=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/60)},m=(new Date).getTime(),n=d-e,p=function(){var k=(new Date).getTime()-m;if(k>=c){if(a instanceof Array)for(k=0;k<a.length;k++)a[k].style[b]=f+d+g;else a.style[b]=f+d+g;h&&h()}else{var q=e+
k/c*n;if(a instanceof Array)for(k=0;k<a.length;k++)a[k].style[b]=f+q+g;else a.style[b]=f+q+g;l(p)}};l(p)}}function L(a){var b=document.querySelector("#error_name"),c=document.querySelector("#error_info"),d=document.querySelector("#error_container");Z.style.display="none";b.innerHTML=a;c.innerHTML="For more info visit <a href=https://www.blend4web.com/troubleshooting>"+"https://www.blend4web.com/troubleshooting".replace("https://www.","")+"</a>";d.style.display="block";na.style.opacity=1;na.style.marginTop=
"-90px"}var F=w("app"),f=w("camera_anim"),N=w("config"),P=w("scenes"),V=w("data"),R=w("main"),ea=w("sfx"),U=w("storage"),X=w("version"),Q=null,S=!1,A=!1,ka=!1,fa=!1,da=!1,ca=!1,Z,oa,la,ma,ha,pa,H,aa,na,Fa,W,ba,ta,Bb=[{type:"simple_button",id:"opened_button",callback:y},{type:"simple_button",id:"help_button",callback:function(){c()||(ba.className=l()?"touch":"",ba.style.display="block",ta.style.display="none",ca=!0)}},{type:"simple_button",id:"close_help",callback:function(){ca&&(ba.style.display=
"none",ta.style.display="block",ca=!1)}},{type:"trigger_button",id:"fullscreen_on_button",callback:function(){c()||F.BE(t,t)},Ej:"fullscreen_off_button",Dj:function(){c()||F.DB()}},{type:"trigger_button",id:"pause_button",callback:function(a){c()||(R.pause(),a&&z(a.target),f.kD()&&(v(),(a=document.querySelector("#auto_rotate_on_button")||document.querySelector("#auto_rotate_off_button"))&&z(a)))},Ej:"play_button",Dj:m},{type:"trigger_button",id:"auto_rotate_on_button",callback:g,Ej:"auto_rotate_off_button",
Dj:v},{type:"trigger_button",id:"sound_on_button",callback:function(a){c()||(ea.kj(null,!0),z(a.target))},Ej:"sound_off_button",Dj:function(a){c()||(ea.kj(null,!1),z(a.target))}},{type:"menu_button",id:"quality_buttons_container",callback:function(a,b){if(!c()){da=!0;W.style.marginRight="-30px";for(var d=b.sA,e=b.rA,f=0;f<d.length;f++){var g=document.getElementById(d[f]);0>W.className.indexOf(d[f])?g.addEventListener("mouseup",e[f],!1):(g.className="active_elem",g.addEventListener("mouseup",x,!1))}W.className=
"quality_buttons_container";f=0;for(d=W.children;f<d.length;f++)d[f].style.display="block",d[f].style.opacity=1}},sA:["low_mode_button","high_mode_button","ultra_mode_button"],rA:[function(){u(N.Df)},function(){u(N.Cf)},function(){u(N.Wg)}]}];a.Ob=function(){N.set("background_color",[.224,.224,.224,1]);var a="DEBUG"==X.type(),b=!1,c=!1,d=!1,f=F.cl();f&&"compressed_textures"in f&&!h&&!a&&(d=c=!0);f&&"show_fps"in f&&(b=!0);f&&f.load?U.Ob("b4w_webplayer:"+f.load):U.Ob("b4w_webplayer:"+window.location.href);
f=U.get("quality");f&&"CUSTOM"!=f||(f="HIGH",U.set("quality",f));switch(f){case "LOW":var g=N.Df;break;case "HIGH":g=N.Cf;break;case "ULTRA":g=N.Wg}N.set("quality",g);var h=b4w.module_check(N.get("built_in_module_name"));F.Ob({canvas_container_id:"main_canvas_container",callback:e,gl_debug:a,physics_enabled:!h,show_fps:b,report_init_failure:!1,console_verbose:a,error_purge_elements:["control_panel"],alpha:!1,key_pause_enabled:!1,fps_elem_id:"fps_container",fps_wrapper_id:"fps_wrapper",assets_dds_available:c,
assets_min50_available:d})}});window.addEventListener("load",function(){b4w.require("embed_main").Ob()},!1);var vd=["b4w","$","jQuery"],wd=[],Dd;for(Dd in window)-1!=vd.indexOf(Dd)||Dd in qd||wd.push(Dd);wd.length&&console.error("globals detected:",wd);
