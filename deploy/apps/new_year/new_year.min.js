b4w.register("new_year_language",function(t,e){var u="en",B={default_text:{ru:"\u0423\u0432\u0430\u0436\u0430\u0435\u043c\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438!\n\u041d\u0430 \u044d\u0442\u043e\u0442 \u041d\u043e\u0432\u044b\u0439 \u0433\u043e\u0434 \u043c\u044b \u043f\u0440\u0438\u0433\u043e\u0442\u043e\u0432\u0438\u043b\u0438 \u0434\u043b\u044f \u0432\u0430\u0441 \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u044b\u0439 \u043f\u043e\u0434\u0430\u0440\u043e\u043a.\n\u042d\u0442\u043e\u0439 \u0442\u0440\u0451\u0445\u043c\u0435\u0440\u043d\u043e\u0439 \u043e\u0442\u043a\u0440\u044b\u0442\u043a\u043e\u0439 \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u043e\u0437\u0434\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u0432\u043e\u0438\u0445 \u0431\u043b\u0438\u0437\u043a\u0438\u0445, \u0437\u043d\u0430\u043a\u043e\u043c\u044b\u0445 \u0438 \u043f\u0440\u043e\u0441\u0442\u043e \u0432\u0441\u0435\u0445 \u0442\u0435\u0445, \u043a\u0442\u043e \u043f\u043e\u0441\u0435\u0442\u0438\u0442 \u0432\u0430\u0448\u0443 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0432 \u0441\u043e\u0446\u0441\u0435\u0442\u0438 \u0438\u043b\u0438 \u0432 \u0431\u043b\u043e\u0433\u0435.\n\u0416\u0435\u043b\u0430\u0435\u043c \u0412\u0430\u043c \u043f\u0440\u043e\u0446\u0432\u0435\u0442\u0430\u043d\u0438\u044f \u0438 \u0431\u043b\u0430\u0433\u043e\u043f\u043e\u043b\u0443\u0447\u0438\u044f \u0432 2015 \u0433\u043e\u0434\u0443!",
en:"Dear users!\nFor this New Year's we have prepared a special gift for you.\nWith this 3D greeting card you can congratulate your family, friends and the visitors of your blog or social account.\nWe wish you happiness and prosperity in the coming 2015!"},title:{ru:"\u0421 \u041d\u043e\u0432\u044b\u043c \u0413\u043e\u0434\u043e\u043c! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043f\u043e\u0434\u0430\u0440\u043a\u0438, \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0442\u0435\u043b\u0435\u0432\u0438\u0437\u043e\u0440, \u043e\u0442\u043f\u0440\u0430\u0432\u044c\u0442\u0435 \u0434\u0440\u0443\u0437\u044c\u044f\u043c \u0441\u0432\u043e\u0435 \u043f\u043e\u0437\u0434\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435!",
en:"Happy New Year! Try opening the presents, turn on the TV and even send a personal greeting!"}};t.set_language=function(e){u=e};t.get_language=function(){return u};t.get_translation=function(e){var r=B[e];return r?(r=r[u])?r:"[TRANSLATION FOR "+e+": NO SUCH LANGUAGE]":"[TRANSLATION FOR "+e+": NO SUCH KEY]"}});b4w.register("new_year_main",function(t,e){function u(a,d){d?(q.enable_controls(a),L.create_simple_preloader({bg_color:"#00000000",bar_color:"#FFF",background_container_id:"background_image_container",canvas_container_id:"canvas3d",preloader_fadeout:!0}),x.detect_mobile()||a.addEventListener("mousedown",M),a.addEventListener("touchstart",M),window.onresize=N,N(),O=y?"../../deploy/assets/new_year/":"../../assets/new_year/",$.load(O+"christmas_tree.json",B,aa,!0)):console.log("b4w init failure")}function B(a){window.Ya?
new Ya.share({element:"yandex_icons",elementStyle:{type:"none",quickServices:"facebook twitter vkontakte odnoklassniki gplus moimir".split(" ")},onready:function(a){r();document.getElementById("send_button").onclick=function(){P();a.updateShareLink(window.location.href+" via Blend4Web",l.get_translation("title"))};a.updateShareLink(window.location.href+" via Blend4Web",l.get_translation("title"))}}):document.getElementById("send_button").onclick=function(){P()};document.getElementById("mail_to").onclick=
function(){this.href=onclick="mailto:yourfriends?subject="+l.get_translation("title")+"&body="+window.location.href.replace("&","%26")};q.enable_camera_controls();Z();ba();v.enable_mouse_hover_glow()}function Z(){var a=c.get_active_camera();C=m.get_eye(a);Q=m.get_pivot(a);var d=new Float32Array(3);m.get_pivot(a,d);R=S.dist(d,C);D=m.get_angles(a);var a=c.get_object_by_name("letter"),d=c.get_object_by_dupli_name("letter","armature_letter"),p=c.get_object_by_dupli_name("gift","Armature.001");b.apply(a,
"letter_fly_group");b.apply(p,"cap_fly");b.apply(d,"letter_fly_fin");b.set_behavior(a,b.AB_FINISH_STOP);b.set_behavior(d,b.AB_FINISH_STOP);b.set_behavior(p,b.AB_FINISH_STOP);a=c.get_object_by_dupli_name("gift_monkey","Armature_gift_monkey");d=c.get_object_by_dupli_name("gift_monkey.001","Armature");b.apply(a,"cap_fly");b.set_behavior(a,b.AB_FINISH_STOP);b.set_frame(d,0);b.apply(d,"jump_B4W_BAKED");b.set_behavior(d,b.AB_FINISH_STOP);g.push(c.get_object_by_dupli_name("confetti","Cylinder"));g.push(c.get_object_by_dupli_name("confetti",
"Cylinder.001"));g.push(c.get_object_by_dupli_name("confetti","Cylinder.002"));g.push(c.get_object_by_dupli_name("confetti","Cylinder.003"));g.push(c.get_object_by_dupli_name("confetti","Cylinder.004"));g.push(c.get_object_by_dupli_name("confetti","Cylinder.005"));a=c.get_object_by_dupli_name("gift_5","Armature_gift_5");b.apply(a,"cap_fly");b.set_behavior(a,b.AB_FINISH_STOP);for(a=0;a<g.length;a++)b.apply(g[a],"ParticleSystem 3"),b.set_behavior(g[a],b.AB_FINISH_STOP);a=c.get_object_by_dupli_name("confetti_ribbons",
"ribbons_flom_above");d=c.get_object_by_dupli_name("confetti","ribbons_from_below");b.apply(a,"Shader NodetreeAction.004");b.set_behavior(a,b.AB_FINISH_STOP);b.apply(d,"Shader NodetreeAction");b.set_behavior(d,b.AB_FINISH_STOP);a=c.get_object_by_dupli_name("bear","bear");b.apply(a,"bear_wiggle");b.set_behavior(a,b.AB_FINISH_STOP);b.set_frame(a,0);E(!0);F(!0);z(!0);(a=q.get_url_params())&&a.lang&&"ru"==a.lang?(l.set_language(a.lang),document.body.className="lang_ru"):document.body.className="lang_en";
a=a&&a.text?a.text:null;T();ca(a)}function r(){var a=q.get_url_params();a&&a.lang&&"ru"==a.lang&&l.set_language(a.lang)}function T(){var a=n.get_canvas_texture_context("my_letter");a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.globalAlpha=.95,a.globalAlpha=1,a.font="44px congratulatory_font, 'URW Chancery L', cursive",a.fillStyle="#ffffff",n.update_canvas_texture_context("my_letter"))}function E(a){var d=c.get_object_by_dupli_name("letter","letter"),b=c.get_object_by_dupli_name("letter","wax_seal_rope");
a?(c.hide_object(d),c.hide_object(b)):(c.show_object(d),c.show_object(b))}function F(a){var d=c.get_object_by_dupli_name("gift_monkey.001","monkey"),b=c.get_object_by_dupli_name("gift_monkey.001","monkey.001");a?(c.hide_object(d),c.hide_object(b)):(c.show_object(d),c.show_object(b))}function z(a){var d=c.get_object_by_dupli_name("confetti_ribbons","ribbons_flom_above"),b=c.get_object_by_dupli_name("confetti","ribbons_from_below");if(a)for(c.hide_object(d),c.hide_object(b),a=0;a<g.length;a++)c.hide_object(g[a]);
else for(c.show_object(d),c.show_object(b),a=0;a<g.length;a++)c.show_object(g[a])}function ca(a){var d=document.getElementById("text_element");d.oninput=function(){300<d.value.length&&(d.value=d.value.substr(0,300))};var b=n.get_canvas_texture_context("my_letter");d.value=a?da(a):l.get_translation("default_text");a=U(d.value,b);V(a)}function ea(){var a=document.getElementById("container"),d=document.getElementById("open_button"),p=document.getElementById("close_button"),f=document.getElementById("text_container"),
k=document.getElementById("icons");k.style.visibility="visible";d.addEventListener("click",function(){f.style.visibility="visible";p.style.visibility="hidden";d.style.visibility="hidden";T();var a=document.getElementById("open_button"),b=document.getElementById("text_element"),c=document.getElementById("text_container");b.disabled=!1;a.style.visibility="hidden";c.style.visibility="visible"},!1);p.addEventListener("click",function(){G=!1;v.enable_mouse_hover_glow();a.style.visibility="hidden";f.style.visibility=
"hidden";k.style.visibility="hidden";var d=c.get_object_by_name("letter"),p=c.get_object_by_dupli_name("letter","armature_letter"),e=c.get_object_by_dupli_name("gift","Armature.001");b.set_speed(d,-2);b.set_speed(e,-2);b.set_speed(p,-2);b.play(d);b.play(e,E);b.play(p);q.enable_camera_controls()},!1);a.style.visibility="visible"}function P(){var a=document.getElementById("text_element"),d=document.getElementById("text_container"),b=document.getElementById("open_button"),c=document.getElementById("close_button"),
a=a.value,k=n.get_canvas_texture_context("my_letter"),k=U(a,k);V(k);d.style.visibility="hidden";b.style.visibility="inherit";c.style.visibility="inherit";for(var c="",k=300<a.length?300:a.length,e=0;e<k;e++){for(var d=a[e].charCodeAt(0).toString(16),b=4-d.length,g=0;g<b;g++)d="0"+d;c+=d}a=c;window.history.pushState("","","?lang="+l.get_language()+"&text="+a)}function N(){var a=window.innerWidth,d=window.innerHeight;x.resize(a,d);document.getElementById("text_element").style.fontSize=(.025*d).toString()+
"px";var b=document.getElementsByTagName("html")[0];b.style.height=d.toString()+"px";b.style.width=a.toString()+"px";if(b=document.getElementById("background_image_container"))b.style.height=d.toString()+"px",b.style.width=a.toString()+"px";if(b=document.getElementById("simple_preloader_container"))b.style.height=d.toString()+"px",b.style.width=a.toString()+"px";a=document.getElementById("container");a.style.width=(.5*d).toString()+"px";a.style.height=(.6*d).toString()+"px";a.style.top=(.03*d).toString()+
"px"}function U(a,b){for(var c=a.split(""),f="",e="",g=[],h=0;h<c.length;h++){if(300<=h){e+="...";break}"\n"==c[h]?(f+=e,g.push(f),e=f=""):-1<" ,.-+!?".indexOf(c[h])?(515<b.measureText(f+e).width&&(g.push(f),f=""),f+=e,e="",f+=c[h]):(e+=c[h],515<b.measureText(e).width&&(f+=e,g.push(f),f=e=""))}g.push(f+e);12<g.length&&(g.length=12,g.push("..."));return g}function V(a){if(a){for(var b=n.get_canvas_texture_context("my_letter"),c=b.font.split("px"),c=parseInt(c[0]),f=0;f<a.length;f++)b.fillText(a[f],
235,Math.round(1.25*c*f+185));n.update_canvas_texture_context("my_letter")}}function da(a){for(var b="",c="",f=0;f<a.length;f+=4)b+=a[f]+a[f+1]+a[f+2]+a[f+3],c+=String.fromCharCode(parseInt(b,16)),b="";return c}function M(a){if(!G){a.preventDefault&&a.preventDefault();var d=v.get_coords_x(a);a=v.get_coords_y(a);if(d=c.pick_object(d,a))switch(c.get_object_name(d)){case "gift*box":d=c.get_object_by_name("letter");a=c.get_object_by_dupli_name("letter","armature_letter");var e=c.get_object_by_dupli_name("gift",
"Armature.001"),f=c.get_object_by_dupli_name("gift","letter");E();h.speaker_stop(f);h.speaker_play(f);G=!0;v.disable_mouse_hover_glow();W=x.global_timeline();var f=c.get_active_camera(),k=m.get_pivot(f,fa),l=m.get_eye(f,ga);X=S.dist(k,l);m.get_angles(f,s);s[0]>Math.PI&&(s[0]-=2*Math.PI);q.disable_camera_controls();b.set_speed(d,1);b.set_speed(e,1);b.set_speed(a,1);b.play(d,ea);b.play(e);b.play(a);break;case "gift_5*box_5":e=c.get_object_by_dupli_name("gift_5","Armature_gift_5");d=c.get_object_by_dupli_name("confetti",
"ribbons_from_below");a=c.get_object_by_dupli_name("confetti_ribbons","ribbons_flom_above");f=c.get_object_by_dupli_name("gift_5","fireworks");h.speaker_stop(f);if(H){b.set_speed(e,-2);b.play(e);for(e=0;e<g.length;e++)b.stop(g[e]),b.set_frame(g[e],0);b.stop(d);b.set_frame(d,0);b.stop(a);b.set_frame(a,0);z(!0)}else for(z(),b.set_speed(e,1),b.play(e),b.play(d,ha),h.speaker_play(f),e=0;e<g.length;e++)b.play(g[e]);H=!H;break;case "gift_monkey*box_6":d=c.get_object_by_dupli_name("gift_monkey","Armature_gift_monkey");
a=c.get_object_by_dupli_name("gift_monkey.001","Armature");e=c.get_object_by_dupli_name("gift_monkey","monkey");h.speaker_stop(e);h.speaker_play(e);I?(b.set_speed(d,-1.7),b.play(d,F),b.set_speed(a,-3)):(F(),b.set_speed(d,1),b.play(d),b.set_speed(a,1));b.play(a);I=!I;break;case "TV*tv":c.get_object_by_name("lamp");d=c.get_object_by_dupli_name("TV","speaker");J?(n.pause_video("Texture"),n.reset_video("Texture"),h.speaker_stop(d)):(n.play_video("Texture"),h.speaker_play(d));J=!J;break;case "bear*bear":d=
c.get_object_by_dupli_name("bear","bear"),a=c.get_object_by_dupli_name("bear","spk_bear"),h.speaker_stop(a),h.speaker_play(a),K?b.set_speed(d,-1):b.set_speed(d,1),b.play(d),K=!K}}}function ha(){var a=c.get_object_by_dupli_name("confetti_ribbons","ribbons_flom_above");b.play(a,z)}function ba(){var a=c.get_active_camera(),b=w.create_timeline_sensor(),e=w.create_elapsed_sensor();w.create_sensor_manifold(a,"CAMERA_MOVE",w.CT_CONTINUOUS,[b,e],function(a){return a[0]-W<A},function(a,b,c){if(0<c){b=w.get_sensor_value(a,
b,1);c=b/A*(D[0]-s[0]);var d=b/A*(D[1]-s[1]);ia.move_local(a,0,b/A*(R-X),0);m.rotate_pivot(a,c,d)}else m.set_look_at(a,C,Q,ja.AXIS_Y)})}function aa(a){L.update_preloader(a)}var n=e("textures"),$=e("data"),q=e("app"),x=e("main"),ka=e("version"),c=e("scenes"),b=e("animation"),m=e("camera"),S=e("vec3"),w=e("controls"),ia=e("transform"),ja=e("util"),h=e("sfx"),v=e("mouse");e("lights");var L=e("preloader"),l=e("new_year_language"),Y=e("config"),O,y="DEBUG"===ka.type(),C,X,Q,R,D,fa,ga=new Float32Array(3),
s=new Float32Array(2),W=0,A=25/24,g=[],H=!1,I=!1,K=!1,J=!1,G=!1;t.init=function(){x.detect_mobile()&&Y.set("quality",Y.P_LOW);q.init({canvas_container_id:"canvas3d",callback:u,pause_invisible:!1,physics_enabled:!1,key_pause_enabled:!1,assets_dds_available:!y,assets_min50_available:!y,console_verbose:y})}});b4w.require("new_year_main").init();
