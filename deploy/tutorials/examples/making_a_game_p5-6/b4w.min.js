var b4w=function(a){var p={};a.module=p;var c={};a.register=function(a,c){if(p[a])throw Error('Module "'+a+'" already registered');p[a]=c};a.require=function(a,h){if(!p[a])throw Error('Module "'+a+'" not found');h=h||"__B4W_DEF_NS";c[h]||(c[h]=function(a){return function(b){var k=p[b];if(!k)throw Error('Module "'+b+'" not found');k.xh||(k.xh={});k.xh[a]||(k.xh[a]={},k(k.xh[a],c[a]));return k.xh[a]}}(h));return c[h](a)};a.module_check=function(a){return p[a]?!0:!1};return a}({});"object"==typeof module&&module.sl&&(GLOBAL.b4w={module:{}});b4w.module.__version=function(a){function p(){return"26.03.2015 05:27:56"}a.version=function(){return"15.03"};a.type=function(){return"RELEASE"};a.date=p;a.timestamp=function(){var a=p(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.sl&&b4w.module.__version(exports);b4w.module.__config=function(a,p){function c(){return b4w.module_check(a.Hb.Xi)}function b(){for(var b=a.Hb,c=null,d=document.getElementsByTagName("script"),m=0;m<d.length;m++){for(var l=d[m].src,r=0;r<b.dq.length;r++)if(0<=l.indexOf(b.dq[r])){c=l;break}if(null!==c)break}c||(h.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),c=document.location.href);b=c.indexOf("?");0<=b&&(c=c.substring(0,b));return c.substring(0,c.lastIndexOf("/")+1)}var h=p("__print"),
d=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.Qu=d.sa(a.context);a.q={alpha_sort:!0,alpha_sort_threshold:.1,lm:"5.02",se:1E4,console_verbose:!1,do_not_load_resources:!1,qk:!1,dw:1.5,cw:10,background_color:[0,0,0,0],force_selectable:!1,all_objs_selectable:!1,Af:.01,resolution_factor:1,canvas_resolution_factor:1,jk:3,allow_cors:!1,xl:!1,Oi:!0,show_hud_debug_info:!1,GB:!0,Ae:"DEPTH",anaglyph_use:!1,ak:!0,ki:.5,Ic:!0,glow:!0,Ge:!0,
sg:!0,Cg:!0,kg:!0,Lg:!0,pg:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,ms:!1,vg:!0,ci:!0,Sa:!0,Yj:!0,water_dynamic:!0,shore_smoothing:!0,Wg:!0,Yc:1024,im:512,Gc:53,as:!0,precision:"highp",quality:a.P_HIGH,Bk:!0,Sx:!1,rr:!1,Qo:!1,fs:!1,sf:!1,Tp:!1,Vk:!1,cp:!1,fD:!1,Kc:!1,allow_hidpi:!1,yj:!1,dp:!1};a.Dv=d.sa(a.q);a.xd={Ea:-1,hp:!1,kf:1};a.controls={Qx:1/120};a.yd={dir:"ASSETS=../../assets/",Lx:15,Uq:!0,km:!1,il:!1};a.eu=d.sa(a.yd);a.Hb={shaders_dir:"",gz:"include/",Xi:"built_in_data",dq:["b4w.min.js",
"b4w.full.min.js","src/b4w.js","USER_DEFINED_MODULE"],er:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.pb={enabled:!0,se:60,yi:""};a.by=d.sa(a.pb);a.pi={uj:1024,ij:384};a.Iy=d.sa(a.pi);a.Lc={pn:!0,Nj:!1,Vn:!1,ro:!1,Ro:!1};a.fz=d.sa(a.Lc);a.jl={enabled:!1,Jz:"MAIN_OPAQUE",Iz:0,jz:"COLOR"};a.zv=d.sa(a.jl);a.bu=function(){var b=a.q,c=a.pb,d=a.pi;switch(b.quality){case a.P_ULTRA:b.Ae="DEPTH";b.shore_smoothing=!0;b.glow=!0;b.Ge=!0;b.sg=!0;b.Cg=!0;b.kg=!0;b.ak=!0;b.ki=1;b.Ic=!0;b.vg=!0;
b.ci=!0;b.Sa=!0;b.Yj=!0;b.resolution_factor=1.75;d.uj=2048;b.jk=3;b.Oi=!0;b.qk=!1;b.Gc=53;b.precision="highp";b.water_dynamic=!0;b.Wg=!0;b.antialiasing=!0;b.smaa=!0;b.pg=!0;b.Lg=!0;b.allow_hidpi=!0;c.se=120;break;case a.P_HIGH:b.Ae="DEPTH";b.shore_smoothing=!0;b.glow=!0;b.Ge=!0;b.sg=!0;b.Cg=!0;b.kg=!0;b.ak=!0;b.ki=.5;b.Ic=!0;b.vg=!0;b.ci=!0;b.Sa=!0;b.Yj=!0;b.resolution_factor=1;d.uj=1024;b.jk=3;b.Oi=!0;b.qk=!1;b.Gc=53;b.precision="highp";b.water_dynamic=!0;b.Wg=!0;b.antialiasing=!0;b.smaa=!1;b.pg=
!0;b.Lg=!0;b.allow_hidpi=!1;c.se=60;break;case a.P_LOW:b.Ae="NONE",b.shore_smoothing=!1,b.glow=!1,b.Ge=!1,b.sg=!1,b.Cg=!1,b.kg=!1,b.ak=!1,b.ki=.5,b.Ic=!1,b.vg=!1,b.ci=!1,b.Sa=!1,b.Yj=!1,b.resolution_factor=1,d.uj=512,b.jk=2,b.Oi=!1,b.qk=!0,b.Gc=53,b.precision="mediump",b.water_dynamic=!1,b.Wg=!1,b.antialiasing=!1,b.smaa=!1,b.pg=!1,b.Lg=!1,b.allow_hidpi=!1,c.se=60}};a.set=function(b,c){switch(b){case "all_objs_selectable":a.q.all_objs_selectable=c;break;case "allow_cors":a.q.allow_cors=c;break;case "allow_hidpi":a.q.allow_hidpi=
c;break;case "alpha":a.context.alpha=c;break;case "alpha_sort":a.q.alpha_sort=c;break;case "alpha_sort_threshold":a.q.alpha_sort_threshold=c;break;case "anaglyph_use":a.q.anaglyph_use=c;break;case "animation_framerate":a.xd.Ea=c;break;case "antialiasing":a.q.antialiasing=c;break;case "assets_dds_available":a.yd.il=c;break;case "assets_min50_available":a.yd.km=c;break;case "audio":a.Lc.pn=c;break;case "background_color":a.q.background_color=c;break;case "built_in_module_name":a.Hb.Xi=c;break;case "canvas_resolution_factor":a.q.canvas_resolution_factor=
c;break;case "console_verbose":a.q.console_verbose=c;break;case "context_antialias":a.context.antialias=c;break;case "do_not_load_resources":a.q.do_not_load_resources=c;break;case "force_selectable":a.q.force_selectable=c;break;case "gyro_use":a.q.yj=c;break;case "glow":a.q.glow=c;break;case "physics_enabled":a.pb.enabled=c;break;case "physics_uranium_path":a.pb.yi=c;break;case "precision":a.q.precision=c;break;case "quality":a.q.quality=c;break;case "resolution_factor":a.q.resolution_factor=c;break;
case "sfx_mix_mode":a.Lc.Nj=c;break;case "shaders_dir":a.Hb.shaders_dir=c;break;case "show_hud_debug_info":a.q.show_hud_debug_info=c;break;case "smaa":a.q.smaa=c;break;case "smaa_search_texture_path":a.Hb.smaa_search_texture_path=c;break;case "smaa_area_texture_path":a.Hb.smaa_area_texture_path=c;break;case "wireframe_debug":a.q.wireframe_debug=c;break;default:h.error("Unknown config property: "+b)}};a.get=function(b){switch(b){case "all_objs_selectable":return a.q.all_objs_selectable;case "allow_cors":return a.q.allow_cors;
case "allow_hidpi":return a.q.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.q.alpha_sort;case "alpha_sort_threshold":return a.q.alpha_sort_threshold;case "anaglyph_use":return a.q.anaglyph_use;case "animation_framerate":return a.xd.Ea;case "antialiasing":return a.q.antialiasing;case "assets_dds_available":return a.yd.il;case "assets_min50_available":return a.yd.km;case "audio":return a.Lc.pn;case "background_color":return a.q.background_color;case "built_in_module_name":return a.Hb.Xi;
case "canvas_resolution_factor":return a.q.canvas_resolution_factor;case "console_verbose":return a.q.console_verbose;case "context_antialias":return a.context.antialias;case "do_not_load_resources":return a.q.do_not_load_resources;case "force_selectable":return a.q.force_selectable;case "gyro_use":return a.q.yj;case "glow":return a.q.glow;case "physics_enabled":return a.pb.enabled;case "physics_uranium_path":return a.pb.yi;case "precision":return a.q.precision;case "quality":return a.q.quality;case "resolution_factor":return a.q.resolution_factor;
case "sfx_mix_mode":return a.Lc.Nj;case "shaders_dir":return a.Hb.shaders_dir;case "show_hud_debug_info":return a.q.show_hud_debug_info;case "smaa":return a.q.smaa;case "smaa_search_texture_path":return a.Hb.smaa_search_texture_path;case "smaa_area_texture_path":return a.Hb.smaa_area_texture_path;case "wireframe_debug":return a.q.wireframe_debug;default:h.error("Unknown config property: "+b)}};a.reset=function(){a.context=d.sa(a.Qu);a.q=d.sa(a.Dv);a.yd=d.sa(a.eu);a.pb=d.sa(a.by);a.pi=d.sa(a.Iy);a.Lc=
d.sa(a.fz);a.jl=d.sa(a.zv)};a.Xp=c;a.Yy=function(){var d=a.Hb,k=a.pb;c()||""!=d.shaders_dir||(d.shaders_dir=b()+"../shaders/");if(c())d.smaa_search_texture_path="smaa_search_texture.png",d.smaa_area_texture_path="smaa_area_texture.png";else if(""==d.smaa_search_texture_path||""==d.smaa_area_texture_path){var g=b()+d.er;d.smaa_search_texture_path=d.smaa_search_texture_path||g+"smaa_search_texture.png";d.smaa_area_texture_path=d.smaa_area_texture_path||g+"smaa_area_texture.png"}k.enabled&&""==k.yi&&
(g=b()+d.er,k.yi=g+"uranium.js")};a.get_std_assets_path=function(){return a.yd.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,p){function c(a){var c=document.createElement("div"),e=c.style;e.position="absolute";e.backgroundColor="black";e.borderRadius="20px 20px 20px 0px";e.boxShadow="0px 0px 10px rgb(180, 180, 200)";e.opacity=1;e.padding="8px 12px";e.lineHeight="15px";e.visibility="hidden";var n=E.parentElement;n.appendChild(c);var x=m.get_meta_tags(a),C=document.createElement("span"),I=C.style;C.innerHTML=x.title||a.name;I.fontWeight="bold";I.fontSize="12px";I.lineHeight="15px";I.color=
"#fff";I.fontFamily="Arial";d(C);c.appendChild(C);var J=x.description;if(J){a=document.createElement("div");var g=a.style;g.position="absolute";g.bottom="0px";g.left="0px";g.backgroundColor="#000";g.borderRadius="20px 20px 20px 0px";g.boxShadow="0px 0px 10px rgb(180, 180, 200)";g.visibility="hidden";g.padding="8px 12px";g.overflow="hidden";g.lineHeight="15px";g.fontSize="12px";g.zIndex="2";c.appendChild(a);var x=document.createElement("span"),l=x.style;x.innerHTML=J;l.fontSize="12px";l.fontFamily=
"Arial";l.fontWeight="bold";l.lineHeight="15px";l.color="#fff";l.visibility="hidden";a.appendChild(x);var u=!1,f=!1;n.addEventListener("click",function(a){if(!(u||f||B))if(a.target!=C&&a.target!=c||"hidden"!=g.visibility||1!=e.opacity)"visible"==g.visibility&&(e.visibility="visible",I.visibility="visible",g.visibility="hidden",l.visibility="hidden");else{e.visibility="hidden";I.visibility="hidden";g.visibility="visible";u=f=!0;a=c.offsetWidth;var d=c.offsetHeight,n=Math.min(250,b(J)),x=h(J,n);n>a?
w.Ln(a,n,function(a){a==n&&("visible"==g.visibility&&(l.visibility="visible"),u=!1);g.width=a+"px"}):u=!1;x>d?w.Ln(d,x,function(a){a==x&&("visible"==g.visibility&&(l.visibility="visible"),f=!1);g.height=a+"px"}):f=!1}},!1)}return c}function b(a){var b=document.createElement("div"),c=document.createElement("span"),d=b.style;c.innerHTML=a;c.style.fontSize="12px";c.style.fontFamily="Arial";c.style.fontWeight="bold";c.style.color="#fff";c.style.visibility="hidden";d.lineHeight="15px";b.appendChild(c);
d.position="absolute";d.visibility="hidden";d.fontSize="12px";d.display="inline-block";d.lineHeight="15px";document.body.appendChild(b);a=b.offsetWidth+1;document.body.removeChild(b);return a}function h(a,b){var c=document.createElement("div"),d=document.createElement("span"),e=c.style;d.innerHTML=a;d.style.fontSize="12px";d.style.fontFamily="Arial";d.style.fontWeight="bold";d.style.color="#fff";d.style.visibility="hidden";e.lineHeight="15px";c.appendChild(d);e.position="absolute";e.visibility="hidden";
e.fontSize="12px";e.display="inline-block";e.width=b+"px";e.lineHeight="15px";document.body.appendChild(c);d=c.offsetHeight;document.body.removeChild(c);return d}function d(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]="none";a.style.cursor="default"}function f(){for(var a=0,b=0;b<x.length;b++)x[b].ml&&a++;n=new Float32Array(3*a)}var k=
p("__batch"),g=p("__camera"),m=p("__objects"),l=p("__print"),r=p("__renderer"),q=p("__scenes"),w=p("__time");p("__util");var v=p("__config").q,E=null,B=!1,x=[],n=new Float32Array(0),e=new Uint8Array(16),H=new Float32Array(3);a.init=function(a){E=a};a.append=function(a){var b;a:{for(b=0;b<x.length;b++)if(x[b].obj==a){b=!0;break a}b=!1}if(!b){b={type:a.b4w_anchor.type,obj:a,x:0,y:0,depth:0,jg:"out",ml:a.b4w_anchor.detect_visibility,element:null,Mg:null,Mn:0};switch(b.type){case "ANNOTATION":b.element=
c(a);b.Mn=b.element.offsetHeight;break;case "ELEMENT":b.element=document.getElementById(a.b4w_anchor.element_id),b.element||(l.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}x.push(b);f()}};a.remove=function(a){for(var b=0;b<x.length;b++){var c=x[b];if(c.obj==a){"ANNOTATION"==c.type&&E.parentElement.removeChild(c.element);x.splice(b,1);f();break}}};a.update=function(){for(var a=0,b=0;b<x.length;b++){var c=x[b];c.ml&&(n.set(c.obj.d.g,3*a),a++);var d,e=c,C=H;d=q.pj(q.rj());
C=g.project_point(d,e.obj.d.g,C);C[0]/=v.resolution_factor;C[1]/=v.resolution_factor;e=q.Bp();C[0]/=e;C[1]/=e;d=C;C=d[0];e=d[1];d=d[2];if(C!=c.x||e!=c.y||d!=c.depth){switch(c.type){case "ANNOTATION":var I=c.element;I.style.left=Math.floor(C)+"px";I.style.top=Math.floor(e-c.Mn)+"px";break;case "ELEMENT":I=c.element,I.style.left=Math.floor(C-I.offsetWidth/2)+"px",I.style.top=Math.floor(e-I.offsetHeight/2)+"px"}c.x=C;c.y=e;c.depth=d;c.Mg&&c.Mg(C,e,c.jg,c.obj,I)}}0<a&&(a=q.fa(q.rj(),"ANCHOR_VISIBILITY").p[0].o,
k.Wz(a,n))};a.nA=function(){for(var a=0;a<x.length;a++){var b=x[a],c=b.x,d=b.y,n=b.depth,n=0>c||0>d||0>n||1<n||c>=E.clientWidth||d>=E.clientHeight?"out":"visible";if(b.ml&&"out"!=n){var n=b,C=q.fa(q.rj(),"ANCHOR_VISIBILITY");if(C){var I=q.Bp(),J=n.x*I,I=n.y*I,J=J*v.resolution_factor,I=I*v.resolution_factor,C=C.j;r.ar(C.Id,J,C.height-I,2,2,e);n=1020==e[0]+e[4]+e[8]+e[12]?"visible":"out"==n.jg||0==e[0]+e[4]+e[8]+e[12]?"covered":n.jg}else n=void 0}if(n!=b.jg){switch(b.type){case "ANNOTATION":case "ELEMENT":var g=
b.element;if(!g)break;"out"==n?(g.style.visibility="hidden",g.children.length&&(g.children[0].style.visibility="hidden"),"ANNOTATION"==b.type&&1<g.children.length&&(J=g.children[1],J.style.visibility="hidden",J.children.length&&(J.children[0].style.visibility="hidden"))):"visible"==n?(g.style.visibility="visible",g.children.length&&(g.children[0].style.visibility="visible"),g.style.opacity=1):(g.style.visibility="visible",g.style.opacity=.1,g.children.length&&(g.children[0].style.visibility="visible"),
"ANNOTATION"==b.type&&1<g.children.length&&(J=g.children[1],J.style.visibility="hidden",J.children.length&&(J.children[0].style.visibility="hidden")))}b.jg=n;b.Mg&&b.Mg(c,d,b.jg,b.obj,g)}}};a.attach_move_cb=function(a,b){for(var c=0;c<x.length;c++)x[c].obj==a&&(x[c].Mg=b)};a.detach_move_cb=function(a){for(var b=0;b<x.length;b++)x[b].obj==a&&(x[b].Mg=null)};a.cleanup=function(){for(var a=0;a<x.length;a++){var b=x[a];"ANNOTATION"==b.type&&E.parentElement.removeChild(b.element)}x.length=0};a.Wp=function(a){return a.b4w_anchor?
!0:!1};a.pause=function(){B=!0};a.resume=function(){B=!1}};b4w.module.__boundings=function(a,p){function c(a,b){for(var c=a[0],d=a[1],g=a[2],n=a[0],e=a[1],l=a[2],f=3;f<a.length;f+=3)var k=a[f],m=a[f+1],h=a[f+2],c=Math.max(c,k),d=Math.max(d,m),g=Math.max(g,h),n=Math.min(n,k),e=Math.min(e,m),l=Math.min(l,h);b.max_x=c;b.max_y=d;b.max_z=g;b.min_x=n;b.min_y=e;b.min_z=l;return b}function b(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,g=a.max_z,n=a.min_x,e=a.min_y,l=a.min_z;b[0]=n;b[1]=e;b[2]=l;b[3]=c;b[4]=e;b[5]=l;b[6]=c;b[7]=d;b[8]=l;b[9]=n;b[10]=
d;b[11]=l;b[12]=n;b[13]=e;b[14]=g;b[15]=c;b[16]=e;b[17]=g;b[18]=c;b[19]=d;b[20]=g;b[21]=n;b[22]=d;b[23]=g;return b}function h(a,b,c){g.add(b,c,a.D);g.scale(a.D,.5,a.D);a.va=g.distance(a.D,b);return a}var d=p("__geometry"),f=p("__util"),k=p("__tsr"),g=p("vec3"),m=new Float32Array(24),l=new Float32Array(3),r=new Float32Array(3),q=new Float32Array(3);a.Do=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.jB=function(){return{max_x:1E12,min_x:-1E12,
max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.qd=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.Vo=function(a,b){var c=a.max_y,d=a.max_z,g=a.min_x,n=a.min_y,e=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,g);a.min_y=Math.min(b.min_y,n);a.min_z=Math.min(b.min_z,e)};a.ku=c;a.Ok=function(d,g,l){l||(l=a.qd());d=b(d,m);f.ve(d,g,d);return c(d,l)};a.Vv=b;a.eD=function(b,c,d){d||
(d=a.qd());var g=c.min_x,x=c.max_x,n=c.min_y,e=c.max_y,l=c.min_z;c=c.max_z;if(g>=b.max_x||x<=b.min_x||n>=b.max_y||e<=b.min_y||l>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,g);d.max_x=Math.min(b.max_x,x);d.min_y=Math.max(b.min_y,n);d.max_y=Math.min(b.max_y,e);d.min_z=Math.max(b.min_z,l);d.max_z=Math.min(b.max_z,c);return d};a.iD=function(b,c,d){d||(d=a.qd());var g=b.max_x-b.min_x,x=b.max_y-b.min_y,n=b.max_z-b.min_z;d.min_x=
b.min_x-.5*(c-1)*g;d.max_x=b.max_x+.5*(c-1)*g;d.min_y=b.min_y-.5*(c-1)*x;d.max_y=b.max_y+.5*(c-1)*x;d.min_z=b.min_z-.5*(c-1)*n;d.max_z=b.max_z+.5*(c-1)*n;return d};a.Qk=function(b,c,d){d||(d=a.Fi());g.transformMat4(b.D,c,d.D);d.va=b.va*f.Ij(c);return d};a.Pk=function(a,b,c){c||(c={Ue:new Float32Array(3),Ve:new Float32Array(3),We:new Float32Array(3),D:new Float32Array([0,0,0])});k.vi(a.D,b,c.D);g.copy(a.Ue,c.Ue);g.copy(a.Ve,c.Ve);g.copy(a.We,c.We);k.kk(c.Ue,b,c.Ue);k.kk(c.Ve,b,c.Ve);k.kk(c.We,b,c.We);
return c};a.cl=function(a,b){return{va:a,D:new Float32Array(b)}};a.Fi=function(){return{D:new Float32Array([0,0,0]),va:0}};a.bl=function(a,b,c,d){return{Ue:new Float32Array(a),Ve:new Float32Array(b),We:new Float32Array(c),D:new Float32Array([d[0],d[1],d[2]])}};a.mu=function(){return{D:new Float32Array([0,0,0]),va:1E12}};a.Rv=function(a,b){var c=g.subtract(b.D,a.D,g.create());0==g.length(c)&&g.set(1,0,0,c);var d=g.normalize(c,g.create()),c=g.scale(d,a.va,g.create());g.add(c,a.D,c);var x=g.scale(d,
-a.va,g.create());g.add(x,a.D,x);var n=g.scale(d,b.va,g.create());g.add(n,b.D,n);var e=g.scale(d,-b.va,g.create());g.add(e,b.D,e);c=[c,x,n,e];d=g.normalize(d,g.create());x=c[0];n=c[0];for(e=1;e<c.length;e++){var l=g.dot(c[e],d);l<g.dot(x,d)&&(x=c[e]);l>g.dot(n,d)&&(n=c[e])}d=[x,n];c=d[0];d=d[1];a.D=g.scale(g.add(c,d,g.create()),.5,g.create());a.va=g.length(g.subtract(d,c,g.create()))/2};a.Eo=function(a,b){var c=b.max_y,d=b.min_y,g=Math.max(0,c-d-2*a);return{va:a,height:g,D:new Float32Array([0,(c+
d)/2,0])}};a.Go=function(a,b){var c=b.max_y,d=b.min_y,g=Math.max(0,c-d);return{va:a,height:g,D:new Float32Array([0,(c+d)/2,0])}};a.Fo=function(a,b){var c=b.max_y,d=b.min_y,g=Math.max(0,c-d);return{va:a,height:g,D:new Float32Array([0,(c+d)/2,0])}};a.nB=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.oy=function(a){for(var b=0,c=0,d=0,g=0,n=0,e=0,l=0,f=0,k=0;k<a.submeshes.length;k++){var m=a.submeshes[k];if(m.position.length){b=
g=m.position[0];c=n=m.position[1];d=e=m.position[2];break}}for(k=0;k<a.submeshes.length;k++)for(var m=a.submeshes[k],m=m.position,h=0;h<m.length/3;h++)var q=m[3*h],C=m[3*h+1],I=m[3*h+2],b=Math.max(q,b),c=Math.max(C,c),d=Math.max(I,d),g=Math.min(q,g),n=Math.min(C,n),e=Math.min(I,e),l=Math.max(Math.sqrt(q*q+C*C+I*I),l),f=Math.max(Math.sqrt(q*q+I*I),f);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=g;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=n;a.b4w_bounding_box.max_z=d;a.b4w_bounding_box.min_z=
e;a.b4w_bounding_sphere_radius=l;a.b4w_bounding_cylinder_radius=f};a.Mw=function(b){var c=b.subarray(0,3),f=b.subarray(6,9),m=b.subarray(12,15),x=b.subarray(18,21);b=g.subtract(f,c,l);g.normalize(b,b);var n=d.Pw(c,f,m,r),n=g.cross(n,b,n);g.normalize(n,n);var e=g.create(),k=g.create();g.subtract(f,c,q);k[0]=g.dot(q,b);k[1]=g.dot(q,n);f=g.create();g.subtract(m,c,q);f[0]=g.dot(q,b);f[1]=g.dot(q,n);m=g.create();g.subtract(x,c,q);m[0]=g.dot(q,b);m[1]=g.dot(q,n);x=a.Fi();m=[e,k,f,m];e=h(x,m[0],m[1]);for(x=
2;x<m.length;x++)if(g.distance(e.D,m[x])>e.va){for(var G=e,e=m,k=m[x],f=x-1,G=h(G,k,e[0]),y=1;y<=f;y++)if(g.distance(G.D,e[y])>G.va){for(var A=G,G=e,D=k,L=e[y],C=y-1,A=h(A,D,L),I=0;I<=C;I++)if(g.distance(A.D,G[I])>A.va){var J=D,Q=L,N=G[I],u=g.subtract(Q,N,q),u=g.squaredLength(u),P=g.subtract(J,N,q),S=g.squaredLength(P),P=g.subtract(J,Q,q),Z=g.squaredLength(P),P=u*(S+Z-u),p=S*(Z+u-S),u=Z*(u+S-Z),S=P+p+u;g.copy(J,A.D);g.scale(A.D,P/S,A.D);g.scaleAndAdd(A.D,Q,p/S,A.D);g.scaleAndAdd(A.D,N,u/S,A.D);A.va=
g.distance(A.D,J)}G=A}e=G}x=e;b=g.scale(b,x.D[0],q);g.scaleAndAdd(b,n,x.D[1],b);g.add(b,c,x.D);return x}};b4w.module.__compat=function(a,p){function c(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function b(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function h(){return!window.ActiveXObject&&"ActiveXObject"in window}var d=p("__config"),f=p("__extensions"),k=p("__print"),
g=p("__util");a.Sy=function(a){var l=d.xd,r=d.q,q=d.context,w=d.pi,v=d.Lc;r.Yc=a.getParameter(a.MAX_TEXTURE_SIZE);r.im=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var E=Boolean(f.Jw());c("Firefox")&&d.Xp()&&(k.warn("Firefox detected for single HTML version, disable video textures."),r.cp=!0);c("Firefox/28.0")&&(c("Linux")||c("Macintosh"))&&(k.warn("Firefox 28 detected, applying depth hack"),E=!1);c("iPad")||c("iPhone")?(k.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
q.alpha||(r.background_color[3]=1),r.fs=!0,r.smaa=!1,r.Ge=!1,r.precision="highp",r.Tp=!0):c("Mac OS X")&&c("Safari")&&!c("Chrome")&&(k.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),v.Vn=!0,v.ro=!0);c("Windows")&&(c("Chrome/40")||c("Firefox/33")||c("Firefox/34")||c("Firefox/35")||c("Firefox/36"))&&(k.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),r.Vk=!0);b()&&(k.warn("Mobile detected, applying various hacks for video textures."),
r.sf=!0,c("iPad")||c("iPhone")||(k.warn("Mobile (not iOS) detected, disable playback rate for video textures."),v.Ro=!0));(c("Firefox/35.0")||c("Firefox/36.0"))&&c("Windows")&&(k.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),r.dp=!0);if(c("iPhone")||h())k.warn("iPhone or IE11 detected. Enable sequential video fallback for video textures."),r.Kc=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(k.warn("Not enough varyings, disable shadows on blend objects"),r.Qo=!0);if(q=f.wp())c("Macintosh")&&
-1<a.getParameter(q.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(k.warn("OS X / Intel HD 3000 detected, applying depth hack"),E=!1),-1<a.getParameter(q.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(q.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(k.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),E=!1,l.hp=!0),-1<a.getParameter(q.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(q.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(k.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),
r.precision="highp",r.Ae="NONE"),-1<a.getParameter(q.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(q.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(k.warn("ARM Mali-T760 detected, disable SSAO."),r.Ge=!1),-1<a.getParameter(q.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&-1<a.getParameter(q.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(k.warn("Qualcomm Adreno detected, applying shader constants hack."),r.rr=!0,-1<a.getParameter(q.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(k.warn('Qualcomm Adreno305 detected, set "highp" precision.'),
r.precision="highp"),-1<a.getParameter(q.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(k.warn('Qualcomm Adreno330 detected, set "highp" precision.'),r.precision="highp")),-1<a.getParameter(q.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(q.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&(k.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),r.xl=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(k.warn("Vertex textures are not allowed. Disabling vertex textures"),
r.Bk=!1);r.allow_hidpi&&1<window.devicePixelRatio&&(k.log("%cENABLE HIDPI MODE","color: #00a"),r.resolution_factor=1,r.smaa=!1);E||(r.vg=!1,r.ci=!1,r.Sa=!1,r.water_dynamic=!1,r.shore_smoothing=!1,r.Wg=!1,r.Ic=!1,r.smaa=!1);r.as=Boolean(f.xp());r.kj=E;l=g.clamp(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),128,Infinity);r.Gc=g.trunc((l-50)/4);r.QC=g.trunc((l-50)/2);0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(r.precision="mediump");h()&&(k.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),
w.ij=512);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(k.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),r.xl=!0)};a.detect_mobile=b;a.$t=function(){c("Firefox/35.0")&&c("Windows")&&(k.warn("Windows/Firefox 35 detected, forcing context's alpha"),d.context.alpha=!0)};a.Tl=h};b4w.module.__constraints=function(a,p){function c(a){var b={};b.type=a;return b}function b(a,b){a.Ya&&a.Ya.S&&d(a.Ya.S,a);b.S&&h(b.S,a);a.Ya=b}function h(a,b){if(-1==a.oc.indexOf(b))a.oc.push(b);else throw"Descendant object override is forbidden";}function d(a,b){var c=a.oc.indexOf(b);if(-1!=c)a.oc.splice(c,1);else throw"No descendant object";}function f(a,b,c){switch(b.type){case 1:var d=a.d.quat,u=b.S.d.N;c=b.S.d.quat;b.xe?(E.copy(b.xe,d),E.multiply(c,d,d)):E.copy(c,d);v.transformMat4(b.offset,
u,a.d.g);a.d.scale=b.bk*b.S.d.scale;break;case 9:var f=a.d.g,d=a.d.quat,u=b.S.d.N;c=b.S.d.quat;E.multiply(E.invert(b.Mf,b.Mf),d,d);E.multiply(c,d,d);v.transformMat4(b.offset,u,f);E.copy(c,b.Mf);break;case 10:f=a.d.g;d=a.d.quat;u=b.S.d.N;c=b.S.d.quat;E.multiply(E.invert(b.Mf,b.Mf),d,d);E.multiply(c,d,d);v.transformMat4(b.offset,u,f);E.copy(c,b.Mf);var d=a.d.quat,f=b.S.d.quat,h=v.transformQuat(q.AXIS_Y,d,x),u=E.invert(f,G),w=v.transformQuat(h,u,n),y=e;y[0]=w[0];y[1]=0;y[2]=w[2];var D=v.length(y),u=
-y[2]/D,u=Math.acos(u)*q.sign(y[0]),D=D/v.length(w),D=Math.acos(D)*q.sign(w[1]),w=!1;u<-b.qo&&(u=-b.qo,w=!0);u>b.so&&(u=b.so,w=!0);D<-b.uo&&(D=-b.uo,w=!0);D>b.po&&(D=b.po,w=!0);w&&(b=Math.sin(D),D=Math.cos(D),w=Math.sin(u),u=Math.cos(u),y=n,y[0]=D*w,y[1]=b,y[2]=-D*u,v.transformQuat(y,f,y),b=E.rotationTo(h,y,G),E.multiply(b,d,d),E.normalize(d,d));"CAMERA"==a.d.type&&(b=v.transformQuat(q.AXIS_Y,c,n),m(a,b));break;case 12:f=a.d.g;d=a.d.quat;u=b.S.d.N;D=b.S.d.g;a=b.lz;w=x;h=G;v.transformMat4(b.offset,
u,w);q.smooth_v(w,f,c,a,f);b=x;v.sub(D,f,b);v.normalize(b,b);y=d;f=L;u=f.subarray(0,3);D=f.subarray(3,6);w=f.subarray(6,9);v.copy(b,D);v.negate(D,D);v.normalize(D,D);Boolean(.999999<Math.abs(v.dot(b,q.AXIS_Y)))?(b=B.fromQuat(E.normalize(y,h),C),v.copy(b.subarray(0,3),u)):v.cross(q.AXIS_Y,D,u);v.normalize(u,u);v.cross(u,D,w);v.normalize(w,w);E.fromMat3(f,h);E.normalize(h,h);q.wr(h,d,c,.16*a,d);break;case 2:d=a.d.quat;f=H;c=G;l(b.S,b.ru,!0,f,c);b.xe?(E.copy(b.xe,d),E.multiply(c,d,d)):E.copy(c,d);a.d.scale=
b.bk*f[3];q.vi(b.offset,f[3],c,f,a.d.g);break;case 3:f=a.d.g;d=a.d.quat;c=b.S.d.g;k(f,d,c);"CAMERA"==a.d.type&&m(a,q.AXIS_Y);break;case 4:f=a.d.g;d=a.d.quat;c=b.target;k(f,d,c);"CAMERA"==a.d.type&&m(a,q.AXIS_Y);break;case 5:f=a.d.g;d=a.d.quat;c=b.S.d.g;g(f,d,c,b.Gf);d=v.dist(f,c);if(b=d>b.ai?d-b.ai:d<b.Gf?d-b.Gf:0)v.sub(c,f,x),v.normalize(x,x),v.scale(x,b,x),v.add(f,x,f);"CAMERA"==a.d.type&&m(a,q.AXIS_Y);break;case 6:f=a.d.g;d=a.d.quat;c=b.target;g(f,d,c,b.Gf);d=v.dist(f,c);if(b=d>b.ai?d-b.ai:d<b.Gf?
d-b.Gf:0)v.sub(c,f,x),v.normalize(x,x),v.scale(x,b,x),v.add(f,x,f);"CAMERA"==a.d.type&&m(a,q.AXIS_Y);break;case 7:u=b.S.d.N;v.transformMat4(b.offset,u,a.d.g);break;case 8:D=b.S.d.g;f=a.d.g;v.add(D,b.offset,f);break;case 13:d=a.d.quat;u=b.S.d.N;c=b.S.d.quat;b.xe?(E.copy(b.xe,d),E.multiply(c,d,d)):E.copy(c,d);v.transformMat4(b.offset,u,a.d.g);break;case 11:c=b.S.d,c=r.qg(c.g,c.scale,c.quat,A),r.multiply(c,b.Tr,c),f=a.d.g,f[0]=c[0],f[1]=c[1],f[2]=c[2],a.d.scale=c[3],d=a.d.quat,d[0]=c[4],d[1]=c[5],d[2]=
c[6],d[3]=c[7]}}function k(a,b,c){var d=x;q.quat_to_dir(b,q.AXIS_MY,d);v.normalize(d,d);var u=n;v.subtract(c,a,u);v.normalize(u,u);a=H;q.hr(d,u,a);E.multiply(a,b,b)}function g(a,b,c,d){var u=x;q.quat_to_dir(b,q.AXIS_MY,u);v.normalize(u,u);var e=n;v.subtract(c,a,e);a=v.length(e);v.normalize(e,e);a>d-.001&&(d=q.hr(u,e,H),E.multiply(d,b,b),E.normalize(b,b))}function m(a,b){var c=a.d,d=c.quat,u=q.quat_to_dir(c.quat,q.AXIS_Y,x);v.normalize(u,u);if(.999999<Math.abs(v.dot(b,u)))u=E.identity(G);else{var C=
v.cross(b,u,n);v.normalize(C,C);c.aa==w.MS_TARGET_CONTROLS?c.ik&&(C[0]*=-1,C[1]*=-1,C[2]*=-1):0<q.quat_to_dir(c.quat,q.AXIS_Z,e)[1]&&(C[0]*=-1,C[1]*=-1,C[2]*=-1);c=q.quat_to_dir(c.quat,q.AXIS_X,e);v.normalize(c,c);var g=q.clamp(v.dot(c,C),-1,1),f=Math.acos(g),u=-.999999>=g?E.setAxisAngle(u,f,G):E.rotationTo(c,C,G);E.normalize(u,u)}E.multiply(u,d,d)}function l(a,b,c,d,u){var C=a.d,e=C.jf,n=C.qc[b];b=n.Hh;a=a.pose.bones[n.ym];var n=a.Fn,g=H,f=C.mc,x=C.lc,l=C.ec,k=C.dc,h=f[4*b+1],m=f[4*b+2],q=f[4*b+
3],v=x[4*b+1],w=x[4*b+2],B=x[4*b+3];g[0]=(1-e)*f[4*b]+e*x[4*b];g[1]=(1-e)*h+e*v;g[2]=(1-e)*m+e*w;g[3]=(1-e)*q+e*B;f=G;x=y;f[0]=l[4*b];f[1]=l[4*b+1];f[2]=l[4*b+2];f[3]=l[4*b+3];x[0]=k[4*b];x[1]=k[4*b+1];x[2]=k[4*b+2];x[3]=k[4*b+3];E.slerp(f,x,e,f);e=A;r.bz(g,e);r.Im(f,e);c?(c=D,r.translate(n,a.Gt,c),r.multiply(e,c,e)):r.multiply(e,n,e);r.multiply(C.Wd,e,e);d[0]=e[0];d[1]=e[1];d[2]=e[2];d[3]=e[3];u&&(u[0]=e[4],u[1]=e[5],u[2]=e[6],u[3]=e[7])}var r=p("__tsr"),q=p("__util"),w=p("__camera"),v=p("vec3"),
E=p("quat"),B=p("mat3");p("mat4");a.MA=1;a.LA=2;a.PA=3;a.QA=4;a.GA=5;a.HA=6;a.NA=7;a.FA=8;a.KA=9;a.JA=10;a.rd=11;a.IA=12;a.OA=13;var x=new Float32Array(3),n=new Float32Array(3),e=new Float32Array(3),H=new Float32Array(4),G=new Float32Array(4),y=new Float32Array(4),A=new Float32Array(16),D=new Float32Array(16),L=new Float32Array(9),C=new Float32Array(9),A=new Float32Array(8);a.ps=9*Math.PI/10;a.On=function(a,d,e,C,u){var n=c(1);n.S=d;n.offset=new Float32Array(e);n.xe=C?new Float32Array(C):null;n.bk=
u;b(a,n);f(a,n,0)};a.Nn=function(a,d,e,C,u,n){var g=c(2);g.S=d;g.ru=e;g.offset=new Float32Array(C);g.xe=u?new Float32Array(u):null;g.bk=n;b(a,g);f(a,g,0)};a.Tt=function(a,d,e,C){var u=c(9),n=a.d.quat,g=d.d.quat;u.S=d;u.offset=new Float32Array(e);u.Mf=new Float32Array(g);C&&(E.copy(C,n),E.multiply(g,n,n));b(a,u);f(a,u,0)};a.St=function(a,d,e,C,u,n,g,x){var l=c(10),k=a.d.quat,h=d.d.quat;l.S=d;l.offset=new Float32Array(e);l.Mf=new Float32Array(h);l.qo=u;l.so=n;l.uo=g;l.po=x;C&&(E.copy(C,k),E.multiply(h,
k,k));b(a,l);f(a,l,0)};a.Rt=function(a,d,e,C){var u=c(12);u.S=d;u.offset=new Float32Array(e);u.lz=C;b(a,u);f(a,u,0)};a.Vt=function(a,d,e,C){var u=c(13);u.S=d;u.offset=new Float32Array(e);u.bk=1;u.xe=C?new Float32Array(C):null;b(a,u);f(a,u,0)};a.fB=h;a.YC=d;a.Xt=function(a,d){var e=c(3);e.S=d;b(a,e);f(a,e,0)};a.Yt=function(a,d){var e=c(4);e.target=new Float32Array(d);b(a,e);f(a,e,0)};a.Ot=function(a,d,e,C){var u=c(5);u.S=d;u.Gf=e;u.ai=C;b(a,u);f(a,u,0)};a.Pt=function(a,d,e,C){var u=c(6);u.target=new Float32Array(d);
u.Gf=e;u.ai=C;b(a,u);f(a,u,0)};a.Ut=function(a,d,e){var C=c(7);C.S=d;C.offset=new Float32Array(e);b(a,C);f(a,C,0)};a.Nt=function(a,d,e){var C=c(8);C.S=d;C.offset=new Float32Array(e);b(a,C);f(a,C,0)};a.Mt=function(a,d,e){var C=c(11);C.S=d;C.Tr=new Float32Array(e);b(a,C);f(a,C,0)};a.cA=function(a,b){a.Ya&&f(a,a.Ya,b)};a.Dy=k;a.Ey=g;a.correct_up=m;a.remove=function(a){a.Ya.S&&d(a.Ya.S,a);a.Ya=null};a.Ld=function(a){return a.Ya?a.Ya.type:null};a.iC=function(a){return a.Ya&&a.Ya.S?a.Ya.S:null};a.Jd=function(a){return a.Ya&&
11==a.Ya.type?a.Ya.Tr:null};a.Dw=l};b4w.module.__controls=function(a,p){function c(a){return{type:a,value:0,X:null,fm:null,em:null,Hj:null,Ec:!1,key:0,Vb:"",Yk:null,om:!1,Xk:function(){},Wk:null,wo:function(){},ed:null,Sm:new Float32Array(3),ql:new Float32Array(3),dm:!1,$q:function(){},axis:"",kc:0,oh:new Float32Array(3),Zj:new Float32Array(4),threshold:0,Yq:new Float32Array(4),Ri:0,Qi:0,gr:0,Si:0,xc:0,repeat:!1,Wn:!1,xj:0,wj:0,vj:0,Ll:0,Kl:0,Jl:0}}function b(a,b){var t;if(a.Hj){t=a.fm;for(var c=a.em,d=0;d<t.length;d++)c[d]=t[d].value;
t=a.Hj(c)}else t=!1;t||(a.value=Number(b))}function h(a){a=I.indexOf(a);-1<a?I.splice(a,1):n.error("Wrong object")}function d(a,b){for(var t=0,c=0;c<b.length;c++)for(var d=b[c].Zd,u=0;u<d.length;u++)for(var e=d[u].bd,C=0;C<e.length;C++)e[C]===a&&t++;return t}function f(a,b){switch(a.type){case 80:e.remove_collision_test(a.Yk,a.Vb,a.Xk);a.Ec=!0;break;case 90:e.clear_collision_impulse_test(a.Wk);a.Ec=!0;break;case 100:e.remove_ray_test(a.ed,a.Vb,a.Sm,a.ql,a.dm);a.Ec=!0;break;case 130:a.Ec=!0}var t=
b.indexOf(a);-1<t&&b.splice(t,1)}function k(a){for(var t=0;t<J.length;t++){var c=J[t];20==c.type&&a.keyCode==c.key&&b(c,1)}O&&a.preventDefault();ca&&ca(a)}function g(a){for(var t=0;t<J.length;t++){var c=J[t];20==c.type&&0==a.keyCode&&16==c.key&&b(c,0);20==c.type&&a.keyCode==c.key&&b(c,0)}O&&a.preventDefault();ca&&ca(a)}function m(a){var t=!1,c=null;u=a.clientX;P=a.clientY;for(var d=0;d<J.length;d++){var e=J[d];50==e.type&&(b(e,1),e.X=a.which);160==e.type&&(t||(c=H.pick_object(a.clientX,a.clientY),
t=!0),e.value=c==e.ed?1:0)}T&&a.preventDefault();ia&&ia(a)}function l(a){for(var t=0;t<J.length;t++){var c=J[t];50==c.type&&b(c,0);160==c.type&&c.Wn&&(c.value=0)}T&&!oa&&a.preventDefault();ia&&ia(a)}function r(a){var t=a.clientX,c=a.clientY;u=t;P=c;for(var d=t-S,e=c-Z,C=Math.sqrt(d*d+e*e),K=0;K<J.length;K++){var n=J[K];if(40===n.type)switch(n.axis){case "X":b(n,d);n.X=t;break;case "Y":b(n,e);n.X=c;break;case "XY":b(n,C),n.X[0]=t,n.X[1]=c}}T&&!oa&&a.preventDefault();ia&&ia(a)}function q(a){var c=a.wheelDelta||
-40*a.detail,c=c*L.Qx;N+=c;for(c=0;c<J.length;c++){var d=J[c];30===d.type&&b(d,N)}W&&a.preventDefault();t&&t(a)}function w(a){var b=a.targetTouches;if(1==b.length){for(var t=b[0],b=t.pageX,t=t.pageY,c=!1,d=null,u=0;u<J.length;u++){var e=J[u];160==e.type&&(c||(d=H.pick_object(b,t),c=!0),e.value=d==e.ed)}Y[0]=b;Y[1]=-1;ha[0]=t;ha[1]=-1}else 1<b.length&&(z=pa=B(b),Y[0]=b[0].pageX,Y[1]=b[1].pageX,ha[0]=b[0].pageY,ha[1]=b[1].pageY);V.set(Y);fa.set(ha);K&&K(a)}function v(t){var c=t.targetTouches;if(0!==
c.length){if(1===c.length){V[0]=c[0].pageX;V[1]=-1;fa[0]=c[0].pageY;fa[1]=-1;var c=V[0]-Y[0],d=fa[0]-ha[0],u=Math.sqrt(c*c+d*d);if(-1!=Y[1]&&-1!=ha[1]){var e=V[0]-Y[1],C=fa[0]-ha[1],n=Math.sqrt(e*e+C*C);n<u&&(c=e,d=C,u=n)}for(n=0;n<J.length;n++){var g=J[n];if(60===g.type)switch(g.X=a.PL_SINGLE_TOUCH_MOVE,g.axis){case "X":b(g,c);break;case "Y":b(g,d);break;case "XY":b(g,u)}}}else if(1<c.length){V[0]=c[0].pageX;V[1]=c[1].pageX;fa[0]=c[0].pageY;fa[1]=c[1].pageY;z=B(c);u=z-pa;e=R;e[0]=(V[0]+V[1])/2;e[1]=
(fa[0]+fa[1])/2;C=X;C[0]=(Y[0]+Y[1])/2;C[1]=(ha[0]+ha[1])/2;var f,c=e[0],d=e[1],n=C[0],g=C[1];f=Math.sqrt((c-n)*(c-n)+(d-g)*(d-g));for(n=0;n<J.length;n++)if(g=J[n],70===g.type&&Math.abs(f)<Math.abs(u)&&(g.X=a.PL_MULTITOUCH_MOVE_ZOOM,b(g,u)),60===g.type&&Math.abs(f)>Math.abs(u))switch(g.X=a.PL_MULTITOUCH_MOVE_PAN,g.axis){case "X":c=e[0]-C[0];b(g,c);break;case "Y":d=e[1]-C[1];b(g,d);break;case "XY":b(g,f)}}ma&&t.preventDefault();K&&K(t)}}function E(a){for(var t=0;t<J.length;t++){var c=J[t];if(170==
c.type||180==c.type)c.wj=a.beta,c.xj=a.gamma,c.vj=a.alpha,c.value||(c.Ll=a.gamma,c.Kl=a.beta,c.Jl=a.alpha,b(c,1))}}function B(a){var b=a[0],t=a[1];a=b.pageX;var b=b.pageY,c=t.pageX,t=t.pageY;return Math.sqrt((a-c)*(a-c)+(b-t)*(b-t))}var x=p("__config"),n=p("__print"),e=p("__physics"),H=p("__scenes"),G=p("__time"),y=p("__util"),A=p("vec3"),D=p("quat"),L=x.controls,C=x.q,I=[],J=[],Q={},N=0,u=0,P=0,S=0,Z=0,V=new Float32Array(2),fa=new Float32Array(2),Y=new Float32Array(2),ha=new Float32Array(2),R=new Float32Array(2),
X=new Float32Array(2),z=0,pa=0,ga=!1,ea=0,O=!1,T=!1,W=!1,ma=!1,oa=!1,ca=null,ia=null,t=null,K=null;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.update=function(t,c){for(var d=0;d<J.length;d++){var e=J[d],C=t,K=c;if(K)switch(e.type){case 110:var n=e.ed,g=n.d.g,n=n.d.quat,f=A.dist(e.oh,g),x=e.Yq;D.invert(e.Zj,x);D.multiply(n,x,x);D.normalize(x,x);x=Math.abs(2*Math.acos(x[3]));f/=K;e.Ri=y.smooth(f,e.Ri,
K,.3);e.X[0]=f;f=x/K;e.Qi=y.smooth(f,e.Qi,K,.3);e.X[1]=f;e.Ri>=e.threshold||e.Qi>=e.gr?b(e,1):b(e,0);A.copy(g,e.oh);D.copy(n,e.Zj);e.kc=C;break;case 120:n=e.ed;g=n.d.g;n=Math.abs(g[1]-e.oh[1])/K;e.Si=y.smooth(n,e.Si,K,.3);e.X=n;e.Si>=e.threshold?b(e,1):b(e,0);A.copy(g,e.oh);e.kc=C;break;case 130:!e.Ec&&0<=e.xc&&C-e.kc>=e.xc&&(b(e,1),e.repeat?e.kc=C:e.xc=-e.xc);break;case 140:e.kc||(e.kc=C);b(e,C-e.kc);e.kc=C;break;case 150:b(e,C);break;case 170:e.X[0]=Math.PI*(e.xj-e.Ll)/180;e.X[1]=Math.PI*(e.wj-
e.Kl)/180;e.X[2]=Math.PI*(e.vj-e.Jl)/180;e.Ll=e.xj;e.Kl=e.wj;e.Jl=e.vj;break;case 180:e.X[0]=Math.PI*e.xj/180,e.X[1]=Math.PI*e.wj/180,e.X[2]=Math.PI*e.vj/180}}for(d=0;d<I.length;d++)for(K=I[d],e=K.Zd,C=0;C<e.length;C++)if(g=e[C],g.Wr!=ea){g.Wr=ea;for(var n=g,f=n.bd,x=n.Ny,l=0;l<f.length;l++)x[l]=f[l].value;var n=n.Fx(x),f=g,x=f.gq,k=l=void 0;switch(f.type){case a.CT_CONTINUOUS:n?k=l=1:1==x?k=l=-1:l=0;break;case a.CT_TRIGGER:n&&-1==x?k=l=1:n||1!=x?l=0:k=l=-1;break;case a.CT_SHOT:n&&-1==x?k=l=1:n||
1!=x?l=0:(l=0,k=-1);break;case a.CT_LEVEL:l=f.fq!=n?1:0;break;default:y.la("Wrong sensor manifold type: "+f.type)}k&&(f.gq=k);if(f=l)if(x=K==Q?null:K,ga=!1,g.callback(x,g.id,f,g.vu),g.fq=n,ga){d=-1;break}}for(d=0;d<I.length;d++)for(K=I[d],e=K.Zd,C=0;C<e.length;C++)for(g=e[C],K=g.bd,g=0;g<K.length;g++)switch(n=K[g],n.type){case 30:b(n,0);break;case 40:b(n,0);break;case 60:b(n,0);break;case 70:b(n,0);break;case 130:b(n,0)}N=0;S=u;Z=P;Y.set(V);ha.set(fa);pa=z;ea++};a.create_custom_sensor=function(a){var t=
c(10);b(t,a);return t};a.create_keyboard_sensor=function(a){var b=c(20);b.key=a;return b};a.create_collision_sensor=function(a,t,d){if(!a||!a.l)return n.error("Wrong collision object"),null;var e=c(80);e.Yk=a;e.Vb=t||"ANY";e.om=d;e.Xk=function(a,t){b(e,a);a&&t&&d&&(e.X=e.X||new Float32Array(3),e.X[0]=t[0],e.X[1]=t[1],e.X[2]=t[2])};e.Ec=!0;return e};a.create_collision_impulse_sensor=function(a){if(!a||!a.l)return n.error("Wrong collision impulse object"),null;var t=c(90);t.Wk=a;t.wo=function(a){b(t,
a)};t.Ec=!0;return t};a.create_ray_sensor=function(a,t,d,e,u){if(!a)return n.error("Wrong collision object"),null;var C=c(100);C.ed=a;C.Sm=t;C.ql=d;C.dm=e;C.Vb=u||"ANY";C.$q=function(a,t){b(C,a);a&&(C.X=t)};C.Ec=!0;return C};a.create_mouse_click_sensor=function(){return c(50)};a.create_mouse_wheel_sensor=function(){return c(30)};a.create_mouse_move_sensor=function(a){var b=c(40);b.axis=a||"XY";b.X="XY"==b.axis?new Float32Array(2):0;return b};a.create_touch_move_sensor=function(a){var b=c(60);b.axis=
a||"XY";b.X=0;return b};a.create_touch_zoom_sensor=function(){var a=c(70);a.X=0;return a};a.create_motion_sensor=function(a,b,t){if(!a)return n.error("Wrong collision object"),null;var d=c(110);d.ed=a;var e=a.d.g;a=a.d.quat;d.Yq=new Float32Array(4);d.oh=new Float32Array(e);d.Zj=new Float32Array(a);d.Ri=0;d.Qi=0;d.threshold=b;d.gr=t;d.kc=0;d.X=new Float32Array([0,0]);return d};a.create_vertical_velocity_sensor=function(a,b){if(!a)return n.error("Wrong collision object"),null;var t=c(120);t.ed=a;var d=
a.d.quat;t.oh=new Float32Array(a.d.g);t.Zj=new Float32Array(d);t.Si=0;t.threshold=b;t.kc=0;t.X=0;return t};a.create_timer_sensor=function(a,b){var t=c(130);t.xc=a;t.repeat=b;t.Ec=!0;return t};a.reset_timer_sensor=function(a,b,t,c){a=a||Q;a=a.Ac;if(!a||!a[b])return n.error("reset_timer_sensor(): wrong object"),null;b=a[b].bd[t];if(!b)return n.error("reset_timer_sensor(): sensor not found"),null;b.kc=G.Ag();b.xc=c};a.create_elapsed_sensor=function(){var a=c(140);a.kc=0;return a};a.create_gyro_delta_sensor=
function(){var a=c(170);a.X=new Float32Array(3);return a};a.create_gyro_angles_sensor=function(){var a=c(180);a.X=new Float32Array(3);return a};a.create_timeline_sensor=function(){return c(150)};a.create_selection_sensor=function(a,b){var t=c(160);t.ed=a;t.Wn=b;return t};a.My=b;a.get_sensor_value=function(a,b,t){a=a||Q;a=a.Ac;if(!a||!a[b])return n.error("get_sensor_value(): wrong object"),null;b=a[b].bd[t];return b?b.value:(n.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=
function(a,b,t){a=a||Q;a=a.Ac;if(!a||!a[b])return n.error("get_sensor_payload(): wrong object"),null;b=a[b].bd[t];return b?b.X:(n.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){I=[];J=[];Q={}};a.check_sensor_manifold=function(a,b){a=a||Q;if(!a.Ac)return!1;if(b&&a.Ac[b])return!0;if(!b)for(var t in a.Ac)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||Q;var t=a.Ac;if(t){var c=a.Zd;if(b){var e=t[b];if(e){for(var u=e.bd,C=0;C<u.length;C++)1===d(u[C],I)&&f(u[C],
J);delete t[b];e=c.indexOf(e);-1<e?c.splice(e,1):y.la("Incorrect manifolds array");Object.getOwnPropertyNames(t).length||h(a)}}else{for(b in t){e=t[b];u=e.bd;for(C=0;C<u.length;C++)1===d(u[C],I)&&f(u[C],J);delete t[b];e=c.indexOf(e);-1<e?c.splice(e,1):y.la("Incorrect manifolds array")}h(a);ga=!0}}};a.create_sensor_manifold=function(a,b,t,c,u,C,K){a=a||Q;a.Ac=a.Ac||{};a.Zd=a.Zd||[];var n=a.Ac,g=a.Zd,x=n[b];if(x){c=x.bd;for(var l=0;l<c.length;l++)1===d(c[l],I)&&f(c[l],J);x=g.indexOf(x);-1<x?g.splice(x,
1):y.la("Incorrect manifolds array")}t={id:b,type:t,bd:c.slice(0),Fx:u,Ny:Array(c.length),callback:C,vu:K,gq:-1,fq:0,Wr:-1};n[b]=t;g.push(t);-1==I.indexOf(a)&&I.push(a);a=t.bd;for(b=0;b<a.length;b++){n=a[b];if(n.Ec){switch(n.type){case 80:e.append_collision_test(n.Yk,n.Vb,n.Xk,n.om);break;case 90:e.apply_collision_impulse_test(n.Wk,n.wo);break;case 100:e.append_ray_test(n.ed,n.Vb,n.Sm,n.ql,n.dm,n.$q);break;case 130:n.kc=G.Ag(),0>n.xc&&(n.xc=-n.xc)}n.Ec=!1}-1==J.indexOf(n)&&J.push(n)}ga=!0};a.kl=function(a){for(var b=
0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.Cv=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<I.length;a++){var b=I[a],t=b.Ac,b=b.Zd,c;for(c in t)delete t[c];b.splice(0,b.length)}for(a=0;a<J.length;a++)f(J[a],J),a--;I.splice(0,I.length)};a.debug=function(){n.log(String(I.length)+" objects with manifolds",I);n.log(String(J.length)+" sensors",J);for(var a=[],b=[],t=0;t<J.length;t++){var c=J[t];80==c.type&&a.push(c);
100==c.type&&b.push(c)}n.log(String(a.length)+" collision sensors",a);n.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",k,!1);a.addEventListener("keyup",g,!1);O=b};a.register_mouse_events=function(a,b,t){if(t)var c=window;else c=a,c.addEventListener("mouseout",l,!1);a.addEventListener("mousedown",m,!1);c.addEventListener("mousemove",r,!1);c.addEventListener("mouseup",l,!1);T=b;oa=t};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",
q,!1);a.addEventListener("DOMMouseScroll",q,!1);W=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",w,!1);a.addEventListener("touchmove",v,!1);document.addEventListener("touchstart",function(){});ma=b};a.register_device_orientation=function(){window.DeviceOrientationEvent&&C.yj&&window.addEventListener("deviceorientation",E,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",k,!1);a.removeEventListener("keyup",g,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",
m,!1);a.removeEventListener("mousemove",r,!1);a.removeEventListener("mouseout",l,!1);a.removeEventListener("mouseup",l,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",q,!1);a.removeEventListener("DOMMouseScroll",q,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",w,!1);a.removeEventListener("touchmove",v,!1);document.removeEventListener("touchstart",function(){})};a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&C.yj&&
window.removeEventListener("deviceorientation",E,!1)};a.dB=function(a){ca=a};a.eB=function(a){ia=a};a.hB=function(a){t=a};a.gB=function(a){K=a}};b4w.module.__curve=function(a,p){function c(a,b,c,d,l){var h=d.length;l||(l=new Float32Array(h));for(var q=h+a,w=new Float32Array(q),v=1;v<=q-1;v++)w[v-1]=b>=c[v-1]&&b<c[v+1-1]?1:0;for(var E=2;E<=a;E++)for(v=1;v<=q-E;v++)w[v-1]=(0!=w[v-1]?(b-c[v-1])*w[v-1]/(c[v+E-1-1]-c[v-1]):0)+(0!=w[v+1-1]?(c[v+E-1]-b)*w[v+1-1]/(c[v+E-1]-c[v+1-1]):0);b==c[q-1]&&(w[h-1]=1);a=0;for(v=1;v<=h;v++)a+=w[v-1]*d[v-1];for(v=1;v<=h;v++)l[v-1]=0!=a?w[v-1]*d[v-1]/a:0;return l}function b(a){a=a.Fj;return a[a.length-1]}function h(a){a=
a.Ko;return a[a.length-1]}var d=p("__util");a.ov=function(a){var b={},d=a.data;a=d.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var h=a.order_u;b.ue=h;a=a.points;var l=a.length/5,r=[],q=l+h,l=l+2;r[0]=0;for(var w=2;w<=q;w++)r[w-1]=w>h&&w<l?r[w-2]+1:r[w-2];b.Fj=r;if("2D"==d.dimensions)b.qe=!1;else if("3D"==d.dimensions)b.qe=!0;else throw"Wrong curve dimensions";h=[];r=[];for(d=0;d<a.length;d+=5)h.push(a[d]),h.push(a[d+1]),h.push(a[d+2]),b.qe&&h.push(a[d+3]),r.push(a[d+4]);b.al=
h;b.qn=r;a=[];for(var d=b.al,h=b.qe?4:3,r=b.qn,q=b.Fj,l=b.ue,w=d.length/h,v=w+l,E=0,B=q[v-1]/999,x=0;1E3>x;x++){5E-6>q[v-1]-E&&(E=q[v-1]);for(var n=c(l,E,q,r),e=0;e<h;e++)for(var H=a[h*x+e]=0;H<w;H++)a[h*x+e]+=n[H]*d[h*H+e];E+=B}h=b.qe?4:3;r=new Float32Array(1E3);r[0]=0;for(d=1;1E3>d;d+=1)q=a[(d-1)*h],l=a[(d-1)*h+1],w=a[(d-1)*h+2],v=a[d*h],E=a[d*h+1],B=a[d*h+2],r[d]=r[d-1]+Math.sqrt((v-q)*(v-q)+(E-l)*(E-l)+(B-w)*(B-w));b.Ko=r;return b};a.zz=function(a,d,g){g||(g=[]);var h=d,l=Math.max(h,0);d=l=Math.min(h,
b(a));var h=a.al,l=a.qe?4:3,r=a.qn,q=a.Fj,w=a.ue;a=h.length/l;var v=a+w;5E-6>q[v-1]-d&&(d=q[v-1]);v=new Float32Array(a);c(w,d,q,r,v);for(d=0;d<l;d++)for(r=g[d]=0;r<a;r++)g[d]+=v[r]*h[l*r+d]};a.wz=function(a,b,c){c||(c=[]);var d=a.al,l=a.qe?4:3,h=a.qn,q=a.Fj,w=a.ue;a=d.length/l;var v=a+w;5E-6>q[v-1]-b&&(b=q[v-1]);var v=new Float32Array(a),E=b;b=v;var B=h.length;b||(b=new Float32Array(B));var x=new Float32Array(B),n=new Float32Array(B),e=x,H=n;e||(e=new Float32Array(B));H||(H=new Float32Array(B));for(var G=
B+w,y=new Float32Array(G),A=new Float32Array(G),D=1;D<=G-1;D++)y[D-1]=E>=q[D-1]&&E<q[D+1-1]?1:0;E==q[G-1]&&(y[B-1]=1);for(var L=2;L<=w;L++)for(D=1;D<=G-L;D++){var C=0!=y[D-1]?y[D-1]/(q[D+L-1-1]-q[D-1]):0,I=0!=y[D+1-1]?-y[D+1-1]/(q[D+L-1]-q[D+1-1]):0,J=0!=A[D-1]?(E-q[D-1])*A[D-1]/(q[D+L-1-1]-q[D-1]):0,Q=0!=A[D+1-1]?(q[D+L-1]-E)*A[D+1-1]/(q[D+L-1]-q[D+1-1]):0;y[D-1]=(0!=y[D-1]?(E-q[D-1])*y[D-1]/(q[D+L-1-1]-q[D-1]):0)+(0!=y[D+1-1]?(q[D+L-1]-E)*y[D+1-1]/(q[D+L-1]-q[D+1-1]):0);A[D-1]=C+I+J+Q}for(D=1;D<=
B;D++)e[D-1]=y[D-1],H[D-1]=A[D-1];q=0;for(w=1;w<=B;w++)q+=x[w-1]*h[w-1];E=0;for(w=1;w<=B;w++)E+=n[w-1]*h[w-1];for(w=1;w<=B;w++)b[w-1]=0!=q?n[w-1]*h[w-1]/q+x[w-1]*h[w-1]*E/(q*q):0;for(h=0;h<l;h++)for(q=c[h]=0;q<a;q++)c[h]+=v[q]*d[l*q+h]};a.gD=b;a.yz=h;a.xz=function(a,c){if(0>=c)return 0;var g=b(a);if(c>=h(a))return g;var m=a.Ko,l=d.Ui(m,c,0,m.length-1);return g*(l+(c-m[l])/(m[l+1]-m[l]))/1E3}};b4w.module.__dds=function(a,p){function c(a,b,c,d){var g=new Uint16Array(4),l=new Uint16Array(c*d),x=0,n=0,e=0,h=n=x=0,f=0,k=0,m=0,D=c/4;d/=4;for(var L=0;L<d;L++)for(var C=0;C<D;C++)e=b+4*(L*D+C),g[0]=a[e],g[1]=a[e+1],x=g[0]&31,n=g[0]&2016,h=g[0]&63488,f=g[1]&31,k=g[1]&2016,m=g[1]&63488,g[2]=5*x+3*f>>3|5*n+3*k>>3&2016|5*h+3*m>>3&63488,g[3]=5*f+3*x>>3|5*k+3*n>>3&2016|5*m+3*h>>3&63488,x=a[e+2],n=4*L*c+4*C,l[n]=g[x&3],l[n+1]=g[x>>2&3],l[n+2]=g[x>>4&3],l[n+3]=g[x>>6&3],n+=c,l[n]=g[x>>8&3],l[n+1]=g[x>>
10&3],l[n+2]=g[x>>12&3],l[n+3]=g[x>>14],x=a[e+3],n+=c,l[n]=g[x&3],l[n+1]=g[x>>2&3],l[n+2]=g[x>>4&3],l[n+3]=g[x>>6&3],n+=c,l[n]=g[x>>8&3],l[n+1]=g[x>>10&3],l[n+2]=g[x>>12&3],l[n+3]=g[x>>14];return l}function b(a,b,d,h){var E=new Int32Array(d,0,31),B,x,n,e,H,G;if(542327876!=E[0])return k.error("Invalid magic number in DDS header"),0;if(!E[20]&4)return k.error("Unsupported format, must contain a FourCC code"),0;B=E[21];switch(B){case g:x=8;n=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case m:x=16;n=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case l:x=16;n=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return k.error("Unsupported FourCC code:",f(B)),null}G=1;E[2]&131072&&!1!==h&&(G=Math.max(1,E[7]));e=E[4];H=E[3];E=E[1]+4;if(b)for(B=0;B<G;++B)h=Math.max(4,e)/4*Math.max(4,H)/4*x,b=new Uint8Array(d,E,h),a.compressedTexImage2D(a.TEXTURE_2D,B,n,e,H,0,b),E+=h,e=Math.max(.5*e,1),H=Math.max(.5*H,1);else if(B==g)Math.max(4,e),Math.max(4,H),b=new Uint16Array(d),d=c(b,E/2,e,H),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,e,H,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,d),h&&a.generateMipmap(a.TEXTURE_2D);else return k.error("No manual decoder for",f(B),"and no native support"),0;return G}function h(a,c,d,g,l,h){var x=new XMLHttpRequest;x.open("GET",d,!0);x.responseType="arraybuffer";x.onload=function(){if(200==x.status){a.bindTexture(a.TEXTURE_2D,g);var d=b(a,c,x.response,l);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}h&&
h(g)};x.send(null);return g}function d(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function f(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var k=p("__print"),g=d("DXT1"),m=d("DXT3"),l=d("DXT5");a.JB=c;a.oA=b;a.Cp=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.Gw=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case g:b=6;break;case m:case l:b=4;break;default:k.error("Unsupported FourCC code:",f(a))}return b};
a.KC=h;a.JC=function(a,b,c,d){var g=a.createTexture();h(a,b,c,g,!0,d);return g}};b4w.module.__debug=function(a,p){function c(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function b(a,b){typeof a!=typeof b&&k.la("Structure assertion failed: incompatible types");for(var c in a)c in b||k.la("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||k.la("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&k.la("Structure assertion failed: incompatible types for key "+c)}var h=
p("__extensions"),d=p("__print"),f=p("__textures"),k=p("__util"),g=null,m={},l=!1,r={},q=[],w=-1,v=null,E=!1;a.Bn={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.gc=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(m[a[d]]=d)}g=a};a.Eu=function(a){if(l){var b=g.getError();b!=g.NO_ERROR&&(b in m?k.la("GL Error: "+b+", gl."+m[b]+" ("+
a+")"):k.la("Unknown GL error: "+b+" ("+a+")"))}};a.Au=function(){if(l)switch(g.checkFramebufferStatus(g.FRAMEBUFFER)){case g.FRAMEBUFFER_COMPLETE:break;case g.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:d.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case g.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:d.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case g.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:d.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case g.FRAMEBUFFER_UNSUPPORTED:d.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:d.error("FRAMEBUFFER CHECK FAILED")}};a.Cu=function(){if(-1!=w)return w;g.bindFramebuffer(g.FRAMEBUFFER,g.createFramebuffer());var a=f.hj("DEBUG",f.vh);f.resize(a,1,1);g.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,a.Cb,a.Oa,0);g.checkFramebufferStatus(g.FRAMEBUFFER)!=g.FRAMEBUFFER_COMPLETE?(w=!0,d.warn("depth-only issue was found")):w=!1;g.bindFramebuffer(g.FRAMEBUFFER,null);return w};
a.Fu=function(a,b,e){if(l&&!g.getShaderParameter(a,g.COMPILE_STATUS))throw e=c(e),d.error("shader compilation failed:\n"+e+"\n"+g.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.Gu=function(a,b,e,f,k,m){if(l&&!g.getProgramParameter(a,g.LINK_STATUS)){var q=h.rp();q&&(k=q.getTranslatedShaderSource(e),m=q.getTranslatedShaderSource(f));k=c(k);m=c(m);d.error("shader linking failed:\n"+k+"\n\n\n"+m+"\n"+g.getProgramInfoLog(a)+" ("+b+")");throw"Engine failed: see above for error messages";
}};a.set_check_gl_errors=function(a){l=a};a.KB=function(a){r[a]=a in r?r[a]+1:1};a.update=function(){for(var a in r)d.log(a,r[a]),r[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(k.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}q.push(a)};a.msg=function(){for(var a=1,b=0;b<q.length;b++){var c=q[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],k.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);
else c.push(arguments[b]);q.push(c)};var B=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},g=Math.max(0,performance.now()-1E3*a),l=0;l<q.length;l++){var h=q[l];a=h[0];if(!(a<g)){var f=String(h[1]);c[f]||(c[f]=B[b++%B.length]);a=["%c"+(a/1E3).toFixed(6),c[f],f];for(f=2;f<h.length;f++)a.push(h[f]);d.log.apply(this,a)}}q.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-
1E3*a),g=0;g<q.length;g++){var l=q[g];a=l[0];if(!(a<c))for(var h=2;h<l.length;h++){var f=String(l[1]);3<l.length&&(f+="_"+String(h-2));b[f]||(b[f]=f+"\n");b[f]+=String(a)+" "+l[h]+"\n"}}a="";for(f in b)a+=b[f]+"\n\n";d.log(a);q.splice(0)};a.oB=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&
b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(k.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.cB=function(a,b){typeof a!=b&&k.la("Type assertion failed: value type is not a {"+b+"}:",a)};a.aB=b;a.bB=function(a){E?b(a,v):E=!0;v=a}};b4w.module.__extensions=function(a,p){function c(a){if(a in d)return d[a];var c=h.getExtension(a)||null;d[a]=c;b.log("%cGET EXTENSION","color: #"+(c?"0a0":"a00"),a);return c}var b=p("__print"),h=null,d={};a.gc=function(a){h=a};a.xp=function(){return c("WEBGL_compressed_texture_s3tc")||c("WEBKIT_WEBGL_compressed_texture_s3tc")||c("MOZ_WEBGL_compressed_texture_s3tc")};a.Jw=function(){return c("WEBGL_depth_texture")||c("WEBKIT_WEBGL_depth_texture")||c("MOZ_WEBGL_depth_texture")};a.Aw=function(){return c("EXT_texture_filter_anisotropic")||
c("WEBKIT_EXT_texture_filter_anisotropic")||c("MOZ_EXT_texture_filter_anisotropic")};a.rp=function(){return c("WEBGL_debug_shaders")};a.wp=function(){return c("WEBGL_debug_renderer_info")};a.sp=function(){return c("OES_element_index_uint")};a.Uw=function(){return c("OES_standard_derivatives")};a.cleanup=function(){d={}}};b4w.module.__graph=function(a){function p(a,b,d){d||(d=null);if(c(a,b))throw"Graph already has node with given ID";a.Da.push(b,d)}function c(a,b){for(var c=a.Da,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function b(a,b,d,e){e||(e=null);if(c(a,b)&&c(a,d))a.ha.push(b,d,e);else throw"Wrong node IDs";}function h(a,b){if(!c(a,b))throw"Node not found";for(var d=a.Da,e=0;e<d.length;e+=2)d[e]==b&&(d.splice(e,2),e-=2)}function d(a){a=a.Da;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}
function f(a,b){for(var c=a.Da,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function k(a){var b=[],c={};g(a,c);for(var d=a.Da,e=0;e<d.length;e+=2)0==n(a,d[e])&&m(a,d[e],c,b);return{Da:b,ha:a.ha.slice(0)}}function g(a,b){for(var c=a.Da,d=0;d<c.length;d+=2)b[c[d]]=!1}function m(a,b,c,d){if(!c[b]){c[b]=!0;for(var g=0;g<x(a,b);g++)m(a,e(a,b,g),c,d);d.unshift(b,B(a,b))}}function l(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var g=0;g<x(a,b);g++){var u=e(a,b,g);l(a,u,c,d)}if(20==d||30==d)for(g=
0;g<n(a,b);g++)u=H(a,b,g),l(a,u,c,d)}}function r(a){var b=a.Da;a=a.ha;for(var c=[],d=[],e=[],u=0;u<b.length;u++)e[b[2*u]]=u,c.push(u,b[2*u+1]);for(u=0;u<a.length;u+=3)d.push(e[a[u]],e[a[u+1]],a[u+2]);return{Da:c,ha:d}}function q(a,b,c){if(c.Rc==c.te){for(var d=0,g=0;d<c.te;d++)-1!=c.Dd[d]&&(a[g]=d,b[g]=c.Dd[d],g++);return!0}if(c.te>c.Ng||c.He>c.Ie||c.kh>c.mh||c.jh>c.lh)return!1;for(var g=d=-1,u=!1;!u&&w(c,L,d,g);)if(d=L[0],g=L[1],v(c,d,g)){var l;l=c;u={};u.Ph=l.Ph;u.Qh=l.Qh;u.qm=l.qm;u.nj=l.nj;u.te=
l.te;u.Ng=l.Ng;u.ue=l.ue;u.Rc=u.Qj=l.Rc;u.jh=l.jh;u.kh=l.kh;u.He=l.He;u.lh=l.lh;u.mh=l.mh;u.Ie=l.Ie;u.yh=-1;u.Dd=l.Dd;u.cf=l.cf;u.pf=l.pf;u.qf=l.qf;u.If=l.If;u.Jf=l.Jf;u.dk=l.dk;l.dk[0]+=1;var u=l=u,h=d,f=g,k=u.Ph,m=u.Qh,r=u.te,B=u.Ng,A=u.Dd,y=u.cf,D=u.pf,G=u.qf,p=u.If,ea=u.Jf;E(h<r);E(f<B);E(u.Rc<r);E(u.Rc<B);r=++u.Rc;u.yh=h;D[h]||(D[h]=r,u.jh++,p[h]&&u.He++);p[h]||(p[h]=r,u.kh++,D[h]&&u.He++);G[f]||(G[f]=r,u.lh++,ea[f]&&u.Ie++);ea[f]||(ea[f]=r,u.mh++,G[f]&&u.Ie++);A[h]=f;y[f]=h;for(A=0;A<n(k,h);A++)y=
H(k,h,A),D[y]||(D[y]=r,u.jh++,p[y]&&u.He++);for(A=0;A<x(k,h);A++)y=e(k,h,A),p[y]||(p[y]=r,u.kh++,D[y]&&u.He++);for(A=0;A<n(m,f);A++)y=H(m,f,A),G[y]||(G[y]=r,u.lh++,ea[y]&&u.Ie++);for(A=0;A<x(m,f);A++)y=e(m,f,A),ea[y]||(ea[y]=r,u.mh++,G[y]&&u.Ie++);u=q(a,b,l);E(1>=l.Rc-l.Qj);E(-1!=l.yh);y=l.Ph;h=l.Qh;f=l.Rc;k=l.yh;m=l.Dd;D=l.cf;r=l.pf;G=l.qf;B=l.If;p=l.Jf;if(l.Qj<f){r[k]==f&&(r[k]=0);for(ea=0;ea<n(y,k);ea++)A=H(y,k,ea),r[A]==f&&(r[A]=0);B[k]==f&&(B[k]=0);for(ea=0;ea<x(y,k);ea++)A=e(y,k,ea),B[A]==f&&
(B[A]=0);y=m[k];G[y]==f&&(G[y]=0);for(ea=0;ea<n(h,y);ea++)A=H(h,y,ea),G[A]==f&&(G[A]=0);p[y]==f&&(p[y]=0);for(ea=0;ea<x(h,y);ea++)A=e(h,y,ea),p[A]==f&&(p[A]=0);m[k]=-1;D[y]=-1;l.Rc=l.Qj;l.yh=-1}}return u}function w(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var e=a.He,u=a.Ie,g=a.kh,n=a.mh,l=a.jh,h=a.lh,f=a.Rc,x=a.te,k=a.Ng,m=a.Dd,q=a.cf,r=a.pf,E=a.qf,v=a.If,w=a.Jf;if(e>f&&u>f)for(;c<x&&(-1!=m[c]||0==v[c]||0==r[c]);)c++,d=0;else if(g>f&&n>f)for(;c<x&&(-1!=m[c]||0==v[c]);)c++,d=0;else if(l>f&&h>f)for(;c<x&&
(-1!=m[c]||0==r[c]);)c++,d=0;else if(0==c&&0!=a.ue){for(r=0;r<x&&-1!=m[c=a.ue[r]];)r++;r==x&&(c=x)}else for(;c<x&&-1!=m[c];)c++,d=0;if(e>f&&u>f)for(;d<k&&(-1!=q[d]||0==w[d]||0==E[d]);)d++;else if(g>f&&n>f)for(;d<k&&(-1!=q[d]||0==w[d]);)d++;else if(l>f&&h>f)for(;d<k&&(-1!=q[d]||0==E[d]);)d++;else for(;d<k&&-1!=q[d];)d++;return c<x&&d<k?(b[0]=c,b[1]=d,!0):!1}function v(a,b,c){var d=a.Ph,g=a.Qh,u=a.Ng,l=a.Dd,h=a.cf,f=a.pf,k=a.qf,m=a.If,q=a.Jf;E(b<a.te);E(c<u);E(-1==l[b]);E(-1==h[c]);if(!(0,a.qm)(B(d,
b),B(g,c)))return!1;for(var r=u=0,v=0,w=0,A=0,L=0,D=0;D<x(d,b);D++){var p=e(d,b,D);if(-1!=l[p]){var O=l[p];if(!G(g,c,O)||!y(a.nj,d,b,p,g,c,O))return!1}else f[p]&&v++,m[p]&&u++,f[p]||m[p]||A++}for(D=0;D<n(d,b);D++)if(p=H(d,b,D),-1!=l[p]){if(O=l[p],!G(g,O,c)||!y(a.nj,d,p,b,g,O,c))return!1}else f[p]&&v++,m[p]&&u++,f[p]||m[p]||A++;for(D=0;D<x(g,c);D++)if(O=e(g,c,D),-1!=h[O]){if(p=h[O],!G(d,b,p))return!1}else k[O]&&w++,q[O]&&r++,k[O]||q[O]||L++;for(D=0;D<n(g,c);D++)if(O=H(g,c,D),-1!=h[O]){if(p=h[O],!G(d,
p,b))return!1}else k[O]&&w++,q[O]&&r++,k[O]||q[O]||L++;return v<=w&&u<=r&&A<=L}function E(a){if(!a)throw"Assertion failed";}function B(a,b){for(var c=a.Da,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function x(a,b){for(var c=a.ha,d=0,e=0;e<c.length;e+=3)c[e]==b&&d++;return d}function n(a,b){for(var c=a.ha,d=0,e=0;e<c.length;e+=3)c[e+1]==b&&d++;return d}function e(a,b,c){a=a.ha;for(var d=0,e=0;e<a.length;e+=3)if(a[e]==b){if(d==c)return a[e+1];d++}return-1}function H(a,b,c){a=a.ha;for(var d=
0,e=0;e<a.length;e+=3)if(a[e+1]==b){if(d==c)return a[e];d++}return-1}function G(a,b,c){a=a.ha;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function y(a,b,c,d,e,u,g){for(var n=A(b,c,d),l=A(e,u,g),h=0;h<n;h++){for(var f=!1,x=0;x<l;x++)if(a(D(b,c,d,h),D(e,u,g,x))){f=!0;break}if(!f)return!1}return!0}function A(a,b,c){var d=0;a=a.ha;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&d++;return d}function D(a,b,c,d){a=a.ha;for(var e=0,u=0;u<a.length;u+=3)if(a[u]==b&&a[u+1]==c){if(e==
d)return a[u+2];e++}return null}var L=[-1,-1];a.xn=-1;a.SA=10;a.tn=20;a.WA=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var e=a[d];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:c.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{Da:b,ha:c}};a.BB=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)d.push(b[e][0],b[e][1],b[e][2]);return{Da:c,ha:d}};a.Ek=p;a.nC=c;a.de=b;a.ni=h;a.Sg=function(a,
b,c,d){if(!G(a,b,c))throw"Edge not found";a=a.ha;for(var e=0,u=0;u<a.length;u+=3)if(a[u]==b&&a[u+1]==c){if(-1==d)a.splice(u,3);else{if(d==e){a.splice(u,3);break}e++}u-=3}};a.A=function(a,b){if(-1==f(a,b)){var c=d(a);p(a,c,b);return c}throw"Non-unique attribute";};a.yy=function(a,b,c,d,e){a=a.ha;for(var u=0;u<a.length;u+=3)a[u]==b&&a[u+1]==c&&a[u+2]==d&&(a[u+2]=e)};a.lp=d;a.Og=f;a.m=function(a,c,d,e){c=f(a,c);d=f(a,d);if(-1!=c&&-1!=d)b(a,c,d,e);else throw"Attributes not found";};a.P=function(a,b){for(var c=
a.Da,d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};a.Ke=function(a,b){for(var c=a.ha,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.Vd=function(a,b,c){for(var d=a.ha,e=0;e<d.length;e+=3)if(d[e+1]==b){var u=d[e];if(c(u,B(a,u),d[e+2]))break}};a.Le=function(a,b,c){for(var d=a.ha,e=0;e<d.length;e+=3)if(d[e]==b){var u=d[e+1];if(c(u,B(a,u),d[e+2]))break}};a.$m=k;a.Pz=function(a){a=k(a).Da;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.yC=function(){};a.Ir=function(a,b,d){if(!c(a,b))throw"No such node";
var e={};g(a,e);l(a,b,e,d);b=[];for(var n in e)e[n]&&(n=Number(n),b.push(n,B(a,n)));a={Da:b,ha:a.ha.slice(0)};e=a.ha;for(n=0;n<e.length;n+=3)b=e[n+1],c(a,e[n])&&c(a,b)||(e.splice(n,3),n-=3);return a};a.Tw=function(a){for(var b=[],c=a.Da,d=0;d<c.length;d+=2){var e=c[d];n(a,e)||b.push(e)}return b};a.zp=function(a){for(var b=[],c=a.Da,d=0;d<c.length;d+=2){var e=c[d];x(a,e)||b.push(e)}return b};a.match=function(a,b,c,d){var e={};e.Ph=r(a);e.Qh=r(b);e.qm=c||function(a,b){return a==b};e.nj=d||function(a,
b){return a==b};d=a.Da.length/2;var u=b.Da.length/2;e.te=d;e.Ng=u;e.ue=0;e.Rc=e.Qj=0;e.He=e.jh=e.kh=0;e.Ie=e.lh=e.mh=0;e.yh=-1;e.Dd=Array(d);e.cf=Array(u);e.pf=Array(d);e.qf=Array(u);e.If=Array(d);e.Jf=Array(u);e.dk=[1];for(c=0;c<d;c++)e.Dd[c]=-1,e.pf[c]=0,e.If[c]=0;for(c=0;c<u;c++)e.cf[c]=-1,e.qf[c]=0,e.Jf[c]=0;u=Array(d);d=Array(d);if(q(u,d,e)){for(c=0;c<u.length;c++)u[c]=a.Da[2*u[c]],d[c]=b.Da[2*d[c]];return[u,d]}return null};a.cb=B;a.Qg=x;a.Rp=n;a.zg=e;a.qj=H;a.dC=A;a.yg=D;a.replace=function(a,
b,c){for(var e=a.ha,g=d(a),u=0;u<b.length;u++){var n=b[u];h(a,n);for(var l=0;l<e.length;l+=3)e[l]==n&&(e[l]=g),e[l+1]==n&&(e[l+1]=g),e[l]==e[l+1]&&(e.splice(l,3),l-=3)}p(a,g,c)};a.py=function(a,b,c,d,e){if(!G(a,b,c))throw"Edge not found";a=a.ha;for(var u=0;u<a.length;u+=3)a[u]==b&&a[u+1]==c&&(a[u]=d,a[u+1]=e)};a.CB=function(a,b){var c=a.Da,d=a.ha,e;e="digraph debug {\n    node [shape=box];\n";for(var u=0;u<c.length;u+=2){var g=c[u],n=c[u+1],n=b?b(g,n):String(g);e+="    ";e+=String(g)+' [label="'+
n.replace(/\"/g,'\\"')+'"];\n'}for(u=0;u<d.length;u+=3)c=d[u],g=d[u+1],e+="    ",e+=String(c)+" -> "+String(g)+";\n";return e+="}"}};b4w.module.__ipc=function(a){var p=a.ts=0;a.us=1;a.vs=2;a.ws=3;a.xs=4;a.ys=5;var c=a.As=6,b=a.Bs=7,h=a.Cs=8;a.Ds=9;a.zs=10;a.bt=11;a.Nc=12;a.Es=13;a.Fs=14;a.Gs=15;a.Is=16;a.Hs=17;a.Js=18;a.Ks=19;a.Ls=20;a.Ms=21;a.Ns=22;a.Os=23;a.Ps=24;a.Qs=25;a.Rs=26;a.Ss=27;a.Ts=28;a.Us=29;a.Vs=30;a.Ws=31;a.Xs=32;a.Ys=33;a.$s=34;a.at=35;a.ct=36;a.zn=37;a.dt=38;a.et=39;a.ft=40;a.gt=41;a.ht=42;a.it=43;a.jt=44;a.kt=45;a.lt=46;a.mt=47;a.nt=48;a.ot=49;a.pt=50;a.An=51;var d=a.eg=52;a.qt=53;a.yn=54;a.rt=55;a.st=56;a.UA=
57;a.Zs=58;for(var f=null,k=[],g=[],m=[],l=[],r=0;59>r;r++)k.push(null),g.push(null),m.push(null),l.push(null);g[h]={msg_id:0,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3)};g[c]={msg_id:0,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4)};g[b]={msg_id:0,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0};g[p]={msg_id:0,body_id_a:0,body_id_b:0,result:0,
coll_point:new Float32Array(3)};g[d]={msg_id:0,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4)};l[h]=["msg_id",1,"body_id",1,"time",1,"trans",3,"quat",4,"linvel",3,"angvel",3];l[c]=["msg_id",1,"chassis_hull_body_id",1,"prop_ind",1,"trans",3,"quat",4];l[b]=["msg_id",1,"body_id",1,"from",3,"to",3,"local",1,"body_id_b_hit",1,"cur_result",1];l[p]=["msg_id",1,"body_id_a",1,"body_id_b",1,"result",1,"coll_point",3];l[d]=["msg_id",1,"body_id",1,"trans",3,"quat",4];a.init=function(a,b){a.addEventListener("message",
function(a){var c=a.data;a=c[0]|0;if(l[a]){for(var d=g[a],h=l[a],n=0,e=0;e<h.length;e+=2){var f=h[e],k=h[e+1];if(1==k)d[f]="msg_id"==f||"body_id"==f||"body_id_a"==f||"body_id_b"==f?c[n]|0:c[n];else for(var m=0;m<k;m++)d[f][m]=c[n+m];n+=k}c=d}b(a,c)},!1);f=a};a.cleanup=function(){f=null};a.r=function(){var a=arguments[0]|0;if(l[a]){var b=g[a],c=l[a],d=0;if(!m[a]){for(var h=0,x=1;x<c.length;x+=2)h+=c[x];m[a]=new Float32Array(h)}h=m[a];for(x=0;x<c.length;x+=2){var n=b[c[x]],e=c[x+1];1==e?h[d]=n:h.set(n,
d);d+=e}k[a]||(k[a]=h);a=k[a]}else for(b=arguments.length,k[a]||(k[a]=Array(b),k[a][0]=a),a=k[a],c=1;c<b;c++)a[c]=arguments[c];f.postMessage(a)};a.up=function(a){return g[a]}};b4w.module.__hud=function(a,p){function c(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function b(a){h(' SCENE "'+a.name+'"');if(a.d){var b=0,c=0;g.P(a.d.ob,function(a,d){if("SINK"==d.type)h(" (F)",d.type);else{var g=d.type,l=Math.round(d.j.width)+"x"+Math.round(d.j.height),n=d.p.length,e=d.Fh,f=d.enqueue&&d.U;f?h(" (A)",g,d.Ff,l,e,"of",n):h(" (P)",g,d.Ff,l,e,"of",n);d.Fh=0;f&&(b+=n,c+=e)}});return[b,c]}h("No INFO")}function h(){for(var a=80+20*l[0],b=[5,
18,3,10,4,3,5],c=arguments[0],d=1;d<arguments.length;d++){for(var g="",h=0;h<b[d]-String(arguments[d]).length;h++)g+=" ";c+=g+arguments[d]}l[0]++;m.fillText(c,30,a)}function d(a,b,c){b*=a.xa;c.x=a.x+b;c.y=a.y;c.xa=a.xa-2*b;c.oa=a.oa}function f(a){return a.x+a.xa/2}function k(a){var b=m,c={x:0,y:0,xa:0,oa:0},g=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.xa=g;c.oa=b;d(c,.01,c);g=.02*c.oa;c.x=c.x;c.y+=g;c.xa=c.xa;c.oa-=2*g;g=c.xa/8;c.x+=g*a;c.y=c.y;c.xa=g;c.oa=c.oa;d(c,.02,c);return c}var g=p("__graph"),
m=null,l=[0,0];a.init=function(a){a=a.getContext("2d");c(a);return m=a};a.ph=function(){m&&c(m)};a.reset=function(){var a=m;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),l[0]=0,l[1]=0)};a.iz=function(a,c){var d=m;if(d){d.textAlign="left";d.fillStyle="rgba(0,255,0,255)";h(" FPS",(1/c).toFixed(2));l[0]++;for(var g=d=0,f=0;f<a.length;f++){var k=b(a[f]),d=d+k[0],g=g+k[1];l[0]++}h(" ---------------------------------------------");
h("    ","TOTAL ACTIVE","","",g,"of",d)}};a.print=function(){var a=m;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",h.apply(Math,arguments))};a.plot_array=function(a,b,c,d,g,l,h){var n=m;if(n){b=k(b);var e=b.oa/5;b.x=b.x;b.y+=4*e;b.xa=b.xa;b.oa=e;n.textAlign="center";n.fillStyle="#00FF00";m.fillText(a,f(b),b.y-10);n.strokeStyle="#00FF00";n.lineWidth=.5;n.beginPath();n.moveTo(b.x,b.y);n.lineTo(b.x+b.xa,b.y);n.lineTo(b.x+b.xa,b.y+b.oa);n.lineTo(b.x,b.y+b.oa);n.closePath();n.stroke();if(!l&&
!h)for(l=1E6,h=-1E6,a=0;a<c.length;a++)l=Math.min(l,c[a]),h=Math.max(h,c[a]);n.textAlign="right";m.fillText(String(l),b.x-10,b.y+b.oa);m.fillText(String(h),b.x-10,b.y);n.textAlign="center";m.fillText(String(d),b.x,b.y+b.oa+15);m.fillText(String(g),b.x+b.xa,b.y+b.oa+15);n.strokeStyle="#FF0000";n.lineWidth=1.5;n.beginPath();d=b.xa/(c.length-1);h=b.oa/(h-l);for(a=0;a<c.length;a++)g=b.x+d*a,e=b.y+b.oa-(c[a]-l)*h,0==a?n.moveTo(g,e):n.lineTo(g,e);n.stroke()}};a.draw_mixer_strip=function(a,b,c,d,g,l,h){var n=
m;if(n)for(n.textAlign="center",n.fillStyle="#00FF00",n.font="bold 12px Courier",c=k(c),m.fillText(b?"["+a+"]":a,f(c),c.y),0<=l&&m.fillText(l?"[M]":"[ ]",f(c)-15,c.y+30),0<=h&&m.fillText(h?"[S]":"[ ]",f(c)+15,c.y+30),a={x:0,y:0,xa:0,oa:0},b=0;b<d.length;b++){l=d[b];var e="VOLUME"==l[0];if(e){h=c.y+350;var H=c.xa,G=a;G.x=c.x;G.y=h;G.xa=H;G.oa=250}else{h=c.y+10+50*b;var H=c.xa,G=c.oa,y=a;y.x=c.x;y.y=h;y.xa=H;y.oa=G}h=n;var H=a,y=b==g,A=l[0],G=l[1],D=l[2],L=l[3],C=(L-D)/l[4],C=1>C?Math.floor(1/C-1E-5).toFixed(0).length:
0;l=l[5]?Math.log(G/D)/Math.log(L/D):(G-D)/(L-D);h.textAlign="center";y?h.fillText("["+A+"]",f(H),H.y):h.fillText(A,f(H),H.y);h.strokeStyle="#00FF00";h.lineWidth=e?3:1;e?(h.textAlign="right",h.fillText(L.toFixed(C),f(H)-10,H.y+15),h.textAlign="right",h.fillText(D.toFixed(C),f(H)-10,H.y+H.oa-15)):(h.textAlign="right",h.fillText(D.toFixed(C),H.x+28,H.y+15),h.textAlign="left",h.fillText(L.toFixed(C),H.x+H.xa-28,H.y+15));h.beginPath();if(e){var I=H.y+15+(H.oa-30)*(1-l);h.moveTo(f(H),H.y+15);h.lineTo(f(H),
H.y+H.oa-15);h.moveTo(f(H)-5,H.y+15);h.lineTo(f(H)+5,H.y+15);h.moveTo(f(H)-5,H.y+H.oa-15);h.lineTo(f(H)+5,H.y+H.oa-15);h.moveTo(f(H)-5,I);h.lineTo(f(H)+5,I)}else{var J=H.x+30+(H.xa-60)*l;h.moveTo(H.x+30,H.y+15);h.lineTo(H.x+H.xa-30,H.y+15);h.moveTo(H.x+30,H.y+15-5);h.lineTo(H.x+30,H.y+15+5);h.moveTo(H.x+H.xa-30,H.y+15-5);h.lineTo(H.x+H.xa-30,H.y+15+5);h.moveTo(J,H.y+15-5);h.lineTo(J,H.y+15+5)}h.stroke();"EQ_Q"==A?(l=Math.log(1+1/(2*G*G)+Math.sqrt((2+1/(G*G))*(2+1/(G*G))/4-1))/Math.log(2),e?(h.textAlign=
"left",h.fillText(G.toFixed(C),f(H)+10,I),h.textAlign="left",h.fillText("("+l.toFixed(C+1)+")",f(H)+10,I+10)):(h.textAlign="right",h.fillText(G.toFixed(C),J,H.y+30),h.textAlign="left",h.fillText("("+l.toFixed(C+1)+")",J,H.y+30))):e?(h.textAlign="left",h.fillText(G.toFixed(C),f(H)+10,I)):(h.textAlign="center",h.fillText(G.toFixed(C),J,H.y+30))}}};b4w.module.__renderer=function(a,p){function c(a){if(a){var b=(a.da?B.COLOR_BUFFER_BIT:0)|(a.ga?B.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=r;break;case "DEPTH":a=q;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=w;break;case "GLOW_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=v;break;default:a=l.background_color}}else b=B.COLOR_BUFFER_BIT|B.DEPTH_BUFFER_BIT,a=l.background_color;B.colorMask(!0,!0,!0,!0);B.depthMask(!0);
B.clearColor(a[0],a[1],a[2],a[3]);B.clear(b)}function b(a,b,c){B.bindBuffer(B.ARRAY_BUFFER,a.$f);for(var d=0;d<b.length;d++){var g=b[d];B.enableVertexAttribArray(g.zf);B.vertexAttribPointer(g.zf,g.Zc,B.FLOAT,!1,0,g.iu+g.ew*c)}a.Md?(B.bindBuffer(B.ELEMENT_ARRAY_BUFFER,a.Md),B.drawElements(a.mode,a.count,a.Pl,0)):B.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)g=b[d],B.disableVertexAttribArray(g.zf)}function h(a){switch(a){case 0:return B.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return B.TEXTURE_CUBE_MAP_NEGATIVE_X;
case 2:return B.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return B.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return B.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return B.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function d(a){var b=a.wi,c=[],d=[],g={},l;for(l in b){var h=!1;switch(l){case "u_proj_matrix":var f=function(a,b,c,d,e,u){a.uniformMatrix4fv(b,!1,u.pa)},h=!0;break;case "u_view_matrix":case "u_view_matrix_frag":f=function(a,b,c,d,e,u){a.uniformMatrix4fv(b,!1,u.ka)};h=!0;break;case "u_shadow_cast_billboard_view_matrix":f=function(a,
b,c,d,e,u){a.uniformMatrix4fv(b,!1,u.sr)};h=!0;break;case "u_view_proj_prev":f=function(a,b,c,d,e,u){a.uniformMatrix4fv(b,!1,u.ky)};h=!0;break;case "u_view_proj_inverse":f=function(a,b,c,d,e,u){a.uniformMatrix4fv(b,!1,u.rh)};h=!0;break;case "u_sky_vp_inverse":f=function(a,b,c,d,e,u){a.uniformMatrix4fv(b,!1,u.dd)};h=!0;break;case "u_camera_eye":case "u_camera_eye_frag":f=function(a,b,c,d,e,u){a.uniform3fv(b,u.ne)};h=!0;break;case "u_camera_eye_last":f=function(a,b,c,d,e,u){a.uniform3fv(b,u.bp)};h=
!0;break;case "u_camera_quat":f=function(a,b,c,d,e,u){a.uniform4fv(b,u.quat)};h=!0;break;case "u_view_max_depth":f=function(a,b,c,d,e,u){a.uniform1f(b,u.Ta)};h=!0;break;case "u_camera_range":f=function(a,b,c,d,e,u){a.uniform2f(b,u.Ja,u.Ta)};break;case "u_csm_center_dists":f=function(a,b,c,d,e,u){a.uniform4fv(b,u.Io)};break;case "u_cam_water_depth":f=function(a,b,c){a.uniform1f(b,c.Sk)};h=!0;break;case "u_waves_height":f=function(a,b,c){a.uniform1f(b,c.Qe)};break;case "u_waves_length":f=function(a,
b,c){a.uniform1f(b,c.cg)};break;case "u_fog_color_density":f=function(a,b,c){a.uniform4fv(b,c.Kb)};break;case "u_underwater_fog_color_density":f=function(a,b,c){a.uniform4fv(b,c.Mc)};break;case "u_bloom_key":f=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":f=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":f=function(a,b,c){a.uniform1f(b,c.time)};h=!0;break;case "u_wind":f=function(a,b,c){a.uniform3fv(b,c.Di)};break;case "u_horizon_color":f=function(a,
b,c){a.uniform3fv(b,c.tc)};break;case "u_zenith_color":f=function(a,b,c){a.uniform3fv(b,c.zc)};break;case "u_environment_energy":f=function(a,b,c){a.uniform1f(b,c.me)};break;case "u_sky_color":f=function(a,b,c){a.uniform3fv(b,c.Yg)};break;case "u_rayleigh_brightness":f=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":f=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":f=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":f=
function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":f=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":f=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":f=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":f=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":f=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;
case "u_light_positions":f=function(a,b,c){a.uniform3fv(b,c.xf)};break;case "u_light_directions":f=function(a,b,c){a.uniform3fv(b,c.vf)};break;case "u_light_color_intensities":f=function(a,b,c){a.uniform3fv(b,c.uf)};break;case "u_light_factors":f=function(a,b,c){a.uniform4fv(b,c.wf)};break;case "u_sun_quaternion":f=function(a,b,c){a.uniform4fv(b,c.Mr)};break;case "u_sun_intensity":f=function(a,b,c){a.uniform3fv(b,c.Lr)};break;case "u_sun_direction":f=function(a,b,c){a.uniform3fv(b,c.hk)};break;case "u_height":f=
function(a,b,c,d,e,u){a.uniform1f(b,u.height)};h=!0;break;case "u_model_matrix":f=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.N)};h=!0;break;case "u_transb":f=function(a,b,c,d){a.uniform4fv(b,d.mc)};h=!0;break;case "u_transa":f=function(a,b,c,d){a.uniform4fv(b,d.lc)};h=!0;break;case "u_quat":f=function(a,b,c,d){a.uniform4fv(b,d.quat)};h=!0;break;case "u_quatsb":f=function(a,b,c,d){a.uniform4fv(b,d.ec)};h=!0;break;case "u_quatsa":f=function(a,b,c,d){a.uniform4fv(b,d.dc)};h=!0;break;case "u_frame_factor":f=
function(a,b,c,d){a.uniform1f(b,d.jf)};h=!0;break;case "au_center_pos":f=function(){};h=!0;break;case "au_wind_bending_amp":f=function(a,b,c,d){a.uniform1f(b,d.pd)};h=!0;break;case "au_wind_bending_freq":f=function(a,b,c,d){a.uniform1f(b,d.Re)};h=!0;break;case "au_detail_bending_freq":f=function(a,b,c,d){a.uniform1f(b,d.he)};h=!0;break;case "au_detail_bending_amp":f=function(a,b,c,d){a.uniform1f(b,d.ge)};h=!0;break;case "au_branch_bending_amp":f=function(a,b,c,d){a.uniform1f(b,d.ee)};h=!0;break;case "u_node_values":f=
function(a,b,c,d){a.uniform1fv(b,d.Qd)};h=!0;break;case "u_node_rgbs":f=function(a,b,c,d){a.uniform3fv(b,d.ac)};h=!0;break;case "u_diffuse_color":f=function(a,b,c,d,e){a.uniform4fv(b,e.lb)};h=!0;break;case "u_diffuse_intensity":f=function(a,b,c,d,e){a.uniform1f(b,e.je)};h=!0;break;case "u_diffuse_params":f=function(a,b,c,d,e){a.uniform2fv(b,e.Ed)};h=!0;break;case "u_emit":f=function(a,b,c,d,e){a.uniform1f(b,e.Fd)};h=!0;break;case "u_ambient":f=function(a,b,c,d,e){a.uniform1f(b,e.wd)};h=!0;break;case "u_specular_color":f=
function(a,b,c,d,e){a.uniform3fv(b,e.fd)};h=!0;break;case "u_specular_alpha":f=function(a,b,c,d,e){a.uniform1f(b,e.$g)};h=!0;break;case "u_specular_params":f=function(a,b,c,d,e){a.uniform3fv(b,e.Sb)};h=!0;break;case "u_reflect_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.Pf)};h=!0;break;case "u_mirror_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.mm)};h=!0;break;case "u_grass_map_dim":f=function(a,b,c,d,e){a.uniform3fv(b,e.Mb)};h=!0;break;case "u_grass_size":f=function(a,b,c,d,e){a.uniform1f(b,e.Il)};
h=!0;break;case "u_scale_threshold":f=function(a,b,c,d,e){a.uniform1f(b,e.Ep)};h=!0;break;case "u_cube_fog":f=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.Wb)};break;case "u_jitter_amp":f=function(a,b,c,d,e){a.uniform1f(b,e.bq)};h=!0;break;case "u_jitter_freq":f=function(a,b,c,d,e){a.uniform1f(b,e.cq)};h=!0;break;case "u_wireframe_mode":f=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":f=function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":f=
function(a,b,c){a.uniform2fv(b,c.zx)};h=!0;break;case "u_subsample_indices":f=function(a,b,c){a.uniform4fv(b,c.Ax)};h=!0;break;case "u_refr_bump":f=function(a,b,c,d,e){a.uniform1f(b,e.br)};h=!0;break;case "u_lamp_light_positions":f=function(a,b,c,d,e){a.uniform3fv(b,e.Yl)};break;case "u_lamp_light_directions":f=function(a,b,c,d,e){a.uniform3fv(b,e.Wl)};break;case "u_lamp_light_color_intensities":f=function(a,b,c,d,e){a.uniform3fv(b,e.Vl)};break;case "u_lamp_light_factors":f=function(a,b,c,d,e){a.uniform4fv(b,
e.Xl)};break;case "u_halo_size":f=function(a,b,c,d,e){a.uniform1f(b,e.Jp)};h=!0;break;case "u_halo_hardness":f=function(a,b,c,d,e){a.uniform1f(b,e.Gp)};h=!0;break;case "u_halo_rings_color":f=function(a,b,c,d,e){a.uniform3fv(b,e.Ip)};h=!0;break;case "u_halo_lines_color":f=function(a,b,c,d,e){a.uniform3fv(b,e.Hp)};h=!0;break;case "u_halo_stars_blend":f=function(a,b,c,d,e){a.uniform1f(b,e.Kp)};h=!0;break;case "u_halo_stars_height":f=function(a,b,c,d,e){a.uniform1f(b,e.Lp)};h=!0;break;case "u_fresnel_params":f=
function(a,b,c,d,e){a.uniform4fv(b,e.Fc)};h=!0;break;case "u_texture_scale":f=function(a,b,c,d,e){a.uniform3fv(b,e.Je)};h=!0;break;case "u_parallax_scale":f=function(a,b,c,d,e){a.uniform1f(b,e.Lf)};h=!0;break;case "u_color_id":f=function(a,b,c,d){a.uniform3fv(b,d.ej)};h=!0;break;case "u_line_points":f=function(a,b,c,d,e){a.uniform3fv(b,e.IC)};h=!0;break;case "u_diffuse_color_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.ie)};h=!0;break;case "u_alpha_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.$d)};
h=!0;break;case "u_specular_color_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.yr)};h=!0;break;case "u_normal_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.uq)};h=!0;break;case "u_normalmap0_scale":f=function(a,b,c,d,e){a.uniform2fv(b,e.Ef[0])};h=!0;break;case "u_normalmap1_scale":f=function(a,b,c,d,e){a.uniform2fv(b,e.Ef[1])};h=!0;break;case "u_normalmap2_scale":f=function(a,b,c,d,e){a.uniform2fv(b,e.Ef[2])};h=!0;break;case "u_normalmap3_scale":f=function(a,b,c,d,e){a.uniform2fv(b,e.Ef[3])};h=!0;
break;case "u_foam_factor":f=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};h=!0;break;case "u_foam_uv_freq":f=function(a,b,c,d,e){a.uniform2fv(b,e.fp)};h=!0;break;case "u_foam_mag":f=function(a,b,c,d,e){a.uniform2fv(b,e.ep)};h=!0;break;case "u_foam_scale":f=function(a,b,c,d,e){a.uniform2fv(b,e.wl)};h=!0;break;case "u_water_norm_uv_velocity":f=function(a,b,c,d,e){a.uniform1f(b,e.th)};h=!0;break;case "u_shallow_water_col":f=function(a,b,c,d,e){a.uniform3fv(b,e.shallow_water_col)};h=!0;break;case "u_shore_water_col":f=
function(a,b,c,d,e){a.uniform3fv(b,e.shore_water_col)};h=!0;break;case "u_water_shallow_col_fac":f=function(a,b,c,d,e){a.uniform1f(b,e.shallow_water_col_fac)};h=!0;break;case "u_water_shore_col_fac":f=function(a,b,c,d,e){a.uniform1f(b,e.shore_water_col_fac)};h=!0;break;case "u_p_length":f=function(a,b,c,d,e){a.uniform1f(b,e.Hq)};h=!0;break;case "u_p_cyclic":f=function(a,b,c,d,e){a.uniform1i(b,e.Dq)};h=!0;break;case "u_p_max_lifetime":f=function(a,b,c,d,e){a.uniform1f(b,e.Jq)};h=!0;break;case "u_p_fade_in":f=
function(a,b,c,d,e){a.uniform1f(b,e.Eq)};h=!0;break;case "u_p_fade_out":f=function(a,b,c,d,e){a.uniform1f(b,e.Fq)};h=!0;break;case "u_p_size":f=function(a,b,c,d,e){a.uniform1f(b,e.vm)};h=!0;break;case "u_p_alpha_start":f=function(a,b,c,d,e){a.uniform1f(b,e.Aq)};h=!0;break;case "u_p_alpha_end":f=function(a,b,c,d,e){a.uniform1f(b,e.zq)};h=!0;break;case "u_p_nfactor":f=function(a,b,c,d,e){a.uniform1f(b,e.um)};h=!0;break;case "u_p_gravity":f=function(a,b,c,d,e){a.uniform1f(b,e.Gq)};h=!0;break;case "u_p_mass":f=
function(a,b,c,d,e){a.uniform1f(b,e.Iq)};h=!0;break;case "u_p_size_ramp":f=function(a,b,c,d,e){a.uniform2fv(b,e.Kq)};h=!0;break;case "u_p_color_ramp":f=function(a,b,c,d,e){a.uniform4fv(b,e.Bq)};h=!0;break;case "u_p_wind":f=function(a,b,c,d,e){a.uniform3fv(b,e.Sj)};h=!0;break;case "u_texel_size":f=function(a,b,c,d,e){a.uniform2fv(b,e.Ym)};h=!0;break;case "u_p_time":f=function(a,b,c,d,e){a.uniform1f(b,e.cc.O.time)};h=!0;break;case "u_position":f=function(a,b,c,d,e){a.uniform3fv(b,e.fi)};h=!0;break;
case "u_va_frame_factor":f=function(a,b,c,d){a.uniform1f(b,d.ds)};h=!0;break;case "u_normal_offset":f=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":f=function(a,b,c,d,e,u){a.uniform4fv(b,u.Xj)};break;case "u_v_light_matrix":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.cs)};h=!0;break;case "u_b_light_matrix":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Yn)};break;case "u_p_light_matrix0":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Kf[0])};h=!0;break;case "u_p_light_matrix1":f=
function(a,b,c){a.uniformMatrix4fv(b,!1,c.Kf[1])};h=!0;break;case "u_p_light_matrix2":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Kf[2])};h=!0;break;case "u_p_light_matrix3":f=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Kf[3])};h=!0;break;case "u_motion_blur_exp":f=function(a,b,c){a.uniform1f(b,c.pq)};h=!0;break;case "u_refl_plane":f=function(a,b,c){a.uniform4fv(b,c.vb)};break;case "u_radial_blur_step":f=function(a,b,c){a.uniform1f(b,c.$j)};break;case "u_god_rays_intensity":f=function(a,b,c){a.uniform1f(b,
c.god_rays_intensity)};break;case "u_ssao_radius_increase":f=function(a,b,c){a.uniform1f(b,c.dh)};break;case "u_ssao_blur_discard_value":f=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};h=!0;break;case "u_ssao_influence":f=function(a,b,c){a.uniform1f(b,c.bh)};break;case "u_ssao_dist_factor":f=function(a,b,c){a.uniform1f(b,c.ah)};break;case "u_dof_dist":f=function(a,b,c,d,e,u){a.uniform1f(b,u.dof_distance)};h=!0;break;case "u_dof_front":f=function(a,b,c,d,e,u){a.uniform1f(b,u.dof_front)};
h=!0;break;case "u_dof_rear":f=function(a,b,c,d,e,u){a.uniform1f(b,u.dof_rear)};h=!0;break;case "u_glow_intensity":f=function(a,b,c,d){a.uniform1f(b,d.nf)};h=!0;break;case "u_glow_color":f=function(a,b,c){a.uniform3fv(b,c.Bg)};break;case "u_draw_glow":f=function(a,b,c){a.uniform1f(b,c.nl)};h=!0;break;case "u_brightness":f=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":f=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":f=function(a,b,c){a.uniform1f(b,c.exposure)};
break;case "u_saturation":f=function(a,b,c){a.uniform1f(b,c.saturation)};break;default:f=null}f&&(f={name:l,Bl:f,zf:b[l]},h?c.push(f):(d.push(f),g[l]=f))}a.Sr=c;a.di=d;a.xm=g}var f=p("__config"),k=p("__debug"),g=p("__textures"),m=p("__util"),l=f.q,r=[1,1,1,1],q=[1,1,1,1],w=[0,0,0,1],v=[0,0,0,0],E=new Uint8Array([91.8,142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var B=null,x=new Uint8Array(4);a.gc=function(a){var b=
l.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);B=a};a.Ih=function(a){if(a.U){var e=a.j;B.bindFramebuffer(B.FRAMEBUFFER,e.Id);if(a.Gk){var f=e.sb;B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,f.Cb,f.Oa,0)}B.viewport(0,0,e.width,e.height);c(a);a.za?B.enable(B.BLEND):B.disable(B.BLEND);a.xb?B.enable(B.DEPTH_TEST):
B.disable(B.DEPTH_TEST);if(a.Ca){for(var e=a.j,f=a.p,g=0;g<f.length;g++){var m=f[g],q=m.o,r=q.Jb;B.useProgram(r.hi);m=m.fb;r.di.length||d(r);for(var r=r.di,v=r.length;v--;){var C=r[v];C.Bl(B,C.zf,a,m,q,e)}}a.Ca=!1}switch(a.type){case "SHADOW_CAST":B.enable(B.POLYGON_OFFSET_FILL);B.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);B.cullFace(B.BACK);break;case "MAIN_REFLECT":B.disable(B.POLYGON_OFFSET_FILL);B.cullFace(B.FRONT);break;default:B.disable(B.POLYGON_OFFSET_FILL),B.cullFace(B.BACK)}e=
a.j;f=a.p;for(g=0;g<f.length;g++)if(r=f[g],r.U){var q=a,m=e,C=r.fb,w=r.o,v=w.Jb;B.useProgram(v.hi);for(var r=w.na,J=w.Un,p=v.Sr,N=p.length;N--;){var u=p[N];u.Bl(B,u.zf,q,C,w,m)}m=w.zo;B.colorMask(m,m,m,m);B.depthMask(w.T);w.wa?B.enable(B.CULL_FACE):B.disable(B.CULL_FACE);m=w.L;for(w=0;w<m.length;w++)p=m[w],B.activeTexture(B.TEXTURE0+w),B.bindTexture(p.Cb,p.Oa);if("SKY"==q.type){m=q;v=v.wi;w=m.j.sb.Oa;p=m.Jo;for(N=0;6>N;N++)if(u=h(N),l.Vk?(B.bindTexture(B.TEXTURE_CUBE_MAP,w),B.texImage2D(u,0,B.RGBA,
1,1,0,B.RGBA,B.UNSIGNED_BYTE,E)):(B.uniformMatrix4fv(v.u_cube_view_matrix,!1,p[N]),B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,u,w,0),b(r,J,C.fn)),m.Oj&&3!=N){var u=m,P=N,S=x;l.Vk?S.set(E):(B.readPixels(191,191,1,1,B.RGBA,B.UNSIGNED_BYTE,S),255!=S[0]&&255!=S[1]&&255!=S[2]||B.readPixels(191,220,1,1,B.RGBA,B.UNSIGNED_BYTE,S));var Z=S[0],V=S[1],S=S[2],Z=Z/255,V=V/255,S=S/255;2===P?(u.Wb[3]=Z,u.Wb[7]=V,u.Wb[11]=S):2>P?(u.Wb[4*P]=Z,u.Wb[4*P+1]=V,u.Wb[4*P+2]=S):(u.Wb[4*(P-2)]=Z,u.Wb[4*(P-2)+
1]=V,u.Wb[4*(P-2)+2]=S)}q.Fh+=6}else b(r,J,C.fn),q.Fh++}k.Eu("draw subscene: "+a.type);B.bindFramebuffer(B.FRAMEBUFFER,null)}};a.clear=function(a){B.bindFramebuffer(B.FRAMEBUFFER,a.j.Id);c(a)};a.Qn=function(a){var b=a.Un;b.length=0;var c=a.na;a=a.Jb;c&&a||m.la("Incomplete batch");c=c.Ob;a=a.attributes;for(var d in a){var h=c[d];b.push({zf:a[d],iu:4*h.offset,ew:1<h.frames?4*h.length:0,Zc:h.Zc})}};a.hu=d;a.Rn=function(a){var b=a.Jb,c=a.L;a=a.Bb;B.useProgram(b.hi);for(var d=0;d<c.length;d++)B.uniform1i(b.wi[a[d]],
d)};a.ar=function(a,b,c,d,h,f){d||(d=1);h||(h=1);f||(f=new Uint8Array(4*d*h));f.length!=4*d*h&&m.la("read_pixels(): Wrong storage");B.bindFramebuffer(B.FRAMEBUFFER,a);B.readPixels(b,c,d,h,B.RGBA,B.UNSIGNED_BYTE,f);B.bindFramebuffer(B.FRAMEBUFFER,null);return f};a.Yz=function(a){var b=a.Jb;B.useProgram(b.hi);b.di.length||d(b);b=b.xm.u_cube_fog;b.Bl(B,b.zf,null,null,a,null)};a.xy=function(a,b){var c=B.createFramebuffer();B.bindFramebuffer(B.FRAMEBUFFER,c);if(a){var d=a,h=d.Oa,d=d.Cb==B.TEXTURE_CUBE_MAP?
B.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.Cb;B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,d,h,0)}g.Yp(b)?B.framebufferRenderbuffer(B.FRAMEBUFFER,B.DEPTH_ATTACHMENT,B.RENDERBUFFER,b.Ne):g.Wh(b)&&(d=b,h=d.Oa,d=d.Cb,B.framebufferTexture2D(B.FRAMEBUFFER,B.DEPTH_ATTACHMENT,d,h,0));k.Au();B.bindFramebuffer(B.FRAMEBUFFER,null);return c};a.wy=function(a,b,c,d,h){null==a?(B.bindFramebuffer(B.FRAMEBUFFER,a),B.viewport(0,0,d,h),B.clear(B.COLOR_BUFFER_BIT|B.DEPTH_BUFFER_BIT)):(g.Wh(b)&&B.deleteTexture(b.Oa),
g.Yp(c)?B.deleteRenderbuffer(c.Ne):g.Wh(c)&&B.deleteTexture(c.Oa),B.deleteFramebuffer(a))};a.qC=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,p){function c(a,c,d){var e=a.ke;"string"==typeof d&&(a=b(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==c){e[a][1]=d;return}e.push([c,d])}function b(a,b){for(var c=a.ke,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function h(a,b){var c=a+b;if(H[c])return H[c];if(x){var d=x[b];if(!d)return null}else{d=E.Vw(a+b);if(!d)return null;d=n.Qq.parse(d)}return H[c]=d}function d(a,b,c){function d(b){b=b.a;for(var c=0;c<b.length;c++){var x=b[c];switch(x.type){case "condition":a:for(var x=
x.a,v=0;v<x.length;v++){var T=x[v];switch(T.type){case "if":case "elif":var W=T.c;try{var S=e(W)}catch(oa){throw"Failed to process #"+T.type+" expression: "+W.join(" ");}if(S){d(T.group);break a}break;case "else":d(T.group);break a;case "ifdef":T.name in k&&d(T.group);break;case "ifndef":T.name in k||d(T.group)}}break;case "include":x=h(B.shaders_dir,B.gz+x.file);d(x);break;case "var":case "export":case "import":break;case "define":v=x.name;k[v]=x.b;x.Ka&&(r[v]=x.Ka);break;case "error":throw"Shader error: #error "+
x.b.join(" ");case "line":break;case "pragma":u.push("#pragma "+x.name+" "+x.b.join(" "));break;case "undef":x=x.name;delete k[x];delete r[x];break;case "warning":q.warn("Shader warning: #warning "+x.b.join(" "));break;case "extension":u.push("#extension "+f(x.b,k,r,!1));break;case "#":break;case "node":E[x.name]=x;break;case "nodes_global":x=l;for(v=0;v<x.length;v++)if(T=x[v],W=E[T.id])for(var ca=0,ia=0;ia<W.k.length;ia++){var t=W.k[ia];"node_param"==t.type&&(t=t.qualifier.join(" ")+" ","vert"==
a?t+=T.Ci[ca]:"frag"==a&&(t+=T.Ka[ca],null!==T.Uj[ca]&&(t+=" = "+T.Uj[ca])),t+=";",u.push(t),ca++)}break;case "nodes_main":x=l;for(v=0;v<x.length;v++)if(T=x[v],W=E[T.id]){ca={};ia={};for(t=0;t<T.df.length;t++)ia[T.df[t][0]]=[T.df[t][1]];z=p=G=0;for(var t=T,K=W.k,la=ca,H=ia,ba=0;ba<K.length;ba++){var da=K[ba];switch(da.type){case "node_in":var L=t.H[G];if(null!==t.Rl[G]){if(("MATERIAL"==t.id&&3===G||"MATERIAL_EXT"==t.id&&3===G)&&da.e){la[da.name]=t.Rl[G];G++;continue}var D=da.qualifier.join(" ")+" ",
D=D+L,D=D+(" = "+t.Rl[G]),D=D+";";u.push(D)}la[da.name]=L;G++;break;case "node_out":L=t.Va[p];if(!da.e||-1<y.indexOf(L))D=da.qualifier.join(" ")+" ",D+=L,D+=";",u.push(D),la[da.name]=L;-1<y.indexOf(L)&&(H["USE_OUT_"+da.name]=[1]);p++;break;case "node_param":"vert"==a?L=t.Ci[z]:"frag"==a&&(L=t.Ka[z]),la[da.name]=L,z++}}g(T,W.f,ca,ia)}break;case "lamp":w[x.name]=x;break;case "lamps_main":x=n;for(v=0;v<x.length;v++)if(T=x[v],T.yx)for(W=w[T.type].f,ca=0;ca<W.length;ca++){ia=W[ca];t=[];for(K=0;K<ia.b.length;K++){la=
ia.b[K];switch(la){case "LAMP_IND":la=T.index;break;case "LAMP_LIGHT_FACT_IND":la=T.Dx;break;case "LAMP_FAC_CHANNELS":la=T.Cx;break;case "LAMP_SPOT_SIZE":la=m(T.gd);break;case "LAMP_SPOT_BLEND":la=m(T.Tf||.01);break;case "LAMP_LIGHT_DIST":la=m(T.distance);break;case "LAMP_SHADOW_MAP_IND":la=T.kw?1:0}t.push(la)}u.push(t.join(" "))}break;case "textline":u.push(f(x.b,k,r,!1));break;default:throw"Unknown element type: "+x.type;}}}function e(a,b){var c=f(a,k,r,!0,b);return v.Qq.parse(c)}function g(a,b,
c,d){for(var h=0;h<b.length;h++){var l=b[h];switch(l.type){case "node_condition":a:for(var n=a,l=l.a,x=c,m=d,q=0;q<l.length;q++){var t=l[q];switch(t.type){case "node_if":case "node_elif":var K=t.c;try{var la=e(K,m)}catch(E){throw"Failed to process #"+t.type+" expression: "+K.join(" ");}if(la){g(n,t.f,x,m);break a}break;case "node_else":g(n,t.f,x,m);break a;case "node_ifdef":(t.name in k||t.name in m)&&g(n,t.f,x,m);break;case "node_ifndef":t.name in k||t.name in m||g(n,t.f,x,m)}}break;case "textline":n=
[];for(x=0;x<l.b.length;x++)m=l.b[x],m in c?n.push(c[m]):n.push(m);u.push(f(n,k,r,!0,d))}}}var l=c.rm,n=c.am;c=c.ke||[];for(var u=[],k={},x=0;x<c.length;x++)k[c[x][0]]=[c[x][1]];for(x=0;x<l.length;x++)k["USE_NODE_"+l[x].id]=[1];var r={},E={},w={},y=[];for(x in l)for(var H in l[x].H)y.push(l[x].H[H]);d(b);var G=0,p=0,z=0;return u.join("\n")}function f(a,b,c,d,e){var h=[];k(a,b,c,d,h,e);return h.join(" ")}function k(a,b,c,d,e,h){for(var f=0;f<a.length;f++){var g=a[f];g in b||h&&g in h?(g=h&&h[g]||b[g],
0==g.length&&d?e.push(0):k(g,b,c,d,e,h)):e.push(g)}}function g(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);w.Fu(d,b,c);return d}function m(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return l(a);case 2:return"vec2("+l(a[0])+","+l(a[1])+")";case 3:return"vec3("+l(a[0])+","+l(a[1])+","+l(a[2])+")";case 4:return"vec4("+l(a[0])+","+l(a[1])+","+l(a[2])+","+l(a[3])+")";case 9:return"mat3("+l(a[0])+","+l(a[1])+","+l(a[2])+","+l(a[3])+","+l(a[4])+","+l(a[5])+","+l(a[6])+
","+l(a[7])+","+l(a[8])+")";case 16:return"mat4("+l(a[0])+","+l(a[1])+","+l(a[2])+","+l(a[3])+","+l(a[4])+","+l(a[5])+","+l(a[6])+","+l(a[7])+","+l(a[8])+","+l(a[9])+","+l(a[10])+","+l(a[11])+","+l(a[12])+","+l(a[13])+","+l(a[14])+","+l(a[15])+")";default:throw"Wrong glsl value dimension";}}function l(a){return a%1?String(a):String(a)+".0"}var r=p("__config"),q=p("__print"),w=p("__debug"),v=p("__gpp_eval"),E=p("__assets");p("__util");var B=r.Hb;if(b4w.module_check("shader_texts"))var x=p("shader_texts"),
n=null;else x=null,n=p("__gpp_parser");var e={},H={},G=[],y=null;a.gc=function(a){y=a};a.B=c;a.Kw=b;a.zC=function(a,b){for(var c=a.ke,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.Py=function(a){a.ke=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE USE_REFRACTION SHORE_SMOOTHING SKINNED SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
d=0;d<b.length;d++){var e=b[d],h;switch(e){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "USE_REFRACTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":h=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":h=1;break;case "SHADOW_TEX_RES":h=m(2048);break;case "AA_METHOD":h="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":h="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":h="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":h="POST_EFFECT_NONE";break;case "SHADOW_SRC":h="SHADOW_SRC_NONE";break;case "SHADOW_DST":h=
"SHADOW_DST_NONE";break;case "SSAO_QUALITY":h="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":h="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":h="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":h=r.q.precision;break;case "EPSILON":h="highp"==r.q.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":h="u_va_frame_factor";break;default:q.error("Unknown directive ("+a.Ai+", "+a.Mh+"): "+e)}c(a,e,h)}};a.kC=function(a){return a.Ai};a.tp=function(a){return a.Mh};a.rC=function(a,d){for(var e=
d.ke,h=0;h<e.length;h++){var f=e[h][0],g=e[h][1];b(a,f)&&c(a,f,g)}};a.Fw=function(a){var b=JSON.stringify(a),c=e[b];if(c)return c;var f=a.Mh,c=h(B.shaders_dir,a.Ai),f=h(B.shaders_dir,f);if(!c||!f)return null;var l=d("vert",c,a),n=d("frag",f,a),c=y,k=g(c,b,l,c.VERTEX_SHADER),x=g(c,b,n,c.FRAGMENT_SHADER),f=c.createProgram();c.attachShader(f,k);c.attachShader(f,x);c.linkProgram(f);c.validateProgram(f);c.getProgramParameter(f,c.VALIDATE_STATUS)==c.RA&&q.error("shader program is not valid",b);w.Gu(f,b,
k,x,l,n);a={ln:k,jp:x,hi:f,attributes:{},wi:{},di:[],xm:{},Sr:[],Ia:a};n=c.getProgramParameter(f,c.ACTIVE_ATTRIBUTES);for(l=0;l<n;l++)k=c.getActiveAttrib(f,l).name,a.attributes[k]=c.getAttribLocation(f,k);n=c.getProgramParameter(f,c.ACTIVE_UNIFORMS);for(l=0;l<n;l++)k=c.getActiveUniform(f,l).name.split("[0]").join(""),a.wi[k]=c.getUniformLocation(f,k);return e[b]=c=a};a.yv=function(){return G};a.qp=function(){return e};a.cleanup=function(){for(var a in e){var b=e[a];y.deleteProgram(b.hi);y.deleteShader(b.ln);
y.deleteShader(b.jp);delete e[a]}for(var c in H)delete H[c];for(var d in G)delete G[d]};a.DB=function(a){var b=a.ke;q.log("Shader: "+a.Ai+" "+a.Mh+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)q.log("  "+b[a][0],b[a][1])};a.t=m;a.oo=function(a,b){return b in a.wi?!0:!1};a.Zw=function(a){return(y.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,p){function c(a){return 65536<a.I?y.sp()?!1:!0:!1}function b(a){return 0<a.W.length?!0:!1}function h(a,c,h){if(!b(a))return a;h||e.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.I*(c||1)+", will use drawArrays","color: #aa0");c=a.W;h=a.I;var u=a.F,f=a.v,g;for(g in u){var l=u[g],n=w(l,h);u[g]=d(c,l,n)}for(u=0;u<f.length;u++){var k=f[u];for(g in k)l=k[g],n=w(l,h),k[g]=d(c,l,n)}a.I=c.length;a.W=new Uint16Array(0);return a}function d(a,b,c){if(0==
b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var h=a[e],f=0;f<c;f++)d[c*e+f]=b[c*h+f];return d}function f(a,b){var c=a.md,d=a.Ob[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function k(b,c){var d,e;switch(c){case a.uh:case a.Ii:d=I.TRIANGLES;e=I.STATIC_DRAW;break;case a.vk:d=I.POINTS;e=I.STATIC_DRAW;break;case a.un:d=I.TRIANGLES;e=I.DYNAMIC_DRAW;break;case a.qs:d=I.POINTS;e=I.DYNAMIC_DRAW;
break;case a.rs:d=I.LINES;e=I.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.zi=e}function g(a){a.oe?(a.Md||(a.Md=I.createBuffer()),I.bindBuffer(I.ELEMENT_ARRAY_BUFFER,a.Md),I.bufferData(I.ELEMENT_ARRAY_BUFFER,a.oe,a.zi),a.jj=a.oe.byteLength):a.jj=0;a.$f||(a.$f=I.createBuffer());I.bindBuffer(I.ARRAY_BUFFER,a.$f);I.bufferData(I.ARRAY_BUFFER,a.md,a.zi);a.No=a.md.byteLength}function m(a){for(var b=G.bb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].W.length;b.W=new Uint32Array(c);
for(d=c=0;d<a.length;d++)c+=a[d].I;b.I=c;var e=a[0],h;for(h in e.F){for(d=c=0;d<a.length;d++)c+=a[d].F[h].length;b.F[h]=new Float32Array(c)}for(h in e.v[0]){for(d=c=0;d<a.length;d++)c+=a[d].v[0][h].length;for(d=0;d<e.v.length;d++)b.v[d]=b.v[d]||{},b.v[d][h]=new Float32Array(c)}for(e=d=c=0;e<a.length;e++){h=a[e];for(var f=h.W,g=h.I,l=h.F,n=0;n<f.length;n++)b.W[c+n]=f[n]+d;var c=c+f.length,k;for(k in l){var f=l[k],x=d*w(f,g);b.F[k].set(f,x)}for(n=0;n<h.v.length;n++){var l=h.v[n],m=b.v[n];for(k in l)f=
l[k],x=d*w(f,g),m[k].set(f,x)}d+=g}return b}function l(a,b,c,d,f,g){var l=G.bb("SUBMESH_"+a.name+"_"+b),n=a.submeshes[b],k=n.base_length,m=a.materials[b];l.I=k;if(r(c,"a_texcoord")){var E=null,v=a.materials[b];b=a.submeshes[b];if(v.texture_slots.length)switch(v=v.texture_slots[0],v.texture_coords){case "UV":v=a.uv_textures.indexOf(v.uv_layer);-1==v||0==v?E=new Float32Array(b.texcoord):1==v&&(E=new Float32Array(b.texcoord2));break;case "ORCO":for(var C=a.b4w_bounding_box,E=new Float32Array(2*b.base_length),
v=(C.max_x+C.min_x)/2,w=(C.max_z+C.min_z)/2,B=C.max_x-C.min_x,C=C.max_z-C.min_z,y=0,H=0;H<b.position.length;H+=3)E[y++]=(b.position[H]-v)/B+.5,E[y++]=(w-b.position[H+2])/C+.5}null===E&&(E=new Float32Array(b.texcoord));b=E}else b=new Float32Array(0);var O,E=n.group;if(r(c,"a_influence")&&d){v=new Float32Array(4*k);w=E.length/k;B=new Float32Array(w);for(C=0;C<w;C++)for(O in B[C]=-1,d)if(y=d[O],y.gs===C){B[C]=y.Hh;break}H=3<w?w:4;d=new Float32Array(H);O=new Uint32Array(H);for(var C=new Float32Array(4),
y=new Float32Array(H),H=new Uint32Array(H),T=new Float32Array(4),W=0;W<k;W++)d.set(y),O.set(H),C.set(T),v.set(q(E,w,W,k,B,d,O,C),4*W)}else v=new Float32Array(0);O=v;d=f?G.sa(f):{};d.a_color={lf:!0};d.a_color.src=r(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,vc:7}]:[];f={a_texcoord:b,a_influence:O};O=n.vertex_colors;b=n.color;E=a.name;v=[];for(w=0;w<O.length;w++)v.push(O[w].name);for(var p in d)if(w=d[p].src,w.length){for(C=B=0;C<w.length;C++)B+=G.Qf(w[C].vc);f[p]=new Float32Array(B*
k);for(C=y=0;C<w.length;C++){var oa=w[C].name,H=w[C].vc,T=G.fr(H),ca=v.indexOf(oa);-1==ca&&G.la('vertex color "'+oa+'" for mesh "'+E+'" not found.');var W=O[ca].mask,ia=G.Qf(W);(H&W)!==H&&e.error("Wrong color extraction from "+oa+" to "+p+".");for(var t=oa=0;t<ca;t++)oa+=G.Qf(O[t].mask);ca=oa*k;for(oa=0;oa<k;oa++)for(t=0;3>t;t++)T[t]&&(f[p][oa*B+(y+G.oi(H,t))]=b[ca+oa*ia+G.oi(W,t)]);y+=ia}}else f[p]=new Float32Array(0);p=a.uv_textures;d=n.texcoord;O=n.texcoord2;b=a.name;if(g)for(var K in g){E=p.indexOf(K);
-1==E&&G.la('uv map "'+K+'" for mesh "'+b+'" not found');if(0==E)var la=new Float32Array(d);else 1==E&&(la=new Float32Array(O));f[g[K]]=la}l.F=f;l.W=new Uint32Array(n.indices);g=n.position.length/k/3;la=(K=r(c,"a_normal")&&n.normal.length?!0:!1)&&r(c,"a_tangent")&&n.tangent.length?!0:!1;p=K&&m.texture_slots.length&&r(c,"a_tangent")&&"ORCO"==m.texture_slots[0].texture_coords?!0:!1;for(f=0;f<g;f++){m={};d=new Float32Array(3*k);O=new Float32Array(K?3*k:0);b=new Float32Array(la||p?4*k:0);E=f*k*3;v=E+
3*k;d.set(n.position.subarray(E,v),0);K&&(E=f*k*3,v=E+3*k,O.set(n.normal.subarray(E,v),0));if(la)E=f*k*4,v=E+4*k,b.set(n.tangent.subarray(E,v),0);else if(p)for(E=O,v=b,w=k,e.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+a.name+'". Please add a UV-map.'),B=0;B<w;B++)C=D,y=L,C[0]=E[3*B],C[1]=E[3*B+1],C[2]=E[3*B+2],A.cross(C,G.AXIS_Z,y),0==A.length(y)&&A.cross(C,G.AXIS_X,y),A.normalize(y,y),v[4*B]=y[0],v[4*B+1]=y[1],v[4*B+2]=y[2],v[4*B+3]=1;else if(K&&
r(c,"a_tangent"))for(b=new Float32Array(4*k),f=0;f<b.length;f++)b[f]=1;m.a_position=d;m.a_normal=O;m.a_tangent=b;l.v.push(m)}if(1<g){a=l.v[0];var m={},Oa;for(Oa in a)m[Oa]=new Float32Array(a[Oa]);l.v.push(m)}r(c,"a_polyindex")&&(h(l,1,!0),l.F.a_polyindex=x(l));return l}function r(a,b){return-1<a.indexOf(b)?!0:!1}function q(a,b,c,d,e,h,f,g){for(var l=!0,n=0;n<b;n++){var k=a[n*d+c];if(-1!==k){var m=e[n];-1!==m&&(h[n]=k,f[n]=m,l=!1)}}if(l)return g;v(h,f,!1);for(n=a=0;4>n;n++)a+=h[n];if(.01>a)return g;
for(n=0;4>n;n++)h[n]/=a;if(.01>Math.abs(h[0]-1))g[0]=f[0]+1;else for(n=0;4>n;n++)g[n]=f[n]+h[n];return g}function w(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function v(a,b,c){var d=a.length,e=d,h=!1;for(c=c?-1:1;1<e||h;){1<e&&(e=Math.floor(e/1.247330950103979));for(var h=!1,f=0;e+f<d;f++)0>c*(a[f]-a[f+e])&&(h=a[f],a[f]=a[f+e],a[f+e]=h,h=b[f],b[f]=b[f+e],b[f+e]=h,h=!0)}}function E(a,
b,c){var d=[],e=[];A.subtract(b,a,d);A.subtract(c,a,e);A.normalize(d,d);A.normalize(e,e);return Math.acos(A.dot(d,e))}function B(a,c,d){c||(c=[]);d=d?a.v[0].a_normal:a.v[0].a_position;if(b(a)){a=a.W;for(var e=a.length/3,h=0;h<e;h++){var f=new Float32Array(9),g=a[3*h];f[0]=d[3*g];f[1]=d[3*g+1];f[2]=d[3*g+2];g=a[3*h+1];f[3]=d[3*g];f[4]=d[3*g+1];f[5]=d[3*g+2];g=a[3*h+2];f[6]=d[3*g];f[7]=d[3*g+1];f[8]=d[3*g+2];c[h]=f}}else for(h=0;h<d.length;h++)f=new Float32Array(9),f[0]=d[9*h],f[1]=d[9*h+1],f[2]=d[9*
h+2],f[3]=d[9*h+3],f[4]=d[9*h+4],f[5]=d[9*h+5],f[6]=d[9*h+6],f[7]=d[9*h+7],f[8]=d[9*h+8],c[h]=f;return c}function x(a){for(var b=new Float32Array(a.I),c=0;c<a.I;c++)b[c]=c%3;return b}function n(a,b,c){var d=A.dist(a,b);a=A.dist(a,c);b=A.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}var e=p("__print"),H=p("__tsr"),G=p("__util"),y=p("__extensions"),A=p("vec3"),D=new Float32Array(3),L=new Float32Array(3),C=new Float32Array(3);a.td=10;a.Cn=20;a.XA=30;a.Ii=10;a.vk=20;a.un=30;a.qs=40;a.rs=50;a.uh=a.Ii;
var I=null;a.gc=function(a){I=a};a.FB=function(a){var b=_buffers[a];I.deleteBuffer(b.Md);I.deleteBuffer(b.$f);delete _buffers[a]};a.Gz=function(d,e,f,u){c(d)&&h(d);var l=d.W,n=d.I,m=d.v,x={},q;for(q in d.F)q in u&&!u[q].lf||(x[q]=d.F[q]);u={oe:null,md:null,Pl:0,count:0,Ob:{},mode:0,zi:0,jj:0,No:0,$f:null,Md:null,zj:null};if(l.length)if(q=l.length,65536>=n)var E=new Uint16Array(l),v=I.UNSIGNED_SHORT;else E=new Uint32Array(l),v=I.UNSIGNED_INT;else q=n,E=null;var r=0,C=m.length,B;for(B in m[0])var y=
m[0][B],r=r+y.length*C;for(B in x)y=x[B],r+=y.length;B=new Float32Array(r);var r=0,C={},A;for(A in x){var H=x[A];if(y=H.length)B.set(H,r),C[A]={iB:A,Zc:w(H,n),offset:r,frames:1,length:y},r+=y}x=m.length;for(A in m[0])if(H=m[0][A],y=H.length,H=w(H,n),y){C[A]={Zc:H,offset:r,frames:x,length:y};1<x&&(C[A+"_next"]={Zc:H,offset:r+y,frames:x,length:y});for(var O=0;O<x;O++)H=m[O][A],B.set(H,r),r+=y}u.count=q;u.oe=E;u.md=B;u.Pl=v;u.Ob=C;k(u,f);g(u);e!=a.td&&b(d)&&(u.zj={Ox:new Float32Array(l.length),Px:new Float32Array(l.length),
Kv:new Float32Array(l.length/3),type:e});return u};a.wx=c;a.vx=b;a.Vm=h;a.$z=function(a,b,c){k(a,b);a.count=c.length;a.oe=c;a.Pl=c instanceof Uint16Array?I.UNSIGNED_SHORT:I.UNSIGNED_INT};a.ok=function(a,b,c,d){var e=a.md,h=a.Ob,f=h[b];f?(c&&f.Zc!=c&&G.la('invalid num_comp for "'+b+'"'),e.set(d,f.offset)):(e=e.length,f=new Float32Array(e+d.length),f.set(a.md),f.set(d,e),a.md=f,h[b]={Zc:c,offset:e});g(a)};a.Uv=f;a.NC=function(a){a.zi=I.STATIC_DRAW};a.Ix=function(a){a.zi=I.DYNAMIC_DRAW};a.Yr=g;a.vo=
function(a){a.Md&&I.deleteBuffer(a.Md);a.$f&&I.deleteBuffer(a.$f)};a.Np=function(a,b){return a.submeshes[b].base_length?!1:!0};a.Jr=function(a,b){for(var c=0;c<a.v.length;c++){var d=a.v[c].a_position;H.lk(d,b,d,0);d=a.v[c].a_normal;0<d.length&&H.Qr(d,b,d,0);d=a.v[c].a_tangent;0<d.length&&H.Rr(d,b,d,0)}(c=a.F.au_center_pos)&&c.length&&H.lk(c,b,c,0);return a};a.Ez=function(a,b){var c=a.F.au_center_pos;if(c&&c.length){var d=new Float32Array(c);H.lk(d,b,d,0);for(var e=0;e<a.v.length;e++)for(var h=0;h<
d.length;h++)a.v[e].a_position[h]+=d[h]-c[h];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.Dz=function(a,b){var c=a.I,d;for(d in b){var e=b[d].length;a.F[d]=new Float32Array(e*c);for(var h=0;h<c;h++)for(var f=0;f<e;f++)a.F[d][h*e+f]=b[d][f]}};a.Fz=m;a.Hx=function(a,b,c){if(!a.I)return G.bb("EMPTY");var d=c.length;65536<a.I*d&&!y.sp()&&h(a,d);var e=a.W,f=a.I,g=a.F;a=a.v;for(var l in b){var n=b[l].length,k=n*f;g[l]=new Float32Array(k);for(var m=0;m<f;m++)for(k=0;k<
n;k++)g[l][m*n+k]=b[l][k]}b=G.bb("CLONE_"+d+"_SUBMESHES");b.I=f*d;b.W=new Uint32Array(e.length*d);for(m=0;m<d;m++)for(n=e.length*m,l=f*m,k=0;k<e.length;k++)b.W[n+k]=e[k]+l;for(var x in g)for(e=g[x],k=e.length*d,n=w(e,f),b.F[x]=new Float32Array(k),m=0;m<d;m++)l=f*n*m,b.F[x].set(e,l);for(x in a[0])for(m=0;m<a.length;m++)for(e=a[m][x],k=e.length*d,n=w(e,f),b.v[m]=b.v[m]||{},b.v[m][x]=new Float32Array(k),k=0;k<d;k++)switch(g=c[k],l=f*n*k,x){case "a_position":H.lk(e,g,b.v[m][x],l);break;case "a_normal":H.Qr(e,
g,b.v[m][x],l);break;case "a_tangent":H.Rr(e,g,b.v[m][x],l);break;default:throw"Wrong attribute name: "+x;}return b};a.ap=l;a.Xv=function(a){var b=a.I,c=a.v[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint16Array(4*a.W.length);for(var h=0;h<b;h++)d[12*h]=c[3*h],d[12*h+1]=c[3*h+1],d[12*h+2]=c[3*h+2],d[12*h+3]=c[3*h],d[12*h+4]=c[3*h+1],d[12*h+5]=c[3*h+2],d[12*h+6]=c[3*h],d[12*h+7]=c[3*h+1],d[12*h+8]=c[3*h+2],d[12*h+9]=c[3*h],d[12*h+10]=c[3*h+1],d[12*h+11]=c[3*h+2],e[8*h]=-.5,
e[8*h+1]=-.5,e[8*h+2]=-.5,e[8*h+3]=.5,e[8*h+4]=.5,e[8*h+5]=.5,e[8*h+6]=.5,e[8*h+7]=-.5,a[6*h]=4*h+2,a[6*h+1]=4*h+1,a[6*h+2]=4*h,a[6*h+3]=4*h+2,a[6*h+4]=4*h,a[6*h+5]=4*h+3;c=G.bb("HALO");c.v=[];c.v[0]={};c.I=4*b;c.v[0].a_position=d;c.F.a_halo_bb_vertex=e;c.W=a;return c};a.hx=r;a.Yv=function(a){for(var b=["a_position","a_normal"],c=[],d=0;d<a.submeshes.length;d++){var e=l(a,d,b,null,null,null);e.I&&c.push(e)}return 0==c.length?G.bb("EMPTY"):1==c.length?c[0]:m(c)};a.Zz=function(a,b,c){for(var d=a.oe,
e=f(a,"a_position"),h=a.zj,g=h.Ox,l=h.Px,h=h.Kv,n=d,k=n.length/3,m=0;m<k;m++){var x=n[3*m],q=n[3*m+1],E=n[3*m+2],v=e[3*x+1],r=e[3*x+2],C=e[3*q+1],w=e[3*q+2],T=e[3*E+1],B=e[3*E+2];g[3*m]=(e[3*x]+e[3*q]+e[3*E])/3;g[3*m+1]=(v+C+T)/3;g[3*m+2]=(r+w+B)/3}G.ve(g,b,l);b=g.length/3;for(e=0;e<b;e++)l=g[3*e]-c[0],n=g[3*e+1]-c[1],k=g[3*e+2]-c[2],h[e]=l*l+n*n+k*k;c=d;d=h.length;if(!(2>d))for(g=d,e=!1;1<g||e;)for(1<g&&(g=Math.floor(g/1.247330950103979)),e=!1,b=0;g+b<d;b++)0>h[b]-h[b+g]&&(e=h[b],h[b]=h[b+g],h[b+
g]=e,e=c,l=b,n=b+g,k=e[3*l],m=e[3*l+1],x=e[3*l+2],e[3*l]=e[3*n],e[3*l+1]=e[3*n+1],e[3*l+2]=e[3*n+2],e[3*n]=k,e[3*n+1]=m,e[3*n+2]=x,e=!0);d=c;I.bindBuffer(I.ELEMENT_ARRAY_BUFFER,a.Md);I.bufferData(I.ELEMENT_ARRAY_BUFFER,d,I.DYNAMIC_DRAW)};a.oz=v;a.ho=function(a,b,c){for(var d=b.length/3,e=a.length/3,h=[],f=Array(3),g=Array(3),l=Array(3),n=0;n<e;n++){for(var k=a[3*n],m=a[3*n+1],x=a[3*n+2],q=0;3>q;q++)f[q]=b[3*k+q],g[q]=b[3*m+q],l[q]=b[3*x+q];if(c)var q=E(f,g,l),v=E(g,l,f),r=Math.PI-q-v;else r=v=q=1;
var C=h,w;w=f;var T=l,B=[],y=[],oa=[];A.subtract(g,w,B);A.subtract(T,w,y);A.cross(B,y,oa);A.normalize(oa,oa);w=oa;for(T=0;3>T;T++)B=3*m+T,y=3*x+T,C[3*k+T]=q*w[T],C[B]=v*w[T],C[y]=r*w[T]}if(c)for(var ca in c)for(n=c[ca],a=0;3>a;a++){b=3*n[0]+a;for(e=1;e<n.length;e++)f=3*n[e]+a,h[b]+=h[f];for(e=1;e<n.length;e++)f=3*n[e]+a,h[f]=h[b]}for(n=0;n<d;n++){c=n;ca=h;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=ca[e];A.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,ca[e]=a[b]}return h};a.jo=function(a,b,c){for(var d=
{},e=b.length/3,h=0;h<e;h++){var f=String(b[3*h])+String(b[3*h+1])+String(b[3*h+2]);d[f]=[]}e=a.length;for(h=0;h<e;h++)b=a[h],f=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),f in d&&d[f].push(b);return d};a.Cl=function(a,b,c,d){var e=B(a,null,!1);if(c)var h=B(a,null,!0);var f=e.length,g=new Float32Array(f),l=D,k=L;for(a=0;a<f;a++){var m=e[a];l.set(m.subarray(0,3));k.set(m.subarray(3,6));C.set(m.subarray(6));g[a]=Math.sqrt(n(l,k,C))}l=new Float32Array(f);l[0]=g[0];for(a=1;a<f;a++)l[a]=l[a-1]+g[a];
f=l[g.length-1];g=[];for(a=0;a<b;a++){var k=f*G.yc(d),k=G.Ui(l,k,0,l.length-1),m=c?h[k]:e[k],k=a,x=m,q=d,m=void 0,m=new Float32Array(3),E=x[0],v=x[1],r=x[2],w=x[3],y=x[4],T=x[5],W=x[6],A=x[7],oa=x[8],x=G.yc(q),q=G.yc(q);1<x+q&&(x=1-x,q=1-q);var ca=1-x-q,v=ca*v+x*y+q*A,r=ca*r+x*T+q*oa;m[0]=ca*E+x*w+q*W;m[1]=v;m[2]=r;g[k]=m}return g};a.LB=B;a.$o=x;a.mD=n;a.Pw=function(a,b,c,d){var e=b[0]-a[0],h=c[0]-a[0],f=b[1]-a[1],g=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=f*a-b*g;d[1]=h*b-e*a;d[2]=e*g-f*h;return d};
a.Hy=function(a,b,c){a=a.v[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]}};b4w.module.__objects=function(a,p){function c(a){a={type:a,Sc:0,gx:[0,0],g:new Float32Array(3),quat:new Float32Array(4),Wd:new Float32Array(8),N:new Float32Array(16),Up:new Float32Array(16),zb:new Float32Array(3),Zb:new Float32Array(3),Eg:0,Fg:0,Sl:!1,ej:null,nf:0,ik:!1,bs:!1,aa:0,hn:1,gn:1,jn:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,ff:null,Ur:!1,Tc:0,ef:0,Na:!1,Nb:null,nd:null,Gb:null,pl:!0,J:null,sj:null,Oh:0,Jh:0,yl:0,Zh:0,Af:0,Rq:"",pk:!1,hc:!1,Ab:!1,Rb:!1,fc:!1,Qb:!1,Hc:!1,Ze:!1,
od:!1,lj:!1,Vc:!1,Sa:!1,rg:!1,Sh:!1,Gj:!1,ad:!1,Rj:!1,Ej:!1,is_visible:!1,Ei:0,pd:0,Re:0,he:0,ge:0,ee:0,Pd:"",yb:null,Ti:!1,Ad:!1,Ah:"",Nk:!1,jf:0,time:0,fn:0,ds:0,Gc:0,Nh:!1,sk:!1,Vh:!1,be:!1,ae:1,Dk:0,Ck:1,mk:new Int8Array([-1,-1]),fk:[],oq:[],tr:[],ec:null,dc:null,mc:null,lc:null,qc:null,Sq:null,Qd:null,Df:null,Jj:null,ac:null,Cf:null,Kj:null,Eb:null,Kk:null,Ik:null,Jk:null,Qa:null,Cc:null,rb:null,Xe:null,Ye:null,scale:1,re:1E4};L.identity(a.quat);A.identity(a.Wd);I.identity(a.N);I.identity(a.Up);
return a}function b(a){var b=a.parent;if(b&&b.ig)return!0;switch(a.type){case "MESH":var c=l.Bj(a),d=a.b4w_do_not_batch,h=a.b4w_collision,f=a.b4w_vehicle,g=a.b4w_floating,b=a.b4w_character,n=a.b4w_billboard,k=H.jx(a),m=e.Op(a);if(!(c=c||d||h||f||g))a:{a=a.data;for(c=0;c<a.materials.length;c++)if("LENS_FLARES"===a.materials[c].name){c=!0;break a}c=!1}return c||k||b||n||m;case "EMPTY":return b=l.Bj(a),n=e.Op(a),a=a.b4w_do_not_batch,b||n||a;default:return!0}}function h(a,b,c,e,f,g,l,n,k){for(var m=0;m<
a.nodes.length;m++){var x=a.nodes[m];if("VALUE"==x.type){var q=b+x.name;e.push(x.outputs[0].default_value);f.push(q,f.length/2)}else"RGB"==x.type?(q=b+x.name,x=x.outputs[0].default_value.slice(0,3),l.push(x[0],x[1],x[2]),n.push(q,n.length/2)):"GROUP"==x.type&&(q=x.node_group.node_tree,h(q,b+x.name+"%join%",q.animation_data,e,f,g,l,n,k))}if(c)for((a=c.action)&&d(a,b,g,f,k,n),c=c.nla_tracks,e=0;e<c.length;e++)for(l=c[e].strips,m=0;m<c[e].strips.length;m++)a=l[m].action,d(a,b,g,f,k,n)}function d(a,b,
c,d,e,h){var g=a.d.Ka,l;for(l in g){var n=b+l.match(/"(.*?)"/)[1],g=f(d,n);null!=g?(n=a.name+"%join%"+l,c.push(n,g)):(g=f(h,n),null!=g&&(n=a.name+"%join%"+l,e.push(n,g)))}}function f(a,b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function k(a,b,c){return{name:a,type:b,modifiers:[],particle_systems:[],constraints:[],data:null,parent:null,b4w_vehicle_settings:null,b4w_floating_settings:null,b4w_character_settings:null,b4w_vehicle:!1,b4w_character:!1,b4w_floating:!1,n:[],Dn:c,
oc:[],Zd:[],ud:[],Ac:null,Ya:null,pc:null,i:null,w:[],l:null,h:null,ca:null}}function g(a){return a instanceof Array?a.slice():a}function m(a){if("object"!=typeof a||null===a)return a;var b=a instanceof Array?[]:{},c=null,d=null;a.L&&(c=a.L,a.L=null);a.Bb&&(d=a.Bb,a.Bb=null);for(var e in a)b[e]=a[e]&&"object"==typeof a[e]?a[e]instanceof Float32Array?new Float32Array(a[e]):a[e]instanceof Uint32Array?new Uint32Array(a[e]):a[e]instanceof Uint16Array?new Uint16Array(a[e]):a[e]instanceof WebGLUniformLocation?
a[e]:a[e]instanceof WebGLProgram?a[e]:a[e]instanceof WebGLShader?a[e]:a[e]instanceof WebGLBuffer?null:m(a[e]):a[e];c&&(b.L=c,a.L=c);d&&(b.Bb=d,a.Bb=d);return b}var l=p("__animation"),r=p("__batch"),q=p("__boundings"),w=p("__camera"),v=p("__config"),E=p("__constraints"),B=p("__curve"),x=p("__geometry"),n=p("__lights"),e=p("__nla"),H=p("__particles"),G=p("__scenes"),y=p("__transform"),A=p("__tsr"),D=p("__util"),L=p("quat"),C=p("vec3"),I=p("mat4"),J=v.q,Q=0,N=new Float32Array(4);a.gj=c;a.en=function(a,
d){var e=b(a);a.ig=e;a.d=c("MESH"===a.type?e?"DYNAMIC":"STATIC":a.type);a.Dn=!1;a.Ya=null;a.oc=[];a.w=[];a.l=null;a.h=null;a.ca=null;a.ra||(a.ra=null);var e=a.d,f=a.location,g=a.scale[0];D.ly(a.rotation_quaternion,N);y.set_translation(a,f);y.set_rotation(a,N);y.set_scale(a,g);switch(a.type){case "ARMATURE":f=a.pose.bones;for(g=0;g<f.length;g++){var k=f[g],m=k.bone,x=new Float32Array(m.matrix_local),v=new Float32Array(16);I.invert(x,v);var H=new Float32Array(k.matrix_basis),p=new Float32Array(3);C.subtract(m.tail_local,
m.head_local,p);D.uA(p,v,p);k.Gt=p;k.At=[k].concat(k.parent_recursive);k.Fn=A.ip(x,A.create());k.En=A.ip(H,A.create());k.yk=A.create();k.Mi=!1}f=l.su(a);e.qc=f;f=l.io(a,f);a.b4w_animation_mixing?(e.ec=new Float32Array(f.qa),e.dc=new Float32Array(f.qa),e.mc=new Float32Array(f.g),e.lc=new Float32Array(f.g)):(e.ec=f.qa,e.dc=f.qa,e.mc=f.g,e.lc=f.g);e.Sq=f;e.jf=0;e.be=a.b4w_animation_mixing;break;case "MESH":e.ad=J.all_objs_selectable||a.b4w_selectable;e.Rj=a.b4w_selectable;e.Ad=a.b4w_billboard;e.nu=a.b4w_pres_glob_orientation;
e.Ah="BASIC";e.Nk="SPHERICAL"==a.b4w_billboard_geometry;e.sj={bx:a.b4w_glow_settings.glow_duration,dx:a.b4w_glow_settings.glow_period,ex:a.b4w_glow_settings.glow_relapses};e.ad&&(a.d.ej=D.kp(Q),Q++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.sk=a.data.b4w_vertex_anim.length?!0:!1;if(g=l.get_first_armature_object(a)){f=a.d;k=a.data.vertex_groups;if(k.length){m=g.data.bones;x=g.pose.bones;v=0;H={};for(p=0;p<m.length;p++){var L=m[p].name,ga=D.keysearch("name",L,k);if(ga){var ea=D.Gl(x,"name",
L);H[L]={eo:p,Hh:v++,ym:ea,gs:ga.index}}}f.qc=H;f.Gc=v;f.Vh=!0}f=a.d.qc;f=l.io(g,f);g.b4w_animation_mixing?(e.ec=new Float32Array(f.qa),e.dc=new Float32Array(f.qa),e.mc=new Float32Array(f.g),e.lc=new Float32Array(f.g)):(e.ec=f.qa,e.dc=f.qa,e.mc=f.g,e.lc=f.g);e.Sq=f;e.jf=0}g=a.d;f=a.data.materials;k=[];m=[];x=[];v=[];H=[];p=[];for(L=0;L<f.length;L++)ga=f[L],(ea=ga.node_tree)&&h(ea,ga.name+"%join%",ea.animation_data,k,m,x,v,H,p);g.Qd=k;g.Df=m;g.Jj=x;g.ac=v;g.Cf=H;g.Kj=p;a.n=[];e.hc=a.b4w_shadow_cast;
e.Ab=a.b4w_shadow_receive;e.Rb=a.b4w_shadow_cast_only&&e.hc;e.fc=a.b4w_reflexible;e.Qb=a.b4w_reflexible_only&&e.fc;e.Hc=a.b4w_reflective;e.Ze=a.b4w_caustics;e.od=a.b4w_wind_bending;e.Ei=a.b4w_wind_bending_angle;g=r.AA(a.b4w_wind_bending_angle,r.ju(a.data.b4w_bounding_box),a.scale[0]);e.pd=g;e.Re=a.b4w_wind_bending_freq;e.he=a.b4w_detail_bending_freq;e.ge=a.b4w_detail_bending_amp;e.ee=a.b4w_branch_bending_amp;e.Sh=!1;e.Pd=a.b4w_main_bend_stiffness_col;g=a.b4w_detail_bend_colors;e.yb={};e.yb.iq=g.leaves_stiffness_col;
e.yb.hq=g.leaves_phase_col;e.yb.yq=g.overall_stiffness_col;e.rg=a.b4w_do_not_cull;e.lj=a.b4w_disable_fogging;e.Vc=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";g=a.data.materials[0];e.Oh=g.physics.friction;e.Jh=g.physics.elasticity;e.Zh=0;e.re=1E4;e.Af=a.b4w_lod_transition;e.Gj=!0;break;case "CAMERA":w.wu(a);w.fu(a);break;case "LAMP":n.Bx(a);break;case "CURVE":if(g=B.ov(a))a.Ft=g;break;case "EMPTY":e.Eb=q.qd(),g=q.Fi(),e.Cc=g}if(!d&&(a.parent&&"OBJECT"==a.parent_type?(f=e.g,k=e.quat,
g=e.scale,E.On(a,a.parent,f,k,g)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(f=e.g,k=e.quat,g=e.scale,E.Nn(a,a.parent,a.parent_bone,f,k,g)):a.ra&&a.ra.b4w_group_relative?(g=A.qg(e.g,e.scale,e.quat),E.Mt(a,a.ra,g)):a.ra&&!a.ra.b4w_group_relative&&(y.C(a),k=e.N,I.multiply(a.ra.d.N,k,k),f=D.Bf(k),g=D.Ij(k),k=D.matrix_to_quat(k),y.set_translation(a,f),y.set_rotation(a,k),y.set_scale(a,g)),g=a.dupli_group))for(f=g.objects,g=0;g<f.length;g++)f[g].ra=a;a.field&&(e.yl=a.field.strength,G.Xr(a));
e.pk=a.game.use_collision_compound;e.Rq=a.game.physics_type;y.C(a)};a.gA=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.d||"DYNAMIC"!=c.d.type&&"CAMERA"!=c.d.type||y.C(c);c.b4w_use_default_animation&&l.Bj(c)&&(l.apply_def(c),c.w.length&&l.play(c,null,l.SLOT_ALL))}};a.uc=function(a){return a.ig?!0:!1};a.Cj=function(a){return"MESH"==a.type&&a.ig?!0:!1};a.get_meta_tags=function(a){a=a.b4w_object_tags;return{title:a?a.title:"",description:a?a.description:"",category:a?a.category:""}};a.cleanup=
function(){Q=0};a.Yx=function(a){return a.d.Vc};a.Sp=k;a.copy=function(a,b,c){b=k(b,a.type,!1);var d=[];if(c){for(var e=0;e<a.n.length;e++)a.n[e].sc||(b.n.push(m(a.n[e])),d.push(a.n[e].na));for(e=0;e<a.n.length;e++)if(a.n[e].sc){var h=m(a.n[e]);b.n.push(h);for(var f=0;f<d.length;f++)d[f]==a.n[e].na&&(h.na=b.n[f].na)}}else b.n=g(a.n);b.d=m(a.d);a.ig&&(b.ig=a.ig);a.ra&&(b.ra=a.ra);a.ud&&(b.ud=g(a.ud));!a.l||a.b4w_vehicle||a.b4w_character||a.b4w_floating||(b.l=m(a.l));b.game=m(a.game);b.b4w_collision_id=
a.b4w_collision_id;b.b4w_correct_bounding_offset=a.b4w_correct_bounding_offset;b.b4w_collision=a.b4w_collision;b.data=a.data;b.particle_systems=c?m(a.particle_systems):g(a.particle_systems);if(c)for(e=0;e<b.n.length;e++){b.n[e].na&&x.Yr(b.n[e].na);if("PARTICLES"==b.n[e].type&&b.n[e].Am)for(f=0;f<b.WC.length;f++)if(b.particle_systems[f].name==b.n[e].Am){b.n[e].cc=b.particle_systems[f];break}b.n[e].Pg=b.uuid;r.Xz(b.n[e],D.lg(b.d,0))}b.uuid=D.mp();b.d.Sl=!0;b.d.ej=D.kp(Q);Q++;return b};a.Ru=m;a.Yw=function(a,
b){for(var c=a.d.Df,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null};a.Rw=function(a,b){for(var c=a.d.Cf,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}};b4w.module.__particles=function(a,p){function c(){throw"_rand() undefined";}function b(a,b,c,d,h,e,f){var g=a.O.ll,l=a.O.Wc,k=a.O.time;a=a.O.Tq;for(var r=b?4:1,p=0;p<g.length;p+=r){var C=g[p];if(C>a&&C<=k)for(C=0;8>C;C++)l[8*p+C]=h[C];for(C=0;8>C;C++)q[C]=l[8*p+C];C=w;C[0]=c[3*p];C[1]=c[3*p+1];C[2]=c[3*p+2];m.vi(C,q,C);e[3*p]=C[0];e[3*p+1]=C[1];e[3*p+2]=C[2];var I=w;I[0]=d[3*p];I[1]=d[3*p+1];I[2]=d[3*p+2];m.kk(I,q,I);f[3*p]=I[0];f[3*p+1]=I[1];f[3*p+2]=I[2];if(b)for(C=1;4>C;C++)e[3*(p+C)]=e[3*p],e[3*
(p+C)+1]=e[3*p+1],e[3*(p+C)+2]=e[3*p+2],f[3*(p+C)]=I[0],f[3*(p+C)+1]=I[1],f[3*(p+C)+2]=I[2]}}function h(a){a?(g.Az(a),c=function(){return g.ny()}):c=function(){return Math.random()}}var d=p("__config"),f=p("__geometry"),k=p("__scenes"),g=p("__util"),m=p("__tsr"),l=p("vec3"),r=d.xd,q=new Float32Array(8),w=new Float32Array(3);a.Dg=function(a){return 0<a.particle_systems.length?!0:!1};a.Ml=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.lC=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.jx=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.pw=function(a,d,k,m){k.O=k.O||{};var n=f.Yv(d),e=k.settings.count,q=k.settings.frame_start/r.Ea,w=k.settings.frame_end/r.Ea,y=k.settings.lifetime/r.Ea,A=k.settings.lifetime_random,p=k.settings.emit_from,L=
k.settings.factor_random,C=k.settings.angular_velocity_mode,I=k.settings.angular_velocity_factor,J=k.settings.b4w_randomize_emission,Q=k.settings.b4w_cyclic;h(k.seed);var N=k.O.rA="WORLD"==k.settings.b4w_coordinate_system?!0:!1;k.O.frame=0;if(d=!a.of){var u;u=[];for(var P=0;P<e;P++)u.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);u=new Float32Array(u);for(var P=[],S=0;S<e;S++)P.push(4*S,4*S+2,4*S+1,4*S,4*S+3,4*S+2);P=new Uint16Array(P)}switch(p){case "VERT":for(var S=n.v[0].a_position,n=n.v[0].a_normal,Z=S.length/
3,p=[],V=0;V<e;V++){var fa=Math.round((Z-1)*c());p.push(fa);d&&(p.push(fa),p.push(fa),p.push(fa))}Z=[];for(V=0;V<p.length;V++)Z.push(S[3*p[V]]),Z.push(S[3*p[V]+1]),Z.push(S[3*p[V]+2]);S=new Float32Array(Z);Z=[];for(V=0;V<p.length;V++)Z.push(n[3*p[V]]),Z.push(n[3*p[V]+1]),Z.push(n[3*p[V]+2]);p=new Float32Array(Z);break;case "FACE":S=[];p=[];V=[];g.Aj(0,V);Z=f.Cl(n,e,!1,V);g.Aj(0,V);n=f.Cl(n,e,!0,V);for(V=0;V<Z.length;V++)S.push(Z[V][0],Z[V][1],Z[V][2]),d&&(S.push(Z[V][0],Z[V][1],Z[V][2]),S.push(Z[V][0],
Z[V][1],Z[V][2]),S.push(Z[V][0],Z[V][1],Z[V][2])),p.push(n[V][0],n[V][1],n[V][2]),d&&(p.push(n[V][0],n[V][1],n[V][2]),p.push(n[V][0],n[V][1],n[V][2]),p.push(n[V][0],n[V][1],n[V][2]));S=new Float32Array(S);p=new Float32Array(p);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}p=[S,p];n=p[0];p=p[1];k.O.fi=new Float32Array(n);k.O.Vx=new Float32Array(p);k.O.ey=new Float32Array(n.length);k.O.Wx=new Float32Array(p.length);k.O.time=0;k.O.Tq=
-1;S=[];w=(w-q)/e;for(Z=0;Z<e;Z++)V=J?w*Z+10*w*(.5-c()):w*Z,Q||(V+=q),S.push(V),d&&(S.push(V),S.push(V),S.push(V));q=new Float32Array(S);k.O.ll=new Float32Array(q);k.O.Oo=new Float32Array(q);k.O.Wc=new Float32Array(8*q.length);for(J=0;J<8*q.length;J++)for(Q=0;8>Q;Q++)k.O.Wc[8*J+Q]=m[Q];N&&b(k,d,n,p,m,n,p);k=[];m=y*A;for(A=0;A<e;A++)N=m*c(),k.push(y-N),d&&(k.push(y-N),k.push(y-N),k.push(y-N));y=new Float32Array(k);k=[];for(m=0;m<e;m++){A=[c()-.5,c()-.5,c()-.5];l.normalize(A,A);k.push(L*A[0]);k.push(L*
A[1]);k.push(L*A[2]);switch(C){case "NONE":k.push(0);break;case "SPIN":case "VELOCITY":k.push(I);break;case "RAND":k.push(2*I*(c()-.5));break;default:throw"Undefined velocity factor";}if(d)for(A=k.slice(-4),N=0;12>N;N++)k.push(A[N%4])}e=new Float32Array(k);L=g.bb("EMITTER_PARTICLES");C=g.Dc();C.a_position=n;C.a_normal=p;L.v[0]=C;d?L.W=P:(a.Uc=f.vk,L.W=new Uint16Array(0));L.I=n.length/3;L.F.a_p_delay=q;L.F.a_p_lifetime=y;L.F.a_p_vels=e;d&&(L.F.a_p_bb_vertex=u);return L};a.dA=function(a){for(var c=
a.n,d=0;d<c.length;d++){var h=c[d],g=c[d].cc;if(g){var e=h.na;if(!g.O.rA)break;var l=g.O.ey,k=g.O.Wx;b(g,!h.of,g.O.fi,g.O.Vx,a.d.Wd,l,k);f.Ix(e);f.ok(e,"a_position",3,l);f.ok(e,"a_normal",3,k)}}};a.Qy=function(a,b,c){var d=b.settings.lifetime/r.Ea,h=b.settings.normal_factor,e=9.81*b.settings.effector_weights.gravity,f=b.settings.effector_weights.wind,g=b.settings.mass,l=b.settings.b4w_fade_in/r.Ea,m=b.settings.b4w_fade_out/r.Ea,q=b.settings.b4w_cyclic;a.Hq=b.settings.frame_end/r.Ea-b.settings.frame_start/
r.Ea;a.Dq=q?1:0;a.um=h;a.Gq=e;h=k.ax();a.Sj[0]=h[0]*f;a.Sj[1]=h[1]*f;a.Sj[2]=h[2]*f;a.Jq=d;a.Iq=g;a.Eq=l;a.Fq=m;a.of?(d=c.halo.size,f=c.halo.hardness,30>f?(f=.5,g=.9):40>f?(f=.1,g=1):50>f?(f=0,g=.8):(f=0,g=.5)):(d=b.settings.particle_size,g=f=1);a.vm=d;a.Aq=f;a.zq=g;d=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;f=Math.min(2*d.length,b.length);for(g=0;g<f;g+=2)l=
d[g/2],b[g]=l.position,b[g+1]=(l.color[0]+l.color[1]+l.color[2])/3;a.Lq=d.length}a.Kq.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;f=Math.min(4*d.length,c.length);for(g=0;g<f;g+=4)l=d[g/4],c[g]=l.position,c[g+1]=l.color[0],c[g+2]=l.color[1],c[g+3]=l.color[2];a.Cq=d.length}a.Bq.set(c)};a.$y=function(a,b){a.O.Tq=a.O.time;a.O.time=b};a.gy=
function(a){for(var b=a.I,c=a.v[0].a_position,d=a.F.a_texcoord,f=[],e=[],h=0;h<b;h++)e.push(c[3*h]),e.push(c[3*h+1]),f.push(c[3*h+2]);f=new Float32Array(f);e=new Float32Array(e);a.F.a_lf_dist=f;a.F.a_lf_bb_vertex=e;a.F.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.n;for(var d=0;d<a.length;d++){var f=a[d],e=f.cc;e&&e.name==b&&(f.vm=c)}};a.set_normal_factor=function(a,b,c){a=a.n;for(var d=0;d<a.length;d++){var f=a[d],e=f.cc;e&&e.name==b&&(f.um=c)}};a.set_factor=function(a,b,c){a=a.n;for(var d=
0;d<a.length;d++){var h=a[d],e=h.cc;if(e&&e.name==b){var g=e.O.ll;if(1==c)e=g;else if(0==c)for(var l=!h.of,k=l?4:1,e=e.O.Oo,m=0;m<e.length;m+=k)e[m]=1E4,l&&(e[m+1]=e[m],e[m+2]=e[m],e[m+3]=e[m]);else for(var q=1/c,e=e.O.Oo,k=(l=!h.of)?4:1,r=0,m=0;m<e.length;m+=k)m>=r?(e[m]=g[m],r+=q):e[m]=1E4,l&&(e[m+1]=e[m],e[m+2]=e[m],e[m+3]=e[m]);f.ok(h.na,"a_p_delay",1,e)}}};a.lA=function(a,b,c){a=a.particle_systems;for(var d=0;d<a.length;d++){var f=a[d];if("EMITTER"==f.settings.type)for(var e=f.O.ll,d=0;d<8*e.length;d++)f.O.Wc[8*
d]=b[0],f.O.Wc[8*d+1]=b[1],f.O.Wc[8*d+2]=b[2],f.O.Wc[8*d+3]=b[3],f.O.Wc[8*d+4]=c[0],f.O.Wc[8*d+5]=c[1],f.O.Wc[8*d+6]=c[2],f.O.Wc[8*d+7]=c[3]}}};b4w.module.__primitives=function(a,p){function c(a,b,c,d){for(var f=[],h=[],g=[],B=[],x=2*c/(a-1),n=2*d/(b-1),e=0;e<a;e++)for(var p=-c+e*x,G=0;G<b;G++)if(h.push(p,0,-d+G*n),g.push(0,1,0),B.push(e/(a-1),G/(b-1)),e&&G){var y=e*b+G,A=y-1,D=(e-1)*b+G,L=D-1;f.push(y,A,D);f.push(A,L,D)}a=k.Dc();a.a_position=new Float32Array(h);a.a_normal=new Float32Array(g);g=k.bb("GRID_PLANE");g.v[0]=a;g.F.a_texcoord=new Float32Array(B);g.W=new Uint32Array(f);g.I=h.length/3;return g}function b(a){var b=a.length;if(b%4)throw"Wrong array";
for(var c=[],f=[],h=0;h<b;h+=4){var g=a[h+1],E=a[h+2],B=a[h+3];d(a[h],f);d(g,f);d(E,f);d(B,f);c.push(h,h+1,h+2);c.push(h,h+2,h+3)}a=k.Dc();a.a_position=new Float32Array(f);b=k.bb("FROM_QUADS");b.v[0]=a;b.W=new Uint32Array(c);b.I=f.length/3;return b}function h(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function d(a,b){b.push(a[0],a[1],a[2])}var f=p("__geometry"),k=p("__util"),g=p("__config").q;a.aC=function(a){for(var b=k.bb("LINE"),c=[],d=0;d<2*a;d++)c.push(d);d=k.Dc();d.a_point=new Float32Array(c);
b.v[0]=d;b.W=new Uint32Array(c);b.I=2*a;return b};a.bC=function(a,b){var d=c(2,2,a,b);d.name="PLANE";return d};a.$B=c;a.tw=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==B-1)||1==b%2&&(0==a||a==E-1)?!0:!1}var h=c/=Math.pow(2,a-1),v=c,E=b+1,B=b+1;b=[];c=[];for(var x=0,n=0,e=-1,p=[],G=0;G<a;G++){for(var y=2*h/(E-1),A=2*v/(B-1),D=[],L=[],C=0,I=0;I<E;I++){for(var J=-h+I*y,Q=[],N=0;N<B;N++){var u=-v+N*A;if(J>-x&&J<x&&u>-n&&u<n)Q.push(-1),C++;else{for(var P=null,S=0;S<p.length;S+=3)if(J==p[S]&&
u==p[S+1]){P=p[S+2];break}S=null!==P?P:e+1;d(I,N)?(Q.push(-2),C++):(null==P&&(0==N||N==B-1||0==I||I==E-1?(P=G==a-1?y:2*y,D.push(J,u,S)):P=y,c.push(J,P,u),e++),Q.push(S));if(I&&N)if(1==I)if(d(I-1,N)){if(1<N){var u=S-1,P=L[I-1][N+1],Z=P-1;b.push(S,u,Z)}else P=L[I-1][N+1],Z=P-1;b.push(S,Z,P)}else d(I,N)||(u=S-1,P=L[I-1][N],b.push(S,u,P));else if(I==E-1){if(!d(I,N))if(N==B-1)u=S-1,P=L[I-1][N-1],Z=L[I-2][N],b.push(S,u,P),b.push(S,P,Z);else{var u=S-1,P=L[I-1][N],Z=P-1,V=P+1;b.push(S,u,Z);b.push(S,Z,P);
b.push(S,P,V);2==N&&(V=L[I-2][N-2],b.push(u,V,Z))}}else 1==N?d(I,N-1)?(u=L[I-1][N],P=L[I-1][N-1],b.push(S,P,u)):(u=Q[N-1],P=L[I-1][N],Z=L[I-2][N-1],b.push(S,u,P),b.push(u,Z,P)):N==B-1?d(I,N)||(u=Q[N-1],P=L[I-1][N-1],Z=L[I-2][N],b.push(S,u,P),b.push(S,P,Z)):-1!=L[I-1][N]&&-1!=L[I-1][N-1]&&-1!=Q[N-1]?(u=Q[N-1],P=L[I-1][N],Z=L[I-1][N-1],b.push(S,u,P),b.push(u,Z,P),N==B-2&&d(I,N+1)&&(V=L[I-1][N+1],b.push(S,P,V))):N==B-2&&d(I,N+1)&&(P=L[I-1][N],V=L[I-1][N+1],b.push(S,P,V))}}L.push(Q)}p=D;x=h;n=v;h*=2;
v*=2}2E4>x&&(a=-(2*x)/(E-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-x,a,-n),c.push(-x,a,n),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(x,a,-n),c.push(x,a,n),S=e+1,b.push(S+3,S+2,S+1,S+2,S+0,S+1,S+6,S+4,S+2,S+4,S+0,S+2,S+5,S+7,S+1,S+7,S+3,S+1,S+5,S+4,S+7,S+7,S+4,S+6));a=k.Dc();a.a_position=new Float32Array(c);h=k.bb("multigrid_plane");h.v[0]=a;h.W=new Uint32Array(b);h.I=c.length/3;g.ms&&(f.Vm(h,1,!0),a.a_polyindex=f.$o(h));return h};a.ZB=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var c=[],f=[],h=0;h<b;h+=3){var g=a[h+1],E=a[h+2];d(a[h],f);d(g,f);d(E,f);c.push(h,h+1,h+2)}a=k.Dc();a.a_position=new Float32Array(f);b=k.bb("FROM_TRIANGLES");b.v[0]=a;b.W=new Uint32Array(c);b.I=f.length/3;return b};a.YB=b;a.qw=function(a){a=k.vA(a);var c=[];c.push(a[0],a[1],a[2],a[3]);c.push(a[0],a[3],a[5],a[4]);c.push(a[3],a[2],a[6],a[5]);c.push(a[1],a[7],a[6],a[2]);c.push(a[0],a[4],a[7],a[1]);c.push(a[4],a[5],a[6],a[7]);a=b(c);a.name="FRUSTUM";return a};a.Ua=function(){var a=k.bb("FULLSCREEN_TRI"),
b=k.Dc();b.a_position=new Float32Array([0,0,1,0,0,1]);a.v[0]=b;a.W=new Uint32Array([0,1,2]);a.I=3;return a};a.rw=function(){var a=k.bb("FULLSCREEN_QUAD"),b=k.Dc();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.v[0]=b;a.W=new Uint32Array([0,2,1,1,2,3]);a.I=4;return a};a.mw=function(){var a=k.bb("BILLBOARD"),b=k.Dc();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.v[0]=b;a.W=new Uint32Array([0,2,1,0,3,2]);a.I=4;return a};a.nw=function(){var a=k.bb("CUBEMAP_BOARD"),b=k.Dc();b.a_position=
new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.v[0]=b;a.W=new Uint32Array([0,2,1,0,3,2]);a.I=4;return a};a.op=function(a,b){var c=k.bb("UV_SPHERE"),g,w,v=[],E=[],B=[];for(w=0;8>=w;w++)for(g=0;16>=g;g++){var x=g/16,n=w/8;E.push(-a*Math.cos(2*x*Math.PI)*Math.sin(n*Math.PI)+b[0],a*Math.cos(n*Math.PI)+b[1],a*Math.sin(2*x*Math.PI)*Math.sin(n*Math.PI)+b[2])}for(w=x=0;8>w;w++)for(g=0;16>g;g++){var n=h(E,17*w+g+1),e=h(E,17*w+g),p=h(E,17*(w+1)+g),G=h(E,17*(w+1)+g+1);Math.abs(n[1])==a+b[1]?(d(n,v),d(p,v),d(G,v),
B.push(x,x+1,x+2),x+=3):Math.abs(p[1])==a+b[1]?(d(n,v),d(e,v),d(p,v),B.push(x,x+1,x+2),x+=3):(d(n,v),d(e,v),d(p,v),d(G,v),B.push(x,x+1,x+2),B.push(x,x+2,x+3),x+=4)}g={};g.a_position=v;E=f.jo(B,E,v);g.a_normal=f.ho(B,v,E);g.a_tangent=[];c.F.a_influence=[];c.F.a_color=[];c.F.a_texcoord=[];c.v[0]=g;c.W=B;c.I=v.length/3;return c};a.np=function(a){var b=k.bb("INDEX"),c=k.Dc();c.a_index=new Float32Array(a);for(var d=0;d<a;d++)c.a_index[d]=d;b.v[0]=c;b.W=new Uint16Array(0);b.I=a;return b}};b4w.module.__prerender=function(a,p){var c=p("__config"),b=p("__debug"),h=p("__geometry"),d=p("__util"),f=p("__renderer"),k=p("vec3"),g=c.q,m="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH GLOW_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.zm=function(a){if(-1<m.indexOf(a.type)){for(var c=!1,q=a.p,w=0;w<q.length;w++){var v=q[w],E=v,B=a,x=E.fb,n=B.j;E.U=!0;x.is_visible=!1;if(x)if(x.Sh)E.U=!1;else{var e=n.ne,p=x.rb.D,G=x.re,e=Math.sqrt((p[0]-e[0])*(p[0]-e[0])+(p[1]-
e[1])*(p[1]-e[1])+(p[2]-e[2])*(p[2]-e[2])),p=x.Af*x.rb.va;e>=x.Zh&&e<G+p?(x.is_visible=!0,"GLOW_MASK"!=B.type||Boolean(x.nf)?(n=n.zl,x.rg?x=!1:"STATIC"===x.type?(G=x.rb,x=G.D,x=d.vz(x,n,G.va)):(G=x.Ye,x=G.D,x=d.Pv(x,n,G.Ue,G.Ve,G.We)),x?E.U=!1:"WIREFRAME"==B.type&&(E.U=E.o.wireframe_mode==b.Bn.WM_DEBUG_SPHERES?E.o.Gh:!E.o.Gh)):E.U=!1):E.U=!1}else E.U=!1;v.U&&(c=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||c?a.U=!0:(a.U&&f.clear(a),a.U=!1)}}if("MAIN_BLEND"==
a.type&&(c=a.j.ne,k.dist(c,a.os)>g.alpha_sort_threshold&&g.alpha_sort&&a.p)){for(q=0;q<a.p.length;q++)v=a.p[q],E=v.o,w=v.fb.N,E&&E.za&&E.Yd!=h.td&&(E=E.na)&&v.U&&(v=E.zj)&&v.type==h.Cn&&h.Zz(E,w,c);a.os.set(c)}}};b4w.module.__print=function(a){function p(a,b){var c=[];-1<a[0].indexOf("%c")?c.push(a[0].replace("%c","%c"+b+": ")):c.push(b+": "+a[0]);for(var h=1;h<a.length;h++)c.push(a[h]);return c}var c=!1,b=0,h=0;a.cz=function(a){c=a};a.log=function(){if(c){var a=p(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=function(){b++;var a=p(arguments,"B4W ERROR");console.error.apply(console,a)};a.warn=function(){h++;var a=p(arguments,"B4W WARN");console.warn.apply(console,a)};a.info=function(){var a=
p(arguments,"B4W INFO");console.info.apply(console,a)};a.Sv=function(){b++;var a=p(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.Tv=function(){h++;var a=p(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){c&&console.time.apply(console,arguments)};a.timeEnd=function(){c&&console.timeEnd.apply(console,arguments)};a.group=function(){c&&console.group.apply(console,arguments)};a.groupCollapsed=function(){c&&console.groupCollapsed.apply(console,arguments)};
a.groupEnd=function(){c&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.$w=function(){return h};a.Lw=function(){return b};a.clear_errors_warnings=function(){b=h=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,p){function c(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=
.5,b("node material",a,"specular_toon_size"));"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in
a||(a.diffuse_fresnel_factor=.5,b("node material",a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name=
"B4W_"+a.node_tree_name}}}function b(a,b,c){c=c+">>"+a;c in v||(v[c]={Um:[],dr:"undefined",type:a});v[c].Um.push(b.name)}function h(a,b){param_id in v||(v[param_id]={Um:[],dr:"deprecated",type:a});v[param_id].Um.push(b.name)}function d(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=m.af(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var h=m.bj(d[c]);e.submeshes.push(h)}return e}var f=
p("__boundings"),k=p("__curve"),g=p("__print"),m=p("__util"),l=p("vec3"),r=p("vec4"),q=p("quat"),w=p("mat4"),v={};a.Bu=function(a){v={};var d=a.worlds;if(0==d.length){g.warn("WARNING Datablock world is missing, reexport scene");var f={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},b4w_fog_color:[.5,.5,.5],b4w_fog_density:0};d.push(f)}for(var d=a.worlds,l=0;l<d.length;l++){var f=d[l],e=f.b4w_shadow_settings;
"csm_resolution"in e||(b("world",f,"b4w_shadow_settings.csm_resolution"),e.csm_resolution=2048);"self_shadow_polygon_offset"in e||(b("world",f,"b4w_shadow_settings.self_shadow_polygon_offset"),e.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in e||(b("world",f,"b4w_shadow_settings.self_shadow_normal_offset"),e.self_shadow_normal_offset=.01);"b4w_enable_csm"in e||(b("world",f,"b4w_shadow_settings.b4w_enable_csm"),e.b4w_enable_csm=!1);"csm_num"in e||(b("world",f,"b4w_shadow_settings.csm_num"),
e.csm_num=1);"csm_first_cascade_border"in e||(b("world",f,"b4w_shadow_settings.csm_first_cascade_border"),e.csm_first_cascade_border=10);"first_cascade_blur_radius"in e||(b("world",f,"b4w_shadow_settings.first_cascade_blur_radius"),e.first_cascade_blur_radius=3);"csm_last_cascade_border"in e||(b("world",f,"b4w_shadow_settings.csm_last_cascade_border"),e.csm_last_cascade_border=100);"last_cascade_blur_radius"in e||(b("world",f,"b4w_shadow_settings.last_cascade_blur_radius"),e.last_cascade_blur_radius=
1.5);"fade_last_cascade"in e||(b("world",f,"b4w_shadow_settings.fade_last_cascade"),e.fade_last_cascade=!0);"blend_between_cascades"in e||(b("world",f,"b4w_shadow_settings.blend_between_cascades"),e.blend_between_cascades=!0);e=f.b4w_ssao_settings;"dist_factor"in e||(b("world",f,"b4w_ssao_settings.dist_factor"),e.dist_factor=0,e.samples=16);"hemisphere"in e||(b("world",f,"b4w_ssao_settings.hemisphere"),e.hemisphere=!1);"blur_depth"in e||(b("world",f,"b4w_ssao_settings.blur_depth"),e.blur_depth=!1);
"blur_discard_value"in e||(b("world",f,"b4w_ssao_settings.blur_discard_value"),e.blur_discard_value=1);"b4w_glow_color"in f||(f.b4w_glow_color=[1,1,1],b("object",f,"b4w_glow_color"));"b4w_glow_factor"in f||(f.b4w_glow_factor=1,b("object",f,"b4w_glow_factor"));"b4w_fog_density"in f||(b("world",f,"b4w_fog_density"),f.b4w_fog_density=0);"b4w_sky_settings"in f&&"rayleigh_brightness"in f.b4w_sky_settings||(b("world",f,"rayleigh_brightness"),f.b4w_sky_settings={procedural_skydome:!1,use_as_enviroment_map:!1,
color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"b4w_bloom_settings"in f?("blur"in f.b4w_bloom_settings||(b("world",f,"b4w_bloom_settings.blur"),f.b4w_bloom_settings.blur=4),"edge_lum"in f.b4w_bloom_settings||(b("world",f,"b4w_bloom_settings.edge_lum"),f.b4w_bloom_settings.edge_lum=1)):(b("world",f,"b4w_bloom_settings"),f.b4w_bloom_settings=
{key:.2,blur:4});"b4w_motion_blur_settings"in f?("motion_blur_factor"in f.b4w_motion_blur_settings||(b("world",f,"b4w_motion_blur_settings.motion_blur_factor"),f.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in f.b4w_motion_blur_settings||(b("world",f,"b4w_motion_blur_settings.motion_blur_decay_threshold"),f.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(b("world",f,"b4w_motion_blur_settings"),f.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});
"b4w_color_correction_settings"in f||(b("world",f,"b4w_color_correction_settings"),f.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in f.b4w_god_rays_settings||(b("world",f,"b4w_god_rays_settings.steps_per_pass"),f.b4w_god_rays_settings.steps_per_pass=10)}d=a.scenes;for(l=0;l<d.length;l++)f=d[l],"b4w_use_nla"in f||(f.b4w_use_nla=!1,b("scene",f,"b4w_use_nla")),"fps"in f||(f.fps=24,b("scene",f,"fps")),"b4w_nla_cyclic"in f||(f.b4w_nla_cyclic=!1,b("scene",
f,"b4w_nla_cyclic")),"b4w_nla_script"in f||(f.b4w_nla_script=[],b("scene",f,"b4w_nla_script")),"b4w_detect_collisions"in f&&(h("scene",f),delete f.b4w_detect_collisions),"audio_doppler_speed"in f||(f.audio_doppler_speed=343.3),"audio_doppler_factor"in f||(f.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in f||(f.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",f,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in f||(f.b4w_enable_convolution_engine=
!1),"b4w_enable_bloom"in f||(f.b4w_enable_bloom=!1,b("scene",f,"b4w_enable_bloom")),"b4w_enable_motion_blur"in f||(f.b4w_enable_motion_blur=!1,b("scene",f,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in f||(f.b4w_enable_color_correction=!1,b("scene",f,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in f||(f.b4w_enable_antialiasing=!0,b("scene",f,"b4w_enable_antialiasing")),"b4w_tags"in f||(f.b4w_tags={title:"",description:""},b("scene",f,"b4w_tags"));f=a.meshes;for(l=0;l<f.length;l++)for(e=
f[l],e.b4w_bounding_box||(b("mesh",e,"b4w_bounding_box"),e.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0}),e.uv_textures||(b("mesh",e,"uv_textures"),e.uv_textures=[]),e.b4w_bounding_sphere_center||(e.b4w_bounding_sphere_center=[0,0,0]),e.b4w_bounding_cylinder_center||(e.b4w_bounding_cylinder_center=[0,0,0]),e.b4w_bounding_ellipsoid_center||(e.b4w_bounding_ellipsoid_center=[0,0,0]),e.b4w_bounding_ellipsoid_axes||(d=e.b4w_bounding_box,e.b4w_bounding_ellipsoid_axes=[(d.max_x-d.min_x)/
2,(d.max_y-d.min_y)/2,(d.max_z-d.min_z)/2]),d=0;d<e.b4w_vertex_anim.length;d++){var k=e.b4w_vertex_anim[d];"allow_nla"in k||(b('mesh["b4w_vertex_anim"]',e,"allow_nla"),k.allow_nla=!0)}d=a.cameras;for(l=0;l<d.length;l++)f=d[l],f.type||(f.type="PERSP",b("camera",f,"type")),"b4w_eye_target_dist"in f&&(delete f.b4w_eye_target_dist,h("camera",f)),"b4w_trans_velocity"in f||(f.b4w_trans_velocity=1,b("camera",f,"b4w_trans_velocity")),"b4w_rot_velocity"in f||(f.b4w_rot_velocity=1,b("camera",f,"b4w_rot_velocity")),
"b4w_zoom_velocity"in f||(f.b4w_zoom_velocity=.1,b("camera",f,"b4w_zoom_velocity")),"b4w_use_distance_limits"in f||(f.b4w_use_distance_limits=!1,b("camera",f,"b4w_use_distance_limits")),"b4w_distance_min"in f||(f.b4w_distance_min=1,b("camera",f,"b4w_distance_min")),"b4w_distance_max"in f||(f.b4w_distance_max=100,b("camera",f,"b4w_distance_max")),"b4w_horizontal_translation_min"in f||(f.b4w_horizontal_translation_min=-100,b("camera",f,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in
f||(f.b4w_horizontal_translation_max=100,b("camera",f,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in f||(f.b4w_vertical_translation_min=-100,b("camera",f,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in f||(f.b4w_vertical_translation_max=100,b("camera",f,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in f||(f.b4w_use_horizontal_clamping=!1,b("camera",f,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in f||(f.b4w_rotation_left_limit=-Math.PI,
b("camera",f,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in f||(f.b4w_rotation_right_limit=Math.PI,b("camera",f,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in f||(f.b4w_horizontal_clamping_type="LOCAL",b("camera",f,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in f||(f.b4w_use_vertical_clamping=!1,b("camera",f,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in f||(f.b4w_rotation_down_limit=-Math.PI/2,b("camera",f,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in
f||(f.b4w_rotation_up_limit=Math.PI/2,b("camera",f,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in f||(f.b4w_vertical_clamping_type="LOCAL",b("camera",f,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in f||(f.b4w_hover_angle_min=Math.PI/6,b("camera",f,"b4w_hover_angle_min")),"b4w_hover_angle_max"in f||(f.b4w_hover_angle_max=Math.PI/6,b("camera",f,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in f||(f.b4w_enable_hover_hor_rotation=!0,b("camera",f,"b4w_enable_hover_hor_rotation")),
"b4w_use_panning"in f||(f.b4w_use_panning=!0,b("camera",f,"b4w_use_panning"));d=a.lamps;for(l=0;l<d.length;l++)f=d[l],"b4w_generate_shadows"in f||(f.b4w_generate_shadows=!1,b("lamp",f,"b4w_generate_shadows")),"b4w_dynamic_intensity"in f||(f.b4w_dynamic_intensity=!1,b("lamp",f,"b4w_dynamic_intensity")),"use_diffuse"in f||(f.use_diffuse=!0,b("lamp",f,"use_diffuse")),"use_specular"in f||(f.use_specular=!0,b("lamp",f,"use_specular"));d=a.speakers;for(l=0;l<d.length;l++)f=d[l],"b4w_behavior"in f||(f.b4w_behavior=
f.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in f||(f.b4w_disable_doppler=!1),"b4w_delay"in f||(f.b4w_delay=0),"b4w_delay_random"in f||(f.b4w_delay_random=0),"b4w_volume_random"in f||(f.b4w_volume_random=0),"b4w_pitch_random"in f||(f.b4w_pitch_random=0),"b4w_fade_in"in f||(f.b4w_fade_in=0),"b4w_fade_out"in f||(f.b4w_fade_out=0),"b4w_loop"in f||(f.b4w_loop=!1),"b4w_loop_count"in f||(f.b4w_loop_count=0),"b4w_loop_count_random"in f||(f.b4w_loop_count_random=0),"b4w_playlist_id"in
f||(f.b4w_playlist_id="");d=a.textures;for(l=0;l<d.length;l++)f=d[l],"b4w_anisotropic_filtering"in f||(f.b4w_anisotropic_filtering="OFF",b("texture",f,"b4w_anisotropic_filtering")),"b4w_water_foam"in f||(f.b4w_water_foam=!1,b("texture",f,"b4w_water_foam")),"b4w_foam_uv_freq"in f||(f.b4w_foam_uv_freq=[1,1],b("texture",f,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in f||(f.b4w_foam_uv_magnitude=[1,1],b("texture",f,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in f||(f.b4w_parallax_steps=5,b("material",
f,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in f||(f.b4w_parallax_lod_dist=10,b("material",f,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in f||(f.b4w_shore_dist_map=!1,b("texture",f,"b4w_shore_dist_map")),"b4w_shore_boundings"in f||(f.b4w_shore_boundings=new Float32Array(4),f.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",f,"b4w_shore_boundings")),"b4w_max_shore_dist"in f||(f.b4w_max_shore_dist=100,b("texture",f,"b4w_max_shore_dist")),"b4w_disable_compression"in f||(f.b4w_disable_compression=
!1,b("texture",f,"b4w_disable_compression")),"b4w_source_type"in f||(f.b4w_source_type="",b("texture",f,"b4w_source_type")),"b4w_source_id"in f||(f.b4w_source_id="",b("texture",f,"b4w_source_id")),"b4w_source_size"in f||(f.b4w_source_size=1024,b("texture",f,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in f||(f.b4w_enable_canvas_mipmapping=!0,b("texture",f,"b4w_enable_canvas_mipmapping"));f=a.materials;for(l=0;l<f.length;l++){e=f[l];"b4w_node_mat_type"in e&&h("material",e);"b4w_skydome"in e&&
h("material",e);"b4w_procedural_skydome"in e&&h("material",e);e.b4w_water&&("b4w_water_shore_smoothing"in e||(e.b4w_water_shore_smoothing=!1,b("material",e,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in e||(e.b4w_water_dynamic=!1,b("material",e,"b4w_water_dynamic")),"b4w_waves_height"in e||(e.b4w_waves_height=1,b("material",e,"b4w_waves_height")),"b4w_waves_length"in e||(e.b4w_waves_length=1,b("material",e,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in e||(e.b4w_water_dst_noise_scale0=.05,
b("material",e,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in e||(e.b4w_water_dst_noise_scale1=.03,b("material",e,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in e||(e.b4w_water_dst_noise_freq0=1.3,b("material",e,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in e||(e.b4w_water_dst_noise_freq1=1,b("material",e,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in e||(e.b4w_water_dir_min_shore_fac=.4,b("material",e,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in
e||(e.b4w_water_dir_freq=.5,b("material",e,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in e||(e.b4w_water_dir_noise_scale=.05,b("material",e,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in e||(e.b4w_water_dir_noise_freq=.07,b("material",e,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in e||(e.b4w_water_dir_min_noise_fac=.5,b("material",e,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in e||(e.b4w_water_dst_min_fac=.2,b("material",e,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in
e||(e.b4w_water_waves_hor_fac=5,b("material",e,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in e||(e.b4w_water_absorb_factor=6,b("material",e,"b4w_water_absorb_factor")),"b4w_water_fog_color"in e||(e.b4w_water_fog_color=new Float32Array(3),e.b4w_water_fog_color=[.5,.7,.7],b("material",e,"b4w_water_fog_color")),"b4w_foam_factor"in e||(e.b4w_foam_factor=5,b("material",e,"b4w_foam_factor")),"b4w_generated_mesh"in e||(e.b4w_generated_mesh=!1,b("material",e,"b4w_generated_mesh")),"b4w_water_num_cascads"in
e||(e.b4w_water_num_cascads=5,b("material",e,"b4w_water_num_cascads")),"b4w_water_subdivs"in e||(e.b4w_water_subdivs=64,b("material",e,"b4w_water_subdivs")),"b4w_water_detailed_dist"in e||(e.b4w_water_detailed_dist=1E3,b("material",e,"b4w_water_detailed_dist")));"b4w_dynamic_grass_size"in e||(e.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in e||(e.b4w_dynamic_grass_color="");"diffuse_intensity"in e||(e.diffuse_intensity=1,b("material",e,"diffuse_intensity"));"b4w_use_ghost"in e||(e.b4w_use_ghost=
!1);"b4w_collision_group"in e||(e.b4w_collision_group=128,b("material",e,"b4w_collision_group"));"b4w_collision_mask"in e||(e.b4w_collision_mask=127,b("material",e,"b4w_collision_mask"));"b4w_do_not_render"in e||(e.b4w_do_not_render=!1,b("material",e,"b4w_do_not_render"));"HALO"!=e.type||"b4w_halo_sky_stars"in e||(e.b4w_halo_sky_stars=!1,b("material",e,"b4w_halo_sky_stars"));"HALO"!=e.type||"b4w_halo_stars_blend_height"in e||(e.b4w_halo_stars_blend_height=10,b("material",e,"b4w_halo_stars_blend_height"));
"HALO"!=e.type||"b4w_halo_stars_min_height"in e||(e.b4w_halo_stars_min_height=0,b("material",e,"b4w_halo_stars_min_height"));"specular_shader"in e||(e.specular_shader="COOKTORR",b("material",e,"specular_shader"));"diffuse_shader"in e||(e.diffuse_shader="LAMBERT",b("material",e,"diffuse_shader"));"roughness"in e||(e.roughness=.5,b("material",e,"roughness"));"diffuse_fresnel"in e||(e.diffuse_fresnel=.1,b("material",e,"diffuse_fresnel"));"diffuse_fresnel_factor"in e||(e.diffuse_fresnel_factor=.5,b("material",
e,"diffuse_fresnel_factor"));"specular_slope"in e||(e.specular_slope=.2,b("material",e,"specular_slope"));"specular_toon_size"in e||(e.specular_toon_size=.5,b("material",e,"specular_toon_size"));"specular_toon_smooth"in e||(e.specular_toon_smooth=.1,b("material",e,"specular_toon_smooth"));"specular_alpha"in e||(e.specular_alpha=1,b("material",e,"specular_alpha"));"b4w_wettable"in e||(e.b4w_wettable=!1,b("material",e,"b4w_wettable"));"b4w_refractive"in e||(e.b4w_refractive=!1,b("material",e,"b4w_refractive"));
"b4w_refr_bump"in e||(e.b4w_refr_bump=0,b("material",e,"b4w_refr_bump"));"b4w_shallow_water_col"in e||(e.b4w_shallow_water_col=[0,.8,.3],b("material",e,"b4w_shallow_water_col"));"b4w_shore_water_col"in e||(e.b4w_shore_water_col=[0,.9,.2],b("material",e,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in e||(e.b4w_shallow_water_col_fac=1,b("material",e,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in e||(e.b4w_shore_water_col_fac=.5,b("material",e,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in
e||(e.b4w_water_sss_strength=5.9,b("material",e,"b4w_water_sss_strength"));"b4w_water_sss_width"in e||(e.b4w_water_sss_width=.45,b("material",e,"b4w_water_sss_width"));"b4w_render_above_all"in e||(e.b4w_render_above_all=!1,b("material",e,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in e||(e.b4w_water_norm_uv_velocity=.05,b("material",e,"b4w_water_norm_uv_velocity"));k=e.texture_slots;for(d=0;d<k.length;d++){var q=k[d];"blend_type"in q||(q.blend_type="MIX",b("texture_slot",q,"blend_type"))}if(e.node_tree)for(e=
e.node_tree.nodes,d=0;d<e.length;d++)c(e[d])}f=a.node_groups;for(l=0;l<f.length;l++)for(e=f[l].node_tree.nodes,d=0;d<e.length;d++)c(e[d]);f=a.objects;for(l=0;l<f.length;l++){e=f[l];switch(e.type){case "MESH":"b4w_dynamic_geometry"in e||(e.b4w_dynamic_geometry=!1);"b4w_reflexible"in e||(e.b4w_reflexible=!1);"b4w_reflexible_only"in e||(e.b4w_reflexible_only=!1);"b4w_reflective"in e||(e.b4w_reflective=!1);"b4w_wind_bending"in e||(e.b4w_wind_bending=!1,b("object",e,"b4w_wind_bending"));"b4w_wind_bending_angle"in
e||(e.b4w_wind_bending_angle=10,e.b4w_wind_bending_freq=.25,b("object",e,"wind bending params"));"b4w_detail_bending_amp"in e||(e.b4w_detail_bending_amp=.1,e.b4w_branch_bending_amp=.3,b("object",e,"detail bending params"));"b4w_detail_bending_freq"in e||(e.b4w_detail_bending_freq=1,b("object",e,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in e||(e.b4w_main_bend_stiffness_col="",b("object",e,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in e||(e.b4w_detail_bend_colors={leaves_stiffness_col:"",
leaves_phase_col:"",overall_stiffness_col:""},b("object",e,"b4w_detail_bend_colors"));"b4w_caustics"in e||(e.b4w_caustics=!1);"vertex_groups"in e&&e.vertex_groups.length&&e.data&&0==e.data.vertex_groups.length&&(e.data.vertex_groups=e.vertex_groups,delete e.vertex_groups,b("object",e,"vertex_groups"));"b4w_vertex_anim"in e&&e.b4w_vertex_anim.length&&e.data&&0==e.data.b4w_vertex_anim.length&&(e.data.b4w_vertex_anim=e.b4w_vertex_anim,delete e.b4w_vertex_anim,b("object",e,"b4w_vertex_anim"));"b4w_do_not_render"in
e||(e.b4w_do_not_render=!1);"use_ghost"in e.game||(e.game.use_ghost=!1);"use_sleep"in e.game||(e.game.use_sleep=!1);"velocity_min"in e.game||(e.game.velocity_min=0);"velocity_max"in e.game||(e.game.velocity_max=0);"collision_group"in e.game||(e.game.collision_group=1);"collision_mask"in e.game||(e.game.collision_mask=255);"b4w_vehicle_settings"in e?e.b4w_vehicle_settings&&("steering_ratio"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.steering_ratio=10),"steering_max"in e.b4w_vehicle_settings||
(e.b4w_vehicle_settings.steering_max=1),"inverse_control"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.inverse_control=!1),"force_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.force_max=1500),"brake_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.brake_max=100),"speed_ratio"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in e.b4w_vehicle_settings||
(e.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.roll_influence=
.1),"max_suspension_travel_cm"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.floating_factor=3),"floating_factor"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.water_rot_damp=.9)):(e.b4w_vehicle_settings=null,b("object",e,"b4w_vehicle_settings"));
"b4w_floating_settings"in e?e.b4w_floating_settings&&("floating_factor"in e.b4w_floating_settings||(e.b4w_floating_settings.floating_factor=3),"water_lin_damp"in e.b4w_floating_settings||(e.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in e.b4w_floating_settings||(e.b4w_floating_settings.water_rot_damp=.8)):(e.b4w_floating_settings=null,b("object",e,"b4w_floating_settings"));"b4w_character_settings"in e?e.b4w_character_settings&&("walk_speed"in e.b4w_character_settings||(e.b4w_character_settings.walk_speed=
4),"run_speed"in e.b4w_character_settings||(e.b4w_character_settings.run_speed=8),"step_height"in e.b4w_character_settings||(e.b4w_character_settings.step_height=.25),"jump_strength"in e.b4w_character_settings||(e.b4w_character_settings.jump_strength=5),"waterline"in e.b4w_character_settings||(e.b4w_character_settings.waterline=0)):(e.b4w_character_settings=null,b("object",e,"b4w_character_settings"));"b4w_selectable"in e||(e.b4w_selectable=!1,b("object",e,"b4w_selectable"));"b4w_billboard"in e||
(e.b4w_billboard=!1,b("object",e,"b4w_billboard"));"b4w_billboard_geometry"in e||(e.b4w_billboard_geometry="SPHERICAL",b("object",e,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in e||(e.b4w_pres_glob_orientation=!1,b("object",e,"b4w_pres_glob_orientation"));"b4w_glow_settings"in e||(e.b4w_glow_settings={},e.b4w_glow_settings.glow_duration=1,e.b4w_glow_settings.glow_period=1,e.b4w_glow_settings.glow_relapses=0,b("object",e,"b4w_glow_settings"));"b4w_lod_transition"in e||(e.b4w_lod_transition=
.01,b("object",e,"b4w_lod_transition"));"lod_levels"in e||(e.lod_levels=[],b("object",e,"lod_levels"));"b4w_animation_mixing"in e||(e.b4w_animation_mixing=!1,b("object",e,"b4w_animation_mixing"));break;case "EMPTY":"b4w_group_relative"in e||(e.b4w_group_relative=!1,b("object",e,"b4w_group_relative")),"b4w_anchor"in e||(e.b4w_anchor=null,b("object",e,"b4w_anchor"))}"b4w_anim_behavior"in e||(e.b4w_anim_behavior=e.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",e,"b4w_anim_behavior"));if(!("rotation_quaternion"in
e)){d=[0,0,0,1];m.euler_to_quat(e.rotation_euler,d);var k=d,q=d[0],r=d[1],w=d[2];k[0]=d[3];k[1]=q;k[2]=r;k[3]=w;e.rotation_quaternion=d;b("object",e,"rotation_quaternion")}"webgl_do_not_batch"in e&&(e.b4w_do_not_batch=e.webgl_do_not_batch)&&h("object",e);"b4w_shadow_cast_only"in e||(e.b4w_shadow_cast_only=!1,b("object",e,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in e||(e.b4w_correct_bounding_offset="AUTO",b("object",e,"b4w_correct_bounding_offset"));k=e.particle_systems;for(d=0;d<k.length;d++)q=
k[d],r=q.settings,"use_whole_group"in r||(r.use_whole_group=!1,b("object",r,"use_whole_group")),q.transforms||(q.transforms=new Float32Array,b("particle_system",q,"transforms")),"b4w_billboard_align"in r||(r.b4w_billboard_align="VIEW",b("particle_settings",r,"b4w_billboard_align")),"b4w_dynamic_grass"in r||(r.b4w_dynamic_grass=!1,b("object",r,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in r||(r.b4w_dynamic_grass_scale_threshold=.01,b("object",r,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in
r||(r.b4w_initial_rand_rotation=!1,b("particle_settings",r,"b4w_initial_rand_rotation")),"b4w_rotation_type"in r||(r.b4w_rotation_type="Z",b("particle_settings",r,"b4w_rotation_type")),"b4w_rand_rotation_strength"in r||(r.b4w_rand_rotation_strength=1,b("particle_settings",r,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in r||(r.b4w_hair_billboard=!1,b("particle_settings",r,"b4w_hair_billboard")),"b4w_hair_billboard_type"in r||(r.b4w_hair_billboard_type="BASIC",b("particle_settings",r,"b4w_hair_billboard_type")),
"b4w_hair_billboard_jitter_amp"in r||(r.b4w_hair_billboard_jitter_amp=0,b("particle_settings",r,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in r||(r.b4w_hair_billboard_jitter_freq=0,b("particle_settings",r,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in r||(r.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",r,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in r||(r.b4w_wind_bend_inheritance="PARENT",b("particle_settings",r,"b4w_wind_bend_inheritance")),
"b4w_shadow_inheritance"in r||(r.b4w_shadow_inheritance="PARENT",b("particle_settings",r,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in r||(r.b4w_reflection_inheritance="PARENT",b("particle_settings",r,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in r||(r.b4w_vcol_from_name="",b("particle_settings",r,"b4w_vcol_from_name")),"b4w_vcol_to_name"in r||(r.b4w_vcol_to_name="",b("particle_settings",r,"b4w_vcol_to_name")),"b4w_coordinate_system"in r||(r.b4w_coordinate_system="LOCAL",b("particle_settings",
r,"b4w_coordinate_system")),"b4w_allow_nla"in r||(r.b4w_allow_nla=!0,b("particle_settings",r,"b4w_allow_nla"));"constraints"in e||(e.constraints=[],b("object",e,"constraints"));k=e.modifiers;for(d=0;d<k.length;d++){a:{q=k[d];switch(q.type){case "ARRAY":if(!("fit_type"in q)){g.error("WARNING Incomplete modifier "+String(q.type)+' for "'+e.name+'", reexport '+(e.library?"library"+e.library.split("/").slice(-1)[0]:"main scene"));q=!1;break a}}q=!0}q||(k.splice(d,1),d--)}"animation_data"in e||(e.animation_data=
{action:null,nla_tracks:[]},b("object",e,"animation_data"));if(e.animation_data)for(("action"in e.animation_data)||(e.animation_data.action=null,g.warn("no action in animation data "+e.name)),("nla_tracks"in e.animation_data)||(e.animation_data.nla_tracks=[],g.warn("no NLA in animation data "+e.name)),k=e.animation_data.nla_tracks,d=0;d<k.length;d++)for(q=k[d],r=0;r<q.strips.length;r++)w=q.strips[r],"action"in w||(w.action=null,g.warn("no action in NLA strip "+e.name)),"action_frame_start"in w||(w.action_frame_start=
0,g.warn("no action_frame_start in NLA strip "+e.name)),"action_frame_end"in w||(w.action_frame_end=w.frame_end-w.frame_start,g.warn("no action_frame_start in NLA strip "+e.name));"b4w_collision_id"in e||(e.b4w_collision_id="",b("material",e,"b4w_collision_id"));d=e.scale;0==d[0]&&0==d[1]&&0==d[2]?d=!0:(k=Math.abs((d[1]-d[2])/d[1]),d=.001>Math.abs((d[0]-d[1])/d[0])&&.001>k);d||g.warn("non-uniform scale for object "+e.name)}for(var p in v)l=v[p],d=p.match(/.*?(?=>>|$)/i)[0],g.warn("WARNING "+String(d)+
" is "+l.dr+" for "+l.type+", reexport "+a.b4w_filepath_blend)};a.yu=function(a,b){"num_channels"in a||(a.num_channels=1,g.warn('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport '+(b.library?"library"+b.library.split("/").slice(-1)[0]:"main scene")))};a.au=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var h=b[c].type;if("ARRAY"==h||"CURVE"==h){b=!0;break a}}b=!1}if(!b)return null;b=d(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var e=
a[c];switch(e.type){case "ARRAY":for(var h=b,g=e,v=0,y=0,p=0,D=new Float32Array(16),e=[],L=1;L<g.count;L++){g.use_constant_offset&&(v+=g.constant_offset_displace[0],y+=g.constant_offset_displace[1],p+=g.constant_offset_displace[2]);if(g.use_relative_offset)var C=h.b4w_bounding_box,v=v+(C.max_x-C.min_x)*g.relative_offset_displace[0],y=y+(C.max_y-C.min_y)*g.relative_offset_displace[1],p=p+(C.max_z-C.min_z)*g.relative_offset_displace[2];m.Qz(v,y,p,D);for(var I=C=d(h),J=D,Q=0;Q<I.submeshes.length;Q++){var N=
I.submeshes[Q];m.ve(N.position,J,N.position,0);m.wA(N.normal,J,N.normal);m.Nz(N.tangent,J,N.tangent)}e.push(C)}for(L=0;L<e.length;L++)for(g=h,v=e[L],y=0;y<g.submeshes.length;y++){p=g.submeshes[y];D=v.submeshes[y];C=p.base_length;I=p.indices.length;p.base_length+=D.base_length;for(var u in p)if("base_length"!=u)if("indices"==u)for(p[u]=m.Tz(p[u],D[u]),J=I;J<p.indices.length;J++)p.indices[J]+=C;else"vertex_colors"!=u&&(p[u]=m.bw(p[u],D[u]))}break;case "CURVE":for(var h=b,L=e.object.Ft,g=new Float32Array(16),
y=L.qe?4:3,v=new Float32Array(y),y=new Float32Array(y),p=new Float32Array(3),D=new Float32Array(4),C=new Float32Array(4),I=new Float32Array(3),J=new Float32Array(3),Q=new Float32Array(3),N=new Float32Array(4),P=new Float32Array(4),S=0;S<h.submeshes.length;S++){var Z=h.submeshes[S],V=Z.position,fa=Z.normal,Z=Z.tangent,Y;a:switch(Y=e.deform_axis,Y){case "POS_X":case "NEG_X":Y=0;break a;case "POS_Y":case "NEG_Y":Y=1;break a;case "POS_Z":case "NEG_Z":Y=2;break a;default:throw"Wrong deform axis value "+
Y;}I[0]=0;I[1]=0;I[2]=0;I[Y]=1;for(var ha=k.yz(L),R=0;R<V.length/3;R++){Q[0]=V[3*R];Q[1]=V[3*R+1];Q[2]=V[3*R+2];var X=Q[Y],z=k.xz(L,X);k.zz(L,z,v);p[0]=v[0];p[1]=v[1];p[2]=v[2];k.wz(L,z,y);J[0]=y[0];J[1]=0;J[2]=y[2];l.normalize(J,J);q.rotationTo(I,J,D);0>X?(v[0]=J[0],v[1]=J[1],v[2]=J[2],l.scale(v,X,v),l.add(p,v,p)):X>ha&&(v[0]=J[0],v[1]=J[1],v[2]=J[2],l.scale(v,X-ha,v),l.add(p,v,p));w.fromRotationTranslation(D,p,g);L.qe&&(q.setAxisAngle(I,v[3],C),l.transformQuat(Q,C,Q));Q[Y]=0;l.transformMat4(Q,g,
Q);V[3*R]=Q[0];V[3*R+1]=Q[1];V[3*R+2]=Q[2];fa.length&&(N[0]=fa[3*R],N[1]=fa[3*R+1],N[2]=fa[3*R+2],N[3]=0,r.transformMat4(N,g,N),fa[3*R]=N[0],fa[3*R+1]=N[1],fa[3*R+2]=N[2]);Z.length&&(P[0]=Z[3*R],P[1]=Z[3*R+1],P[2]=Z[3*R+2],P[3]=0,r.transformMat4(P,g,P),Z[3*R]=P[0],Z[3*R+1]=P[1],Z[3*R+2]=P[2])}}}f.oy(b)}return b};a.AB=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,
fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,
elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.gu=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_use_nla)for(var d=d.b4w_nla_script,e=0;e<d.length;e++){var f=d[e];switch(f.type){case "SELECT":case "SELECT_PLAY":for(var h=
0;h<a.length;h++){var g=a[h];g.name==f.object&&(g.b4w_selectable=!0)}break;case "SHOW":case "HIDE":for(h=0;h<a.length;h++)g=a[h],g.name==f.object&&(g.b4w_do_not_batch=!0)}}}}};b4w.module.__scenegraph=function(a,p){function c(a){a=ua.sa(a);a.Id=null;a.sb=null;a.rc=null;return a}function b(a,b){var c=[];M.Ke(a,function(b,t,e){-1<c.indexOf(e)?M.yy(a,b,t,e,d(e)):c.push(e)});M.P(a,function(t,e){for(var f=0;f<e.ia.length;f++){var h=e.ia[f];b||"MAIN_REFLECT"!=e.type||(h.Xf=!0);-1<c.indexOf(h)?e.ia[f]=d(h):c.push(h)}"ANTIALIASING"==e.type&&M.Vd(a,t,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.ia.length;c++){var d=b.ia[c];d.ua=ja.G;d.ta=ja.G}});b||M.Vd(a,t,function(a,
b,c){"DEPTH"==c.K&&(c.Xf=!0)})});M.P(a,function(b){var c={};h(a,b,c);for(var d in c){b=c[d];for(var t=b[0],e=0;e<b.length;e++)if(b[e].ua==ja.G){t=b[e];break}for(var f=b[0],e=0;e<b.length;e++)if(b[e].ta==ja.G){f=b[e];break}for(var g=b[0],e=0;e<b.length;e++)if(!b[e].Xf){g=b[e];break}for(e=0;e<b.length;e++)b[e].ua=t.ua,b[e].ta=f.ta,b[e].Xf=g.Xf}})}function h(a,b,c){M.Vd(a,b,function(b,d,e){e.Fa&&e.K==e.Y&&(c[e.K]=c[e.K]||[],-1==c[e.K].indexOf(e)&&c[e.K].push(e),h(a,b,c))});M.Le(a,b,function(a,b,d){d.Fa&&
(c[d.K]=c[d.K]||[],-1==c[d.K].indexOf(d)&&c[d.K].push(d))});b=M.cb(a,b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.ia.length;d++){var e=b.ia[d];c[e.K].push(e)}}function d(a){if(a.ja)throw"Failed to clone slink with attached texture";return ua.af(a)}function f(a){var b=M.$m(a),c=[];M.P(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var e=[];break;default:e=c}for(var t=0;t<d.ia.length;t++){var f=d.ia[t],h=r(e,f,g(f));f.ja=h;
d.kd[t]=h}for(t=0;t<d.kd.length;t++)h=d.kd[t],l(e,h);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":e=[]}M.Le(b,a,function(c,d,t){if(!t.ja){if((c=m(b,a,t.K))&&t.Fa&&!t.ja){d=e;for(var f=c,h=0;h<d.length;h++){var K=d[h];K.Xm===f&&K.ji++}}else c=r(e,t,g(t));t.ja=c}});M.Vd(b,a,function(a,b,c){l(e,c.ja)});M.Le(b,a,function(a,b,c){c.ja&&"NONE"==c.Y&&l(e,c.ja)})})}function k(a){w(a,function(b,c,d){b.ph&&(ca(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&
"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||ca(a,d,"ANTIALIASING")||"ANCHOR_VISIBILITY"==d.type)&&(b.Ee*=jb.resolution_factor)})}function g(a){a=ua.af(a);delete a.Y;delete a.Fa;delete a.ja;return JSON.stringify(a)}function m(a,b,c){var d=null;M.Vd(a,b,function(a,b,e){if(e.Fa&&e.K==e.Y&&e.K==c&&e.ja)return d=e.ja,!0});M.Le(a,b,function(a,b,e){if(e.Fa&&e.K==c&&e.ja)return d=e.ja,!0});return d}function l(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.Xm===b&&d.ji&&d.ji--}}function r(a,b,c){for(var d=null,e=
0;e<a.length;e++){var t=a[e];if(t.id==c&&0===t.ji){d=t;break}}if(d)return d.ji++,d.Xm;b=q(b);a.push({id:c,ji:1,Xm:b});return b}function q(a){var b=a.Ee*a.size;switch(a.K){case "COLOR":var c=ja.hj("COLOR",ja.gg);ja.resize(c,b,b);ja.Gm(c,a.ua,a.ta);return c;case "DEPTH":return a.Xf?(c=ja.hj("DEPTH_RBUF",ja.fg),ja.resize(c,b,b)):(c=ja.hj("DEPTH_TEX",ja.vh),ja.resize(c,b,b),ja.Gm(c,a.ua,a.ta)),c;case "CUBEMAP":return c=ja.Zu(b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.K;}}function w(a,
b){var c=!1;M.Ke(a,function(d,e,t){if(t&&(d=M.cb(a,d),e=M.cb(a,e),b(t,!1,d,e)))return c=!0});c||M.P(a,function(a,c){for(var d=0;d<c.ia.length;d++)if(b(c.ia[d],!0,c,null))return!0})}function v(a){M.P(a,function(b,c){if("SINK"!=c.type){var d=c.j;M.Le(a,b,function(a,b,c){c.Fa&&c.ja&&(da.ck(d,c.K,c.ja),c.K==c.Y&&b.j&&da.ck(b.j,c.K,c.ja))});for(var e=0;e<c.ia.length;e++){var t=c.ia[e];t.Fa&&t.K==t.Y&&da.ck(d,t.K,c.kd[e])}!d.sb&&!d.rc||d.Id||(d.Id=Db.xy(d.sb,d.rc))}})}function E(a){var b=null,c=0;M.P(a,
function(a,d){if(d.type==Za.Jz){if(c==Za.Iz)return b=d,!0;c++}});return b}function B(a,b){var c=M.Og(a,b),d=y("NONE"),t=M.A(a,d),f=M.zp(a)[0];M.Ke(a,function(b,c){c==f&&M.py(a,b,f,b,t)});M.Ke(a,function(t,f,h){if(t==c)return M.m(a,b,d,e(Za.jz,"u_color",h.size,h.Ee,h.ph)),!0});M.de(a,t,f,e("SCREEN","NONE",.5,.5,!0))}function x(a,b){var c=n("SHADOW_CAST");c.dl=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.Zl){case "SPOT":case "POINT":c.j=da.kb(da.nc);da.Hm(c.j,180*b.gd/Math.PI,
.1,2*b.distance);break;default:c.j=da.kb(da.wh)}return c}function n(a){return{type:a,za:!1,Mq:!1,Gk:!1,Oj:!1,Fh:0,time:0,j:null,Jo:null,vb:null,p:[],ia:[],kd:[],Di:new Float32Array(3),os:new Float32Array(3),Mb:new Float32Array(3),Kb:new Float32Array(4),Wb:new Float32Array(16),me:0,Ff:0,vf:null,xf:null,uf:null,wf:null,tc:new Float32Array(3),zc:new Float32Array(3),Lr:new Float32Array([0,0,0]),hk:new Float32Array(3),Mr:new Float32Array(4),Zg:null,tj:0,nl:0,Uh:!1,Bg:new Float32Array(3),Oe:0,Pa:null,rk:!1,
Be:new Float32Array(2),Ce:new Float32Array(2),Xg:0,Jg:0,Sk:0,Mc:null,Qe:0,cg:0,Pe:0,Ze:!1,lo:0,mo:new Float32Array(2),ko:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,Yg:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,dh:0,bh:0,ah:0,Cr:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,
exposure:0,saturation:0,god_rays_intensity:0,Ig:0,$j:0,gh:0,dl:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,cs:null,Yn:null,Kf:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,bo:0,Yo:0,Lj:0,Mj:0,pq:0,gi:"",zx:new Float32Array(2),U:!0,enqueue:!0,da:!0,ga:!0,xb:!0,Ca:!0}}function e(a,b,c,d,e){return{K:a,Y:b,size:c,Ee:d,ph:e,Fa:!0,ja:null,Xf:!1,ua:ja.sd,ta:ja.sd}}function H(a,b){for(var c=0,d=K(a,b),e=0;e<d.length;e++){var f=d[e];"SHADOW_CAST"==f.type&&(f=t(a,f,"SHADOW_CAST").j,b.cs=f.ka,
b.Yn=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.Kf=b.Kf||[],b.Kf[c]=f.pa,c++)}}function G(){var a=n("GRASS_MAP");a.j=da.kb(da.hg);return a}function y(a){var b=n("POSTPROCESSING");b.da=!1;b.ga=!1;b.xb=!1;b.j=da.kb(da.jb);b.gi=a;return b}function A(a){var b=n("BLOOM_BLUR");b.da=!1;b.ga=!1;b.xb=!1;b.j=da.kb(da.jb);b.gi=a;return b}function D(a,b,c,d,e,t,f,h,g){var K=n("MAIN_"+a);if("OPAQUE"===a)K.da=!0,K.ga=c,K.za=!1;else if("BLEND"===a)K.da=!1,K.ga=!1,K.za=!0;else if("XRAY"===a)K.da=
!1,K.ga=!0,K.za=!0;else if("REFLECT"===a)K.da=!0,K.ga=!0,K.za=!1;else throw"wrong main subscene type";K.za&&h&&(K.self_shadow_normal_offset=h.self_shadow_normal_offset);K.j=b;K.tc.set(f.tc);K.zc.set(f.zc);K.me=f.me;K.Zg=f.Zg;K.Kb=t;d&&(K.Pa=d,d.Kb&&(K.Mc=new Float32Array(d.Kb)),K.Qe=d.waves_height,K.cg=d.waves_length,K.Pe=d.Pe,d.$i&&g&&(K.Ze=!0,K.lo=d.$i,K.mo.set(d.Uk),K.ko=d.Tk),d.ek&&(K.rk=!0,a=d.hz,K.Be[0]=(a[0]+a[1])/2,K.Be[1]=(a[2]+a[3])/2,K.Ce[0]=a[0]-a[1],K.Ce[1]=a[2]-a[3],K.Xg=d.Xg,K.Jg=d.Jg));
K.vf=new Float32Array(3*e);K.xf=new Float32Array(3*e);K.uf=new Float32Array(3*e);K.wf=new Float32Array(0==e%2?2*e:2*e+2);return K}function L(a,b){var c=n("COLOR_PICKING");b&&(c.type+="_XRAY",c.da=!1,c.ga=!0);c.enqueue=!1;c.j=a;return c}function C(a){var b=n("WIREFRAME");b.U=!1;b.da=!1;b.ga=!1;b.j=a;return b}function I(a){var b=n("ANCHOR_VISIBILITY");b.da=!0;b.ga=!1;b.j=a;return b}function J(a,b){var c=n("DEPTH");c.j=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function Q(a){var b=
n("DEPTH_PACK");b.da=!1;b.ga=!1;b.j=a;return b}function N(a,b,c){var d=n("SSAO");d.da=!1;d.ga=!1;d.xb=!1;d.j=a;d.Kb=b;d.Mc=new Float32Array(b);d.dh=c.radius_increase;d.ssao_hemisphere=c.lx;d.bh=c.influence;d.ah=c.dist_factor;d.Cr=c.Fy;return d}function u(a,b){var c=n("SSAO_BLUR");c.da=!1;c.ga=!1;c.xb=!1;c.ssao_blur_depth=b.pu;c.ssao_blur_discard_value=b.ao;c.j=a;return c}function P(){var a=n("ANTIALIASING");a.da=!1;a.ga=!1;a.xb=!1;a.j=da.kb(da.jb);return a}function S(a){var b=n(a);b.da="SMAA_BLENDING_WEIGHT_CALCULATION"==
a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.ga=!1;b.xb=!1;b.j=da.kb(da.jb);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.Ax=new Float32Array(4));return b}function Z(a,b,c,d){var e=n("COMPOSITING");e.da=!1;e.ga=!1;e.xb=!1;e.j=da.kb(da.jb);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function V(a,b){var c=n("MOTION_BLUR");c.da=!1;c.ga=!1;c.xb=!1;c.j=da.kb(da.jb);c.Gk=!0;c.Lj=a;c.Mj=b;return c}function fa(a){var b=n("DOF");b.da=!1;b.ga=!1;b.xb=!1;b.j=a;return b}function Y(a){var b=n("GLOW_MASK");
b.j=a;b.xb=!1;return b}function ha(a){var b=n("GLOW");b.Bg.set(a.Bg);b.tj=a.tj;b.Yo=5;b.bo=3;b.xb=!1;b.j=da.kb(da.jb);return b}function R(){var a=n("REFRACT");a.da=!1;a.ga=!1;a.xb=!1;a.j=da.kb(da.jb);return a}function X(a,b,c,d,e,t,f){var h=n("GOD_RAYS");h.da=!1;h.ga=!1;h.xb=!1;h.tc[0]=1;h.tc[1]=1;h.tc[2]=1;h.zc[0]=1;h.zc[1]=1;h.zc[2]=1;h.me=1;h.Mq=d;h.Oe=b;h.$j=e;h.Ig=c;h.gh=f;h.j=a;h.Ff=t;h.vf=new Float32Array(3*t);h.xf=new Float32Array(3*t);h.uf=new Float32Array(3*t);h.wf=new Float32Array(0==t%
2?2*t:2*t+2);return h}function z(a,b){var c=n("GOD_RAYS_COMBINE");c.da=!1;c.ga=!1;c.xb=!1;c.j=da.kb(da.jb);c.god_rays_intensity=a;c.Ff=b;c.vf=new Float32Array(3*b);c.xf=new Float32Array(3*b);c.uf=new Float32Array(3*b);c.wf=new Float32Array(0==b%2?2*b:2*b+2);return c}function pa(a,b){var c=n("SKY");c.enqueue=!1;c.da=!1;c.ga=!1;c.xb=!1;var d=da.kb(da.jb);d.width=Ba.ij;d.height=Ba.ij;c.j=d;c.Jo=ua.ow();c.Ff=a;c.vf=new Float32Array(3*a);c.xf=new Float32Array(3*a);c.uf=new Float32Array(3*a);c.wf=new Float32Array(0==
a%2?2*a:2*a+2);c.tc[0]=1;c.tc[1]=1;c.tc[2]=1;c.zc[0]=1;c.zc[1]=1;c.zc[2]=1;c.me=1;c.Yg.set(b.Yg);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;
c.mie_distribution=b.mie_distribution;return c}function ga(){var a=n("COPY");a.da=!1;a.ga=!1;a.j=da.kb(da.jb);return a}function ea(){var a=n("ANAGLYPH");a.da=!1;a.ga=!1;a.j=da.kb(da.jb);return a}function O(){var a=n("LUMINANCE");a.da=!1;a.ga=!1;a.j=da.kb(da.jb);return a}function T(){var a=n("AVERAGE_LUMINANCE");a.da=!1;a.ga=!1;a.j=da.kb(da.jb);return a}function W(a,b,c,d){var e=n("LUMINANCE_TRUNCED");e.da=!1;e.ga=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.j=d;e.vf=new Float32Array(3*c);e.xf=new Float32Array(3*
c);e.uf=new Float32Array(3*c);e.wf=new Float32Array(0==c%2?2*c:2*c+2);return e}function ma(a){var b=n("BLOOM");b.da=!1;b.ga=!1;b.j=da.kb(da.jb);b.bloom_blur=a;return b}function oa(){var a=n("SINK");a.enqueue=!1;return a}function ca(a,b,c){if(b.type===c)return!0;b=la(a,b);for(var d=0;d<b.length;d++)if(ca(a,b[d],c))return!0;return!1}function ia(a,b,c){if(b.type===c)return!0;b=K(a,b);for(var d=0;d<b.length;d++)if(ia(a,b[d],c))return!0;return!1}function t(a,b,c){if(b.type===c)return b;b=K(a,b);for(var d=
0;d<b.length;d++){var e=t(a,b[d],c);if(e)return e}return null}function K(a,b){var c=M.Og(a,b);if(c==M.xn)throw"Subscene not in graph";for(var d=[],e=M.Rp(a,c),t=0;t<e;t++){var f=M.qj(a,c,t);f!=c&&d.push(M.cb(a,f))}return d}function la(a,b){var c=M.Og(a,b);if(c==M.xn)throw"Subscene not in graph";for(var d=[],e=M.Qg(a,c),t=0;t<e;t++){var f=M.zg(a,c,t);f!=c&&d.push(M.cb(a,f))}return d}function Oa(a){var b=[],c=[];w(a,function(a){a.ja&&-1==b.indexOf(a.ja)&&(b.push(a.ja),c.push(a.ja,b.length-1))});return c}
function ba(a,b){var c;c=""+(a.K+"\\n");c+="NONE"!=a.Y?a.Y+"\\n":"";c+="(";if(a.ph){var d=a.Ee;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.K){c+=" ";if(a.Xf)c+="RR";else{var d=a.ua,e=a.ta,t="";d==ja.G?t+="L":d==ja.sd&&(t+="N");e==ja.G?t+="L":e==ja.sd&&(t+="N");c+=t}for(d=0;d<b.length;d+=2)b[d]==a.ja&&(c+=" "+b[d+1])}return c+")\\n"}var da=p("__camera"),Aa=p("__config"),Tb=p("__debug"),M=p("__graph"),Db=p("__renderer"),ja=p("__textures"),
ua=p("__util");p("vec4");var Za=Aa.jl,jb=Aa.q,Ba=Aa.pi;a.Hu=function(a){switch(a.Y){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;default:return!0}};a.Sz=w;a.iv=function(a,d,t){function h(b,t){var f=c(wa[t]);d.J.push(f);f=D(b,f,!1,Oa,ba,ob,Fa,Ia,a.ih);l.push(f);M.A(g,f);M.m(g,K[t],f,m[t]);M.m(g,K[t],f,q[t]);Ta&&(M.m(g,Ta,f,yb),M.m(g,Ta,f,Fb));if(kb){for(var k=0;k<ia.length;k++)M.m(g,ia[k],f,ca[k]);var k=n[t],u=e("COLOR","u_scene_depth",1,1,!0);u.ua=ja.sd;
u.ta=ja.sd;M.m(g,k,f,u)}r.length&&(M.m(g,r[t],f,la[t]),f.vb=Ga[0]);w.length&&M.m(g,w[t],f,p[t]);return f}var g=M.create(),K=[],l=[],n=[],m=[],q=[],r=[],la=[],w=[],p=[],ia=[],ca=[],ba=a.eq,Oa=a.Pa,Aa=a.Dm,Db=a.Ge,Nb=a.Cg,eb=a.Kx,Ga=a.qy,Ha=a.kg,Ob=a.Lg,qb=a.pg,fb=a.antialiasing,Fa=a.EA,ob=a.Kb,Ia=a.cd,Ua=a.Nx,zb=a.ou,rb=a.xu,cb=a.fx,Vb=a.cx,gb=a.sg,kb=a.Gv,Ka=Boolean(t.length),wa=[];if(a.anaglyph_use&&!Ka){var Ab=d.J[0],sb=c(Ab);da.nq(Ab,da.wb);da.nq(sb,da.Db);wa.push(Ab,sb);d.J.push(sb)}else{var sa=
d.J[0];wa.push(sa)}if(Aa){da.dn(wa[0],Ia);for(var Pb=Ia.csm_num,aa=0;aa<Pb;aa++){var db=x(aa,Ia);M.A(g,db);ia.push(db);var Qa=Ia.csm_resolution,sa=db.j;sa.width=Qa;sa.height=Qa;db.da=!1;ca.push(e("DEPTH","u_shadow_map"+aa,Qa,1,!1));(Tb.Cu()||jb.dp)&&db.ia.push(e("COLOR","COLOR",Qa,1,!1))}}if(0<Ga.length&&!Ka)for(aa=0;aa<wa.length;aa++){sa=c(wa[aa]);d.J.push(sa);var Ca=D("REFLECT",sa,!1,Oa,ba,ob,Fa,null,a.ih);Ca.vb=Ga[0];Ca.j.vb=Ga[0];M.A(g,Ca);r.push(Ca);la.push(e("COLOR","u_reflectmap",1,jb.ki,!0));
Ca.ia.push(e("DEPTH","DEPTH",1,jb.ki,!0))}K=[];l=[];if(a.Sa){var Ta=G();M.A(g,Ta);Qa=Ba.uj;Ta.j.width=Qa;Ta.j.height=Qa;var yb=e("DEPTH","u_grass_map_depth",Qa,1,!1);yb.ua=ja.G;yb.ta=ja.G;var Fb=e("COLOR","u_grass_map_color",Qa,1,!1);Fb.ua=ja.G;Fb.ta=ja.G}else Fb=yb=Ta=null;for(var cc=[],Bb=[],aa=0;aa<wa.length;aa++){var sa=wa[aa],Ra={};q.push(e("DEPTH","DEPTH",1,1,!0));if(kb){var Wb=c(sa);d.J.push(Wb);if(Aa){Ra=J(Wb,Ia);M.A(g,Ra);Bb.push(Ra);for(var Ib=0;Ib<ia.length;Ib++)db=ia[Ib],M.m(g,db,Ra,ca[Ib]);
var dc=e("COLOR","u_color",1,1,!0),Xb=e("DEPTH","u_depth",1,1,!0);if(Db){var mc=c(sa);d.J.push(mc);var tb=a.Bz,hb=N(mc,ob,tb);M.A(g,hb);var nc=e("COLOR","u_ssao_mask",1,1,!0);M.m(g,Ra,hb,dc);M.m(g,Ra,hb,Xb);var ic=c(sa);d.J.push(ic);var $a=u(ic,tb);M.A(g,$a);var oc=e("COLOR","u_shadow_mask",1,1,!0);M.m(g,hb,$a,nc);M.m(g,Ra,$a,Xb)}var F=c(Wb);d.J.push(F);var Jb=Q(F);M.A(g,Jb);M.m(g,Ra,Jb,e("DEPTH","u_depth",1,1,!0));n.push(Jb)}else Ra=J(Wb,Ia),M.A(g,Ra),n.push(Ra);Ta&&(M.m(g,Ta,Ra,yb),M.m(g,Ta,Ra,
Fb))}Ca=D("OPAQUE",sa,!kb,Oa,ba,ob,Fa,null,a.ih);M.A(g,Ca);l.push(Ca);kb&&(M.m(g,Ra,Ca,q[aa]),nc?M.m(g,$a,Ca,oc):Aa&&M.m(g,Ra,Ca,e("COLOR","u_shadow_mask",1,1,!0)));var lb=e("COLOR","u_color",1,1,!0);m.push(e("COLOR","COLOR",1,1,!0));Ta&&(M.m(g,Ta,Ca,yb),M.m(g,Ta,Ca,Fb));r.length&&(M.m(g,r[aa],Ca,la[aa]),Ca.vb=Ga[0])}K=l;l=[];if(!Ka&&a.Ao){sa=c(K[0].j);d.J.push(sa);var Da=L(sa,!1);M.A(g,Da);if(a.Xd){sa=c(K[0].j);d.J.push(sa);var ib=L(sa,!0);M.A(g,ib);M.m(g,Da,ib,e("COLOR","COLOR",1,1,!0));M.m(g,Da,
ib,e("DEPTH","DEPTH",1,1,!0))}}else Da=null;if(eb.Ic&&!Ka)for(aa=0;aa<wa.length;aa++){var U=R();M.A(g,U);M.m(g,K[aa],U,lb);w.push(U);p.push(e("COLOR","u_refractmap",1,1,!0))}for(aa=0;aa<wa.length;aa++)Ca=h("BLEND",aa),cc.push(Ca);K=l;l=[];if(a.Xd){for(aa=0;aa<wa.length;aa++)h("XRAY",aa);K=l;l=[]}if(jb.wireframe_debug){for(aa=0;aa<wa.length;aa++){sa=ua.sa(wa[aa]);d.J.push(sa);var Va=C(sa);l.push(Va);M.A(g,Va);M.m(g,K[aa],Va,m[aa]);M.m(g,K[aa],Va,q[aa]);Ta&&(M.m(g,Ta,Va,yb),M.m(g,Ta,Va,Fb))}K=l;l=[]}if(!Ka&&
a.Kt){sa=ua.sa(wa[0]);d.J.push(sa);var Wa=I(sa);M.A(g,Wa);M.m(g,K[0],Wa,q[0])}if(Nb&&kb&&!Ka){for(aa=0;aa<wa.length;aa++){var Qb=cb.Ig,ya=cb.px,Kb=cb.gh,Ma=K[aa],uc=Oa?1:0,Yb=e("DEPTH","u_input",1,1,!0);Yb.ua=ja.G;Yb.ta=ja.G;var Cb=e("COLOR","u_input",1,.25,!0);Cb.ua=ja.G;Cb.ta=ja.G;var ec=Qb/Kb,Fc=c(wa[aa]);d.J.push(Fc);var La=X(Fc,uc,Qb,!0,ec,ba,Kb);M.A(g,La);M.m(g,Ma,La,Yb);var ec=Qb/Kb*.5,Na=c(wa[aa]);d.J.push(Na);var Gc=X(Na,uc,Qb,!1,ec,ba,Kb);M.A(g,Gc);M.m(g,La,Gc,Cb);var ec=Qb/Kb*.25,pd=c(wa[aa]);
d.J.push(pd);var Lb=X(pd,uc,Qb,!1,ec,ba,Kb);M.A(g,Lb);M.m(g,Gc,Lb,Cb);r.length&&(La.vb=Ga[0],Gc.vb=Ga[0],Lb.vb=Ga[0]);var vc=z(ya,ba);l.push(vc);M.A(g,vc);M.m(g,Ma,vc,e("COLOR","u_main",1,1,!0));M.m(g,Lb,vc,e("COLOR","u_god_rays",1,1,!0))}K=l;l=[]}if(Ha&&!Ka){for(aa=0;aa<wa.length;aa++){var Ma=K[aa],pc=O();M.A(g,pc);M.m(g,Ma,pc,e("COLOR","u_input",1,1,!0));var Hc=T();M.A(g,Hc);Hc.j.width=1;Hc.j.height=1;var Zb=e("COLOR","u_input",1,.25,!0);Zb.ua=ja.G;Zb.ta=ja.G;var Ic=e("COLOR","u_luminance",1,.25,
!0);Ic.ua=ja.G;Ic.ta=ja.G;M.m(g,pc,Hc,Zb);var jd=zb.key,wc=zb.Mv,jc=c(wa[aa]);d.J.push(jc);var qc=W(jd,wc,ba,jc);M.A(g,qc);M.m(g,Ma,qc,e("COLOR","u_main",1,1,!0));M.m(g,pc,qc,Ic);M.m(g,Hc,qc,e("COLOR","u_average_lum",1,1,!1));var Mb=e("COLOR","u_color",1,.25,!0);Mb.ua=ja.G;Mb.ta=ja.G;var rc=A("X_BLUR");M.A(g,rc);M.m(g,qc,rc,Mb);var xc=A("Y_BLUR");M.A(g,xc);M.m(g,rc,xc,Mb);var kc=ma(zb.blur);M.A(g,kc);var $b=e("COLOR","u_bloom",1,.25,!0);$b.ua=ja.G;$b.ta=ja.G;M.m(g,xc,kc,$b);M.m(g,Ma,kc,e("COLOR",
"u_main",1,1,!0));l.push(kc)}K=l;l=[]}if(Ob&&!Ka){for(aa=0;aa<K.length;aa++){var Xc=K[aa],fc=V(Ua.Lj,Ua.Mj);l.push(fc);M.A(g,fc);M.m(g,Xc,fc,e("COLOR","u_mb_tex_curr",1,1,!0));fc.ia.push(e("COLOR","u_mb_tex_accum",1,1,!0))}K=l;l=[]}if(gb&&kb&&!Ka){for(aa=0;aa<K.length;aa++){var Ma=K[aa],mb=c(wa[aa]);d.J.push(mb);Mb=e("COLOR","u_color",1,1,!0);Mb.ua=ja.G;Mb.ta=ja.G;var nb=y("X_BLUR");M.A(g,nb);M.m(g,Ma,nb,Mb);var gc=y("Y_BLUR");M.A(g,gc);M.m(g,nb,gc,Mb);var Ra=cc[aa],Rb=fa(mb);mb.dof_distance=d.dof_distance;
mb.ff=d.ff;mb.dof_front=d.dof_front;mb.dof_rear=d.dof_rear;mb.dof_power=d.dof_power;mb.dof_on=1;l.push(Rb);M.A(g,Rb);M.m(g,Ma,Rb,e("COLOR","u_sharp",1,1,!0));M.m(g,gc,Rb,e("COLOR","u_blurred",1,1,!0));M.m(g,Ra,Rb,e("DEPTH","u_depth",1,1,!0))}K=l;l=[]}if(!Ka&&a.glow){for(aa=0;aa<wa.length;aa++){var Ma=K[aa],Yc=c(wa[aa]);d.J.push(Yc);var Jc=Y(Yc);M.A(g,Jc);var Zc=y("X_EXTEND"),Pc=e("COLOR","u_color",1,1,!0),$c=e("COLOR","u_glow_mask",1,1,!0);Zc.Uh=!0;M.A(g,Zc);M.m(g,Jc,Zc,Pc);var Kc=e("COLOR","u_color",
1,.5,!0);Kc.ua=ja.G;Kc.ta=ja.G;var ub=y("Y_EXTEND");ub.Uh=!0;M.A(g,ub);M.m(g,Zc,ub,Kc);nb=y("X_BLUR");nb.Uh=!0;M.A(g,nb);M.m(g,ub,nb,Kc);var ad=e("COLOR","u_color",1,.25,!0);ad.ua=ja.G;ad.ta=ja.G;var bd=e("COLOR","u_glow_mask_blurred",1,.25,!0);bd.ua=ja.G;bd.ta=ja.G;gc=y("Y_BLUR");gc.Uh=!0;M.A(g,gc);M.m(g,nb,gc,ad);var yc=ha(Vb);M.A(g,yc);M.m(g,Ma,yc,e("COLOR","u_glow_src",1,1,!0));M.m(g,Jc,yc,$c);M.m(g,gc,yc,bd);l.push(yc)}K=l;l=[]}if(qb&&!Ka){for(aa=0;aa<K.length;aa++){var Ma=K[aa],Qc=Z(rb.brightness,
rb.contrast,rb.exposure,rb.saturation);M.A(g,Qc);M.m(g,Ma,Qc,e("COLOR","u_color",1,1,!0));l.push(Qc)}K=l;l=[]}if(fb){for(aa=0;aa<K.length;aa++)if(Ma=K[aa],jb.smaa){var Xa=e("COLOR","u_color",1,1,!0);Xa.ua=ja.G;Xa.ta=ja.G;var zc=S("SMAA_EDGE_DETECTION");M.A(g,zc);M.m(g,Ma,zc,Xa);var Ac=S("SMAA_BLENDING_WEIGHT_CALCULATION");M.A(g,Ac);M.m(g,zc,Ac,Xa);var Lc=e("COLOR","u_search_tex",1,1,!1),cd=e("COLOR","u_area_tex",1,1,!1);Lc.ua=ja.G;Lc.ta=ja.G;cd.ua=ja.G;cd.ta=ja.G;Ac.ia.push(Lc);Ac.ia.push(cd);var Mc=
S("SMAA_NEIGHBORHOOD_BLENDING");M.A(g,Mc);M.m(g,Ma,Mc,Xa);var dd=e("COLOR","u_blend",1,1,!0);dd.ua=ja.G;dd.ta=ja.G;M.m(g,Ac,Mc,dd);l.push(Mc)}else{var Rc=P();M.A(g,Rc);var Sc=e("COLOR","u_color",1,1,!0);Sc.ua=ja.G;Sc.ta=ja.G;M.m(g,Ma,Rc,Sc);if(1<jb.resolution_factor){var ed=y("NONE");M.A(g,ed);M.m(g,Rc,ed,Sc);l.push(ed)}else l.push(Rc)}K=l;l=[]}if(a.anaglyph_use&&!Ka){var Nc=ea();M.A(g,Nc);M.m(g,K[0],Nc,e("COLOR","u_sampler_left",1,1,!0));M.m(g,K[1],Nc,e("COLOR","u_sampler_right",1,1,!0));l.push(Nc)}else l.push(K[0]);
var Bc=M.Og(g,K[0]),Cc=!1;M.Vd(g,Bc,function(a,b,c){if(c.K==c.Y)return Cc=!0});if(Cc){var Sb=ga();M.A(g,Sb);M.m(g,K[0],Sb,e("COLOR","u_color",1,1,!0));K=l;l=[];l.push(Sb)}Da&&(ib?l.push(ib):l.push(Da));Wa&&l.push(Wa);if(!Ka&&a.Mm.procedural_skydome){var kd=pa(ba,a.Mm);M.A(g,kd);l.push(kd)}var hc=oa();M.A(g,hc);for(aa=0;aa<l.length;aa++){var Dc=l[aa];switch(Dc.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":M.m(g,Dc,hc,e("COLOR","NONE",1,1,!0));M.m(g,Dc,hc,e("DEPTH","NONE",1,1,!0));break;case "SKY":M.m(g,
Dc,hc,e("CUBEMAP","u_sky",Ba.ij,1,!1));break;case "ANCHOR_VISIBILITY":M.m(g,Dc,hc,e("COLOR","NONE",1,1,!0));break;default:if(Ka){var fd=t[0].d,sc=e("COLOR","OFFSCREEN",1,1,!0);sc.ja=fd;M.m(g,l[aa],hc,sc);for(Ib=1;Ib<t.length;Ib++){var gd=t[Ib].d,Sb=ga();M.A(g,Sb);M.m(g,l[aa],Sb,e("COLOR","u_color",1,1,!0));sc=e("COLOR","OFFSCREEN",1,gd.Sf/fd.Sf,!0);sc.ja=gd;M.m(g,Sb,hc,sc)}}else M.m(g,l[aa],hc,e("SCREEN","NONE",1,1,!0))}}if(Za.enabled){var ac=E(g);ac&&B(g,ac)}b(g,kb);1<jb.resolution_factor&&k(g);
f(g);v(g);for(aa=0;aa<Bb.length;aa++)H(g,Bb[aa]);for(aa=0;aa<cc.length;aa++)H(g,cc[aa]);return g};a.uC=n;a.OB=function(a){var b=null;M.P(a,function(a,c){return c.j&&null===c.j.Id?(b=c,!0):!1});return b};a.mb=function(a,b,c){a=K(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.mC=ca;a.kx=ia;a.Nw=K;a.hC=la;a.Ha=function(a,b){var c=null;M.P(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.xv=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',
b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=Oa(a);M.P(a,function(a,d){var e=b+="    ",t="",t=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(t+=" ("+d.gi.replace(/_/g," ")+")");if(d.j){for(var t=t+"\\n",f=0;f<c.length;f+=2)c[f]==d.j.sb&&(t+="C"+c[f+1]+" ");for(f=0;f<c.length;f+=2)c[f]==d.j.rc&&(t+="D"+c[f+1])}d.ia.length&&(t+="\\n-----\\n");for(f=0;f<d.ia.length;f++)t+=ba(d.ia[f],c);f="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+
' [label="'+t+'" color="black" style="'+(f+",bold")+'"];\n')});M.Ke(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+ba(e,c)+'" style="'+(e.Fa?"solid":"dotted")+'"];\n'});return b+="}"};a.jv=function(a){a=M.Pz(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,p){function c(){return{name:"",type:0,source:"",width:0,height:0,$k:1,Ni:!0,Sf:1024,Uo:!1,Bd:null,Xa:null,Tg:null,jr:1,Td:0,Ug:!1,tk:!1,tf:!1,R:0,Aa:0,wg:0,pA:!1,Vf:!1,nm:0,Lb:0,Cb:0,Oa:null,Ne:null}}function b(b,d,e){var f=b.type,g=new Uint8Array([204,204,204,255]),l=c();switch(f){case "DATA_TEX2D":case "IMAGE":var k=A.createTexture(),m=A.TEXTURE_2D;A.bindTexture(m,k);A.texImage2D(m,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,g);b.image&&"MOVIE"==b.image.source&&(l.tf=
!0,l.R=b.frame_start,l.Aa=b.frame_offset,l.wg=b.frame_duration,l.pA=b.use_auto_refresh,l.Vf=b.use_cyclic,l.nm=b.movie_length,0!=l.Aa&&v.warn('Frame offset for texture "'+b.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":k=A.createTexture();m=A.TEXTURE_2D;A.bindTexture(m,k);if("NONE"==b.b4w_source_type)return null;if("SCENE"==b.b4w_source_type)if(b.b4w_source_id&&(e=x.keysearch("name",b.b4w_source_id,e)))l.Sf=b.b4w_source_size,e.vd=e.vd||[],e.vd.push(b),
A.texImage2D(m,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,g);else return null;break;case "ENVIRONMENT_MAP":k=A.createTexture();m=A.TEXTURE_CUBE_MAP;A.bindTexture(m,k);e="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var q=0;6>q;q++)A.texImage2D(A["TEXTURE_CUBE_MAP_"+e[q]],0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,g);break;case "VORONOI":case "BLEND":return null;default:return v.error('texture "'+b.name+'" has unsupported type "'+f+'"'),null}("NONE"!=f||b.b4w_enable_canvas_mipmapping&&
"CANVAS"==b.b4w_source_type)&&"DATA_TEX2D"!=f?A.texParameteri(m,A.TEXTURE_MIN_FILTER,D[n.jk]):A.texParameteri(m,A.TEXTURE_MIN_FILTER,A.LINEAR);A.texParameteri(m,A.TEXTURE_MAG_FILTER,A.LINEAR);g=m;e=b.b4w_anisotropic_filtering;"DEFAULT"===e&&(e=d);"OFF"!==e&&n.Oi&&(d=B.Aw())&&(e=parseFloat(e.split("x")[0]),A.texParameterf(g,d.TEXTURE_MAX_ANISOTROPY_EXT,e));"REPEAT"!=b.extension||b.b4w_shore_dist_map?(A.texParameteri(m,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(m,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE)):
(A.texParameteri(m,A.TEXTURE_WRAP_S,A.REPEAT),A.texParameteri(m,A.TEXTURE_WRAP_T,A.REPEAT));l.type=a.gg;l.width=1;l.height=1;l.Oa=k;l.Cb=m;"CANVAS"==b.b4w_source_type&&"NONE"==f?(f=b.b4w_source_id,k=b.b4w_source_size,l.Uo=b.b4w_enable_canvas_mipmapping,l.name=f,l.source="CANVAS",m=document.createElement("canvas"),m.setAttribute("id",f),m.width=k,m.height=k,l.Bd=m.getContext("2d"),G[f]=l,h(l)):"SCENE"==b.b4w_source_type&&"NONE"==f?(l.name=b.b4w_source_id,l.source="SCENE"):(l.name=b.name,l.source=f,
A.generateMipmap(m),A.bindTexture(m,null));return b.d=l}function h(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Cb;A.bindTexture(b,a.Oa);var c=g(a),d=m(a),e=a.Bd.canvas;A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!0);A.texImage2D(b,0,c,c,d,e);A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!1);a.Uo&&A.generateMipmap(b);A.bindTexture(b,null);a.width=e.width;a.height=e.height}function d(a){var b=a.Cb;A.bindTexture(b,a.Oa);A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!0);A.texImage2D(b,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,a.Tg[a.Td]);
A.bindTexture(b,null)}function f(a){A.texParameteri(a,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE);A.texParameteri(a,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE);A.texParameteri(a,A.TEXTURE_MAG_FILTER,A.LINEAR);A.texParameteri(a,A.TEXTURE_MIN_FILTER,A.LINEAR)}function k(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function g(b){switch(b.type){case a.gg:b=A.RGBA;break;case a.wk:b=A.RGB;break;case a.Ji:b=A.RGBA;break;case a.Ki:b=A.RGB;break;case a.vh:b=A.DEPTH_COMPONENT;
break;default:throw"Wrong texture type";}return b}function m(b){switch(b.type){case a.gg:b=A.UNSIGNED_BYTE;break;case a.wk:b=A.UNSIGNED_BYTE;break;case a.Ji:b=A.FLOAT;break;case a.Ki:b=A.FLOAT;break;case a.vh:b=A.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function l(a){return a in y?(n.Kc?y[a].Ug=!0:y[a].Xa.play(),!0):null}function r(a){return a in y?(a=y[a],n.Kc?(a.Td=a.Aa,d(a),a.Td++):a.Xa.currentTime=a.Aa/a.Lb,!0):null}function q(a){return a in y?(n.Kc?y[a].Ug=!1:y[a].Xa.pause(),
!0):null}var w=p("__config"),v=p("__print"),E=p("__dds"),B=p("__extensions"),x=p("__util"),n=w.q,e=w.xd,H=w.Lc;a.sd=0;a.G=0;a.xt=0;a.vt=0;a.wt=0;a.ut=0;a.gg=10;a.wk=20;a.Ji=30;a.Ki=40;a.vh=50;a.fg=60;var G={},y={},A=null,D;a.gc=function(b){D=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.sd=b.NEAREST;a.G=b.LINEAR;a.xt=b.NEAREST_MIPMAP_NEAREST;a.vt=b.LINEAR_MIPMAP_NEAREST;a.wt=b.NEAREST_MIPMAP_LINEAR;a.ut=b.LINEAR_MIPMAP_LINEAR;A=b};a.Ew=function(a){return a in
G?G[a].Bd:null};a.bA=function(a){return a in G?(h(G[a]),!0):!1};a.hj=function(b,d){var e=c();e.name=b;e.type=d;e.source="NONE";if(d==a.fg)e.Ne=A.createRenderbuffer();else{var f=A.TEXTURE_2D,g=A.createTexture();A.bindTexture(f,g);A.texParameteri(f,A.TEXTURE_MAG_FILTER,A.LINEAR);A.texParameteri(f,A.TEXTURE_MIN_FILTER,A.LINEAR);A.texParameteri(f,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE);A.texParameteri(f,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE);A.bindTexture(f,null);e.Cb=f;e.Oa=g}return e};a.Zu=function(b){var d=A.createTexture(),
e=A.TEXTURE_CUBE_MAP;A.bindTexture(e,d);A.texParameteri(e,A.TEXTURE_MAG_FILTER,A.LINEAR);A.texParameteri(e,A.TEXTURE_MIN_FILTER,A.LINEAR);A.texParameteri(e,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE);A.texParameteri(e,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),g=0;6>g;g++)A.texImage2D(A[f[g]],0,A.RGBA,b,b,0,A.RGBA,A.UNSIGNED_BYTE,
null);A.bindTexture(e,null);e=c();e.name="CUBEMAP";e.type=a.gg;e.source="NONE";e.width=3*b;e.height=2*b;e.$k=1;e.Oa=d;e.Cb=A.TEXTURE_CUBE_MAP;return e};a.Gm=function(b,c,d){if(b.type!=a.fg){var e=b.Cb;A.bindTexture(e,b.Oa);c&&A.texParameteri(e,A.TEXTURE_MIN_FILTER,c);d&&A.texParameteri(e,A.TEXTURE_MAG_FILTER,d);A.bindTexture(e,null)}};a.eC=function(b){if(b.type==a.fg)return{min:a.sd,Gx:a.sd};var c=b.Cb;A.bindTexture(c,b.Oa);b=A.getTexParameter(c,A.TEXTURE_MIN_FILTER);var d=A.getTexParameter(c,A.TEXTURE_MAG_FILTER);
A.bindTexture(c,null);return{min:b,Gx:d}};a.resize=function(b,c,d){c=Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.fg)A.bindRenderbuffer(A.RENDERBUFFER,b.Ne),A.renderbufferStorage(A.RENDERBUFFER,A.DEPTH_COMPONENT16,c,d),A.bindRenderbuffer(A.RENDERBUFFER,null);else{var e=b.Cb;A.bindTexture(e,b.Oa);var f=g(b),h=m(b);A.texImage2D(e,0,f,c,d,0,f,h,null);A.bindTexture(e,null)}c>n.Yc||d>n.Yc?v.error('Slink texture "'+b.name+'" has unsupported size'):(b.width=c,b.height=d)}};a.rv=
b;a.mA=function(a){var b=a.Cb;A.bindTexture(b,a.Oa);A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!0);4!=a.Xa.length?A.texImage2D(b,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,a.Xa):A.texImage2D(b,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,a.Xa);A.bindTexture(b,null)};a.jA=d;a.xi=function(a,b,c,d){var g=a.source,h=a.Cb;A.bindTexture(h,a.Oa);if(4==b.length){var l=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==g)if(l)A.texImage2D(h,0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){c=
E.Cp(b);if(c.width>n.Yc||c.height>n.Yc){v.error("texture has unsupported size",d);return}E.oA(A,B.xp(),b,!0);k(c.width,c.height)&&(a.Xn||v.warn("using NPOT texture",d),f(h));a.width=c.width;a.height=c.height;a.$k=E.Gw(b)}else{A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>n.Yc||b.height>n.Yc){v.error("texture has unsupported size",d);return}a.tf?n.Kc?b&&(y[a.name]=a,a.Tg=b,a.Lb=a.nm/b.length,a.wg=Math.round(a.wg/a.Lb),a.Aa=Math.round(a.Aa/a.Lb),a.R=Math.round(a.R/a.Lb),a.Td=a.Aa,A.texImage2D(h,
0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,a.Tg[0])):(a.Xa=b,a.Xa.loop=a.Vf,b&&(y[a.name]=a),a.Lb=e.Ea,b.duration&&(a.Lb=a.nm/b.duration),H.Ro||(b.playbackRate=e.Ea/a.Lb,H.ro&&2<b.playbackRate&&(b.playbackRate=2)),A.texImage2D(h,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,a.Xa)):A.texImage2D(h,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,b);n.Kc&&a.tf?(a.width=b[0].width,a.height=b[0].height):(a.width=b.width,a.height=b.height);k(b.width,b.height)?(a.Xn||(a.tf?v.warn("using NPOT video texture",d):v.warn("using NPOT texture",d)),f(h)):
a.tf||A.generateMipmap(h)}else if("ENVIRONMENT_MAP"==g)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],l){for(l=0;6>l;l++)g=c[l],A.texImage2D(A["TEXTURE_CUBE_MAP_"+g[0]],0,A.RGBA,1,1,0,A.RGBA,A.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!1);var m=b.width/3;if(m>n.im||m>n.im){v.error("cubemap has unsupported size",d);return}for(l=0;6>l;l++){var g=c[l],q=document.createElement("canvas");q.width=
m;q.height=m;var r=q.getContext("2d");"POSITIVE_Y"==g[0]||"NEGATIVE_Y"==g[0]?(r.translate(0,m),r.scale(1,-1)):(r.translate(m,0),r.scale(-1,1));r.drawImage(b,g[1]*m,g[2]*m,m,m,0,0,m,m);A.texImage2D(A["TEXTURE_CUBE_MAP_"+g[0]],0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,q)}a.width=3*m;a.height=2*m;k(b.width/3,b.height/2)?(v.warn("using NPOT cube map texture",d),f(h)):A.generateMipmap(h)}else"DATA_TEX2D"==g&&(A.texImage2D(h,0,A.RGBA,b.width,b.height,0,A.RGBA,A.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);
A.bindTexture(h,null)};a.Fv=function(a){A.deleteTexture(a)};a.Wh=function(a){return a&&a.name&&(a.Oa||a.Ne)?!0:!1};a.Yp=function(a){return a&&a.name&&a.Ne?!0:!1};a.AC=function(b){return b.type==a.Ji||b.type==a.Ki?!0:!1};a.Ww=function(b){var c=0;switch(b.type){case a.gg:case a.wk:c=4;break;case a.Ji:case a.Ki:c=16;break;case a.vh:c=3;break;case a.fg:c=2}return c};a.vw=function(a){var c=null,c={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};b(c,null,
a);c.image={filepath:null};return c};a.cleanup=function(){G={};y={}};a.play_video=l;a.reset_video=r;a.pause_video=q;a.pause=function(){for(var a in y)n.Kc&&!y[a].Ug||!n.Kc&&y[a].Xa.paused||(q(a),y[a].tk=!0)};a.reset=function(){for(var a in y)r(a),y[a].tk=!1};a.play=function(a){for(var b in y)if(!a||y[b].tk)l(b),y[b].tk=!1}};b4w.module.__assets=function(a,p){function c(){return E.Xp()?p(E.Hb.Xi).data:null}function b(){var a={Li:null,Et:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.Li=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=c();b&&a.Li in b&&(a.status=200,b[a.Li]&&(a.response=a.Et(b[a.Li])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function h(b){for(var c=0,e=0;e<b.length;e++){var h=b[e];20===h.state&&c++;if(c>=G.Lx)break;if(10===h.state)switch(h.state=20,c++,h.type){case a.AT_ARRAYBUFFER:d(h,"arraybuffer");break;case a.AT_JSON:d(h,"json");break;case a.AT_TEXT:d(h,"text");break;case a.AT_AUDIOBUFFER:f(h);break;case a.AT_IMAGE_ELEMENT:k(h);
break;case a.AT_AUDIO_ELEMENT:g(h);break;case a.Hi:m(h);break;case a.Gi:l(h);break;default:n.la("Wrong asset type: "+h.type)}}}function d(a,d){var e=c(),f=e&&a.s in e?new b:new XMLHttpRequest;f.open("GET",a.s,!0);"text"==d?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==d?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=d;f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;if(b){if("json"==d&&
"string"==typeof b)try{b=JSON.parse(b)}catch(c){a.$a(null,a.uri,a.type,a.s,a.gb);B.error(c+" (parsing JSON "+a.s+")");return}a.$a(b,a.uri,a.type,a.s,a.gb)}else a.$a(null,a.uri,a.type,a.s,a.gb),B.error("empty responce when trying to get "+a.s)}else a.$a(null,a.uri,a.type,a.s,a.gb),B.error(f.status+" when trying to get "+a.s);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.Xq(b.loaded/b.total)},!1);f.send(null)}function f(a){var d=c(),e=d&&a.s in d?new b:new XMLHttpRequest;
e.open("GET",a.s,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?x.Bv(b,function(b){a.$a(b,a.uri,a.type,a.s,a.gb);a.state=30},function(){a.$a(null,a.uri,a.type,a.s,a.gb);B.error("failed to decode "+a.s);a.state=30}):(a.$a(null,a.uri,a.type,a.s,a.gb),B.error("empty responce when trying to get "+a.s),a.state=30)}else a.$a(null,a.uri,a.type,a.s,a.gb),B.error(e.status+" when trying to get "+a.s),a.state=
30};e.send(null)}function k(a){var b=document.createElement("img");y.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.$a(b,a.uri,a.type,a.s,a.gb),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.$a(null,a.uri,a.type,a.s,a.gb),B.error("could not load image: "+a.s),a.state=30)},!1);var d=c();if(d&&a.s in d)if(d[a.s]){var e=q(a.s);b.src="data:"+e+";base64,"+d[a.s]}else H.Tl()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=
new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.s}function g(a){var b=document.createElement("audio");y.allow_cors&&(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=a.state&&(a.$a(b,a.uri,a.type,a.s,a.gb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.$a(null,a.uri,a.type,a.s,a.gb),B.error("could not load sound: "+a.s),a.state=30)},!1);var d=c();if(d&&a.s in d)if(d[a.s]){var e=w(a.s);b.src="data:"+e+";base64,"+d[a.s];40!=a.state&&(a.$a(b,
a.uri,a.type,a.s,a.gb),a.state=30)}else H.Tl()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.s,y.sf&&b.load();setTimeout(function(){b.mz=1},5E3)}function m(a){var b=document.createElement("video");b.muted=!0;if(y.allow_cors||y.sf)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.$a(b,a.uri,a.type,a.s,a.gb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&
(a.$a(null,a.uri,a.type,a.s),B.error("could not load video: "+a.s,a.gb),a.state=30)},!1);var d=c();if(d&&a.s in d)if(d[a.s]){var e=v(a.s);b.src="data:"+e+";base64,"+d[a.s];40!=a.state&&(a.$a(b,a.uri,a.type,a.s,a.gb),a.state=30)}else H.Tl()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.s,y.sf&&b.load();setTimeout(function(){b.mz=1},1E4)}function l(a){function d(b){a.$a(b,a.uri,a.type,a.s,a.gb)}var e=c(),f=e&&
a.s in e?new b:new XMLHttpRequest;f.open("GET",a.s,!0);f.responseType="arraybuffer";f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;b?r(b,d):(a.$a(null,a.uri,a.type,a.s,a.gb),B.error("empty responce when trying to get "+a.s))}else a.$a(null,a.uri,a.type,a.s,a.gb),B.error(f.status+" when trying to get "+a.s);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.Xq(b.loaded/b.total)},!1);f.send(null)}function r(a,
b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],f={images:[],Lb:c[4]},g=20,h=0;h<e;h++){var l=c[g/4],k=document.createElement("img");k.src=window.URL.createObjectURL(new Blob([d.subarray(g+4,g+4+l)],{type:"image/jpg"}));f.images.push(k);g+=l+8-l%4}k.onload=function(){b(f)}}function q(a){var b="image";switch(n.El(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function w(a){var b="audio";switch(n.El(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";
break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function v(a){var b="video";switch(n.El(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var E=p("__config"),B=p("__print"),x=p("__sfx"),n=p("__util"),e=p("__version"),H=p("__compat"),G=E.yd,y=E.q;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.Hi=70;a.Gi=80;var A=[],D=0,L={};a.ti=
function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.Vw=function(a){if(L[a])return L[a];var b=G.Uq?a+e.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return L[a]=b;n.la("Error XHR: responce is empty, GET "+a)}else n.la("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<A.length;a++)A[a].state=40;A=[];D=0;L={}};a.enqueue=
function(a,b,d,f){for(var g=0;g<a.length;g++){var l=a[g],l={uri:l[0],type:l[1],s:l[2],gb:l[3],state:10,$a:b||function(){},Nq:d||function(){},Xq:f||function(){},Oq:D};if(G.Uq){var k=c();k&&l.s in k||(l.s+=e.timestamp())}A.push(l)}h(A);D++};a.update=function(){h(A);for(var a=A,b=0,c=!0,d=0;d<a.length;d++){var e=a[d];e.Oq===a[b].Oq?30!==e.state&&(c=!1):(c&&(a[d-1].Nq(),c=d-b,a.splice(b,c),d-=c),b=d,c=30===a[d].state?!0:!1);d===a.length-1&&c&&(a[d].Nq(),a.splice(b))}}};b4w.module.__loader=function(a,p){function c(c,d,e,f){var g=B,h=w.create(),l;for(l in d){var k=b(d[l]);(f&&k.eb||!c&&k.ub)&&q(k);w.A(h,k)}for(l in d)for(k=d[l],k.name=l,c=0;c<k.H.length;c++)w.m(h,d[k.H[c]],k,null);d=b({name:"out",La:a.ss,Ra:function(a,b,c,d,e){0===b.id&&(g.Vq=!0);3!=b.status&&(b.status=2);b.lq(b.id,!0);e(b,c);v.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},hb:5});var m=[];if(e)for(e=w.zp(h),c=0;c<e.length;c++)m.push(w.cb(h,e[c]));else w.P(h,function(a,b){b.ab||m.push(b)});
w.A(h,d);for(c=0;c<m.length;c++)d.H.push(m[c].name),w.m(h,m[c],d,null);return h}function b(a){a.ab=a.ab||!1;a.La||0===a.La||(a.La=a.Oc);a.H=a.H||[];a.Th=a.Th||!1;a.Lm=a.Lm||!1;a.hb=a.hb||0;a.eb=a.eb||!1;a.ub=a.ub||!1;a.status=0;a.LC=0;a.cm=0;a.$e=a.$e||null;return a}function h(a,b){for(var c=[],d=[],f=0;f<b.length;f++){var g=b[f];w.cb(a.hd,g).Th&&(w.Le(a.hd,g,function(d){var f=!0;w.Vd(a.hd,d,function(a,b){if(!b.Th)return f=!1,1});f&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(f))}for(f=
d.length-1;0<=f;f--)b.splice(d[f],1);return c}function d(a){function b(c,d){var e=w.cb(a.hd,c),f=w.cb(a.hd,d),g=f.La-e.La;0==g&&(g=e.ab-f.ab);return g}var c=[],d=a.Ud,f=!1;do{var g=h(a,d);c.push.apply(c,d);0<g.length&&(f=!0);d=g}while(0<g.length);f&&c.sort(b);a.Ud=c;return a.Ud.length}function f(a,b,c){if(b.Lm)return b.Th=!0,g(a,b),!1;if(!b.Ra&&!b.mg&&!b.Ch)return g(a,b),!1;if(0==b.status&&(b.status++,b.Ra))return b.Ra(c,a,b,b.$e,g,m),!0;if(1==b.status){if(b.mg)return b.mg(c,a,b,b.$e,g,m),!0;b.status++}return 2==
b.status&&(b.status++,b.Ch)?(b.Ch(c,a,b,b.$e,g,m),!0):!1}function k(a){if(0==a.gk)return 100;var b=0;w.P(a.hd,function(c,d){a.do_not_load_resources&&d.eb||(b+=d.cm*d.hb)});return E.trunc(100*b/a.gk)}function g(a,b){b.Th=!0;b.status=3;l(a,b,1)}function m(a,b,c){1>c?l(a,b,c):b.status++}function l(a,b,c){var d=B;if(b.Ra||b.mg||b.Ch)if(b.cm=c,b=k(a),a.Lo!=b||1==c)a.Rm(b,performance.now()-a.Pr),a.Lo=b,d.gm=!0}function r(a,b){var c=null;w.P(a.hd,function(a,d){if(d.name==b)return c=d,1});return c}function q(a){a.Lm=
!0;a.cm=1}var w=p("__graph"),v=p("__print"),E=p("__util");a.Oc=0;a.Se=1;a.ss=2;var B=null;a.yp=function(){return B};a.kv=function(){var a={ld:[],hl:0,zk:0,Vq:!1,gm:!1};return B=a};a.sv=function(a,b,d,f,g,h,l,k){var m=B,q={id:m.ld.length,status:0,s:b,Zn:"",lq:d||function(){},bm:k||!1,rD:h,Pr:0,Lo:0,gk:0,Em:!1,Rm:f||function(){},Bo:g||function(){},hd:null,Ud:null,Ol:!1,Nl:!1,Ql:!1};a=c(0===q.id,a,h,l);q.hd=a;b=[];d=w.Tw(a);for(f=0;f<d.length;f++)b.push(d[f]);q.Ud=b;w.P(a,function(a,b){!(b.Ra||b.mg||
b.Ch)||q.do_not_load_resources&&b.eb||(q.gk+=b.hb)});m.ld.push(q);m.zk++;return q.id};a.iA=function(b){var c=B;if(c&&0!=B.zk)if(c.gm)c.gm=!1;else{var e=performance.now();do{var g=c.ld[c.hl],h=b[g.id];if(3!=g.status)if(0==g.status&&(g.status=1,g.Pr=performance.now(),g.Rm(0,0)),d(g)){var l=g,k=l.Ud.length;do{var m=w.cb(l.hd,l.Ud[0]),q=f(l,m,h);m.La==a.Se&&(l.Em=!0);m=l.Ud.shift();l.Ud.push(m);k--}while(!q&&0!=k)}else g.Bo(h,g),g.status=3,c.zk--,l=g,l.Rm=null,l.Bo=null,l.hd=null,l.Ud=null;c.Vq&&(c.hl=
(c.hl+1)%c.ld.length);if(g.Em){g.Em=!1;break}}while(16>performance.now()-e)}};a.hD=m;a.ur=function(a,b){var c=r(a,b);null!==c&&q(c)};a.Oz=function(a){return a&&3==a.status};a.is_primary_loaded=function(a){var b=B;if(!b)return!1;a|=0;return b.ld[a]&&(3==b.ld[a].status||2==b.ld[a].status)};a.cleanup=function(){B=null}};b4w.module.__nla=function(a,p){function c(){return{type:"CLIP",R:0,ea:0,Sd:!1,paused:!1,zh:"",Bc:0,Hn:0,It:0,Xo:0,Wo:0,hh:!1}}function b(a,b){for(var c=a.b4w_nla_script,d=b.ye,e=0;e<c.length;e++){var f=c[e];switch(f.type){case "PLAY":d.push({type:"PLAY",R:f.frame_range[0],ea:f.frame_range[1],pe:!1});break;case "SELECT":case "SELECT_PLAY":var g=E.mf(E.dg,f.object,0),h=E.Sw(a),l=h.indexOf(g);if(-1==l){v.error("NLA script error: non-selectable object");return}for(var f={type:f.type,vr:"SELECT"==f.type?
f.target_slot:e+1,kz:e+1,ze:-1,Ly:h.length,Ky:l,R:f.frame_range[0],ea:f.frame_range[1],pe:!1},l=[],k=0;k<h.length;k++)l.push(q.create_selection_sensor(h[k],!0));q.create_sensor_manifold(g,"NLA_SELECT_"+e,q.CT_SHOT,l,q.Cv,function(a,c,d,e){if(!(b.tb>=b.ye.length)&&(d=b.ye[b.tb],"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.pe)){for(d=0;d<e.Ly;d++)if(q.get_sensor_value(a,c,d)&&d==e.Ky){e.ze=1;return}e.ze=0}},f);d.push(f);break;case "JUMP":d.push({type:"JUMP",Nm:f.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",
Nm:f.target_slot,Mu:f.condition,li:f.register1,mi:f.register2,sm:f.number1,tm:f.number2});break;case "REGSTORE":d.push({type:"REGSTORE",ry:f.registerd,Xx:f.number1});break;case "MATH":d.push({type:"MATH",$x:f.operation,li:f.register1,mi:f.register2,sm:f.number1,tm:f.number2,Rg:f.registerd});break;case "SHOW":case "HIDE":g=E.mf(E.dg,f.object,0);d.push({type:f.type,obj:g});break;case "REDIRECT":d.push({type:"REDIRECT",url:f.url});break;case "PAGEPARAM":d.push({type:"PAGEPARAM",ay:f.param_name,Rg:f.registerd});
break;case "NOOP":d.push({type:"NOOP"})}}}function h(a,b,c,g){if(a.ye.length){if(a.tb>=a.ye.length)if(a.cyclic)a.tb=0;else{a.Aa-=e.Ea*c;return}var l=f(a,b,g,!1),k=a.ye[a.tb];switch(k.type){case "PLAY":k.pe?l>=k.ea&&(k.pe=!1,a.tb++,h(a,b,c,g)):(a.Aa+=k.R-l,k.pe=!0,d(a,k));break;case "SELECT":case "SELECT_PLAY":-1<k.ze?"SELECT"==k.type||"SELECT_PLAY"==k.type&&0==k.ze?(a.tb=k.ze?k.vr:k.kz,k.ze=-1,h(a,b,c,g)):k.pe?l>=k.ea&&(k.pe=!1,a.tb=k.vr,k.ze=-1,h(a,b,c,g)):(a.Aa+=k.R-l,k.pe=!0,d(a,k)):a.Aa-=e.Ea*
c;break;case "JUMP":a.tb=k.Nm;h(a,b,c,g);break;case "CONDJUMP":var l=-1==k.li?k.sm:a.$c[k.li],m=-1==k.mi?k.tm:a.$c[k.mi],n=!1;switch(k.Mu){case "EQUAL":l==m&&(n=!0);break;case "NOTEQUAL":l!=m&&(n=!0);break;case "LESS":l<m&&(n=!0);break;case "GREATER":l>m&&(n=!0);break;case "LEQUAL":l<=m&&(n=!0);break;case "GEQUAL":l>=m&&(n=!0)}n?a.tb=k.Nm:a.tb++;h(a,b,c,g);break;case "REGSTORE":a.$c[k.ry]=k.Xx;a.tb++;h(a,b,c,g);break;case "MATH":l=-1==k.li?k.sm:a.$c[k.li];m=-1==k.mi?k.tm:a.$c[k.mi];switch(k.$x){case "ADD":a.$c[k.Rg]=
l+m;break;case "MUL":a.$c[k.Rg]=l*m;break;case "SUB":a.$c[k.Rg]=l-m;break;case "DIV":0==m&&x.la("Division by zero in NLA script"),a.$c[k.Rg]=l/m}a.tb++;h(a,b,c,g);break;case "SHOW":E.show_object(k.obj);a.tb++;h(a,b,c,g);break;case "HIDE":E.hide_object(k.obj);a.tb++;h(a,b,c,g);break;case "REDIRECT":window.location.href=k.url;a.ye.length=0;break;case "PAGEPARAM":a:{l=location.href.toString();if(-1!=l.indexOf("?"))for(l=l.split("?")[1].split("&"),m=0;m<l.length;m++)if(n=l[m].split("="),1<n.length&&n[0]==
k.ay){l=Number(n[1]);break a}l=0}a.$c[k.Rg]=l;a.tb++;h(a,b,c,g);break;case "NOOP":a.tb++,h(a,b,c,g)}}}function d(a,b){for(var c=a.ye,d=0;d<c.length;d++){var e=c[d];e!=b&&(e.ze=-1)}}function f(a,b,c,d){b=(b-c)*e.Ea+a.Aa-a.R;a.cyclic&&d&&(b%=a.ea-a.R+1);return b+=a.R}function k(a,b){b?n.pause_video(a.name):(n.reset_video(a.name),n.play_video(a.name))}function g(a,b){for(var d=[],e=0;e<a.length;e++){var f=a[e].strips;if(f)for(var g=0;g<f.length;g++){var h=f[g],l=c();l.type=h.type;l.R=h.frame_start;l.ea=
h.frame_end;l.zh=h.action?h.action.name:"";l.Bc=b;l.Hn=h.action_frame_start;l.It=h.action_frame_end;d.push(l)}}return d}function m(a){return B.Od(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}var l=p("__animation"),r=p("__camera"),q=p("__controls"),w=p("__config");p("__loader");p("__particles");var v=p("__print"),E=p("__scenes"),B=p("__sfx"),x=p("__util"),n=p("__textures"),e=w.xd,H=w.q,G=[],y=-1;a.hA=function(a,d){var e={R:a.frame_start,ea:a.frame_end,Aa:0,Xh:-1,cyclic:d,
bc:[],L:[],ye:[],tb:0,$c:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};b(a,e);for(var f=E.Ba(a,"ALL",E.DATA_ID_ALL),h=0;h<f.length;h++){var k=f[h],n=0,q=[],u=k.animation_data;u&&u.nla_tracks.length&&(u=u.nla_tracks,x.rf(k)||r.is_camera(k)||x.is_mesh(k)||x.sx(k)||B.Od(k))&&(u=g(u,n),u.length&&(q=q.concat(u),n++));m(k)&&(u=k.data.animation_data.nla_tracks,u=g(u,n),u.length&&(q=q.concat(u),n++));if(l.Mp(k))for(var w=k.data.materials,p=0;p<w.length;p++){var y=w[p].node_tree,u=y.animation_data;y&&u&&(u=u.nla_tracks,
u=g(u,n),u.length&&(q=q.concat(u),n++))}for(p=0;p<k.particle_systems.length;p++)u=k.particle_systems[p],w=u.settings,"EMITTER"==w.type&&w.b4w_allow_nla&&(w=c(),w.type="CLIP",w.R=e.R,w.ea=e.ea+1,w.zh=u.name,w.Bc=n,q.push(w),n++);u=n+1;if(x.is_mesh(k)&&k.data)for(p=0;p<k.data.b4w_vertex_anim.length;p++)y=k.data.b4w_vertex_anim[p],y.allow_nla&&(n=u,w=c(),w.type="CLIP",w.R=e.R,w.ea=e.ea+1,w.zh=y.name,w.Bc=n,q.push(w));q.length&&(k.xk=q,e.bc.push(k))}f=a.d.qh;for(p=0;p<f.length;p++)if(h=f[p].d,h.Xa||h.Tg)w=
c(),w.type="VIDEO",k=1,H.Kc&&(k=h.Lb),w.R=Math.min(h.R*k,e.ea),w.ea=h.Vf?e.ea:Math.min((h.wg+h.R+h.Aa)*k,e.ea),w.zh=f[p].name,h.Dt=w,e.L.push(h);p=e.R;f=e.ea;for(h=0;h<e.bc.length;h++)for(k=e.bc[h],n=k.xk,q=0;q<n.length;q++)w=n[q],u=k.name+" ["+w.R+":"+w.ea+"]",w.R=Math.max(p,w.R),w.ea=Math.min(f+1,w.ea),w.R>w.ea&&(v.warn("NLA: out of scene range: "+u),n.splice(q,1),q--);for(p=0;p<e.bc.length;p++)for(f=e.bc[p].xk,h=0;h<f.length;h++){k=f[h];n=e.R;q=e.ea+1;for(w=0;w<f.length;w++)u=f[w],k.Bc==u.Bc&&
(u.ea<=k.R&&(n=k.R),u.R>=k.ea&&(q=Math.min(q,u.R)));k.Xo=n;k.Wo=q}G.push(e)};a.start=function(){y=0};a.update=function(a,b){if(!(0>y)){0==y&&(y=a);for(var c=0;c<G.length;c++){var d=G[c];h(d,a,b,y);for(var g=f(d,a,y,!0),m=0;m<d.bc.length;m++){for(var n=d.bc[m],q=n.xk,u=0;u<q.length;u++){var r=q[u];"SOUND"==r.type&&g<d.Xh-1E-6&&(r.Sd=!1)}for(u=0;u<q.length;u++)switch(r=q[u],r.type){case "CLIP":if(r.Xo<=g&&g<r.Wo&&!r.Sd){var w=n,v=r;l.apply(w,v.zh,v.Bc);l.set_behavior(w,l.AB_FINISH_STOP,v.Bc);for(w=
0;w<q.length;w++)q[w]!=r&&q[w].Bc==r.Bc&&(q[w].Sd=!1);r.Sd=!0}if(r.Sd){var w=n,v=g-r.R+r.Hn,p=l.get_current_frame_float(w,r.Bc);1E-6<Math.abs(v-p)&&l.set_current_frame_float(w,v,r.Bc)}break;case "SOUND":(g<d.Xh-1E-6||d.Xh<r.R)&&r.R<=g&&g<r.ea&&!r.Sd&&(B.play(n,(r.R-g)/e.Ea,(r.ea-r.R)/e.Ea),r.Sd=!0),d.Xh<r.ea&&r.ea<=g&&r.Sd&&(r.Sd=!1)}}for(m=0;m<d.L.length;m++)r=d.L[m].Dt,r.R<=Math.round(g)&&Math.round(g)<r.ea&&!r.hh&&(k(d.L[m],r.hh),r.hh=!0),r.ea<=Math.round(g)&&r.hh&&(k(d.L[m],r.hh),r.hh=!1);d.Xh=
g}}};a.cleanup=function(){G.length=0;y=-1};a.Op=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||m(a)||l.Mp(a)?!0:!1}};b4w.module.__camera=function(a,p){function c(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function b(b){var c={type:b,name:"",Ee:1,width:0,height:0,Id:null,sb:null,rc:null,Za:0,Hd:0,Ja:0,Ta:0,left:0,right:0,top:0,bottom:0,ne:new Float32Array(3),bp:new Float32Array(3),quat:new Float32Array(4),ka:new Float32Array(16),kB:new Float32Array(16),pa:new Float32Array(16),
rh:new Float32Array(16),ky:new Float32Array(16),dd:new Float32Array(16),sr:new Float32Array(16),bg:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,ff:null,dof_on:0,zl:{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Ja:new Float32Array([0,0,0,0]),Ta:new Float32Array([0,0,0,0])},ui:0,jd:0,vb:null,Eh:null,el:null,Io:new Float32Array(4),Xj:new Float32Array(4)};if(b==a.jb)return c;switch(b){case a.nc:f(c,
40,.1,1E3);break;case a.Pc:f(c,2.5,.1,1E3);break;case a.Te:break;case a.hg:break;case a.wh:break;case a.wb:case a.Db:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function h(b,c,d){if(b.type!=a.wb&&b.type!=a.Db)throw"set_stereo_params(): wrong camera type";b.ui=c;b.jd=d;n(b,b.Za);if(N.Z())for(c=N.get_active(),b=c.d.cd,c=N.pj(c).d.J,d=0;d<c.length;d++)D(c[d],b)}function d(a,b){var c=a.d,d=u.quat_to_dir(c.quat,u.AXIS_Y,R),c=u.quat_to_dir(c.quat,
u.AXIS_Z,X),e=-Math.asin(d[1]/P.length(d)),d=Math.abs(e)>Math.PI/4?P.scale(c,-u.sign(e),z):P.scale(d,-u.sign(c[1]),z),f=Math.atan(Math.abs(d[0]/d[2]));0<c[1]&&(e=u.sign(e)*Math.PI-e);c=f;0>d[2]&&(c=Math.PI-c);0>d[0]&&(c=2*Math.PI-c);b[0]=c;b[1]=e;return b}function f(b,c,d,e,f){switch(b.type){case a.nc:case a.wb:case a.Db:b.Hd=c;b.Za=1;break;case a.Pc:b.top=c;b.Za=1;break;case a.Te:delete b.Hd;b.Hd=c;b.Za=f/c;break;case a.hg:b.top=c;b.Za=f/c;break;default:Q.error("set_frustum(): Unsupported camera type: "+
b.type)}b.Ja=d;b.Ta=e}function k(b,c){var d=c.d.g,t=c.d.quat,f=W;fa.rotateX(c.d.N,-Math.PI/2,f);fa.invert(f,b.ka);if(b.vb){var f=b.vb[0],g=b.vb[1],h=b.vb[2],l=b.vb[3],k=W;k[0]=1-2*f*f;k[1]=-2*f*g;k[2]=-2*f*h;k[3]=0;k[4]=-2*f*g;k[5]=1-2*g*g;k[6]=-2*g*h;k[7]=0;k[8]=-2*f*h;k[9]=-2*g*h;k[10]=1-2*h*h;k[11]=0;k[12]=-2*f*l;k[13]=-2*g*l;k[14]=-2*h*l;k[15]=1;fa.multiply(b.ka,k,b.ka);n(b,b.Za,!0);f=ea;g=W;fa.invert(b.ka,g);fa.transpose(g,g);S.transformMat4(b.vb,g,f);g=O;g[0]=(u.sign(f[0])+b.pa[8])/b.pa[0];
g[1]=(u.sign(f[1])+b.pa[9])/b.pa[5];g[2]=-1;g[3]=(1+b.pa[10])/b.pa[14];S.scale(f,2/(f[0]*g[0]+f[1]*g[1]+f[2]*g[2]+f[3]*g[3]),f);b.pa[2]=f[0];b.pa[6]=f[1];b.pa[10]=f[2]+1;b.pa[14]=f[3]}b.type==a.wb?b.ka[12]+=b.jd/2:b.type==a.Db&&(b.ka[12]-=b.jd/2);fa.multiply(b.pa,b.ka,b.bg);H(b);e(b);P.copy(b.ne,b.bp);P.copy(d,b.ne);Z.copy(t,b.quat)}function g(b,c,d,t){fa.lookAt(c,d,t,b.ka);b.type==a.wb?b.ka[12]+=b.jd/2:b.type==a.Db&&(b.ka[12]-=b.jd/2);fa.multiply(b.pa,b.ka,b.bg);H(b);e(b);P.copy(c,b.ne)}function m(a){var b=
a.d.J;if(!b)throw"Wrong object";for(var c=a.d,d=0;d<b.length;d++){var e=b[d];k(e,a);u.Zo(e.bg,e.zl);if(e.ff)if(e.dof_on){var f=P.dist(c.g,e.ff.location);e.dof_distance=f}else e.dof_distance=0}}function l(b,c){var e=b.d,t=e.Nb;!t||e.aa!=a.MS_EYE_CONTROLS&&e.aa!=a.MS_TARGET_CONTROLS||(c&&(e=d(b,Y),t.left+=e[0],t.right+=e[0]),t.left=u.angle_wrap_0_2pi(t.left),t.right=u.angle_wrap_0_2pi(t.right))}function r(b,c){var e=b.d,t=e.nd;!t||e.aa!=a.MS_EYE_CONTROLS&&e.aa!=a.MS_TARGET_CONTROLS||(c&&(e=d(b,Y),t.Ma+=
e[1],t.Ga+=e[1]),t.Ma=u.angle_wrap_periodic(t.Ma,-Math.PI,Math.PI),t.Ga=u.angle_wrap_periodic(t.Ga,-Math.PI,Math.PI))}function q(a,b,c){if(b==c)return c-a;a=u.angle_wrap_0_2pi(a);b=u.angle_wrap_0_2pi(b);c=u.angle_wrap_0_2pi(c);var d=Math.abs(b-c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-b;c=u.angle_wrap_0_2pi(c+b);a=u.angle_wrap_0_2pi(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0}function w(a,b,c,e,f){var g=a.d,h=b,l=c;if(e||f)a=d(a,ha),e&&(h=b-a[0]),f&&(l=c-a[1]);if(h||l)b=Z.identity(pa),
h&&(h=Z.setAxisAngle(u.AXIS_Y,h,ga),Z.multiply(b,h,b)),l&&(h=u.quat_to_dir(g.quat,u.AXIS_X,R),l=Z.setAxisAngle(h,l,ga),Z.normalize(l,l),Z.multiply(b,l,b)),Z.multiply(b,g.quat,g.quat)}function v(a,b,c,e,f){var g=a.d,h=b,l=c;if(e||f){var k=d(a,ha);e&&(h=b-k[0]);f&&(l=c-k[1])}B(a,a.d.zb,h,l);a=d(a,ha);a=u.angle_wrap_periodic(a[1],-Math.PI,Math.PI);g.ik=Math.abs(a)>Math.PI/2}function E(a,b,c,e,f){var g=a.d,h=b,l=c;if(e||f){var k=d(a,ha);e&&(h=b-k[0]);f&&(l=c-k[1])}g.pl||(h=0);B(a,g.Zb,h,l);l&&x(a)}function B(a,
b,c,d){var e=a.d;if(c||d){var f=Z.identity(pa);c&&(c=Z.setAxisAngle(u.AXIS_Y,c,ga),Z.multiply(f,c,f));a=A(a);d&&(!a||a&&e.Na)&&(a=u.quat_to_dir(e.quat,u.AXIS_X,R),d=Z.setAxisAngle(a,d,ga),Z.normalize(d,d),Z.multiply(f,d,f));u.Cy(e.g,b,f,e.g);Z.multiply(f,e.quat,e.quat)}}function x(a){var b=a.d;if(b.Na){var c=d(a,Y)[1];a=a.d;a.Gb.Ga-a.Gb.Ma?(c=(a.Gb.Ga-c)/(a.Gb.Ga-a.Gb.Ma),c=Math.max(c,0)):c=0;c=c*(a.ef-a.Tc)+a.Tc;a=u.quat_to_dir(b.quat,u.AXIS_MY,R);P.normalize(a,a);P.scale(a,c,a);P.subtract(b.Zb,
a,b.g)}}function n(b,c,d){switch(b.type){case a.nc:if(!c)throw"No aspect ratio";b.Za=c;case a.Te:fa.perspective(u.my(b.Hd),b.Za,b.Ja,b.Ta,b.pa);break;case a.Pc:if(!c)throw"No aspect ratio";b.Za=c;case a.hg:c=b.top*b.Za;fa.ortho(-c,c,-b.top,b.top,b.Ja,b.Ta,b.pa);break;case a.wh:fa.ortho(b.left,b.right,b.bottom,b.top,b.Ja,b.Ta,b.pa);break;case a.wb:case a.Db:if(!c)throw"No aspect ratio";b.Za=c;var f=Math.tan(b.Hd*Math.PI/360);c=b.Ja*f;var g=b.Za*b.ui*f;b.type==a.wb?(f=g-b.jd/2,g+=b.jd/2):(f=g+b.jd/
2,g-=b.jd/2);f=-(b.Ja/b.ui*f);g*=b.Ja/b.ui;fa.frustum(f,g,-c,c,b.Ja,b.Ta,b.pa);b.left=f;b.right=g;break;case a.jb:return;default:throw"Wrong camera type: "+b.type;}d||(fa.multiply(b.pa,b.ka,b.bg),H(b),e(b))}function e(a){fa.copy(a.ka,a.dd);a.dd[12]=0;a.dd[13]=0;a.dd[14]=0;a.dd[15]=1;fa.multiply(a.pa,a.dd,a.dd);fa.invert(a.dd,a.dd)}function H(a){fa.copy(a.ka,a.rh);fa.multiply(a.pa,a.rh,a.rh);fa.invert(a.rh,a.rh)}function G(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=b.Ja);d||(d=b.Ta);var g,h,l,k,
m,n,q,r;switch(b.type){case a.jb:throw"Extraction from NONE camera is not possible";case a.nc:case a.Te:g=c*Math.tan(b.Hd*Math.PI/360);k=-g;h=g*b.Za;l=-h;m=d/c*g;r=-m;n=m*b.Za;q=-n;break;case a.Pc:case a.hg:l=b.top*b.Za;g=m=b.top;h=n=l;k=r=-b.top;l=q=-l;break;case a.wh:g=m=b.top;h=n=b.right;k=r=b.bottom;l=q=b.left;break;case a.wb:case a.Db:m=c/b.Ja;g=c*Math.tan(b.Hd*Math.PI/360);k=-g;h=b.right*m;l=b.left*m;q=d/c;m=g*q;r=-m;n=h*q;q*=l;break;default:throw"Wrong camera type: "+b.type;}e[0]=l;e[1]=k;
e[2]=-c;e[3]=h;e[4]=k;e[5]=-c;e[6]=h;e[7]=g;e[8]=-c;e[9]=l;e[10]=g;e[11]=-c;e[12]=q;e[13]=r;e[14]=-d;e[15]=q;e[16]=m;e[17]=-d;e[18]=n;e[19]=m;e[20]=-d;e[21]=n;e[22]=r;e[23]=-d;f&&(c=W,fa.invert(b.ka,c),u.ve(e,c,e,0));return e}function y(a){return"CAMERA"===a.type?!0:!1}function A(b){return y(b)&&b.d&&b.d.aa==a.MS_HOVER_CONTROLS?!0:!1}function D(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.Eh){var d=b.csm_num;a.Eh=Array(d);for(var e=0;e<d;e++)a.Eh[e]=new Float32Array(3);a.el=new Float32Array(d)}for(d=
0;d<c;d++){var e=0==d?a.Ja:L(b,a,d-1),f=L(b,a,d),e=G(a,e,f,ma),e=I.Mw(e);a.Eh[d].set(e.D);a.el[d]=e.va;a.Io[d]=P.length(e.D);a.Xj[d]=C(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.Xj[0]=b.first_cascade_blur_radius}function L(a,b,c){var d=a.csm_num,e=u.clamp(a.csm_first_cascade_border,b.Ja,b.Ta);a=u.clamp(a.csm_last_cascade_border,b.Ja,b.Ta);return u.clamp(C(e,a,d,c),b.Ja,b.Ta)}function C(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-
1))}return a}var I=p("__boundings");p("__config");var J=p("__constraints"),Q=p("__print"),N=p("__scenes"),u=p("__util"),P=p("vec3"),S=p("vec4"),Z=p("quat"),V=p("mat3"),fa=p("mat4");a.jb=10;a.nc=20;a.Pc=30;a.Te=40;a.hg=50;a.wh=60;a.wb=70;a.Db=80;a.MS_STATIC=0;a.MS_ANIMATION=1;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var Y=new Float32Array(2),ha=new Float32Array(2),R=new Float32Array(3),X=new Float32Array(3),z=new Float32Array(3),pa=new Float32Array(4),ga=new Float32Array(4),
ea=new Float32Array(4),O=new Float32Array(4),T=new Float32Array(16),W=new Float32Array(16),ma=new Float32Array(24);a.wu=function(e){var g=e.d,h=e.data;switch(h.type){case "PERSP":var t=b(a.nc);if(h.angle_y)var k=h.angle_y/Math.PI*180;f(t,k,h.clip_start,h.clip_end);break;case "ORTHO":t=b(a.Pc),f(t,h.ortho_scale/2,h.clip_start,h.clip_end)}t.name=e.name;g.Ur=!1;g.aa=c(h.b4w_move_style);g.dof_distance=e.data.dof_distance;g.ff=e.data.dof_object;g.dof_front=e.data.b4w_dof_front;g.dof_rear=e.data.b4w_dof_rear;
g.dof_power=e.data.b4w_dof_power;g.pl=e.data.b4w_enable_hover_hor_rotation;g.J=[t];if(g.aa==a.MS_TARGET_CONTROLS||g.aa==a.MS_EYE_CONTROLS||g.aa==a.MS_HOVER_CONTROLS)g.hn=e.data.b4w_trans_velocity,g.gn=e.data.b4w_rot_velocity,g.jn=e.data.b4w_zoom_velocity;g.aa==a.MS_TARGET_CONTROLS&&(g.zb.set(h.b4w_target),h=u.quat_to_dir(g.quat,u.AXIS_Z,R),g.ik=0<h[1]);h=e.d;k=h.aa;if(k===a.MS_TARGET_CONTROLS||k===a.MS_EYE_CONTROLS||k===a.MS_HOVER_CONTROLS){var m=e.data,n=null,T=null,w=null;k===a.MS_TARGET_CONTROLS||
k===a.MS_EYE_CONTROLS?(m.b4w_use_panning&&(h.bs=m.b4w_use_panning),m.b4w_use_horizontal_clamping&&(n={left:m.b4w_rotation_left_limit,right:m.b4w_rotation_right_limit}),m.b4w_use_vertical_clamping&&(T={Ga:m.b4w_rotation_down_limit,Ma:m.b4w_rotation_up_limit}),k===a.MS_TARGET_CONTROLS&&(h.Na=m.b4w_use_distance_limits&&m.b4w_distance_min<=m.b4w_distance_max,h.Na&&(h.Tc=m.b4w_distance_min,h.ef=m.b4w_distance_max))):k===a.MS_HOVER_CONTROLS&&(m.b4w_use_horizontal_clamping&&m.b4w_horizontal_translation_min<=
m.b4w_horizontal_translation_max&&(n={left:m.b4w_horizontal_translation_min,right:m.b4w_horizontal_translation_max}),m.b4w_use_vertical_clamping&&m.b4w_vertical_translation_min<=m.b4w_vertical_translation_max&&(T={Ga:m.b4w_vertical_translation_min,Ma:m.b4w_vertical_translation_max}),h.Na=m.b4w_use_distance_limits&&m.b4w_hover_angle_min<=m.b4w_hover_angle_max&&m.b4w_distance_min<=m.b4w_distance_max,h.Na&&(w={Ga:m.b4w_hover_angle_min,Ma:m.b4w_hover_angle_max},h.Tc=m.b4w_distance_min,h.ef=m.b4w_distance_max));
var v=n;v&&k==a.MS_EYE_CONTROLS&&(v.left*=-1,v.right*=-1);if(v=T)switch(k){case a.MS_TARGET_CONTROLS:v.Ga*=-1;v.Ma*=-1;break;case a.MS_HOVER_CONTROLS:var W=-v.Ga;v.Ga=-v.Ma;v.Ma=W}(v=w)&&k==a.MS_HOVER_CONTROLS&&(v.Ga*=-1,v.Ma*=-1);h.Nb=n;h.nd=T;h.Gb=w;l(e,"LOCAL"==m.b4w_horizontal_clamping_type);r(e,"LOCAL"==m.b4w_vertical_clamping_type)}if(g.aa===a.MS_HOVER_CONTROLS)if(g=e.d,g.Na){h=e.d;k=u.quat_to_dir(h.quat,u.AXIS_MY,R);m=ea;m.set(u.AXIS_Y);m[3]=0;k=u.line_plane_intersect(m,0,h.g,k,h.Zb);if(!k||
100<P.len(k))h.Zb[0]=h.g[0],h.Zb[1]=0,h.Zb[2]=h.g[2];h=d(e,Y);g=q(h[1],g.Gb.Ma,g.Gb.Ga);0<h[1]&&Q.warn("Active hover camera has wrong orientation");g?E(e,0,g):x(e)}else g.pl=!1;if(t.type==a.Pc)switch(e=e.d,e.aa){case a.MS_TARGET_CONTROLS:e.Eg=P.dist(e.g,e.zb);e.Fg=e.J[0].top;break;case a.MS_HOVER_CONTROLS:e.Na&&(e.Eg=P.dist(e.g,e.Zb),e.Fg=e.J[0].top)}};a.kb=b;a.lB=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.sb);case "DEPTH":return Boolean(a.rc);case "SCREEN":return!Boolean(a.sb)&&
!Boolean(a.rc);default:throw"Wrong attachment type: "+b;}};a.ck=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.sb=c;break;case "DEPTH":a.rc=c;break;case "SCREEN":a.sb=null;a.rc=null;break;default:throw"Wrong attachment type: "+b;}};a.cC=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.sb;case "DEPTH":return a.rc;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.nq=function(b,c){if(b.type!=a.nc||c!=a.wb&&c!=a.Db)throw"make_stereo(): wrong camera type";b.type=
c;h(b,6,.065)};a.Zy=h;a.get_camera_angles=d;a.get_camera_angles_char=function(a,b){d(a,b);b[0]=u.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.get_angles=function(a,b){var c=a.d,d=u.quat_to_dir(c.quat,u.AXIS_MY,R),e=Math.asin(d[1]/P.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?u.quat_to_dir(c.quat,u.AXIS_MZ,X):u.quat_to_dir(c.quat,u.AXIS_Z,X)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b};a.Hm=f;a.Ry=function(b,c,d,
e,f,g,h){switch(b.type){case a.wh:b.left=c;b.right=d;b.bottom=e;b.top=f;b.Ja=g;b.Ta=h;break;default:Q.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.d.aa};a.aD=k;a.bD=g;a.pr=function(a,b,c){var d=R;d[0]=0;d[1]=-1;d[2]=0;P.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=X;e[0]=0;e[1]=0;e[2]=-1;P.transformQuat(e,c,e);g(a,b,d,e)};a.Zv=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];fa.lookAt(a,b,c,W);fa.invert(W,W);fa.rotateX(W,
Math.PI/2,W);V.fromMat4(W,T);Z.fromMat3(T,e)};a.Vr=m;a.aA=function(b){var c=b.d;switch(c.aa){case a.MS_TARGET_CONTROLS:c.Na?J.Ey(c.g,c.quat,c.zb,c.Tc,J.ps):J.Dy(c.g,c.quat,c.zb);J.correct_up(b,u.AXIS_Y);break;case a.MS_EYE_CONTROLS:J.correct_up(b,u.AXIS_Y)}};a.fy=l;a.jy=r;a.Zr=function(b){var c=b.d;if(y(b)&&c.J[0].type===a.Pc){if(c.aa===a.MS_TARGET_CONTROLS)var d=P.dist(c.g,c.zb),c=d/c.Eg*c.Fg;else c.Na&&c.aa===a.MS_HOVER_CONTROLS?(d=P.distance(c.g,c.Zb),c=d/c.Eg*c.Fg):c=b.d.J[0].top;for(var e in b.d.J)d=
b.d.J[e],d.top=c,n(d,d.Za);m(b)}};a.Iu=function(b){var c=b.d;if(c.aa===a.MS_TARGET_CONTROLS||c.aa===a.MS_EYE_CONTROLS){if(c.Nb){var e=c.Nb.left,f=c.Nb.right,g=d(b,Y);(g=c.aa==a.MS_TARGET_CONTROLS?q(g[0],e,f):q(g[0],f,e))&&(c.aa==a.MS_TARGET_CONTROLS?v(b,g,0):w(b,g,0))}c.nd&&(e=c.nd.Ga,f=c.nd.Ma,g=d(b,Y),(g=c.aa==a.MS_TARGET_CONTROLS?q(g[1],f,e):q(g[1],e,f))&&(c.aa==a.MS_TARGET_CONTROLS?v(b,0,g):w(b,0,g)));c.aa===a.MS_TARGET_CONTROLS&&c.Na&&(g=b.d,e=P.subtract(g.g,g.zb,R),f=P.length(e),f>g.ef?(P.scale(e,
g.ef/f,e),P.add(g.zb,e,g.g)):f<g.Tc&&(f=u.quat_to_dir(g.quat,u.AXIS_MY,X),P.scale(f,100*g.Tc,f),P.add(e,f,e),P.scale(e,-g.Tc/P.length(e),e),P.add(g.zb,e,g.g)))}c.aa===a.MS_HOVER_CONTROLS&&(c=b.d,g=c.Na?c.Zb:c.g,c.Nb&&(e=u.clamp(g[0],c.Nb.left,c.Nb.right)-g[0],g[0]+=e,c.Na&&(c.g[0]+=e)),c.nd&&(e=u.clamp(g[2],c.nd.Ga,c.nd.Ma)-g[2],g[2]+=e,c.Na&&(c.g[2]+=e)),c=b.d,c.Na&&(g=d(b,Y)[1],g=q(g,c.Gb.Ma,c.Gb.Ga),u.quat_to_dir(c.quat,u.AXIS_MY,R),g&&E(b,0,g)))};a.rotate_eye_camera=w;a.rotate_target_camera=v;
a.rotate_hover_camera=E;a.mx=x;a.BC=function(b){switch(b.type){case a.nc:case a.Pc:case a.wb:case a.Db:return!0;default:return!1}};a.yw=function(b){b=b.d.J[0];switch(b.type){case a.nc:case a.Te:case a.wb:case a.Db:return Math.PI*b.Hd/180;default:return Q.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.Vg=n;a.tu=e;a.uu=H;a.Wv=G;a.fu=function(a){a=a.d;var b=I.qd();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Eb=b;var c=I.cl(1,[0,0,0]);a.Cc=c;a.Ik=I.Eo(1,b);a.Kk=I.Go(1,
b);a.Jk=I.Fo(1,b)};a.is_camera=y;a.is_target_camera=function(b){return y(b)&&b.d&&b.d.aa==a.MS_TARGET_CONTROLS?!0:!1};a.is_eye_camera=function(b){return y(b)&&b.d&&b.d.aa==a.MS_EYE_CONTROLS?!0:!1};a.is_hover_camera=A;a.dn=D;a.vv=L;a.project_point=function(b,c,d){b=b.d.J[0];switch(b.type){case a.nc:case a.Te:case a.Pc:case a.hg:case a.wb:case a.Db:var e=ea;e.set(c);e[3]=1;S.transformMat4(e,b.bg,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+
1)/2);return d;default:return Q.error("Non-compatible camera"),d}};a.fC=function(a){return a.d.J[0]}};b4w.module.__lights=function(a,p){function c(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),ng:new Float32Array(3),gd:0,Tf:0,uw:!1,To:!1,Wf:!0,Me:!0,le:1,distance:25,NB:"INVERSE_SQUARE"}}function b(a){a.ng[0]=a.color[0]*a.le;a.ng[1]=a.color[1]*a.le;a.ng[2]=a.color[2]*a.le}var h=p("__util"),d=p("vec3");a.tC=c;a.Bx=function(a){var k=a.data,g=c(k.type);g.name=a.name;g.Wf=k.use_diffuse;g.Me=k.use_specular;var m=h.quat_to_dir(a.d.quat,h.AXIS_Y,[]);d.normalize(m,
m);g.direction[0]=m[0];g.direction[1]=m[1];g.direction[2]=m[2];g.color[0]=k.color[0];g.color[1]=k.color[1];g.color[2]=k.color[2];g.le=k.energy;b(g);g.distance=k.distance;if("POINT"===g.type||"SPOT"===g.type)g.distance=k.distance;"SPOT"===g.type&&(g.gd=k.spot_size,g.Tf=k.spot_blend);g.uw=k.b4w_generate_shadows;g.To=k.b4w_dynamic_intensity;a.ca=g};a.Ty=function(a,c){a.color[0]=c[0];a.color[1]=c[1];a.color[2]=c[2];b(a)};a.Vy=function(a,b){a.Tf=b};a.Uy=function(a,b){a.distance=b};a.Wy=function(a,b){a.gd=
b};a.kr=function(a,c){a.le=c;b(a)};a.Ul=function(a){return"LAMP"===a.type?!0:!1};a.eA=function(a){if("LAMP"!=a.type)throw"Wrong light object";var b=a.ca;b&&h.quat_to_dir(a.d.quat,h.AXIS_Y,b.direction)}};b4w.module.__scenes=function(a,p){function c(){if(!eb)for(var a=0;a<Ha.length;a++){var b=Ha[a];if(!b.vd.length){eb=b;break}}return eb}function b(){if(!Ga)throw"No active scene available";return Ga}function h(a,b,c,d){for(var e=null,f=0;f<b.length;f++){var t=b[f];if((c?t.origin_name:t.name)==a&&t.d.Sc==d){e=t;break}}return e}function d(a,b){b||(b="ALL");var c=[];f(a.objects,b,c);return c}function f(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&f(e.objects,
b,c)}}function k(b){if("NONE"==qa.Ae||!b.b4w_render_shadows)return!1;var c=!1,d=!1;if(0==X(b,"LAMP",a.DATA_ID_ALL).length)return!1;b=X(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){var f=b[e];f.b4w_shadow_cast&&(c=!0);f.b4w_shadow_receive&&(d=!0);if(c&&d)return!0}return!1}function g(a){if(!a.ma)return!1;a=a.ma.LAMP;for(var b=0;b<a.length;b++)if("SUN"==a[b].ca.type)return!0;return!1}function m(a){if(!qa.shore_smoothing)return!1;a=z(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}
function l(b){var c=z(b),d=[];b=X(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<c.length;e++){var f=c[e];if(f.b4w_water){for(var t={},g=0;g<b.length;g++)for(var h=b[g],l=h.data.materials,k=0;k<l.length;k++)l[k]==f&&(t.Pe=h.location[1]);if(qa.kj)for(t.Kb=f.b4w_water_fog_color.slice(0),t.Kb.push(f.b4w_water_fog_density),f.b4w_water_dynamic?(t.tg=!0,t.waves_height=f.b4w_waves_height,t.waves_length=f.b4w_waves_length,t.dst_noise_scale0=f.b4w_water_dst_noise_scale0,t.dst_noise_scale1=f.b4w_water_dst_noise_scale1,
t.dst_noise_freq0=f.b4w_water_dst_noise_freq0,t.dst_noise_freq1=f.b4w_water_dst_noise_freq1,t.dir_min_shore_fac=f.b4w_water_dir_min_shore_fac,t.dir_freq=f.b4w_water_dir_freq,t.dir_noise_scale=f.b4w_water_dir_noise_scale,t.dir_noise_freq=f.b4w_water_dir_noise_freq,t.dir_min_noise_fac=f.b4w_water_dir_min_noise_fac,t.dst_min_fac=f.b4w_water_dst_min_fac,t.waves_hor_fac=f.b4w_water_waves_hor_fac):(t.tg=!1,t.waves_height=0,t.waves_length=0),t.$i=null,t.Tk=null,t.Uk=new Float32Array(2),t.ek=null,f=f.texture_slots,
g=0;g<f.length;g++)h=f[g].texture,"VORONOI"==h.type&&(t.$i=h.noise_scale,t.Uk.set([.3,.7]),t.Tk=h.noise_intensity),!0===h.b4w_shore_dist_map&&(t.ek=h.image,t.Xg=h.image.size[0],t.hz=h.b4w_shore_boundings,t.Jg=h.b4w_max_shore_dist);else t.waves_height=0,t.waves_length=0,t.$i=null,t.Tk=null,t.Uk=null,t.Kb=null,t.tg=!1;d.push(t)}}if(0<d.length){t=d[0];if(!t.tg)for(e=0;e<d.length;e++)d[e].tg&&(t=d[e]);return t}return null}function r(a){function b(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var e=a[d];
"GROUP"==e.type&&e.node_group&&b(e.node_group.node_tree);"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(c.Ic=!0)}}}var c={};a=z(a);for(var d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(c.Ic=!0);e.node_tree&&b(e.node_tree)}return c}function q(b){if(!qa.ak||!b.b4w_render_reflections)return!1;var c=[];b=X(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var e=b[d];if(e.b4w_reflective){var f;a:{e=e.constraints;for(f=0;f<e.length;f++){var t=e[f];if("LOCKED_TRACK"==t.type&&"REFLECTION PLANE"==
t.name){f=t.target;break a}}f=null}f&&(e=f.location,f=f.d.quat,t=new Float32Array(4),ta.Rz(e,f,ta.AXIS_Y,t),c.push(t))}}return c}function w(a,b){var c={},d=a.world.b4w_sky_settings;c.procedural_skydome=d.procedural_skydome&&b;c.use_as_environment_lighting=d.use_as_environment_lighting;c.Yg=d.color;c.rayleigh_brightness=d.rayleigh_brightness;c.mie_brightness=d.mie_brightness;c.spot_brightness=d.spot_brightness;c.scatter_strength=d.scatter_strength;c.rayleigh_strength=d.rayleigh_strength;c.mie_strength=
d.mie_strength;c.rayleigh_collection_power=d.rayleigh_collection_power;c.mie_collection_power=d.mie_collection_power;c.mie_distribution=d.mie_distribution;!b&&d.procedural_skydome&&va.warn("There is no sun on the scene. Procedural sky won't be rendered");return c}function v(a){var b={};a=a.world.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.lx=a.hemisphere;b.pu=a.blur_depth;b.ao=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.Fy=a.samples;return b}function E(a){var b=
{};a=a.world.b4w_bloom_settings;b.blur=a.blur;b.Mv=a.edge_lum;b.key=a.key;return b}function B(a){var b={};a=a.world.b4w_motion_blur_settings;b.Lj=a.motion_blur_decay_threshold;b.Mj=a.motion_blur_factor;return b}function x(a){var b={};a=a.world.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function n(a){var b={};a=a.world.b4w_god_rays_settings;b.px=a.intensity;b.Ig=a.max_ray_length;b.gh=a.steps_per_pass;return b}
function e(a){var b={};a=a.world;b.Bg=a.b4w_glow_color;b.tj=a.b4w_glow_factor;return b}function H(a){var b=a.world;a=[0,0,0];var c=[0,0,0],d=b.light_settings,e=b.texture_slots;if(d.use_environment_light)if("SKY_COLOR"==d.environment_color||"SKY_TEXTURE"==d.environment_color)a=b.horizon_color.slice(0),c=b.zenith_color.slice(0);else if("PLAIN"==d.environment_color)a=[1,1,1],c=[1,1,1];else throw"Unsupported world environment color"+d.environment_color;b={};b.me=d.environment_energy;b.tc=a;b.zc=c;b.Zg=
e;return b}function G(b){if(!qa.Sa)return!1;var c=!1,d=!1;b=X(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){for(var f=b[e],t=f.data.materials,g=0;g<t.length;g++)t[g].b4w_terrain&&(c=!0);f=f.particle_systems;for(g=0;g<f.length;g++)t=f[g].settings,"HAIR"==t.type&&t.b4w_dynamic_grass&&(d=!0);if(c&&d)return!0}return!1}function y(b){b=X(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)if(b[c].d.ad)return!0;return!1}function A(b){b=X(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)for(var d=
b[c].data.materials,e=0;e<d.length;e++){var f=d[e],t=f.game_settings.alpha_blend;if(f.b4w_render_above_all&&"OPAQUE"!=t&&"CLIP"!=t)return!0}return!1}function D(b){b=X(b,"EMPTY",a.DATA_ID_ALL);for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_anchor&&d.b4w_anchor.detect_visibility)return!0}return!1}function L(a,b,c){var d=ua.Og(a,b);ua.Vd(a,d,function(a,b,d){if(d.Fa){switch(d.K){case "COLOR":case "CUBEMAP":a=b.j.sb;break;case "DEPTH":a=b.j.rc;break;case "SCREEN":a=null;break;default:throw"Wrong slink";
}switch(d.Y){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(!a)throw"Connection of SCREEN is forbidden";if(a.Ne)throw"Batch texture can't use renderbuffer";na.oo(c.Jb,d.Y)&&ba.Pi(c,a,d.Y)}}});for(a=0;a<b.ia.length;a++){var d=b.ia[a],e=b.kd[a];switch(d.Y){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(e.Ne)throw"Batch texture can't use renderbuffer";na.oo(c.Jb,d.Y)&&ba.Pi(c,e,d.Y)}}}function C(a,
b,c,d,e){switch(a.type){case "MAIN_OPAQUE":I(a,b,c,"OPAQUE",d,e);break;case "MAIN_BLEND":I(a,b,c,"BLEND",d,e);break;case "MAIN_XRAY":I(a,b,c,"XRAY",d,e);break;case "MAIN_REFLECT":for(var f=b.d,t=b.n,g=0;g<t.length;g++){var h=t[g];if(("MAIN"==h.type||"NODES"==h.type||"PARTICLES"==h.type)&&h.sc){if(!e){J(h,a,b,c,"REFLECT",d);var l=h.Ia;na.B(l,"DISABLE_FOG",0);na.B(l,"WATER_EFFECTS",0);"special_skydome.glslf"==na.tp(l)&&na.B(l,"REFLECTION_PASS",1);na.B(l,"SHADOW_SRC","SHADOW_SRC_NONE");na.B(l,"TEXTURE_NORM",
0);N(d,h);ba.qb(h);u(h)}a.p.push({U:!0,fb:f,o:h})}}break;case "DEPTH":f=b.d;b=b.n;for(t=0;t<b.length;t++)if(g=b[t],"DEPTH"==g.type&&!g.Rb&&!g.sc){if(!e){var h=g,k=a,l=f,K=c,m=d,n=h.Ia;if(ra.kx(K,k,"SHADOW_CAST"))if(h.Ab){if("DEPTH"!=qa.Ae)throw"Wrong shadows type";na.B(n,"SHADOW_SRC","SHADOW_SRC_DEPTH");na.B(n,"SHADOW_DST","SHADOW_DST_MASK");ba.Fk(h,m.d.cd);ra.Nw(K,k)}else na.B(n,"SHADOW_SRC","SHADOW_SRC_NONE"),na.B(n,"SHADOW_DST","SHADOW_DST_MASK");else na.B(n,"SHADOW_SRC","SHADOW_SRC_NONE"),na.B(n,
"SHADOW_DST","SHADOW_DST_NONE");h.Sa&&(k=ra.Ha(K,"GRASS_MAP"))&&S(h,k,l);ba.qb(h);u(h)}a.p.push({U:!0,fb:f,o:g});L(c,a,g);P(g)}break;case "SHADOW_CAST":f=!1;t=b.d;b=b.n;g=ra.Ha(c,"GRASS_MAP");for(h=0;h<b.length;h++)if(l=b[h],"DEPTH"==l.type&&l.sc){f=!0;if(!e){if("DEPTH"!=qa.Ae)throw"Wrong shadows type";na.B(l.Ia,"SHADOW_SRC","SHADOW_SRC_NONE");na.B(l.Ia,"SHADOW_DST","SHADOW_DST_DEPTH");l.Sa&&g&&S(l,g,t);ba.ba(l,"SHADOW_TEX_RES",na.t(d.d.cd.csm_resolution));ba.qb(l);u(l)}a.p.push({U:!0,fb:t,o:l})}f&&
V(a,ra.Ha(c,"MAIN_OPAQUE"),a.p,d,!0);break;case "COLOR_PICKING":Y(a,b,e);break;case "COLOR_PICKING_XRAY":Y(a,b,e);break;case "GRASS_MAP":c=b.d;d=b.n;for(b=0;b<d.length;b++)f=d[b],"GRASS_MAP"==f.type&&(e||(ba.qb(f),u(f)),a.p.push({U:!0,fb:c,o:f}),f=a.j,l=c.Qa,t=a.Mb[0],g=a.Mb[1],h=a.Mb[2],0==t&&0==g?(t=l.min_y,g=l.max_y):(t=Math.min(t,l.min_y),g=Math.max(g,l.max_y)),l=1E-4*(g-t),a.Mb[0]=t-l,a.Mb[1]=g+l,Aa.Hm(f,h/2,-g,-t,h/2),Aa.Vg(f));break;case "GLOW_MASK":c=b.d;d=b.n;for(b=0;b<d.length;b++)f=d[b],
f.sc&&"COLOR_ID"==f.type&&(e||(ba.ba(f,"USE_GLOW",1),ba.qb(f),u(f)),a.p.push({U:!0,fb:c,o:f}));break;case "WIREFRAME":for(d=b.d,b=b.n,f=0;f<b.length;f++)t=b[f],"WIREFRAME"==t.type&&(e||(t.Sa&&(g=ra.Ha(c,"GRASS_MAP"))&&S(t,g,d),ba.qb(t),u(t)),a.p.push({U:!0,fb:d,o:t}),L(c,a,t),P(t))}}function I(a,b,c,d,e,f){for(var t=b.d,g=b.n,h=0;h<g.length;h++){var l=g[h];l.Rb||l.Qb||l.sc||"MAIN"!=l.type&&"NODES"!=l.type&&"PARTICLES"!=l.type||"OPAQUE"===d&&l.za||!("BLEND"!==d&&"XRAY"!==d||l.za&&"XRAY"==d==l.Xd)||
(f||(J(l,a,b,c,d,e),N(e,l),ba.qb(l),u(l)),a.p.push({U:!0,fb:t,o:l}),L(c,a,l),P(l))}a.p.sort(function(a,b){var c;if(a.o&&b.o){c=a.o.za;var d=b.o.za;(c=c==d?0:c>d?1:-1)||(c=a.o.Hf,d=b.o.Hf,c=c==d?0:c>d?1:-1)}else c=0;return c})}function J(a,b,c,d,e,f){var t=c.d;if("OPAQUE"===e)c=ra.Ha(d,"SHADOW_CAST")&&a.Ab?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE";else if("BLEND"===e||"XRAY"===e)if(ra.Ha(d,"SHADOW_CAST")&&a.Ab)switch(qa.Ae){case "DEPTH":c="SHADOW_SRC_DEPTH";break;default:throw"Wrong shadows type";}else c=
"SHADOW_SRC_NONE";else if("REFLECT"===e)c="SHADOW_SRC_NONE";else throw"Wrong main subscene type";e=a.Ia;var g=f.d.cd;na.B(e,"SHADOW_SRC",c);ba.Fk(a,g);c=b.Ff;na.B(e,"NUM_LIGHTS",c);na.B(e,"NUM_LFACTORS",0==c%2?c/2:Math.floor(c/2)+1);"special_skydome.glslf"==na.tp(e)&&na.B(e,"REFLECTION_PASS",0);na.B(e,"SSAO_ONLY",0);b.Pa&&b.Mc?na.B(e,"WATER_EFFECTS",1):na.B(e,"WATER_EFFECTS",0);b.Pa&&b.Ze&&t.Ze?(na.B(e,"CAUSTICS",1),na.B(e,"CAUST_SCALE",b.lo),na.B(e,"CAUST_SPEED",na.t(b.mo,2)),na.B(e,"CAUST_BRIGHT",
b.ko)):na.B(e,"CAUSTICS",0);b.Pa&&(na.B(e,"WAVES_HEIGHT",na.t(b.Qe)),na.B(e,"WAVES_LENGTH",na.t(b.cg)),na.B(e,"WATER_LEVEL",na.t(b.Pe)));a.Hc&&ra.Ha(d,"MAIN_REFLECT")&&-1===a.Bb.indexOf("u_mirrormap")?na.B(e,"REFLECTIVE",1):na.B(e,"REFLECTIVE",0);(g=ra.Ha(d,"SKY"))?a.Wq?(c=g.j.sb,ba.Pi(a,c,"u_sky")):qa.Yj?(a.Wb=g.Wb,na.B(e,"PROCEDURAL_FOG",1)):na.B(e,"PROCEDURAL_FOG",0):na.B(e,"PROCEDURAL_FOG",0);if("SKY_TEXTURE"==f.world.light_settings.environment_color){c=null;if(f.d.Mm.procedural_skydome&&f.world.b4w_sky_settings.use_as_environment_lighting)c=
g.j.sb;else for(g=0;g<b.Zg.length;g++)if(b.Zg[g].texture.b4w_use_as_environment_lighting){c=ba.Cw(b.Zg[g],!1);break}c?(na.B(e,"SKY_TEXTURE",1),ba.Pi(a,c,"u_sky_texture")):va.warn("environment lighting is set to 'Sky Texture', but there is no world texture with environment map")}a.Sa&&(c=ra.Ha(d,"GRASS_MAP"))&&S(a,c,t);a.Cm?"NODES"==a.type?(na.B(e,"REFRACTIVE",1),f.d.Ic?na.B(e,"USE_REFRACTION",1):na.B(e,"USE_REFRACTION",0)):f.d.Ic?na.B(e,"REFRACTIVE",1):na.B(e,"REFRACTIVE",0):(na.B(e,"REFRACTIVE",
0),na.B(e,"USE_REFRACTION",0));a.Oe&&(a.on&&ra.Ha(d,"DEPTH")?na.B(e,"SHORE_SMOOTHING",1):na.B(e,"SHORE_SMOOTHING",0),a.water_dynamic&&b.Pa&&b.Qe?na.B(e,"DYNAMIC",1):na.B(e,"DYNAMIC",0));"PARTICLES"==a.type&&(na.B(e,"SIZE_RAMP_LENGTH",a.Lq),na.B(e,"COLOR_RAMP_LENGTH",a.Cq));if(!a.sc)for(b=a.L,d=0;d<b.length;d++)if(c=b[d],"SCENE"==c.source)for(t=0;t<Ha.length;t++)for(var g=Ha[t],h=Ha[t].vd,l=0;l<h.length;l++)h[l].d==c&&ua.m(Ob,g,f,null);if(a.Gg){b=0;for(var k in a.Gg)b++;a.Yl=new Float32Array(3*b);
a.Wl=new Float32Array(3*b);a.Vl=new Float32Array(3*b);a.Xl=new Float32Array(4*b);na.B(e,"NUM_LAMP_LIGHTS",b);for(d=0;d<f.ma.LAMP.length;d++)Q(a,f.ma.LAMP[d])}}function Q(a,b){var c=b.uuid;if(c in a.Gg){c=a.Gg[c];a.Yl.set(b.d.g,3*c);a.Wl.set(b.ca.direction,3*c);a.Vl.set(b.ca.ng,3*c);var d=Vb,e=b.ca;d[0]=-1;d[1]=-1;d[2]=-1;d[3]=e.Me?1:0;switch(e.type){case "POINT":d[2]=e.distance;break;case "SPOT":d[2]=e.distance;var f=d[0]=Math.cos(e.gd/2);d[1]=e.Tf*(1-f)}a.Xl.set(d,4*c)}}function N(b,c){var d=X(b,
"LAMP",a.DATA_ID_ALL);c.Ia.am=[];for(var e=fa(d)||d[0],f=0;f<d.length;f++){var t=d[f].ca;if("SPOT"==t.type)var g=Math.cos(t.gd/2),h=t.Tf*(1-g);var l=t.index;c.Ia.am.push({type:t.type,index:l,Dx:Math.floor(l/2),Cx:0==l%2?"rg":"ba",gd:g,Tf:h,distance:t.distance,yx:t.Wf||t.Me,kw:l==e.ca.index})}}function u(a){var b=a.Jb.attributes,c=a.na.Ob,d;for(d in b)c[d]||ta.la('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES"==a.type)b=na.Zw(a.Jb.ln),10<b&&("MAIN"==a.type&&va.warn("Varying limit exceeded for main shader - "+
b+', materials: "'+a.wc.join(", ")+'"'),"NODES"==a.type&&(d=c=0,a.Zf&&(c=ta.Kd(a.Zf)),a.Wa&&(d=ta.Kd(a.Wa)),va.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.wc.join(", ")+'"')))}function P(a){8<a.L.length&&va.warn("too many textures used - "+a.L.length+' (max 8), materials "'+a.wc.join(", ")+'"')}function S(a,b,c){a.Mb=b.Mb;var d=b.Mb[0],e=b.Mb[1],f=b.Mb[2];c=c.Eb;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.Mb[2]=f;b=b.j;Aa.Hm(b,
f/2,-e,-d,f/2);Aa.Vg(b);d=a.Il||0;d=0==d?c:Math.max(d,c);a.Il=d}function Z(a){var b=O(a,"MAIN_OPAQUE"),c=!0;ua.P(a.d.ob,function(d,e){"SHADOW_CAST"===e.type&&(V(e,b,e.p,a,c),c=!1)})}function V(b,c,d,e,f){if(0!=d.length){var t=b.j;c=c.j;var g=X(e,"LAMP",a.DATA_ID_ALL),g=fa(g)||g[0],h=g.d;Aa.pr(t,h.g,h.quat);Ea.copy(c.ne,t.ne);xa.copy(c.ka,t.sr);if("SPOT"==g.ca.type||"POINT"==g.ca.type)Aa.Vg(t,t.Za);else{g=Ab;da.qd(g);for(h=0;h<d.length;h++){var l=d[h].fb;0==h?da.Do(l.Qa,g):da.Vo(g,l.Qa)}d=da.Vv(g,
Ka);ta.ve(d,t.ka,d);if(e.d.cd.enable_csm){e=Ea.copy(c.Eh[b.dl],cb);g=xa.invert(c.ka,kb);ta.ve(e,g,e);ta.ve(e,t.ka,e);b=c.el[b.dl];if(f)for(Pb=0,f=2;f<d.length;f+=3)Pb=Math.min(Pb,d[f]);f=Ab;f.max_x=e[0]+b;f.max_y=e[1]+b;f.max_z=0;f.min_x=e[0]-b;f.min_y=e[1]-b;f.min_z=Pb}else{b=f=Ab;c=wa;c.set(d);e=zb/9;d=xa.identity(kb);xa.rotate(d,e,ta.AXIS_MZ,d);h=g=-1;for(l=0;10>l;l++){var k=da.ku(c,sb),K=(k.max_x-k.min_x)*(k.max_y-k.min_y);if(-1==g||K<g)g=K,h=l,da.Do(k,b);ta.ve(c,d,c)}b=h*e;0<b&&(c=xa.identity(kb),
xa.rotate(c,b,ta.AXIS_MZ,c),xa.multiply(c,t.ka,t.ka));b=f.max_x-f.min_x;c=f.max_y-f.min_y;b&&c&&(e=Math.abs(b-c)/2,2<b/c?(f.max_y+=e,f.min_y-=e):2<c/b&&(f.max_x+=e,f.min_x-=e));f.max_x+=.005;f.max_y+=.005;f.max_z+=.005;f.min_x-=.005;f.min_y-=.005;f.min_z-=.005}Aa.Ry(t,f.min_x,f.max_x,f.min_y,f.max_y,-f.max_z,-f.min_z);Aa.Vg(t)}ta.Zo(t.bg,t.zl)}}function fa(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.data.b4w_generate_shadows)return c}return!1}function Y(a,b,c){var d=b.d;b=b.n;for(var e="COLOR_PICKING_XRAY"==
a.type,f=0;f<b.length;f++){var t=b[f];t.Xd!=e||t.sc||"COLOR_ID"!=t.type||(c||(ba.ba(t,"USE_GLOW",0),ba.qb(t),u(t)),a.p.push({U:!0,fb:d,o:t}))}}function ha(a,b){for(var c=ea(b,bc),d=a.ca,e=a.d,f=d.index,t=0;t<c.length;t++){var g=c[t];g.xf.set(e.g,3*f);g.vf.set(d.direction,3*f);g.uf.set(d.ng,3*f);switch(d.type){case "SUN":if(g.Mr.set(e.quat),g.Lr=d.ng,"SKY"===g.type){var h=cb;h[0]=h[1]=h[2]=1;var l=Math.acos(Ea.dot(g.hk,h)),h=Math.acos(Ea.dot(d.direction,h));g.Oj=Math.floor(l/.025)!=Math.floor(h/.025)?
!0:!1;Ea.copy(d.direction,g.hk);R(b,g)}else Ea.copy(d.direction,g.hk);case "HEMI":case "POINT":case "SPOT":break;default:va.error("unknown light type: "+d.type)}l=rb;l[0]=d.Wf?1:0;l[1]=d.Me?1:0;g.wf.set(l,2*f);g.Ca=!0;for(l=0;l<g.p.length;l++)h=g.p[l].o,h.Gg&&Q(h,a)}}function R(a,b){xb.Ih(b);if(b.Oj)for(var c=ea(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY"]),d=0;d<c.length;d++)for(var e=c[d].p,f=0;f<e.length;f++){var t=e[f];t.U&&(t=t.o,ba.zu(t)&&xb.Yz(t))}}function X(b,c,d){if(!b.ma)throw"Access to uninitialized scene";
b=b.ma[c];if(d==a.DATA_ID_ALL)return b;c=[];for(var e=0;e<b.length;e++){var f=b[e];f.d.Sc==d&&c.push(f)}return c}function z(b){var c=[];b=X(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++)for(var e=b[d].data,f=0;f<e.materials.length;f++){var t=e.materials[f];-1==c.indexOf(t)&&c.push(t)}return c}function pa(a,b,c){for(var d=a.d,e=a.camera.d.J,f=0;f<e.length;f++){var t=e[f];Aa.Vg(t,b/c);d.Dm&&Aa.dn(t,d.cd)}d.Dm&&(d.Pj=!0,O(a,"DEPTH").Ca=!0,O(a,"MAIN_BLEND").Ca=!0);Aa.Vr(a.camera);ra.Sz(d.ob,function(d,
e,f){if(d.ph){var t=d.Ee*b,g=d.Ee*c;if(e)for(e=0;e<f.ia.length;e++)f.ia[e]==d&&Sa.resize(d.ja,t,g);else Sa.Wh(d.ja)&&Sa.resize(d.ja,t,g),d=f.j,d.width=t,d.height=g,"DOF"==f.type&&T(a,{dof_power:f.j.dof_power,dof_on:f.j.dof_on}),ga(f,1/b,1/c)}})}function ga(a,b,c){a=a.p;for(var d=0;d<a.length;d++){var e=a[d].o;e&&ba.si(e,b,c)}}function ea(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];ua.P(a.d.ob,function(a,b){b.type==e&&c.push(b)})}return c}function O(a,b){return ra.Ha(a.d.ob,b)}function T(a,b){var c=
O(a,"DOF");if(!c)return va.error("DOF is not enabled on scene. Check camera settings"),0;var d=a.d.ob;"boolean"==typeof b.dof_on&&(c.j.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.j.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.j.dof_power=b.dof_power;for(var e=ra.mb(d,c,"POSTPROCESSING"),d=ra.mb(d,e,"POSTPROCESSING"),e=[e,d],d=0;d<e.length;d++){var f=
e[d].p[0].o;f&&(ba.Rf(f,c.j.dof_power),ga(e[d],1/c.j.width,1/c.j.height))}}c.Ca=!0}function W(a,b){var c=O(Ga,"MAIN_OPAQUE");if(!c||!c.Pa)return va.error("get_water_surface_level() - no water parameters on this scene"),0;var d=c.Qe,e=c.cg,f=c.Pe,t=c.Pa;if(!d||!t.tg)return t.Pe;var g=Ea.length(c.Di),h=c.time;g&&(h*=g);var l=rb;l[0]=20/e*(a-.25*h);l[1]=20/e*(b-.25*h);g=ta.no(l);l[0]=17/e*(b+.1*h);l[1]=17/e*(a+.1*h);var l=ta.no(l),g=g+l-1,k=t.dst_noise_scale0,l=t.dst_noise_scale1,K=t.dst_noise_freq0,
m=t.dst_noise_freq1,n=rb;n[0]=k*(a+K*h);n[1]=k*(b+K*h);k=ta.Om(n);n[0]=l*(b-m*h);n[1]=l*(a-m*h);l=ta.Om(n);l*=d*k;if(c.rk)if(m=(a-c.Be[0])/c.Ce[0],n=(c.Be[1]+b)/c.Ce[1],m+=.5,n+=.5,1<m||0>m||1<n||0>n)d=l;else var m=ta.pp(Ga.d.Jm,c.Xg,m,n),k=t.dir_freq,q=t.dir_noise_scale,r=t.dir_noise_freq,K=t.dir_min_noise_fac,n=t.dst_min_fac,c=e/c.Jg/Math.PI,q=[q/e*(a+r*h),q/e*(b+r*h)],e=Math.sqrt(m),d=d*Math.max(m,t.dir_min_shore_fac)*Math.sin(e/c+k*h)*Math.max(ta.Om(q),K),t=Math.max(e,n),d=d*(1-t)+l*t,g=g*m;else d=
l;return f+(d+.05*g)}function ma(a,b){a.Uh&&"POSTPROCESSING"==a.type&&b.U!=a.U&&(a.U=b.U);b.U||"GLOW"!=a.type||(a.nl=0)}function oa(a,b,c,d){var e=ua.cb(a,b);Aa.ck(e.j,c,d);e.Gk=!0;ua.Le(a,b,function(b,e,f){f.Fa&&f.K==c&&ra.Hu(f)&&ca(a,b,f.Y,d)});ua.Vd(a,b,function(b,e,f){f.Fa&&f.K==c&&f.K==f.Y&&oa(a,b,c,d)})}function ca(a,b,c,d){a=ua.cb(a,b).p;for(b=0;b<a.length;b++)ba.zy(a[b].o,d,c)}function ia(a){var b=O(a,"GRASS_MAP");if(b){var c=b.j,d=a.camera.d,e=d.g;a=cb;a[0]=0;a[1]=-b.Mb[2]/2;a[2]=0;Ea.transformQuat(a,
d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=gb;b[0]=0;b[1]=0;b[2]=0;b[3]=1;Aa.pr(c,a,b)}}function t(a,b){ua.P(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.ia[0]||!d.kd[0])throw"Wrong MOTION_BLUR subscene";var e=d.ia[0],f=d.kd[0];d.kd[0]=d.j.sb;ua.Le(a,c,function(b,c,d){d.Fa&&ca(a,b,d.Y,f)});oa(a,c,e.K,f);ca(a,c,e.Y,d.kd[0]);d.pq=Math.exp(-b/d.Mj)}})}function K(b,c){var d=0,e=b.Ct;0==e.Zm&&(e.Zm=c);var f=c-e.Zm;if(e.cr&&f/e.xc>=e.cr)a.clear_glow_anim(b);else{f%=e.xc;if(f<e.Dp)switch(e=f/(e.Dp/5),f=
Math.floor(e),f){case 0:d=(e-f)/2;break;case 1:d=(e-f)/2+.5;break;case 2:d=1;break;case 3:d=1-(e-f)/2;break;case 4:d=.5-(e-f)/2}b.d.nf=d}}function la(a){ua.P(a.d.ob,function(a,b){b.Ca=!0})}function Oa(a){if("WIND"==a.field.type){a=a.d;ta.quat_to_dir(a.quat,ta.AXIS_Y,sa);Ea.normalize(sa,sa);Ea.scale(sa,a.yl,sa);a=Ha;for(var b=0;b<a.length;b++)for(var c=ea(a[b],Hb),d=0;d<c.length;d++)c[d].Di.set(sa)}}var ba=p("__batch"),da=p("__boundings"),Aa=p("__camera"),Tb=p("__config"),M=p("__data"),Db=p("__debug"),
ja=p("__geometry"),ua=p("__graph"),Za=p("__hud"),jb=p("__objects");p("__particles");var Ba=p("__physics"),Ub=p("__prerender"),wb=p("__primitives"),va=p("__print"),xb=p("__renderer"),ra=p("__scenegraph"),lc=p("__sfx"),na=p("__shaders"),Sa=p("__textures"),ta=p("__util"),Ea=p("vec3"),xa=p("mat4"),qa=Tb.q,bb=Tb.xd,za="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),Pa=["ARMATURE","EMPTY","MESH","SPEAKER"],Gb="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GLOW_MASK WIREFRAME".split(" ");
a.TA=Gb;var bc="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),Eb=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],Hb="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS GLOW_MASK WIREFRAME".split(" "),pb=["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],Nb=0,eb=null,Ga=null,Ha=[],Ob=null,qb=[],fb=0,Fa=0,ob=1,Ia=0,Ua=0,zb=Math.PI/2;a.dg=0;a.vn=1;a.wn=2;a.DATA_ID_ALL=
-1;var rb=new Float32Array(2),cb=new Float32Array(3);new Float32Array(4);var Vb=new Float32Array(4),gb=new Float32Array(4),kb=new Float32Array(16),Ka=new Float32Array(24),wa=new Float32Array(24),Ab=da.qd(),sb=da.qd(),sa=new Float32Array(3),Pb=null;a.set_active=function(a){Ga=a;lc.Oy(a)};a.iy=function(a,b){var c=a.d,d=ra.jv(c.ob);if(a==b){pa(a,fb,Fa);for(var e=0;e<d.length;e++)a.d.Of.push(d[e])}else for(e=a.vd[0],pa(a,e.d.Sf,e.d.Sf),e=0;e<d.length;e++)b.d.Of.push(d[e]);d=ea(a,Hb);for(e=0;e<d.length;e++)d[e].Di.set(sa);
for(e=0;e<c.Of.length;e++)"SHADOW_CAST"==c.Of[e].type&&xb.Ih(c.Of[e])};a.rj=c;a.get_active=b;a.Z=function(){return Ga?!0:!1};a.pj=function(a){return a.camera};a.Rh=function(){return Ha};a.Qw=function(){if(1==Ha.length)return Ha;for(var a=[],b=0;b<Ha.length;b++){var c=Ha[b];if(!c.vd.length){b=ua.Og(Ob,c);b=ua.Ir(Ob,b,ua.tn);b=ua.$m(b);ua.P(b,function(b,c){a.push(c)});break}}return a};a.mf=function(b,c,d,e){for(var f=Ha,t=null,g=0;g<f.length;g++){var l=X(f[g],"ALL",a.DATA_ID_ALL);switch(b){case a.dg:t=
h(c,l,!1,d);break;case a.vn:t=null;(l=h(c,l,!1,e))&&l.dupli_group&&(t=h(d,l.dupli_group.objects,!0,e));break;case a.wn:for(var t=null,k=0;k<c.length;k++)if((t=h(c[k],l,0!=k,d))&&t.dupli_group)l=t.dupli_group.objects;else break}if(t)break}return t};a.Wt=function(a,b,c){for(var e in Pa){var f=Pa[e],t=d(a,f),g=b.d.qh,h=!1;for(e=0;e<c.length;e++)if(h=!0,c[e].d&&c[e].d.tf){for(var l=0;l<g.length;l++)g[l]==c[e]&&(h=!1);h&&g.push(c[e])}f in b.ma||(b.ma[f]=[]);for(l=0;l<t.length;l++)ta.rf(t[l])&&t[l].proxy||
(b.ma.ALL.push(t[l]),b.ma[f].push(t[l]))}};a.Qt=function(b,c){b.ma={ALL:[]};for(var f in za){var t=za[f],h=d(b,t);b.ma[t]=[];for(var K=0;K<h.length;K++)ta.rf(h[K])&&h[K].proxy||(b.ma.ALL.push(h[K]),b.ma[t].push(h[K]))}b.vd=b.vd||[];b.d=b.d||{};t=b.d;h=b.camera.d;f=b.world.b4w_shadow_settings;K=t.cd={};f.csm_resolution>qa.Yc?(K.csm_resolution=qa.Yc,va.error("Shadow map texture has unsupported size. Changed to "+qa.Yc+".")):K.csm_resolution=f.csm_resolution;K.self_shadow_polygon_offset=f.self_shadow_polygon_offset;
K.self_shadow_normal_offset=f.self_shadow_normal_offset;K.enable_csm=f.b4w_enable_csm;var u=X(b,"LAMP",a.DATA_ID_ALL);if(u=fa(u)||u[0])K.Zl=u.ca.type,K.gd=u.ca.gd,K.distance=u.ca.distance,"SPOT"!=K.Zl&&"POINT"!=K.Zl||!K.enable_csm||(va.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),K.enable_csm=!1);K.enable_csm?(K.csm_num=f.csm_num,K.csm_first_cascade_border=f.csm_first_cascade_border,K.first_cascade_blur_radius=f.first_cascade_blur_radius,K.csm_last_cascade_border=
f.csm_last_cascade_border,K.last_cascade_blur_radius=f.last_cascade_blur_radius,K.fade_last_cascade=f.fade_last_cascade,K.blend_between_cascades=f.blend_between_cascades):(K.csm_num=1,K.csm_first_cascade_border=f.csm_first_cascade_border,K.first_cascade_blur_radius=f.first_cascade_blur_radius,K.csm_last_cascade_border=f.csm_last_cascade_border,K.last_cascade_blur_radius=f.last_cascade_blur_radius,K.fade_last_cascade=!1,K.blend_between_cascades=!1);t.qh=[];for(f=0;f<c.length;f++)c[f].d&&c[f].d.tf&&
t.qh.push(c[f]);f=b.world.b4w_fog_color;t.Kb=new Float32Array([f[0],f[1],f[2],b.world.b4w_fog_density]);t.ih=g(b);t.Mm=w(b,t.ih);t.EA=H(b);t.eq=X(b,"LAMP",a.DATA_ID_ALL).length;t.Pa=l(b);t.Kx=r(b);t.Ao=y(b)||qa.force_selectable;t.Xd=A(b);t.Kt=D(b);t.vq=0;h.J[0].type!=Aa.nc&&qa.anaglyph_use?(va.warn("Anaglyph stereo is disabled for the non-perspective camera"),f=!1):f=qa.anaglyph_use;t.anaglyph_use=f;t.Dm=qa.kj&&k(b);t.RB=b.world.b4w_fog_color;t.shore_smoothing=m(b);t.qy=q(b);t.ou=E(b);t.Nx=B(b);t.xu=
x(b);t.fx=n(b);t.cx=e(b);t.sg=qa.sg&&(0<h.dof_distance||h.ff);t.Sa=G(b);t.Lg=qa.Lg&&b.b4w_enable_motion_blur;t.pg=qa.pg&&b.b4w_enable_color_correction;t.antialiasing=qa.antialiasing&&b.b4w_enable_antialiasing;t.kg=qa.kg&&b.b4w_enable_bloom&&t.ih;t.Ge=qa.Ge&&b.b4w_enable_ssao;t.Bz=v(b);t.Cg=qa.Cg&&b.b4w_enable_god_rays&&t.ih;t.Ic=qa.Ic&&b.b4w_render_refractions;t.glow=qa.glow?t.Ao:!1;t.Gv=qa.kj;f=b.vd.sort(function(a,b){return b.d.Sf-a.d.Sf});t.ob=ra.iv(t,h,f);t.Of=[];t.Pj=!1;t.pm=!1;Ha.push(b);Ob||
(Ob=ua.create());ua.A(Ob,b)};a.Zk=d;a.Fl=function(a){return a.d.ob};a.lw=function(a){ua.P(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=ba.Ho(c.gi);break;case "SSAO":d=ba.pv(c);break;case "SSAO_BLUR":d=ba.qv(c);ba.si(d,1/c.j.width,1/c.j.height);break;case "DEPTH_PACK":d=ba.$u();break;case "REFRACT":case "COPY":d=ba.Ho("NONE");break;case "GOD_RAYS":ra.mb(a,c,"WIREFRAME")||ra.mb(a,c,"MAIN_BLEND")||ra.mb(a,c,"GOD_RAYS");d=ba.cv(c.Mq|0,(c.vb&&c.Oe)|0,c.gh);break;case "GOD_RAYS_COMBINE":ra.mb(a,
c,"WIREFRAME")||ra.mb(a,c,"MAIN_BLEND");ra.mb(a,c,"GOD_RAYS");d=ba.dv();break;case "MOTION_BLUR":d=ba.hv(c.Lj);break;case "DOF":d=ba.av();ba.Rf(d,c.j.dof_power);for(var e=ra.mb(a,c,"POSTPROCESSING"),f=ra.mb(a,e,"POSTPROCESSING"),t=[e,f],g=0;g<t.length;g++){var h=t[g].p;(e=h[0].o)&&ba.Rf(e,c.j.dof_power)}break;case "GLOW":t=ra.mb(a,c,"POSTPROCESSING");g=ra.mb(a,t,"POSTPROCESSING");e=ra.mb(a,g,"POSTPROCESSING");f=ra.mb(a,e,"POSTPROCESSING");d=ba.bv();t=[g,t];for(g=0;g<t.length;g++)h=t[g].p,(h=h[0].o)&&
ba.Rf(h,c.bo);t=[f,e];for(g=0;g<t.length;g++)h=t[g].p,(h=h[0].o)&&ba.Rf(h,c.Yo*c.tj);break;case "COMPOSITING":d=ba.Yu();break;case "ANTIALIASING":d=ba.Uu();break;case "LANCZOS":d=ba.ev(c.GC);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=ba.nv(c.type);break;case "ANAGLYPH":d=ba.Su();break;case "SKY":d=ba.mv();ba.si(d,1/c.j.width,1/c.j.height);break;case "LUMINANCE":d=ba.fv();break;case "AVERAGE_LUMINANCE":d=ba.Vu();
break;case "LUMINANCE_TRUNCED":d=ba.gv();break;case "BLOOM_BLUR":d=ba.Wu(c.gi);ba.si(d,1/c.j.width,1/c.j.height);break;case "BLOOM":d=ra.mb(a,c,"BLOOM_BLUR");t=[ra.mb(a,d,"BLOOM_BLUR"),d];for(g=0;g<t.length;g++)h=t[g].p,(h=h[0].o)&&ba.Rf(h,c.bloom_blur);d=ba.Xu();break;case "VELOCITY":d=ba.tv();break;case "ANCHOR_VISIBILITY":d=ba.Tu()}d&&(e={U:!0,fb:jb.gj("NONE"),o:d},u(d),c.p.push(e),L(a,c,d),P(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":var d=a.d.ob,e=b.d;!ra.Ha(d,"SHADOW_CAST")&&
e.Ab&&(e.Ab=!1);e=ea(a,Gb);c&&(Ba.has_physics(b)&&Ba.append_object(b,a),a.ma.ALL.push(b),a.ma[b.type].push(b),b.ra&&b.ra.ol.bc&&(b.UC=b.name,b.ra.dupli_group.objects.push(b)));for(var f=0;f<e.length;f++)C(e[f],b,d,a,c);break;case "LAMP":b.ca.index=a.d.vq++;c=ea(a,bc);for(d=0;d<c.length;d++)c[d].Ff++;ha(b,a)}};a.remove_object=function(a){if(!a.d.Sl)return!1;var c=b();M.hy(c,a,!1);var d=c.ma.ALL.indexOf(a);-1!=d&&c.ma.ALL.splice(d,1);d=c.ma[a.type].indexOf(a);-1!=d&&c.ma[a.type].splice(d,1);a.ra&&a.ra.ol.bc&&
(d=a.ra.ol.bc.indexOf(a),-1!=d&&a.ra.ol.bc.splice(d,1));return!0};a.ZA=C;a.Fm=function(a){a.d.Pj=!0};a.Hw=function(a,b){for(var c=a.d.cd,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=Aa.vv(c,b,e);return d};a.hide_object=function(a){a.d.Sh=!0};a.show_object=function(a){a.d.Sh=!1};a.uy=function(a,b,c){b=b.d;a=ea(a,Gb);for(var d=0;d<a.length;d++)for(var e=a[d].p,f=e.length-1;0<=f;f--){var t=e[f];t.fb==b&&(t.o&&c&&ja.vo(t.o.na),e.splice(f,1))}};a.check_object=function(a,b){return b.ma[a.type]&&
-1<b.ma[a.type].indexOf(a)?!0:!1};a.nz=function(a){var b=a.ma.LAMP;if(b.length==a.d.vq){for(var c=[],d=0;d<b.length;d++)c[b[d].ca.index]=d;for(d=0;d<c.length-1;d++)for(var e=d+1;e<c.length;e++){var f=b[c[d]].ca,t=b[c[e]].ca;if(t.Wf&&t.Me&&(!f.Wf||!f.Me)||!f.Wf&&(t.Wf||!f.Me&&t.Me))f=c[d],c[d]=c[e],c[e]=f}for(d=0;d<c.length;d++)b[c[d]].ca.index=d,ha(b[c[d]],a)}};a.Uf=ha;a.cleanup=function(){for(var a=0;a<Ha.length;a++){var b=Ha[a];ua.P(b.d.ob,function(a,b){if("SINK"!=b.type){var c=b.j;xb.wy(c.Id,c.sb,
c.rc,c.width,c.height);for(var c=b.p,d=0;d<c.length;d++){var e=c[d].o;e&&ba.Ju(e)}}});b.d.ob=[];b.d.Of=[]}Ga=eb=null;Ha.length=0;Ob=null;qb.length=0;sa[0]=0;sa[1]=0;sa[2]=0};a.mq=function(a,b,c){a=Aa.Wv(a,a.Ja,a.Ta,null,!0);var d=wb.qw(a);a=jb.gj("DYNAMIC");a.Qa=a.Eb={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.rb=a.Cc=da.mu();var e=a.rb.va;a.Ye=a.Xe=da.bl([e,0,0],[0,e,0],[0,0,e],a.rb.D);c=ba.lv(d,c);b.p.push({U:!0,fb:a,o:c})};a.Ba=X;a.jC=function(a){return[a.frame_start,
a.frame_end]};a.qr=function(a,b,c,d,e){fb=a;Fa=b;ob=c;Ia=e;Ua=d;Ga&&pa(Ga,a,b)};a.si=ga;a.Hz=ea;a.fa=O;a.get_environment_colors=function(a){a=ea(a,bc)[0];var b=a.tc,c=a.zc,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.me,d,e]};a.set_environment_colors=function(a,b,c,d){a=ea(a,bc);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.me=b);c&&f.tc.set(c);d&&f.zc.set(d);f.Ca=!0}};a.get_sky_params=function(a){if(a=O(a,"SKY")){var b={};b.color=Array(3);Ea.copy(a.Yg,b.color);
b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=
function(a,b){var c=O(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.Yg.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),
"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.Ca=!0,c.Oj=
!0,R(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=ea(a,Eb)[0].Kb;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=ea(a,Eb),d=0;d<c.length;d++){var e=c[d];e.Kb.set(b);e.Ca=!0}};a.get_ssao_params=function(a){var b=O(a,"SSAO");a=O(a,"SSAO_BLUR");if(!b)return null;var c=b.p[0].o,d={};d.ssao_quality=ba.nb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.ao=a.ssao_blur_discard_value;d.radius_increase=
b.dh;d.influence=b.bh;d.dist_factor=b.ah;d.ssao_only=b.ssao_only;d.ssao_white=ba.nb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=O(a,"SSAO"),d=O(a,"SSAO_BLUR");if(!c)return va.error("SSAO is not enabled on scene"),0;if("string"==typeof b.ssao_quality){var e=c.p[0].o;ba.ba(e,"SSAO_QUALITY",b.ssao_quality);ba.qb(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.p[0].o,ba.ba(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),ba.qb(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.p[0].o,ba.ba(e,
"SSAO_BLUR_DEPTH",b.ssao_blur_depth),ba.qb(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.dh&&(c.dh=b.dh);"number"==typeof b.bh&&(c.bh=b.bh);"number"==typeof b.ah&&(c.ah=b.ah);if("number"==typeof b.ssao_only){c=O(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var f=0;f<c.p.length;f++)e=c.p[f].o,ba.ba(e,"SSAO_ONLY",b.ssao_only),ba.qb(e,!0)}"number"==typeof b.ssao_white&&(e=c.p[0].o,ba.ba(e,"SSAO_WHITE",b.ssao_white),ba.qb(e,
!0));c.Ca=!0;d.Ca=!0};a.get_dof_params=function(a){a=O(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=a.j.dof_front;b.dof_rear=a.j.dof_rear;b.dof_power=a.j.dof_power;return b};a.set_dof_params=T;a.get_god_rays_params=function(a){var b=ea(a,["GOD_RAYS"]);a=O(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].Ig;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=ba.nb(b[0].p[0].o,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=
function(a,b){var c=ea(a,["GOD_RAYS"]),d=O(a,"GOD_RAYS_COMBINE");if(!c||!d)return va.error("God Rays are not enabled on scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].Ig=e,c[f].$j=e/c[f].gh/(f+1),c[f].Ca=!0;if("number"==typeof b.god_rays_steps)for(var t=na.t(b.god_rays_steps,1),e=c[0].Ig,f=0;f<c.length;f++){c[f].gh=t;c[f].$j=e/t/(f+1);c[f].Ca=!0;var g=
c[f].p[0].o;ba.ba(g,"STEPS_PER_PASS",t);ba.qb(g,!0)}d.Ca=!0};a.get_bloom_params=function(a){var b=O(a,["LUMINANCE_TRUNCED"]);a=O(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=function(a,b){var c=O(a,"LUMINANCE_TRUNCED"),d=O(a,"BLOOM");if(!c||!d)return va.error("Bloom is not enabled on scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.Ca=!0);"number"==typeof b.bloom_edge_lum&&
(c.bloom_edge_lum=b.bloom_edge_lum,c.Ca=!0);if("number"==typeof b.bloom_blur)for(var e=a.d.ob,c=ra.mb(e,d,"BLOOM_BLUR"),e=ra.mb(e,c,"BLOOM_BLUR"),c=[c,e],e=0;e<c.length;e++){var f=c[e].p[0].o;f&&(ba.Rf(f,b.bloom_blur),ga(c[e],1/d.j.width,1/d.j.height))}};a.get_wind_params=function(){var a=sa,b=Ea.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.set_wind_params=function(b,c){for(var d=X(b,"ALL",a.DATA_ID_ALL),e=0;e<d.length;e++){var f=
d[e];if("EMPTY"===f.type&&f.field&&"WIND"===f.field.type)var t=f}if(!t)return va.error("There is no wind on the scene"),0;d=t.d;"number"==typeof c.wind_dir&&(cb=[0,c.wind_dir/180*Math.PI,-Math.PI/2],ta.euler_to_quat(cb,gb),d.quat.set(gb),Oa(t));"number"==typeof c.wind_strength&&(d.yl=c.wind_strength,Oa(t));la(b)};a.Jy=function(a){a.d.pm=!0};a.get_water_surface_level=W;a.get_water_mat_params=function(a,b){var c=O(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.Qe,b.waves_length=c.cg,c.Mc)){b.water_fog_density=
c.Mc[3];var d=b.water_fog_color=[];d[0]=c.Mc[0];d[1]=c.Mc[1];d[2]=c.Mc[2]}};a.set_water_params=function(a,b){var c=O(a,"MAIN_OPAQUE");if(!c||!c.Pa)return va.error("set_water_params() - no water parameters on this scene"),null;c=c.Pa;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=
b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);
"number"==typeof b.water_dynamic&&(c.tg=b.water_dynamic);for(var d=ea(a,pb),e=0;e<d.length;e++){var f=d[e];"number"==typeof b.water_fog_density&&c.Kb&&(f.Mc[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.Kb&&f.Mc.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.Qe=b.waves_height);"number"==typeof b.waves_length&&(f.cg=b.waves_length);f.Ca=!0}};a.get_shore_dist=function(a,b){var c=O(Ga,"MAIN_OPAQUE");if(!c.rk)return 100;var d=c.Jg,e=c.Pe,f=(a[0]-c.Be[0])/c.Ce[0],t=(c.Be[1]+
a[2])/c.Ce[1],f=f+.5,t=t+.5;if(1<f||0>f||1<t||0>t)e=1;else return c=d*ta.pp(Ga.d.Jm,c.Xg,f,t),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,c){for(var d=b().camera.d,e=0;e<Ha.length;e++){var f=Ha[e],g=f.d.ob;if(f.d.Pa)var h=d.g[1]-W(d.g[0],d.g[2]);for(var l=f.d.qh,k=0;k<l.length;k++){var m=l[k].d,n=m.Xa,q=m.wg+m.Aa;if(n){var r=Math.round(n.currentTime*m.Lb),u=m.Aa/m.Lb;if(r<m.Aa-(qa.sf?5:0)||l[k].d.Vf&&r>q)n.currentTime=u;!m.Vf&&r>q&&n.pause();2<=n.readyState&&!n.paused&&Sa.mA(m)}else if(m.Tg){n=
Math.min(m.Tg.length,m.wg+m.Aa);if(m.Td<m.Aa||m.Vf&&m.Td>=n)m.Td=m.Aa;!m.Vf&&m.Td>=n&&(m.Ug=!1);n=Math.round(a*bb.Ea/m.Lb)*m.jr;n!=Nb&&m.Ug&&(Sa.jA(m),m.Td++);Nb=n}}ua.P(g,function(b,c){-1<Hb.indexOf(c.type)&&(c.time=a);-1<pb.indexOf(c.type)&&f.d.Pa&&(c.Sk=h)})}for(e=0;e<Ha.length;e++)if(f=Ha[e],k=f.d,d=k.Of,k.Pj&&(Z(f),k.Pj=!1),k.pm&&(ia(f),k.pm=!1),d.length){f.b4w_enable_motion_blur&&t(k.ob,c);if(k.glow){for(var T=0,e=0;e<f.ma.MESH.length;e++)k=f.ma.MESH[e],T+=k.d.nf,-1!=qb.indexOf(k)&&K(k,a);ua.P(f.d.ob,
function(a,b){"GLOW"===b.type&&(b.nl=T)})}g=null;for(k=0;k<d.length;k++)"GLOW_MASK"==d[k].type&&(g=k);for(k=0;k<d.length;k++)l=d[k],Ub.zm(l),null!==g&&ma(l,d[g]),xb.Ih(l)}qa.show_hud_debug_info&&Za.iz(Ha,c)};a.Dl=function(a){var b=[];ua.P(a.d.ob,function(a,c){b.push(c)});return b};a.apply_glow_anim=function(a,b,c,d){a.Ct={Zm:0,Dp:b,xc:c,cr:d};-1==qb.indexOf(a)&&qb.push(a)};a.clear_glow_anim=function(a){a.d.nf=0;a=qb.indexOf(a);-1!=a&&qb.splice(a,1)};a.vB=function(){qb=[]};a.get_cam_water_depth=function(){var a=
O(Ga,"MAIN_BLEND"),b=Ga;return a||b.d.Pa?a.Sk:null};a.get_object_data_id=function(a){return a.d.Sc};a.$r=la;a.ez=function(a,b){switch(b){case "WM_NONE":a.U=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.p.length;c++)a.p[c].o.wireframe_mode=Db.Bn[b];a.U=!0}a.za="WM_TRANSPARENT_WIREFRAME"==b;a.Ca=!0};a.dz=function(a,b){for(var c=0;c<a.p.length;c++)a.p[c].o.wireframe_edge_color=b,a.Ca=!0};a.Jn=function(a,b){for(var c=
0;c<b.length;c++)a.ma.ALL.push(b[c]),a.ma.MESH.push(b[c])};a.Xr=Oa;a.pick_object=function(b,d){var e=c();if(!e)return va.error("No active scene"),null;var f=O(e,"COLOR_PICKING");if(f){b-=Ua;d-=Ia;b*=ob;d*=ob;Ub.zm(f);xb.Ih(f);var t=O(e,"COLOR_PICKING_XRAY");t?(Ub.zm(t),xb.Ih(t),f=t.j):f=f.j;d=f.height-d;f=xb.ar(f.Id,b,d);e=X(e,"MESH",a.DATA_ID_ALL);for(t=0;t<e.length;t++){var g=e[t].d.ej;if(g&&3>Math.abs(255*g[0]-f[0])&&3>Math.abs(255*g[1]-f[1])&&3>Math.abs(255*g[2]-f[2]))return e[t]}}else va.error("Color picking is not available");
return null};a.ax=function(){return sa};a.Sw=function(b){var c=[];b=X(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var e=b[d];e.d.ad&&c.push(e)}return c};a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b};a.Vz=function(){for(var b=Ga,c=X(b,"MESH",a.DATA_ID_ALL),d=0;d<c.length;d++)for(var e=c[d].n,f=0;f<e.length;f++){var t=e[f];if("MAIN"==t.type||"NODES"==t.type)N(b,t),ba.qb(t)}};a.Bp=function(){return ob}};b4w.module.__physics=function(a,p){function c(a,b){for(var d=a.oc,e=0;e<d.length;e++)d[e].d.pk&&b.push(d[e]),c(d[e],b)}function b(a,b){if(fa)switch(a){case D.ys:y.log(b);break;case D.vs:y.error(b);break;case D.ws:A.fbmsg.apply(this,b.slice(1));break;case D.Cs:var c=h(b.body_id);if(c){var d=b.trans,e=b.quat,f=b.linvel,t=b.angvel,c=c.l;c.fl=b.time;I.ri(d,1,e,c.gl);N.copy(f,c.jq);N.copy(t,c.Kn)}break;case D.As:(d=h(b.chassis_hull_body_id))&&I.ri(b.trans,1,b.quat,d.i.ii[b.prop_ind]);break;case D.xs:if(c=
h(b[1]))d=b[4],c=c.pc.Vi[b[2]],C.set_translation(c,b[3]),C.set_rotation(c,d),C.C(c);break;case D.Ds:if(c=h(b[1]))c.i.speed=b[2];break;case D.ts:for(var d=b.body_id_a,c=b.body_id_b,e=b.result,f=b.coll_point,d=parseInt(d),t=fa.l.p,g=0;g<t.length;g++)for(var l=t[g].pb,k=0;k<l.Qc.length;k++){for(var m=l.Qc[k],n=m.Tj,q=!1,r=0;r<n.length;r++){var u=n[r];if(u[0]===d&&u[1]===c){m.Pq[r]=e;q=!0;break}}if(q){n=m.Pq;for(r=q=0;r<n.length;r++)q=q||n[r];m.callback(q,f)}}break;case D.us:if(c=h(b[1]))c=c.l,c.dj&&
c.dj(b[2]);break;case D.Bs:if(c=h(b.body_id))for(c=c.l,e=b.from,f=b.to,t=b.local,g=b.body_id_b_hit,l=b.cur_result,k=0;k<c.we.length;k++)if(n=c.we[k],J.cj(n.K,e)&&J.cj(n.Y,f)&&n.local==t){for(d in n.Rd)n.Rd[d]=1;-1!=g&&(n.Rd[g]=l);for(var m=n.Vb,r=n.callback,n=n.Rd,q=!1,u=1,v=0;v<fa.l.p.length;v++){var w=fa.l.p[v].pb;if(("ANY"==m||w.id==m)&&w.M in n&&1!==n[w.M]){q=!0;u=n[w.M];break}}r(q,u)}break;case D.zs:console.log("Physics message ping: ",performance.now()-b[1]);break;default:y.error("Wrong message: "+
a)}}function h(a){return ha[a]||null}function d(){R.body++;return R.body}function f(a){return{M:a,hm:0,Dj:!1,De:!0,DC:!1,is_character:!1,tx:!1,fj:null,id:"",xB:{},Qc:[],dj:null,we:[],fl:0,gl:new Float32Array([0,0,0,1,0,0,0,1]),jq:new Float32Array(3),Kn:new Float32Array(3),Zi:new Float32Array(3),Yi:new Float32Array(4)}}function k(a,b){switch(a){case "BOX":var c=b.Eb;break;case "CYLINDER":c=b.Kk;break;case "CONE":c=b.Jk;break;case "SPHERE":c=b.Cc;break;case "CAPSULE":c=b.Ik}return c}function g(a){if(!a)return null;
var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.D&&(b.center=a.D);"number"===typeof a.va&&(b.radius=a.va);"number"===typeof a.height&&(b.height=a.height);return b}function m(a,b,c,d){var e=a.d.g,f=b.d.N,t=new Float32Array(16);P.invert(f,t);f=new Float32Array(3);
N.transformMat4(e,t,f);switch(b.i.type){case 10:b=b.b4w_vehicle_settings;a=a.d.Eb;D.r(D.Fs,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:D.r(D.Es,c,f,a.jD)}}function l(a){return a.l&&a.l.fj?!0:!1}function r(a,b,c,d,e,f,t,g,h,l){var k;R.Co++;k=R.Co.toString(16);D.r(D.Ms,k,a,g,b.l.M,c,d,e.l.M,f,t,h,l);b.l.fj=k}function q(a){var b=a.l;if(b&&(0===b.hm||!0===b.Dj||!1===b.De||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.g[0]!=a.l.Zi[0]||a.d.g[1]!=a.l.Zi[1]||a.d.g[2]!=
a.l.Zi[2]||a.d.quat[0]!=a.l.Yi[0]||a.d.quat[1]!=a.l.Yi[1]||a.d.quat[2]!=a.l.Yi[2])){a.l.Zi.set(a.d.g);a.l.Yi.set(a.d.quat);var b=a.l,c=D.up(D.eg);c.msg_id=D.eg;c.body_id=a.l.M;c.trans=a.d.g;"DYNAMIC"===b.type?(c.quat=z,u.identity(z)):c.quat=a.d.quat;D.r(D.eg,c)}a=a.oc;for(b=0;b<a.length;b++)q(a[b])}function w(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.quat;e[0]=b;e[1]=c;e[2]=d;N.transformQuat(e,a,e)}function v(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.l.p.length;e++){var f=
b.l.p[e];if("ANY"==a||f.pb.id==a)f=f.pb.M,c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function E(a,b){D.r(D.Nc,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=J.Pn(e.K)+J.Pn(e.Y)+String(e.local);c[f]=c[f]||{K:e.K,Y:e.Y,local:e.local,co:[]};var t=c[f].co,g;for(g in e.Rd)-1==t.indexOf(g)&&t.push(g)}for(f in c)d=c[f].K,e=c[f].Y,g=c[f].local,t=c[f].co,D.r(D.zn,a,d,e,g,t)}else D.r(D.zn,a,null,null,!1,null)}function B(a,b){if(b.fh){var c=a.l.M,d=b.ug*b.gp,e=b.Bh*b.fo,f=-b.eh*b.Tm*2*Math.PI/
b.Er;b.Vp&&(f*=-1);switch(b.type){case 10:D.r(D.Nc,c);D.r(D.st,c,d,e,f);break;case 20:D.r(D.Nc,c),D.r(D.rt,c,d,e,f)}}}function x(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function n(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function e(a){return a.b4w_character?!0:!1}function H(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}var G=p("__config");p("__constraints");var y=p("__print"),A=p("__debug"),D=p("__ipc");p("__renderer");
var L=p("__scenes"),C=p("__transform"),I=p("__tsr"),J=p("__util"),Q=p("__version"),N=p("vec3"),u=p("quat"),P=p("mat4"),S=G.pb,Z=G.q,V=null,fa=null,Y=[],ha=[],R={ns:0,body:0,Co:0,shape:0},X=new Float32Array(3),z=new Float32Array(4),pa=new Float32Array(4),ga=new Float32Array(16),ea=new Float32Array(8),O=new Float32Array(8);a.nx=function(a){if(S.enabled){var c=S.yi+Q.timestamp();y.log("%cLOAD PHYSICS","color: #0a0",c,"Max FPS: "+S.se);V=new Worker(c);D.init(V,b);D.r(D.bt,a,S.se)}};a.Sn=function(a){var b;
R.ns++;b=R.ns;D.r(D.Rs,b);a.l={};a.l.DA=b;a.l.p=[]};a.cleanup=function(){if(S.enabled){D.r(D.Xs);fa=null;Y.length=0;ha.length=0;for(var a in R)R[a]=0}};a.append_object=function(a,b){fa=b;D.r(D.gt,b.l.DA);var h=a.d;if(!h)throw"No object render: "+a.name;if(a.parent&&h.pk)return null;var q=[];h.pk&&c(a,q);if(x(a)||n(a)||e(a)||H(a)||a.b4w_collision){var w,v=a,t=h.Rq,K=v.d,la=v.game,p=d();if("CAMERA"==v.type)var E=la.use_collision_bounds?la.collision_bounds_type:"BOX",O=k(E,K),z=K.Oh,A=K.Jh,z=.5,A=0;
else"EMPTY"==v.type?(E="EMPTY",O=null,A=z=0):(E=la.use_collision_bounds?la.collision_bounds_type:"BOX",O=k(E,K),z=K.Oh,A=K.Jh);var M=K.g,G=K.quat,C=la.use_ghost,S=la.use_sleep,I=la.mass,Z=la.velocity_min,V=la.velocity_max,R=la.damping,Q=la.rotation_damping,X=la.collision_group,ea=la.collision_mask,ra=K.Cc.va,lc=g(O),na=v.b4w_correct_bounding_offset,Sa;var ta=E;if(q.length){var Ea=[],xa={};xa.quat=new Float32Array([0,0,0,1]);xa.trans=new Float32Array(3);xa.worker_bounding=lc;xa.bounding_type=ta;Ea.push(xa);
P.invert(K.N,ga);u.invert(K.quat,pa);for(var qa=0;qa<q.length;qa++){var bb={},za=q[qa],Pa=za.game.collision_bounds_type,Gb=new Float32Array(4),bc=new Float32Array(3);N.transformMat4(za.d.g,ga,bc);u.multiply(pa,za.d.quat,Gb);bb.trans=bc;bb.quat=Gb;bb.bounding_type=Pa;bb.worker_bounding=g(k(Pa,za.d));Ea.push(bb)}Sa=Ea}else Sa=[];D.r(D.Is,p,M,G,t,C,S,I,Z,V,R,Q,X,ea,E,lc,ra,z,A,Sa,na);Y.push(v);ha[p]=v;var Eb=f(p);Eb.type=t;Eb.hm=I;Eb.Dj=C;w=Eb;a.l=w;var Hb={o:null,pb:w};b.l.p.push(Hb)}else for(var pb=
a.n||[],Nb=0;Nb<pb.length;Nb++){var eb=pb[Nb],Ga;if(Ga="PHYSICS"==eb.type){var Ha;a:{for(var Ob=b.l.p,qb=0;qb<Ob.length;qb++){var fb=Ob[qb].o;if(fb&&fb.id==eb.id){Ha=!0;break a}}Ha=!1}Ga=!Ha}if(Ga)if(eb.jc.I)if(eb.Oe&&b.d.Pa){var Fa=eb,ob=fa,Ia=L.fa(ob,"MAIN_OPAQUE");D.r(D.Qs,Ia.Pe);if(Ia.Pa&&Fa.zA){var Ua={};Ua.dst_noise_scale0=Fa.dst_noise_scale0;Ua.dst_noise_scale1=Fa.dst_noise_scale1;Ua.dst_noise_freq0=Fa.dst_noise_freq0;Ua.dst_noise_freq1=Fa.dst_noise_freq1;Ua.dir_min_shore_fac=Fa.dir_min_shore_fac;
Ua.dir_freq=Fa.dir_freq;Ua.dir_noise_scale=Fa.dir_noise_scale;Ua.dir_noise_freq=Fa.dir_noise_freq;Ua.dir_min_noise_fac=Fa.dir_min_noise_fac;Ua.dst_min_fac=Fa.dst_min_fac;Ua.waves_hor_fac=Fa.waves_hor_fac;var zb=Ia.Qe,rb=Ia.cg;Ia.rk?D.r(D.yn,Ua,Ia.Ce[0],Ia.Ce[1],Ia.Be[0],Ia.Be[1],Ia.Jg,zb,rb,Ia.Xg,ob.d.Jm):D.r(D.yn,Ua,0,0,0,0,0,zb,rb,0,null)}}else{var cb;if(eb.qA){var Vb=a,gb=eb,kb=d(),Ka=gb.jc;D.r(D.Os,kb,Ka.v[0].a_position,Ka.W||null,Vb.d.g,gb.xo,gb.yo);var wa=f(kb);wa.Dj=!0;cb=wa}else{var Ab=a,
sb=eb,sa=d(),Pb=sb.jc;D.r(D.Ps,sa,Pb.v[0].a_position,Pb.W||null,Ab.d.g,sb.Oh,sb.Jh,sb.xo,sb.yo);cb=f(sa)}w=cb;w.id=eb.Vb;Hb={o:eb,pb:w};b.l.p.push(Hb)}else y.error("Object "+a.name+" has collision material with no assigned vertices")}if(x(a)||n(a)){var aa=a,db=aa.l.M;x(aa)?(aa.i.type=10,D.r(D.Js,db,aa.i.Kz,aa.i.Mz,aa.i.Lz,aa.i.BA,aa.i.Mx)):n(aa)&&(aa.i.type=20,D.r(D.Hs,db,aa.i.vl,aa.i.mn,aa.i.nn));if(aa.i.Nf){var Qa=aa.i.Nf;switch(aa.i.type){case 10:m(Qa[1],aa,db,!0);m(Qa[0],aa,db,!0);m(Qa[3],aa,
db,!1);m(Qa[2],aa,db,!1);break;case 20:for(var Ca=0;Ca<Qa.length;Ca++)m(Qa[Ca],aa,db,!1)}}aa.l.id=aa.b4w_vehicle_settings.name;B(a,a.i)}else if(e(a)){var Ta=a.d,yb=a.l,Fb=Ta.Eb.max_y-Ta.Eb.min_y,cc=yb.M,Bb=a.b4w_character_settings,Ra=Bb.walk_speed,Wb=Bb.run_speed,Ib=Bb.step_height,dc=Bb.jump_strength,Xb=Bb.waterline,mc=J.Iv(a);D.r(D.Ks,cc,mc,Fb,Ra,Wb,Ib,dc,Xb);yb.is_character=!0}else if(H(a)){var tb=a,hb=tb.l.M;D.r(D.Ns,hb,tb.pc.vl,tb.pc.mn,tb.pc.nn);if(tb.pc.Vi)for(var nc=tb.pc.Vi,ic=0;ic<nc.length;ic++){var $a=
nc[ic],oc=$a.d.g,F=tb.d.N,Jb=new Float32Array(16);P.invert(F,Jb);var lb=new Float32Array(3);N.transformMat4(oc,Jb,lb);D.r(D.Gs,hb,lb,$a.qu)}tb.l.tx=!0}else a.b4w_collision&&(w.id=a.b4w_collision_id);for(Nb=0;Nb<Y.length;Nb++)if(a=Y[Nb],a.l){var Da=a;if(!l(Da))for(var ib=0;ib<Da.constraints.length;ib++){var U=Da.constraints[ib],Va=U.target,Wa=U.pivot_type;if("RIGID_BODY_JOINT"==U.type&&Va.l){var Qb=new Float32Array([U.pivot_x,U.pivot_y,U.pivot_z]),ya,Kb=new Float32Array([U.axis_x,U.axis_y,U.axis_z]);
ya=J.euler_to_quat(Kb,new Float32Array(4));var Ma=P.fromRotationTranslation(ya,Qb,new Float32Array(16)),uc=P.multiply(Da.d.N,Ma,new Float32Array(16)),Yb=P.invert(Va.d.N,new Float32Array(16)),Cb=P.multiply(Yb,uc,Yb),ec=J.Bf(Cb),Fc=J.matrix_to_quat(Cb),La=U,Na={};Na.use_limit_x=La.use_limit_x;Na.use_limit_y=La.use_limit_y;Na.use_limit_z=La.use_limit_z;Na.use_angular_limit_x=La.use_angular_limit_x;Na.use_angular_limit_y=La.use_angular_limit_y;Na.use_angular_limit_z=La.use_angular_limit_z;Na.limit_max_x=
La.limit_max_x;Na.limit_min_x=La.limit_min_x;Na.limit_max_y=La.limit_max_y;Na.limit_min_y=La.limit_min_y;Na.limit_max_z=La.limit_max_z;Na.limit_min_z=La.limit_min_z;Na.limit_angle_max_x=La.limit_angle_max_x;Na.limit_angle_min_x=La.limit_angle_min_x;Na.limit_angle_max_y=La.limit_angle_max_y;Na.limit_angle_min_y=La.limit_angle_min_y;Na.limit_angle_max_z=La.limit_angle_max_z;Na.limit_angle_min_z=La.limit_angle_min_z;r(Wa,Da,Qb,ya,Va,ec,Fc,Na,null,null)}}}};a.aw=h;a.update=function(){for(var a=0;a<Y.length;a++){var b=
Y[a],c=b.l;if(c.De&&c.fl){var d=performance.now()/1E3-c.fl,d=Math.min(d,10/60);Z.Sx&&(d=0);var e=ea;I.ox(c.gl,d,c.jq,c.Kn,ea);C.set_translation(b,I.Ap(e));C.set_rotation(b,I.vp(e));C.C(b);q(b);if(b.i)for(var c=b,d=c.i.Nf,e=c.d.Wd,f=ea,t=0;t<d.length;t++){var g=d[t];I.multiply(e,c.i.ii[t],f);C.or(g,f);C.C(g)}b.i&&b.i.fh&&(c=b.i,d=c.fh)&&(e=b.i.Fr,g=ga,f=b.d.g,t=b.d.quat,J.bn(b.i.Gr,t,f,g),J.Bf(g,d.d.g),J.matrix_to_quat(g,d.d.quat),g=z,J.cn(e,t,f,g),e=pa,u.setAxisAngle(g,-c.eh*c.Tm*2*Math.PI,e),u.multiply(e,
d.d.quat,d.d.quat),C.C(d));b.i&&b.i.Qm&&(c=b.i,d=c.Qm)&&(f=b.i.Ar,e=ga,t=b.d.g,g=b.d.quat,J.bn(b.i.Br,g,t,e),J.Bf(e,d.d.g),J.matrix_to_quat(e,d.d.quat),e=z,J.cn(f,g,t,e),f=pa,t=Math.abs(c.speed)*c.zr,t>c.jm&&(t=c.jm),u.setAxisAngle(e,-t,f),u.multiply(f,d.d.quat,d.d.quat),C.C(d));b.i&&b.i.Wm&&(c=b.i,d=c.Wm)&&(e=b.i.Nr,g=ga,f=b.d.g,t=b.d.quat,J.bn(b.i.Or,t,f,g),J.Bf(g,d.d.g),J.matrix_to_quat(g,d.d.quat),b=z,J.cn(e,t,f,b),e=pa,u.setAxisAngle(b,-Math.abs(c.ug)*c.Po,e),u.multiply(e,d.d.quat,d.d.quat),
C.C(d))}}if(a=fa)a=L.fa(a,"MAIN_OPAQUE"),a.Pa&&0<a.Pa.waves_height&&(b=N.length(a.Di),D.r(D.qt,a.time*b))};a.ww=function(){return fa};a.pause=function(){S.enabled&&D.r(D.ct)};a.resume=function(){S.enabled&&D.r(D.ft)};a.enable_simulation=function(a){a=a.l;if(!a)throw"No object physics";if(!a.De){var b=a.M;a.De=!0;D.r(D.at,b)}};a.disable_simulation=function(a){a=a.l;if(!a)throw"No object physics";if(a.De){var b=a.M;a.De=!1;D.r(D.$s,b)}};a.has_physics=function(a){return a.l?!0:!1};a.has_dynamic_physics=
function(a){return(a=a.l)&&a.De&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.hm&&0==a.Dj?!0:!1};a.has_simulated_physics=function(a){return(a=a.l)&&a.De?!0:!1};a.set_gravity=function(a,b){D.r(D.pt,a.l.M,b)};a.ix=l;a.apply_constraint=r;a.clear_constraint=function(a){a=a.l;D.r(D.et,a.fj);a.fj=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,g){c=I.qg(c,1,d,ea);f=I.qg(f,1,g,O);I.invert(c,c);I.multiply(f,c,c);C.Xw(e,f);I.multiply(f,c,c);C.or(b,c);C.C(b);a.set_transform(b,b.d.g,b.d.quat)};a.set_transform=
function(a,b,c){I.ri(a.d.g,1,a.d.quat,a.l.gl);var d=D.up(D.eg);d.msg_id=D.eg;d.body_id=a.l.M;d.trans=b;d.quat=c;D.r(D.Nc,a.l.M);D.r(D.eg,d)};a.sync_transform=q;a.apply_velocity=function(a,b,c,d){w(a,b,c,d,X);a=a.l.M;D.r(D.Nc,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(X[0]),f=Math.abs(X[1]),t=Math.abs(X[2]);X[0]=e?X[0]/e*Math.max(e,b):0;X[1]=f?X[1]/f*Math.max(f,c):0;X[2]=t?X[2]/t*Math.max(t,d):0;D.r(D.An,a,X[0],X[1],X[2])};a.apply_velocity_world=function(a,b,c,d){a=a.l.M;D.r(D.Nc,
a);D.r(D.An,a,b,c,d)};a.apply_force=function(a,b,c,d){w(a,b,c,d,X);a=a.l.M;D.r(D.Nc,a);D.r(D.Ss,a,X[0],X[1],X[2])};a.apply_torque=function(a,b,c,d){w(a,b,c,d,X);a=a.l.M;D.r(D.Nc,a);D.r(D.Us,a,X[0],X[1],X[2])};a.set_character_move_dir=function(a,b,c){a=a.l.M;D.r(D.Nc,a);D.r(D.jt,a,b,c)};a.set_character_move_type=function(a,b){D.r(D.kt,a.l.M,b)};a.set_character_walk_velocity=function(a,b){D.r(D.ot,a.l.M,b)};a.set_character_run_velocity=function(a,b){D.r(D.mt,a.l.M,b)};a.set_character_fly_velocity=function(a,
b){D.r(D.ht,a.l.M,b)};a.character_jump=function(a){D.r(D.Vs,a.l.M)};a.character_rotation_inc=function(a,b,c){D.r(D.Ws,a.l.M,b,c)};a.set_character_rotation=function(a,b,c){D.r(D.lt,a.l.M,b,c)};a.set_character_rotation_h=function(a,b){D.r(D.it,a.l.M,b)};a.set_character_rotation_v=function(a,b){D.r(D.nt,a.l.M,b)};a.tB=function(){return!1};a.rB=function(){return!1};a.pB=function(){y.error("check_collision() deprecated");return!1};a.qB=function(){y.error("check_collision_any() deprecated");return!1};a.sB=
function(){y.error("check_ray_hit() deprecated");return!1};a.pD=function(){y.error("update_object_coords() deprecated")};a.append_collision_test=function(a,b,c,d){var e=a.l,f=e.M;b=b||"ANY";for(var t=0;t<e.Qc.length;t++){var g=e.Qc[t];if(g.Vb==b&&g.callback==c)return}t=[];a=a.l.M;g=[];v(b,fa,g,null);for(var h=0;h<g.length;h++){var l=g[h];a<l?t.push([a,l]):a>l&&t.push([l,a])}g={Vb:b,callback:c,Tj:t,Pq:new Uint8Array(t.length),om:d||!1};e.Qc.push(g);D.r(D.Nc,f);D.r(D.Ls,t,d)};a.remove_collision_test=
function(a,b,c){a=a.l;b=b||"ANY";for(var d=0;d<a.Qc.length;d++){var e=a.Qc[d];if(e.Vb==b&&e.callback==c){a.Qc.splice(d,1);d--;for(var e=e.Tj,f=fa.l.p,t=0;t<f.length;t++)for(var g=f[t].pb,h=0;h<g.Qc.length;h++)for(var l=g.Qc[h],k=0;k<l.Tj.length;k++)for(var m=l.Tj[k],n=0;n<e.length;n++){var q=e[n];m[0]===q[0]&&m[1]===q[1]&&(e.splice(n,1),n--)}e.length&&D.r(D.dt,e)}}};a.apply_collision_impulse_test=function(a,b){var c=a.l;c?(D.r(D.Ts,c.M),c.dj=b):y.error("Object "+a.name+" has no physics")};a.clear_collision_impulse_test=
function(a){var b=a.l;b?(D.r(D.Ys,b.M),b.dj=null):y.error("Object "+a.name+" has no physics")};a.append_ray_test=function(a,b,c,d,e,f){var t=a.l;if(t){a=t.M;b=b||"ANY";c={K:new Float32Array(c),Y:new Float32Array(d),local:e,callback:f,Vb:b,Rd:{}};v(b,fa,null,c.Rd);delete c.Rd[a];for(var g in c.Rd)c.Rd[g]=1;t.we.push(c);E(a,t.we)}else y.error("Object "+a.name+" has no physics")};a.remove_ray_test=function(a,b,c,d,e){if(b=a.l){a=b.M;for(var f=0;f<b.we.length;f++){var t=b.we[f];J.cj(t.K,c)&&J.cj(t.Y,
d)&&t.local==e&&(b.we.splice(f,1),f--)}E(a,b.we)}else y.error("Object "+a.name+" has no physics")};a.vehicle_throttle=function(a,b){var c=a.i;c.ug=b;B(a,c)};a.vehicle_steer=function(a,b){var c=a.i;c.eh=b;B(a,c)};a.vehicle_brake=function(a,b){var c=a.i;c.Bh=b;B(a,c)};a.is_vehicle_chassis=x;a.is_vehicle_hull=n;a.rx=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.qx=function(a){return a.b4w_vehicle?
"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.ux=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.$p=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.Zp=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.aq=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.i.speed};a.CA=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;
case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=e;a.CC=H;a.gC=function(){return 0};a.Av=function(){D.r(D.Zs)};a.ty=function(a){var b=Y.indexOf(a);-1!=b?(Y.splice(b,1),a=ha.indexOf(a),-1!=a&&ha.splice(a,1)):y.error("Object ",a.name," doesn't have bounding physics")};a.reset=function(){V.terminate()}};b4w.module.__data=function(a,p){function c(a,b){for(var c=z(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}Sa[b.id]=null;ta[b.id]=null}function b(a,b,c){var d;a instanceof ArrayBuffer&&(a=ca.Cp(a));d=a.width;a=a.height;da.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(Ea)&&c&&da.warn("image",b,"is not from app root.")}function h(a,b,c,d,e,g){d=b.s;if(!d)throw"Nothing requested";K.enqueue([[d,K.AT_JSON,d]],function(d,
g,h,l){if(d){da.log("%cLOAD METADATA","color: #616",l);f(d);for(var k in d)a[k]=d[k];(d=a.binaries[0].binfile)?b.Zn=d:(t.ur(b,"load_binaries"),t.ur(b,"prepare_bindata"));if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)da.Sv(a.b4w_export_errors[d]);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)da.Tv(a.b4w_export_warnings[d]);e(b,c)}else b.lq(b.id,!1)},null,function(a){g(b,c,a)})}function d(a,b,c,d,e,f){d=Y(b.s)+b.Zn;if(!d)throw"Binary data is missing";K.enqueue([[d,
K.AT_ARRAYBUFFER,d]],function(d,f,t,g){d&&(da.log("%cLOAD BINARY","color: #616",g),a.bin_data=d,e(b,c))},null,function(a){f(b,c,a)})}function f(a){var b=va.lm.split(".").map(function(a){return a|0}),c=a.b4w_format_version.split(".").map(function(a){return a|0});c[0]<b[0]&&Ba.la("Incompatible file version: "+a.b4w_format_version+", required: "+va.lm+". Reexport scene with the latest B4W addon to fix it.");c[1]<b[1]&&da.warn("Version mismatch. File version: "+ +a.b4w_format_version+", required: "+va.lm+
". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.")}function k(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],t=a.objects,h=a.meshes;a=a.actions;for(var l=Ba.Du(),k=["indices"],m=["normal","tangent"],K=["color","group"],n=["position","texcoord","texcoord2"],q=0;q<h.length;q++)for(var r=h[q].submeshes,u=0;u<r.length;u++)for(var w in r[u]){var v=r[u][w][1];if(-1!=k.indexOf(w)){var la=4*r[u][w][0]+f["int"],p=r[u],E=w,x=d;if(l)var O=new Uint32Array(x,la,v);else for(var O=
new Uint32Array(v),x=new DataView(x),y=0;y<v;y++)O[y]=x.getUint32(la+4*y,!0);p[E]=O}else if(-1!=n.indexOf(w))la=4*r[u][w][0]+f["float"],r[u][w]=g(d,la,v,l);else if(-1!=m.indexOf(w)){la=2*r[u][w][0]+f["short"];p=r[u];E=w;x=d;O=new Float32Array(v);x=new DataView(x);for(y=0;y<v;y++)O[y]=x.getInt16(la+2*y,!0)/32767;p[E]=O}else if(-1!=K.indexOf(w)){la=2*r[u][w][0]+f.ushort;p=r[u];E=w;x=d;O=new Float32Array(v);x=new DataView(x);for(y=0;y<v;y++)O[y]=x.getUint16(la+2*y,!0)/65535;p[E]=O}}for(w=0;w<t.length;w++)for(h=
t[w].particle_systems,k=0;k<h.length;k++)m=h[k],m.transforms=g(d,4*m.transforms[0]+f["float"],m.transforms[1],l);for(t=0;t<a.length;t++){w=a[t];var h=w.fcurves,m=w.frame_range,k=m[0],m=m[1],K=T.Bw(k,m),n=null,r=q=!1,B;for(B in h)q|=-1<B.indexOf("rotation_euler"),r|=-1<B.indexOf("rotation_quaternion");for(B in h)if(q&&r&&-1<B.indexOf("rotation_euler"))delete h[B];else{var u=h[B],da;for(da in u)v=u[da],la=g(d,f["float"]+4*v.bin_data_pos[0],v.bin_data_pos[1],l),p=new Float32Array(K),null===n&&(n=new Int8Array(K)),
T.cu(v,la,p,n,k,m),v.Ub=p;-1<B.indexOf("rotation_euler")&&T.$v(h,B)}w.zt=n}e(b,c)}function g(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function m(a,b,c,d,e){var f=a.cameras,t=a.groups,g=a.materials,h=a.meshes,l=a.node_groups,k=a.objects,m=a.particles,K=a.scenes,n=a.speakers,q=a.textures,r=a.worlds;l||(da.warn('"node_groups" datablock undefined. reexport main scene.'),l=a.node_groups=[]);for(var u="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),
w={},la=0;la<u.length;la++)for(var p=a[u[la]],x=0;x<p.length;x++){var O=p[x];w[O.uuid]=O}for(var y=0;y<K.length;y++){for(var B=K[y],H=B.objects,W=0;W<H.length;W++)E(H,W,w);B.camera&&E(B,"camera",w);B.world&&E(B,"world",w)}for(y=0;y<t.length;y++)for(var A=t[y].objects,W=0;W<A.length;W++)E(A,W,w);for(y=0;y<k.length;y++){var G=k[y];G.dupli_group&&E(G,"dupli_group",w);G.parent&&E(G,"parent",w);if(G.animation_data){var D=G.animation_data;D.action&&E(D,"action",w);if(D.nla_tracks)for(W=0;W<D.nla_tracks.length;W++)for(var ja=
D.nla_tracks[W],ia=0;ia<ja.strips.length;ia++)ja.strips[ia].action&&E(ja.strips[ia],"action",w)}switch(G.type){case "MESH":if(!G.data)throw"mesh not found for object "+G.name;E(G,"data",w);for(var P=G.modifiers,W=0;W<P.length;W++){var Tb=P[W];"ARMATURE"==Tb.type?E(Tb,"object",w):"CURVE"==Tb.type&&E(Tb,"object",w)}var S=G.particle_systems;if(S)for(W=0;W<S.length;W++)E(S[W],"settings",w);break;case "ARMATURE":E(G,"data",w);for(var ma=G.pose.bones,ca=G.data.bones,W=0;W<ma.length;W++){var Db=ma[W];Db.bone=
ca[Db.bone];for(var I=Db.parent_recursive,ia=0;ia<I.length;ia++)I[ia]=ma[I[ia]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":E(G,"data",w)}var J=G.constraints;if(J)for(W=0;W<J.length;W++){var Z=J[W];Z.target&&E(Z,"target",w)}var V=G.lod_levels;if(V)for(W=0;W<V.length;W++){var ua=V[W];ua.object&&E(ua,"object",w)}}for(y=0;y<h.length;y++)for(var oa=h[y].materials,W=0;W<oa.length;W++)E(oa,W,w);for(y=0;y<g.length;y++){for(var jb=g[y],F=jb.texture_slots,W=0;W<F.length;W++)E(F[W],"texture",
w);var N=jb.node_tree;N&&v(N,w)}for(y=0;y<l.length;y++)(N=l[y].node_tree)&&v(N,w);for(y=0;y<q.length;y++){var R=q[y],Q=R.type;"IMAGE"!=Q&&"ENVIRONMENT_MAP"!=Q||E(R,"image",w)}for(y=0;y<f.length;y++){var na=f[y];na.dof_object&&E(na,"dof_object",w)}for(y=0;y<n.length;y++){var U=n[y];U.sound&&E(U,"sound",w);if(U.animation_data&&(D=U.animation_data,D.action&&E(D,"action",w),D.nla_tracks))for(W=0;W<D.nla_tracks.length;W++)for(ja=D.nla_tracks[W],ia=0;ia<ja.strips.length;ia++)ja.strips[ia].action&&E(ja.strips[ia],
"action",w)}for(y=0;y<m.length;y++){for(var Y=m[y],F=Y.texture_slots,W=0;W<F.length;W++)E(F[W],"texture",w);Y.dupli_group&&E(Y,"dupli_group",w);Y.dupli_object&&E(Y,"dupli_object",w)}for(y=0;y<r.length;y++)if(F=r[y].texture_slots)for(W=0;W<F.length;W++)E(F[W],"texture",w);Aa.Bu(a);xa=0===b.id;qa||(qa=a.scenes[0]);for(var Wa=a.textures,Qb=xa?a.scenes[0].b4w_anisotropic_filtering:qa.b4w_anisotropic_filtering,ya=0;ya<Wa.length;ya++)xa||"SCENE"!=Wa[ya].b4w_source_type||(Wa[ya].b4w_source_id=""),Za.rv(Wa[ya],
Qb,a.scenes);for(var Kb={},Ma=a.objects,X=0;X<Ma.length;X++){var fa=Ma[X];if("MESH"===fa.type&&!fa.particle_systems.length)for(var Cb=fa.data,ra=Cb.name,ha=Cb.submeshes,ea=Cb.materials,ta=0;ta<ha.length;ta++)0!==ha[ta].base_length||Kb[ra]||(ea[ta]&&da.warn('material "'+ea[ta].name+'" is not assigned to any face (object "'+fa.name+'").'),Kb[ra]=!0)}for(var ga=a.meshes,Ea=0;Ea<ga.length;Ea++){var Sa=ga[Ea];Sa.materials.length||Sa.uv_textures.length&&da.warn('mesh "'+Sa.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",
use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,
b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});
for(var xb=a.meshes,Pa=Ba.keysearch("name","DEFAULT",a.materials),za=0;za<xb.length;za++){var bb=xb[za];0==bb.materials.length&&bb.materials.push(Pa)}for(var Gb=a.actions,pb=b.id,Hb=0;Hb<Gb.length;Hb++){var Eb=Gb[Hb];Eb.Bt=pb;T.Lt(Eb)}for(var qc=a.scenes,Mb=0;Mb<qc.length;Mb++){for(var rc=qc[Mb],xc=M.Zk(rc,"ALL"),kc=[],$b=0;$b<xc.length;$b++)for(var Xc=xc[$b].particle_systems,fc=0;fc<Xc.length;fc++){var mb=Xc[fc].settings;if("HAIR"==mb.type)if("OBJECT"==mb.render_type)Oa.en(mb.dupli_object,!0);else if("GROUP"==
mb.render_type){for(var nb=mb.dupli_group,gc=M.Zk(rc,"EMPTY"),Rb=0;Rb<gc.length;Rb++)gc[Rb].dupli_group==nb&&kc.push(gc[Rb]);for(Rb=0;Rb<nb.objects.length;Rb++)Oa.en(nb.objects[Rb],!0)}else da.warn("render type",mb.render_type,"not supported for particle systems ("+mb.name+").")}for($b=0;$b<kc.length;$b++)C(kc[$b],[rc])}pa(a,b.id);for(var Yc=a.scenes,Jc=0;Jc<Yc.length;Jc++){for(var Zc=Yc[Jc],Pc=[],$c=[],Kc=Yc[Jc].objects,ub=0;ub<Kc.length;ub++){var ad=Kc[ub];L(Kc,ad,Pc,$c);var bd=ad.dupli_group;if(bd)for(var yc=
bd.objects,Qc=0;Qc<yc.length;Qc++)L(yc,yc[Qc],Pc,$c)}for(ub=0;ub<$c.length;ub++)C($c[ub],[Zc]);for(ub=0;ub<Pc.length;ub++)Ba.Zt(Pc[ub][0],Pc[ub][1])}pa(a,b.id);var Xa=z(a,b.id);Aa.gu(Xa,a.scenes);for(ya=0;ya<Xa.length;ya++){var zc=Xa[ya];!xa&&zc.parent&&-1<bc.indexOf(zc.parent.type)&&(zc.parent="");Oa.en(zc,!1);zc.d.Sc=b.id}for(var Ac=0;Ac<Xa.length;Ac++){var Lc=Xa[Ac];if("MESH"==Lc.type){var cd=T.get_first_armature_object(Lc);if(cd){var Mc=cd.d;if(Mc.be){var dd=Lc.d.qc,Rc=[],Sc;for(Sc in dd){var ed=
dd[Sc];Rc.push(4*ed.Hh,4*ed.eo)}Mc.oq.push(Rc)}Mc.fk.push(Lc.d)}}}for(var Nc=-1,Bc=0;Bc<Xa.length;Bc++){var Cc=Xa[Bc],Sb=Cc.d;if(Ba.is_mesh(Cc)&&Sb.Vh){var kd=Sb.Gc;kd>Nc&&(Nc=kd)}}for(Bc=0;Bc<Xa.length;Bc++)if(Cc=Xa[Bc],Sb=Cc.d,Ba.is_mesh(Cc)&&Sb.Vh){Sb.Gc=Nc;var hc=Cc,Dc=Sb.Gc,fd=va.Gc,sc=hc.d;Dc>2*fd?Ba.la('too many bones for "'+hc.name+'"'):Dc>fd?(da.warn('too many bones for "'+hc.name+'" / '+Dc+" bones (max "+fd+"). Blending between frames will be disabled."),sc.Nh=!1):sc.Nh=!0;sc.Nh=sc.Nh&&
!lc.hp}for(var gd=0;gd<Xa.length;gd++){var ac=Xa[gd];if(Ba.is_mesh(ac)){var td=ac.lod_levels.length;if(td)for(var id=ac,Ec=0;Ec<td;Ec++){var Oc=ac.lod_levels[Ec].object;if(!Oc){id.d.Gj=!0;id.d.re=ac.lod_levels[Ec].distance;break}Oc.d.Af=ac.d.Af;id.d.re=ac.lod_levels[Ec].distance;Oc.d.Zh=ac.lod_levels[Ec].distance;if(ac.lod_levels[Ec+1])Oc.d.re=ac.lod_levels[Ec+1].distance;else{Oc.d.Gj=!0;Oc.d.re=1E4;break}id.d.Gj=!1;id=Oc}}}for(var qd=0;qd<Xa.length;qd++){var ka=Xa[qd];if(ka.b4w_vehicle){var Ya=ka.b4w_vehicle_settings;
if("CHASSIS"==Ya.part){ka.i={};ka.i.gp=Ya.force_max;ka.i.fo=Ya.brake_max;ka.i.Kz=Ya.suspension_compression;ka.i.Mz=Ya.suspension_stiffness;ka.i.Lz=Ya.suspension_damping;ka.i.BA=Ya.wheel_friction;ka.i.$C=Ya.roll_influence;ka.i.Mx=Ya.max_suspension_travel_cm;ka.i.ug=0;ka.i.Bh=1;ka.i.eh=0;ka.i.speed=0;ka.i.Nf=[];ka.i.ii=[];ka.i.fh=null;for(var ud=ka.ra?ka.ra.dupli_group.objects:Xa,Tc=0;Tc<ud.length;Tc++){var Ja=ud[Tc];if(Ja.b4w_vehicle){var ab=Ja.b4w_vehicle_settings;if(ba.rx(Ja)&&Ya.name==ab.name){var vd=
ba.CA(Ja.b4w_vehicle_settings.part);ka.i.Nf[vd]=Ja;ka.i.ii[vd]=new Float32Array(8)}else if(ba.$p(Ja)&&Ya.name==ab.name){ka.i.fh=Ja;ka.i.Tm=ab.steering_max;ka.i.Er=ab.steering_ratio;ka.i.Vp=ab.inverse_control;var vb=wb.invert(ka.d.N,new Float32Array(16)),ld=wb.multiply(vb,Ja.d.N,vb);ka.i.Gr=ld;var Uc=new Float32Array([1,0,0,0]);Ub.transformMat4(Uc,ld,Uc);ka.i.Fr=Uc}else if(ba.Zp(Ja)&&Ya.name==ab.name){ka.i.Qm=Ja;ka.i.zr=ab.speed_ratio;ka.i.jm=ab.max_speed_angle;var vb=wb.invert(ka.d.N,new Float32Array(16)),
md=wb.multiply(vb,Ja.d.N,vb);ka.i.Br=md;var Vc=new Float32Array([1,0,0,0]);Ub.transformMat4(Vc,md,Vc);ka.i.Ar=Vc}else if(ba.aq(Ja)&&Ya.name==ab.name){ka.i.Wm=Ja;ka.i.Po=ab.delta_tach_angle;var vb=wb.invert(ka.d.N,new Float32Array(16)),nd=wb.multiply(vb,Ja.d.N,vb);ka.i.Or=nd;var Wc=new Float32Array([1,0,0,0]);Ub.transformMat4(Wc,nd,Wc);ka.i.Nr=Wc}}}if(4!=ka.i.Nf.length)throw"Not enough wheels for chassis "+ka.name;}else if("HULL"==Ya.part){ka.i={};ka.i.Nf=[];ka.i.ii=[];ka.i.gp=Ya.force_max;ka.i.fo=
Ya.brake_max;ka.i.vl=Ya.floating_factor;ka.i.mn=Ya.water_lin_damp;ka.i.nn=Ya.water_rot_damp;ka.i.ug=0;ka.i.Bh=1;ka.i.eh=0;ka.i.speed=0;ka.i.fh=null;for(var wd=ka.ra?ka.ra.dupli_group.objects:Xa,Tc=0;Tc<wd.length;Tc++)Ja=wd[Tc],Ja.b4w_vehicle&&(ab=Ja.b4w_vehicle_settings,ba.qx(Ja)&&Ya.name==ab.name?(ka.i.Nf.push(Ja),ka.i.ii.push(new Float32Array(8))):ba.$p(Ja)&&Ya.name==ab.name?(ka.i.fh=Ja,ka.i.Tm=ab.steering_max,ka.i.Er=ab.steering_ratio,ka.i.Vp=ab.inverse_control,vb=wb.invert(ka.d.N,new Float32Array(16)),
ld=wb.multiply(vb,Ja.d.N,vb),ka.i.Gr=ld,Uc=new Float32Array([1,0,0,0]),Ub.transformMat4(Uc,ld,Uc),ka.i.Fr=Uc):ba.Zp(Ja)&&Ya.name==ab.name?(ka.i.Qm=Ja,ka.i.zr=ab.speed_ratio,ka.i.jm=ab.max_speed_angle,vb=wb.invert(ka.d.N,new Float32Array(16)),md=wb.multiply(vb,Ja.d.N,vb),ka.i.Br=md,Vc=new Float32Array([1,0,0,0]),Ub.transformMat4(Vc,md,Vc),ka.i.Ar=Vc):ba.aq(Ja)&&Ya.name==ab.name&&(ka.i.Wm=Ja,ka.i.Po=ab.delta_tach_angle,vb=wb.invert(ka.d.N,new Float32Array(16)),nd=wb.multiply(vb,Ja.d.N,vb),ka.i.Or=nd,
Wc=new Float32Array([1,0,0,0]),Ub.transformMat4(Wc,nd,Wc),ka.i.Nr=Wc))}}}for(var rd=0;rd<Xa.length;rd++){var tc=Xa[rd];if(tc.b4w_floating){var od=tc.b4w_floating_settings;if("MAIN_BODY"==od.part){tc.pc={};tc.pc.vl=od.floating_factor;tc.pc.mn=od.water_lin_damp;tc.pc.nn=od.water_rot_damp;tc.pc.Vi=[];for(var xd=tc.ra?tc.ra.dupli_group.objects:Xa,sd=0;sd<xd.length;sd++){var hd=xd[sd];if(hd.b4w_floating){var yd=hd.b4w_floating_settings;ba.ux(hd)&&od.name==yd.name&&(tc.pc.Vi.push(hd),hd.qu=hd.b4w_floating_settings.synchronize_position)}}}}}e(b,
c)}function l(a,b,c,d,e){!xa&&1<a.scenes.length&&(a.scenes=[a.scenes[0]],da.warn("loading data contains multiple scenes.","Only the first one will be loaded."));-1==lc.Ea&&xa&&(lc.Ea=a.scenes[0].fps);for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];if(xa&&!f.camera)throw"Scene check failed: No camera";for(var t=M.Zk(f,"MESH"),g=0;g<t.length;g++){var h=t[g],l=Aa.au(h);l&&(a.meshes.push(l),h.data=l)}for(var g=z(a,b.id),h=a.meshes,l=h.slice(0),k=0;k<g.length;k++){var m=g[k];"MESH"==m.type&&(m=l.indexOf(m.data),
-1<m&&l.splice(m,1))}for(k=0;k<l.length;k++)h.splice(h.indexOf(l[k]),1);xa?(M.Qt(f,a.textures),f.d.qh.length&&(b.Ol=!0),ra.enabled&&f.b4w_enable_physics&&ba.Sn(f),f.b4w_enable_audio&&ja.Tn(f),g=M.Fl(f),h=f.b4w_batch_grid_size):(M.Wt(f,qa,a.textures),ra.enabled&&f.b4w_enable_physics&&!qa.l&&ba.Sn(qa),f.b4w_enable_audio&&!qa.h&&ja.Tn(qa),g=M.Fl(qa),h=qa.b4w_batch_grid_size);l=[];W.sw(g,h,t,f.world,l,qa.d.eq);xa?(M.Jn(f,l),M.lw(g)):M.Jn(qa,l)}d=a.materials;if(xb.il&&va.as)for(a=0;a<d.length;a++){g=d[a];
h=g.texture_slots;for(f=0;f<h.length;f++)if(l=h[f],k=l.texture,"IMAGE"==k.type||"ENVIRONMENT_MAP"==k.type)t=k.image,t.Tb||(-1<t.filepath.indexOf(".dds")?t.Tb=!0:(t.Tb=!k.b4w_disable_compression&&!l.use_map_normal&&"ENVIRONMENT_MAP"!=k.type&&!k.b4w_shore_dist_map&&"MOVIE"!=t.source,t.Tb&&(t.filepath+=".dds")));if(f=g.node_tree)for(g=f.nodes,f=0;f<g.length;f++)t=g[f],"TEXTURE"==t.type&&(h=t.texture)&&(t=h.image)&&!t.Tb&&(t.Tb=h.d.Ni&&!h.b4w_disable_compression&&"MOVIE"!=t.source,t.Tb&&(t.filepath+=
".dds"))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],f.Tb=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));e(b,c)}function r(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},t={},g={},h={},l=0;l<d.length;l++){var k=d[l];f[k.uuid]=k;g[k.uuid]=k}for(l=0;l<a.length;l++)k=a[l],t[k.uuid]=k,h[k.uuid]=k;q(a,null,h,g);for(var m in g)m in f||d.push(g[m]);for(m in h)m in t||a.push(h[m]);e(b,c)}function q(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var t=a[f],g=c[t.uuid];if(t=g.proxy){b&&-1==e.indexOf(t.uuid)&&
e.push(t.uuid);for(var h=c[t.uuid],l=h.constraints,t=0;t<l.length;t++){var k=Ba.af(l[t]);k.name+="_CLONE";g.constraints.push(k)}"b4w_proxy_inherit_anim"in g&&!g.b4w_proxy_inherit_anim||(g.animation_data&&(h.animation_data=Ba.af(g.animation_data)),h.b4w_use_default_animation=g.b4w_use_default_animation,h.b4w_auto_skel_anim=g.b4w_auto_skel_anim,h.b4w_anim_behavior=g.b4w_anim_behavior,h.b4w_cyclic_animation=g.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)g=Ba.Gl(a,"uuid",e[f]),-1<g&&a.splice(g,1);e=
{};for(f=0;f<a.length;f++)t=a[f],g=c[t.uuid],b&&(l=Ba.af(g),g="origin_name"in g?g.origin_name:g.name,l.name=b+"*"+g,l.origin_name=g,w(l),c[l.uuid]=l,e[t.uuid]=l.uuid,t.uuid=l.uuid),g=c[t.uuid],g.dupli_group&&(t=g.dupli_group,l=d[t.uuid],h=Ba.af(l),h.name=Ba.nk(l.name+"_CLONE"),h.uuid=la.Pp("Group"+h.name),d[h.uuid]=h,t.uuid=h.uuid,q(h.objects,g.name,c,d));if(b)for(f=0;f<a.length;f++){t=a[f];g=c[t.uuid];g.parent&&g.parent.uuid in e?g.parent.uuid=e[g.parent.uuid]:g.parent&&(da.warn("Object's \""+g.name+
'" parent is not in dupli group. Disabling parenting.'),g.parent=null);l=g.constraints;for(t=0;t<l.length;t++)b=l[t],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=g.modifiers;for(t=0;t<b.length;t++)d=b[t],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((g=g.lod_levels)&&g.length)for(t=0;t<g.length;t++)b=g[t],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var m in e)bb[m]=e[m]}function w(a){a.uuid=la.Pp("Object"+a.name)}function v(a,b){for(var c=
a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&E(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in bb&&(e.lamp.uuid=bb[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&E(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var f=e[d];B(f,"from_node",c);B(f,"to_node",c);x(f,"from_socket",f.from_node.outputs);x(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&E(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],
f=0;f<e.strips.length;f++)e.strips[f].action&&E(e.strips[f],"action",b)}function E(a,b,c){(c=c[a[b].uuid])||da.error("Dangling link found:",b,a);a[b]=c}function B(a,b,c){c=Ba.keysearch("name",a[b].name,c);a[b]=c}function x(a,b,c){c=Ba.keysearch("identifier",a[b].identifier,c);a[b]=c}function n(a,c,d,f,t,g){if(!va.do_not_load_resources){for(var h=Y(c.s),l=a.images,k={},m=[],n=0;n<l.length;n++){var q=l[n],r=q.uuid;if("FILE"===q.source||"MOVIE"===q.source){var u=e(q,a.textures);if(!u.length)da.warn("image ",
q.name," has no users.");else if(!(u[0].b4w_shore_dist_map||"MOVIE"===q.source&&va.cp)){u=R(h+q.filepath);if("FILE"===q.source){var w=q.Tb?K.AT_ARRAYBUFFER:K.AT_IMAGE_ELEMENT;xb.km&&va.qk&&(u=K.ti(u),"dds"==u[1]?(u=K.ti(u[0]),u=u[0]+".min50."+u[1]+".dds"):u=u[0]+".min50."+u[1])}else"MOVIE"===q.source&&(va.Kc?(u=K.ti(u),u=u[0]+".altconv.seq",w=K.Gi):(u=K.ti(u),w=ja.detect_video_container(u[1]),u=w!=u[1]?u[0]+".altconv."+w:u[0]+"."+w,w=K.Hi));m.push([r,w,u]);k[r]=q}}}m.length?(f.Qp=0,K.enqueue(m,function(t,
h,l,n){if(t){if(l==K.Hi||l==K.Gi){if(l==K.Hi)var q=t.videoWidth,u=t.videoHeight;else q=t.images[0].width,u=t.images[0].height;da.log("%cLOAD VIDEO "+q+"x"+u,"color: #"+(2048<q||2048<u?"a00":1024<q||1024<u?"aa0":"0a0"),n);-1==n.indexOf(Ea)&&da.warn("video",n,"is not from app root.")}else b(t,n,!0);h=k[h];n=e(h,a.textures);for(q=0;q<n.length;q++){var u=n[q],r=u.image.filepath;l==K.Gi?(u.d.jr=t.Lb,Za.xi(u.d,t.images,h.Tb,r)):Za.xi(u.d,t,h.Tb,r)}}t=++f.Qp/m.length;g(c,d,t)},function(){da.log("%cLOADED ALL IMAGES",
"color: #0a0");t(c,d)})):t(c,d)}}function e(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function H(a,b,c,d,e,f){if(!va.do_not_load_resources){a=z(a,b.id);for(var t=Y(b.s),g=[],h={},l=0;l<a.length;l++){var k=a[l];if(G(k)){var m=k.data.sound,n=m.uuid;"BACKGROUND_MUSIC"==ja.Hl(k)?(n=Ba.mp(),b.Nl=!0):"NONE"!=ja.Hl(k)&&va.Tp&&(b.Ql=!0);if(!(n in h)){h[n]=[];m=R(t+m.filepath);switch(ja.xr(k)){case ja.uk:var q=K.AT_AUDIOBUFFER;break;case ja.rn:q=K.AT_AUDIO_ELEMENT}var m=
K.ti(m),u=ja.detect_audio_container(m[1]),m=u!=m[1]?m[0]+".altconv."+u:m[0]+"."+u;g.push([n,q,m])}h[n].push(k)}}g.length?K.enqueue(g,function(a,e,t,l){if(a)for(da.log("%cLOAD SOUND","color: #0aa",l),-1==l.indexOf(Ea)&&da.warn("sound",l,"is not from app root."),e=h[e],t=0;t<e.length;t++)ja.kA(e[t],a);a=++d.pz/g.length;f(b,c,a)},function(){da.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)}):e(b,c)}}function G(a){return ja.Od(a)&&ja.xr(a)!=ja.sn?!0:!1}function y(a,b){for(var c=M.Ba(a,"SPEAKER",M.DATA_ID_ALL),
d=0;d<c.length;d++){var e=c[d];ja.Od(e)&&(ja.is_cyclic(e)||b)&&ja.play_def(e)}}function A(a){a=a.d.qh;for(var b=0;b<a.length;b++)va.Kc&&a[b].use_auto_refresh?a[b].d.Ug=!0:a[b].d.Xa&&a[b].use_auto_refresh&&a[b].d.Xa.play()}function D(a,b,c,d,e){Db.start();da.log("%cSTART NLA","color: #0a0");e(b,c)}function L(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,f=0;f<e;f++){var t=b.lod_levels[f],g=t.object;if(g){var h=Ba.bj(g);h.name=b.name+"_LOD_"+String(f+1);w(h);h.lod_levels=
[];c.push([a,h]);d.push(g);t.object=h}}}function C(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=f.objects,t=f.indexOf(a),-1<t&&f.splice(t,1))}var t=d.indexOf(a);-1<t&&d.splice(t,1)}}function I(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d],t=xa?f.b4w_enable_physics:qa.b4w_enable_physics||f.b4w_enable_physics;xa||(f=qa);for(var g=0;g<Eb.length;g++)for(var h=M.Ba(f,Eb[g],M.DATA_ID_ALL),l=0;l<h.length;l++){var k=h[l];k.d.Sc==b.id&&
ra.enabled&&t&&(ba.append_object(k,f),b.bm&&ba.has_physics(k)&&ba.disable_simulation(k))}}e(b,c)}function J(a,c,d,f,t){var g={};f=[];for(var h=a.scenes,l=0;l<a.scenes.length;l++){var k=h[l];if(k.d.Pa&&(k=k.d.Pa.ek)&&"FILE"===k.source){var m=k.uuid,n=R(Y(c.s)+k.filepath);f.push([m,k.Tb?K.AT_ARRAYBUFFER:K.AT_IMAGE_ELEMENT,n]);g[m]=k}}f.length?K.enqueue(f,function(c,d,f,t){if(c){b(c,t,!0);d=g[d];t=e(d,a.textures);for(f=0;f<t.length;f++){var l=t[f];Za.xi(l.d,c,d.Tb,l.image.filepath)}for(f=0;f<h.length;f++)if(t=
h[f],t.d.Pa.ek===d){var k=c,m=document.createElement("canvas"),l=d.size[0],K=d.size[1];m.width=l;m.height=K;m=m.getContext("2d");m.drawImage(k,0,0);k=m.getImageData(0,0,l,K).data;m=new Float32Array(4);m[0]=1/16581375;m[1]=1/65025;m[2]=1/255;m[3]=1;for(var l=l*K,K=new Float32Array(l),n=0;n<l;n++)K[n]=m[1]*k[4*n+2]+m[2]*k[4*n+3];t.d.Jm=K}}},function(){t(c,d)}):t(c,d)}function Q(a,c,d,e,f){if(va.antialiasing&&va.smaa){e=a.scenes[0];a=[];for(var t=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION",
"SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],g=0;g<t.length;g++){var h=M.fa(e,t[g]);h&&a.push(h)}if(a.length){e=[];g=K.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",g,ma.Hb.smaa_search_texture_path]);e.push(["AREA_TEXTURE",g,ma.Hb.smaa_area_texture_path]);for(g=0;g<a.length;g++)if(t=a[g],"SMAA_BLENDING_WEIGHT_CALCULATION"==t.type){a=t.ia;for(g=0;g<a.length;g++)if(t=a[g],"u_search_tex"==t.Y)var l=t.ja;else if("u_area_tex"==t.Y)var k=t.ja;break}e.length?K.enqueue(e,function(a,c,d,e){a&&(b(a,e,!1),c="SEARCH_TEXTURE"==
c?l:k,c.source="IMAGE",c.Xn=!0,Za.xi(c,a,-1!=e.indexOf(".dds")?1:0,e),Za.Gm(c,Za.G,Za.G))},function(){f(c,d)}):f(c,d)}else f(c,d)}else f(c,d)}function N(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];xa||(e=qa);for(var f=M.Ba(e,"LAMP",M.DATA_ID_ALL),t=0;t<f.length;t++){var g=f[t];g.d.Sc==b.id&&(b.bm&&Ba.is_mesh(g)&&M.hide_object(g),d.Ak.push({ir:e,obj:g}))}f=M.Ba(e,"ALL",M.DATA_ID_ALL);for(t=0;t<f.length;t++)g=f[t],"LAMP"!=g.type&&g.d.Sc==b.id&&(b.bm&&Ba.is_mesh(g)&&M.hide_object(g),d.Ak.push({ir:e,
obj:g}))}}function u(a,b,c,d,e,f){e=d.Ak;var t=d.xq;e.length?(a=e[t].obj,t=e[t].ir,M.append_object(t,a,!1),-1!=Hb.indexOf(a.type)&&t.b4w_enable_audio&&ja.append_object(a,t),O.Wp(a)&&O.append(a),d=++d.xq/e.length,"LAMP"==a.type&&M.nz(t)):d=1;f(b,c,d)}function P(a,b,c,d,e){if(xa){d=M.Qw();for(var f=M.rj(),t=0;t<d.length;t++){var g=d[t];M.iy(g,f);g.b4w_use_nla&&Db.hA(g,g.b4w_nla_cyclic)}M.set_active(f)}else M.$r(qa);a=z(a,b.id);Oa.gA(a);e(b,c)}function S(a,b,c,d,e){if(xa)for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||
A(a.scenes[d]),y(a.scenes[d]);else a.scenes[0].b4w_use_nla||A(qa),y(qa);e(b,c)}function Z(a,b,c,d,e){va.sf&&(b.Ol||b.Nl||b.Ql)?za||V(a,e,b,c):e(b,c)}function V(a,b,c,d){var e=pb.canvas.parentElement;Gb=e.style.zIndex;e.style.zIndex="999";za=document.createElement("div");za.style.position="relative";za.style.height="88px";za.style.width="88px";var f=Math.round(pb.canvas.offsetWidth/2-44);za.style.top=Math.round(pb.canvas.offsetHeight/2-44).toString()+"px";za.style.left=f.toString()+"px";za.style.backgroundImage=
"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAYAAABxlTA0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAhOSURBVHic7Z1tjFxVGcd/z1AKsbzotoW0IQqFhpSXFlugxbbGRkNSLJEQLVJttH7VEl8+oCYYExLFDxilJib6AWshtlterN20hkBKsNitpFVapB9YIzGBWEq3+IKCLf374Tx3587szGxn5577Mt1fcnN37r1zznP+c/a55557znOMkiDJgLnAADDT9+ktOQYwChwHTvh+tGl7zcyUp/3tsCIzlzQdWAwsA24CLs4o6X8ALwDDwEEz+19G6XZN7gJLugi4mSDqh4HzUqffBN6gXkPT++RvaKzhM5v2lwCzUmm+C/yRIPYfzOyfMcrVjlwE9n//lcAngQVALXV6hFD435vZ3zLK74PARwg/4lWpU6eBI8Au4Lk83Eh0gSUtBDYA8/3QaeAlYB8wbGbHIuc/myD0LcB11H/cEeBhM3sxZv7RBJZ0OfBF4EY/9CawDdhrZv+Kle8ENl0IrADuou5GDhKE/muMPDMXWNIs4PPAxz39t4FBYGeRN5s0fnO9HVgLzAAE7AG2ZP0flZnAkmrAOuBOYDpwEhgCBouqsRPhNXotsAY4l2DzDoLQ72WRRyYCS7oAuJfQKohWG2Lhfno9sIqgySHg+6WoGJIuk/QzSUOSHpF0TdE2TRZJ13gZhiT93FsjhRq0RNI2N2iTpEsKNSgDJM2S9GMv06CkGyf+Vnsm7SIk3QF8idDs2Qc8aGbv9GJMWZB0HvBVQttdhFbGE5NJq2uBJU0DvgJ8wg9tBR4ty7N /lkhaS/DNBjwDbDKzU7Ez/bL/+zwh6aNRMysBkpZK2u5l/lrszNZ4Ro9LujpqZiVC0ryUyHfGyuQGSTsk7ZS0PEomJcZr8k7ferrxtUp8rqSt/guuyzTxCiFpbap1cUZNuNpEF0iaAXwHuAB4HvhVb2ZWFzMbBH4HvA+4z58EO9JRYH/8vRe4DPgL8MN+bC10yY8IWswBviXpnE4XT1SDP0d44/AWcL+ZvZuJiRXGNbifoMlCQjOueyTNlvSk+5zrMrSxL/DH6p2u0ex213WqwesJPUzPm9lLmVtYcczsZUKn1rl0qMUtBZZ0BaFn6RSwOYaBfcIWQhfnKtdsHO1q8AbC4+Fvzez1SMZVHu+OHSJotaHVNeMElrSIcGP7L6GfIRqSdklaEDOPHBgkvLVZ7No10CCwv/1NfonHzeytyMatBg5JekjSwIRXlxDvlB/0jxtcw9ZIWumthl9KOj+2cWrkuKSN3ltXKSRNl/QL125l+lyzi7jV91sL6NsdAB4i1OjVOefdE/4yd5t/vDV9bkxgfyS+HngPeC4368azANhVQf+8lzDm43rXEmiswUuAacCfzezfORvXikr5Z/fFLxM0vCk5nhb4Ft8P52jXREwDNgKvVMQ/J9olWgaB3fAlfmx/zkadCVXxz4nAS3xwy1gNXkjognvVzI4WYdkZUmr/bGZ/B14FzgdugLrAy3xfJvfQiTL750TDZQA1bxgvbTpZBcrqnxMXu1SS1QijDGcCo2Y2Upxdk6Zs/nmEMFj8YmBOjSAuQNU7dUrhn/2NT6LlzBqNE0v6gTL450TLvhQYivfPiZYD/SpwQlH++awROCFv/9wgcHKTO97m4n4iL/+caHnW1OA0efjnlje5s6EGp4npnxtq8BQRqZGqzkUaUgCjwD3AQjPbnXHaiZajaYHL1mkSi1PAJmC+mcUasT7mdqdxdtXg3cA3zOxI5HwSLU+kBe7nGnyEIGzWrqAdYzW4RuqOl1PmeRLTz3 ZirOnbrzX4FPBT4LtmVkT7vq8FzsvPdqKlwHMLMiYr8vaznUi0PF4DjhH88ICkq9p/p7QU5Wdb4hoOEOIGvV7zHvix90iFWdY9ebRnJ0PyAnm/mSl5VB5uOll2dhNq7D0F3cQ60fCGPhH4EPAf4IqSz5g/AtxmZrcVfBNriaRLgcuBd4A/gQvs/14H/LoyuolS+dkOJNodSMLnpHvT9vm+TG6irH62HYl2iZakO5sPEAp0raQZZvZ2npa1oAzt2TPGZ31eS9DwheT4WA12QQ8TRF+Rt4EpSu1nO7AcOAc4nK6czR3uT/n+7mR0YI5Uxc+Ow7X6rH98Kn2uWeC9hKE/s4BPxTcNqJ6fbcXtBM1GCBq2R9Ki1JT9i2JaVfQwpyyQdKHqgaE6T+MC8FiOBwnjhe+OaVwF/WwrkuiBB1vFwWz30vNhQrSl1ZLmRDSu0vgk8DV4ZKpW17QU2ANl7iG0KL4Qy8A+IJkwv6ddcNFOr+2Tic4rpsIZjEchwuEqgkZb2l3XVmCf6Pykf/ymQlTVKRhzDd8mTALf0SlG50QDTx4hhOd+PyFGTd5t49KhEBXwPoImhwkataWjwGZ2GngAeA24EogbmK3k+HyWrwPzgKPA9zJptytEWE3aenf1nGBFkbTONdgu6UNZJ75Y0m88Tk0ZuzSjImm56oHp4pRf0h3+Cz4maV6UTEqIpCu9zEOSPtPNd7saXWlmvwaeJsxk/IGkm7v5fhXxMj5AKPOzZra9m+/3Gt5WwGYze6zbdKqApE8THrSS8LY/MbOT3aSRVYDmPYTYuqVYZaBXvDm6kfAg0VOA5l4NSYcYf7CE84a7RtKAlyWTEONZGJQOkr9ZFY4rLOlqL0NmQfJjLfPwLGGZhzeySD82PlRhPfAxMl7mYWqhkiosVJJGU0vtNJDnYlHHgEcJi0UVshyEQiy4FYSwvUnE1GotFtWMxi93dhJ4kTDgcH/ssWXeslnq2yKCK4CqL3eWRu0X7BPwC mGg3HDGC/Yt820+9XL234J9zajzkpNHCcEsTlBfZvJE02eoLzf5Ad/Sn+cCl6bS7P8lJ9uhqUVT80N9uuzv/wFReZvk3/McjgAAAABJRU5ErkJggg==')";
Pa=document.createElement("div");Pa.style.position="relative";Pa.style.height=pb.canvas.offsetHeight.toString()+"px";Pa.style.width=pb.canvas.offsetWidth.toString()+"px";Pa.style.background="rgba(0, 0, 0, 0.5)";Pa.style.zIndex="999";e.appendChild(Pa);Pa.appendChild(za);za.addEventListener("click",function(){c.Ol&&(Za.play(),Za.pause(),Za.reset());if(c.Nl){if(xa)for(var e=0;e<a.scenes.length;e++)y(a.scenes[e],!0);else y(qa,!0);ja.pause()}c.Ql&&ja.dy();fa();b(c,d)},!1)}function fa(){if(za){var a=pb.canvas.parentElement;
a.style.zIndex=Gb;Pa.removeChild(za);a.removeChild(Pa);za=Pa=null;Gb=0}}function Y(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function ha(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function R(a){var b=a.split("://",2);
return 1<b.length?(b[1]=ha(b[1]),b.join("://")):ha(a)}function X(a,b,c){T.is_animated(b)&&T.remove(b);M.clear_glow_anim(b);ba.has_physics(b)&&(ba.disable_simulation(b),ba.ty(b));oa.check_sensor_manifold(b)&&oa.remove_sensor_manifold(b);M.uy(a,b,c);ja.Od(b)&&ja.rz(b);O.Wp(b)&&O.remove(b)}function z(a,b){ta[b]||pa(a,b);return ta[b]}function pa(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)ga(c[e].objects,0,d);ta[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var t=c[f],g=0;g<t.length;g++)ta[b].push(t[g])}
function ga(a,b,c){c[b]=c[b]||[];for(var d=c[b],e=0;e<a.length;e++){var f=a[e],t=ea(f);d[t]=d[t]||[];(xa||-1==bc.indexOf(f.type))&&-1==d[t].indexOf(f)&&d[t].push(f);(f=f.dupli_group)&&ga(f.objects,b+1,c)}}function ea(a){return(a=a.parent||T.get_first_armature_object(a))?1+ea(a):0}var O=p("__anchors"),T=p("__animation"),W=p("__batch"),ma=p("__config"),oa=p("__controls"),ca=p("__dds"),ia=p("__extensions");p("__lights");var t=p("__loader"),K=p("__assets"),la=p("__md5"),Oa=p("__objects"),ba=p("__physics"),
da=p("__print"),Aa=p("__reformer"),Tb=p("__renderer"),M=p("__scenes"),Db=p("__nla"),ja=p("__sfx"),ua=p("__shaders"),Za=p("__textures"),jb=p("__nodemat"),Ba=p("__util"),Ub=p("vec4"),wb=p("mat4"),va=ma.q,xb=ma.yd,ra=ma.pb,lc=ma.xd,na=ma.Lc,Sa=null,ta=null,Ea="",xa=!1,qa=null,bb={},za=null,Pa=null,Gb=0,bc=["LAMP","CAMERA"],Eb=["MESH","CAMERA","EMPTY"],Hb=["SPEAKER"],pb=null;a.is_primary_loaded=function(a){return t.is_primary_loaded(a)};a.update=function(){t.iA(Sa)};a.gc=function(a){pb=a};a.fA=function(a,
b){if(za){Pa.style.height=b.toString()+"px";Pa.style.width=a.toString()+"px";var c=Math.round(a/2-44);za.style.top=Math.round(b/2-44).toString()+"px";za.style.left=c.toString()+"px"}};a.load=function(a,b,e,f,g){var K={load_main:{La:t.Se,ab:!1,H:[],eb:!1,hb:500,ub:!1,Ra:h},duplicate_objects:{La:t.Oc,ab:!1,H:["load_main"],eb:!1,hb:50,ub:!1,Ra:r},load_binaries:{La:t.Se,ab:!1,H:["load_main"],eb:!1,hb:500,ub:!1,Ra:d},prepare_bindata:{La:t.Oc,ab:!1,H:["duplicate_objects","load_binaries"],eb:!1,hb:0,ub:!1,
Ra:k},prepare_root_datablocks:{La:t.Oc,ab:!1,H:["duplicate_objects","prepare_bindata"],eb:!1,hb:150,ub:!1,Ra:m},prepare_root_scenes:{La:t.Oc,ab:!1,H:["prepare_root_datablocks"],eb:!1,hb:350,ub:!1,Ra:l},load_smaa_textures:{La:t.Se,ab:!0,H:["prepare_root_scenes"],eb:!1,hb:10,ub:!0,Ra:Q},load_shoremap:{La:t.Se,ab:!0,H:["prepare_root_scenes"],eb:!1,hb:10,ub:!0,Ra:J},load_textures:{La:t.Se,ab:!0,H:["prepare_root_scenes"],eb:!0,hb:500,ub:!1,Ra:n,$e:{Qp:0}},add_physics_objects:{La:t.Oc,ab:!1,H:["load_shoremap"],
eb:!1,hb:20,ub:!1,Ra:I},add_objects:{La:t.Oc,ab:!1,H:["add_physics_objects"],eb:!1,hb:800,ub:!1,Ra:N,mg:u,Ch:P,$e:{Ak:[],xq:0}},load_speakers:{La:t.Se,ab:!0,H:["add_objects"],eb:!0,hb:30,ub:!1,Ra:H,$e:{pz:0}},mobile_media_start:{La:t.Oc,ab:!va.sf,H:["load_textures","load_speakers"],eb:!0,hb:5,ub:!1,Ra:Z,mg:Z},synchronize_media:{La:t.Oc,ab:!0,H:["mobile_media_start"],eb:!0,hb:70,ub:!1,Ra:S},start_nla:{La:t.Oc,ab:!0,H:["mobile_media_start"],eb:!1,hb:5,ub:!1,Ra:D}},q=t.yp();q||(q=t.kv(),Sa=[],ta=[],
bb={});Sa[q.ld.length]={};return t.sv(K,a,b,e,c,f||na.Vn,va.do_not_load_resources,g)};a.unload=function(a){var b=t.yp();if(!b||!b.ld.length||a&&!t.Oz(b.ld[a]))da.error("Unable to unload data!");else{if(0==a)da.log("%cUNLOAD ALL","color: #00a"),O.cleanup(),T.cleanup(),ja.cleanup(),Db.cleanup(),M.cleanup(),t.cleanup(),ba.cleanup(),Oa.cleanup(),Ba.cleanup(),Tb.cleanup(),jb.cleanup(),ua.cleanup(),oa.cleanup(),ia.cleanup(),K.cleanup(),Za.cleanup(),ta=null,bb={},xa=!1,Sa=qa=null;else{da.log("%cUNLOAD DATA "+
a,"color: #00a");T.sy(a);for(var b=M.Rh(),c=0;c<b.length;c++)for(var d=b[c],e=M.Ba(d,"ALL",M.DATA_ID_ALL),f=e.length-1;0<=f;f--){var g=e[f];if(g.d.Sc==a){X(d,g,!0);e.splice(f,1);var h=M.Ba(d,g.type,M.DATA_ID_ALL),g=h.indexOf(g);-1!=g&&h.splice(g,1)}}}fa()}};a.hy=X;a.set_debug_resources_root=function(a){Ea=a}};b4w.module.__batch=function(a,p){function c(a){a={type:a,id:0,vy:0,Pg:"",L:[],Bb:[],wc:[],bf:[],Zf:null,Wa:{},Jb:null,Ia:null,Un:[],cc:null,na:null,qc:null,Gh:!1,Mo:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,bq:0,cq:0,Ep:0,Il:0,Mb:new Float32Array(3),Wb:new Float32Array(16),za:!1,zo:!1,T:!1,Xd:!1,wa:!1,Yf:!1,Vc:!1,hc:!1,Rb:!1,Ab:!1,fc:!1,Qb:!1,Hc:!1,Sa:!1,Wq:!1,Uc:V.uh,Yd:V.td,nh:0,Ym:new Float32Array(2),u:new Float32Array(2),sc:!1,Am:"",dD:"",Fp:!1,Jp:0,Gp:0,Kp:0,Lp:0,Ip:new Float32Array(3),
Hp:new Float32Array(3),of:!1,wd:0,Fd:0,je:1,Pf:0,yr:0,$g:1,Lf:0,ie:0,$d:1,uq:0,mm:0,Hf:0,br:0,Ed:Array(2),Sb:new Float32Array(3),Je:new Float32Array(3),fd:new Float32Array(3),lb:new Float32Array(4),Fc:new Float32Array(4),Gg:null,Yl:null,Wl:null,Vl:null,Xl:null,Oe:!1,water_dynamic:!1,on:!1,js:!1,ks:0,ls:0,hs:0,th:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,fp:new Float32Array(2),ep:new Float32Array(2),wl:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
Ef:null,Cm:!1,Hq:0,Dq:0,um:0,Gq:0,Jq:0,Iq:0,Eq:0,Fq:0,vm:0,Aq:0,zq:0,Lq:0,Cq:0,Sj:new Float32Array(3),Kq:new Float32Array(8),Bq:new Float32Array(16)};a.lb[3]=1;a.zo=!0;a.T=!0;a.nh=1;return a}function b(a,b){for(var c=[],d=pa.Ha(b,"SHADOW_CAST"),e=pa.Ha(b,"MAIN_REFLECT"),f=pa.Ha(b,"GLOW_MASK"),g=0;g<a.n.length;g++){var l=a.n[g],k=null;"DEPTH"==l.type&&d&&l.hc&&(k=h(l));"MAIN"!=l.type&&"NODES"!=l.type&&"PARTICLES"!=l.type||!e||l.za||!l.fc||(k=h(l));"COLOR_ID"==l.type&&f&&(k=h(l));k&&(k.sc=!0,C(k,a.d.id),
c.push(k))}a.n.push.apply(a.n,c)}function h(a){var b=a.na,c=a.cc;a.na=null;a.cc=null;var d=ha.Ru(a);a.na=b;d.na=b;a.cc=c;d.cc=c;return d}function d(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e],h=f.d,l=g(f.data.b4w_bounding_box),m=f.data.b4w_bounding_cylinder_radius,n=f.data.b4w_bounding_sphere_radius,q=f.data.b4w_bounding_sphere_center,r=f.data.b4w_bounding_ellipsoid_axes,w=f.data.b4w_bounding_ellipsoid_center;if(h.Ad){var n=Math.max(Math.abs(l.max_x),Math.abs(l.min_x)),m=Math.max(Math.abs(l.max_y),
Math.abs(l.min_y)),v=Math.max(Math.abs(l.max_z),Math.abs(l.min_z)),v=Math.sqrt(n*n+m*m+v*v),n=Math.sqrt(n*n+m*m);l.max_x=l.max_y=l.max_z=v;l.min_x=l.min_y=l.min_z=-v;m=n;n=v;q[0]=q[1]=q[2]=0;r[0]=r[1]=r[2]=v;w[0]=w[1]=w[2]=0}h.Eb=l;v=u.Ok(l,h.N);h.Qa=v;var v=h,p=m;v.Kk=u.Go(p,l);v.Ik=u.Eo(m,l);v.Jk=u.Fo(p,l);q=u.cl(n,q);h.Cc=q;q=u.Qk(q,h.N);h.rb=q;r=u.bl([r[0],0,0],[0,r[1],0],[0,0,r[2]],w);h.Xe=r;r=u.Pk(r,h.Wd);h.Ye=r;d=d.concat(k(f,h,b,c))}return d}function f(a,b,c,d){for(var e=[],f=[],h={},l=0;l<
a.length;l++){var m=a[l],n=m.d,q=g(m.data.b4w_bounding_box),r=u.Ok(q,n.N),w=u.cl(m.data.b4w_bounding_sphere_radius,m.data.b4w_bounding_sphere_center),v=u.Qk(w,n.N),p=m.data.b4w_bounding_ellipsoid_axes,p=u.bl([p[0],0,0],[0,p[1],0],[0,0,p[2]],m.data.b4w_bounding_ellipsoid_center),E=u.Pk(p,n.Wd);n.Eb=q;n.Qa=r;n.Cc=w;n.rb=v;n.Xe=p;n.Ye=E;q={};q.hc=n.hc;q.Rb=n.Rb;q.Ab=n.Ab;q.ad=n.ad;q.Rj=n.Rj;q.sj=n.sj;q.fc=n.fc;q.Qb=n.Qb;q.Hc=n.Hc;q.Ze=n.Ze;q.od=n.od;q.Pd=n.Pd;q.yb=n.yb;q.Ad=n.Ad;q.Ah=n.Ah;q.Sa=n.Sa;
q.rg=n.rg;q.lj=n.lj;q.Qd=n.Qd;q.Df=n.Df;q.Jj=n.Jj;q.ac=n.ac;q.Cf=n.Cf;q.Kj=n.Kj;q.Vc=n.Vc;r=n.rb.D;q.gx=0==c?[0,0]:[Math.floor(r[0]/c),Math.floor(r[2]/c)];q.re=n.re;q.Zh=n.Zh;q.Af=n.Af;n=JSON.stringify(q);h[n]=h[n]||[];h[n].push(m)}for(var y in h){q=JSON.parse(y);c=h[y];var m=ha.gj("STATIC"),x;for(x in q)m[x]=q[x];m.Sc=a[0].d.Sc;m.pd=0;m.Re=0;m.he=0;m.ge=0;m.ee=0;m.Sh=!1;for(l=0;l<c.length;l++)n=c[l],0==l?(m.Qa=T.sa(n.d.Qa),m.rb=T.sa(n.d.rb),m.Xe=T.sa(n.d.Xe),m.Ye=T.sa(n.d.Ye)):(u.Vo(m.Qa,n.d.Qa),
u.Rv(m.rb,n.d.rb));m.Eb=T.sa(m.Qa);m.Cc=T.sa(m.rb);f.push({Ib:m,bc:c})}for(a=0;a<f.length;a++)for(h=f[a].Ib,l=f[a].bc,y=0;y<l.length;y++){x=l[y];c=k(x,h,b,d);m=L(x.d)||L(h);n={};h.od&&(n.au_center_pos=[m[0],m[1],m[2]],n.au_wind_bending_amp=[x.d.pd],n.au_wind_bending_freq=[x.b4w_wind_bending_freq],n.au_detail_bending_amp=[x.b4w_detail_bending_amp],n.au_detail_bending_freq=[x.b4w_detail_bending_freq],n.au_branch_bending_amp=[x.b4w_branch_bending_amp]);for(q=0;q<c.length;q++)v=c[q].Ib,r=c[q].jc,w=c[q].o,
v.Ej?v.Ad?V.Ez(r,m):V.Jr(r,m):("COLOR_ID"==w.type?(v=c[q].Ib=x.d,v.type="DYNAMIC",w.Pg=x.uuid,H(w,v),C(w,T.lg(v,0))):r=V.Jr(r,m),V.Dz(r,n));e=e.concat(c)}return e}function k(a,b,d,e){for(var f=[],g=m(d,b),h=T.lg(b,0),k=a.data,n=k.materials,q=0;q<g.length;q++){var r=g[q];if(!a.b4w_do_not_render||"PHYSICS"==r)for(var u=0;u<n.length;u++){var w=n[u];if(("LENS_FLARES"!=w.name||0!=e)&&!V.Np(k,u)){var v=c(r);if(l(v,w,!0)){v.Uc=k.Uc||V.uh;H(v,b);for(var p=v,E=a.particle_systems,x=0;x<E.length;x++){var O=
E[x].settings.b4w_vcol_from_name,B=E[x].settings.b4w_vcol_to_name;""!==O&&""!==B&&(p.Wa[O]={lf:!1,src:[{name:O,vc:7}]})}"DYNAMIC"==b.type&&(v.Pg=a.uuid);C(v,h);p=V.ap(k,u,v.bf,v.qc,v.Wa,v.Zf);"LENS_FLARES"==w.name&&(p=R.gy(p));f.push({o:v,jc:p,$b:[w.name],Ib:b,Jc:[a]})}}}}g=a.particle_systems;if(0<g.length&&f.length){e=!0;for(q=0;q<g.length;q++)if(g[q].settings.use_render_emitter){e=!1;break}q=f[0].o;g=f[0].jc;k=[];n=a.particle_systems;r=a.data;for(u=0;u<n.length;u++)if(w=n[u],v=w.settings,v.count)if("EMITTER"==
v.type){if("DYNAMIC"==b.type){p=c("PARTICLES");E=r.materials;x=w.settings.material-1;x>=E.length&&(S.warn('Wrong material used for rendering particle system "'+w.name+'"'),x=0);E=E[x];"HALO"===w.settings.render_type&&(p.of=!0);l(p,E);H(p,b);x=p;O=w;switch(O.settings.b4w_billboard_align){case "VIEW":y(x,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":y(x,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":y(x,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":y(x,"BILLBOARD_ALIGN",
"BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}y(x,"BILLBOARD",0);ga.B(x.Ia,"WORLD_SPACE","WORLD"==O.settings.b4w_coordinate_system?1:0);p.Vc=!0;p.Pg=a.name+"_"+v.uuid;p.Am=w.name;C(p,h);p.cc=w;v=R.pw(p,r,w,a.d.Wd);R.Qy(p,w,E);k.push({o:p,jc:v,$b:[E.name],Ib:b,Jc:[a]})}}else if("HAIR"==v.type){p=T.Aj(w.seed);v.b4w_dynamic_grass&&(b.rg=!0);if(w.transforms.length)var z=w.transforms;else for(var E=V.Cl(g,v.count,!1,p),z=new Float32Array(4*E.length),A=0;A<E.length;A++)x=.75+.5*
T.yc(p),z[4*A]=E[A][0],z[4*A+1]=E[A][1],z[4*A+2]=E[A][2],z[4*A+3]=x;E=pa.Ha(d,"GRASS_MAP")?!0:!1;if("OBJECT"==v.render_type)x=[m(d,v.dupli_object.d)],w=D(a,b,q,g,[v.dupli_object],x,[z],v,w,E,p,!1),k=k.concat(w);else if("GROUP"==v.render_type){O=v.dupli_group.objects;B=!1;x=[];for(A=0;A<O.length;A++){var G=m(d,v.dupli_group.objects[A].d);x.push(G)}if(v.use_whole_group){B=z;z=O;A={};for(G=0;G<B.length;G+=4)for(var ia=0;ia<z.length;ia++){var P=W.create();W.scale(z[ia].d.g,z[ia].d.scale,P);var ma=W.clone([B[G],
B[G+1],B[G+2]]);W.add(ma,P,ma);A[ia]||(A[ia]=new Float32Array(B.length));A[ia][G]=ma[0];A[ia][G+1]=ma[1];A[ia][G+2]=ma[2];A[ia][G+3]=B[G+3]}z=A;B=!0}else if(v.use_group_count){for(var ma=O,ca=v.dupli_weights,A=p,G={},ia=[],P=0;P<ma.length;P++)for(var I=ma[P],I=I.origin_name||I.name,J=0;J<ca.length;J++){var Z=ca[J];I==Z.name.split(": ")[0]&&ia.push(Z)}ca.length!=ia.length&&S.error("dupli weights match failed");for(P=0;P<z.length;P+=4){var L,ca=ia;L=[0];for(ma=0;ma<ca.length;ma++)L[ma+1]=L[ma]+ca[ma].count;
ca=L[L.length-1]*T.yc(A);for(ma=I=0;ma<L.length;ma++)if(ca>=L[ma]&&ca<L[ma+1]){I=ma;break}L=I;G[L]=G[L]||[];G[L].push(z[P],z[P+1],z[P+2],z[P+3])}for(L in G)G[L]=new Float32Array(G[L]);z=G}else{A=p;G=O.length;ia={};for(P=0;P<z.length;P+=4){var oa=Math.floor(G*T.yc(A));ia[oa]=ia[oa]||[];ia[oa].push(z[P],z[P+1],z[P+2],z[P+3])}for(oa in ia)ia[oa]=new Float32Array(ia[oa]);z=ia}w=D(a,b,q,g,O,x,z,v,w,E,p,B);k=k.concat(w)}"INSTANCE"==v.b4w_wind_bend_inheritance&&(a.d.pd=0)}else throw"Unknown particle settings type";
a=k;f=e?a:f.concat(a)}return f}function g(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function m(a,b){var c=["MAIN","NODES"];b.ad&&(pa.Ha(a,"COLOR_PICKING")||pa.Ha(a,"GLOW_MASK"))&&c.push("COLOR_ID");pa.Ha(a,"WIREFRAME")&&c.push("WIREFRAME");c.push("PHYSICS");(pa.Ha(a,"DEPTH")||pa.Ha(a,"SHADOW_CAST"))&&c.push("DEPTH");pa.Ha(a,"GRASS_MAP")&&c.push("GRASS_MAP");if(b.Rb||b.Qb){var d=null;b.Rb&&(d=["MAIN","NODES","COLOR_ID","PHYSICS","WIREFRAME"]);if(b.Qb)var e=
["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],d=null!==d?T.du(d,e):e;for(e=0;e<d.length;e++){var f=c.indexOf(d[e]);-1!==f&&c.splice(f,1)}}return c}function l(a,b,c){var d,e;switch(a.type){case "MAIN":if(b.b4w_do_not_render||b.use_nodes)a=!1;else{q(a,b);var f=b.game_settings.alpha_blend;a.Xd=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;a.Hf=b.offset_z;a.Je.set([1,1,1]);var g=b.texture_slots;ma.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.lb);switch(b.name){case "LENS_FLARES":J(a,
"special_lens_flares.glslv","special_lens_flares.glslf");G(a,"a_position");G(a,"a_texcoord");var h=c?[1,1,1,0]:null,h=w(g[0],h);Q(a,h);break;default:J(a,"main.glslv","main.glslf");var l=v("use_map_color_diffuse",g),k=v("use_map_color_spec",g),m=v("use_map_normal",g),u=v("use_map_mirror",g),p=v("use_stencil",g),f=l[0],k=k[0],m=m[0],u=u[0],l=l[1],g=p[0]&&v("use_rgb_to_intensity",g)[0];if(f){switch(f.blend_type){case "MIX":y(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":y(a,
"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}h="IMAGE"==f.texture.d.source&&c?[a.lb[0],a.lb[1],a.lb[2],1]:"ENVIRONMENT_MAP"==f.texture.d.source&&c?[.8,.8,.8,1]:null;h=w(f,h);Q(a,h,"u_colormap0");a.ie=f.diffuse_color_factor;a.$d=f.use_map_alpha?f.alpha_factor:0;a.Je.set(f.scale)}p=f&&f==k;k&&(p||(h=c?[.5,.5,.5,1]:null,h=w(k,h),Q(a,h,"u_specmap0")),a.yr=k.specular_color_factor);if(m){G(a,"a_normal");G(a,"a_tangent");h=c?[.5,.5,1,1]:null;h=w(m,h);Q(a,h,"u_normalmap0");a.uq=m.normal_factor;var O=
m.texture;if(O.b4w_use_map_parallax&&ca.ci){var h=ga.t(O.b4w_parallax_steps),z=ga.t(O.b4w_parallax_lod_dist);y(a,"PARALLAX",1);y(a,"PARALLAX_STEPS",h);y(a,"PARALLAX_LOD_DIST",z);a.Lf=O.b4w_parallax_scale}}u&&(h=c?[0,0,.5,1]:null,h=w(u,h),Q(a,h,"u_mirrormap"),a.mm=u.mirror_factor);if(O=f&&l&&g?1:0)h=c?[.8,.8,.8,1]:null,h=w(l,h),Q(a,h,"u_colormap1"),h=c?[.5,.5,.5,1]:null,h=w(g,h),Q(a,h,"u_stencil0");(c=f||k||m)&&a.Je.set(c.scale);y(a,"TEXTURE_SPEC",void 0==k?0:1);y(a,"TEXTURE_MIRROR",void 0==u?0:1);
y(a,"ALPHA_AS_SPEC",p?1:0);y(a,"TEXTURE_STENCIL_ALPHA_MASK",O);G(a,"a_position");G(a,"a_normal");(f||k||m)&&G(a,"a_texcoord");if(b.b4w_water){a.Oe=!0;a.on=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;c=b.texture_slots;J(a,"special_water.glslv","special_water.glslf");G(a,"a_position");G(a,"a_texcoord");G(a,"a_normal");G(a,"a_tangent");ca.ms?(G(a,"a_polyindex"),a.T=!0,a.wireframe_edge_color=[0,0,0],y(a,"DEBUG_WIREFRAME",1)):y(a,"DEBUG_WIREFRAME",0);p=v("use_map_normal",c);u=v("use_map_mirror",
c)[0];p.length&&(O=w(p[0]),Q(a,O,"u_normalmap0"),a.th=b.b4w_water_norm_uv_velocity);y(a,"NUM_NORMALMAPS",p.length);a.Ef=Array(p.length);for(O=0;O<p.length;O++)a.Ef[O]=new Float32Array(2),a.Ef[O].set([p[O].scale[0],p[O].scale[1]]);u?(y(a,"TEXTURE_MIRROR",1),p=w(u),Q(a,p,"u_mirrormap"),a.mm=u.mirror_factor):y(a,"TEXTURE_MIRROR",0);u=null;for(O=0;O<c.length;O++)if(d=c[O],!0===d.texture.b4w_water_foam){u=d;break}u&&ca.vg?(y(a,"FOAM",1),p=w(u),Q(a,p,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.fp.set(u.texture.b4w_foam_uv_freq),
a.ep.set(u.texture.b4w_foam_uv_magnitude),a.wl[0]=u.scale[0],a.wl[1]=u.scale[1]):y(a,"FOAM",0);for(O=0;O<c.length;O++)if(d=c[O],!0===d.texture.b4w_shore_dist_map){e=d;break}e&&ca.Bk?(e=w(e),Q(a,e,"u_shore_dist_map"),y(a,"SHORE_PARAMS",1),e=d.texture.b4w_shore_boundings,y(a,"MAX_SHORE_DIST",ga.t(d.texture.b4w_max_shore_dist)),y(a,"SHORE_MAP_SIZE_X",ga.t(e[0]-e[1])),y(a,"SHORE_MAP_SIZE_Y",ga.t(e[2]-e[3])),y(a,"SHORE_MAP_CENTER_X",ga.t((e[0]+e[1])/2)),y(a,"SHORE_MAP_CENTER_Y",ga.t((e[2]+e[3])/2))):y(a,
"SHORE_PARAMS",0);b.b4w_generated_mesh&&ca.kj?(y(a,"GENERATED_MESH",1),a.js=!0,a.ks=b.b4w_water_num_cascads,a.ls=b.b4w_water_subdivs,a.hs=b.b4w_water_detailed_dist):y(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){d=ga.t(b.b4w_water_dst_noise_scale0);e=ga.t(b.b4w_water_dst_noise_scale1);c=ga.t(b.b4w_water_dst_noise_freq0);var u=ga.t(b.b4w_water_dst_noise_freq1),p=ga.t(b.b4w_water_dir_min_shore_fac),O=ga.t(b.b4w_water_dir_freq),h=ga.t(b.b4w_water_dir_noise_scale),z=ga.t(b.b4w_water_dir_noise_freq),
T=ga.t(b.b4w_water_dir_min_noise_fac),W=ga.t(b.b4w_water_dst_min_fac),A=ga.t(b.b4w_water_waves_hor_fac);y(a,"DST_NOISE_SCALE_0",d);y(a,"DST_NOISE_SCALE_1",e);y(a,"DST_NOISE_FREQ_0",c);y(a,"DST_NOISE_FREQ_1",u);y(a,"DIR_MIN_SHR_FAC",p);y(a,"DIR_FREQ",O);y(a,"DIR_NOISE_SCALE",h);y(a,"DIR_NOISE_FREQ",z);y(a,"DIR_MIN_NOISE_FAC",T);y(a,"DST_MIN_FAC",W);y(a,"WAVES_HOR_FAC",A)}B(a,b);x(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=
b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;y(a,"ABSORB",ga.t(b.b4w_water_absorb_factor));y(a,"SSS_STRENGTH",ga.t(b.b4w_water_sss_strength));y(a,"SSS_WIDTH",ga.t(b.b4w_water_sss_width));d=a.Ia;e=a.bf;a.Ia=d;a.bf=e}"HALO"===b.type&&(d=b.halo,J(a,"halo.glslv","halo.glslf"),y(a,"NUM_RINGS",d.ring_count),y(a,"NUM_LINES",d.line_count),y(a,"NUM_STARS",d.star_tip_count),y(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.bf=["a_position"],a.Jp=d.size,a.Gp=d.hardness/20,a.Ip.set(d.b4w_halo_rings_color),
a.Hp.set(d.b4w_halo_lines_color),a.Kp=1/b.b4w_halo_stars_blend_height,a.Lp=b.b4w_halo_stars_min_height,a.Fp=!0);y(a,"TEXCOORD",0);y(a,"NORMAL_TEXCOORD",0);f&&r(a,f,"TEXTURE_COLOR0_CO");l&&r(a,l,"TEXTURE_COLOR1_CO");g&&r(a,g,"TEXTURE_STENCIL_ALPHA_MASK_CO");k&&r(a,k,"TEXTURE_SPEC_CO");m&&r(a,m,"TEXTURE_NORM_CO");y(a,"SHADELESS",b.use_shadeless?1:0);a.Yf=b.use_shadeless}f=b.game_settings.alpha_blend;y(a,"ALPHA","OPAQUE"===f?0:1);y(a,"ALPHA_CLIP","CLIP"===f?1:0);y(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?
1:0);b.use_vertex_color_paint?(y(a,"VERTEX_COLOR",1),G(a,"a_color")):y(a,"VERTEX_COLOR",0);a.wd=b.ambient;a.je=b.diffuse_intensity;a.Fd=b.emit;a.fd.set(b.specular_color);a.$g=b.specular_alpha;B(a,b);x(a,b);b.b4w_wettable?y(a,"WETTABLE",1):y(a,"WETTABLE",0);E(a,b);a.Cm=b.b4w_refractive;a.br=b.b4w_refr_bump;a=!0}break;case "NODES":a=n(a,b);break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)a=!1;else if(q(a,b),a.za)a=!1;else{J(a,"depth.glslv","depth.glslf");
G(a,"a_position");G(a,"a_normal");f=b.game_settings.alpha_blend;y(a,"ALPHA","OPAQUE"===f?0:1);a.Je.set([1,1,1]);if((b=v("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===f){a.Je.set(b.scale);y(a,"TEXTURE_COLOR",1);G(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)f=w(b),Q(a,f,"u_colormap0");"NONE"==b.texture.d.source&&(f=w(b),Q(a,f,"u_colormap0"))}else y(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.qA=b.b4w_use_ghost,a.Vb=b.b4w_collision_id,
a.xo=b.b4w_collision_group,a.yo=b.b4w_collision_mask,a.Oh=b.physics.friction,a.Jh=b.physics.elasticity,a=!0):b.b4w_water?(a.Oe=!0,a.zA=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,
a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_do_not_render||"HALO"===b.type)a=!1;else{q(a,b);a.Yd=V.td;a.T=!0;a.za=!1;f=b.game_settings.alpha_blend;a.Xd=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;J(a,"color_id.glslv","color_id.glslf");G(a,"a_position");f=b.game_settings.alpha_blend;y(a,"ALPHA","OPAQUE"===f?0:1);a.Je.set([1,1,1]);if((b=v("use_map_color_diffuse",
b.texture_slots)[0])&&"CLIP"===f){a.Je.set(b.scale);y(a,"TEXTURE_COLOR",1);G(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)f=w(b),Q(a,f,"u_colormap0");"NONE"==b.texture.d.source&&(f=w(b),Q(a,f,"u_colormap0"))}else y(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?a=!1:(q(a,b),a.za=!1,a.Yd=V.td,a.T=!0,J(a,"grass_map.glslv","grass_map.glslf"),G(a,"a_position"),f=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?
b.b4w_dynamic_grass_color:null,a.Wa.a_grass_size={lf:!0,src:[]},f?(a.Wa.a_grass_size.src.push({name:f,vc:4}),y(a,"DYNAMIC_GRASS_SIZE",1)):y(a,"DYNAMIC_GRASS_SIZE",0),a.Wa.a_grass_color={lf:!0,src:[]},b?(a.Wa.a_grass_color.src.push({name:b,vc:7}),y(a,"DYNAMIC_GRASS_COLOR",1)):y(a,"DYNAMIC_GRASS_COLOR",0),a=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?a=!1:(J(a,"wireframe.glslv","wireframe.glslf"),G(a,"a_position"),G(a,"a_normal"),G(a,"a_polyindex"),
a.T=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],a=!0);break;case "PARTICLES":if(b.b4w_do_not_render)a=!1;else{f=b.texture_slots;if(a.of)J(a,"particles_color.glslv","particles_color.glslf");else if(J(a,"particles_texture.glslv","particles_texture.glslf"),f=v("use_map_color_diffuse",f)[0]){y(a,"TEXTURE_COLOR",1);switch(f.blend_type){case "MIX":y(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":y(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.ie=f.diffuse_color_factor;
a.$d=f.use_map_alpha?f.alpha_factor:0;f=w(f);Q(a,f)}ma.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.lb);a.wd=b.ambient;a.je=b.diffuse_intensity;a.Fd=b.emit;a.fd.set(b.specular_color);a.$g=b.specular_alpha;G(a,"a_position");G(a,"a_normal");f=b.game_settings.alpha_blend;y(a,"ALPHA","OPAQUE"===f?0:1);y(a,"ALPHA_CLIP","CLIP"===f?1:0);y(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);B(a,b);x(a,b);q(a,b);f=b.game_settings.alpha_blend;a.Xd=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=
f;a.Hf=b.offset_z;a=!0}break;default:throw"Wrong batch type: "+a.type;}return a}function r(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":y(a,c,"TEXTURE_COORDS_UV_ORCO");y(a,"TEXCOORD",1);break;case "NORMAL":y(a,c,"TEXTURE_COORDS_NORMAL");y(a,"NORMAL_TEXCOORD",1);break;default:y(a,c,0)}}function q(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.za=!0;a.Yd=V.Cn;a.T=!0;break;case "ALPHA":a.za=!0;a.Yd=V.td;a.T=!0;break;case "CLIP":a.za=!1;a.Yd=V.td;a.T=!0;break;case "ADD":a.za=
!0;a.Yd=V.td;a.T=!1;break;case "OPAQUE":a.za=!1;a.Yd=V.td;a.T=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.wa=c.use_backface_culling}function w(a,b){var c=a.texture,d=c.d,c=c.image;d&&b&&c&&ea.xi(d,b,c.Tb,c.filepath);return d}function v(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];1==f[a]&&f.texture&&f.texture.d&&c.push(f)}return c}function E(a,b){var c=b.raytrace_transparency;a.Fc[0]=c.fresnel;a.Fc[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.Pf=c.reflect_factor;a.Fc[2]=
c.fresnel;a.Fc[3]=1-c.fresnel_factor/5}function B(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":y(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":y(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":y(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;d=b.specular_toon_smooth;break;default:S.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.Sb[0]=b.specular_intensity;
a.Sb[1]=c;a.Sb[2]=d}function x(a,b){switch(b.diffuse_shader){case "LAMBERT":y(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.Ed[0]=0;a.Ed[1]=0;break;case "OREN_NAYAR":y(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.Ed[0]=b.roughness;a.Ed[1]=0;break;case "FRESNEL":y(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.Ed[0]=b.diffuse_fresnel;a.Ed[1]=b.diffuse_fresnel_factor;break;default:S.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.Ed[0]=0,a.Ed[1]=0}}function n(a,b){if(!b.use_nodes||
b.b4w_do_not_render)return!1;var c=Y.Ku(b.node_tree,b.uuid,!1,b.name);if(!c)return S.error('Failed to create node graph for material "'+b.name+'", disable nodes'),e(a,b),!0;J(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;y(a,"ALPHA","OPAQUE"===d?0:1);y(a,"ALPHA_CLIP","CLIP"===d?1:0);y(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);G(a,"a_position");q(a,b);a.Hf=b.offset_z;d=b.game_settings.alpha_blend;a.Xd=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;ma.set(b.diffuse_color[0],
b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.lb);a.Fd=b.emit;a.wd=b.ambient;E(a,b);b.b4w_wettable?y(a,"WETTABLE",1):y(a,"WETTABLE",0);a.Ia.rm=Y.Lu(c);var f=!1;fa.P(c,function(b,c){switch(c.type){case "GEOMETRY_UV":var d=c.data.name,e=c.data.value;a.Zf||(a.Zf={});a.Zf[e]=d;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":d=c.data.name;a.Wa[d]={lf:!0,src:[{name:c.data.value}]};e=0;if("GEOMETRY_VC"==c.type)e=7;else for(var g=0;g<c.Va.length;g++){var h="RGB".indexOf(c.Va[g].identifier);
-1<h&&(e|=1<<2-h)}a.Wa[d].src[0].vc=e;break;case "GEOMETRY_NO":G(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":d=c.data.value;G(a,"a_normal");y(a,"DIFFUSE_SHADER","DIFFUSE_"+d.Hv);y(a,"SPECULAR_SHADER","SPECULAR_"+d.uz);y(a,"SHADELESS_MAT",d.Yf?1:0);a.Yf=d.Yf;a.$g=d.$g;f=!0;break;case "TEXTURE_COLOR":case "TEXTURE_COLOR2":case "TEXTURE_COLOR3":case "TEXTURE_COLOR4":case "TEXTURE_ENVIRONMENT":d=c.data.name;e=c.data.value;!1!==e.d.Ni&&(e.d.Ni="TEXTURE_ENVIRONMENT"!=c.type?!0:!1);Q(a,e.d,d);
break;case "TEXTURE_NORMAL":case "TEXTURE_NORMAL2":case "TEXTURE_NORMAL3":case "TEXTURE_NORMAL4":case "B4W_PARALLAX":y(a,"CALC_TBN_SPACE",1);G(a,"a_normal");G(a,"a_tangent");d=c.data.name;e=c.data.value;e.d.Ni=!1;Q(a,e.d,d);break;case "LAMP":c.data&&(a.Gg=c.data);break;case "B4W_REFRACTION":a.Cm=!0}});f||(a.Yf=!0);return!0}function e(a,b){J(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;y(a,"ALPHA","OPAQUE"===c?0:1);y(a,"ALPHA_CLIP","CLIP"===c?1:0);y(a,"SHADELESS",1);G(a,"a_position");
G(a,"a_normal");ma.set(1,0,1,1,a.lb);y(a,"VERTEX_COLOR",0);a.Hf=b.offset_z;q(a,b)}function H(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.Ej?y(a,"AU_QUALIFIER","attribute"):y(a,"AU_QUALIFIER","uniform"),y(a,"STATIC_BATCH",0)):(y(a,"AU_QUALIFIER","attribute"),y(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(Z.Uw()?y(a,"WIREFRAME_QUALITY",1):y(a,"WIREFRAME_QUALITY",0),a.Gh?(y(a,"DEBUG_SPHERE",1),a.Mo?y(a,"DEBUG_SPHERE_DYNAMIC",1):y(a,"DEBUG_SPHERE_DYNAMIC",0)):y(a,"DEBUG_SPHERE",0),y(a,"ALPHA",1));
b.od?(""!==b.Pd?(a.Wa.a_bending_col_main={lf:!0,src:[{name:b.Pd,vc:4}]},G(a,"a_bending_col_main"),""!==b.yb.iq&&""!==b.yb.hq&&""!==b.yb.yq?(a.Wa.a_bending_col_detail={lf:!0,src:[{name:b.yb.iq,vc:4},{name:b.yb.hq,vc:2},{name:b.yb.yq,vc:1}]},G(a,"a_bending_col_detail"),G(a,"a_normal"),y(a,"DETAIL_BEND",1)):y(a,"DETAIL_BEND",0),y(a,"MAIN_BEND_COL",1)):y(a,"MAIN_BEND_COL",0),y(a,"WIND_BEND",1)):y(a,"WIND_BEND",0);b.Ti?y(a,"BEND_CENTER_ONLY",1):y(a,"BEND_CENTER_ONLY",0);y(a,"BILLBOARD_PRES_GLOB_ORIENTATION",
b.nu|0);b.Ad?y(a,"BILLBOARD",1):y(a,"BILLBOARD",0);b.Ad&&b.Ej?y(a,"HAIR_BILLBOARD",1):y(a,"HAIR_BILLBOARD",0);b.Nk?y(a,"BILLBOARD_SPHERICAL",1):y(a,"BILLBOARD_SPHERICAL",0);switch(b.Ah){case "RANDOM":y(a,"BILLBOARD_RANDOM",1);y(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":y(a,"BILLBOARD_RANDOM",0);y(a,"BILLBOARD_JITTERED",1);break;default:y(a,"BILLBOARD_RANDOM",0),y(a,"BILLBOARD_JITTERED",0)}b.Sa&&ca.Bk?y(a,"DYNAMIC_GRASS",1):y(a,"DYNAMIC_GRASS",0);a.Sa=b.Sa;a.Vc=b.Vc;a.hc=b.hc;a.Rb=b.Rb;a.Ab=
b.Ab&&!a.Yf&&!(a.za&&ca.Qo);a.fc=b.fc;a.Qb=b.Qb;a.Hc=b.Hc;b.Vh?(G(a,"a_influence"),y(a,"SKINNED",1),b.Nh?y(a,"FRAMES_BLENDING",1):y(a,"FRAMES_BLENDING",0),y(a,"MAX_BONES",b.Gc)):(y(a,"SKINNED",0),y(a,"FRAMES_BLENDING",0));b.sk?(y(a,"VERTEX_ANIM",1),ca.fs?y(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):y(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):y(a,"VERTEX_ANIM",0);if(b.Vh&&b.sk)throw"Skinning and vertex animation are mutually exlusive";b.lj?y(a,"DISABLE_FOG",1):y(a,"DISABLE_FOG",0);b.qc&&
(a.qc=b.qc);if("NODES"==a.type){for(var c=a.Ia.rm,d=b.Df,e=b.Cf,f=0;f<c.length;f++){var g=c[f];switch(g.id){case "VALUE":var h=g.Uj[0];if(h)for(var l=0;l<d.length;l+=2)if(d[l]==h){g.df.push(["VALUE_IND",d[l+1]]);break}break;case "RGB":if(h=g.Uj[0])for(l=0;l<e.length;l+=2)if(e[l]==h){g.df.push(["RGB_IND",e[l+1]]);break}}}y(a,"NUM_VALUES",b.Qd.length);y(a,"NUM_RGBS",b.ac.length)}}}function G(a,b){var c=a.bf;-1==c.indexOf(b)&&c.push(b)}function y(a,b,c){ga.B(a.Ia,b,c)}function A(a,b){if("PHYSICS"==a.type)a.jc=
b;else{var c=a.Yd,d=a.Uc;a.Fp&&(b=V.Xv(b));a.js&&(b=X.tw(a.ks,a.ls,a.hs));c=V.Gz(b,c,d,a.Wa);a.Vc||c.zj||(c.oe=null,c.md=null);a.na=c;c=b.v.length;a.num_vertices=b.I*c;a:switch(a.Uc){case V.uh:case V.Ii:case V.un:d=!0;break a;default:d=!1}d?V.vx(b)?a.num_triangles=b.W.length/3*c:a.num_triangles=b.I/3*c:a.num_triangles=0}}function D(a,b,d,e,f,g,h,k,m,n,q,u){var r=[],w=k.b4w_dynamic_grass;if(!n&&w)return r;for(var v="INSTANCE"==k.b4w_wind_bend_inheritance,p="INSTANCE"==k.b4w_shadow_inheritance,E="INSTANCE"==
k.b4w_reflection_inheritance,x=[],y=[],B=0;B<f.length;B++){var z=f[B],A=T.bj(b);A.Ad=k.b4w_hair_billboard;A.Ah=k.b4w_hair_billboard_type;A.Nk="SPHERICAL"==k.b4w_hair_billboard_geometry;A.Sa=w;A.Ej=!0;A.Qd=z.d.Qd;A.Df=z.d.Df;A.ac=z.d.ac;A.Cf=z.d.Cf;v?(A.od=z.d.od,A.Ei=z.d.Ei,A.Re=z.d.Re,A.he=z.d.he,A.Pd=z.d.Pd,A.ge=z.d.ge,A.ee=z.d.ee,A.pd=z.d.pd,A.yb=z.d.yb,A.Ti=!1):(A.od=a.d.od,A.Ei=a.d.Ei,A.Re=a.d.Re,A.he=a.d.he,A.Pd=a.d.Pd,A.ge=a.d.ge,A.ee=a.d.ee,A.pd=a.d.pd,A.yb=a.d.yb,A.Ti=!0);p?(A.hc=z.d.hc,
A.Rb=z.d.Rb,A.Ab=z.d.Ab):(A.hc=a.d.hc,A.Rb=a.d.Rb,A.Ab=a.d.Ab);E?(A.fc=z.d.fc,A.Qb=z.d.Qb,A.Hc=z.d.Hc):(A.fc=a.d.fc,A.Qb=a.d.Qb,A.Hc=a.d.Hc);x.push(A);var G=h[B];G||(G=new Float32Array);u&&T.Aj(m.seed,q);for(var D=new Float32Array(3),ia=new Float32Array([0,0,0,1]),P=[],ca=0;ca<G.length;ca+=4){D[0]=G[ca];D[1]=G[ca+1];D[2]=G[ca+2];var I=G[ca+3];if(k.b4w_initial_rand_rotation){switch(k.b4w_rotation_type){case "XYZ":var J=new Float32Array([T.yc(q),T.yc(q),T.yc(q)]);W.normalize(J,J);break;case "Z":J=new Float32Array([0,
1,0]);break;default:throw"Unsupported random rotation type: "+k.b4w_rotation_type;}oa.setAxisAngle(J,k.b4w_rand_rotation_strength*(2*Math.PI*T.yc(q)-Math.PI),ia)}var Z=O.qg(D,I,ia);P.push(Z)}y.push(P)}for(var L={},B=0;B<f.length;B++){var N=g[B],A=x[B],R=T.lg(A,0),P=y[B];if(P.length)for(var Q=f[B].data,Y=Q.materials,ca=0;ca<Y.length;ca++)if(!V.Np(Q,ca))for(var X=0;X<N.length;X++){var fa=N[X];if("COLOR_ID"!==fa){var ha=c(fa),ea=Y[ca];if(l(ha,ea,!0)){ha.Uc=Q.Uc||V.uh;H(ha,A);ha.Pg=k.uuid;"JITTERED"==
k.b4w_hair_billboard_type&&(ha.bq=k.b4w_hair_billboard_jitter_amp,ha.cq=k.b4w_hair_billboard_jitter_freq);w&&(ha.Ep=k.b4w_dynamic_grass_scale_threshold);v||(delete ha.Wa.a_bending_col_main,delete ha.Wa.a_bending_col_detail);C(ha,R);var ga=V.ap(Q,ca,ha.bf,ha.qc,ha.Wa,ha.Zf),pa=[];if(A.od||A.Sa||A.Ad)pa.au_wind_bending_amp=[A.pd],pa.au_wind_bending_freq=[A.Re],pa.au_detail_bending_freq=[A.he],pa.au_detail_bending_amp=[A.ge],pa.au_branch_bending_amp=[A.ee];var fb=V.Hx(ga,pa,P),Fa=fb,ob=P;Fa.F.au_center_pos=
new Float32Array(3*Fa.I);for(var Ia=ob.length,Ua=Fa.I/Ia,zb=0;zb<Ia;zb++)for(var rb=ob[zb],cb=3*Ua*zb,Vb=0;Vb<Ua;Vb++)Fa.F.au_center_pos[cb+3*Vb]=rb[0],Fa.F.au_center_pos[cb+3*Vb+1]=rb[1],Fa.F.au_center_pos[cb+3*Vb+2]=rb[2];fb=Fa;if(A.Ti){var gb=fb,kb=a.d.N;gb.F.a_emitter_center=new Float32Array(3*gb.I);var Ka=ma.fromValues(0,0,0,1);ma.transformMat4(Ka,kb,Ka);for(var wa=0;wa<gb.I;wa++)gb.F.a_emitter_center[3*wa]=Ka[0],gb.F.a_emitter_center[3*wa+1]=Ka[1],gb.F.a_emitter_center[3*wa+2]=Ka[2];fb=gb}var Ab=
k.b4w_vcol_from_name,sb=k.b4w_vcol_to_name,sa=ha,Pb=d,aa=!v,db=Q,Qa=[];if(""!==Ab&&""!==sb){var Ca,Ta=sb,yb=sa.Wa,Fb=[],cc=void 0;for(cc in yb)for(var Bb=yb[cc].src,Ra=0,Wb=0;Wb<Bb.length;Wb++){var Ib=Bb[Wb].vc;Ta==Bb[Wb].name&&Fb.push(cc,Ib,Ra);Ra+=T.Qf(Ib)}Ca=Fb;if(0<Ca.length)for(var dc=0;dc<Ca.length;dc+=3)Qa.push({Kh:Ab,oj:7,Vj:Ca[dc],Wj:Ca[dc+1],mj:Ca[dc+2]});else V.hx(sa.bf,"a_color")&&sb==db.active_vcol_name&&Qa.push({Kh:Ab,oj:7,Vj:"a_color",Wj:7,mj:0})}aa&&("a_bending_col_main"in Pb.Wa&&
Qa.push({Kh:"a_bending_col_main",oj:4,Vj:"a_bending_col_main",Wj:4,mj:0}),"a_bending_col_detail"in Pb.Wa&&Qa.push({Kh:"a_bending_col_detail",oj:7,Vj:"a_bending_col_detail",Wj:7,mj:0}));for(var Xb=fb,mc=P,tb=e,hb=Qa,nc=ha.Wa,ic=!1,$a=0;$a<hb.length;$a++){var oc=hb[$a].Kh,F=tb.F[oc];if(F&&0<F.length){ic=!0;break}}if(ic){var Jb,lb=a.d.Eb,Da=tb.v[0].a_position,ib=mc,U=L,Va=new Float32Array(3),Wa=new Float32Array(3),Qb=new Uint32Array(ib.length);if(!("verts_indices"in U)){U.Cd=new Float32Array(3);U.zd=
new Float32Array(3);U.kn=new Uint32Array(Da.length/3);U.$h=new Uint32Array(Da.length/3);U.Cd[0]=(lb.max_x-lb.min_x)/20;U.Cd[1]=(lb.max_y-lb.min_y)/20;U.Cd[2]=(lb.max_z-lb.min_z)/20;U.zd[0]=lb.min_x;U.zd[1]=lb.min_y;U.zd[2]=lb.min_z;for(var ya=0;ya<Da.length/3;ya++){var Kb=T.trunc((Da[3*ya]-U.zd[0])/U.Cd[0]),Ma=T.trunc((Da[3*ya+1]-U.zd[1])/U.Cd[1]),uc=T.trunc((Da[3*ya+2]-U.zd[2])/U.Cd[2]),Kb=T.clamp(Kb,0,19),Ma=T.clamp(Ma,0,19),uc=T.clamp(uc,0,19);U.kn[ya]=ya;U.$h[ya]=uc*Math.pow(20,2)+20*Ma+Kb}V.oz(U.$h,
U.kn,!0);U.ag=new Uint32Array(Math.pow(20,3));for(ya=0;ya<U.$h.length;ya++)U.ag[U.$h[ya]]++;delete U.$h;for(ya=1;ya<U.ag.length;ya++)U.ag[ya]+=U.ag[ya-1]}for(var Yb=0;Yb<ib.length;Yb++){Va[0]=ib[Yb][0];Va[1]=ib[Yb][1];Va[2]=ib[Yb][2];for(var Cb=1E10,ec=-1,Fc=T.trunc((Va[0]-U.zd[0])/U.Cd[0]),La=T.trunc((Va[1]-U.zd[1])/U.Cd[1]),Na=T.trunc((Va[2]-U.zd[2])/U.Cd[2]),Fc=T.clamp(Fc,0,19),La=T.clamp(La,0,19),Na=T.clamp(Na,0,19),Gc=Na*Math.pow(20,2)+20*La+Fc,pd=U.ag[Gc],Lb=0==Gc?0:U.ag[Gc-1];Lb<pd;Lb++){var vc=
U.kn[Lb];Wa[0]=Da[3*vc];Wa[1]=Da[3*vc+1];Wa[2]=Da[3*vc+2];W.sub(Wa,Va,Wa);var pc=W.sqrLen(Wa);pc<=Cb&&(Cb=pc,ec=vc)}if(-1==ec)for(Lb=0;Lb<Da.length/3;Lb++)Wa[0]=Da[3*Lb],Wa[1]=Da[3*Lb+1],Wa[2]=Da[3*Lb+2],W.sub(Wa,Va,Wa),pc=W.sqrLen(Wa),pc<=Cb&&(Cb=pc,ec=Lb);Qb[Yb]=ec}Jb=Qb;for(var Hc=Xb.I/mc.length,$a=0;$a<hb.length;$a++){var Zb=hb[$a].Vj,Ic=hb[$a].Wj,oc=hb[$a].Kh,jd=hb[$a].oj,F=tb.F[oc];switch(Zb){case "a_bending_col_main":var wc=1;break;case "a_bending_col_detail":wc=3;break;case "a_color":wc=3;
break;default:for(var jc=wc=0;jc<nc[Zb].src.length;jc++)wc+=T.Qf(nc[Zb].src[jc].vc)}if(F&&0<F.length){var qc=T.Qf(jd),Mb=T.Qf(Ic),rc=jd&Ic,xc=T.fr(rc);rc!=Ic&&S.error("Wrong color extraction from "+oc+" to "+Zb+".");if("a_bending_col_main"==Zb||"a_bending_col_detail"==Zb)Xb.F[Zb]=new Float32Array(Xb.I*Mb);for(jc=0;jc<mc.length;jc++){var kc=Jb[jc],$b=kc*qc,Xc=jc*Hc*wc;if(-1!=kc)for(var fc=0;fc<Hc;fc++)for(var mb=fc*wc,nb=0;nb<xc.length;nb++)xc[nb]&&(Xb.F[Zb][Xc+mb+(hb[$a].mj+T.oi(Ic,nb))]=F[$b+T.oi(jd,
nb)])}}else Xb.F[Zb]=new Float32Array(0)}}fb=Xb;r.push({o:ha,jc:fb,$b:[ea.name],Ib:A,Jc:[a]})}}}}return r}function L(a){return O.qg(a.g,a.scale,a.quat)}function C(a,b){for(var c=null,d=null,e=0;e<a.L.length;e++){var f=a.L[e].Bd;f&&(c||(c={}),c[e]=f,a.L[e].Bd=null);if(f=a.L[e].Xa)d||(d={}),d[e]=f,a.L[e].Xa=null}a.id=0;a.vy=b;a.id=T.lg(a,b);if(c)for(var g in c)a.L[g].Bd=c[g];if(d)for(g in d)a.L[g].Xa=d[g]}function I(a,b,d,e,f){var g=c("WIREFRAME");J(g,"wireframe.glslv","wireframe.glslf");g.wireframe_mode=
0;g.Gh=!0;g.T=!0;g.Pg=d;f&&(g.Mo=!0);H(g,b);C(g,T.lg(b,0));e?(b=X.op(1,a.D),V.Hy(b,[a.Ue[0],a.Ve[1],a.We[2]],a.D)):b=X.op(a.va,a.D);V.Vm(b,1,!0);b.F.a_polyindex=V.$o(b);A(g,b);return g}function J(a,b,c){a.Ia={Ai:b,Mh:c,ke:[],am:[],rm:[]};ga.Py(a.Ia)}function Q(a,b,c){1==a.L.length&&0==a.Bb.length&&a.Bb.push("default0");c=c||"default"+String(a.L.length);-1==a.Bb.indexOf(c)&&(a.L.push(b),a.Bb.push(c));a.Jb&&z.Rn(a)}function N(a){if(!a.Ia)throw"No shaders info for batch "+a.name;a.Jb=ga.Fw(a.Ia);z.hu(a.Jb);
z.Qn(a);z.Rn(a)}var u=p("__boundings"),P=p("__config"),S=p("__print"),Z=p("__extensions"),V=p("__geometry"),fa=p("__graph"),Y=p("__nodemat"),ha=p("__objects"),R=p("__particles"),X=p("__primitives");p("__reformer");var z=p("__renderer"),pa=p("__scenegraph"),ga=p("__shaders"),ea=p("__textures"),O=p("__tsr"),T=p("__util"),W=p("vec3"),ma=p("vec4"),oa=p("quat"),ca=P.q,ia=["MAIN","NODES"];a.sC=c;a.sw=function(a,e,g,h,l,k){for(var m=[],n=[],q=[],r=0;r<g.length;r++){var v=g[r];ha.uc(v)?n.push(v):q.push(v)}r=
[];r=r.concat(d(n,a,k));n=r=r.concat(f(q,a,e,k));r=[];v=[];q={};for(e=0;e<n.length;e++){var p=n[e].o,E=n[e].Ib,x=null;if(p.id in q){var O=q[p.id],y=v[O].o,B=v[O].Ib,z=null,W=null;for(k=0;k<p.L.length;k++){var H=p.L[k].Bd;H&&(z||(z={}),z[k]=H,p.L[k].Bd=null);if(H=p.L[k].Xa)W||(W={}),W[k]=H,p.L[k].Xa=null}T.Hr(p,y)&&T.Hr(E,B)&&(x=v[O]);if(z)for(k in z)p.L[k].Bd=z[k];if(W)for(k in W)p.L[k].Xa=W[k];if(!x){do p.id++;while(q[p.id])}}x||(x={o:p,Ib:n[e].Ib,Jc:[],Kr:[],$b:[]},q[p.id]=v.length,v.push(x));x.Jc=
x.Jc.concat(n[e].Jc);n[e].jc&&n[e].jc.I&&x.Kr.push(n[e].jc);if(x.$b.length)for(k=0;k<n[e].$b.length;k++)p=n[e].$b[k],-1==x.$b.indexOf(p)&&x.$b.push(p);else x.$b=n[e].$b}for(e=0;e<v.length;e++){n=v[e].Kr;if(0==n.length)k=T.bb(T.nk("%empty"));else if(1==n.length)k=n[0];else{q=[];for(k=0;k<n.length;k++)V.wx(n[k])||q.push(k);if(q.length<n.length)for(k=0;k<q.length;k++)V.Vm(n[q[k]]);k=V.Fz(n)}r.push({o:v[e].o,Ib:v[e].Ib,jc:k,$b:v[e].$b,Jc:v[e].Jc})}m.push.apply(m,r);for(r=0;r<m.length;r++)A(m[r].o,m[r].jc),
m[r].o.wc=m[r].$b;for(r=0;r<m.length;r++)if(e=m[r].o,"STATIC"==m[r].Ib.type)v=ha.Sp(T.nk("%meta"),"MESH",!0),v.d=m[r].Ib,v.n=[e],l.push(v);else for(n=[],k=0;k<m[r].Jc.length;k++)if(v=m[r].Jc[k],-1==n.indexOf(v.name)){for(q=0;q<v.n.length;q++)if(v.n[q]==e)throw"Batch already exist in object";v.n.push(e);n.push(v.name)}if(ca.wireframe_debug){for(r=0;r<m.length;r++)if(e=m[r].Ib,"DYNAMIC"==e.type&&(v=m[r].Jc[0],-1<ia.indexOf(m[r].o.type))){n=!1;for(k=0;k<v.n.length;k++)v.n[k].Gh&&(n=!0);n||(e=I(e.Xe,
e,v.name,!0,!0),v.n.push(e))}for(r=0;r<l.length;r++)v=l[r],e=v.d,-1<ia.indexOf(v.n[0].type)&&(e=I(e.Cc,e,v.name,!1),v.n.push(e))}m=null;if(h.texture_slots)for(r=0;r<h.texture_slots.length;r++)if(h.texture_slots[r].texture.b4w_use_as_skydome){m=w(h.texture_slots[r],null);break}if(h.b4w_sky_settings.procedural_skydome||m)e=c("MAIN"),J(e,"special_skydome.glslv","special_skydome.glslf"),h.b4w_sky_settings.procedural_skydome?e.Wq=!0:Q(e,m,"u_sky"),h.b4w_sky_settings.reflexible&&(e.fc=!0,h.b4w_sky_settings.reflexible_only&&
(e.Qb=!0)),G(e,"a_position"),e.Hf=99999,h=X.rw(),A(e,h),v=ha.Sp(T.nk("%meta"),"MESH",!0),v.d=ha.gj("DYNAMIC"),v.d.rg=!0,v.d.Eb=u.qd(),v.d.Cc=u.Fi(),v.d.Qa=u.qd(),v.d.rb=u.Fi(),v.n=[e],l.push(v);for(r=0;r<g.length;r++)b(g[r],a);for(r=0;r<l.length;r++)b(l[r],a)};a.AA=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.ju=g;a.Cw=w;a.Fk=function(a,b){y(a,"CSM_SECTION0",0);y(a,"CSM_SECTION1",
0);y(a,"CSM_SECTION2",0);y(a,"CSM_SECTION3",0);for(var c=0;c<b.csm_num;c++)y(a,"CSM_SECTION"+String(c),1);y(a,"SHADOW_TEX_RES",ga.t(b.csm_resolution));y(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);y(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.ba=y;a.nb=function(a,b){return ga.Kw(a.Ia,b)};a.Xz=C;a.Pi=Q;a.zy=function(a,b,c){c=a.Bb.indexOf(c);-1<c&&(a.L[c]=b)};a.lv=function(a,b){var d=c("MAIN");d.za=!0;ma.set(b[0],b[1],b[2],.5,d.lb);d.Uc=V.Ii;A(d,a);J(d,"main.glslv","main.glslf");
y(d,"SHADELESS",1);N(d);return d};a.qb=N;a.zu=function(a){return a.Jb.di.length?a.Jb.xm.u_cube_fog?!0:!1:!1};a.$u=function(){var a=c("DEPTH_PACK");a.wa=!0;a.T=!1;var b=X.Ua();A(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");N(a);return a};a.Ho=function(a){var b=c("POSTPROCESSING");J(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":y(b,"POST_EFFECT","POST_EFFECT_NONE");b.u[0]=1;b.u[1]=1;break;case "GRAYSCALE":y(b,
"POST_EFFECT","POST_EFFECT_GRAYSCALE");b.u[0]=1;b.u[1]=1;break;case "X_BLUR":y(b,"POST_EFFECT","POST_EFFECT_X_BLUR");b.u[0]=1;b.u[1]=0;break;case "Y_BLUR":y(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");b.u[0]=0;b.u[1]=1;break;case "X_EXTEND":y(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");b.u[0]=1;b.u[1]=0;break;case "Y_EXTEND":y(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");b.u[0]=0;b.u[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}b.wa=!0;b.T=!1;a=X.Ua();A(b,a);N(b);return b};a.zB=function(){var a=c("EDGE");
a.T=!1;a.wa=!0;a.u[0]=1;a.u[1]=1;var b=X.Ua();A(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");N(a);return a};a.pv=function(a){var b=c("SSAO");b.T=!1;b.wa=!0;b.u[0]=1;b.u[1]=1;var d=X.Ua();A(b,d);J(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");y(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.Cr);y(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:ea.vw(a)};d={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,
221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=w(a,d);Q(b,a,"u_ssao_special_tex");N(b);return b};a.qv=function(a){var b=c("SSAO_BLUR");b.T=!1;b.wa=!0;b.u[0]=1;b.u[1]=1;var d=X.Ua();A(b,d);J(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");y(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);N(b);return b};a.av=function(){var a=c("DOF");a.T=!1;a.wa=!0;a.u[0]=1;a.u[1]=1;var b=X.Ua();
A(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");y(a,"DEPTH_RGBA",1);N(a);return a};a.bv=function(){var a=c("GLOW");a.T=!1;a.wa=!0;a.u[0]=1;a.u[1]=1;var b=X.Ua();A(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");N(a);return a};a.cv=function(a,b,d){var e=c("GOD_RAYS");e.T=!1;e.wa=!0;e.u[0]=1;e.u[1]=1;var f=X.mw();A(e,f);J(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");y(e,"DEPTH_RGBA",a);y(e,"WATER_EFFECTS",b);y(e,"STEPS_PER_PASS",
ga.t(d,1));N(e);return e};a.dv=function(){var a=c("GOD_RAYS_COM");a.T=!1;a.wa=!0;a.u[0]=1;a.u[1]=1;var b=X.Ua();A(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");N(a);return a};a.mv=function(){var a=c("SKY");a.T=!1;a.wa=!0;a.u[0]=1;a.u[1]=1;var b=X.nw();A(a,b);J(a,"procedural_skydome.glslv","procedural_skydome.glslf");y(a,"WATER_EFFECTS",1);N(a);return a};a.Uu=function(){var a=c("ANTIALIASING");a.T=!1;a.wa=!0;a.u[0]=1;a.u[1]=1;a.nh=1/ca.resolution_factor;var b=
X.Ua();A(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");y(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");N(a);return a};a.nv=function(a){var b=c("SMAA"),d=X.Ua();A(b,d);J(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");y(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");y(b,"SMAA_PASS",a);y(b,"SMAA_PREDICATION",0);y(b,"SMAA_REPROJECTION",0);N(b);b.T=!1;b.wa=!0;b.u[0]=1;b.u[1]=1;b.nh=1/ca.resolution_factor;return b};a.ev=function(a){var b=c("LANCZOS");b.T=!1;b.wa=!0;b.nh=
1/ca.resolution_factor;"LANCZOS_X"==a?(b.u[0]=1,b.u[1]=0):"LANCZOS_Y"==a&&(b.u[0]=0,b.u[1]=1);a=X.Ua();A(b,a);J(b,"postprocessing/postprocessing.glslv","postprocessing/lanczos.glslf");N(b);return b};a.Yu=function(){var a=c("COMPOSITING");a.T=!1;a.wa=!0;a.u[0]=1;a.u[1]=1;var b=X.Ua();A(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");N(a);return a};a.hv=function(a){var b=c("MOTION_BLUR");b.wa=!0;b.T=!1;var d=X.Ua();A(b,d);J(b,"postprocessing/postprocessing.glslv",
"postprocessing/motion_blur.glslf");y(b,"BLUR_DECAY_THRESHOLD",ga.t(a));N(b);return b};a.Su=function(){var a=c("ANAGLYPH");a.wa=!0;a.T=!1;var b=X.Ua();A(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");N(a);return a};a.fv=function(){var a=c("LUMINANCE");a.T=!1;a.wa=!0;a.u[0]=1;a.u[1]=1;var b=X.Ua();A(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");N(a);return a};a.Vu=function(){var a=c("LUMINANCE");a.T=!1;a.wa=!0;a.u[0]=1;a.u[1]=1;var b=
X.Ua();A(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");N(a);return a};a.gv=function(){var a=c("LUMINANCE_X_BLUR");a.T=!1;a.wa=!0;a.u[0]=1;a.u[1]=1;var b=X.Ua();A(a,b);J(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");N(a);return a};a.Wu=function(a){var b=c("POSTPROCESSING");switch(a){case "X_BLUR":b.u[0]=1;b.u[1]=0;break;case "Y_BLUR":b.u[0]=0;b.u[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}b.wa=
!0;b.T=!1;a=X.Ua();A(b,a);J(b,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");N(b);return b};a.Xu=function(){var a=c("BLOOM");a.T=!1;a.wa=!0;a.u[0]=1;a.u[1]=1;var b=X.Ua();A(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");N(a);return a};a.tv=function(){var a=c("VELOCITY");a.T=!1;a.wa=!0;a.u[0]=1;a.u[1]=1;var b=X.Ua();A(a,b);J(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");N(a);return a};a.Tu=function(){var a=c("ANCHOR_VISIBILITY");
a.T=!0;a.wa=!0;a.u[0]=1;a.u[1]=1;a.Uc=V.vk;J(a,"anchors.glslv","anchors.glslf");var b=X.np(1);A(a,b);y(a,"ANCHOR_NUM",1);N(a);a.fi=new Float32Array(0);return a};a.Wz=function(a,b){var c=b.length/3;if(c!=a.fi.length/3){var d=X.np(c);A(a,d);y(a,"ANCHOR_NUM",c);N(a)}a.fi=b};a.si=function(a,b,c){var d=a.nh;a.Ym[0]=b*a.u[0]*d;a.Ym[1]=c*a.u[1]*d};a.Rf=function(a,b){a.nh=b};a.V=function(a,b,c){for(var d=0;d<a.n.length;d++)if(a.n[d].type==c&&!a.n[d].sc&&-1!=a.n[d].wc.indexOf(b))return a.n[d];return null};
a.Yb=function(a,b,c){for(var d=0;d<a.n.length;d++)if(a.n[d].type==c&&a.n[d].sc&&-1!=a.n[d].wc.indexOf(b))return a.n[d];return null};a.lr=function(a,b){a.lb.set(b.lb);a.je=b.je;a.fd.set(b.fd);a.Sb.set(b.Sb);a.Fd=b.Fd;a.wd=b.wd;a.ie=b.ie;a.$d=b.$d;a.Pf=b.Pf;a.Fc.set(b.Fc);a.Lf=b.Lf;a.shallow_water_col.set(b.shallow_water_col);a.shallow_water_col_fac=b.shallow_water_col_fac;a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.th=b.th};a.mB=
function(a,b){for(var c=a.n,d=0;d<c.length;d++)if(c[d].type==b)return!0;return!1};a.Ju=function(a){for(var b=a.L,c=0;c<b.length;c++)ea.Fv(b[c].Oa);V.vo(a.na)}};b4w.module.__nodemat=function(a,p){function c(a,c,e,g){if(c in W)return W[c];for(var h=R.create(),l=a.nodes,n=a.links,q=a.animation_data,p=0;p<l.length;p++)if(!B(h,l[p],0,q,g))return W[c]=null;if(e&&-1==v(a,h,"GROUP_OUTPUT","group"))return null;p=u(h);if(!P(h,n,p))return null;if(e)return h;for(p=0;p<n.length;p++)for(e=n[p],g=f(e.from_node,h),l=f(e.to_node,h),q=0;q<g.length;q++)for(var x=0;x<l.length;x++){for(var E=g[q],O=l[x],y=R.cb(h,E),z=R.cb(h,O),A=h,T=z,z=[],G=e.from_socket.identifier,H=e.to_socket.identifier,
D=y.Va,y=0;y<D.length;y++)if(D[y].identifier==G){z.push(y);break}T=T.H;for(y=0;y<T.length;y++)if(T[y].identifier==H){z.push(y);break}2==z.length&&R.de(A,E,O,z)}d(h);a=v(a,h,"OUTPUT","material");if(-1==a)return W[c]=null;k(h);h=R.Ir(h,a,R.tn);b(h);m(h);r(h);w(h);return W[c]=h}function b(a){R.P(a,function(b,c){for(var d=c.H,e=c.Va,f=0;f<d.length;f++)h(a,d[f],b,f,1);for(f=0;f<e.length;f++)h(a,e[f],b,f,0)})}function h(a,b,c,d,e){if(b.Nd){var f=!0;R.Ke(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&
g[1]==d)f=!1});f&&(b.Nd=!1)}}function d(a){var b=[];R.P(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":R.Ke(a,function(a,e,f){a==c&&"Translucency"==d.Va[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)R.de(a,b[c],b[c+1],b[c+2])}function f(a,b){var c=[];R.P(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function k(a){var b=[];R.P(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=
2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var f=g(a,d);if(-1!=f){var h=R.qj(a,f,0);R.Sg(a,f,d,-1);-1!=h&&R.Sg(a,h,f,-1);d=R.cb(a,f);e.data=d.data;e.Ka[0]=d.Ka[0];R.ni(a,f)}e.H.splice(1,1)}else if("REROUTE"==e.type){for(var e=R.qj(a,d,0),l=R.Qg(a,d),f=[],h=[],k=[],m=0;m<l;m++){var n=R.zg(a,d,m),q=h.indexOf(n);-1!=q?k[q]+=1:(h.push(n),k.push(1),f.push(d,n))}if(-1!=e)for(l=R.yg(a,e,d,0)[0],m=0;m<h.length;m++)for(n=0;n<k[m];n++)q=R.yg(a,d,h[m],n)[1],R.de(a,e,h[m],[l,q]);for(m=0;m<f.length;m+=
2)R.Sg(a,f[m],f[m+1],-1)}}}function g(a,b){for(var c=a.ha,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function m(a){var b=[];R.P(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var l=c[h];if(q(f,l.ya)){g=[];h=R.Qg(a,e);for(n=0;n<h;n++){var k=R.zg(a,e,n),m=R.yg(a,e,k,0);g.push(e,
k,m);R.de(a,l.id,k,m)}for(var n=0;n<g.length;n+=3)R.Sg(a,g[n],g[n+1],0);R.ni(a,e);g=!1;break}}g&&(l={id:e,ya:f},c.push(l))}}function l(a){for(var b={},c=0;c<a.Da.length;c+=2){var d=a.Da[c];b[d]=[]}for(c=0;c<a.ha.length;c+=3){var e=a.ha[c],f=a.ha[c+1];b[f].push(e);b[f].push(b[e])}for(d in b)b[d]=JSON.stringify(b[d]).match(/\d+/g)||[],b[d]=b[d].map(function(a){return parseInt(a)});return b}function r(a){var b=[];R.P(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=
l(a),d=[],e=0;e<b.length;e+=2){for(var f=b[e],g=b[e+1],h=!0,k=0;k<d.length;k++){var m=d[k];if(!(3<=m.Kg.length||!q(g,m.ya)||-1<c[f].indexOf(m.id)||-1<c[m.id].indexOf(f))){for(var n=!1,r=0;r<m.Kg.length;r++){var u=m.Kg[r].id;if(-1<c[f].indexOf(u)||-1<c[u].indexOf(f)){n=!0;break}}if(!n){k=[];n=R.Rp(a,f);h={};for(r=0;r<n;r++){var v=R.qj(a,f,r);v in h||(h[v]=0);u=R.yg(a,v,f,h[v]++);k.push(v,f,u)}for(var n=[],h=R.Qg(a,f),w={},r=0;r<h;r++)v=R.zg(a,f,r),v in w||(w[v]=0),u=R.yg(a,f,v,w[v]++),n.push(f,v,u);
h=k.concat(n);for(r=0;r<h.length;r+=3)R.Sg(a,h[r],h[r+1],0);R.ni(a,f);r={id:f,ya:g,Nv:k,Ov:n};m.Kg.push(r);h=!1;break}}}h&&(m={id:f,ya:g,Kg:[]},d.push(m))}for(e=0;e<d.length;e++){m=d[e];c=m.Kg.length;n=m.ya.H.length;h=m.ya.Va.length;for(k=0;k<c;k++){g=m.Kg[k];r=g.ya;f=g.Nv;g=g.Ov;m.ya.H=m.ya.H.concat(r.H);m.ya.Va=m.ya.Va.concat(r.Va);for(r=0;r<m.ya.H.length;r++)m.ya.H[r].identifier+=z.trunc(r/n)+1;for(r=0;r<m.ya.Va.length;r++)m.ya.Va[r].identifier+=z.trunc(r/h)+1;for(r=0;r<f.length;r+=3)v=f[r],u=
f[r+2],u[1]+=(k+1)*n,R.de(a,v,m.id,u);for(r=0;r<g.length;r+=3)v=g[r+1],u=g[r+2],u[0]+=(k+1)*h,R.de(a,m.id,v,u)}switch(c){case 1:m.ya.type+="2";break;case 2:m.ya.type+="3";break;case 3:m.ya.type+="4"}R.ni(a,m.id);R.Ek(a,m.id,m.ya)}}}function q(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==
b.data.value;default:return!1}}function w(a){var b=[];R.P(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],h=[],l=[[],[],[]],k=R.Qg(a,d),m=0;m<k;m++){var n=R.zg(a,d,m);if("SEPRGB"!=R.cb(a,n).type){f=!1;break}g.push(d,n);for(var q={},r=R.Qg(a,n),f=0;f<r;f++){var u=R.zg(a,n,f);u in q||(q[u]=0);var v=R.yg(a,n,u,q[u]++);g.push(n,u);l[v[0]].push(d,u,v)}h.push(n);f=!0}if(f){for(m=d=k=0;m<l.length;m++)l[m].length&&(k++,d|=1<<2-m);if(k){e.type+=
k;e.Va=[];for(m=0;m<l.length;m++)if(l[m].length)for(e.Va.push({Fb:0,identifier:"RGB"[m],Nd:!0,name:"RGB"[m]}),f=0;f<l[m].length;f+=3)l[m][f+2][0]=z.oi(d,m);for(m=0;m<g.length;m+=2)R.Sg(a,g[m],g[m+1],0);for(m=0;m<h.length;m++)R.ni(a,h[m]);for(m=0;m<l.length;m++)for(f=0;f<l[m].length;f+=3)R.de(a,l[m][f],l[m][f+1],l[m][f+2])}}}}function v(a,b,c,d){a=a.nodes;for(var e=null,g=0;g<a.length;g++){var h=a[g];h.type==c&&(e=h)}return e?f(e,b)[0]:(ha.error('No "'+c+'" node in node '+d),-1)}function E(a,b,c,d){return{name:a,
type:b,inputs:c,outputs:d}}function B(a,b,c,d,e){var f=b.name,g=b.type,h=[],l=[],k=[],m=[],q=null,r=[];switch(g){case "CAMERA":l=[];k=J(b);break;case "COMBRGB":case "COMBHSV":l=I(b);k=J(b);break;case "GEOMETRY":a:{for(var g=b.outputs,u=0;u<g.length;u++)if(g[u].is_linked){g=!0;break a}g=!1}if(!g)return!0;g=G(b,c);if(!g)return ha.error("Geometry output is not supported"),!1;switch(g){case "GEOMETRY_UV":if(!b.uv_layer)return ha.error('Missing uv layer in node "',b.name,'"'),!1;q=H("param_GEOMETRY_UV_a");
u=H("param_GEOMETRY_UV_v");h.push(Q(q));h.push(Q(u));k.push(D(b,"UV"));m.push(Q(u));q={name:q,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return ha.error("Missing vertex color layer in node ",b.name),!1;q=H("param_GEOMETRY_VC_a");u=H("param_GEOMETRY_VC_v");h.push(Q(q));h.push(Q(u));k.push(D(b,"Vertex Color"));m.push(Q(u));q={name:q,value:b.color_layer};break;case "GEOMETRY_NO":k.push(D(b,"Normal"));break;case "GEOMETRY_FB":k.push(D(b,"Front/Back"));break;case "GEOMETRY_VW":k.push(D(b,
"View"));break;case "GEOMETRY_GL":k.push(D(b,"Global"))}break;case "GROUP":u=b.node_tree_name;switch(u){case "B4W_LINEAR_TO_SRGB":if(!x(b,[1],[1])){q=n(b,e);break}g="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!x(b,[1],[1])){q=n(b,e);break}g="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!x(b,[1],[1])){q=n(b,e);break}g="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!x(b,[1,1],[1])){q=n(b,e);break}g="B4W_REFLECT";break;case "B4W_REFRACTION":if(!x(b,[1,0],[1])){q=
n(b,e);break}g="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!x(b,[1,1,0,0,0],[1])){q=n(b,e);break}var g="B4W_PARALLAX",v=H("temp_texture");m.push(Q(v));break;case "B4W_CLAMP":if(!x(b,[1],[1])){q=n(b,e);break}g="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!x(b,[0,0,0,0,0],[0])){q=n(b,e);break}g="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!x(b,[],[0])){q=n(b,e);break}g="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!x(b,[0,0,0],[0])){q=n(b,e);break}g="B4W_SMOOTHSTEP";break;default:q=n(b,e)}l=I(b);k=J(b);
"B4W_TRANSLUCENCY"==u&&(u=C("TranslucencyParams","TranslucencyParams",[0,0,0,0]),u.Nd=k[0].Nd,k.push(u));break;case "LAMP":q=b.lamp;if(!q)return ha.error("There is no lamp in node: "+b.name),!1;k.push(D(b,"Color"));k.push(D(b,"Light Vector"));k.push(D(b,"Distance"));k.push(D(b,"Visibility Factor"));q.uuid in ma?m.push(Q(H("param_LAMP_lamp_index"),ma[q.uuid],1)):(ma[q.uuid]=oa,m.push(Q(H("param_LAMP_lamp_index"),oa++,1)));q=ma;break;case "NORMAL":l=I(b);k=J(b);u=D(b,"Normal");m.push(Q(H("param_NORMAL_Normal"),
u.Fb,3));break;case "MAPPING":u=b.vector_type;g="MAPPING";l.push(A(b,"Vector"));k.push(D(b,"Vector"));var v=b.rotation,w=b.scale,p=b.translation,E=ea.create(),T=z.Qv(v),W=new Float32Array([w[0],0,0,0,w[1],0,0,0,w[2]]);ea.multiply(T,W,E);E=z.Jx(E,O.create());switch(u){case "POINT":E[12]=p[0];E[13]=p[1];E[14]=p[2];break;case "TEXTURE":E[12]=p[0];E[13]=p[1];E[14]=p[2];E=O.invert(E,E);break;case "NORMAL":O.invert(E,E),O.transpose(E,E)}switch(u){case "NORMAL":r.push(["MAPPING_IS_NORMAL",1]);case "TEXTURE":r.push(["MAPPING_TRS_MATRIX",
X.t(E,16)]);break;case "POINT":0!==ga.length(v)?r.push(["MAPPING_TRS_MATRIX",X.t(E,16)]):(0!==ga.length(w)&&r.push(["MAPPING_SCALE",X.t(w,3)]),0!==ga.length(p)&&r.push(["MAPPING_TRANSLATION",X.t(p,3)]));break;case "VECTOR":0!==ga.length(v)?r.push(["MAPPING_TRS_MATRIX",X.t(E,16)]):0!==ga.length(w)&&r.push(["MAPPING_SCALE",X.t(w,3)])}b.use_min&&r.push(["MAPPING_MIN_CLIP",X.t(b.min,3)]);b.use_max&&r.push(["MAPPING_MAX_CLIP",X.t(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":q=A(b,"Color");q.Fb.splice(3);
l.push(q);(q=A(b,"Alpha"))?l.push(q):l.push(C("Alpha","Alpha",1));q=A(b,"Spec");q.Fb.splice(3);l.push(q);u=A(b,"Normal");u.Fb.splice(3);l.push(u);k.push(D(b,"Color"));k.push(D(b,"Alpha"));k.push(D(b,"Normal"));"MATERIAL_EXT"==g&&((q=A(b,"Emit"))?l.push(q):l.push(C("Emit","Emit",0)),q=A(b,"Translucency"),q.Fb=0,q.name="Translucency",q.identifier="Translucency",q?l.push(q):l.push(C(q.name,q.identifier,q.Fb)),q=A(b,"Translucency"),q.Fb=[0,0,0,0],q.name="TranslucencyParams",q.identifier="TranslucencyParams",
q?l.push(q):l.push(C(q.name,q.identifier,q.Fb)),q=A(b,"Reflectivity"),v=A(b,"Ray Mirror"),q?v="Reflectivity":v?(q=v,v="Ray Mirror"):v="Reflectivity",q?l.push(q):l.push(C(v,v,0)),(q=A(b,"SpecTra"))?l.push(q):l.push(C("SpecTra","SpecTra",0)),k.push(D(b,"Diffuse")),k.push(D(b,"Spec")));v=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":q=b.specular_hardness;break;case "WARDISO":q=b.specular_slope;break;case "TOON":q=b.specular_toon_size;v=b.specular_toon_smooth;break;default:ha.error("unsupported specular shader: "+
b.specular_shader+' (material "'+b.material_name+'")'),q=b.specular_hardness}switch(b.diffuse_shader){case "LAMBERT":p=w=0;break;case "OREN_NAYAR":w=b.roughness;p=0;break;case "FRESNEL":w=b.diffuse_fresnel;p=b.diffuse_fresnel_factor;break;default:ha.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),p=w=0}m.push(Q(H("param_MATERIAL_diffuse"),[w,p],2));m.push(Q(H("param_MATERIAL_spec"),[b.specular_intensity,q,v],3));q={name:b.name,value:{uz:b.specular_shader,
Hv:b.diffuse_shader,Yf:b.use_shadeless,$g:b.specular_alpha}};u.Nd&&r.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&r.push(["USE_MATERIAL_DIFFUSE",1]);b.use_specular&&r.push(["USE_MATERIAL_SPECULAR",1]);break;case "MATH":switch(b.operation){case "ADD":g="MATH_ADD";break;case "SUBTRACT":g="MATH_SUBTRACT";break;case "MULTIPLY":g="MATH_MULTIPLY";break;case "DIVIDE":g="MATH_DIVIDE";break;case "SINE":g="MATH_SINE";break;case "COSINE":g="MATH_COSINE";break;case "TANGENT":g="MATH_TANGENT";break;case "ARCSINE":g=
"MATH_ARCSINE";break;case "ARCCOSINE":g="MATH_ARCCOSINE";break;case "ARCTANGENT":g="MATH_ARCTANGENT";break;case "POWER":g="MATH_POWER";break;case "LOGARITHM":g="MATH_LOGARITHM";break;case "MINIMUM":g="MATH_MINIMUM";break;case "MAXIMUM":g="MATH_MAXIMUM";break;case "ROUND":g="MATH_ROUND";break;case "LESS_THAN":g="MATH_LESS_THAN";break;case "GREATER_THAN":g="MATH_GREATER_THAN";break;case "MODULO":g="MATH_MODULO";break;case "ABSOLUTE":g="MATH_ABSOLUTE";break;default:return ha.error("Unsupported MATH operation: "+
b.operation),!1}r.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);l=I(b);k=J(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":g="MIX_RGB_MIX";break;case "ADD":g="MIX_RGB_ADD";break;case "MULTIPLY":g="MIX_RGB_MULTIPLY";break;case "SUBTRACT":g="MIX_RGB_SUBTRACT";break;case "SCREEN":g="MIX_RGB_SCREEN";break;case "DIVIDE":g="MIX_RGB_DIVIDE";break;case "DIFFERENCE":g="MIX_RGB_DIFFERENCE";break;case "DARKEN":g="MIX_RGB_DARKEN";break;case "LIGHTEN":g="MIX_RGB_LIGHTEN";break;case "OVERLAY":g="MIX_RGB_OVERLAY";
break;case "DODGE":g="MIX_RGB_DODGE";break;case "BURN":g="MIX_RGB_BURN";break;case "HUE":g="MIX_RGB_HUE";break;case "SATURATION":g="MIX_RGB_SATURATION";break;case "VALUE":g="MIX_RGB_VALUE";break;case "COLOR":g="MIX_RGB_COLOR";break;case "SOFT_LIGHT":g="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":g="MIX_RGB_LINEAR_LIGHT";break;default:return ha.error("Unsupported MIX_RGB blend type: "+b.blend_type),!1}r.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);l=I(b);k=J(b);break;case "OUTPUT":l=I(b);k=[];
break;case "RGB":u=e+"%join%"+b.name;u={name:"-1",value:u};m.push(u);k.push(D(b,"Color"));break;case "SEPRGB":case "SEPHSV":l=I(b);k=J(b);break;case "TEXTURE":g=y(b);if("TEXTURE_EMPTY"==g)k.push(D(b,"Color")),k.push(D(b,"Normal")),k.push(D(b,"Value"));else{l.push(A(b,"Vector"));if("TEXTURE_COLOR"==g||"TEXTURE_ENVIRONMENT"==g)k.push(D(b,"Color")),k.push(D(b,"Value"));if("TEXTURE_NORMAL"==g){if("ENVIRONMENT_MAP"==b.texture.type)return ha.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),!1;
k.push(D(b,"Normal"));k.push(D(b,"Value"))}v=H("param_TEXTURE_texture");m.push(Q(v));q={name:v,value:b.texture}}break;case "VALUE":g="VALUE";u=e+"%join%"+b.name;u={name:"-1",value:u};m.push(u);k.push(D(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":g="VECT_MATH_ADD";break;case "SUBTRACT":g="VECT_MATH_SUBTRACT";break;case "AVERAGE":g="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":g="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":g="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":g=
"VECT_MATH_NORMALIZE";break;default:return ha.error("Unsupported VECT_MATH operation: "+b.operation),!1}l=I(b);k=J(b);break;default:l=I(b),k=J(b)}f={name:f,type:g,Ci:h,H:l,Va:k,Ka:m,data:q,df:r};R.Ek(a,R.lp(a),f);if(f="GEOMETRY"==b.type)a:{f=b.outputs;for(l=h=0;l<f.length;l++)if(f[l].is_linked&&h++>c){f=!0;break a}f=!1}return f&&!B(a,b,++c,d,e)?!1:!0}function x(a,b,c){for(var d=a.inputs,e=a.outputs,f=a.node_tree_name,g=0;g<b.length;g++){var h=d[g],l=b[g];if(!h||h.default_value instanceof Array!=l)return ha.warn('Wrong inputs for custom node group "'+
a.name+'" of type: "',f,'".Processing as general node group.'),!1}for(g=0;g<c.length;g++)if(b=e[g],d=c[g],!b||b.default_value instanceof Array!=d)return ha.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1;return!0}function n(a,b){var d=a.node_group.node_tree,f={},g;for(g in d)if("links"==g||"nodes"==g){f[g]=[];for(var h=0;h<d[g].length;h++){f[g][h]={};for(var l in d[g][h])if("links"==g){f[g][h][l]={};for(var k in d[g][h][l])f[g][h][l][k]=
e(d[g][h][l][k])}else f[g][h][l]=e(d[g][h][l])}}else f[g]=e(d[g]);d=a.node_tree_name;if("B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d)g=E("Group input","GROUP_INPUT",[],a.inputs),h=E("Group output","GROUP_OUTPUT",a.outputs,[]),l=null,l="B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d&&(ca.quality==pa.P_LOW||ca.xl)?{from_node:g,from_socket:g.outputs[1],to_node:h,to_socket:h.inputs[0]}:{from_node:g,from_socket:g.outputs[0],to_node:h,to_socket:h.inputs[0]},f.nodes=[g,h],f.links=[l];d=a.name;g=f.nodes;h=f.links;
for(l=0;l<g.length;l++)g[l].name=N(g[l].type,d,g[l].name);for(l=0;l<h.length;l++)h[l].from_node.name=N(h[l].from_node.type,d,h[l].from_node.name),h[l].to_node.name=N(h[l].to_node.type,d,h[l].to_node.name);return{Tx:c(f,a.node_group.uuid,!0,b),Ux:f.links}}function e(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?z.bj(a):a}function H(a){T[a]||(T[a]=0);var b=a+T[a],b=b.replace(/ /g,"_").replace(/\//g,"_");T[a]++;return b}function G(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=
c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";default:return null}}}function y(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,e=!1,f=0;f<b.length;f++){var g=b[f];if(g.is_linked)switch(g.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":e=!0;break;
default:throw"Unknown texture output";}}if(c)return d&&ha.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(e)return"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function A(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return L(e)}return null}function D(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];
if(e.identifier==b)return L(e)}return null}function L(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=z.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,Nd:d,Fb:a}}function C(a,b,c){return{name:a,identifier:b,Nd:!1,Fb:c}}function I(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=L(a.inputs[c]);d.Fb.length&&d.Fb.splice(3);b.push(d)}return b}function J(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=L(a.outputs[c]);b.push(d)}return b}function Q(a,b,c){b=null===b||void 0===b?
null:X.t(b,c);return{name:a,value:b}}function N(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function u(a){var b=[];R.P(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function P(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.Tx,f=c[d].data.Ux;if(!e)return!1;R.P(e,function(b,c){R.Ek(a,R.lp(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);Y(c[d],b,a)}return!0}function S(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+
"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function Z(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=c[e],g=null,h=0;h<b.length;h++)if(f.from_socket.identifier==b[h].to_socket.identifier){g=b[h];break}g?(f.from_node=g.from_node,f.from_socket=g.from_socket):d.push(f)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function V(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function fa(a,b,c,
d){for(var e=0;e<d.length;e++){for(var g=d[e],h,l=0;l<c.H.length;l++)if(g.from_socket.identifier==c.H[l].identifier){h=c.H[l].Fb;break}for(var l=g,k=b,m=h,n=f(l.to_node,k),q=0;q<n.length;q++)for(var r=R.cb(k,n[q]),u=0;u<r.H.length;u++)if(r.H[u].identifier==l.to_socket.identifier){r.H[u].Fb=m;break}g=a.indexOf(g);-1!=g&&a.splice(g,1)}}function Y(a,b,c){for(var d=a.name,e=[],f=[],g=[],h=[],l=0;l<b.length;l++){var k=b[l];S(k.from_node,d,k,e,g,h);S(k.to_node,d,k,f,g,h)}f=Z(b,f,g);e=Z(b,h,e);V(b,f);fa(b,
c,a,f);if(e.length){var m;R.P(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(m=b)});fa(b,c,m,e)}}var ha=p("__print"),R=p("__graph"),X=p("__shaders"),z=p("__util"),pa=p("__config"),ga=p("vec3");p("vec4");var ea=p("mat3"),O=p("mat4"),T={},W={},ma={},oa=0;new Float32Array(4);var ca=pa.q;a.Ku=c;a.Lu=function(a){var b=[],c={};T={};var d=R.$m(a);R.P(d,function(a,d){var e;e=[];for(var f=[],g=[],h=[],l=[],k=[],m=0;m<d.H.length;m++){var n=d.H[m];if(n.Nd)e.push(null),f.push(null);else{e.push(H("in_"+
d.type+"_"+n.identifier));var q=X.t(n.Fb,0);ca.rr&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==n.identifier||"Color2"==n.identifier||"Fac"==n.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==n.identifier||"Value_001"==n.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==n.identifier)&&(n=q,n=n.replace(/(,)/g,"$1 "),n=n.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),n=n.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),q=n=n.replace(/\s+/g,""));f.push(q)}}for(m=
0;m<d.Va.length;m++)n=d.Va[m],n.Nd?g.push(null):g.push(H("out_"+d.type+"_"+n.identifier));for(m=0;m<d.Ka.length;m++)n=d.Ka[m],h.push(n.name),l.push(n.value);for(m=0;m<d.Ci.length;m++)k.push(d.Ci[m].name);e={id:d.type,H:e,Rl:f,Va:g,Ka:h,Uj:l,Ci:k,df:JSON.parse(JSON.stringify(d.df))};b.push(e);c[a]=e});R.Ke(d,function(a,b,e){var f=R.cb(d,a);R.cb(d,b);var g=f.Va[e[0]];a=c[a].Va;b=c[b].H;f=a[e[0]]||H("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.cleanup=function(){for(var a in W)delete W[a];
for(var b in ma)delete ma[b];oa=0}};b4w.module.__animation=function(a,p){function c(a,b){var c=a.w[b];c&&c.ul&&c.Lh&&(c.Lh=!1,c.ul(a))}function b(a,b,c){c=a.w[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.Xb=d;c.ce=b.name;for(e=d=0;e<a.data.b4w_vertex_anim.length;e++){var f=a.data.b4w_vertex_anim[e];if(f==b)break;else d+=f.frame_end-f.frame_start+1}c.es=d}function h(a,b,c){a=a.w[c];a.type=50;a.ce=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);
a.cc=b}function d(a){return a.replace(/_B4W_BAKED$/,"")}function f(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:R.la("Wrong animation behavior")}}function k(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&g(d,b)}return b}function g(a,b){if(a.animation_data){var c=a.animation_data.action;c&&R.Kd(c.fcurves)&&b.push(c)}for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];e.node_group&&(e=e.node_group.node_tree)&&
g(e,b)}}function m(a){return R.is_mesh(a)&&a.d.sk?!0:!1}function l(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}function r(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function q(a,b,d){H(a,b,d);c(a,d);a.d.be&&(A(a,b),y(a,b))}function w(a,b,c){var d=b.frame_range,f=b.d,g=a.w[c];g.ce=b.name;g.Gn=d;g.Jt=f.cy;g.Ht=f.lu;g.start=d[0];g.length=d[1]-d[0];g.Xb=d[0];d=R.Kd(f.Wi);if(R.rf(a)&&d){g.type=10;var h=v(a,b);h||
(h=D(a,b,x(a)),a.ud.push(b,h));g.g=h.g;g.qa=h.qa;var g=a.d,h=g.fk,l=a.w[c],f=l.Km,k;a:{k=g.tr;for(var m=0;m<k.length;m+=2)if(b==k[m]){k=k[m+1];break a}k=null}if(k)l.Km=k;else{for(l=0;l<h.length;l++)k=D(a,b,h[l].qc),f.push(k);g.tr.push(b,f)}g.be&&(b=g.mk,c>b[1]?(g=b[1],b[1]=c,b[0]=g):c>b[0]&&c<b[1]&&(b[0]=c),E(a))}else if(fa.Od(a)&&(f.Ka.volume||f.Ka.pitch))g.volume=f.Ka.volume||null,g.pitch=f.Ka.pitch||null,g.type=40;else if("MESH"==a.type&&e(b)){g.type=60;f=v(a,b);if(!f){f=[];l=[];k=[];var m=[],
q=b.d,r=a.d.Jj,u=a.d.Kj;for(h in q.Ka){var w=b.name+"%join%"+h;n(h,w,q,l,f,r);n(h,w,q,m,k,u)}f={sA:f,values:l,Ay:k,By:m};a.ud.push(b,f)}g.rq=f.sA;g.tq=f.values;g.qq=f.Ay;g.sq=f.By}else if(h=f.Ka.tsr){g.type=20;f=v(a,b);if(!f){f=b.d.wq;l=[];k=[];for(m=0;m<f;m++)l.push(h.subarray(8*m,8*m+4)),k.push(h.subarray(8*m+4,8*m+8));f={g:l,qa:k};a.ud.push(b,f)}g.g=f.g;g.qa=f.qa;S.Dg(a)&&S.lA(a,g.g,g.qa)}else return V.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;R.rf(a)&&
!d&&B(a,c);return!0}function v(a,b){for(var c=a.ud,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function E(a){var b=a.d.mk;if(-1!=b[0]&&-1!=b[1]){var c=a.w;a=c[b[1]].Xb;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.Xb;d=Math.floor(a);b.Xb=d+e}}function B(a,b){var c=a.d.mk,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.w;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function x(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var e=b[d].name;
c[e]={eo:d,Hh:d,ym:R.Gl(a,"name",e),gs:-1}}return c}function n(a,b,c,d,e,f){for(var g=0;g<f.length;g+=2)if(b==f[g]){e.push(f[g+1]);d.push(new Float32Array(c.Ka[a]));break}}function e(a){a=a.d;for(var b in a.Ka)if(-1!=b.indexOf("nodes"))return!0;return!1}function H(a,b,c){if((c=a.w[c])&&null!=c.type&&(c.play||0==b)){var d=a.d,e=c.Xb,f=c.start,g=c.length,e=e+c.speed*b*ga.Ea,h=c.type,l=c.speed;if(0<=l&&e>=f+g||0>l&&e<f)switch(c.Lh=!0,c.behavior){case 10:e=0<=l?(e-f)%g+f:f+g-1E-6;break;case 20:e=0<=l?
f:f+g-1E-6;c.play=!1;break;case 30:e=0<=l?f+g-1E-6:f,c.play=!1}c.Xb=e;switch(h){case 10:if(!d.be){e=G(c,e,ea);b=e[0];f=e[1];e=e[2];d.ec=c.qa[b];d.dc=c.qa[f];d.mc=c.g[b];d.lc=c.g[f];d.jf=e;d=d.fk;c=c.Km;for(g=0;g<d.length;g++)h=d[g],l=c[g],h.ec=l.qa[b],h.dc=l.qa[f],h.mc=l.g[b],h.lc=l.g[f],h.jf=e;Y.C(a)}break;case 20:h=e=G(c,e,ea);(d=O)||(d=new Float32Array(4));var f=h[0],g=h[1],h=h[2],l=c.g,k=l[f][1],m=l[f][2],n=l[g][1],q=l[g][2];d[0]=(1-h)*l[f][0]+h*l[g][0];d[1]=(1-h)*k+h*n;d[2]=(1-h)*m+h*q;f=e;(g=
W)||(g=new Float32Array(4));h=c.qa;z.slerp(h[f[0]].subarray(0,4),h[f[1]].subarray(0,4),f[2],g);f=g;g=e[2];h=c.g;e=(1-g)*h[e[0]][3]+g*h[e[1]][3];c.an&&(g=T,Y.get_translation(a,g),R.smooth_v(d,g,b,c.an,d));c.Bm&&(g=ma,Y.get_rotation(a,g),R.wr(f,g,b,c.Bm,f));Y.set_translation(a,d);Y.set_rotation(a,f);Y.set_scale(a,e);Y.C(a);Z.sync_transform(a);break;case 30:(a=ea)||(a=Array(3));f=e-c.start;0>f&&(f=0);f>=c.length&&(f=c.length);b=Math.floor(f);e=b+1;f-=b;10!=c.behavior&&e==c.length&&(e=--b,f=1);c=c.es;
a[0]=b+c;a[1]=e+c;a[2]=f;e=ea;d.fn=e[0];d.ds=e[2];break;case 40:e=G(c,e,ea);b=e[0];d=e[1];e=e[2];c.volume&&fa.set_volume(a,(1-e)*c.volume[b]+e*c.volume[d]);c.pitch&&fa.playrate(a,(1-e)*c.pitch[b]+e*c.pitch[d]);break;case 50:S.$y(c.cc,e/ga.Ea);break;case 60:e=G(c,e,ea);b=e[0];d=e[1];e=e[2];l=c.tq;k=c.rq;f=c.sq;c=c.qq;for(g=0;g<k.length;g++)m=l[g],h=k[g],a.d.Qd[h]=(1-e)*m[b]+e*m[d];for(g=0;g<c.length;g++)l=f[g],h=c[g],l=pa.lerp(l.subarray(3*b,3*b+3),l.subarray(3*d,3*d+3),e,O),a.d.ac[h]=l[0],a.d.ac[h+
1]=l[1],a.d.ac[h+2]=l[2];break;default:R.la("Unknown animation type:"+h)}}}function G(a,b,c){c||(c=Array(3));var d=a.Gn[0],e=a.Gn[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.Jt;e=Math.floor(b);a=a.Ht[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function y(a,b){var c=a.d,d=c.ae,e=c.mk,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var g=a.w[f];if(g.play||0==b)var h=G(g,g.Xb,ea),l=h[0],k=h[1],h=h[2],m=g.qa[l],n=g.qa[k],l=g.g[l],k=g.g[k];else d=1}else d=1;e=a.w[e];if(e.play||0==b)var h=G(e,e.Xb,ea),q=h[0],r=h[1],h=h[2];else if(-1!=
f&&g.play)d=0;else return;f=e.qa[q];g=e.qa[r];q=e.g[q];e=e.g[r];if(1==d)c.ec.set(f),c.dc.set(g),c.mc.set(q),c.lc.set(e);else if(0==d)c.ec.set(m),c.dc.set(n),c.mc.set(l),c.lc.set(k);else{for(r=0;r<m.length;r+=4){for(var u=W,v=ma,w=0;4>w;w++)u[w]=m[r+w],v[w]=f[r+w];z.slerp(u,v,d,u);for(w=0;4>w;w++)c.ec[r+w]=u[w];for(w=0;4>w;w++)u[w]=n[r+w],v[w]=g[r+w];z.slerp(u,v,d,u);for(w=0;4>w;w++)c.dc[r+w]=u[w]}R.$n(l,q,d,c.mc);R.$n(k,e,d,c.lc)}Y.C(a);d=c.fk;m=c.oq;for(r=0;r<d.length;r++){n=d[r];l=m[r];for(k=0;k<
l.length;k+=2)for(q=l[k],f=l[k+1],g=0;4>g;g++)n.ec[q+g]=c.ec[f+g],n.dc[q+g]=c.dc[f+g],n.mc[q+g]=c.mc[f+g],n.lc[q+g]=c.lc[f+g];n.jf=h}}}function A(a,b){var c=a.d,d=c.ae,e=c.Dk;if(0!=e){var d=c.Ck-d,f=e*b;R.sign(d)==R.sign(e)&&Math.abs(f)<Math.abs(d)?c.ae+=f:(c.ae=c.Ck,c.Dk=0)}}function D(a,b,c){for(var d=a.pose.bones,e=[],f=[],g=b.d.wq,h=0;h<g;h++){for(var l=0;l<d.length;l++){var k=d[l],m=ha.create(),n=b.d.Wi[k.name];n&&ha.copy(n.subarray(8*h,8*h+8),m);k.En=m;k.Mi=!1}l=L(a,c);e.push(l.g);f.push(l.qa)}return{g:e,
qa:f}}function L(a,b){var c=[],d=[],e=a.pose.bones,f=new Float32Array(4),g=new Float32Array(4),h;for(h in b){var l=b[h],k=l.Hh,m=e[l.ym],l=f,n=g,q=m.At,r=q[q.length-1],u=r.yk;r.Mi||ha.identity(u);for(r=q.length-1;0<=r;r--){var m=q[r],v=m.yk;if(m.Mi)u=v;else{var w=m.Fn,p=m.En;ha.invert(w,oa);ha.multiply(p,oa,oa);ha.multiply(w,oa,oa);ha.multiply(u,oa,v);u=v;m.Mi=!0}}m=m.yk;l[0]=m[0];l[1]=m[1];l[2]=m[2];l[3]=m[3];n[0]=m[4];n[1]=m[5];n[2]=m[6];n[3]=m[7];z.normalize(n,n);for(l=0;4>l;l++)n=4*k+l,c[n]=f[l],
d[n]=g[l]}c=new Float32Array(c);d=new Float32Array(d);return{g:c,qa:d}}function C(a,b,c,d,e,f,g){var h=a+(b-a)/2,l=I(h,d,e,f,g)-c;return.02>Math.abs(l)?h:0<l?C(a,h,c,d,e,f,g):C(h,b,c,d,e,f,g)}function I(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function J(a,b){if(!a.w.length)for(var c=0;8>c;c++)a.w.push(null);a.w[b]={type:null,ce:null,qa:null,g:null,Km:[],play:!1,behavior:20,Xb:0,start:0,length:0,an:0,Bm:0,Lh:!1,es:null,speed:1,volume:null,pitch:null,tq:[],rq:[],sq:[],qq:[]};
a.ud=a.ud||[];-1==ca.indexOf(a)&&ca.push(a)}function Q(a,b){Y.C(a);Z.sync_transform(a);q(a,0,b)}function N(a,c,d){d=d||0;if(R.is_mesh(a)){var e=R.keysearch("name",c,a.data.b4w_vertex_anim);if(e)return J(a,d),b(a,e,d),Q(a,d),!0;if((e=R.keysearch("name",c,a.particle_systems))&&"EMITTER"==e.settings.type)return J(a,d),h(a,e,d),Q(a,d),!0}if(e=R.keysearch("name",c,ia)||R.keysearch("name",c+"_B4W_BAKED",ia)){J(a,d);if(w(a,e,d))return Q(a,d),!0;a.w[d]=null}V.error('Unsupported object: "',a.name,'" or animation name: "',
c,'"');return!1}function u(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&d.animation_data)return!0}return!1}var P=p("__config"),S=p("__particles"),Z=p("__physics"),V=p("__print");p("__scenes");var fa=p("__sfx"),Y=p("__transform"),ha=p("__tsr"),R=p("__util"),X=p("__reformer");p("mat4");var z=p("quat");p("vec4");var pa=p("vec3"),ga=P.xd;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=
30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=60;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var ea=Array(3),O=new Float32Array(3),T=new Float32Array(3),W=new Float32Array(4),ma=new Float32Array(4),oa=new Float32Array(8);new Float32Array(16);var ca=[],ia=[];a.frame_to_sec=function(a){return a/ga.Ea};a.update=function(a){for(var b=0;b<ca.length;b++){for(var d=
ca[b],e=0;8>e;e++)H(d,a,e);d.d.be&&(A(d,a),y(d,a))}for(b=0;b<ca.length;b++)for(d=ca[b],e=0;8>e&&d.w.length;e++)c(d,e)};a.xw=function(){return ia};a.Iw=function(a,b){var c=a.w[b];return c&&c.ce?d(c.ce):null};a.get_anim_names=function(a){var b=[];if(m(a))for(var c=0;c<a.data.b4w_vertex_anim.length;c++)b.push(a.data.b4w_vertex_anim[c].name);var f,c=[];for(f=0;f<ia.length;f++){var g=ia[f],h=g.d;R.Kd(g.d.Wi)?"ARMATURE"==a.type&&c.push(g):h.Ka.volume||h.Ka.pitch?fa.Od(a)&&c.push(g):!e(g)&&g.fcurves.length&&
c.push(g)}"MESH"==a.type&&(c=c.concat(k(a)));f=c;for(c=0;c<f.length;c++)b.push(d(f[c].name));if(S.Dg(a)&&S.Ml(a))for(c=0;c<a.particle_systems.length;c++)b.push(a.particle_systems[c].name);return b};a.Cz=d;a.get_anim_type=function(a,b){var c=a.w[b];return c?c.type:null};a.apply_def=function(a){var c=0,d,e=[];if((d=a.animation_data)&&d.action&&(d=d.action,R.Kd(d.fcurves))){var g=R.Kd(d.d.Wi);"ARMATURE"!=a.type&&g||e.push(d)}fa.Od(a)&&a.data.animation_data&&a.data.animation_data.action&&e.push(a.data.animation_data.action);
"MESH"==a.type&&(e=e.concat(k(a)));d=e;for(e=0;e<d.length;e++)g=d[e],J(a,c),w(a,g,c)?(Q(a,c),a.w[c].behavior=f(a.b4w_anim_behavior),c++):a.w[c]=null;d=a.particle_systems;for(e=0;e<d.length;e++){var g=d[e],l=g.settings;"EMITTER"==l.type&&(J(a,c),h(a,g,c),Q(a,c),a.w[c].behavior=f(a.b4w_anim_behavior),l.b4w_cyclic&&(a.w[c].behavior=10),c++)}m(a)&&(J(a,c),b(a,a.data.b4w_vertex_anim[0],c),Q(a,c),a.w[c].behavior=f(a.b4w_anim_behavior))};a.get_first_armature_object=l;a.play=function(a,b,c){r(a.w,c,function(a){a.play=
!0;a.ul=b?b:null;a.Lh=!1});a.d.be&&E(a)};a.stop=function(a,b){r(a.w,b,function(a){a.play=!1;a.ul=null;a.Lh=!1})};a.is_play=function(a,b){var c=a.w[b];return c?c.play:!1};a.set_current_frame_float=function(a,b,c){var d=a.w;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.Xb=b,q(a,0,c))}else if(e=d[c])e.Xb=b,q(a,0,c)};a.get_current_frame_float=function(a,b){var c=a.w[b];return c&&c.Xb?c.Xb:0};a.is_cyclic=function(a,b){var c=a.w[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){r(a.w,c,function(a){a.behavior=
b})};a.get_behavior=function(a,b){var c=a.w[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){r(a.w,d,function(a){a.an=b||0;a.Bm=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.w[c]=null;else a.w[b]=null;a.d.be&&B(a,b)};a.update_object_animation=q;a.Bj=function(a){if("ARMATURE"==a.type||l(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||S.Dg(a)&&S.Ml(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||
u(a)?!0:!1};a.is_animated=function(a){return Boolean(a.w.length)};a.su=x;a.io=L;a.Lt=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);z.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):-1<a.indexOf("scale")?(d=3,e=0):(d=0,e=b);return d+e}function d(a,b,c,e,h){if(-1<c.search(f)){a=b;c=c.split('"')[1];var l=g}else 8==h?(c="tsr",l=g):l=1<h?new Float32Array(h):0;if(!a[c]){h=a;b=c;if("object"==
typeof l&&l.length)for(var k=l.length,m=new Float32Array(e*k),n=0;n<e;n++)for(var q=0;q<k;q++)m[n*k+q]=l[q];else if("number"==typeof l)for(m=new Float32Array(e),n=0;n<e;n++)m[n]=l;else R.la("Wrong storage default value");h[b]=m}return a[c]}a.d={};var e=a.d;e.cy=1/ga.kf;var f=new RegExp(/pose.bones\[\".+\"\]/g),g=ha.create(),h=a.fcurves,l={},k={},m=0,n;for(n in h){var q=h[n],r;for(r in q){var u=q[r],v=u.Ub;X.yu(u,a);u=u.num_channels;m||(m=v.length);for(var u=d(l,k,n,m,u),w=u.length/m,p=c(n,r|0),E=
0;E<m;E++)u[E*w+p]=v[E]}}for(var x in l)"tsr"==x&&b(l[x],m);for(var O in k)b(k[O],m);e.Ka=l;e.Wi=k;e.lu=a.zt;e.wq=m;ia.push(a)};a.Bw=function(a,b){return(b-a)*ga.kf+1};a.cu=function(a,b,c,d,e,f){var g,h,l=new Float32Array(2),k=new Float32Array(2),m=new Float32Array(2),n=new Float32Array(2),q=b[1],r=b[2],u=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var v=0,w=0,p=null;e<=f;e++)if(e<q)for(var E=0;E<ga.kf;E++)c[v++]=r;else if(e>u)for(E=0;E<ga.kf;E++)c[v++]=a;else{var x=b[w],O=3;0===x&&(O+=
2);0===p&&(O+=2);var y=2===x?0:1;if(b[w+1]==b[w+O+1])p=x,w+=O;else{E=0;e==b[w+1]&&(y&&(d[v]=1),c[v]=b[w+2],v++,E++);if(e==u)for(;E<ga.kf;E++)c[v++]=a;else for(l[0]=b[w+1],l[1]=b[w+2],0!==x?(k[0]=0,k[1]=0):0===p?(k[0]=b[w+5],k[1]=b[w+6]):(k[0]=b[w+3],k[1]=b[w+4]),0!==x?(m[0]=0,m[1]=0):(m[0]=b[w+O+3],m[1]=b[w+O+4]),n[0]=b[w+O+1],n[1]=b[w+O+2];E<ga.kf;E++){var B=e+E/ga.kf;switch(x){case 0:g=l;h=k;var z=m,T=n,A=[],W=[],G=void 0,H=void 0,D=void 0,G=void 0;A[0]=g[0]-h[0];A[1]=g[1]-h[1];W[0]=T[0]-z[0];W[1]=
T[1]-z[1];D=T[0]-g[0];G=Math.abs(A[0]);H=Math.abs(W[0]);0!=G+H&&G+H>D&&(G=D/(G+H),h[0]=g[0]-G*A[0],h[1]=g[1]-G*A[1],z[0]=T[0]-G*W[0],z[1]=T[1]-G*W[1]);y&&(d[v]=1);c[v]=I(C(0,1,B,l[0],k[0],m[0],n[0]),l[1],k[1],m[1],n[1]);v++;break;case 1:h=l[0];z=l[1];g=T=(n[1]-z)/(n[0]-h);h=z-T*h;y&&(d[v]=1);c[v]=g*B+h;v++;break;case 2:y&&(d[v]=1);c[v]=b[w+2];v++;break;default:R.la("Unknown keyframe intepolation mode: "+x)}}e+1==b[w+O+1]&&(p=x,w+=O)}}};a.PB=function(a){for(var b=0;b<a.length;b++)if(a[b].YA)return a[b];
return!1};a.apply=N;a.tA=function(a,b){var c=R.keysearch("name",b,ia)||R.keysearch("name",b+"_B4W_BAKED",ia);return c?R.Kd(c.fcurves)?!0:!1:R.keysearch("name",b,a.particle_systems)?!0:!1};a.get_slot_num_by_anim=function(a,b){for(var c=a.w,e=0;e<c.length;e++){var f=c[e];if(f&&d(f.ce)==d(b))return e}return-1};a.zw=function(a,b){var c=a.w[b];return c&&c.ce?d(c.ce):null};a.remove=function(a){a.w.length=0;a=ca.indexOf(a);-1!=a&&ca.splice(a,1)};a.sy=function(a){for(var b=ia.length-1;0<=b;b--)ia[b].Bt==
a&&ia.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.w.length)return N(a,b,0)?0:-1;for(var c=0;c<a.w.length;c++)if(!a.w[c])return N(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.d.Dk=(b-a.d.ae)/c;a.d.Ck=b};a.set_speed=function(a,b,c){r(a.w,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.w[b].speed};a.get_anim_start_frame=function(a,b){return a.w[b].start};a.get_anim_length=function(a,b){return a.w[b].length};a.Mp=u;a.cleanup=function(){ca.length=0;ia.length=0};a.$v=
function(a,b){var c=a[b],d=(c[0]||c[1]||c[2]).Ub.length,e=W,f=O,g=Boolean(c[0]);g||(c[0]={Ub:new Float32Array(d),num_channels:8});var h=Boolean(c[1]);h||(c[1]={Ub:new Float32Array(d),num_channels:8});var l=Boolean(c[2]);l||(c[2]={Ub:new Float32Array(d),num_channels:8});c[3]={Ub:new Float32Array(d),num_channels:8};for(var k=0;k<d;k++)f[0]=g?c[0].Ub[k]:0,f[1]=h?c[1].Ub[k]:0,f[2]=l?c[2].Ub[k]:0,R.euler_to_quat(f,e),c[0].Ub[k]=e[3],c[1].Ub[k]=e[0],c[2].Ub[k]=e[1],c[3].Ub[k]=e[2];d=b.replace("euler","quaternion");
a[d]=c;delete a[b]}};b4w.module.__time=function(a,p){p("__util");var c=0,b=0,h=[],d=0,f=[];a.mr=function(a){c=a;b=performance.now();for(a=0;a<h.length;a++){var d=h[a];c>d.rl&&(h.splice(a,1),a--,d.callback())}for(a=0;a<f.length;a++){var d=f[a],m=1-(d.rl-c)/d.duration,m=Math.min(m,1);d.callback(d.K+m*(d.Y-d.K));1==m&&(f.splice(a,1),a--)}};a.Ag=function(){return c};a.nr=function(a,f){var m;d++;m=d;h.push({id:m,callback:a,rl:c+(performance.now()-b+f)/1E3});return m};a.aj=function(a){for(var b=0;b<h.length;b++)if(h[b].id==
a){h.splice(b,1);break}};a.Ln=function(a,b,d){f.push({callback:d,K:a,Y:b,rl:c+.2,duration:.2});d(a)};a.reset=function(){b=c=0;d=h.length=0}};b4w.module.__transform=function(a,p){function c(a){var n=a.d;d.cA(a,e);if("CAMERA"==a.type&&(h.aA(a),h.Iu(a),h.Zr(a),n.aa==h.MS_TARGET_CONTROLS)){var q=r.quat_to_dir(n.quat,r.AXIS_Z,B);n.ik=0<q[1]}var q=n.g,v=n.scale,w=n.quat;l.ri(q,v,w,n.Wd);var p=n.N;E.identity(p);E.fromQuat(w,p);"CAMERA"!=a.type&&r.Gy(p,v,p);p[12]=q[0];p[13]=q[1];p[14]=q[2];E.invert(p,n.Up);a.w.length&&k.Ml(a)&&k.dA(a);n.Eb&&n.Qa&&(b.Ok(n.Eb,p,n.Qa),b.Qk(n.Cc,p,n.rb),b.Pk(n.Xe,n.Wd,n.Ye),n.hc&&g.Fm(g.get_active()));switch(a.type){case "SPEAKER":m.tz(a,
e);break;case "CAMERA":h.Vr(a);g.Z()&&g.pj(g.get_active())==a&&m.Ex(g.get_active(),q,w,e);break;case "LAMP":f.eA(a);g.Z()&&g.Uf(a,g.get_active());break;case "EMPTY":a.field&&g.Xr(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!g.Z()||(n=g.get_active(),g.Fm(n),g.Jy(n));a=a.oc;for(n=0;n<a.length;n++)c(a[n])}var b=p("__boundings"),h=p("__camera"),d=p("__constraints"),f=p("__lights"),k=p("__particles"),g=p("__scenes"),m=p("__sfx"),l=p("__tsr"),r=p("__util"),q=p("vec3"),w=p("quat"),v=p("mat3"),E=p("mat4"),B=new Float32Array(3),
x=new Float32Array(4),n=new Float32Array(9),e=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){e=a};a.set_translation=function(a,b){d.Ld(a)==d.rd?l.az(b,d.Jd(a)):a.d.g.set(b)};a.get_translation=function(a,b){d.Ld(a)==d.rd?q.copy(l.Ap(d.Jd(a)),b):q.copy(a.d.g,b)};a.set_rotation=function(a,b){d.Ld(a)==d.rd?l.Im(b,d.Jd(a)):a.d.quat.set(b)};a.get_rotation=function(a,b){d.Ld(a)==d.rd?w.copy(l.vp(d.Jd(a)),b):w.copy(a.d.quat,b)};a.set_rotation_euler=function(a,b){if(d.Ld(a)==d.rd){var c=r.euler_to_quat(b,
x);l.Im(c,d.Jd(a))}else r.euler_to_quat(b,a.d.quat)};a.set_scale=function(a,b){d.Ld(a)==d.rd?l.set_scale(b,d.Jd(a)):a.d.scale=b};a.get_scale=function(a){return d.Ld(a)==d.rd?l.get_scale(d.Jd(a)):a.d.scale};a.Xw=function(a,b){if(d.Ld(a)==d.rd)l.copy(d.Jd(a),b);else{var c=a.d;l.ri(c.g,c.scale,c.quat,b)}};a.or=function(a,b){if(d.Ld(a)==d.rd)l.copy(b,d.Jd(a));else{var c=a.d;c.g[0]=b[0];c.g[1]=b[1];c.g[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}};a.get_object_size=
function(a){var b=a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(b=a.d,q.copy(b.rb.D,c)):(b=a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,q.transformMat4(c,b.N,c));return c};a.move_local=function(a,b,c,d){a=a.d;var e=B;e[0]=b;e[1]=c;e[2]=d;b=v.fromMat4(a.N,n);q.transformMat3(e,
b,e);q.add(a.g,e,a.g)};a.C=c;a.distance=function(a,b){return q.dist(a.d.g,b.d.g)};a.Zx=function(a,b){return q.dist(a.d.g,b)};a.get_object_bounding_box=function(a){return{max_x:a.d.Qa.max_x,min_x:a.d.Qa.min_x,max_y:a.d.Qa.max_y,min_y:a.d.Qa.min_y,max_z:a.d.Qa.max_z,min_z:a.d.Qa.min_z}}};b4w.module.__tsr=function(a,p){function c(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function b(a,b,c){var d=b[0],f=b[1],g=b[2],h=b[3],k=b[4],p=b[5],n=b[6];b=b[7];var e=a[0]*h,H=a[1]*h,G=a[2]*h;a=b*e+p*G-n*H;var h=b*H+n*e-k*G,y=b*G+k*H-p*e,e=-k*e-p*H-n*G;c[0]=a*b+e*-k+h*-n-y*-p;c[1]=h*b+e*-p+y*-k-a*-n;c[2]=y*b+e*-n+a*-p-h*-k;c[0]+=d;c[1]+=f;c[2]+=g;return c}var h=p("__util"),d=p("vec3"),f=p("quat");p("mat4");var k=new Float32Array(3),g=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.qg=function(a,b,d,f){f||(f=new Float32Array(8));c(a,b,d,f);return f};a.ri=c;a.az=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.bz=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.Im=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.Ap=function(a){return a.subarray(0,
3)};a.get_scale=function(a){return a[3]};a.vp=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],h=a[1],k=a[2];g[0]=a[4];g[1]=a[5];g[2]=a[6];g[3]=a[7];f.invert(g,g);var p=g[0],B=g[1],x=g[2],n=g[3],d=d*c,h=h*c,e=k*c,k=n*d+B*e-x*h,H=n*h+x*d-p*e,G=n*e+p*h-B*d,d=-p*d-B*h-x*e;b[0]=-(k*n+d*-p+H*-x-G*-B);b[1]=-(H*n+d*-B+G*-p-k*-x);b[2]=-(G*n+d*-x+k*-B-H*-p);b[3]=c;b[4]=p;b[5]=B;b[6]=x;b[7]=n;return b};a.ip=function(a,b){var d=h.Bf(a,k),f=h.Ij(a),w=h.matrix_to_quat(a,
g);c(d,f,w,b);return b};a.multiply=function(a,c,d){b(c,a,d);d[3]=a[3]*c[3];var f=a[4],g=a[5],h=a[6];a=a[7];var k=c[4],p=c[5],x=c[6];c=c[7];d[4]=f*c+a*k+g*x-h*p;d[5]=g*c+a*p+h*k-f*x;d[6]=h*c+a*x+f*p-g*k;d[7]=a*c-f*k-g*p-h*x;return d};a.vi=b;a.lk=function(a,b,c,d){d||(d=0);var f=a.length,g=b[0],h=b[1],k=b[2],p=b[3],n=b[4],e=b[5],H=b[6];b=b[7];for(var G=0;G<f;G+=3){var y=a[G]*p,A=a[G+1]*p,D=a[G+2]*p,L=b*y+e*D-H*A,C=b*A+H*y-n*D,I=b*D+n*A-e*y,y=-n*y-e*A-H*D;c[d+G]=L*b+y*-n+C*-H-I*-e;c[d+G+1]=C*b+y*-e+
I*-n-L*-H;c[d+G+2]=I*b+y*-H+L*-e-C*-n;c[d+G]+=g;c[d+G+1]+=h;c[d+G+2]+=k}};a.Qr=function(a,b,c,d){d||(d=0);var f=a.length,g=b[3],h=b[4],k=b[5],p=b[6];b=b[7];for(var n=0;n<f;n+=3){var e=a[n]*g,H=a[n+1]*g,G=a[n+2]*g,y=b*e+k*G-p*H,A=b*H+p*e-h*G,D=b*G+h*H-k*e,e=-h*e-k*H-p*G;c[d+n]=y*b+e*-h+A*-p-D*-k;c[d+n+1]=A*b+e*-k+D*-h-y*-p;c[d+n+2]=D*b+e*-p+y*-k-A*-h}};a.kk=function(a,b,c){var d=b[3],f=b[4],g=b[5],h=b[6];b=b[7];var k=a[0]*d,p=a[1]*d,n=a[2]*d;a=b*k+g*n-h*p;var d=b*p+h*k-f*n,e=b*n+f*p-g*k,k=-f*k-g*p-
h*n;c[0]=a*b+k*-f+d*-h-e*-g;c[1]=d*b+k*-g+e*-f-a*-h;c[2]=e*b+k*-h+a*-g-d*-f};a.Rr=function(a,b,c,d){d||(d=0);var f=a.length,g=b[3],h=b[4],k=b[5],p=b[6];b=b[7];for(var n=0;n<f;n+=4){var e=a[n]*g,H=a[n+1]*g,G=a[n+2]*g,y=b*e+k*G-p*H,A=b*H+p*e-h*G,D=b*G+h*H-k*e,e=-h*e-k*H-p*G;c[d+n]=y*b+e*-h+A*-p-D*-k;c[d+n+1]=A*b+e*-k+D*-h-y*-p;c[d+n+2]=D*b+e*-p+y*-k-A*-h;c[d+n+3]=a[n+3]}};a.translate=function(a,b,c){var d=a[3],f=a[4],g=a[5],h=a[6],k=a[7],p=b[0]*d,n=b[1]*d,e=b[2]*d;b=k*p+g*e-h*n;var d=k*n+h*p-f*e,H=
k*e+f*n-g*p,p=-f*p-g*n-h*e;c[0]=a[0]+b*k+p*-f+d*-h-H*-g;c[1]=a[1]+d*k+p*-g+H*-f-b*-h;c[2]=a[2]+H*k+p*-h+b*-g-d*-f;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.vC=function(a,b,c,g){g||(g=new Float32Array(8));d.lerp(a.subarray(0,3),b.subarray(0,3),c,g.subarray(0,3));var h=a[3];g[3]=h+c*(b[3]-h);f.slerp(a.subarray(4),b.subarray(4),c,g.subarray(4));return g};a.MB=function(a,b,c,d){d||(d=new Float32Array(8));var g=a.subarray(0,3),h=b.subarray(0,3),k=d.subarray(0,3);k[0]=h[0]*(c+1)-g[0]*
c;k[1]=h[1]*(c+1)-g[1]*c;k[2]=h[2]*(c+1)-g[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);g=d.subarray(4);g[0]=b[0]*(c+1)-a[0]*c;g[1]=b[1]*(c+1)-a[1]*c;g[2]=b[2]*(c+1)-a[2]*c;g[3]=b[3]*(c+1)-a[3]*c;f.normalize(g,g);return d};a.ox=function(a,b,c,d,g){var h=a.subarray(0,3),k=g.subarray(0,3);k[0]=h[0]+b*c[0];k[1]=h[1]+b*c[1];k[2]=h[2]+b*c[2];g[3]=a[3];a=a.subarray(4);g=g.subarray(4);c=d[0];h=d[1];d=d[2];var k=a[0],p=a[1],x=a[2],n=a[3];g[0]=.5*(c*n+h*x-d*p);g[1]=.5*(h*n+d*k-c*x);g[2]=.5*
(d*n+c*p-h*k);g[3]=.5*(-c*k-h*p-d*x);g[0]=a[0]+g[0]*b;g[1]=a[1]+g[1]*b;g[2]=a[2]+g[2]*b;g[3]=a[3]+g[3]*b;f.normalize(g,g)}};b4w.module.__util=function(a,p){function c(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function b(a,c){var d=a instanceof Array?[]:{},e;for(e in a)d[e]=!a[e]||"object"!=typeof a[e]||-1!=c.indexOf(a[e])||a[e]instanceof Float32Array?a[e]:b(a[e],c);return d}function h(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function d(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function f(a,b){var c=b;switch(typeof a){case "number":return k(a,
c);case "string":return g(a,c);case "boolean":return k(a|0,c);case "function":case "undefined":return k(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=k(a[d],c);else if(d)for(d=0;d<a.length;d++)c=f(a[d],c);else for(var e in a)c=f(a[e],c)}else c=k(0,c)}return c}function k(a,b){var c=b;P[0]=a;c=(c<<5)-c+S[0];c&=c;c=(c<<5)-c+S[1];return c&c}function g(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),
c&=c;return c}function m(a){return(34*a+1)*a%289}function l(a){return a-Math.floor(a)}function r(a){return q((34*a+5)*a)}function q(a){return a-289*Math.floor(a/289)}function w(a){return a-7*Math.floor(a/7)}function v(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function E(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;
for(c=0;c<a.length;c++)if(!B(a[c],b[c]))return!1}else if(d){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!B(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function B(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return E(a,b);default:return!0}}var x=p("__print"),n=p("vec3"),e=p("vec4"),H=p("quat"),G=p("mat3"),y=p("mat4"),A=0,D={},L=new Float32Array(3),
C=new Float32Array(3),I=new Float32Array(4),J=new Float32Array(4),Q=new Float32Array(9),N=new Float32Array(16),u=new Float32Array(16),P=new Float64Array(1),S=new Uint32Array(P.buffer),Z=new Float32Array([0,0,0]),V=new Float32Array([0,0,0,1]),fa=new Float32Array([0,0,0,1,0,0,0,1]),Y=new Float32Array([1,0,0]),ha=new Float32Array([0,1,0]),R=new Float32Array([0,0,1]),X=new Float32Array([-1,0,0]),z=new Float32Array([0,-1,0]),pa=new Float32Array([0,0,-1]),ga=Math.floor(44488.07041494893);a.yt=Z;a.tt=V;
a.VA=fa;a.AXIS_X=Y;a.AXIS_Y=ha;a.AXIS_Z=R;a.AXIS_MX=X;a.AXIS_MY=z;a.AXIS_MZ=pa;a.keyfind=c;a.bw=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Tz=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Du=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.du=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);
return c};a.sign=function(a){return 0<a?1:0>a?-1:0};a.FC=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.EC=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.Gl=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.Zt=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.uB=
function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.TC=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.RC=function(a,b){var d=c("name",b,a);1<d.length&&x.error("obj_by_name(): name resolution ambiguity");return d};a.SC=function(a,b){var d=c("name",b,a),e=d.length;1<e&&x.error("obj_by_name(): name resolution ambiguity");if(0>=e)return[];for(var f=[],g=0;g<e;g++){var h=d[g];if("EMPTY"==h.type&&h.dupli_group)for(var h=
h.dupli_group.objects,k=0;k<h.length;k++)f.push(h[k])}return d=d.concat(f)};a.Qz=function(a,b,c,d){d||(d=new Float32Array(16));y.identity(d);d[12]=a;d[13]=b;d[14]=c};var ea=1;a.ny=function(){ea=(69069*ea+5)%Math.pow(2,32);return Math.round(ea/65536)%32768/32767};a.Az=function(a){ea=a};a.yc=function(a){var b=a[0]%ga*48271-3399*Math.floor(a[0]/ga);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.Aj=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){var c=Math.cos(a[1]/
2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),g=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.Qv=function(a){var b=G.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),g=Math.sin(a[1]);a=Math.sin(a[2]);var h=c*e,k=c*a,l=f*e,n=f*a;b[0]=d*e;b[1]=d*a;b[2]=-g;b[3]=g*l-k;b[4]=g*n+h;b[5]=d*f;b[6]=g*h+n;b[7]=g*k-l;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=
e*e,h=c*d+e*f;.499999<h?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=Math.PI/2):-.499999>h?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*g),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*g),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));n.transformQuat(b,a,c);return c};a.HB=function(a,b,c){c||(c=new Float32Array(4));a=n.normalize(a,L);var d=n.dot(b,a);a=n.cross(b,a,C);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/
2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.Rz=function(a,b,c,d){d||(d=new Float32Array(4));n.transformQuat(c,b,d);d[3]=-n.dot(a,d)};a.Iv=function(a){var b=a.d.quat;switch(a.type){case "CAMERA":L[0]=0;L[1]=-1;L[2]=0;n.transformQuat(L,b,L);C[0]=0;C[1]=0;C[2]=-1;break;case "MESH":L[0]=0;L[1]=0;L[2]=1;n.transformQuat(L,b,L);C[0]=0;C[1]=0;C[2]=1;break;case "EMPTY":L[0]=0,L[1]=1,L[2]=0,n.transformQuat(L,b,L),C[0]=0,C[1]=1,C[2]=0}L[1]=0;n.normalize(L,L);a=n.dot(L,C);return Math.acos(a)*(0<
-L[0]*C[2]?-1:1)};a.$n=function(a,b,c,d){if(0!=c){d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.nD=function(){A++;return A.toString(16)};a.nk=function(a){D[a]||(D[a]=0);var b=a+D[a];D[a]++;return b};a.Dc=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.bb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,I:0,W:null,v:[],F:b}};a.af=function(a){return JSON.parse(JSON.stringify(a))};
a.wB=function(a,c){var d=[],e;for(e in c){var f=c[e];if(f)for(var g=0;g<f.length;g++)d.push(f[g])}return b(a,d)};a.sa=function(b){var c=b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof Float32Array?new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.sa(b[d]):b[d];return c};a.bj=function(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?
new Float32Array(a[c]):a[c]instanceof Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof Array?a[c].slice(0):a[c]:a[c];return b};a.is_mesh=function(a){return"MESH"===a.type?!0:!1};a.sx=function(a){return"EMPTY"===a.type?!0:!1};a.rf=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));G.fromMat4(a,Q);var c=Q[0],d=Q[3],e=Q[6],f=Q[1],g=Q[4],h=Q[7],k=Q[2],l=Q[5],n=Q[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*
f+g*g+h*h)||1,k=Math.sqrt(k*k+l*l+n*n)||1;Q[0]/=c;Q[3]/=c;Q[6]/=c;Q[1]/=f;Q[4]/=f;Q[7]/=f;Q[2]/=k;Q[5]/=k;Q[8]/=k;H.fromMat3(Q,b);return b};a.Bf=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.Ij=function(a){I[0]=.577350269189626;I[1]=.577350269189626;I[2]=.577350269189626;I[3]=0;e.transformMat4(I,a,I);return e.length(I)};a.Zo=function(a,b){var c=b.left,d=b.right,e=b.top,f=b.bottom,g=b.Ja,k=b.Ta;c[0]=a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=
a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-a[8];d[3]=a[15]-a[12];e[0]=a[3]-a[1];e[1]=a[7]-a[5];e[2]=a[11]-a[9];e[3]=a[15]-a[13];f[0]=a[3]+a[1];f[1]=a[7]+a[5];f[2]=a[11]+a[9];f[3]=a[15]+a[13];g[0]=a[3]+a[2];g[1]=a[7]+a[6];g[2]=a[11]+a[10];g[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];h(c);h(d);h(e);h(f);h(g);h(k)};a.vz=function(a,b,c){return c<-d(a,b.left)||c<-d(a,b.right)||c<-d(a,b.top)||c<-d(a,b.bottom)||c<-d(a,b.Ja)||c<-d(a,b.Ta)?!0:!1};a.Pv=function(a,b,c,e,f){g=n.dot(c,
b.Ta);h=n.dot(e,b.Ta);k=n.dot(f,b.Ta);g=Math.sqrt(g*g+h*h+k*k);if(g<-d(a,b.Ja)||g<-d(a,b.Ta))return!0;var g=n.dot(c,b.left),h=n.dot(e,b.left),k=n.dot(f,b.left);if(Math.sqrt(g*g+h*h+k*k)<-d(a,b.left))return!0;g=n.dot(c,b.right);h=n.dot(e,b.right);k=n.dot(f,b.right);if(Math.sqrt(g*g+h*h+k*k)<-d(a,b.right))return!0;g=n.dot(c,b.top);h=n.dot(e,b.top);k=n.dot(f,b.top);if(Math.sqrt(g*g+h*h+k*k)<-d(a,b.top))return!0;g=n.dot(c,b.bottom);h=n.dot(e,b.bottom);k=n.dot(f,b.bottom);return Math.sqrt(g*g+h*h+k*k)<
-d(a,b.bottom)?!0:!1};a.ve=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*k+b[13];c[d+f+2]=b[2]*g+b[6]*h+b[10]*k+b[14]}};a.wA=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k}};a.Nz=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],k=a[f+2];c[d+
f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k;c[d+f+3]=a[f+3]}};a.uA=function(a,b,c){c||(c=new Float32Array(3));I[0]=a[0];I[1]=a[1];I[2]=a[2];I[3]=0;e.transformMat4(I,b,I);c[0]=I[0];c[1]=I[1];c[2]=I[2]};a.QB=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.vA=function(a){for(var b=
[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.Ui=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.Ui(b,c,d,f-1):b[f]<c?a.Ui(b,c,f+1,e):f};a.fe=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.cj=function(a,b){for(var c=0;c<a.length;c++)if(1E-7<Math.abs(a[c]-b[c]))return!1;return!0};a.Gy=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];
c[15]=a[15]};a.bn=function(a,b,c,d){d||(d=new Float32Array(16));b=y.fromRotationTranslation(b,c,N);y.multiply(b,a,d)};a.vi=function(a,b,c,d,e){e||(e=new Float32Array(3));c=y.fromRotationTranslation(c,d,N);1!==b&&(d=y.identity(u),b=n.set(b,b,b,L),y.scale(d,b,d),y.multiply(c,d,c));n.transformMat4(a,c,e);return e};a.cn=function(a,b,c,d){d||(d=new Float32Array(4));b=y.fromRotationTranslation(b,c,N);e.transformMat4(a,b,d)};a.wC=function(a,b,c,d,e){e||(e=new Float32Array(3));b=y.fromRotationTranslation(c,
d,N);y.invert(b,b);n.transformMat4(a,b,e);return e};a.kD=function(a,b,c){c||(c=new Float32Array(16));y.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.PC=function(b,c,d){a.Bf(b,c);c[3]=a.Ij(b);a.matrix_to_quat(b,d)};a.Pn=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.Cy=function(a,b,c,d){d||(d=new Float32Array(3));n.subtract(b,a,L);n.transformQuat(L,c,L);n.subtract(b,L,d)};a.ow=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),
c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16),g=new Float32Array(16);y.lookAt(a,[-1,0,0],[0,-1,0],b);y.scale(b,[-1,1,1],b);y.scale(b,[-1,1,-1],c);y.lookAt(a,[0,-1,0],[0,0,-1],d);y.scale(d,[1,1,-1],d);y.scale(d,[1,-1,-1],e);y.lookAt(a,[0,0,-1],[0,-1,0],f);y.scale(f,[-1,1,1],f);y.scale(f,[-1,1,-1],g);return[b,c,d,e,f,g]};a.lg=function(a,b){return f(a,b)};a.hash_code=f;a.oC=g;a.OC=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,k,l,n,m,q,u,r,v,w;if(!c||
a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];h=a[2];k=a[3];l=a[4];n=a[5];m=a[6];q=a[7];u=a[8];r=a[9];v=a[10];w=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=k;c[4]=l;c[5]=n;c[6]=m;c[7]=q;c[8]=u;c[9]=r;c[10]=v;c[11]=w;c[12]=f*d+l*e+u*b+a[12];c[13]=g*d+n*e+r*b+a[13];c[14]=h*d+m*e+v*b+a[14];c[15]=k*d+q*e+w*b+a[15];return c};a.Jx=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=
a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.my=function(a){return a*Math.PI/180};a.EB=function(a){return 180*a/Math.PI};a.Om=function(a){var b=.366025403784439*a[0]+.366025403784439*
a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>a?1:0,g=1-f,e=b+.211324865405187-f,h=a+.211324865405187-g,k=b+-.577350269189626,n=a+-.577350269189626,c=c%289,d=d%289,q=m(m(d)+c),g=m(m(d+g)+c+f),u=m(m(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+h*h),0),f=Math.max(.5-(k*k+n*n),0),r=2*l(.024390243902439*q)-1,v=2*l(.024390243902439*g)-1,w=2*l(.024390243902439*u)-1,q=Math.abs(r)-.5,g=Math.abs(v)-.5,u=Math.abs(w)-.5,r=r-Math.floor(r+
.5),v=v-Math.floor(v+.5),w=w-Math.floor(w+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(r*r+q*q)),d=d*d*d*d*(1.79284291400159-.85373472095314*(v*v+g*g)),f=f*f*f*f*(1.79284291400159-.85373472095314*(w*w+u*u));return 130*(c*(r*b+q*a)+d*(v*e+g*h)+f*(w*k+u*n))};a.no=function(a){var b=1/7,c=b/2,d=q(Math.floor(a[0])),e=q(Math.floor(a[1])),f=l(a[0]);a=l(a[1]);var g=f-.5,h=f-1.5,f=a-.5;a-=1.5;var k=r(d),n=r(d+1),m=k,d=n,k=r(k+e),n=r(n+e),m=r(m+e+1),d=r(d+e+1),e=g+.7*(w(k)*b+c),u=h+.7*(w(n)*b+c),g=g+.7*
(w(m)*b+c),h=h+.7*(w(d)*b+c),k=f+.7*(w(Math.floor(k*b))*b+c),f=f+.7*(w(Math.floor(n*b))*b+c),m=a+.7*(w(Math.floor(m*b))*b+c),b=a+.7*(w(Math.floor(d*b))*b+c);return Math.min(e*e+k*k,u*u+f*f,g*g+m*m,h*h+b*b)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=n.transformQuat(b,a,L);b=c[0];var f=c[1];c=c[2];Q[0]=f*f+c*c;Q[1]=-f*b;Q[2]=-c*b;Q[3]=-b*f;Q[4]=b*b+c*c;Q[5]=-c*f;Q[6]=-b*c;Q[7]=-f*c;Q[8]=b*b+f*f;n.transformMat3(a,Q,a);n.normalize(a,a);H.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=
function(a,b){b||(b=new Float32Array(4));var c=I,d=J,c=H.setAxisAngle([0,1,0],Math.PI,H.create()),d=H.setAxisAngle([1,0,0],Math.PI/2,H.create());H.multiply(c,d,c);H.multiply(a,c,b);return b};a.cleanup=function(){A=0;D={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.wr=function(a,b,c,
d,e){e||(e=new Float32Array(a.length));H.slerp(a,b,Math.exp(-c/d),e)};a.xC=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=G.fromQuat(a,Q);C[0]=0;C[1]=1;C[2]=0;L[0]=c[3];L[1]=c[4];L[2]=c[5];var d=n.cross(C,L,L);n.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);C[0]=c[0];
C[1]=c[1];C[2]=c[2];n.normalize(C,C);H.rotationTo(C,d,J);H.multiply(J,a,a)};a.pp=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],k=a[e*b+Math.min(c+1,g)],l=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+k*d)*(1-f)+(l*(1-d)+a*d)*f};a.Qf=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.fr=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.oi=function(a,
b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.mp=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.Kd=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];n.normalize(c,
c)};a.lD=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var k=g*a-h*e,l=h*d-f*a,n=f*e-g*d,m=g*n-h*l,h=h*k-f*n,f=f*l-g*k;c[0]=d+2*k*b+2*m;c[1]=e+2*l*b+2*h;c[2]=a+2*n*b+2*f;return c};a.la=function(a){a&&x.error.apply(x,arguments);throw"panic: see above for possible error messages";};a.angle_wrap_periodic=v;a.angle_wrap_0_2pi=function(a){return v(a,0,2*Math.PI)};a.El=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.Hr=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=
e==f;break;case "object":d=E(e,f)}if(!d)return!1}return!0};a.ly=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.kp=function(a){a+=1;132651<a&&x.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d,f){I.set(a);I[3]=b;J.set(d);J[3]=0;a=e.dot(I,J);if(0==a)return null;J.set(c);J[3]=1;a=-e.dot(I,J)/a;f[0]=c[0]+a*d[0];f[1]=c[1]+a*d[1];f[2]=c[2]+a*d[2];return f};
a.yB=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.hr=function(a,b,c){var d=n.dot(a,b);-.9999999>d?(n.cross(Y,a,L),1E-6>n.length(L)&&n.cross(ha,a,L),n.normalize(L,L),H.setAxisAngle(L,Math.PI,c)):(n.cross(a,b,L),c.set(L),c[3]=1+d,H.normalize(c,c));return c}};b4w.module.__sfx=function(a,p){function c(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;B.warn("deprecated WebAudio implementation");return null}B.warn("WebAudio is not supported");return null}function b(a,b,c){var d=a.h;if("NONE"!=d.behavior){c||(c=0);var e=d.loop,l=d.pitch;if(d.src&&(e||0<=c)){d.Hk=Math.floor(5E4*Math.random());var n=C.currentTime+b;d.ic=n;d.state=20;h(a);"POSITIONAL"==d.behavior||"BACKGROUND_SOUND"==d.behavior?(b=C.createBufferSource(),
b.buffer=d.src,b.playbackRate.value=l,e?(d.ib&&d.ib.disconnect(),b.loop=!0,b.start(n),d.duration=0):(e=b.buffer?b.buffer.duration:0,c>e?(e=n+c+d.Gd,b.loop=!0,b.start(n),b.stop(e),d.duration=c):(b.loop=!1,b.start(n),d.duration=e)),b.connect(d.Pb),d.ib=b,f(d),k(d)):"BACKGROUND_MUSIC"==d.behavior&&(x.aj(d.Lk),x.aj(d.Mk),c=function(){var b=a.h,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.ib=b.ib||C.createMediaElementSource(c),b.ib.connect(b.Pb),20==b.state&&(c.currentTime&&(c.currentTime=0),c.play()))},0==
b?c():d.Lk=x.nr(c,1E3*b),d.duration=e?0:v(a));g(d,n)}}}function h(a){var b=a.h;if(!b.Pb){var c=a.d.g;a=a.d.quat;if(H.Nj){var d=C.createBiquadFilter();d.type="peaking"}else d=null;var e=C.createGain();switch(b.behavior){case "POSITIONAL":var f=C.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);b.$l.set(c);c=G;n.quat_to_dir(a,n.AXIS_MY,c);f.setOrientation(c[0],
c[1],c[2]);b.direction.set(c);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.Nu;f.coneOuterAngle=b.Ou;f.coneOuterGain=b.Pu;var g=C.createGain();g.gain.value=w(b);d?(f.connect(d),d.connect(g)):f.connect(g);g.connect(e);b.Pb=f;if(b.sh){var h=C.createGain();e.connect(h);h.connect(C?I.h.Pb:null)}else h=null,e.connect(C?I.h.Pb:null);break;case "BACKGROUND_SOUND":f=null;g=C.createGain();g.gain.value=w(b);d?(b.Pb=d,d.connect(g)):b.Pb=g;g.connect(e);b.sh?
(h=C.createGain(),e.connect(h),h.connect(C?I.h.Pb:null)):(h=null,e.connect(C?I.h.Pb:null));break;case "BACKGROUND_MUSIC":h=f=null,g=C.createGain(),g.gain.value=w(b),d?(b.Pb=d,d.connect(g)):b.Pb=g,g.connect(e),e.connect(C?I.h.Pb:null)}b.bi=f;b.Xc=d;b.xg=g;b.hf=e;b.Zq=h}}function d(a){var c=a.h,d=c.duration,c=c.delay+c.Ev*Math.random();b(a,c,d)}function f(a){a.sh&&a.Zq.gain.cancelScheduledValues(a.ic);a.ei&&a.ib.playbackRate.cancelScheduledValues(a.ic);a.Bi=a.ic}function k(a){if(a.sh||a.ei){var b=a.Zq,
c=a.ib,d=c.buffer?c.buffer.duration:0;if(d){var e=a.ic;Q[0]=a.Hk;for(var f=0;5>f;){var g=a.pitch+a.ei*n.yc(Q);if(e>=a.Bi){if(a.sh){var h=1-n.clamp(a.sh,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.ei&&c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.Bi=e-.001}}}function g(a,b){if(a.tl||a.Gd){var c=a.hf;c.gain.cancelScheduledValues(b);a.tl?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.tl)):c.gain.setValueAtTime(1,b);a.Gd&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,
b+a.duration+a.Gd))}}function m(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.h;if(20==b.state||40==b.state){var c=b.hf,d=C.currentTime;b.Gd&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.Gd));"BACKGROUND_MUSIC"==b.behavior?b.src&&(x.aj(b.Lk),x.aj(b.Mk),b.Mk=x.nr(function(){var b=a.h.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.Gd)):(c=b.ib,b.duration<c.buffer.duration?b.Gd&&20==b.state?c.stop(d+b.Gd):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),
b.ic=0,b.wm=0,b.Rk=0);b.state=30}}function l(a){a=a.h;if(20==a.state){var b=C.currentTime;a.wm=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.ic){Q[0]=a.Hk;for(var d=a.ib.buffer.duration,e=a.ic;e<b;)c=a.pitch+a.ei*n.yc(Q),e+=d/c;c*=d/c-(e-b)}else c=0;a.Rk=c;a.ib.stop(0);a.ib.disconnect();f(a)}a.state=40}}function r(a){var b=a.h;if(40==b.state){var c=C.currentTime;b.ic+=c-b.wm;if("BACKGROUND_MUSIC"==b.behavior)b.src.play();else{a=a.h;var d=C.createBufferSource();d.loop=a.ib.loop;
d.buffer=a.ib.buffer;d.playbackRate.value=a.ib.playbackRate.value;a.bi?d.connect(a.bi):d.connect(a.xg);a.ib=d;b.Bi=c;b.ib.start(b.ic,b.Rk);k(b)}g(b,b.ic);b.state=20}}function q(a){return!a.h||20!=a.h.state&&40!=a.h.state&&30!=a.h.state?!1:!0}function w(a){return a.muted?0:a.volume}function v(a){a=a.h;return(a=a.src)?a.duration:0}var E=p("__config"),B=p("__print"),x=p("__time"),n=p("__util"),e=p("vec3"),H=E.Lc;a.sn=10;a.uk=20;a.rn=30;var G=new Float32Array(3),y=new Float32Array(3),A=new Float32Array(3),
D=[],L=[],C=null,I=null,J=[],Q=[1],N=null;a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(D.push("ogg"),D.push("ogv")),""!=a.canPlayType("audio/mpeg")&&D.push("mp3"),""!=a.canPlayType("audio/mp4")&&(D.push("mp4"),D.push("m4v")),""!=a.canPlayType("audio/webm")&&D.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&L.push("ogv"),""!=b.canPlayType("video/mp4")&&L.push("m4v"),""!=b.canPlayType("video/webm")&&
L.push("webm"));(C=H.pn?c():null)&&B.log("%cINIT WEBAUDIO: "+C.sampleRate+"Hz","color: #00a")};a.Tn=function(a){var b={yf:new Float32Array(3),kq:new Float32Array(3),Hg:new Float32Array(3)};a.h=b;if(C){var c=C.createGain(),d=C.createGain();b.xg=c;b.hf=d;c.connect(d);d.connect(C.destination);if(a.b4w_enable_dynamic_compressor){var d=C.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=
e.release;d.connect(c);b.Dh=d;b.Pb=d}else b.Dh=null,b.Pb=c;c=C.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=!1;b.volume=1;b.gf=0}};a.Oy=function(a){I=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<D.indexOf(a)?a:"ogg"==a&&-1<D.indexOf("mp4")?"mp4":"mp3"==a&&-1<D.indexOf("ogg")?"ogg":"mp4"==a&&-1<D.indexOf("ogg")?"ogg":"ogv"==a&&-1<D.indexOf("m4v")?"m4v":"webm"==a&&-1<D.indexOf("m4v")?"m4v":"m4v"==a&&-1<D.indexOf("webm")?"webm":""};a.detect_video_container=
function(a){a||(a="webm");return-1<L.indexOf(a)?a:"ogv"==a&&-1<L.indexOf("m4v")?"m4v":"webm"==a&&-1<L.indexOf("m4v")?"m4v":"m4v"==a&&-1<L.indexOf("webm")?"webm":""};a.append_object=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.h={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.h.behavior=C?b.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var c=a.h,d;C?(window.MediaElementAudioSourceNode?d=!0:(B.warn("MediaElementAudioSourceNode not found"),d=!1),
d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.h.behavior="NONE");a.h.Jv=b.b4w_disable_doppler;a.h.muted=b.muted;a.h.volume=b.volume;a.h.pitch=b.pitch;a.h.attenuation=b.attenuation;a.h.dist_ref=b.distance_reference;a.h.dist_max=b.distance_max||1E4;a.h.Nu=b.cone_angle_inner;a.h.Ou=b.cone_angle_outer;a.h.Pu=b.cone_volume_outer;a.h.cyclic=b.b4w_cyclic_play;a.h.loop=b.b4w_loop;a.h.delay=b.b4w_delay;a.h.Ev=b.b4w_delay_random;a.h.sh=
b.b4w_volume_random;a.h.ei=b.b4w_pitch_random;a.h.tl=b.b4w_fade_in;a.h.Gd=b.b4w_fade_out;a.h.ic=0;a.h.wm=0;a.h.Rk=0;a.h.duration=0;a.h.Bi=0;a.h.Hk=1;a.h.src=null;a.h.state=10;a.h.$l=new Float32Array(3);a.h.direction=new Float32Array(3);a.h.Pm=new Float32Array(3);a.h.Lk=-1;a.h.Mk=-1;a.h.gf=0;J.push(a)};a.xr=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.h.behavior){case "POSITIONAL":return a.uk;case "BACKGROUND_SOUND":return a.uk;case "BACKGROUND_MUSIC":return a.rn;case "NONE":return a.sn;
default:throw"Wrong speaker behavior";}};a.kA=function(a,b){var c=a.h;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.dy=function(){var a=C.createBufferSource();a.buffer=C.createBuffer(1,22050,22050);a.connect(C.destination);a.start(0)};a.Bv=function(a,b,c){C?C.decodeAudioData(a,b,c):c()};a.rz=function(a){m(a);delete a.h;J.splice(J.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<J.length;a++){var b=
J[a].h;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.ib&&b.ib.disconnect()}I&&I.h&&(a=I.h,a.yf[0]=0,a.yf[1]=0,a.yf[2]=0,a.Hg[0]=0,a.Hg[1]=0,a.Hg[2]=0);I=null;J.splice(0);N=null};a.update=function(a){if(C&&0!=J.length){for(var b=0;b<J.length;b++){var c=J[b],e=c.h,f=C.currentTime;C&&!e.loop&&e.cyclic&&20==e.state&&e.duration&&e.ic+e.duration<f&&d(c);20==e.state&&3>e.Bi-f&&k(e)}N&&(-1==N.Fa||a>N.In+N.So[N.Fa])&&(b=N,-1<b.Fa&&m(b.Fe[b.Fa]),-1==b.Fa&&b.random?c=Math.round(Math.random()*(b.Fe.length-
1)):b.random?(c=1+Math.round(Math.random()*(b.Fe.length-2)),c=(b.Fa+c)%b.Fe.length):c=(b.Fa+1)%b.Fe.length,d(b.Fe[c]),b.Fa=c,b.In=a)}};a.play=b;a.play_def=d;a.stop=m;a.is_play=function(a){return 20==a.h.state};a.qz=l;a.sz=r;a.playrate=function(a,b){var c=a.h;c.pitch=b;!q(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.ib.playbackRate.value=b,f(c),k(c))};a.get_playrate=function(a){return a.h.pitch};a.cyclic=function(a,b){a.h.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.h.cyclic};
a.Ex=function(a,b,c,d){if(C&&a.h){var f=G;f[0]=0;f[1]=-1;f[2]=0;e.transformQuat(f,c,f);y[0]=0;y[1]=0;y[2]=-1;e.transformQuat(y,c,y);c=C.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(f[0],f[1],f[2],y[0],y[1],y[2]);a.h.kq.set(f);d&&(A[0]=(b[0]-a.h.yf[0])/d,A[1]=(b[1]-a.h.yf[1])/d,A[2]=(b[2]-a.h.yf[2])/d,n.smooth_v(A,a.h.Hg,d,.3,A),c.setVelocity(A[0],A[1],A[2]),a.h.Hg.set(A));a.h.yf.set(b)}};a.listener_reset_speed=function(a,b){if(C&&I.h){var c=G;b?c.set(b):c.set(I.h.kq);e.scale(c,a,c);C.listener.setVelocity(c[0],
c[1],c[2]);I.h.Hg.set(c)}};a.tz=function(a,b){var c=a.h;if(q(a)&&"POSITIONAL"==c.behavior){var d=a.d.g,e=c.bi;e.setPosition(d[0],d[1],d[2]);var f=G;n.quat_to_dir(a.d.quat,n.AXIS_MY,f);e.setOrientation(f[0],f[1],f[2]);f=c.$l;!c.Jv&&b&&(y[0]=(d[0]-f[0])/b,y[1]=(d[1]-f[1])/b,y[2]=(d[2]-f[2])/b,n.smooth_v(y,c.Pm,b,.3,y),e.setVelocity(y[0],y[1],y[2]),c.Pm.set(y));f.set(d)}};a.speaker_reset_speed=function(a,b,c){var d=a.h;if(q(a)&&"POSITIONAL"==d.behavior){var f=G;c?f.set(c):f.set(d.direction);e.scale(f,
b,f);d.bi.setVelocity(f[0],f[1],f[2]);d.Pm.set(f);d.$l.set(a.d.g)}};a.Od=function(a){return a.h?!0:!1};a.Hl=function(a){return a.h.behavior};a.check_active_speakers=function(){for(var a=0;a<J.length;a++)if(q(J[a]))return!0;return!1};a.Xy=function(a){var b=I.h;b&&(b.volume=a,C&&(b.xg.gain.value=w(b)))};a.Ow=function(){var a=I.h;return a?a.volume:0};a.set_volume=function(a,b){var c=a.h;c.volume=b;q(a)&&(c.xg.gain.value=w(c))};a.get_volume=function(a){return a.h.volume};a.mute=function(a,b){a.h.muted=
Boolean(b);q(a)&&(a.h.xg.gain.value=w(a.h))};a.is_muted=function(a){return a.h.muted};a.Rx=function(a){var b=I.h;b&&(b.muted=Boolean(a),C&&(b.xg.gain.value=w(b)))};a.xx=function(){var a=I.h;return a?a.muted:!1};a.get_speaker_objects=function(){return J};a.pause=function(){for(var a=0;a<J.length;a++)l(J[a])};a.resume=function(){for(var a=0;a<J.length;a++)r(J[a])};a.set_compressor_params=function(a,b){if(a.h&&a.h.Dh){var c=a.h.Dh;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;
c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.h||!a.h.Dh)return null;a=a.h.Dh;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(q(a)){a=a.h;var d=a.hf,e=C.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.gf=c}};a.unduck=function(a){if(q(a)){a=a.h;var b=a.hf,c=C.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,
c+a.gf);a.gf=0}};a.Lv=function(a,b){if(C){var c=I.h,d=c.hf,e=C.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.gf=b}};a.Uz=function(){if(C){var a=I.h,b=a.hf,c=C.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.gf);a.gf=0}};a.apply_playlist=function(a,b,c){N={Fa:-1,In:0,random:c,Fe:[],So:[]};for(c=0;c<a.length;c++){var d=a[c],e=v(d);0==e?B.warn("Ignoring speaker with zero duration: "+d.name):(m(d),d.h.cyclic=!1,N.Fe.push(d),
N.So.push(e+b))}};a.get_duration=v;a.clear_playlist=function(){if(N)for(var a=N.Fe,b=0;b<a.length;b++)m(a[b]);N=null};a.get_positional_params=function(a){return(a=a.h)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.h;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.bi;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=
c.attenuation)}};a.set_filter_params=function(a,b){var c=a.h;c&&c.Xc&&(c.Xc.frequency.value=b.freq,c.Xc.Q.value=b.Q,c.Xc.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.h)&&a.Xc?{freq:a.Xc.frequency.value,Q:a.Xc.Q.value,gain:a.Xc.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.h;if(!a||!a.Xc)return null;a.Xc.getFrequencyResponse(b,c,d)}};b4w.module.vec3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new p(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var c=new p(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.fromValues=function(a,c,d){var f=new p(3);f[0]=a;f[1]=c;f[2]=d;return f};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.set=function(a,c,d,f){f[0]=a;f[1]=c;f[2]=d;return f};a.add=function(a,c,d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];return d};
a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);return d};
a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;return d};a.scaleAndAdd=function(a,c,d,f){f[0]=a[0]+c[0]*d;f[1]=a[1]+c[1]*d;f[2]=a[2]+c[2]*d;return f};a.distance=function(a,c){var d=c[0]-a[0],f=c[1]-a[1],k=c[2]-a[2];return Math.sqrt(d*d+f*f+k*k)};a.dist=a.distance;a.squaredDistance=function(a,c){var d=c[0]-a[0],f=c[1]-a[1],k=c[2]-a[2];return d*d+f*f+k*k};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1];a=a[2];return Math.sqrt(c*c+d*d+a*a)};a.len=a.length;a.squaredLength=
function(a){var c=a[0],d=a[1];a=a[2];return c*c+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};a.normalize=function(a,c){var d=a[0],f=a[1],k=a[2],d=d*d+f*f+k*k;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};a.cross=function(a,c,d){var f=a[0],k=a[1];a=a[2];var g=c[0],m=c[1];c=c[2];d[0]=k*c-a*m;d[1]=
a*g-f*c;d[2]=f*m-k*g;return d};a.lerp=function(a,c,d,f){var k=a[0],g=a[1];a=a[2];f[0]=k+d*(c[0]-k);f[1]=g+d*(c[1]-g);f[2]=a+d*(c[2]-a);return f};a.random=function(a,h){a=a||1;var d=2*c()*Math.PI,f=2*c()-1,k=Math.sqrt(1-f*f)*a;h[0]=Math.cos(d)*k;h[1]=Math.sin(d)*k;h[2]=f*a;return h};a.transformMat4=function(a,c,d){var f=a[0],k=a[1];a=a[2];var g=c[3]*f+c[7]*k+c[11]*a+c[15],g=g||1;d[0]=(c[0]*f+c[4]*k+c[8]*a+c[12])/g;d[1]=(c[1]*f+c[5]*k+c[9]*a+c[13])/g;d[2]=(c[2]*f+c[6]*k+c[10]*a+c[14])/g;return d};a.transformMat3=
function(a,c,d){var f=a[0],k=a[1];a=a[2];d[0]=f*c[0]+k*c[3]+a*c[6];d[1]=f*c[1]+k*c[4]+a*c[7];d[2]=f*c[2]+k*c[5]+a*c[8];return d};a.transformQuat=function(a,c,d){var f=a[0],k=a[1],g=a[2];a=c[0];var m=c[1],l=c[2];c=c[3];var r=c*f+m*g-l*k,q=c*k+l*f-a*g,w=c*g+a*k-m*f,f=-a*f-m*k-l*g;d[0]=r*c+f*-a+q*-l-w*-m;d[1]=q*c+f*-m+w*-a-r*-l;d[2]=w*c+f*-l+r*-m-q*-a;return d};a.rotateX=function(a,c,d,f){var k=[],g=[];k[0]=a[0]-c[0];k[1]=a[1]-c[1];k[2]=a[2]-c[2];g[0]=k[0];g[1]=k[1]*Math.cos(d)-k[2]*Math.sin(d);g[2]=
k[1]*Math.sin(d)+k[2]*Math.cos(d);f[0]=g[0]+c[0];f[1]=g[1]+c[1];f[2]=g[2]+c[2];return f};a.rotateY=function(a,c,d,f){var k=[],g=[];k[0]=a[0]-c[0];k[1]=a[1]-c[1];k[2]=a[2]-c[2];g[0]=k[2]*Math.sin(d)+k[0]*Math.cos(d);g[1]=k[1];g[2]=k[2]*Math.cos(d)-k[0]*Math.sin(d);f[0]=g[0]+c[0];f[1]=g[1]+c[1];f[2]=g[2]+c[2];return f};a.rotateZ=function(a,c,d,f){var k=[],g=[];k[0]=a[0]-c[0];k[1]=a[1]-c[1];k[2]=a[2]-c[2];g[0]=k[0]*Math.cos(d)-k[1]*Math.sin(d);g[1]=k[0]*Math.sin(d)+k[1]*Math.cos(d);g[2]=k[2];f[0]=g[0]+
c[0];f[1]=g[1]+c[1];f[2]=g[2]+c[2];return f};a.forEach=function(){var b=a.create();return function(a,c,f,k,g,m){c||(c=3);f||(f=0);for(k=k?Math.min(k*c+f,a.length):a.length;f<k;f+=c)b[0]=a[f],b[1]=a[f+1],b[2]=a[f+2],g(b,m,b),a[f]=b[0],a[f+1]=b[1],a[f+2]=b[2];return a}}();a.$A=function(b,c){var d=a.fromValues(b[0],b[1],b[2]),f=a.fromValues(c[0],c[1],c[2]);a.normalize(d,d);a.normalize(f,f);d=a.dot(d,f);return 1<d?0:Math.acos(d)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==
typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new p(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var c=new p(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.fromValues=function(a,c,d,f){var k=new p(4);k[0]=a;k[1]=c;k[2]=d;k[3]=f;return k};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.set=function(a,c,d,f,k){k[0]=a;k[1]=c;k[2]=d;k[3]=f;return k};a.add=function(a,c,d){d[0]=
a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3]+c[3];return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];d[3]=a[3]-c[3];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];d[3]=a[3]*c[3];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];d[3]=a[3]/c[3];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);d[3]=
Math.min(a[3],c[3]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);d[3]=Math.max(a[3],c[3]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;return d};a.scaleAndAdd=function(a,c,d,f){f[0]=a[0]+c[0]*d;f[1]=a[1]+c[1]*d;f[2]=a[2]+c[2]*d;f[3]=a[3]+c[3]*d;return f};a.distance=function(a,c){var d=c[0]-a[0],f=c[1]-a[1],k=c[2]-a[2],g=c[3]-a[3];return Math.sqrt(d*d+f*f+k*k+g*g)};a.dist=a.distance;a.squaredDistance=
function(a,c){var d=c[0]-a[0],f=c[1]-a[1],k=c[2]-a[2],g=c[3]-a[3];return d*d+f*f+k*k+g*g};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1],f=a[2];a=a[3];return Math.sqrt(c*c+d*d+f*f+a*a)};a.len=a.length;a.squaredLength=function(a){var c=a[0],d=a[1],f=a[2];a=a[3];return c*c+d*d+f*f+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];c[3]=1/a[3];return c};a.normalize=
function(a,c){var d=a[0],f=a[1],k=a[2],g=a[3],d=d*d+f*f+k*k+g*g;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,d,f){var k=a[0],g=a[1],m=a[2];a=a[3];f[0]=k+d*(c[0]-k);f[1]=g+d*(c[1]-g);f[2]=m+d*(c[2]-m);f[3]=a+d*(c[3]-a);return f};a.random=function(b,h){b=b||1;h[0]=c();h[1]=c();h[2]=c();h[3]=c();a.normalize(h,h);a.scale(h,b,h);return h};a.transformMat4=function(a,c,d){var f=a[0],
k=a[1],g=a[2];a=a[3];d[0]=c[0]*f+c[4]*k+c[8]*g+c[12]*a;d[1]=c[1]*f+c[5]*k+c[9]*g+c[13]*a;d[2]=c[2]*f+c[6]*k+c[10]*g+c[14]*a;d[3]=c[3]*f+c[7]*k+c[11]*g+c[15]*a;return d};a.transformQuat=function(a,c,d){var f=a[0],k=a[1],g=a[2],m=c[0],l=c[1],r=c[2];c=c[3];var q=c*f+l*g-r*k,w=c*k+r*f-m*g,v=c*g+m*k-l*f,f=-m*f-l*k-r*g;d[0]=q*c+f*-m+w*-r-v*-l;d[1]=w*c+f*-l+v*-m-q*-r;d[2]=v*c+f*-r+q*-l-w*-m;d[3]=a[3];return d};a.forEach=function(){var b=a.create();return function(a,c,f,k,g,m){c||(c=4);f||(f=0);for(k=k?Math.min(k*
c+f,a.length):a.length;f<k;f+=c)b[0]=a[f],b[1]=a[f+1],b[2]=a[f+2],b[3]=a[f+3],g(b,m,b),a[f]=b[0],a[f+1]=b[1],a[f+2]=b[2],a[f+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,p){var c=p("vec3"),b=p("vec4"),h=p("mat3"),d="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new d(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=c.create(),d=c.fromValues(1,0,0),g=c.fromValues(0,1,0);return function(h,l,r){var q=c.dot(h,l);if(-.9999999>q)return c.cross(d,h,b),1E-6>c.length(b)&&c.cross(g,h,b),c.normalize(b,b),a.setAxisAngle(b,Math.PI,r),r;if(.9999999<q)return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r;c.cross(h,
l,b);r[0]=b[0];r[1]=b[1];r[2]=b[2];r[3]=1+q;return a.normalize(r,r)}}();a.setAxes=function(){var b=h.create();return function(c,d,h,l){b[0]=d[0];b[3]=d[1];b[6]=d[2];b[1]=h[0];b[4]=h[1];b[7]=h[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,l),l)}}();a.clone=b.clone;a.fromValues=b.fromValues;a.copy=b.copy;a.set=b.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=b.add;a.multiply=function(a,b,c){var d=a[0],h=a[1],r=a[2];a=a[3];var q=b[0],w=b[1],v=b[2];b=b[3];c[0]=d*b+a*q+h*v-r*w;c[1]=h*b+a*w+r*q-d*v;c[2]=r*b+a*v+d*w-h*q;c[3]=a*b-d*q-h*w-r*v;return c};a.mul=a.multiply;a.scale=b.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],h=a[1],r=a[2];a=a[3];var q=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*q;c[1]=h*b+r*q;c[2]=r*b-h*q;c[3]=a*b-d*q;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],h=a[1],r=a[2];a=a[3];var q=Math.sin(b);b=Math.cos(b);c[0]=d*
b-r*q;c[1]=h*b+a*q;c[2]=r*b+d*q;c[3]=a*b-h*q;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],h=a[1],r=a[2];a=a[3];var q=Math.sin(b);b=Math.cos(b);c[0]=d*b+h*q;c[1]=h*b-d*q;c[2]=r*b+a*q;c[3]=a*b-r*q;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],h=a[2];b[0]=c;b[1]=d;b[2]=h;b[3]=Math.sqrt(Math.abs(1-c*c-d*d-h*h));return b};a.dot=b.dot;a.lerp=b.lerp;a.slerp=function(a,b,c,d){var h=a[0],r=a[1],q=a[2];a=a[3];var w=b[0],v=b[1],p=b[2];b=b[3];var B,x,n;x=h*w+r*v+q*p+a*b;0>x&&(x=-x,w=-w,v=-v,
p=-p,b=-b);1E-6<1-x?(B=Math.acos(x),n=Math.sin(B),x=Math.sin((1-c)*B)/n,c=Math.sin(c*B)/n):x=1-c;d[0]=x*h+c*w;d[1]=x*r+c*v;d[2]=x*q+c*p;d[3]=x*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],h=a[2],r=a[3],q=c*c+d*d+h*h+r*r,q=q?1/q:0;b[0]=-c*q;b[1]=-d*q;b[2]=-h*q;b[3]=r*q;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=b.length;a.len=a.length;a.squaredLength=b.squaredLength;a.sqrLen=a.squaredLength;a.normalize=b.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var h=(d+1)%3,r=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*h+h]-a[3*r+r]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*h+r]-a[3*r+h])*c;b[h]=(a[3*h+d]+a[3*d+h])*c;b[r]=(a[3*r+d]+a[3*d+r])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new p(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=
a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var h=a[1],d=a[2],f=a[5];b[1]=a[3];b[2]=a[6];b[3]=h;b[5]=a[7];b[6]=d;b[7]=f}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var h=a[0],d=a[1],f=a[2],k=a[3],g=a[4],m=a[5],l=a[6],r=a[7],q=a[8],w=q*g-m*r,v=-q*k+m*l,p=
r*k-g*l,B=h*w+d*v+f*p;if(!B)return null;B=1/B;b[0]=w*B;b[1]=(-q*d+f*r)*B;b[2]=(m*d-f*g)*B;b[3]=v*B;b[4]=(q*h-f*l)*B;b[5]=(-m*h+f*k)*B;b[6]=p*B;b[7]=(-r*h+d*l)*B;b[8]=(g*h-d*k)*B;return b};a.adjoint=function(a,b){var h=a[0],d=a[1],f=a[2],k=a[3],g=a[4],m=a[5],l=a[6],r=a[7],q=a[8];b[0]=g*q-m*r;b[1]=f*r-d*q;b[2]=d*m-f*g;b[3]=m*l-k*q;b[4]=h*q-f*l;b[5]=f*k-h*m;b[6]=k*r-g*l;b[7]=d*l-h*r;b[8]=h*g-d*k;return b};a.determinant=function(a){var b=a[3],h=a[4],d=a[5],f=a[6],k=a[7],g=a[8];return a[0]*(g*h-d*k)+a[1]*
(-g*b+d*f)+a[2]*(k*b-h*f)};a.multiply=function(a,b,h){var d=a[0],f=a[1],k=a[2],g=a[3],m=a[4],l=a[5],r=a[6],q=a[7];a=a[8];var w=b[0],v=b[1],p=b[2],B=b[3],x=b[4],n=b[5],e=b[6],H=b[7];b=b[8];h[0]=w*d+v*g+p*r;h[1]=w*f+v*m+p*q;h[2]=w*k+v*l+p*a;h[3]=B*d+x*g+n*r;h[4]=B*f+x*m+n*q;h[5]=B*k+x*l+n*a;h[6]=e*d+H*g+b*r;h[7]=e*f+H*m+b*q;h[8]=e*k+H*l+b*a;return h};a.mul=a.multiply;a.translate=function(a,b,h){var d=a[0],f=a[1],k=a[2],g=a[3],m=a[4],l=a[5],r=a[6],q=a[7];a=a[8];var w=b[0];b=b[1];h[0]=d;h[1]=f;h[2]=k;
h[3]=g;h[4]=m;h[5]=l;h[6]=w*d+b*g+r;h[7]=w*f+b*m+q;h[8]=w*k+b*l+a;return h};a.rotate=function(a,b,h){var d=a[0],f=a[1],k=a[2],g=a[3],m=a[4],l=a[5],r=a[6],q=a[7];a=a[8];var w=Math.sin(b);b=Math.cos(b);h[0]=b*d+w*g;h[1]=b*f+w*m;h[2]=b*k+w*l;h[3]=b*g-w*d;h[4]=b*m-w*f;h[5]=b*l-w*k;h[6]=r;h[7]=q;h[8]=a;return h};a.scale=function(a,b,h){var d=b[0];b=b[1];h[0]=d*a[0];h[1]=d*a[1];h[2]=d*a[2];h[3]=b*a[3];h[4]=b*a[4];h[5]=b*a[5];h[6]=a[6];h[7]=a[7];h[8]=a[8];return h};a.iw=function(a,b){b[0]=1;b[1]=0;b[2]=
0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.gw=function(a,b){var h=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=h;b[2]=0;b[3]=-h;b[4]=d;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.hw=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var h=a[0],d=a[1],f=a[2],k=a[3],g=h+h,m=d+d,l=f+f,h=h*g,r=d*g,d=d*m,q=f*g,w=
f*m,f=f*l,g=k*g,m=k*m,k=k*l;b[0]=1-d-f;b[3]=r-k;b[6]=q+m;b[1]=r+k;b[4]=1-h-f;b[7]=w-g;b[2]=q-m;b[5]=w+g;b[8]=1-h-d;return b};a.normalFromMat4=function(a,b){var h=a[0],d=a[1],f=a[2],k=a[3],g=a[4],m=a[5],l=a[6],r=a[7],q=a[8],w=a[9],v=a[10],p=a[11],B=a[12],x=a[13],n=a[14],e=a[15],H=h*m-d*g,G=h*l-f*g,y=h*r-k*g,A=d*l-f*m,D=d*r-k*m,L=f*r-k*l,C=q*x-w*B,I=q*n-v*B,q=q*e-p*B,J=w*n-v*x,w=w*e-p*x,v=v*e-p*n,p=H*v-G*w+y*J+A*q-D*I+L*C;if(!p)return null;p=1/p;b[0]=(m*v-l*w+r*J)*p;b[1]=(l*q-g*v-r*I)*p;b[2]=(g*w-m*
q+r*C)*p;b[3]=(f*w-d*v-k*J)*p;b[4]=(h*v-f*q+k*I)*p;b[5]=(d*q-h*w-k*C)*p;b[6]=(x*L-n*D+e*A)*p;b[7]=(n*y-B*L-e*G)*p;b[8]=(B*D-x*y+e*H)*p;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.fw=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new p(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];b[1]=
a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var h=a[1],d=a[2],f=a[3],k=a[6],g=a[7],m=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=h;b[6]=a[9];b[7]=a[13];b[8]=d;b[9]=k;b[11]=a[14];b[12]=f;b[13]=g;
b[14]=m}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var h=a[0],d=a[1],f=a[2],k=a[3],g=a[4],m=a[5],l=a[6],r=a[7],q=a[8],w=a[9],v=a[10],p=a[11],B=a[12],x=a[13],n=a[14],e=a[15],H=h*m-d*g,G=h*l-f*g,y=h*r-k*g,A=d*l-f*m,D=d*r-k*m,L=f*r-k*l,C=q*x-w*B,I=q*n-v*B,J=q*e-p*B,Q=w*n-v*x,N=w*e-p*x,u=v*e-p*n,P=H*u-G*N+y*Q+A*J-D*I+L*C;if(!P)return null;
P=1/P;b[0]=(m*u-l*N+r*Q)*P;b[1]=(f*N-d*u-k*Q)*P;b[2]=(x*L-n*D+e*A)*P;b[3]=(v*D-w*L-p*A)*P;b[4]=(l*J-g*u-r*I)*P;b[5]=(h*u-f*J+k*I)*P;b[6]=(n*y-B*L-e*G)*P;b[7]=(q*L-v*y+p*G)*P;b[8]=(g*N-m*J+r*C)*P;b[9]=(d*J-h*N-k*C)*P;b[10]=(B*D-x*y+e*H)*P;b[11]=(w*y-q*D-p*H)*P;b[12]=(m*I-g*Q-l*C)*P;b[13]=(h*Q-d*I+f*C)*P;b[14]=(x*G-B*A-n*H)*P;b[15]=(q*A-w*G+v*H)*P;return b};a.adjoint=function(a,b){var h=a[0],d=a[1],f=a[2],k=a[3],g=a[4],m=a[5],l=a[6],r=a[7],q=a[8],w=a[9],v=a[10],p=a[11],B=a[12],x=a[13],n=a[14],e=a[15];
b[0]=m*(v*e-p*n)-w*(l*e-r*n)+x*(l*p-r*v);b[1]=-(d*(v*e-p*n)-w*(f*e-k*n)+x*(f*p-k*v));b[2]=d*(l*e-r*n)-m*(f*e-k*n)+x*(f*r-k*l);b[3]=-(d*(l*p-r*v)-m*(f*p-k*v)+w*(f*r-k*l));b[4]=-(g*(v*e-p*n)-q*(l*e-r*n)+B*(l*p-r*v));b[5]=h*(v*e-p*n)-q*(f*e-k*n)+B*(f*p-k*v);b[6]=-(h*(l*e-r*n)-g*(f*e-k*n)+B*(f*r-k*l));b[7]=h*(l*p-r*v)-g*(f*p-k*v)+q*(f*r-k*l);b[8]=g*(w*e-p*x)-q*(m*e-r*x)+B*(m*p-r*w);b[9]=-(h*(w*e-p*x)-q*(d*e-k*x)+B*(d*p-k*w));b[10]=h*(m*e-r*x)-g*(d*e-k*x)+B*(d*r-k*m);b[11]=-(h*(m*p-r*w)-g*(d*p-k*w)+q*
(d*r-k*m));b[12]=-(g*(w*n-v*x)-q*(m*n-l*x)+B*(m*v-l*w));b[13]=h*(w*n-v*x)-q*(d*n-f*x)+B*(d*v-f*w);b[14]=-(h*(m*n-l*x)-g*(d*n-f*x)+B*(d*l-f*m));b[15]=h*(m*v-l*w)-g*(d*v-f*w)+q*(d*l-f*m);return b};a.determinant=function(a){var b=a[0],h=a[1],d=a[2],f=a[3],k=a[4],g=a[5],m=a[6],l=a[7],r=a[8],q=a[9],w=a[10],v=a[11],p=a[12],B=a[13],x=a[14];a=a[15];return(b*g-h*k)*(w*a-v*x)-(b*m-d*k)*(q*a-v*B)+(b*l-f*k)*(q*x-w*B)+(h*m-d*g)*(r*a-v*p)-(h*l-f*g)*(r*x-w*p)+(d*l-f*m)*(r*B-q*p)};a.multiply=function(a,b,h){var d=
a[0],f=a[1],k=a[2],g=a[3],m=a[4],l=a[5],r=a[6],q=a[7],w=a[8],v=a[9],p=a[10],B=a[11],x=a[12],n=a[13],e=a[14];a=a[15];var H=b[0],G=b[1],y=b[2],A=b[3];h[0]=H*d+G*m+y*w+A*x;h[1]=H*f+G*l+y*v+A*n;h[2]=H*k+G*r+y*p+A*e;h[3]=H*g+G*q+y*B+A*a;H=b[4];G=b[5];y=b[6];A=b[7];h[4]=H*d+G*m+y*w+A*x;h[5]=H*f+G*l+y*v+A*n;h[6]=H*k+G*r+y*p+A*e;h[7]=H*g+G*q+y*B+A*a;H=b[8];G=b[9];y=b[10];A=b[11];h[8]=H*d+G*m+y*w+A*x;h[9]=H*f+G*l+y*v+A*n;h[10]=H*k+G*r+y*p+A*e;h[11]=H*g+G*q+y*B+A*a;H=b[12];G=b[13];y=b[14];A=b[15];h[12]=H*d+
G*m+y*w+A*x;h[13]=H*f+G*l+y*v+A*n;h[14]=H*k+G*r+y*p+A*e;h[15]=H*g+G*q+y*B+A*a;return h};a.mul=a.multiply;a.translate=function(a,b,h){var d=b[0],f=b[1];b=b[2];var k,g,m,l,r,q,p,v,E,B,x,n;a===h?(h[12]=a[0]*d+a[4]*f+a[8]*b+a[12],h[13]=a[1]*d+a[5]*f+a[9]*b+a[13],h[14]=a[2]*d+a[6]*f+a[10]*b+a[14],h[15]=a[3]*d+a[7]*f+a[11]*b+a[15]):(k=a[0],g=a[1],m=a[2],l=a[3],r=a[4],q=a[5],p=a[6],v=a[7],E=a[8],B=a[9],x=a[10],n=a[11],h[0]=k,h[1]=g,h[2]=m,h[3]=l,h[4]=r,h[5]=q,h[6]=p,h[7]=v,h[8]=E,h[9]=B,h[10]=x,h[11]=n,
h[12]=k*d+r*f+E*b+a[12],h[13]=g*d+q*f+B*b+a[13],h[14]=m*d+p*f+x*b+a[14],h[15]=l*d+v*f+n*b+a[15]);return h};a.scale=function(a,b,h){var d=b[0],f=b[1];b=b[2];h[0]=a[0]*d;h[1]=a[1]*d;h[2]=a[2]*d;h[3]=a[3]*d;h[4]=a[4]*f;h[5]=a[5]*f;h[6]=a[6]*f;h[7]=a[7]*f;h[8]=a[8]*b;h[9]=a[9]*b;h[10]=a[10]*b;h[11]=a[11]*b;h[12]=a[12];h[13]=a[13];h[14]=a[14];h[15]=a[15];return h};a.rotate=function(a,b,h,d){var f=h[0],k=h[1];h=h[2];var g=Math.sqrt(f*f+k*k+h*h),m,l,r,q,p,v,E,B,x,n,e,H,G,y,A,D,L,C,I,J;if(1E-7>Math.abs(g))return null;
g=1/g;f*=g;k*=g;h*=g;m=Math.sin(b);l=Math.cos(b);r=1-l;b=a[0];g=a[1];q=a[2];p=a[3];v=a[4];E=a[5];B=a[6];x=a[7];n=a[8];e=a[9];H=a[10];G=a[11];y=f*f*r+l;A=k*f*r+h*m;D=h*f*r-k*m;L=f*k*r-h*m;C=k*k*r+l;I=h*k*r+f*m;J=f*h*r+k*m;f=k*h*r-f*m;k=h*h*r+l;d[0]=b*y+v*A+n*D;d[1]=g*y+E*A+e*D;d[2]=q*y+B*A+H*D;d[3]=p*y+x*A+G*D;d[4]=b*L+v*C+n*I;d[5]=g*L+E*C+e*I;d[6]=q*L+B*C+H*I;d[7]=p*L+x*C+G*I;d[8]=b*J+v*f+n*k;d[9]=g*J+E*f+e*k;d[10]=q*J+B*f+H*k;d[11]=p*J+x*f+G*k;a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);
return d};a.rotateX=function(a,b,h){var d=Math.sin(b);b=Math.cos(b);var f=a[4],k=a[5],g=a[6],m=a[7],l=a[8],r=a[9],q=a[10],p=a[11];a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[4]=f*b+l*d;h[5]=k*b+r*d;h[6]=g*b+q*d;h[7]=m*b+p*d;h[8]=l*b-f*d;h[9]=r*b-k*d;h[10]=q*b-g*d;h[11]=p*b-m*d;return h};a.rotateY=function(a,b,h){var d=Math.sin(b);b=Math.cos(b);var f=a[0],k=a[1],g=a[2],m=a[3],l=a[8],r=a[9],q=a[10],p=a[11];a!==h&&(h[4]=a[4],h[5]=a[5],h[6]=a[6],
h[7]=a[7],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[0]=f*b-l*d;h[1]=k*b-r*d;h[2]=g*b-q*d;h[3]=m*b-p*d;h[8]=f*d+l*b;h[9]=k*d+r*b;h[10]=g*d+q*b;h[11]=m*d+p*b;return h};a.rotateZ=function(a,b,h){var d=Math.sin(b);b=Math.cos(b);var f=a[0],k=a[1],g=a[2],m=a[3],l=a[4],r=a[5],q=a[6],p=a[7];a!==h&&(h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[0]=f*b+l*d;h[1]=k*b+r*d;h[2]=g*b+q*d;h[3]=m*b+p*d;h[4]=l*b-f*d;h[5]=r*b-k*d;h[6]=q*b-g*d;h[7]=p*b-m*d;return h};
a.iw=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.hw=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.gw=function(a,b,h){var d=b[0],f=b[1];b=b[2];var k=Math.sqrt(d*d+f*f+b*b),g;if(1E-7>Math.abs(k))return null;k=1/k;d*=k;f*=k;b*=k;k=Math.sin(a);a=Math.cos(a);g=1-a;h[0]=d*d*g+a;h[1]=f*d*g+b*
k;h[2]=b*d*g-f*k;h[3]=0;h[4]=d*f*g-b*k;h[5]=f*f*g+a;h[6]=b*f*g+d*k;h[7]=0;h[8]=d*b*g+f*k;h[9]=f*b*g-d*k;h[10]=b*b*g+a;h[11]=0;h[12]=0;h[13]=0;h[14]=0;h[15]=1;return h};a.VB=function(a,b){var h=Math.sin(a),d=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=d;b[6]=h;b[7]=0;b[8]=0;b[9]=-h;b[10]=d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.WB=function(a,b){var h=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=0;b[2]=-h;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=h;b[9]=0;b[10]=d;b[11]=0;b[12]=0;b[13]=0;
b[14]=0;b[15]=1;return b};a.XB=function(a,b){var h=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=h;b[2]=0;b[3]=0;b[4]=-h;b[5]=d;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,h){var d=a[0],f=a[1],k=a[2],g=a[3],m=d+d,l=f+f,r=k+k;a=d*m;var q=d*l,d=d*r,p=f*l,f=f*r,k=k*r,m=g*m,l=g*l,g=g*r;h[0]=1-(p+k);h[1]=q+g;h[2]=d-l;h[3]=0;h[4]=q-g;h[5]=1-(a+k);h[6]=f+m;h[7]=0;h[8]=d+l;h[9]=f-m;h[10]=1-(a+p);h[11]=0;h[12]=b[0];h[13]=b[1];h[14]=b[2];
h[15]=1;return h};a.fromQuat=function(a,b){var h=a[0],d=a[1],f=a[2],k=a[3],g=h+h,m=d+d,l=f+f,h=h*g,r=d*g,d=d*m,q=f*g,p=f*m,f=f*l,g=k*g,m=k*m,k=k*l;b[0]=1-d-f;b[1]=r+k;b[2]=q-m;b[3]=0;b[4]=r-k;b[5]=1-h-f;b[6]=p+g;b[7]=0;b[8]=q+m;b[9]=p-g;b[10]=1-h-d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,h,d,f,k,g){var m=1/(b-a),l=1/(d-h),r=1/(f-k);g[0]=2*f*m;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2*f*l;g[6]=0;g[7]=0;g[8]=(b+a)*m;g[9]=(d+h)*l;g[10]=(k+f)*r;g[11]=-1;g[12]=0;g[13]=0;g[14]=
k*f*2*r;g[15]=0;return g};a.perspective=function(a,b,h,d,f){a=1/Math.tan(a/2);var k=1/(h-d);f[0]=a/b;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=(d+h)*k;f[11]=-1;f[12]=0;f[13]=0;f[14]=2*d*h*k;f[15]=0;return f};a.XC=function(a,b,h,d){var f=Math.tan(a.oD*Math.PI/180),k=Math.tan(a.IB*Math.PI/180),g=Math.tan(a.HC*Math.PI/180);a=Math.tan(a.ZC*Math.PI/180);var m=2/(g+a),l=2/(f+k);d[0]=m;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=l;d[6]=0;d[7]=0;d[8]=-((g-a)*m*.5);d[9]=(f-k)*l*.5;d[10]=h/
(b-h);d[11]=-1;d[12]=0;d[13]=0;d[14]=h*b/(b-h);d[15]=0;return d};a.ortho=function(a,b,h,d,f,k,g){var m=1/(a-b),l=1/(h-d),r=1/(f-k);g[0]=-2*m;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=-2*l;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=2*r;g[11]=0;g[12]=(a+b)*m;g[13]=(d+h)*l;g[14]=(k+f)*r;g[15]=1;return g};a.lookAt=function(c,b,h,d){var f,k,g,m,l,r,q,p,v=c[0],E=c[1];c=c[2];g=h[0];m=h[1];k=h[2];q=b[0];h=b[1];f=b[2];if(1E-7>Math.abs(v-q)&&1E-7>Math.abs(E-h)&&1E-7>Math.abs(c-f))return a.identity(d);b=v-q;h=E-h;q=c-f;p=1/Math.sqrt(b*
b+h*h+q*q);b*=p;h*=p;q*=p;f=m*q-k*h;k=k*b-g*q;g=g*h-m*b;(p=Math.sqrt(f*f+k*k+g*g))?(p=1/p,f*=p,k*=p,g*=p):g=k=f=0;m=h*g-q*k;l=q*f-b*g;r=b*k-h*f;(p=Math.sqrt(m*m+l*l+r*r))?(p=1/p,m*=p,l*=p,r*=p):r=l=m=0;d[0]=f;d[1]=m;d[2]=b;d[3]=0;d[4]=k;d[5]=l;d[6]=h;d[7]=0;d[8]=g;d[9]=r;d[10]=q;d[11]=0;d[12]=-(f*v+k*E+g*c);d[13]=-(m*v+l*E+r*c);d[14]=-(b*v+h*E+q*c);d[15]=1;return d};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.fw=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.__gpp_eval=function(a){a.Qq=function(){function a(c,b,h,d,f,k){this.message=c;this.offset=d;this.Yh=f;this.og=k;this.name="SyntaxError"}(function(a,b){function h(){this.constructor=a}h.prototype=b.prototype;a.prototype=new h})(a,Error);return{SyntaxError:a,parse:function(c){function b(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function h(a){if(Jb!==a){Jb>a&&(Jb=0,lb={Yh:1,og:1,qi:!1});var b=lb,d,e;for(d=
Jb;d<a;d++)e=c.charAt(d),"\n"===e?(b.qi||b.Yh++,b.og=1,b.qi=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(b.Yh++,b.og=1,b.qi=!0):(b.og++,b.qi=!1);Jb=a}return lb}function d(a){F<Da||(F>Da&&(Da=F,ib=[]),ib.push(a))}function f(){var a,b,e;a=F;b=Y();b!==z?(b=k(),b!==z?(e=Y(),e!==z?(U++,10===c.charCodeAt(F)?(e=mc,F++):(e=z,0===U&&d(tb)),e===z&&(c.substr(F,2)===hb?(e=hb,F+=2):(e=z,0===U&&d(nc)),e===z&&(13===c.charCodeAt(F)?(e=ic,F++):(e=z,0===U&&d($a)))),U--,e===z&&0===U&&d(Xb),e===z&&(e=null),e!==z?a=b:(F=
a,a=z)):(F=a,a=z)):(F=a,a=z)):(F=a,a=z);return a}function k(){var a,b,e,f,h,l,k,n;a=F;b=g();if(b!==z){e=[];f=F;h=Y();h!==z?(44===c.charCodeAt(F)?(l=ea,F++):(l=z,0===U&&d(O)),l!==z?(k=Y(),k!==z?(n=g(),n!==z?f=h=[h,l,k,n]:(F=f,f=z)):(F=f,f=z)):(F=f,f=z)):(F=f,f=z);for(;f!==z;)e.push(f),f=F,h=Y(),h!==z?(44===c.charCodeAt(F)?(l=ea,F++):(l=z,0===U&&d(O)),l!==z?(k=Y(),k!==z?(n=g(),n!==z?f=h=[h,l,k,n]:(F=f,f=z)):(F=f,f=z)):(F=f,f=z)):(F=f,f=z);e!==z?a=b=0==e.length?b:e[e.length-1]:(F=a,a=z)}else F=a,a=z;
return a}function g(){var a,b,e,f;a=F;b=m();b!==z?(e=Y(),e!==z?(63===c.charCodeAt(F)?(e=T,F++):(e=z,0===U&&d(W)),e!==z?(e=Y(),e!==z?(e=k(),e!==z?(f=Y(),f!==z?(58===c.charCodeAt(F)?(f=ma,F++):(f=z,0===U&&d(oa)),f!==z?(f=Y(),f!==z?(f=k(),f!==z?a=b?e:f:(F=a,a=z)):(F=a,a=z)):(F=a,a=z)):(F=a,a=z)):(F=a,a=z)):(F=a,a=z)):(F=a,a=z)):(F=a,a=z)):(F=a,a=z);a===z&&(a=m());return a}function m(){var a,b,c,d,e,f,g,h;a=F;b=l();if(b!==z){c=[];d=F;e=Y();e!==z?(f=fa(),f!==z?(g=Y(),g!==z?(h=l(),h!==z?d=e=[e,f,g,h]:(F=
d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);for(;d!==z;)c.push(d),d=F,e=Y(),e!==z?(f=fa(),f!==z?(g=Y(),g!==z?(h=l(),h!==z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);if(c!==z)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else F=a,a=z}else F=a,a=z;return a}function l(){var a,b,c,d,e,f,g,h;a=F;b=r();if(b!==z){c=[];d=F;e=Y();e!==z?(f=V(),f!==z?(g=Y(),g!==z?(h=r(),h!==z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);for(;d!==z;)c.push(d),d=F,e=Y(),e!==z?(f=V(),f!==z?(g=Y(),g!==z?(h=r(),h!==
z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);if(c!==z)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else F=a,a=z}else F=a,a=z;return a}function r(){var a,b,c,d,e,f,g,h;a=F;b=q();if(b!==z){c=[];d=F;e=Y();e!==z?(f=Z(),f!==z?(g=Y(),g!==z?(h=q(),h!==z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);for(;d!==z;)c.push(d),d=F,e=Y(),e!==z?(f=Z(),f!==z?(g=Y(),g!==z?(h=q(),h!==z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);if(c!==z)for(a=b,b=0;b<c.length;b++)a|=c[b][3];else F=
a,a=z}else F=a,a=z;return a}function q(){var a,b,c,d,e,f,g,h;a=F;b=w();if(b!==z){c=[];d=F;e=Y();e!==z?(f=S(),f!==z?(g=Y(),g!==z?(h=w(),h!==z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);for(;d!==z;)c.push(d),d=F,e=Y(),e!==z?(f=S(),f!==z?(g=Y(),g!==z?(h=w(),h!==z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);if(c!==z)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else F=a,a=z}else F=a,a=z;return a}function w(){var a,b,c,d,e,f,g,h;a=F;b=v();if(b!==z){c=[];d=F;e=Y();e!==z?(f=P(),f!==z?
(g=Y(),g!==z?(h=v(),h!==z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);for(;d!==z;)c.push(d),d=F,e=Y(),e!==z?(f=P(),f!==z?(g=Y(),g!==z?(h=v(),h!==z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);if(c!==z)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else F=a,a=z}else F=a,a=z;return a}function v(){var a,b,c,d,e,f,g,h;a=F;b=E();if(b!==z){c=[];d=F;e=Y();e!==z?(f=u(),f!==z?(g=Y(),g!==z?(h=E(),h!==z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);for(;d!==z;)c.push(d),d=F,e=Y(),
e!==z?(f=u(),f!==z?(g=Y(),g!==z?(h=E(),h!==z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);if(c!==z)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else F=a,a=z}else F=a,a=z;return a}function E(){var a,b,c,d,e,f,g,h;a=F;b=B();if(b!==z){c=[];d=F;e=Y();e!==z?(f=N(),f!==z?(g=Y(),g!==z?(h=B(),h!==z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);for(;d!==z;)c.push(d),d=F,e=Y(),e!==z?(f=N(),f!==z?(g=Y(),g!==z?(h=B(),h!==z?d=e=[e,f,g,h]:
(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);if(c!==z)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else F=a,a=z}else F=a,a=z;return a}function B(){var a,b,c,d,e,f,g,h;a=F;b=x();if(b!==z){c=[];d=F;e=Y();e!==z?(f=Q(),f!==z?(g=Y(),g!==z?(h=x(),h!==z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);for(;d!==z;)c.push(d),d=F,e=Y(),e!==z?(f=Q(),f!==z?(g=Y(),g!==z?(h=x(),h!==z?d=e=[e,f,g,h]:(F=d,
d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);if(c!==z)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else F=a,a=z}else F=a,a=z;return a}function x(){var a,b,c,d,e,f,g,h;a=F;b=n();if(b!==z){c=[];d=F;e=Y();e!==z?(f=J(),f!==z?(g=Y(),g!==z?(h=n(),h!==z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);for(;d!==z;)c.push(d),d=F,e=Y(),e!==z?(f=J(),f!==z?(g=Y(),g!==z?(h=n(),h!==z?d=e=[e,f,g,h]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);if(c!==z)for(a=b,b=0;b<
c.length;b++)switch(c[b][1]){case "+":a+=c[b][3];break;case "-":a-=c[b][3]}else F=a,a=z}else F=a,a=z;return a}function n(){var a,b,c,d,f,g,h,l;a=F;b=e();if(b!==z){c=[];d=F;f=Y();f!==z?(g=I(),g!==z?(h=Y(),h!==z?(l=e(),l!==z?d=f=[f,g,h,l]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);for(;d!==z;)c.push(d),d=F,f=Y(),f!==z?(g=I(),g!==z?(h=Y(),h!==z?(l=e(),l!==z?d=f=[f,g,h,l]:(F=d,d=z)):(F=d,d=z)):(F=d,d=z)):(F=d,d=z);if(c!==z)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=
Math.floor(a/c[b][3]);break;case "%":a%=c[b][3]}else F=a,a=z}else F=a,a=z;return a}function e(){var a,f,g;a=F;c.substr(F,7)===ca?(f=ca,F+=7):(f=z,0===U&&d(ia));f!==z?(g=Y(),g!==z?(g=G(),g!==z?a=g:(F=a,a=z)):(F=a,a=z)):(F=a,a=z);if(a===z){a=F;f=H();if(f!==z)if(g=Y(),g!==z)if(c.substr(F,2)===Sa?(g=Sa,F+=2):(g=z,0===U&&d(ta)),g===z&&(c.substr(F,2)===Ea?(g=Ea,F+=2):(g=z,0===U&&d(xa))),g!==z){a:{a=f;switch(g){case "++":f=++a;break a;case "--":f=--a;break a}f=void 0}a=f}else F=a,a=z;else F=a,a=z;else F=
a,a=z;a===z&&(a=H());a===z&&(a=F,c.substr(F,2)===Sa?(f=Sa,F+=2):(f=z,0===U&&d(ta)),f===z&&(c.substr(F,2)===Ea?(f=Ea,F+=2):(f=z,0===U&&d(xa)),f===z&&(43===c.charCodeAt(F)?(f=qa,F++):(f=z,0===U&&d(bb)),f===z&&(45===c.charCodeAt(F)?(f=za,F++):(f=z,0===U&&d(Pa)),f===z&&(126===c.charCodeAt(F)?(f=Gb,F++):(f=z,0===U&&d(bc)),f===z&&(33===c.charCodeAt(F)?(f=Eb,F++):(f=z,0===U&&d(Hb))))))),f!==z?(g=Y(),g!==z?(g=e(),g!==z?a=f=b(f,g):(F=a,a=z)):(F=a,a=z)):(F=a,a=z))}return a}function H(){var a,b,e;U++;var f;
a=F;48===c.charCodeAt(F)?(b=da,F++):(b=z,0===U&&d(Aa));if(b!==z)if(ua.test(c.charAt(F))?(b=c.charAt(F),F++):(b=z,0===U&&d(Za)),b!==z){b=F;e=[];f=A();if(f!==z)for(;f!==z;)e.push(f),f=A();else e=z;b=e!==z?c.substring(b,F):e;b!==z?a=b=parseInt("0x"+b):(F=a,a=z)}else F=a,a=z;else F=a,a=z;if(a===z){a=F;48===c.charCodeAt(F)?(b=da,F++):(b=z,0===U&&d(Aa));if(b===z)if(b=F,Db.test(c.charAt(F))?(e=c.charAt(F),F++):(e=z,0===U&&d(ja)),e!==z){var g;f=[];g=y();if(g!==z)for(;g!==z;)f.push(g),g=y();else f=z;f===z&&
(f=null);f!==z?b=e=[e,f]:(F=b,b=z)}else F=b,b=z;a=b!==z?c.substring(a,F):b;a!==z&&(a=parseInt(a))}U--;a===z&&0===U&&d(ba);a===z&&(b=D(),b!==z&&(b=0),a=b,a===z&&(a=F,40===c.charCodeAt(F)?(b=t,F++):(b=z,0===U&&d(K)),b!==z?(b=Y(),b!==z?(b=k(),b!==z?(e=Y(),e!==z?(41===c.charCodeAt(F)?(e=la,F++):(e=z,0===U&&d(Oa)),e!==z?a=b:(F=a,a=z)):(F=a,a=z)):(F=a,a=z)):(F=a,a=z)):(F=a,a=z)));return a}function G(){var a,b,e,f,g;b=D();b!==z&&(b=0);a=b;if(a===z){b=[];f=e=F;U++;40===c.charCodeAt(F)?(g=t,F++):(g=z,0===
U&&d(K));g===z&&(41===c.charCodeAt(F)?(g=la,F++):(g=z,0===U&&d(Oa)));U--;g===z?f=void 0:(F=f,f=z);f!==z?(g=R(),g!==z?e=f=[f,g]:(F=e,e=z)):(F=e,e=z);if(e!==z)for(;e!==z;)b.push(e),f=e=F,U++,40===c.charCodeAt(F)?(g=t,F++):(g=z,0===U&&d(K)),g===z&&(41===c.charCodeAt(F)?(g=la,F++):(g=z,0===U&&d(Oa))),U--,g===z?f=void 0:(F=f,f=z),f!==z?(g=R(),g!==z?e=f=[f,g]:(F=e,e=z)):(F=e,e=z);else b=z;b!==z&&(b=1);a=b;a===z&&(a=F,40===c.charCodeAt(F)?(b=t,F++):(b=z,0===U&&d(K)),b!==z?(e=Y(),e!==z?(f=G(),f!==z?(g=Y(),
g!==z?(41===c.charCodeAt(F)?(b=la,F++):(b=z,0===U&&d(Oa)),b!==z?a=f:(F=a,a=z)):(F=a,a=z)):(F=a,a=z)):(F=a,a=z)):(F=a,a=z))}return a}function y(){var a;Tb.test(c.charAt(F))?(a=c.charAt(F),F++):(a=z,0===U&&d(M));return a}function A(){var a;jb.test(c.charAt(F))?(a=c.charAt(F),F++):(a=z,0===U&&d(Ba));return a}function D(){var a,b;U++;b=a=F;U++;var e,f,g,h;e=F;c.substr(F,7)===ca?(f=ca,F+=7):(f=z,0===U&&d(ia));f!==z?(g=F,U++,h=C(),U--,h===z?g=void 0:(F=g,g=z),g!==z?e=f=[f,g]:(F=e,e=z)):(F=e,e=z);U--;e===
z?b=void 0:(F=b,b=z);if(b!==z){U++;b=F;e=L();if(e!==z){f=[];for(g=C();g!==z;)f.push(g),g=C();f!==z?b=e+=f.join(""):(F=b,b=z)}else F=b,b=z;U--;b===z&&0===U&&d(Ub);b!==z?a=b:(F=a,a=z)}else F=a,a=z;U--;a===z&&0===U&&d(Ub);return a}function L(){var a;lc.test(c.charAt(F))?(a=c.charAt(F),F++):(a=z,0===U&&d(na));a===z&&(36===c.charCodeAt(F)?(a=wb,F++):(a=z,0===U&&d(va)),a===z&&(95===c.charCodeAt(F)?(a=xb,F++):(a=z,0===U&&d(ra))));return a}function C(){var a;a=L();a===z&&(a=y());return a}function I(){var a,
b,e,f;a=F;42===c.charCodeAt(F)?(b=pb,F++):(b=z,0===U&&d(Nb));b===z&&(47===c.charCodeAt(F)?(b=eb,F++):(b=z,0===U&&d(Ga)),b===z&&(37===c.charCodeAt(F)?(b=Ha,F++):(b=z,0===U&&d(Ob))));b!==z?(e=F,U++,61===c.charCodeAt(F)?(f=qb,F++):(f=z,0===U&&d(fb)),U--,f===z?e=void 0:(F=e,e=z),e!==z?a=b:(F=a,a=z)):(F=a,a=z);return a}function J(){var a,b,e;a=F;43===c.charCodeAt(F)?(b=qa,F++):(b=z,0===U&&d(bb));b!==z?(b=F,U++,43===c.charCodeAt(F)?(e=qa,F++):(e=z,0===U&&d(bb)),e===z&&(61===c.charCodeAt(F)?(e=qb,F++):(e=
z,0===U&&d(fb))),U--,e===z?b=void 0:(F=b,b=z),b!==z?a="+":(F=a,a=z)):(F=a,a=z);a===z&&(a=F,45===c.charCodeAt(F)?(b=za,F++):(b=z,0===U&&d(Pa)),b!==z?(b=F,U++,45===c.charCodeAt(F)?(e=za,F++):(e=z,0===U&&d(Pa)),e===z&&(61===c.charCodeAt(F)?(e=qb,F++):(e=z,0===U&&d(fb))),U--,e===z?b=void 0:(F=b,b=z),b!==z?a="-":(F=a,a=z)):(F=a,a=z));return a}function Q(){var a;c.substr(F,2)===Fa?(a=Fa,F+=2):(a=z,0===U&&d(ob));a===z&&(c.substr(F,2)===Ia?(a=Ia,F+=2):(a=z,0===U&&d(Ua)));return a}function N(){var a;c.substr(F,
2)===zb?(a=zb,F+=2):(a=z,0===U&&d(rb));a===z&&(c.substr(F,2)===cb?(a=cb,F+=2):(a=z,0===U&&d(Vb)),a===z&&(60===c.charCodeAt(F)?(a=gb,F++):(a=z,0===U&&d(kb)),a===z&&(62===c.charCodeAt(F)?(a=Ka,F++):(a=z,0===U&&d(wa)))));return a}function u(){var a;c.substr(F,2)===Ab?(a=Ab,F+=2):(a=z,0===U&&d(sb));a===z&&(c.substr(F,2)===sa?(a=sa,F+=2):(a=z,0===U&&d(Pb)));return a}function P(){var a,b,e;a=F;38===c.charCodeAt(F)?(b=aa,F++):(b=z,0===U&&d(db));b!==z?(b=F,U++,38===c.charCodeAt(F)?(e=aa,F++):(e=z,0===U&&
d(db)),U--,e===z?b=void 0:(F=b,b=z),b!==z?a="&":(F=a,a=z)):(F=a,a=z);return a}function S(){var a,b,e;a=F;94===c.charCodeAt(F)?(b=Qa,F++):(b=z,0===U&&d(Ca));b!==z?(b=F,U++,94===c.charCodeAt(F)?(e=Qa,F++):(e=z,0===U&&d(Ca)),U--,e===z?b=void 0:(F=b,b=z),b!==z?a="^":(F=a,a=z)):(F=a,a=z);return a}function Z(){var a,b,e;a=F;124===c.charCodeAt(F)?(b=Ta,F++):(b=z,0===U&&d(yb));b!==z?(b=F,U++,124===c.charCodeAt(F)?(e=Ta,F++):(e=z,0===U&&d(yb)),U--,e===z?b=void 0:(F=b,b=z),b!==z?a="|":(F=a,a=z)):(F=a,a=z);
return a}function V(){var a;c.substr(F,2)===Fb?(a=Fb,F+=2):(a=z,0===U&&d(cc));a!==z&&(a="&&");return a}function fa(){var a;c.substr(F,2)===Bb?(a=Bb,F+=2):(a=z,0===U&&d(Ra));a!==z&&(a="||");return a}function Y(){var a,b;a=[];for(b=ha();b!==z;)a.push(b),b=ha();return a}function ha(){var a;U++;Ib.test(c.charAt(F))?(a=c.charAt(F),F++):(a=z,0===U&&d(dc));U--;a===z&&0===U&&d(Wb);return a}function R(){var a;c.length>F?(a=c.charAt(F),F++):(a=z,0===U&&d(oc));return a}var X=1<arguments.length?arguments[1]:
{},z={},pa={start:f},ga=f,ea=",",O={type:"literal",value:",",description:'","'},T="?",W={type:"literal",value:"?",description:'"?"'},ma=":",oa={type:"literal",value:":",description:'":"'},ca="defined",ia={type:"literal",value:"defined",description:'"defined"'},t="(",K={type:"literal",value:"(",description:'"("'},la=")",Oa={type:"literal",value:")",description:'")"'},ba={type:"other",description:"number"},da="0",Aa={type:"literal",value:"0",description:'"0"'},Tb=/^[0-9]/,M={type:"class",value:"[0-9]",
description:"[0-9]"},Db=/^[1-9]/,ja={type:"class",value:"[1-9]",description:"[1-9]"},ua=/^[xX]/,Za={type:"class",value:"[xX]",description:"[xX]"},jb=/^[0-9a-fA-F]/,Ba={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},Ub={type:"other",description:"identifier"},wb="$",va={type:"literal",value:"$",description:'"$"'},xb="_",ra={type:"literal",value:"_",description:'"_"'},lc=/^[a-zA-Z]/,na={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},Sa="++",ta={type:"literal",value:"++",description:'"++"'},
Ea="--",xa={type:"literal",value:"--",description:'"--"'},qa="+",bb={type:"literal",value:"+",description:'"+"'},za="-",Pa={type:"literal",value:"-",description:'"-"'},Gb="~",bc={type:"literal",value:"~",description:'"~"'},Eb="!",Hb={type:"literal",value:"!",description:'"!"'},pb="*",Nb={type:"literal",value:"*",description:'"*"'},eb="/",Ga={type:"literal",value:"/",description:'"/"'},Ha="%",Ob={type:"literal",value:"%",description:'"%"'},qb="=",fb={type:"literal",value:"=",description:'"="'},Fa=
"<<",ob={type:"literal",value:"<<",description:'"<<"'},Ia=">>",Ua={type:"literal",value:">>",description:'">>"'},zb="<=",rb={type:"literal",value:"<=",description:'"<="'},cb=">=",Vb={type:"literal",value:">=",description:'">="'},gb="<",kb={type:"literal",value:"<",description:'"<"'},Ka=">",wa={type:"literal",value:">",description:'">"'},Ab="==",sb={type:"literal",value:"==",description:'"=="'},sa="!=",Pb={type:"literal",value:"!=",description:'"!="'},aa="&",db={type:"literal",value:"&",description:'"&"'},
Qa="^",Ca={type:"literal",value:"^",description:'"^"'},Ta="|",yb={type:"literal",value:"|",description:'"|"'},Fb="&&",cc={type:"literal",value:"&&",description:'"&&"'},Bb="||",Ra={type:"literal",value:"||",description:'"||"'},Wb={type:"other",description:"whitespace"},Ib=/^[\t\x0B\f ]/,dc={type:"class",value:"[\\t\\v\\f ]",description:"[\\t\\v\\f ]"},Xb={type:"other",description:"end of line"},mc="\n",tb={type:"literal",value:"\n",description:'"\\n"'},hb="\r\n",nc={type:"literal",value:"\r\n",description:'"\\r\\n"'},
ic="\r",$a={type:"literal",value:"\r",description:'"\\r"'},oc={type:"any",description:"any character"},F=0,Jb=0,lb={Yh:1,og:1,qi:!1},Da=0,ib=[],U=0,Va;if("startRule"in X){if(!(X.Dr in pa))throw Error("Can't start parsing from rule \""+X.Dr+'".');ga=pa[X.Dr]}Va=ga();if(Va!==z&&F===c.length)return Va;Va!==z&&F<c.length&&d({type:"end",description:"end of input"});throw function(b,d,e){function f(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<
a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function g(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,
function(a){return"\\u"+b(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var l=h(e),k=e<c.length?c.charAt(e):null;null!==d&&f(d);return new a(null!==b?b:g(d,k),0,0,e,l.Yh,l.og)}(null,ib,Da);}}}()};b4w.module.__md5=function(a){function p(a,f){var m=a[0],l=a[1],r=a[2],q=a[3],m=b(m,l,r,q,f[0],7,-680876936),q=b(q,m,l,r,f[1],12,-389564586),r=b(r,q,m,l,f[2],17,606105819),l=b(l,r,q,m,f[3],22,-1044525330),m=b(m,l,r,q,f[4],7,-176418897),q=b(q,m,l,r,f[5],12,1200080426),r=b(r,q,m,l,f[6],17,-1473231341),l=b(l,r,q,m,f[7],22,-45705983),m=b(m,l,r,q,f[8],7,1770035416),q=b(q,m,l,r,f[9],12,-1958414417),r=b(r,q,m,l,f[10],17,-42063),l=b(l,r,q,m,f[11],22,-1990404162),m=b(m,l,r,q,f[12],7,1804603682),q=b(q,m,l,r,
f[13],12,-40341101),r=b(r,q,m,l,f[14],17,-1502002290),l=b(l,r,q,m,f[15],22,1236535329),m=h(m,l,r,q,f[1],5,-165796510),q=h(q,m,l,r,f[6],9,-1069501632),r=h(r,q,m,l,f[11],14,643717713),l=h(l,r,q,m,f[0],20,-373897302),m=h(m,l,r,q,f[5],5,-701558691),q=h(q,m,l,r,f[10],9,38016083),r=h(r,q,m,l,f[15],14,-660478335),l=h(l,r,q,m,f[4],20,-405537848),m=h(m,l,r,q,f[9],5,568446438),q=h(q,m,l,r,f[14],9,-1019803690),r=h(r,q,m,l,f[3],14,-187363961),l=h(l,r,q,m,f[8],20,1163531501),m=h(m,l,r,q,f[13],5,-1444681467),q=
h(q,m,l,r,f[2],9,-51403784),r=h(r,q,m,l,f[7],14,1735328473),l=h(l,r,q,m,f[12],20,-1926607734),m=c(l^r^q,m,l,f[5],4,-378558),q=c(m^l^r,q,m,f[8],11,-2022574463),r=c(q^m^l,r,q,f[11],16,1839030562),l=c(r^q^m,l,r,f[14],23,-35309556),m=c(l^r^q,m,l,f[1],4,-1530992060),q=c(m^l^r,q,m,f[4],11,1272893353),r=c(q^m^l,r,q,f[7],16,-155497632),l=c(r^q^m,l,r,f[10],23,-1094730640),m=c(l^r^q,m,l,f[13],4,681279174),q=c(m^l^r,q,m,f[0],11,-358537222),r=c(q^m^l,r,q,f[3],16,-722521979),l=c(r^q^m,l,r,f[6],23,76029189),m=
c(l^r^q,m,l,f[9],4,-640364487),q=c(m^l^r,q,m,f[12],11,-421815835),r=c(q^m^l,r,q,f[15],16,530742520),l=c(r^q^m,l,r,f[2],23,-995338651),m=d(m,l,r,q,f[0],6,-198630844),q=d(q,m,l,r,f[7],10,1126891415),r=d(r,q,m,l,f[14],15,-1416354905),l=d(l,r,q,m,f[5],21,-57434055),m=d(m,l,r,q,f[12],6,1700485571),q=d(q,m,l,r,f[3],10,-1894986606),r=d(r,q,m,l,f[10],15,-1051523),l=d(l,r,q,m,f[1],21,-2054922799),m=d(m,l,r,q,f[8],6,1873313359),q=d(q,m,l,r,f[15],10,-30611744),r=d(r,q,m,l,f[6],15,-1560198380),l=d(l,r,q,m,f[13],
21,1309151649),m=d(m,l,r,q,f[4],6,-145523070),q=d(q,m,l,r,f[11],10,-1120210379),r=d(r,q,m,l,f[2],15,718787259),l=d(l,r,q,m,f[9],21,-343485551);a[0]=m+a[0]&4294967295;a[1]=l+a[1]&4294967295;a[2]=r+a[2]&4294967295;a[3]=q+a[3]&4294967295}function c(a,b,c,d,f,h){b=(b+a&4294967295)+(d+h&4294967295)&4294967295;return(b<<f|b>>>32-f)+c&4294967295}function b(a,b,d,f,h,q,p){return c(b&d|~b&f,a,b,h,q,p)}function h(a,b,d,f,h,q,p){return c(b&f|d&~f,a,b,h,q,p)}function d(a,b,d,f,h,q,p){return c(d^(b|~f),a,b,h,
q,p)}var f="0123456789abcdef".split("");a.Pp=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var h=b.substring(d-64,d),q=[],w=void 0,w=0;64>w;w+=4)q[w>>2]=h.charCodeAt(w)+(h.charCodeAt(w+1)<<8)+(h.charCodeAt(w+2)<<16)+(h.charCodeAt(w+3)<<24);p(a,q)}b=b.substring(d-64);h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)h[d>>2]|=b.charCodeAt(d)<<(d%4<<3);h[d>>2]|=128<<(d%4<<3);if(55<d)for(p(a,h),d=0;16>d;d++)h[d]=0;h[14]=8*
c;p(a,h);for(b=0;b<a.length;b++){c=a[b];d="";for(h=0;4>h;h++)d+=f[c>>8*h+4&15]+f[c>>8*h&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["anchors.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",a:[{type:"var",name:"ANCHOR_NUM",b:["0"]},{type:"textline",b:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec4 a = u_view_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_Position = u_proj_matrix * a ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_glow_intensity",";"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_glow_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",
a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",
a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",
b:"void main ( ) { vec3 cl = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"cl = mix ( cl , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 cm = vec3 ( 0.0 ) ; vec3 cn = vec3 ( 0.0 ) ; vec3 co = vec3 ( 0.0 ) ; bt ( cl , cm , cn , co ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",
a:[{type:"textline",b:["vec3","cp","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cp = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 cq = ( u_model_matrix * vec4 ( cp , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 cr = ag ( u_camera_eye , cq , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 cr = aa ( u_camera_eye , cq , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 cs = ( u_model_matrix * vec4 ( cp , 1.0 ) ) . xyz ; cr = cr * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , cs ) ;".split(" ")}]}}]},{type:"textline",b:"d ct = an ( cl - cp , cp , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , cr ) ; ct . b = cq ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"d ct = an ( cl , cp , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","cu","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cu = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ck ( ct . a , ct . b , cu ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( ct . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ;".split(" ")}]}}]},{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"shadow.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:"float ft = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ft = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( ft < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cs ( cF ) ;".split(" ")}]}},
{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( fn ( cL . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"WIND_BEND && MAIN_BEND_COL && DETAIL_BEND || SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:"BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},
{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 gw = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"gw = mix ( gw , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 gx = vec3 ( 0.0 ) ; vec3 gy = vec3 ( 0.0 ) ; vec3 gz = vec3 ( 0.0 ) ; bt ( gw , gx , gy , gz ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","gA","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d gB = gh ( gw , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gA , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gC = ( u_model_matrix * vec4 ( gA , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! HAIR_BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["mat4","gD","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["mat4","gD",
"=","u_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 gE = ag ( u_camera_eye , gC , gD , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gE = aa ( u_camera_eye , gC , gD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 gF = ( u_model_matrix * vec4 ( gA , 1.0 ) ) . xyz ; gE = gE * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , gF ) ;".split(" ")}]}}]},
{type:"textline",b:"d gB = an ( gw - gA , gA , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gE ) ; gB . b = gC ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d gB = an ( gw , gA , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","gG","=","a_normal",
";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gG = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ck ( gB . a , gB . b , gG ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gH = u_view_matrix * vec4 ( gB . a , 1.0 ) ; vec4 gI = u_proj_matrix * gH ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"gI . xy += u_subpixel_jitter * gI . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gr ( gB . a ) ; cL = gH ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"cF = - gH . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 gJ = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; float gK = SHADOW_TEX_RES / 2.0 ; gJ = floor ( gJ * gK + 0.5 ) / gK - gJ ; gI . xy += gJ ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gI",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gw",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gw",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( gw , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , gw ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",
b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gw",";"]}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gw",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gx = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 gy = aa ( u_camera_eye , gx , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"gy = gy * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"d gz = an ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gy ) ; gz . b = gx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d gz = an ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gA = u_proj_matrix * u_view_matrix * vec4 ( gz . a , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gw = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["gw","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gw","=","a_grass_color",";"]}]}}]}]}}]},
{type:"textline",b:["gl_Position","=","gA",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 gE ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float gF ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",
">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int gG = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int gG = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float gI ( float gH ) { return gH - floor ( gH * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void gR ( inout float gJ , in float gK [ gG ] , in float gL ) { for ( int gM = 0 ; gM < NUM_RINGS ; gM ++ ) { float gN = 40.0 * gK [ gM ] ; float gO = 300.0 * ( gI ( gN ) - 0.005 ) ; float gP = gN ; float gQ = abs ( gP * ( u_halo_size * gO - gL ) ) ; gJ += 1.0 - min ( gQ , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void g_ ( inout float gS , in float gT [ gG ] , in float gU ) { for ( int gV = 0 ; gV < NUM_LINES ; gV ++ ) { float gW = gT [ gV ] ; float gX = gW ; float gY = 1000.0 * ( gI ( gW ) - 0.005 ) ; float gZ = 20.0 * abs ( gX * a . x + gY * a . y ) ; gS += 1.0 - min ( gZ , 1.0 ) ; } gS *= gU ; }".split(" ")}]}}]},{type:"textline",b:"void hg ( inout float ha , in vec2 hb ) { float hc , hd ; hd = atan ( hb . y , hb . x ) ; hd *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float he = cos ( hd ) ; float hf = sin ( hd ) ; hd = ( he * hb . x + hf * hb . y ) * ( he * hb . y - hf * hb . x ) ; hc = abs ( hd ) ; if ( hc < 1.0 ) { hc = ( 0.01 * u_halo_size ) / ( hc ) ; ha *= sqrt ( min ( hc , 1.0 ) ) ; } } void main ( ) { float hh = ( a . x * a . x + a . y * a . y ) ; float hi = sqrt ( hh ) ; hh = max ( 1.0 - hh , 0.0 ) ; hh = pow ( hh , u_halo_hardness ) ; float hj = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hk [ gG ] ; for ( int hl = 0 ; hl < gG ; hl ++ ) { hk [ hl ] = fract ( gF / ( float ( hl ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"float hm = 0.0 ; gR ( hm , hk , hi ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hn = 0.0 ; g_ ( hn , hk , hh ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"hg ( hh , a ) ;".split(" ")}]}}]},{type:"textline",b:"hh *= hj ; vec3 ho = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"hm *= hh ; ho += u_halo_rings_color * hm ; hh += hm ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"hn *= hj ; ho += u_halo_lines_color * hn ; hh += hn ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"hh *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float hp = u_halo_stars_blend * ( gE . y - u_halo_stars_height ) ; hh *= clamp ( hp , 0.0 , 1.0 ) ; hh *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"gA ( ho ) ; gD ( ho , hh ) ; gl_FragColor = vec4 ( ho , hh ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float gF ;".split(" ")},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gE",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 gG = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; a = a_halo_bb_vertex * 2.0 ; gF = fract ( gG . x + gG . y + gG . z ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",
a:[{type:"textline",b:"mat4 gH = z ( gG , u_view_matrix ) ; mat4 gI = u_view_matrix ; gI [ 3 ] [ 0 ] = 0.0 ; gI [ 3 ] [ 1 ] = 0.0 ; gI [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gH = z ( gG , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gJ = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 gK = gH * gJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"vec4 gL = u_proj_matrix * gI * gK ; gL . z = 0.99999 * gL . w ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["gE","=","gK",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 gL = u_proj_matrix * u_view_matrix * gK ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gL",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};
a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 gG = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( gG , 1.0 ) ; }".split(" ")}]};a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",
name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NORMAL_TEXCOORD","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",
b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",
";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_reflect_factor ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 kJ ; varying vec3 kK ; varying vec3 kL ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kM",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kN",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kO",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],
group:{type:"group",a:[{type:"textline",b:"float lz = kK . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["vec2","lA","=","a",";"]}]}}]},{type:"textline",b:["vec3","lB","=","kL",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) lB = lB ; else lB = - lB ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:"vec3 lC = cross ( lB , kM . xyz ) * kM . w ; mat3 lD = mat3 ( kM . xyz , lC , lB ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float lE = length ( cL ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"vec2 lF = normalize ( u_view_matrix_frag * vec4 ( kL , 0.0 ) ) . st ; lF = lF * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( lE < PARALLAX_LOD_DIST ) { float lG = clamp ( 0.5 * ( PARALLAX_LOD_DIST - lE ) , 0.0 , 1.0 ) ; float lH = u_parallax_scale * lG ; vec3 lI = normalize ( kJ * lD ) ; float lJ = 1.0 / PARALLAX_STEPS ; vec2 lK = lI . xy * lH / ( PARALLAX_STEPS * lI . z ) ; float lL = 1.0 ; float lM ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:["vec2","lN","=","lF",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","lN","=","lA",";"]}]}}]},{type:"textline",b:"lM = texture2D ( u_normalmap0 , lN ) . a ; for ( float lO = 1.0 ; lO <= PARALLAX_STEPS ; lO ++ ) { if ( lM < lL ) { lL -= lJ ; lN -= lK ; lM = texture2D ( u_normalmap0 , lN ) . a ; } } vec2 lP = lN + lK ; float lQ = texture2D ( u_normalmap0 , lP ) . a - ( lL + lJ ) ; float lR = lM - lL ; float lS = lR / ( lR - lQ ) ; lN = lS * lP + ( 1.0 - lS ) * lN ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lA += lN - lF ;".split(" ")}]}}]},{type:"textline",b:["lF","=","lN",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lF += lN - lA ;".split(" ")}]}}]},{type:"textline",b:["lA","=","lN",";"]}]}}]},{type:"textline",
b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["vec4","lT",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lT = texture2D ( u_normalmap0 , lF ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lT = texture2D ( u_normalmap0 , lA ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lU = lT . rgb - 0.5 ; lU = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , lU , u_normal_factor ) ; vec3 lV = lD * lU ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","lV","=","lB",";"]}]}}]},{type:"textline",b:"lV = normalize ( lV ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lF = normalize ( u_view_matrix_frag * vec4 ( lV , 0.0 ) ) . st ; lF = lF * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lW = normalize ( kJ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],
group:{type:"group",a:[{type:"textline",b:"vec3 lX = kN ; gy ( lX ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec4 lY = vec4 ( lX , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","lY","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["float","lZ","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:"vec4 l_ = texture2D ( u_colormap0 , lF ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec4 l_ = texture2D ( u_colormap0 , lA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"gy ( l_ . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","ma",
";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"ma = texture2D ( u_colormap1 , lF ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ma = texture2D ( u_colormap1 , lA ) ;".split(" ")}]}}]},{type:"textline",b:"gy ( ma . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec4 mb = texture2D ( u_stencil0 , lF ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 mb = texture2D ( u_stencil0 , lA ) ;".split(" ")}]}}]},{type:"textline",b:"l_ = mix ( l_ , ma , mb . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lY . rgb = mix ( lY . rgb , l_ . rgb , u_diffuse_color_factor ) ; float mc = u_alpha_factor * l_ . a ; mc += ( 1.0 - step ( 0.0 , mc ) ) ; lY . a = mix ( mc , 1.0 , u_diffuse_color . a ) ; lZ = l_ . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lY . rgb *= mix ( vec3 ( 1.0 ) , l_ . rgb , u_diffuse_color_factor ) ; lY . a = l_ . a ; lZ = l_ . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 md = u_diffuse_intensity * lY . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["vec3","me","=","md",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float mf = 0.5 * lV . y + 0.5 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 mg = u_environment_energy * textureCube ( u_sky_texture , lV ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mg = u_environment_energy * mix ( u_horizon_color , u_zenith_color , mf ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 mh = u_ambient * mg ; float mi = fs ( md ) ; vec3 mj = u_emit * lY . rgb ; vec3 mk = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"vec3 ml = vec3 ( lZ ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 ml = texture2D ( u_specmap0 , lF ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ml = texture2D ( u_specmap0 , lA ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"gy ( ml . rgb ) ; mk = mix ( mk , ml , u_specular_color_factor ) ;".split(" ")}]}}]},
{type:"textline",b:"float mm = u_specular_params [ 0 ] ; vec2 mn = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 mo = mm * mk ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS","==","0"],group:{type:"group",a:[{type:"textline",b:"hx mp = kh ( mj , mh , md ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hx mp = kc ( mj , mh , md , mo , kK , lV , lW , mn , u_diffuse_params , mi , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 me = mp . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["float","mq","=","u_reflect_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","mq","=","0.0",";"]}]}}]},{type:"textline",b:"lk ( me , lW , lV , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , mq ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"me += mp . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"me = max ( me - sqrt ( 0.01 * - min ( lz , 0.0 ) ) , 0.5 * me ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"kI ( me , lz , u_time , mi , lV , u_sun_direction , u_sun_intensity , u_sun_quaternion , kK , lE ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"float mr = lY . a ; if ( mr <= 0.5 ) discard ; mr = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float mr = lY . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"mr += mp . a . a * mo . r * u_specular_alpha ;".split(" ")}]}}]}]}}]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["float","mr","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"me = mix ( ly ( cK , lV . xz * u_refr_bump ) , me , mr ) ; mr = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float ms = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 mt = gS ( u_cube_fog , lW ) ; vec4 mu = vec4 ( mt , u_fog_color_density . a ) ; gy ( mu . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 mu = u_fog_color_density ; mu . rgb *= ms ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"hk ( me , lE , lW , u_cam_water_depth , u_underwater_fog_color_density , mu , lz , ms ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( me , lE , mu ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),group:{type:"group",a:[{type:"textline",b:"me = vec3 ( dT . a ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","me",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"gD ( me , mr ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( me , mr ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 kJ ; varying vec3 kK ; varying vec3 kL ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kM",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kN",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kO",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 lz = a_position ; vec3 lA = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec3 lB = vec3 ( a_tangent ) ; vec3 lC = a_tangent [ 3 ] * cross ( lA , lB ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 lD = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 lE = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vec3 lF = lD - u_camera_eye ; vec3 lC = cross ( lF , lE ) ; vec3 lB = cross ( lE , lC ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lB = vec3 ( 0.0 ) ; vec3 lC = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"lz = mix ( lz , a_position_next , u_va_frame_factor ) ; lA = mix ( lA , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vec3 lG = vec3 ( a_tangent ) ; vec3 lH = a_tangent_next [ 3 ] * cross ( a_normal_next , lG ) ; lB = mix ( lB , lG , u_va_frame_factor ) ; lC = mix ( lC , lH , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bt ( lz , lB , lC , lA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","lI","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lI = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d lJ = gh ( lz , lB , lC , lA , lI , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lK = ( u_model_matrix * vec4 ( lI , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 lL = ag ( u_camera_eye , lK , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 lL = aa ( u_camera_eye , lK , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lM = ( u_model_matrix * vec4 ( lI , 1.0 ) ) . xyz ; lL = lL * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lM ) ;".split(" ")}]}}]},{type:"textline",b:"d lJ = an ( lz - lI , lI , lB , lC , lA , lL ) ; lJ . b = lK ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d lJ = an ( lz , lI , lB , lC , lA , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"float lN = ( dot ( cross ( lJ . e , lJ . c ) , lJ . d ) < 0.0 ) ? - 1.0 : 1.0 ; kM = vec4 ( lJ . c , lN ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( lJ . a , lJ . b , lA ) ;".split(" ")}]}}]},{type:"textline",b:"kK = lJ . a ; kL = lJ . e ; kJ = u_camera_eye - lJ . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",
a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kN = lJ . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["kN","=","a_color",";"]}]}}]},{type:"textline",b:"vec4 lO = u_view_matrix * vec4 ( lJ . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),
group:{type:"group",a:[{type:"textline",b:["cL","=","lO",";"]}]}}]},{type:"textline",b:"vec4 lP = u_proj_matrix * lO ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"lP . xy += u_subpixel_jitter * lP . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gr","(","lP",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",
b:"gr ( lJ . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:"float lQ = lP . x ; float lR = lP . y ; float lS = lP . w ; cK . x = ( lQ + lS ) / 2.0 ; cK . y = ( lR + lS ) / 2.0 ; cK . z = lS ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kO = - lO . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position",
"=","lP",";","}"]}]};a["nodes.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_VALUES",b:["0"]},{type:"var",name:"NUM_RGBS",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",
")"]},{type:"var",name:"MAPPING_MAX_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"var",name:"RGB_IND",b:["0"]},{type:"var",name:"VALUE_IND",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",
file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_reflectmap ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_RGB"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 kK ; varying vec4 cL ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","kL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kM",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION",
"&&","USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["varying","float","kO",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 lz = vec3 ( ZERO_VALUE_NODES ) ; vec3 lA = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",
a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 lE ( in vec3 lB , in float lC ) { vec3 lD = lz ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"lD = ly ( cK , lB . xz * lC ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lD = texture2D ( u_refractmap , cK . xy / cK . z ) . rgb ; gy ( lD ) ;".split(" ")}]}}]},{type:"textline",b:["return","lD",";","}"]}]}}]},{type:"textline",b:"vec3 lH ( float lF , vec3 lG ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , lG ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return mix ( u_horizon_color , u_zenith_color , lF ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec3 lO ( vec3 lI ) { vec4 lJ = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; vec4 lK = mix ( vec4 ( lI . bg , lJ . wz ) , vec4 ( lI . gb , lJ . xy ) , step ( lI . b , lI . g ) ) ; vec4 lL = mix ( vec4 ( lK . xyw , lI . r ) , vec4 ( lI . r , lK . yzx ) , step ( lK . x , lI . r ) ) ; float lM = lL . x - min ( lL . w , lL . y ) ; float lN = 1.0e-10 ; return vec3 ( abs ( lL . z + ( lL . w - lL . y ) / ( 6.0 * lM + lN ) ) , lM / ( lL . x + lN ) , lL . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 lS ( vec3 lP ) { vec4 lQ = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; vec3 lR = abs ( fract ( vec3 ( lP . r , lP . r , lP . r ) + lQ . xyz ) * 6.0 - lQ . www ) ; return lP . b * mix ( lQ . xxx , clamp ( lR - lQ . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , lP . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_B4W_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 lU ( vec2 lT ) { return vec3 ( lT * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_TEXTURE_COLOR || USE_NODE_TEXTURE_NORMAL || USE_NODE_TEXTURE_COLOR2 || USE_NODE_TEXTURE_NORMAL2 || USE_NODE_TEXTURE_COLOR3 || USE_NODE_TEXTURE_NORMAL3 || USE_NODE_TEXTURE_NORMAL4 || USE_NODE_TEXTURE_COLOR4 || USE_NODE_B4W_PARALLAX".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lW ( vec3 lV ) { return vec2 ( lV . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},{type:"node",name:"CAMERA",k:[{type:"node_out",name:"mB",qualifier:["vec3"],e:!0},{type:"node_out",name:"mC",qualifier:["float"],e:!0},{type:"node_out",name:"mD",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mB"],f:[{type:"textline",b:"mB = normalize ( mr . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_mC"],f:[{type:"textline",b:"mC = abs ( mr . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mD"],f:[{type:"textline",b:"mD = length ( mr . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",k:[{type:"node_in",name:"mE",qualifier:["float"],e:!1},{type:"node_in",name:"mF",qualifier:["float"],e:!1},{type:"node_in",name:"mG",qualifier:["float"],e:!1},{type:"node_out",name:"mH",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mH = vec3 ( mE , mF , mG ) ;".split(" ")}]},
{type:"node",name:"COMBHSV",k:[{type:"node_in",name:"mI",qualifier:["float"],e:!1},{type:"node_in",name:"mJ",qualifier:["float"],e:!1},{type:"node_in",name:"mK",qualifier:["float"],e:!1},{type:"node_out",name:"mL",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mL = lS ( vec3 ( mI , mJ , mK ) ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_out",name:"mM",qualifier:["vec3"],e:!1},{type:"node_param",name:"lX",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"mM = lU ( lX ) ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC",k:[{type:"node_out",name:"mN",qualifier:["vec3"],e:!1},{type:"node_param",name:"lY",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["mN","=","lY",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_out",name:"mO",qualifier:["float"],e:!1},{type:"node_param",name:"lZ",qualifier:["varying","float"]}],f:[{type:"textline",b:["mO","=","lZ",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_out",name:"mP",qualifier:["float"],e:!1},{type:"node_out",name:"mQ",
qualifier:["float"],e:!1},{type:"node_param",name:"l_",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"mP = l_ [ 0 ] ; mQ = l_ [ 1 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_out",name:"mR",qualifier:["float"],e:!1},{type:"node_out",name:"mS",qualifier:["float"],e:!1},{type:"node_out",name:"mT",qualifier:["float"],e:!1},{type:"node_param",name:"ma",qualifier:["varying","vec3"]}],f:[{type:"textline",b:"mR = ma [ 0 ] ; mS = ma [ 1 ] ; mT = ma [ 2 ] ;".split(" ")}]},{type:"node",
name:"GEOMETRY_NO",k:[{type:"node_out",name:"mU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mU","=","mk",";"]}]},{type:"node",name:"GEOMETRY_FB",k:[{type:"node_out",name:"mV",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mV = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",k:[{type:"node_out",name:"mW",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mW","=","mp",";"]}]},{type:"node",name:"GEOMETRY_GL",k:[{type:"node_out",name:"mX",
qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mX = vec3 ( mq . r , - mq . b , mq . g ) ;".split(" ")}]},{type:"node",name:"HUE_SAT",k:[{type:"node_in",name:"mY",qualifier:["float"],e:!1},{type:"node_in",name:"mZ",qualifier:["float"],e:!1},{type:"node_in",name:"m_",qualifier:["float"],e:!1},{type:"node_in",name:"na",qualifier:["float"],e:!1},{type:"node_in",name:"nb",qualifier:["vec3"],e:!1},{type:"node_out",name:"nc",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ vec3 nd = lO ( nb ) ; nd [ 0 ] += ( mY - 0.5 ) ; if ( nd [ 0 ] > UNITY_VALUE_NODES ) nd [ 0 ] -= UNITY_VALUE_NODES ; else if ( nd [ 0 ] < ZERO_VALUE_NODES ) nd [ 0 ] += UNITY_VALUE_NODES ; nd *= vec3 ( UNITY_VALUE_NODES , mZ , m_ ) ; nd = mix ( lA , mix ( lz , nd , step ( lz , nd ) ) , step ( nd , lA ) ) ; nc = mix ( nb , lS ( nd ) , na ) ; }".split(" ")}]},
{type:"node",name:"INVERT",k:[{type:"node_in",name:"ne",qualifier:["float"],e:!1},{type:"node_in",name:"nf",qualifier:["vec3"],e:!1},{type:"node_out",name:"ng",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ng = mix ( nf , lA - nf , ne ) ;".split(" ")}]},{type:"node",name:"LAMP",k:[{type:"node_out",name:"nh",qualifier:["vec3"],e:!1},{type:"node_out",name:"ni",qualifier:["vec3"],e:!1},{type:"node_out",name:"nj",qualifier:["float"],e:!1},{type:"node_out",name:"nk",qualifier:["float"],e:!1},{type:"node_param",
name:"mb",qualifier:["const","float"]}],f:[{type:"textline",b:"{ const int nl = int ( mb ) ; nh = u_lamp_light_color_intensities [ nl ] ; vec4 nm = u_lamp_light_factors [ nl ] ; vec3 nn = u_lamp_light_directions [ nl ] ; vec3 no = u_lamp_light_positions [ nl ] ; float np = nm . z ; if ( np != - UNITY_VALUE_NODES ) { ni = no - kK ; nj = length ( ni ) ; ni = normalize ( ni ) ; nk = np / ( np + nj * nj ) ; float nq = nm . x ; float nr = nm . y ; if ( nq > - UNITY_VALUE_NODES ) { float ns = dot ( ni , nn ) ; ns *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( ns - nq ) / nr ) ; nk *= ns ; } } else { ni = nn ; nj = length ( no - kK ) ; nk = UNITY_VALUE_NODES ; } }".split(" ")}]},
{type:"node",name:"NORMAL",k:[{type:"node_in",name:"nt",qualifier:["vec3"],e:!1},{type:"node_out",name:"nu",qualifier:["vec3"],e:!0},{type:"node_out",name:"nv",qualifier:["float"],e:!0},{type:"node_param",name:"mc",qualifier:["vec3"]}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nu"],f:[{type:"textline",b:["nu","=","mc",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nv"],f:[{type:"textline",b:"nv = - dot ( nt , mc ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",
k:[{type:"node_in",name:"nw",qualifier:["vec3"],e:!1},{type:"node_out",name:"nx",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"nx = - ( u_view_matrix_frag * vec4 ( nw , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"MAPPING",k:[{type:"node_in",name:"ny",qualifier:["vec3"],e:!1},{type:"node_out",name:"nz",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["nz","=","ny",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",f:[{type:"textline",b:"nz = ( MAPPING_TRS_MATRIX * vec4 ( nz , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_SCALE",f:[{type:"textline",b:"nz = nz * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",f:[{type:"textline",b:"nz = nz + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",f:[{type:"textline",b:"nz = max ( nz , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",f:[{type:"textline",
b:"nz = min ( nz , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],f:[{type:"textline",b:"nz = normalize ( nz ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",k:[{type:"node_in",name:"nA",qualifier:["float"],e:!1},{type:"node_in",name:"nB",qualifier:["float"],e:!1},{type:"node_out",name:"nC",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nC = nA + nB ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",
b:"nC = clamp ( nC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",k:[{type:"node_in",name:"nD",qualifier:["float"],e:!1},{type:"node_in",name:"nE",qualifier:["float"],e:!1},{type:"node_out",name:"nF",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nF = nD - nE ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nF = clamp ( nF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_MULTIPLY",k:[{type:"node_in",name:"nG",qualifier:["float"],e:!1},{type:"node_in",name:"nH",qualifier:["float"],e:!1},{type:"node_out",name:"nI",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nI = nG * nH ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nI = clamp ( nI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",k:[{type:"node_in",name:"nJ",qualifier:["float"],e:!1},{type:"node_in",name:"nK",
qualifier:["float"],e:!1},{type:"node_out",name:"nL",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nL = ( nK != ZERO_VALUE_NODES ) ? nJ / nK : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nL = clamp ( nL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SINE",k:[{type:"node_in",name:"nM",qualifier:["float"],e:!1},{type:"node_in",name:"nN",qualifier:["float"],e:!1},{type:"node_out",name:"nO",
qualifier:["float"],e:!1}],f:[{type:"textline",b:"nO = sin ( nM ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nO = clamp ( nO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nN",";"]}]},{type:"node",name:"MATH_COSINE",k:[{type:"node_in",name:"nP",qualifier:["float"],e:!1},{type:"node_in",name:"nQ",qualifier:["float"],e:!1},{type:"node_out",name:"nR",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nR = cos ( nP ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nR = clamp ( nR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nQ",";"]}]},{type:"node",name:"MATH_TANGENT",k:[{type:"node_in",name:"nS",qualifier:["float"],e:!1},{type:"node_in",name:"nT",qualifier:["float"],e:!1},{type:"node_out",name:"nU",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nU = tan ( nS ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],
f:[{type:"textline",b:"nU = clamp ( nU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nT",";"]}]},{type:"node",name:"MATH_ARCSINE",k:[{type:"node_in",name:"nV",qualifier:["float"],e:!1},{type:"node_in",name:"nW",qualifier:["float"],e:!1},{type:"node_out",name:"nX",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nX = ( nV <= UNITY_VALUE_NODES && nV >= - UNITY_VALUE_NODES ) ? asin ( nV ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nX = clamp ( nX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nW",";"]}]},{type:"node",name:"MATH_ARCCOSINE",k:[{type:"node_in",name:"nY",qualifier:["float"],e:!1},{type:"node_in",name:"nZ",qualifier:["float"],e:!1},{type:"node_out",name:"n_",qualifier:["float"],e:!1}],f:[{type:"textline",b:"n_ = ( nY <= UNITY_VALUE_NODES && nY >= - UNITY_VALUE_NODES ) ? acos ( nY ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"n_ = clamp ( n_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nZ",";"]}]},{type:"node",name:"MATH_ARCTANGENT",k:[{type:"node_in",name:"oa",qualifier:["float"],e:!1},{type:"node_in",name:"ob",qualifier:["float"],e:!1},{type:"node_out",name:"oc",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oc = atan ( oa ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",
b:"oc = clamp ( oc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["ob",";"]}]},{type:"node",name:"MATH_POWER",k:[{type:"node_in",name:"od",qualifier:["float"],e:!1},{type:"node_in",name:"oe",qualifier:["float"],e:!1},{type:"node_out",name:"of",qualifier:["float"],e:!1}],f:[{type:"textline",b:"if ( od < ZERO_VALUE_NODES || od == ZERO_VALUE_NODES && oe == ZERO_VALUE_NODES ) of = ZERO_VALUE_NODES ; else of = pow ( od , oe ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"of = clamp ( of , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",k:[{type:"node_in",name:"og",qualifier:["float"],e:!1},{type:"node_in",name:"oh",qualifier:["float"],e:!1},{type:"node_out",name:"oi",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oi = ( og > ZERO_VALUE_NODES && oh > ZERO_VALUE_NODES ) ? log2 ( og ) / log2 ( oh ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oi = clamp ( oi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",k:[{type:"node_in",name:"oj",qualifier:["float"],e:!1},{type:"node_in",name:"ok",qualifier:["float"],e:!1},{type:"node_out",name:"ol",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ol = min ( oj , ok ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ol = clamp ( ol , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MAXIMUM",k:[{type:"node_in",name:"om",qualifier:["float"],e:!1},{type:"node_in",name:"on",qualifier:["float"],e:!1},{type:"node_out",name:"oo",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oo = max ( om , on ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oo = clamp ( oo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",k:[{type:"node_in",name:"op",qualifier:["float"],e:!1},
{type:"node_in",name:"oq",qualifier:["float"],e:!1},{type:"node_out",name:"or",qualifier:["float"],e:!1}],f:[{type:"textline",b:"or = floor ( op + 0.5 ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"or = clamp ( or , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oq",";"]}]},{type:"node",name:"MATH_LESS_THAN",k:[{type:"node_in",name:"os",qualifier:["float"],e:!1},{type:"node_in",name:"ot",qualifier:["float"],e:!1},
{type:"node_out",name:"ou",qualifier:["float"],e:!1}],f:[{type:"textline",b:"ou = ( os < ot ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ou = clamp ( ou , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",k:[{type:"node_in",name:"ov",qualifier:["float"],e:!1},{type:"node_in",name:"ow",qualifier:["float"],e:!1},{type:"node_out",name:"ox",qualifier:["float"],
e:!1}],f:[{type:"textline",b:"ox = ( ov > ow ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ox = clamp ( ox , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",k:[{type:"node_in",name:"oy",qualifier:["float"],e:!1},{type:"node_in",name:"oz",qualifier:["float"],e:!1},{type:"node_out",name:"oA",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oA = abs ( oz ) > 0.000001 ? mod ( oy , oz ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oA = clamp ( oA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ABSOLUTE",k:[{type:"node_in",name:"oB",qualifier:["float"],e:!1},{type:"node_in",name:"oC",qualifier:["float"],e:!1},{type:"node_out",name:"oD",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oD = abs ( oB ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oD = clamp ( oD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["oC",";"]}]},{type:"node",name:"MIX_RGB_MIX",k:[{type:"node_in",name:"oE",qualifier:["float"],e:!1},{type:"node_in",name:"oF",qualifier:["vec3"],e:!1},{type:"node_in",name:"oG",qualifier:["vec3"],e:!1},{type:"node_out",name:"oH",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oI = clamp ( oE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oH = mix ( oF , oG , oI ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oH = clamp ( oH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_ADD",k:[{type:"node_in",name:"oJ",qualifier:["float"],e:!1},{type:"node_in",name:"oK",qualifier:["vec3"],e:!1},{type:"node_in",name:"oL",qualifier:["vec3"],e:!1},{type:"node_out",name:"oM",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oN = clamp ( oJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oM = mix ( oK , oK + oL , oN ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oM = clamp ( oM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_MULTIPLY",k:[{type:"node_in",name:"oO",qualifier:["float"],e:!1},{type:"node_in",name:"oP",qualifier:["vec3"],e:!1},{type:"node_in",name:"oQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"oR",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oS = clamp ( oO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oR = mix ( oP , oP * oQ , oS ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oR = clamp ( oR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SUBTRACT",k:[{type:"node_in",name:"oT",qualifier:["float"],e:!1},{type:"node_in",name:"oU",qualifier:["vec3"],e:!1},{type:"node_in",name:"oV",qualifier:["vec3"],e:!1},{type:"node_out",name:"oW",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oX = clamp ( oT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oW = mix ( oU , oU - oV , oX ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oW = clamp ( oW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SCREEN",k:[{type:"node_in",name:"oY",qualifier:["float"],e:!1},{type:"node_in",name:"oZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"o_",qualifier:["vec3"],e:!1},{type:"node_out",name:"pa",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pb = clamp ( oY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pc = UNITY_VALUE_NODES - pb ; pa = lA - ( vec3 ( pc ) + pb * ( lA - o_ ) ) * ( lA - oZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pa = clamp ( pa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DIVIDE",k:[{type:"node_in",name:"pd",qualifier:["float"],e:!1},{type:"node_in",name:"pe",qualifier:["vec3"],e:!1},{type:"node_in",name:"pf",qualifier:["vec3"],e:!1},{type:"node_out",name:"pg",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float ph = clamp ( pd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pi = UNITY_VALUE_NODES - ph ; pf += step ( pf , lz ) ; pg = pi * pe + ph * pe / pf ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pg = clamp ( pg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",k:[{type:"node_in",name:"pj",qualifier:["float"],e:!1},{type:"node_in",name:"pk",qualifier:["vec3"],e:!1},{type:"node_in",name:"pl",qualifier:["vec3"],e:!1},{type:"node_out",name:"pm",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pn = clamp ( pj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pm = mix ( pk , abs ( pk - pl ) , pn ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pm = clamp ( pm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DARKEN",k:[{type:"node_in",name:"po",qualifier:["float"],e:!1},{type:"node_in",name:"pp",qualifier:["vec3"],e:!1},{type:"node_in",name:"pq",qualifier:["vec3"],e:!1},{type:"node_out",name:"pr",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float ps = clamp ( po , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pr = min ( pp . rgb , pq . rgb * ps ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pr = clamp ( pr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_LIGHTEN",k:[{type:"node_in",name:"pt",qualifier:["float"],e:!1},{type:"node_in",name:"pu",qualifier:["vec3"],e:!1},{type:"node_in",name:"pv",qualifier:["vec3"],e:!1},{type:"node_out",name:"pw",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float px = clamp ( pt , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pw = max ( pu . rgb , pv . rgb * px ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pw = clamp ( pw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_OVERLAY",k:[{type:"node_in",name:"py",qualifier:["float"],e:!1},{type:"node_in",name:"pz",qualifier:["vec3"],e:!1},{type:"node_in",name:"pA",qualifier:["vec3"],e:!1},{type:"node_out",name:"pB",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pC = clamp ( py , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pD = vec3 ( UNITY_VALUE_NODES - pC ) ; pB = mix ( pz * ( pD + 2.0 * pC * pA ) , lA - ( pD + 2.0 * pC * ( lA - pA ) ) * ( lA - pz ) , step ( 0.5 , pz ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pB = clamp ( pB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DODGE",k:[{type:"node_in",name:"pE",qualifier:["float"],e:!1},{type:"node_in",name:"pF",qualifier:["vec3"],e:!1},{type:"node_in",name:"pG",qualifier:["vec3"],e:!1},{type:"node_out",name:"pH",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pI = clamp ( pE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pJ = lA - pI * pG ; vec3 pK = clamp ( pF / pJ , 0.0 , 1.0 ) ; pH = mix ( mix ( pK , lA , step ( pJ , lz ) ) , pF , step ( pF , lz ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pH = clamp ( pH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_BURN",k:[{type:"node_in",name:"pL",qualifier:["float"],e:!1},{type:"node_in",name:"pM",qualifier:["vec3"],e:!1},{type:"node_in",name:"pN",qualifier:["vec3"],e:!1},{type:"node_out",name:"pO",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pP = clamp ( pL , 0.0 , 1.0 ) ; vec3 pQ = vec3 ( 1.0 - pP ) ; vec3 pR = pQ + pP * pN ; vec3 pS = clamp ( lA - ( lA - pM ) / pR , 0.0 , 1.0 ) ; pO = mix ( pS , lz , step ( pR , lz ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pO = clamp ( pO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_HUE",k:[{type:"node_in",name:"pT",qualifier:["float"],e:!1},{type:"node_in",name:"pU",qualifier:["vec3"],e:!1},{type:"node_in",name:"pV",qualifier:["vec3"],e:!1},{type:"node_out",name:"pW",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pX = clamp ( pT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pY , pZ , p_ ; pW = pU ; pZ = lO ( pV ) ; if ( pZ . y != ZERO_VALUE_NODES ) { pY = lO ( pW ) ; pY . x = pZ . x ; p_ = lS ( pY ) ; pW = mix ( pW , p_ , pX ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pW = clamp ( pW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SATURATION",k:[{type:"node_in",name:"qa",qualifier:["float"],e:!1},{type:"node_in",name:"qb",qualifier:["vec3"],e:!1},{type:"node_in",name:"qc",qualifier:["vec3"],e:!1},{type:"node_out",name:"qd",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qe = clamp ( qa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qf = UNITY_VALUE_NODES - qe ; qd = qb ; vec3 qg , qh ; qg = lO ( qd ) ; if ( qg . y != ZERO_VALUE_NODES ) { qh = lO ( qc ) ; qg . y = qf * qg . y + qe * qh . y ; qd = lS ( qg ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qd = clamp ( qd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_VALUE",k:[{type:"node_in",name:"qi",qualifier:["float"],e:!1},{type:"node_in",name:"qj",qualifier:["vec3"],e:!1},{type:"node_in",name:"qk",qualifier:["vec3"],e:!1},{type:"node_out",name:"ql",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qm = clamp ( qi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qn = UNITY_VALUE_NODES - qm ; vec3 qo , qp ; qo = lO ( qj ) ; qp = lO ( qk ) ; qo . z = qn * qo . z + qm * qp . z ; ql = lS ( qo ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"ql = clamp ( ql , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_COLOR",k:[{type:"node_in",name:"qq",qualifier:["float"],e:!1},{type:"node_in",name:"qr",qualifier:["vec3"],e:!1},{type:"node_in",name:"qs",qualifier:["vec3"],e:!1},{type:"node_out",name:"qt",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qu = clamp ( qq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qv , qw , qx ; qt = qr ; qw = lO ( qs ) ; if ( qw . y != ZERO_VALUE_NODES ) { qv = lO ( qt ) ; qv . x = qw . x ; qv . y = qw . y ; qx = lS ( qv ) ; qt = mix ( qt , qx , qu ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qt = clamp ( qt , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",k:[{type:"node_in",name:"qy",qualifier:["float"],e:!1},{type:"node_in",name:"qz",qualifier:["vec3"],e:!1},{type:"node_in",name:"qA",qualifier:["vec3"],e:!1},{type:"node_out",name:"qB",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qC = clamp ( qy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qD = UNITY_VALUE_NODES - qC ; vec3 qE = qA + qz - qA * qz ; qB = qz * ( vec3 ( qD ) + vec3 ( qC ) * ( ( lA - qz ) * qA + qE ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qB = clamp ( qB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",k:[{type:"node_in",name:"qF",qualifier:["float"],e:!1},{type:"node_in",name:"qG",qualifier:["vec3"],e:!1},{type:"node_in",name:"qH",qualifier:["vec3"],e:!1},{type:"node_out",name:"qI",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qJ = clamp ( qF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qI = qG + qJ * ( 2.0 * qH - lA ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qI = clamp ( qI , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"OUTPUT",k:[{type:"node_in",name:"qK",qualifier:["vec3"],e:!1},{type:"node_in",name:"qL",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mv = qK ; mA = qL ;".split(" ")}]},{type:"node",name:"MATERIAL",k:[{type:"node_in",name:"qM",qualifier:["vec3"],e:!1},{type:"node_in",name:"qN",qualifier:["float"],
e:!1},{type:"node_in",name:"qO",qualifier:["vec3"],e:!1},{type:"node_in",name:"qP",qualifier:["vec3"],e:!0},{type:"node_out",name:"qQ",qualifier:["vec3"],e:!0},{type:"node_out",name:"qR",qualifier:["float"],e:!0},{type:"node_out",name:"qS",qualifier:["vec3"],e:!0},{type:"node_param",name:"md",qualifier:["const","vec2"]},{type:"node_param",name:"me",qualifier:["const","vec3"]}],f:[{type:"textline",b:"{ vec3 qT = clamp ( qM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qU = me [ 0 ] * clamp ( qO , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"vec3 qV = normalize ( qP ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["vec3","qV","=","mk",";"]}]}]},{type:"textline",b:["hx","qW",";"]},{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT"],f:[{type:"textline",b:"vec3 qX = ms * qT ; float qY = 0.5 * qV . y + 0.5 ; vec3 qZ = mu * u_environment_energy * lH ( qY , qV ) ; float q_ = fs ( qT ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"vec2 ra = vec2 ( md [ 0 ] , md [ 1 ] ) ; vec2 rb = vec2 ( me [ 1 ] , me [ 2 ] ) ; qW = kc ( qX , qZ , qT , qU , mq , qV , mp , rb , ra , q_ , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:"qW = kh ( qX , qZ , qT ) ;".split(" ")}]}]},{type:"textline",b:["mz","=","q_",";"]}]},{type:"node_else",f:[{type:"textline",
b:"qW . a = vec4 ( qT , ZERO_VALUE_NODES ) ; qW . b = lz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qQ"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"qQ = qW . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["qQ","=","lz",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"qQ += qW . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_qR"],f:[{type:"textline",b:"qR = clamp ( qN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"qR += qW . a . a * qU . r * mt ; qR = clamp ( qR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qS"],f:[{type:"textline",b:["qS","=","qV",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",
b:"mw = qW . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["mw","=","lz",";"]}]}]},{type:"textline",b:["mx","=","qV",";","}"]}]},{type:"node",name:"MATERIAL_EXT",k:[{type:"node_in",name:"rc",qualifier:["vec3"],e:!1},{type:"node_in",name:"rd",qualifier:["float"],e:!1},{type:"node_in",name:"re",qualifier:["vec3"],e:!1},{type:"node_in",name:"rf",qualifier:["vec3"],e:!0},{type:"node_in",name:"rg",qualifier:["float"],e:!1},{type:"node_in",name:"rh",qualifier:["float"],e:!1},{type:"node_in",
name:"ri",qualifier:["vec4"],e:!1},{type:"node_in",name:"rj",qualifier:["float"],e:!1},{type:"node_in",name:"rk",qualifier:["float"],e:!1},{type:"node_out",name:"rl",qualifier:["vec3"],e:!0},{type:"node_out",name:"rm",qualifier:["float"],e:!0},{type:"node_out",name:"rn",qualifier:["vec3"],e:!0},{type:"node_out",name:"ro",qualifier:["vec3"],e:!0},{type:"node_out",name:"rp",qualifier:["vec3"],e:!0},{type:"node_param",name:"mf",qualifier:["const","vec2"]},{type:"node_param",name:"mg",qualifier:["const",
"vec3"]}],f:[{type:"textline",b:"{ vec3 rq = clamp ( rc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 rr = mg [ 0 ] * clamp ( re , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"vec3 rs = normalize ( rf ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["vec3","rs","=","mk",";"]}]}]},{type:"textline",b:["hx","rt",";"]},{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT"],f:[{type:"textline",
b:"float ru = fs ( rq ) ; vec3 rv = rg * rq ; float rw = 0.5 * rs . y + 0.5 ; vec3 rx = mu * u_environment_energy * lH ( rw , rs ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"vec2 ry = vec2 ( mf [ 0 ] , mf [ 1 ] ) ; vec2 rz = vec2 ( mg [ 1 ] , mg [ 2 ] ) ; rt = kc ( rv , rx , rq , rr , mq , rs , mp , rz , ry , ru , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , rh , ri ) ;".split(" ")}]},{type:"node_else",
f:[{type:"textline",b:"rt = kh ( rv , rx , rq ) ;".split(" ")}]}]},{type:"textline",b:["mz","=","ru",";"]}]},{type:"node_else",f:[{type:"textline",b:"rt . a = vec4 ( rq , ZERO_VALUE_NODES ) ; rt . b = lz ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rl"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"rl = rt . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["rl","=","lz",";"]}]}]},{type:"node_condition",a:[{type:"node_if",
c:["REFLECTIVE","||","TEXTURE_MIRROR"],f:[{type:"textline",b:"lk ( rl , mp , rs , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , rj ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"rl += rt . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rm"],f:[{type:"textline",b:"rm = clamp ( rd , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],
f:[{type:"textline",b:"rm += rt . a . a * rr . r * rk ; rm = clamp ( rm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rn"],f:[{type:"textline",b:["rn","=","rs",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ro"],f:[{type:"textline",b:"ro = rt . a . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rp"],f:[{type:"textline",b:"rp = rt . b ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"mw = rt . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["mw","=","lz",";"]}]}]},{type:"textline",b:["mx","=","rs",";","}"]}]},{type:"node",name:"RGB",k:[{type:"node_out",name:"rA",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rA = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",k:[{type:"node_in",name:"rB",qualifier:["vec3"],e:!1},{type:"node_out",name:"rC",qualifier:["float"],e:!1}],f:[{type:"textline",b:"rC = rB . r * 0.35 + rB . g * 0.45 + rB . b * 0.2 ;".split(" ")}]},
{type:"node",name:"SEPRGB",k:[{type:"node_in",name:"rD",qualifier:["vec3"],e:!1},{type:"node_out",name:"rE",qualifier:["float"],e:!0},{type:"node_out",name:"rF",qualifier:["float"],e:!0},{type:"node_out",name:"rG",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rE"],f:[{type:"textline",b:"rE = rD . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rF"],f:[{type:"textline",b:"rF = rD . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_rG"],f:[{type:"textline",b:"rG = rD . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",k:[{type:"node_in",name:"rH",qualifier:["vec3"],e:!1},{type:"node_out",name:"rI",qualifier:["float"],e:!0},{type:"node_out",name:"rJ",qualifier:["float"],e:!0},{type:"node_out",name:"rK",qualifier:["float"],e:!0}],f:[{type:"textline",b:"{ vec3 rL = lO ( rH ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rI"],f:[{type:"textline",b:"rI = rL . r ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_rJ"],f:[{type:"textline",b:"rJ = rL . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rK"],f:[{type:"textline",b:"rK = rL . b ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"SQUEEZE",k:[{type:"node_in",name:"rM",qualifier:["float"],e:!1},{type:"node_in",name:"rN",qualifier:["float"],e:!1},{type:"node_in",name:"rO",qualifier:["float"],e:!1},{type:"node_out",name:"rP",qualifier:["float"],e:!1}],f:[{type:"textline",b:"rP = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( rM - rO ) * rN ) ) ) ;".split(" ")}]},
{type:"node",name:"B4W_SRGB_TO_LINEAR",k:[{type:"node_in",name:"rQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"rR",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rR = max ( lz , rQ ) ; rR = pow ( rR , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",k:[{type:"node_in",name:"rS",qualifier:["vec3"],e:!1},{type:"node_out",name:"rT",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rT = max ( lz , rS ) ; rT = pow ( rT , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",
name:"TEXTURE_EMPTY",k:[{type:"node_out",name:"rU",qualifier:["vec3"],e:!1},{type:"node_out",name:"rV",qualifier:["vec3"],e:!1},{type:"node_out",name:"rW",qualifier:["float"],e:!1}],f:[{type:"textline",b:"{ rW = rU [ 0 ] = rU [ 1 ] = rU [ 2 ] = rV [ 0 ] = rV [ 1 ] = rV [ 2 ] = 0.0 ; }".split(" ")}]},{type:"node",name:"TEXTURE_COLOR",k:[{type:"node_in",name:"rX",qualifier:["vec3"],e:!1},{type:"node_out",name:"rY",qualifier:["vec3"],e:!1},{type:"node_out",name:"rZ",qualifier:["float"],e:!1},{type:"node_param",
name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 r_ = texture2D ( node_TEXTURE_COLOR_var_texture , lW ( rX ) ) ; rY = r_ . xyz ; gy ( rY ) ; rZ = r_ . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_NORMAL",k:[{type:"node_in",name:"sa",qualifier:["vec3"],e:!1},{type:"node_out",name:"sb",qualifier:["vec3"],e:!1},{type:"node_out",name:"sc",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],
f:[{type:"textline",b:"{ vec4 sd = texture2D ( node_TEXTURE_NORMAL_var_texture , lW ( sa ) ) ; my = sd . xyz - 0.5 ; sb = normalize ( mn * my ) ; sc = sd . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_ENVIRONMENT",k:[{type:"node_in",name:"se",qualifier:["vec3"],e:!1},{type:"node_out",name:"sf",qualifier:["vec3"],e:!0},{type:"node_out",name:"sg",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]}],f:[{type:"textline",b:"{ vec4 sh = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , se ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sf"],f:[{type:"textline",b:"sf = sh . xyz ; gy ( sf ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sg"],f:[{type:"textline",b:"sg = sh . w ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"TEXTURE_COLOR2",k:[{type:"node_in",name:"si",qualifier:["vec3"],e:!1},{type:"node_in",name:"sj",qualifier:["vec3"],e:!1},{type:"node_out",name:"sk",qualifier:["vec3"],e:!1},{type:"node_out",name:"sl",qualifier:["float"],
e:!1},{type:"node_out",name:"sm",qualifier:["vec3"],e:!1},{type:"node_out",name:"sn",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_COLOR2_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 so = texture2D ( node_TEXTURE_COLOR2_var_texture , lW ( si ) ) ; sk = so . xyz ; gy ( sk ) ; sl = so . w ; so = texture2D ( node_TEXTURE_COLOR2_var_texture , lW ( sj ) ) ; sm = so . xyz ; gy ( sm ) ; sn = so . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_NORMAL2",
k:[{type:"node_in",name:"sp",qualifier:["vec3"],e:!1},{type:"node_in",name:"sq",qualifier:["vec3"],e:!1},{type:"node_out",name:"sr",qualifier:["vec3"],e:!1},{type:"node_out",name:"ss",qualifier:["float"],e:!1},{type:"node_out",name:"st",qualifier:["vec3"],e:!1},{type:"node_out",name:"su",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL2_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sv = texture2D ( node_TEXTURE_NORMAL2_var_texture , lW ( sp ) ) ; my = sv . xyz - 0.5 ; sr = normalize ( mn * my ) ; ss = sv . w ; sv = texture2D ( node_TEXTURE_NORMAL2_var_texture , lW ( sq ) ) ; my = sv . xyz - 0.5 ; st = normalize ( mn * my ) ; su = sv . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_COLOR3",k:[{type:"node_in",name:"sw",qualifier:["vec3"],e:!1},{type:"node_in",name:"sx",qualifier:["vec3"],e:!1},{type:"node_in",name:"sy",qualifier:["vec3"],e:!1},{type:"node_out",name:"sz",qualifier:["vec3"],e:!1},{type:"node_out",name:"sA",qualifier:["float"],e:!1},{type:"node_out",name:"sB",qualifier:["vec3"],e:!1},{type:"node_out",name:"sC",qualifier:["float"],e:!1},{type:"node_out",name:"sD",qualifier:["vec3"],e:!1},{type:"node_out",name:"sE",qualifier:["float"],e:!1},
{type:"node_param",name:"node_TEXTURE_COLOR3_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sF = texture2D ( node_TEXTURE_COLOR3_var_texture , lW ( sw ) ) ; sz = sF . xyz ; gy ( sz ) ; sA = sF . w ; sF = texture2D ( node_TEXTURE_COLOR3_var_texture , lW ( sx ) ) ; sB = sF . xyz ; gy ( sB ) ; sC = sF . w ; sF = texture2D ( node_TEXTURE_COLOR3_var_texture , lW ( sy ) ) ; sD = sF . xyz ; gy ( sD ) ; sE = sF . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_COLOR4",k:[{type:"node_in",
name:"sG",qualifier:["vec3"],e:!1},{type:"node_in",name:"sH",qualifier:["vec3"],e:!1},{type:"node_in",name:"sI",qualifier:["vec3"],e:!1},{type:"node_in",name:"sJ",qualifier:["vec3"],e:!1},{type:"node_out",name:"sK",qualifier:["vec3"],e:!1},{type:"node_out",name:"sL",qualifier:["float"],e:!1},{type:"node_out",name:"sM",qualifier:["vec3"],e:!1},{type:"node_out",name:"sN",qualifier:["float"],e:!1},{type:"node_out",name:"sO",qualifier:["vec3"],e:!1},{type:"node_out",name:"sP",qualifier:["float"],e:!1},
{type:"node_out",name:"sQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"sR",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_COLOR4_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sS = texture2D ( node_TEXTURE_COLOR4_var_texture , lW ( sG ) ) ; sK = sS . xyz ; gy ( sK ) ; sL = sS . w ; sS = texture2D ( node_TEXTURE_COLOR4_var_texture , lW ( sH ) ) ; sM = sS . xyz ; gy ( sM ) ; sN = sS . w ; sS = texture2D ( node_TEXTURE_COLOR4_var_texture , lW ( sI ) ) ; sO = sS . xyz ; gy ( sO ) ; sP = sS . w ; sS = texture2D ( node_TEXTURE_COLOR4_var_texture , lW ( sJ ) ) ; sQ = sS . xyz ; gy ( sQ ) ; sR = sS . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_NORMAL3",k:[{type:"node_in",name:"sT",qualifier:["vec3"],e:!1},{type:"node_in",name:"sU",qualifier:["vec3"],e:!1},{type:"node_in",name:"sV",qualifier:["vec3"],e:!1},{type:"node_out",name:"sW",qualifier:["vec3"],e:!1},{type:"node_out",name:"sX",qualifier:["float"],e:!1},{type:"node_out",name:"sY",qualifier:["vec3"],e:!1},{type:"node_out",name:"sZ",qualifier:["float"],e:!1},{type:"node_out",name:"s_",qualifier:["vec3"],e:!1},{type:"node_out",name:"ta",qualifier:["float"],
e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL3_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 tb = texture2D ( node_TEXTURE_NORMAL3_var_texture , lW ( sT ) ) ; my = tb . xyz - 0.5 ; sW = normalize ( mn * my ) ; sX = tb . w ; tb = texture2D ( node_TEXTURE_NORMAL3_var_texture , lW ( sU ) ) ; my = tb . xyz - 0.5 ; sY = normalize ( mn * my ) ; sZ = tb . w ; tb = texture2D ( node_TEXTURE_NORMAL3_var_texture , lW ( sV ) ) ; my = tb . xyz - 0.5 ; s_ = normalize ( mn * my ) ; ta = tb . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_NORMAL4",k:[{type:"node_in",name:"tc",qualifier:["vec3"],e:!1},{type:"node_in",name:"td",qualifier:["vec3"],e:!1},{type:"node_in",name:"te",qualifier:["vec3"],e:!1},{type:"node_in",name:"tf",qualifier:["vec3"],e:!1},{type:"node_out",name:"tg",qualifier:["vec3"],e:!1},{type:"node_out",name:"th",qualifier:["float"],e:!1},{type:"node_out",name:"ti",qualifier:["vec3"],e:!1},{type:"node_out",name:"tj",qualifier:["float"],e:!1},{type:"node_out",name:"tk",qualifier:["vec3"],e:!1},
{type:"node_out",name:"tl",qualifier:["float"],e:!1},{type:"node_out",name:"tm",qualifier:["vec3"],e:!1},{type:"node_out",name:"tn",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL4_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 to = texture2D ( node_TEXTURE_NORMAL4_var_texture , lW ( tc ) ) ; my = to . xyz - 0.5 ; tg = normalize ( mn * my ) ; th = to . w ; to = texture2D ( node_TEXTURE_NORMAL4_var_texture , lW ( td ) ) ; my = to . xyz - 0.5 ; ti = normalize ( mn * my ) ; tj = to . w ; to = texture2D ( node_TEXTURE_NORMAL4_var_texture , lW ( te ) ) ; my = to . xyz - 0.5 ; tk = normalize ( mn * my ) ; tl = to . w ; to = texture2D ( node_TEXTURE_NORMAL4_var_texture , lW ( tf ) ) ; my = to . xyz - 0.5 ; tm = normalize ( mn * my ) ; tn = to . w ; }".split(" ")}]},
{type:"node",name:"VALUE",k:[{type:"node_out",name:"tp",qualifier:["float"],e:!1}],f:[{type:"textline",b:"tp = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",k:[{type:"node_in",name:"tq",qualifier:["vec3"],e:!1},{type:"node_in",name:"tr",qualifier:["vec3"],e:!1},{type:"node_out",name:"ts",qualifier:["vec3"],e:!1},{type:"node_out",name:"tt",qualifier:["float"],e:!0}],f:[{type:"textline",b:"ts = tq + tr ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tt"],
f:[{type:"textline",b:"tt = ( abs ( ts [ 0 ] ) + abs ( ts [ 1 ] ) + abs ( ts [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_SUBTRACT",k:[{type:"node_in",name:"tu",qualifier:["vec3"],e:!1},{type:"node_in",name:"tv",qualifier:["vec3"],e:!1},{type:"node_out",name:"tw",qualifier:["vec3"],e:!1},{type:"node_out",name:"tx",qualifier:["float"],e:!0}],f:[{type:"textline",b:"tw = tu - tv ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tx"],f:[{type:"textline",b:"tx = ( abs ( tw [ 0 ] ) + abs ( tw [ 1 ] ) + abs ( tw [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_AVERAGE",k:[{type:"node_in",name:"ty",qualifier:["vec3"],e:!1},{type:"node_in",name:"tz",qualifier:["vec3"],e:!1},{type:"node_out",name:"tA",qualifier:["vec3"],e:!1},{type:"node_out",name:"tB",qualifier:["float"],e:!0}],f:[{type:"textline",b:"tA = ty + tz ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tB"],f:[{type:"textline",b:"tB = length ( tA ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tA"],f:[{type:"textline",b:"tA = normalize ( tA ) ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_DOT_PRODUCT",k:[{type:"node_in",name:"tC",qualifier:["vec3"],e:!1},{type:"node_in",name:"tD",qualifier:["vec3"],e:!1},{type:"node_out",name:"tE",qualifier:["vec3"],e:!1},{type:"node_out",name:"tF",qualifier:["float"],e:!0}],f:[{type:"textline",b:["tE","=","lz",";"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tF"],f:[{type:"textline",b:"tF = dot ( tC , tD ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",k:[{type:"node_in",name:"tG",qualifier:["vec3"],
e:!1},{type:"node_in",name:"tH",qualifier:["vec3"],e:!1},{type:"node_out",name:"tI",qualifier:["vec3"],e:!1},{type:"node_out",name:"tJ",qualifier:["float"],e:!0}],f:[{type:"textline",b:"tI = cross ( tG , tH ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tJ"],f:[{type:"textline",b:"tJ = length ( tI ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",k:[{type:"node_in",name:"tK",qualifier:["vec3"],e:!1},{type:"node_in",name:"tL",qualifier:["vec3"],e:!1},{type:"node_out",
name:"tM",qualifier:["vec3"],e:!1},{type:"node_out",name:"tN",qualifier:["float"],e:!0}],f:[{type:"textline",b:"tM = normalize ( tK ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tN"],f:[{type:"textline",b:"tN = length ( tK ) ;".split(" ")}]}]},{type:"textline",b:["tL",";"]}]},{type:"node",name:"B4W_REFLECT",k:[{type:"node_in",name:"tO",qualifier:["vec3"],e:!1},{type:"node_in",name:"tP",qualifier:["vec3"],e:!1},{type:"node_out",name:"tQ",qualifier:["vec3"],e:!1}],f:[{type:"textline",
b:"tQ = reflect ( - tO , tP ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",k:[{type:"node_in",name:"tR",qualifier:["vec3"],e:!1},{type:"node_in",name:"tS",qualifier:["float"],e:!1},{type:"node_in",name:"tT",qualifier:["const","float"],e:!1},{type:"node_in",name:"tU",qualifier:["const","float"],e:!1},{type:"node_out",name:"tV",qualifier:["vec3"],e:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ float tW = length ( mr ) ; if ( tW < tU ) { vec2 tX = lW ( tR ) ; float tY = clamp ( 0.5 * ( tU - tW ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float tZ = tS * tY ; vec3 t_ = normalize ( mp * mn ) ; float ua = UNITY_VALUE_NODES / tT ; vec2 ub = t_ . xy * tZ / ( tT * t_ . z ) ; float uc = UNITY_VALUE_NODES ; float ud = texture2D ( node_B4W_PARALLAX_var_texture , tX ) . a ; for ( float ue = 1.0 ; ue <= tT ; ue ++ ) { if ( ud < uc ) { uc -= ua ; tX -= ub ; ud = texture2D ( node_B4W_PARALLAX_var_texture , tX ) . a ; } } vec2 uf = tX + ub ; float ug = texture2D ( node_B4W_PARALLAX_var_texture , uf ) . a - ( uc + ua ) ; float uh = ud - uc ; float ui = uh / ( uh - ug ) ; tX = ui * uf + ( UNITY_VALUE_NODES - ui ) * tX ; tV = lU ( tX ) ; } else tV = tR ; }".split(" ")}]},
{type:"node",name:"B4W_CLAMP",k:[{type:"node_in",name:"uj",qualifier:["vec3"],e:!1},{type:"node_out",name:"uk",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"uk = clamp ( uj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",k:[{type:"node_in",name:"ul",qualifier:["vec3"],e:!1},{type:"node_in",name:"um",qualifier:["float"],e:!1},{type:"node_out",name:"un",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"un = lE ( ul , um ) ;".split(" ")}]},{type:"node",
name:"B4W_TRANSLUCENCY",k:[{type:"node_in",name:"uo",qualifier:["float"],e:!1},{type:"node_in",name:"up",qualifier:["float"],e:!1},{type:"node_in",name:"uq",qualifier:["float"],e:!1},{type:"node_in",name:"ur",qualifier:["float"],e:!1},{type:"node_in",name:"us",qualifier:["float"],e:!1},{type:"node_out",name:"ut",qualifier:["float"],e:!0},{type:"node_out",name:"uu",qualifier:["vec4"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ut"],f:[{type:"textline",b:["ut","=","uo",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_uu"],f:[{type:"textline",b:"uu = vec4 ( up , uq , ur , us ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",k:[{type:"node_out",name:"uv",qualifier:["float"],e:!1}],f:[{type:"textline",b:["uv","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",k:[{type:"node_in",name:"uw",qualifier:["float"],e:!1},{type:"node_in",name:"ux",qualifier:["float"],e:!1},{type:"node_in",name:"uy",qualifier:["float"],e:!1},{type:"node_out",name:"uz",qualifier:["float"],
e:!1}],f:[{type:"textline",b:"uz = smoothstep ( ux , uy , uw ) ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mh","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float mi = kK . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mj","=","kL",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) mj = mj ; else mj = - mj ;".split(" ")}]}}]},{type:"textline",b:"vec3 mk = normalize ( mj ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",
a:[{type:"textline",b:"vec3 ml = cross ( mj , kM . xyz ) * kM . w ; mat3 mm = mat3 ( kM . xyz , ml , mj ) ; mat3 mn = mm ;".split(" ")}]}}]},{type:"textline",b:"vec3 mo = u_camera_eye_frag - kK ; vec3 mp = normalize ( mo ) ; vec3 mq = kK ; vec4 mr = cL ; float ms = u_emit ; float mt = u_specular_alpha ; float mu = u_ambient ; vec3 mv ; vec3 mw ; vec3 mx ; vec3 my ; float mz ; float mA ;".split(" ")},{type:"nodes_main"},{type:"textline",b:"vec3 uA = mv ; float uB = mA ;".split(" ")},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"uA = max ( uA - sqrt ( 0.01 * - min ( mi , ZERO_VALUE_NODES ) ) , 0.5 * uA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"kI ( uA , mi , u_time , mz , mx , u_sun_direction , mh , u_sun_quaternion , kK , length ( cL ) ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),
group:{type:"group",a:[{type:"textline",b:"float uC = clamp ( length ( u_sun_intensity ) + u_environment_energy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 uD = gS ( u_cube_fog , mp ) ; vec4 uE = vec4 ( uD , u_fog_color_density . a ) ; gy ( uE . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec4 uE = u_fog_color_density ; uE . rgb *= uC ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"hk ( uA , length ( cL ) , mp , u_cam_water_depth , u_underwater_fog_color_density , uE , mi , uC ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( uA , length ( cL ) , uE ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( uB < 0.5 ) discard ; uB = UNITY_VALUE_NODES ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 uF = texture2DProj ( u_shadow_mask , cK ) . rg ; float uG = uF . g ; uA = vec3 ( uG ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","uA",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( uA , uB ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( uA , uB ) ; }".split(" ")}]};
a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",
b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",
b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",
";"]}]}}]},{type:"textline",b:"varying vec3 kK ; varying vec4 cL ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kM",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kO",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"lX",qualifier:["varying",
"vec2"]}],f:[{type:"textline",b:["lX","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",k:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"mb",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["mb","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"mc",
qualifier:["varying","float"]}],f:[{type:"textline",b:["mc","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"md",qualifier:["varying","vec2"]}],f:[{type:"textline",b:["md","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute",
"vec3"]},{type:"node_param",name:"me",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["me","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec3 mf = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mg = a_normal ; vec3 mh = vec3 ( a_tangent ) ; vec3 mi = a_tangent [ 3 ] * cross ( mg , mh ) ;".split(" ")}]}},{type:"elif",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec3 mg = a_normal ; vec3 mh = vec3 ( 0.0 ) ; vec3 mi = vec3 ( 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mg = vec3 ( 0.0 ) ; vec3 mh = vec3 ( 0.0 ) ; vec3 mi = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"mf = mix ( mf , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"mg = mix ( mg , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mj = vec3 ( a_tangent ) ; vec3 mk = a_tangent_next [ 3 ] * cross ( a_normal_next , mj ) ; mh = mix ( mh , mj , u_va_frame_factor ) ; mi = mix ( mi , mk , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",
b:"bt ( mf , mh , mi , mg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","ml","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ml = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 mm = ( u_model_matrix * vec4 ( ml , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],
group:{type:"group",a:[{type:"textline",b:"mat4 mn = ag ( u_camera_eye , mm , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 mn = aa ( u_camera_eye , mm , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 mo = ( u_model_matrix * vec4 ( ml , 1.0 ) ) . xyz ; mn = mn * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , mo ) ;".split(" ")}]}}]},
{type:"textline",b:"d mp = an ( mf - ml , ml , mh , mi , mg , mn ) ; mp . b = mm ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d mp = an ( mf , ml , mh , mi , mg , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( mp . a , mp . b , mg ) ;".split(" ")}]}}]},{type:"textline",b:"kK = mp . a ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"kL = mp . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"float mq = ( dot ( cross ( mp . e , mp . c ) , mp . d ) < 0.0 ) ? - 1.0 : 1.0 ; kM = vec4 ( mp . c , mq ) ;".split(" ")}]}}]},{type:"textline",b:"cL = u_view_matrix * vec4 ( mp . a , 1.0 ) ; vec4 mr = u_proj_matrix * cL ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"mr . xy += u_subpixel_jitter * mr . w ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gr","(","mr",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gr ( mp . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_B4W_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:"float ms = mr . x ; float mt = mr . y ; float mu = mr . w ; cK . x = ( ms + mu ) / 2.0 ; cK . y = ( mt + mu ) / 2.0 ; cK . z = mu ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kO = - cL . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},{type:"textline",b:["gl_Position","=","mr",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float mf ; varying vec3 kN ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cL",";"]}]}}]},{type:"textline",b:"void main ( ) { float mg = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; float mh = smoothstep ( u_p_alpha_start , u_p_alpha_end , mg ) ; float mi = u_diffuse_color . a * mf * ( 1.0 - clamp ( mh , 0.0 , 1.0 ) ) ; vec3 mj = kN * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gL ( mj , length ( cL ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","mj",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( mj , mi ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( mj , mi ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",
b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",
b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float mf ; varying vec3 kN ; varying vec3 cL ;".split(" ")},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { mg mW ; mW = mV ( ) ; vec4 mX = u_view_matrix * vec4 ( mW . b , 1.0 ) ; gl_Position = u_proj_matrix * mX ; mf = mW . c ; kN = mW . d ; cL = mX . xyz ; float mY = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = mW . a * mY ; }".split(" ")}]};
a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],
group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float mf ; varying vec3 kN ; varying vec2 a ; varying vec3 kJ ; varying vec3 kK ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 lz = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"vec4 lA = texture2D ( u_sampler , a ) ; gy ( lA . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lz . rgb = mix ( lz . rgb , lA . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lz . rgb *= mix ( vec3 ( 1.0 ) , lA . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"lz . a = lA . a ;".split(" ")}]}}]},{type:"textline",b:"lz . rgb *= kN ; vec3 lB = u_diffuse_intensity * lz . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"vec3 lC = u_emit * lz . rgb ; vec3 lD = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 lE = u_environment_energy * textureCube ( u_sky_texture , lD ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lF = 0.5 ; vec3 lE = u_environment_energy * mix ( u_horizon_color , u_zenith_color , lF ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lG = u_ambient * lE ; float lH = u_specular_params [ 0 ] ; vec2 lI = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 lJ = lH * u_specular_color ; vec3 lK = normalize ( kJ ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hx lL = kc ( lC , lG , lB , lJ , kK , lD , lK , lI , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hx lL = kh ( lC , lG , lB ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lM = lL . a . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["vec3","lM","=","lB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gL ( lM , length ( cL ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"float lN = lz . a * mf ; gA ( lM ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( lM , lN ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lM , lN ) ; }".split(" ")}]};
a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float mf ; varying vec3 kN ; varying vec2 a ; varying vec3 kJ ; varying vec3 kK ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float lB ( vec2 lz , vec2 lA ) { return ( atan ( lA . y , lA . x ) - atan ( lz . y , lz . x ) ) ; } void main ( ) { mg lC ; lC = mV ( ) ; float lD ; mat4 lE ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { lD = lC . e ; lE = z ( lC . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { lD = lC . e ; lE = k ( ) ; lE [ 3 ] = vec4 ( lC . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { lD = lC . e ; lE = o ( radians ( 90.0 ) ) ; lE [ 3 ] = vec4 ( lC . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { lD = lB ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + lC . e ; lE = m ( radians ( - 90.0 ) ) ; lE [ 3 ] = vec4 ( lC . b , 1.0 ) ; } vec4 lF = vec4 ( a_p_bb_vertex * 2.0 * lC . a * u_p_size , 0.0 , 1.0 ) ; vec4 lG = lE * q ( lD ) * lF ; vec4 lH = u_view_matrix * lG ; vec4 lI = u_proj_matrix * lH ; gl_Position = lI ; mf = lC . c ; kN = lC . d ; a = a_p_bb_vertex + 0.5 ; kK = lG . xyz ; kJ = u_camera_eye - lG . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cL","=","lH",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 mW ; const float mX = 0.99 ; const float mY = 1.8 ; const int mZ = 8 ; float ni ( vec3 m_ , vec3 na ) { float nb = dot ( na , na ) ; float nc = 2.0 * dot ( na , m_ ) ; float nd = dot ( m_ , m_ ) - 1.0 ; float ne = nc * nc - 4.0 * nb * nd ; float nf = sqrt ( ne ) ; float ng = ( - nc - nf ) / 2.0 ; float nh = nd / ng ; return nh ; } float np ( float nj , float nk ) { float nl = 3.0 * ( 1.0 - nk * nk ) ; float nm = 2.0 * ( 2.0 + nk * nk ) ; float nn = 1.0 + nj * nj ; float no = pow ( 1.0 + nk * nk - 2.0 * nk * nj , 1.5 ) ; no = max ( no , 0.00001 ) ; return ( nl / nm ) * ( nn / no ) ; } float nx ( vec3 nq , vec3 nr , float ns ) { float nt = dot ( nr , - nq ) ; if ( nt < 0.0 ) { return 1.0 ; } vec3 nu = nq + nt * nr ; if ( length ( nu ) < ns ) { return 0.0 ; } else if ( length ( nu ) >= ns ) { vec3 nv = normalize ( nu ) * ns - nq ; float nw = acos ( dot ( normalize ( nv ) , nr ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( nw * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 nB ( float ny , vec3 nz , float nA ) { return nz - nz * pow ( u_sky_color , vec3 ( nA / ny ) ) ; } void main ( ) { vec3 nC = normalize ( mW ) ; vec3 nD = u_sun_direction ; float nE = dot ( nC , nD ) ; float nF = np ( nE , - 0.01 ) * u_rayleigh_brightness * nD . y ; float nG = np ( nE - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - nD . y ) ; float nH = smoothstep ( 0.0 , 100.0 , np ( nE , 0.9995 ) ) * u_spot_brightness ; vec3 nI = vec3 ( 0.0 , mX , 0.0 ) ; float nJ = ni ( nI , nC ) ; float nK = nJ / float ( mZ ) ; float nL = nx ( nI , nC , mX - 0.3 ) ; vec3 nM = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 nN = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int nO = 0 ; nO < mZ ; nO ++ ) { float nP = nK * float ( nO ) ; vec3 nQ = nI + nC * nP ; float nR = nx ( nQ , nD , mX - 0.2 ) ; float nS = ni ( nQ , nD ) ; vec3 nT = nB ( nS , vec3 ( mY ) , u_scatter_strength ) * nR ; nM += nB ( sqrt ( nP ) , u_sky_color * nT , u_rayleigh_strength ) ; nN += nB ( nP , nT , u_mie_strength ) ; } nM = nM * nL * pow ( nJ , u_rayleigh_collection_power ) / float ( mZ ) ; nN = ( nN * nL * pow ( nJ , u_mie_collection_power ) ) / float ( mZ ) ; vec3 nU = vec3 ( nH * nN + nG * nN + nF * nM ) ; gA ( nU ) ; gl_FragColor = vec4 ( nU , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 mW ; void main ( ) { vec4 lz = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 lA = u_cube_view_matrix * lz ; mW = lA . xyz ; gl_Position = lz ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_sampler , a ) ; gA ( lz . rgb ) ; gD ( lz . rgb , lz . a ) ; gl_FragColor = lz ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { a = a_texcoord ; vec3 lz = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 lA = u_proj_matrix * u_view_matrix * vec4 ( lz , 0.0 ) ; lA . x /= lA . w ; lA . y /= lA . w ; lA += 99999.0 * step ( lA . z , 0.0 ) ; lA += 100.0 * ( step ( 1.0 , abs ( lA . x ) ) + step ( 1.0 , abs ( lA . y ) ) ) ; lA . x = - a_lf_dist * lA . x ; lA . y = - a_lf_dist * lA . y ; float lB = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 lC = vec2 ( a_lf_bb_vertex . x / lB , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float lD = 1.9 ; lC *= ( 1.0 + lD * length ( lA . xy ) ) ; } gl_Position = vec4 ( lA . xy + lC , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:["uniform","samplerCube","u_sky",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 mW ; void main ( ) { vec3 lz = textureCube ( u_sky , mW ) . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"gy ( lz . rgb ) ; float lA = u_camera_eye_frag . y - WATER_LEVEL ; lA = min ( - lA * 0.03 , 0.8 ) ; float lB = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; vec3 lC = normalize ( mW ) ; vec3 lD = vec3 ( 0.0 ) ; vec4 lE = u_underwater_fog_color_density ; lE . rgb = mix ( lE . rgb , lD , min ( - lC . y + lA , 1.0 ) ) * lB ; float lF = clamp ( sign ( lC . y - 0.05 * lA ) , 0.0 , 1.0 ) ; lz = mix ( lE . rgb , lz , lF ) ; gA ( lz . rgb ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( lz , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 mW ; void main ( ) { vec4 lz = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 lA = u_sky_vp_inverse * lz ; mW = lA . xyz ; gl_Position = lz ; }".split(" ")}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",
name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:"uniform float u_time ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",
b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float lz = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 kJ ; varying vec3 kK ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],
group:{type:"group",a:[{type:"textline",b:["varying","vec3","kL",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 kM ; varying vec3 mX ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mY",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mZ",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","kO",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","m_",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE",
"&&","SHORE_SMOOTHING"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 no ( in vec2 na , in vec3 nb , in vec3 nc , in vec3 nd , out float ne ) { vec3 nf = reflect ( - nc , nb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 ng = na . xy + nb . xz * REFL_BUMP / kO ; ne = u_reflect_factor ; vec3 nh ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG",
"&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"nh = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nh = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"float ni = dot ( nc , nb ) ; ne *= max ( 1.0 - 1.0 / ni , 1.0 ) ; } else { nh = texture2D ( u_reflectmap , ng ) . rgb ; gy ( nh ) ; }".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"ne = u_mirror_factor ; vec3 nh = nd * textureCube ( u_mirrormap , nf ) . rgb ; gy ( nh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ne = u_reflect_factor ; vec3 nh = nd * vec3 ( 0.3 , 0.5 , 1.0 ) ; gy ( nh ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nj = normalize ( nf + nc ) ; float nk = 1.0 - dot ( nc , nj ) ; float nl = u_fresnel_params [ 3 ] ; float nm = u_fresnel_params [ 2 ] ; float nn = nl + ( 1.0 - nl ) * pow ( nk , nm ) ; ne = min ( ne * nn , 1.0 ) ; return nh ; } void main ( ) {".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 np = mat3 ( kM , mX , kL ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nq = normalize ( kL ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 np = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nq = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","FOAM"],group:{type:"group",a:[{type:"textline",b:"float nr = kK . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec2 ns = vec2 ( mY . x , - mY . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec2 ns = vec2 ( kK . x , - kK . z ) + 0.5 ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","ns","=","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 nt = vec3 ( 0.0 ) ; vec3 nu = texture2D ( u_normalmap0 , ns * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nt += nu ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nv = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["nv","+=","nu",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"nu = texture2D ( u_normalmap0 , ns * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nt += nu ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",
a:[{type:"textline",b:["nv","+=","nu",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"nu = texture2D ( u_normalmap0 , ns * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nt += nu ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["nv","+=","nu",";"]}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"nu = texture2D ( u_normalmap0 , ns * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nt += nu ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["nv","+=","nu",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",
">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nw = np * nv ; if ( ! g ( nw , vec3 ( 0.0 ) ) ) nw = normalize ( nw ) ; vec3 nx = mix ( nq , nw , 0.2 ) ; nx = normalize ( nx ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"nq = mix ( nq , normalize ( np * nt ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nq = mix ( nq , normalize ( np * nt ) , 0.5 ) ;".split(" ")}]}}]},
{type:"textline",b:"nq = normalize ( nq ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 ny = normalize ( kJ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nz = cK . xy / cK . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float nA = kO * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],
group:{type:"group",a:[{type:"textline",b:"float nB = u_diffuse_color . a ; vec4 nC = texture2DProj ( u_scene_depth , cK ) ; float nD = cw ( nC ) ; float nE = max ( nD - kO , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nF = nz + nq . xz * u_refr_bump / kO ; float nG = lq ( nD , nF , nz ) ; float nH = max ( nG - kO , 0.0 ) ; float nI = u_view_max_depth / ABSORB * nH ; float nJ ; if ( u_cam_water_depth < 0.0 ) nJ = 0.0 ; else nJ = min ( nB * nI , 1.0 ) ; float nK = u_view_max_depth / ABSORB * nE ; nB = min ( 15.0 * nB * u_view_max_depth * nE , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float nK = u_view_max_depth / ABSORB * nE ; if ( u_cam_water_depth > 0.0 ) nB = min ( nB * nK , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"nB *= min ( 5.0 * nA , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nB = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float nJ = 1.0 - nB ; vec2 nF = nz + nq . xz * REFR_BUMP / kO ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 nL = texture2D ( u_refractmap , nF ) . rgb ; gy ( nL ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nM = pow ( min ( mZ . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 nN = mix ( u_shallow_water_col , u_diffuse_color . rgb , nM ) ; nM = pow ( min ( mZ . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; nN = mix ( u_shore_water_col , nN , nM ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nN = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nO = max ( 1.0 - u_view_max_depth * nE , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nO = 1.0 - nB ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:"float nP = max ( nr / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 nQ = normalize ( vec3 ( mZ . r , 0.0 , mZ . g ) ) ; vec3 nR = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , nQ , 0.8 ) ) ; float nS = 1.25 * max ( dot ( nx , nR ) - 0.2 , 0.0 ) ; nS += max ( dot ( nx , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; nO += nS * ( 1.0 - mZ . b ) ; nP *= ( 1.0 - 0.95 * pow ( mZ . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"nO += nP ; nO = min ( u_foam_factor * nO , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 nT = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + ns * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"float nU = u_specular_params [ 0 ] ; vec2 nV = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 nW = nU * u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 nX = u_environment_energy * textureCube ( u_sky_texture , nq ) . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nX = u_environment_energy * u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"vec3 nY = u_ambient * nX ; vec3 nZ = nY + u_sun_intensity ; float n_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 oa = no ( nz , nq , ny , nZ , n_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 oa = no ( vec2 ( 0.0 ) , nq , ny , nZ , n_ ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 ob = u_diffuse_intensity * nN ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hx oc = kc ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , ob , nW , kK , nq , ny , nV , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hx oc = kh ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , ob ) ;".split(" ")}]}}]},
{type:"textline",b:"ob = oc . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float od = max ( dot ( u_sun_direction , - kL ) + SSS_WIDTH , 0.0 ) * max ( dot ( - ny , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; od = clamp ( SSS_STRENGTH * od , 0.0 , 1.0 ) ; ob = mix ( ob , u_shallow_water_col , od ) ; ob = mix ( ob , u_shore_water_col , od ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:"ob = mix ( nL , ob , nJ ) ;".split(" ")}]}}]},{type:"textline",b:"ob = mix ( ob , oa , n_ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"float oe = mix ( nT . g , nT . r , max ( 4.0 * ( nO - 0.75 ) , 0.0 ) ) ; oe = mix ( nT . b , oe , max ( 2.0 * nO - 1.0 , 0.0 ) ) ; oe = mix ( 0.0 , oe , nO ) ; ob = mix ( ob , nZ , oe ) ;".split(" ")}]}}]},{type:"textline",b:"ob += oc . b ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 of = gS ( u_cube_fog , ny ) ; vec4 og = vec4 ( of , u_fog_color_density . a ) ; gy ( og . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","og","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { ht ( ob , nA , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { gL ( ob , nA , og ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( ob , nA , og ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["gA","(","ob",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"nB = max ( nB , oc . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["nB","+=","oe",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gD ( ob , nB ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 oh = fwidth ( m_ ) ; vec3 oi = smoothstep ( vec3 ( 0.0 ) , oh * lz , m_ ) ; float oj = min ( min ( oi . x , oi . y ) , oi . z ) ; oj = clamp ( oj , 0.0 , 1.0 ) ; ob = mix ( u_wireframe_edge_color , ob , oj ) ; nB = mix ( 1.0 , nB , oj ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( ob , nB ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",
b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 kJ ; varying vec3 kK ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","kL",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 kM ; varying vec3 mX ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mY",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mZ",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","kO",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","m_",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"vec3 lF ( in vec2 lz ) { vec2 lA = 0.5 + vec2 ( ( lz . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( lz . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; vec4 lB = texture2D ( u_shore_dist_map , lA ) ; const vec2 lC = vec2 ( 1.0 / 255.0 , 1.0 ) ; float lD = dot ( lB . ba , lC ) ; vec2 lE = normalize ( lB . rg * 2.0 - 1.0 ) ; return vec3 ( lE , lD ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},
{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void lW ( inout vec3 lG , in float lH , in vec3 lI ) { float lJ = dM ( DST_NOISE_SCALE_0 * ( lG . xz + DST_NOISE_FREQ_0 * lH ) ) * dM ( DST_NOISE_SCALE_1 * ( lG . zx - DST_NOISE_FREQ_1 * lH ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float lK = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float lL = lI . b ; float lM = sqrt ( lL ) ; float lN = max ( lL , DIR_MIN_SHR_FAC ) * sin ( lM / lK + DIR_FREQ * lH ) ; float lO = max ( dM ( DIR_NOISE_SCALE * ( lG . xz + DIR_NOISE_FREQ * lH ) ) , DIR_MIN_NOISE_FAC ) ; lN *= lO ; float lP = WAVES_HEIGHT * mix ( lN , lJ , max ( lM , DST_MIN_FAC ) ) ; vec2 lQ = lI . rg ; float lR = WAVES_HOR_FAC * lN * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - lL ) , 0.0 ) ; vec2 lS = lR * lQ ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float lP = WAVES_HEIGHT * lJ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"vec2 lT = 2.0 * ( lG . xz - 0.1 * lH ) ; vec2 lU = 1.3 * ( lG . zx + 0.03 * lH ) ; float lV = dg ( 0.5 * lT ) . x + dg ( 0.5 * lU ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lG . xz += lS ; lV *= lL ;".split(" ")}]}}]},{type:"textline",
b:"lP += SMALL_WAVES_FAC * lV ;".split(" ")}]}}]},{type:"textline",b:"lG . y += lP ; }".split(" ")}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) m_ = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) m_ = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) m_ = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["vec3","na","=","a_position",
";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float nb = abs ( na . y ) ; vec2 nc = u_camera_eye . xz - mod ( u_camera_eye . xz , nb ) ; na . y = WATER_LEVEL ; na . xz += nc ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},{type:"textline",b:"d nd = an ( na , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC",
"&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"mY = nd . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"mZ = lF ( nd . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float ne = length ( u_wind ) ; float nf = u_time ; nf *= ne ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["float",
"ng","=","nb",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","ng","=","0.1",";"]}]}}]},{type:"textline",b:"vec3 nh = nd . a + vec3 ( ng , 0.0 , 0.0 ) ; vec3 ni = nd . a + vec3 ( 0.0 , 0.0 , ng ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 nj = lF ( nh . xz ) ; vec3 nk = lF ( ni . xz ) ; lW ( nh , nf , nj ) ; lW ( ni , nf , nk ) ; lW ( nd . a , nf , mZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"lW ( nh , nf , vec3 ( 0.0 ) ) ; lW ( ni , nf , vec3 ( 0.0 ) ) ; lW ( nd . a , nf , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_position . y < 0.0 ) { nd . a . y = WATER_LEVEL - 1.0 ; nh . y = nd . a . y ; ni . y = nd . a . y ; }".split(" ")}]}}]},{type:"textline",b:"vec3 nl = normalize ( nh - nd . a ) ; vec3 nm = normalize ( ni - nd . a ) ; kL = normalize ( cross ( nm , nl ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"kM = nm ; mX = cross ( kL , kM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nn = dot ( kL , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float no = clamp ( 0.8 - nn , 0.0 , 1.0 ) ; kL = mix ( kL , vec3 ( 0.0 , 1.0 , 0.0 ) , no ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"kK = nd . a ; kJ = u_camera_eye - nd . a ; vec4 np = u_view_matrix * vec4 ( nd . a , 1.0 ) ; vec4 nq = u_proj_matrix * np ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float nr = nq . x ; float ns = nq . y ; float nt = nq . w ; cK . x = ( nr + nt ) / 2.0 ; cK . y = ( ns + nt ) / 2.0 ; cK . z = nt ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"kO = - np . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["gl_Position","=","nq",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 m_ ; const float lz = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 lA = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lA = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lB = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 lC = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 lD = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec3 lE = vec3 ( 0.0 ) ; float lF = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"vec3 lG = sign ( m_ - vec3 ( 0.02 * lz ) ) ; if ( lG . x < 0.0 || lG . y < 0.0 || lG . z < 0.0 ) { lE = lA ; lF = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lG = sign ( m_ - vec3 ( 0.02 * lz ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( lG . x < 0.0 || lG . y < 0.0 || lG . z < 0.0 ) lE = u_wireframe_edge_color ; else lE = lD ; lF = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( lG . x < 0.0 || lG . y < 0.0 || lG . z < 0.0 ) lF = 1.0 ; else lF = 0.0 ; lE = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( lG . x < 0.0 || lG . y < 0.0 || lG . z < 0.0 ) lE = u_wireframe_edge_color ; else if ( gl_FrontFacing ) lE = lB ; else lE = lC ; lF = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 lH = fwidth ( m_ ) ; vec3 lI = smoothstep ( vec3 ( 0.0 ) , lH * lz , m_ ) ; float lJ = min ( min ( lI . x , lI . y ) , lI . z ) ; lJ = clamp ( lJ , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { lE = vec3 ( mix ( u_wireframe_edge_color , lD , lJ ) ) ; lF = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { lE = u_wireframe_edge_color ; lF = mix ( 1.0 , 0.0 , lJ ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) lE = mix ( u_wireframe_edge_color , lB , lJ ) ; else lE = mix ( u_wireframe_edge_color , lC , lJ ) ; lF = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["gA","(","lE",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gD ( lE , lF ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lE , lF ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",b:["varying","vec3","m_",";"]},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { if ( a_polyindex == 0.0 ) m_ = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) m_ = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) m_ = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 lz = a_position ; vec3 lA = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"d lB = an ( lz , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"lz = mix ( lz , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 lC = vec3 ( 0.0 ) ; vec3 lD = vec3 ( 0.0 ) ; bt ( lz , lC , lD , lA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["vec3","lE","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lE = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d lB = gh ( lz , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lE , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lF = ( u_model_matrix * vec4 ( lE , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 lG = ag ( u_camera_eye , lF , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 lG = aa ( u_camera_eye , lF , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND",
"&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lH = ( u_model_matrix * vec4 ( lE , 1.0 ) ) . xyz ; lG = lG * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lH ) ;".split(" ")}]}}]},{type:"textline",b:"d lB = an ( lz - lE , lE , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lG ) ; lB . b = lF ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d lB = an ( lz , lE , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( lB . a , lB . b , lA ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 lI = u_view_matrix * vec4 ( lB . a , 1.0 ) ; gl_Position = u_proj_matrix * lI ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_sampler_left , a ) ; vec4 lA = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( lz [ 0 ] , lA [ 1 ] , lA [ 2 ] , lz [ 3 ] + lA [ 3 ] ) ; }".split(" ")}]};
a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 lC ( float lz , float lA ) { vec2 lB = a + vec2 ( lz , lA ) * u_texel_size ; return texture2D ( u_color , lB ) ; } float lG ( vec4 lD ) { vec3 lE = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lF = dot ( lD . rgb , lE ) ; return lF ; } vec4 nc ( ) { vec4 lH = lC ( - 1.0 , - 1.0 ) ; vec4 lI = lC ( 1.0 , - 1.0 ) ; vec4 lJ = lC ( - 1.0 , 1.0 ) ; vec4 lK = lC ( 1.0 , 1.0 ) ; vec4 lL = lC ( 0.0 , 0.0 ) ; float lM = lG ( lH ) ; float lN = lG ( lI ) ; float lO = lG ( lJ ) ; float lP = lG ( lK ) ; float lQ = lG ( lL ) ; float lR = min ( lQ , min ( min ( lM , lN ) , min ( lO , lP ) ) ) ; float lS = max ( lQ , max ( max ( lM , lN ) , max ( lO , lP ) ) ) ; vec2 lT ; lT . x = - ( ( lM + lN ) - ( lO + lP ) ) ; lT . y = ( ( lM + lO ) - ( lN + lP ) ) ; float lU = max ( ( lM + lN + lO + lP ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float lV = 1.0 / ( min ( abs ( lT . x ) , abs ( lT . y ) ) + lU ) ; lT = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , lT * lV ) ) * u_texel_size ; vec4 lW = 0.5 * ( texture2D ( u_color , a + lT * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + lT * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 na = lW * 0.5 + 0.25 * ( texture2D ( u_color , a + lT * - 0.5 ) + texture2D ( u_color , a + lT * 0.5 ) ) ; float nb = lG ( na ) ; if ( ( nb < lR ) || ( nb > lS ) ) return lW ; else return na ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 oO ( ) { vec2 nd ; nd . x = a . x ; nd . y = a . y ; vec4 ne = texture2D ( u_color , nd ) ; vec4 nf = lC ( 0.0 , 1.0 ) ; vec4 ng = lC ( 1.0 , 0.0 ) ; vec4 nh = lC ( 0.0 , - 1.0 ) ; vec4 ni = lC ( - 1.0 , 0.0 ) ; float nj = lG ( nf ) ; float nk = lG ( ng ) ; float nl = lG ( nh ) ; float nm = lG ( ni ) ; float nn = lG ( ne ) ; float no = max ( nj , nn ) ; float np = min ( nj , nn ) ; float nq = max ( nk , no ) ; float nr = min ( nk , np ) ; float ns = max ( nl , nm ) ; float nt = min ( nl , nm ) ; float nu = max ( ns , nq ) ; float nv = min ( nt , nr ) ; float nw = nu * FXAA_QUALITY_EDGE_THRESHOLD ; float nx = nu - nv ; float ny = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , nw ) ; bool nz = nx < ny ; if ( nz ) return ne ; vec4 nA = lC ( - 1.0 , - 1.0 ) ; vec4 nB = lC ( 1.0 , 1.0 ) ; vec4 nC = lC ( 1.0 , - 1.0 ) ; vec4 nD = lC ( - 1.0 , 1.0 ) ; float nE = lG ( nA ) ; float nF = lG ( nB ) ; float nG = lG ( nC ) ; float nH = lG ( nD ) ; float nI = nl + nj ; float nJ = nm + nk ; float nK = 1.0 / nx ; float nL = nI + nJ ; float nM = ( - 2.0 * nn ) + nI ; float nN = ( - 2.0 * nn ) + nJ ; float nO = nG + nF ; float nP = nE + nG ; float nQ = ( - 2.0 * nk ) + nO ; float nR = ( - 2.0 * nl ) + nP ; float nS = nE + nH ; float nT = nH + nF ; float nU = ( abs ( nM ) * 2.0 ) + abs ( nQ ) ; float nV = ( abs ( nN ) * 2.0 ) + abs ( nR ) ; float nW = ( - 2.0 * nm ) + nS ; float nX = ( - 2.0 * nj ) + nT ; float nY = abs ( nW ) + nU ; float nZ = abs ( nX ) + nV ; float n_ = nS + nO ; float oa = u_texel_size . x ; bool ob = nY >= nZ ; float oc = nL * 2.0 + n_ ; if ( ! ob ) nl = nm ; if ( ! ob ) nj = nk ; if ( ob ) oa = u_texel_size . y ; float od = ( oc * ( 1.0 / 12.0 ) ) - nn ; float oe = nl - nn ; float of = nj - nn ; float og = nl + nn ; float oh = nj + nn ; bool oi = abs ( oe ) >= abs ( of ) ; float oj = max ( abs ( oe ) , abs ( of ) ) ; if ( oi ) oa = - oa ; float ok = clamp ( abs ( od ) * nK , 0.0 , 1.0 ) ; vec2 ol ; ol . x = nd . x ; ol . y = nd . y ; vec2 om ; om . x = ( ! ob ) ? 0.0 : u_texel_size . x ; om . y = ( ob ) ? 0.0 : u_texel_size . y ; if ( ! ob ) ol . x += oa * 0.5 ; if ( ob ) ol . y += oa * 0.5 ; vec2 on ; on . x = ol . x - om . x ; on . y = ol . y - om . y ; vec2 oo ; oo . x = ol . x + om . x ; oo . y = ol . y + om . y ; float op = ( ( - 2.0 ) * ok ) + 3.0 ; float oq = lG ( texture2D ( u_color , on ) ) ; float or = ok * ok ; float os = lG ( texture2D ( u_color , oo ) ) ; if ( ! oi ) og = oh ; float ot = oj * 1.0 / 4.0 ; float ou = nn - og * 0.5 ; float ov = op * or ; bool ow = ou < 0.0 ; oq -= og * 0.5 ; os -= og * 0.5 ; bool ox = abs ( oq ) >= ot ; bool oy = abs ( os ) >= ot ; if ( ! ox ) on . x -= om . x * 1.5 ; if ( ! ox ) on . y -= om . y * 1.5 ; bool oz = ( ! ox ) || ( ! oy ) ; if ( ! oy ) oo . x += om . x * 1.5 ; if ( ! oy ) oo . y += om . y * 1.5 ; if ( oz ) { if ( ! ox ) oq = lG ( texture2D ( u_color , on . xy ) ) ; if ( ! oy ) os = lG ( texture2D ( u_color , oo . xy ) ) ; if ( ! ox ) oq = oq - og * 0.5 ; if ( ! oy ) os = os - og * 0.5 ; ox = abs ( oq ) >= ot ; oy = abs ( os ) >= ot ; if ( ! ox ) on . x -= om . x * 2.0 ; if ( ! ox ) on . y -= om . y * 2.0 ; oz = ( ! ox ) || ( ! oy ) ; if ( ! oy ) oo . x += om . x * 2.0 ; if ( ! oy ) oo . y += om . y * 2.0 ; if ( oz ) { if ( ! ox ) oq = lG ( texture2D ( u_color , on . xy ) ) ; if ( ! oy ) os = lG ( texture2D ( u_color , oo . xy ) ) ; if ( ! ox ) oq = oq - og * 0.5 ; if ( ! oy ) os = os - og * 0.5 ; ox = abs ( oq ) >= ot ; oy = abs ( os ) >= ot ; if ( ! ox ) on . x -= om . x * 2.0 ; if ( ! ox ) on . y -= om . y * 2.0 ; oz = ( ! ox ) || ( ! oy ) ; if ( ! oy ) oo . x += om . x * 2.0 ; if ( ! oy ) oo . y += om . y * 2.0 ; if ( oz ) { if ( ! ox ) oq = lG ( texture2D ( u_color , on . xy ) ) ; if ( ! oy ) os = lG ( texture2D ( u_color , oo . xy ) ) ; if ( ! ox ) oq = oq - og * 0.5 ; if ( ! oy ) os = os - og * 0.5 ; ox = abs ( oq ) >= ot ; oy = abs ( os ) >= ot ; if ( ! ox ) on . x -= om . x * 4.0 ; if ( ! ox ) on . y -= om . y * 4.0 ; oz = ( ! ox ) || ( ! oy ) ; if ( ! oy ) oo . x += om . x * 4.0 ; if ( ! oy ) oo . y += om . y * 4.0 ; if ( oz ) { if ( ! ox ) oq = lG ( texture2D ( u_color , on . xy ) ) ; if ( ! oy ) os = lG ( texture2D ( u_color , oo . xy ) ) ; if ( ! ox ) oq = oq - og * 0.5 ; if ( ! oy ) os = os - og * 0.5 ; ox = abs ( oq ) >= ot ; oy = abs ( os ) >= ot ; if ( ! ox ) on . x -= om . x * 2.0 ; if ( ! ox ) on . y -= om . y * 2.0 ; if ( ! oy ) oo . x += om . x * 2.0 ; if ( ! oy ) oo . y += om . y * 2.0 ; } } } } float oA = nd . x - on . x ; float oB = oo . x - nd . x ; if ( ! ob ) oA = nd . y - on . y ; if ( ! ob ) oB = oo . y - nd . y ; bool oC = ( oq < 0.0 ) != ow ; float oD = ( oB + oA ) ; bool oE = ( os < 0.0 ) != ow ; float oF = 1.0 / oD ; bool oG = oA < oB ; float oH = min ( oA , oB ) ; bool oI = oG ? oC : oE ; float oJ = ov * ov ; float oK = ( oH * ( - oF ) ) + 0.5 ; float oL = oJ * FXAA_QUALITY_SUBPIX ; float oM = oI ? oK : 0.0 ; float oN = max ( oM , oL ) ; if ( ! ob ) nd . x += oN * oa ; if ( ob ) nd . y += oN * oa ; return texture2D ( u_color , nd ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = nc ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = oO ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 lz = vec2 ( 0.0 , 0.0 ) ; vec2 lA = u_texel_size ; vec4 lB = texture2D ( u_color , a ) ; gl_FragColor = lB * 0.0875447373698 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0858112354248 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0808139781061 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0731235112908 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0635705267419 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0530985673112 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0426125984122 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0328565115809 ; lz += lA ; gl_FragColor += texture2D ( u_color , a + lz ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - lz ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * lB , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_main , a ) ; vec4 lA = texture2D ( u_bloom , a ) ; vec4 lB = lz ; lB += lA ; gl_FragColor = vec4 ( lB . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_color , a ) ; vec3 lA = lz . rgb ; if ( u_brightness < 0.0 ) lA = lA * ( 1.0 + u_brightness ) ; else lA = lA + ( ( 1.0 - lA ) * u_brightness ) ; lA = ( lA - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; lA *= u_exposure ; vec3 lB = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lC = dot ( lA , lB ) ; lA = mix ( vec3 ( lC ) , lA , u_saturation ) ; gl_FragColor = vec4 ( lA , lz . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cs ( clamp ( nh ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { vec4 ni = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { float nj = nh ( u_depth , a , u_camera_range ) ; nj *= u_view_max_depth ; float nk ; if ( nj < u_dof_dist ) nk = ( u_dof_dist - nj ) / u_dof_front ; else nk = ( nj - u_dof_dist ) / u_dof_rear ; nk = clamp ( nk , 0.0 , 1.0 ) ; vec4 nl = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( ni , nl , nk ) ; } else gl_FragColor = ni ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float lE ( float lz , float lA , float lB ) { vec2 lC = a + vec2 ( lz , lA ) * u_texel_size ; vec4 lD = texture2D ( u_sampler , lC ) * lB ; return cw ( lD ) ; } void main ( ) { float lF = ( lE ( - 1.0 , - 1.0 , - 1.0 ) + lE ( 0.0 , - 1.0 , - 1.0 ) + lE ( 1.0 , - 1.0 , - 1.0 ) + lE ( - 1.0 , 0.0 , - 1.0 ) + lE ( 0.0 , 0.0 , 8.0 ) + lE ( 1.0 , 0.0 , - 1.0 ) + lE ( - 1.0 , 1.0 , - 1.0 ) + lE ( 0.0 , 1.0 , - 1.0 ) + lE ( 1.0 , 1.0 , - 1.0 ) ) ; lF *= 1000.0 ; gl_FragColor = vec4 ( lF , lF , lF , 1.0 ) ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_glow_src ; uniform sampler2D u_glow_mask ; uniform sampler2D u_glow_mask_blurred ; uniform vec3 u_glow_color ; uniform float u_draw_glow ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_glow_src , a ) ; gl_FragColor = lz ; if ( u_draw_glow != 0.0 ) { vec4 lA = texture2D ( u_glow_mask , a ) ; vec4 lB = texture2D ( u_glow_mask_blurred , a ) ; float lC = lB . a - lA . a ; if ( lC != 0.0 ) { float lD = smoothstep ( 0.0 , 1.0 , lB . a ) ; if ( lA . a == 0.0 ) { vec3 lE = u_glow_color ; gA ( lE ) ; vec4 lF = vec4 ( clamp ( lE , 0.0 , 1.0 ) , lD ) ; gl_FragColor = mix ( lz , lF , lD ) ; } } } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float ni ; varying vec2 nj ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 nk ; void main ( ) { vec2 nl = ( nk . xy - a ) ; float nm = length ( nl ) ; vec2 nn = u_radial_blur_step * nl / nm ; float no = nm / u_radial_blur_step ; nn *= min ( no , STEPS_PER_PASS ) / STEPS_PER_PASS ; no = max ( no , STEPS_PER_PASS ) ; vec2 np = a ; float nq = 0.0 ; for ( float nr = 0.0 ; nr < STEPS_PER_PASS ; nr += 1.0 ) { if ( nr <= no ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"float ns = nh ( u_input , np , u_camera_range ) ; nq += max ( ( 1.0 - pow ( nm , 0.3 ) ) * step ( 0.9 , ns ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 nt = texture2D ( u_input , np ) ; nq += cw ( nt ) ;".split(" ")}]}}]},{type:"textline",b:"} np += nn ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"vec2 nu = a + nj ; float nv = dg ( vec2 ( 2.5 * ( nu . x ) , 2.5 * ( nu . y ) + 1.0 * u_time ) ) . x + 0.75 * dg ( vec2 ( 5.0 * ( nu . x ) - 0.66 * u_time , 5.0 * ( nu . y ) + 0.66 * u_time ) ) . x + 0.5 * dM ( vec2 ( 7.5 * ( nu . x ) + 0.33 * u_time , 7.5 * ( nu . y ) - 0.33 * u_time ) ) ; nv *= clamp ( 1.2 - sqrt ( 0.2 * nm ) , 0.0 , 1.0 ) * ni ; nq = max ( nv , nq ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = cs ( nq / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform vec4 u_refl_plane ; varying float ni ; varying vec2 nj ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"varying vec2 a ; varying vec4 nk ; void lG ( in vec4 lz , in vec3 lA , out vec3 lB ) { float lC = lz . w * lA . x + lz . y * lA . z - lz . z * lA . y ; float lD = lz . w * lA . y + lz . z * lA . x - lz . x * lA . z ; float lE = lz . w * lA . z + lz . x * lA . y - lz . y * lA . x ; float lF = - lz . x * lA . x - lz . y * lA . y - lz . z * lA . z ; lB . x = lC * lz . w - lF * lz . x - lD * lz . z + lE * lz . y ; lB . y = lD * lz . w - lF * lz . y - lE * lz . x + lC * lz . z ; lB . z = lE * lz . w - lF * lz . z - lC * lz . y + lD * lz . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 lH = normalize ( u_sun_direction ) ; nk = u_proj_matrix * u_view_matrix * vec4 ( lH , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_camera_eye . y + a_bb_vertex . t < - u_refl_plane . w ) { ni = 1.0 ; vec3 lI = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 lJ ; lG ( u_camera_quat , lI , lJ ) ; lJ = normalize ( lJ ) ; float lK = dot ( lJ , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lL = atan ( lJ . x , lJ . z ) ; nj = vec2 ( - lL , acos ( lK ) ) ; } else { ni = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"nk . x /= nk . w ; nk . y /= nk . w ; nk . x = 0.5 * ( nk . x + 1.0 ) ; nk . y = 0.5 * ( nk . y + 1.0 ) ; nk += 99999.0 * step ( nk . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_main , a ) ; vec3 lA = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; gy ( lz . rgb ) ; float lB = cw ( texture2D ( u_god_rays , a ) ) ; vec3 lC = lz . rgb + u_god_rays_intensity * vec3 ( lB ) * lA ; gA ( lC ) ; gl_FragColor . rgb = lC ; gl_FragColor . a = lz . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_color , a ) * 0.38026 ; lz += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; lz += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; lz += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; lz += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; lz += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; lz += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; lz += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; lz += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = lz ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_input , a ) ; float lA = dot ( lz . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( lA ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float lz ; float lA = 0.0 ; for ( float lB = 0.025 ; lB < 1.0 ; lB += 0.05 ) for ( float lC = 0.025 ; lC < 1.0 ; lC += 0.05 ) { lz = max ( texture2D ( u_input , vec2 ( lB , lC ) ) . r , 0.01 ) ; lA += log ( lz ) ; } float lD = exp ( lA / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( lD ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float nl ; void main ( ) { float nm = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float nn = texture2D ( u_luminance , a ) . r ; vec4 no = texture2D ( u_main , a ) ; float np = nn / nm ; float nq = u_bloom_edge_lum ; gl_FragColor = no * max ( np - nq , 0.0 ) * nl ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float nl ; const vec3 lz = vec3 ( 0.0 , 1.0 , 0.0 ) ; void lH ( in vec4 lA , in vec3 lB , out vec3 lC ) { float lD = lA . w * lB . x + lA . y * lB . z - lA . z * lB . y ; float lE = lA . w * lB . y + lA . z * lB . x - lA . x * lB . z ; float lF = lA . w * lB . z + lA . x * lB . y - lA . y * lB . x ; float lG = - lA . x * lB . x - lA . y * lB . y - lA . z * lB . z ; lC . x = lD * lA . w - lG * lA . x - lE * lA . z + lF * lA . y ; lC . y = lE * lA . w - lG * lA . y - lF * lA . x + lD * lA . z ; lC . z = lF * lA . w - lG * lA . z - lD * lA . y + lE * lA . x ; } void main ( ) { a = 2.0 * a_position ; vec3 lI ; lH ( u_camera_quat , lz , lI ) ; nl = dot ( - lI , u_sun_direction ) * u_bloom_key ; nl *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 lz = texture2D ( u_mb_tex_curr , a ) ; vec4 lA = texture2D ( u_mb_tex_accum , a ) ; if ( length ( lz - lA ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * lz + u_motion_blur_exp * lA ; } else { gl_FragColor = lz ; } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"vec4 lz = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( lz . r + lz . g + lz . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lA = vec2 ( 0.0 , 0.0 ) ; vec2 lB = u_texel_size ; vec4 lC ; lC = texture2D ( u_color , a ) ; gl_FragColor = lC * 0.2270270270 ; lA += lB ; lC = texture2D ( u_color , a + lA ) ; gl_FragColor += lC * 0.1945945946 ; lC = texture2D ( u_color , a - lA ) ; gl_FragColor += lC * 0.1945945946 ; lA += lB ; lC = texture2D ( u_color , a + lA ) ; gl_FragColor += lC * 0.1216216216 ; lC = texture2D ( u_color , a - lA ) ; gl_FragColor += lC * 0.1216216216 ; lA += lB ; lC = texture2D ( u_color , a + lA ) ; gl_FragColor += lC * 0.0540540541 ; lC = texture2D ( u_color , a - lA ) ; gl_FragColor += lC * 0.0540540541 ; lA += lB ; lC = texture2D ( u_color , a + lA ) ; gl_FragColor += lC * 0.0162162162 ; lC = texture2D ( u_color , a - lA ) ; gl_FragColor += lC * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 lB = u_texel_size ; vec4 lC = texture2D ( u_color , a ) ; gl_FragColor = lC ; if ( lC . a == 0.0 ) { lC = texture2D ( u_color , a + lB ) ; if ( lC . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , lC . a ) ; else { lC = texture2D ( u_color , a - lB ) ; if ( lC . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , lC . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_position ; varying vec2 a ; void main ( ) { a = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","nm",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nn ; varying vec4 no ; varying vec4 np ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nq",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 nw ( vec2 nr , sampler2D ns ) { float nt = texture2D ( ns , nr ) . r ; float nu = texture2D ( ns , nn . xy ) . r ; float nv = texture2D ( ns , nn . zw ) . r ; return vec3 ( nt , nu , nv ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nC ( vec2 nx , sampler2D ny ) { vec3 nz = nw ( nx , ny ) ; vec2 nA = abs ( nz . xx - nz . yz ) ; vec2 nB = step ( SMAA_PREDICATION_THRESHOLD , nA ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * nB ) ; }".split(" ")}]}}]},{type:"textline",b:"void nG ( bvec2 nD , inout vec2 nE , vec2 nF ) { if ( nD . x ) nE . x = nF . x ; if ( nD . y ) nE . y = nF . y ; } void nG ( bvec4 nH , inout vec4 nI , vec4 nJ ) { nG ( nH . xy , nI . xy , nJ . xy ) ; nG ( nH . zw , nI . zw , nJ . zw ) ; } vec2 nL ( vec2 nK ) { return sign ( nK ) * floor ( abs ( nK ) + .5 ) ; } vec4 nL ( vec4 nM ) { return sign ( nM ) * floor ( abs ( nM ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 oc ( vec2 nN , sampler2D nO".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","nP"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 nQ = nC ( nN , nP ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 nQ = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nR = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float nS = dot ( texture2D ( nO , nN ) . rgb , nR ) ; float nT = dot ( texture2D ( nO , nn . xy ) . rgb , nR ) ; float nU = dot ( texture2D ( nO , nn . zw ) . rgb , nR ) ; vec4 nV ; nV . xy = abs ( nS - vec2 ( nT , nU ) ) ; vec2 nW = step ( nQ , nV . xy ) ; if ( dot ( nW , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float nX = dot ( texture2D ( nO , no . xy ) . rgb , nR ) ; float nY = dot ( texture2D ( nO , no . zw ) . rgb , nR ) ; nV . zw = abs ( nS - vec2 ( nX , nY ) ) ; vec2 nZ = max ( nV . xy , nV . zw ) ; float n_ = dot ( texture2D ( nO , np . xy ) . rgb , nR ) ; float oa = dot ( texture2D ( nO , np . zw ) . rgb , nR ) ; nV . zw = abs ( vec2 ( nT , nU ) - vec2 ( n_ , oa ) ) ; nZ = max ( nZ . xy , nV . zw ) ; float ob = max ( nZ . x , nZ . y ) ; nW . xy *= step ( ob , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * nV . xy ) ; return nW ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 oe ( vec2 od ) { od . r = od . r * abs ( 5.0 * od . r - 5.0 * 0.75 ) ; return nL ( od ) ; } vec4 oe ( vec4 of ) { of . rb = of . rb * abs ( 5.0 * of . rb - 5.0 * 0.75 ) ; return nL ( of ) ; } vec2 on ( sampler2D og , vec2 oh , vec2 oi , out vec2 oj ) { vec4 ok = vec4 ( oh , - 1.0 , 1.0 ) ; vec3 ol = vec3 ( u_texel_size , 1.0 ) ; for ( int om = 0 ; om < SMAA_MAX_SEARCH_STEPS_DIAG ; om ++ ) { if ( ok . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && ok . w > 0.9 ) { ok . xyz += ol * vec3 ( oi , 1.0 ) ; oj = texture2D ( og , ok . xy , 0.0 ) . rg ; ok . w = dot ( oj , vec2 ( 0.5 , 0.5 ) ) ; } } return ok . zw ; } vec2 ov ( sampler2D oo , vec2 op , vec2 oq , out vec2 or ) { vec4 os = vec4 ( op , - 1.0 , 1.0 ) ; os . x += 0.25 * u_texel_size . x ; vec3 ot = vec3 ( u_texel_size , 1.0 ) ; for ( int ou = 0 ; ou < SMAA_MAX_SEARCH_STEPS_DIAG ; ou ++ ) { if ( os . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && os . w > 0.9 ) { os . xyz = ot * vec3 ( oq , 1.0 ) + os . xyz ; or = texture2D ( oo , os . xy , 0.0 ) . rg ; or = oe ( or ) ; os . w = dot ( or , vec2 ( 0.5 , 0.5 ) ) ; } } return os . zw ; } vec2 oB ( sampler2D ow , vec2 ox , vec2 oy , float oz ) { vec2 oA = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * oy + ox ; oA = SMAA_AREATEX_PIXEL_SIZE * oA + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; oA . x += 0.5 ; oA . y += SMAA_AREATEX_SUBTEX_SIZE * oz ; return texture2D ( ow , oA , 0.0 ) . rg ; } vec2 oQ ( sampler2D oC , sampler2D oD , vec2 oE , vec2 oF , vec4 oG ) { vec2 oH = vec2 ( 0.0 , 0.0 ) ; vec4 oI ; vec2 oJ ; if ( oF . r > 0.0 ) { oI . xz = on ( oC , oE , vec2 ( - 1.0 , 1.0 ) , oJ ) ; oI . x += float ( oJ . y > 0.9 ) ; } else oI . xz = vec2 ( 0.0 , 0.0 ) ; oI . yw = on ( oC , oE , vec2 ( 1.0 , - 1.0 ) , oJ ) ; if ( oI . x + oI . y > 2.0 ) { vec4 oK = vec4 ( - oI . x + 0.25 , oI . x , oI . y , - oI . y - 0.25 ) * u_texel_size . xyxy + oE . xyxy ; vec4 oL ; oL . xy = texture2D ( oC , oK . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; oL . zw = texture2D ( oC , oK . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; oL . yxwz = oe ( oL . xyzw ) ; vec2 oM = vec2 ( 2.0 , 2.0 ) * oL . xz + oL . yw ; nG ( bvec2 ( step ( 0.9 , oI . zw ) ) , oM , vec2 ( 0.0 , 0.0 ) ) ; oH += oB ( oD , oI . xy , oM , oG . z ) ; } oI . xz = ov ( oC , oE , vec2 ( - 1 , - 1 ) , oJ ) ; if ( texture2D ( oC , oE + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { oI . yw = ov ( oC , oE , vec2 ( 1 , 1 ) , oJ ) ; oI . y += float ( oJ . y > 0.9 ) ; } else oI . yw = vec2 ( 0.0 , 0.0 ) ; if ( oI . x + oI . y > 2.0 ) { vec4 oN = vec4 ( - oI . x , - oI . x , oI . y , oI . y ) * u_texel_size . xyxy + oE . xyxy ; vec4 oO ; oO . x = texture2D ( oC , oN . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; oO . y = texture2D ( oC , oN . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; oO . zw = texture2D ( oC , oN . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 oP = vec2 ( 2.0 , 2.0 ) * oO . xz + oO . yw ; nG ( bvec2 ( step ( 0.9 , oI . zw ) ) , oP , vec2 ( 0 , 0 ) ) ; oH += oB ( oD , oI . xy , oP , oG . w ) . gr ; } return oH ; }".split(" ")}]}}]},
{type:"textline",b:"float oW ( sampler2D oR , vec2 oS , float oT ) { vec2 oU = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 oV = SMAA_SEARCHTEX_SIZE * vec2 ( oT , 1.0 ) ; oU += vec2 ( - 1.0 , 1.0 ) ; oV += vec2 ( 0.5 , - 0.5 ) ; oU *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; oV *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( oR , oU * oS + oV , 0.0 ) . r ; } float pd ( sampler2D oX , sampler2D oY , vec2 oZ , float o_ ) { vec2 pa = vec2 ( 0.0 , 1.0 ) ; for ( int pb = 0 ; pb < SMAA_MAX_SEARCH_STEPS ; pb ++ ) { if ( oZ . x > o_ && pa . g > 0.8281 && pa . r == 0.0 ) { pa = texture2D ( oX , oZ , 0.0 ) . rg ; oZ = - vec2 ( 2.0 , 0.0 ) * u_texel_size + oZ ; } } float pc = - ( 255.0 / 127.0 ) * oW ( oY , pa , 0.0 ) + 3.25 ; return u_texel_size . x * pc + oZ . x ; } float pl ( sampler2D pe , sampler2D pf , vec2 pg , float ph ) { vec2 pi = vec2 ( 0.0 , 1.0 ) ; for ( int pj = 0 ; pj < SMAA_MAX_SEARCH_STEPS ; pj ++ ) { if ( pg . x < ph && pi . g > 0.8281 && pi . r == 0.0 ) { pi = texture2D ( pe , pg , 0.0 ) . rg ; pg = vec2 ( 2.0 , 0.0 ) * u_texel_size + pg ; } } float pk = - ( 255.0 / 127.0 ) * oW ( pf , pi , 0.5 ) + 3.25 ; return - u_texel_size . x * pk + pg . x ; } float pt ( sampler2D pm , sampler2D pn , vec2 po , float pp ) { vec2 pq = vec2 ( 1.0 , 0.0 ) ; for ( int pr = 0 ; pr < SMAA_MAX_SEARCH_STEPS ; pr ++ ) { if ( po . y > pp && pq . r > 0.8281 && pq . g == 0.0 ) { pq = texture2D ( pm , po , 0.0 ) . rg ; po = - vec2 ( 0.0 , 2.0 ) * u_texel_size + po ; } } float ps = - ( 255.0 / 127.0 ) * oW ( pn , pq . gr , 0.0 ) + 3.25 ; return u_texel_size . y * ps + po . y ; } float pB ( sampler2D pu , sampler2D pv , vec2 pw , float px ) { vec2 py = vec2 ( 1.0 , 0.0 ) ; for ( int pz = 0 ; pz < SMAA_MAX_SEARCH_STEPS ; pz ++ ) { if ( pw . y < px && py . r > 0.8281 && py . g == 0.0 ) { py = texture2D ( pu , pw , 0.0 ) . rg ; pw = vec2 ( 0.0 , 2.0 ) * u_texel_size + pw ; } } float pA = - ( 255.0 / 127.0 ) * oW ( pv , py . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * pA + pw . y ; } vec2 pI ( sampler2D pC , vec2 pD , float pE , float pF , float pG ) { vec2 pH = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * nL ( 4.0 * vec2 ( pE , pF ) ) + pD ; pH = SMAA_AREATEX_PIXEL_SIZE * pH + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; pH . y = SMAA_AREATEX_SUBTEX_SIZE * pG + pH . y ; return texture2D ( pC , pH , 0.0 ) . rg ; } void pQ ( sampler2D pJ , inout vec2 pK , vec4 pL , vec2 pM ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pN = step ( pM . xy , pM . yx ) ; vec2 pO = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pN ; pO /= pN . x + pN . y ; vec2 pP = vec2 ( 1.0 , 1.0 ) ; pP . x -= pO . x * texture2D ( pJ , pL . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; pP . x -= pO . y * texture2D ( pJ , pL . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; pP . y -= pO . x * texture2D ( pJ , pL . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; pP . y -= pO . y * texture2D ( pJ , pL . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; pK *= clamp ( pP , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void pY ( sampler2D pR , inout vec2 pS , vec4 pT , vec2 pU ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pV = step ( pU . xy , pU . yx ) ; vec2 pW = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pV ; pW /= pV . x + pV . y ; vec2 pX = vec2 ( 1.0 , 1.0 ) ; pX . x -= pW . x * texture2D ( pR , pT . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; pX . x -= pW . y * texture2D ( pR , pT . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; pX . y -= pW . x * texture2D ( pR , pT . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; pX . y -= pW . y * texture2D ( pR , pT . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; pS *= clamp ( pX , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qq ( vec2 pZ , vec2 p_ , sampler2D qa , sampler2D qb , sampler2D qc , vec4 qd ) { vec4 qe = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 qf = texture2D ( qa , pZ ) . rg ; if ( qf . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"qe . rg = oQ ( qa , qb , pZ , qf , qd ) ; if ( qe . r == - qe . g ) {".split(" ")}]}}]},
{type:"textline",b:"vec2 qg ; vec3 qh ; qh . x = pd ( qa , qc , nn . xy , np . x ) ; qh . y = no . y ; qg . x = qh . x ; float qi = texture2D ( qa , qh . xy , 0.0 ) . r ; qh . z = pl ( qa , qc , nn . zw , np . y ) ; qg . y = qh . z ; qg = abs ( nL ( qg / u_texel_size . xx - p_ . xx ) ) ; vec2 qj = sqrt ( qg ) ; float qk = texture2D ( qa , qh . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; qe . rg = pI ( qb , qj , qi , qk , qd . y ) ; qh . y = pZ . y ; pQ ( qa , qe . rg , qh . xyzy , qg ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else qf . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( qf . r > 0.0 ) { vec2 ql ; vec3 qm ; qm . y = pt ( qa , qc , no . xy , np . z ) ; qm . x = nn . x ; ql . x = qm . y ; float qn = texture2D ( qa , qm . xy , 0.0 ) . g ; qm . z = pB ( qa , qc , no . zw , np . w ) ; ql . y = qm . z ; ql = abs ( nL ( ql / u_texel_size . yy - p_ . yy ) ) ; vec2 qo = sqrt ( ql ) ; float qp = texture2D ( qa , qm . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; qe . ba = pI ( qb , qo , qn , qp , qd . x ) ; qm . x = pZ . x ; pY ( qa , qe . ba , qm . xyxz , ql ) ; } return qe ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qH ( vec2 qr , sampler2D qs , sampler2D qt".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qu"]}]}}]},{type:"textline",b:") { vec4 qv ; qv . x = texture2D ( qt , nm . xy ) . a ; qv . y = texture2D ( qt , nm . zw ) . g ; qv . wz = texture2D ( qt , qr ) . xz ; if ( dot ( qv , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 qw = texture2D ( qs , qr , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qx = texture2D ( qu , a ) ; vec2 qy = 2.0 * cE ( qx ) - 1.0 ; qw . a = sqrt ( 2.0 * length ( qy ) ) ;".split(" ")}]}}]},{type:"textline",b:"return qw ; } else { bool qz = max ( qv . x , qv . z ) > max ( qv . y , qv . w ) ; vec4 qA = vec4 ( 0.0 , qv . y , 0.0 , qv . w ) ; vec2 qB = qv . yw ; nG ( bvec4 ( qz , qz , qz , qz ) , qA , vec4 ( qv . x , 0.0 , qv . z , 0.0 ) ) ; nG ( bvec2 ( qz , qz ) , qB , qv . xz ) ; qB /= dot ( qB , vec2 ( 1.0 , 1.0 ) ) ; vec4 qC = qA * vec4 ( u_texel_size , - u_texel_size ) + qr . xyxy ; vec4 qD = qB . x * texture2D ( qs , qC . xy , 0.0 ) ; qD += qB . y * texture2D ( qs , qC . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qE = texture2D ( qu , qC . xy ) ; vec2 qF = 2.0 * cE ( qE ) - 1.0 ; vec2 qG = qB . x * qF ; qE = texture2D ( qu , qC . zw ) ; qF = 2.0 * cE ( qE ) - 1.0 ; qG += qB . y * qF ; qD . a = sqrt ( 2.0 * length ( qG ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","qD",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qT ( vec2 qI , sampler2D qJ , sampler2D qK".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qL"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qM = texture2D ( qL , a ) ; vec2 qN ; qN = 2.0 * cE ( qM ) - 1.0 ; vec4 qO = texture2D ( qJ , qI ) ; vec4 qP = texture2D ( qK , qI - qN ) ; float qQ = abs ( qO . a * qO . a - qP . a * qP . a ) / 2.0 ; float qR = 0.5 * clamp ( 1.0 - sqrt ( qQ ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 qS = mix ( qO , qP , qR ) ; qS . a = 1.0 ; return qS ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qO = texture2D ( qJ , qI ) ; vec4 qP = texture2D ( qK , qI ) ; return mix ( qO , qP , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qU = vec4 ( oc ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qU = qq ( a , nq , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qU = qH ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qU = vec4 ( qT ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qU = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","qU",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","nm",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nn ; varying vec4 no ; varying vec4 np ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nq",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void lA ( vec2 lz ) { nn = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + lz . xyxy ; no = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + lz . xyxy ; np = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + lz . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void lD ( vec2 lB , out vec2 lC ) { lC = lB / u_texel_size ; nn = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + lB . xyxy ; no = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + lB . xyxy ; np = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( nn . xz , no . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void lF ( vec2 lE ) { nm = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + lE . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = 2.0 * a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["lA","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"lD ( a , nq ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["lF","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},
{type:"define",name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float ns ( in vec2 nr ) { return nh ( u_depth , nr , u_camera_range ) ; } void main ( ) { float nt = texture2D ( u_color , a ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( nt , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"vec3 nu = normalize ( 2.0 * texture2D ( u_ssao_special_tex , a * 0.25 / u_texel_size ) . rgb - 1.0 ) ; float nv = ns ( a ) ; float nw = nv * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_8"],group:{type:"group",a:[{type:"textline",b:"const float nx = 8.0 ; const int ny = 1 ;".split(" ")}]}},
{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"const float nx = 16.0 ; const int ny = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_24"],group:{type:"group",a:[{type:"textline",b:"const float nx = 24.0 ; const int ny = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"const float nx = 32.0 ; const int ny = 4 ;".split(" ")}]}}]},{type:"textline",b:"float nz = u_ssao_radius_increase * 0.001 ; const float nA = 1.0 + 2.4 / nx ; float nB = 0.0 ; for ( int nC = 0 ; nC < ny ; nC ++ ) for ( int nD = - 1 ; nD <= 1 ; nD += 2 ) for ( int nE = - 1 ; nE <= 1 ; nE += 2 ) for ( int nF = - 1 ; nF <= 1 ; nF += 2 ) { vec3 nG = reflect ( normalize ( vec3 ( nD , nE , nF ) ) , nu ) * ( nz *= nA ) ; vec3 nH = vec3 ( a , nw ) ; nH += vec3 ( nG . xy , nG . z * nw * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nH . z -= 1.4 * ( nH . z - nw ) * step ( nw , nH . z ) ;".split(" ")}]}}]},{type:"textline",b:"float nI = ns ( nH . xy ) * ( u_camera_range . y - u_camera_range . x ) ; float nJ = clamp ( ( nw - nI ) / nI , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nB += mix ( 1.0 , nJ , step ( nI , nH . z ) ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"nB += mix ( step ( nH . z , nI ) , 0.5 , nJ ) ;".split(" ")}]}}]},{type:"textline",b:"} nB = nB / nx ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nB = clamp ( nB * nB + 0.6 * nB , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nB = clamp ( nB * nB + nB , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"float nK = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * nv ) ; nB = mix ( 1.0 , nB , nK ) ; gl_FragColor = vec4 ( nt , nB , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float ns ( in vec2 nr ) { return nh ( u_depth , nr , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float nt = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nu = ns ( a ) ; float nv = 0.0 ; float nw = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"vec2 nx = vec2 ( - 2.0 ) ; for ( int ny = 0 ; ny < 4 ; ++ ny ) { for ( int nz = 0 ; nz < 4 ; ++ nz ) { vec2 nA = ( nx + vec2 ( float ( ny ) , float ( nz ) ) ) * u_texel_size ; float nB = texture2D ( u_ssao_mask , a + nA ) . g ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nC = ns ( a + nA ) ; float nD = 1.0 - clamp ( abs ( nC - nu ) * nw , 0.0 , 1.0 ) ; nt += nB * nD ; nv += nD ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nt","+=","nB",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nt / nv , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nt / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { float lz = texture2D ( u_depth , a ) . x ; vec4 lA = vec4 ( a * 2.0 - 1.0 , 2.0 * lz - 1.0 , 1.0 ) ; vec4 lB = u_view_proj_inverse * lA ; vec4 lC = lB / lB . w ; vec4 lD = u_view_proj_prev * lC ; lD /= lD . w ; vec2 lE = ( lA . xy - lD . xy ) / 4.0 + 0.5 ; lE = clamp ( lE , 0.0 , 1.0 ) ; gl_FragColor = cs ( lE ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; float c = 1.0 ; struct d { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool g ( vec3 e , vec3 f ) { return any ( lessThan ( abs ( e - f ) , vec3 ( EPSILON ) ) ) ; } vec3 j ( in vec4 h , in vec3 i ) { return i + 2.0 * cross ( h . xyz , cross ( h . xyz , i ) + h . w * i ) ; } mat4 k ( ) { return mat4 ( c , b , b , b , b , c , b , b , b , b , c , b , b , b , b , c ) ; } mat4 m ( float l ) { return mat4 ( c , b , b , b , b , cos ( l ) , sin ( l ) , b , b , - sin ( l ) , cos ( l ) , b , b , b , b , c ) ; } mat4 o ( float n ) { return mat4 ( cos ( n ) , b , - sin ( n ) , b , b , c , b , b , sin ( n ) , b , cos ( n ) , b , b , b , b , c ) ; } mat4 q ( float p ) { return mat4 ( cos ( p ) , sin ( p ) , b , b , - sin ( p ) , cos ( p ) , b , b , b , b , c , b , b , b , b , c ) ; } d s ( in d r ) { return d ( r . a , r . b , normalize ( r . c ) , normalize ( r . d ) , normalize ( r . e ) , r . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 t = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 z ( vec3 u , mat4 v ) { vec3 w = vec3 ( v [ 0 ] [ 0 ] , v [ 1 ] [ 0 ] , v [ 2 ] [ 0 ] ) ; vec3 x = vec3 ( v [ 0 ] [ 1 ] , v [ 1 ] [ 1 ] , v [ 2 ] [ 1 ] ) ; vec3 y = vec3 ( v [ 0 ] [ 2 ] , v [ 1 ] [ 2 ] , v [ 2 ] [ 2 ] ) ; x = cross ( y , w ) ; return mat4 ( vec4 ( w , 0.0 ) , vec4 ( x , 0.0 ) , vec4 ( y , 0.0 ) , vec4 ( u , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 F ( vec3 A , vec3 B ) { vec3 C = A - B ; C . y = 0.0 ; C = normalize ( C ) ; vec3 D = normalize ( cross ( t , C ) ) ; vec3 E = normalize ( cross ( C , D ) ) ; return mat4 ( vec4 ( D , 0.0 ) , vec4 ( E , 0.0 ) , vec4 ( C , 0.0 ) , vec4 ( B , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 Q ( in vec3 G , float H , float I , float J , vec3 L ) { float M = fract ( length ( L ) / 0.17 ) ; float N = J + M / 10.0 ; float O = M ; if ( J != 0.0 ) O /= J ; G *= 1.0 + 0.5 * sin ( H ) ; float P = length ( G ) * I * sin ( 2.0 * 3.14 * H * N + O ) ; return q ( P ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 aa ( in vec3 R , in vec3 S , in mat4 T ) {".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 U = z ( S , T ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"float V = fract ( ( S . x * 1.43 + S . y * 0.123 + S . z * 6.1 ) ) ; float W = 2.0 * M_PI * V ; vec3 X = normalize ( vec3 ( T [ 0 ] [ 2 ] , 0.0 , T [ 2 ] [ 2 ] ) ) ; float Y = acos ( X [ 2 ] ) ; if ( X [ 0 ] < 0.0 ) Y = 2.0 * M_PI - Y ; float Z = Y - W ; if ( Z < 0.0 ) Z = 2.0 * M_PI + Z ; float _ = W ; if ( Z <= MAX_BILLBOARD_ANGLE ) _ += Z ; else if ( Z <= M_PI - MAX_BILLBOARD_ANGLE ) _ += MAX_BILLBOARD_ANGLE * ( 2.0 * Z - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( Z <= M_PI + MAX_BILLBOARD_ANGLE ) _ += Z - M_PI ; else if ( Z <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) _ += MAX_BILLBOARD_ANGLE * ( 2.0 * Z - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else _ += Z - 2.0 * M_PI ; mat4 U = o ( _ ) ; U [ 3 ] = vec4 ( S , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 U = F ( R , S ) ;".split(" ")}]}}]},{type:"textline",b:["return","U",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 ag ( in vec3 ab , in vec3 ac , in mat4 ad , mat4 ae ) { mat4 af = aa ( ab , ac , ad ) ; ae [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; af = af * ae ; return af ; }".split(" ")}]}}]},{type:"textline",b:"d an ( in vec3 ah , in vec3 ai , in vec3 aj , in vec3 ak , in vec3 al , in mat4 am ) { ah = ( am * vec4 ( ah , 1.0 ) ) . xyz ; ai = ( am * vec4 ( ai , 1.0 ) ) . xyz ; aj = ( am * vec4 ( aj , 0.0 ) ) . xyz ; ak = ( am * vec4 ( ak , 0.0 ) ) . xyz ; al = ( am * vec4 ( al , 0.0 ) ) . xyz ; return s ( d ( ah , ai , aj , ak , al , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};
a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 aq ( vec2 ao , vec3 ap ) { return ( ao + 0.5 ) * ap . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 az ( in vec4 ar , in vec4 as , in float at ) { float au = ar [ 0 ] * as [ 0 ] + ar [ 1 ] * as [ 1 ] + ar [ 2 ] * as [ 2 ] + ar [ 3 ] * as [ 3 ] ; if ( au < 0.0 ) { as *= - 1.0 ; au = - au ; } if ( abs ( au ) >= 1.0 ) return ar ; float av = acos ( au ) ; float aw = sqrt ( 1.0 - au * au ) ; if ( abs ( aw ) < 0.001 ) return vec4 ( ar * 0.5 + as * 0.5 ) ; float ax = sin ( ( 1.0 - at ) * av ) / aw ; float ay = sin ( at * av ) / aw ; return ar * ax + as * ay ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aO ( in vec3 aA , in vec4 aB , in vec4 aC , in vec4 aD , in vec4 aE , in float aF ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aG = az ( aB , aC , aF ) ; vec4 aH = mix ( aD , aE , aF ) ; vec3 aI = j ( aG , aA ) ; vec3 aJ = aI * aH . w + aH . xyz ; return aJ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aK = j ( aB , aA ) ; vec3 aL = j ( aC , aA ) ; vec3 aM = aK * aD . w + aD . xyz ; vec3 aN = aL * aE . w + aE . xyz ; return mix ( aM , aN , aF ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aX ( in vec3 aP , in vec4 aQ , in vec4 aR , in float aS ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aT = az ( aQ , aR , aS ) ; vec3 aU = j ( aT , aP ) ; return aU ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aV = j ( aQ , aP ) ; vec3 aW = j ( aR , aP ) ; return mix ( aV , aW , aS ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 aO ( in vec3 aY , in vec4 aZ , in vec4 a_ ) { vec3 ba = j ( aZ , aY ) ; vec3 bb = ba * a_ . w + a_ . xyz ; return bb ; } vec3 aX ( in vec3 bc , in vec4 bd ) { vec3 be = j ( bd , bc ) ; return be ; }".split(" ")}]}}]},{type:"textline",b:"void bt ( inout vec3 bf , inout vec3 bg , inout vec3 bh , inout vec3 bi ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["float","bj","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { vec3 bk = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bl = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bm = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bn = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec4 bo = a_influence ; for ( int bp = 0 ; bp < 4 ; bp ++ ) { int bq = int ( bo [ bp ] ) ; float br = fract ( bo [ bp ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bk += br * aO ( bf , u_quatsb [ bq ] , u_quatsa [ bq ] , u_transb [ bq ] , u_transa [ bq ] , bj ) ; bl += br * aX ( bg , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ; bm += br * aX ( bh , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ; bn += br * aX ( bi , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bk += br * aO ( bf , u_quatsb [ bq ] , u_transb [ bq ] ) ; bl += br * aX ( bg , u_quatsb [ bq ] ) ; bm += br * aX ( bh , u_quatsb [ bq ] ) ; bn += br * aX ( bi , u_quatsb [ bq ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} bf = bk ; bg = bl ; bh = bm ; bi = bn ; } if ( ! ( a_influence . y > 0.0 ) ) { int bs = int ( a_influence [ 0 ] - 1.0 ) ; if ( bs > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bf = aO ( bf , u_quatsb [ bs ] , u_quatsa [ bs ] , u_transb [ bs ] , u_transa [ bs ] , bj ) ; bg = aX ( bg , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ; bh = aX ( bh , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ; bi = aX ( bi , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bf = aO ( bf , u_quatsb [ bs ] , u_transb [ bs ] ) ; bg = aX ( bg , u_quatsb [ bs ] ) ; bh = aX ( bh , u_quatsb [ bs ] ) ; bi = aX ( bi , u_quatsb [ bs ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bH ( inout vec3 bu , in vec3 bv , in float bw , in float bx , in float by , in vec3 bz , in float bA ) { float bB = length ( bv ) ; float bC = bx * ( 1.0 + 0.1 * fract ( bB ) ) ; float bD = bw * bA * ( 1.0 + sin ( 2.0 * 3.14 * by * bC + bB ) ) ; float bE = ( bu . y - bv . y ) * abs ( bD ) ; bE += 1.0 ; bE *= bE ; bE = bE * bE - bE ; vec3 bF = bu ; bF . xz += bz . xz * bE * sign ( bD ) ; float bG = length ( bu - bv ) ; bu = bv + normalize ( bF - bv ) * bG ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bJ ( vec4 bI ) { return bI * bI * ( 3.0 - 2.0 * bI ) ; } vec4 bL ( vec4 bK ) { return abs ( fract ( bK + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bN ( vec4 bM ) { return bJ ( bL ( bM ) ) ; } void cd ( inout vec3 bO , in float bP , in vec3 bQ , in vec3 bR , in vec3 bS , in float bT , in float bU , in float bV , in vec3 bW ) { float bX ; float bY ; float bZ ; vec2 b_ ; vec4 ca ; vec2 cb ; vec3 cc ; bX = dot ( bS , vec3 ( 1.0 ) ) ; bY = bX + bW . g ; bZ = dot ( bO , vec3 ( bW . g ) ) ; b_ = ( bP + vec2 ( bZ , bY ) ) ; ca = ( ( fract ( ( b_ . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bR ) * bT ; ca = bN ( ca ) ; cb = ca . xz + ca . yw ; cb . y = 0.5 - cb . y ; cc = cb . xyx * bW . rbr * vec3 ( bU * bQ . x , bV , bU * bQ . z ) ; bO += cc ; }".split(" ")}]}}]},
{type:"textline",b:"void ck ( inout vec3 ce , inout vec3 cf , in vec3 cg ) { vec3 ch = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vec3 ci = cf ; vec3 cj = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ci = ce ; vec3 cj = cf ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"cd ( ci , u_time , cg , ch , cj , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bH ( ci , cj , au_wind_bending_amp , au_wind_bending_freq , u_time , ch , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bH ( ci , cj , au_wind_bending_amp , au_wind_bending_freq , u_time , ch , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"ce += ci - cf ; cf = ci ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ce = ci ; cf = cj ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",
b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",
b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float cl = 255.0 ; float cm = 0.0 ; float cn = 1.0 ; vec4 cs ( const in float co ) { vec4 cp = vec4 ( cl * cl * cl , cl * cl , cl , cn ) ; vec4 cq = vec4 ( cm , cn / cl , cn / cl , cn / cl ) ; vec4 cr = fract ( co * cp ) ; cr -= cr . xxyz * cq ; return cr ; } float cw ( const in vec4 ct ) { float cu ; vec4 cv = vec4 ( cn / ( cl * cl * cl ) , cn / ( cl * cl ) , cn / cl , cn ) ; cu = dot ( ct , cv ) ; return cu ; } vec4 cs ( const in vec2 cx ) { vec2 cy = vec2 ( cl , cn ) ; vec2 cz = vec2 ( cm , cn / cl ) ; vec4 cA = fract ( cx . xxyy * cy . xyxy ) ; cA -= cA . xxzz * cz . xyxy ; if ( cx . r == cn ) cA . rg = vec2 ( cm , cn ) ; if ( cx . g == cn ) cA . ba = vec2 ( cm , cn ) ; return cA ; } vec2 cE ( const in vec4 cB ) { vec2 cC ; vec2 cD = vec2 ( cn / cl , cn ) ; cC . r = dot ( cB . rg , cD ) ; cC . g = dot ( cB . ba , cD ) ; return cC ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float cM = 0.0 ; float cN = 1.0 ; vec4 cP ( vec4 cO ) { return cO - floor ( cO * ( cN / 289.0 ) ) * 289.0 ; } vec3 cP ( vec3 cQ ) { return cQ - floor ( cQ * ( cN / 289.0 ) ) * 289.0 ; } vec2 cP ( vec2 cR ) { return cR - floor ( cR * ( cN / 289.0 ) ) * 289.0 ; } vec4 cT ( vec4 cS ) { return cS - floor ( cS * ( cN / 7.0 ) ) * 7.0 ; } vec4 cV ( vec4 cU ) { return cP ( ( 34.0 * cU + 5.0 ) * cU ) ; }".split(" ")},{type:"define",name:"K",
b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 dg ( vec2 cW ) { vec2 cX = cP ( floor ( cW ) ) ; vec2 cY = fract ( cW ) ; vec4 cZ = cY . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 c_ = cY . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 da = cV ( cX . x + vec4 ( cM , cN , cM , cN ) ) ; da = cV ( da + cX . y + vec4 ( cM , cM , cN , cN ) ) ; vec4 db = cT ( da ) * K + K2 ; vec4 dc = cT ( floor ( da * K ) ) * K + K2 ; vec4 dd = cZ + JITTER * db ; vec4 de = c_ + JITTER * dc ; vec4 df = dd * dd + de * de ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"df . xy = min ( df . xy , df . zw ) ; df . x = min ( df . x , df . y ) ; return df . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"df . xy = ( df . x < df . y ) ? df . xy : df . yx ; df . xz = ( df . x < df . z ) ? df . xz : df . zx ; df . xw = ( df . x < df . w ) ? df . xw : df . wx ; df . y = min ( df . y , df . z ) ; df . y = min ( df . y , df . w ) ; return sqrt ( df . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 dw ( vec2 dh , float di ) { vec2 dj = cP ( floor ( dh ) ) ; vec2 dk = fract ( dh ) ; vec4 dl = dk . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 dm = dk . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 dn = cV ( dj . x + vec4 ( cM , cN , cM , cN ) ) ; dn = cV ( dn + dj . y + vec4 ( cM , cM , cN , cN ) ) ; vec4 dp = cT ( dn ) * K + K2 ; vec4 dq = cT ( floor ( dn * K ) ) * K + K2 ; vec4 dr = dl + JITTER * dp ; vec4 ds = dm + JITTER * dq ; vec4 dt = dr * dr + ds * ds ; dr += di ; ds += di ; vec4 du = dr * dr + ds * ds ; dr += di ; ds += di ; vec4 dv = dr * dr + ds * ds ; dt . xy = min ( dt . xy , dt . zw ) ; dt . x = min ( dt . x , dt . y ) ; du . xy = min ( du . xy , du . zw ) ; du . x = min ( du . x , du . y ) ; dv . xy = min ( dv . xy , dv . zw ) ; dv . x = min ( dv . x , dv . y ) ; return mat3 ( dt . xx , cM , du . xx , cM , dv . xx , cM ) ; } vec3 dy ( vec3 dx ) { return cP ( ( ( dx * 34.0 ) + cN ) * dx ) ; } float dM ( vec2 dz ) { const vec4 dA = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 dB = floor ( dz + dot ( dz , dA . yy ) ) ; vec2 dC = dz - dB + dot ( dB , dA . xx ) ; vec2 dD ; dD = ( dC . x > dC . y ) ? vec2 ( cN , cM ) : vec2 ( cM , cN ) ; vec4 dE = dC . xyxy + dA . xxzz ; dE . xy -= dD ; dB = cP ( dB ) ; vec3 dF = dy ( dy ( dB . y + vec3 ( cM , dD . y , cN ) ) + dB . x + vec3 ( cM , dD . x , cN ) ) ; vec3 dG = max ( 0.5 - vec3 ( dot ( dC , dC ) , dot ( dE . xy , dE . xy ) , dot ( dE . zw , dE . zw ) ) , cM ) ; dG = dG * dG ; dG = dG * dG ; vec3 dH = 2.0 * fract ( dF * dA . www ) - cN ; vec3 dI = abs ( dH ) - 0.5 ; vec3 dJ = floor ( dH + 0.5 ) ; vec3 dK = dH - dJ ; dG *= 1.79284291400159 - 0.85373472095314 * ( dK * dK + dI * dI ) ; vec3 dL ; dL . x = dK . x * dC . x + dI . x * dC . y ; dL . yz = dK . yz * dE . xz + dI . yz * dE . yw ; return 130.0 * dot ( dG , dL ) ; } vec2 dS ( vec2 dN ) { float dO = dot ( dN , vec2 ( 12.9898 , 78.233 ) ) ; float dP = dot ( dN , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float dQ = fract ( sin ( dO ) * 43758.5453 ) * 2.0 - cN ; float dR = fract ( sin ( dP ) * 43758.5453 ) * 2.0 - cN ; return vec2 ( dQ , dR ) ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","dT",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"const float dU = 0.1 ; const float dV = 0.1 ; const float dW = - 0.01 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"const float dX = 0.05 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mat4 dY = mat4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 , 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 , - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 , - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; mat4 dZ = mat4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 , - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 , - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 , - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"bool eb ( vec2 d_ , float ea ) { return all ( lessThanEqual ( d_ , vec2 ( 1.0 + ea ) ) ) && all ( greaterThanEqual ( d_ , vec2 ( 0.0 - ea ) ) ) ; }".split(" ")}]}}]},{type:"textline",b:"float eo ( vec3 ec , sampler2D ed , float ee ) { float ef ; ec . z = clamp ( ec . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",
a:[{type:"textline",b:"ef = 0.0 ; float eg = dS ( ec . xy ) . x * M_PI ; float eh = cos ( eg ) ; float ei = sin ( eg ) ; mat2 ej = mat2 ( eh , ei , - ei , eh ) ; vec2 ek , el ; for ( int em = 0 ; em < 4 ; em ++ ) for ( int en = 0 ; en < 4 ; en ++ ) { el . x = dY [ em ] [ en ] ; el . y = dZ [ em ] [ en ] ; el = ej * el ; ek = ec . xy + el * ee / SHADOW_TEX_RES ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ! eb ( ek , dW ) ) ef += 1.0 ; else".split(" ")}]}}]},
{type:"textline",b:"ef += step ( ec . z , texture2D ( ed , ek ) . r ) ; } ef /= 16.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["ef","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( ef , 0.0 , 1.0 ) ; } float eG ( vec3 ep , sampler2D eq , vec3 er , sampler2D es , float et , float eu , float ev ) { float ew , ex ; ep . z = clamp ( ep . z , 0.0 , 1.0 ) ; er . z = clamp ( er . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],
group:{type:"group",a:[{type:"textline",b:"ew = 0.0 ; ex = 0.0 ; float ey = dS ( ep . xy ) . x * M_PI ; float ez = cos ( ey ) ; float eA = sin ( ey ) ; mat2 eB = mat2 ( ez , eA , - eA , ez ) ; vec2 eC , eD ; for ( int eE = 0 ; eE < 4 ; eE ++ ) for ( int eF = 0 ; eF < 4 ; eF ++ ) { eD . x = dY [ eE ] [ eF ] ; eD . y = dZ [ eE ] [ eF ] ; eD = eB * eD ; eC = ep . xy + eD * et / SHADOW_TEX_RES ; ew += step ( ep . z , texture2D ( eq , eC ) . r ) ; eC = er . xy + eD * eu / SHADOW_TEX_RES ; ex += step ( er . z , texture2D ( es , eC ) . r ) ; } ew = mix ( ew , ex , ev ) ; ew /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["ew","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( ew , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"float eK ( vec2 eH ) { float eI = min ( eH . x , eH . y ) ; float eJ = min ( 1.0 - eH . x , 1.0 - eH . y ) ; return min ( eI , eJ ) ; } float eN ( float eL , float eM ) { if ( eM >= 0.0 && eM <= dV ) eL = ( eL - 1.0 ) / dV * eM + 1.0 ; return eL ; } float eZ ( vec3 eO , vec3 eP , sampler2D eQ , sampler2D eR , float eS , float eT , float eU , float eV ) { float eW ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"float eX = eK ( eO . xy ) ; if ( - eV > eU && eX >= 0.0 && eX <= dU && eb ( eP . xy , 0.0 ) ) { float eY = 1.0 - eX / dU ; eW = eG ( eO , eQ , eP , eR , eS , eT , eY ) ; } else".split(" ")}]}}]},{type:"textline",b:"eW = eo ( eO , eQ , eS ) ; return eW ; } float fg ( vec3 e_ , sampler2D fa , float fb , float fc , float fd ) { float fe = eo ( e_ , fa , fb ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - fd > fc ) { float ff = eK ( e_ . xy ) ; fe = eN ( fe , ff ) ; }".split(" ")}]}}]},{type:"textline",b:"return fe ; } float fn ( float fh ) { float fi = 1.0 ; vec3 fj = cG . xyz / cG . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"vec3 fk = cH . xyz / cH . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:"vec3 fl = cI . xyz / cI . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"vec3 fm = cJ . xyz / cJ . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( eb ( fj . xy , 0.0 ) ) { fi = eZ ( fj , fk , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , fh ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( eb ( fj . xy , dX ) ) { fi = fg ( fj , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , fh ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fk . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"fi = eZ ( fk , fl , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , fh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"fi = fg ( fk , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , fh ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fl . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"fi = eZ ( fl , fm , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , fh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"fi = fg ( fl , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , fh ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fm . xy , 0.0 ) ) fi = fg ( fm , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , fh ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","fi",";","}"]}]}}]}]}}]},{type:"textline",b:"float fs ( inout vec3 fo ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 fp = texture2DProj ( u_shadow_mask , cK ) . rg ; vec3 fq = vec3 ( fp . r ) ; float fr = fp . g ; dT = vec4 ( fq , fr ) ; fo *= dT . a ; return dT . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return fn ( cL . z ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 fx ( vec3 ft , float fu , vec2 fv ) { vec2 fw = vec2 ( ( ft . x - fv . x ) / fu , - ( ft . z - fv . y ) / fu ) ; return fract ( fw ) ; } vec2 fB ( vec2 fy , float fz , vec2 fA ) { return vec2 ( fy . x * fz , - fy . y * fz ) + fA ; } d fC ( ) { return d ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } d gh ( vec3 fD , vec3 fE , vec3 fF , vec3 fG , vec3 fH , sampler2D fI , sampler2D fJ , vec3 fK , float fL , vec3 fM , vec4 fN , mat4 fO ) { vec3 fP = j ( fN , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float fQ = - fP . x ; float fR = - fP . z ; vec2 fS = vec2 ( fM . x + fL * ( - 1.0 - fQ ) / 2.0 , fM . z + fL * ( 1.0 - fR ) / 2.0 ) ; vec2 fT = fx ( fH , fL , fS ) ; float fU = fL / 2.0 ; vec2 fV = abs ( fB ( fT - vec2 ( 0.5 ) , fL , vec2 ( 0.0 ) ) ) ; float fW = fU * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( fV ) > fW ) return fC ( ) ; float fX = fL / fK . z ; vec2 fY = ( fT - vec2 ( 0.5 ) ) * fX + vec2 ( 0.5 ) ; vec3 fZ = fP * ( fL / fK . z - 1.0 ) / 2.0 ; fY . x += fZ . x ; fY . y -= fZ . z ; vec4 f_ = texture2D ( fJ , fY ) ; float ga = f_ . r ; if ( ga < u_scale_threshold ) return fC ( ) ; float gb = fK . y - fK . x ; float gc = fK . y - texture2D ( fI , fY ) . r * gb ; vec2 gd = fD . xz - fH . xz ; fH . xz = fB ( fT , fL , fS ) ; fH . y = gc ; fD . xz = fH . xz + gd ; fD . y *= ga ; fD . y += gc ; vec3 ge = f_ . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fD -= fH ; mat4 gf = aa ( fM , fH , fO ) ; d gg = an ( fD , fH , fE , fF , fG , gf ) ; gg . b = fH ; gg . f = ge ; return s ( gg ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return s ( d ( fD , fH , fE , fF , fG , ge ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"vec4 gn ( mat4 gi , vec4 gj ) { vec2 gk = ( gi * u_v_light_matrix [ 3 ] ) . xy ; float gl = SHADOW_TEX_RES / 2.0 ; gk = floor ( gk * gl + 0.5 ) / gl - gk ; vec4 gm = gi * gj ; gm . xy += gk ; gm = u_b_light_matrix * gm ; return gm ; } void gr ( vec3 go ) { vec3 gp = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ; vec4 gq = u_v_light_matrix * vec4 ( go + u_normal_offset * gp , 1.0 ) ; cG = gn ( u_p_light_matrix0 , gq ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cH = gn ( u_p_light_matrix1 , gq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cI = gn ( u_p_light_matrix2 , gq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cJ = gn ( u_p_light_matrix3 , gq ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void gr ( vec4 gs ) { float gt = gs . x ; float gu = gs . y ; float gv = gs . w ; cK . x = ( gt + gv ) / 2.0 ; cK . y = ( gu + gv ) / 2.0 ; cK . z = gv ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void gy ( inout vec3 gx ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"gx = max ( vec3 ( 0.0 ) , gx ) ; gx = pow ( gx , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gA ( inout vec3 gz ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"gz = max ( vec3 ( 0.0 ) , gz ) ; gz = pow ( gz , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gD ( inout vec3 gB , in float gC ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"gB = gB * gC ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void gL ( inout vec3 gG , in float gH , in vec4 gI ) { float gJ = gI . w * gH ; float gK = exp ( - gJ * gJ ) ; gK = clamp ( gK , 0.0 , 1.0 ) ; gG = mix ( gI . rgb , gG , gK ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 gS ( in mat4 gM , in vec3 gN ) { vec3 gO = mix ( gM [ 0 ] . rgb , gM [ 1 ] . rgb , max ( sign ( gN . x ) , 0.0 ) ) ; vec3 gP = mix ( gM [ 2 ] . rgb , gM [ 3 ] . rgb , max ( sign ( gN . z ) , 0.0 ) ) ; vec3 gQ = vec3 ( gM [ 0 ] . a , gM [ 1 ] . a , gM [ 2 ] . a ) ; vec3 gR = mix ( gO , gP , abs ( gN . z ) ) ; gR = mix ( gR , gQ , abs ( gN . y ) ) ; return gR ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void gU ( inout float gT ) { gT -= 0.5 ; gT = 4.0 * ( gT * gT * gT ) + 0.5 ; } void hk ( inout vec3 gV , in float gW , in vec3 gX , in float gY , in vec4 gZ , in vec4 g_ , in float ha , in float hb ) { float hc = g_ . w * gW ; float hd = exp ( - hc * hc ) ; hd = clamp ( hd , 0.0 , 1.0 ) ; float he = max ( gX . y , 0.0 ) ; gW = max ( gW - max ( gY / he , 0.0 ) , 0.0 ) ; float hf = gZ . w * gW ; float hg = 1.0 - hf ; hg = max ( hg , 0.0 ) ; gU ( hg ) ; hg += max ( ha - 0.5 , 0.0 ) ; if ( hg < hd ) { vec3 hh = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 hi = gZ . rgb ; gY = clamp ( - gY * 0.03 , 0.0 , 0.8 ) ; vec3 hj = mix ( hi , hh , min ( he , 1.0 ) ) ; hj = mix ( hj , vec3 ( 0.0 ) , gY ) * hb ; gV = mix ( hj , gV , hg ) ; } if ( hg >= hd ) { gV = mix ( g_ . rgb , gV , hd ) ; } } void ht ( inout vec3 hl , in float hm , in float hn , in vec4 ho , in float hp ) { float hq = ho . w * hm ; float hr = 1.0 - hq ; hr = clamp ( hr , 0.0 , 1.0 ) ; gU ( hr ) ; hn = clamp ( - hn * 0.03 , 0.0 , 0.8 ) ; vec3 hs = mix ( ho . rgb , vec3 ( 0.0 ) , hn ) * hp ; hl = mix ( hs , hl , hr ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"LAMP_IND",b:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",b:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",b:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",b:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",b:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",b:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",b:["0"]},{type:"var",name:"NUM_LFACTORS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",
b:"float hu = 0.0 ; float hv = 1.0 ; float hw = 0.5 ; struct hx { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float hF ( vec3 hy , vec3 hz , vec3 hA , float hB , float hC ) { vec3 hD = normalize ( hy + hz ) ; float hE = ( hv - hB ) * max ( dot ( hA , hD ) , hu ) + hB ; return pow ( hE , hC ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hQ ( vec3 hG , vec3 hH , vec3 hI , float hJ ) { vec3 hK = normalize ( hG + hH ) ; float hL = max ( dot ( hI , hK ) , 0.001 ) ; float hM = max ( dot ( hI , hH ) , 0.01 ) ; float hN = max ( dot ( hI , hG ) , 0.01 ) ; float hO = tan ( acos ( hL ) ) ; float hP = max ( hJ , 0.001 ) ; return hN * ( hv / ( 4.0 * M_PI * hP * hP ) ) * ( exp ( - ( hO * hO ) / ( hP * hP ) ) / ( sqrt ( hM * hN ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hY ( vec3 hR , vec3 hS , vec3 hT , float hU , float hV ) { vec3 hW = normalize ( hR + hS ) ; float hX = acos ( dot ( hW , hT ) ) ; if ( hX < hU ) return hv ; else if ( hX >= hU + hV || hV == hu ) return hu ; else return hv - ( hX - hU ) / hV ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void it ( float hZ , vec3 h_ , vec3 ia , vec3 ib , float ic , inout float id ) { if ( ic > hu ) { float ie = max ( dot ( h_ , ib ) , hu ) ; float ig = ic * ic ; float ih = hv - hw * ( ig / ( ig + 0.33 ) ) ; vec3 ii = ia - hZ * h_ ; vec3 ij = ib - ie * h_ ; if ( length ( ii ) == hu || length ( ij ) == hu || abs ( hZ ) > hv || abs ( ie ) > hv ) id = id * ih ; else { float ik = acos ( hZ ) ; float il = acos ( ie ) ; vec3 im = normalize ( ii ) ; vec3 io = normalize ( ij ) ; float ip , iq ; ip = max ( ik , il ) ; iq = min ( ik , il ) ; iq *= 0.95 ; float ir = max ( dot ( im , io ) , hu ) ; float is = 0.45 * ( ig / ( ig + 0.09 ) ) ; id = id * ( ih + ( is * ir * sin ( ip ) * tan ( iq ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void iA ( vec3 iu , vec3 iv , float iw , float ix , out float iy ) { float iz ; if ( iw == hu ) { iy = hv ; } else { iz = hv + abs ( dot ( iv , iu ) ) ; iz = ix + ( hv - ix ) * pow ( iz , iw ) ; iy = clamp ( iz , hu , hv ) ; } }".split(" ")}]}}]},{type:"textline",b:"void iI ( vec3 iB , vec3 iC , vec3 iD , vec2 iE , const float iF , out float iG ) {".split(" ")},{type:"condition",
a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"iA ( iB , iC , iE [ 0 ] , iE [ 1 ] , iG ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float iH = max ( dot ( iB , iC ) , hu ) ; iG = ( hv - iF ) * iH + iF ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"it ( iH , iB , iC , iD , iE [ 0 ] , iG ) ;".split(" ")}]}}]}]}}]},{type:"textline",
b:"} void iP ( vec3 iJ , vec3 iK , vec3 iL , float iM , vec2 iN , out float iO ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"iO = hF ( iJ , iK , iL , iM , iN [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"iO = hQ ( iJ , iK , iL , iN [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER",
"==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"iO = hY ( iJ , iK , iL , iN [ 0 ] , iN [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["iO","=","hu",";"]}]}}]},{type:"textline",b:"} void jl ( vec3 iQ , vec3 iR , vec3 iS , vec2 iT , vec4 iU , vec3 iV , vec3 iW , vec3 iX , inout hx iY , float iZ , vec2 i_ , vec2 ja , float jb ) { float jc = hu ; if ( iT . r != hu ) iI ( iS , iR , iQ , i_ , jb , jc ) ; float jd = hu ; if ( iT . g != hu ) iP ( iR , iQ , iS , jb , ja , jd ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( iR , iS ) * dot ( iQ , iS ) < hu ) { float je = iU . x ; float jf = iU . y ; float jg = iU . z ; float jh = iU . w ; float ji = clamp ( abs ( dot ( iR , iS ) ) , hu , hv ) ; float jj = clamp ( dot ( iQ , - iR ) , hu , hv ) ; float jk = pow ( jj , jf ) ; iY . a += iZ * vec4 ( iX * ji * pow ( iV , vec3 ( je ) ) , hv ) ; iY . a += jg * mix ( vec4 ( iV , hv ) , vec4 ( hv ) , jh ) * iZ * vec4 ( iX * ji * vec3 ( jk ) , hv ) ; } else { iY . b += iX * iW * jd ; iY . a += vec4 ( iX * iV * jc , jd ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"iY . b += iX * iW * jd ; iY . a += vec4 ( iX * iV * jc , jd ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"lamp",name:"POINT",f:[{type:"textline",b:"{ vec2 jD = jz [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; vec3 jE = jw [ LAMP_IND ] ; vec3 jF = jy [ LAMP_IND ] ; float jG = hu ;".split(" ")},{type:"textline",b:"vec3 jH = jF ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) jH *= jv ; vec3 jI = jE - jq ;".split(" ")},{type:"textline",b:"float jJ = length ( jI ) ; jH *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + jJ * jJ ) ; jI = normalize ( jI ) ; jl ( js , jI , jr , jD , jB , jo , jp , jH , jC , jA , ju , jt , jG ) ; }".split(" ")}]},
{type:"lamp",name:"SPOT",f:[{type:"textline",b:"{ vec2 jK = jz [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; vec3 jL = jw [ LAMP_IND ] ; vec3 jM = jy [ LAMP_IND ] ; vec3 jN = jx [ LAMP_IND ] ; float jO = hu ;".split(" ")},{type:"textline",b:"vec3 jP = jM ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) jP *= jv ; vec3 jQ = jL - jq ;".split(" ")},{type:"textline",b:"float jR = length ( jQ ) ; jP *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + jR * jR ) ; jQ = normalize ( jQ ) ;".split(" ")},{type:"textline",b:"float jS = dot ( jQ , jN ) ; jS *= smoothstep ( hu , hv , ( jS - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; jP *= jS ; jl ( js , jQ , jr , jK , jB , jo , jp , jP , jC , jA , ju , jt , jO ) ; }".split(" ")}]},
{type:"lamp",name:"SUN",f:[{type:"textline",b:"{ vec2 jT = jz [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; vec3 jU = jy [ LAMP_IND ] ; vec3 jV = jx [ LAMP_IND ] ; float jW = hu ;".split(" ")},{type:"textline",b:"vec3 jX = jU ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) jX *= jv ; jl ( js , jV , jr , jT , jB , jo , jp , jX , jC , jA , ju , jt , jW ) ; }".split(" ")}]},{type:"lamp",name:"HEMI",f:[{type:"textline",b:"{ vec2 jY = jz [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ; vec3 jZ = jy [ LAMP_IND ] ; vec3 j_ = jx [ LAMP_IND ] ; float ka = hw ;".split(" ")},
{type:"textline",b:"vec3 kb = jZ ; if ( bool ( LAMP_SHADOW_MAP_IND ) ) kb *= jv ; jl ( js , j_ , jr , jY , jB , jo , jp , kb , jC , jA , ju , jt , ka ) ; }".split(" ")}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hx kc ( vec3 jm , vec3 jn , vec3 jo , vec3 jp , vec3 jq , vec3 jr , vec3 js , vec2 jt , vec2 ju , float jv , vec3 jw [ NUM_LIGHTS ] , vec3 jx [ NUM_LIGHTS ] , vec3 jy [ NUM_LIGHTS ] , vec4 jz [ NUM_LFACTORS ] , float jA , vec4 jB ) { hx jC ; jC . a = vec4 ( jm + jo * jn , hu ) ; jC . b = vec3 ( hu ) ;".split(" ")},
{type:"lamps_main"},{type:"textline",b:["return","jC",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hx kh ( vec3 kd , vec3 ke , vec3 kf ) { hx kg ; kg . a = vec4 ( kd + kf * ke , hu ) ; kg . b = vec3 ( hu ) ; return kg ; }".split(" ")}]}}]}]};a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},
{type:"textline",b:"void kI ( inout vec3 ki , float kj , float kk , float kl , vec3 km , vec3 kn , vec3 ko , vec4 kp , vec3 kq , float kr ) { if ( kr > CAUSTICS_VIEW_DISTANCE ) return ; vec4 ks = kp ; vec3 kt = kq + km ; kt . xz = 10.0 * sin ( 0.1 * kt . xz ) ; vec3 ku = kt + 2.0 * cross ( - ks . xyz , cross ( - ks . xyz , kt ) + ks . w * kt ) ; vec2 kv = ku . xz ; vec3 kw = kn ; float kx = max ( dot ( km , kw ) , 0.0 ) ; float ky = 0.025 ; kv . s += 0.5 * sin ( dot ( kq + kk , vec3 ( 1.0 ) ) ) ; kv . t += 0.7 * ( - sin ( dot ( kq - kk , vec3 ( - 0.7 ) ) ) ) ; kv . st += 0.23 * cos ( 4.0 * kj - CAUST_SPEED . x * kk ) ; kv . st += 3.0 * sin ( kj - 0.3 * CAUST_SPEED . y * kk ) ; float kz = CAUST_SCALE * ( 1.0 + max ( 0.1 * kj , 0.0 ) ) ; mat3 kA = dw ( ( kv / kz ) , ky ) ; float kB = ( kA * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; float kC = ( kA * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; float kD = ( kA * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; vec3 kE = CAUST_BRIGHT * vec3 ( kB , kC , kD ) ; float kF = kl * kx ; float kG = max ( sign ( kj ) , 0.0 ) ; kF = min ( kF + 0.5 * sign ( - km . y ) * kG , 1.0 ) ; kF *= 1.0 - kG * ( 0.1 * kj ) ; kE *= kF ; kE *= kE ; float kH = min ( - kj + 10.0 , 1.0 ) ; ki += max ( ( 2.0 * ko * kE ) * kH , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float kW ( in vec3 kP , in vec3 kQ , in float kR , in float kS ) { vec3 kT = normalize ( kQ + kP ) ; float kU = 1.0 - dot ( kP , kT ) ; float kV = kS + ( 1.0 - kS ) * pow ( kU , kR ) ; return kV ; } void lk ( inout vec3 kX , in vec3 kY , in vec3 kZ , in float k_ , in float la , in float lb ) { vec3 lc = reflect ( - kY , kZ ) ; float ld = 1.0 ; if ( k_ != 0.0 ) ld = kW ( kY , lc , k_ , la ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 le = u_refl_plane . xyz * dot ( kZ , u_refl_plane . xyz ) ; vec3 lf = kZ - le ; vec2 lg = ( u_view_matrix_frag * vec4 ( lf , 0.0 ) ) . xy ; vec2 lh = cK . xy / cK . z ; lh += lg * REFL_BUMP ; vec3 li = texture2D ( u_reflectmap , lh ) . rgb ; gy ( li . rgb ) ; kX = mix ( kX , li , lb * ld ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"vec3 lj = textureCube ( u_mirrormap , lc ) . xyz ; gy ( lj . rgb ) ; kX = mix ( kX , lj , u_mirror_factor * ld ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float lq ( in float ll , inout vec2 lm , in vec2 ln ) { vec4 lo = texture2D ( u_scene_depth , lm ) ; float lp = cw ( lo ) ; if ( lp < kO ) { lm = ln ; return ll ; } else { return lp ; } return ll ; } vec3 ly ( in vec3 lr , in vec2 ls ) { vec2 lt = lr . xy / lr . z ; vec2 lu = lt + ls ; vec4 lv = texture2DProj ( u_scene_depth , lr ) ; float lw = cw ( lv ) ; lq ( lw , lu , lt ) ; vec3 lx = texture2D ( u_refractmap , lu ) . rgb ; gy ( lx ) ; return lx ; }".split(" ")}]}}]}]};
a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct mg { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mn ( inout float mh , float mi , vec2 mj , vec2 mk ) { float ml = mk . x - mj . x ; float mm = ( mi - mj . x ) / ml ; mh = mix ( mh , mk . y , clamp ( mm , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mu ( inout vec3 mo , float mp , vec4 mq , vec4 mr ) { float ms = mr . x - mq . x ; float mt = ( mp - mq . x ) / ms ; mo = mix ( mo , mr . yzw , clamp ( mt , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float mA ( float mv , float mw , vec2 mx [ SIZE_RAMP_LENGTH ] ) { float my = mv / mw ; float mz = mx [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mn ( mz , my , mx [ 0 ] , mx [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mn ( mz , my , mx [ 1 ] , mx [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",b:"mn ( mz , my , mx [ 2 ] , mx [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",
b:["return","mz",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 mG ( float mB , float mC , vec4 mD [ COLOR_RAMP_LENGTH ] ) { float mE = mB / mC ; vec3 mF = mD [ 0 ] . yzw ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mu ( mF , mE , mD [ 0 ] , mD [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],group:{type:"group",
a:[{type:"textline",b:"mu ( mF , mE , mD [ 1 ] , mD [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",b:"mu ( mF , mE , mD [ 2 ] , mD [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mF",";","}"]}]}}]},{type:"textline",b:"float mP ( float mH , float mI , float mJ , float mK ) { float mL = max ( 0.01 , min ( mI , mJ ) ) ; float mM = max ( 0.01 , min ( mI , mK ) ) ; float mN = mI - mM ; float mO = clamp ( mH / mL , 0.0 , 1.0 ) - step ( mN , mH ) * ( mH - mN ) / mM ; return mO ; } mg mV ( ) { mg mQ ; float mR ; if ( u_p_cyclic == 1 ) { mR = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( mR < 0.0 ) mR += u_p_length ; } if ( u_p_cyclic != 1 ) { mR = u_p_time - a_p_delay ; } if ( mR < 0.0 || mR >= a_p_lifetime ) { mQ . a = 0.0001 ; mQ . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( mR < 0.0 || mR >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mS = a_position ; vec3 mT = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mS = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 mT = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"mS += u_p_nfactor * mR * mT ; mS += a_p_vels . xyz * mR ; mS . y -= u_p_gravity * mR * mR / 2.0 ; float mU = max ( u_p_mass , EPSILON ) ; mS += ( u_p_wind / mU ) * mR * mR / 2.0 ; mQ . b = mS ; mQ . e = a_p_vels . w * mR ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mQ . a = mA ( mR , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mQ . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mQ . d = mG ( mR , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mQ . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"mQ . c = mP ( mR , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return mQ ; }".split(" ")}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float nh ( in sampler2D na , in vec2 nb , in vec2 nc ) { float nd = texture2D ( na , nb ) . r ; float ne = nc . x ; float nf = nc . y ; float ng = 2.0 * ne / ( ne + nf - ( 2.0 * nd - 1.0 ) * ( nf - ne ) ) ; return ng ; }".split(" ")}]}};b4w.module.animation=function(a,p){var c=p("__animation"),b=p("__constraints");p("__physics");var h=p("__print"),d=p("__util");a.SLOT_0=c.SLOT_0;a.SLOT_1=c.SLOT_1;a.SLOT_2=c.SLOT_2;a.SLOT_3=c.SLOT_3;a.SLOT_4=c.SLOT_4;a.SLOT_5=c.SLOT_5;a.SLOT_6=c.SLOT_6;a.SLOT_7=c.SLOT_7;a.SLOT_ALL=c.SLOT_ALL;a.OBJ_ANIM_TYPE_ARMATURE=c.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=c.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=c.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=c.OBJ_ANIM_TYPE_SOUND;a.OBJ_ANIM_TYPE_PARTICLES=
c.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=c.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=c.AB_CYCLIC;a.AB_FINISH_RESET=c.AB_FINISH_RESET;a.AB_FINISH_STOP=c.AB_FINISH_STOP;var f=new Float32Array(4);a.is_animated=function(a){return c.is_animated(a)};a.get_actions=function(){h.error("get_actions() deprecated, use get_anim_names() instead");for(var a=[],b=c.xw(),d=0;d<b.length;d++)a.push(c.Cz(b[d].name));return a};a.get_current_action=function(b,c){h.error("get_current_action() deprecated, use get_current_anim_name() instead");
return a.get_current_anim_name(b,c)};a.get_anim_names=function(a){return c.Bj(a)?c.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.Iw(a,b)};a.apply=function(a,b,d){if(d>c.SLOT_7)h.error("Can't apply animation to slot "+d+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{d=d||c.SLOT_0;if(c.is_animated(a)){var f=c.get_slot_num_by_anim(a,b);if(-1!=f&&f!=d){h.error('Animation "'+b+'" is already applied to object "'+
a.name+'" (slot "'+f+'").');return}}c.tA(a,b)?c.apply(a,b,d):h.error('No fcurves in action "'+b+'"')}};a.remove=function(a){c.remove(a)};a.remove_slot_animation=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.remove_slot_animation(a,b))};a.apply_def=function(a){c.apply_def(a)};a.play=function(a,b,d){c.is_animated(a)?(d=d||c.SLOT_0,c.play(a,b,d),c.update_object_animation(a,0,d)):h.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.stop(a,
b))};a.is_play=function(a,b){if(!c.is_animated(a))return!1;b=b||c.SLOT_0;return c.is_play(a,b)};a.set_current_frame_float=function(b,c,d){h.error("set_current_frame_float() deprecated, use set_frame() instead");a.set_frame(b,c,d)};a.get_current_frame_float=function(b,c){h.error("get_current_frame_float() deprecated, use get_frame() instead");return a.get_frame(b,c)};a.set_frame=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_current_frame_float(a,b,d),c.update_object_animation(a,0,d))};a.get_frame=
function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return c.get_current_frame_float(a,b)};a.set_speed=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_speed(a,b||1,d))};a.get_speed=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return a.w[b]?c.get_speed(a,b):0};a.get_frame_range=function(a,b){h.error("get_frame_range() deprecated, use get_anim_start_frame() and get_anim_length() instead");if(c.is_animated(a)){b=b||c.SLOT_0;var d=a.w[b];if(d)return[d.start,d.start+d.length]}return null};
a.get_anim_start_frame=function(a,b){return c.is_animated(a)&&(b=b||c.SLOT_0,a.w[b])?c.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return c.is_animated(a)&&(b=b||c.SLOT_0,a.w[b])?c.get_anim_length(a,b):-1};a.cyclic=function(b,d,f){h.error("cyclic() deprecated, use set_behavior() instead");a.set_behavior(b,d?c.AB_CYCLIC:c.AB_FINISH_RESET,f)};a.is_cyclic=function(a,b){h.error("is_cyclic() deprecated, use get_behavior() instead");if(!c.is_animated(a))return!1;b=b||c.SLOT_0;return c.is_cyclic(a,
b)};a.set_behavior=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_behavior(a,b,d))};a.get_behavior=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.get_behavior(a,b)};a.apply_smoothing=function(a,b,d,f){f=f||c.SLOT_0;c.is_animated(a)&&c.apply_smoothing(a,b,d,f)};a.update_object_animation=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.update_object_animation(a,b||0,d))};a.frame_to_sec=function(a){return c.frame_to_sec(a)};a.get_bone_translation=function(a,c,h){if(!d.rf(a))return null;
h||(h=new Float32Array(3));b.Dw(a,c,!1,f,null);h[0]=f[0];h[1]=f[1];h[2]=f[2];return h};a.get_first_armature_object=function(a){return d.is_mesh(a)?c.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,b){return c.is_animated(a)&&b?c.get_slot_num_by_anim(a,b):null};a.get_anim_name=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.zw(a,b)};a.get_anim_type=function(a,b){return c.is_animated(a)?c.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return c.apply_to_first_empty_slot(a,
b)};a.get_skel_mix_factor=function(a){return a.d.ae};a.set_skel_mix_factor=function(a,b,f){d.rf(a)?(b=Math.min(Math.max(b,0),1),a.d.ae!=b&&c.set_skel_mix_factor(a,b,f||0)):h.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,p){var c=p("__anchors");p("__print");p("__util");a.attach_move_cb=c.attach_move_cb;a.detach_move_cb=c.detach_move_cb};b4w.module.assets=function(a,p){var c=p("__assets");a.AT_ARRAYBUFFER=c.AT_ARRAYBUFFER;a.AT_JSON=c.AT_JSON;a.AT_TEXT=c.AT_TEXT;a.AT_AUDIOBUFFER=c.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=c.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=c.AT_AUDIO_ELEMENT;a.enqueue=function(a,h,d){c.enqueue(a,h,d)}};b4w.module.camera=function(a,p){function c(a,c){b.is_target_camera(a)?(m.copy(c,a.d.zb),k.C(a),h.sync_transform(a)):d.error("set_pivot(): Wrong object or camera move style")}var b=p("__camera");p("__config");var h=p("__physics"),d=p("__print"),f=p("__constraints"),k=p("__transform"),g=p("__util"),m=p("vec3"),l=p("vec4");p("quat");var r=p("mat3"),q=p("mat4"),w=new Float32Array(2),v=new Float32Array(3),E=new Float32Array(3),B=new Float32Array(4),x=new Float32Array(9);a.MS_STATIC=b.MS_STATIC;a.MS_ANIMATION=
b.MS_ANIMATION;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.is_camera=b.is_camera;a.is_target_camera=b.is_target_camera;a.is_eye_camera=b.is_eye_camera;a.is_hover_camera=b.is_hover_camera;a.set_move_style=function(a,b){a.d.aa=b};a.get_move_style=function(a){return b.is_camera(a)?b.get_move_style(a):(d.error("get_move_style(): Wrong object"),null)};a.set_velocity_params=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&
!b.is_hover_camera(a))return d.error("set_velocity_params(): Wrong object or camera move style"),null;var f=a.d;f.hn=c[0];f.gn=c[1];f.jn=c[2]};a.get_velocity_params=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return d.error("get_velocity_params(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));var f=a.d;c[0]=f.hn;c[1]=f.gn;c[2]=f.jn;return c};a.set_look_at=function(a,c,d,f){var g=a.d;b.Zv(c,d,f,g.g,g.quat);k.C(a);h.sync_transform(a)};a.get_eye=
function(a,c){if(b.is_camera(a))return c||(c=new Float32Array(3)),m.copy(a.d.g,c),c;d.error("get_eye(): Wrong object")};a.set_pivot=c;a.set_trans_pivot=function(a,c,f){b.is_target_camera(a)?(m.copy(c,a.d.g),m.copy(f,a.d.zb),k.C(a),h.sync_transform(a)):d.error("set_trans_pivot(): Wrong object or camera move style")};a.get_pivot=function(a,c){if(b.is_target_camera(a))return c||(c=new Float32Array(3)),m.copy(a.d.zb,c),c;d.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(b,
c,f){d.error("rotate_pivot() deprecated, use rotate_camera() or rotate_target_camera() instead");a.rotate_target_camera(b,c,f)};a.move_pivot=function(a,c,f){if(b.is_target_camera(a)){var g=a.d;if(g.bs){var l=r.fromMat4(g.N,x),q=m.subtract(g.g,g.zb,E);v[0]=c;v[1]=0;v[2]=f;m.scale(v,m.len(q),v);m.transformMat3(v,l,v);m.add(g.zb,v,g.zb);m.add(g.g,v,g.g);k.C(a);h.sync_transform(a)}}else d.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(b,c){d.error("rotate_hover_cam() deprecated, use rotate_camera() or rotate_hover_camera() instead");
a.rotate_hover_camera(b,c,0)};a.get_hover_cam_angle=function(a){d.error("get_hover_cam_angle() deprecated, use get_camera_angles() instead");return b.is_hover_camera(a)?-b.get_camera_angles(a,w)[1]:(d.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,c){d.error("set_hover_cam_angle() deprecated, use rotate_camera() or rotate_hover_camera() instead");if(b.is_hover_camera(a))if(a.d.Na){var f=b.get_camera_angles(a,w);(f=-c-f[1])&&b.rotate_hover_camera(a,
0,f);k.C(a);h.sync_transform(a)}else d.error("set_hover_cam_angle(): distance/hover_angle limits are not defined or disabled");else d.error("set_hover_cam_angle(): wrong object or camera move style")};a.get_hover_angle_limits=function(a,c){if(b.is_hover_camera(a))return a.d.Gb?(c||(c=new Float32Array(2)),c[0]=a.d.Gb.Ga,c[1]=a.d.Gb.Ma):d.error("get_hover_angle_limits(): camera hasn't angle limits"),c;d.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,c){if(b.is_hover_camera(a)||
b.is_target_camera(a))return a.d.Na?(c||(c=new Float32Array(2)),c[0]=a.d.ef,c[1]=a.d.Tc):d.error("get_cam_dist_limits(): camera hasn't distance limits"),c;d.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(b,c){d.error("translate_hover_cam_v() deprecated, use hover_cam_set_translation() instead");a.hover_cam_set_translation(b,c)};a.hover_cam_set_translation=function(a,c){if(b.is_hover_camera(a)){var f=a.d;if(f.Na){var g=m.subtract(c,f.g,v);m.add(g,f.Zb,f.Zb)}k.set_translation(a,
c);k.C(a);h.sync_transform(a)}else d.error("hover_cam_set_translation(): wrong object")};a.get_hover_cam_pivot=function(a,c){if(!b.is_hover_camera(a))return d.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));m.copy(a.d.Zb,c);return c};a.has_distance_limits=function(a){return b.is_target_camera(a)||b.is_hover_camera(a)?a.d.Na:(d.error("has_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,c,f,g){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:g|=
k.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>f){d.error("apply_vertical_limits(): wrong vertical limits");return}break;default:d.error("apply_vertical_limits(): wrong object");return}a.d.nd={Ga:c,Ma:f};b.jy(a,g==k.SPACE_LOCAL);k.C(a);h.sync_transform(a)};a.clear_vertical_limits=function(a){a.d.nd=null};a.apply_horizontal_limits=function(a,c,f,g){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:break;case b.MS_HOVER_CONTROLS:if(c>f){d.error("apply_horizontal_limits(): wrong horizontal limits");
return}break;default:d.error("apply_horizontal_limits(): wrong object");return}a.d.Nb={left:c,right:f};b.fy(a,g==k.SPACE_LOCAL);k.C(a);h.sync_transform(a)};a.clear_horizontal_limits=function(a){a.d.Nb=null};a.get_horizontal_limits=function(a,c){if(b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a)){var f=a.d;c=c||new Float32Array(2);if(f.Nb)return c[0]=f.Nb.left,c[1]=f.Nb.right,c}else d.error("get_horizontal_limits(): wrong object")};a.has_horizontal_limits=function(a){if(b.is_target_camera(a)||
b.is_eye_camera(a)||b.is_hover_camera(a))return Boolean(a.d.Nb);d.error("has_horizontal_limits(): wrong object")};a.apply_hover_angle_limits=function(a,c,f){b.is_hover_camera(a)?c<f?d.error("apply_hover_angle_limits(): wrong hover angle limits"):(c=g.angle_wrap_periodic(c,-Math.PI,Math.PI),f=g.angle_wrap_periodic(f,-Math.PI,Math.PI),c=g.clamp(c,-Math.PI/2,0),f=g.clamp(f,-Math.PI/2,0),a.d.Gb={Ga:c,Ma:f},b.mx(a),k.C(a),h.sync_transform(a)):d.error("apply_hover_angle_limits(): wrong object")};a.clear_hover_angle_limits=
function(a){b.is_hover_camera(a)?a.d.Gb=null:d.error("clear_hover_angle_limits(): wrong object")};a.apply_distance_limits=function(a,c,f){if(b.is_target_camera(a)||b.is_hover_camera(a))if(c>f)d.error("apply_distance_limits(): wrong distance limits");else{var g=a.d;g.Na=!0;g.Tc=c;g.ef=f;k.C(a);h.sync_transform(a)}else d.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){b.is_target_camera(a)||b.is_hover_camera(a)?a.d.Na=!1:d.error("clear_distance_limits(): wrong object")};
a.set_eye_params=function(b,c,f){d.error("set_eye_params() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,Math.PI/2-f)};a.is_look_up=function(a){g.quat_to_dir(a.d.quat,g.AXIS_MY,v);return 0<=v[1]?!0:!1};a.rotate_camera=function(c,e,f,g,l){switch(a.get_move_style(c)){case b.MS_STATIC:case b.MS_ANIMATION:break;case b.MS_TARGET_CONTROLS:b.rotate_target_camera(c,e,f,g,l);break;case b.MS_EYE_CONTROLS:b.rotate_eye_camera(c,e,f,g,l);break;case b.MS_HOVER_CONTROLS:b.rotate_hover_camera(c,
e,f,g,l);break;default:d.error("rotate_camera(): Wrong object")}k.C(c);h.sync_transform(c)};a.rotate_target_camera=function(a,c,f,g,l){b.is_target_camera(a)?(b.rotate_target_camera(a,c,f,g,l),k.C(a),h.sync_transform(a)):d.error("rotate_target_camera(): wrong object")};a.rotate_eye_camera=function(a,c,f,g,l){b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,f,g,l),k.C(a),h.sync_transform(a)):d.error("rotate_eye_camera(): wrong object")};a.rotate_hover_camera=function(a,c,f,g,l){b.is_hover_camera(a)?(b.rotate_hover_camera(a,
c,f,g,l),k.C(a),h.sync_transform(a)):d.error("rotate_hover_camera(): wrong object")};a.rotate=function(b,c,f){d.error("rotate() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,-f)};a.get_camera_angles=function(a,c){c||(c=new Float32Array(2));b.get_camera_angles(a,c);return c};a.get_camera_angles_char=function(a,c){c||(c=new Float32Array(2));b.get_camera_angles_char(a,c);return c};a.get_angles=function(a,c){d.error("get_angles() deprecated, use get_camera_angles() instead");
c||(c=new Float32Array(2));b.get_angles(a,c);return c};a.set_stereo_distance=function(a,c){for(var d=a.d.J,f=0;f<d.length;f++){var g=d[f];g.type!=b.wb&&g.type!=b.Db||b.Zy(g,c,g.jd)}};a.get_stereo_distance=function(a){a=a.d.J;for(var c=0;c<a.length;c++){var d=a[c];if(d.type==b.wb||d.type==b.Db)return d.ui}return 0};a.is_underwater=function(a){d.error("is_underwater() deprecated, always returns false");return a.d.Ur};a.translate_view=function(a,c,d,f){a=a.d.J;for(var g=0;g<a.length;g++){var h=a[g];
h.vb||b.Vg(h,h.Za);var l=v;l[0]=-c;l[1]=-d;l[2]=0;q.translate(h.pa,l,h.pa);q.rotateZ(h.pa,f,h.pa);q.multiply(h.pa,h.ka,h.bg);b.uu(h);b.tu(h)}};a.correct_up=function(a,b){b||(b=g.AXIS_Y);f.correct_up(a,b)};a.zoom_object=function(a,e){if(b.is_target_camera(a)){k.get_object_center(e,!1,v);c(a,v);k.C(a);var f=k.get_object_size(e),g=b.yw(a)/2,f=f/Math.sin(g),g=k.Zx(a,v);k.move_local(a,0,f-g,0);k.C(a);h.sync_transform(a)}else d.error("zoom_object(): wrong object")};a.set_ortho_scale=function(c,e){if(b.is_camera(c)&&
a.is_ortho_camera(c)){var f=c.d;if(b.is_target_camera(c)){var g=m.dist(f.g,f.zb);f.Fg=e/2*f.Eg/g}else b.is_hover_camera(c)&&a.has_distance_limits(c)?(g=m.distance(f.g,f.Zb),f.Fg=e/2*f.Eg/g):c.d.J[0].top=e/2;b.Zr(c)}else d.error("set_ortho_scale(): wrong object")};a.get_ortho_scale=function(c){if(b.is_camera(c)&&a.is_ortho_camera(c))return 2*c.d.J[0].top;d.error("get_ortho_scale(): wrong object")};a.is_ortho_camera=function(a){if(b.is_camera(a))return a.d.J[0].type==b.Pc;d.error("is_ortho_camera(): wrong object")};
a.calc_ray=function(a,c,f,g){g||(g=new Float32Array(3));var h=a.d.J[0];switch(h.type){case b.nc:case b.Te:case b.wb:case b.Db:var k=Math.tan(h.Hd*Math.PI/360);B[0]=(2*c/h.width-1)*k*h.Za;B[1]=-1;B[2]=(2*f/h.height-1)*k;B[3]=0;l.transformMat4(B,a.d.N,B);g[0]=B[0];g[1]=B[1];g[2]=B[2];m.normalize(g,g);return g;default:return d.error("Non-compatible camera"),g}};a.project_point=function(a,c,d){d||(d=new Float32Array(2));return b.project_point(a,c,d)}};b4w.module.config=function(a,p){var c=p("__config");a.P_LOW=c.P_LOW;a.P_HIGH=c.P_HIGH;a.P_ULTRA=c.P_ULTRA;a.P_CUSTOM=c.P_CUSTOM;a.set=c.set;a.get=c.get;a.reset=c.reset;a.get_std_assets_path=c.get_std_assets_path};b4w.module.controls=function(a,p){var c=p("__controls"),b=p("__print");a.CT_CONTINUOUS=c.CT_CONTINUOUS;a.CT_TRIGGER=c.CT_TRIGGER;a.CT_SHOT=c.CT_SHOT;a.CT_LEVEL=c.CT_LEVEL;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=
104;a.KEY_NUM9=105;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=
190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=c.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=c.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=c.PL_MULTITOUCH_MOVE_PAN;a.create_custom_sensor=c.create_custom_sensor;a.create_keyboard_sensor=c.create_keyboard_sensor;a.create_collision_sensor=c.create_collision_sensor;a.create_collision_impulse_sensor=c.create_collision_impulse_sensor;
a.create_ray_sensor=c.create_ray_sensor;a.create_mouse_click_sensor=c.create_mouse_click_sensor;a.create_mouse_wheel_sensor=c.create_mouse_wheel_sensor;a.create_mouse_move_sensor=c.create_mouse_move_sensor;a.create_touch_move_sensor=c.create_touch_move_sensor;a.create_touch_zoom_sensor=c.create_touch_zoom_sensor;a.create_motion_sensor=c.create_motion_sensor;a.create_vertical_velocity_sensor=c.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=c.create_gyro_angles_sensor;a.create_gyro_delta_sensor=
c.create_gyro_delta_sensor;a.create_timer_sensor=function(a,b){return c.create_timer_sensor(a,b||!1)};a.reset_timer_sensor=c.reset_timer_sensor;a.create_elapsed_sensor=c.create_elapsed_sensor;a.create_timeline_sensor=c.create_timeline_sensor;a.create_selection_sensor=function(a,b){return c.create_selection_sensor(a,b||!1)};a.set_custom_sensor=function(a,b){c.My(a,b)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=c.get_sensor_value;a.get_sensor_payload=c.get_sensor_payload;a.create_sensor_lock=
function(a,d,f){b.error("create_sensor_lock() deprecated");a.fm=d.slice(0);a.em=Array(d.length);a.Hj=f||c.kl};a.remove_sensor_lock=function(a){b.error("remove_sensor_lock() deprecated");a.fm=null;a.em=null;a.Hj=null};a.create_sensor_manifold=function(a,b,f,k,g,m,l){g=g||c.kl;c.create_sensor_manifold(a,b,f,k,g,m,void 0===l?null:l)};a.create_kb_sensor_manifold=function(a,b,f,k,g,m){k=c.create_keyboard_sensor(k);c.create_sensor_manifold(a,b,f,[k],c.kl,g,void 0===m?null:m)};a.check_sensor_manifolds=function(a){return c.check_sensor_manifold(a,
null)};a.check_sensor_manifold=c.check_sensor_manifold;a.remove_sensor_manifolds=function(a){b.error("remove_sensor_manifolds() deprecated, use remove_sensor_manifold() instead");c.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=c.remove_sensor_manifold;a.reset=c.reset;a.register_keyboard_events=c.register_keyboard_events;a.register_mouse_events=function(a,b,f){c.register_mouse_events(a,b,!!f)};a.register_wheel_events=c.register_wheel_events;a.register_touch_events=c.register_touch_events;
a.register_device_orientation=c.register_device_orientation;a.unregister_keyboard_events=c.unregister_keyboard_events;a.unregister_mouse_events=c.unregister_mouse_events;a.unregister_wheel_events=c.unregister_wheel_events;a.unregister_device_orientation=c.register_device_orientation;a.unregister_touch_events=c.unregister_touch_events};b4w.module.constraints=function(a,p){var c=p("__constraints"),b=p("__physics"),h=p("__transform");a.append_stiff=function(a,f,k,g,m){m=m||1;f instanceof Array&&2==f.length?c.Nn(a,f[0],f[1],k,g,m):c.On(a,f,k,g,m);h.C(a);b.sync_transform(a)};a.append_semi_stiff=function(a,f,k,g){c.Tt(a,f,k,g);h.C(a);b.sync_transform(a)};a.append_semi_stiff_cam=function(a,f,k,g,m,l,r,q){c.St(a,f,k,g,m,l,r,q);h.C(a);b.sync_transform(a)};a.append_semi_soft_cam=function(a,f,k,g){if(!g||0>g)g=.25;c.Rt(a,f,k,g);h.C(a);b.sync_transform(a)};
a.append_stiff_trans=function(a,f,k){c.Ut(a,f,k);h.C(a);b.sync_transform(a)};a.append_copy_trans=function(a,f,k){c.Nt(a,f,k);h.C(a);b.sync_transform(a)};a.append_stiff_trans_rot=function(a,f,k,g){c.Vt(a,f,k,g);h.C(a);b.sync_transform(a)};a.append_track=function(a,f){3==f.length?c.Yt(a,f):c.Xt(a,f);h.C(a);b.sync_transform(a)};a.append_follow=function(a,f,k,g){3==f.length?c.Pt(a,f,k,g):c.Ot(a,f,k,g);h.C(a);b.sync_transform(a)};a.remove=function(a){a.Ya&&c.remove(a)}};b4w.module.data=function(a,p){var c=p("__data");p("__print");p("__util");a.load=c.load;a.unload=function(a){c.unload(a|0)};a.set_debug_resources_root=c.set_debug_resources_root;a.is_primary_loaded=c.is_primary_loaded;a.load_and_add_new=c.load;a.cleanup=a.unload};b4w.module.debug=function(a,p){p("__batch");p("__config");var c=p("__controls"),b=p("__debug"),h=p("__physics"),d=p("__print"),f=p("__scenegraph"),k=p("__scenes"),g=p("__shaders"),m=p("__sfx"),l=p("__textures"),r=p("__util"),q=p("vec3");a.physics_worker=function(){h.Av()};a.physics_id=function(a){d.log("O",h.aw(a));for(var b=h.ww().l.p,c=0;c<b.length;c++){var f=b[c];f.pb.M==a&&d.log("B",f)}};a.visible_objects=function(){for(var a=k.get_active(),b=k.Ba(a,"MESH",k.DATA_ID_ALL),a=k.fa(a,"MAIN_OPAQUE").p,
c=0;c<b.length;c++){var f=b[c],g=f.d;if("DYNAMIC"==g.type)for(var h=0;h<a.length;h++){var e=a[h];if(e.U&&e.fb==g){d.log(f.name,f);break}}}};a.object_info=function(a){for(var b=k.get_active(),c=k.Ba(b,"MESH",k.DATA_ID_ALL),f=0;f<c.length;f++){var g=c[f];if(g.name==a){d.log("Object",g);for(var h=k.Dl(b),e=0;e<h.length;e++){for(var l=h[e],m=l.p,q=[],r=0;r<m.length;r++)m[r].fb==g.d&&q.push(m[r]);d.log("Subscene "+l.type,q)}}}};a.objects_stat=function(){var a=k.get_active();console.log("Armatures: "+k.Ba(a,
"ARMATURE",k.DATA_ID_ALL).length);console.log("Cameras: "+k.Ba(a,"CAMERA",k.DATA_ID_ALL).length);console.log("Curves: "+k.Ba(a,"CURVE",k.DATA_ID_ALL).length);console.log("Empties: "+k.Ba(a,"EMPTY",k.DATA_ID_ALL).length);console.log("Lamps: "+k.Ba(a,"LAMP",k.DATA_ID_ALL).length);console.log("Meshes: "+k.Ba(a,"MESH",k.DATA_ID_ALL).length);console.log("Speakers: "+k.Ba(a,"SPEAKER",k.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=k.get_active(),b=[k.fa(b,"MAIN_OPAQUE"),k.fa(b,"MAIN_BLEND")],
c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.p,f=0;f<d.length;f++){var g=d[f].o;g&&(a+=g.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=k.get_active(),b=[k.fa(b,"MAIN_OPAQUE"),k.fa(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.p,f=0;f<d.length;f++){var g=d[f].o;g&&(a+=g.num_triangles)}}return a};a.num_draw_calls=function(){var a=k.get_active(),a=[k.fa(a,"MAIN_OPAQUE"),k.fa(a,"MAIN_BLEND")];return a[0].p.length+a[1].p.length};a.num_shaders=function(){return r.Kd(g.qp())};
a.geometry_stats=function(){for(var a=k.get_active(),b=k.Dl(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var f=d.p,g=0;g<f.length;g++){var e=f[g].o,h=f[g].fb;e&&("COLOR_PICKING"!=d.type&&"GLOW_MASK"!=d.type||h.Rj)&&(a[e.id]=e)}}var f=d=c=b=0,l;for(l in a)e=a[l],e=e.na,e.jj&&(d++,f+=e.jj/1048576),b++,c+=e.No/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:f}};a.num_textures=function(){for(var a=[],b=0,c=k.get_active(),c=[k.fa(c,"MAIN_OPAQUE"),k.fa(c,
"MAIN_BLEND")],d=0;d<c.length;d++){var f=c[d];if(f)for(var f=f.p,g=0;g<f.length;g++){var e=f[g].o;if(e)for(var e=e.L,h=0;h<e.length;h++){var l=e[h];if("IMAGE"===l.source||"ENVIRONMENT_MAP"===l.source){var m=l.Oa;-1===a.indexOf(m)&&(a.push(m),l=l.width*l.height*4/1048576/l.$k,l*=1.3333,b+=l)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=k.get_active(),c=k.Dl(c),d=0;d<c.length;d++){var f=c[d];if("SINK"!=f.type){var g=f.j,e=[g.sb,g.rc];e.push.apply(e,f.kd);for(f=
0;f<e.length;f++){var h=e[f];l.Wh(h)&&-1==a.indexOf(h)&&(a.push(h),b+=g.width*g.height*l.Ww(h))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=k.get_active();(a=k.fa(a,"MAIN_OPAQUE"))&&k.mq(a.j,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=k.get_active(),b=k.fa(a,"MAIN_OPAQUE"),a=k.Hz(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],f;switch(c){case 0:f=[1,0,0];break;case 1:f=[0,1,0];break;case 2:f=[0,0,1];break;default:f=[1,0,1]}k.mq(d.j,
b,f)}};a.scenegraph_to_dot=function(){for(var a=k.Rh(),b=0;b<a.length;b++)d.log("\n"+f.xv(k.Fl(a[b])))};a.scenes_to_dot=function(){};a.controls_info=c.debug;a.object_distance=function(a,b){return q.dist(a.d.g,b.d.g)};a.msg=b.msg;a.fbmsg=b.fbmsg;a.print_telemetry=b.print_telemetry;a.plot_telemetry=b.plot_telemetry;a.fbres=function(a,c){function d(){b.fbmsg("FBRES",a());setTimeout(d,c)}c||(c=16);d()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,
0,0]),d=new Float32Array([0,1,0]),f=new Float32Array([0,0,1]),g=new Float32Array([-1,0,0]),e=new Float32Array([0,-1,0]),h=new Float32Array([0,0,-1]);if(!r.fe(a,r.yt))throw"Wrong VEC3_IDENT";if(!r.fe(b,r.tt))throw"Wrong QUAT4_IDENT";if(!r.fe(c,r.AXIS_X))throw"Wrong AXIS_X";if(!r.fe(d,r.AXIS_Y))throw"Wrong AXIS_Y";if(!r.fe(f,r.AXIS_Z))throw"Wrong AXIS_Z";if(!r.fe(g,r.AXIS_MX))throw"Wrong AXIS_MX";if(!r.fe(e,r.AXIS_MY))throw"Wrong AXIS_MY";if(!r.fe(h,r.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=
m.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==m.Hl(c)&&m.mute(c,!0)}};a.check_finite=function(a){b.check_finite(a)};a.set_debug_params=function(a){var b=k.get_active();if(b=k.fa(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&k.ez(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&k.dz(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return d.Lw()};a.get_warning_quantity=function(){return d.$w()};a.clear_errors_warnings=
function(){return d.clear_errors_warnings()}};b4w.module.geometry=function(a,p){function c(a){return a&&a.d&&a.d.Vc?!0:!1}var b=p("__batch"),h=p("__geometry"),d=p("__print"),f=p("__renderer");p("__objects");a.extract_vertex_array=function(a,f,m){if(!c(a))return d.error("Wrong object:",a.name),null;if(a=b.V(a,f,"MAIN")||b.V(a,f,"NODES")){if((f=a.na)&&f.Ob&&f.Ob[m])return h.Uv(f,m);d.error("Attribute not found:"+m);return null}d.error("Wrong material:",f);return null};a.extract_index_array=function(a,f){if(!c(a))return d.error("Wrong object:",
a.name),null;var h=b.V(a,f,"MAIN")||b.V(a,f,"NODES");if(h){if((h=h.na)&&h.Ob)return h.oe;d.error("Buffer data not found");return null}d.error("Wrong material:",f);return null};a.update_vertex_array=function(a,f,m,l){var r=["MAIN","NODES","DEPTH","COLOR_ID"];if(c(a))for(var q=0;q<r.length;q++){var p=b.V(a,f,r[q]);p&&(p=p.na)&&p.Ob&&p.Ob[m]&&h.ok(p,m,0,l)}else d.error("Wrong object:",a.name)};a.override_geometry=function(a,g,m,l,r){var q=["MAIN","NODES","DEPTH","COLOR_ID"];if(c(a))if(m instanceof Uint16Array||
m instanceof Uint32Array)if(l instanceof Float32Array)for(var p=0;p<q.length;p++){var v=b.V(a,g,q[p]);if(v){var E=v.na;if(E){h.$z(E,v.Uc,m);var B=0,x;for(x in E.Ob)var n=E.Ob[x],B=B+l.length/3*n.Zc;E.md=new Float32Array(B);var B=E.md,e=0;for(x in E.Ob)switch(n=E.Ob[x],x){case "a_position":B.set(l,e);n.offset=e;n.length=l.length;e+=n.length;break;case "a_normal":var H;r&&(H=h.jo(m,l,l));var G=h.ho(m,l,H);B.set(G,e);n.offset=e;n.length=l.length;e+=n.length;break;case "a_tangent":n.offset=e;n.length=
l.length/3*n.Zc;for(var G=new Float32Array(n.length),y=0;y<G.length;y+=4)G[y]=1,G[y+3]=1;B.set(G,e);e+=n.length;break;default:n.offset=e,n.length=l.length/3*n.Zc,G=new Float32Array(n.length),B.set(G,e),e+=n.length}h.Yr(E);f.Qn(v);(v=b.Yb(a,v))&&v.na&&(v.na=E)}}}else d.error("Wrong positions_array type");else d.error("Wrong ibo_array type");else d.error("Wrong object:",a.name)}};b4w.module.hud=function(a,p){var c=p("__hud");p("__print");a.draw_mixer_strip=c.draw_mixer_strip;a.plot_array=c.plot_array};b4w.module.lights=function(a,p){function c(a){for(var b=f.get_active(),c=f.Ba(b,"LAMP",f.DATA_ID_ALL),q=0;q<c.length;q++){var r=c[q];if("SUN"==r.ca.type){var n=r;break}}if(!n)return h.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(c=(90-a.vert_position)/180*Math.PI,q=n.d,k.set_rotation_euler(n,[c,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),g.quat_to_dir(q.quat,g.AXIS_Y,a),q=m.length(q.g),m.copy(a,l),m.scale(l,q,l),k.set_translation(n,
l),k.C(n),a=n.ca,a.To&&(r=n.data.energy,q=b.world.light_settings.environment_energy,c=Math.cos(Math.abs(c)),r*=Math.max(Math.min(3*c,1),0),c=Math.max(c,.1)*q,d.kr(a,r),f.set_environment_colors(b,c,null,null)),f.Uf(n,b))}function b(a){if(d.Ul(a))return a.ca.type;h.error("get_light_type(): Wrong object");return!1}var h=p("__print"),d=p("__lights"),f=p("__scenes");p("__batch");var k=p("__transform"),g=p("__util"),m=p("vec3"),l=new Float32Array(3),r,q=60;a.get_lamps=function(a){var b=f.get_active(),b=
f.Ba(b,"LAMP",f.DATA_ID_ALL);if(!a)return b;for(var c=[],d=0;d<b.length;d++){var g=b[d];g.ca.type===a&&c.push(g)}return c};a.get_sun_params=function(){for(var a=f.get_active(),a=f.Ba(a,"LAMP",f.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.ca.type){b=d;break}}return b?(b=b.ca.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=c;a.set_day_time=
function(a){for(var b=f.get_active(),b=f.Ba(b,"LAMP",f.DATA_ID_ALL),d=0;d<b.length;d++){var g=b[d];if("SUN"==g.ca.type){var l=g;break}}if(!l)return h.error("There is no sun on the scene"),null;l=-Math.cos(a/12*Math.PI)*q;b={};b.hor_position=12>a?15*a:15*(a-24);b.vert_position=l;c(b)};a.set_date=function(a){(r=a.getDate())?1582==r&&10==a.MC&&4<a.wv&&15>a.wv&&h.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):h.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=
function(a){q=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(d.Ul(a))var c=a.ca;else return h.error("get_light_params(): Wrong object"),!1;if(a=b(a))switch(a){case "SPOT":var f={light_type:a,light_color:c.color,light_energy:c.le,light_spot_blend:c.Tf,light_spot_size:c.gd,light_distance:c.distance};break;case "POINT":f={light_type:a,light_color:c.color,light_energy:c.le,light_distance:c.distance};break;default:f={light_type:a,light_color:c.color,light_energy:c.le}}return f?f:!1};a.get_light_type=
b;a.set_light_params=function(a,b){if(d.Ul(a))var c=a.ca;else return h.error("set_light_params(): Wrong object"),!1;var g=f.get_active();"number"==typeof b.light_energy&&(d.kr(c,b.light_energy),f.Uf(a,g));"object"==typeof b.light_color&&(d.Ty(c,b.light_color),f.Uf(a,g));"number"==typeof b.light_spot_blend&&(d.Vy(c,b.light_spot_blend),f.Uf(a,g));"number"==typeof b.light_spot_size&&(d.Wy(c,b.light_spot_size),f.Uf(a,g));"number"==typeof b.light_distance&&(d.Uy(c,b.light_distance),f.Uf(a,g));f.Vz()}};b4w.module.material=function(a,p){function c(a,b){for(var c=a.n,d=0;d<c.length;d++){var f=c[d];if(-1<f.wc.indexOf(b))return"MAIN"==f.type}return!1}function b(a,b){var c=d.V(a,b,"MAIN");return Boolean(c&&c.Sb[0])}function h(a,b){var c=d.V(a,b,"MAIN");return Boolean(c&&c.Sb[1])}var d=p("__batch"),f=p("__config"),k=p("__print"),g=p("__objects"),m=p("__shaders");p("__util");p("vec4");var l=f.q,r="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.inherit_material=function(a,
b,c,f){if(g.Cj(c)&&g.Cj(a)){for(var h=["MAIN","DEPTH","COLOR_ID"],l=!1,m=0;m<h.length;m++){var e=h[m],p=d.V(a,b,e),G=d.V(c,f,e);if(p&&G){var l=!0,y=d.Yb(c,f,e);"MAIN"==e&&(d.lr(G,p),y&&d.lr(y,p));for(e=0;e<G.Bb.length;e++){var A=G.Bb[e];if(-1!==r.indexOf(A)){var D=p.Bb.indexOf(A);-1!==D&&(G.L[e]=p.L[D],y&&(A=y.Bb.indexOf(A),-1!==A&&(y.L[A]=p.L[D])))}}}}l||k.error("Wrong objects for inheriting material!")}else k.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.n;
for(var c=0;c<a.length;c++)for(var d=0;d<a[c].wc.length;d++)-1==b.indexOf(a[c].wc[d])&&b.push(a[c].wc[d]);return b};a.set_diffuse_color=function(a,b,c){var f=d.V(a,b,"MAIN");f?(f.lb.set(c),(a=d.Yb(a,b,"MAIN"))&&a.lb.set(c)):k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=d.V(a,b,"MAIN");if(c){var f=Array(4);f[0]=c.lb[0];f[1]=c.lb[1];f[2]=c.lb[2];f[3]=c.lb[3];return f}k.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,
b,c){var f=d.V(a,b,"MAIN");if(f){if(f.je=c,a=d.Yb(a,b,"MAIN"))a.je=c}else k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=d.V(a,b,"MAIN");if(c)return c.je;k.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var f=d.V(a,b,"MAIN");f?(f.fd.set(c),(a=d.Yb(a,b,"MAIN"))&&a.fd.set(c)):k.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=d.V(a,b,"MAIN");if(c){var f=Array(3);f[0]=
c.fd[0];f[1]=c.fd[1];f[2]=c.fd[2];return f}k.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,c,f){b(a,c)||k.error('Property "specular_intensity" is missing!');d.V(a,c,"MAIN").Sb[0]=f;(a=d.Yb(a,c,"MAIN"))&&(a.Sb[0]=f)};a.get_specular_intensity=function(a,c){b(a,c)||k.error('Property "specular_intensity" is missing!');return d.V(a,c,"MAIN").Sb[0]};a.check_specular_intensity=b;a.set_specular_hardness=function(a,b,c){h(a,b)||k.error('Property "specular_hardness" is missing!');
d.V(a,b,"MAIN").Sb[1]=c;(a=d.Yb(a,b,"MAIN"))&&(a.Sb[1]=c)};a.get_specular_hardness=function(a,b){h(a,b)||k.error('Property "specular_hardness" is missing!');return d.V(a,b,"MAIN").Sb[1]};a.check_specular_hardness=h;a.set_emit_factor=function(a,b,c){var f=d.V(a,b,"MAIN");if(f){if(f.Fd=c,a=d.Yb(a,b,"MAIN"))a.Fd=c}else k.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=d.V(a,b,"MAIN");if(c)return c.Fd;k.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=
function(a,b,c){var f=d.V(a,b,"MAIN");if(f){if(f.wd=c,a=d.Yb(a,b,"MAIN"))a.wd=c}else k.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=d.V(a,b,"MAIN");if(c)return c.wd;k.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){var f=d.V(a,b,"MAIN");if(f){if(f.ie=c,a=d.Yb(a,b,"MAIN"))a.ie=c}else k.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=d.V(a,b,"MAIN");if(c)return c.ie;
k.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var f=d.V(a,b,"MAIN");if(f){if(f.$d=c,a=d.Yb(a,b,"MAIN"))a.$d=c}else k.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=d.V(a,b,"MAIN");if(c)return c.$d;k.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return k.error("missing arguments in get_material_params"),null;if(!c(a,b))return null;var f=d.V(a,b,"MAIN");
if(!f)return null;var g={};"MAIN"==f.type&&(g.Pf=f.Pf,g.TB=f.Fc[2],g.UB=5*(1-f.Fc[3]),g.Lf=f.Lf,g.VC=d.nb(f,"PARALLAX_STEPS")[1]);return g};a.get_water_material_params=function(a,b){if(!a||!b)return k.error("missing arguments in get_water_material_params"),null;if(!c(a,b))return null;var f=d.V(a,b,"MAIN");if(!f||!f.Oe)return null;if(!f)return k.error("material not found"),null;var g={};if("MAIN"==f.type){if(l.Wg){var h=g.shallow_water_col=Array(3);h[0]=f.shallow_water_col[0];h[1]=f.shallow_water_col[1];
h[2]=f.shallow_water_col[2];h=g.shore_water_col=Array(3);h[0]=f.shore_water_col[0];h[1]=f.shore_water_col[1];h[2]=f.shore_water_col[2];g.shallow_water_col_fac=f.shallow_water_col_fac;g.shore_water_col_fac=f.shore_water_col_fac}g.foam_factor=f.foam_factor;g.norm_uv_velocity=f.th;g.absorb_factor=d.nb(f,"ABSORB")[1];g.sss_strength=d.nb(f,"SSS_STRENGTH")[1];g.sss_width=d.nb(f,"SSS_WIDTH")[1];g.dst_noise_scale0=d.nb(f,"DST_NOISE_SCALE_0")[1];g.dst_noise_scale1=d.nb(f,"DST_NOISE_SCALE_1")[1];g.dst_noise_freq0=
d.nb(f,"DST_NOISE_FREQ_0")[1];g.dst_noise_freq1=d.nb(f,"DST_NOISE_FREQ_1")[1];g.dir_min_shore_fac=d.nb(f,"DIR_MIN_SHR_FAC")[1];g.dir_freq=d.nb(f,"DIR_FREQ")[1];g.dir_noise_scale=d.nb(f,"DIR_NOISE_SCALE")[1];g.dir_noise_freq=d.nb(f,"DIR_NOISE_FREQ")[1];g.dir_min_noise_fac=d.nb(f,"DIR_MIN_NOISE_FAC")[1];g.dst_min_fac=d.nb(f,"DST_MIN_FAC")[1];g.waves_hor_fac=d.nb(f,"WAVES_HOR_FAC")[1]}return g};a.set_material_extended_params=function(a,b,f){if(a&&b&&f){if(!c(a,b))return k.error("setting material params is not possible"),
null;var g=d.V(a,b,"MAIN");if(g){var h=[g];(g=d.Yb(a,b,"MAIN"))&&h.push(g);for(a=0;a<h.length;a++)g=h[a],"number"==typeof f.material_reflectivity&&(g.Pf=f.material_reflectivity),"number"==typeof f.material_fresnel&&(g.Fc[2]=f.material_fresnel),"number"==typeof f.material_fresnel_factor&&(g.Fc[3]=1-f.material_fresnel_factor/5),"number"==typeof f.material_parallax_scale&&(g.Lf=f.material_parallax_scale),"number"==typeof f.material_parallax_steps&&(b=m.t(parseFloat(f.material_parallax_steps)),d.ba(g,
"PARALLAX_STEPS",b),d.qb(g,!0))}else k.error("material not found")}else k.error("missing arguments in set_material_params")};a.set_water_material_params=function(a,b,f){if(!a||!b||!f)return k.error("missing arguments in set_water_material_params"),null;if(!c(a,b))return k.error("setting water material params is not possible"),null;var g=d.V(a,b,"MAIN");if(!g)return k.error("material not found"),null;b=[g];(g=d.Yb(a,mat_name,"MAIN"))&&b.push(g);for(a=0;a<b.length;a++){g=b[a];l.Wg&&("object"==typeof f.shallow_water_col&&
g.shallow_water_col.set(f.shallow_water_col),"number"==typeof f.shallow_water_col_fac&&(g.shallow_water_col_fac=f.shallow_water_col_fac),"object"==typeof f.shore_water_col&&g.shore_water_col.set(f.shore_water_col),"number"==typeof f.shore_water_col_fac&&(g.shore_water_col_fac=f.shore_water_col_fac));if(l.shore_smoothing&&g.on&&("boolean"==typeof f.shore_smoothing&&(f.shore_smoothing?d.ba(g,"SHORE_SMOOTHING",1):d.ba(g,"SHORE_SMOOTHING",0)),"number"==typeof f.absorb_factor)){var h=m.t(parseFloat(f.absorb_factor));
d.ba(g,"ABSORB",h)}"number"==typeof f.foam_factor&&l.vg&&(g.foam_factor=f.foam_factor);"number"==typeof f.norm_uv_velocity&&(g.th=f.norm_uv_velocity);l.water_dynamic&&g.water_dynamic&&("boolean"==typeof f.water_dynamic&&(f.water_dynamic?d.ba(g,"DYNAMIC",1):d.ba(g,"DYNAMIC",0)),"number"==typeof f.waves_height&&(h=m.t(parseFloat(f.waves_height)),d.ba(g,"WAVES_HEIGHT",h)),"number"==typeof f.waves_length&&(h=m.t(parseFloat(f.waves_length)),d.ba(g,"WAVES_LENGTH",h)),"number"==typeof f.sss_strength&&(h=
m.t(parseFloat(f.sss_strength)),d.ba(g,"SSS_STRENGTH",h)),"number"==typeof f.sss_width&&(h=m.t(parseFloat(f.sss_width)),d.ba(g,"SSS_WIDTH",h)),"number"==typeof f.dst_noise_scale0&&(h=m.t(parseFloat(f.dst_noise_scale0)),d.ba(g,"DST_NOISE_SCALE_0",h)),"number"==typeof f.dst_noise_scale1&&(h=m.t(parseFloat(f.dst_noise_scale1)),d.ba(g,"DST_NOISE_SCALE_1",h)),"number"==typeof f.dst_noise_freq0&&(h=m.t(parseFloat(f.dst_noise_freq0)),d.ba(g,"DST_NOISE_FREQ_0",h)),"number"==typeof f.dst_noise_freq1&&(h=m.t(parseFloat(f.dst_noise_freq1)),
d.ba(g,"DST_NOISE_FREQ_1",h)),"number"==typeof f.dir_min_shore_fac&&(h=m.t(parseFloat(f.dir_min_shore_fac)),d.ba(g,"DIR_MIN_SHR_FAC",h)),"number"==typeof f.dir_freq&&(h=m.t(parseFloat(f.dir_freq)),d.ba(g,"DIR_FREQ",h)),"number"==typeof f.dir_noise_scale&&(h=m.t(parseFloat(f.dir_noise_scale)),d.ba(g,"DIR_NOISE_SCALE",h)),"number"==typeof f.dir_noise_freq&&(h=m.t(parseFloat(f.dir_noise_freq)),d.ba(g,"DIR_NOISE_FREQ",h)),"number"==typeof f.dir_min_noise_fac&&(h=m.t(parseFloat(f.dir_min_noise_fac)),d.ba(g,
"DIR_MIN_NOISE_FAC",h)),"number"==typeof f.dst_min_fac&&(h=m.t(parseFloat(f.dst_min_fac)),d.ba(g,"DST_MIN_FAC",h)),"number"==typeof f.waves_hor_fac&&(h=m.t(parseFloat(f.waves_hor_fac)),d.ba(g,"WAVES_HOR_FAC",h)));d.qb(g,!0)}return!0}};b4w.module.particles=function(a,p){var c=p("__particles"),b=p("__print");a.set_size=function(a,d,f){c.Dg(a)?c.set_size(a,d,f):b.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,d,f){c.Dg(a)?c.set_normal_factor(a,d,f):b.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,d,f){c.Dg(a)?(f=Math.min(f,1),f=Math.max(f,0),c.set_factor(a,d,f)):b.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,p){var c=p("__print"),b=p("__physics"),h=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){b.has_physics(a)?b.enable_simulation(a):c.error("No physics for object "+a.name)};a.disable_simulation=function(a){b.has_physics(a)?b.disable_simulation(a):c.error("No physics for object "+a.name)};a.has_physics=function(a){return b.has_physics(a)};a.has_simulated_physics=function(a){return b.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return b.has_dynamic_physics(a)};a.set_gravity=function(a,f){b.has_physics(a)?b.set_gravity(a,f):c.error("No physics for object "+a.name)};a.set_damping=function(a,f,h){b.has_physics(a)?b.r("set_damping",a.l.M,f,h):c.error("No physics for object "+a.name)};a.reset_damping=function(a){if(b.has_physics(a)){var f=a.game;b.r("set_damping",a.l.M,f.damping,f.rotation_damping)}else c.error("No physics for object "+a.name)};a.set_transform=function(a,f,h){b.has_physics(a)?b.set_transform.apply(this,
arguments):c.error("No physics for object "+a.name)};a.sync_transform=function(a){b.has_physics(a)?b.sync_transform(a):c.error("No physics for object "+a.name)};a.apply_velocity=function(a){b.has_physics(a)?b.apply_velocity.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){b.has_physics(a)?b.apply_velocity_world.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_force=function(a,f,h,g){b.has_physics(a)?b.apply_force.apply(this,
arguments):c.error("No physics for object "+a.name)};a.apply_torque=function(a,f,h,g){b.has_physics(a)?b.apply_torque.apply(this,arguments):c.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,f){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_throttle(a,h.clamp(f,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,f,k){if(b.has_physics(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");
f=h.clamp(f,0,1);var g=a.i.ug;-1==k||1==k?g=Math.max(-1,Math.min(g+k*f,1)):0==k&&0<=g?(g-=f,g=Math.max(0,g)):0==k&&0>g?(g+=f,g=Math.min(0,g)):c.error("Wrong steering direction");b.vehicle_throttle(a,h.clamp(g,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_steer=function(a,f){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_steer(a,h.clamp(f,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,f,k){if(b.has_physics(a)){b.is_vehicle_chassis(a)||
b.is_vehicle_hull(a)||c.error("Wrong object");f=h.clamp(f,0,1);var g=a.i.eh;-1==k||1==k?g=Math.max(-1,Math.min(g+k*f,1)):0==k&&0<=g?(g-=f,g=Math.max(0,g)):0==k&&0>g?(g+=f,g=Math.min(0,g)):c.error("Wrong steering direction");b.vehicle_steer(a,h.clamp(g,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_brake=function(a,f){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_brake(a,h.clamp(f,0,1))):c.error("No physics for object "+a.name)};
a.vehicle_brake_inc=function(a,f){if(b.has_physics(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");f=h.clamp(f,-1,1);var k=a.i.Bh;b.vehicle_brake(a,h.clamp(k+k*f,0,1))}else c.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return b.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return b.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;
c.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.i.ug;c.error("Wrong object")};a.get_vehicle_steering=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.i.eh;c.error("Wrong object")};a.get_vehicle_brake=function(a){if(!b.has_physics(a))return c.error("No physics for object "+
a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.i.Bh;c.error("Wrong object")};a.get_vehicle_speed=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return b.get_vehicle_speed(a);c.error("Wrong object")};a.is_character=function(a){return b.is_character(a)};a.set_character_move_dir=function(a,f,h){b.has_physics(a)?b.set_character_move_dir(a,f,h):c.error("No physics for object "+a.name)};a.set_character_move_type=
function(a,f){b.has_physics(a)?b.set_character_move_type(a,f):c.error("No physics for object "+a.name)};a.set_character_walk_velocity=function(a,f){b.has_physics(a)?b.set_character_walk_velocity(a,f):c.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,f){b.has_physics(a)?b.set_character_run_velocity(a,f):c.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,f){b.has_physics(a)?b.set_character_fly_velocity(a,f):c.error("No physics for object "+
a.name)};a.character_jump=function(a){b.has_physics(a)?b.character_jump(a):c.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,f,h){b.has_physics(a)?b.character_rotation_inc(a,f,h):c.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,f){b.has_physics(a)?b.set_character_rotation_quat(a,f):c.error("No physics for object "+a.name)};a.set_character_rotation=function(a,f,h){b.has_physics(a)?b.set_character_rotation(a,f,h):c.error("No physics for object "+
a.name)};a.set_character_rotation_v=function(a,f){b.has_physics(a)?b.set_character_rotation_v(a,f):c.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,f){b.has_physics(a)?b.set_character_rotation_h(a,f):c.error("No physics for object "+a.name)};a.append_collision_test=function(a,f,h,g){b.has_physics(a)?b.append_collision_test(a,f,h,g):c.error("No physics for object "+a.name)};a.remove_collision_test=function(a,f){b.has_physics(a)?b.remove_collision_test(a,f):c.error("No physics for object "+
a.name)};a.apply_collision_impulse_test=function(a,f){b.has_physics(a)?b.apply_collision_impulse_test(a,f):c.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){b.has_physics(a)?b.clear_collision_impulse_test(a):c.error("No physics for object "+a.name)};a.append_ray_test=function(a,f,h,g,m,l){b.has_physics(a)?b.append_ray_test(a,f,h,g,m,l):c.error("No physics for object "+a.name)};a.remove_ray_test=function(a,f,h,g,m){b.has_physics(a)?b.remove_ray_test(a,f,h,g,m):c.error("No physics for object "+
a.name)};a.apply_constraint=function(a,f,h,g,m,l,r,q,p,v){b.has_physics(f)&&b.has_physics(m)?b.apply_constraint(a,f,h,g,m,l,r,q,p,v):c.error("Wrong objects")};a.clear_constraint=function(a){b.has_physics(a)&&b.ix(a)?b.clear_constraint(a):c.error("Wrong object")};a.pull_to_constraint_pivot=function(a,f,h,g,m,l){b.has_physics(a)&&b.has_physics(g)?b.pull_to_constraint_pivot(a,f,h,g,m,l):c.error("Wrong objects")}};b4w.module.scenes=function(a,p){var c=p("__batch"),b=p("__camera"),h=p("__graph"),d=p("__objects"),f=p("__print"),k=p("__physics"),g=p("__scenes"),m=p("__util");a.DATA_ID_ALL=g.DATA_ID_ALL;a.set_active=function(a){var b=g.Rh();g.set_active(m.keysearch("name",a,b))};a.get_active=function(){return g.Z()?g.get_active().name:""};a.get_scenes=function(){for(var a=g.Rh(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(g.Z())return g.pj(g.get_active());f.error("No active scene");
return!1};a.get_object_by_name=function(a,b){var c=g.mf(g.dg,a,b|0);if(c)return c;f.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,c){if(a=g.mf(g.vn,a,b,c|0))return a;f.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var c=g.mf(g.wn,a,b|0);if(c)return c;f.error("get object "+a+": not found")};a.get_object_data_id=function(a){return g.get_object_data_id(a)};a.pick_object=g.pick_object;a.set_glow_intensity=function(a,b){a.d.nf=b};a.get_glow_intensity=
function(a){return a.d.nf};a.apply_glow_anim=function(a,b,c,d){a.d&&a.d.ad&&g.apply_glow_anim(a,b,c,d)};a.apply_glow_anim_def=function(a){if(a.d&&a.d.ad){var b=a.d.sj;g.apply_glow_anim(a,b.bx,b.dx,b.ex)}};a.clear_glow_anim=function(a){a.d&&a.d.ad&&g.clear_glow_anim(a)};a.set_glow_color=function(a){var b=g.get_active();if(b=g.fa(b,"GLOW"))b.Bg.set(a),b.Ca=!0};a.get_glow_color=function(a){var b=g.get_active();if(b=g.fa(b,"GLOW"))return a=a||new Float32Array(3),a.set(b.Bg),a};a.get_shadow_params=function(){if(!g.Z())return f.error("No active scene"),
!1;var a=g.get_active(),b=g.fa(a,"SHADOW_CAST");if(!b)return null;var c=a.d.cd,d=g.fa(a,"MAIN_OPAQUE"),h=g.fa(a,"DEPTH"),k={};k.csm_resolution=c.csm_resolution;k.self_shadow_polygon_offset=b.self_shadow_polygon_offset;h&&(k.self_shadow_normal_offset=h.self_shadow_normal_offset);k.enable_csm=c.enable_csm;k.csm_num=c.csm_num;k.csm_first_cascade_border=c.csm_first_cascade_border;k.first_cascade_blur_radius=c.first_cascade_blur_radius;k.csm_last_cascade_border=c.csm_last_cascade_border;k.last_cascade_blur_radius=
c.last_cascade_blur_radius;k.fade_last_cascade=c.fade_last_cascade;k.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(k.csm_borders=g.Hw(a,d.j),k.blur_radii=new Float32Array(c.csm_num),k.blur_radii.set(d.j.Xj.subarray(0,c.csm_num))):(k.csm_borders=null,k.blur_radii=null);return k};a.set_shadow_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var d=g.get_active();"number"==typeof a.self_shadow_polygon_offset&&h.P(d.d.ob,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=
a.self_shadow_polygon_offset)});var k=g.fa(d,"DEPTH");k&&("number"==typeof a.self_shadow_normal_offset&&(k.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(k.pcf_blur_radius=a.pcf_blur_radius));var m=g.fa(d,"MAIN_BLEND");m&&("number"==typeof a.self_shadow_normal_offset&&(m.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(m.pcf_blur_radius=a.pcf_blur_radius),m.Ca=!0);m=d.d.cd;"number"==typeof a.csm_first_cascade_border&&
(m.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(m.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(m.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(m.last_cascade_blur_radius=a.last_cascade_blur_radius);if(k){for(var p=k.p,E=0;E<p.length;E++){var B=p[E];B.fb.Ab&&(B=B.o,c.Fk(B,m),c.qb(B))}k.Ca=!0}k=d.camera.d.J;for(E=0;E<k.length;E++)b.dn(k[E],
m);g.Fm(d)};a.get_environment_colors=function(){if(!g.Z())return f.error("No active scene"),!1;var a=g.get_active();return g.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(!g.Z())return f.error("No active scene"),!1;var d=g.get_active();g.set_environment_colors(d,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();return g.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!g.Z())return f.error("No active scene"),
!1;var b=g.get_active();g.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!g.Z())return f.error("No active scene"),!1;var a=g.get_active();return g.get_ssao_params(a)};a.set_ssao_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!g.Z())return f.error("No active scene"),null;var a=g.get_active(),a=g.fa(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=
a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!g.Z())return f.error("No active scene"),null;var b=g.get_active(),b=g.fa(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.Ca=!0};a.get_sky_params=function(){if(!g.Z())return f.error("No active scene"),
!1;var a=g.get_active();return g.get_sky_params(a)};a.set_sky_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.set_sky_params(b,a)};a.get_dof_params=function(){if(!g.Z())return f.error("No active scene"),!1;var a=g.get_active();return g.fa(a,"DOF")?g.get_dof_params(a):null};a.set_dof_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!g.Z())return f.error("No active scene"),
!1;var a=g.get_active();return g.fa(a,"GOD_RAYS")?g.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.set_god_rays_params(b,a)};a.get_bloom_params=function(){if(!g.Z())return f.error("No active scene"),!1;var a=g.get_active();return g.fa(a,"BLOOM")?g.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.set_bloom_params(b,a)};a.get_wind_params=
function(){return g.get_wind_params()};a.set_wind_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.set_wind_params(b,a)};a.get_water_surface_level=g.get_water_surface_level;a.set_water_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.set_water_params(b,a)};a.get_water_mat_params=function(a){if(!g.Z())return f.error("No active scene"),!1;var b=g.get_active();g.get_water_mat_params(b,a)};a.update_scene_materials_params=
function(){if(!g.Z())return f.error("No active scene"),!1;var a=g.get_active();g.$r(a)};a.hide_object=function(a){d.Cj(a)?g.hide_object(a):f.error("show/hide is only supported for dynamic meshes")};a.show_object=function(a){d.Cj(a)?g.show_object(a):f.error("show/hide is only supported for dynamic meshes")};a.is_visible=function(a){return a.d.is_visible};a.check_object=function(a){return g.Z()?g.check_object(a,g.get_active()):(f.error("No active scene"),!1)};a.get_all_objects=function(a,b){var c=g.get_active();
a||(a="ALL");b||0===b||(b=g.DATA_ID_ALL);return g.Ba(c,a,b)};a.get_object_name=function(a){return a?a.name:(f.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(f.error("Wrong object ID"),"UNDEFINED")};a.get_object_dg_parent=function(a){return a.ra};a.get_object_children=function(a){return a.oc.slice(0)};a.get_first_character=function(){for(var a=g.Ba(g.get_active(),"MESH",g.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(k.is_character(c))return c}return null};
a.get_shore_dist=function(a,b){b||0===b||(b=1);return g.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return g.get_cam_water_depth()};a.get_type_mesh_object=function(a){return"MESH"==a.type?a.d.type:null};a.get_meta_tags=function(){if(!g.Z())return f.error("No active scene"),!1;var a=g.get_active();return g.get_meta_tags(a)};a.append_object=function(a){if(!a.d.Sl)return f.error('object "'+a.name+'" has been created not by coping.'),!1;var b=a.name;if(g.mf(g.dg,a.name,0))for(var c=1;;){b=a.name+
(3>String(c).length?"."+("000"+String(c)).slice(-3):"."+String(c));if(!g.mf(g.dg,b,0)){a.name=b;f.error('object "'+a.name+'" already exists. Name was replaced by "'+b+'".');break}c++}g.append_object(g.get_active(),a,!0)};a.remove_object=function(a){g.remove_object(a)||f.error('object "'+a.name+'" was not copied.')}};b4w.module.sfx=function(a,p){var c=p("__scenes"),b=p("__sfx"),h=p("__print");a.play=function(a,c,h){b.play(a,c,h)};a.play_def=function(a){b.play_def(a)};a.is_play=function(a){return b.is_play(a)};a.speaker_play=function(a,c,k,g){h.error("speaker_play() deprecated, use play() or play_def() instead");b.cyclic(a,c);g&&b.playrate(a,g);b.play(a,0,k)};a.speaker_stop=function(a){h.error("speaker_stop() deprecated, use stop() instead");b.stop(a)};a.stop=function(a){b.stop(a)};a.pause=function(a){b.qz(a)};
a.resume=function(a){b.sz(a)};a.speaker_playback_rate=function(a,c){h.error("speaker_playback_rate() deprecated, use playrate() instead");b.playrate(a,c)};a.playrate=function(a,c){b.playrate(a,c)};a.get_playrate=function(a){return b.get_playrate(a)};a.cyclic=function(a,c){b.cyclic(a,c)};a.is_cyclic=function(a){return b.is_cyclic(a)};a.listener_reset_speed=function(a,c){b.listener_reset_speed(a,c)};a.speaker_reset_speed=function(a,c,h){b.speaker_reset_speed(a,c,h)};a.get_volume=function(a){return a&&
"object"===typeof a?b.get_volume(a):b.Ow()};a.set_volume=function(a,c){a&&"object"===typeof a?b.set_volume(a,c):b.Xy(c)};a.mute=function(a,c){a&&"object"===typeof a?b.mute(a,c):b.Rx(c)};a.is_muted=function(a){return a&&"object"===typeof a?b.is_muted(a):b.xx()};a.get_speaker_objects=function(){return b.get_speaker_objects().slice(0)};a.get_speakers=function(){h.error("get_speakers() deprecated, use get_speaker_objects() instead");return a.get_speaker_objects()};a.check_active_speakers=b.check_active_speakers;
a.set_compressor_params=function(a){b.set_compressor_params(c.get_active(),a)};a.get_compressor_params=function(){return b.get_compressor_params(c.get_active())};a.duck=function(a,c,h){a&&"object"===typeof a?b.duck(a,c,h):b.Lv(c,h)};a.unduck=function(a){a&&"object"===typeof a?b.unduck(a):b.Uz()};a.apply_playlist=b.apply_playlist;a.clear_playlist=b.clear_playlist;a.detect_audio_container=b.detect_audio_container;a.detect_video_container=b.detect_video_container;a.set_positional_params=b.set_positional_params;
a.get_positional_params=b.get_positional_params;a.set_filter_params=b.set_filter_params;a.get_filter_params=b.get_filter_params;a.get_filter_freq_response=b.get_filter_freq_response;a.get_duration=function(a){if(a&&b.Od(a))return b.get_duration(a);h.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.shaders=function(a,p){function c(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var f=d.split(" ")[0];f in b||(b[f]=0);b[f]++}}c=a=0;for(f in b)switch(f){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[f];break;default:a+=b[f]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function b(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);
c.send(b);if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function h(a){for(var b=g.Rh(),c=0;c<b.length;c++)for(var d=g.Ba(b[c],"MESH",g.DATA_ID_ALL),f=0;f<d.length;f++){var h=d[f];if(h.n)for(var k=0;k<h.n.length;k++){var m=h.n[k];if(m.Jb==a&&m.wc.length)return m.wc}}return null}function d(a){a.sort(function(a,b){return b.Al.ALU_OPS-a.Al.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.Al,g=c.yA,k=h(c.uv),k=k?"\t\t("+k.join(", ")+")":"\t\t(NA)";f.groupCollapsed("FRAG --\x3e",
"ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",g.ALU_OPS,"TEX",g.TEX_OPS,k);f.groupCollapsed("directives");for(var k=c.Ia.ke,m=0;m<k.length;m++){var p=k[m];f.log(p[0],p[1])}f.groupEnd();f.groupCollapsed("vert src");f.log(c.xA);f.groupEnd();f.groupCollapsed("vert stats");for(var n in g)"ALU_OPS"!=n&&"TEX_OPS"!=n&&f.log(n,g[n]);f.groupEnd();f.groupCollapsed("frag src");f.log(c.jw);f.groupEnd();f.groupCollapsed("frag stats");for(n in d)"ALU_OPS"!=n&&"TEX_OPS"!=n&&f.log(n,d[n]);f.groupEnd();
f.groupEnd()}}p("__config");var f=p("__print"),k=p("__extensions"),g=p("__scenes"),m=p("__shaders");p("__util");a.report_repeatful_compilation=function(){var a=m.yv(),b=0,c;for(c in a){var d=a[c],g=d.count;1<g&&f.log(g-1,d.cD,d.pC);b+=g-1}f.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var g=m.qp(),h=0,p;for(p in g)a&&-1===p.indexOf(a)||h++;var h="of "+h+" analyzing...",v={};for(p in g)if(!a||-1!==p.indexOf(a)){var E=g[p],B;var x=E.ln;B=E.jp;var n=k.rp();if(n){x=n.getTranslatedShaderSource(x);
B=n.getTranslatedShaderSource(B);var n=b("/nvidia_vert",x),e=c(n),H=b("/nvidia_frag",B),G=c(H);B={xA:x,qD:n,yA:e,jw:B,SB:H,Al:G}}else f.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),B=void 0;n=E.Ia;x=n.Ai+" + "+n.Mh;B.uv=E;B.Ia=n;E=v[x]=v[x]||[];E.push(B);f.log(h)}for(x in v)f.group("%c"+x,"color: #800"),E=v[x],d(E),f.groupEnd()}};b4w.module.textures=function(a,p){var c=p("__textures"),b=p("__print");a.get_canvas_texture_context=function(a){var d=c.Ew(a);if(d)return d;b.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a){c.bA(a)||b.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a){c.play_video(a)||b.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a){c.pause_video(a)||b.error('Texture with name "'+a+'" not found!')};a.reset_video=function(a){c.reset_video(a)||
b.error('Texture with name "'+a+'" not found!')}};b4w.module.transform=function(a,p){var c=p("__print"),b=p("__physics"),h=p("__transform"),d=p("__util"),f=p("__objects"),k=new Float32Array(3),g=new Float32Array(4);a.SPACE_LOCAL=h.SPACE_LOCAL;a.SPACE_WORLD=h.SPACE_WORLD;a.set_translation=function(a,d,g,p){f.uc(a)?(k[0]=d,k[1]=g,k[2]=p,h.set_translation(a,k),h.C(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,d){f.uc(a)?(h.set_translation(a,d),h.C(a),b.sync_transform(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.set_translation_rel=function(a,g,p,q,w){f.uc(a)?(k[0]=g,k[1]=p,k[2]=q,d.vi(k,1,w.d.quat,w.d.g,k),h.set_translation(a,k),h.C(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,b){b||(b=new Float32Array(3));h.get_translation(a,b);return b};a.set_rotation=function(a,d,k,p,w){f.uc(a)?(g[0]=d,g[1]=k,g[2]=p,g[3]=w,h.set_rotation(a,g),h.C(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};
a.set_rotation_quat=function(){c.error("set_rotation_quat() deprecated, use set_rotation() instead");return a.set_rotation};a.set_rotation_v=function(a,d){f.uc(a)?(h.set_rotation(a,d),h.C(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat_v=function(){c.error("set_rotation_quat_v() deprecated, use set_rotation_v() instead");return a.set_rotation_v};a.get_rotation=function(a,b){b||(b=new Float32Array(4));h.get_rotation(a,b);return b};a.get_rotation_quat=
function(){c.error("get_rotation_quat() deprecated, use get_rotation() instead");return a.get_rotation};a.set_rotation_euler=function(a,d,g,p){f.uc(a)?(k[0]=d,k[1]=g,k[2]=p,h.set_rotation_euler(a,k),h.C(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,d){f.uc(a)?(h.set_rotation_euler(a,d),h.C(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,b){f.uc(a)?(h.set_scale(a,b),h.C(a)):c.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.get_scale=function(a){return h.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return c.error("Wrong object: "+a.name),!1;for(var d=0;d<a.oc.length;d++)if(!f.uc(a.oc[d])){c.error('Wrong object: "'+a.oc[d].name+'" is not dynamic.');return}h.set_translation(a,[0,0,0]);h.set_rotation(a,[0,0,0,1]);h.set_scale(a,1);h.C(a);b.sync_transform(a)};a.get_object_size=function(a){return d.is_mesh(a)?h.get_object_size(a):(c.error("Wrong object: "+a.name),0)};
a.get_object_center=function(a,b,f){return d.is_mesh(a)?h.get_object_center(a,b,f):(c.error("Wrong object: "+a.name),null)};a.move_local=function(a,d,g,k){f.uc(a)?(h.move_local(a,d,g,k),h.C(a),b.sync_transform(a)):c.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return h.get_object_bounding_box(a)}};b4w.module.util=function(a,p){var c=p("__print"),b=p("__util"),h=p("vec3");p("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=b.keyfind;a.keysearch=b.keysearch;a.matrix_to_quat=function(a){return b.matrix_to_quat(a)};a.euler_to_quat=function(a,c){c||(c=new Float32Array(4));return b.euler_to_quat(a,c)};a.quat_to_euler=
function(a,c){c||(c=new Float32Array(3));return b.quat_to_euler(a,c)};a.sign=b.sign;a.clamp=b.clamp;a.quat_to_dir=b.quat_to_dir;a.ground_project_quat=function(a,c){return b.quat_project(a,b.AXIS_MY,b.AXIS_Y,b.AXIS_MZ,c)};a.cam_quat_to_mesh_quat=function(a,c){return b.cam_quat_to_mesh_quat(a,c)};a.quat_project=function(a,f,k,g,m){return 0!=h.dot(k,g)?(c.error("Wrong in-plane direction"),null):b.quat_project(a,f,k,g,m)};a.hash_code=b.hash_code;a.smooth=b.smooth;a.smooth_v=b.smooth_v;a.is_vector=b.is_vector;
a.correct_cam_quat_up=b.correct_cam_quat_up;a.quat_to_angle_axis=b.quat_to_angle_axis;a.random_from_array=b.random_from_array;a.xz_direction=b.xz_direction;a.line_plane_intersect=b.line_plane_intersect;a.is_mesh=b.is_mesh;a.angle_wrap_0_2pi=b.angle_wrap_0_2pi;a.angle_wrap_periodic=b.angle_wrap_periodic};"object"==typeof module&&module.sl&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){var c=p("__version");a.version=c.version;a.type=c.type;a.date=c.date};"object"==typeof module&&module.sl&&b4w.module.version(exports);b4w.module.objects=function(a,p){var c=p("__objects"),b=p("__print"),h=p("__util"),d=p("__scenes");a.get_meta_tags=function(a){if(a&&a.b4w_object_tags)return c.get_meta_tags(a)};a.copy=function(a,k,g){return h.is_mesh(a)?a.Dn?(b.error('object "'+a.name+'" is meta-object.'),!1):c.uc(a)?!c.Yx(a)&&g?(b.error('object "'+a.name+'" has not dynamic geometry for deep copying.'),!1):-1==d.Ba(d.get_active(),"MESH",d.DATA_ID_ALL).indexOf(a)?(b.error('object "'+a.name+'" does not belong to the active scene.'),
!1):c.copy(a,k||"",g):(b.error('object "'+a.name+'" is not dynamic.'),!1):(b.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,d,g){if(!h.is_mesh(a))return b.error('object "'+a.name+'" is not of type "MESH".'),null;d=d.join("%join%");var m=c.Yw(a,d);null!=m?a.d.Qd[m]=g:b.error('value "'+d+'" was not found in "'+a.name+'" object.')};a.set_nodemat_rgb=function(a,d,g,m,l){if(!h.is_mesh(a))return b.error('object "'+a.name+'" is not of type "MESH".'),null;d=d.join("%join%");
var p=c.Rw(a,d);null!=p?(a.d.ac[p]=g,a.d.ac[p+1]=m,a.d.ac[p+2]=l):b.error('rgb "'+d+'" was not found in "'+a.name+'" object.')}};b4w.module.main=function(a,p){function c(){}function b(){}function h(){}function d(){window.performance||(e.log("Apply performance workaround"),window.performance={});var a=Date.now();if(window.performance.now)b=a-performance.now();else{e.log("Apply performance.now() workaround");window.performance.now=function(){return Date.now()-a};var b=a}Z.mr(0);return b}function f(a,c){a.addEventListener("webglcontextlost",function(a){a.preventDefault();e.error("WebGL context lost");l()},!1);A.gc(c);var d=A.wp();
d&&e.log("%cRENDERER INFO:","color: #00a",c.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+c.getParameter(d.UNMASKED_RENDERER_WEBGL));Q.gc(c);D.gc(c);S.gc(c);P.gc(c);y.gc(c);G.gc(c);N.qr(a.width,a.height,1,k("x"),k("y"));u.init();b=v();q()}function k(a){if("x"==a)var b=X.offsetLeft;else if("y"==a)b=X.offsetTop;else return 0;return g(b,X,a)}function g(a,b,c){a=a||0;if(b=b.offsetParent){if("x"==c)var d=b.offsetLeft;else"y"==c&&(d=b.offsetTop);a=g(a+d,b,c)}return a}function m(){c=function(){}}function l(){r()||
(ga=performance.now()/1E3,u.pause(),J.pause(),S.pause(),E.pause())}function r(){return ea<ga}function q(){oa(q);var a=performance.now()/1E3;pa||(pa=a);var c=a-pa;if(!(c<1/R.se)){for(var d=Z.Ag(),e=0;e<O.length;e++)O[e](d,c);r()||(ea>pa&&(c-=ea-Math.max(ga,pa)),d+=c,Z.mr(d),y.update(),I.update(),G.update(),w(d,c),b(c));pa=a}}function w(a,b){G.is_primary_loaded()&&(L.reset(),V.update(b),C.update(a,b),u.update(a,b),B.update(b),G.is_primary_loaded()&&(J.update(a,b),G.is_primary_loaded()&&(c(b,a),G.is_primary_loaded()&&
(H.update(a,b),G.is_primary_loaded()&&(E.update(),N.update(a,b),E.nA(),T&&(T(X.toDataURL()),T=null))))))}function v(){var a=60,b=0,c=0,d=R.dw,e=R.cw;return function(f){a=fa.smooth(1/f,a,f,d);b=fa.smooth(0,b,f,d);c=(c+1)%e;0==c&&h(Math.round(a),Math.round(b))}}var E=p("__anchors"),B=p("__animation"),x=p("__compat"),n=p("__config"),e=p("__print"),H=p("__controls"),G=p("__data"),y=p("__debug"),A=p("__extensions"),D=p("__geometry"),L=p("__hud"),C=p("__nla"),I=p("__assets"),J=p("__physics"),Q=p("__renderer"),
N=p("__scenes"),u=p("__sfx"),P=p("__shaders"),S=p("__textures"),Z=p("__time"),V=p("__transform"),fa=p("__util"),Y=p("__version"),ha=n.context,R=n.q,X=null,z=null,pa=0,ga=0,ea=0,O=[],T=null,W=["webgl","experimental-webgl"],ma=null,oa=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/R.se)}}();a.init=function(a,b){n.Yy();e.cz(R.console_verbose);
var c=Y.version()+" "+Y.type()+" ("+Y.date()+")";e.log("%cINIT ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;c=d();X=a;x.$t();var g;g=null;for(var h=0;h<W.length;h++){var k=W[h];try{g=a.getContext(k,ha)}catch(l){}if(g)break}if(!g)return null;ma=g;f(X,g);n.bu();x.Sy(g);e.log("%cSET PRECISION:","color: #00a",R.precision);b?(L.init(b),z=b):(n.q.show_hud_debug_info=!1,n.Lc.Nj=!1);J.nx(c);E.init(a);return g};a.set_check_gl_errors=function(a){y.set_check_gl_errors(a)};a.resize=function(a,
b,c){!1!==c&&(X.style.width=a+"px",X.style.height=b+"px",z&&(z.style.width=a+"px",z.style.height=b+"px"));z&&(z.width=a,z.height=b,L.ph());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))R.canvas_resolution_factor=1;c=a*R.canvas_resolution_factor;b*=R.canvas_resolution_factor;R.allow_hidpi&&1<window.devicePixelRatio&&(c*=window.devicePixelRatio,b*=window.devicePixelRatio);X.width=c;X.height=b;if(c>ma.drawingBufferWidth||b>ma.drawingBufferHeight){e.warn("Canvas size exceeds platform limits, downscaling");
var d=Math.min(ma.drawingBufferWidth/c,ma.drawingBufferHeight/b);c*=d;b*=d;X.width=c;X.height=b}N.qr(c,b,c/a,k("x"),k("y"));w(Z.Ag(),0);G.fA(X.width,X.height)};a.set_fps_callback=function(a){h=a};a.clear_fps_callback=function(){h=function(){}};a.set_on_before_render_callback=function(a){e.error("set_on_before_render_callback() deprecated, use set_render_callback() instead");c=a};a.set_render_callback=function(a){c=a};a.clear_on_before_render_callback=function(){e.error("clear_on_before_render_callback() deprecated, use clear_render_callback() instead");
m()};a.clear_render_callback=function(){m()};a.global_timeline=function(){return Z.Ag()};a.redraw=function(){e.error("redraw() deprecated");w(Z.Ag(),0)};a.pause=l;a.resume=function(){r()&&(ea=performance.now()/1E3,u.resume(),J.resume(),S.play(!0),E.resume())};a.is_paused=r;a.reset=function(){G.unload(0);J.reset();z=X=null;ea=ga=pa=0;h=function(){};b=function(){};c=function(){};O.length=0;ma=null;Z.reset()};a.canvas_data_url=function(a){T=a};a.get_canvas_elem=function(){return X};a.detect_mobile=function(){return x.detect_mobile()};
a.append_loop_cb=function(a){for(var b=0;b<O.length;b++)if(O[b]==a)return;O.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<O.length;b++)if(O[b]==a){O.splice(b,1);break}}};
