var b4w=function(a){var p={};a.module=p;var c={};a.register=function(a,c){if(p[a])throw Error('Module "'+a+'" already registered');p[a]=c};a.require=function(a,e){if(!p[a])throw Error('Module "'+a+'" not found');e=e||"__B4W_DEF_NS";c[e]||(c[e]=function(a){return function(b){var e=p[b];if(!e)throw Error('Module "'+b+'" not found');e.mh||(e.mh={});e.mh[a]||(e.mh[a]={},e(e.mh[a],c[a]));return e.mh[a]}}(e));return c[e](a)};a.module_check=function(a){return p[a]?!0:!1};return a}({});"object"==typeof module&&module.gl&&(GLOBAL.b4w={module:{}});b4w.module.__version=function(a){function p(){return"25.02.2015 10:28:43"}a.version=function(){return"15.02"};a.type=function(){return"RELEASE"};a.date=p;a.timestamp=function(){var a=p(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.gl&&b4w.module.__version(exports);b4w.module.__config=function(a,p){function c(){return b4w.module_check(a.Qb.Qi)}var b=p("__print"),e=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.uu=e.wa(a.context);a.p={alpha_sort:!0,alpha_sort_threshold:.1,$p:5,me:1E4,console_verbose:!1,do_not_load_resources:!1,jk:!1,Hv:1.5,Gv:10,background_color:[0,0,0,0],force_selectable:!1,all_objs_selectable:!1,wf:.01,resolution_factor:1,canvas_resolution_factor:1,ck:3,allow_cors:!1,ll:!1,
Hi:!0,show_hud_debug_info:!1,cB:!0,ue:"DEPTH",anaglyph_use:!1,Tj:!0,ei:.5,Ac:!0,glow:!0,Ae:!0,hg:!0,rg:!0,$f:!0,yg:!0,dg:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,Sr:!1,kg:!0,Wh:!0,Ca:!0,Qj:!0,water_dynamic:!0,shore_smoothing:!0,Ig:!0,Mc:1024,Vl:512,max_bones:53,Hr:!0,precision:"highp",quality:a.P_HIGH,tk:!0,gf:!1,tx:!1,Zq:!1,Ho:!1,Mr:!1,nf:!1,Fp:!1,ko:!1,Vo:!1,zC:!1,Cc:!1,allow_hidpi:!1,oj:!1,Wo:!1};a.gv=e.wa(a.p);a.hd={za:-1,$o:!1,df:1};a.controls={rx:1/120};a.kd={dir:"ASSETS=../../assets/",
mx:15,Dq:!0,Xl:!1,$k:!1};a.Lt=e.wa(a.kd);a.Qb={shaders_dir:"../../shaders/",Fy:"include/",Qi:"built_in_data",smaa_search_texture_path:"",smaa_area_texture_path:"",Zx:"./",Nq:["b4w.min.js","b4w.full.min.js","src/b4w.js","USER_DEFINED_MODULE"]};a.rb={enabled:!0,me:60,ah:""};a.Cx=e.wa(a.rb);a.ii={kj:1024,$i:384};a.gy=e.wa(a.ii);a.Ld={$z:!0,Fj:!1,Jn:!1,fo:!1,Io:!1};a.Ey=e.wa(a.Ld);a.bl={enabled:!1,hz:"MAIN_OPAQUE",gz:0,Iy:"COLOR"};a.cv=e.wa(a.bl);a.It=function(){var b=a.p,c=a.rb,e=a.ii;switch(b.quality){case a.P_ULTRA:b.ue=
"DEPTH";b.shore_smoothing=!0;b.glow=!0;b.Ae=!0;b.hg=!0;b.rg=!0;b.$f=!0;b.Tj=!0;b.ei=1;b.Ac=!0;b.kg=!0;b.Wh=!0;b.Ca=!0;b.Qj=!0;b.resolution_factor=1.75;e.kj=2048;b.ck=3;b.Hi=!0;b.jk=!1;b.max_bones=53;b.precision="highp";b.water_dynamic=!0;b.Ig=!0;b.antialiasing=!0;b.smaa=!0;b.dg=!0;b.yg=!0;b.allow_hidpi=!0;c.me=120;break;case a.P_HIGH:b.ue="DEPTH";b.shore_smoothing=!0;b.glow=!0;b.Ae=!0;b.hg=!0;b.rg=!0;b.$f=!0;b.Tj=!0;b.ei=.5;b.Ac=!0;b.kg=!0;b.Wh=!0;b.Ca=!0;b.Qj=!0;b.resolution_factor=1;e.kj=1024;b.ck=
3;b.Hi=!0;b.jk=!1;b.max_bones=53;b.precision="highp";b.water_dynamic=!0;b.Ig=!0;b.antialiasing=!0;b.smaa=!1;b.dg=!0;b.yg=!0;b.allow_hidpi=!1;c.me=60;break;case a.P_LOW:b.ue="NONE",b.shore_smoothing=!1,b.glow=!1,b.Ae=!1,b.hg=!1,b.rg=!1,b.$f=!1,b.Tj=!1,b.ei=.5,b.Ac=!1,b.kg=!1,b.Wh=!1,b.Ca=!1,b.Qj=!1,b.resolution_factor=1,e.kj=512,b.ck=2,b.Hi=!1,b.jk=!0,b.max_bones=53,b.precision="mediump",b.water_dynamic=!1,b.Ig=!1,b.antialiasing=!1,b.smaa=!1,b.dg=!1,b.yg=!1,b.allow_hidpi=!1,c.me=60}};a.set=function(c,
g){switch(c){case "all_objs_selectable":a.p.all_objs_selectable=g;break;case "allow_cors":a.p.allow_cors=g;break;case "allow_hidpi":a.p.allow_hidpi=g;break;case "alpha":a.context.alpha=g;break;case "alpha_sort":a.p.alpha_sort=g;break;case "alpha_sort_threshold":a.p.alpha_sort_threshold=g;break;case "anaglyph_use":a.p.anaglyph_use=g;break;case "animation_framerate":a.hd.za=g;break;case "antialiasing":a.p.antialiasing=g;break;case "assets_dds_available":a.kd.$k=g;break;case "assets_min50_available":a.kd.Xl=
g;break;case "background_color":a.p.background_color=g;break;case "built_in_module_name":a.Qb.Qi=g;break;case "canvas_resolution_factor":a.p.canvas_resolution_factor=g;break;case "console_verbose":a.p.console_verbose=g;break;case "context_antialias":a.context.antialias=g;break;case "do_not_load_resources":a.p.do_not_load_resources=g;break;case "force_selectable":a.p.force_selectable=g;break;case "gyro_use":a.p.oj=g;break;case "glow":a.p.glow=g;break;case "physics_enabled":a.rb.enabled=g;break;case "physics_uranium_path":a.rb.ah=
g;break;case "precision":a.p.precision=g;break;case "quality":a.p.quality=g;break;case "resolution_factor":a.p.resolution_factor=g;break;case "sfx_mix_mode":a.Ld.Fj=g;break;case "shaders_dir":a.Qb.shaders_dir=g;break;case "show_hud_debug_info":a.p.show_hud_debug_info=g;break;case "smaa":a.p.smaa=g;break;case "smaa_search_texture_path":a.Qb.smaa_search_texture_path=g;break;case "smaa_area_texture_path":a.Qb.smaa_area_texture_path=g;break;case "wireframe_debug":a.p.wireframe_debug=g;break;default:b.error("B4W config set - property unknown: "+
c)}};a.get=function(c){switch(c){case "all_objs_selectable":return a.p.all_objs_selectable;case "allow_cors":return a.p.allow_cors;case "allow_hidpi":return a.p.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.p.alpha_sort;case "alpha_sort_threshold":return a.p.alpha_sort_threshold;case "anaglyph_use":return a.p.anaglyph_use;case "animation_framerate":return a.hd.za;case "antialiasing":return a.p.antialiasing;case "assets_dds_available":return a.kd.$k;case "assets_min50_available":return a.kd.Xl;
case "background_color":return a.p.background_color;case "built_in_module_name":return a.Qb.Qi;case "canvas_resolution_factor":return a.p.canvas_resolution_factor;case "console_verbose":return a.p.console_verbose;case "context_antialias":return a.context.antialias;case "do_not_load_resources":return a.p.do_not_load_resources;case "force_selectable":return a.p.force_selectable;case "gyro_use":return a.p.oj;case "glow":return a.p.glow;case "physics_enabled":return a.rb.enabled;case "physics_uranium_path":return a.rb.ah;
case "precision":return a.p.precision;case "quality":return a.p.quality;case "resolution_factor":return a.p.resolution_factor;case "sfx_mix_mode":return a.Ld.Fj;case "shaders_dir":return a.Qb.shaders_dir;case "show_hud_debug_info":return a.p.show_hud_debug_info;case "smaa":return a.p.smaa;case "smaa_search_texture_path":return a.Qb.smaa_search_texture_path;case "smaa_area_texture_path":return a.Qb.smaa_area_texture_path;case "wireframe_debug":return a.p.wireframe_debug;default:b.error("B4W config get - property unknown: "+
c)}};a.reset=function(){a.context=e.wa(a.uu);a.p=e.wa(a.gv);a.kd=e.wa(a.Lt);a.rb=e.wa(a.Cx);a.ii=e.wa(a.gy);a.Ld=e.wa(a.Ey);a.bl=e.wa(a.cv)};a.Jp=c;a.wy=function(){var d=a.Qb,g=a.rb;if(c())d.smaa_search_texture_path="smaa_search_texture.png",d.smaa_area_texture_path="smaa_area_texture.png";else if(""==d.smaa_search_texture_path||""==d.smaa_area_texture_path||""==g.ah){for(var e=null,f=document.getElementsByTagName("script"),m=0;m<f.length;m++){for(var h=f[m].src,r=0;r<d.Nq.length;r++)if(0<=h.indexOf(d.Nq[r])){e=
h;break}if(null!==e)break}e||(b.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),e=document.location.href);f=e.indexOf("?");0<=f&&(e=e.substring(0,f));e=e.substring(0,e.lastIndexOf("/")+1)+d.Zx;g.ah=g.ah||e+"uranium.js";d.smaa_search_texture_path=d.smaa_search_texture_path||e+"smaa_search_texture.png";d.smaa_area_texture_path=d.smaa_area_texture_path||e+"smaa_area_texture.png"}};a.get_std_assets_path=function(){return a.kd.dir.replace("ASSETS=","")}};b4w.module.__boundings=function(a,p){function c(a,b){for(var c=a[0],d=a[1],q=a[2],f=a[0],l=a[1],e=a[2],g=3;g<a.length;g+=3)var n=a[g],h=a[g+1],k=a[g+2],c=Math.max(c,n),d=Math.max(d,h),q=Math.max(q,k),f=Math.min(f,n),l=Math.min(l,h),e=Math.min(e,k);b.max_x=c;b.max_y=d;b.max_z=q;b.min_x=f;b.min_y=l;b.min_z=e;return b}function b(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,q=a.max_z,f=a.min_x,l=a.min_y,e=a.min_z;b[0]=f;b[1]=l;b[2]=e;b[3]=c;b[4]=l;b[5]=e;b[6]=c;b[7]=d;b[8]=e;b[9]=f;b[10]=
d;b[11]=e;b[12]=f;b[13]=l;b[14]=q;b[15]=c;b[16]=l;b[17]=q;b[18]=c;b[19]=d;b[20]=q;b[21]=f;b[22]=d;b[23]=q;return b}function e(a,b,c){f.add(b,c,a.A);f.scale(a.A,.5,a.A);a.sa=f.distance(a.A,b);return a}var d=p("__geometry"),g=p("__util"),k=p("__tsr"),f=p("vec3"),m=new Float32Array(24),h=new Float32Array(3),r=new Float32Array(3),n=new Float32Array(3);a.uo=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.JA=function(){return{max_x:1E12,min_x:-1E12,
max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.cd=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.No=function(a,b){var c=a.max_y,d=a.max_z,q=a.min_x,f=a.min_y,l=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,q);a.min_y=Math.min(b.min_y,f);a.min_z=Math.min(b.min_z,l)};a.Rt=c;a.Gk=function(d,f,e){e||(e=a.cd());d=b(d,m);g.pe(d,f,d);return c(d,e)};a.xv=b;a.yC=function(b,c,d){d||
(d=a.cd());var f=c.min_x,q=c.max_x,e=c.min_y,l=c.max_y,g=c.min_z;c=c.max_z;if(f>=b.max_x||q<=b.min_x||e>=b.max_y||l<=b.min_y||g>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,f);d.max_x=Math.min(b.max_x,q);d.min_y=Math.max(b.min_y,e);d.max_y=Math.min(b.max_y,l);d.min_z=Math.max(b.min_z,g);d.max_z=Math.min(b.max_z,c);return d};a.CC=function(b,c,d){d||(d=a.cd());var f=b.max_x-b.min_x,q=b.max_y-b.min_y,e=b.max_z-b.min_z;d.min_x=
b.min_x-.5*(c-1)*f;d.max_x=b.max_x+.5*(c-1)*f;d.min_y=b.min_y-.5*(c-1)*q;d.max_y=b.max_y+.5*(c-1)*q;d.min_z=b.min_z-.5*(c-1)*e;d.max_z=b.max_z+.5*(c-1)*e;return d};a.Ik=function(b,c,d){d||(d=a.xi());f.transformMat4(b.A,c,d.A);d.sa=b.sa*g.Bj(c);return d};a.Hk=function(a,b,c){c||(c={Pe:new Float32Array(3),Qe:new Float32Array(3),Re:new Float32Array(3),A:new Float32Array([0,0,0])});k.oi(a.A,b,c.A);f.copy(a.Pe,c.Pe);f.copy(a.Qe,c.Qe);f.copy(a.Re,c.Re);k.dk(c.Pe,b,c.Pe);k.dk(c.Qe,b,c.Qe);k.dk(c.Re,b,c.Re);
return c};a.Uk=function(a,b){return{sa:a,A:new Float32Array(b)}};a.xi=function(){return{A:new Float32Array([0,0,0]),sa:0}};a.Tk=function(a,b,c,d){return{Pe:new Float32Array(a),Qe:new Float32Array(b),Re:new Float32Array(c),A:new Float32Array([d[0],d[1],d[2]])}};a.Tt=function(){return{A:new Float32Array([0,0,0]),sa:1E12}};a.uv=function(a,b){var c=f.subtract(b.A,a.A,f.create());0==f.length(c)&&f.set(1,0,0,c);var d=f.normalize(c,f.create()),c=f.scale(d,a.sa,f.create());f.add(c,a.A,c);var q=f.scale(d,
-a.sa,f.create());f.add(q,a.A,q);var e=f.scale(d,b.sa,f.create());f.add(e,b.A,e);var l=f.scale(d,-b.sa,f.create());f.add(l,b.A,l);c=[c,q,e,l];d=f.normalize(d,f.create());q=c[0];e=c[0];for(l=1;l<c.length;l++){var g=f.dot(c[l],d);g<f.dot(q,d)&&(q=c[l]);g>f.dot(e,d)&&(e=c[l])}d=[q,e];c=d[0];d=d[1];a.A=f.scale(f.add(c,d,f.create()),.5,f.create());a.sa=f.length(f.subtract(d,c,f.create()))/2};a.vo=function(a,b){var c=b.max_y,d=b.min_y,q=Math.max(0,c-d-2*a);return{sa:a,height:q,A:new Float32Array([0,(c+
d)/2,0])}};a.xo=function(a,b){var c=b.max_y,d=b.min_y,q=Math.max(0,c-d);return{sa:a,height:q,A:new Float32Array([0,(c+d)/2,0])}};a.wo=function(a,b){var c=b.max_y,d=b.min_y,q=Math.max(0,c-d);return{sa:a,height:q,A:new Float32Array([0,(c+d)/2,0])}};a.MA=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.Ox=function(a){for(var b=0,c=0,d=0,q=0,f=0,l=0,e=0,g=0,n=0;n<a.submeshes.length;n++){var h=a.submeshes[n];if(h.position.length){b=
q=h.position[0];c=f=h.position[1];d=l=h.position[2];break}}for(n=0;n<a.submeshes.length;n++)for(var h=a.submeshes[n],h=h.position,k=0;k<h.length/3;k++)var m=h[3*k],y=h[3*k+1],H=h[3*k+2],b=Math.max(m,b),c=Math.max(y,c),d=Math.max(H,d),q=Math.min(m,q),f=Math.min(y,f),l=Math.min(H,l),e=Math.max(Math.sqrt(m*m+y*y+H*H),e),g=Math.max(Math.sqrt(m*m+H*H),g);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=q;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=f;a.b4w_bounding_box.max_z=d;a.b4w_bounding_box.min_z=
l;a.b4w_bounding_sphere_radius=e;a.b4w_bounding_cylinder_radius=g};a.qw=function(b){var c=b.subarray(0,3),g=b.subarray(6,9),k=b.subarray(12,15),q=b.subarray(18,21);b=f.subtract(g,c,h);f.normalize(b,b);var m=d.tw(c,g,k,r),m=f.cross(m,b,m);f.normalize(m,m);var l=f.create(),z=f.create();f.subtract(g,c,n);z[0]=f.dot(n,b);z[1]=f.dot(n,m);g=f.create();f.subtract(k,c,n);g[0]=f.dot(n,b);g[1]=f.dot(n,m);k=f.create();f.subtract(q,c,n);k[0]=f.dot(n,b);k[1]=f.dot(n,m);q=a.xi();k=[l,z,g,k];l=e(q,k[0],k[1]);for(q=
2;q<k.length;q++)if(f.distance(l.A,k[q])>l.sa){for(var A=l,l=k,z=k[q],g=q-1,A=e(A,z,l[0]),G=1;G<=g;G++)if(f.distance(A.A,l[G])>A.sa){for(var t=A,A=l,B=z,O=l[G],y=G-1,t=e(t,B,O),H=0;H<=y;H++)if(f.distance(t.A,A[H])>t.sa){var L=B,Z=O,J=A[H],F=f.subtract(Z,J,n),F=f.squaredLength(F),U=f.subtract(L,J,n),K=f.squaredLength(U),U=f.subtract(L,Z,n),S=f.squaredLength(U),U=F*(K+S-F),p=K*(S+F-K),F=S*(F+K-S),K=U+p+F;f.copy(L,t.A);f.scale(t.A,U/K,t.A);f.scaleAndAdd(t.A,Z,p/K,t.A);f.scaleAndAdd(t.A,J,F/K,t.A);t.sa=
f.distance(t.A,L)}A=t}l=A}q=l;b=f.scale(b,q.A[0],n);f.scaleAndAdd(b,m,q.A[1],b);f.add(b,c,q.A);return q}};b4w.module.__compat=function(a,p){function c(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function b(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function e(){return!window.ActiveXObject&&"ActiveXObject"in window}var d=p("__config"),g=p("__extensions"),k=p("__print"),
f=p("__util");a.qy=function(a){var h=d.hd,r=d.p,n=d.context,x=d.ii,v=d.Ld;r.Mc=a.getParameter(a.MAX_TEXTURE_SIZE);r.Vl=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var u=Boolean(g.nw());c("Firefox")&&d.Jp()&&(k.warn("Firefox detected for single HTML version, disable video textures."),r.Vo=!0);c("Firefox/28.0")&&(c("Linux")||c("Macintosh"))&&(k.warn("Firefox 28 detected, applying depth hack"),u=!1);c("iPad")||c("iPhone")?(k.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
n.alpha||(r.background_color[3]=1),r.Mr=!0,r.smaa=!1,r.Ae=!1,r.precision="highp",r.Fp=!0):c("Mac OS X")&&c("Safari")&&!c("Chrome")&&(k.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),v.Jn=!0,v.fo=!0);c("Windows")&&(c("Chrome/40")||c("Firefox/33")||c("Firefox/34")||c("Firefox/35")||c("Firefox/36"))&&(k.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),r.ko=!0);b()&&(k.warn("Mobile detected, applying glsl loops unroll hack, applying various hacks for video textures."),
r.gf=!0,r.nf=!0,c("iPad")||c("iPhone")||(k.warn("Mobile (not iOS) detected, disable playback rate for video textures."),v.Io=!0));(c("Firefox/35.0")||c("Firefox/36.0"))&&c("Windows")&&(k.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),r.Wo=!0);if(c("iPhone")||e())k.warn("iPhone or IE11 detected. Enable sequential video fallback for video textures."),r.Cc=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(k.warn("Not enough varyings, disable shadows on blend objects"),r.Ho=!0);if(n=
g.mp())c("Macintosh")&&-1<a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(k.warn("OS X / Intel HD 3000 detected, applying depth and glsl loops unroll hacks"),u=!1,r.gf=!0),-1<a.getParameter(n.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(k.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),u=!1,h.$o=!0),-1<a.getParameter(n.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&
(k.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),r.precision="highp",r.ue="NONE"),-1<a.getParameter(n.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(k.warn("ARM Mali-T760 detected, disable SSAO."),r.Ae=!1),-1<a.getParameter(n.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&-1<a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(k.warn("Qualcomm Adreno detected, applying shader constants hack."),r.Zq=!0,-1<
a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(k.warn('Qualcomm Adreno305 detected, set "highp" precision.'),r.precision="highp"),-1<a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(k.warn('Qualcomm Adreno330 detected, set "highp" precision.'),r.precision="highp")),-1<a.getParameter(n.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&(k.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),
r.ll=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(k.warn("Vertex textures are not allowed. Disabling vertex textures"),r.tk=!1);r.allow_hidpi&&1<window.devicePixelRatio&&(k.log("%cENABLE HIDPI MODE","color: #00a"),r.resolution_factor=1,r.smaa=!1);u||(r.kg=!1,r.Wh=!1,r.Ca=!1,r.water_dynamic=!1,r.shore_smoothing=!1,r.Ig=!1,r.Ac=!1,r.smaa=!1);r.Hr=Boolean(g.np());r.bj=u;h=f.clamp(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),128,Infinity);r.max_bones=f.trunc((h-50)/4);r.kC=f.trunc((h-50)/
2);0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(r.precision="mediump");e()&&(k.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),x.$i=512);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(k.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),r.ll=!0)};a.detect_mobile=b;a.Gt=function(){c("Firefox/35.0")&&c("Windows")&&(k.warn("Windows/Firefox 35 detected, forcing context's alpha"),d.context.alpha=!0)};
a.Hl=e};b4w.module.__constraints=function(a,p){function c(a){var b={};b.type=a;return b}function b(a,b){a.jb&&a.jb.S&&e(a.jb.S,a);if(b.S){var c=b.S;if(-1==c.Sd.indexOf(a))c.Sd.push(a);else throw"Descendant object override is forbidden";}a.jb=b}function e(a,b){var c=a.Sd.indexOf(b);if(-1!=c)a.Sd.splice(c,1);else throw"No descendant object";}function d(a,b,c){switch(b.type){case 1:var d=a.d.quat,e=b.S.d.K;c=b.S.d.quat;b.re?(v.copy(b.re,d),v.multiply(c,d,d)):v.copy(c,d);x.transformMat4(b.offset,e,a.d.g);a.d.scale=
b.Uj*b.S.d.scale;break;case 9:var F=a.d.g,d=a.d.quat,e=b.S.d.K;c=b.S.d.quat;v.multiply(v.invert(b.Hf,b.Hf),d,d);v.multiply(c,d,d);x.transformMat4(b.offset,e,F);v.copy(c,b.Hf);break;case 10:F=a.d.g;d=a.d.quat;e=b.S.d.K;c=b.S.d.quat;v.multiply(v.invert(b.Hf,b.Hf),d,d);v.multiply(c,d,d);x.transformMat4(b.offset,e,F);v.copy(c,b.Hf);var d=a.d.quat,F=b.S.d.quat,n=x.transformQuat(r.AXIS_Y,d,E),e=v.invert(F,z),t=x.transformQuat(n,e,q),A=D;A[0]=t[0];A[1]=0;A[2]=t[2];var p=x.length(A),e=-A[2]/p,e=Math.acos(e)*
r.sign(A[0]),p=p/x.length(t),p=Math.acos(p)*r.sign(t[1]),t=!1;e<-b.eo&&(e=-b.eo,t=!0);e>b.ho&&(e=b.ho,t=!0);p<-b.io&&(p=-b.io,t=!0);p>b.co&&(p=b.co,t=!0);t&&(b=Math.sin(p),p=Math.cos(p),t=Math.sin(e),e=Math.cos(e),A=q,A[0]=p*t,A[1]=b,A[2]=-p*e,x.transformQuat(A,F,A),b=v.rotationTo(n,A,z),v.multiply(b,d,d),v.normalize(d,d));"CAMERA"==a.d.type&&(b=x.transformQuat(r.AXIS_Y,c,q),f(a,b));break;case 12:F=a.d.g;d=a.d.quat;e=b.S.d.K;p=b.S.d.g;a=b.Ky;t=E;n=z;x.transformMat4(b.offset,e,t);r.smooth_v(t,F,c,
a,F);b=E;x.sub(p,F,b);x.normalize(b,b);A=d;F=B;e=F.subarray(0,3);p=F.subarray(3,6);t=F.subarray(6,9);x.copy(b,p);x.negate(p,p);x.normalize(p,p);Boolean(.999999<Math.abs(x.dot(b,r.AXIS_Y)))?(b=u.fromQuat(v.normalize(A,n),O),x.copy(b.subarray(0,3),e)):x.cross(r.AXIS_Y,p,e);x.normalize(e,e);x.cross(e,p,t);x.normalize(t,t);v.fromMat3(F,n);v.normalize(n,n);r.er(n,d,c,.16*a,d);break;case 2:d=a.d.quat;F=l;c=z;m(b.S,b.Yt,!0,F,c);b.re?(v.copy(b.re,d),v.multiply(c,d,d)):v.copy(c,d);a.d.scale=b.Uj*F[3];r.oi(b.offset,
F[3],c,F,a.d.g);break;case 3:F=a.d.g;d=a.d.quat;c=b.S.d.g;g(F,d,c);"CAMERA"==a.d.type&&f(a,r.AXIS_Y);break;case 4:F=a.d.g;d=a.d.quat;c=b.target;g(F,d,c);"CAMERA"==a.d.type&&f(a,r.AXIS_Y);break;case 5:F=a.d.g;d=a.d.quat;c=b.S.d.g;k(F,d,c,b.Cf);d=x.dist(F,c);if(b=d>b.Uh?d-b.Uh:d<b.Cf?d-b.Cf:0)x.sub(c,F,E),x.normalize(E,E),x.scale(E,b,E),x.add(F,E,F);"CAMERA"==a.d.type&&f(a,r.AXIS_Y);break;case 6:F=a.d.g;d=a.d.quat;c=b.target;k(F,d,c,b.Cf);d=x.dist(F,c);if(b=d>b.Uh?d-b.Uh:d<b.Cf?d-b.Cf:0)x.sub(c,F,E),
x.normalize(E,E),x.scale(E,b,E),x.add(F,E,F);"CAMERA"==a.d.type&&f(a,r.AXIS_Y);break;case 7:e=b.S.d.K;x.transformMat4(b.offset,e,a.d.g);break;case 8:p=b.S.d.g;F=a.d.g;x.add(p,b.offset,F);break;case 13:d=a.d.quat;e=b.S.d.K;c=b.S.d.quat;b.re?(v.copy(b.re,d),v.multiply(c,d,d)):v.copy(c,d);x.transformMat4(b.offset,e,a.d.g);break;case 11:c=b.S.d,c=h.eg(c.g,c.scale,c.quat,G),h.multiply(c,b.Br,c),F=a.d.g,F[0]=c[0],F[1]=c[1],F[2]=c[2],a.d.scale=c[3],d=a.d.quat,d[0]=c[4],d[1]=c[5],d[2]=c[6],d[3]=c[7]}}function g(a,
b,c){var d=E;r.quat_to_dir(b,r.AXIS_MY,d);x.normalize(d,d);var f=q;x.subtract(c,a,f);x.normalize(f,f);a=l;r.Rq(d,f,a);v.multiply(a,b,b)}function k(a,b,c,d){var f=E;r.quat_to_dir(b,r.AXIS_MY,f);x.normalize(f,f);var e=q;x.subtract(c,a,e);a=x.length(e);x.normalize(e,e);a>d-.001&&(d=r.Rq(f,e,l),v.multiply(d,b,b),v.normalize(b,b))}function f(a,b){var c=a.d,d=c.quat,f=r.quat_to_dir(c.quat,r.AXIS_Y,E);x.normalize(f,f);if(.999999<Math.abs(x.dot(b,f)))f=v.identity(z);else{var l=x.cross(b,f,q);x.normalize(l,
l);c.O==n.MS_TARGET_CONTROLS?c.bk&&(l[0]*=-1,l[1]*=-1,l[2]*=-1):0<r.quat_to_dir(c.quat,r.AXIS_Z,D)[1]&&(l[0]*=-1,l[1]*=-1,l[2]*=-1);c=r.quat_to_dir(c.quat,r.AXIS_X,D);x.normalize(c,c);var e=r.clamp(x.dot(c,l),-1,1),g=Math.acos(e),f=-.999999>=e?v.setAxisAngle(f,g,z):v.rotationTo(c,l,z);v.normalize(f,f)}v.multiply(f,d,d)}function m(a,b,c,d,q){var f=a.d,e=f.cf,g=f.nc[b];b=g.wh;a=a.pose.bones[g.jm];var g=a.un,n=l,k=f.kc,r=f.jc,m=f.cc,O=f.bc,u=k[4*b+1],B=k[4*b+2],x=k[4*b+3],D=r[4*b+1],E=r[4*b+2],N=r[4*
b+3];n[0]=(1-e)*k[4*b]+e*r[4*b];n[1]=(1-e)*u+e*D;n[2]=(1-e)*B+e*E;n[3]=(1-e)*x+e*N;k=z;r=A;k[0]=m[4*b];k[1]=m[4*b+1];k[2]=m[4*b+2];k[3]=m[4*b+3];r[0]=O[4*b];r[1]=O[4*b+1];r[2]=O[4*b+2];r[3]=O[4*b+3];v.slerp(k,r,e,k);e=G;h.Ay(n,e);h.um(k,e);c?(c=t,h.translate(g,a.mt,c),h.multiply(e,c,e)):h.multiply(e,g,e);h.multiply(f.Pd,e,e);d[0]=e[0];d[1]=e[1];d[2]=e[2];d[3]=e[3];q&&(q[0]=e[4],q[1]=e[5],q[2]=e[6],q[3]=e[7])}var h=p("__tsr"),r=p("__util"),n=p("__camera"),x=p("vec3"),v=p("quat"),u=p("mat3");p("mat4");
a.lA=1;a.kA=2;a.oA=3;a.pA=4;a.fA=5;a.gA=6;a.mA=7;a.eA=8;a.jA=9;a.iA=10;a.dd=11;a.hA=12;a.nA=13;var E=new Float32Array(3),q=new Float32Array(3),D=new Float32Array(3),l=new Float32Array(4),z=new Float32Array(4),A=new Float32Array(4),G=new Float32Array(16),t=new Float32Array(16),B=new Float32Array(9),O=new Float32Array(9),G=new Float32Array(8);a.Vr=9*Math.PI/10;a.Cn=function(a,q,f,l,e){var g=c(1);g.S=q;g.offset=new Float32Array(f);g.re=l?new Float32Array(l):null;g.Uj=e;b(a,g);d(a,g,0)};a.Bn=function(a,
q,f,l,e,g){var n=c(2);n.S=q;n.Yt=f;n.offset=new Float32Array(l);n.re=e?new Float32Array(e):null;n.Uj=g;b(a,n);d(a,n,0)};a.zt=function(a,q,f,l){var e=c(9),g=a.d.quat,n=q.d.quat;e.S=q;e.offset=new Float32Array(f);e.Hf=new Float32Array(n);l&&(v.copy(l,g),v.multiply(n,g,g));b(a,e);d(a,e,0)};a.yt=function(a,q,f,e,l,g,n,h){var k=c(10),r=a.d.quat,m=q.d.quat;k.S=q;k.offset=new Float32Array(f);k.Hf=new Float32Array(m);k.eo=l;k.ho=g;k.io=n;k.co=h;e&&(v.copy(e,r),v.multiply(m,r,r));b(a,k);d(a,k,0)};a.xt=function(a,
q,f,e){var l=c(12);l.S=q;l.offset=new Float32Array(f);l.Ky=e;b(a,l);d(a,l,0)};a.Bt=function(a,q,f,l){var e=c(13);e.S=q;e.offset=new Float32Array(f);e.Uj=1;e.re=l?new Float32Array(l):null;b(a,e);d(a,e,0)};a.Dt=function(a,q){var f=c(3);f.S=q;b(a,f);d(a,f,0)};a.Et=function(a,q){var f=c(4);f.target=new Float32Array(q);b(a,f);d(a,f,0)};a.ut=function(a,q,f,e){var l=c(5);l.S=q;l.Cf=f;l.Uh=e;b(a,l);d(a,l,0)};a.vt=function(a,q,f,l){var e=c(6);e.target=new Float32Array(q);e.Cf=f;e.Uh=l;b(a,e);d(a,e,0)};a.At=
function(a,q,f){var e=c(7);e.S=q;e.offset=new Float32Array(f);b(a,e);d(a,e,0)};a.tt=function(a,q,f){var e=c(8);e.S=q;e.offset=new Float32Array(f);b(a,e);d(a,e,0)};a.st=function(a,q,f){var e=c(11);e.S=q;e.Br=new Float32Array(f);b(a,e);d(a,e,0)};a.yz=function(a,b){a.jb&&d(a,a.jb,b)};a.ay=g;a.by=k;a.correct_up=f;a.remove=function(a){a.jb.S&&e(a.jb.S,a);a.jb=null};a.Bd=function(a){return a.jb?a.jb.type:null};a.EB=function(a){return a.jb&&a.jb.S?a.jb.S:null};a.Ad=function(a){return a.jb&&11==a.jb.type?
a.jb.Br:null};a.gw=m};b4w.module.__controls=function(a,p){function c(a){return{type:a,value:0,X:null,Sl:null,Rl:null,Aj:null,xc:!1,key:0,Yb:"",Pk:null,$l:!1,Ok:function(){},Nk:null,lo:function(){},Uc:null,Em:new Float32Array(3),fl:new Float32Array(3),Ql:!1,Jq:function(){},axis:"",ic:0,Zg:new Float32Array(3),Rj:new Float32Array(4),threshold:0,Hq:new Float32Array(4),Ki:0,Ji:0,Qq:0,Li:0,rc:0,repeat:!1,Kn:!1,nj:0,mj:0,lj:0,Bl:0,Al:0,zl:0}}function b(a,b){var s;if(a.Aj){s=a.Sl;for(var c=a.Rl,y=0;y<s.length;y++)c[y]=s[y].value;
s=a.Aj(c)}else s=!1;s||(a.value=Number(b))}function e(a){a=H.indexOf(a);-1<a?H.splice(a,1):D.error("Wrong object")}function d(a,b){for(var s=0,c=0;c<b.length;c++)for(var y=b[c].Me,d=0;d<y.length;d++)for(var q=y[d].Rc,f=0;f<q.length;f++)q[f]===a&&s++;return s}function g(a,b){switch(a.type){case 80:l.remove_collision_test(a.Pk,a.Yb,a.Ok);a.xc=!0;break;case 90:l.clear_collision_impulse_test(a.Nk);a.xc=!0;break;case 100:l.remove_ray_test(a.Uc,a.Yb,a.Em,a.fl,a.Ql);a.xc=!0;break;case 130:a.xc=!0}var s=
b.indexOf(a);-1<s&&b.splice(s,1)}function k(a){for(var s=0;s<L.length;s++){var c=L[s];20==c.type&&a.keyCode==c.key&&b(c,1)}I&&a.preventDefault();R&&R(a)}function f(a){for(var s=0;s<L.length;s++){var c=L[s];20==c.type&&0==a.keyCode&&16==c.key&&b(c,0);20==c.type&&a.keyCode==c.key&&b(c,0)}I&&a.preventDefault();R&&R(a)}function m(a){var c=!1,y=null;F=a.clientX;U=a.clientY;for(var d=0;d<L.length;d++){var q=L[d];50==q.type&&(b(q,1),q.X=a.which);160==q.type&&(c||(y=z.pick_object(a.clientX,a.clientY),c=!0),
q.value=y==q.Uc?1:0)}Y&&a.preventDefault();s&&s(a)}function h(a){for(var c=0;c<L.length;c++){var y=L[c];50==y.type&&b(y,0);160==y.type&&y.Kn&&(y.value=0)}Y&&!M&&a.preventDefault();s&&s(a)}function r(a){var c=a.clientX,y=a.clientY;F=c;U=y;for(var d=c-K,q=y-S,f=Math.sqrt(d*d+q*q),e=0;e<L.length;e++){var l=L[e];if(40===l.type)switch(l.axis){case "X":b(l,d);l.X=c;break;case "Y":b(l,q);l.X=y;break;case "XY":b(l,f),l.X[0]=c,l.X[1]=y}}Y&&!M&&a.preventDefault();s&&s(a)}function n(a){var s=a.wheelDelta||-40*
a.detail,s=s*O.rx;J+=s;for(s=0;s<L.length;s++){var c=L[s];30===c.type&&b(c,J)}ga&&a.preventDefault();V&&V(a)}function x(a){var b=a.targetTouches;if(1==b.length){for(var s=b[0],b=s.pageX,s=s.pageY,c=!1,y=null,d=0;d<L.length;d++){var q=L[d];160==q.type&&(c||(y=z.pick_object(b,s),c=!0),q.value=y==q.Uc)}P[0]=b;P[1]=-1;ca[0]=s;ca[1]=-1}else 1<b.length&&(w=fa=E(b),P[0]=b[0].pageX,P[1]=b[1].pageX,ca[0]=b[0].pageY,ca[1]=b[1].pageY);T.set(P);ba.set(ca);ma&&ma(a)}function v(s){var c=s.targetTouches;if(0!==
c.length){if(1===c.length){T[0]=c[0].pageX;T[1]=-1;ba[0]=c[0].pageY;ba[1]=-1;var c=T[0]-P[0],y=ba[0]-ca[0],d=Math.sqrt(c*c+y*y);if(-1!=P[1]&&-1!=ca[1]){var q=T[0]-P[1],f=ba[0]-ca[1],e=Math.sqrt(q*q+f*f);e<d&&(c=q,y=f,d=e)}for(e=0;e<L.length;e++){var l=L[e];if(60===l.type)switch(l.X=a.PL_SINGLE_TOUCH_MOVE,l.axis){case "X":b(l,c);break;case "Y":b(l,y);break;case "XY":b(l,d)}}}else if(1<c.length){T[0]=c[0].pageX;T[1]=c[1].pageX;ba[0]=c[0].pageY;ba[1]=c[1].pageY;w=E(c);d=w-fa;q=X;q[0]=(T[0]+T[1])/2;q[1]=
(ba[0]+ba[1])/2;f=aa;f[0]=(P[0]+P[1])/2;f[1]=(ca[0]+ca[1])/2;var M,c=q[0],y=q[1],e=f[0],l=f[1];M=Math.sqrt((c-e)*(c-e)+(y-l)*(y-l));for(e=0;e<L.length;e++)if(l=L[e],70===l.type&&Math.abs(M)<Math.abs(d)&&(l.X=a.PL_MULTITOUCH_MOVE_ZOOM,b(l,d)),60===l.type&&Math.abs(M)>Math.abs(d))switch(l.X=a.PL_MULTITOUCH_MOVE_PAN,l.axis){case "X":c=q[0]-f[0];b(l,c);break;case "Y":y=q[1]-f[1];b(l,y);break;case "XY":b(l,M)}}qa&&s.preventDefault();ma&&ma(s)}}function u(a){for(var s=0;s<L.length;s++){var c=L[s];if(170==
c.type||180==c.type)c.mj=a.beta,c.nj=a.gamma,c.lj=a.alpha,c.value||(c.Bl=a.gamma,c.Al=a.beta,c.zl=a.alpha,b(c,1))}}function E(a){var b=a[0],s=a[1];a=b.pageX;var b=b.pageY,c=s.pageX,s=s.pageY;return Math.sqrt((a-c)*(a-c)+(b-s)*(b-s))}var q=p("__config"),D=p("__print"),l=p("__physics"),z=p("__scenes"),A=p("__time"),G=p("__util"),t=p("vec3"),B=p("quat"),O=q.controls,y=q.p,H=[],L=[],Z={},J=0,F=0,U=0,K=0,S=0,T=new Float32Array(2),ba=new Float32Array(2),P=new Float32Array(2),ca=new Float32Array(2),X=new Float32Array(2),
aa=new Float32Array(2),w=0,fa=0,ja=!1,N=0,I=!1,Y=!1,ga=!1,qa=!1,M=!1,R=null,s=null,V=null,ma=null;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.update=function(s,c){for(var y=0;y<L.length;y++){var d=L[y],q=s,f=c;if(f)switch(d.type){case 110:var e=d.Uc,l=e.d.g,e=e.d.quat,M=t.dist(d.Zg,l),g=d.Hq;B.invert(d.Rj,g);B.multiply(e,g,g);B.normalize(g,g);g=Math.abs(2*Math.acos(g[3]));M/=f;d.Ki=G.smooth(M,d.Ki,
f,.3);d.X[0]=M;M=g/f;d.Ji=G.smooth(M,d.Ji,f,.3);d.X[1]=M;d.Ki>=d.threshold||d.Ji>=d.Qq?b(d,1):b(d,0);t.copy(l,d.Zg);B.copy(e,d.Rj);d.ic=q;break;case 120:e=d.Uc;l=e.d.g;e=Math.abs(l[1]-d.Zg[1])/f;d.Li=G.smooth(e,d.Li,f,.3);d.X=e;d.Li>=d.threshold?b(d,1):b(d,0);t.copy(l,d.Zg);d.ic=q;break;case 130:!d.xc&&0<=d.rc&&q-d.ic>=d.rc&&(b(d,1),d.repeat?d.ic=q:d.rc=-d.rc);break;case 140:d.ic||(d.ic=q);b(d,q-d.ic);d.ic=q;break;case 150:b(d,q);break;case 170:d.X[0]=Math.PI*(d.nj-d.Bl)/180;d.X[1]=Math.PI*(d.mj-
d.Al)/180;d.X[2]=Math.PI*(d.lj-d.zl)/180;d.Bl=d.nj;d.Al=d.mj;d.zl=d.lj;break;case 180:d.X[0]=Math.PI*d.nj/180,d.X[1]=Math.PI*d.mj/180,d.X[2]=Math.PI*d.lj/180}}for(y=0;y<H.length;y++)for(f=H[y],d=f.Me,q=0;q<d.length;q++)if(l=d[q],l.Er!=N){l.Er=N;for(var e=l,M=e.Rc,g=e.ly,Y=0;Y<M.length;Y++)g[Y]=M[Y].value;var e=e.gx(g),M=l,g=M.Qp,V=Y=void 0;switch(M.type){case a.CT_CONTINUOUS:e?V=Y=1:1==g?V=Y=-1:Y=0;break;case a.CT_TRIGGER:e&&-1==g?V=Y=1:e||1!=g?Y=0:V=Y=-1;break;case a.CT_SHOT:e&&-1==g?V=Y=1:e||1!=
g?Y=0:(Y=0,V=-1);break;case a.CT_LEVEL:Y=M.Pp!=e?1:0;break;default:G.fa("Wrong sensor manifold type: "+M.type)}V&&(M.Qp=V);if(M=Y)if(g=f==Z?null:f,ja=!1,l.callback(g,l.id,M,l.bu),l.Pp=e,ja){y=-1;break}}for(y=0;y<H.length;y++)for(f=H[y],d=f.Me,q=0;q<d.length;q++)for(l=d[q],f=l.Rc,l=0;l<f.length;l++)switch(e=f[l],e.type){case 30:b(e,0);break;case 40:b(e,0);break;case 60:b(e,0);break;case 70:b(e,0);break;case 130:b(e,0)}J=0;K=F;S=U;P.set(T);ca.set(ba);fa=w;N++};a.create_custom_sensor=function(a){var s=
c(10);b(s,a);return s};a.create_keyboard_sensor=function(a){var b=c(20);b.key=a;return b};a.create_collision_sensor=function(a,s,d){if(!a||!a.l)return D.error("Wrong collision object"),null;var y=c(80);y.Pk=a;y.Yb=s||"ANY";y.$l=d;y.Ok=function(a,s){b(y,a);a&&s&&d&&(y.X=y.X||new Float32Array(3),y.X[0]=s[0],y.X[1]=s[1],y.X[2]=s[2])};y.xc=!0;return y};a.create_collision_impulse_sensor=function(a){if(!a||!a.l)return D.error("Wrong collision impulse object"),null;var s=c(90);s.Nk=a;s.lo=function(a){b(s,
a)};s.xc=!0;return s};a.create_ray_sensor=function(a,s,d,y,q){if(!a)return D.error("Wrong collision object"),null;var e=c(100);e.Uc=a;e.Em=s;e.fl=d;e.Ql=y;e.Yb=q||"ANY";e.Jq=function(a,s){b(e,a);a&&(e.X=s)};e.xc=!0;return e};a.create_mouse_click_sensor=function(){return c(50)};a.create_mouse_wheel_sensor=function(){return c(30)};a.create_mouse_move_sensor=function(a){var b=c(40);b.axis=a||"XY";b.X="XY"==b.axis?new Float32Array(2):0;return b};a.create_touch_move_sensor=function(a){var b=c(60);b.axis=
a||"XY";b.X=0;return b};a.create_touch_zoom_sensor=function(){var a=c(70);a.X=0;return a};a.create_motion_sensor=function(a,b,s){if(!a)return D.error("Wrong collision object"),null;var d=c(110);d.Uc=a;var y=a.d.g;a=a.d.quat;d.Hq=new Float32Array(4);d.Zg=new Float32Array(y);d.Rj=new Float32Array(a);d.Ki=0;d.Ji=0;d.threshold=b;d.Qq=s;d.ic=0;d.X=new Float32Array([0,0]);return d};a.create_vertical_velocity_sensor=function(a,b){if(!a)return D.error("Wrong collision object"),null;var s=c(120);s.Uc=a;var d=
a.d.quat;s.Zg=new Float32Array(a.d.g);s.Rj=new Float32Array(d);s.Li=0;s.threshold=b;s.ic=0;s.X=0;return s};a.create_timer_sensor=function(a,b){var s=c(130);s.rc=a;s.repeat=b;s.xc=!0;return s};a.reset_timer_sensor=function(a,b,s,c){a=a||Z;a=a.Gc;if(!a||!a[b])return D.error("reset_timer_sensor(): wrong object"),null;b=a[b].Rc[s];if(!b)return D.error("reset_timer_sensor(): sensor not found"),null;b.ic=A.pg();b.rc=c};a.create_elapsed_sensor=function(){var a=c(140);a.ic=0;return a};a.create_gyro_delta_sensor=
function(){var a=c(170);a.X=new Float32Array(3);return a};a.create_gyro_angles_sensor=function(){var a=c(180);a.X=new Float32Array(3);return a};a.create_timeline_sensor=function(){return c(150)};a.create_selection_sensor=function(a,b){var s=c(160);s.Uc=a;s.Kn=b;return s};a.ky=b;a.get_sensor_value=function(a,b,s){a=a||Z;a=a.Gc;if(!a||!a[b])return D.error("get_sensor_value(): wrong object"),null;b=a[b].Rc[s];return b?b.value:(D.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=
function(a,b,s){a=a||Z;a=a.Gc;if(!a||!a[b])return D.error("get_sensor_payload(): wrong object"),null;b=a[b].Rc[s];return b?b.X:(D.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){H=[];L=[];Z={}};a.check_sensor_manifold=function(a,b){a=a||Z;if(!a.Gc)return!1;if(b&&a.Gc[b])return!0;if(!b)for(var s in a.Gc)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||Z;var s=a.Gc;if(s){var c=a.Me;if(b){var y=s[b];if(y){for(var q=y.Rc,f=0;f<q.length;f++)1===d(q[f],H)&&g(q[f],
L);delete s[b];y=c.indexOf(y);-1<y?c.splice(y,1):G.fa("Incorrect manifolds array");Object.getOwnPropertyNames(s).length||e(a)}}else{for(b in s){y=s[b];q=y.Rc;for(f=0;f<q.length;f++)1===d(q[f],H)&&g(q[f],L);delete s[b];y=c.indexOf(y);-1<y?c.splice(y,1):G.fa("Incorrect manifolds array")}e(a);ja=!0}}};a.create_sensor_manifold=function(a,b,s,c,y,q,e){a=a||Z;a.Gc=a.Gc||{};a.Me=a.Me||[];var f=a.Gc,M=a.Me,Y=f[b];if(Y){c=Y.Rc;for(var V=0;V<c.length;V++)1===d(c[V],H)&&g(c[V],L);Y=M.indexOf(Y);-1<Y?M.splice(Y,
1):G.fa("Incorrect manifolds array")}s={id:b,type:s,Rc:c.slice(0),gx:y,ly:Array(c.length),callback:q,bu:e,Qp:-1,Pp:0,Er:-1};f[b]=s;M.push(s);-1==H.indexOf(a)&&H.push(a);a=s.Rc;for(b=0;b<a.length;b++){f=a[b];if(f.xc){switch(f.type){case 80:l.append_collision_test(f.Pk,f.Yb,f.Ok,f.$l);break;case 90:l.apply_collision_impulse_test(f.Nk,f.lo);break;case 100:l.append_ray_test(f.Uc,f.Yb,f.Em,f.fl,f.Ql,f.Jq);break;case 130:f.ic=A.pg(),0>f.rc&&(f.rc=-f.rc)}f.xc=!1}-1==L.indexOf(f)&&L.push(f)}ja=!0};a.cl=function(a){for(var b=
0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.fv=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<H.length;a++){var b=H[a],s=b.Gc,b=b.Me,c;for(c in s)delete s[c];b.splice(0,b.length)}for(a=0;a<L.length;a++)g(L[a],L),a--;H.splice(0,H.length)};a.debug=function(){D.log(String(H.length)+" objects with manifolds",H);D.log(String(L.length)+" sensors",L);for(var a=[],b=[],s=0;s<L.length;s++){var c=L[s];80==c.type&&a.push(c);
100==c.type&&b.push(c)}D.log(String(a.length)+" collision sensors",a);D.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",k,!1);a.addEventListener("keyup",f,!1);I=b};a.register_mouse_events=function(a,b,s){if(s)var c=window;else c=a,c.addEventListener("mouseout",h,!1);a.addEventListener("mousedown",m,!1);c.addEventListener("mousemove",r,!1);c.addEventListener("mouseup",h,!1);Y=b;M=s};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",
n,!1);a.addEventListener("DOMMouseScroll",n,!1);ga=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",x,!1);a.addEventListener("touchmove",v,!1);document.addEventListener("touchstart",function(){});qa=b};a.register_device_orientation=function(){window.DeviceOrientationEvent&&y.oj&&window.addEventListener("deviceorientation",u,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",k,!1);a.removeEventListener("keyup",f,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",
m,!1);a.removeEventListener("mousemove",r,!1);a.removeEventListener("mouseout",h,!1);a.removeEventListener("mouseup",h,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",n,!1);a.removeEventListener("DOMMouseScroll",n,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",x,!1);a.removeEventListener("touchmove",v,!1);document.removeEventListener("touchstart",function(){})};a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&y.oj&&
window.removeEventListener("deviceorientation",u,!1)};a.EA=function(a){R=a};a.FA=function(a){s=a};a.HA=function(a){V=a};a.GA=function(a){ma=a}};b4w.module.__curve=function(a,p){function c(a,b,c,d,e){var r=d.length;e||(e=new Float32Array(r));for(var n=r+a,x=new Float32Array(n),v=1;v<=n-1;v++)x[v-1]=b>=c[v-1]&&b<c[v+1-1]?1:0;for(var u=2;u<=a;u++)for(v=1;v<=n-u;v++)x[v-1]=(0!=x[v-1]?(b-c[v-1])*x[v-1]/(c[v+u-1-1]-c[v-1]):0)+(0!=x[v+1-1]?(c[v+u-1]-b)*x[v+1-1]/(c[v+u-1]-c[v+1-1]):0);b==c[n-1]&&(x[r-1]=1);a=0;for(v=1;v<=r;v++)a+=x[v-1]*d[v-1];for(v=1;v<=r;v++)e[v-1]=0!=a?x[v-1]*d[v-1]/a:0;return e}function b(a){a=a.yj;return a[a.length-1]}function e(a){a=
a.Bo;return a[a.length-1]}var d=p("__util");a.Su=function(a){var b={},d=a.data;a=d.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var e=a.order_u;b.oe=e;a=a.points;var h=a.length/5,r=[],n=h+e,h=h+2;r[0]=0;for(var x=2;x<=n;x++)r[x-1]=x>e&&x<h?r[x-2]+1:r[x-2];b.yj=r;if("2D"==d.dimensions)b.ke=!1;else if("3D"==d.dimensions)b.ke=!0;else throw"Wrong curve dimensions";e=[];r=[];for(d=0;d<a.length;d+=5)e.push(a[d]),e.push(a[d+1]),e.push(a[d+2]),b.ke&&e.push(a[d+3]),r.push(a[d+4]);b.Sk=
e;b.cn=r;a=[];for(var d=b.Sk,e=b.ke?4:3,r=b.cn,n=b.yj,h=b.oe,x=d.length/e,v=x+h,u=0,E=n[v-1]/999,q=0;1E3>q;q++){5E-6>n[v-1]-u&&(u=n[v-1]);for(var D=c(h,u,n,r),l=0;l<e;l++)for(var z=a[e*q+l]=0;z<x;z++)a[e*q+l]+=D[z]*d[e*z+l];u+=E}e=b.ke?4:3;r=new Float32Array(1E3);r[0]=0;for(d=1;1E3>d;d+=1)n=a[(d-1)*e],h=a[(d-1)*e+1],x=a[(d-1)*e+2],v=a[d*e],u=a[d*e+1],E=a[d*e+2],r[d]=r[d-1]+Math.sqrt((v-n)*(v-n)+(u-h)*(u-h)+(E-x)*(E-x));b.Bo=r;return b};a.Yy=function(a,d,e){e||(e=[]);var m=d,h=Math.max(m,0);d=h=Math.min(m,
b(a));var m=a.Sk,h=a.ke?4:3,r=a.cn,n=a.yj,x=a.oe;a=m.length/h;var v=a+x;5E-6>n[v-1]-d&&(d=n[v-1]);v=new Float32Array(a);c(x,d,n,r,v);for(d=0;d<h;d++)for(r=e[d]=0;r<a;r++)e[d]+=v[r]*m[h*r+d]};a.Vy=function(a,b,c){c||(c=[]);var d=a.Sk,e=a.ke?4:3,r=a.cn,n=a.yj,x=a.oe;a=d.length/e;var v=a+x;5E-6>n[v-1]-b&&(b=n[v-1]);var v=new Float32Array(a),u=b;b=v;var E=r.length;b||(b=new Float32Array(E));var q=new Float32Array(E),D=new Float32Array(E),l=q,z=D;l||(l=new Float32Array(E));z||(z=new Float32Array(E));for(var A=
E+x,G=new Float32Array(A),t=new Float32Array(A),B=1;B<=A-1;B++)G[B-1]=u>=n[B-1]&&u<n[B+1-1]?1:0;u==n[A-1]&&(G[E-1]=1);for(var O=2;O<=x;O++)for(B=1;B<=A-O;B++){var y=0!=G[B-1]?G[B-1]/(n[B+O-1-1]-n[B-1]):0,H=0!=G[B+1-1]?-G[B+1-1]/(n[B+O-1]-n[B+1-1]):0,L=0!=t[B-1]?(u-n[B-1])*t[B-1]/(n[B+O-1-1]-n[B-1]):0,Z=0!=t[B+1-1]?(n[B+O-1]-u)*t[B+1-1]/(n[B+O-1]-n[B+1-1]):0;G[B-1]=(0!=G[B-1]?(u-n[B-1])*G[B-1]/(n[B+O-1-1]-n[B-1]):0)+(0!=G[B+1-1]?(n[B+O-1]-u)*G[B+1-1]/(n[B+O-1]-n[B+1-1]):0);t[B-1]=y+H+L+Z}for(B=1;B<=
E;B++)l[B-1]=G[B-1],z[B-1]=t[B-1];n=0;for(x=1;x<=E;x++)n+=q[x-1]*r[x-1];u=0;for(x=1;x<=E;x++)u+=D[x-1]*r[x-1];for(x=1;x<=E;x++)b[x-1]=0!=n?D[x-1]*r[x-1]/n+q[x-1]*r[x-1]*u/(n*n):0;for(r=0;r<e;r++)for(n=c[r]=0;n<a;n++)c[r]+=v[n]*d[e*n+r]};a.AC=b;a.Xy=e;a.Wy=function(a,c){if(0>=c)return 0;var f=b(a);if(c>=e(a))return f;var m=a.Bo,h=d.Ni(m,c,0,m.length-1);return f*(h+(c-m[h])/(m[h+1]-m[h]))/1E3}};b4w.module.__dds=function(a,p){function c(a,b,c,d){var e=new Uint16Array(4),f=new Uint16Array(c*d),q=0,g=0,l=0,h=g=q=0,k=0,m=0,t=0,B=c/4;d/=4;for(var O=0;O<d;O++)for(var y=0;y<B;y++)l=b+4*(O*B+y),e[0]=a[l],e[1]=a[l+1],q=e[0]&31,g=e[0]&2016,h=e[0]&63488,k=e[1]&31,m=e[1]&2016,t=e[1]&63488,e[2]=5*q+3*k>>3|5*g+3*m>>3&2016|5*h+3*t>>3&63488,e[3]=5*k+3*q>>3|5*m+3*g>>3&2016|5*t+3*h>>3&63488,q=a[l+2],g=4*O*c+4*y,f[g]=e[q&3],f[g+1]=e[q>>2&3],f[g+2]=e[q>>4&3],f[g+3]=e[q>>6&3],g+=c,f[g]=e[q>>8&3],f[g+1]=e[q>>
10&3],f[g+2]=e[q>>12&3],f[g+3]=e[q>>14],q=a[l+3],g+=c,f[g]=e[q&3],f[g+1]=e[q>>2&3],f[g+2]=e[q>>4&3],f[g+3]=e[q>>6&3],g+=c,f[g]=e[q>>8&3],f[g+1]=e[q>>10&3],f[g+2]=e[q>>12&3],f[g+3]=e[q>>14];return f}function b(a,b,d,e){var u=new Int32Array(d,0,31),E,q,D,l,z,A;if(542327876!=u[0])return k.error("Invalid magic number in DDS header"),0;if(!u[20]&4)return k.error("Unsupported format, must contain a FourCC code"),0;E=u[21];switch(E){case f:q=8;D=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case m:q=16;D=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case h:q=16;D=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return k.error("Unsupported FourCC code:",g(E)),null}A=1;u[2]&131072&&!1!==e&&(A=Math.max(1,u[7]));l=u[4];z=u[3];u=u[1]+4;if(b)for(E=0;E<A;++E)e=Math.max(4,l)/4*Math.max(4,z)/4*q,b=new Uint8Array(d,u,e),a.compressedTexImage2D(a.TEXTURE_2D,E,D,l,z,0,b),u+=e,l=Math.max(.5*l,1),z=Math.max(.5*z,1);else if(E==f)Math.max(4,l),Math.max(4,z),b=new Uint16Array(d),d=c(b,u/2,l,z),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,l,z,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,d),e&&a.generateMipmap(a.TEXTURE_2D);else return k.error("No manual decoder for",g(E),"and no native support"),0;return A}function e(a,c,d,e,f,g){var q=new XMLHttpRequest;q.open("GET",d,!0);q.responseType="arraybuffer";q.onload=function(){if(200==q.status){a.bindTexture(a.TEXTURE_2D,e);var d=b(a,c,q.response,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}g&&
g(e)};q.send(null);return e}function d(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function g(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var k=p("__print"),f=d("DXT1"),m=d("DXT3"),h=d("DXT5");a.fB=c;a.Mz=b;a.qp=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.kw=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case f:b=6;break;case m:case h:b=4;break;default:k.error("Unsupported FourCC code:",g(a))}return b};
a.eC=e;a.dC=function(a,b,c,d){var f=a.createTexture();e(a,b,c,f,!0,d);return f}};b4w.module.__debug=function(a,p){function c(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function b(a,b){typeof a!=typeof b&&k.fa("Structure assertion failed: incompatible types");for(var c in a)c in b||k.fa("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||k.fa("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&k.fa("Structure assertion failed: incompatible types for key "+c)}var e=
p("__extensions"),d=p("__print"),g=p("__textures"),k=p("__util"),f=null,m={},h=!1,r={},n=[],x=-1,v=null,u=!1;a.pn={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.ec=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(m[a[d]]=d)}f=a};a.iu=function(a){if(h){var b=f.getError();if(b!=f.NO_ERROR){if(b in m)throw"B4W Error: "+b+", gl."+m[b]+
" ("+a+")";throw"Unknown GL error: "+b+" ("+a+")";}}};a.fu=function(){if(h)switch(f.checkFramebufferStatus(f.FRAMEBUFFER)){case f.FRAMEBUFFER_COMPLETE:break;case f.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case f.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case f.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case f.FRAMEBUFFER_UNSUPPORTED:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:d.error("B4W Error: FRAMEBUFFER CHECK FAILED")}};a.ao=function(){if(-1!=x)return x;f.bindFramebuffer(f.FRAMEBUFFER,f.createFramebuffer());var a=g.Zi("DEBUG",g.ih);g.resize(a,1,1);f.framebufferTexture2D(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,a.Hb,a.Ka,0);f.checkFramebufferStatus(f.FRAMEBUFFER)!=f.FRAMEBUFFER_COMPLETE?(x=!0,d.warn("B4W warning: depth-only issue was found")):x=!1;f.bindFramebuffer(f.FRAMEBUFFER,
null);return x};a.ju=function(a,b,e){if(h&&!f.getShaderParameter(a,f.COMPILE_STATUS))throw e=c(e),d.error("B4W Error: shader compilation failed:\n"+e+"\n"+f.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.ku=function(a,b,l,g,n,k){if(h&&!f.getProgramParameter(a,f.LINK_STATUS)){var t=e.fp();t&&(n=t.getTranslatedShaderSource(l),k=t.getTranslatedShaderSource(g));n=c(n);k=c(k);d.error("B4W Error: shader linking failed:\n"+n+"\n\n\n"+k+"\n"+f.getProgramInfoLog(a)+" ("+
b+")");throw"Engine failed: see above for error messages";}};a.set_check_gl_errors=function(a){h=a};a.gB=function(a){r[a]=a in r?r[a]+1:1};a.update=function(){for(var a in r)d.log(a,r[a]),r[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(k.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}n.push(a)};a.msg=function(){for(var a=1,b=0;b<n.length;b++){var c=n[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=
arguments[b],k.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);n.push(c)};var E=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},e=Math.max(0,performance.now()-1E3*a),f=0;f<n.length;f++){var g=n[f];a=g[0];if(!(a<e)){var h=String(g[1]);c[h]||(c[h]=E[b++%E.length]);a=["%c"+(a/1E3).toFixed(6),c[h],h];for(h=2;h<g.length;h++)a.push(g[h]);d.log.apply(this,a)}}n.splice(0)};a.plot_telemetry=
function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-1E3*a),e=0;e<n.length;e++){var f=n[e];a=f[0];if(!(a<c))for(var g=2;g<f.length;g++){var h=String(f[1]);3<f.length&&(h+="_"+String(g-2));b[h]||(b[h]=h+"\n");b[h]+=String(a)+" "+f[g]+"\n"}}a="";for(h in b)a+=b[h]+"\n\n";d.log(a);n.splice(0)};a.NA=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&
b("gecko")&&b("firefox");case "msie":return b("mozilla")&&b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(k.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.DA=function(a,b){typeof a!=b&&k.fa("Type assertion failed: value type is not a {"+b+"}:",a)};a.BA=b;a.CA=function(a){u?b(a,
v):u=!0;v=a}};b4w.module.__extensions=function(a,p){function c(a){if(a in d)return d[a];var c=e.getExtension(a)||null;d[a]=c;b.log("%cGET EXTENSION","color: #"+(c?"0a0":"a00"),a);return c}var b=p("__print"),e=null,d={};a.ec=function(a){e=a};a.np=function(){return c("WEBGL_compressed_texture_s3tc")||c("WEBKIT_WEBGL_compressed_texture_s3tc")||c("MOZ_WEBGL_compressed_texture_s3tc")};a.nw=function(){return c("WEBGL_depth_texture")||c("WEBKIT_WEBGL_depth_texture")||c("MOZ_WEBGL_depth_texture")};a.dw=function(){return c("EXT_texture_filter_anisotropic")||
c("WEBKIT_EXT_texture_filter_anisotropic")||c("MOZ_EXT_texture_filter_anisotropic")};a.fp=function(){return c("WEBGL_debug_shaders")};a.mp=function(){return c("WEBGL_debug_renderer_info")};a.gp=function(){return c("OES_element_index_uint")};a.yw=function(){return c("OES_standard_derivatives")};a.cleanup=function(){d={}}};b4w.module.__graph=function(a){function p(a,b,d){d||(d=null);if(c(a,b))throw"Graph already has node with given ID";a.Ea.push(b,d)}function c(a,b){for(var c=a.Ea,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function b(a,b,d,e){e||(e=null);if(c(a,b)&&c(a,d))a.ra.push(b,d,e);else throw"Wrong node IDs";}function e(a,b){if(!c(a,b))throw"Node not found";for(var d=a.Ea,e=0;e<d.length;e+=2)d[e]==b&&(d.splice(e,2),e-=2)}function d(a){a=a.Ea;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}
function g(a,b){for(var c=a.Ea,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function k(a){var b=[],c={};f(a,c);for(var d=a.Ea,e=0;e<d.length;e+=2)0==D(a,d[e])&&m(a,d[e],c,b);return{Ea:b,ra:a.ra.slice(0)}}function f(a,b){for(var c=a.Ea,d=0;d<c.length;d+=2)b[c[d]]=!1}function m(a,b,c,d){if(!c[b]){c[b]=!0;for(var e=0;e<q(a,b);e++)m(a,l(a,b,e),c,d);d.unshift(b,E(a,b))}}function h(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var e=0;e<q(a,b);e++){var f=l(a,b,e);h(a,f,c,d)}if(20==d||30==d)for(e=
0;e<D(a,b);e++)f=z(a,b,e),h(a,f,c,d)}}function r(a){var b=a.Ea;a=a.ra;for(var c=[],d=[],e=[],f=0;f<b.length;f++)e[b[2*f]]=f,c.push(f,b[2*f+1]);for(f=0;f<a.length;f+=3)d.push(e[a[f]],e[a[f+1]],a[f+2]);return{Ea:c,ra:d}}function n(a,b,c){if(c.Jc==c.ne){for(var d=0,e=0;d<c.ne;d++)-1!=c.qd[d]&&(a[e]=d,b[e]=c.qd[d],e++);return!0}if(c.ne>c.zg||c.Be>c.Ce||c.Vg>c.Xg||c.Ug>c.Wg)return!1;for(var e=d=-1,f=!1;!f&&x(c,O,d,e);)if(d=O[0],e=O[1],v(c,d,e)){var g;g=c;f={};f.Fh=g.Fh;f.Gh=g.Gh;f.bm=g.bm;f.ej=g.ej;f.ne=
g.ne;f.zg=g.zg;f.oe=g.oe;f.Jc=f.Ij=g.Jc;f.Ug=g.Ug;f.Vg=g.Vg;f.Be=g.Be;f.Wg=g.Wg;f.Xg=g.Xg;f.Ce=g.Ce;f.nh=-1;f.qd=g.qd;f.Xe=g.Xe;f.jf=g.jf;f.kf=g.kf;f.Ef=g.Ef;f.Ff=g.Ff;f.Wj=g.Wj;g.Wj[0]+=1;var f=g=f,h=d,k=e,m=f.Fh,t=f.Gh,B=f.ne,r=f.zg,A=f.qd,E=f.Xe,w=f.jf,G=f.kf,p=f.Ef,N=f.Ff;u(h<B);u(k<r);u(f.Jc<B);u(f.Jc<r);B=++f.Jc;f.nh=h;w[h]||(w[h]=B,f.Ug++,p[h]&&f.Be++);p[h]||(p[h]=B,f.Vg++,w[h]&&f.Be++);G[k]||(G[k]=B,f.Wg++,N[k]&&f.Ce++);N[k]||(N[k]=B,f.Xg++,G[k]&&f.Ce++);A[h]=k;E[k]=h;for(A=0;A<D(m,h);A++)E=
z(m,h,A),w[E]||(w[E]=B,f.Ug++,p[E]&&f.Be++);for(A=0;A<q(m,h);A++)E=l(m,h,A),p[E]||(p[E]=B,f.Vg++,w[E]&&f.Be++);for(A=0;A<D(t,k);A++)E=z(t,k,A),G[E]||(G[E]=B,f.Wg++,N[E]&&f.Ce++);for(A=0;A<q(t,k);A++)E=l(t,k,A),N[E]||(N[E]=B,f.Xg++,G[E]&&f.Ce++);f=n(a,b,g);u(1>=g.Jc-g.Ij);u(-1!=g.nh);E=g.Fh;h=g.Gh;k=g.Jc;m=g.nh;t=g.qd;w=g.Xe;B=g.jf;G=g.kf;r=g.Ef;p=g.Ff;if(g.Ij<k){B[m]==k&&(B[m]=0);for(N=0;N<D(E,m);N++)A=z(E,m,N),B[A]==k&&(B[A]=0);r[m]==k&&(r[m]=0);for(N=0;N<q(E,m);N++)A=l(E,m,N),r[A]==k&&(r[A]=0);
E=t[m];G[E]==k&&(G[E]=0);for(N=0;N<D(h,E);N++)A=z(h,E,N),G[A]==k&&(G[A]=0);p[E]==k&&(p[E]=0);for(N=0;N<q(h,E);N++)A=l(h,E,N),p[A]==k&&(p[A]=0);t[m]=-1;w[E]=-1;g.Jc=g.Ij;g.nh=-1}}return f}function x(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var e=a.Be,f=a.Ce,q=a.Vg,l=a.Xg,g=a.Ug,h=a.Wg,n=a.Jc,k=a.ne,m=a.zg,O=a.qd,B=a.Xe,t=a.jf,r=a.kf,u=a.Ef,x=a.Ff;if(e>n&&f>n)for(;c<k&&(-1!=O[c]||0==u[c]||0==t[c]);)c++,d=0;else if(q>n&&l>n)for(;c<k&&(-1!=O[c]||0==u[c]);)c++,d=0;else if(g>n&&h>n)for(;c<k&&(-1!=O[c]||0==t[c]);)c++,
d=0;else if(0==c&&0!=a.oe){for(t=0;t<k&&-1!=O[c=a.oe[t]];)t++;t==k&&(c=k)}else for(;c<k&&-1!=O[c];)c++,d=0;if(e>n&&f>n)for(;d<m&&(-1!=B[d]||0==x[d]||0==r[d]);)d++;else if(q>n&&l>n)for(;d<m&&(-1!=B[d]||0==x[d]);)d++;else if(g>n&&h>n)for(;d<m&&(-1!=B[d]||0==r[d]);)d++;else for(;d<m&&-1!=B[d];)d++;return c<k&&d<m?(b[0]=c,b[1]=d,!0):!1}function v(a,b,c){var d=a.Fh,e=a.Gh,f=a.zg,g=a.qd,h=a.Xe,n=a.jf,k=a.kf,m=a.Ef,O=a.Ff;u(b<a.ne);u(c<f);u(-1==g[b]);u(-1==h[c]);if(!(0,a.bm)(E(d,b),E(e,c)))return!1;for(var B=
f=0,t=0,r=0,x=0,v=0,p=0;p<q(d,b);p++){var N=l(d,b,p);if(-1!=g[N]){var I=g[N];if(!A(e,c,I)||!G(a.ej,d,b,N,e,c,I))return!1}else n[N]&&t++,m[N]&&f++,n[N]||m[N]||x++}for(p=0;p<D(d,b);p++)if(N=z(d,b,p),-1!=g[N]){if(I=g[N],!A(e,I,c)||!G(a.ej,d,N,b,e,I,c))return!1}else n[N]&&t++,m[N]&&f++,n[N]||m[N]||x++;for(p=0;p<q(e,c);p++)if(I=l(e,c,p),-1!=h[I]){if(N=h[I],!A(d,b,N))return!1}else k[I]&&r++,O[I]&&B++,k[I]||O[I]||v++;for(p=0;p<D(e,c);p++)if(I=z(e,c,p),-1!=h[I]){if(N=h[I],!A(d,N,b))return!1}else k[I]&&r++,
O[I]&&B++,k[I]||O[I]||v++;return t<=r&&f<=B&&x<=v}function u(a){if(!a)throw"Assertion failed";}function E(a,b){for(var c=a.Ea,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function q(a,b){for(var c=a.ra,d=0,e=0;e<c.length;e+=3)c[e]==b&&d++;return d}function D(a,b){for(var c=a.ra,d=0,e=0;e<c.length;e+=3)c[e+1]==b&&d++;return d}function l(a,b,c){a=a.ra;for(var d=0,e=0;e<a.length;e+=3)if(a[e]==b){if(d==c)return a[e+1];d++}return-1}function z(a,b,c){a=a.ra;for(var d=0,e=0;e<a.length;e+=3)if(a[e+
1]==b){if(d==c)return a[e];d++}return-1}function A(a,b,c){a=a.ra;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function G(a,b,c,d,e,f,q){for(var l=t(b,c,d),g=t(e,f,q),h=0;h<l;h++){for(var n=!1,k=0;k<g;k++)if(a(B(b,c,d,h),B(e,f,q,k))){n=!0;break}if(!n)return!1}return!0}function t(a,b,c){var d=0;a=a.ra;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&d++;return d}function B(a,b,c,d){a=a.ra;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(e==d)return a[f+2];e++}return null}
var O=[-1,-1];a.ln=-1;a.rA=10;a.fn=20;a.uA=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var e=a[d];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:c.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{Ea:b,ra:c}};a.YA=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)d.push(b[e][0],b[e][1],b[e][2]);return{Ea:c,ra:d}};a.wk=p;a.JB=c;a.Xd=b;a.Eg=e;a.Dg=function(a,b,c,d){if(!A(a,b,c))throw"Edge not found";
a=a.ra;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(-1==d)a.splice(f,3);else{if(d==e){a.splice(f,3);break}e++}f-=3}};a.w=function(a,b){if(-1==g(a,b)){var c=d(a);p(a,c,b);return c}throw"Non-unique attribute";};a.Xx=function(a,b,c,d,e){a=a.ra;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&a[f+2]==d&&(a[f+2]=e)};a.cp=d;a.Ag=g;a.m=function(a,c,d,e){c=g(a,c);d=g(a,d);if(-1!=c&&-1!=d)b(a,c,d,e);else throw"Attributes not found";};a.P=function(a,b){for(var c=a.Ea,d=0;d<c.length&&!b(c[d],c[d+
1]);d+=2);};a.De=function(a,b){for(var c=a.ra,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.Od=function(a,b,c){for(var d=a.ra,e=0;e<d.length;e+=3)if(d[e+1]==b){var f=d[e];if(c(f,E(a,f),d[e+2]))break}};a.Ee=function(a,b,c){for(var d=a.ra,e=0;e<d.length;e+=3)if(d[e]==b){var f=d[e+1];if(c(f,E(a,f),d[e+2]))break}};a.Mm=k;a.nz=function(a){a=k(a).Ea;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.TB=function(){};a.qr=function(a,b,d){if(!c(a,b))throw"No such node";var e={};f(a,e);h(a,b,e,
d);b=[];for(var q in e)e[q]&&(q=Number(q),b.push(q,E(a,q)));a={Ea:b,ra:a.ra.slice(0)};e=a.ra;for(q=0;q<e.length;q+=3)b=e[q+1],c(a,e[q])&&c(a,b)||(e.splice(q,3),q-=3);return a};a.xw=function(a){for(var b=[],c=a.Ea,d=0;d<c.length;d+=2){var e=c[d];D(a,e)||b.push(e)}return b};a.wl=function(a){for(var b=[],c=a.Ea,d=0;d<c.length;d+=2){var e=c[d];q(a,e)||b.push(e)}return b};a.match=function(a,b,c,d){var e={};e.Fh=r(a);e.Gh=r(b);e.bm=c||function(a,b){return a==b};e.ej=d||function(a,b){return a==b};d=a.Ea.length/
2;var f=b.Ea.length/2;e.ne=d;e.zg=f;e.oe=0;e.Jc=e.Ij=0;e.Be=e.Ug=e.Vg=0;e.Ce=e.Wg=e.Xg=0;e.nh=-1;e.qd=Array(d);e.Xe=Array(f);e.jf=Array(d);e.kf=Array(f);e.Ef=Array(d);e.Ff=Array(f);e.Wj=[1];for(c=0;c<d;c++)e.qd[c]=-1,e.jf[c]=0,e.Ef[c]=0;for(c=0;c<f;c++)e.Xe[c]=-1,e.kf[c]=0,e.Ff[c]=0;f=Array(d);d=Array(d);if(n(f,d,e)){for(c=0;c<f.length;c++)f[c]=a.Ea[2*f[c]],d[c]=b.Ea[2*d[c]];return[f,d]}return null};a.Qa=E;a.Bg=q;a.Dp=D;a.og=l;a.gj=z;a.AB=t;a.ng=B;a.replace=function(a,b,c){for(var f=a.ra,q=d(a),l=
0;l<b.length;l++){var g=b[l];e(a,g);for(var h=0;h<f.length;h+=3)f[h]==g&&(f[h]=q),f[h+1]==g&&(f[h+1]=q),f[h]==f[h+1]&&(f.splice(h,3),h-=3)}p(a,q,c)};a.Px=function(a,b,c,d,e){if(!A(a,b,c))throw"Edge not found";a=a.ra;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&(a[f]=d,a[f+1]=e)};a.ZA=function(a,b){var c=a.Ea,d=a.ra,e;e="digraph debug {\n    node [shape=box];\n";for(var f=0;f<c.length;f+=2){var q=c[f],l=c[f+1],l=b?b(q,l):String(q);e+="    ";e+=String(q)+' [label="'+l.replace(/\"/g,'\\"')+'"];\n'}for(f=
0;f<d.length;f+=3)c=d[f],q=d[f+1],e+="    ",e+=String(c)+" -> "+String(q)+";\n";return e+="}"}};b4w.module.__ipc=function(a){var p=a.Zr=0;a.$r=1;a.as=2;a.bs=3;a.cs=4;a.ds=5;var c=a.fs=6,b=a.gs=7,e=a.hs=8;a.js=9;a.es=10;a.Is=11;a.Ec=12;a.ks=13;a.ls=14;a.ms=15;a.os=16;a.ns=17;a.ps=18;a.qs=19;a.rs=20;a.ss=21;a.ts=22;a.us=23;a.vs=24;a.ws=25;a.xs=26;a.ys=27;a.zs=28;a.As=29;a.Bs=30;a.Cs=31;a.Ds=32;a.Es=33;a.Gs=34;a.Hs=35;a.Js=36;a.nn=37;a.Ks=38;a.Ls=39;a.Ms=40;a.Ns=41;a.Os=42;a.Ps=43;a.Qs=44;a.Rs=45;a.Ss=46;a.Ts=47;a.Us=48;a.Vs=49;a.Ws=50;a.on=51;var d=a.Xf=52;a.Xs=53;a.mn=54;a.Ys=55;a.Zs=56;a.sA=
57;a.Fs=58;for(var g=null,k=[],f=[],m=[],h=[],r=0;59>r;r++)k.push(null),f.push(null),m.push(null),h.push(null);f[e]={msg_id:0,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3)};f[c]={msg_id:0,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4)};f[b]={msg_id:0,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0};f[p]={msg_id:0,body_id_a:0,body_id_b:0,result:0,
coll_point:new Float32Array(3)};f[d]={msg_id:0,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4)};h[e]=["msg_id",1,"body_id",1,"time",1,"trans",3,"quat",4,"linvel",3,"angvel",3];h[c]=["msg_id",1,"chassis_hull_body_id",1,"prop_ind",1,"trans",3,"quat",4];h[b]=["msg_id",1,"body_id",1,"from",3,"to",3,"local",1,"body_id_b_hit",1,"cur_result",1];h[p]=["msg_id",1,"body_id_a",1,"body_id_b",1,"result",1,"coll_point",3];h[d]=["msg_id",1,"body_id",1,"trans",3,"quat",4];a.init=function(a,b){a.addEventListener("message",
function(a){var c=a.data;a=c[0]|0;if(h[a]){for(var d=f[a],e=h[a],g=0,l=0;l<e.length;l+=2){var n=e[l],k=e[l+1];if(1==k)d[n]="msg_id"==n||"body_id"==n||"body_id_a"==n||"body_id_b"==n?c[g]|0:c[g];else for(var m=0;m<k;m++)d[n][m]=c[g+m];g+=k}c=d}b(a,c)},!1);g=a};a.cleanup=function(){g=null};a.q=function(){var a=arguments[0]|0;if(h[a]){var b=f[a],c=h[a],d=0;if(!m[a]){for(var e=0,q=1;q<c.length;q+=2)e+=c[q];m[a]=new Float32Array(e)}e=m[a];for(q=0;q<c.length;q+=2){var r=b[c[q]],l=c[q+1];1==l?e[d]=r:e.set(r,
d);d+=l}k[a]||(k[a]=e);a=k[a]}else for(b=arguments.length,k[a]||(k[a]=Array(b),k[a][0]=a),a=k[a],c=1;c<b;c++)a[c]=arguments[c];g.postMessage(a)};a.kp=function(a){return f[a]}};b4w.module.__hud=function(a,p){function c(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function b(a){e(' SCENE "'+a.name+'"');if(a.d){var b=0,c=0;f.P(a.d.pb,function(a,d){if("SINK"==d.type)e(" (F)",d.type);else{var f=d.type,q=Math.round(d.j.width)+"x"+Math.round(d.j.height),g=d.o.length,l=d.vh,h=d.enqueue&&d.T;h?e(" (A)",f,d.Af,q,l,"of",g):e(" (P)",f,d.Af,q,l,"of",g);d.vh=0;h&&(b+=g,c+=l)}});return[b,c]}e("No INFO")}function e(){for(var a=80+20*h[0],b=[5,
18,3,10,4,3,5],c=arguments[0],d=1;d<arguments.length;d++){for(var e="",f=0;f<b[d]-String(arguments[d]).length;f++)e+=" ";c+=e+arguments[d]}h[0]++;m.fillText(c,30,a)}function d(a,b,c){b*=a.ta;c.x=a.x+b;c.y=a.y;c.ta=a.ta-2*b;c.la=a.la}function g(a){return a.x+a.ta/2}function k(a){var b=m,c={x:0,y:0,ta:0,la:0},e=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.ta=e;c.la=b;d(c,.01,c);e=.02*c.la;c.x=c.x;c.y+=e;c.ta=c.ta;c.la-=2*e;e=c.ta/8;c.x+=e*a;c.y=c.y;c.ta=e;c.la=c.la;d(c,.02,c);return c}var f=p("__graph"),
m=null,h=[0,0];a.init=function(a){a=a.getContext("2d");c(a);return m=a};a.$g=function(){m&&c(m)};a.reset=function(){var a=m;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),h[0]=0,h[1]=0)};a.Hy=function(a,c){var d=m;if(d){d.textAlign="left";d.fillStyle="rgba(0,255,0,255)";e(" FPS",(1/c).toFixed(2));h[0]++;for(var f=d=0,g=0;g<a.length;g++){var k=b(a[g]),d=d+k[0],f=f+k[1];h[0]++}e(" ---------------------------------------------");
e("    ","TOTAL ACTIVE","","",f,"of",d)}};a.print=function(){var a=m;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",e.apply(Math,arguments))};a.plot_array=function(a,b,c,d,e,f,q){var h=m;if(h){b=k(b);var l=b.la/5;b.x=b.x;b.y+=4*l;b.ta=b.ta;b.la=l;h.textAlign="center";h.fillStyle="#00FF00";m.fillText(a,g(b),b.y-10);h.strokeStyle="#00FF00";h.lineWidth=.5;h.beginPath();h.moveTo(b.x,b.y);h.lineTo(b.x+b.ta,b.y);h.lineTo(b.x+b.ta,b.y+b.la);h.lineTo(b.x,b.y+b.la);h.closePath();h.stroke();if(!f&&
!q)for(f=1E6,q=-1E6,a=0;a<c.length;a++)f=Math.min(f,c[a]),q=Math.max(q,c[a]);h.textAlign="right";m.fillText(String(f),b.x-10,b.y+b.la);m.fillText(String(q),b.x-10,b.y);h.textAlign="center";m.fillText(String(d),b.x,b.y+b.la+15);m.fillText(String(e),b.x+b.ta,b.y+b.la+15);h.strokeStyle="#FF0000";h.lineWidth=1.5;h.beginPath();d=b.ta/(c.length-1);q=b.la/(q-f);for(a=0;a<c.length;a++)e=b.x+d*a,l=b.y+b.la-(c[a]-f)*q,0==a?h.moveTo(e,l):h.lineTo(e,l);h.stroke()}};a.draw_mixer_strip=function(a,b,c,d,e,f,q){var h=
m;if(h)for(h.textAlign="center",h.fillStyle="#00FF00",h.font="bold 12px Courier",c=k(c),m.fillText(b?"["+a+"]":a,g(c),c.y),0<=f&&m.fillText(f?"[M]":"[ ]",g(c)-15,c.y+30),0<=q&&m.fillText(q?"[S]":"[ ]",g(c)+15,c.y+30),a={x:0,y:0,ta:0,la:0},b=0;b<d.length;b++){f=d[b];var l="VOLUME"==f[0];if(l){q=c.y+350;var z=c.ta,A=a;A.x=c.x;A.y=q;A.ta=z;A.la=250}else{q=c.y+10+50*b;var z=c.ta,A=c.la,G=a;G.x=c.x;G.y=q;G.ta=z;G.la=A}q=h;var z=a,G=b==e,t=f[0],A=f[1],B=f[2],O=f[3],y=(O-B)/f[4],y=1>y?Math.floor(1/y-1E-5).toFixed(0).length:
0;f=f[5]?Math.log(A/B)/Math.log(O/B):(A-B)/(O-B);q.textAlign="center";G?q.fillText("["+t+"]",g(z),z.y):q.fillText(t,g(z),z.y);q.strokeStyle="#00FF00";q.lineWidth=l?3:1;l?(q.textAlign="right",q.fillText(O.toFixed(y),g(z)-10,z.y+15),q.textAlign="right",q.fillText(B.toFixed(y),g(z)-10,z.y+z.la-15)):(q.textAlign="right",q.fillText(B.toFixed(y),z.x+28,z.y+15),q.textAlign="left",q.fillText(O.toFixed(y),z.x+z.ta-28,z.y+15));q.beginPath();if(l){var H=z.y+15+(z.la-30)*(1-f);q.moveTo(g(z),z.y+15);q.lineTo(g(z),
z.y+z.la-15);q.moveTo(g(z)-5,z.y+15);q.lineTo(g(z)+5,z.y+15);q.moveTo(g(z)-5,z.y+z.la-15);q.lineTo(g(z)+5,z.y+z.la-15);q.moveTo(g(z)-5,H);q.lineTo(g(z)+5,H)}else{var L=z.x+30+(z.ta-60)*f;q.moveTo(z.x+30,z.y+15);q.lineTo(z.x+z.ta-30,z.y+15);q.moveTo(z.x+30,z.y+15-5);q.lineTo(z.x+30,z.y+15+5);q.moveTo(z.x+z.ta-30,z.y+15-5);q.lineTo(z.x+z.ta-30,z.y+15+5);q.moveTo(L,z.y+15-5);q.lineTo(L,z.y+15+5)}q.stroke();"EQ_Q"==t?(f=Math.log(1+1/(2*A*A)+Math.sqrt((2+1/(A*A))*(2+1/(A*A))/4-1))/Math.log(2),l?(q.textAlign=
"left",q.fillText(A.toFixed(y),g(z)+10,H),q.textAlign="left",q.fillText("("+f.toFixed(y+1)+")",g(z)+10,H+10)):(q.textAlign="right",q.fillText(A.toFixed(y),L,z.y+30),q.textAlign="left",q.fillText("("+f.toFixed(y+1)+")",L,z.y+30))):l?(q.textAlign="left",q.fillText(A.toFixed(y),g(z)+10,H)):(q.textAlign="center",q.fillText(A.toFixed(y),L,z.y+30))}}};b4w.module.__renderer=function(a,p){function c(a){if(a){var b=(a.ea?u.COLOR_BUFFER_BIT:0)|(a.ia?u.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=r;break;case "DEPTH":a=n;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":a=x;break;case "GLOW_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=v;break;default:a=h.background_color}}else b=u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT,a=h.background_color;u.colorMask(!0,!0,!0,!0);u.depthMask(!0);u.clearColor(a[0],
a[1],a[2],a[3]);u.clear(b)}function b(a,b,c){u.bindBuffer(u.ARRAY_BUFFER,a.Tf);for(var d=0;d<b.length;d++){var e=b[d];u.enableVertexAttribArray(e.vf);u.vertexAttribPointer(e.vf,e.Nc,u.FLOAT,!1,0,e.Pt+e.Iv*c)}a.Dd?(u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a.Dd),u.drawElements(a.mode,a.count,a.Fl,0)):u.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)e=b[d],u.disableVertexAttribArray(e.vf)}function e(a){switch(a){case 0:return u.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return u.TEXTURE_CUBE_MAP_NEGATIVE_X;
case 2:return u.TEXTURE_CUBE_MAP_POSITIVE_Y;case 3:return u.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return u.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return u.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function d(a){var b=a.pi,c=[],d=[],e={},f;for(f in b){var g=!1;switch(f){case "u_proj_matrix":var h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.oa)},g=!0;break;case "u_view_matrix":case "u_view_matrix_frag":h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.ha)};g=!0;break;case "u_shadow_cast_billboard_view_matrix":h=function(a,
b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.$q)};g=!0;break;case "u_view_proj_prev":h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Jx)};g=!0;break;case "u_view_proj_inverse":h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.fh)};g=!0;break;case "u_sky_vp_inverse":h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Tc)};g=!0;break;case "u_camera_eye":case "u_camera_eye_frag":h=function(a,b,c,d,e,f){a.uniform3fv(b,f.fe)};g=!0;break;case "u_camera_eye_last":h=function(a,b,c,d,e,f){a.uniform3fv(b,f.Uo)};g=
!0;break;case "u_camera_quat":h=function(a,b,c,d,e,f){a.uniform4fv(b,f.quat)};g=!0;break;case "u_view_max_depth":h=function(a,b,c,d,e,f){a.uniform1f(b,f.Pa)};g=!0;break;case "u_camera_range":h=function(a,b,c,d,e,f){a.uniform2f(b,f.Ia,f.Pa)};break;case "u_csm_center_dists":h=function(a,b,c,d,e,f){a.uniform4fv(b,f.zo)};break;case "u_cam_water_depth":h=function(a,b,c){a.uniform1f(b,c.Kk)};g=!0;break;case "u_waves_height":h=function(a,b,c){a.uniform1f(b,c.Ie)};break;case "u_waves_length":h=function(a,
b,c){a.uniform1f(b,c.Wf)};break;case "u_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.Nb)};break;case "u_underwater_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.Dc)};break;case "u_bloom_key":h=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":h=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":h=function(a,b,c){a.uniform1f(b,c.time)};g=!0;break;case "u_wind":h=function(a,b,c){a.uniform3fv(b,c.vi)};break;case "u_horizon_color":h=function(a,
b,c){a.uniform3fv(b,c.pc)};break;case "u_zenith_color":h=function(a,b,c){a.uniform3fv(b,c.uc)};break;case "u_environment_energy":h=function(a,b,c){a.uniform1f(b,c.ee)};break;case "u_sky_color":h=function(a,b,c){a.uniform3fv(b,c.Kg)};break;case "u_rayleigh_brightness":h=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":h=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":h=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":h=
function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":h=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":h=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":h=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":h=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":h=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;
case "u_light_positions":h=function(a,b,c){a.uniform3fv(b,c.tf)};break;case "u_light_directions":h=function(a,b,c){a.uniform3fv(b,c.qf)};break;case "u_light_color_intensities":h=function(a,b,c){a.uniform3fv(b,c.pf)};break;case "u_light_factors1":h=function(a,b,c){a.uniform4fv(b,c.rf)};break;case "u_light_factors2":h=function(a,b,c){a.uniform4fv(b,c.sf)};break;case "u_shadow_lamp_id":h=function(a,b,c){a.uniform1i(b,c.ar)};break;case "u_sun_quaternion":h=function(a,b,c){a.uniform4fv(b,c.ur)};break;
case "u_sun_intensity":h=function(a,b,c){a.uniform3fv(b,c.tr)};break;case "u_sun_direction":h=function(a,b,c){a.uniform3fv(b,c.ak)};break;case "u_height":h=function(a,b,c,d,e,f){a.uniform1f(b,f.height)};g=!0;break;case "u_model_matrix":h=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.K)};g=!0;break;case "u_transb":h=function(a,b,c,d){a.uniform4fv(b,d.kc)};g=!0;break;case "u_transa":h=function(a,b,c,d){a.uniform4fv(b,d.jc)};g=!0;break;case "u_quat":h=function(a,b,c,d){a.uniform4fv(b,d.quat)};g=!0;break;
case "u_quatsb":h=function(a,b,c,d){a.uniform4fv(b,d.cc)};g=!0;break;case "u_quatsa":h=function(a,b,c,d){a.uniform4fv(b,d.bc)};g=!0;break;case "u_frame_factor":h=function(a,b,c,d){a.uniform1f(b,d.cf)};g=!0;break;case "au_center_pos":h=function(){};g=!0;break;case "au_wind_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.bd)};g=!0;break;case "au_wind_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.Je)};g=!0;break;case "au_detail_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.ae)};g=!0;break;case "au_detail_bending_amp":h=
function(a,b,c,d){a.uniform1f(b,d.$d)};g=!0;break;case "au_branch_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.Yd)};g=!0;break;case "u_anim_values":h=function(a,b,c,d){a.uniform1fv(b,d.yf)};g=!0;break;case "u_diffuse_color":h=function(a,b,c,d,e){a.uniform4fv(b,e.yb)};g=!0;break;case "u_diffuse_intensity":h=function(a,b,c,d,e){a.uniform1f(b,e.Ze)};g=!0;break;case "u_diffuse_params":h=function(a,b,c,d,e){a.uniform2fv(b,e.td)};g=!0;break;case "u_emit":h=function(a,b,c,d,e){a.uniform1f(b,e.ce)};g=
!0;break;case "u_ambient":h=function(a,b,c,d,e){a.uniform1f(b,e.Hc)};g=!0;break;case "u_specular_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.Md)};g=!0;break;case "u_specular_alpha":h=function(a,b,c,d,e){a.uniform1f(b,e.Mg)};g=!0;break;case "u_specular_params":h=function(a,b,c,d,e){a.uniform3fv(b,e.tc)};g=!0;break;case "u_reflect_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.di)};g=!0;break;case "u_mirror_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.Yl)};g=!0;break;case "u_grass_map_dim":h=function(a,
b,c,d,e){a.uniform3fv(b,e.Pb)};g=!0;break;case "u_grass_size":h=function(a,b,c,d,e){a.uniform1f(b,e.yl)};g=!0;break;case "u_scale_threshold":h=function(a,b,c,d,e){a.uniform1f(b,e.jj)};g=!0;break;case "u_cube_fog":h=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.Zb)};break;case "u_jitter_amp":h=function(a,b,c,d,e){a.uniform1f(b,e.wj)};g=!0;break;case "u_jitter_freq":h=function(a,b,c,d,e){a.uniform1f(b,e.xj)};g=!0;break;case "u_wireframe_mode":h=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;
case "u_wireframe_edge_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":h=function(a,b,c){a.uniform2fv(b,c.cx)};g=!0;break;case "u_subsample_indices":h=function(a,b,c){a.uniform4fv(b,c.dx)};g=!0;break;case "u_refr_bump":h=function(a,b,c,d,e){a.uniform1f(b,e.Kq)};g=!0;break;case "u_lamp_light_positions":h=function(a,b,c,d,e){a.uniform3fv(b,e.Ml)};break;case "u_lamp_light_directions":h=function(a,b,c,d,e){a.uniform3fv(b,e.Kl)};break;case "u_lamp_light_color_intensities":h=
function(a,b,c,d,e){a.uniform3fv(b,e.Jl)};break;case "u_lamp_light_factors":h=function(a,b,c,d,e){a.uniform4fv(b,e.Ll)};break;case "u_halo_size":h=function(a,b,c,d,e){a.uniform1f(b,e.wp)};g=!0;break;case "u_halo_hardness":h=function(a,b,c,d,e){a.uniform1f(b,e.tp)};g=!0;break;case "u_halo_rings_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.vp)};g=!0;break;case "u_halo_lines_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.up)};g=!0;break;case "u_halo_stars_blend":h=function(a,b,c,d,e){a.uniform1f(b,e.xp)};
g=!0;break;case "u_halo_stars_height":h=function(a,b,c,d,e){a.uniform1f(b,e.yp)};g=!0;break;case "u_fresnel_params":h=function(a,b,c,d,e){a.uniform4fv(b,e.zd)};g=!0;break;case "u_texture_scale":h=function(a,b,c,d,e){a.uniform3fv(b,e.Xc)};g=!0;break;case "u_parallax_scale":h=function(a,b,c,d,e){a.uniform1f(b,e.Xh)};g=!0;break;case "u_color_id":h=function(a,b,c,d,e){a.uniform3fv(b,e.oo)};g=!0;break;case "u_line_points":h=function(a,b,c,d,e){a.uniform3fv(b,e.cC)};g=!0;break;case "u_diffuse_color_factor":h=
function(a,b,c,d,e){a.uniform1f(b,e.Ye)};g=!0;break;case "u_alpha_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.Ne)};g=!0;break;case "u_specular_color_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.gr)};g=!0;break;case "u_normal_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.dq)};g=!0;break;case "u_normalmap0_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.zf[0])};g=!0;break;case "u_normalmap1_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.zf[1])};g=!0;break;case "u_normalmap2_scale":h=function(a,b,c,
d,e){a.uniform2fv(b,e.zf[2])};g=!0;break;case "u_normalmap3_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.zf[3])};g=!0;break;case "u_foam_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};g=!0;break;case "u_foam_uv_freq":h=function(a,b,c,d,e){a.uniform2fv(b,e.Yo)};g=!0;break;case "u_foam_mag":h=function(a,b,c,d,e){a.uniform2fv(b,e.Xo)};g=!0;break;case "u_foam_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.kl)};g=!0;break;case "u_water_norm_uv_velocity":h=function(a,b,c,d,e){a.uniform1f(b,
e.nk)};g=!0;break;case "u_shallow_water_col":h=function(a,b,c,d,e){a.uniform3fv(b,e.shallow_water_col)};g=!0;break;case "u_shore_water_col":h=function(a,b,c,d,e){a.uniform3fv(b,e.shore_water_col)};g=!0;break;case "u_water_shallow_col_fac":h=function(a,b,c,d,e){a.uniform1f(b,e.shallow_water_col_fac)};g=!0;break;case "u_water_shore_col_fac":h=function(a,b,c,d,e){a.uniform1f(b,e.shore_water_col_fac)};g=!0;break;case "u_p_length":h=function(a,b,c,d,e){a.uniform1f(b,e.qq)};g=!0;break;case "u_p_cyclic":h=
function(a,b,c,d,e){a.uniform1i(b,e.mq)};g=!0;break;case "u_p_max_lifetime":h=function(a,b,c,d,e){a.uniform1f(b,e.sq)};g=!0;break;case "u_p_fade_in":h=function(a,b,c,d,e){a.uniform1f(b,e.nq)};g=!0;break;case "u_p_fade_out":h=function(a,b,c,d,e){a.uniform1f(b,e.oq)};g=!0;break;case "u_p_size":h=function(a,b,c,d,e){a.uniform1f(b,e.gm)};g=!0;break;case "u_p_alpha_start":h=function(a,b,c,d,e){a.uniform1f(b,e.jq)};g=!0;break;case "u_p_alpha_end":h=function(a,b,c,d,e){a.uniform1f(b,e.iq)};g=!0;break;case "u_p_nfactor":h=
function(a,b,c,d,e){a.uniform1f(b,e.fm)};g=!0;break;case "u_p_gravity":h=function(a,b,c,d,e){a.uniform1f(b,e.pq)};g=!0;break;case "u_p_mass":h=function(a,b,c,d,e){a.uniform1f(b,e.rq)};g=!0;break;case "u_p_size_ramp":h=function(a,b,c,d,e){a.uniform2fv(b,e.tq)};g=!0;break;case "u_p_color_ramp":h=function(a,b,c,d,e){a.uniform4fv(b,e.kq)};g=!0;break;case "u_p_wind":h=function(a,b,c,d,e){a.uniform3fv(b,e.Kj)};g=!0;break;case "u_texel_size":h=function(a,b,c,d,e){a.uniform2fv(b,e.Km)};g=!0;break;case "u_p_time":h=
function(a,b,c,d,e){a.uniform1f(b,e.Oc.L.time)};g=!0;break;case "u_va_frame_factor":h=function(a,b,c,d){a.uniform1f(b,d.Kr)};g=!0;break;case "u_normal_offset":h=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":h=function(a,b,c,d,e,f){a.uniform4fv(b,f.Pj)};break;case "u_v_light_matrix":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Jr)};g=!0;break;case "u_b_light_matrix":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Mn)};break;case "u_p_light_matrix0":h=function(a,
b,c){a.uniformMatrix4fv(b,!1,c.Gf[0])};g=!0;break;case "u_p_light_matrix1":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Gf[1])};g=!0;break;case "u_p_light_matrix2":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Gf[2])};g=!0;break;case "u_p_light_matrix3":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Gf[3])};g=!0;break;case "u_motion_blur_exp":h=function(a,b,c){a.uniform1f(b,c.aq)};g=!0;break;case "u_refl_plane":h=function(a,b,c){a.uniform4fv(b,c.Ab)};break;case "u_radial_blur_step":h=function(a,b,c){a.uniform1f(b,
c.Sj)};break;case "u_god_rays_intensity":h=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":h=function(a,b,c){a.uniform1f(b,c.Pg)};break;case "u_ssao_blur_discard_value":h=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};g=!0;break;case "u_ssao_influence":h=function(a,b,c){a.uniform1f(b,c.Og)};break;case "u_ssao_dist_factor":h=function(a,b,c){a.uniform1f(b,c.Ng)};break;case "u_dof_dist":h=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_distance)};g=!0;break;
case "u_dof_front":h=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_front)};g=!0;break;case "u_dof_rear":h=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_rear)};g=!0;break;case "u_glow_intensity":h=function(a,b,c,d,e){a.uniform1f(b,e.qg)};g=!0;break;case "u_glow_color":h=function(a,b,c){a.uniform3fv(b,c.Jh)};break;case "u_draw_glow":h=function(a,b,c){a.uniform1f(b,c.el)};g=!0;break;case "u_brightness":h=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":h=function(a,b,c){a.uniform1f(b,c.contrast)};
break;case "u_exposure":h=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":h=function(a,b,c){a.uniform1f(b,c.saturation)};break;default:h=null}h&&(h={name:f,pl:h,vf:b[f]},g?c.push(h):(d.push(h),e[f]=h))}a.Ar=c;a.Yh=d;a.im=e}var g=p("__config"),k=p("__debug"),f=p("__textures"),m=p("__util"),h=g.p,r=[1,1,1,1],n=[1,1,1,1],x=[0,0,0,1],v=[0,0,0,0];new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var u=null,E=new Uint8Array(4);
a.ec=function(a){var b=h.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);u=a};a.yh=function(a){if(a.T){var f=a.j;u.bindFramebuffer(u.FRAMEBUFFER,f.ge);if(a.yk){var g=f.ub;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,g.Hb,g.Ka,0)}u.viewport(0,0,f.width,f.height);c(a);a.va?u.enable(u.BLEND):u.disable(u.BLEND);
a.Fb?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST);if(a.ya){for(var f=a.j,g=a.o,n=0;n<g.length;n++){var m=g[n],r=m.n,t=r.Mb;u.useProgram(t.ai);m=m.eb;t.Yh.length||d(t);for(var t=t.Yh,v=t.length;v--;){var x=t[v];x.pl(u,x.vf,a,m,r,f)}}a.ya=!1}switch(a.type){case "SHADOW_CAST":u.enable(u.POLYGON_OFFSET_FILL);u.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);u.cullFace(u.BACK);break;case "MAIN_REFLECT":u.disable(u.POLYGON_OFFSET_FILL);u.cullFace(u.FRONT);break;default:u.disable(u.POLYGON_OFFSET_FILL),
u.cullFace(u.BACK)}f=a.j;g=a.o;for(n=0;n<g.length;n++)if(t=g[n],t.T){var r=a,m=f,v=t.eb,y=t.n,x=y.Mb;u.useProgram(x.ai);for(var t=y.lb,H=y.In,L=x.Ar,p=L.length;p--;){var J=L[p];J.pl(u,J.vf,r,v,y,m)}m=y.po;u.colorMask(m,m,m,m);u.depthMask(y.U);y.qa?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE);m=y.M;for(y=0;y<m.length;y++)L=m[y],u.activeTexture(u.TEXTURE0+y),u.bindTexture(L.Hb,L.Ka);if("SKY"==r.type){m=r;x=x.pi;y=m.j.ub.Ka;L=m.Ao;for(p=0;6>p;p++){J=e(p);if(h.ko){var F=new Uint8Array([91.8,142.8,.96*
255,255]);u.bindTexture(u.TEXTURE_CUBE_MAP,y);u.texImage2D(J,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,F)}else u.uniformMatrix4fv(x.u_cube_view_matrix,!1,L[p]),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,J,y,0),b(t,H,v.Tm);if(m.Gj&&3!=p){var J=m,F=p,U=E;u.readPixels(191,191,1,1,u.RGBA,u.UNSIGNED_BYTE,U);255!=U[0]&&255!=U[1]&&255!=U[2]||u.readPixels(191,220,1,1,u.RGBA,u.UNSIGNED_BYTE,U);var K=U[0],S=U[1],U=U[2],K=K/255,S=S/255,U=U/255;2===F?(J.Zb[3]=K,J.Zb[7]=S,J.Zb[11]=U):2>F?(J.Zb[4*F]=
K,J.Zb[4*F+1]=S,J.Zb[4*F+2]=U):(J.Zb[4*(F-2)]=K,J.Zb[4*(F-2)+1]=S,J.Zb[4*(F-2)+2]=U)}}r.vh+=6}else b(t,H,v.Tm),r.vh++}k.iu("draw subscene: "+a.type);u.bindFramebuffer(u.FRAMEBUFFER,null)}};a.clear=function(a){u.bindFramebuffer(u.FRAMEBUFFER,a.j.ge);c(a)};a.En=function(a){var b=a.In;b.length=0;var c=a.lb;a=a.Mb;c&&a||m.fa("Incomplete batch");c=c.Rb;a=a.attributes;for(var d in a){var e=c[d];b.push({vf:a[d],Pt:4*e.offset,Iv:1<e.frames?4*e.length:0,Nc:e.Nc})}};a.Ot=d;a.Fn=function(a){var b=a.Mb,c=a.M;
a=a.hc;u.useProgram(b.ai);for(var d=0;d<c.length;d++)u.uniform1i(b.pi[a[d]],d)};a.Nx=function(a,b,c){var d,e,f;d||(d=1);e||(e=1);f||(f=new Uint8Array(4*d*e));f.length!=4*d*e&&m.fa("read_pixels(): Wrong storage");u.bindFramebuffer(u.FRAMEBUFFER,a);u.readPixels(b,c,d,e,u.RGBA,u.UNSIGNED_BYTE,f);u.bindFramebuffer(u.FRAMEBUFFER,null);return f};a.tz=function(a){var b=a.Mb;u.useProgram(b.ai);b.Yh.length||d(b);b=b.im.u_cube_fog;b.pl(u,b.vf,null,null,a,null)};a.Wx=function(a,b){var c=u.createFramebuffer();
u.bindFramebuffer(u.FRAMEBUFFER,c);if(a){var d=a,e=d.Ka,d=d.Hb==u.TEXTURE_CUBE_MAP?u.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.Hb;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,d,e,0)}f.Kp(b)?u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,b.Fe):f.Oh(b)&&(d=b,e=d.Ka,d=d.Hb,u.framebufferTexture2D(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,d,e,0));k.fu();u.bindFramebuffer(u.FRAMEBUFFER,null);return c};a.Vx=function(a,b,c,d,e){null==a?(u.bindFramebuffer(u.FRAMEBUFFER,a),u.viewport(0,0,
d,e),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT)):(f.Oh(b)&&u.deleteTexture(b.Ka),f.Kp(c)?u.deleteRenderbuffer(c.Fe):f.Oh(c)&&u.deleteTexture(c.Ka),u.deleteFramebuffer(a))};a.MB=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,p){function c(a,c,d){var e=a.be;"string"==typeof d&&(a=b(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==c){e[a][1]=d;return}e.push([c,d])}function b(a,b){for(var c=a.be,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function e(a,b){var c=a+b;if(z[c])return z[c];if(q){var d=q[b];if(!d)return null}else{d=u.zw(a+b);if(!d)return null;d=D.zq.parse(d)}return z[c]=d}function d(a,b,c,d){function f(b){b=b.a;for(var c=0;c<b.length;c++){var m=b[c];switch(m.type){case "condition":a:for(var m=
m.a,v=0;v<m.length;v++){var x=m[v];switch(x.type){case "if":case "elif":var I=x.c;try{var Y=h(I)}catch(ga){throw"Failed to process #"+x.type+" expression: "+I.join(" ");}if(Y){f(x.group);break a}break;case "else":f(x.group);break a;case "ifdef":x.name in k&&f(x.group);break;case "ifndef":x.name in k||f(x.group)}}break;case "include":m=e(E.shaders_dir,E.Fy+m.file);f(m);break;case "var":case "export":case "import":break;case "define":v=m.name;k[v]=m.b;m.Aa&&(r[v]=m.Aa);break;case "error":throw"Shader error: #error "+
m.b.join(" ");case "line":break;case "pragma":q.push("#pragma "+m.name+" "+m.b.join(" "));break;case "undef":m=m.name;delete k[m];delete r[m];break;case "warning":n.warn("Shader warning: #warning "+m.b.join(" "));break;case "extension":q.push("#extension "+g(m.b,k,r,!1));break;case "#":break;case "node":u[m.name]=m;break;case "nodes_global":m=d;for(v=0;v<m.length;v++)if(x=m[v],I=u[x.id])for(var B=0,M=0;M<I.k.length;M++){var R=I.k[M];"node_param"==R.type&&(R=R.qualifier.join(" ")+" ","vert"==a?R+=
x.ui[B]:"frag"==a&&(R+=x.Aa[B],null!==x.Mj[B]&&(R+=" = "+x.Mj[B])),R+=";",q.push(R),B++)}break;case "nodes_main":m=d;for(v=0;v<m.length;v++)if(x=m[v],I=u[x.id]){B={};M={};for(R=0;R<x.xh.length;R++)M[x.xh[R][0]]=[x.xh[R][1]];G=D=z=0;for(var R=x,s=I.k,V=B,ma=M,U=0;U<s.length;U++){var O=s[U];switch(O.type){case "node_in":var p=R.F[z];if(null!==R.Gp[z]){if(("MATERIAL"==R.id&&3===z||"MATERIAL_EXT"==R.id&&3===z)&&O.e){z++;continue}var la=O.qualifier.join(" ")+" ",la=la+p,la=la+(" = "+R.Gp[z]),la=la+";";
q.push(la)}V[O.name]=p;z++;break;case "node_out":p=R.Sa[D];if(!O.e||-1<A.indexOf(p))la=O.qualifier.join(" ")+" ",la+=p,la+=";",q.push(la),V[O.name]=p;-1<A.indexOf(p)&&(ma["USE_OUT_"+O.name]=[1]);D++;break;case "node_param":"vert"==a?p=R.ui[G]:"frag"==a&&(p=R.Aa[G]),V[O.name]=p,G++}}l(x,I.f,B,M)}break;case "textline":q.push(g(m.b,k,r,!1));break;default:throw"Unknown element type: "+m.type;}}}function h(a,b){var c=g(a,k,r,!0,b);return v.zq.parse(c)}function l(a,b,c,d){for(var e=0;e<b.length;e++){var f=
b[e];switch(f.type){case "node_condition":a:for(var Y=a,f=f.a,m=c,n=d,M=0;M<f.length;M++){var R=f[M];switch(R.type){case "node_if":case "node_elif":var s=R.c;try{var V=h(s,n)}catch(y){throw"Failed to process #"+R.type+" expression: "+s.join(" ");}if(V){l(Y,R.f,m,n);break a}break;case "node_else":l(Y,R.f,m,n);break a;case "node_ifdef":(R.name in k||R.name in n)&&l(Y,R.f,m,n);break;case "node_ifndef":R.name in k||R.name in n||l(Y,R.f,m,n)}}break;case "textline":Y=[];for(m=0;m<f.b.length;m++)n=f.b[m],
n in c?Y.push(c[n]):Y.push(n);q.push(g(Y,k,r,!0,d))}}}for(var q=[],k={},m=0;m<c.length;m++)k[c[m][0]]=[c[m][1]];for(m=0;m<d.length;m++)k["USE_NODE_"+d[m].id]=[1];var r={},u={},A=[];for(m in d)for(var x in d[m].F)A.push(d[m].F[x]);f(b);var z=0,D=0,G=0;return q.join("\n")}function g(a,b,c,d,e){var f=[];k(a,b,c,d,f,e);return f.join(" ")}function k(a,b,c,d,e,f){for(var h=0;h<a.length;h++){var g=a[h];g in b||f&&g in f?(g=f&&f[g]||b[g],0==g.length&&d?e.push(0):k(g,b,c,d,e,f)):e.push(g)}}function f(a,b,
c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);x.ju(d,b,c);return d}function m(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return h(a);case 2:return"vec2("+h(a[0])+","+h(a[1])+")";case 3:return"vec3("+h(a[0])+","+h(a[1])+","+h(a[2])+")";case 4:return"vec4("+h(a[0])+","+h(a[1])+","+h(a[2])+","+h(a[3])+")";case 9:return"mat3("+h(a[0])+","+h(a[1])+","+h(a[2])+","+h(a[3])+","+h(a[4])+","+h(a[5])+","+h(a[6])+","+h(a[7])+","+h(a[8])+")";case 16:return"mat4("+h(a[0])+","+h(a[1])+
","+h(a[2])+","+h(a[3])+","+h(a[4])+","+h(a[5])+","+h(a[6])+","+h(a[7])+","+h(a[8])+","+h(a[9])+","+h(a[10])+","+h(a[11])+","+h(a[12])+","+h(a[13])+","+h(a[14])+","+h(a[15])+")";default:throw"Wrong glsl value dimension";}}function h(a){return a%1?String(a):String(a)+".0"}var r=p("__config"),n=p("__print"),x=p("__debug"),v=p("__gpp_eval"),u=p("__assets");p("__util");var E=r.Qb;if(b4w.module_check("shader_texts"))var q=p("shader_texts"),D=null;else q=null,D=p("__gpp_parser");var l={},z={},A=[],G=null;
a.ec=function(a){G=a};a.G=c;a.ow=b;a.UB=function(a,b){for(var c=a.be,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.ny=function(a){a.be=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE USE_REFRACTION SHORE_SMOOTHING SKINNED SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
d=0;d<b.length;d++){var e=b[d],f;switch(e){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_LIGHTS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "USE_REFRACTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":f=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":f=1;break;case "SHADOW_TEX_RES":f=m(2048);break;case "AA_METHOD":f="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":f="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":f="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":f="POST_EFFECT_NONE";break;case "SHADOW_SRC":f="SHADOW_SRC_NONE";break;case "SHADOW_DST":f=
"SHADOW_DST_NONE";break;case "SSAO_QUALITY":f="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":f="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":f="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":f=r.p.precision;break;case "EPSILON":f="highp"==r.p.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":f="u_va_frame_factor";break;default:n.error("Unknown directive ("+a.si+", "+a.Ch+"): "+e)}c(a,e,f)}};a.FB=function(a){return a.si};a.hp=function(a){return a.Ch};a.Rw=function(a,d){for(var e=
d.be,f=0;f<e.length;f++){var h=e[f][0],g=e[f][1];b(a,h)&&c(a,h,g)}};a.iw=function(a,b){var c=JSON.stringify(a)+JSON.stringify(b),h=l[c];if(h)return h;var g=a.Ch,h=e(E.shaders_dir,a.si),g=e(E.shaders_dir,g);if(!h||!g)return null;var q=a.be||[],k=d("vert",h,q,b),q=d("frag",g,q,b),h=G,m=f(h,c,k,h.VERTEX_SHADER),r=f(h,c,q,h.FRAGMENT_SHADER),g=h.createProgram();h.attachShader(g,m);h.attachShader(g,r);h.linkProgram(g);h.validateProgram(g);h.getProgramParameter(g,h.VALIDATE_STATUS)==h.qA&&n.error("B4W Error - shader program is not valid",
c);x.ku(g,c,m,r,k,q);k={Zm:m,bp:r,ai:g,attributes:{},pi:{},Yh:[],im:{},Ar:[],Ua:a};m=h.getProgramParameter(g,h.ACTIVE_ATTRIBUTES);for(q=0;q<m;q++)r=h.getActiveAttrib(g,q).name,k.attributes[r]=h.getAttribLocation(g,r);m=h.getProgramParameter(g,h.ACTIVE_UNIFORMS);for(q=0;q<m;q++)r=h.getActiveUniform(g,q).name.split("[0]").join(""),k.pi[r]=h.getUniformLocation(g,r);return l[c]=h=k};a.bv=function(){return A};a.jw=function(){return l};a.cleanup=function(){for(var a in l){var b=l[a];G.deleteProgram(b.ai);
G.deleteShader(b.Zm);G.deleteShader(b.bp);delete l[a]}for(var c in z)delete z[c];for(var d in A)delete A[d]};a.$A=function(a){var b=a.be;n.log("Shader: "+a.si+" "+a.Ch+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)n.log("  "+b[a][0],b[a][1])};a.s=m;a.bo=function(a,b){return b in a.pi?!0:!1};a.Cw=function(a){return(G.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,p){function c(a){return 65536<a.H?G.gp()?!1:!0:!1}function b(a){return 0<a.ba.length?!0:!1}function e(a,c,e){if(!b(a))return a;e||l.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.H*(c||1)+", will use drawArrays","color: #aa0");c=a.ba;e=a.H;var f=a.D,h=a.u,g;for(g in f){var q=f[g],k=x(q,e);f[g]=d(c,q,k)}for(f=0;f<h.length;f++){var m=h[f];for(g in m)q=m[g],k=x(q,e),m[g]=d(c,q,k)}a.H=c.length;a.ba=new Uint16Array(0);return a}function d(a,b,c){if(0==
b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var f=a[e],h=0;h<c;h++)d[c*e+h]=b[c*f+h];return d}function g(a,b){var c=a.$c,d=a.Rb[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function k(b,c){var d,e;switch(c){case a.hh:case a.Ai:d=H.TRIANGLES;e=H.STATIC_DRAW;break;case a.hn:d=H.POINTS;e=H.STATIC_DRAW;break;case a.gn:d=H.TRIANGLES;e=H.DYNAMIC_DRAW;break;case a.Wr:d=H.POINTS;e=H.DYNAMIC_DRAW;
break;case a.Xr:d=H.LINES;e=H.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.ri=e}function f(a){a.he?(a.Dd||(a.Dd=H.createBuffer()),H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,a.Dd),H.bufferData(H.ELEMENT_ARRAY_BUFFER,a.he,a.ri),a.aj=a.he.byteLength):a.aj=0;a.Tf||(a.Tf=H.createBuffer());H.bindBuffer(H.ARRAY_BUFFER,a.Tf);H.bufferData(H.ARRAY_BUFFER,a.$c,a.ri);a.Eo=a.$c.byteLength}function m(a){for(var b=A.vb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].ba.length;b.ba=new Uint32Array(c);
for(d=c=0;d<a.length;d++)c+=a[d].H;b.H=c;var e=a[0],f;for(f in e.D){for(d=c=0;d<a.length;d++)c+=a[d].D[f].length;b.D[f]=new Float32Array(c)}for(f in e.u[0]){for(d=c=0;d<a.length;d++)c+=a[d].u[0][f].length;for(d=0;d<e.u.length;d++)b.u[d]=b.u[d]||{},b.u[d][f]=new Float32Array(c)}for(e=d=c=0;e<a.length;e++){f=a[e];for(var h=f.ba,g=f.H,q=f.D,l=0;l<h.length;l++)b.ba[c+l]=h[l]+d;var c=c+h.length,k;for(k in q){var h=q[k],m=d*x(h,g);b.D[k].set(h,m)}for(l=0;l<f.u.length;l++){var q=f.u[l],n=b.u[l];for(k in q)h=
q[k],m=d*x(h,g),n[k].set(h,m)}d+=g}return b}function h(a,b,c,d,f,h){var g=A.vb("SUBMESH_"+a.name+"_"+b),k=a.submeshes[b],m=k.base_length,y=a.materials[b];g.H=m;if(r(c,"a_texcoord")){var u=null,x=a.materials[b];b=a.submeshes[b];if(x.texture_slots.length)switch(x=x.texture_slots[0],x.texture_coords){case "UV":x=a.uv_textures.indexOf(x.uv_layer);-1==x||0==x?u=new Float32Array(b.texcoord):1==x&&(u=new Float32Array(b.texcoord2));break;case "ORCO":for(var v=a.b4w_bounding_box,u=new Float32Array(2*b.base_length),
x=(v.max_x+v.min_x)/2,z=(v.max_z+v.min_z)/2,E=v.max_x-v.min_x,v=v.max_z-v.min_z,D=0,N=0;N<b.position.length;N+=3)u[D++]=(b.position[N]-x)/E+.5,u[D++]=(z-b.position[N+2])/v+.5}null===u&&(u=new Float32Array(b.texcoord));b=u}else b=new Float32Array(0);var I,u=k.group;if(r(c,"a_influence")&&d){x=new Float32Array(4*m);z=u.length/m;E=new Float32Array(z);for(v=0;v<z;v++)for(I in E[v]=-1,d)if(D=d[I],D.Nr===v){E[v]=D.wh;break}N=3<z?z:4;d=new Float32Array(N);I=new Uint32Array(N);for(var v=new Float32Array(4),
D=new Float32Array(N),N=new Uint32Array(N),Y=new Float32Array(4),ga=0;ga<m;ga++)d.set(D),I.set(N),v.set(Y),x.set(n(u,z,ga,m,E,d,I,v),4*ga)}else x=new Float32Array(0);I=x;d=f?A.wa(f):{};d.a_color={ef:!0};d.a_color.src=r(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,qc:7}]:[];f={a_texcoord:b,a_influence:I};I=k.vertex_colors;b=k.color;u=a.name;x=[];for(z=0;z<I.length;z++)x.push(I[z].name);for(var H in d)if(z=d[H].src,z.length){for(v=E=0;v<z.length;v++)E+=A.Kf(z[v].qc);f[H]=new Float32Array(E*
m);for(v=D=0;v<z.length;v++){var M=z[v].name,N=z[v].qc,Y=A.Oq(N),R=x.indexOf(M);if(-1==R)throw'B4W Error: vertex color "'+M+'" for mesh "'+u+'" not found.';var ga=I[R].mask,s=A.Kf(ga);(N&ga)!==N&&l.error("B4W Error: Wrong color extraction from "+M+" to "+H+".");for(var V=M=0;V<R;V++)M+=A.Kf(I[V].mask);R=M*m;for(M=0;M<m;M++)for(V=0;3>V;V++)Y[V]&&(f[H][M*E+(D+A.hi(N,V))]=b[R+M*s+A.hi(ga,V)]);D+=s}}else f[H]=new Float32Array(0);H=a.uv_textures;d=k.texcoord;I=k.texcoord2;b=a.name;if(h)for(var ma in h){u=
H.indexOf(ma);if(-1==u)throw'B4W Error: uv map "'+ma+'" for mesh "'+b+'" not found';if(0==u)var pa=new Float32Array(d);else 1==u&&(pa=new Float32Array(I));f[h[ma]]=pa}g.D=f;g.ba=new Uint32Array(k.indices);h=k.position.length/m/3;pa=(ma=r(c,"a_normal")&&k.normal.length?!0:!1)&&r(c,"a_tangent")&&k.tangent.length?!0:!1;H=ma&&y.texture_slots.length&&r(c,"a_tangent")&&"ORCO"==y.texture_slots[0].texture_coords?!0:!1;for(f=0;f<h;f++){y={};d=new Float32Array(3*m);I=new Float32Array(ma?3*m:0);b=new Float32Array(pa||
H?4*m:0);u=f*m*3;x=u+3*m;d.set(k.position.subarray(u,x),0);ma&&(u=f*m*3,x=u+3*m,I.set(k.normal.subarray(u,x),0));if(pa)u=f*m*4,x=u+4*m,b.set(k.tangent.subarray(u,x),0);else if(H)for(u=I,x=b,z=m,l.warn('B4W Warning: Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+a.name+'". Please add a UV-map.'),E=0;E<z;E++)v=B,D=O,v[0]=u[3*E],v[1]=u[3*E+1],v[2]=u[3*E+2],t.cross(v,A.AXIS_Z,D),0==t.length(D)&&t.cross(v,A.AXIS_X,D),t.normalize(D,D),x[4*E]=D[0],x[4*E+1]=
D[1],x[4*E+2]=D[2],x[4*E+3]=1;else if(ma&&r(c,"a_tangent"))for(b=new Float32Array(4*m),f=0;f<b.length;f++)b[f]=1;y.a_position=d;y.a_normal=I;y.a_tangent=b;g.u.push(y)}if(1<h){a=g.u[0];var y={},G;for(G in a)y[G]=new Float32Array(a[G]);g.u.push(y)}r(c,"a_polyindex")&&(e(g,1,!0),g.D.a_polyindex=q(g));return g}function r(a,b){return-1<a.indexOf(b)?!0:!1}function n(a,b,c,d,e,f,h,g){for(var q=!0,l=0;l<b;l++){var k=a[l*d+c];if(-1!==k){var m=e[l];-1!==m&&(f[l]=k,h[l]=m,q=!1)}}if(q)return g;v(f,h,!1);for(l=
a=0;4>l;l++)a+=f[l];if(.01>a)return g;for(l=0;4>l;l++)f[l]/=a;if(.01>Math.abs(f[0]-1))g[0]=h[0]+1;else for(l=0;4>l;l++)g[l]=h[l]+f[l];return g}function x(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function v(a,b,c){var d=a.length,e=d,f=!1;for(c=c?-1:1;1<e||f;){1<e&&(e=Math.floor(e/1.247330950103979));for(var f=!1,h=0;e+h<d;h++)0>c*(a[h]-a[h+e])&&(f=a[h],a[h]=a[h+e],a[h+e]=f,f=b[h],
b[h]=b[h+e],b[h+e]=f,f=!0)}}function u(a,b,c){var d=[],e=[];t.subtract(b,a,d);t.subtract(c,a,e);t.normalize(d,d);t.normalize(e,e);return Math.acos(t.dot(d,e))}function E(a,c,d){c||(c=[]);d=d?a.u[0].a_normal:a.u[0].a_position;if(b(a)){a=a.ba;for(var e=a.length/3,f=0;f<e;f++){var h=new Float32Array(9),g=a[3*f];h[0]=d[3*g];h[1]=d[3*g+1];h[2]=d[3*g+2];g=a[3*f+1];h[3]=d[3*g];h[4]=d[3*g+1];h[5]=d[3*g+2];g=a[3*f+2];h[6]=d[3*g];h[7]=d[3*g+1];h[8]=d[3*g+2];c[f]=h}}else for(f=0;f<d.length;f++)h=new Float32Array(9),
h[0]=d[9*f],h[1]=d[9*f+1],h[2]=d[9*f+2],h[3]=d[9*f+3],h[4]=d[9*f+4],h[5]=d[9*f+5],h[6]=d[9*f+6],h[7]=d[9*f+7],h[8]=d[9*f+8],c[f]=h;return c}function q(a){for(var b=new Float32Array(a.H),c=0;c<a.H;c++)b[c]=c%3;return b}function D(a,b,c){var d=t.dist(a,b);a=t.dist(a,c);b=t.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}var l=p("__print"),z=p("__tsr"),A=p("__util"),G=p("__extensions"),t=p("vec3"),B=new Float32Array(3),O=new Float32Array(3),y=new Float32Array(3);a.gd=10;a.qn=20;a.vA=30;a.Ai=10;a.hn=
20;a.gn=30;a.Wr=40;a.Xr=50;a.hh=a.Ai;var H=null;a.ec=function(a){H=a};a.bB=function(a){var b=_buffers[a];H.deleteBuffer(b.Dd);H.deleteBuffer(b.Tf);delete _buffers[a]};a.ez=function(d,h,g,l){c(d)&&e(d);var q=d.ba,m=d.H,n=d.u,y={},r;for(r in d.D)r in l&&!l[r].ef||(y[r]=d.D[r]);l={he:null,$c:null,Fl:0,count:0,Rb:{},mode:0,ri:0,aj:0,Eo:0,Tf:null,Dd:null,qj:null};if(q.length)if(r=q.length,65536>=m)var u=new Uint16Array(q),v=H.UNSIGNED_SHORT;else u=new Uint32Array(q),v=H.UNSIGNED_INT;else r=m,u=null;var A=
0,z=n.length,B;for(B in n[0])var t=n[0][B],A=A+t.length*z;for(B in y)t=y[B],A+=t.length;B=new Float32Array(A);var A=0,z={},E;for(E in y){var N=y[E];if(t=N.length)B.set(N,A),z[E]={IA:E,Nc:x(N,m),offset:A,frames:1,length:t},A+=t}y=n.length;for(E in n[0])if(N=n[0][E],t=N.length,N=x(N,m),t){z[E]={Nc:N,offset:A,frames:y,length:t};1<y&&(z[E+"_next"]={Nc:N,offset:A+t,frames:y,length:t});for(var I=0;I<y;I++)N=n[I][E],B.set(N,A),A+=t}l.count=r;l.he=u;l.$c=B;l.Fl=v;l.Rb=z;k(l,g);f(l);h!=a.gd&&b(d)&&(l.qj={px:new Float32Array(q.length),
qx:new Float32Array(q.length),nv:new Float32Array(q.length/3),type:h});return l};a.ax=c;a.$w=b;a.Hm=e;a.vz=function(a,b,c){k(a,b);a.count=c.length;a.he=c;a.Fl=c instanceof Uint16Array?H.UNSIGNED_SHORT:H.UNSIGNED_INT};a.hk=function(a,b,c,d){var e=a.$c,h=a.Rb,g=h[b];if(g){if(c&&g.Nc!=c)throw'Error: invalid num_comp for "'+b+'"';e.set(d,g.offset)}else e=e.length,g=new Float32Array(e+d.length),g.set(a.$c),g.set(d,e),a.$c=g,h[b]={Nc:c,offset:e};f(a)};a.wv=g;a.hC=function(a){a.ri=H.STATIC_DRAW};a.jx=function(a){a.ri=
H.DYNAMIC_DRAW};a.Az=f;a.jo=function(a){a.Dd&&H.deleteBuffer(a.Dd);a.Tf&&H.deleteBuffer(a.Tf)};a.zp=function(a,b){return a.submeshes[b].base_length?!1:!0};a.rr=function(a,b){for(var c=0;c<a.u.length;c++){var d=a.u[c].a_position;z.ek(d,b,d,0);d=a.u[c].a_normal;0<d.length&&z.yr(d,b,d,0);d=a.u[c].a_tangent;0<d.length&&z.zr(d,b,d,0)}(c=a.D.au_center_pos)&&c.length&&z.ek(c,b,c,0);return a};a.cz=function(a,b){var c=a.D.au_center_pos;if(c&&c.length){var d=new Float32Array(c);z.ek(d,b,d,0);for(var e=0;e<
a.u.length;e++)for(var f=0;f<d.length;f++)a.u[e].a_position[f]+=d[f]-c[f];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.bz=function(a,b){var c=a.H,d;for(d in b){var e=b[d].length;a.D[d]=new Float32Array(e*c);for(var f=0;f<c;f++)for(var h=0;h<e;h++)a.D[d][f*e+h]=b[d][h]}};a.dz=m;a.ix=function(a,b,c){if(!a.H)return A.vb("EMPTY");var d=c.length;65536<a.H*d&&!G.gp()&&e(a,d);var f=a.ba,h=a.H,g=a.D;a=a.u;for(var l in b){var q=b[l].length,k=q*h;g[l]=new Float32Array(k);
for(var m=0;m<h;m++)for(k=0;k<q;k++)g[l][m*q+k]=b[l][k]}b=A.vb("CLONE_"+d+"_SUBMESHES");b.H=h*d;b.ba=new Uint32Array(f.length*d);for(m=0;m<d;m++)for(q=f.length*m,l=h*m,k=0;k<f.length;k++)b.ba[q+k]=f[k]+l;for(var n in g)for(f=g[n],k=f.length*d,q=x(f,h),b.D[n]=new Float32Array(k),m=0;m<d;m++)l=h*q*m,b.D[n].set(f,l);for(n in a[0])for(m=0;m<a.length;m++)for(f=a[m][n],k=f.length*d,q=x(f,h),b.u[m]=b.u[m]||{},b.u[m][n]=new Float32Array(k),k=0;k<d;k++)switch(g=c[k],l=h*q*k,n){case "a_position":z.ek(f,g,b.u[m][n],
l);break;case "a_normal":z.yr(f,g,b.u[m][n],l);break;case "a_tangent":z.zr(f,g,b.u[m][n],l);break;default:throw"Wrong attribute name: "+n;}return b};a.To=h;a.zv=function(a){var b=a.H,c=a.u[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint16Array(4*a.ba.length);for(var f=0;f<b;f++)d[12*f]=c[3*f],d[12*f+1]=c[3*f+1],d[12*f+2]=c[3*f+2],d[12*f+3]=c[3*f],d[12*f+4]=c[3*f+1],d[12*f+5]=c[3*f+2],d[12*f+6]=c[3*f],d[12*f+7]=c[3*f+1],d[12*f+8]=c[3*f+2],d[12*f+9]=c[3*f],d[12*f+10]=c[3*f+
1],d[12*f+11]=c[3*f+2],e[8*f]=-.5,e[8*f+1]=-.5,e[8*f+2]=-.5,e[8*f+3]=.5,e[8*f+4]=.5,e[8*f+5]=.5,e[8*f+6]=.5,e[8*f+7]=-.5,a[6*f]=4*f+2,a[6*f+1]=4*f+1,a[6*f+2]=4*f,a[6*f+3]=4*f+2,a[6*f+4]=4*f,a[6*f+5]=4*f+3;c=A.vb("HALO");c.u=[];c.u[0]={};c.H=4*b;c.u[0].a_position=d;c.D.a_halo_bb_vertex=e;c.ba=a;return c};a.Lw=r;a.Av=function(a){for(var b=["a_position","a_normal"],c=[],d=0;d<a.submeshes.length;d++){var e=h(a,d,b,null,null,null);e.H&&c.push(e)}return 0==c.length?A.vb("EMPTY"):1==c.length?c[0]:m(c)};
a.uz=function(a,b,c){for(var d=a.he,e=g(a,"a_position"),f=a.qj,h=f.px,l=f.qx,f=f.nv,q=d,k=q.length/3,m=0;m<k;m++){var n=q[3*m],y=q[3*m+1],r=q[3*m+2],u=e[3*n+1],v=e[3*n+2],x=e[3*y+1],I=e[3*y+2],Y=e[3*r+1],ga=e[3*r+2];h[3*m]=(e[3*n]+e[3*y]+e[3*r])/3;h[3*m+1]=(u+x+Y)/3;h[3*m+2]=(v+I+ga)/3}A.pe(h,b,l);b=h.length/3;for(e=0;e<b;e++)l=h[3*e]-c[0],q=h[3*e+1]-c[1],k=h[3*e+2]-c[2],f[e]=l*l+q*q+k*k;c=d;d=f.length;if(!(2>d))for(h=d,e=!1;1<h||e;)for(1<h&&(h=Math.floor(h/1.247330950103979)),e=!1,b=0;h+b<d;b++)0>
f[b]-f[b+h]&&(e=f[b],f[b]=f[b+h],f[b+h]=e,e=c,l=b,q=b+h,k=e[3*l],m=e[3*l+1],n=e[3*l+2],e[3*l]=e[3*q],e[3*l+1]=e[3*q+1],e[3*l+2]=e[3*q+2],e[3*q]=k,e[3*q+1]=m,e[3*q+2]=n,e=!0);d=c;H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,a.Dd);H.bufferData(H.ELEMENT_ARRAY_BUFFER,d,H.DYNAMIC_DRAW)};a.Ny=v;a.Un=function(a,b,c){for(var d=b.length/3,e=a.length/3,f=[],h=Array(3),g=Array(3),l=Array(3),q=0;q<e;q++){for(var k=a[3*q],m=a[3*q+1],n=a[3*q+2],y=0;3>y;y++)h[y]=b[3*k+y],g[y]=b[3*m+y],l[y]=b[3*n+y];if(c)var y=u(h,g,l),
r=u(g,l,h),v=Math.PI-y-r;else v=r=y=1;var x=f,I;I=h;var Y=l,A=[],z=[],M=[];t.subtract(g,I,A);t.subtract(Y,I,z);t.cross(A,z,M);t.normalize(M,M);I=M;for(Y=0;3>Y;Y++)A=3*m+Y,z=3*n+Y,x[3*k+Y]=y*I[Y],x[A]=r*I[Y],x[z]=v*I[Y]}if(c)for(var R in c)for(q=c[R],a=0;3>a;a++){b=3*q[0]+a;for(e=1;e<q.length;e++)h=3*q[e]+a,f[b]+=f[h];for(e=1;e<q.length;e++)h=3*q[e]+a,f[h]=f[b]}for(q=0;q<d;q++){c=q;R=f;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=R[e];t.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,R[e]=a[b]}return f};
a.Wn=function(a,b,c){for(var d={},e=b.length/3,f=0;f<e;f++){var h=String(b[3*f])+String(b[3*f+1])+String(b[3*f+2]);d[h]=[]}e=a.length;for(f=0;f<e;f++)b=a[f],h=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),h in d&&d[h].push(b);return d};a.ql=function(a,b,c,d){var e=E(a,null,!1);if(c)var f=E(a,null,!0);var h=e.length,g=new Float32Array(h),l=B,q=O;for(a=0;a<h;a++){var k=e[a];l.set(k.subarray(0,3));q.set(k.subarray(3,6));y.set(k.subarray(6));g[a]=Math.sqrt(D(l,q,y))}l=new Float32Array(h);l[0]=g[0];
for(a=1;a<h;a++)l[a]=l[a-1]+g[a];h=l[g.length-1];g=[];for(a=0;a<b;a++){var q=h*A.sc(d),q=A.Ni(l,q,0,l.length-1),k=c?f[q]:e[q],q=a,m=k,n=d,k=void 0,k=new Float32Array(3),r=m[0],u=m[1],v=m[2],x=m[3],I=m[4],Y=m[5],z=m[6],t=m[7],M=m[8],m=A.sc(n),n=A.sc(n);1<m+n&&(m=1-m,n=1-n);var R=1-m-n,u=R*u+m*I+n*t,v=R*v+m*Y+n*M;k[0]=R*r+m*x+n*z;k[1]=u;k[2]=v;g[q]=k}return g};a.hB=E;a.So=q;a.GC=D;a.tw=function(a,b,c,d){var e=b[0]-a[0],f=c[0]-a[0],h=b[1]-a[1],g=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=h*a-b*g;d[1]=f*
b-e*a;d[2]=e*g-h*f;return d};a.ey=function(a,b,c){a=a.u[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]}};b4w.module.__objects=function(a,p){function c(a){a={type:a,sd:0,Kw:[0,0],g:new Float32Array(3),quat:new Float32Array(4),Pd:new Float32Array(8),K:new Float32Array(16),Hp:new Float32Array(16),Ta:new Float32Array(3),Cd:new Float32Array(3),tg:0,je:0,bk:!1,Ir:!1,O:0,Vm:1,Um:1,Wm:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,$e:null,Cr:!1,ud:0,fg:0,sb:!1,Ha:null,Fa:null,Ra:null,Mo:!0,J:null,hj:null,Eh:0,zh:0,ml:0,Rh:0,wf:0,Aq:"",ik:!1,Ub:!1,Bb:!1,Vb:!1,dc:!1,Tb:!1,zc:!1,Ue:!1,ad:!1,cj:!1,wd:!1,Ca:!1,
gg:!1,Kh:!1,zj:!1,Qc:!1,Jj:!1,vj:!1,is_visible:!1,wi:0,bd:0,Je:0,ae:0,$d:0,Yd:0,Gd:"",Gb:null,Mi:!1,md:!1,oh:"",Fk:!1,cf:0,time:0,Tm:0,Kr:0,max_bones:0,Dh:!1,lk:!1,Nh:!1,Vd:!1,Ud:1,vk:0,uk:1,fk:new Int8Array([-1,-1]),Yj:[],Zp:[],br:[],cc:null,bc:null,kc:null,jc:null,nc:null,Bq:null,yf:null,Sh:null,Kb:null,Ck:null,Ak:null,Bk:null,Ma:null,wc:null,tb:null,Se:null,Te:null,scale:1,le:1E4};D.identity(a.quat);E.identity(a.Pd);z.identity(a.K);z.identity(a.Hp);return a}function b(a,b,c,d){var e=a.d.Aa,f;for(f in e){var h=
a.name+"_"+f;f in d||(d[f]=b.length,b.push(e[f][0]));c.push(h,d[f])}}var e=p("__animation"),d=p("__batch"),g=p("__boundings"),k=p("__camera"),f=p("__config"),m=p("__constraints"),h=p("__curve"),r=p("__lights"),n=p("__nla"),x=p("__particles");p("__print");var v=p("__scenes"),u=p("__transform"),E=p("__tsr"),q=p("__util"),D=p("quat"),l=p("vec3"),z=p("mat4"),A=f.p,G=0,t=new Float32Array(4);a.Yi=c;a.Sm=function(a,f){var y;y=a.parent;if(!(y=y&&y.sn)){if(!(y="ARMATURE"===a.type||"CAMERA"===a.type)&&(y="MESH"===
a.type)){var D=e.sj(a),p=a.b4w_do_not_batch,Z=a.b4w_dynamic_geometry,J=a.b4w_collision,F=a.b4w_vehicle,U=a.b4w_floating;y=a.b4w_character;var K=a.b4w_billboard,S=x.Nw(a),T=n.Ap(a);if(!(D=D||p||Z||J||F||U))a:{D=a.data;for(p=0;p<D.materials.length;p++)if("LENS_FLARES"===D.materials[p].name){D=!0;break a}D=!1}y=D||S||y||K||T}!y&&(y="EMPTY"===a.type)&&(y=e.sj(a),K=n.Ap(a),y=y||K)}y=y?!0:!1;a.sn=y;a.d=c("MESH"===a.type?y?"DYNAMIC":"STATIC":a.type);a.jb=null;a.Sd=[];a.Jb||(a.Jb=null);y=a.d;S=a.location;
K=a.scale[0];q.Kx(a.rotation_quaternion,t);u.set_translation(a,S);u.set_rotation(a,t);u.set_scale(a,K);switch(a.type){case "ARMATURE":S=a.pose.bones;for(K=0;K<S.length;K++)T=S[K],D=T.bone,p=new Float32Array(D.matrix_local),Z=new Float32Array(16),z.invert(p,Z),J=new Float32Array(T.matrix_basis),F=new Float32Array(3),l.subtract(D.tail_local,D.head_local,F),q.Sz(F,Z,F),T.mt=F,T.gt=[T].concat(T.parent_recursive),T.un=E.ap(p,E.create()),T.tn=E.ap(J,E.create()),T.rk=E.create(),T.Fi=!1;S=e.Zt(a);y.nc=S;
S=e.Vn(a,S);a.b4w_animation_mixing?(y.cc=new Float32Array(S.pa),y.bc=new Float32Array(S.pa),y.kc=new Float32Array(S.g),y.jc=new Float32Array(S.g)):(y.cc=S.pa,y.bc=S.pa,y.kc=S.g,y.jc=S.g);y.Bq=S;y.cf=0;y.Vd=a.b4w_animation_mixing;break;case "MESH":y.Qc=A.all_objs_selectable||a.b4w_selectable;y.Jj=a.b4w_selectable;y.md=a.b4w_billboard;y.Ut=a.b4w_pres_glob_orientation;y.oh="BASIC";y.Fk="SPHERICAL"==a.b4w_billboard_geometry;y.hj={Fw:a.b4w_glow_settings.glow_duration,Hw:a.b4w_glow_settings.glow_period,
Iw:a.b4w_glow_settings.glow_relapses};y.Qc&&(a.rn=q.Ov(G),G++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.lk=a.data.b4w_vertex_anim.length?!0:!1;if(K=e.get_first_armature_object(a)){S=a.d;T=a.data.vertex_groups;if(T.length){D=K.data.bones;p=K.pose.bones;Z=0;J={};for(F=0;F<D.length;F++){var U=D[F].name,ba=q.keysearch("name",U,T);if(ba){var P=q.vl(p,"name",U);J[U]={Sn:F,wh:Z++,jm:P,Nr:ba.index}}}S.nc=J;S.max_bones=Z;S.Nh=!0}S=a.d.nc;S=e.Vn(K,S);K.b4w_animation_mixing?(y.cc=new Float32Array(S.pa),
y.bc=new Float32Array(S.pa),y.kc=new Float32Array(S.g),y.jc=new Float32Array(S.g)):(y.cc=S.pa,y.bc=S.pa,y.kc=S.g,y.jc=S.g);y.Bq=S;y.cf=0}if(e.Cl(a)){K=a.d;S=a.data.materials;T=[];D=[];for(p=0;p<S.length;p++)if((Z=S[p].node_tree)&&Z.animation_data)for(F=Z.animation_data,Z={},(J=F.action)&&b(J,T,D,Z),F=F.nla_tracks,U=0;U<F.length;U++)for(ba=F[U].strips,P=0;P<F[U].strips.length;P++)J=ba[P].action,b(J,T,D,Z);K.yf=T;K.Sh=D}a.V=[];y.Ub=a.b4w_shadow_cast;y.Bb=a.b4w_shadow_receive;y.Vb=a.b4w_shadow_cast_only&&
y.Ub;y.dc=a.b4w_reflexible;y.Tb=a.b4w_reflexible_only&&y.dc;y.zc=a.b4w_reflective;y.Ue=a.b4w_caustics;y.ad=a.b4w_wind_bending;y.wi=a.b4w_wind_bending_angle;K=d.Zz(a.b4w_wind_bending_angle,d.Qt(a.data.b4w_bounding_box),a.scale[0]);y.bd=K;y.Je=a.b4w_wind_bending_freq;y.ae=a.b4w_detail_bending_freq;y.$d=a.b4w_detail_bending_amp;y.Yd=a.b4w_branch_bending_amp;y.Kh=!1;y.Gd=a.b4w_main_bend_stiffness_col;K=a.b4w_detail_bend_colors;y.Gb={};y.Gb.Sp=K.leaves_stiffness_col;y.Gb.Rp=K.leaves_phase_col;y.Gb.hq=
K.overall_stiffness_col;y.gg=a.b4w_do_not_cull;y.cj=a.b4w_disable_fogging;y.wd=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";K=a.data.materials[0];y.Eh=K.physics.friction;y.zh=K.physics.elasticity;y.Rh=0;y.le=1E4;y.wf=a.b4w_lod_transition;y.zj=!0;break;case "CAMERA":k.cu(a);k.Mt(a);break;case "LAMP":r.ex(a);break;case "CURVE":if(K=h.Su(a))a.lt=K;break;case "EMPTY":y.Kb=g.cd(),K=g.xi(),y.wc=K}if(!f&&(a.parent&&"OBJECT"==a.parent_type?(S=y.g,T=y.quat,K=y.scale,m.Cn(a,a.parent,S,T,K)):
a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(S=y.g,T=y.quat,K=y.scale,m.Bn(a,a.parent,a.parent_bone,S,T,K)):a.Jb&&a.Jb.b4w_group_relative?(K=E.eg(y.g,y.scale,y.quat),m.st(a,a.Jb,K)):a.Jb&&!a.Jb.b4w_group_relative&&(u.v(a),T=y.K,z.multiply(a.Jb.d.K,T,T),S=q.xf(T),K=q.Bj(T),T=q.matrix_to_quat(T),u.set_translation(a,S),u.set_rotation(a,T),u.set_scale(a,K)),K=a.dupli_group))for(S=K.objects,K=0;K<S.length;K++)S[K].Jb=a;a.field&&(y.ml=a.field.strength,v.Fr(a));y.ik=a.game.use_collision_compound;
y.Aq=a.game.physics_type;u.v(a)};a.Dz=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.d||"DYNAMIC"!=c.d.type&&"CAMERA"!=c.d.type||u.v(c);c.b4w_use_default_animation&&e.sj(c)&&(e.apply_def(c),c.C&&e.play(c,null,e.SLOT_ALL))}};a.tj=function(a){return"MESH"==a.type&&a.sn?!0:!1};a.get_meta_tags=function(a){a=a.b4w_object_tags;return{title:a.title,description:a.description,category:a.category}};a.cleanup=function(){G=0}};b4w.module.__particles=function(a,p){function c(){throw"_rand() undefined";}function b(a,b,c,d,e,f,h){var g=a.L.dl,k=a.L.Kc,r=a.L.time;a=a.L.Cq;for(var B=b?4:1,p=0;p<g.length;p+=B){var y=g[p];if(y>a&&y<=r)for(y=0;8>y;y++)k[8*p+y]=e[y];for(y=0;8>y;y++)n[y]=k[8*p+y];y=x;y[0]=c[3*p];y[1]=c[3*p+1];y[2]=c[3*p+2];m.oi(y,n,y);f[3*p]=y[0];f[3*p+1]=y[1];f[3*p+2]=y[2];var H=x;H[0]=d[3*p];H[1]=d[3*p+1];H[2]=d[3*p+2];m.dk(H,n,H);h[3*p]=H[0];h[3*p+1]=H[1];h[3*p+2]=H[2];if(b)for(y=1;4>y;y++)f[3*(p+y)]=f[3*p],f[3*
(p+y)+1]=f[3*p+1],f[3*(p+y)+2]=f[3*p+2],h[3*(p+y)]=H[0],h[3*(p+y)+1]=H[1],h[3*(p+y)+2]=H[2]}}function e(a){a?(f.Zy(a),c=function(){return f.Mx()}):c=function(){return Math.random()}}var d=p("__config"),g=p("__geometry"),k=p("__scenes"),f=p("__util"),m=p("__tsr"),h=p("vec3"),r=d.hd,n=new Float32Array(8),x=new Float32Array(3);a.sg=function(a){return 0<a.particle_systems.length?!0:!1};a.pj=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.HB=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.Nw=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.Tv=function(a,d,m,q){m.L=m.L||{};var k=g.Av(d),l=m.settings.count,n=m.settings.frame_start/r.za,x=m.settings.frame_end/r.za,p=m.settings.lifetime/r.za,t=m.settings.lifetime_random,B=m.settings.emit_from,O=
m.settings.factor_random,y=m.settings.angular_velocity_mode,H=m.settings.angular_velocity_factor,L=m.settings.b4w_randomize_emission,Z=m.settings.b4w_cyclic;e(m.seed);var J=m.L.Pz="WORLD"==m.settings.b4w_coordinate_system?!0:!1;m.L.frame=0;if(d=!a.hf){var F;F=[];for(var U=0;U<l;U++)F.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);F=new Float32Array(F);for(var U=[],K=0;K<l;K++)U.push(4*K,4*K+2,4*K+1,4*K,4*K+3,4*K+2);U=new Uint16Array(U)}switch(B){case "VERT":for(var K=k.u[0].a_position,k=k.u[0].a_normal,S=K.length/
3,B=[],T=0;T<l;T++){var ba=Math.round((S-1)*c());B.push(ba);d&&(B.push(ba),B.push(ba),B.push(ba))}S=[];for(T=0;T<B.length;T++)S.push(K[3*B[T]]),S.push(K[3*B[T]+1]),S.push(K[3*B[T]+2]);K=new Float32Array(S);S=[];for(T=0;T<B.length;T++)S.push(k[3*B[T]]),S.push(k[3*B[T]+1]),S.push(k[3*B[T]+2]);B=new Float32Array(S);break;case "FACE":K=[];B=[];T=[];f.rj(0,T);S=g.ql(k,l,!1,T);f.rj(0,T);k=g.ql(k,l,!0,T);for(T=0;T<S.length;T++)K.push(S[T][0],S[T][1],S[T][2]),d&&(K.push(S[T][0],S[T][1],S[T][2]),K.push(S[T][0],
S[T][1],S[T][2]),K.push(S[T][0],S[T][1],S[T][2])),B.push(k[T][0],k[T][1],k[T][2]),d&&(B.push(k[T][0],k[T][1],k[T][2]),B.push(k[T][0],k[T][1],k[T][2]),B.push(k[T][0],k[T][1],k[T][2]));K=new Float32Array(K);B=new Float32Array(B);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}B=[K,B];k=B[0];B=B[1];m.L.Fx=new Float32Array(k);m.L.wx=new Float32Array(B);m.L.Gx=new Float32Array(k.length);m.L.xx=new Float32Array(B.length);m.L.time=0;m.L.Cq=
-1;K=[];x=(x-n)/l;for(S=0;S<l;S++)T=L?x*S+10*x*(.5-c()):x*S,Z||(T+=n),K.push(T),d&&(K.push(T),K.push(T),K.push(T));n=new Float32Array(K);m.L.dl=new Float32Array(n);m.L.Fo=new Float32Array(n);m.L.Kc=new Float32Array(8*n.length);for(L=0;L<8*n.length;L++)for(Z=0;8>Z;Z++)m.L.Kc[8*L+Z]=q[Z];J&&b(m,d,k,B,q,k,B);m=[];q=p*t;for(t=0;t<l;t++)J=q*c(),m.push(p-J),d&&(m.push(p-J),m.push(p-J),m.push(p-J));p=new Float32Array(m);m=[];for(q=0;q<l;q++){t=[c()-.5,c()-.5,c()-.5];h.normalize(t,t);m.push(O*t[0]);m.push(O*
t[1]);m.push(O*t[2]);switch(y){case "NONE":m.push(0);break;case "SPIN":case "VELOCITY":m.push(H);break;case "RAND":m.push(2*H*(c()-.5));break;default:throw"Undefined velocity factor";}if(d)for(t=m.slice(-4),J=0;12>J;J++)m.push(t[J%4])}l=new Float32Array(m);O=f.vb("EMITTER_PARTICLES");y=f.rd();y.a_position=k;y.a_normal=B;O.u[0]=y;d?O.ba=U:(a.vd=g.hn,O.ba=new Uint16Array(0));O.H=k.length/3;O.D.a_p_delay=n;O.D.a_p_lifetime=p;O.D.a_p_vels=l;d&&(O.D.a_p_bb_vertex=F);return O};a.zz=function(a){for(var c=
a.V,d=0;d<c.length;d++){var e=c[d],f=c[d].Oc;if(f){var h=e.lb;if(!f.L.Pz)break;var m=f.L.Gx,k=f.L.xx;b(f,!e.hf,f.L.Fx,f.L.wx,a.d.Pd,m,k);g.jx(h);g.hk(h,"a_position",3,m);g.hk(h,"a_normal",3,k)}}};a.oy=function(a,b,c){var d=b.settings.lifetime/r.za,e=b.settings.normal_factor,f=9.81*b.settings.effector_weights.gravity,h=b.settings.effector_weights.wind,g=b.settings.mass,m=b.settings.b4w_fade_in/r.za,n=b.settings.b4w_fade_out/r.za,x=b.settings.b4w_cyclic;a.qq=b.settings.frame_end/r.za-b.settings.frame_start/
r.za;a.mq=x?1:0;a.fm=e;a.pq=f;e=k.Ew();a.Kj[0]=e[0]*h;a.Kj[1]=e[1]*h;a.Kj[2]=e[2]*h;a.sq=d;a.rq=g;a.nq=m;a.oq=n;a.hf?(d=c.halo.size,h=c.halo.hardness,30>h?(h=.5,g=.9):40>h?(h=.1,g=1):50>h?(h=0,g=.8):(h=0,g=.5)):(d=b.settings.particle_size,g=h=1);a.gm=d;a.jq=h;a.iq=g;d=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;h=Math.min(2*d.length,b.length);for(g=0;g<h;g+=2)m=
d[g/2],b[g]=m.position,b[g+1]=(m.color[0]+m.color[1]+m.color[2])/3;a.uq=d.length}a.tq.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;h=Math.min(4*d.length,c.length);for(g=0;g<h;g+=4)m=d[g/4],c[g]=m.position,c[g+1]=m.color[0],c[g+2]=m.color[1],c[g+3]=m.color[2];a.lq=d.length}a.kq.set(c)};a.yy=function(a,b){a.L.Cq=a.L.time;a.L.time=b};a.Hx=
function(a){for(var b=a.H,c=a.u[0].a_position,d=a.D.a_texcoord,e=[],f=[],h=0;h<b;h++)f.push(c[3*h]),f.push(c[3*h+1]),e.push(c[3*h+2]);e=new Float32Array(e);f=new Float32Array(f);a.D.a_lf_dist=e;a.D.a_lf_bb_vertex=f;a.D.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.V;for(var d=0;d<a.length;d++){var e=a[d],f=e.Oc;f&&f.name==b&&(e.gm=c)}};a.set_normal_factor=function(a,b,c){a=a.V;for(var d=0;d<a.length;d++){var e=a[d],f=e.Oc;f&&f.name==b&&(e.fm=c)}};a.set_factor=function(a,b,c){a=a.V;for(var d=
0;d<a.length;d++){var e=a[d],f=e.Oc;if(f&&f.name==b){var h=f.L.dl;if(1==c)f=h;else if(0==c)for(var m=!e.hf,k=m?4:1,f=f.L.Fo,n=0;n<f.length;n+=k)f[n]=1E4,m&&(f[n+1]=f[n],f[n+2]=f[n],f[n+3]=f[n]);else for(var r=1/c,f=f.L.Fo,k=(m=!e.hf)?4:1,x=0,n=0;n<f.length;n+=k)n>=x?(f[n]=h[n],x+=r):f[n]=1E4,m&&(f[n+1]=f[n],f[n+2]=f[n],f[n+3]=f[n]);g.hk(e.lb,"a_p_delay",1,f)}}};a.Kz=function(a,b,c){a=a.particle_systems;for(var d=0;d<a.length;d++){var e=a[d];if("EMITTER"==e.settings.type)for(var f=e.L.dl,d=0;d<8*f.length;d++)e.L.Kc[8*
d]=b[0],e.L.Kc[8*d+1]=b[1],e.L.Kc[8*d+2]=b[2],e.L.Kc[8*d+3]=b[3],e.L.Kc[8*d+4]=c[0],e.L.Kc[8*d+5]=c[1],e.L.Kc[8*d+6]=c[2],e.L.Kc[8*d+7]=c[3]}}};b4w.module.__primitives=function(a,p){function c(a,b,c,d){for(var e=[],f=[],g=[],p=[],q=2*c/(a-1),D=2*d/(b-1),l=0;l<a;l++)for(var z=-c+l*q,A=0;A<b;A++)if(f.push(z,0,-d+A*D),g.push(0,1,0),p.push(l/(a-1),A/(b-1)),l&&A){var G=l*b+A,t=G-1,B=(l-1)*b+A,O=B-1;e.push(G,t,B);e.push(t,O,B)}a=k.rd();a.a_position=new Float32Array(f);a.a_normal=new Float32Array(g);g=k.vb("GRID_PLANE");g.u[0]=a;g.D.a_texcoord=new Float32Array(p);g.ba=new Uint32Array(e);g.H=f.length/3;return g}function b(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],e=[],f=0;f<b;f+=4){var g=a[f+1],u=a[f+2],p=a[f+3];d(a[f],e);d(g,e);d(u,e);d(p,e);c.push(f,f+1,f+2);c.push(f,f+2,f+3)}a=k.rd();a.a_position=new Float32Array(e);b=k.vb("FROM_QUADS");b.u[0]=a;b.ba=new Uint32Array(c);b.H=e.length/3;return b}function e(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function d(a,b){b.push(a[0],a[1],a[2])}var g=p("__geometry"),k=p("__util"),f=p("__config").p;a.xB=function(a){for(var b=k.vb("LINE"),c=[],d=0;d<2*a;d++)c.push(d);d=k.rd();d.a_point=
new Float32Array(c);b.u[0]=d;b.ba=new Uint32Array(c);b.H=2*a;return b};a.yB=function(a,b){var d=c(2,2,a,b);d.name="PLANE";return d};a.wB=c;a.Xv=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==p-1)||1==b%2&&(0==a||a==u-1)?!0:!1}var e=c/=Math.pow(2,a-1),v=c,u=b+1,p=b+1;b=[];c=[];for(var q=0,D=0,l=-1,z=[],A=0;A<a;A++){for(var G=2*e/(u-1),t=2*v/(p-1),B=[],O=[],y=0,H=0;H<u;H++){for(var L=-e+H*G,Z=[],J=0;J<p;J++){var F=-v+J*t;if(L>-q&&L<q&&F>-D&&F<D)Z.push(-1),y++;else{for(var U=null,K=0;K<z.length;K+=
3)if(L==z[K]&&F==z[K+1]){U=z[K+2];break}K=null!==U?U:l+1;d(H,J)?(Z.push(-2),y++):(null==U&&(0==J||J==p-1||0==H||H==u-1?(U=A==a-1?G:2*G,B.push(L,F,K)):U=G,c.push(L,U,F),l++),Z.push(K));if(H&&J)if(1==H)if(d(H-1,J)){if(1<J){var F=K-1,U=O[H-1][J+1],S=U-1;b.push(K,F,S)}else U=O[H-1][J+1],S=U-1;b.push(K,S,U)}else d(H,J)||(F=K-1,U=O[H-1][J],b.push(K,F,U));else if(H==u-1){if(!d(H,J))if(J==p-1)F=K-1,U=O[H-1][J-1],S=O[H-2][J],b.push(K,F,U),b.push(K,U,S);else{var F=K-1,U=O[H-1][J],S=U-1,T=U+1;b.push(K,F,S);
b.push(K,S,U);b.push(K,U,T);2==J&&(T=O[H-2][J-2],b.push(F,T,S))}}else 1==J?d(H,J-1)?(F=O[H-1][J],U=O[H-1][J-1],b.push(K,U,F)):(F=Z[J-1],U=O[H-1][J],S=O[H-2][J-1],b.push(K,F,U),b.push(F,S,U)):J==p-1?d(H,J)||(F=Z[J-1],U=O[H-1][J-1],S=O[H-2][J],b.push(K,F,U),b.push(K,U,S)):-1!=O[H-1][J]&&-1!=O[H-1][J-1]&&-1!=Z[J-1]?(F=Z[J-1],U=O[H-1][J],S=O[H-1][J-1],b.push(K,F,U),b.push(F,S,U),J==p-2&&d(H,J+1)&&(T=O[H-1][J+1],b.push(K,U,T))):J==p-2&&d(H,J+1)&&(U=O[H-1][J],T=O[H-1][J+1],b.push(K,U,T))}}O.push(Z)}z=B;
q=e;D=v;e*=2;v*=2}2E4>q&&(a=-(2*q)/(u-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-q,a,-D),c.push(-q,a,D),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(q,a,-D),c.push(q,a,D),K=l+1,b.push(K+3,K+2,K+1,K+2,K+0,K+1,K+6,K+4,K+2,K+4,K+0,K+2,K+5,K+7,K+1,K+7,K+3,K+1,K+5,K+4,K+7,K+7,K+4,K+6));a=k.rd();a.a_position=new Float32Array(c);e=k.vb("multigrid_plane");e.u[0]=a;e.ba=new Uint32Array(b);e.H=c.length/3;f.Sr&&(g.Hm(e,1,!0),a.a_polyindex=g.So(e));return e};a.vB=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var c=[],e=[],f=0;f<b;f+=3){var g=a[f+1],u=a[f+2];d(a[f],e);d(g,e);d(u,e);c.push(f,f+1,f+2)}a=k.rd();a.a_position=new Float32Array(e);b=k.vb("FROM_TRIANGLES");b.u[0]=a;b.ba=new Uint32Array(c);b.H=e.length/3;return b};a.uB=b;a.Uv=function(a){a=k.Tz(a);var c=[];c.push(a[0],a[1],a[2],a[3]);c.push(a[0],a[3],a[5],a[4]);c.push(a[3],a[2],a[6],a[5]);c.push(a[1],a[7],a[6],a[2]);c.push(a[0],a[4],a[7],a[1]);c.push(a[4],a[5],a[6],a[7]);a=b(c);a.name="FRUSTUM";return a};a.Vv=function(){var a=k.vb("BILLBOARD"),
b=k.rd();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.u[0]=b;a.ba=new Uint32Array([0,2,1,1,2,3]);a.H=4;return a};a.Ga=function(){var a=k.vb("BILLBOARD"),b=k.rd();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.u[0]=b;a.ba=new Uint32Array([0,2,1,0,3,2]);a.H=4;return a};a.Rv=function(){var a=k.vb("CUBEMAP_BOARD"),b=k.rd();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.u[0]=b;a.ba=new Uint32Array([0,2,1,0,3,2]);a.H=4;return a};a.dp=function(a,b){var c=k.vb("UV_SPHERE"),
f,x,v=[],u=[],p=[];for(x=0;8>=x;x++)for(f=0;16>=f;f++){var q=f/16,D=x/8;u.push(-a*Math.cos(2*q*Math.PI)*Math.sin(D*Math.PI)+b[0],a*Math.cos(D*Math.PI)+b[1],a*Math.sin(2*q*Math.PI)*Math.sin(D*Math.PI)+b[2])}for(x=q=0;8>x;x++)for(f=0;16>f;f++){var D=e(u,17*x+f+1),l=e(u,17*x+f),z=e(u,17*(x+1)+f),A=e(u,17*(x+1)+f+1);Math.abs(D[1])==a+b[1]?(d(D,v),d(z,v),d(A,v),p.push(q,q+1,q+2),q+=3):Math.abs(z[1])==a+b[1]?(d(D,v),d(l,v),d(z,v),p.push(q,q+1,q+2),q+=3):(d(D,v),d(l,v),d(z,v),d(A,v),p.push(q,q+1,q+2),p.push(q,
q+2,q+3),q+=4)}f={};f.a_position=v;u=g.Wn(p,u,v);f.a_normal=g.Un(p,v,u);f.a_tangent=[];c.D.a_influence=[];c.D.a_color=[];c.D.a_texcoord=[];c.u[0]=f;c.ba=p;c.H=v.length/3;return c}};b4w.module.__prerender=function(a,p){var c=p("__config"),b=p("__debug"),e=p("__geometry"),d=p("__util"),g=p("__renderer"),k=p("vec3"),f=c.p,m="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH GLOW_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.km=function(a){if(-1<m.indexOf(a.type)){for(var c=!1,n=a.o,x=0;x<n.length;x++){var v=n[x],u=v,p=a,q=u.eb,D=p.j;u.T=!0;q.is_visible=!1;if(q)if(q.Kh)u.T=!1;else{var l=D.fe,z=q.tb.A,A=q.le,l=Math.sqrt((z[0]-l[0])*(z[0]-l[0])+(z[1]-
l[1])*(z[1]-l[1])+(z[2]-l[2])*(z[2]-l[2])),z=q.wf*q.tb.sa;l>=q.Rh&&l<A+z?(q.is_visible=!0,"GLOW_MASK"!=p.type||Boolean(u.n.qg)?(D=D.nl,q.gg?q=!1:"STATIC"===q.type?(A=q.tb,q=A.A,q=d.Uy(q,D,A.sa)):(A=q.Te,q=A.A,q=d.sv(q,D,A.Pe,A.Qe,A.Re)),q?u.T=!1:"WIREFRAME"==p.type&&(u.T=u.n.wireframe_mode==b.pn.WM_DEBUG_SPHERES?u.n.al:!u.n.al)):u.T=!1):u.T=!1}else u.T=!1;v.T&&(c=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||c?a.T=!0:(a.T&&g.clear(a),a.T=!1)}}if("MAIN_BLEND"==
a.type&&(c=a.j.fe,k.dist(c,a.Ur)>f.alpha_sort_threshold&&f.alpha_sort&&a.o)){for(n=0;n<a.o.length;n++)v=a.o[n],u=v.n,x=v.eb.K,u&&u.va&&u.Rd!=e.gd&&(u=u.lb)&&v.T&&(v=u.qj)&&v.type==e.qn&&e.uz(u,x,c);a.Ur.set(c)}}};b4w.module.__print=function(a){var p=!1,c=0,b=0;a.By=function(a){p=a};a.log=function(){p&&console.log.apply(console,arguments)};a.error=function(){c++;console.error.apply(console,arguments)};a.warn=function(){b++;console.warn.apply(console,arguments)};a.time=function(){p&&console.time.apply(console,arguments)};a.timeEnd=function(){p&&console.timeEnd.apply(console,arguments)};a.group=function(){p&&console.group.apply(console,arguments)};a.groupCollapsed=function(){p&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){p&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.Dw=function(){return b};a.pw=function(){return c};a.clear_errors_warnings=function(){c=b=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,p){function c(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=
.5,b("node material",a,"specular_toon_size"));"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in
a||(a.diffuse_fresnel_factor=.5,b("node material",a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name=
"B4W_"+a.node_tree_name}}}function b(a,b,c){c=c+">>"+a;c in v||(v[c]={Gm:[],Mq:"undefined",type:a});v[c].Gm.push(b.name)}function e(a,b){param_id in v||(v[param_id]={Gm:[],Mq:"deprecated",type:a});v[param_id].Gm.push(b.name)}function d(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var e=m.We(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var f=m.sh(d[c]);e.submeshes.push(f)}return e}var g=
p("__boundings"),k=p("__curve"),f=p("__print"),m=p("__util"),h=p("vec3"),r=p("vec4"),n=p("quat"),x=p("mat4"),v={};a.gu=function(a){v={};var d=a.worlds;if(0==d.length){f.warn("WARNING Datablock world is missing, reexport scene");var g={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},b4w_fog_color:[.5,.5,.5],b4w_fog_density:0};d.push(g)}for(var d=a.worlds,h=0;h<d.length;h++){var g=d[h],l=g.b4w_shadow_settings;
"csm_resolution"in l||(b("world",g,"b4w_shadow_settings.csm_resolution"),l.csm_resolution=2048);"self_shadow_polygon_offset"in l||(b("world",g,"b4w_shadow_settings.self_shadow_polygon_offset"),l.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in l||(b("world",g,"b4w_shadow_settings.self_shadow_normal_offset"),l.self_shadow_normal_offset=.01);"b4w_enable_csm"in l||(b("world",g,"b4w_shadow_settings.b4w_enable_csm"),l.b4w_enable_csm=!1);"csm_num"in l||(b("world",g,"b4w_shadow_settings.csm_num"),
l.csm_num=1);"csm_first_cascade_border"in l||(b("world",g,"b4w_shadow_settings.csm_first_cascade_border"),l.csm_first_cascade_border=10);"first_cascade_blur_radius"in l||(b("world",g,"b4w_shadow_settings.first_cascade_blur_radius"),l.first_cascade_blur_radius=3);"csm_last_cascade_border"in l||(b("world",g,"b4w_shadow_settings.csm_last_cascade_border"),l.csm_last_cascade_border=100);"last_cascade_blur_radius"in l||(b("world",g,"b4w_shadow_settings.last_cascade_blur_radius"),l.last_cascade_blur_radius=
1.5);"fade_last_cascade"in l||(b("world",g,"b4w_shadow_settings.fade_last_cascade"),l.fade_last_cascade=!0);"blend_between_cascades"in l||(b("world",g,"b4w_shadow_settings.blend_between_cascades"),l.blend_between_cascades=!0);l=g.b4w_ssao_settings;"dist_factor"in l||(b("world",g,"b4w_ssao_settings.dist_factor"),l.dist_factor=0,l.samples=16);"hemisphere"in l||(b("world",g,"b4w_ssao_settings.hemisphere"),l.hemisphere=!1);"blur_depth"in l||(b("world",g,"b4w_ssao_settings.blur_depth"),l.blur_depth=!1);
"blur_discard_value"in l||(b("world",g,"b4w_ssao_settings.blur_discard_value"),l.blur_discard_value=1);"b4w_glow_color"in g||(g.b4w_glow_color=[1,1,1],b("object",g,"b4w_glow_color"));"b4w_glow_factor"in g||(g.b4w_glow_factor=1,b("object",g,"b4w_glow_factor"));"b4w_fog_density"in g||(b("world",g,"b4w_fog_density"),g.b4w_fog_density=0);"b4w_sky_settings"in g&&"rayleigh_brightness"in g.b4w_sky_settings||(b("world",g,"rayleigh_brightness"),g.b4w_sky_settings={procedural_skydome:!1,use_as_enviroment_map:!1,
color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"b4w_bloom_settings"in g?("blur"in g.b4w_bloom_settings||(b("world",g,"b4w_bloom_settings.blur"),g.b4w_bloom_settings.blur=4),"edge_lum"in g.b4w_bloom_settings||(b("world",g,"b4w_bloom_settings.edge_lum"),g.b4w_bloom_settings.edge_lum=1)):(b("world",g,"b4w_bloom_settings"),g.b4w_bloom_settings=
{key:.2,blur:4});"b4w_motion_blur_settings"in g?("motion_blur_factor"in g.b4w_motion_blur_settings||(b("world",g,"b4w_motion_blur_settings.motion_blur_factor"),g.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in g.b4w_motion_blur_settings||(b("world",g,"b4w_motion_blur_settings.motion_blur_decay_threshold"),g.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(b("world",g,"b4w_motion_blur_settings"),g.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});
"b4w_color_correction_settings"in g||(b("world",g,"b4w_color_correction_settings"),g.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in g.b4w_god_rays_settings||(b("world",g,"b4w_god_rays_settings.steps_per_pass"),g.b4w_god_rays_settings.steps_per_pass=10)}d=a.scenes;for(h=0;h<d.length;h++)g=d[h],"b4w_use_nla"in g||(g.b4w_use_nla=!1,b("scene",g,"b4w_use_nla")),"fps"in g||(g.fps=24,b("scene",g,"fps")),"b4w_nla_cyclic"in g||(g.b4w_nla_cyclic=!1,b("scene",
g,"b4w_nla_cyclic")),"b4w_nla_script"in g||(g.b4w_nla_script=[],b("scene",g,"b4w_nla_script")),"b4w_detect_collisions"in g&&(e("scene",g),delete g.b4w_detect_collisions),"audio_doppler_speed"in g||(g.audio_doppler_speed=343.3),"audio_doppler_factor"in g||(g.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in g||(g.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",g,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in g||(g.b4w_enable_convolution_engine=
!1),"b4w_enable_bloom"in g||(g.b4w_enable_bloom=!1,b("scene",g,"b4w_enable_bloom")),"b4w_enable_motion_blur"in g||(g.b4w_enable_motion_blur=!1,b("scene",g,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in g||(g.b4w_enable_color_correction=!1,b("scene",g,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in g||(g.b4w_enable_antialiasing=!0,b("scene",g,"b4w_enable_antialiasing")),"b4w_tags"in g||(g.b4w_tags={title:"",description:""},b("scene",g,"b4w_tags"));g=a.meshes;for(h=0;h<g.length;h++)for(l=
g[h],l.b4w_bounding_box||(b("mesh",l,"b4w_bounding_box"),l.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0}),l.uv_textures||(b("mesh",l,"uv_textures"),l.uv_textures=[]),l.b4w_bounding_sphere_center||(l.b4w_bounding_sphere_center=[0,0,0]),l.b4w_bounding_cylinder_center||(l.b4w_bounding_cylinder_center=[0,0,0]),l.b4w_bounding_ellipsoid_center||(l.b4w_bounding_ellipsoid_center=[0,0,0]),l.b4w_bounding_ellipsoid_axes||(d=l.b4w_bounding_box,l.b4w_bounding_ellipsoid_axes=[(d.max_x-d.min_x)/
2,(d.max_y-d.min_y)/2,(d.max_z-d.min_z)/2]),d=0;d<l.b4w_vertex_anim.length;d++){var k=l.b4w_vertex_anim[d];"allow_nla"in k||(b('mesh["b4w_vertex_anim"]',l,"allow_nla"),k.allow_nla=!0)}d=a.cameras;for(h=0;h<d.length;h++)g=d[h],g.type||(g.type="PERSP",b("camera",g,"type")),"b4w_eye_target_dist"in g&&(delete g.b4w_eye_target_dist,e("camera",g)),"b4w_trans_velocity"in g||(g.b4w_trans_velocity=1,b("camera",g,"b4w_trans_velocity")),"b4w_rot_velocity"in g||(g.b4w_rot_velocity=1,b("camera",g,"b4w_rot_velocity")),
"b4w_zoom_velocity"in g||(g.b4w_zoom_velocity=.1,b("camera",g,"b4w_zoom_velocity")),"b4w_use_distance_limits"in g||(g.b4w_use_distance_limits=!1,b("camera",g,"b4w_use_distance_limits")),"b4w_distance_min"in g||(g.b4w_distance_min=1,b("camera",g,"b4w_distance_min")),"b4w_distance_max"in g||(g.b4w_distance_max=100,b("camera",g,"b4w_distance_max")),"b4w_horizontal_translation_min"in g||(g.b4w_horizontal_translation_min=-100,b("camera",g,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in
g||(g.b4w_horizontal_translation_max=100,b("camera",g,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in g||(g.b4w_vertical_translation_min=-100,b("camera",g,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in g||(g.b4w_vertical_translation_max=100,b("camera",g,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in g||(g.b4w_use_horizontal_clamping=!1,b("camera",g,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in g||(g.b4w_rotation_left_limit=-Math.PI,
b("camera",g,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in g||(g.b4w_rotation_right_limit=Math.PI,b("camera",g,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in g||(g.b4w_horizontal_clamping_type="LOCAL",b("camera",g,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in g||(g.b4w_use_vertical_clamping=!1,b("camera",g,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in g||(g.b4w_rotation_down_limit=-Math.PI/2,b("camera",g,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in
g||(g.b4w_rotation_up_limit=Math.PI/2,b("camera",g,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in g||(g.b4w_vertical_clamping_type="LOCAL",b("camera",g,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in g||(g.b4w_hover_angle_min=Math.PI/6,b("camera",g,"b4w_hover_angle_min")),"b4w_hover_angle_max"in g||(g.b4w_hover_angle_max=Math.PI/6,b("camera",g,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in g||(g.b4w_enable_hover_hor_rotation=!0,b("camera",g,"b4w_enable_hover_hor_rotation")),
"b4w_use_panning"in g||(g.b4w_use_panning=!0,b("camera",g,"b4w_use_panning"));d=a.lamps;for(h=0;h<d.length;h++)g=d[h],"b4w_generate_shadows"in g||(g.b4w_generate_shadows=!1,b("lamp",g,"b4w_generate_shadows")),"b4w_dynamic_intensity"in g||(g.b4w_dynamic_intensity=!1,b("lamp",g,"b4w_dynamic_intensity")),"use_diffuse"in g||(g.use_diffuse=!0,b("lamp",g,"use_diffuse")),"use_specular"in g||(g.use_specular=!0,b("lamp",g,"use_specular"));d=a.speakers;for(h=0;h<d.length;h++)g=d[h],"b4w_behavior"in g||(g.b4w_behavior=
g.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in g||(g.b4w_disable_doppler=!1),"b4w_delay"in g||(g.b4w_delay=0),"b4w_delay_random"in g||(g.b4w_delay_random=0),"b4w_volume_random"in g||(g.b4w_volume_random=0),"b4w_pitch_random"in g||(g.b4w_pitch_random=0),"b4w_fade_in"in g||(g.b4w_fade_in=0),"b4w_fade_out"in g||(g.b4w_fade_out=0),"b4w_loop"in g||(g.b4w_loop=!1),"b4w_loop_count"in g||(g.b4w_loop_count=0),"b4w_loop_count_random"in g||(g.b4w_loop_count_random=0),"b4w_playlist_id"in
g||(g.b4w_playlist_id="");d=a.textures;for(h=0;h<d.length;h++)g=d[h],"b4w_anisotropic_filtering"in g||(g.b4w_anisotropic_filtering="OFF",b("texture",g,"b4w_anisotropic_filtering")),"b4w_water_foam"in g||(g.b4w_water_foam=!1,b("texture",g,"b4w_water_foam")),"b4w_foam_uv_freq"in g||(g.b4w_foam_uv_freq=[1,1],b("texture",g,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in g||(g.b4w_foam_uv_magnitude=[1,1],b("texture",g,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in g||(g.b4w_parallax_steps=5,b("material",
g,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in g||(g.b4w_parallax_lod_dist=10,b("material",g,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in g||(g.b4w_shore_dist_map=!1,b("texture",g,"b4w_shore_dist_map")),"b4w_shore_boundings"in g||(g.b4w_shore_boundings=new Float32Array(4),g.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",g,"b4w_shore_boundings")),"b4w_max_shore_dist"in g||(g.b4w_max_shore_dist=100,b("texture",g,"b4w_max_shore_dist")),"b4w_disable_compression"in g||(g.b4w_disable_compression=
!1,b("texture",g,"b4w_disable_compression")),"b4w_source_type"in g||(g.b4w_source_type="",b("texture",g,"b4w_source_type")),"b4w_source_id"in g||(g.b4w_source_id="",b("texture",g,"b4w_source_id")),"b4w_source_size"in g||(g.b4w_source_size=1024,b("texture",g,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in g||(g.b4w_enable_canvas_mipmapping=!0,b("texture",g,"b4w_enable_canvas_mipmapping"));g=a.materials;for(h=0;h<g.length;h++){l=g[h];"b4w_node_mat_type"in l&&e("material",l);"b4w_skydome"in l&&
e("material",l);"b4w_procedural_skydome"in l&&e("material",l);l.b4w_water&&("b4w_water_shore_smoothing"in l||(l.b4w_water_shore_smoothing=!1,b("material",l,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in l||(l.b4w_water_dynamic=!1,b("material",l,"b4w_water_dynamic")),"b4w_waves_height"in l||(l.b4w_waves_height=1,b("material",l,"b4w_waves_height")),"b4w_waves_length"in l||(l.b4w_waves_length=1,b("material",l,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in l||(l.b4w_water_dst_noise_scale0=.05,
b("material",l,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in l||(l.b4w_water_dst_noise_scale1=.03,b("material",l,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in l||(l.b4w_water_dst_noise_freq0=1.3,b("material",l,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in l||(l.b4w_water_dst_noise_freq1=1,b("material",l,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in l||(l.b4w_water_dir_min_shore_fac=.4,b("material",l,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in
l||(l.b4w_water_dir_freq=.5,b("material",l,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in l||(l.b4w_water_dir_noise_scale=.05,b("material",l,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in l||(l.b4w_water_dir_noise_freq=.07,b("material",l,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in l||(l.b4w_water_dir_min_noise_fac=.5,b("material",l,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in l||(l.b4w_water_dst_min_fac=.2,b("material",l,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in
l||(l.b4w_water_waves_hor_fac=5,b("material",l,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in l||(l.b4w_water_absorb_factor=6,b("material",l,"b4w_water_absorb_factor")),"b4w_water_fog_color"in l||(l.b4w_water_fog_color=new Float32Array(3),l.b4w_water_fog_color=[.5,.7,.7],b("material",l,"b4w_water_fog_color")),"b4w_foam_factor"in l||(l.b4w_foam_factor=5,b("material",l,"b4w_foam_factor")),"b4w_generated_mesh"in l||(l.b4w_generated_mesh=!1,b("material",l,"b4w_generated_mesh")),"b4w_water_num_cascads"in
l||(l.b4w_water_num_cascads=5,b("material",l,"b4w_water_num_cascads")),"b4w_water_subdivs"in l||(l.b4w_water_subdivs=64,b("material",l,"b4w_water_subdivs")),"b4w_water_detailed_dist"in l||(l.b4w_water_detailed_dist=1E3,b("material",l,"b4w_water_detailed_dist")));"b4w_dynamic_grass_size"in l||(l.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in l||(l.b4w_dynamic_grass_color="");"diffuse_intensity"in l||(l.diffuse_intensity=1,b("material",l,"diffuse_intensity"));"b4w_use_ghost"in l||(l.b4w_use_ghost=
!1);"b4w_collision_group"in l||(l.b4w_collision_group=128,b("material",l,"b4w_collision_group"));"b4w_collision_mask"in l||(l.b4w_collision_mask=127,b("material",l,"b4w_collision_mask"));"b4w_do_not_render"in l||(l.b4w_do_not_render=!1,b("material",l,"b4w_do_not_render"));"HALO"!=l.type||"b4w_halo_sky_stars"in l||(l.b4w_halo_sky_stars=!1,b("material",l,"b4w_halo_sky_stars"));"HALO"!=l.type||"b4w_halo_stars_blend_height"in l||(l.b4w_halo_stars_blend_height=10,b("material",l,"b4w_halo_stars_blend_height"));
"HALO"!=l.type||"b4w_halo_stars_min_height"in l||(l.b4w_halo_stars_min_height=0,b("material",l,"b4w_halo_stars_min_height"));"specular_shader"in l||(l.specular_shader="COOKTORR",b("material",l,"specular_shader"));"diffuse_shader"in l||(l.diffuse_shader="LAMBERT",b("material",l,"diffuse_shader"));"roughness"in l||(l.roughness=.5,b("material",l,"roughness"));"diffuse_fresnel"in l||(l.diffuse_fresnel=.1,b("material",l,"diffuse_fresnel"));"diffuse_fresnel_factor"in l||(l.diffuse_fresnel_factor=.5,b("material",
l,"diffuse_fresnel_factor"));"specular_slope"in l||(l.specular_slope=.2,b("material",l,"specular_slope"));"specular_toon_size"in l||(l.specular_toon_size=.5,b("material",l,"specular_toon_size"));"specular_toon_smooth"in l||(l.specular_toon_smooth=.1,b("material",l,"specular_toon_smooth"));"specular_alpha"in l||(l.specular_alpha=1,b("material",l,"specular_alpha"));"b4w_wettable"in l||(l.b4w_wettable=!1,b("material",l,"b4w_wettable"));"b4w_refractive"in l||(l.b4w_refractive=!1,b("material",l,"b4w_refractive"));
"b4w_refr_bump"in l||(l.b4w_refr_bump=0,b("material",l,"b4w_refr_bump"));"b4w_shallow_water_col"in l||(l.b4w_shallow_water_col=[0,.8,.3],b("material",l,"b4w_shallow_water_col"));"b4w_shore_water_col"in l||(l.b4w_shore_water_col=[0,.9,.2],b("material",l,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in l||(l.b4w_shallow_water_col_fac=1,b("material",l,"b4w_shallow_water_col_fac"));"b4w_shore_water_col_fac"in l||(l.b4w_shore_water_col_fac=.5,b("material",l,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in
l||(l.b4w_water_sss_strength=5.9,b("material",l,"b4w_water_sss_strength"));"b4w_water_sss_width"in l||(l.b4w_water_sss_width=.45,b("material",l,"b4w_water_sss_width"));"b4w_render_above_all"in l||(l.b4w_render_above_all=!1,b("material",l,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in l||(l.b4w_water_norm_uv_velocity=.05,b("material",l,"b4w_water_norm_uv_velocity"));k=l.texture_slots;for(d=0;d<k.length;d++){var n=k[d];"blend_type"in n||(n.blend_type="MIX",b("texture_slot",n,"blend_type"))}if(l.node_tree)for(l=
l.node_tree.nodes,d=0;d<l.length;d++)c(l[d])}g=a.node_groups;for(h=0;h<g.length;h++)for(l=g[h].node_tree.nodes,d=0;d<l.length;d++)c(l[d]);g=a.objects;for(h=0;h<g.length;h++){l=g[h];switch(l.type){case "MESH":"b4w_dynamic_geometry"in l||(l.b4w_dynamic_geometry=!1);"b4w_reflexible"in l||(l.b4w_reflexible=!1);"b4w_reflexible_only"in l||(l.b4w_reflexible_only=!1);"b4w_reflective"in l||(l.b4w_reflective=!1);"b4w_wind_bending"in l||(l.b4w_wind_bending=!1,b("object",l,"b4w_wind_bending"));"b4w_wind_bending_angle"in
l||(l.b4w_wind_bending_angle=10,l.b4w_wind_bending_freq=.25,b("object",l,"wind bending params"));"b4w_detail_bending_amp"in l||(l.b4w_detail_bending_amp=.1,l.b4w_branch_bending_amp=.3,b("object",l,"detail bending params"));"b4w_detail_bending_freq"in l||(l.b4w_detail_bending_freq=1,b("object",l,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in l||(l.b4w_main_bend_stiffness_col="",b("object",l,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in l||(l.b4w_detail_bend_colors={leaves_stiffness_col:"",
leaves_phase_col:"",overall_stiffness_col:""},b("object",l,"b4w_detail_bend_colors"));"b4w_caustics"in l||(l.b4w_caustics=!1);"vertex_groups"in l&&l.vertex_groups.length&&l.data&&0==l.data.vertex_groups.length&&(l.data.vertex_groups=l.vertex_groups,delete l.vertex_groups,b("object",l,"vertex_groups"));"b4w_vertex_anim"in l&&l.b4w_vertex_anim.length&&l.data&&0==l.data.b4w_vertex_anim.length&&(l.data.b4w_vertex_anim=l.b4w_vertex_anim,delete l.b4w_vertex_anim,b("object",l,"b4w_vertex_anim"));"b4w_do_not_render"in
l||(l.b4w_do_not_render=!1);"use_ghost"in l.game||(l.game.use_ghost=!1);"use_sleep"in l.game||(l.game.use_sleep=!1);"velocity_min"in l.game||(l.game.velocity_min=0);"velocity_max"in l.game||(l.game.velocity_max=0);"collision_group"in l.game||(l.game.collision_group=1);"collision_mask"in l.game||(l.game.collision_mask=255);"b4w_vehicle_settings"in l?l.b4w_vehicle_settings&&("steering_ratio"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.steering_ratio=10),"steering_max"in l.b4w_vehicle_settings||
(l.b4w_vehicle_settings.steering_max=1),"inverse_control"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.inverse_control=!1),"force_max"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.force_max=1500),"brake_max"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.brake_max=100),"speed_ratio"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in l.b4w_vehicle_settings||
(l.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.roll_influence=
.1),"max_suspension_travel_cm"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.floating_factor=3),"floating_factor"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in l.b4w_vehicle_settings||(l.b4w_vehicle_settings.water_rot_damp=.9)):(l.b4w_vehicle_settings=null,b("object",l,"b4w_vehicle_settings"));
"b4w_floating_settings"in l?l.b4w_floating_settings&&("floating_factor"in l.b4w_floating_settings||(l.b4w_floating_settings.floating_factor=3),"water_lin_damp"in l.b4w_floating_settings||(l.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in l.b4w_floating_settings||(l.b4w_floating_settings.water_rot_damp=.8)):(l.b4w_floating_settings=null,b("object",l,"b4w_floating_settings"));"b4w_character_settings"in l?l.b4w_character_settings&&("walk_speed"in l.b4w_character_settings||(l.b4w_character_settings.walk_speed=
4),"run_speed"in l.b4w_character_settings||(l.b4w_character_settings.run_speed=8),"step_height"in l.b4w_character_settings||(l.b4w_character_settings.step_height=.25),"jump_strength"in l.b4w_character_settings||(l.b4w_character_settings.jump_strength=5),"waterline"in l.b4w_character_settings||(l.b4w_character_settings.waterline=0)):(l.b4w_character_settings=null,b("object",l,"b4w_character_settings"));"b4w_selectable"in l||(l.b4w_selectable=!1,b("object",l,"b4w_selectable"));"b4w_billboard"in l||
(l.b4w_billboard=!1,b("object",l,"b4w_billboard"));"b4w_billboard_geometry"in l||(l.b4w_billboard_geometry="SPHERICAL",b("object",l,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in l||(l.b4w_pres_glob_orientation=!1,b("object",l,"b4w_pres_glob_orientation"));"b4w_glow_settings"in l||(l.b4w_glow_settings={},l.b4w_glow_settings.glow_duration=1,l.b4w_glow_settings.glow_period=1,l.b4w_glow_settings.glow_relapses=0,b("object",l,"b4w_glow_settings"));"b4w_lod_transition"in l||(l.b4w_lod_transition=
.01,b("object",l,"b4w_lod_transition"));"lod_levels"in l||(l.lod_levels=[],b("object",l,"lod_levels"));"b4w_animation_mixing"in l||(l.b4w_animation_mixing=!1,b("object",l,"b4w_animation_mixing"));break;case "EMPTY":"b4w_group_relative"in l||(l.b4w_group_relative=!1,b("object",l,"b4w_group_relative"))}"b4w_anim_behavior"in l||(l.b4w_anim_behavior=l.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",l,"b4w_anim_behavior"));if(!("rotation_quaternion"in l)){d=[0,0,0,1];m.euler_to_quat(l.rotation_euler,
d);var k=d,n=d[0],r=d[1],x=d[2];k[0]=d[3];k[1]=n;k[2]=r;k[3]=x;l.rotation_quaternion=d;b("object",l,"rotation_quaternion")}"webgl_do_not_batch"in l&&(l.b4w_do_not_batch=l.webgl_do_not_batch)&&e("object",l);"b4w_shadow_cast_only"in l||(l.b4w_shadow_cast_only=!1,b("object",l,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in l||(l.b4w_correct_bounding_offset="AUTO",b("object",l,"b4w_correct_bounding_offset"));k=l.particle_systems;for(d=0;d<k.length;d++)n=k[d],r=n.settings,"use_whole_group"in r||
(r.use_whole_group=!1,b("object",r,"use_whole_group")),n.transforms||(n.transforms=new Float32Array,b("particle_system",n,"transforms")),"b4w_billboard_align"in r||(r.b4w_billboard_align="VIEW",b("particle_settings",r,"b4w_billboard_align")),"b4w_dynamic_grass"in r||(r.b4w_dynamic_grass=!1,b("object",r,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in r||(r.b4w_dynamic_grass_scale_threshold=.01,b("object",r,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in r||(r.b4w_initial_rand_rotation=
!1,b("particle_settings",r,"b4w_initial_rand_rotation")),"b4w_rotation_type"in r||(r.b4w_rotation_type="Z",b("particle_settings",r,"b4w_rotation_type")),"b4w_rand_rotation_strength"in r||(r.b4w_rand_rotation_strength=1,b("particle_settings",r,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in r||(r.b4w_hair_billboard=!1,b("particle_settings",r,"b4w_hair_billboard")),"b4w_hair_billboard_type"in r||(r.b4w_hair_billboard_type="BASIC",b("particle_settings",r,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in
r||(r.b4w_hair_billboard_jitter_amp=0,b("particle_settings",r,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in r||(r.b4w_hair_billboard_jitter_freq=0,b("particle_settings",r,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in r||(r.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",r,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in r||(r.b4w_wind_bend_inheritance="PARENT",b("particle_settings",r,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in
r||(r.b4w_shadow_inheritance="PARENT",b("particle_settings",r,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in r||(r.b4w_reflection_inheritance="PARENT",b("particle_settings",r,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in r||(r.b4w_vcol_from_name="",b("particle_settings",r,"b4w_vcol_from_name")),"b4w_vcol_to_name"in r||(r.b4w_vcol_to_name="",b("particle_settings",r,"b4w_vcol_to_name")),"b4w_coordinate_system"in r||(r.b4w_coordinate_system="LOCAL",b("particle_settings",r,"b4w_coordinate_system")),
"b4w_allow_nla"in r||(r.b4w_allow_nla=!0,b("particle_settings",r,"b4w_allow_nla"));"constraints"in l||(l.constraints=[],b("object",l,"constraints"));k=l.modifiers;for(d=0;d<k.length;d++){a:{n=k[d];switch(n.type){case "ARRAY":if(!("fit_type"in n)){f.error("WARNING Incomplete modifier "+String(n.type)+' for "'+l.name+'", reexport '+(l.library?"library"+l.library.split("/").slice(-1)[0]:"main scene"));n=!1;break a}}n=!0}n||(k.splice(d,1),d--)}"animation_data"in l||(l.animation_data={action:null,nla_tracks:[]},
b("object",l,"animation_data"));if(l.animation_data)for(("action"in l.animation_data)||(l.animation_data.action=null,f.warn("B4W Warning: no action in animation data "+l.name)),("nla_tracks"in l.animation_data)||(l.animation_data.nla_tracks=[],f.warn("B4W Warning: no NLA in animation data "+l.name)),k=l.animation_data.nla_tracks,d=0;d<k.length;d++)for(n=k[d],r=0;r<n.strips.length;r++)x=n.strips[r],"action"in x||(x.action=null,f.warn("B4W Warning: no action in NLA strip "+l.name)),"action_frame_start"in
x||(x.action_frame_start=0,f.warn("B4W Warning: no action_frame_start in NLA strip "+l.name)),"action_frame_end"in x||(x.action_frame_end=x.frame_end-x.frame_start,f.warn("B4W Warning: no action_frame_start in NLA strip "+l.name));"b4w_collision_id"in l||(l.b4w_collision_id="",b("material",l,"b4w_collision_id"));d=l.scale;0==d[0]&&0==d[1]&&0==d[2]?d=!0:(k=Math.abs((d[1]-d[2])/d[1]),d=.001>Math.abs((d[0]-d[1])/d[0])&&.001>k);d||f.warn("B4W Warning: non-uniform scale for object "+l.name)}for(var p in v)h=
v[p],d=p.match(/.*?(?=>>|$)/i)[0],f.warn("WARNING "+String(d)+" is "+h.Mq+" for "+h.type+", reexport "+a.b4w_filepath_blend)};a.Ht=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var e=b[c].type;if("ARRAY"==e||"CURVE"==e){b=!0;break a}}b=!1}if(!b)return null;b=d(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var f=a[c];switch(f.type){case "ARRAY":for(var e=b,v=f,A=0,p=0,t=0,B=new Float32Array(16),f=[],O=1;O<v.count;O++){v.use_constant_offset&&(A+=v.constant_offset_displace[0],
p+=v.constant_offset_displace[1],t+=v.constant_offset_displace[2]);if(v.use_relative_offset)var y=e.b4w_bounding_box,A=A+(y.max_x-y.min_x)*v.relative_offset_displace[0],p=p+(y.max_y-y.min_y)*v.relative_offset_displace[1],t=t+(y.max_z-y.min_z)*v.relative_offset_displace[2];m.oz(A,p,t,B);for(var H=y=d(e),L=B,Z=0;Z<H.submeshes.length;Z++){var J=H.submeshes[Z];m.pe(J.position,L,J.position,0);m.Uz(J.normal,L,J.normal);m.lz(J.tangent,L,J.tangent)}f.push(y)}for(O=0;O<f.length;O++)for(v=e,A=f[O],p=0;p<v.submeshes.length;p++){t=
v.submeshes[p];B=A.submeshes[p];y=t.base_length;H=t.indices.length;t.base_length+=B.base_length;for(var F in t)if("base_length"!=F)if("indices"==F)for(t[F]=m.rz(t[F],B[F]),L=H;L<t.indices.length;L++)t.indices[L]+=y;else t[F]=m.Fv(t[F],B[F])}break;case "CURVE":for(var e=b,O=f.object.lt,v=new Float32Array(16),p=O.ke?4:3,A=new Float32Array(p),p=new Float32Array(p),t=new Float32Array(3),B=new Float32Array(4),y=new Float32Array(4),H=new Float32Array(3),L=new Float32Array(3),Z=new Float32Array(3),J=new Float32Array(4),
U=new Float32Array(4),K=0;K<e.submeshes.length;K++){var S=e.submeshes[K],T=S.position,ba=S.normal,S=S.tangent,P;a:switch(P=f.deform_axis,P){case "POS_X":case "NEG_X":P=0;break a;case "POS_Y":case "NEG_Y":P=1;break a;case "POS_Z":case "NEG_Z":P=2;break a;default:throw"Wrong deform axis value "+P;}H[0]=0;H[1]=0;H[2]=0;H[P]=1;for(var ca=k.Xy(O),X=0;X<T.length/3;X++){Z[0]=T[3*X];Z[1]=T[3*X+1];Z[2]=T[3*X+2];var aa=Z[P],w=k.Wy(O,aa);k.Yy(O,w,A);t[0]=A[0];t[1]=A[1];t[2]=A[2];k.Vy(O,w,p);L[0]=p[0];L[1]=0;
L[2]=p[2];h.normalize(L,L);n.rotationTo(H,L,B);0>aa?(A[0]=L[0],A[1]=L[1],A[2]=L[2],h.scale(A,aa,A),h.add(t,A,t)):aa>ca&&(A[0]=L[0],A[1]=L[1],A[2]=L[2],h.scale(A,aa-ca,A),h.add(t,A,t));x.fromRotationTranslation(B,t,v);O.ke&&(n.setAxisAngle(H,A[3],y),h.transformQuat(Z,y,Z));Z[P]=0;h.transformMat4(Z,v,Z);T[3*X]=Z[0];T[3*X+1]=Z[1];T[3*X+2]=Z[2];ba.length&&(J[0]=ba[3*X],J[1]=ba[3*X+1],J[2]=ba[3*X+2],J[3]=0,r.transformMat4(J,v,J),ba[3*X]=J[0],ba[3*X+1]=J[1],ba[3*X+2]=J[2]);S.length&&(U[0]=S[3*X],U[1]=S[3*
X+1],U[2]=S[3*X+2],U[3]=0,r.transformMat4(U,v,U),S[3*X]=U[0],S[3*X+1]=U[1],S[3*X+2]=U[2])}}}g.Ox(b)}return b};a.XA=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,
b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,
hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.Nt=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.b4w_use_nla)for(var d=d.b4w_nla_script,e=0;e<d.length;e++){var f=d[e];switch(f.type){case "SELECT":case "SELECT_PLAY":for(var g=0;g<a.length;g++){var h=a[g];h.name==f.object&&(h.b4w_selectable=!0)}break;case "SHOW":case "HIDE":for(g=0;g<a.length;g++)h=a[g],h.name==f.object&&
(h.b4w_do_not_batch=!0)}}}}};b4w.module.__scenegraph=function(a,p){function c(a){a=Za.wa(a);a.ge=null;a.ub=null;a.oc=null;return a}function b(a,b){var c=[];Q.De(a,function(b,e,f){-1<c.indexOf(f)?Q.Xx(a,b,e,f,d(f)):c.push(f)});Q.P(a,function(e,f){for(var g=0;g<f.ca.length;g++){var s=f.ca[g];b||"MAIN_REFLECT"!=f.type||(s.Qf=!0);-1<c.indexOf(s)?f.ca[g]=d(s):c.push(s)}"ANTIALIASING"==f.type&&Q.Od(a,e,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.ca.length;c++){var d=b.ca[c];d.na=ia.B;d.ma=ia.B}});b||Q.Od(a,e,function(a,
b,c){"DEPTH"==c.N&&(c.Qf=!0)})});Q.P(a,function(b){var c={};e(a,b,c);for(var d in c){b=c[d];for(var f=b[0],g=0;g<b.length;g++)if(b[g].na==ia.B){f=b[g];break}for(var s=b[0],g=0;g<b.length;g++)if(b[g].ma==ia.B){s=b[g];break}for(var h=b[0],g=0;g<b.length;g++)if(!b[g].Qf){h=b[g];break}for(g=0;g<b.length;g++)b[g].na=f.na,b[g].ma=s.ma,b[g].Qf=h.Qf}})}function e(a,b,c){Q.Od(a,b,function(b,d,f){f.Ba&&f.N==f.da&&(c[f.N]=c[f.N]||[],-1==c[f.N].indexOf(f)&&c[f.N].push(f),e(a,b,c))});Q.Ee(a,b,function(a,b,d){d.Ba&&
(c[d.N]=c[d.N]||[],-1==c[d.N].indexOf(d)&&c[d.N].push(d))});b=Q.Qa(a,b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.ca.length;d++){var f=b.ca[d];c[f.N].push(f)}}function d(a){if(a.ga)throw"Failed to clone slink with attached texture";return Za.We(a)}function g(a){var b=Q.Mm(a),c=[];Q.P(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var e=[];break;default:e=c}for(var g=0;g<d.ca.length;g++){var s=d.ca[g],l=r(e,s,f(s));s.ga=l;
d.Yc[g]=l}for(g=0;g<d.Yc.length;g++)l=d.Yc[g],h(e,l);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":e=[]}Q.Ee(b,a,function(c,d,g){if(!g.ga){if((c=m(b,a,g.N))&&g.Ba&&!g.ga){d=e;for(var s=c,h=0;h<d.length;h++){var l=d[h];l.Jm===s&&l.ci++}}else c=r(e,g,f(g));g.ga=c}});Q.Od(b,a,function(a,b,c){h(e,c.ga)});Q.Ee(b,a,function(a,b,c){c.ga&&"NONE"==c.da&&h(e,c.ga)})})}function k(a){x(a,function(b,c,d){b.$g&&(qa(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&
"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||qa(a,d,"ANTIALIASING"))&&(b.ye*=Ea.resolution_factor)})}function f(a){a=Za.We(a);delete a.da;delete a.Ba;delete a.ga;return JSON.stringify(a)}function m(a,b,c){var d=null;Q.Od(a,b,function(a,b,e){if(e.Ba&&e.N==e.da&&e.N==c&&e.ga)return d=e.ga,!0});Q.Ee(a,b,function(a,b,e){if(e.Ba&&e.N==c&&e.ga)return d=e.ga,!0});return d}function h(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.Jm===b&&d.ci&&d.ci--}}function r(a,b,c){for(var d=null,e=0;e<a.length;e++){var f=a[e];
if(f.id==c&&0===f.ci){d=f;break}}if(d)return d.ci++,d.Jm;b=n(b);a.push({id:c,ci:1,Jm:b});return b}function n(a){var b=a.ye*a.size;switch(a.N){case "COLOR":var c=ia.Zi("COLOR",ia.Zf);ia.resize(c,b,b);ia.sm(c,a.na,a.ma);return c;case "DEPTH":return a.Qf?(c=ia.Zi("DEPTH_RBUF",ia.Yf),ia.resize(c,b,b)):(c=ia.Zi("DEPTH_TEX",ia.ih),ia.resize(c,b,b),ia.sm(c,a.na,a.ma)),c;case "CUBEMAP":return c=ia.Bu(b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.N;}}function x(a,b){var c=!1;Q.De(a,function(d,
e,f){if(f&&(d=Q.Qa(a,d),e=Q.Qa(a,e),b(f,!1,d,e)))return c=!0});c||Q.P(a,function(a,c){for(var d=0;d<c.ca.length;d++)if(b(c.ca[d],!0,c,null))return!0})}function v(a){Q.P(a,function(b,c){if("SINK"!=c.type){var d=c.j;Q.Ee(a,b,function(a,b,c){c.Ba&&c.ga&&(na.Vj(d,c.N,c.ga),c.N==c.da&&b.j&&na.Vj(b.j,c.N,c.ga))});for(var e=0;e<c.ca.length;e++){var f=c.ca[e];f.Ba&&f.N==f.da&&na.Vj(d,f.N,c.Yc[e])}!d.ub&&!d.oc||d.ge||(d.ge=Ba.Wx(d.ub,d.oc))}})}function u(a){var b=null,c=0;Q.P(a,function(a,d){if(d.type==va.hz){if(c==
va.gz)return b=d,!0;c++}});return b}function E(a,b){var c=Q.Ag(a,b),d=A("NONE"),e=Q.w(a,d),f=Q.wl(a)[0];Q.De(a,function(b,c){c==f&&Q.Px(a,b,f,b,e)});Q.De(a,function(e,f,g){if(e==c)return Q.m(a,b,d,l(va.Iy,"u_color",g.size,g.ye,g.$g)),!0});Q.Xd(a,e,f,l("SCREEN","NONE",.5,.5,!0))}function q(a,b){var c=D("SHADOW_CAST");c.Vk=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;switch(b.Nl){case "SPOT":case "POINT":c.j=na.mb(na.lc);na.tm(c.j,180*b.Nf/Math.PI,.1,2*b.distance);break;default:c.j=na.mb(na.kh)}return c}
function D(a){return{type:a,va:!1,vq:!1,yk:!1,Gj:!1,vh:0,time:0,j:null,Ao:null,Ab:null,o:[],ca:[],Yc:[],vi:new Float32Array(3),Ur:new Float32Array(3),Pb:new Float32Array(3),Nb:new Float32Array(4),Zb:new Float32Array(16),ee:0,Af:0,ar:0,qf:null,tf:null,pf:null,rf:null,sf:null,pc:new Float32Array(3),uc:new Float32Array(3),tr:new Float32Array([0,0,0]),ak:new Float32Array(3),ur:new Float32Array(4),Lg:null,ij:0,el:0,Mh:!1,Jh:new Float32Array(3),Ge:0,La:null,kk:!1,ve:new Float32Array(2),we:new Float32Array(2),
Jg:0,xg:0,Kk:0,Dc:null,Ie:0,Wf:0,He:0,Ue:!1,Yn:0,Zn:new Float32Array(2),Xn:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,Kg:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,Pg:0,Og:0,Ng:0,kr:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,
wg:0,Sj:0,Sg:0,Vk:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,Jr:null,Mn:null,Gf:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,Qn:0,Qo:0,Cj:0,Dj:0,aq:0,$h:"",cx:new Float32Array(2),T:!0,enqueue:!0,ea:!0,ia:!0,Fb:!0,ya:!0}}function l(a,b,c,d,e){return{N:a,da:b,size:c,ye:d,$g:e,Ba:!0,ga:null,Qf:!1,na:ia.ed,ma:ia.ed}}function z(){var a=D("GRASS_MAP");a.j=na.mb(na.jh);return a}function A(a){var b=D("POSTPROCESSING");b.ea=!1;b.ia=!1;b.Fb=!1;b.j=na.mb(na.ib);b.$h=a;return b}function G(a){var b=
D("BLOOM_BLUR");b.ea=!1;b.ia=!1;b.Fb=!1;b.j=na.mb(na.ib);b.$h=a;return b}function t(a,b,c,d,e,f,g,s,h){var l=D("MAIN_"+a);if("OPAQUE"===a)l.ea=!0,l.ia=c,l.va=!1;else if("BLEND"===a)l.ea=!1,l.ia=!1,l.va=!0;else if("XRAY"===a)l.ea=!1,l.ia=!0,l.va=!0;else if("REFLECT"===a)l.ea=!0,l.ia=!0,l.va=!1;else throw"wrong main subscene type";l.va&&s&&(l.self_shadow_normal_offset=s.self_shadow_normal_offset);l.j=b;l.pc.set(g.pc);l.uc.set(g.uc);l.ee=g.ee;l.Lg=g.Lg;l.Nb=f;d&&(l.La=d,d.Nb&&(l.Dc=new Float32Array(d.Nb)),
l.Ie=d.waves_height,l.Wf=d.waves_length,l.He=d.He,d.Ti&&h&&(l.Ue=!0,l.Yn=d.Ti,l.Zn.set(d.Mk),l.Xn=d.Lk),d.Xj&&(l.kk=!0,a=d.Gy,l.ve[0]=(a[0]+a[1])/2,l.ve[1]=(a[2]+a[3])/2,l.we[0]=a[0]-a[1],l.we[1]=a[2]-a[3],l.Jg=d.Jg,l.xg=d.xg));l.qf=new Float32Array(3*e);l.tf=new Float32Array(3*e);l.pf=new Float32Array(3*e);l.rf=new Float32Array(4*e);l.sf=new Float32Array(4*e);return l}function B(a,b){var c=D("COLOR_PICKING");b&&(c.type+="_XRAY",c.ea=!1,c.ia=!0);c.enqueue=!1;c.j=a;return c}function O(a){var b=D("WIREFRAME");
b.T=!1;b.ea=!1;b.ia=!1;b.j=a;return b}function y(a,b){var c=D("DEPTH");c.j=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function H(a){var b=D("DEPTH_PACK");b.ea=!1;b.ia=!1;b.j=a;return b}function L(a,b,c){var d=D("SSAO");d.ea=!1;d.ia=!1;d.Fb=!1;d.j=a;d.Nb=b;d.Dc=new Float32Array(b);d.Pg=c.radius_increase;d.ssao_hemisphere=c.Pw;d.Og=c.influence;d.Ng=c.dist_factor;d.kr=c.cy;return d}function Z(a,b){var c=D("SSAO_BLUR");c.ea=!1;c.ia=!1;c.Fb=!1;c.ssao_blur_depth=b.Wt;c.ssao_blur_discard_value=
b.Pn;c.j=a;return c}function J(){var a=D("ANTIALIASING");a.ea=!1;a.ia=!1;a.Fb=!1;a.j=na.mb(na.ib);return a}function F(a){var b=D(a);b.ea="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.ia=!1;b.Fb=!1;b.j=na.mb(na.ib);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.dx=new Float32Array(4));return b}function U(a,b,c,d){var e=D("COMPOSITING");e.ea=!1;e.ia=!1;e.Fb=!1;e.j=na.mb(na.ib);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function K(a,b){var c=D("MOTION_BLUR");
c.ea=!1;c.ia=!1;c.Fb=!1;c.j=na.mb(na.ib);c.yk=!0;c.Cj=a;c.Dj=b;return c}function S(a){var b=D("DOF");b.ea=!1;b.ia=!1;b.Fb=!1;b.j=a;return b}function T(a){var b=D("GLOW_MASK");b.j=a;b.Fb=!1;return b}function ba(a){var b=D("GLOW");b.Jh.set(a.Jh);b.ij=a.ij;b.Qo=5;b.Qn=3;b.Fb=!1;b.j=na.mb(na.ib);return b}function P(){var a=D("REFRACT");a.ea=!1;a.ia=!1;a.Fb=!1;a.j=na.mb(na.ib);return a}function ca(a,b,c,d,e,f,g){var s=D("GOD_RAYS");s.ea=!1;s.ia=!1;s.Fb=!1;s.pc[0]=1;s.pc[1]=1;s.pc[2]=1;s.uc[0]=1;s.uc[1]=
1;s.uc[2]=1;s.ee=1;s.vq=d;s.Ge=b;s.Sj=e;s.wg=c;s.Sg=g;s.j=a;s.Af=f;s.qf=new Float32Array(3*f);s.tf=new Float32Array(3*f);s.pf=new Float32Array(3*f);s.rf=new Float32Array(4*f);s.sf=new Float32Array(4*f);return s}function X(a,b){var c=D("GOD_RAYS_COMBINE");c.ea=!1;c.ia=!1;c.Fb=!1;c.j=na.mb(na.ib);c.god_rays_intensity=a;c.Af=b;c.qf=new Float32Array(3*b);c.tf=new Float32Array(3*b);c.pf=new Float32Array(3*b);c.rf=new Float32Array(4*b);c.sf=new Float32Array(4*b);return c}function aa(a,b){var c=D("SKY");
c.enqueue=!1;c.ea=!1;c.ia=!1;c.Fb=!1;var d=na.mb(na.ib);d.width=vb.$i;d.height=vb.$i;c.j=d;c.Ao=Za.Sv();c.Af=a;c.qf=new Float32Array(3*a);c.tf=new Float32Array(3*a);c.pf=new Float32Array(3*a);c.rf=new Float32Array(4*a);c.sf=new Float32Array(4*a);c.pc[0]=1;c.pc[1]=1;c.pc[2]=1;c.uc[0]=1;c.uc[1]=1;c.uc[2]=1;c.ee=1;c.Kg.set(b.Kg);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;
c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function w(){var a=D("COPY");a.ea=!1;a.ia=!1;a.j=na.mb(na.ib);return a}function fa(){var a=D("ANAGLYPH");a.ea=!1;a.ia=!1;a.j=na.mb(na.ib);return a}function ja(){var a=D("LUMINANCE");a.ea=!1;a.ia=!1;a.j=na.mb(na.ib);
return a}function N(){var a=D("AVERAGE_LUMINANCE");a.ea=!1;a.ia=!1;a.j=na.mb(na.ib);return a}function I(a,b,c,d){var e=D("LUMINANCE_TRUNCED");e.ea=!1;e.ia=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.j=d;e.qf=new Float32Array(3*c);e.tf=new Float32Array(3*c);e.pf=new Float32Array(3*c);e.rf=new Float32Array(4*c);e.sf=new Float32Array(4*c);return e}function Y(a){var b=D("BLOOM");b.ea=!1;b.ia=!1;b.j=na.mb(na.ib);b.bloom_blur=a;return b}function ga(){var a=D("SINK");a.enqueue=!1;return a}function qa(a,b,c){if(b.type===
c)return!0;b=V(a,b);for(var d=0;d<b.length;d++)if(qa(a,b[d],c))return!0;return!1}function M(a,b,c){if(b.type===c)return!0;b=s(a,b);for(var d=0;d<b.length;d++)if(M(a,b[d],c))return!0;return!1}function R(a,b,c){if(b.type===c)return b;b=s(a,b);for(var d=0;d<b.length;d++){var e=R(a,b[d],c);if(e)return e}return null}function s(a,b){var c=Q.Ag(a,b);if(c==Q.ln)throw"Subscene not in graph";for(var d=[],e=Q.Dp(a,c),f=0;f<e;f++){var g=Q.gj(a,c,f);g!=c&&d.push(Q.Qa(a,g))}return d}function V(a,b){var c=Q.Ag(a,
b);if(c==Q.ln)throw"Subscene not in graph";for(var d=[],e=Q.Bg(a,c),f=0;f<e;f++){var g=Q.og(a,c,f);g!=c&&d.push(Q.Qa(a,g))}return d}function ma(a){var b=[],c=[];x(a,function(a){a.ga&&-1==b.indexOf(a.ga)&&(b.push(a.ga),c.push(a.ga,b.length-1))});return c}function pa(a,b){var c;c=""+(a.N+"\\n");c+="NONE"!=a.da?a.da+"\\n":"";c+="(";if(a.$g){var d=a.ye;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.N){c+=" ";if(a.Qf)c+="RR";else{var d=a.na,e=a.ma,
f="";d==ia.B?f+="L":d==ia.ed&&(f+="N");e==ia.B?f+="L":e==ia.ed&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.ga&&(c+=" "+b[d+1])}return c+")\\n"}var na=p("__camera"),ea=p("__config"),la=p("__debug"),Q=p("__graph"),Ba=p("__renderer"),ia=p("__textures"),Za=p("__util");p("vec4");var va=ea.bl,Ea=ea.p,vb=ea.ii;a.lu=function(a){switch(a.da){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;default:return!0}};a.qz=x;a.Lu=function(a,d,e){function f(b,e){var g=c(za[e]);
d.J.push(g);g=t(b,g,!1,D,qa,$a,Ua,Ia,a.Tg);M.push(g);Q.w(s,g);Q.m(s,h[e],g,V[e]);Q.m(s,h[e],g,n[e]);Da&&(Q.m(s,Da,g,xb),Q.m(s,Da,g,yb));if(Ra){for(var k=0;k<p.length;k++)Q.m(s,p[k],g,pa[k]);k=m[e];if("DEPTH_PACK"==k.type){var Y=l("COLOR","u_scene_depth",1,1,!0);Y.na=ia.ed;Y.ma=ia.ed}else Y=l("DEPTH","u_scene_depth",1,1,!0),Y.na=ia.B,Y.ma=ia.B;Q.m(s,k,g,Y)}R.length&&(Q.m(s,R[e],g,r[e]),g.Ab=xa[0]);x.length&&Q.m(s,x[e],g,ma[e]);return g}var s=Q.create(),h=[],M=[],m=[],V=[],n=[],R=[],r=[],x=[],ma=[],
p=[],pa=[],qa=a.Op,D=a.La,ea=a.om,Ba=a.Ae,hc=a.rg,hb=a.lx,xa=a.Qx,ab=a.$f,zb=a.yg,ic=a.dg,Ab=a.antialiasing,Ua=a.dA,$a=a.Nb,Ia=a.Sc,Zb=a.ox,Sa=a.Vt,Ga=a.du,Bb=a.Jw,Ub=a.Gw,ob=a.hg,Ra=a.jv,Va=Boolean(e.length),za=[];if(a.anaglyph_use&&!Va){var pb=d.J[0],Mb=c(pb);na.Yp(pb,na.Db);na.Yp(Mb,na.Ib);za.push(pb,Mb);d.J.push(Mb)}else{var ua=d.J[0];za.push(ua)}if(ea){na.Rm(za[0],Ia);for(var rb=Ia.csm_num,da=0;da<rb;da++){var Nb=q(da,Ia);Q.w(s,Nb);p.push(Nb);var ya=Ia.csm_resolution,ua=Nb.j;ua.width=ya;ua.height=
ya;Nb.ea=!1;pa.push(l("DEPTH","u_shadow_map"+da,ya,1,!1));(la.ao()||Ea.Wo)&&Nb.ca.push(l("COLOR","COLOR",ya,1,!1))}}if(0<xa.length&&!Va)for(da=0;da<za.length;da++){ua=c(za[da]);d.J.push(ua);var Aa=t("REFLECT",ua,!1,D,qa,$a,Ua,null,a.Tg);Aa.Ab=xa[0];Aa.j.Ab=xa[0];Q.w(s,Aa);R.push(Aa);r.push(l("COLOR","u_reflectmap",1,Ea.ei,!0));Aa.ca.push(l("DEPTH","DEPTH",1,Ea.ei,!0))}h=[];M=[];if(a.Ca){var Da=z();Q.w(s,Da);ya=vb.kj;Da.j.width=ya;Da.j.height=ya;var xb=l("DEPTH","u_grass_map_depth",ya,1,!1);xb.na=
ia.B;xb.ma=ia.B;var yb=l("COLOR","u_grass_map_color",ya,1,!1);yb.na=ia.B;yb.ma=ia.B}else yb=xb=Da=null;for(da=0;da<za.length;da++){var ua=za[da],Oa={};n.push(l("DEPTH","DEPTH",1,1,!0));if(Ra){var Ob=c(ua);d.J.push(Ob);if(ea){Oa=y(Ob,Ia);Q.w(s,Oa);for(var ib=0;ib<p.length;ib++)Nb=p[ib],Q.m(s,Nb,Oa,pa[ib]);var Pb=l("COLOR","u_color",1,1,!0),cc=l("DEPTH","u_depth",1,1,!0);if(Ba){var uc=c(ua);d.J.push(uc);var Vb=a.$y,Gb=L(uc,$a,Vb);Q.w(s,Gb);var jc=l("COLOR","u_ssao_mask",1,1,!0);Q.m(s,Oa,Gb,Pb);Q.m(s,
Oa,Gb,cc);var kc=c(ua);d.J.push(kc);var Ta=Z(kc,Vb);Q.w(s,Ta);var lc=l("COLOR","u_shadow_mask",1,1,!0);Q.m(s,Gb,Ta,jc);Q.m(s,Oa,Ta,cc)}var Wb=c(Ob);d.J.push(Wb);var bb=H(Wb)}else Oa=y(Ob,Ia),Q.w(s,Oa),la.ao()&&Oa.ca.push(l("COLOR","COLOR",1,1,!0)),Wb=c(Ob),d.J.push(Wb),bb=H(Wb);Q.w(s,bb);Q.m(s,Oa,bb,l("DEPTH","u_depth",1,1,!0));m.push(bb);Da&&(Q.m(s,Da,Oa,xb),Q.m(s,Da,Oa,yb))}Aa=t("OPAQUE",ua,!Ra,D,qa,$a,Ua,null,a.Tg);Q.w(s,Aa);M.push(Aa);Ra&&(Q.m(s,Oa,Aa,n[da]),jc?Q.m(s,Ta,Aa,lc):Q.m(s,Oa,Aa,l("COLOR",
"u_shadow_mask",1,1,!0)));var dc=l("COLOR","u_color",1,1,!0);V.push(l("COLOR","COLOR",1,1,!0));Da&&(Q.m(s,Da,Aa,xb),Q.m(s,Da,Aa,yb));R.length&&(Q.m(s,R[da],Aa,r[da]),Aa.Ab=xa[0])}h=M;M=[];if(!Va&&a.qo){ua=c(h[0].j);d.J.push(ua);var sb=B(ua,!1);Q.w(s,sb);if(a.Qd){ua=c(h[0].j);d.J.push(ua);var C=B(ua,!0);Q.w(s,C);Q.m(s,sb,C,l("COLOR","COLOR",1,1,!0));Q.m(s,sb,C,l("DEPTH","DEPTH",1,1,!0))}}else sb=null;if(hb.Ac&&!Va)for(da=0;da<za.length;da++){var cb=P();Q.w(s,cb);Q.m(s,h[da],cb,dc);x.push(cb);ma.push(l("COLOR",
"u_refractmap",1,1,!0))}for(var Wa=[],da=0;da<za.length;da++)Aa=f("BLEND",da),Wa.push(Aa);h=M;M=[];if(a.Qd){for(da=0;da<za.length;da++)f("XRAY",da);h=M;M=[]}if(Ea.wireframe_debug){for(da=0;da<za.length;da++){ua=Za.wa(za[da]);d.J.push(ua);var Xa=O(ua);M.push(Xa);Q.w(s,Xa);Q.m(s,h[da],Xa,V[da]);Q.m(s,h[da],Xa,n[da]);Da&&(Q.m(s,Da,Xa,xb),Q.m(s,Da,Xa,yb))}h=M;M=[]}if(hc&&Ra&&!Va){for(da=0;da<za.length;da++){var oa=Bb.wg,W=Bb.Uw,Ka=Bb.Sg,Qa=h[da],La=D?1:0,Hb=l("DEPTH","u_input",1,1,!0);Hb.na=ia.B;Hb.ma=
ia.B;var Ib=l("COLOR","u_input",1,.25,!0);Ib.na=ia.B;Ib.ma=ia.B;var Jb=oa/Ka,Qb=c(za[da]);d.J.push(Qb);var Kb=ca(Qb,La,oa,!0,Jb,qa,Ka);Q.w(s,Kb);Q.m(s,Qa,Kb,Hb);var Jb=oa/Ka*.5,Xb=c(za[da]);d.J.push(Xb);var mc=ca(Xb,La,oa,!1,Jb,qa,Ka);Q.w(s,mc);Q.m(s,Kb,mc,Ib);var Jb=oa/Ka*.25,Dc=c(za[da]);d.J.push(Dc);var Pa=ca(Dc,La,oa,!1,Jb,qa,Ka);Q.w(s,Pa);Q.m(s,mc,Pa,Ib);R.length&&(Kb.Ab=xa[0],mc.Ab=xa[0],Pa.Ab=xa[0]);var Ma=X(W,qa);M.push(Ma);Q.w(s,Ma);Q.m(s,Qa,Ma,l("COLOR","u_main",1,1,!0));Q.m(s,Pa,Ma,l("COLOR",
"u_god_rays",1,1,!0))}h=M;M=[]}if(ab&&!Va){for(da=0;da<za.length;da++){var Qa=h[da],Yc=ja();Q.w(s,Yc);Q.m(s,Qa,Yc,l("COLOR","u_input",1,1,!0));var Cb=N();Q.w(s,Cb);Cb.j.width=1;Cb.j.height=1;var Ec=l("COLOR","u_input",1,.25,!0);Ec.na=ia.B;Ec.ma=ia.B;var vc=l("COLOR","u_luminance",1,.25,!0);vc.na=ia.B;vc.ma=ia.B;Q.m(s,Yc,Cb,Ec);var kd=Sa.key,ec=Sa.pv,Jc=c(za[da]);d.J.push(Jc);var $b=I(kd,ec,qa,Jc);Q.w(s,$b);Q.m(s,Qa,$b,l("COLOR","u_main",1,1,!0));Q.m(s,Yc,$b,vc);Q.m(s,Cb,$b,l("COLOR","u_average_lum",
1,1,!1));var jb=l("COLOR","u_color",1,.25,!0);jb.na=ia.B;jb.ma=ia.B;var Db=G("X_BLUR");Q.w(s,Db);Q.m(s,$b,Db,jb);var wc=G("Y_BLUR");Q.w(s,wc);Q.m(s,Db,wc,jb);var xc=Y(Sa.blur);Q.w(s,xc);var nc=l("COLOR","u_bloom",1,.25,!0);nc.na=ia.B;nc.ma=ia.B;Q.m(s,wc,xc,nc);Q.m(s,Qa,xc,l("COLOR","u_main",1,1,!0));M.push(xc)}h=M;M=[]}if(zb&&!Va){for(da=0;da<h.length;da++){var ac=h[da],oc=K(Zb.Cj,Zb.Dj);M.push(oc);Q.w(s,oc);Q.m(s,ac,oc,l("COLOR","u_mb_tex_curr",1,1,!0));oc.ca.push(l("COLOR","u_mb_tex_accum",1,1,
!0))}h=M;M=[]}if(ob&&Ra&&!Va){for(da=0;da<h.length;da++){var Qa=h[da],Rb=c(za[da]);d.J.push(Rb);jb=l("COLOR","u_color",1,1,!0);jb.na=ia.B;jb.ma=ia.B;var qb=A("X_BLUR");Q.w(s,qb);Q.m(s,Qa,qb,jb);var Eb=A("Y_BLUR");Q.w(s,Eb);Q.m(s,qb,Eb,jb);var Oa=Wa[da],fc=S(Rb);Rb.dof_distance=d.dof_distance;Rb.$e=d.$e;Rb.dof_front=d.dof_front;Rb.dof_rear=d.dof_rear;Rb.dof_power=d.dof_power;Rb.dof_on=1;M.push(fc);Q.w(s,fc);Q.m(s,Qa,fc,l("COLOR","u_sharp",1,1,!0));Q.m(s,Eb,fc,l("COLOR","u_blurred",1,1,!0));Q.m(s,Oa,
fc,l("DEPTH","u_depth",1,1,!0))}h=M;M=[]}if(!Va&&a.glow){for(da=0;da<za.length;da++){var Qa=h[da],tb=c(za[da]);d.J.push(tb);var Kc=T(tb);Q.w(s,Kc);var yc=A("X_EXTEND"),md=l("COLOR","u_color",1,1,!0),Lc=l("COLOR","u_glow_mask",1,1,!0);yc.Mh=!0;Q.w(s,yc);Q.m(s,Kc,yc,md);var zc=l("COLOR","u_color",1,.5,!0);zc.na=ia.B;zc.ma=ia.B;var Fc=A("Y_EXTEND");Fc.Mh=!0;Q.w(s,Fc);Q.m(s,yc,Fc,zc);qb=A("X_BLUR");qb.Mh=!0;Q.w(s,qb);Q.m(s,Fc,qb,zc);var Fb=l("COLOR","u_color",1,.25,!0);Fb.na=ia.B;Fb.ma=ia.B;var Zc=l("COLOR",
"u_glow_mask_blurred",1,.25,!0);Zc.na=ia.B;Zc.ma=ia.B;Eb=A("Y_BLUR");Eb.Mh=!0;Q.w(s,Eb);Q.m(s,qb,Eb,Fb);var Gc=ba(Ub);Q.w(s,Gc);Q.m(s,Qa,Gc,l("COLOR","u_glow_src",1,1,!0));Q.m(s,Kc,Gc,Lc);Q.m(s,Eb,Gc,Zc);M.push(Gc)}h=M;M=[]}if(ic&&!Va){for(da=0;da<h.length;da++){var Qa=h[da],Mc=U(Ga.brightness,Ga.contrast,Ga.exposure,Ga.saturation);Q.w(s,Mc);Q.m(s,Qa,Mc,l("COLOR","u_color",1,1,!0));M.push(Mc)}h=M;M=[]}if(Ab){for(da=0;da<h.length;da++)if(Qa=h[da],Ea.smaa){var Ac=l("COLOR","u_color",1,1,!0);Ac.na=ia.B;
Ac.ma=ia.B;var db=F("SMAA_EDGE_DETECTION");Q.w(s,db);Q.m(s,Qa,db,Ac);var gc=F("SMAA_BLENDING_WEIGHT_CALCULATION");Q.w(s,gc);Q.m(s,db,gc,Ac);var Nc=l("COLOR","u_search_tex",1,1,!1),Hc=l("COLOR","u_area_tex",1,1,!1);Nc.na=ia.B;Nc.ma=ia.B;Hc.na=ia.B;Hc.ma=ia.B;gc.ca.push(Nc);gc.ca.push(Hc);var Oc=F("SMAA_NEIGHBORHOOD_BLENDING");Q.w(s,Oc);Q.m(s,Qa,Oc,Ac);var Pc=l("COLOR","u_blend",1,1,!0);Pc.na=ia.B;Pc.ma=ia.B;Q.m(s,gc,Oc,Pc);M.push(Oc)}else{var Qc=J();Q.w(s,Qc);var Rc=l("COLOR","u_color",1,1,!0);Rc.na=
ia.B;Rc.ma=ia.B;Q.m(s,Qa,Qc,Rc);if(1<Ea.resolution_factor){var $c=A("NONE");Q.w(s,$c);Q.m(s,Qc,$c,Rc);M.push($c)}else M.push(Qc)}h=M;M=[]}if(a.anaglyph_use&&!Va){var Sc=fa();Q.w(s,Sc);Q.m(s,h[0],Sc,l("COLOR","u_sampler_left",1,1,!0));Q.m(s,h[1],Sc,l("COLOR","u_sampler_right",1,1,!0));M.push(Sc)}else M.push(h[0]);var fd=Q.Ag(s,h[0]),pc=!1;Q.Od(s,fd,function(a,b,c){if(c.N==c.da)return pc=!0});if(pc){var Sb=w();Q.w(s,Sb);Q.m(s,h[0],Sb,l("COLOR","u_color",1,1,!0));h=M;M=[];M.push(Sb)}sb&&(C?M.push(C):
M.push(sb));if(!Va&&a.ym.procedural_skydome){var qc=aa(qa,a.ym);Q.w(s,qc);M.push(qc)}var rc=ga();Q.w(s,rc);for(da=0;da<M.length;da++)switch(M[da].type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":Q.m(s,M[da],rc,l("COLOR","NONE",1,1,!0));Q.m(s,M[da],rc,l("DEPTH","NONE",1,1,!0));break;case "SKY":Q.m(s,qc,rc,l("CUBEMAP","u_sky",vb.$i,1,!1));break;default:if(Va){var ad=e[0].d,Bc=l("COLOR","OFFSCREEN",1,1,!0);Bc.ga=ad;Q.m(s,M[da],rc,Bc);for(ib=1;ib<e.length;ib++){var bd=e[ib].d,Sb=w();Q.w(s,Sb);Q.m(s,
M[da],Sb,l("COLOR","u_color",1,1,!0));Bc=l("COLOR","OFFSCREEN",1,bd.Mf/ad.Mf,!0);Bc.ga=bd;Q.m(s,Sb,rc,Bc)}}else Q.m(s,M[da],rc,l("SCREEN","NONE",1,1,!0))}if(Ra)for(var Tc=Q.wl(s),da=0;da<Tc.length;da++)for(var cd=Tc[da],ib=0;ib<m.length;ib++)Oa=m[ib],Q.Qa(s,cd)==Oa&&Q.Eg(s,cd);if(va.enabled){var Yb=u(s);Yb&&E(s,Yb)}b(s,Ra);1<Ea.resolution_factor&&k(s);g(s);v(s);return s};a.PB=D;a.kB=function(a){var b=null;Q.P(a,function(a,c){return c.j&&null===c.j.ge?(b=c,!0):!1});return b};a.nb=function(a,b,c){a=
s(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.IB=qa;a.Ow=M;a.Ev=R;a.jp=s;a.DB=V;a.ab=function(a,b){var c=null;Q.P(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.av=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=ma(a);Q.P(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(f+=" ("+d.$h.replace(/_/g,
" ")+")");if(d.j){for(var f=f+"\\n",s=0;s<c.length;s+=2)c[s]==d.j.ub&&(f+="C"+c[s+1]+" ");for(s=0;s<c.length;s+=2)c[s]==d.j.oc&&(f+="D"+c[s+1])}d.ca.length&&(f+="\\n-----\\n");for(s=0;s<d.ca.length;s++)f+=pa(d.ca[s],c);s="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(s+",bold")+'"];\n')});Q.De(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+pa(e,c)+'" style="'+(e.Ba?"solid":"dotted")+'"];\n'});return b+="}"};a.Mu=function(a){a=
Q.nz(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,p){function c(){return{name:"",type:0,source:"",width:0,height:0,Rk:1,Gi:!0,Mf:1024,Lo:!1,nd:null,Xa:null,Fg:null,Sq:1,Kd:0,Gg:!1,mk:!1,of:!1,R:0,xa:0,lg:0,Nz:!1,Pf:!1,Zl:0,Ob:0,Hb:0,Ka:null,Fe:null}}function b(b,d,f){var g=b.type,h=new Uint8Array([204,204,204,255]),l=c();switch(g){case "DATA_TEX2D":case "IMAGE":var k=t.createTexture(),m=t.TEXTURE_2D;t.bindTexture(m,k);t.texImage2D(m,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,h);b.image&&"MOVIE"==b.image.source&&(l.of=
!0,l.R=b.frame_start,l.xa=b.frame_offset,l.lg=b.frame_duration,l.Nz=b.use_auto_refresh,l.Pf=b.use_cyclic,l.Zl=b.movie_length,0!=l.xa&&v.warn('Frame offset for texture "'+b.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":k=t.createTexture();m=t.TEXTURE_2D;t.bindTexture(m,k);if("NONE"==b.b4w_source_type)return null;if("SCENE"==b.b4w_source_type)if(b.b4w_source_id&&(f=q.keysearch("name",b.b4w_source_id,f)))l.Mf=b.b4w_source_size,f.Td=f.Td||[],f.Td.push(b),
t.texImage2D(m,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,h);else return null;break;case "ENVIRONMENT_MAP":k=t.createTexture();m=t.TEXTURE_CUBE_MAP;t.bindTexture(m,k);f="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var n=0;6>n;n++)t.texImage2D(t["TEXTURE_CUBE_MAP_"+f[n]],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,h);break;case "VORONOI":case "BLEND":return null;default:return v.error('B4W warning: texture "'+b.name+'" has unsupported type "'+g+'"'),null}("NONE"!=g||b.b4w_enable_canvas_mipmapping&&
"CANVAS"==b.b4w_source_type)&&"DATA_TEX2D"!=g?t.texParameteri(m,t.TEXTURE_MIN_FILTER,B[D.ck]):t.texParameteri(m,t.TEXTURE_MIN_FILTER,t.LINEAR);t.texParameteri(m,t.TEXTURE_MAG_FILTER,t.LINEAR);h=m;f=b.b4w_anisotropic_filtering;"DEFAULT"===f&&(f=d);"OFF"!==f&&D.Hi&&(d=E.dw())&&(f=parseFloat(f.split("x")[0]),t.texParameterf(h,d.TEXTURE_MAX_ANISOTROPY_EXT,f));"REPEAT"!=b.extension||b.b4w_shore_dist_map?(t.texParameteri(m,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(m,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)):
(t.texParameteri(m,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(m,t.TEXTURE_WRAP_T,t.REPEAT));l.type=a.Zf;l.width=1;l.height=1;l.Ka=k;l.Hb=m;"CANVAS"==b.b4w_source_type&&"NONE"==g?(g=b.b4w_source_id,k=b.b4w_source_size,l.Lo=b.b4w_enable_canvas_mipmapping,l.name=g,l.source="CANVAS",m=document.createElement("canvas"),m.setAttribute("id",g),m.width=k,m.height=k,l.nd=m.getContext("2d"),A[g]=l,e(l)):"SCENE"==b.b4w_source_type&&"NONE"==g?(l.name=b.b4w_source_id,l.source="SCENE"):(l.name=b.name,l.source=g,
t.generateMipmap(m),t.bindTexture(m,null));return b.d=l}function e(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Hb;t.bindTexture(b,a.Ka);var c=f(a),d=m(a),e=a.nd.canvas;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);t.texImage2D(b,0,c,c,d,e);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1);a.Lo&&t.generateMipmap(b);t.bindTexture(b,null);a.width=e.width;a.height=e.height}function d(a){var b=a.Hb;t.bindTexture(b,a.Ka);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);t.texImage2D(b,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a.Fg[a.Kd]);
t.bindTexture(b,null)}function g(a){t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.LINEAR)}function k(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function f(b){switch(b.type){case a.Zf:b=t.RGBA;break;case a.pk:b=t.RGB;break;case a.Ci:b=t.RGBA;break;case a.Di:b=t.RGB;break;case a.ih:b=t.DEPTH_COMPONENT;
break;default:throw"Wrong texture type";}return b}function m(b){switch(b.type){case a.Zf:b=t.UNSIGNED_BYTE;break;case a.pk:b=t.UNSIGNED_BYTE;break;case a.Ci:b=t.FLOAT;break;case a.Di:b=t.FLOAT;break;case a.ih:b=t.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function h(a){return a in G?(D.Cc?G[a].Gg=!0:G[a].Xa.play(),!0):null}function r(a){return a in G?(a=G[a],D.Cc?(a.Kd=a.xa,d(a),a.Kd++):a.Xa.currentTime=a.xa/a.Ob,!0):null}function n(a){return a in G?(D.Cc?G[a].Gg=!1:G[a].Xa.pause(),
!0):null}var x=p("__config"),v=p("__print"),u=p("__dds"),E=p("__extensions"),q=p("__util"),D=x.p,l=x.hd,z=x.Ld;a.ed=0;a.B=0;a.dt=0;a.bt=0;a.ct=0;a.at=0;a.Zf=10;a.pk=20;a.Ci=30;a.Di=40;a.ih=50;a.Yf=60;var A={},G={},t=null,B;a.ec=function(b){B=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.ed=b.NEAREST;a.B=b.LINEAR;a.dt=b.NEAREST_MIPMAP_NEAREST;a.bt=b.LINEAR_MIPMAP_NEAREST;a.ct=b.NEAREST_MIPMAP_LINEAR;a.at=b.LINEAR_MIPMAP_LINEAR;t=b};a.hw=function(a){return a in
A?A[a].nd:null};a.xz=function(a){return a in A?(e(A[a]),!0):!1};a.Zi=function(b,d){var e=c();e.name=b;e.type=d;e.source="NONE";if(d==a.Yf)e.Fe=t.createRenderbuffer();else{var f=t.TEXTURE_2D,g=t.createTexture();t.bindTexture(f,g);t.texParameteri(f,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(f,t.TEXTURE_MIN_FILTER,t.LINEAR);t.texParameteri(f,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(f,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.bindTexture(f,null);e.Hb=f;e.Ka=g}return e};a.Bu=function(b){var d=t.createTexture(),
e=t.TEXTURE_CUBE_MAP;t.bindTexture(e,d);t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.LINEAR);t.texParameteri(e,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(e,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),g=0;6>g;g++)t.texImage2D(t[f[g]],0,t.RGBA,b,b,0,t.RGBA,t.UNSIGNED_BYTE,
null);t.bindTexture(e,null);e=c();e.name="CUBEMAP";e.type=a.Zf;e.source="NONE";e.width=3*b;e.height=2*b;e.Rk=1;e.Ka=d;e.Hb=t.TEXTURE_CUBE_MAP;return e};a.sm=function(b,c,d){if(b.type!=a.Yf){var e=b.Hb;t.bindTexture(e,b.Ka);c&&t.texParameteri(e,t.TEXTURE_MIN_FILTER,c);d&&t.texParameteri(e,t.TEXTURE_MAG_FILTER,d);t.bindTexture(e,null)}};a.BB=function(b){if(b.type==a.Yf)return{min:a.ed,hx:a.ed};var c=b.Hb;t.bindTexture(c,b.Ka);b=t.getTexParameter(c,t.TEXTURE_MIN_FILTER);var d=t.getTexParameter(c,t.TEXTURE_MAG_FILTER);
t.bindTexture(c,null);return{min:b,hx:d}};a.resize=function(b,c,d){c=Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.Yf)t.bindRenderbuffer(t.RENDERBUFFER,b.Fe),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,c,d),t.bindRenderbuffer(t.RENDERBUFFER,null);else{var e=b.Hb;t.bindTexture(e,b.Ka);var g=f(b),h=m(b);t.texImage2D(e,0,g,c,d,0,g,h,null);t.bindTexture(e,null)}c>D.Mc||d>D.Mc?v.error('B4W warning: Slink texture "'+b.name+'" has unsupported size'):(b.width=c,b.height=
d)}};a.Vu=b;a.Lz=function(a){var b=a.Hb;t.bindTexture(b,a.Ka);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);4!=a.Xa.length?t.texImage2D(b,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a.Xa):t.texImage2D(b,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,a.Xa);t.bindTexture(b,null)};a.Hz=d;a.qi=function(a,b,c,d){var e=a.source,f=a.Hb;t.bindTexture(f,a.Ka);if(4==b.length){var h=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==e)if(h)t.texImage2D(f,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,b),a.width=1,a.height=
1;else if(c){c=u.qp(b);if(c.width>D.Mc||c.height>D.Mc){v.error("B4W warning: texture has unsupported size",d);return}u.Mz(t,E.np(),b,!0);k(c.width,c.height)&&(a.Ln||v.warn("B4W warning: using NPOT texture",d),g(f));a.width=c.width;a.height=c.height;a.Rk=u.kw(b)}else{t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>D.Mc||b.height>D.Mc){v.error("B4W warning: texture has unsupported size",d);return}a.of?D.Cc?b&&(G[a.name]=a,a.Fg=b,a.Ob=a.Zl/b.length,a.lg=Math.round(a.lg/a.Ob),a.xa=Math.round(a.xa/
a.Ob),a.R=Math.round(a.R/a.Ob),a.Kd=a.xa,t.texImage2D(f,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a.Fg[0])):(a.Xa=b,a.Xa.loop=a.Pf,b&&(G[a.name]=a),a.Ob=l.za,b.duration&&(a.Ob=a.Zl/b.duration),z.Io||(b.playbackRate=l.za/a.Ob,z.fo&&2<b.playbackRate&&(b.playbackRate=2)),t.texImage2D(f,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,a.Xa)):t.texImage2D(f,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,b);D.Cc&&a.of?(a.width=b[0].width,a.height=b[0].height):(a.width=b.width,a.height=b.height);k(b.width,b.height)?(a.Ln||(a.of?v.warn("B4W warning: using NPOT video texture",
d):v.warn("B4W warning: using NPOT texture",d)),g(f)):a.of||t.generateMipmap(f)}else if("ENVIRONMENT_MAP"==e)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],h){for(h=0;6>h;h++)e=c[h],t.texImage2D(t["TEXTURE_CUBE_MAP_"+e[0]],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1);var m=b.width/3;if(m>D.Vl||m>D.Vl){v.error("B4W warning: cubemap has unsupported size",d);return}for(h=
0;6>h;h++){var e=c[h],n=document.createElement("canvas");n.width=m;n.height=m;var r=n.getContext("2d");"POSITIVE_Y"==e[0]||"NEGATIVE_Y"==e[0]?(r.translate(0,m),r.scale(1,-1)):(r.translate(m,0),r.scale(-1,1));r.drawImage(b,e[1]*m,e[2]*m,m,m,0,0,m,m);t.texImage2D(t["TEXTURE_CUBE_MAP_"+e[0]],0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)}a.width=3*m;a.height=2*m;k(b.width/3,b.height/2)?(v.warn("B4W warning: using NPOT cube map texture",d),g(f)):t.generateMipmap(f)}else"DATA_TEX2D"==e&&(t.texImage2D(f,0,t.RGBA,b.width,
b.height,0,t.RGBA,t.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);t.bindTexture(f,null)};a.iv=function(a){t.deleteTexture(a)};a.Oh=function(a){return a&&a.name&&(a.Ka||a.Fe)?!0:!1};a.Kp=function(a){return a&&a.name&&a.Fe?!0:!1};a.VB=function(b){return b.type==a.Ci||b.type==a.Di?!0:!1};a.Aw=function(b){var c=0;switch(b.type){case a.Zf:case a.pk:c=4;break;case a.Ci:case a.Di:c=16;break;case a.ih:c=3;break;case a.Yf:c=2}return c};a.Zv=function(a){var c=null,c={name:"special_ssao_texture",
type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};b(c,null,a);c.image={filepath:null};return c};a.cleanup=function(){A={};G={}};a.play_video=h;a.reset_video=r;a.pause_video=n;a.pause=function(){for(var a in G)D.Cc&&!G[a].Gg||!D.Cc&&G[a].Xa.paused||(n(a),G[a].mk=!0)};a.reset=function(){for(var a in G)r(a),G[a].mk=!1};a.play=function(a){for(var b in G)if(!a||G[b].mk)h(b),G[b].mk=!1}};b4w.module.__assets=function(a,p){function c(){return u.Jp()?p(u.Qb.Qi).data:null}function b(){var a={Ei:null,kt:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.Ei=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=c();b&&a.Ei in b&&(a.status=200,b[a.Ei]&&(a.response=a.kt(b[a.Ei])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function e(b){for(var c=0,e=0;e<b.length;e++){var l=b[e];20===l.state&&c++;if(c>=A.mx)break;if(10===l.state)switch(l.state=20,c++,l.type){case a.AT_ARRAYBUFFER:d(l,"arraybuffer");break;case a.AT_JSON:d(l,"json");break;case a.AT_TEXT:d(l,"text");break;case a.AT_AUDIOBUFFER:g(l);break;case a.AT_IMAGE_ELEMENT:k(l);
break;case a.AT_AUDIO_ELEMENT:f(l);break;case a.zi:m(l);break;case a.yi:h(l);break;default:throw"Wrong asset type: "+l.type;}}}function d(a,d){var e=c(),f=e&&a.r in e?new b:new XMLHttpRequest;f.open("GET",a.r,!0);"text"==d?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==d?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=d;f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;if(b){if("json"==d&&
"string"==typeof b)try{b=JSON.parse(b)}catch(c){a.Za(null,a.uri,a.type,a.r,a.fb);E.error(c+" (parsing JSON "+a.r+")");return}a.Za(b,a.uri,a.type,a.r,a.fb)}else a.Za(null,a.uri,a.type,a.r,a.fb),E.error("B4W Error: empty responce when trying to get "+a.r)}else a.Za(null,a.uri,a.type,a.r,a.fb),E.error("B4W Error: "+f.status+" when trying to get "+a.r);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.Gq(b.loaded/b.total)},!1);f.send(null)}function g(a){var d=c(),e=d&&a.r in
d?new b:new XMLHttpRequest;e.open("GET",a.r,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?q.ev(b,function(b){a.Za(b,a.uri,a.type,a.r,a.fb);a.state=30},function(){a.Za(null,a.uri,a.type,a.r,a.fb);E.error("B4W Error: failed to decode "+a.r);a.state=30}):(a.Za(null,a.uri,a.type,a.r,a.fb),E.error("B4W Error: empty responce when trying to get "+a.r),a.state=30)}else a.Za(null,a.uri,a.type,a.r,a.fb),E.error("B4W Error: "+
e.status+" when trying to get "+a.r),a.state=30};e.send(null)}function k(a){var b=document.createElement("img");G.allow_cors&&(b.crossOrigin="Anonymous");b.onload=function(){40!=a.state&&(a.Za(b,a.uri,a.type,a.r,a.fb),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.Za(null,a.uri,a.type,a.r,a.fb),E.error("B4W Error: could not load image: "+a.r),a.state=30)},!1);var d=c();if(d&&a.r in d)if(d[a.r]){var e=n(a.r);b.src="data:"+e+";base64,"+d[a.r]}else z.Hl()?(d=document.createEvent("CustomEvent"),
d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.r}function f(a){var b=document.createElement("audio");G.allow_cors&&(b.crossOrigin="Anonymous");b.addEventListener("loadeddata",function(){40!=a.state&&(a.Za(b,a.uri,a.type,a.r,a.fb),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.Za(null,a.uri,a.type,a.r,a.fb),E.error("B4W Error: could not load sound: "+a.r),a.state=30)},!1);var d=c();if(d&&a.r in d)if(d[a.r]){var e=x(a.r);b.src=
"data:"+e+";base64,"+d[a.r];40!=a.state&&(a.Za(b,a.uri,a.type,a.r,a.fb),a.state=30)}else z.Hl()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.r,G.nf&&b.load();setTimeout(function(){b.Ly=1},5E3)}function m(a){var b=document.createElement("video");b.muted=!0;if(G.allow_cors||G.nf)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.Za(b,a.uri,a.type,a.r,a.fb),a.state=30)},!1);b.addEventListener("error",
function(){40!=a.state&&(a.Za(null,a.uri,a.type,a.r),E.error("B4W Error: could not load video: "+a.r,a.fb),a.state=30)},!1);var d=c();if(d&&a.r in d)if(d[a.r]){var e=v(a.r);b.src="data:"+e+";base64,"+d[a.r];40!=a.state&&(a.Za(b,a.uri,a.type,a.r,a.fb),a.state=30)}else z.Hl()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=a.r,G.nf&&b.load();setTimeout(function(){b.Ly=1},1E4)}function h(a){function d(b){a.Za(b,a.uri,
a.type,a.r,a.fb)}var e=c(),f=e&&a.r in e?new b:new XMLHttpRequest;f.open("GET",a.r,!0);f.responseType="arraybuffer";f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;b?r(b,d):(a.Za(null,a.uri,a.type,a.r,a.fb),E.error("B4W Error: empty responce when trying to get "+a.r))}else a.Za(null,a.uri,a.type,a.r,a.fb),E.error("B4W Error: "+f.status+" when trying to get "+a.r);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&
a.Gq(b.loaded/b.total)},!1);f.send(null)}function r(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],f={images:[],Ob:c[4]},g=20,h=0;h<e;h++){var l=c[g/4],k=new Blob([d.subarray(g+4,g+4+l)],{type:"image/jpg"}),m=document.createElement("img");m.src=window.URL.createObjectURL(k);f.images.push(m);g+=l+8-l%4}m.onload=function(){b(f)}}function n(a){var b="image";switch(D.tl(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function x(a){var b="audio";switch(D.tl(a).toLowerCase()){case "ogv":case "ogg":b+=
"/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function v(a){var b="video";switch(D.tl(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var u=p("__config"),E=p("__print"),q=p("__sfx"),D=p("__util"),l=p("__version"),z=p("__compat"),A=u.kd,G=u.p;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.zi=70;a.yi=80;var t=[],B=0,
O={};a.mi=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.zw=function(a){if(O[a])return O[a];var b=A.Dq?a+l.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return O[a]=b;throw"Error XHR: responce is empty, GET "+a;}throw"Error XHR: "+c.status+", GET "+a;};a.cleanup=function(){for(var a=0;a<t.length;a++)t[a].state=40;t=[];B=0;O=
{}};a.enqueue=function(a,b,d,f){for(var g=0;g<a.length;g++){var h=a[g],h={uri:h[0],type:h[1],r:h[2],fb:h[3],state:10,Za:b||function(){},wq:d||function(){},Gq:f||function(){},xq:B};if(A.Dq){var k=c();k&&h.r in k||(h.r+=l.timestamp())}t.push(h)}e(t);B++};a.update=function(){e(t);for(var a=t,b=0,c=!0,d=0;d<a.length;d++){var f=a[d];f.xq===a[b].xq?30!==f.state&&(c=!1):(c&&(a[d-1].wq(),c=d-b,a.splice(b,c),d-=c),b=d,c=30===a[d].state?!0:!1);d===a.length-1&&c&&(a[d].wq(),a.splice(b))}}};b4w.module.__loader=function(a,p){function c(c,d,e,f){var g=E,h=x.create(),k;for(k in d){var m=b(d[k]);(f&&m.cb||!c&&m.zb)&&n(m);x.w(h,m)}for(k in d)for(m=d[k],m.name=k,c=0;c<m.F.length;c++)x.m(h,d[m.F[c]],m,null);d=b({name:"out",Ja:a.Yr,Na:function(a,b,c,d,e){0===b.id&&(g.Eq=!0);3!=b.status&&(b.status=2);b.Wp(b.id,!0);e(b,c);v.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},gb:5});var r=[];if(e)for(e=x.wl(h),c=0;c<e.length;c++)r.push(x.Qa(h,e[c]));else x.P(h,function(a,b){b.$a||r.push(b)});
x.w(h,d);for(c=0;c<r.length;c++)d.F.push(r[c].name),x.m(h,r[c],d,null);return h}function b(a){a.$a=a.$a||!1;a.Ja||0===a.Ja||(a.Ja=a.Fc);a.F=a.F||[];a.Lh=a.Lh||!1;a.xm=a.xm||!1;a.gb=a.gb||0;a.cb=a.cb||!1;a.zb=a.zb||!1;a.status=0;a.fC=0;a.Pl=0;a.Ve=a.Ve||null;return a}function e(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];x.Qa(a.Vc,f).Lh&&(x.Ee(a.Vc,f,function(d){var e=!0;x.Od(a.Vc,d,function(a,b){if(!b.Lh)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=
d.length-1;0<=e;e--)b.splice(d[e],1);return c}function d(a){function b(c,d){var e=x.Qa(a.Vc,c),f=x.Qa(a.Vc,d),g=f.Ja-e.Ja;0==g&&(g=e.$a-f.$a);return g}var c=[],d=a.Nd,f=!1;do{var g=e(a,d);c.push.apply(c,d);0<g.length&&(f=!0);d=g}while(0<g.length);f&&c.sort(b);a.Nd=c;return a.Nd.length}function g(a,b,c){if(b.xm)return b.Lh=!0,f(a,b),!1;if(!b.Na&&!b.ag&&!b.rh)return f(a,b),!1;if(0==b.status&&(b.status++,b.Na))return b.Na(c,a,b,b.Ve,f,m),!0;if(1==b.status){if(b.ag)return b.ag(c,a,b,b.Ve,f,m),!0;b.status++}return 2==
b.status&&(b.status++,b.rh)?(b.rh(c,a,b,b.Ve,f,m),!0):!1}function k(a){if(0==a.$j)return 100;var b=0;x.P(a.Vc,function(c,d){a.do_not_load_resources&&d.cb||(b+=d.Pl*d.gb)});return u.trunc(100*b/a.$j)}function f(a,b){b.Lh=!0;b.status=3;h(a,b,1)}function m(a,b,c){1>c?h(a,b,c):b.status++}function h(a,b,c){var d=E;if(b.Na||b.ag||b.rh)if(b.Pl=c,b=k(a),a.Co!=b||1==c)a.Dm(b,performance.now()-a.xr),a.Co=b,d.Tl=!0}function r(a,b){var c=null;x.P(a.Vc,function(a,d){if(d.name==b)return c=d,1});return c}function n(a){a.xm=
!0;a.Pl=1}var x=p("__graph"),v=p("__print"),u=p("__util");a.Fc=0;a.Ke=1;a.Yr=2;var E=null;a.op=function(){return E};a.Nu=function(){var a={Zc:[],Zk:0,sk:0,Eq:!1,Tl:!1};return E=a};a.Wu=function(a,b,d,e,f,g,h,k){var m=E,n={id:m.Zc.length,status:0,r:b,Nn:"",Wp:d||function(){},Vp:k||!1,LC:g,xr:0,Co:0,$j:0,pm:!1,Dm:e||function(){},ro:f||function(){},Vc:null,Nd:null,El:!1,Dl:!1,Gl:!1};a=c(0===n.id,a,g,h);n.Vc=a;b=[];d=x.xw(a);for(e=0;e<d.length;e++)b.push(d[e]);n.Nd=b;x.P(a,function(a,b){!(b.Na||b.ag||
b.rh)||n.do_not_load_resources&&b.cb||(n.$j+=b.gb)});m.Zc.push(n);m.sk++;return n.id};a.Gz=function(b){var c=E;if(c&&0!=E.sk)if(c.Tl)c.Tl=!1;else{var e=performance.now();do{var f=c.Zc[c.Zk],h=b[f.id];if(3!=f.status)if(0==f.status&&(f.status=1,f.xr=performance.now(),f.Dm(0,0)),d(f)){var k=f,m=k.Nd.length;do{var n=x.Qa(k.Vc,k.Nd[0]),r=g(k,n,h);n.Ja==a.Ke&&(k.pm=!0);n=k.Nd.shift();k.Nd.push(n);m--}while(!r&&0!=m)}else f.ro(h,f),f.status=3,c.sk--,k=f,k.Dm=null,k.ro=null,k.Vc=null,k.Nd=null;c.Eq&&(c.Zk=
(c.Zk+1)%c.Zc.length);if(f.pm){f.pm=!1;break}}while(16>performance.now()-e)}};a.BC=m;a.cr=function(a,b){var c=r(a,b);null!==c&&n(c)};a.mz=function(a){return a&&3==a.status};a.is_primary_loaded=function(a){var b=E;if(!b)return!1;a|=0;return b.Zc[a]&&(3==b.Zc[a].status||2==b.Zc[a].status)};a.cleanup=function(){E=null}};b4w.module.__nla=function(a,p){function c(){return{type:"CLIP",R:0,aa:0,Jd:!1,paused:!1,Wd:"",mc:0,wn:0,ot:0,Po:0,Oo:0,stop_video:!1}}function b(a,b){for(var c=a.b4w_nla_script,d=b.se,e=0;e<c.length;e++){var f=c[e];switch(f.type){case "PLAY":d.push({type:"PLAY",R:f.frame_range[0],aa:f.frame_range[1],ie:!1});break;case "SELECT":case "SELECT_PLAY":var g=u.Ih(u.Bi,f.object,0),h=u.ww(a),l=h.indexOf(g);if(-1==l){v.error("NLA script error: non-selectable object");return}for(var f={type:f.type,dr:"SELECT"==
f.type?f.target_slot:e+1,Jy:e+1,te:-1,jy:h.length,iy:l,R:f.frame_range[0],aa:f.frame_range[1],ie:!1},l=[],k=0;k<h.length;k++)l.push(n.create_selection_sensor(h[k],!0));n.create_sensor_manifold(g,"NLA_SELECT_"+e,n.CT_SHOT,l,n.fv,function(a,c,d,e){if(!(b.wb>=b.se.length)&&(d=b.se[b.wb],"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.ie)){for(d=0;d<e.jy;d++)if(n.get_sensor_value(a,c,d)&&d==e.iy){e.te=1;return}e.te=0}},f);d.push(f);break;case "JUMP":d.push({type:"JUMP",zm:f.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",
zm:f.target_slot,qu:f.condition,fi:f.register1,gi:f.register2,dm:f.number1,em:f.number2});break;case "REGSTORE":d.push({type:"REGSTORE",Rx:f.registerd,yx:f.number1});break;case "MATH":d.push({type:"MATH",Ax:f.operation,fi:f.register1,gi:f.register2,dm:f.number1,em:f.number2,Cg:f.registerd});break;case "SHOW":case "HIDE":g=u.Ih(u.Bi,f.object,0);d.push({type:f.type,obj:g});break;case "REDIRECT":d.push({type:"REDIRECT",url:f.url});break;case "PAGEPARAM":d.push({type:"PAGEPARAM",Bx:f.param_name,Cg:f.registerd});
break;case "NOOP":d.push({type:"NOOP"})}}}function e(a,b,c,f){if(a.se.length){if(a.wb>=a.se.length)if(a.cyclic)a.wb=0;else{a.xa-=l.za*c;return}var h=g(a,b,f,!1),k=a.se[a.wb];switch(k.type){case "PLAY":k.ie?h>=k.aa&&(k.ie=!1,a.wb++,e(a,b,c,f)):(a.xa+=k.R-h,k.ie=!0,d(a,k));break;case "SELECT":case "SELECT_PLAY":-1<k.te?"SELECT"==k.type||"SELECT_PLAY"==k.type&&0==k.te?(a.wb=k.te?k.dr:k.Jy,k.te=-1,e(a,b,c,f)):k.ie?h>=k.aa&&(k.ie=!1,a.wb=k.dr,k.te=-1,e(a,b,c,f)):(a.xa+=k.R-h,k.ie=!0,d(a,k)):a.xa-=l.za*
c;break;case "JUMP":a.wb=k.zm;e(a,b,c,f);break;case "CONDJUMP":var h=-1==k.fi?k.dm:a.Pc[k.fi],m=-1==k.gi?k.em:a.Pc[k.gi],n=!1;switch(k.qu){case "EQUAL":h==m&&(n=!0);break;case "NOTEQUAL":h!=m&&(n=!0);break;case "LESS":h<m&&(n=!0);break;case "GREATER":h>m&&(n=!0);break;case "LEQUAL":h<=m&&(n=!0);break;case "GEQUAL":h>=m&&(n=!0)}n?a.wb=k.zm:a.wb++;e(a,b,c,f);break;case "REGSTORE":a.Pc[k.Rx]=k.yx;a.wb++;e(a,b,c,f);break;case "MATH":h=-1==k.fi?k.dm:a.Pc[k.fi];m=-1==k.gi?k.em:a.Pc[k.gi];switch(k.Ax){case "ADD":a.Pc[k.Cg]=
h+m;break;case "MUL":a.Pc[k.Cg]=h*m;break;case "SUB":a.Pc[k.Cg]=h-m;break;case "DIV":0==m&&q.fa("Division by zero in NLA script"),a.Pc[k.Cg]=h/m}a.wb++;e(a,b,c,f);break;case "SHOW":u.show_object(k.obj);a.wb++;e(a,b,c,f);break;case "HIDE":u.hide_object(k.obj);a.wb++;e(a,b,c,f);break;case "REDIRECT":window.location.href=k.url;a.se.length=0;break;case "PAGEPARAM":a:{h=location.href.toString();if(-1!=h.indexOf("?"))for(h=h.split("?")[1].split("&"),m=0;m<h.length;m++)if(n=h[m].split("="),1<n.length&&n[0]==
k.Bx){h=Number(n[1]);break a}h=0}a.Pc[k.Cg]=h;a.wb++;e(a,b,c,f);break;case "NOOP":a.wb++,e(a,b,c,f)}}}function d(a,b){for(var c=a.se,d=0;d<c.length;d++){var e=c[d];e!=b&&(e.te=-1)}}function g(a,b,c,d){b=(b-c)*l.za+a.xa-a.R;a.cyclic&&d&&(b%=a.aa-a.R+1);return b+=a.R}function k(a,b){b?D.pause_video(a.name):(D.reset_video(a.name),D.play_video(a.name))}function f(a,b){for(var d=[],e=0;e<a.length;e++){var f=a[e].strips;if(f)for(var g=0;g<f.length;g++){var h=f[g],k=c();k.type=h.type;k.R=h.frame_start;k.aa=
h.frame_end;k.Wd=h.action?h.action.name:"";k.mc=b;k.wn=h.action_frame_start;k.ot=h.action_frame_end;d.push(k)}}return d}function m(a){return E.Fd(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}var h=p("__animation"),r=p("__camera"),n=p("__controls"),x=p("__config");p("__loader");p("__particles");var v=p("__print"),u=p("__scenes"),E=p("__sfx"),q=p("__util"),D=p("__textures"),l=x.hd,z=x.p,A=[],G=-1;a.Fz=function(a,d){var e={R:a.frame_start,aa:a.frame_end,xa:0,Ph:-1,cyclic:d,
Hd:[],M:[],se:[],wb:0,Pc:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};b(a,e);for(var g=u.Da(a,"ALL",u.DATA_ID_ALL),k=0;k<g.length;k++){var l=g[k],n=0,x=[],p=l.animation_data;if(p&&p.nla_tracks.length&&(p=p.nla_tracks,q.lf(l)||r.is_camera(l)||q.is_mesh(l)||q.Xw(l)||E.Fd(l))){var U=f(p,n);U.length&&(x=x.concat(U),n++)}m(l)&&(p=l.data.animation_data.nla_tracks,U=f(p,n),U.length&&(x=x.concat(U),n++));if(h.Cl(l))for(var D=l.data.materials,G=0;G<D.length;G++)if(U=D[G].node_tree,p=U.animation_data,U&&p){for(var p=
p.nla_tracks,U=f(p,-1),T=[],ba=0;ba<U.length;ba++)p=U[ba],-1==T.indexOf(p.Wd)&&T.push(p.Wd),p.mc=n+T.indexOf(p.Wd),x.push(p);n+=T.length}for(G=0;G<l.particle_systems.length;G++)D=l.particle_systems[G],p=D.settings,"EMITTER"==p.type&&p.b4w_allow_nla&&(p=c(),p.type="CLIP",p.R=e.R,p.aa=e.aa+1,p.Wd=D.name,p.mc=n,x.push(p),n++);D=n+1;if(q.is_mesh(l)&&l.data)for(G=0;G<l.data.b4w_vertex_anim.length;G++)U=l.data.b4w_vertex_anim[G],U.allow_nla&&(n=D,p=c(),p.type="CLIP",p.R=e.R,p.aa=e.aa+1,p.Wd=U.name,p.mc=
n,x.push(p));x.length&&(l.qk=x,e.Hd.push(l))}g=a.d.eh;for(G=0;G<g.length;G++)if(k=g[G].d,k.Xa||k.Fg)p=c(),p.type="VIDEO",l=1,z.Cc&&(l=k.Ob),p.R=Math.min(k.R*l,e.aa),p.aa=k.Pf?e.aa:Math.min((k.lg+k.R+k.xa)*l,e.aa),p.Wd=g[G].name,k.jt=p,e.M.push(k);G=e.R;g=e.aa;for(k=0;k<e.Hd.length;k++)for(l=e.Hd[k],n=l.qk,x=0;x<n.length;x++)p=n[x],D=l.name+" ["+p.R+":"+p.aa+"]",p.R=Math.max(G,p.R),p.aa=Math.min(g+1,p.aa),p.R>p.aa&&(v.warn("NLA: out of scene range: "+D),n.splice(x,1),x--);for(G=0;G<e.Hd.length;G++)for(g=
e.Hd[G].qk,k=0;k<g.length;k++){l=g[k];n=e.R;x=e.aa+1;for(p=0;p<g.length;p++)D=g[p],l.mc==D.mc&&(D.aa<=l.R&&(n=l.R),D.R>=l.aa&&(x=Math.min(x,D.R)));l.Po=n;l.Oo=x}A.push(e)};a.start=function(){G=0};a.update=function(a,b){if(!(0>G)){0==G&&(G=a);for(var c=0;c<A.length;c++){var d=A[c];e(d,a,b,G);for(var f=g(d,a,G,!0),m=0;m<d.Hd.length;m++){for(var n=d.Hd[m],r=n.qk,x=0;x<r.length;x++){var q=r[x];"SOUND"==q.type&&f<d.Ph-1E-6&&(q.Jd=!1)}for(x=0;x<r.length;x++)switch(q=r[x],q.type){case "CLIP":if(q.Po<=f&&
f<q.Oo&&!q.Jd){var v=n,p=q;h.apply(v,p.Wd,p.mc);h.set_behavior(v,h.AB_FINISH_STOP,p.mc);for(v=0;v<r.length;v++)r[v]!=q&&r[v].mc==q.mc&&(r[v].Jd=!1);q.Jd=!0}q.Jd&&(v=n,h.set_current_frame_float(v,f-q.R+q.wn,q.mc),h.update_object_animation(v,0,q.mc));break;case "SOUND":(f<d.Ph-1E-6||d.Ph<q.R)&&q.R<=f&&f<q.aa&&!q.Jd&&(E.play(n,(q.R-f)/l.za,(q.aa-q.R)/l.za),q.Jd=!0),d.Ph<q.aa&&q.aa<=f&&q.Jd&&(q.Jd=!1)}}for(m=0;m<d.M.length;m++)q=d.M[m].jt,q.R<=Math.round(f)&&Math.round(f)<q.aa&&!q.stop_video&&(k(d.M[m],
q.stop_video),q.stop_video=!0),q.aa<=Math.round(f)&&q.stop_video&&(k(d.M[m],q.stop_video),q.stop_video=!1);d.Ph=f}}};a.cleanup=function(){A.length=0;G=-1};a.Ap=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||m(a)||h.Cl(a)?!0:!1}};b4w.module.__camera=function(a,p){function c(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function b(b){var c={type:b,name:"",ye:1,width:0,height:0,ge:null,ub:null,oc:null,Ya:0,yd:0,Ia:0,Pa:0,left:0,right:0,top:0,bottom:0,fe:new Float32Array(3),Uo:new Float32Array(3),quat:new Float32Array(4),ha:new Float32Array(16),KA:new Float32Array(16),oa:new Float32Array(16),
fh:new Float32Array(16),Jx:new Float32Array(16),Tc:new Float32Array(16),$q:new Float32Array(16),Vf:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,$e:null,dof_on:0,nl:{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Ia:new Float32Array([0,0,0,0]),Pa:new Float32Array([0,0,0,0])},ni:0,Wc:0,Ab:null,uh:null,Wk:null,zo:new Float32Array(4),Pj:new Float32Array(4)};if(b==a.ib)return c;switch(b){case a.lc:g(c,
40,.1,1E3);break;case a.fd:g(c,2.5,.1,1E3);break;case a.Le:break;case a.jh:break;case a.kh:break;case a.Db:case a.Ib:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function e(b,c,d){if(b.type!=a.Db&&b.type!=a.Ib)throw"set_stereo_params(): wrong camera type";b.ni=c;b.Wc=d;D(b,b.Ya);if(Z.Y())for(c=Z.get_active(),b=c.d.Sc,c=Z.sl(c).d.J,d=0;d<c.length;d++)t(c[d],b)}function d(a,b){var c=a.d,d=J.quat_to_dir(c.quat,J.AXIS_MY,P),e=Math.asin(d[1]/
F.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?J.quat_to_dir(c.quat,J.AXIS_MZ,ca):J.quat_to_dir(c.quat,J.AXIS_Z,ca)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b}function g(b,c,d,e,f){switch(b.type){case a.lc:case a.Db:case a.Ib:b.yd=c;b.Ya=1;break;case a.fd:b.top=c;b.Ya=1;break;case a.Le:delete b.yd;b.yd=c;b.Ya=f/c;break;case a.jh:b.top=c;b.Ya=f/c;break;default:L.error("set_frustum(): Unsupported camera type: "+b.type)}b.Ia=
d;b.Pa=e}function k(b,c){var d=c.d.g,e=c.d.quat,f=ja;T.rotateX(c.d.K,-Math.PI/2,f);T.invert(f,b.ha);if(b.Ab){var f=b.Ab[0],g=b.Ab[1],s=b.Ab[2],h=b.Ab[3],k=ja;k[0]=1-2*f*f;k[1]=-2*f*g;k[2]=-2*f*s;k[3]=0;k[4]=-2*f*g;k[5]=1-2*g*g;k[6]=-2*g*s;k[7]=0;k[8]=-2*f*s;k[9]=-2*g*s;k[10]=1-2*s*s;k[11]=0;k[12]=-2*f*h;k[13]=-2*g*h;k[14]=-2*s*h;k[15]=1;T.multiply(b.ha,k,b.ha);D(b,b.Ya,!0);f=aa;g=ja;T.invert(b.ha,g);T.transpose(g,g);U.transformMat4(b.Ab,g,f);g=w;g[0]=(J.sign(f[0])+b.oa[8])/b.oa[0];g[1]=(J.sign(f[1])+
b.oa[9])/b.oa[5];g[2]=-1;g[3]=(1+b.oa[10])/b.oa[14];U.scale(f,2/(f[0]*g[0]+f[1]*g[1]+f[2]*g[2]+f[3]*g[3]),f);b.oa[2]=f[0];b.oa[6]=f[1];b.oa[10]=f[2]+1;b.oa[14]=f[3]}b.type==a.Db?b.ha[12]+=b.Wc/2:b.type==a.Ib&&(b.ha[12]-=b.Wc/2);T.multiply(b.oa,b.ha,b.Vf);z(b);l(b);F.copy(b.fe,b.Uo);F.copy(d,b.fe);K.copy(e,b.quat)}function f(b,c,d,e){T.lookAt(c,d,e,b.ha);b.type==a.Db?b.ha[12]+=b.Wc/2:b.type==a.Ib&&(b.ha[12]-=b.Wc/2);T.multiply(b.oa,b.ha,b.Vf);z(b);l(b);F.copy(c,b.fe)}function m(a){var b=a.d.J;if(!b)throw"Wrong object";
for(var c=a.d,d=0;d<b.length;d++){var e=b[d];k(e,a);J.Ro(e.Vf,e.nl);if(e.$e)if(e.dof_on){var f=F.dist(c.g,e.$e.location);e.dof_distance=f}else e.dof_distance=0}}function h(b){b=b.d;if(b.Ha){var c=P;b.O==a.MS_TARGET_CONTROLS?F.subtract(b.g,b.Ta,c):J.quat_to_dir(b.quat,J.AXIS_MY,c);c[1]=0;F.normalize(c,c);var d=-Math.acos(-c[2]);0>c[0]&&(d=-2*Math.PI-d);b.O==a.MS_EYE_CONTROLS&&(d*=-1);b.Ha.left+=d;b.Ha.right+=d}}function r(b){b=b.d;if(b.Fa){var c=P;b.O==a.MS_TARGET_CONTROLS?F.subtract(b.g,b.Ta,c):J.quat_to_dir(b.quat,
J.AXIS_MY,c);F.normalize(c,c);c=Math.asin(c[1]);b.Fa.Va+=c;b.Fa.Oa+=c}}function n(a){a=a.d;if(a.Ha)if(a.Fa){var b=J.Oe(a.Fa.Va+Math.PI/2),c=J.Oe(a.Fa.Oa+Math.PI/2);if(c>Math.PI)a.Fa={Oa:-Math.PI/2,Va:Math.PI/2};else if(b>Math.PI||b<c)a.Fa.Va=Math.PI/2}else a.Fa={Oa:-Math.PI/2,Va:Math.PI/2}}function x(b){var c=b.d;if(G(b)&&c.J[0].type===a.fd){if(c.O===a.MS_TARGET_CONTROLS)var d=F.dist(c.g,c.Ta),c=d/c.tg*c.je;else c.sb&&c.O===a.MS_HOVER_CONTROLS?(d=q(b,P),d=F.len(d),c=d/c.tg*c.je):c=c.je;for(var e in b.d.J)d=
b.d.J[e],d.top=c,D(d,d.Ya);m(b)}}function v(a){a=J.quat_to_dir(a.d.quat,J.AXIS_MY,P);F.normalize(a,a);return-Math.asin(a[1])}function u(a,b,c){if(b==c)return c-a;a=J.Oe(a);b=J.Oe(b);c=J.Oe(c);var d=Math.abs(b-c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-b;c=J.Oe(c+b);a=J.Oe(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0}function E(a,b,c){a=a.d;var d=F.subtract(a.Ta,a.g,P);b=K.setAxisAngle(b,c,X);F.transformQuat(d,b,d);F.subtract(a.Ta,d,a.g);K.multiply(b,a.quat,a.quat)}function q(a,
b){var c=a.d;if(c.sb){var d=J.quat_to_dir(c.quat,J.AXIS_MY,P);F.normalize(d,d);if(c.Ra.Va-c.Ra.Oa)var e=(-Math.asin(d[1])-c.Ra.Oa)/(c.Ra.Va-c.Ra.Oa),e=Math.max(e,0);else e=0;return F.scale(d,-(e*(c.fg-c.ud)+c.ud),b)}return null}function D(b,c,d){switch(b.type){case a.lc:if(!c)throw"No aspect ratio";b.Ya=c;case a.Le:T.perspective(J.Lx(b.yd),b.Ya,b.Ia,b.Pa,b.oa);break;case a.fd:if(!c)throw"No aspect ratio";b.Ya=c;case a.jh:c=b.top*b.Ya;T.ortho(-c,c,-b.top,b.top,b.Ia,b.Pa,b.oa);break;case a.kh:T.ortho(b.left,
b.right,b.bottom,b.top,b.Ia,b.Pa,b.oa);break;case a.Db:case a.Ib:if(!c)throw"No aspect ratio";b.Ya=c;var e=Math.tan(b.yd*Math.PI/360);c=b.Ia*e;var f=b.Ya*b.ni*e;b.type==a.Db?(e=f-b.Wc/2,f+=b.Wc/2):(e=f+b.Wc/2,f-=b.Wc/2);e=-(b.Ia/b.ni*e);f*=b.Ia/b.ni;T.frustum(e,f,-c,c,b.Ia,b.Pa,b.oa);b.left=e;b.right=f;break;case a.ib:return;default:throw"Wrong camera type: "+b.type;}d||(T.multiply(b.oa,b.ha,b.Vf),z(b),l(b))}function l(a){T.copy(a.ha,a.Tc);a.Tc[12]=0;a.Tc[13]=0;a.Tc[14]=0;a.Tc[15]=1;T.multiply(a.oa,
a.Tc,a.Tc);T.invert(a.Tc,a.Tc)}function z(a){T.copy(a.ha,a.fh);T.multiply(a.oa,a.fh,a.fh);T.invert(a.fh,a.fh)}function A(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=b.Ia);d||(d=b.Pa);var g,s,h,k,l,m,n,r;switch(b.type){case a.ib:throw"Extraction from NONE camera is not possible";case a.lc:case a.Le:g=c*Math.tan(b.yd*Math.PI/360);k=-g;s=g*b.Ya;h=-s;l=d/c*g;r=-l;m=l*b.Ya;n=-m;break;case a.fd:case a.jh:h=b.top*b.Ya;g=l=b.top;s=m=h;k=r=-b.top;h=n=-h;break;case a.kh:g=l=b.top;s=m=b.right;k=r=b.bottom;
h=n=b.left;break;case a.Db:case a.Ib:l=c/b.Ia;g=c*Math.tan(b.yd*Math.PI/360);k=-g;s=b.right*l;h=b.left*l;n=d/c;l=g*n;r=-l;m=s*n;n*=h;break;default:throw"Wrong camera type: "+b.type;}e[0]=h;e[1]=k;e[2]=-c;e[3]=s;e[4]=k;e[5]=-c;e[6]=s;e[7]=g;e[8]=-c;e[9]=h;e[10]=g;e[11]=-c;e[12]=n;e[13]=r;e[14]=-d;e[15]=n;e[16]=l;e[17]=-d;e[18]=m;e[19]=l;e[20]=-d;e[21]=m;e[22]=r;e[23]=-d;f&&(c=ja,T.invert(b.ha,c),J.pe(e,c,e,0));return e}function G(a){return"CAMERA"===a.type?!0:!1}function t(a,b){if(b.enable_csm){var c=
b.csm_num;if(!a.uh){var d=b.csm_num;a.uh=Array(d);for(var e=0;e<d;e++)a.uh[e]=new Float32Array(3);a.Wk=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.Ia:B(b,a,d-1),f=B(b,a,d),e=A(a,e,f,N),e=y.qw(e);a.uh[d].set(e.A);a.Wk[d]=e.sa;a.zo[d]=F.length(e.A);a.Pj[d]=O(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.Pj[0]=b.first_cascade_blur_radius}function B(a,b,c){var d=a.csm_num,e=J.clamp(a.csm_first_cascade_border,b.Ia,b.Pa);a=J.clamp(a.csm_last_cascade_border,b.Ia,b.Pa);return J.clamp(O(e,
a,d,c),b.Ia,b.Pa)}function O(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var y=p("__boundings");p("__config");var H=p("__constraints"),L=p("__print"),Z=p("__scenes"),J=p("__util"),F=p("vec3"),U=p("vec4"),K=p("quat"),S=p("mat3"),T=p("mat4");a.ib=10;a.lc=20;a.fd=30;a.Le=40;a.jh=50;a.kh=60;a.Db=70;a.Ib=80;a.MS_STATIC=0;a.MS_ANIMATION=1;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var ba=new Float32Array(2),P=new Float32Array(3),
ca=new Float32Array(3),X=new Float32Array(4);new Float32Array(4);var aa=new Float32Array(4),w=new Float32Array(4),fa=new Float32Array(16),ja=new Float32Array(16),N=new Float32Array(24);a.cu=function(d){var e=d.d,f=d.data;switch(f.type){case "PERSP":var k=b(a.lc);if(f.angle_y)var l=f.angle_y/Math.PI*180;g(k,l,f.clip_start,f.clip_end);break;case "ORTHO":k=b(a.fd),g(k,f.ortho_scale/2,f.clip_start,f.clip_end)}k.name=d.name;e.Cr=!1;e.O=c(f.b4w_move_style);e.dof_distance=d.data.dof_distance;e.$e=d.data.dof_object;
e.dof_front=d.data.b4w_dof_front;e.dof_rear=d.data.b4w_dof_rear;e.dof_power=d.data.b4w_dof_power;e.Mo=d.data.b4w_enable_hover_hor_rotation;e.J=[k];if(e.O==a.MS_TARGET_CONTROLS||e.O==a.MS_EYE_CONTROLS||e.O==a.MS_HOVER_CONTROLS)e.Vm=d.data.b4w_trans_velocity,e.Um=d.data.b4w_rot_velocity,e.Wm=d.data.b4w_zoom_velocity;e.O==a.MS_TARGET_CONTROLS&&e.Ta.set(f.b4w_target);f=d.d;if(f.O===a.MS_TARGET_CONTROLS||f.O===a.MS_EYE_CONTROLS||f.O===a.MS_HOVER_CONTROLS)k=d.data,f.O===a.MS_TARGET_CONTROLS||f.O===a.MS_EYE_CONTROLS?
(k.b4w_use_horizontal_clamping&&(f.Ha={left:k.b4w_rotation_left_limit,right:k.b4w_rotation_right_limit}),k.b4w_use_vertical_clamping&&(f.Fa={Oa:k.b4w_rotation_down_limit,Va:k.b4w_rotation_up_limit}),"LOCAL"==k.b4w_horizontal_clamping_type&&h(d),"LOCAL"==k.b4w_vertical_clamping_type&&r(d),n(d),k.b4w_use_panning&&(f.Ir=k.b4w_use_panning)):f.O===a.MS_HOVER_CONTROLS&&(k.b4w_use_horizontal_clamping&&k.b4w_horizontal_translation_min<=k.b4w_horizontal_translation_max&&(f.Ha={left:k.b4w_horizontal_translation_min,
right:k.b4w_horizontal_translation_max}),k.b4w_use_vertical_clamping&&k.b4w_vertical_translation_min<=k.b4w_vertical_translation_max&&(f.Fa={Oa:-k.b4w_vertical_translation_max,Va:-k.b4w_vertical_translation_min}),k.b4w_use_distance_limits&&k.b4w_hover_angle_min<=k.b4w_hover_angle_max&&(f.Ra={Oa:k.b4w_hover_angle_min,Va:k.b4w_hover_angle_max})),f.sb=k.b4w_use_distance_limits&&k.b4w_distance_min<=k.b4w_distance_max,f.sb&&(f.ud=k.b4w_distance_min,f.fg=k.b4w_distance_max);f=d.d;if(f.O===a.MS_HOVER_CONTROLS&&
f.sb)if(f.Ra){var l=v(d),m=J.quat_to_dir(f.quat,J.AXIS_Z,P),k=0;0<m[1]&&(k-=Math.asin(m[1]/F.len(m)));l>f.Ra.Va?k+=l-f.Ra.Va:l<f.Ra.Oa&&(k+=f.Ra.Oa-l);(k||0>l)&&L.warn("B4W Warning: Active hover camera has wrong orientation");k&&(l=J.quat_to_dir(f.quat,J.AXIS_X,ca),k=K.setAxisAngle(l,-k,X),K.normalize(k,k),K.multiply(k,f.quat,f.quat));k=J.quat_to_dir(f.quat,J.AXIS_MY,P);l=aa;l.set(J.AXIS_Y);l[3]=0;k=J.line_plane_intersect(l,0,f.g,k,f.Cd);if(!k||100<F.len(k))f.Cd[0]=f.g[0],f.Cd[1]=0,f.Cd[2]=f.g[2]}else f.sb=
!1;d=d.d;switch(d.O){case a.MS_TARGET_CONTROLS:d.tg=F.dist(d.g,d.Ta);d.je=d.J[0].top;break;case a.MS_HOVER_CONTROLS:d.sb&&(d.tg=F.dist(d.g,d.Cd),d.je=d.J[0].top)}d=J.quat_to_dir(e.quat,J.AXIS_Z,P);e.O==a.MS_TARGET_CONTROLS&&(e.bk=0<d[1])};a.mb=b;a.LA=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.ub);case "DEPTH":return Boolean(a.oc);case "SCREEN":return!Boolean(a.ub)&&!Boolean(a.oc);default:throw"Wrong attachment type: "+b;}};a.Vj=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.ub=
c;break;case "DEPTH":a.oc=c;break;case "SCREEN":a.ub=null;a.oc=null;break;default:throw"Wrong attachment type: "+b;}};a.zB=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.ub;case "DEPTH":return a.oc;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.Yp=function(b,c){if(b.type!=a.lc||c!=a.Db&&c!=a.Ib)throw"make_stereo(): wrong camera type";b.type=c;e(b,6,.065)};a.xy=e;a.Pq=function(a,b){var c=a.d.quat,d=X,e=P;e[0]=0;e[1]=1;e[2]=0;K.setAxisAngle(e,b,d);K.multiply(d,
c,c)};a.tC=function(a,b){var c=a.d.quat,d=X,e=P;e[0]=1;e[1]=0;e[2]=0;K.setAxisAngle(e,b,d);K.multiply(d,c,c)};a.sC=function(a,b){var c=a.d.quat;K.invert(c,c);var d=X,e=P;e[0]=0;e[1]=0;e[2]=1;K.setAxisAngle(e,-b,d);K.multiply(d,c,c);K.invert(c,c)};a.qm=function(a,b){var c=a.d.quat;K.invert(c,c);var d=X,e=P;e[0]=1;e[1]=0;e[2]=0;K.setAxisAngle(e,-b,d);K.multiply(d,c,c);K.invert(c,c)};a.get_angles=d;a.tm=g;a.py=function(b,c,d,e,f,g,s){switch(b.type){case a.kh:b.left=c;b.right=d;b.bottom=e;b.top=f;b.Ia=
g;b.Pa=s;break;default:L.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.d.O};a.vC=k;a.wC=f;a.Xq=function(a,b,c){var d=P;d[0]=0;d[1]=-1;d[2]=0;F.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=ca;e[0]=0;e[1]=0;e[2]=-1;F.transformQuat(e,c,e);f(a,b,d,e)};a.uC=function(a,b,c){if("CAMERA"!=a.type)throw"Wrong camera object";a=a.d;a.g.set(b);a.quat.set(c)};a.Bv=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];T.lookAt(a,b,c,ja);T.invert(ja,
ja);T.rotateX(ja,Math.PI/2,ja);S.fromMat4(ja,fa);K.fromMat3(fa,e)};a.Dr=m;a.wz=function(b){var c=b.d;c.O==a.MS_TARGET_CONTROLS&&(c.sb?H.by(c.g,c.quat,c.Ta,c.ud,H.Vr):H.ay(c.g,c.quat,c.Ta));c.O!=a.MS_TARGET_CONTROLS&&c.O!=a.MS_EYE_CONTROLS||H.correct_up(b,J.AXIS_Y)};a.Qw=h;a.Vz=r;a.Xm=n;a.Ez=x;a.mu=function(b){var c=b.d;if(c.O===a.MS_TARGET_CONTROLS||c.O===a.MS_EYE_CONTROLS){if(c.Ha){var e=c.Ha.left,f=c.Ha.right,g=d(b,ba),g=g[0],g=c.O==a.MS_TARGET_CONTROLS?g-Math.PI:-1*g;if(g=u(g,e,f))c.O==a.MS_TARGET_CONTROLS?
E(b,J.AXIS_Y,g):(g=K.setAxisAngle(J.AXIS_MY,g,X),K.multiply(g,b.d.quat,b.d.quat))}c.Fa&&(e=c.Fa.Oa,f=c.Fa.Va,g=d(b,ba),g=g[1],c.O==a.MS_TARGET_CONTROLS&&(g*=-1),g=0<J.quat_to_dir(c.quat,J.AXIS_Z,P)[1]?J.sign(g)*Math.PI-g:g,g=u(g,e,f))&&(c.O==a.MS_TARGET_CONTROLS?(e=J.quat_to_dir(b.d.quat,J.AXIS_MX,ca),E(b,e,g)):(e=g,g=b.d,f=J.quat_to_dir(g.quat,J.AXIS_X,P),e=K.setAxisAngle(f,e,X),K.multiply(e,g.quat,g.quat)));c.O===a.MS_TARGET_CONTROLS&&(c.sb&&(g=b.d,e=F.subtract(g.g,g.Ta,P),f=F.length(e),f>g.fg?
(F.scale(e,g.fg/f,e),F.add(g.Ta,e,g.g)):f<g.ud&&(f=J.quat_to_dir(g.quat,J.AXIS_MY,ca),F.scale(f,100*g.ud,f),F.add(e,f,e),F.scale(e,-g.ud/F.length(e),e),F.add(g.Ta,e,g.g))),x(b))}c.O===a.MS_HOVER_CONTROLS&&(c=b.d,g=c.sb?c.Cd:c.g,c.Ha&&(g[0]=J.clamp(g[0],c.Ha.left,c.Ha.right)),c.Fa&&(g[2]=J.clamp(g[2],c.Fa.Oa,c.Fa.Va)),c=b.d,c.sb&&(e=J.quat_to_dir(c.quat,J.AXIS_Z,P),g=0,0<e[1]&&(g=Math.asin(e[1]/F.len(e))),e=F.negate(d(b,ba),ba),e[1]<c.Ra.Oa?g+=e[1]-c.Ra.Oa:e[1]>c.Ra.Va&&(g+=e[1]-c.Ra.Va),g&&(e=J.quat_to_dir(c.quat,
J.AXIS_X,ca),F.normalize(e,e),g=K.setAxisAngle(e,g,X),K.normalize(g,g),K.multiply(g,c.quat,c.quat)),g=q(b,P),F.add(c.Cd,g,c.g),x(b)))};a.ip=v;a.rw=q;a.WB=function(b){switch(b.type){case a.lc:case a.fd:case a.Db:case a.Ib:return!0;default:return!1}};a.bw=function(b){b=b.d.J[0];switch(b.type){case a.lc:case a.Le:case a.Db:case a.Ib:return Math.PI*b.yd/180;default:return L.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.Hg=D;a.$t=l;a.au=z;a.yv=A;a.Mt=function(a){a=a.d;var b=y.cd();b.min_x=
-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Kb=b;var c=y.Uk(1,[0,0,0]);a.wc=c;a.Ak=y.vo(1,b);a.Ck=y.xo(1,b);a.Bk=y.wo(1,b)};a.is_camera=G;a.qb=function(b){return G(b)&&b.d&&b.d.O==a.MS_TARGET_CONTROLS?!0:!1};a.bb=function(b){return G(b)&&b.d&&b.d.O==a.MS_HOVER_CONTROLS?!0:!1};a.mf=function(b){return G(b)&&b.d&&b.d.O==a.MS_EYE_CONTROLS?!0:!1};a.Rm=t;a.Zu=B};b4w.module.__lights=function(a,p){function c(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),bg:new Float32Array(3),Nf:0,Zj:0,Yv:!1,Ko:!1,bh:!0,dh:!0,de:1,distance:25,jB:"INVERSE_SQUARE"}}function b(a){a.bg[0]=a.color[0]*a.de;a.bg[1]=a.color[1]*a.de;a.bg[2]=a.color[2]*a.de}var e=p("__util"),d=p("vec3");a.OB=c;a.ex=function(a){var k=a.data,f=c(k.type);f.name=a.name;f.bh=k.use_diffuse;f.dh=k.use_specular;var m=e.quat_to_dir(a.d.quat,e.AXIS_Y,[]);d.normalize(m,
m);f.direction[0]=m[0];f.direction[1]=m[1];f.direction[2]=m[2];f.color[0]=k.color[0];f.color[1]=k.color[1];f.color[2]=k.color[2];f.de=k.energy;b(f);f.distance=k.distance;if("POINT"===f.type||"SPOT"===f.type)f.distance=k.distance;"SPOT"===f.type&&(f.Nf=k.spot_size,f.Zj=k.spot_blend);f.Yv=k.b4w_generate_shadows;f.Ko=k.b4w_dynamic_intensity;a.ja=f};a.ry=function(a,c){a.color[0]=c[0];a.color[1]=c[1];a.color[2]=c[2];b(a)};a.ty=function(a,b){a.Zj=b};a.sy=function(a,b){a.distance=b};a.uy=function(a,b){a.Nf=
b};a.Tq=function(a,c){a.de=c;b(a)};a.Il=function(a){return"LAMP"===a.type?!0:!1};a.Bz=function(a){if("LAMP"!=a.type)throw"Wrong light object";var b=a.ja;b&&e.quat_to_dir(a.d.quat,e.AXIS_Y,b.direction)}};b4w.module.__scenes=function(a,p){function c(){if(!hb)throw"No active scene available";return hb}function b(){return hb?!0:!1}function e(a,b,c,d){for(var e=null,f=0;f<b.length;f++){var g=b[f];if((c?g.origin_name:g.name)==a&&g.d.sd==d){e=g;break}}return e}function d(a,b){b||(b="ALL");var c=[];g(a.objects,b,c);return c}function g(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&g(e.objects,b,c)}}function k(b){if("NONE"==ra.ue||!b.b4w_render_shadows)return!1;
var c=!1,d=!1;if(0==aa(b,"LAMP",a.DATA_ID_ALL).length)return!1;b=aa(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){var f=b[e];f.b4w_shadow_cast&&(c=!0);f.b4w_shadow_receive&&(d=!0);if(c&&d)return!0}return!1}function f(a){if(!a.kb)return!1;a=a.kb.LAMP;for(var b=0;b<a.length;b++)if("SUN"==a[b].ja.type)return!0;return!1}function m(a){if(!ra.shore_smoothing)return!1;a=w(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function h(b){var c=w(b),
d=[];b=aa(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<c.length;e++){var f=c[e];if(f.b4w_water){for(var g={},s=0;s<b.length;s++)for(var h=b[s],k=h.data.materials,l=0;l<k.length;l++)k[l]==f&&(g.He=h.location[1]);if(ra.bj)for(g.Nb=f.b4w_water_fog_color.slice(0),g.Nb.push(f.b4w_water_fog_density),f.b4w_water_dynamic?(g.ig=!0,g.waves_height=f.b4w_waves_height,g.waves_length=f.b4w_waves_length,g.dst_noise_scale0=f.b4w_water_dst_noise_scale0,g.dst_noise_scale1=f.b4w_water_dst_noise_scale1,g.dst_noise_freq0=f.b4w_water_dst_noise_freq0,
g.dst_noise_freq1=f.b4w_water_dst_noise_freq1,g.dir_min_shore_fac=f.b4w_water_dir_min_shore_fac,g.dir_freq=f.b4w_water_dir_freq,g.dir_noise_scale=f.b4w_water_dir_noise_scale,g.dir_noise_freq=f.b4w_water_dir_noise_freq,g.dir_min_noise_fac=f.b4w_water_dir_min_noise_fac,g.dst_min_fac=f.b4w_water_dst_min_fac,g.waves_hor_fac=f.b4w_water_waves_hor_fac):(g.ig=!1,g.waves_height=0,g.waves_length=0),g.Ti=null,g.Lk=null,g.Mk=new Float32Array(2),g.Xj=null,f=f.texture_slots,s=0;s<f.length;s++)h=f[s].texture,"VORONOI"==
h.type&&(g.Ti=h.noise_scale,g.Mk.set([.3,.7]),g.Lk=h.noise_intensity),!0===h.b4w_shore_dist_map&&(g.Xj=h.image,g.Jg=h.image.size[0],g.Gy=h.b4w_shore_boundings,g.xg=h.b4w_max_shore_dist);else g.waves_height=0,g.waves_length=0,g.Ti=null,g.Lk=null,g.Mk=null,g.Nb=null,g.ig=!1;d.push(g)}}if(0<d.length){g=d[0];if(!g.ig)for(e=0;e<d.length;e++)d[e].ig&&(g=d[e]);return g}return null}function r(a){function b(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var e=a[d];"GROUP"==e.type&&e.node_group&&b(e.node_group.node_tree);
"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(c.Ac=!0)}}}var c={};a=w(a);for(var d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(c.Ac=!0);e.node_tree&&b(e.node_tree)}return c}function n(b){if(!ra.Tj||!b.b4w_render_reflections)return!1;var c=[];b=aa(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var e=b[d];if(e.b4w_reflective){var f;a:{e=e.constraints;for(f=0;f<e.length;f++){var g=e[f];if("LOCKED_TRACK"==g.type&&"REFLECTION PLANE"==g.name){f=g.target;break a}}f=null}f&&(e=f.location,
f=f.d.quat,g=new Float32Array(4),ta.pz(e,f,ta.AXIS_Y,g),c.push(g))}}return c}function x(a,b){var c={},d=a.world.b4w_sky_settings;c.procedural_skydome=d.procedural_skydome&&b;c.use_as_environment_lighting=d.use_as_environment_lighting;c.Kg=d.color;c.rayleigh_brightness=d.rayleigh_brightness;c.mie_brightness=d.mie_brightness;c.spot_brightness=d.spot_brightness;c.scatter_strength=d.scatter_strength;c.rayleigh_strength=d.rayleigh_strength;c.mie_strength=d.mie_strength;c.rayleigh_collection_power=d.rayleigh_collection_power;
c.mie_collection_power=d.mie_collection_power;c.mie_distribution=d.mie_distribution;!b&&d.procedural_skydome&&Fa.warn("B4W Warning: There is no sun on the scene. Procedural sky won't be rendered");return c}function v(a){var b={};a=a.world.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.Pw=a.hemisphere;b.Wt=a.blur_depth;b.Pn=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;b.cy=a.samples;return b}function u(a){var b={};a=a.world.b4w_bloom_settings;b.blur=a.blur;b.pv=
a.edge_lum;b.key=a.key;return b}function E(a){var b={};a=a.world.b4w_motion_blur_settings;b.Cj=a.motion_blur_decay_threshold;b.Dj=a.motion_blur_factor;return b}function q(a){var b={};a=a.world.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}function D(a){var b={};a=a.world.b4w_god_rays_settings;b.Uw=a.intensity;b.wg=a.max_ray_length;b.Sg=a.steps_per_pass;return b}function l(a){var b={};a=a.world;b.Jh=a.b4w_glow_color;
b.ij=a.b4w_glow_factor;return b}function z(a){var b=a.world;a=[0,0,0];var c=[0,0,0],d=b.light_settings,e=b.texture_slots;if(d.use_environment_light)if("SKY_COLOR"==d.environment_color||"SKY_TEXTURE"==d.environment_color)a=b.horizon_color.slice(0),c=b.zenith_color.slice(0);else if("PLAIN"==d.environment_color)a=[1,1,1],c=[1,1,1];else throw"Unsupported world environment color"+d.environment_color;b={};b.ee=d.environment_energy;b.pc=a;b.uc=c;b.Lg=e;return b}function A(b){if(!ra.Ca)return!1;var c=!1,
d=!1;b=aa(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){for(var f=b[e],g=f.data.materials,s=0;s<g.length;s++)g[s].b4w_terrain&&(c=!0);f=f.particle_systems;for(s=0;s<f.length;s++)g=f[s].settings,"HAIR"==g.type&&g.b4w_dynamic_grass&&(d=!0);if(c&&d)return!0}return!1}function G(b){b=aa(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)if(b[c].d.Qc)return!0;return!1}function t(b){b=aa(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)for(var d=b[c].data.materials,e=0;e<d.length;e++){var f=d[e],
g=f.game_settings.alpha_blend;if(f.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g)return!0}return!1}function B(a,b,c){var d=va.Ag(a,b);va.Od(a,d,function(a,b,d){if(d.Ba){switch(d.N){case "COLOR":case "CUBEMAP":a=b.j.ub;break;case "DEPTH":a=b.j.oc;break;case "SCREEN":a=null;break;default:throw"Wrong slink";}switch(d.da){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(!a)throw"Connection of SCREEN is forbidden";if(a.Fe)throw"Batch texture can't use renderbuffer";
ka.bo(c.Mb,d.da)&&ea.Ii(c,a,d.da)}}});for(a=0;a<b.ca.length;a++){var d=b.ca[a],e=b.Yc[a];switch(d.da){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(e.Fe)throw"Batch texture can't use renderbuffer";ka.bo(c.Mb,d.da)&&ea.Ii(c,e,d.da)}}}function O(a,b,c,d,e){for(var f=b.d,g=b.V,s=0;s<g.length;s++){var h=g[s];if(!(h.Vb||h.Tb||"MAIN"!=h.type&&"NODES"!=h.type&&"PARTICLES"!=h.type||F(a,h))){if("OPAQUE"===d){if(h.va)continue;var k=sa.ab(c,"SHADOW_CAST")&&
h.Bb?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE"}else if("BLEND"===d||"XRAY"===d){if(!h.va)continue;if("XRAY"==d!=h.Qd)continue;if(sa.ab(c,"SHADOW_CAST")&&h.Bb)switch(ra.ue){case "DEPTH":k="SHADOW_SRC_DEPTH";break;default:throw"Wrong shadows type";}else k="SHADOW_SRC_NONE"}else throw"Wrong main subscene type";"NODES"==h.type&&h.qt&&(b.d.yA.push(h.qt),b.d.xA.push(h.AA));var l=h.Ua,m=e.d.Sc;ka.G(l,"SHADOW_SRC",k);ea.xk(h,m);ka.G(l,"NUM_LIGHTS",a.Af);"special_skydome.glslf"==ka.hp(l)&&ka.G(l,"REFLECTION_PASS",
0);ka.G(l,"SSAO_ONLY",0);a.La&&a.Dc?ka.G(l,"WATER_EFFECTS",1):ka.G(l,"WATER_EFFECTS",0);a.La&&a.Ue&&f.Ue?(ka.G(l,"CAUSTICS",1),ka.G(l,"CAUST_SCALE",a.Yn),ka.G(l,"CAUST_SPEED",ka.s(a.Zn,2)),ka.G(l,"CAUST_BRIGHT",a.Xn)):ka.G(l,"CAUSTICS",0);a.La&&(ka.G(l,"WAVES_HEIGHT",ka.s(a.Ie)),ka.G(l,"WAVES_LENGTH",ka.s(a.Wf)),ka.G(l,"WATER_LEVEL",ka.s(a.He)));h.zc&&sa.ab(c,"MAIN_REFLECT")&&-1===h.hc.indexOf("u_mirrormap")?ka.G(l,"REFLECTIVE",1):ka.G(l,"REFLECTIVE",0);var n=sa.ab(c,"SKY");n?h.Fq?(m=n.j.ub,ea.Ii(h,
m,"u_sky")):ra.Qj?(h.Zb=n.Zb,ka.G(l,"PROCEDURAL_FOG",1)):ka.G(l,"PROCEDURAL_FOG",0):ka.G(l,"PROCEDURAL_FOG",0);if("SKY_TEXTURE"==e.world.light_settings.environment_color){m=null;if(e.d.ym.procedural_skydome&&e.world.b4w_sky_settings.use_as_environment_lighting)m=n.j.ub;else for(s=0;s<a.Lg.length;s++)if(a.Lg[s].texture.b4w_use_as_environment_lighting){m=ea.fw(a.Lg[s],!1);break}m?(ka.G(l,"SKY_TEXTURE",1),ea.Ii(h,m,"u_sky_texture")):Fa.warn("B4W Warning: environment lighting is set to 'Sky Texture', but there is no world texture with environment map")}h.Ca&&
(m=sa.ab(c,"GRASS_MAP"))&&J(h,m,f);h.mm?"NODES"==h.type?(ka.G(l,"REFRACTIVE",1),e.d.Ac?ka.G(l,"USE_REFRACTION",1):ka.G(l,"USE_REFRACTION",0)):e.d.Ac?ka.G(l,"REFRACTIVE",1):ka.G(l,"REFRACTIVE",0):(ka.G(l,"REFRACTIVE",0),ka.G(l,"USE_REFRACTION",0));h.Ge&&(h.bn&&sa.ab(c,"DEPTH")?ka.G(l,"SHORE_SMOOTHING",1):ka.G(l,"SHORE_SMOOTHING",0),h.water_dynamic&&a.La&&a.Ie?ka.G(l,"DYNAMIC",1):ka.G(l,"DYNAMIC",0));"PARTICLES"==h.type&&(ka.G(l,"SIZE_RAMP_LENGTH",h.uq),ka.G(l,"COLOR_RAMP_LENGTH",h.lq));for(var n=h.M,
V=0;V<n.length;V++)if(m=n[V],"SCENE"==m.source)for(var M=0;M<xa.length;M++)for(var r=xa[M],R=xa[M].Td,x=0;x<R.length;x++)R[x].d==m&&va.m(ab,r,e,null);if(h.ug){var m=0,Y;for(Y in h.ug)m++;ka.G(l,"NUM_LAMP_LIGHTS",m);h.Ml=new Float32Array(3*m);h.Kl=new Float32Array(3*m);h.Jl=new Float32Array(3*m);h.Ll=new Float32Array(4*m);for(V=0;V<e.kb.LAMP.length;V++)y(h,e.kb.LAMP[V])}Z(c,a,k);ea.Cb(h);k={T:!0,eb:f,n:h};H(h);a.o.push(k);B(c,a,h);L(h)}}a.o.sort(function(a,b){var c;if(a.n&&b.n){c=a.n.va;var d=b.n.va;
(c=c==d?0:c>d?1:-1)||(c=a.n.Df,d=b.n.Df,c=c==d?0:c>d?1:-1)}else c=0;return c})}function y(a,b){var c=b.uuid;if(c in a.ug){c=a.ug[c];a.Ml.set(b.d.g,3*c);a.Kl.set(b.ja.direction,3*c);a.Jl.set(b.ja.bg,3*c);var d=Ub;P(b.ja,Bb,d);a.Ll.set(d,4*c)}}function H(a){var b=a.Mb.attributes,c=a.lb.Rb,d;for(d in b)if(!c[d])throw'B4W Error: missing data for "'+d+'" attribute';if("MAIN"==a.type||"NODES"==a.type)b=ka.Cw(a.Mb.Zm),10<b&&("MAIN"==a.type&&Fa.warn("B4W Warning: Varying limit exceeded for main shader - "+
b+', materials: "'+a.yc.join(", ")+'"'),"NODES"==a.type&&(d=c=0,a.Sf&&(c=ta.ff(a.Sf)),a.Wa&&(d=ta.ff(a.Wa)),Fa.warn("B4W Warning: Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.yc.join(", ")+'"')))}function L(a){8<a.M.length&&Fa.warn("B4W Warning: too many textures used - "+a.M.length+' (max 8), materials "'+a.yc.join(", ")+'"')}function Z(a,b,c){for(var d=0,e=sa.jp(a,b),f=0;f<e.length;f++){var g=e[f];"SHADOW_SRC_DEPTH"!=c||"SHADOW_CAST"!=g.type&&"POSTPROCESSING"!=
g.type||(g=sa.Ev(a,g,"SHADOW_CAST").j,b.Jr=g.ha,b.Mn=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.Gf=b.Gf||[],b.Gf[d]=g.oa,d++)}}function J(a,b,c){a.Pb=b.Pb;var d=b.Pb[0],e=b.Pb[1],f=b.Pb[2];c=c.Kb;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.Pb[2]=f;b=b.j;Q.tm(b,f/2,-e,-d,f/2);Q.Hg(b);d=a.yl||0;d=0==d?c:Math.max(d,c);a.yl=d}function F(a,b){for(var c=a.o,d=0;d<c.length;d++){var e=c[d].n;if(e&&e.id==b.id)return!0}return!1}function U(a){var b=I(a,"MAIN_OPAQUE"),
c=!0;va.P(a.d.pb,function(d,e){"SHADOW_CAST"===e.type&&(K(e,b,e.o,a,c),c=!1)})}function K(b,c,d,e,f){if(0!=d.length){var g=b.j;c=c.j;var s=aa(e,"LAMP",a.DATA_ID_ALL),s=S(s)||s[0],h=s.d;Q.Xq(g,h.g,h.quat);wa.copy(c.fe,g.fe);Ca.copy(c.ha,g.$q);if("SPOT"==s.ja.type||"POINT"==s.ja.type)Q.Hg(g,g.Ya);else{s=pb;la.cd(s);for(h=0;h<d.length;h++){var k=d[h].eb;0==h?la.uo(k.Ma,s):la.No(s,k.Ma)}d=la.xv(s,Va);ta.pe(d,g.ha,d);if(e.d.Sc.enable_csm){e=wa.copy(c.uh[b.Vk],Ga);s=Ca.invert(c.ha,Ra);ta.pe(e,s,e);ta.pe(e,
g.ha,e);b=c.Wk[b.Vk];if(f)for(rb=0,f=2;f<d.length;f+=3)rb=Math.min(rb,d[f]);f=pb;f.max_x=e[0]+b;f.max_y=e[1]+b;f.max_z=0;f.min_x=e[0]-b;f.min_y=e[1]-b;f.min_z=rb}else{b=f=pb;c=za;c.set(d);e=Zb/9;d=Ca.identity(Ra);Ca.rotate(d,e,ta.AXIS_MZ,d);h=s=-1;for(k=0;10>k;k++){var l=la.Rt(c,Mb),m=(l.max_x-l.min_x)*(l.max_y-l.min_y);if(-1==s||m<s)s=m,h=k,la.uo(l,b);ta.pe(c,d,c)}b=h*e;0<b&&(c=Ca.identity(Ra),Ca.rotate(c,b,ta.AXIS_MZ,c),Ca.multiply(c,g.ha,g.ha));b=f.max_x-f.min_x;c=f.max_y-f.min_y;b&&c&&(e=Math.abs(b-
c)/2,2<b/c?(f.max_y+=e,f.min_y-=e):2<c/b&&(f.max_x+=e,f.min_x-=e));f.max_x+=.005;f.max_y+=.005;f.max_z+=.005;f.min_x-=.005;f.min_y-=.005;f.min_z-=.005}Q.py(g,f.min_x,f.max_x,f.min_y,f.max_y,-f.max_z,-f.min_z);Q.Hg(g)}ta.Ro(g.Vf,g.nl)}}function S(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.data.b4w_generate_shadows)return c}return!1}function T(a,b){for(var c=b.d,d=b.V,e="COLOR_PICKING_XRAY"==a.type,f=0;f<d.length;f++){var g=d[f];if(g.Qd==e&&"COLOR_ID"==g.type&&!F(a,g)){ea.Z(g,"USE_GLOW",0);ea.Cb(g);
var s={T:!0,eb:c,n:g};H(g);a.o.push(s)}}}function ba(a){var b=ta.sh(a);a.Ua=JSON.parse(JSON.stringify(a.Ua));return b}function P(a,b,c){b[0]=1;b[1]=0;b[2]=0;b[3]=a.bh?1:0;c[0]=-1;c[1]=-1;c[2]=-1;c[3]=a.dh?1:0;switch(a.type){case "HEMI":b[0]=.5;b[1]=.5;break;case "POINT":c[2]=a.distance;break;case "SPOT":c[2]=a.distance,b=c[0]=Math.cos(a.Nf/2),c[1]=a.Zj*(1-b)}}function ca(a,b){for(var c=N(b,mb),d=a.ja,e=a.d,f=d.index,g=0;g<c.length;g++){var s=c[g];s.tf.set(e.g,3*f);s.qf.set(d.direction,3*f);s.pf.set(d.bg,
3*f);var h=Bb,k=Ub;P(d,h,k);switch(d.type){case "SUN":if(s.ur.set(e.quat),s.tr=d.bg,"SKY"===s.type){var l=Ga;l[0]=l[1]=l[2]=1;var m=Math.acos(wa.dot(s.ak,l)),l=Math.acos(wa.dot(d.direction,l));s.Gj=Math.floor(m/.025)!=Math.floor(l/.025)?!0:!1;wa.copy(d.direction,s.ak);X(b,s)}else wa.copy(d.direction,s.ak);case "HEMI":case "POINT":case "SPOT":break;default:Fa.error("B4W Warning: unknown light type: "+d.type)}s.rf.set(h,4*f);s.sf.set(k,4*f);s.ya=!0;for(h=0;h<s.o.length;h++)k=s.o[h].n,k.ug&&y(k,a)}}
function X(a,b){wb.yh(b);if(b.Gj)for(var c=N(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY"]),d=0;d<c.length;d++)for(var e=c[d].o,f=0;f<e.length;f++){var g=e[f];g.T&&(g=g.n,ea.eu(g)&&wb.tz(g))}}function aa(b,c,d){if(!b.kb)throw"Access to uninitialized scene";b=b.kb[c];if(d==a.DATA_ID_ALL)return b;c=[];for(var e=0;e<b.length;e++){var f=b[e];f.d.sd==d&&c.push(f)}return c}function w(b){var c=[];b=aa(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++)for(var e=b[d].data,f=0;f<e.materials.length;f++){var g=
e.materials[f];-1==c.indexOf(g)&&c.push(g)}return c}function fa(a,b,c){for(var d=a.d,e=a.camera.d.J,f=0;f<e.length;f++){var g=e[f];Q.Hg(g,b/c);d.om&&Q.Rm(g,d.Sc)}d.om&&(d.Hj=!0,I(a,"DEPTH").ya=!0,I(a,"MAIN_BLEND").ya=!0);Q.Dr(a.camera);sa.qz(d.pb,function(d,e,f){if(d.$g){var g=d.ye*b,s=d.ye*c;if(e)for(e=0;e<f.ca.length;e++)f.ca[e]==d&&eb.resize(d.ga,g,s);else eb.Oh(d.ga)&&eb.resize(d.ga,g,s),d=f.j,d.width=g,d.height=s,"DOF"==f.type&&Y(a,{dof_power:f.j.dof_power,dof_on:f.j.dof_on}),ja(f,1/b,1/c)}})}
function ja(a,b,c){a=a.o;for(var d=0;d<a.length;d++){var e=a[d].n;e&&ea.li(e,b,c)}}function N(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];va.P(a.d.pb,function(a,b){b.type==e&&c.push(b)})}return c}function I(a,b){return sa.ab(a.d.pb,b)}function Y(a,b){var c=I(a,"DOF");if(!c)return Fa.error("DOF is not enabled on scene. Check camera settings"),0;var d=a.d.pb;"boolean"==typeof b.dof_on&&(c.j.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.j.dof_distance=b.dof_distance);"number"==
typeof b.dof_front&&(c.j.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.j.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.j.dof_power=b.dof_power;for(var e=sa.nb(d,c,"POSTPROCESSING"),d=sa.nb(d,e,"POSTPROCESSING"),e=[e,d],d=0;d<e.length;d++){var f=e[d].o[0].n;f&&(ea.Lf(f,c.j.dof_power),ja(e[d],1/c.j.width,1/c.j.height))}}c.ya=!0}function ga(a,b){var c=I(hb,"MAIN_OPAQUE");if(!c||!c.La)return Fa.error("get_water_surface_level() - no water parameters on this scene"),0;var d=c.Ie,e=c.Wf,
f=c.He,g=c.La;if(!d||!g.ig)return g.He;var s=wa.length(c.vi),h=c.time;s&&(h*=s);var k=Sa;k[0]=20/e*(a-.25*h);k[1]=20/e*(b-.25*h);s=ta.$n(k);k[0]=17/e*(b+.1*h);k[1]=17/e*(a+.1*h);var k=ta.$n(k),s=s+k-1,l=g.dst_noise_scale0,k=g.dst_noise_scale1,m=g.dst_noise_freq0,n=g.dst_noise_freq1,V=Sa;V[0]=l*(a+m*h);V[1]=l*(b+m*h);l=ta.Am(V);V[0]=k*(b-n*h);V[1]=k*(a-n*h);k=ta.Am(V);k*=d*l;if(c.kk)if(n=(a-c.ve[0])/c.we[0],V=(c.ve[1]+b)/c.we[1],n+=.5,V+=.5,1<n||0>n||1<V||0>V)d=k;else var n=ta.ep(hb.d.vm,c.Jg,n,V),
l=g.dir_freq,M=g.dir_noise_scale,r=g.dir_noise_freq,m=g.dir_min_noise_fac,V=g.dst_min_fac,c=e/c.xg/Math.PI,M=[M/e*(a+r*h),M/e*(b+r*h)],e=Math.sqrt(n),d=d*Math.max(n,g.dir_min_shore_fac)*Math.sin(e/c+l*h)*Math.max(ta.Am(M),m),g=Math.max(e,V),d=d*(1-g)+k*g,s=s*n;else d=k;return f+(d+.05*s)}function qa(a,b){a.Mh&&"POSTPROCESSING"==a.type&&b.T!=a.T&&(a.T=b.T);b.T||"GLOW"!=a.type||(a.el=0)}function M(a,b,c,d){var e=va.Qa(a,b);Q.Vj(e.j,c,d);e.yk=!0;va.Ee(a,b,function(b,e,f){f.Ba&&f.N==c&&sa.lu(f)&&R(a,
b,f.da,d)});va.Od(a,b,function(b,e,f){f.Ba&&f.N==c&&f.N==f.da&&M(a,b,c,d)})}function R(a,b,c,d){a=va.Qa(a,b).o;for(b=0;b<a.length;b++)ea.Yx(a[b].n,d,c)}function s(a){var b=I(a,"GRASS_MAP");if(b){var c=b.j,d=a.camera.d,e=d.g;a=Ga;a[0]=0;a[1]=-b.Pb[2]/2;a[2]=0;wa.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=ob;b[0]=0;b[1]=0;b[2]=0;b[3]=1;Q.Xq(c,a,b)}}function V(a,b){va.P(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.ca[0]||!d.Yc[0])throw"Wrong MOTION_BLUR subscene";var e=d.ca[0],f=d.Yc[0];
d.Yc[0]=d.j.ub;va.Ee(a,c,function(b,c,d){d.Ba&&R(a,b,d.da,f)});M(a,c,e.N,f);R(a,c,e.da,d.Yc[0]);d.aq=Math.exp(-b/d.Dj)}})}function ma(b,c){var d=0,e=b.it;0==e.Lm&&(e.Lm=c);var f=c-e.Lm;if(e.Lq&&f/e.rc>=e.Lq)a.clear_glow_anim(b);else{f%=e.rc;if(f<e.rp)switch(e=f/(e.rp/5),f=Math.floor(e),f){case 0:d=(e-f)/2;break;case 1:d=(e-f)/2+.5;break;case 2:d=1;break;case 3:d=1-(e-f)/2;break;case 4:d=.5-(e-f)/2}for(e=0;e<b.V.length;e++)f=b.V[e],"COLOR_ID"==f.type&&(f.qg=d)}}function pa(a){va.P(a.d.pb,function(a,
b){b.ya=!0})}function na(a){if("WIND"==a.field.type){a=a.d;ta.quat_to_dir(a.quat,ta.AXIS_Y,ua);wa.normalize(ua,ua);wa.scale(ua,a.ml,ua);a=xa;for(var b=0;b<a.length;b++)for(var c=N(a[b],nb),d=0;d<c.length;d++)c[d].vi.set(ua)}}var ea=p("__batch"),la=p("__boundings"),Q=p("__camera"),Ba=p("__config"),ia=p("__debug"),Za=p("__geometry"),va=p("__graph"),Ea=p("__hud"),vb=p("__objects");p("__particles");var lb=p("__prerender"),gb=p("__primitives"),Fa=p("__print"),wb=p("__renderer"),sa=p("__scenegraph"),bc=
p("__sfx"),ka=p("__shaders"),eb=p("__textures"),ta=p("__util"),wa=p("vec3"),Ca=p("mat4"),ra=Ba.p,Ha=Ba.hd,Ja="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),kb=["ARMATURE","EMPTY","MESH","SPEAKER"],Lb="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GLOW_MASK WIREFRAME".split(" "),mb="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),Tb=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_XRAY",
"MAIN_REFLECT"],nb="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS GLOW_MASK WIREFRAME".split(" "),tc=["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],hc=0,hb=null,xa=[],ab=null,zb=[],ic=0,Ab=0,Ua=1,$a=0,Ia=0,Zb=Math.PI/2;a.Bi=0;a.jn=1;a.kn=2;a.DATA_ID_ALL=-1;var Sa=new Float32Array(2),Ga=new Float32Array(3),Bb=new Float32Array(4),Ub=new Float32Array(4),ob=new Float32Array(4),Ra=new Float32Array(16),Va=new Float32Array(24),za=new Float32Array(24),
pb=la.cd(),Mb=la.cd(),ua=new Float32Array(3),rb=null;a.set_active=function(a){hb=a;bc.my(a)};a.Ix=function(a,b){var c=a.d,d=sa.Mu(c.pb);if(a==b){fa(a,ic,Ab);for(var e=0;e<d.length;e++)a.d.Jf.push(d[e])}else for(e=a.Td[0],fa(a,e.d.Mf,e.d.Mf),e=0;e<d.length;e++)b.d.Jf.push(d[e]);d=N(a,nb);for(e=0;e<d.length;e++)d[e].vi.set(ua);for(e=0;e<c.Jf.length;e++)"SHADOW_CAST"==c.Jf[e].type&&wb.yh(c.Jf[e])};a.get_active=c;a.Y=b;a.sl=function(a){return a.camera};a.Hh=function(){return xa};a.uw=function(){if(1==
xa.length)return xa;for(var a=[],b=0;b<xa.length;b++){var c=xa[b];if(!c.Td.length){b=va.Ag(ab,c);b=va.qr(ab,b,va.fn);b=va.Mm(b);va.P(b,function(b,c){a.push(c)});break}}return a};a.Ih=function(b,c,d,f){for(var g=xa,s=null,h="",k=0;k<g.length;k++){var l=aa(g[k],"ALL",a.DATA_ID_ALL);switch(b){case a.Bi:h=c;s=e(c,l,!1,d);break;case a.jn:h=d;s=null;(l=e(c,l,!1,f))&&l.dupli_group&&(s=e(d,l.dupli_group.objects,!0,f));break;case a.kn:for(var h=c[c.length-1],s=null,m=0;m<c.length;m++)if((s=e(c[m],l,0!=m,d))&&
s.dupli_group)l=s.dupli_group.objects;else break}if(s)break}s||Fa.warn("get object "+h+": not found");return s};a.Ct=function(a,b,c){for(var e in kb){var f=kb[e],g=d(a,f),s=b.d.eh,h=!1;for(e=0;e<c.length;e++)if(h=!0,c[e].d&&c[e].d.of){for(var k=0;k<s.length;k++)s[k]==c[e]&&(h=!1);h&&s.push(c[e])}f in b.kb||(b.kb[f]=[]);for(k=0;k<g.length;k++)ta.lf(g[k])&&g[k].proxy||(b.kb.ALL.push(g[k]),b.kb[f].push(g[k]))}};a.wt=function(b,c){b.kb={ALL:[]};for(var e in Ja){var g=Ja[e],s=d(b,g);b.kb[g]=[];for(var V=
0;V<s.length;V++)ta.lf(s[V])&&s[V].proxy||(b.kb.ALL.push(s[V]),b.kb[g].push(s[V]))}b.Td=b.Td||[];b.d=b.d||{};g=b.d;s=b.camera.d;e=b.world.b4w_shadow_settings;V=g.Sc={};e.csm_resolution>ra.Mc?(V.csm_resolution=ra.Mc,Fa.error("B4W warning: Shadow map texture has unsupported size. Changed to "+ra.Mc+".")):V.csm_resolution=e.csm_resolution;V.self_shadow_polygon_offset=e.self_shadow_polygon_offset;V.self_shadow_normal_offset=e.self_shadow_normal_offset;V.enable_csm=e.b4w_enable_csm;var M=aa(b,"LAMP",a.DATA_ID_ALL);
if(M=S(M)||M[0])V.Nl=M.ja.type,V.Nf=M.ja.Nf,V.distance=M.ja.distance,"SPOT"!=V.Nl&&"POINT"!=V.Nl||!V.enable_csm||(Fa.warn("B4W Warning: Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),V.enable_csm=!1);V.enable_csm?(V.csm_num=e.csm_num,V.csm_first_cascade_border=e.csm_first_cascade_border,V.first_cascade_blur_radius=e.first_cascade_blur_radius,V.csm_last_cascade_border=e.csm_last_cascade_border,V.last_cascade_blur_radius=e.last_cascade_blur_radius,V.fade_last_cascade=e.fade_last_cascade,
V.blend_between_cascades=e.blend_between_cascades):(V.csm_num=1,V.csm_first_cascade_border=e.csm_first_cascade_border,V.first_cascade_blur_radius=e.first_cascade_blur_radius,V.csm_last_cascade_border=e.csm_last_cascade_border,V.last_cascade_blur_radius=e.last_cascade_blur_radius,V.fade_last_cascade=!1,V.blend_between_cascades=!1);g.eh=[];for(e=0;e<c.length;e++)c[e].d&&c[e].d.of&&g.eh.push(c[e]);e=b.world.b4w_fog_color;g.Nb=new Float32Array([e[0],e[1],e[2],b.world.b4w_fog_density]);g.Tg=f(b);g.ym=
x(b,g.Tg);g.dA=z(b);g.Op=aa(b,"LAMP",a.DATA_ID_ALL).length;g.La=h(b);g.lx=r(b);g.qo=G(b)||ra.force_selectable;g.Qd=t(b);g.eq=0;s.J[0].type!=Q.lc&&ra.anaglyph_use?(Fa.warn("B4W Warning: Anaglyph stereo is disabled for the non-perspective camera"),e=!1):e=ra.anaglyph_use;g.anaglyph_use=e;g.om=ra.bj&&k(b);g.nB=b.world.b4w_fog_color;g.shore_smoothing=m(b);g.Qx=n(b);g.Vt=u(b);g.ox=E(b);g.du=q(b);g.Jw=D(b);g.Gw=l(b);g.hg=ra.hg&&(0<s.dof_distance||s.$e);g.Ca=A(b);g.yg=ra.yg&&b.b4w_enable_motion_blur;g.dg=
ra.dg&&b.b4w_enable_color_correction;g.antialiasing=ra.antialiasing&&b.b4w_enable_antialiasing;g.$f=ra.$f&&b.b4w_enable_bloom&&g.Tg;g.Ae=ra.Ae&&b.b4w_enable_ssao;g.$y=v(b);g.rg=ra.rg&&b.b4w_enable_god_rays&&g.Tg;g.Ac=ra.Ac&&b.b4w_render_refractions;g.glow=ra.glow?g.qo:!1;g.jv=ra.bj;e=b.Td.sort(function(a,b){return b.d.Mf-a.d.Mf});g.pb=sa.Lu(g,s,e);g.Jf=[];g.Hj=!1;g.am=!1;xa.push(b);ab||(ab=va.create());va.w(ab,b)};a.Qk=d;a.ul=function(a){return a.d.pb};a.Qv=function(a){va.P(a,function(b,c){var d=
null;switch(c.type){case "POSTPROCESSING":d=ea.yo(c.$h);break;case "SSAO":d=ea.Tu(c);break;case "SSAO_BLUR":d=ea.Uu(c);ea.li(d,1/c.j.width,1/c.j.height);break;case "DEPTH_PACK":d=ea.Cu();break;case "REFRACT":case "COPY":d=ea.yo("NONE");break;case "GOD_RAYS":sa.nb(a,c,"WIREFRAME")||sa.nb(a,c,"MAIN_BLEND")||sa.nb(a,c,"GOD_RAYS");d=ea.Fu(c.vq|0,(c.Ab&&c.Ge)|0,c.Sg);break;case "GOD_RAYS_COMBINE":sa.nb(a,c,"WIREFRAME")||sa.nb(a,c,"MAIN_BLEND");sa.nb(a,c,"GOD_RAYS");d=ea.Gu();break;case "MOTION_BLUR":d=
ea.Ku(c.Cj);break;case "DOF":d=ea.Du();ea.Lf(d,c.j.dof_power);for(var e=sa.nb(a,c,"POSTPROCESSING"),f=sa.nb(a,e,"POSTPROCESSING"),g=[e,f],s=0;s<g.length;s++){var h=g[s].o;(e=h[0].n)&&ea.Lf(e,c.j.dof_power)}break;case "GLOW":g=sa.nb(a,c,"POSTPROCESSING");s=sa.nb(a,g,"POSTPROCESSING");e=sa.nb(a,s,"POSTPROCESSING");f=sa.nb(a,e,"POSTPROCESSING");d=ea.Eu();g=[s,g];for(s=0;s<g.length;s++)h=g[s].o,(h=h[0].n)&&ea.Lf(h,c.Qn);g=[f,e];for(s=0;s<g.length;s++)h=g[s].o,(h=h[0].n)&&ea.Lf(h,c.Qo*c.ij);break;case "COMPOSITING":d=
ea.Au();break;case "ANTIALIASING":d=ea.wu();break;case "LANCZOS":d=ea.Hu(c.aC);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=ea.Ru(c.type);break;case "ANAGLYPH":d=ea.vu();break;case "SKY":d=ea.Qu();ea.li(d,1/c.j.width,1/c.j.height);break;case "LUMINANCE":d=ea.Iu();break;case "AVERAGE_LUMINANCE":d=ea.xu();break;case "LUMINANCE_TRUNCED":d=ea.Ju();break;case "BLOOM_BLUR":d=ea.yu(c.$h);ea.li(d,1/c.j.width,1/c.j.height);
break;case "BLOOM":d=sa.nb(a,c,"BLOOM_BLUR");g=[sa.nb(a,d,"BLOOM_BLUR"),d];for(s=0;s<g.length;s++)h=g[s].o,(h=h[0].n)&&ea.Lf(h,c.bloom_blur);d=ea.zu();break;case "VELOCITY":d=ea.Xu()}d&&(e={T:!0,eb:vb.Yi("NONE"),n:d},H(d),c.o.push(e),B(a,c,d),L(d))})};a.append_object=function(a,b){switch(b.type){case "MESH":var c=a.d.pb,d=b.d;!sa.ab(c,"SHADOW_CAST")&&d.Bb&&(d.Bb=!1);for(var d=N(a,Lb),e=0;e<d.length;e++){var f=d[e],g=b,s=c,h=a;switch(f.type){case "MAIN_OPAQUE":O(f,g,s,"OPAQUE",h);break;case "MAIN_BLEND":O(f,
g,s,"BLEND",h);break;case "MAIN_XRAY":O(f,g,s,"XRAY",h);break;case "MAIN_REFLECT":s=g.d;g=g.V;for(h=0;h<g.length;h++){var k=g[h],l=ba(k);if(!("MAIN"!=l.type&&"NODES"!=l.type&&"PARTICLES"!=l.type||F(f,l)||l.va)&&l.dc){var m=l.Ua;ka.G(m,"DISABLE_FOG",0);ka.G(m,"WATER_EFFECTS",0);"special_skydome.glslf"==ka.hp(m)&&ka.G(m,"REFLECTION_PASS",1);ka.G(m,"SHADOW_SRC","SHADOW_SRC_NONE");ka.G(m,"TEXTURE_NORM",0);ea.Cb(l);m={T:!0,eb:s,n:l};H(l);f.o.push(m);"MAIN"==l.type&&(k.Eb||(k.Eb=[]),k.Eb.push(l))}}break;
case "DEPTH":k=g.d;g=g.V;for(l=0;l<g.length;l++){var n=g[l];if("DEPTH"==n.type&&!F(f,n)&&!n.Vb){if(sa.Ow(s,f,"SHADOW_CAST"))if(n.Bb){switch(ra.ue){case "DEPTH":var m="SHADOW_SRC_DEPTH",V="SHADOW_DST_MASK";break;default:throw"Wrong shadows type";}n=ea.Qm(n,m,V);ea.xk(n,h.d.Sc);sa.jp(s,f);Z(s,f,m)}else n=ea.Qm(n,"SHADOW_SRC_NONE","SHADOW_DST_MASK");else n=ea.Qm(n,"SHADOW_SRC_NONE","SHADOW_DST_NONE");n.Ca&&(m=sa.ab(s,"GRASS_MAP"))&&J(n,m,k);ea.Cb(n);m={T:!0,eb:k,n:n};H(n);f.o.push(m);B(s,f,n);L(n)}}break;
case "SHADOW_CAST":k=!1;l=g.d;g=g.V;for(m=0;m<g.length;m++)if(n=g[m],n.Ub||n.Bb)if(k=!0,"DEPTH"==n.type&&!F(f,n)&&n.Ub){switch(ra.ue){case "DEPTH":V="SHADOW_DST_DEPTH";break;default:throw"Wrong shadows type";}n=ea.Pu(n,V);n.Ca&&(V=sa.ab(s,"GRASS_MAP"))&&J(n,V,l);ea.Z(n,"SHADOW_TEX_RES",ka.s(h.d.Sc.csm_resolution));ea.Cb(n);V={T:!0,eb:l,n:n};H(n);f.o.push(V)}k&&K(f,sa.ab(s,"MAIN_OPAQUE"),f.o,h,!0);break;case "COLOR_PICKING":T(f,g);break;case "COLOR_PICKING_XRAY":T(f,g);break;case "GRASS_MAP":s=g.d;
g=g.V;for(h=0;h<g.length;h++)k=g[h],"GRASS_MAP"!=k.type||F(f,k)||(ea.Cb(k),l={T:!0,eb:s,n:k},H(k),f.o.push(l),k=f.j,V=s.Ma,l=f.Pb[0],m=f.Pb[1],n=f.Pb[2],0==l&&0==m?(l=V.min_y,m=V.max_y):(l=Math.min(l,V.min_y),m=Math.max(m,V.max_y)),V=1E-4*(m-l),f.Pb[0]=l-V,f.Pb[1]=m+V,Q.tm(k,n/2,-m,-l,n/2),Q.Hg(k));break;case "GLOW_MASK":s=g.d;g=g.V;for(h=0;h<g.length;h++)k=g[h],"COLOR_ID"!=k.type||F(f,k)||(l=ba(k),ea.Z(l,"USE_GLOW",1),ea.Cb(l),g.push(l),m={T:!0,eb:s,n:l},H(l),f.o.push(m),k.Eb||(k.Eb=[]),k.Eb.push(l));
break;case "WIREFRAME":for(h=g.d,g=g.V,k=0;k<g.length;k++)l=g[k],"WIREFRAME"!=l.type||F(f,l)||(l.Ca&&(m=sa.ab(s,"GRASS_MAP"))&&J(l,m,h),ea.Cb(l),m={T:!0,eb:h,n:l},H(l),f.o.push(m),B(s,f,l),L(l))}}break;case "LAMP":b.ja.index=a.d.eq++;c=N(a,mb);for(d=0;d<c.length;d++)c[d].Af++;ca(b,a)}};a.GB=F;a.rm=function(a){a.d.Hj=!0};a.lw=function(a,b){for(var c=a.d.Sc,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=Q.Zu(c,b,e);return d};a.hide_object=function(a){a.d.Kh=!0};a.show_object=function(a){a.d.Kh=
!1};a.Ux=function(a,b){for(var c=b.d,d=N(a,Lb),e=0;e<d.length;e++)for(var f=d[e].o,g=f.length-1;0<=g;g--){var s=f[g];s.eb==c&&(s.n&&Za.jo(s.n.lb),f.splice(g,1))}};a.check_object=function(a,b){return b.kb[a.type]&&-1<b.kb[a.type].indexOf(a)?!0:!1};a.My=function(a){var b=a.kb.LAMP;if(b.length==a.d.eq){for(var c=[],d=0;d<b.length;d++)c[b[d].ja.index]=d;for(d=0;d<c.length-1;d++)for(var e=d+1;e<c.length;e++){var f=b[c[d]].ja,g=b[c[e]].ja;if(g.bh&&g.dh&&(!f.bh||!f.dh)||!f.bh&&(g.bh||!f.dh&&g.dh))f=c[d],
c[d]=c[e],c[e]=f}for(d=0;d<c.length;d++)b[c[d]].ja.index=d,ca(b[c[d]],a)}};a.Of=ca;a.Iz=function(b){var c=aa(b,"LAMP",a.DATA_ID_ALL);if(c=S(c)||c[0]){b=N(b,mb);for(var d=0;d<b.length;d++)b[d].ar=c.ja.index}};a.cleanup=function(){for(var a=0;a<xa.length;a++){var b=xa[a];va.P(b.d.pb,function(a,b){if("SINK"!=b.type){var c=b.j;wb.Vx(c.ge,c.ub,c.oc,c.width,c.height);for(var c=b.o,d=0;d<c.length;d++){var e=c[d].n;e&&ea.nu(e)}}});b.d.pb=[];b.d.Jf=[]}hb=null;xa.length=0;ab=null;zb.length=0;ua[0]=0;ua[1]=
0;ua[2]=0};a.Xp=function(a,b,c){a=Q.yv(a,a.Ia,a.Pa,null,!0);var d=gb.Uv(a);a=vb.Yi("DYNAMIC");a.Ma=a.Kb={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.tb=a.wc=la.Tt();var e=a.tb.sa;a.Te=a.Se=la.Tk([e,0,0],[0,e,0],[0,0,e],a.tb.A);c=ea.Ou(d,c);b.o.push({T:!0,eb:a,n:c})};a.Da=aa;a.vw=function(a){return[a.frame_start,a.frame_end]};a.Yq=function(a,b,c,d,e){ic=a;Ab=b;Ua=c;$a=e;Ia=d;hb&&fa(hb,a,b)};a.li=ja;a.fz=N;a.ka=I;a.get_environment_colors=function(a){a=N(a,mb)[0];var b=a.pc,
c=a.uc,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.ee,d,e]};a.set_environment_colors=function(a,b,c,d){a=N(a,mb);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.ee=b);c&&f.pc.set(c);d&&f.uc.set(d);f.ya=!0}};a.get_sky_params=function(a){if(a=I(a,"SKY")){var b={};b.color=Array(3);wa.copy(a.Kg,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=
a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=I(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&
(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==typeof b.color&&c.Kg.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==
typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.ya=!0,c.Gj=!0,X(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=N(a,Tb)[0].Nb;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,
b){for(var c=N(a,Tb),d=0;d<c.length;d++){var e=c[d];e.Nb.set(b);e.ya=!0}};a.get_ssao_params=function(a){var b=I(a,"SSAO");a=I(a,"SSAO_BLUR");if(!b)return null;var c=b.o[0].n,d={};d.ssao_quality=ea.ob(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.Pn=a.ssao_blur_discard_value;d.radius_increase=b.Pg;d.influence=b.Og;d.dist_factor=b.Ng;d.ssao_only=b.ssao_only;d.ssao_white=ea.ob(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=I(a,"SSAO"),
d=I(a,"SSAO_BLUR");if(!c)return Fa.error("SSAO is not enabled on scene"),0;if("string"==typeof b.ssao_quality){var e=c.o[0].n;ea.Z(e,"SSAO_QUALITY",b.ssao_quality);ea.Cb(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.o[0].n,ea.Z(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),ea.Cb(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.o[0].n,ea.Z(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),ea.Cb(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.Pg&&
(c.Pg=b.Pg);"number"==typeof b.Og&&(c.Og=b.Og);"number"==typeof b.Ng&&(c.Ng=b.Ng);if("number"==typeof b.ssao_only){c=I(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var f=0;f<c.o.length;f++)e=c.o[f].n,ea.Z(e,"SSAO_ONLY",b.ssao_only),ea.Cb(e,!0)}"number"==typeof b.ssao_white&&(e=c.o[0].n,ea.Z(e,"SSAO_WHITE",b.ssao_white),ea.Cb(e,!0));c.ya=!0;d.ya=!0};a.get_dof_params=function(a){a=I(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.j.dof_distance;b.dof_front=a.j.dof_front;b.dof_rear=a.j.dof_rear;
b.dof_power=a.j.dof_power;return b};a.set_dof_params=Y;a.get_god_rays_params=function(a){var b=N(a,["GOD_RAYS"]);a=I(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].wg;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=ea.ob(b[0].o[0].n,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=N(a,["GOD_RAYS"]),d=I(a,"GOD_RAYS_COMBINE");if(!c||!d)return Fa.error("God Rays are not enabled on scene"),0;"number"==typeof b.god_rays_intensity&&
(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].wg=e,c[f].Sj=e/c[f].Sg/(f+1),c[f].ya=!0;if("number"==typeof b.god_rays_steps)for(var g=ka.s(b.god_rays_steps,1),e=c[0].wg,f=0;f<c.length;f++){c[f].Sg=g;c[f].Sj=e/g/(f+1);c[f].ya=!0;var s=c[f].o[0].n;ea.Z(s,"STEPS_PER_PASS",g);ea.Cb(s,!0)}d.ya=!0};a.get_bloom_params=function(a){var b=I(a,["LUMINANCE_TRUNCED"]);a=I(a,"BLOOM");if(!b||!a)return null;var c=
{};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=function(a,b){var c=I(a,"LUMINANCE_TRUNCED"),d=I(a,"BLOOM");if(!c||!d)return Fa.error("Bloom is not enabled on scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.ya=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.ya=!0);if("number"==typeof b.bloom_blur)for(var e=a.d.pb,c=sa.nb(e,d,"BLOOM_BLUR"),e=sa.nb(e,c,"BLOOM_BLUR"),c=[c,e],e=0;e<c.length;e++){var f=
c[e].o[0].n;f&&(ea.Lf(f,b.bloom_blur),ja(c[e],1/d.j.width,1/d.j.height))}};a.get_wind_params=function(){var a=ua,b=wa.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.set_wind_params=function(b,c){for(var d=aa(b,"ALL",a.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if("EMPTY"===f.type&&f.field&&"WIND"===f.field.type)var g=f}if(!g)return Fa.error("There is no wind on the scene"),0;d=g.d;"number"==typeof c.wind_dir&&(Ga=[0,c.wind_dir/180*
Math.PI,-Math.PI/2],ta.euler_to_quat(Ga,ob),d.quat.set(ob),na(g));"number"==typeof c.wind_strength&&(d.ml=c.wind_strength,na(g));pa(b)};a.hy=function(a){a.d.am=!0};a.get_water_surface_level=ga;a.get_water_mat_params=function(a,b){var c=I(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.Ie,b.waves_length=c.Wf,c.Dc)){b.water_fog_density=c.Dc[3];var d=b.water_fog_color=[];d[0]=c.Dc[0];d[1]=c.Dc[1];d[2]=c.Dc[2]}};a.set_water_params=function(a,b){var c=I(a,"MAIN_OPAQUE");if(!c||!c.La)return Fa.error("set_water_params() - no water parameters on this scene"),
null;c=c.La;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=
b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.ig=b.water_dynamic);for(var d=N(a,tc),e=0;e<d.length;e++){var f=d[e];"number"==typeof b.water_fog_density&&c.Nb&&(f.Dc[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&
c.Nb&&f.Dc.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.Ie=b.waves_height);"number"==typeof b.waves_length&&(f.Wf=b.waves_length);f.ya=!0}};a.get_shore_dist=function(a,b){var c=I(hb,"MAIN_OPAQUE");if(!c.kk)return 100;var d=c.xg,e=c.He,f=(a[0]-c.ve[0])/c.we[0],g=(c.ve[1]+a[2])/c.we[1],f=f+.5,g=g+.5;if(1<f||0>f||1<g||0>g)e=1;else return c=d*ta.ep(hb.d.vm,c.Jg,f,g),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,b){for(var d=c().camera.d,e=0;e<xa.length;e++){var f=xa[e],g=f.d.pb;
if(f.d.La)var h=d.g[1]-ga(d.g[0],d.g[2]);for(var k=f.d.eh,l=0;l<k.length;l++){var m=k[l].d,n=m.Xa,M=m.lg+m.xa;if(n){var r=Math.round(n.currentTime*m.Ob),R=m.xa/m.Ob;if(r<m.xa-(ra.nf?5:0)||k[l].d.Pf&&r>M)n.currentTime=R;!m.Pf&&r>M&&n.pause();2<=n.readyState&&!n.paused&&eb.Lz(m)}else if(m.Fg){n=Math.min(m.Fg.length,m.lg+m.xa);if(m.Kd<m.xa||m.Pf&&m.Kd>=n)m.Kd=m.xa;!m.Pf&&m.Kd>=n&&(m.Gg=!1);n=Math.round(a*Ha.za/m.Ob)*m.Sq;n!=hc&&m.Gg&&(eb.Hz(m),m.Kd++);hc=n}}va.P(g,function(b,c){-1<nb.indexOf(c.type)&&
(c.time=a);-1<tc.indexOf(c.type)&&f.d.La&&(c.Kk=h)})}for(e=0;e<zb.length;e++)ma(zb[e],a);for(e=0;e<xa.length;e++)if(f=xa[e],l=f.d,d=l.Jf,l.Hj&&(U(f),l.Hj=!1),l.am&&(s(f),l.am=!1),d.length){f.b4w_enable_motion_blur&&V(l.pb,b);if(l.glow){for(var g=I(f,"GLOW_MASK").o,x=0,l=0;l<g.length;l++)x+=g[l].n.qg;va.P(f.d.pb,function(a,b){"GLOW"===b.type&&(b.el=x)})}g=null;for(l=0;l<d.length;l++)"GLOW_MASK"==d[l].type&&(g=l);for(l=0;l<d.length;l++)k=d[l],lb.km(k),null!==g&&qa(k,d[g]),wb.yh(k)}ra.show_hud_debug_info&&
Ea.Hy(xa,b)};a.rl=function(a){var b=[];va.P(a.d.pb,function(a,c){b.push(c)});return b};a.apply_glow_anim=function(a,b,c,d){a.it={Lm:0,rp:b,rc:c,Lq:d};-1==zb.indexOf(a)&&zb.push(a)};a.clear_glow_anim=function(a){if(a.V)for(var b=0;b<a.V.length;b++){var c=a.V[b];"COLOR_ID"==c.type&&(c.qg=0)}a=zb.indexOf(a);-1!=a&&zb.splice(a,1)};a.SA=function(){zb=[]};a.get_cam_water_depth=function(){var a=I(hb,"MAIN_BLEND"),b=hb;return a||b.d.La?a.Kk:null};a.get_object_data_id=function(a){return a.d.sd};a.Gr=pa;a.Dy=
function(a,b){switch(b){case "WM_NONE":a.T=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.o.length;c++)a.o[c].n.wireframe_mode=ia.pn[b];a.T=!0}a.va="WM_TRANSPARENT_WIREFRAME"==b;a.ya=!0};a.Cy=function(a,b){for(var c=0;c<a.o.length;c++)a.o[c].n.wireframe_edge_color=b,a.ya=!0};a.yn=function(a,b){for(var c=0;c<b.length;c++)a.kb.ALL.push(b[c]),a.kb.MESH.push(b[c])};a.Fr=na;a.pick_object=function(d,e){if(!b())return Fa.error("No active scene"),
null;var f=c(),g=I(f,"COLOR_PICKING");if(g){d-=Ia;e-=$a;d*=Ua;e*=Ua;lb.km(g);wb.yh(g);var s=I(f,"COLOR_PICKING_XRAY");s?(lb.km(s),wb.yh(s),g=s.j):g=g.j;e=g.height-e;g=wb.Nx(g.ge,d,e);f=aa(f,"MESH",a.DATA_ID_ALL);for(s=0;s<f.length;s++){var h=f[s].rn;if(h&&5>Math.abs(255*h[0]-g[0])&&5>Math.abs(255*h[1]-g[1])&&5>Math.abs(255*h[2]-g[2]))return f[s]}}else Fa.error("Color picking is not available");return null};a.Ew=function(){return ua};a.ww=function(b){var c=[];b=aa(b,"MESH",a.DATA_ID_ALL);for(var d=
0;d<b.length;d++){var e=b[d];e.d.Qc&&c.push(e)}return c};a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,b.description=a.b4w_tags.description);return b}};b4w.module.__physics=function(a,p){function c(a,b){for(var d=a.Sd,e=0;e<d.length;e++)d[e].d.ik&&b.push(d[e]),c(d[e],b)}function b(a,b){if(ba)switch(a){case B.ds:G.log(b);break;case B.as:G.error(b);break;case B.bs:t.fbmsg.apply(this,b.slice(1));break;case B.hs:var c=e(b.body_id);if(c){var d=b.trans,f=b.quat,g=b.linvel,h=b.angvel,c=c.l;c.Xk=b.time;H.ki(d,1,f,c.Yk);J.copy(g,c.Tp);J.copy(h,c.An)}break;case B.fs:(d=e(b.chassis_hull_body_id))&&H.ki(b.trans,1,b.quat,d.i.bi[b.prop_ind]);break;case B.cs:if(c=
e(b[1]))d=b[4],c=c.vc.Oi[b[2]],y.set_translation(c,b[3]),y.set_rotation(c,d),y.v(c);break;case B.js:if(c=e(b[1]))c.i.speed=b[2];break;case B.Zr:for(var d=b.body_id_a,c=b.body_id_b,f=b.result,g=b.coll_point,d=parseInt(d),h=ba.l.o,k=0;k<h.length;k++)for(var l=h[k].rb,m=0;m<l.Ic.length;m++){for(var n=l.Ic[m],r=n.Lj,x=!1,q=0;q<r.length;q++){var v=r[q];if(v[0]===d&&v[1]===c){n.yq[q]=f;x=!0;break}}if(x){r=n.yq;for(q=x=0;q<r.length;q++)x=x||r[q];n.callback(x,g)}}break;case B.$r:if(c=e(b[1]))c=c.l,c.Wi&&
c.Wi(b[2]);break;case B.gs:if(c=e(b.body_id))for(c=c.l,f=b.from,g=b.to,h=b.local,k=b.body_id_b_hit,l=b.cur_result,m=0;m<c.qe.length;m++)if(r=c.qe[m],L.Vi(r.N,f)&&L.Vi(r.da,g)&&r.local==h){for(d in r.Id)r.Id[d]=1;-1!=k&&(r.Id[k]=l);for(var n=r.Yb,q=r.callback,r=r.Id,x=!1,v=1,p=0;p<ba.l.o.length;p++){var u=ba.l.o[p].rb;if(("ANY"==n||u.id==n)&&u.I in r&&1!==r[u.I]){x=!0;v=r[u.I];break}}q(x,v)}break;case B.es:console.log("Physics message ping: ",performance.now()-b[1]);break;default:G.error("Wrong message: "+
a)}}function e(a){return ca[a]||null}function d(){X.body++;return X.body}function g(a){return{I:a,Ul:0,uj:!1,xe:!0,YB:!1,is_character:!1,Yw:!1,Xi:null,id:"",UA:{},Ic:[],Wi:null,qe:[],Xk:0,Yk:new Float32Array([0,0,0,1,0,0,0,1]),Tp:new Float32Array(3),An:new Float32Array(3),Si:new Float32Array(3),Ri:new Float32Array(4)}}function k(a,b){switch(a){case "BOX":var c=b.Kb;break;case "CYLINDER":c=b.Ck;break;case "CONE":c=b.Bk;break;case "SPHERE":c=b.wc;break;case "CAPSULE":c=b.Ak}return c}function f(a){if(!a)return null;
var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.A&&(b.center=a.A);"number"===typeof a.sa&&(b.radius=a.sa);"number"===typeof a.height&&(b.height=a.height);return b}function m(a,b,c,d){var e=a.d.g,f=b.d.K,g=new Float32Array(16);U.invert(f,g);f=new Float32Array(3);
J.transformMat4(e,g,f);switch(b.i.type){case 10:b=b.b4w_vehicle_settings;a=a.d.Kb;B.q(B.ls,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:B.q(B.ks,c,f,a.DC)}}function h(a){return a.l&&a.l.Xi?!0:!1}function r(a,b,c,d,e,f,g,h,k,l){var m;X.so++;m=X.so.toString(16);B.q(B.ss,m,a,h,b.l.I,c,d,e.l.I,f,g,k,l);b.l.Xi=m}function n(a){var b=a.l;if(b&&(0===b.Ul||!0===b.uj||!1===b.xe||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.g[0]!=a.l.Si[0]||a.d.g[1]!=a.l.Si[1]||a.d.g[2]!=
a.l.Si[2]||a.d.quat[0]!=a.l.Ri[0]||a.d.quat[1]!=a.l.Ri[1]||a.d.quat[2]!=a.l.Ri[2])){a.l.Si.set(a.d.g);a.l.Ri.set(a.d.quat);var b=a.l,c=B.kp(B.Xf);c.msg_id=B.Xf;c.body_id=a.l.I;c.trans=a.d.g;"DYNAMIC"===b.type?(c.quat=w,F.identity(w)):c.quat=a.d.quat;B.q(B.Xf,c)}a=a.Sd;for(b=0;b<a.length;b++)n(a[b])}function x(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.quat;e[0]=b;e[1]=c;e[2]=d;J.transformQuat(e,a,e)}function v(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.l.o.length;e++){var f=
b.l.o[e];if("ANY"==a||f.rb.id==a)f=f.rb.I,c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function u(a,b){B.q(B.Ec,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=L.Dn(e.N)+L.Dn(e.da)+String(e.local);c[f]=c[f]||{N:e.N,da:e.da,local:e.local,Rn:[]};var g=c[f].Rn,h;for(h in e.Id)-1==g.indexOf(h)&&g.push(h)}for(f in c)d=c[f].N,e=c[f].da,h=c[f].local,g=c[f].Rn,B.q(B.nn,a,d,e,h,g)}else B.q(B.nn,a,null,null,!1,null)}function E(a,b){if(b.Rg){var c=a.l.I,d=b.jg*b.Zo,e=b.ph*b.Tn,f=-b.Qg*b.Fm*2*Math.PI/
b.mr;b.Ip&&(f*=-1);switch(b.type){case 10:B.q(B.Ec,c);B.q(B.Zs,c,d,e,f);break;case 20:B.q(B.Ec,c),B.q(B.Ys,c,d,e,f)}}}function q(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function D(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function l(a){return a.b4w_character?!0:!1}function z(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}p("__camera");var A=p("__config");p("__constraints");var G=p("__print"),t=p("__debug"),B=p("__ipc");
p("__renderer");var O=p("__scenes"),y=p("__transform"),H=p("__tsr"),L=p("__util"),Z=p("__version"),J=p("vec3"),F=p("quat"),U=p("mat4"),K=A.rb,S=A.p,T=null,ba=null,P=[],ca=[],X={Tr:0,body:0,so:0,shape:0},aa=new Float32Array(3),w=new Float32Array(4),fa=new Float32Array(4),ja=new Float32Array(16),N=new Float32Array(8),I=new Float32Array(8);a.Sw=function(a){if(K.enabled){var c=K.ah+Z.timestamp();G.log("%cLOAD PHYSICS","color: #0a0",c,"Max FPS: "+K.me);T=new Worker(c);B.init(T,b);B.q(B.Is,a,K.me)}};a.Gn=
function(a){var b;X.Tr++;b=X.Tr;B.q(B.xs,b);a.l={};a.l.cA=b;a.l.o=[]};a.cleanup=function(){if(K.enabled){B.q(B.Ds);ba=null;P.length=0;ca.length=0;for(var a in X)X[a]=0}};a.append_object=function(a,b){ba=b;B.q(B.Ns,b.l.cA);var e=a.d;if(!e)throw"No object render: "+a.name;if(a.parent&&e.ik)return null;var n=[];e.ik&&c(a,n);if(q(a)||D(a)||l(a)||z(a)||a.b4w_collision){var R,s=a,V=e.Aq,x=s.d,v=s.game,p=d();if("CAMERA"==s.type)var u=v.use_collision_bounds?v.collision_bounds_type:"BOX",A=k(u,x),N=x.Eh,I=
x.zh,N=.5,I=0;else"EMPTY"==s.type?(u="EMPTY",A=null,I=N=0):(u=v.use_collision_bounds?v.collision_bounds_type:"BOX",A=k(u,x),N=x.Eh,I=x.zh);var t=x.g,w=x.quat,y=v.use_ghost,K=v.use_sleep,S=v.mass,H=v.velocity_min,T=v.velocity_max,X=v.damping,Z=v.rotation_damping,aa=v.collision_group,bc=v.collision_mask,ka=x.wc.sa,eb=f(A),ta=s.b4w_correct_bounding_offset,wa;var Ca=u;if(n.length){var ra=[],Ha={};Ha.quat=new Float32Array([0,0,0,1]);Ha.trans=new Float32Array(3);Ha.worker_bounding=eb;Ha.bounding_type=Ca;
ra.push(Ha);U.invert(x.K,ja);F.invert(x.quat,fa);for(var Ja=0;Ja<n.length;Ja++){var kb={},Lb=n[Ja],mb=Lb.game.collision_bounds_type,Tb=new Float32Array(4),nb=new Float32Array(3);J.transformMat4(Lb.d.g,ja,nb);F.multiply(fa,Lb.d.quat,Tb);kb.trans=nb;kb.quat=Tb;kb.bounding_type=mb;kb.worker_bounding=f(k(mb,Lb.d));ra.push(kb)}wa=ra}else wa=[];B.q(B.os,p,t,w,V,y,K,S,H,T,X,Z,aa,bc,u,eb,ka,N,I,wa,ta);P.push(s);ca[p]=s;var tc=g(p);tc.type=V;tc.Ul=S;tc.uj=y;R=tc;a.l=R;var hc={n:null,rb:R};b.l.o.push(hc)}else for(var hb=
a.V||[],xa=0;xa<hb.length;xa++){var ab=hb[xa],zb;if(zb="PHYSICS"==ab.type){var ic;a:{for(var Ab=b.l.o,Ua=0;Ua<Ab.length;Ua++){var $a=Ab[Ua].n;if($a&&$a.id==ab.id){ic=!0;break a}}ic=!1}zb=!ic}if(zb)if(ab.gc.H)if(ab.Ge&&b.d.La){var Ia=ab,Zb=ba,Sa=O.ka(Zb,"MAIN_OPAQUE");B.q(B.ws,Sa.He);if(Sa.La&&Ia.Yz){var Ga={};Ga.dst_noise_scale0=Ia.dst_noise_scale0;Ga.dst_noise_scale1=Ia.dst_noise_scale1;Ga.dst_noise_freq0=Ia.dst_noise_freq0;Ga.dst_noise_freq1=Ia.dst_noise_freq1;Ga.dir_min_shore_fac=Ia.dir_min_shore_fac;
Ga.dir_freq=Ia.dir_freq;Ga.dir_noise_scale=Ia.dir_noise_scale;Ga.dir_noise_freq=Ia.dir_noise_freq;Ga.dir_min_noise_fac=Ia.dir_min_noise_fac;Ga.dst_min_fac=Ia.dst_min_fac;Ga.waves_hor_fac=Ia.waves_hor_fac;var Bb=Sa.Ie,Ub=Sa.Wf;Sa.kk?B.q(B.mn,Ga,Sa.we[0],Sa.we[1],Sa.ve[0],Sa.ve[1],Sa.xg,Bb,Ub,Sa.Jg,Zb.d.vm):B.q(B.mn,Ga,0,0,0,0,0,Bb,Ub,0,null)}}else{var ob;if(ab.Oz){var Ra=a,Va=ab,za=d(),pb=Va.gc;B.q(B.us,za,pb.u[0].a_position,pb.ba||null,Ra.d.g,Va.mo,Va.no);var Mb=g(za);Mb.uj=!0;ob=Mb}else{var ua=a,
rb=ab,da=d(),Nb=rb.gc;B.q(B.vs,da,Nb.u[0].a_position,Nb.ba||null,ua.d.g,rb.Eh,rb.zh,rb.mo,rb.no);ob=g(da)}R=ob;R.id=ab.Yb;hc={n:ab,rb:R};b.l.o.push(hc)}else G.error("Object "+a.name+" has collision material with no assigned vertices")}if(q(a)||D(a)){var ya=a,Aa=ya.l.I;q(ya)?(ya.i.type=10,B.q(B.ps,Aa,ya.i.iz,ya.i.kz,ya.i.jz,ya.i.aA,ya.i.nx)):D(ya)&&(ya.i.type=20,B.q(B.ns,Aa,ya.i.jl,ya.i.$m,ya.i.an));if(ya.i.If){var Da=ya.i.If;switch(ya.i.type){case 10:m(Da[1],ya,Aa,!0);m(Da[0],ya,Aa,!0);m(Da[3],ya,
Aa,!1);m(Da[2],ya,Aa,!1);break;case 20:for(var xb=0;xb<Da.length;xb++)m(Da[xb],ya,Aa,!1)}}ya.l.id=ya.b4w_vehicle_settings.name;E(a,a.i)}else if(l(a)){var yb=a.d,Oa=a.l,Ob=yb.Kb.max_y-yb.Kb.min_y,ib=Oa.I,Pb=a.b4w_character_settings,cc=Pb.walk_speed,uc=Pb.run_speed,Vb=Pb.step_height,Gb=Pb.jump_strength,jc=Pb.waterline,kc=L.lv(a);B.q(B.qs,ib,kc,Ob,cc,uc,Vb,Gb,jc);Oa.is_character=!0}else if(z(a)){var Ta=a,lc=Ta.l.I;B.q(B.ts,lc,Ta.vc.jl,Ta.vc.$m,Ta.vc.an);if(Ta.vc.Oi)for(var Wb=Ta.vc.Oi,bb=0;bb<Wb.length;bb++){var dc=
Wb[bb],sb=dc.d.g,C=Ta.d.K,cb=new Float32Array(16);U.invert(C,cb);var Wa=new Float32Array(3);J.transformMat4(sb,cb,Wa);B.q(B.ms,lc,Wa,dc.Xt)}Ta.l.Yw=!0}else a.b4w_collision&&(R.id=a.b4w_collision_id);for(xa=0;xa<P.length;xa++)if(a=P[xa],a.l){var Xa=a;if(!h(Xa))for(var oa=0;oa<Xa.constraints.length;oa++){var W=Xa.constraints[oa],Ka=W.target,Qa=W.pivot_type;if("RIGID_BODY_JOINT"==W.type&&Ka.l){var La=new Float32Array([W.pivot_x,W.pivot_y,W.pivot_z]),Hb,Ib=new Float32Array([W.axis_x,W.axis_y,W.axis_z]);
Hb=L.euler_to_quat(Ib,new Float32Array(4));var Jb=U.fromRotationTranslation(Hb,La,new Float32Array(16)),Qb=U.multiply(Xa.d.K,Jb,new Float32Array(16)),Kb=U.invert(Ka.d.K,new Float32Array(16)),Xb=U.multiply(Kb,Qb,Kb),mc=L.xf(Xb),Dc=L.matrix_to_quat(Xb),Pa=W,Ma={};Ma.use_limit_x=Pa.use_limit_x;Ma.use_limit_y=Pa.use_limit_y;Ma.use_limit_z=Pa.use_limit_z;Ma.use_angular_limit_x=Pa.use_angular_limit_x;Ma.use_angular_limit_y=Pa.use_angular_limit_y;Ma.use_angular_limit_z=Pa.use_angular_limit_z;Ma.limit_max_x=
Pa.limit_max_x;Ma.limit_min_x=Pa.limit_min_x;Ma.limit_max_y=Pa.limit_max_y;Ma.limit_min_y=Pa.limit_min_y;Ma.limit_max_z=Pa.limit_max_z;Ma.limit_min_z=Pa.limit_min_z;Ma.limit_angle_max_x=Pa.limit_angle_max_x;Ma.limit_angle_min_x=Pa.limit_angle_min_x;Ma.limit_angle_max_y=Pa.limit_angle_max_y;Ma.limit_angle_min_y=Pa.limit_angle_min_y;Ma.limit_angle_max_z=Pa.limit_angle_max_z;Ma.limit_angle_min_z=Pa.limit_angle_min_z;r(Qa,Xa,La,Hb,Ka,mc,Dc,Ma,null,null)}}}};a.Dv=e;a.update=function(){for(var a=0;a<P.length;a++){var b=
P[a],c=b.l;if(c.xe&&c.Xk){var d=performance.now()/1E3-c.Xk,d=Math.min(d,10/60);S.tx&&(d=0);var e=N;H.Tw(c.Yk,d,c.Tp,c.An,N);y.set_translation(b,H.pp(e));y.set_rotation(b,H.lp(e));y.v(b);n(b);if(b.i)for(var c=b,d=c.i.If,e=c.d.Pd,f=N,g=0;g<d.length;g++){var h=d[g];H.multiply(e,c.i.bi[g],f);y.Wq(h,f);y.v(h)}b.i&&b.i.Rg&&(c=b.i,d=c.Rg)&&(e=b.i.nr,h=ja,f=b.d.g,g=b.d.quat,L.Om(b.i.or,g,f,h),L.xf(h,d.d.g),L.matrix_to_quat(h,d.d.quat),h=w,L.Pm(e,g,f,h),e=fa,F.setAxisAngle(h,-c.Qg*c.Fm*2*Math.PI,e),F.multiply(e,
d.d.quat,d.d.quat),y.v(d));b.i&&b.i.Cm&&(c=b.i,d=c.Cm)&&(f=b.i.ir,e=ja,g=b.d.g,h=b.d.quat,L.Om(b.i.jr,h,g,e),L.xf(e,d.d.g),L.matrix_to_quat(e,d.d.quat),e=w,L.Pm(f,h,g,e),f=fa,g=Math.abs(c.speed)*c.hr,g>c.Wl&&(g=c.Wl),F.setAxisAngle(e,-g,f),F.multiply(f,d.d.quat,d.d.quat),y.v(d));b.i&&b.i.Im&&(c=b.i,d=c.Im)&&(e=b.i.vr,h=ja,f=b.d.g,g=b.d.quat,L.Om(b.i.wr,g,f,h),L.xf(h,d.d.g),L.matrix_to_quat(h,d.d.quat),b=w,L.Pm(e,g,f,b),e=fa,F.setAxisAngle(b,-Math.abs(c.jg)*c.Go,e),F.multiply(e,d.d.quat,d.d.quat),
y.v(d))}}if(a=ba)a=O.ka(a,"MAIN_OPAQUE"),a.La&&0<a.La.waves_height&&(b=J.length(a.vi),B.q(B.Xs,a.time*b))};a.$v=function(){return ba};a.pause=function(){K.enabled&&B.q(B.Js)};a.resume=function(){K.enabled&&B.q(B.Ms)};a.enable_simulation=function(a){a=a.l;if(!a)throw"No object physics";if(!a.xe){var b=a.I;a.xe=!0;B.q(B.Hs,b)}};a.disable_simulation=function(a){a=a.l;if(!a)throw"No object physics";if(a.xe){var b=a.I;a.xe=!1;B.q(B.Gs,b)}};a.has_physics=function(a){return a.l?!0:!1};a.has_dynamic_physics=
function(a){return(a=a.l)&&a.xe&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.Ul&&0==a.uj?!0:!1};a.has_simulated_physics=function(a){return(a=a.l)&&a.xe?!0:!1};a.set_gravity=function(a,b){B.q(B.Ws,a.l.I,b)};a.Mw=h;a.apply_constraint=r;a.clear_constraint=function(a){a=a.l;B.q(B.Ls,a.Xi);a.Xi=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,g){c=H.eg(c,1,d,N);f=H.eg(f,1,g,I);H.invert(c,c);H.multiply(f,c,c);y.Bw(e,f);H.multiply(f,c,c);y.Wq(b,c);y.v(b);a.set_transform(b,b.d.g,b.d.quat)};a.set_transform=
function(a,b,c){H.ki(a.d.g,1,a.d.quat,a.l.Yk);var d=B.kp(B.Xf);d.msg_id=B.Xf;d.body_id=a.l.I;d.trans=b;d.quat=c;B.q(B.Ec,a.l.I);B.q(B.Xf,d)};a.sync_transform=n;a.apply_velocity=function(a,b,c,d){x(a,b,c,d,aa);a=a.l.I;B.q(B.Ec,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(aa[0]),f=Math.abs(aa[1]),g=Math.abs(aa[2]);aa[0]=e?aa[0]/e*Math.max(e,b):0;aa[1]=f?aa[1]/f*Math.max(f,c):0;aa[2]=g?aa[2]/g*Math.max(g,d):0;B.q(B.on,a,aa[0],aa[1],aa[2])};a.apply_velocity_world=function(a,b,c,d){a=a.l.I;
B.q(B.Ec,a);B.q(B.on,a,b,c,d)};a.apply_force=function(a,b,c,d){x(a,b,c,d,aa);a=a.l.I;B.q(B.Ec,a);B.q(B.ys,a,aa[0],aa[1],aa[2])};a.apply_torque=function(a,b,c,d){x(a,b,c,d,aa);a=a.l.I;B.q(B.Ec,a);B.q(B.As,a,aa[0],aa[1],aa[2])};a.set_character_move_dir=function(a,b,c){a=a.l.I;B.q(B.Ec,a);B.q(B.Qs,a,b,c)};a.set_character_move_type=function(a,b){B.q(B.Rs,a.l.I,b)};a.set_character_walk_velocity=function(a,b){B.q(B.Vs,a.l.I,b)};a.set_character_run_velocity=function(a,b){B.q(B.Ts,a.l.I,b)};a.set_character_fly_velocity=
function(a,b){B.q(B.Os,a.l.I,b)};a.character_jump=function(a){B.q(B.Bs,a.l.I)};a.character_rotation_inc=function(a,b,c){B.q(B.Cs,a.l.I,b,c)};a.set_character_rotation=function(a,b,c){B.q(B.Ss,a.l.I,b,c)};a.set_character_rotation_h=function(a,b){B.q(B.Ps,a.l.I,b)};a.set_character_rotation_v=function(a,b){B.q(B.Us,a.l.I,b)};a.QA=function(){return!1};a.PA=function(){return!1};a.check_collision=function(){G.error("check_collision() deprecated");return!1};a.OA=function(){G.error("check_collision_any() deprecated");
return!1};a.check_ray_hit=function(){G.error("check_ray_hit() deprecated");return!1};a.JC=function(){G.error("update_object_coords() deprecated")};a.append_collision_test=function(a,b,c,d){var e=a.l,f=e.I;b=b||"ANY";for(var g=0;g<e.Ic.length;g++){var h=e.Ic[g];if(h.Yb==b&&h.callback==c)return}g=[];a=a.l.I;h=[];v(b,ba,h,null);for(var k=0;k<h.length;k++){var l=h[k];a<l?g.push([a,l]):a>l&&g.push([l,a])}h={Yb:b,callback:c,Lj:g,yq:new Uint8Array(g.length),$l:d||!1};e.Ic.push(h);B.q(B.Ec,f);B.q(B.rs,g,
d)};a.remove_collision_test=function(a,b,c){a=a.l;b=b||"ANY";for(var d=0;d<a.Ic.length;d++){var e=a.Ic[d];if(e.Yb==b&&e.callback==c){a.Ic.splice(d,1);d--;for(var e=e.Lj,f=ba.l.o,g=0;g<f.length;g++)for(var h=f[g].rb,k=0;k<h.Ic.length;k++)for(var l=h.Ic[k],m=0;m<l.Lj.length;m++)for(var n=l.Lj[m],r=0;r<e.length;r++){var x=e[r];n[0]===x[0]&&n[1]===x[1]&&(e.splice(r,1),r--)}e.length&&B.q(B.Ks,e)}}};a.apply_collision_impulse_test=function(a,b){var c=a.l;c?(B.q(B.zs,c.I),c.Wi=b):G.error("Object "+a.name+
" has no physics")};a.clear_collision_impulse_test=function(a){var b=a.l;b?(B.q(B.Es,b.I),b.Wi=null):G.error("Object "+a.name+" has no physics")};a.append_ray_test=function(a,b,c,d,e,f){var g=a.l;if(g){a=g.I;b=b||"ANY";c={N:new Float32Array(c),da:new Float32Array(d),local:e,callback:f,Yb:b,Id:{}};v(b,ba,null,c.Id);delete c.Id[a];for(var h in c.Id)c.Id[h]=1;g.qe.push(c);u(a,g.qe)}else G.error("Object "+a.name+" has no physics")};a.remove_ray_test=function(a,b,c,d,e){if(b=a.l){a=b.I;for(var f=0;f<b.qe.length;f++){var g=
b.qe[f];L.Vi(g.N,c)&&L.Vi(g.da,d)&&g.local==e&&(b.qe.splice(f,1),f--)}u(a,b.qe)}else G.error("Object "+a.name+" has no physics")};a.vehicle_throttle=function(a,b){var c=a.i;c.jg=b;E(a,c)};a.vehicle_steer=function(a,b){var c=a.i;c.Qg=b;E(a,c)};a.vehicle_brake=function(a,b){var c=a.i;c.ph=b;E(a,c)};a.is_vehicle_chassis=q;a.is_vehicle_hull=D;a.Ww=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==
a?!0:!1};a.Vw=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.Zw=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.Mp=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.Lp=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.Np=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.i.speed};a.bA=
function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=l;a.XB=z;a.CB=function(){return 0};a.dv=function(){B.q(B.Fs)};a.Tx=function(a){var b=P.indexOf(a);-1!=b?(P.splice(b,1),a=ca.indexOf(a),-1!=a&&ca.splice(a,1)):G.error("Object ",a.name," doesn't have bounding physics")};a.reset=function(){T.terminate()}};b4w.module.__data=function(a,p){function c(a,b){for(var c=X(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}ka[b.id]=null;eb[b.id]=null}function b(a,b,c){var d;a instanceof ArrayBuffer&&(a=ga.qp(a));d=a.width;a=a.height;pa.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(ta)&&c&&pa.warn("B4W Warning: image",b,"is not from app root.")}function e(a,b,c,d,e,f){d=b.r;if(!d)throw"Nothing requested";R.enqueue([[d,R.AT_JSON,
d]],function(d,f,g,s){if(d){pa.log("%cLOAD METADATA","color: #616",s);f=d.b4w_format_version;if(Number(f)<gb.$p)throw"Incompatible file version: "+f+". Required: "+gb.$p;for(var h in d)a[h]=d[h];(d=a.binaries[0].binfile)?b.Nn=d:(M.cr(b,"load_binaries"),M.cr(b,"prepare_bindata"));if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)pa.error("EXPORT ERROR:",a.b4w_export_errors[d]);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)pa.warn("EXPORT WARNING:",a.b4w_export_warnings[d]);
e(b,c)}else b.Wp(b.id,!1)},null,function(a){f(b,c,a)})}function d(a,b,c,d,e,f){d=ba(b.r)+b.Nn;if(!d)throw"Binary data is missing";R.enqueue([[d,R.AT_ARRAYBUFFER,d]],function(d,f,g,s){d&&(pa.log("%cLOAD BINARY","color: #616",s),a.bin_data=d,e(b,c))},null,function(a){f(b,c,a)})}function g(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],g=a.objects,s=a.meshes;a=a.actions;for(var h=Ea.hu(),l=["indices"],m=["normal","tangent"],n=["color","group"],V=["position","texcoord","texcoord2"],r=0;r<s.length;r++)for(var M=
s[r].submeshes,x=0;x<M.length;x++)for(var q in M[x]){var R=M[x][q][1];if(-1!=l.indexOf(q)){var v=4*M[x][q][0]+f["int"],p=M[x],u=q,A=d;if(h)var N=new Uint32Array(A,v,R);else for(var N=new Uint32Array(R),A=new DataView(A),ma=0;ma<R;ma++)N[ma]=A.getUint32(v+4*ma,!0);p[u]=N}else if(-1!=V.indexOf(q))v=4*M[x][q][0]+f["float"],M[x][q]=k(d,v,R,h);else if(-1!=m.indexOf(q)){v=2*M[x][q][0]+f["short"];p=M[x];u=q;A=d;N=new Float32Array(R);A=new DataView(A);for(ma=0;ma<R;ma++)N[ma]=A.getInt16(v+2*ma,!0)/32767;
p[u]=N}else if(-1!=n.indexOf(q)){v=2*M[x][q][0]+f.ushort;p=M[x];u=q;A=d;N=new Float32Array(R);A=new DataView(A);for(ma=0;ma<R;ma++)N[ma]=A.getUint16(v+2*ma,!0)/65535;p[u]=N}}for(q=0;q<g.length;q++)for(s=g[q].particle_systems,l=0;l<s.length;l++)m=s[l],m.transforms=k(d,4*m.transforms[0]+f["float"],m.transforms[1],h);for(g=0;g<a.length;g++){q=a[g];var s=q.fcurves,m=q.frame_range,l=m[0],m=m[1],n=ja.ew(l,m),V=null,M=r=!1,z;for(z in s)r|=-1<z.indexOf("rotation_euler"),M|=-1<z.indexOf("rotation_quaternion");
for(z in s)if(r&&M&&-1<z.indexOf("rotation_euler"))delete s[z];else{var x=s[z],I;for(I in x)R=x[I],v=k(d,f["float"]+4*R.bin_data_pos[0],R.bin_data_pos[1],h),p=new Float32Array(n),null===V&&(V=new Int8Array(n)),ja.Jt(R,v,p,V,l,m),R.Xb=p;-1<z.indexOf("rotation_euler")&&ja.Cv(s,z)}q.ft=V}e(b,c)}function k(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function f(a,b,c,d,e){var f=a.cameras,g=a.groups,s=a.materials,
h=a.meshes,k=a.node_groups,l=a.objects,m=a.particles,n=a.scenes,r=a.speakers,M=a.textures,q=a.worlds;k||(pa.warn('B4W Warning: "node_groups" datablock undefined. reexport main scene.'),k=a.node_groups=[]);for(var R="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),p={},u=0;u<R.length;u++)for(var A=a[R[u]],N=0;N<A.length;N++){var z=A[N];p[z.uuid]=z}for(var I=0;I<n.length;I++){for(var t=n[I],w=t.objects,
F=0;F<w.length;F++)v(w,F,p);t.camera&&v(t,"camera",p);t.world&&v(t,"world",p)}for(I=0;I<g.length;I++)for(var Y=g[I].objects,F=0;F<Y.length;F++)v(Y,F,p);for(I=0;I<l.length;I++){var y=l[I];y.dupli_group&&v(y,"dupli_group",p);y.parent&&v(y,"parent",p);if(y.animation_data){var Q=y.animation_data;Q.action&&v(Q,"action",p);if(Q.nla_tracks)for(F=0;F<Q.nla_tracks.length;F++)for(var E=Q.nla_tracks[F],D=0;D<E.strips.length;D++)E.strips[D].action&&v(E.strips[D],"action",p)}switch(y.type){case "MESH":if(!y.data)throw"mesh not found for object "+
y.name;v(y,"data",p);for(var G=y.modifiers,F=0;F<G.length;F++){var ea=G[F];"ARMATURE"==ea.type?v(ea,"object",p):"CURVE"==ea.type&&v(ea,"object",p)}var U=y.particle_systems;if(U)for(F=0;F<U.length;F++)v(U[F],"settings",p);break;case "ARMATURE":v(y,"data",p);for(var K=y.pose.bones,Ba=y.data.bones,F=0;F<K.length;F++){var ga=K[F];ga.bone=Ba[ga.bone];for(var S=ga.parent_recursive,D=0;D<S.length;D++)S[D]=K[S[D]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":v(y,"data",p)}var H=y.constraints;
if(H)for(F=0;F<H.length;F++){var ia=H[F];ia.target&&v(ia,"target",p)}var T=y.lod_levels;if(T)for(F=0;F<T.length;F++){var L=T[F];L.object&&v(L,"object",p)}}for(I=0;I<h.length;I++)for(var J=h[I].materials,F=0;F<J.length;F++)v(J,F,p);for(I=0;I<s.length;I++){for(var P=s[I],va=P.texture_slots,F=0;F<va.length;F++)v(va[F],"texture",p);var qa=P.node_tree;qa&&x(qa,p)}for(I=0;I<k.length;I++)(qa=k[I].node_tree)&&x(qa,p);for(I=0;I<M.length;I++){var ba=M[I],C=ba.type;"IMAGE"!=C&&"ENVIRONMENT_MAP"!=C||v(ba,"image",
p)}for(I=0;I<f.length;I++){var eb=f[I];eb.dof_object&&v(eb,"dof_object",p)}for(I=0;I<r.length;I++){var ka=r[I];ka.sound&&v(ka,"sound",p);if(ka.animation_data&&(Q=ka.animation_data,Q.action&&v(Q,"action",p),Q.nla_tracks))for(F=0;F<Q.nla_tracks.length;F++)for(E=Q.nla_tracks[F],D=0;D<E.strips.length;D++)E.strips[D].action&&v(E.strips[D],"action",p)}for(I=0;I<m.length;I++){for(var ca=m[I],va=ca.texture_slots,F=0;F<va.length;F++)v(va[F],"texture",p);ca.dupli_group&&v(ca,"dupli_group",p);ca.dupli_object&&
v(ca,"dupli_object",p)}for(I=0;I<q.length;I++)if(va=q[I].texture_slots)for(F=0;F<va.length;F++)v(va[F],"texture",p);na.gu(a);wa=0===b.id;Ca||(Ca=a.scenes[0]);for(var Z=a.textures,W=wa?a.scenes[0].b4w_anisotropic_filtering:Ca.b4w_anisotropic_filtering,ta=0;ta<Z.length;ta++)wa||"SCENE"!=Z[ta].b4w_source_type||(Z[ta].b4w_source_id=""),Za.Vu(Z[ta],W,a.scenes);for(var Qa={},La=a.objects,Hb=0;Hb<La.length;Hb++){var Ib=La[Hb];if("MESH"===Ib.type&&!Ib.particle_systems.length)for(var Jb=Ib.data,Qb=Jb.name,
Kb=Jb.submeshes,Xb=Jb.materials,Fa=0;Fa<Kb.length;Fa++)0!==Kb[Fa].base_length||Qa[Qb]||(Xb[Fa]&&pa.warn('B4W Warning: material "'+Xb[Fa].name+'" is not assigned to any face (object "'+Ib.name+'").'),Qa[Qb]=!0)}for(var ra=a.meshes,fa=0;fa<ra.length;fa++){var bc=ra[fa];bc.materials.length||bc.uv_textures.length&&pa.warn('B4W Warning: mesh "'+bc.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,
alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,
b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});for(var Ha=a.meshes,wb=Ea.keysearch("name","DEFAULT",a.materials),
Ja=0;Ja<Ha.length;Ja++){var kb=Ha[Ja];0==kb.materials.length&&kb.materials.push(wb)}for(var mb=a.actions,nb=b.id,Tb=0;Tb<mb.length;Tb++){var $b=mb[Tb];$b.ht=nb;ja.rt($b)}for(var jb=a.scenes,Db=0;Db<jb.length;Db++){for(var wc=jb[Db],xc=la.Qk(wc,"ALL"),nc=[],ac=0;ac<xc.length;ac++)for(var oc=xc[ac].particle_systems,Rb=0;Rb<oc.length;Rb++){var qb=oc[Rb].settings;if("HAIR"==qb.type)if("OBJECT"==qb.render_type)V.Sm(qb.dupli_object,!0);else if("GROUP"==qb.render_type){for(var Eb=qb.dupli_group,fc=la.Qk(wc,
"EMPTY"),tb=0;tb<fc.length;tb++)fc[tb].dupli_group==Eb&&nc.push(fc[tb]);for(tb=0;tb<Eb.objects.length;tb++)V.Sm(Eb.objects[tb],!0)}else pa.warn("B4W Warning: render type",qb.render_type,"not supported for particle systems ("+qb.name+").")}for(ac=0;ac<nc.length;ac++)O(nc[ac],[wc])}aa(a,b.id);for(var Kc=a.scenes,yc=0;yc<Kc.length;yc++){for(var md=Kc[yc],Lc=[],zc=[],Fc=Kc[yc].objects,Fb=0;Fb<Fc.length;Fb++){var Zc=Fc[Fb];B(Fc,Zc,Lc,zc);var Gc=Zc.dupli_group;if(Gc)for(var Mc=Gc.objects,Ac=0;Ac<Mc.length;Ac++)B(Mc,
Mc[Ac],Lc,zc)}for(Fb=0;Fb<zc.length;Fb++)O(zc[Fb],[md]);for(Fb=0;Fb<Lc.length;Fb++)Ea.Ft(Lc[Fb][0],Lc[Fb][1])}aa(a,b.id);var db=X(a,b.id);na.Nt(db,a.scenes);for(ta=0;ta<db.length;ta++){var gc=db[ta];!wa&&gc.parent&&-1<Lb.indexOf(gc.parent.type)&&(gc.parent="");V.Sm(gc,!1);gc.d.sd=b.id}for(var Nc=0;Nc<db.length;Nc++){var Hc=db[Nc];if("MESH"==Hc.type){var Oc=ja.get_first_armature_object(Hc);if(Oc){var Pc=Oc.d;if(Pc.Vd){var Qc=Hc.d.nc,Rc=[],$c;for($c in Qc){var Sc=Qc[$c];Rc.push(4*Sc.wh,4*Sc.Sn)}Pc.Zp.push(Rc)}Pc.Yj.push(Hc.d)}}}for(var fd=
-1,pc=0;pc<db.length;pc++){var Sb=db[pc],qc=Sb.d;if(Ea.is_mesh(Sb)&&qc.Nh){var rc=qc.max_bones;rc>fd&&(fd=rc)}}for(pc=0;pc<db.length;pc++)if(Sb=db[pc],qc=Sb.d,Ea.is_mesh(Sb)&&qc.Nh){qc.max_bones=fd;var ad=Sb,Bc=qc.max_bones,bd=gb.max_bones,Tc=ad.d;Bc>2*bd?Ea.fa('B4W Error: too many bones for "'+ad.name+'"'):Bc>bd?(pa.warn('B4W Warning: too many bones for "'+ad.name+'" / '+Bc+" bones (max "+bd+"). Blending between frames will be disabled."),Tc.Dh=!1):Tc.Dh=!0;Tc.Dh=Tc.Dh&&!sa.$o}for(var cd=0;cd<db.length;cd++){var Yb=
db[cd];if(Ea.is_mesh(Yb)){var pd=Yb.lod_levels.length;if(pd)for(var ed=Yb,Cc=0;Cc<pd;Cc++){var Ic=Yb.lod_levels[Cc].object;if(!Ic){ed.d.zj=!0;ed.d.le=Yb.lod_levels[Cc].distance;break}Ic.d.wf=Yb.d.wf;ed.d.le=Yb.lod_levels[Cc].distance;Ic.d.Rh=Yb.lod_levels[Cc].distance;if(Yb.lod_levels[Cc+1])Ic.d.le=Yb.lod_levels[Cc+1].distance;else{Ic.d.zj=!0;Ic.d.le=1E4;break}ed.d.zj=!1;ed=Ic}}}for(var ld=0;ld<db.length;ld++){var ha=db[ld];if(ha.b4w_vehicle){var Ya=ha.b4w_vehicle_settings;if("CHASSIS"==Ya.part){ha.i=
{};ha.i.Zo=Ya.force_max;ha.i.Tn=Ya.brake_max;ha.i.iz=Ya.suspension_compression;ha.i.kz=Ya.suspension_stiffness;ha.i.jz=Ya.suspension_damping;ha.i.aA=Ya.wheel_friction;ha.i.rC=Ya.roll_influence;ha.i.nx=Ya.max_suspension_travel_cm;ha.i.jg=0;ha.i.ph=1;ha.i.Qg=0;ha.i.speed=0;ha.i.If=[];ha.i.bi=[];ha.i.Rg=null;for(var qd=ha.Jb?ha.Jb.dupli_group.objects:db,Uc=0;Uc<qd.length;Uc++){var Na=qd[Uc];if(Na.b4w_vehicle){var fb=Na.b4w_vehicle_settings;if(ma.Ww(Na)&&Ya.name==fb.name){var rd=ma.bA(Na.b4w_vehicle_settings.part);
ha.i.If[rd]=Na;ha.i.bi[rd]=new Float32Array(8)}else if(ma.Mp(Na)&&Ya.name==fb.name){ha.i.Rg=Na;ha.i.Fm=fb.steering_max;ha.i.mr=fb.steering_ratio;ha.i.Ip=fb.inverse_control;var ub=lb.invert(ha.d.K,new Float32Array(16)),gd=lb.multiply(ub,Na.d.K,ub);ha.i.or=gd;var Vc=new Float32Array([1,0,0,0]);vb.transformMat4(Vc,gd,Vc);ha.i.nr=Vc}else if(ma.Lp(Na)&&Ya.name==fb.name){ha.i.Cm=Na;ha.i.hr=fb.speed_ratio;ha.i.Wl=fb.max_speed_angle;var ub=lb.invert(ha.d.K,new Float32Array(16)),hd=lb.multiply(ub,Na.d.K,ub);
ha.i.jr=hd;var Wc=new Float32Array([1,0,0,0]);vb.transformMat4(Wc,hd,Wc);ha.i.ir=Wc}else if(ma.Np(Na)&&Ya.name==fb.name){ha.i.Im=Na;ha.i.Go=fb.delta_tach_angle;var ub=lb.invert(ha.d.K,new Float32Array(16)),id=lb.multiply(ub,Na.d.K,ub);ha.i.wr=id;var Xc=new Float32Array([1,0,0,0]);vb.transformMat4(Xc,id,Xc);ha.i.vr=Xc}}}if(4!=ha.i.If.length)throw"Not enough wheels for chassis "+ha.name;}else if("HULL"==Ya.part){ha.i={};ha.i.If=[];ha.i.bi=[];ha.i.Zo=Ya.force_max;ha.i.Tn=Ya.brake_max;ha.i.jl=Ya.floating_factor;
ha.i.$m=Ya.water_lin_damp;ha.i.an=Ya.water_rot_damp;ha.i.jg=0;ha.i.ph=1;ha.i.Qg=0;ha.i.speed=0;ha.i.Rg=null;for(var sd=ha.Jb?ha.Jb.dupli_group.objects:db,Uc=0;Uc<sd.length;Uc++)Na=sd[Uc],Na.b4w_vehicle&&(fb=Na.b4w_vehicle_settings,ma.Vw(Na)&&Ya.name==fb.name?(ha.i.If.push(Na),ha.i.bi.push(new Float32Array(8))):ma.Mp(Na)&&Ya.name==fb.name?(ha.i.Rg=Na,ha.i.Fm=fb.steering_max,ha.i.mr=fb.steering_ratio,ha.i.Ip=fb.inverse_control,ub=lb.invert(ha.d.K,new Float32Array(16)),gd=lb.multiply(ub,Na.d.K,ub),ha.i.or=
gd,Vc=new Float32Array([1,0,0,0]),vb.transformMat4(Vc,gd,Vc),ha.i.nr=Vc):ma.Lp(Na)&&Ya.name==fb.name?(ha.i.Cm=Na,ha.i.hr=fb.speed_ratio,ha.i.Wl=fb.max_speed_angle,ub=lb.invert(ha.d.K,new Float32Array(16)),hd=lb.multiply(ub,Na.d.K,ub),ha.i.jr=hd,Wc=new Float32Array([1,0,0,0]),vb.transformMat4(Wc,hd,Wc),ha.i.ir=Wc):ma.Np(Na)&&Ya.name==fb.name&&(ha.i.Im=Na,ha.i.Go=fb.delta_tach_angle,ub=lb.invert(ha.d.K,new Float32Array(16)),id=lb.multiply(ub,Na.d.K,ub),ha.i.wr=id,Xc=new Float32Array([1,0,0,0]),vb.transformMat4(Xc,
id,Xc),ha.i.vr=Xc))}}}for(var nd=0;nd<db.length;nd++){var sc=db[nd];if(sc.b4w_floating){var jd=sc.b4w_floating_settings;if("MAIN_BODY"==jd.part){sc.vc={};sc.vc.jl=jd.floating_factor;sc.vc.$m=jd.water_lin_damp;sc.vc.an=jd.water_rot_damp;sc.vc.Oi=[];for(var td=sc.Jb?sc.Jb.dupli_group.objects:db,od=0;od<td.length;od++){var dd=td[od];if(dd.b4w_floating){var ud=dd.b4w_floating_settings;ma.Zw(dd)&&jd.name==ud.name&&(sc.vc.Oi.push(dd),dd.Xt=dd.b4w_floating_settings.synchronize_position)}}}}}e(b,c)}function m(a,
b,c,d,e){!wa&&1<a.scenes.length&&(a.scenes=[a.scenes[0]],pa.warn("B4W Warning: loading data contains multiple scenes.","Only the first one will be loaded."));-1==sa.za&&wa&&(sa.za=a.scenes[0].fps);for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];if(wa&&!f.camera)throw"Scene check failed: No camera";for(var g=la.Qk(f,"MESH"),s=0;s<g.length;s++){var h=g[s],k=na.Ht(h);k&&(a.meshes.push(k),h.data=k)}for(var s=X(a,b.id),h=a.meshes,k=h.slice(0),l=0;l<s.length;l++){var m=s[l];"MESH"==m.type&&(m=k.indexOf(m.data),
-1<m&&k.splice(m,1))}for(l=0;l<k.length;l++)h.splice(h.indexOf(k[l]),1);wa?(la.wt(f,a.textures),f.d.eh.length&&(b.El=!0),wb.enabled&&f.b4w_enable_physics&&ma.Gn(f),f.b4w_enable_audio&&Ba.Hn(f),s=la.ul(f),h=f.b4w_batch_grid_size):(la.Ct(f,Ca,a.textures),wb.enabled&&f.b4w_enable_physics&&!Ca.l&&ma.Gn(Ca),f.b4w_enable_audio&&!Ca.h&&Ba.Hn(Ca),s=la.ul(Ca),h=Ca.b4w_batch_grid_size);g=N.Wv(s,h,g,f.world,Ca.d.Op);wa?(la.yn(f,g),la.Qv(s)):la.yn(Ca,g)}d=a.materials;if(Fa.$k&&gb.Hr)for(a=0;a<d.length;a++){f=
d[a];h=f.texture_slots;for(g=0;g<h.length;g++)if(k=h[g],l=k.texture,"IMAGE"==l.type||"ENVIRONMENT_MAP"==l.type)s=l.image,s.Wb||(-1<s.filepath.indexOf(".dds")?s.Wb=!0:(s.Wb=!l.b4w_disable_compression&&!k.use_map_normal&&"ENVIRONMENT_MAP"!=l.type&&!l.b4w_shore_dist_map&&"MOVIE"!=s.source,s.Wb&&(s.filepath+=".dds")));if(g=f.node_tree)for(h=g.nodes,g=0;g<h.length;g++)s=h[g],"TEXTURE"==s.type&&((k=s.texture)?(s=k.image)&&!s.Wb&&(s.Wb=k.d.Gi&&!k.b4w_disable_compression&&"MOVIE"!=s.source,s.Wb&&(s.filepath+=
".dds")):pa.warn("B4W Warning: material ",f.name," has empty textures."))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],f.Wb=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));e(b,c)}function h(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},g={},s={},h={},k=0;k<d.length;k++){var l=d[k];f[l.uuid]=l;s[l.uuid]=l}for(k=0;k<a.length;k++)l=a[k],g[l.uuid]=l,h[l.uuid]=l;r(a,null,h,s);for(var m in s)m in f||d.push(s[m]);for(m in h)m in g||a.push(h[m]);e(b,c)}function r(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=
a[f],h=c[g.uuid];if(g=h.proxy){b&&-1==e.indexOf(g.uuid)&&e.push(g.uuid);for(var k=c[g.uuid],l=k.constraints,g=0;g<l.length;g++){var m=Ea.We(l[g]);m.name+="_CLONE";h.constraints.push(m)}"b4w_proxy_inherit_anim"in h&&!h.b4w_proxy_inherit_anim||(h.animation_data&&(k.animation_data=Ea.We(h.animation_data)),k.b4w_use_default_animation=h.b4w_use_default_animation,k.b4w_auto_skel_anim=h.b4w_auto_skel_anim,k.b4w_anim_behavior=h.b4w_anim_behavior,k.b4w_cyclic_animation=h.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)h=
Ea.vl(a,"uuid",e[f]),-1<h&&a.splice(h,1);e={};for(f=0;f<a.length;f++)g=a[f],h=c[g.uuid],b&&(l=Ea.We(h),h="origin_name"in h?h.origin_name:h.name,l.name=b+"*"+h,l.origin_name=h,n(l),c[l.uuid]=l,e[g.uuid]=l.uuid,g.uuid=l.uuid),h=c[g.uuid],h.dupli_group&&(g=h.dupli_group,l=d[g.uuid],k=Ea.We(l),k.name=Ea.gk(l.name+"_CLONE"),k.uuid=s.Bp("Group"+k.name),d[k.uuid]=k,g.uuid=k.uuid,r(k.objects,h.name,c,d));if(b)for(f=0;f<a.length;f++){g=a[f];h=c[g.uuid];h.parent&&h.parent.uuid in e?h.parent.uuid=e[h.parent.uuid]:
h.parent&&(pa.warn("B4W Warning: Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),h.parent=null);l=h.constraints;for(g=0;g<l.length;g++)b=l[g],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=h.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(g=0;g<h.length;g++)b=h[g],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var V in e)ra[V]=e[V]}function n(a){a.uuid=
s.Bp("Object"+a.name)}function x(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&v(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in ra&&(e.lamp.uuid=ra[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&v(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var f=e[d];u(f,"from_node",c);u(f,"to_node",c);E(f,"from_socket",f.from_node.outputs);E(f,"to_socket",f.to_node.inputs)}if(c=a.animation_data)if(c.action&&v(c,"action",b),c.nla_tracks)for(d=
0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],f=0;f<e.strips.length;f++)e.strips[f].action&&v(e.strips[f],"action",b)}function v(a,b,c){(c=c[a[b].uuid])||pa.error("Dangling link found:",b,a);a[b]=c}function u(a,b,c){c=Ea.keysearch("name",a[b].name,c);a[b]=c}function E(a,b,c){c=Ea.keysearch("identifier",a[b].identifier,c);a[b]=c}function q(a,c,d,e,f,g){if(!gb.do_not_load_resources){for(var s=ba(c.r),h=a.images,k={},l=[],m=0;m<h.length;m++){var n=h[m],V=n.uuid;if("FILE"===n.source||"MOVIE"===n.source){var r=
D(n,a.textures);if(!r.length)pa.warn("B4W Warning: image ",n.name," has no users.");else if(!(r[0].b4w_shore_dist_map||"MOVIE"===n.source&&gb.Vo)){r=ca(s+n.filepath);if("FILE"===n.source){var M=n.Wb?R.AT_ARRAYBUFFER:R.AT_IMAGE_ELEMENT;Fa.Xl&&gb.jk&&(r=R.mi(r),"dds"==r[1]?(r=R.mi(r[0]),r=r[0]+".min50."+r[1]+".dds"):r=r[0]+".min50."+r[1])}else"MOVIE"===n.source&&(gb.Cc?(r=R.mi(r),r=r[0]+".altconv.seq",M=R.yi):(r=R.mi(r),M=Ba.detect_video_container(r[1]),r=M!=r[1]?r[0]+".altconv."+M:r[0]+"."+M,M=R.zi));
l.push([V,M,r]);k[V]=n}}}l.length?(e.Cp=0,R.enqueue(l,function(f,s,h,m){if(f){if(h==R.zi||h==R.yi){if(h==R.zi)var n=f.videoWidth,V=f.videoHeight;else n=f.images[0].width,V=f.images[0].height;pa.log("%cLOAD VIDEO "+n+"x"+V,"color: #"+(2048<n||2048<V?"a00":1024<n||1024<V?"aa0":"0a0"),m);-1==m.indexOf(ta)&&pa.warn("B4W Warning: video",m,"is not from app root.")}else b(f,m,!0);s=k[s];m=D(s,a.textures);for(n=0;n<m.length;n++){var V=m[n],r=V.image.filepath;h==R.yi?(V.d.Sq=f.Ob,Za.qi(V.d,f.images,s.Wb,r)):
Za.qi(V.d,f,s.Wb,r)}}f=++e.Cp/l.length;g(c,d,f)},function(){pa.log("%cLOADED ALL IMAGES","color: #0a0");f(c,d)})):f(c,d)}}function D(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function l(a,b,c,d,e,f){if(!gb.do_not_load_resources){a=X(a,b.id);for(var g=ba(b.r),s=[],h={},k=0;k<a.length;k++){var l=a[k];if(z(l)){var m=l.data.sound,n=m.uuid;"BACKGROUND_MUSIC"==Ba.xl(l)?(n=Ea.Pv(),b.Dl=!0):"NONE"!=Ba.xl(l)&&gb.Fp&&(b.Gl=!0);if(!(n in h)){h[n]=[];m=ca(g+m.filepath);
switch(Ba.fr(l)){case Ba.ok:var V=R.AT_AUDIOBUFFER;break;case Ba.dn:V=R.AT_AUDIO_ELEMENT}var m=R.mi(m),r=Ba.detect_audio_container(m[1]),m=r!=m[1]?m[0]+".altconv."+r:m[0]+"."+r;s.push([n,V,m])}h[n].push(l)}}s.length?R.enqueue(s,function(a,e,g,k){if(a)for(pa.log("%cLOAD SOUND","color: #0aa",k),-1==k.indexOf(ta)&&pa.warn("B4W Warning: sound",k,"is not from app root."),e=h[e],g=0;g<e.length;g++)Ba.Jz(e[g],a);a=++d.Oy/s.length;f(b,c,a)},function(){pa.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)}):
e(b,c)}}function z(a){return Ba.Fd(a)&&Ba.fr(a)!=Ba.en?!0:!1}function A(a,b){for(var c=la.Da(a,"SPEAKER",la.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];Ba.Fd(e)&&(Ba.is_cyclic(e)||b)&&Ba.play_def(e)}}function G(a){a=a.d.eh;for(var b=0;b<a.length;b++)gb.Cc&&a[b].use_auto_refresh?a[b].d.Gg=!0:a[b].d.Xa&&a[b].use_auto_refresh&&a[b].d.Xa.play()}function t(a,b,c,d,e){Q.start();pa.log("%cSTART NLA","color: #0a0");e(b,c)}function B(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,
f=0;f<e;f++){var g=b.lod_levels[f],s=g.object;if(s){var h=Ea.sh(s);h.name=b.name+"_LOD_"+String(f+1);n(h);h.lod_levels=[];c.push([a,h]);d.push(s);g.object=h}}}function O(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=f.objects,g=f.indexOf(a),-1<g&&f.splice(g,1))}var g=d.indexOf(a);-1<g&&d.splice(g,1)}}function y(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d],g=wa?f.b4w_enable_physics:Ca.b4w_enable_physics||f.b4w_enable_physics;
wa||(f=Ca);for(var s=0;s<mb.length;s++)for(var h=la.Da(f,mb[s],la.DATA_ID_ALL),k=0;k<h.length;k++){var l=h[k];l.d.sd==b.id&&wb.enabled&&g&&(ma.append_object(l,f),b.Vp&&ma.has_physics(l)&&ma.disable_simulation(l))}}e(b,c)}function H(a,c,d,e,f){var g={};e=[];for(var s=a.scenes,h=0;h<a.scenes.length;h++){var k=s[h];if(k.d.La&&(k=k.d.La.Xj)&&"FILE"===k.source){var l=k.uuid,m=ca(ba(c.r)+k.filepath);e.push([l,k.Wb?R.AT_ARRAYBUFFER:R.AT_IMAGE_ELEMENT,m]);g[l]=k}}e.length?R.enqueue(e,function(c,d,e,f){if(c){b(c,
f,!0);d=g[d];f=D(d,a.textures);for(e=0;e<f.length;e++){var h=f[e];Za.qi(h.d,c,d.Wb,h.image.filepath)}for(e=0;e<s.length;e++)if(f=s[e],f.d.La.Xj===d){var k=c,l=d,m=document.createElement("canvas"),h=l.size[0],l=l.size[1];m.width=h;m.height=l;m=m.getContext("2d");m.drawImage(k,0,0);k=m.getImageData(0,0,h,l).data;m=new Float32Array(4);m[0]=1/16581375;m[1]=1/65025;m[2]=1/255;m[3]=1;for(var h=h*l,l=new Float32Array(h),n=0;n<h;n++)l[n]=m[1]*k[4*n+2]+m[2]*k[4*n+3];f.d.vm=l}}},function(){f(c,d)}):f(c,d)}
function L(a,c,d,e,f){if(gb.antialiasing&&gb.smaa){e=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],s=0;s<g.length;s++){var h=la.ka(e,g[s]);h&&a.push(h)}if(a.length){e=[];s=R.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",s,I.Qb.smaa_search_texture_path]);e.push(["AREA_TEXTURE",s,I.Qb.smaa_area_texture_path]);for(s=0;s<a.length;s++)if(g=a[s],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.ca;for(s=0;s<a.length;s++)if(g=
a[s],"u_search_tex"==g.da)var k=g.ga;else if("u_area_tex"==g.da)var l=g.ga;break}e.length?R.enqueue(e,function(a,c,d,e){a&&(b(a,e,!1),c="SEARCH_TEXTURE"==c?k:l,c.source="IMAGE",c.Ln=!0,Za.qi(c,a,-1!=e.indexOf(".dds")?1:0,e),Za.sm(c,Za.B,Za.B))},function(){f(c,d)}):f(c,d)}else f(c,d)}else f(c,d)}function Z(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];wa||(e=Ca);for(var f=la.Da(e,"ALL",la.DATA_ID_ALL),g=0;g<f.length;g++){var s=f[g];s.d.sd==b.id&&(b.Vp&&Ea.is_mesh(s)&&la.hide_object(s),
d.zn.push({fy:e,obj:s}))}}}function J(a,b,c,d,e,f){a=d.zn;var g=d.gq;a.length?(e=a[g].obj,g=a[g].fy,la.append_object(g,e),-1!=Tb.indexOf(e.type)&&g.b4w_enable_audio&&Ba.append_object(e,g),d=++d.gq/a.length):d=1;f(b,c,d)}function F(a,b,c,d,e){if(wa){d=la.uw();for(var f=d[d.length-1],g=0;g<d.length;g++){var s=d[g];la.My(s);la.Iz(s);la.Ix(s,f);s.b4w_use_nla&&Q.Fz(s,s.b4w_nla_cyclic)}la.set_active(f)}else la.Gr(Ca);a=X(a,b.id);V.Dz(a);e(b,c)}function U(a,b,c,d,e){if(wa)for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||
G(a.scenes[d]),A(a.scenes[d]);else a.scenes[0].b4w_use_nla||G(Ca),A(Ca);e(b,c)}function K(a,b,c,d,e){gb.nf&&(b.El||b.Dl||b.Gl)?Ha||S(a,e,b,c):e(b,c)}function S(a,b,c,d){var e=nb.canvas.parentElement;kb=e.style.zIndex;e.style.zIndex="999";Ha=document.createElement("div");Ha.style.position="relative";Ha.style.height="88px";Ha.style.width="88px";var f=Math.round(nb.canvas.offsetWidth/2-44);Ha.style.top=Math.round(nb.canvas.offsetHeight/2-44).toString()+"px";Ha.style.left=f.toString()+"px";Ha.style.backgroundImage=
"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAYAAABxlTA0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAhOSURBVHic7Z1tjFxVGcd/z1AKsbzotoW0IQqFhpSXFlugxbbGRkNSLJEQLVJttH7VEl8+oCYYExLFDxilJib6AWshtlterN20hkBKsNitpFVapB9YIzGBWEq3+IKCLf374Tx3587szGxn5577Mt1fcnN37r1zznP+c/a55557znOMkiDJgLnAADDT9+ktOQYwChwHTvh+tGl7zcyUp/3tsCIzlzQdWAwsA24CLs4o6X8ALwDDwEEz+19G6XZN7gJLugi4mSDqh4HzUqffBN6gXkPT++RvaKzhM5v2lwCzUmm+C/yRIPYfzOyfMcrVjlwE9n//lcAngQVALXV6hFD435vZ3zLK74PARwg/4lWpU6eBI8Au4Lk83Eh0gSUtBDYA8/3QaeAlYB8wbGbHIuc/myD0LcB11H/cEeBhM3sxZv7RBJZ0OfBF4EY/9CawDdhrZv+Kle8ENl0IrADuou5GDhKE/muMPDMXWNIs4PPAxz39t4FBYGeRN5s0fnO9HVgLzAAE7AG2ZP0flZnAkmrAOuBOYDpwEhgCBouqsRPhNXotsAY4l2DzDoLQ72WRRyYCS7oAuJfQKohWG2Lhfno9sIqgySHg+6WoGJIuk/QzSUOSHpF0TdE2TRZJ13gZhiT93FsjhRq0RNI2N2iTpEsKNSgDJM2S9GMv06CkGyf+Vnsm7SIk3QF8idDs2Qc8aGbv9GJMWZB0HvBVQttdhFbGE5NJq2uBJU0DvgJ8wg9tBR4ty7N /lkhaS/DNBjwDbDKzU7Ez/bL/+zwh6aNRMysBkpZK2u5l/lrszNZ4Ro9LujpqZiVC0ryUyHfGyuQGSTsk7ZS0PEomJcZr8k7ferrxtUp8rqSt/guuyzTxCiFpbap1cUZNuNpEF0iaAXwHuAB4HvhVb2ZWFzMbBH4HvA+4z58EO9JRYH/8vRe4DPgL8MN+bC10yY8IWswBviXpnE4XT1SDP0d44/AWcL+ZvZuJiRXGNbifoMlCQjOueyTNlvSk+5zrMrSxL/DH6p2u0ex213WqwesJPUzPm9lLmVtYcczsZUKn1rl0qMUtBZZ0BaFn6RSwOYaBfcIWQhfnKtdsHO1q8AbC4+Fvzez1SMZVHu+OHSJotaHVNeMElrSIcGP7L6GfIRqSdklaEDOPHBgkvLVZ7No10CCwv/1NfonHzeytyMatBg5JekjSwIRXlxDvlB/0jxtcw9ZIWumthl9KOj+2cWrkuKSN3ltXKSRNl/QL125l+lyzi7jV91sL6NsdAB4i1OjVOefdE/4yd5t/vDV9bkxgfyS+HngPeC4368azANhVQf+8lzDm43rXEmiswUuAacCfzezfORvXikr5Z/fFLxM0vCk5nhb4Ft8P52jXREwDNgKvVMQ/J9olWgaB3fAlfmx/zkadCVXxz4nAS3xwy1gNXkjognvVzI4WYdkZUmr/bGZ/B14FzgdugLrAy3xfJvfQiTL750TDZQA1bxgvbTpZBcrqnxMXu1SS1QijDGcCo2Y2Upxdk6Zs/nmEMFj8YmBOjSAuQNU7dUrhn/2NT6LlzBqNE0v6gTL450TLvhQYivfPiZYD/SpwQlH++awROCFv/9wgcHKTO97m4n4iL/+caHnW1OA0efjnlje5s6EGp4npnxtq8BQRqZGqzkUaUgCjwD3AQjPbnXHaiZajaYHL1mkSi1PAJmC+mcUasT7mdqdxdtXg3cA3zOxI5HwSLU+kBe7nGnyEIGzWrqAdYzW4RuqOl1PmeRLTz3 ZirOnbrzX4FPBT4LtmVkT7vq8FzsvPdqKlwHMLMiYr8vaznUi0PF4DjhH88ICkq9p/p7QU5Wdb4hoOEOIGvV7zHvix90iFWdY9ebRnJ0PyAnm/mSl5VB5uOll2dhNq7D0F3cQ60fCGPhH4EPAf4IqSz5g/AtxmZrcVfBNriaRLgcuBd4A/gQvs/14H/LoyuolS+dkOJNodSMLnpHvT9vm+TG6irH62HYl2iZakO5sPEAp0raQZZvZ2npa1oAzt2TPGZ31eS9DwheT4WA12QQ8TRF+Rt4EpSu1nO7AcOAc4nK6czR3uT/n+7mR0YI5Uxc+Ow7X6rH98Kn2uWeC9hKE/s4BPxTcNqJ6fbcXtBM1GCBq2R9Ki1JT9i2JaVfQwpyyQdKHqgaE6T+MC8FiOBwnjhe+OaVwF/WwrkuiBB1vFwWz30vNhQrSl1ZLmRDSu0vgk8DV4ZKpW17QU2ANl7iG0KL4Qy8A+IJkwv6ddcNFOr+2Tic4rpsIZjEchwuEqgkZb2l3XVmCf6Pykf/ymQlTVKRhzDd8mTALf0SlG50QDTx4hhOd+PyFGTd5t49KhEBXwPoImhwkataWjwGZ2GngAeA24EogbmK3k+HyWrwPzgKPA9zJptytEWE3aenf1nGBFkbTONdgu6UNZJ75Y0m88Tk0ZuzSjImm56oHp4pRf0h3+Cz4maV6UTEqIpCu9zEOSPtPNd7saXWlmvwaeJsxk/IGkm7v5fhXxMj5AKPOzZra9m+/3Gt5WwGYze6zbdKqApE8THrSS8LY/MbOT3aSRVYDmPYTYuqVYZaBXvDm6kfAg0VOA5l4NSYcYf7CE84a7RtKAlyWTEONZGJQOkr9ZFY4rLOlqL0NmQfJjLfPwLGGZhzeySD82PlRhPfAxMl7mYWqhkiosVJJGU0vtNJDnYlHHgEcJi0UVshyEQiy4FYSwvUnE1GotFtWMxi93dhJ4kTDgcH/ssWXeslnq2yKCK4CqL3eWRu0X7BPwC mGg3HDGC/Yt820+9XL234J9zajzkpNHCcEsTlBfZvJE02eoLzf5Ad/Sn+cCl6bS7P8lJ9uhqUVT80N9uuzv/wFReZvk3/McjgAAAABJRU5ErkJggg==')";
Ja=document.createElement("div");Ja.style.position="relative";Ja.style.height=nb.canvas.offsetHeight.toString()+"px";Ja.style.width=nb.canvas.offsetWidth.toString()+"px";Ja.style.background="rgba(0, 0, 0, 0.5)";Ja.style.zIndex="999";e.appendChild(Ja);Ja.appendChild(Ha);Ha.addEventListener("click",function(){c.El&&(Za.play(),Za.pause(),Za.reset());if(c.Dl){if(wa)for(var e=0;e<a.scenes.length;e++)A(a.scenes[e],!0);else A(Ca,!0);Ba.pause()}c.Gl&&Ba.Ex();T();b(c,d)},!1)}function T(){if(Ha){var a=nb.canvas.parentElement;
a.style.zIndex=kb;Ja.removeChild(Ha);a.removeChild(Ja);Ha=Ja=null;kb=0}}function ba(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function P(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function ca(a){var b=a.split("://",2);
return 1<b.length?(b[1]=P(b[1]),b.join("://")):P(a)}function X(a,b){eb[b]||aa(a,b);return eb[b]}function aa(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)w(c[e].objects,0,d);eb[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var g=c[f],s=0;s<g.length;s++)eb[b].push(g[s])}function w(a,b,c){c[b]=c[b]||[];for(var d=c[b],e=0;e<a.length;e++){var f=a[e],g=fa(f);d[g]=d[g]||[];(wa||-1==Lb.indexOf(f.type))&&-1==d[g].indexOf(f)&&d[g].push(f);(f=f.dupli_group)&&w(f.objects,b+1,c)}}function fa(a){return(a=
a.parent||ja.get_first_armature_object(a))?1+fa(a):0}var ja=p("__animation"),N=p("__batch"),I=p("__config"),Y=p("__controls"),ga=p("__dds"),qa=p("__extensions");p("__lights");var M=p("__loader"),R=p("__assets"),s=p("__md5"),V=p("__objects"),ma=p("__physics"),pa=p("__print"),na=p("__reformer"),ea=p("__renderer"),la=p("__scenes"),Q=p("__nla"),Ba=p("__sfx"),ia=p("__shaders"),Za=p("__textures"),va=p("__nodemat"),Ea=p("__util"),vb=p("vec4"),lb=p("mat4"),gb=I.p,Fa=I.kd,wb=I.rb,sa=I.hd,bc=I.Ld,ka=null,eb=
null,ta="",wa=!1,Ca=null,ra={},Ha=null,Ja=null,kb=0,Lb=["LAMP","CAMERA"],mb=["MESH","CAMERA","EMPTY"],Tb=["SPEAKER"],nb=null;a.is_primary_loaded=function(a){return M.is_primary_loaded(a)};a.update=function(){M.Gz(ka)};a.ec=function(a){nb=a};a.Cz=function(a,b){if(Ha){Ja.style.height=b.toString()+"px";Ja.style.width=a.toString()+"px";var c=Math.round(a/2-44);Ha.style.top=Math.round(b/2-44).toString()+"px";Ha.style.left=c.toString()+"px"}};a.load=function(a,b,s,k,n){var V={load_main:{Ja:M.Ke,$a:!1,F:[],
cb:!1,gb:500,zb:!1,Na:e},duplicate_objects:{Ja:M.Fc,$a:!1,F:["load_main"],cb:!1,gb:50,zb:!1,Na:h},load_binaries:{Ja:M.Ke,$a:!1,F:["load_main"],cb:!1,gb:500,zb:!1,Na:d},prepare_bindata:{Ja:M.Fc,$a:!1,F:["duplicate_objects","load_binaries"],cb:!1,gb:0,zb:!1,Na:g},prepare_root_datablocks:{Ja:M.Fc,$a:!1,F:["duplicate_objects","prepare_bindata"],cb:!1,gb:150,zb:!1,Na:f},prepare_root_scenes:{Ja:M.Fc,$a:!1,F:["prepare_root_datablocks"],cb:!1,gb:350,zb:!1,Na:m},load_smaa_textures:{Ja:M.Ke,$a:!0,F:["prepare_root_scenes"],
cb:!1,gb:10,zb:!0,Na:L},load_shoremap:{Ja:M.Ke,$a:!0,F:["prepare_root_scenes"],cb:!1,gb:10,zb:!0,Na:H},load_textures:{Ja:M.Ke,$a:!0,F:["prepare_root_scenes"],cb:!0,gb:500,zb:!1,Na:q,Ve:{Cp:0}},add_physics_objects:{Ja:M.Fc,$a:!1,F:["load_shoremap"],cb:!1,gb:20,zb:!1,Na:y},add_objects:{Ja:M.Fc,$a:!1,F:["add_physics_objects"],cb:!1,gb:800,zb:!1,Na:Z,ag:J,rh:F,Ve:{zn:[],gq:0}},load_speakers:{Ja:M.Ke,$a:!0,F:["add_objects"],cb:!0,gb:30,zb:!1,Na:l,Ve:{Oy:0}},mobile_media_start:{Ja:M.Fc,$a:!gb.nf,F:["load_textures",
"load_speakers"],cb:!0,gb:5,zb:!1,Na:K,ag:K},synchronize_media:{Ja:M.Fc,$a:!0,F:["mobile_media_start"],cb:!0,gb:70,zb:!1,Na:U},start_nla:{Ja:M.Fc,$a:!0,F:["mobile_media_start"],cb:!1,gb:5,zb:!1,Na:t}},r=M.op();r||(r=M.Nu(),ka=[],eb=[],ra={});ka[r.Zc.length]={};return M.Wu(V,a,b,s,c,k||bc.Jn,gb.do_not_load_resources,n)};a.unload=function(a){var b=M.op();if(!b||!b.Zc.length||a&&!M.mz(b.Zc[a]))pa.error("Unable to unload data!");else{if(0==a)pa.log("%cUNLOAD ALL","color: #00a"),ja.cleanup(),Ba.cleanup(),
Q.cleanup(),la.cleanup(),M.cleanup(),ma.cleanup(),V.cleanup(),Ea.cleanup(),ea.cleanup(),va.cleanup(),ia.cleanup(),Y.cleanup(),qa.cleanup(),R.cleanup(),Za.cleanup(),eb=null,ra={},wa=!1,ka=Ca=null;else{pa.log("%cUNLOAD DATA "+a,"color: #00a");ja.Sx(a);for(var b=la.Hh(),c=0;c<b.length;c++)for(var d=b[c],e=la.Da(d,"ALL",la.DATA_ID_ALL),f=e.length-1;0<=f;f--){var g=e[f];if(g.d.sd==a){var s=d,h=g;ja.is_animated(h)&&ja.remove(h);la.clear_glow_anim(h);ma.has_physics(h)&&(ma.disable_simulation(h),ma.Tx(h));
Y.check_sensor_manifold(h)&&Y.remove_sensor_manifold(h);la.Ux(s,h);Ba.Fd(h)&&Ba.Qy(h);e.splice(f,1);s=la.Da(d,g.type,la.DATA_ID_ALL);g=s.indexOf(g);-1!=g&&s.splice(g,1)}}}T()}};a.set_debug_resources_root=function(a){ta=a}};b4w.module.__batch=function(a,p){function c(a){a={type:a,id:0,nm:0,Bf:"",M:[],hc:[],yc:[],cm:[],pd:[],Sf:null,Wa:{},Mb:null,Ua:null,In:[],Oc:null,lb:null,nc:null,Eb:null,Do:!1,num_vertices:0,num_triangles:0,wj:0,xj:0,qg:0,jj:0,yl:0,Pb:new Float32Array(3),oo:new Float32Array(3),Zb:new Float32Array(16),va:!1,po:!1,U:!1,Qd:!1,qa:!1,Rf:!1,wd:!1,Ub:!1,Vb:!1,Bb:!1,dc:!1,Tb:!1,zc:!1,Ca:!1,Fq:!1,vd:S.hh,Rd:S.gd,Yg:0,Km:new Float32Array(2),t:new Float32Array(2),sp:!1,wp:0,tp:0,xp:0,yp:0,vp:new Float32Array(3),
up:new Float32Array(3),hf:!1,Hc:0,ce:0,Ze:1,di:0,gr:0,Mg:1,Xh:0,Ye:0,Ne:1,dq:0,Yl:0,Df:0,Kq:0,td:Array(2),tc:new Float32Array(3),Xc:new Float32Array(3),Md:new Float32Array(3),yb:new Float32Array(4),zd:new Float32Array(4),ug:null,Ml:null,Kl:null,Jl:null,Ll:null,Ge:!1,water_dynamic:!1,bn:!1,Pr:!1,Qr:0,Rr:0,Or:0,nk:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,Yo:new Float32Array(2),Xo:new Float32Array(2),kl:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
zf:null,mm:!1,qq:0,mq:0,fm:0,pq:0,sq:0,rq:0,nq:0,oq:0,gm:0,jq:0,iq:0,uq:0,lq:0,Kj:new Float32Array(3),tq:new Float32Array(8),kq:new Float32Array(16)};a.yb[3]=1;a.po=!0;a.U=!0;a.Yg=1;return a}function b(a,b,c){for(var e=[],f=0;f<a.length;f++){var h=a[f],k=h.d,l=g(h.data.b4w_bounding_box),m=h.data.b4w_bounding_cylinder_radius,n=h.data.b4w_bounding_sphere_radius,r=h.data.b4w_bounding_sphere_center,M=h.data.b4w_bounding_ellipsoid_axes,x=h.data.b4w_bounding_ellipsoid_center;if(k.md){var n=Math.max(Math.abs(l.max_x),
Math.abs(l.min_x)),m=Math.max(Math.abs(l.max_y),Math.abs(l.min_y)),q=Math.max(Math.abs(l.max_z),Math.abs(l.min_z)),q=Math.sqrt(n*n+m*m+q*q),n=Math.sqrt(n*n+m*m);l.max_x=l.max_y=l.max_z=q;l.min_x=l.min_y=l.min_z=-q;m=n;n=q;r[0]=r[1]=r[2]=0;M[0]=M[1]=M[2]=q;x[0]=x[1]=x[2]=0}k.Kb=l;q=J.Gk(l,k.K);k.Ma=q;var q=k,R=m;q.Ck=J.xo(R,l);q.Ak=J.vo(m,l);q.Bk=J.wo(R,l);r=J.Uk(n,r);k.wc=r;r=J.Ik(r,k.K);k.tb=r;M=J.Tk([M[0],0,0],[0,M[1],0],[0,0,M[2]],x);k.Se=M;M=J.Hk(M,k.Pd);k.Te=M;e=e.concat(d(h,k,b,c))}return e}
function e(a,b,c,e){for(var f=[],h=[],k={},l=0;l<a.length;l++){var m=a[l],n=m.d,r=g(m.data.b4w_bounding_box),M=J.Gk(r,n.K),x=J.Uk(m.data.b4w_bounding_sphere_radius,m.data.b4w_bounding_sphere_center),q=J.Ik(x,n.K),R=m.data.b4w_bounding_ellipsoid_axes,R=J.Tk([R[0],0,0],[0,R[1],0],[0,0,R[2]],m.data.b4w_bounding_ellipsoid_center),v=J.Hk(R,n.Pd);n.Kb=r;n.Ma=M;n.wc=x;n.tb=q;n.Se=R;n.Te=v;r={};r.Ub=n.Ub;r.Vb=n.Vb;r.Bb=n.Bb;r.Qc=n.Qc;r.Jj=n.Jj;r.hj=n.hj;r.dc=n.dc;r.Tb=n.Tb;r.zc=n.zc;r.Ue=n.Ue;r.ad=n.ad;r.Gd=
n.Gd;r.Gb=n.Gb;r.md=n.md;r.oh=n.oh;r.Ca=n.Ca;r.gg=n.gg;r.cj=n.cj;r.wd=n.wd;M=n.tb.A;r.Kw=0==c?[0,0]:[Math.floor(M[0]/c),Math.floor(M[2]/c)];r.le=n.le;r.Rh=n.Rh;r.wf=n.wf;n=JSON.stringify(r);k[n]=k[n]||[];k[n].push(m)}for(var p in k){r=JSON.parse(p);c=k[p];var m=P.Yi("STATIC"),u;for(u in r)m[u]=r[u];m.sd=a[0].d.sd;m.bd=0;m.Je=0;m.ae=0;m.$d=0;m.Yd=0;m.Kh=!1;for(l=0;l<c.length;l++)n=c[l],0==l?(m.Ma=I.wa(n.d.Ma),m.tb=I.wa(n.d.tb),m.Se=I.wa(n.d.Se),m.Te=I.wa(n.d.Te)):(J.No(m.Ma,n.d.Ma),J.uv(m.tb,n.d.tb));
m.Kb=I.wa(m.Ma);m.wc=I.wa(m.tb);h.push({Lb:m,Hd:c})}for(a=0;a<h.length;a++)for(k=h[a].Lb,l=h[a].Hd,p=0;p<l.length;p++){u=l[p];c=d(u,k,b,e);m=t(u.d)||t(k);n={};k.ad&&(n.au_center_pos=[m[0],m[1],m[2]],n.au_wind_bending_amp=[u.d.bd],n.au_wind_bending_freq=[u.b4w_wind_bending_freq],n.au_detail_bending_amp=[u.b4w_detail_bending_amp],n.au_detail_bending_freq=[u.b4w_detail_bending_freq],n.au_branch_bending_amp=[u.b4w_branch_bending_amp]);for(r=0;r<c.length;r++)q=c[r].Lb,M=c[r].gc,x=c[r].n,q.vj?q.md?S.cz(M,
m):S.rr(M,m):("COLOR_ID"==x.type?(q=c[r].Lb=u.d,q.type="DYNAMIC",x.Bf=u.uuid,D(x,q),B(x,I.qh(q,0))):M=S.rr(M,m),S.bz(M,n));f=f.concat(c)}return f}function d(a,b,d,e){for(var g=[],h=k(d,b),l=I.qh(b,0),m=a.data,n=m.materials,r=0;r<h.length;r++){var M=h[r];if(!a.b4w_do_not_render||"PHYSICS"==M)for(var x=0;x<n.length;x++){var q=n[x];if(("LENS_FLARES"!=q.name||0!=e)&&!S.zp(m,x)){var R=c(M);if(f(R,q,!0)){R.vd=m.vd||S.hh;"COLOR_ID"===M&&R.oo.set(a.rn);D(R,b);for(var v=R,p=a.particle_systems,u=0;u<p.length;u++){var A=
p[u].settings.b4w_vcol_from_name,N=p[u].settings.b4w_vcol_to_name;""!==A&&""!==N&&(v.Wa[A]={ef:!1,src:[{name:A,qc:7}]})}"DYNAMIC"==b.type&&(R.Bf=a.uuid);B(R,l);v=S.To(m,x,R.pd,R.nc,R.Wa,R.Sf);"LENS_FLARES"==q.name&&(v=ca.Hx(v));g.push({n:R,gc:v,ac:[q.name],Lb:b,Bc:[a]})}}}}h=a.particle_systems;if(0<h.length&&g.length){e=!0;for(r=0;r<h.length;r++)if(h[r].settings.use_render_emitter){e=!1;break}r=g[0].n;h=g[0].gc;m=[];n=a.particle_systems;M=a.data;for(x=0;x<n.length;x++)if(q=n[x],R=q.settings,R.count)if("EMITTER"==
R.type){if("DYNAMIC"==b.type){v=c("PARTICLES");p=M.materials;u=q.settings.material-1;u>=p.length&&(U.warn('B4W Warning: Wrong material used for rendering particle system "'+q.name+'"'),u=0);p=p[u];"HALO"===q.settings.render_type&&(v.hf=!0);f(v,p);D(v,b);u=v;A=q;switch(A.settings.b4w_billboard_align){case "VIEW":z(u,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":z(u,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":z(u,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":z(u,"BILLBOARD_ALIGN",
"BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}z(u,"BILLBOARD",0);fa.G(u.Ua,"WORLD_SPACE","WORLD"==A.settings.b4w_coordinate_system?1:0);v.wd=!0;v.Bf=a.name+"_"+R.uuid;B(v,l);v.Oc=q;R=ca.Tv(v,M,q,a.d.Pd);ca.oy(v,q,p);m.push({n:v,gc:R,ac:[p.name],Lb:b,Bc:[a]})}}else if("HAIR"==R.type){v=I.rj(q.seed);R.b4w_dynamic_grass&&(b.gg=!0);if(q.transforms.length)var F=q.transforms;else for(var p=S.ql(h,R.count,!1,v),F=new Float32Array(4*p.length),t=0;t<p.length;t++)u=.75+.5*I.sc(v),
F[4*t]=p[t][0],F[4*t+1]=p[t][1],F[4*t+2]=p[t][2],F[4*t+3]=u;p=w.ab(d,"GRASS_MAP")?!0:!1;if("OBJECT"==R.render_type)u=[k(d,R.dupli_object.d)],q=G(a,b,r,h,[R.dupli_object],u,[F],R,q,p,v,!1),m=m.concat(q);else if("GROUP"==R.render_type){A=R.dupli_group.objects;N=!1;u=[];for(t=0;t<A.length;t++){var y=k(d,R.dupli_group.objects[t].d);u.push(y)}if(R.use_whole_group){N=F;F=A;t={};for(y=0;y<N.length;y+=4)for(var E=0;E<F.length;E++){var K=Y.create();Y.scale(F[E].d.g,F[E].d.scale,K);var ga=Y.clone([N[y],N[y+
1],N[y+2]]);Y.add(ga,K,ga);t[E]||(t[E]=new Float32Array(N.length));t[E][y]=ga[0];t[E][y+1]=ga[1];t[E][y+2]=ga[2];t[E][y+3]=N[y+3]}F=t;N=!0}else if(R.use_group_count){for(var ga=A,H=R.dupli_weights,t=v,y={},E=[],K=0;K<ga.length;K++)for(var O=ga[K],O=O.origin_name||O.name,T=0;T<H.length;T++){var L=H[T];O==L.name.split(": ")[0]&&E.push(L)}H.length!=E.length&&U.error("B4W Error: dupli weights match failed");for(K=0;K<F.length;K+=4){var J,H=E;J=[0];for(ga=0;ga<H.length;ga++)J[ga+1]=J[ga]+H[ga].count;H=
J[J.length-1]*I.sc(t);for(ga=O=0;ga<J.length;ga++)if(H>=J[ga]&&H<J[ga+1]){O=ga;break}J=O;y[J]=y[J]||[];y[J].push(F[K],F[K+1],F[K+2],F[K+3])}for(J in y)y[J]=new Float32Array(y[J]);F=y}else{t=v;y=A.length;E={};for(K=0;K<F.length;K+=4){var P=Math.floor(y*I.sc(t));E[P]=E[P]||[];E[P].push(F[K],F[K+1],F[K+2],F[K+3])}for(P in E)E[P]=new Float32Array(E[P]);F=E}q=G(a,b,r,h,A,u,F,R,q,p,v,N);m=m.concat(q)}"INSTANCE"==R.b4w_wind_bend_inheritance&&(a.d.bd=0)}else throw"Unknown particle settings type";a=m;g=e?
a:g.concat(a)}return g}function g(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function k(a,b){var c=["MAIN","NODES"];b.Qc&&(w.ab(a,"COLOR_PICKING")||w.ab(a,"GLOW_MASK"))&&c.push("COLOR_ID");w.ab(a,"WIREFRAME")&&c.push("WIREFRAME");c.push("PHYSICS");(w.ab(a,"DEPTH")||w.ab(a,"SHADOW_CAST"))&&c.push("DEPTH");w.ab(a,"GRASS_MAP")&&c.push("GRASS_MAP");if(b.Vb||b.Tb){var d=null;b.Vb&&(d=["MAIN","NODES","COLOR_ID","PHYSICS","WIREFRAME"]);if(b.Tb)var e=["COLOR_ID",
"PHYSICS","DEPTH","WIREFRAME"],d=null!==d?I.Kt(d,e):e;for(e=0;e<d.length;e++){var f=c.indexOf(d[e]);-1!==f&&c.splice(f,1)}}return c}function f(a,b,c){var d,e;switch(a.type){case "MAIN":if(b.b4w_do_not_render||b.use_nodes)a=!1;else{h(a,b);var f=b.game_settings.alpha_blend;a.Qd=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;a.Df=b.offset_z;a.Xc.set([1,1,1]);var g=b.texture_slots;ga.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.yb);switch(b.name){case "LENS_FLARES":y(a,"special_lens_flares.glslv",
"special_lens_flares.glslf");l(a,"a_position");l(a,"a_texcoord");var k=c?[1,1,1,0]:null,k=r(g[0],k);H(a,k);break;default:y(a,"main.glslv","main.glslf");var q=n("use_map_color_diffuse",g),R=n("use_map_color_spec",g),p=n("use_map_normal",g),A=n("use_map_mirror",g),N=n("use_stencil",g),f=q[0],R=R[0],p=p[0],A=A[0],q=q[1],g=N[0]&&n("use_rgb_to_intensity",g)[0];if(f){switch(f.blend_type){case "MIX":z(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":z(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}k=
"IMAGE"==f.texture.d.source&&c?[a.yb[0],a.yb[1],a.yb[2],1]:"ENVIRONMENT_MAP"==f.texture.d.source&&c?[.8,.8,.8,1]:null;k=r(f,k);H(a,k,"u_colormap0");a.Ye=f.diffuse_color_factor;a.Ne=f.use_map_alpha?f.alpha_factor:0;a.Xc.set(f.scale)}N=f&&f==R;R&&(N||(k=c?[.5,.5,.5,1]:null,k=r(R,k),H(a,k,"u_specmap0")),a.gr=R.specular_color_factor);if(p){l(a,"a_normal");l(a,"a_tangent");k=c?[.5,.5,1,1]:null;k=r(p,k);H(a,k,"u_normalmap0");a.dq=p.normal_factor;var I=p.texture;if(I.b4w_use_map_parallax&&M.Wh){var k=fa.s(I.b4w_parallax_steps),
F=fa.s(I.b4w_parallax_lod_dist);z(a,"PARALLAX",1);z(a,"PARALLAX_STEPS",k);z(a,"PARALLAX_LOD_DIST",F);a.Xh=I.b4w_parallax_scale}}A&&(k=c?[0,0,.5,1]:null,k=r(A,k),H(a,k,"u_mirrormap"),a.Yl=A.mirror_factor);if(I=f&&q&&g?1:0)k=c?[.8,.8,.8,1]:null,k=r(q,k),H(a,k,"u_colormap1"),k=c?[.5,.5,.5,1]:null,k=r(g,k),H(a,k,"u_stencil0");(c=f||R||p)&&a.Xc.set(c.scale);z(a,"TEXTURE_SPEC",void 0==R?0:1);z(a,"TEXTURE_MIRROR",void 0==A?0:1);z(a,"ALPHA_AS_SPEC",N?1:0);z(a,"TEXTURE_STENCIL_ALPHA_MASK",I);l(a,"a_position");
l(a,"a_normal");(f||R||p)&&l(a,"a_texcoord");if(b.b4w_water){a.Ge=!0;a.bn=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;c=b.texture_slots;y(a,"special_water.glslv","special_water.glslf");l(a,"a_position");l(a,"a_texcoord");l(a,"a_normal");l(a,"a_tangent");M.Sr?(l(a,"a_polyindex"),a.U=!0,a.wireframe_edge_color=[0,0,0],z(a,"DEBUG_WIREFRAME",1)):z(a,"DEBUG_WIREFRAME",0);N=n("use_map_normal",c);A=n("use_map_mirror",c)[0];N.length&&(I=r(N[0]),H(a,I,"u_normalmap0"),a.nk=b.b4w_water_norm_uv_velocity);
z(a,"NUM_NORMALMAPS",N.length);a.zf=Array(N.length);for(I=0;I<N.length;I++)a.zf[I]=new Float32Array(2),a.zf[I].set([N[I].scale[0],N[I].scale[1]]);A?(z(a,"TEXTURE_MIRROR",1),N=r(A),H(a,N,"u_mirrormap"),a.Yl=A.mirror_factor):z(a,"TEXTURE_MIRROR",0);A=null;for(I=0;I<c.length;I++)if(d=c[I],!0===d.texture.b4w_water_foam){A=d;break}A&&M.kg?(z(a,"FOAM",1),N=r(A),H(a,N,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.Yo.set(A.texture.b4w_foam_uv_freq),a.Xo.set(A.texture.b4w_foam_uv_magnitude),a.kl[0]=A.scale[0],
a.kl[1]=A.scale[1]):z(a,"FOAM",0);for(I=0;I<c.length;I++)if(d=c[I],!0===d.texture.b4w_shore_dist_map){e=d;break}e&&M.tk?(e=r(e),H(a,e,"u_shore_dist_map"),z(a,"SHORE_PARAMS",1),e=d.texture.b4w_shore_boundings,z(a,"MAX_SHORE_DIST",fa.s(d.texture.b4w_max_shore_dist)),z(a,"SHORE_MAP_SIZE_X",fa.s(e[0]-e[1])),z(a,"SHORE_MAP_SIZE_Y",fa.s(e[2]-e[3])),z(a,"SHORE_MAP_CENTER_X",fa.s((e[0]+e[1])/2)),z(a,"SHORE_MAP_CENTER_Y",fa.s((e[2]+e[3])/2))):z(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&M.bj?(z(a,"GENERATED_MESH",
1),a.Pr=!0,a.Qr=b.b4w_water_num_cascads,a.Rr=b.b4w_water_subdivs,a.Or=b.b4w_water_detailed_dist):z(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){d=fa.s(b.b4w_water_dst_noise_scale0);e=fa.s(b.b4w_water_dst_noise_scale1);c=fa.s(b.b4w_water_dst_noise_freq0);var A=fa.s(b.b4w_water_dst_noise_freq1),N=fa.s(b.b4w_water_dir_min_shore_fac),I=fa.s(b.b4w_water_dir_freq),k=fa.s(b.b4w_water_dir_noise_scale),F=fa.s(b.b4w_water_dir_noise_freq),t=fa.s(b.b4w_water_dir_min_noise_fac),w=fa.s(b.b4w_water_dst_min_fac),
Y=fa.s(b.b4w_water_waves_hor_fac);z(a,"DST_NOISE_SCALE_0",d);z(a,"DST_NOISE_SCALE_1",e);z(a,"DST_NOISE_FREQ_0",c);z(a,"DST_NOISE_FREQ_1",A);z(a,"DIR_MIN_SHR_FAC",N);z(a,"DIR_FREQ",I);z(a,"DIR_NOISE_SCALE",k);z(a,"DIR_NOISE_FREQ",F);z(a,"DIR_MIN_NOISE_FAC",t);z(a,"DST_MIN_FAC",w);z(a,"WAVES_HOR_FAC",Y)}v(a,b);u(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;
z(a,"ABSORB",fa.s(b.b4w_water_absorb_factor));z(a,"SSS_STRENGTH",fa.s(b.b4w_water_sss_strength));z(a,"SSS_WIDTH",fa.s(b.b4w_water_sss_width));d=a.Ua;e=a.pd;a.Ua=d;a.pd=e}"HALO"===b.type&&(d=b.halo,y(a,"halo.glslv","halo.glslf"),z(a,"NUM_RINGS",d.ring_count),z(a,"NUM_LINES",d.line_count),z(a,"NUM_STARS",d.star_tip_count),z(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.pd=["a_position"],a.wp=d.size,a.tp=d.hardness/20,a.vp.set(d.b4w_halo_rings_color),a.up.set(d.b4w_halo_lines_color),a.xp=1/b.b4w_halo_stars_blend_height,
a.yp=b.b4w_halo_stars_min_height,a.sp=!0);z(a,"TEXCOORD",0);z(a,"NORMAL_TEXCOORD",0);f&&m(a,f,"TEXTURE_COLOR0_CO");q&&m(a,q,"TEXTURE_COLOR1_CO");g&&m(a,g,"TEXTURE_STENCIL_ALPHA_MASK_CO");R&&m(a,R,"TEXTURE_SPEC_CO");p&&m(a,p,"TEXTURE_NORM_CO");z(a,"SHADELESS",b.use_shadeless?1:0);a.Rf=b.use_shadeless}f=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===f?0:1);z(a,"ALPHA_CLIP","CLIP"===f?1:0);z(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(z(a,"VERTEX_COLOR",1),
l(a,"a_color")):z(a,"VERTEX_COLOR",0);a.Hc=b.ambient;a.Ze=b.diffuse_intensity;a.ce=b.emit;a.Md.set(b.specular_color);a.Mg=b.specular_alpha;v(a,b);u(a,b);b.b4w_wettable?z(a,"WETTABLE",1):z(a,"WETTABLE",0);x(a,b);M.gf?z(a,"UNROLL_LOOPS",1):z(a,"UNROLL_LOOPS",0);a.mm=b.b4w_refractive;a.Kq=b.b4w_refr_bump;a=!0}break;case "NODES":a=E(a,b);break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type)a=!1;else if(h(a,b),a.va)a=!1;else{y(a,"depth.glslv","depth.glslf");l(a,
"a_position");l(a,"a_normal");f=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===f?0:1);a.Xc.set([1,1,1]);if((b=n("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===f){a.Xc.set(b.scale);z(a,"TEXTURE_COLOR",1);l(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)f=r(b),H(a,f,"u_colormap0");"NONE"==b.texture.d.source&&(f=r(b),H(a,f,"u_colormap0"))}else z(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.Oz=b.b4w_use_ghost,a.Yb=b.b4w_collision_id,
a.mo=b.b4w_collision_group,a.no=b.b4w_collision_mask,a.Eh=b.physics.friction,a.zh=b.physics.elasticity,a=!0):b.b4w_water?(a.Ge=!0,a.Yz=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,
a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_do_not_render||"HALO"===b.type)a=!1;else{h(a,b);a.Rd=S.gd;a.U=!0;a.va=!1;f=b.game_settings.alpha_blend;a.Qd=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;y(a,"color_id.glslv","color_id.glslf");l(a,"a_position");f=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===f?0:1);a.Xc.set([1,1,1]);if((b=n("use_map_color_diffuse",
b.texture_slots)[0])&&"CLIP"===f){a.Xc.set(b.scale);z(a,"TEXTURE_COLOR",1);l(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)f=r(b),H(a,f,"u_colormap0");"NONE"==b.texture.d.source&&(f=r(b),H(a,f,"u_colormap0"))}else z(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?a=!1:(h(a,b),a.va=!1,a.Rd=S.gd,a.U=!0,y(a,"grass_map.glslv","grass_map.glslf"),l(a,"a_position"),f=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?
b.b4w_dynamic_grass_color:null,a.Wa.a_grass_size={ef:!0,src:[]},f?(a.Wa.a_grass_size.src.push({name:f,qc:4}),z(a,"DYNAMIC_GRASS_SIZE",1)):z(a,"DYNAMIC_GRASS_SIZE",0),a.Wa.a_grass_color={ef:!0,src:[]},b?(a.Wa.a_grass_color.src.push({name:b,qc:7}),z(a,"DYNAMIC_GRASS_COLOR",1)):z(a,"DYNAMIC_GRASS_COLOR",0),M.gf?z(a,"UNROLL_LOOPS",1):z(a,"UNROLL_LOOPS",0),a=!0);break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?a=!1:(y(a,"wireframe.glslv","wireframe.glslf"),
l(a,"a_position"),l(a,"a_normal"),l(a,"a_polyindex"),a.U=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],M.gf?z(a,"UNROLL_LOOPS",1):z(a,"UNROLL_LOOPS",0),a=!0);break;case "PARTICLES":if(b.b4w_do_not_render)a=!1;else{f=b.texture_slots;if(a.hf)y(a,"particles_color.glslv","particles_color.glslf");else if(y(a,"particles_texture.glslv","particles_texture.glslf"),f=n("use_map_color_diffuse",f)[0]){z(a,"TEXTURE_COLOR",1);switch(f.blend_type){case "MIX":z(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");
break;case "MULTIPLY":z(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Ye=f.diffuse_color_factor;a.Ne=f.use_map_alpha?f.alpha_factor:0;f=r(f);H(a,f)}ga.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.yb);a.Hc=b.ambient;a.Ze=b.diffuse_intensity;a.ce=b.emit;a.Md.set(b.specular_color);a.Mg=b.specular_alpha;l(a,"a_position");l(a,"a_normal");f=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===f?0:1);z(a,"ALPHA_CLIP","CLIP"===f?1:0);z(a,"PARTICLES_SHADELESS",b.use_shadeless?
1:0);v(a,b);u(a,b);h(a,b);f=b.game_settings.alpha_blend;a.Qd=b.b4w_render_above_all&&"OPAQUE"!=f&&"CLIP"!=f;a.Df=b.offset_z;M.gf?z(a,"UNROLL_LOOPS",1):z(a,"UNROLL_LOOPS",0);a=!0}break;default:throw"Wrong batch type: "+a.type;}return a}function m(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":z(a,c,"TEXTURE_COORDS_UV_ORCO");z(a,"TEXCOORD",1);break;case "NORMAL":z(a,c,"TEXTURE_COORDS_NORMAL");z(a,"NORMAL_TEXCOORD",1);break;default:z(a,c,0)}}function h(a,b){var c=b.game_settings,d=c.alpha_blend;
switch(d){case "ALPHA_SORT":a.va=!0;a.Rd=S.qn;a.U=!0;break;case "ALPHA":a.va=!0;a.Rd=S.gd;a.U=!0;break;case "CLIP":a.va=!1;a.Rd=S.gd;a.U=!0;break;case "ADD":a.va=!0;a.Rd=S.gd;a.U=!1;break;case "OPAQUE":a.va=!1;a.Rd=S.gd;a.U=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.qa=c.use_backface_culling}function r(a,b){var c=a.texture,d=c.d,c=c.image;d&&b&&c&&ja.qi(d,b,c.Wb,c.filepath);return d}function n(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];1==f[a]&&f.texture&&f.texture.d&&
c.push(f)}return c}function x(a,b){var c=b.raytrace_transparency;a.zd[0]=c.fresnel;a.zd[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.di=c.reflect_factor;a.zd[2]=c.fresnel;a.zd[3]=1-c.fresnel_factor/5}function v(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":z(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":z(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":z(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;
d=b.specular_toon_smooth;break;default:U.error("B4W Error: unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.tc[0]=b.specular_intensity;a.tc[1]=c;a.tc[2]=d}function u(a,b){switch(b.diffuse_shader){case "LAMBERT":z(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.td[0]=0;a.td[1]=0;break;case "OREN_NAYAR":z(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.td[0]=b.roughness;a.td[1]=0;break;case "FRESNEL":z(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.td[0]=b.diffuse_fresnel;
a.td[1]=b.diffuse_fresnel_factor;break;default:U.error("B4W Error: unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.td[0]=0,a.td[1]=0}}function E(a,b){if(!b.use_nodes||b.b4w_do_not_render)return!1;var c=ba.ou(b.node_tree,b.uuid,!1);if(!c)return U.error('Failed to create node graph for material "'+b.name+'", disable nodes'),q(a,b),!0;y(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===d?0:1);z(a,"ALPHA_CLIP","CLIP"===d?1:0);z(a,"DOUBLE_SIDED_LIGHTING",
b.b4w_double_sided_lighting?1:0);l(a,"a_position");h(a,b);a.Df=b.offset_z;d=b.game_settings.alpha_blend;a.Qd=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;ga.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.yb);a.ce=b.emit;a.Hc=b.ambient;x(a,b);b.b4w_wettable?z(a,"WETTABLE",1):z(a,"WETTABLE",0);a.cm=ba.pu(c);var e=!1;T.P(c,function(c,d){switch(d.type){case "GEOMETRY_UV":var f=d.data.name,g=d.data.value;a.Sf||(a.Sf={});a.Sf[g]=f;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":f=
d.data.name;a.Wa[f]={ef:!0,src:[{name:d.data.value}]};g=0;if("GEOMETRY_VC"==d.type)g=7;else for(var h=0;h<d.Sa.length;h++){var k="RGB".indexOf(d.Sa[h].identifier);-1<k&&(g|=1<<2-k)}a.Wa[f].src[0].qc=g;break;case "GEOMETRY_NO":l(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":f=d.data.value;l(a,"a_normal");z(a,"DIFFUSE_SHADER","DIFFUSE_"+f.kv);z(a,"SPECULAR_SHADER","SPECULAR_"+f.Ty);z(a,"SHADELESS_MAT",f.Rf?1:0);a.Rf=f.Rf;a.Mg=f.Mg;e=!0;break;case "TEXTURE_COLOR":case "TEXTURE_COLOR2":case "TEXTURE_COLOR3":case "TEXTURE_COLOR4":case "TEXTURE_ENVIRONMENT":f=
d.data.name;g=d.data.value;!1!==g.d.Gi&&(g.d.Gi="TEXTURE_ENVIRONMENT"!=d.type?!0:!1);H(a,g.d,f);break;case "TEXTURE_NORMAL":case "TEXTURE_NORMAL2":case "TEXTURE_NORMAL3":case "TEXTURE_NORMAL4":case "B4W_PARALLAX":z(a,"CALC_TBN_SPACE",1);l(a,"a_normal");l(a,"a_tangent");f=d.data.name;(g=d.data.value)?(g.d.Gi=!1,H(a,g.d,f)):U.error("Missing texture in node ",d.name,"for material ",b.name);break;case "LAMP":d.data&&(a.ug=d.data);break;case "B4W_REFRACTION":a.mm=!0}});e||(a.Rf=!0);M.gf?z(a,"UNROLL_LOOPS",
1):z(a,"UNROLL_LOOPS",0);return!0}function q(a,b){y(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;z(a,"ALPHA","OPAQUE"===c?0:1);z(a,"ALPHA_CLIP","CLIP"===c?1:0);z(a,"SHADELESS",1);l(a,"a_position");l(a,"a_normal");ga.set(1,0,1,1,a.yb);z(a,"VERTEX_COLOR",0);a.Df=b.offset_z;h(a,b)}function D(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.vj?z(a,"AU_QUALIFIER","attribute"):z(a,"AU_QUALIFIER","uniform"),z(a,"STATIC_BATCH",0)):(z(a,"AU_QUALIFIER","attribute"),z(a,"STATIC_BATCH",1));
"WIREFRAME"==a.type&&(K.yw()?z(a,"WIREFRAME_QUALITY",1):z(a,"WIREFRAME_QUALITY",0),a.al?(z(a,"DEBUG_SPHERE",1),a.Do?z(a,"DEBUG_SPHERE_DYNAMIC",1):z(a,"DEBUG_SPHERE_DYNAMIC",0)):z(a,"DEBUG_SPHERE",0),z(a,"ALPHA",1));b.ad?(""!==b.Gd?(a.Wa.a_bending_col_main={ef:!0,src:[{name:b.Gd,qc:4}]},l(a,"a_bending_col_main"),""!==b.Gb.Sp&&""!==b.Gb.Rp&&""!==b.Gb.hq?(a.Wa.a_bending_col_detail={ef:!0,src:[{name:b.Gb.Sp,qc:4},{name:b.Gb.Rp,qc:2},{name:b.Gb.hq,qc:1}]},l(a,"a_bending_col_detail"),l(a,"a_normal"),z(a,
"DETAIL_BEND",1)):z(a,"DETAIL_BEND",0),z(a,"MAIN_BEND_COL",1)):z(a,"MAIN_BEND_COL",0),z(a,"WIND_BEND",1)):z(a,"WIND_BEND",0);b.Mi?z(a,"BEND_CENTER_ONLY",1):z(a,"BEND_CENTER_ONLY",0);z(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.Ut|0);b.md?z(a,"BILLBOARD",1):z(a,"BILLBOARD",0);b.md&&b.vj?z(a,"HAIR_BILLBOARD",1):z(a,"HAIR_BILLBOARD",0);b.Fk?z(a,"BILLBOARD_SPHERICAL",1):z(a,"BILLBOARD_SPHERICAL",0);switch(b.oh){case "RANDOM":z(a,"BILLBOARD_RANDOM",1);z(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":z(a,"BILLBOARD_RANDOM",
0);z(a,"BILLBOARD_JITTERED",1);break;default:z(a,"BILLBOARD_RANDOM",0),z(a,"BILLBOARD_JITTERED",0)}b.Ca&&M.tk?z(a,"DYNAMIC_GRASS",1):z(a,"DYNAMIC_GRASS",0);a.Ca=b.Ca;a.wd=b.wd;a.Ub=b.Ub;a.Vb=b.Vb;a.Bb=b.Bb&&!a.Rf&&!(a.va&&M.Ho);a.dc=b.dc;a.Tb=b.Tb;a.zc=b.zc;b.Nh?(l(a,"a_influence"),z(a,"SKINNED",1),b.Dh?z(a,"FRAMES_BLENDING",1):z(a,"FRAMES_BLENDING",0),z(a,"MAX_BONES",b.max_bones)):(z(a,"SKINNED",0),z(a,"FRAMES_BLENDING",0));b.lk?(z(a,"VERTEX_ANIM",1),M.Mr?z(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):
z(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):z(a,"VERTEX_ANIM",0);if(b.Nh&&b.lk)throw"Skinning and vertex animation are mutually exlusive";b.cj?z(a,"DISABLE_FOG",1):z(a,"DISABLE_FOG",0);b.nc&&(a.nc=b.nc);if(b.yf&&"NODES"==a.type){for(var c=a.cm,d=b.Sh,e=0;e<c.length;e++){var f=c[e];switch(f.id){case "ANIM_VALUE":for(var g=f.Mj[1],h=0;h<d.length;h+=2)if(d[h]==g){f.Mj[0]=d[h+1];break}}}z(a,"NUM_ANIM_VALUES",b.yf.length)}}}function l(a,b){var c=a.pd;-1==c.indexOf(b)&&c.push(b)}function z(a,
b,c){fa.G(a.Ua,b,c)}function A(a,b){if("PHYSICS"==a.type)a.gc=b;else{var c=a.Rd,d=a.vd;a.sp&&(b=S.zv(b));a.Pr&&(b=X.Xv(a.Qr,a.Rr,a.Or));c=S.ez(b,c,d,a.Wa);a.wd||c.qj||(c.he=null,c.$c=null);a.lb=c;c=b.u.length;a.num_vertices=b.H*c;a:switch(a.vd){case S.hh:case S.Ai:case S.gn:d=!0;break a;default:d=!1}d?S.$w(b)?a.num_triangles=b.ba.length/3*c:a.num_triangles=b.H/3*c:a.num_triangles=0}}function G(a,b,d,e,g,h,k,l,m,n,r,M){var q=[],x=l.b4w_dynamic_grass;if(!n&&x)return q;for(var R="INSTANCE"==l.b4w_wind_bend_inheritance,
v="INSTANCE"==l.b4w_shadow_inheritance,p="INSTANCE"==l.b4w_reflection_inheritance,u=[],A=[],z=0;z<g.length;z++){var F=g[z],t=I.sh(b);t.md=l.b4w_hair_billboard;t.oh=l.b4w_hair_billboard_type;t.Fk="SPHERICAL"==l.b4w_hair_billboard_geometry;t.Ca=x;t.vj=!0;t.yf=F.d.yf;t.Sh=F.d.Sh;R?(t.ad=F.d.ad,t.wi=F.d.wi,t.Je=F.d.Je,t.ae=F.d.ae,t.Gd=F.d.Gd,t.$d=F.d.$d,t.Yd=F.d.Yd,t.bd=F.d.bd,t.Gb=F.d.Gb,t.Mi=!1):(t.ad=a.d.ad,t.wi=a.d.wi,t.Je=a.d.Je,t.ae=a.d.ae,t.Gd=a.d.Gd,t.$d=a.d.$d,t.Yd=a.d.Yd,t.bd=a.d.bd,t.Gb=a.d.Gb,
t.Mi=!0);v?(t.Ub=F.d.Ub,t.Vb=F.d.Vb,t.Bb=F.d.Bb):(t.Ub=a.d.Ub,t.Vb=a.d.Vb,t.Bb=a.d.Bb);p?(t.dc=F.d.dc,t.Tb=F.d.Tb,t.zc=F.d.zc):(t.dc=a.d.dc,t.Tb=a.d.Tb,t.zc=a.d.zc);u.push(t);var y=k[z];y||(y=new Float32Array);M&&I.rj(m.seed,r);for(var w=new Float32Array(3),E=new Float32Array([0,0,0,1]),G=[],K=0;K<y.length;K+=4){w[0]=y[K];w[1]=y[K+1];w[2]=y[K+2];var H=y[K+3];if(l.b4w_initial_rand_rotation){switch(l.b4w_rotation_type){case "XYZ":var O=new Float32Array([I.sc(r),I.sc(r),I.sc(r)]);Y.normalize(O,O);break;
case "Z":O=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+l.b4w_rotation_type;}qa.setAxisAngle(O,l.b4w_rand_rotation_strength*(2*Math.PI*I.sc(r)-Math.PI),E)}var T=N.eg(w,H,E);G.push(T)}A.push(G)}for(var J={},z=0;z<g.length;z++){var L=h[z],t=u[z],P=I.qh(t,0),G=A[z];if(G.length)for(var ba=g[z].data,X=ba.materials,K=0;K<X.length;K++)if(!S.zp(ba,K))for(var ca=0;ca<L.length;ca++){var Z=L[ca];if("COLOR_ID"!==Z){var aa=c(Z),fa=X[K];if(f(aa,fa,!0)){aa.vd=ba.vd||S.hh;D(aa,
t);aa.Bf=l.uuid;"JITTERED"==l.b4w_hair_billboard_type&&(aa.wj=l.b4w_hair_billboard_jitter_amp,aa.xj=l.b4w_hair_billboard_jitter_freq);x&&(aa.jj=l.b4w_dynamic_grass_scale_threshold);R||(delete aa.Wa.a_bending_col_main,delete aa.Wa.a_bending_col_detail);B(aa,P);var ja=S.To(ba,K,aa.pd,aa.nc,aa.Wa,aa.Sf),Ab=[];if(t.ad||t.Ca||t.md)Ab.au_wind_bending_amp=[t.bd],Ab.au_wind_bending_freq=[t.Je],Ab.au_detail_bending_freq=[t.ae],Ab.au_detail_bending_amp=[t.$d],Ab.au_branch_bending_amp=[t.Yd];var Ua=S.ix(ja,
Ab,G),$a=Ua,Ia=G;$a.D.au_center_pos=new Float32Array(3*$a.H);for(var Zb=Ia.length,Sa=$a.H/Zb,Ga=0;Ga<Zb;Ga++)for(var Bb=Ia[Ga],Ub=3*Sa*Ga,ob=0;ob<Sa;ob++)$a.D.au_center_pos[Ub+3*ob]=Bb[0],$a.D.au_center_pos[Ub+3*ob+1]=Bb[1],$a.D.au_center_pos[Ub+3*ob+2]=Bb[2];Ua=$a;if(t.Mi){var Ra=Ua,Va=a.d.K;Ra.D.a_emitter_center=new Float32Array(3*Ra.H);var za=ga.fromValues(0,0,0,1);ga.transformMat4(za,Va,za);for(var pb=0;pb<Ra.H;pb++)Ra.D.a_emitter_center[3*pb]=za[0],Ra.D.a_emitter_center[3*pb+1]=za[1],Ra.D.a_emitter_center[3*
pb+2]=za[2];Ua=Ra}var Mb=l.b4w_vcol_from_name,ua=l.b4w_vcol_to_name,rb=aa,da=d,Nb=!R,ya=ba,Aa=[];if(""!==Mb&&""!==ua){var Da,xb=ua,yb=rb.Wa,Oa=[],Ob=void 0;for(Ob in yb)for(var ib=yb[Ob].src,Pb=0,cc=0;cc<ib.length;cc++){var uc=ib[cc].qc;xb==ib[cc].name&&Oa.push(Ob,uc,Pb);Pb+=I.Kf(uc)}Da=Oa;if(0<Da.length)for(var Vb=0;Vb<Da.length;Vb+=3)Aa.push({Ah:Mb,fj:7,Nj:Da[Vb],Oj:Da[Vb+1],dj:Da[Vb+2]});else S.Lw(rb.pd,"a_color")&&ua==ya.active_vcol_name&&Aa.push({Ah:Mb,fj:7,Nj:"a_color",Oj:7,dj:0})}Nb&&("a_bending_col_main"in
da.Wa&&Aa.push({Ah:"a_bending_col_main",fj:4,Nj:"a_bending_col_main",Oj:4,dj:0}),"a_bending_col_detail"in da.Wa&&Aa.push({Ah:"a_bending_col_detail",fj:7,Nj:"a_bending_col_detail",Oj:7,dj:0}));for(var Gb=Ua,jc=G,kc=e,Ta=Aa,lc=aa.Wa,Wb=!1,bb=0;bb<Ta.length;bb++){var dc=Ta[bb].Ah,sb=kc.D[dc];if(sb&&0<sb.length){Wb=!0;break}}if(Wb){var C,cb=a.d.Kb,Wa=kc.u[0].a_position,Xa=jc,oa=J,W=new Float32Array(3),Ka=new Float32Array(3),Qa=new Uint32Array(Xa.length);if(!("verts_indices"in oa)){oa.od=new Float32Array(3);
oa.ld=new Float32Array(3);oa.Ym=new Uint32Array(Wa.length/3);oa.Th=new Uint32Array(Wa.length/3);oa.od[0]=(cb.max_x-cb.min_x)/20;oa.od[1]=(cb.max_y-cb.min_y)/20;oa.od[2]=(cb.max_z-cb.min_z)/20;oa.ld[0]=cb.min_x;oa.ld[1]=cb.min_y;oa.ld[2]=cb.min_z;for(var La=0;La<Wa.length/3;La++){var Hb=I.trunc((Wa[3*La]-oa.ld[0])/oa.od[0]),Ib=I.trunc((Wa[3*La+1]-oa.ld[1])/oa.od[1]),Jb=I.trunc((Wa[3*La+2]-oa.ld[2])/oa.od[2]),Hb=I.clamp(Hb,0,19),Ib=I.clamp(Ib,0,19),Jb=I.clamp(Jb,0,19);oa.Ym[La]=La;oa.Th[La]=Jb*Math.pow(20,
2)+20*Ib+Hb}S.Ny(oa.Th,oa.Ym,!0);oa.Uf=new Uint32Array(Math.pow(20,3));for(La=0;La<oa.Th.length;La++)oa.Uf[oa.Th[La]]++;delete oa.Th;for(La=1;La<oa.Uf.length;La++)oa.Uf[La]+=oa.Uf[La-1]}for(var Qb=0;Qb<Xa.length;Qb++){W[0]=Xa[Qb][0];W[1]=Xa[Qb][1];W[2]=Xa[Qb][2];for(var Kb=1E10,Xb=-1,mc=I.trunc((W[0]-oa.ld[0])/oa.od[0]),Dc=I.trunc((W[1]-oa.ld[1])/oa.od[1]),Pa=I.trunc((W[2]-oa.ld[2])/oa.od[2]),mc=I.clamp(mc,0,19),Dc=I.clamp(Dc,0,19),Pa=I.clamp(Pa,0,19),Ma=Pa*Math.pow(20,2)+20*Dc+mc,Yc=oa.Uf[Ma],Cb=
0==Ma?0:oa.Uf[Ma-1];Cb<Yc;Cb++){var Ec=oa.Ym[Cb];Ka[0]=Wa[3*Ec];Ka[1]=Wa[3*Ec+1];Ka[2]=Wa[3*Ec+2];Y.sub(Ka,W,Ka);var vc=Y.sqrLen(Ka);vc<=Kb&&(Kb=vc,Xb=Ec)}if(-1==Xb)for(Cb=0;Cb<Wa.length/3;Cb++)Ka[0]=Wa[3*Cb],Ka[1]=Wa[3*Cb+1],Ka[2]=Wa[3*Cb+2],Y.sub(Ka,W,Ka),vc=Y.sqrLen(Ka),vc<=Kb&&(Kb=vc,Xb=Cb);Qa[Qb]=Xb}C=Qa;for(var kd=Gb.H/jc.length,bb=0;bb<Ta.length;bb++){var ec=Ta[bb].Nj,Jc=Ta[bb].Oj,dc=Ta[bb].Ah,$b=Ta[bb].fj,sb=kc.D[dc];switch(ec){case "a_bending_col_main":var jb=1;break;case "a_bending_col_detail":jb=
3;break;case "a_color":jb=3;break;default:for(var Db=jb=0;Db<lc[ec].src.length;Db++)jb+=I.Kf(lc[ec].src[Db].qc)}if(sb&&0<sb.length){var wc=I.Kf($b),xc=I.Kf(Jc),nc=$b&Jc,ac=I.Oq(nc);nc!=Jc&&U.error("Wrong color extraction from "+dc+" to "+ec+".");if("a_bending_col_main"==ec||"a_bending_col_detail"==ec)Gb.D[ec]=new Float32Array(Gb.H*xc);for(Db=0;Db<jc.length;Db++){var oc=C[Db],Rb=oc*wc,qb=Db*kd*jb;if(-1!=oc)for(var Eb=0;Eb<kd;Eb++)for(var fc=Eb*jb,tb=0;tb<ac.length;tb++)ac[tb]&&(Gb.D[ec][qb+fc+(Ta[bb].dj+
I.hi(Jc,tb))]=sb[Rb+I.hi($b,tb)])}}else Gb.D[ec]=new Float32Array(0)}}Ua=Gb;q.push({n:aa,gc:Ua,ac:[fa.name],Lb:t,Bc:[a]})}}}}return q}function t(a){return N.eg(a.g,a.scale,a.quat)}function B(a,b){for(var c=null,d=null,e=0;e<a.M.length;e++){var f=a.M[e].nd;f&&(c||(c={}),c[e]=f,a.M[e].nd=null);if(f=a.M[e].Xa)d||(d={}),d[e]=f,a.M[e].Xa=null}a.id=0;a.nm=b;a.id=I.qh(a,b);if(c)for(var g in c)a.M[g].nd=c[g];if(d)for(g in d)a.M[g].Xa=d[g]}function O(a,b,d,e,f){var g=c("WIREFRAME");y(g,"wireframe.glslv","wireframe.glslf");
g.wireframe_mode=0;g.al=!0;g.U=!0;g.Bf=d;f&&(g.Do=!0);D(g,b);B(g,I.qh(b,0));e?(b=X.dp(1,a.A),S.ey(b,[a.Pe[0],a.Qe[1],a.Re[2]],a.A)):b=X.dp(a.sa,a.A);S.Hm(b,1,!0);b.D.a_polyindex=S.So(b);A(g,b);return g}function y(a,b,c){a.Ua={si:b,Ch:c,be:[]};fa.ny(a.Ua)}function H(a,b,c){1==a.M.length&&0==a.hc.length&&a.hc.push("default0");c=c||"default"+String(a.M.length);-1==a.hc.indexOf(c)&&(a.M.push(b),a.hc.push(c));a.Mb&&aa.Fn(a)}function L(a){if(!a.Ua)throw"No shaders info for batch "+a.name;a.Mb=fa.iw(a.Ua,
a.cm);aa.Ot(a.Mb);aa.En(a);aa.Fn(a)}function Z(a,b,c){var d=a.Ua;fa.G(d,"SHADOW_SRC",b);fa.G(d,"SHADOW_DST",c);return a}var J=p("__boundings"),F=p("__config"),U=p("__print"),K=p("__extensions"),S=p("__geometry"),T=p("__graph"),ba=p("__nodemat"),P=p("__objects"),ca=p("__particles"),X=p("__primitives");p("__reformer");var aa=p("__renderer"),w=p("__scenegraph");p("__scenes");var fa=p("__shaders"),ja=p("__textures"),N=p("__tsr"),I=p("__util"),Y=p("vec3"),ga=p("vec4"),qa=p("quat"),M=F.p,R=["MAIN","NODES"];
a.NB=c;a.Wv=function(a,d,f,g,h){for(var k=[],m=[],n=0;n<f.length;n++){var q=f[n];switch(q.d.type){case "DYNAMIC":k.push(q);break;case "STATIC":m.push(q)}}f=[];f=f.concat(b(k,a,h));d=f=f.concat(e(m,a,d,h));n=[];q=[];h={};for(f=0;f<d.length;f++){var m=d[f].n,x=d[f].Lb,k=null;if(m.id in h){var v=h[m.id],p=q[v].n,u=q[v].Lb,N=null,t=null;for(a=0;a<m.M.length;a++){var z=m.M[a].nd;z&&(N||(N={}),N[a]=z,m.M[a].nd=null);if(z=m.M[a].Xa)t||(t={}),t[a]=z,m.M[a].Xa=null}I.pr(m,p)&&I.pr(x,u)&&(k=q[v]);if(N)for(a in N)m.M[a].nd=
N[a];if(t)for(a in t)m.M[a].Xa=t[a];if(!k){do m.id++;while(h[m.id])}}k||(k={n:m,Lb:d[f].Lb,Bc:[],sr:[],ac:[]},h[m.id]=q.length,q.push(k));k.Bc=k.Bc.concat(d[f].Bc);d[f].gc&&d[f].gc.H&&k.sr.push(d[f].gc);if(k.ac.length)for(a=0;a<d[f].ac.length;a++)m=d[f].ac[a],-1==k.ac.indexOf(m)&&k.ac.push(m);else k.ac=d[f].ac}for(f=0;f<q.length;f++){d=q[f].sr;if(0==d.length)a=I.vb(I.gk("%empty"));else if(1==d.length)a=d[0];else{h=[];for(a=0;a<d.length;a++)S.ax(d[a])||h.push(a);if(h.length<d.length)for(a=0;a<h.length;a++)S.Hm(d[h[a]]);
a=S.dz(d)}n.push({n:q[f].n,Lb:q[f].Lb,gc:a,ac:q[f].ac,Bc:q[f].Bc})}f=n;for(n=0;n<f.length;n++)A(f[n].n,f[n].gc),f[n].n.yc=f[n].ac;a=[];for(n=0;n<f.length;n++)if(d=f[n].n,"STATIC"==f[n].Lb.type)q=I.Ep(I.gk("%meta")),q.d=f[n].Lb,q.V=[d],a.push(q);else for(h=[],k=0;k<f[n].Bc.length;k++)if(q=f[n].Bc[k],-1==h.indexOf(q.name)){for(m=0;m<q.V.length;m++)if(q.V[m]==d)throw"Batch already exist in object";q.V.push(d);h.push(q.name)}if(M.wireframe_debug){for(n=0;n<f.length;n++)d=f[n].Lb,"DYNAMIC"==d.type&&(q=
f[n].Bc[0],-1<R.indexOf(f[n].n.type)&&(d=O(d.Se,d,q.name,!0,!0),q.V.push(d)));for(n=0;n<a.length;n++)q=a[n],d=q.d,-1<R.indexOf(q.V[0].type)&&(d=O(d.wc,d,q.name,!1),q.V.push(d))}q=null;if(g.texture_slots)for(n=0;n<g.texture_slots.length;n++)if(g.texture_slots[n].texture.b4w_use_as_skydome){q=r(g.texture_slots[n],null);break}if(g.b4w_sky_settings.procedural_skydome||q)d=c("MAIN"),y(d,"special_skydome.glslv","special_skydome.glslf"),g.b4w_sky_settings.procedural_skydome?d.Fq=!0:H(d,q,"u_sky"),g.b4w_sky_settings.reflexible&&
(d.dc=!0,g.b4w_sky_settings.reflexible_only&&(d.Tb=!0)),l(d,"a_position"),d.Df=99999,g=X.Vv(),A(d,g),q=I.Ep(I.gk("%meta")),q.d=P.Yi("DYNAMIC"),q.d.gg=!0,q.d.Kb=J.cd(),q.d.wc=J.xi(),q.d.Ma=J.cd(),q.d.tb=J.xi(),q.V=[d],a.push(q);return a};a.Zz=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.Qt=g;a.fw=r;a.xk=function(a,b){z(a,"CSM_SECTION0",0);z(a,"CSM_SECTION1",0);z(a,"CSM_SECTION2",0);
z(a,"CSM_SECTION3",0);for(var c=0;c<b.csm_num;c++)z(a,"CSM_SECTION"+String(c),1);z(a,"SHADOW_TEX_RES",fa.s(b.csm_resolution));z(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);z(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.Z=z;a.ob=function(a,b){return fa.ow(a.Ua,b)};a.Ii=H;a.Yx=function(a,b,c){c=a.hc.indexOf(c);-1<c&&(a.M[c]=b)};a.Ou=function(a,b){var d=c("MAIN");d.va=!0;ga.set(b[0],b[1],b[2],.5,d.yb);d.vd=S.Ai;A(d,a);y(d,"main.glslv","main.glslf");z(d,"SHADELESS",1);L(d);return d};
a.Cb=L;a.eu=function(a){return a.Mb.Yh.length?a.Mb.im.u_cube_fog?!0:!1:!1};a.Pu=function(a,b){var d=c("DEPTH");d.qa=a.qa;d.Xc.set(a.Xc);d.Ca=a.Ca;d.lb=a.lb;d.id=a.id;d.nm=a.nm;a.M.length&&(d.M[0]=a.M[0],d.hc[0]=a.hc[0]);d.pd=a.pd;d.wj=a.wj;d.xj=a.xj;d.jj=a.jj;d.num_triangles=a.num_triangles;d.num_vertices=a.num_vertices;d.Bf=a.Bf;for(var e=0;e<a.yc.length;e++)d.yc.push(a.yc[e]);d.Oc=a.Oc;a.Eb||(a.Eb=[]);a.Eb.push(d);y(d,"depth.glslv","depth.glslf");fa.Rw(d.Ua,a.Ua);return d=Z(d,"SHADOW_SRC_NONE",
b)};a.Qm=Z;a.Cu=function(){var a=c("DEPTH_PACK");a.qa=!0;a.U=!1;var b=X.Ga();A(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");L(a);return a};a.yo=function(a){var b=c("POSTPROCESSING");y(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":z(b,"POST_EFFECT","POST_EFFECT_NONE");b.t[0]=1;b.t[1]=1;break;case "GRAYSCALE":z(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");b.t[0]=1;b.t[1]=1;break;case "X_BLUR":z(b,"POST_EFFECT","POST_EFFECT_X_BLUR");
b.t[0]=1;b.t[1]=0;break;case "Y_BLUR":z(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");b.t[0]=0;b.t[1]=1;break;case "X_EXTEND":z(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");b.t[0]=1;b.t[1]=0;break;case "Y_EXTEND":z(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");b.t[0]=0;b.t[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}b.qa=!0;b.U=!1;a=X.Ga();A(b,a);L(b);return b};a.WA=function(){var a=c("EDGE");a.U=!1;a.qa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ga();A(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");
L(a);return a};a.Tu=function(a){var b=c("SSAO");b.U=!1;b.qa=!0;b.t[0]=1;b.t[1]=1;var d=X.Ga();A(b,d);y(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");z(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.kr);z(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:ja.Zv(a)};d={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,
203,0,117,73,12,0])};a=r(a,d);H(b,a,"u_ssao_special_tex");L(b);return b};a.Uu=function(a){var b=c("SSAO_BLUR");b.U=!1;b.qa=!0;b.t[0]=1;b.t[1]=1;var d=X.Ga();A(b,d);y(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");z(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);L(b);return b};a.Du=function(){var a=c("DOF");a.U=!1;a.qa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ga();A(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");z(a,"DEPTH_RGBA",1);L(a);return a};a.Eu=function(){var a=
c("GLOW");a.U=!1;a.qa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ga();A(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");L(a);return a};a.Fu=function(a,b,d){var e=c("GOD_RAYS");e.U=!1;e.qa=!0;e.t[0]=1;e.t[1]=1;var f=X.Ga();A(e,f);y(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");z(e,"DEPTH_RGBA",a);z(e,"WATER_EFFECTS",b);z(e,"STEPS_PER_PASS",fa.s(d,1));L(e);return e};a.Gu=function(){var a=c("GOD_RAYS_COM");a.U=!1;a.qa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ga();A(a,b);y(a,"postprocessing/postprocessing.glslv",
"postprocessing/god_rays_combine.glslf");L(a);return a};a.Qu=function(){var a=c("SKY");a.U=!1;a.qa=!0;a.t[0]=1;a.t[1]=1;var b=X.Rv();A(a,b);y(a,"procedural_skydome.glslv","procedural_skydome.glslf");z(a,"NUM_LIGHTS",1);z(a,"WATER_EFFECTS",1);L(a);return a};a.wu=function(){var a=c("ANTIALIASING");a.U=!1;a.qa=!0;a.t[0]=1;a.t[1]=1;a.Yg=1/M.resolution_factor;var b=X.Ga();A(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");z(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");L(a);
return a};a.Ru=function(a){var b=c("SMAA"),d=X.Ga();A(b,d);y(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");z(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");z(b,"SMAA_PASS",a);z(b,"SMAA_PREDICATION",0);z(b,"SMAA_REPROJECTION",0);L(b);b.U=!1;b.qa=!0;b.t[0]=1;b.t[1]=1;b.Yg=1/M.resolution_factor;return b};a.Hu=function(a){var b=c("LANCZOS");b.U=!1;b.qa=!0;b.Yg=1/M.resolution_factor;"LANCZOS_X"==a?(b.t[0]=1,b.t[1]=0):"LANCZOS_Y"==a&&(b.t[0]=0,b.t[1]=1);a=X.Ga();A(b,a);y(b,"postprocessing/postprocessing.glslv",
"postprocessing/lanczos.glslf");L(b);return b};a.Au=function(){var a=c("COMPOSITING");a.U=!1;a.qa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ga();A(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");L(a);return a};a.Ku=function(a){var b=c("MOTION_BLUR");b.qa=!0;b.U=!1;var d=X.Ga();A(b,d);y(b,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");z(b,"BLUR_DECAY_THRESHOLD",fa.s(a));L(b);return b};a.vu=function(){var a=c("ANAGLYPH");a.qa=!0;a.U=!1;var b=X.Ga();A(a,
b);y(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");L(a);return a};a.Iu=function(){var a=c("LUMINANCE");a.U=!1;a.qa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ga();A(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");L(a);return a};a.xu=function(){var a=c("LUMINANCE");a.U=!1;a.qa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ga();A(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");L(a);return a};a.Ju=function(){var a=c("LUMINANCE_X_BLUR");
a.U=!1;a.qa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ga();A(a,b);y(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");L(a);return a};a.yu=function(a){var b=c("POSTPROCESSING");switch(a){case "X_BLUR":b.t[0]=1;b.t[1]=0;break;case "Y_BLUR":b.t[0]=0;b.t[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}b.qa=!0;b.U=!1;a=X.Ga();A(b,a);y(b,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");L(b);return b};a.zu=function(){var a=c("BLOOM");
a.U=!1;a.qa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ga();A(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");L(a);return a};a.Xu=function(){var a=c("VELOCITY");a.U=!1;a.qa=!0;a.t[0]=1;a.t[1]=1;var b=X.Ga();A(a,b);y(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");L(a);return a};a.li=function(a,b,c){var d=a.Yg;a.Km[0]=b*a.t[0]*d;a.Km[1]=c*a.t[1]*d};a.Lf=function(a,b){a.Yg=b};a.W=function(a,b,c){a=a.V;for(var d=null,e=0;e<a.length;e++){var f=a[e];if(-1<
f.yc.indexOf(b)&&(c&&f.type==c||!c)){if(f.Eb)return f;d=null===d?f:d}}return d};a.nu=function(a){for(var b=a.M,c=0;c<b.length;c++)ja.iv(b[c].Ka);S.jo(a.lb)}};b4w.module.__nodemat=function(a,p){function c(a,c,e){if(c in I)return I[c];for(var f=P.create(),l=a.nodes,r=a.links,q=a.animation_data,v=0;v<l.length;v++)if(!u(f,l[v],0,q))return I[c]=null;if(e&&-1==x(a,f,"GROUP_OUTPUT","group"))return null;v=Z(f);if(!J(f,r,v))return null;if(e)return f;for(v=0;v<r.length;v++){e=r[v];for(var l=g(e.from_node,f),q=g(e.to_node,f),p=0;p<l.length;p++)for(var A=0;A<q.length;A++){for(var N=l[p],t=q[A],z=P.Qa(f,N),F=P.Qa(f,t),y=f,w=F,F=[],Y=e.from_socket.identifier,B=e.to_socket.identifier,
E=z.Sa,z=0;z<E.length;z++)if(E[z].identifier==Y){F.push(z);break}w=w.F;for(z=0;z<w.length;z++)if(w[z].identifier==B){F.push(z);break}2==F.length&&P.Xd(y,N,t,F)}}d(f);a=x(a,f,"OUTPUT","material");if(-1==a)return I[c]=null;k(f);f=P.qr(f,a,P.fn);b(f);m(f);h(f);n(f);return I[c]=f}function b(a){P.P(a,function(b,c){for(var d=c.F,f=c.Sa,g=0;g<d.length;g++)e(a,d[g],b,g,1);for(g=0;g<f.length;g++)e(a,f[g],b,g,0)})}function e(a,b,c,d,e){if(b.Ed){var f=!0;P.De(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&
g[1]==d)f=!1});f&&(b.Ed=!1)}}function d(a){var b=[];P.P(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":P.De(a,function(a,e,f){a==c&&"Translucency"==d.Sa[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)P.Xd(a,b[c],b[c+1],b[c+2])}function g(a,b){var c=[];P.P(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function k(a){var b=[];P.P(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=
2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var g=f(a,d);if(-1!=g){var h=P.gj(a,g,0);P.Dg(a,g,d,-1);-1!=h&&P.Dg(a,h,g,-1);d=P.Qa(a,g);e.data=d.data;e.Aa[0]=d.Aa[0];P.Eg(a,g)}e.F.splice(1,1)}else if("REROUTE"==e.type){for(var e=P.gj(a,d,0),k=P.Bg(a,d),g=[],h=[],l=[],m=0;m<k;m++){var n=P.og(a,d,m),r=h.indexOf(n);-1!=r?l[r]+=1:(h.push(n),l.push(1),g.push(d,n))}if(-1!=e)for(k=P.ng(a,e,d,0)[0],m=0;m<h.length;m++)for(n=0;n<l[m];n++)r=P.ng(a,d,h[m],n)[1],P.Xd(a,e,h[m],[k,r]);for(m=0;m<g.length;m+=
2)P.Dg(a,g[m],g[m+1],-1)}}}function f(a,b){for(var c=a.ra,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function m(a){var b=[];P.P(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var k=c[h];if(r(f,k.ua)){g=[];h=P.Bg(a,e);for(n=0;n<h;n++){var l=P.og(a,e,n),m=P.ng(a,e,l,0);g.push(e,
l,m);P.Xd(a,k.id,l,m)}for(var n=0;n<g.length;n+=3)P.Dg(a,g[n],g[n+1],0);P.Eg(a,e);g=!1;break}}g&&(k={id:e,ua:f},c.push(k))}}function h(a){var b=[];P.P(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var k=c[h];if(!(3<=k.Ej.length)&&r(f,k.ua)){for(var h=[],l=P.Dp(a,e),g={},m=0;m<l;m++){var n=P.gj(a,e,m);n in g||(g[n]=0);var q=P.ng(a,n,e,g[n]++);h.push(n,e,q)}for(var l=[],g=P.Bg(a,e),
x={},m=0;m<g;m++)n=P.og(a,e,m),n in x||(x[n]=0),q=P.ng(a,e,n,x[n]++),l.push(e,n,q);for(var g=h.concat(l),m=0;m<g.length;m+=3)P.Dg(a,g[m],g[m+1],0);P.Eg(a,e);m={ua:f,qv:h,rv:l};k.Ej.push(m);g=!1;break}}g&&(k={id:e,ua:f,Ej:[]},c.push(k))}for(d=0;d<c.length;d++){k=c[d];e=k.Ej.length;l=k.ua.F.length;g=k.ua.Sa.length;for(h=0;h<e;h++){q=k.Ej[h];m=q.ua;f=q.qv;x=q.rv;k.ua.F=k.ua.F.concat(m.F);k.ua.Sa=k.ua.Sa.concat(m.Sa);for(m=0;m<k.ua.F.length;m++)k.ua.F[m].identifier+=X.trunc(m/l)+1;for(m=0;m<k.ua.Sa.length;m++)k.ua.Sa[m].identifier+=
X.trunc(m/g)+1;for(m=0;m<f.length;m+=3)n=f[m],q=f[m+2],q[1]+=(h+1)*l,P.Xd(a,n,k.id,q);for(m=0;m<x.length;m+=3)n=x[m+1],q=x[m+2],q[0]+=(h+1)*g,P.Xd(a,k.id,n,q)}switch(e){case 1:k.ua.type+="2";break;case 2:k.ua.type+="3";break;case 3:k.ua.type+="4"}P.Eg(a,k.id);P.wk(a,k.id,k.ua)}}function r(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==
b.data.value;default:return!1}}function n(a){var b=[];P.P(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],h=[],k=[[],[],[]],l=P.Bg(a,d),m=0;m<l;m++){var n=P.og(a,d,m);if("SEPRGB"!=P.Qa(a,n).type){f=!1;break}g.push(d,n);for(var r={},q=P.Bg(a,n),f=0;f<q;f++){var x=P.og(a,n,f);x in r||(r[x]=0);var v=P.ng(a,n,x,r[x]++);g.push(n,x);k[v[0]].push(d,x,v)}h.push(n);f=!0}if(f){for(m=d=l=0;m<k.length;m++)k[m].length&&(l++,d|=1<<2-m);if(l){e.type+=
l;e.Sa=[];for(m=0;m<k.length;m++)if(k[m].length)for(e.Sa.push({xb:0,identifier:"RGB"[m],Ed:!0,name:"RGB"[m]}),f=0;f<k[m].length;f+=3)k[m][f+2][0]=X.hi(d,m);for(m=0;m<g.length;m+=2)P.Dg(a,g[m],g[m+1],0);for(m=0;m<h.length;m++)P.Eg(a,h[m]);for(m=0;m<k.length;m++)for(f=0;f<k[m].length;f+=3)P.Xd(a,k[m][f],k[m][f+1],k[m][f+2])}}}}function x(a,b,c,d){a=a.nodes;for(var e=null,f=0;f<a.length;f++){var h=a[f];h.type==c&&(e=h)}return e?g(e,b)[0]:(ba.error('No "'+c+'" node in node '+d),-1)}function v(a,b,c,d){return{name:a,
type:b,inputs:c,outputs:d}}function u(a,b,c,d){var e=b.name,f=b.type,g=[],h=[],k=[],m=[],n=null,r=[];switch(f){case "CAMERA":h=[];k=y(b);break;case "COMBRGB":case "COMBHSV":h=O(b);k=y(b);break;case "GEOMETRY":a:{for(var f=b.outputs,x=0;x<f.length;x++)if(f[x].is_linked){f=!0;break a}f=!1}if(!f)return!0;f=z(b,c);if(!f)return ba.error("Geometry output is not supported"),!1;switch(f){case "GEOMETRY_UV":if(!b.uv_layer)return ba.error('Missing uv layer in node "',b.name,'"'),!1;n=l("param_GEOMETRY_UV_a");
x=l("param_GEOMETRY_UV_v");g.push(H(n));g.push(H(x));k.push(G(b,"UV"));m.push(H(x));n={name:n,value:b.uv_layer};break;case "GEOMETRY_VC":if(!b.color_layer)return ba.error("Missing vertex color layer in node ",b.name),!1;n=l("param_GEOMETRY_VC_a");x=l("param_GEOMETRY_VC_v");g.push(H(n));g.push(H(x));k.push(G(b,"Vertex Color"));m.push(H(x));n={name:n,value:b.color_layer};break;case "GEOMETRY_NO":k.push(G(b,"Normal"));break;case "GEOMETRY_FB":k.push(G(b,"Front/Back"));break;case "GEOMETRY_VW":k.push(G(b,
"View"));break;case "GEOMETRY_GL":k.push(G(b,"Global"))}break;case "GROUP":x=b.node_tree_name;switch(x){case "B4W_LINEAR_TO_SRGB":if(!E(b,[1],[1])){n=q(b);break}f="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!E(b,[1],[1])){n=q(b);break}f="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!E(b,[1],[1])){n=q(b);break}f="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!E(b,[1,1],[1])){n=q(b);break}f="B4W_REFLECT";break;case "B4W_REFRACTION":if(!E(b,[1,0],[1])){n=q(b);
break}f="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!E(b,[1,1,0,0,0],[1])){n=q(b);break}f="B4W_PARALLAX";if(!b.inputs[1].is_linked)return ba.error('Missing texture in node "',b.name,'"'),!1;var v=l("temp_texture");m.push(H(v));break;case "B4W_CLAMP":if(!E(b,[1],[1])){n=q(b);break}f="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!E(b,[0,0,0,0,0],[0])){n=q(b);break}f="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!E(b,[],[0])){n=q(b);break}f="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!E(b,[0,0,0],[0])){n=
q(b);break}f="B4W_SMOOTHSTEP";break;default:n=q(b)}h=O(b);k=y(b);"B4W_TRANSLUCENCY"==x&&(x=B("TranslucencyParams","TranslucencyParams",[0,0,0,0]),x.Ed=k[0].Ed,k.push(x));break;case "LAMP":n=b.lamp;if(!n)return ba.error("There is no lamp in node: "+b.name),!1;k.push(G(b,"Color"));k.push(G(b,"Light Vector"));k.push(G(b,"Distance"));k.push(G(b,"Visibility Factor"));n.uuid in Y?m.push(H(l("param_LAMP_lamp_index"),Y[n.uuid],1)):(Y[n.uuid]=ga,m.push(H(l("param_LAMP_lamp_index"),ga++,1)));n=Y;break;case "NORMAL":h=
O(b);k=y(b);x=G(b,"Normal");m.push(H(l("param_NORMAL_Normal"),x.xb,3));break;case "MAPPING":x=b.vector_type;f="MAPPING";h.push(A(b,"Vector"));k.push(G(b,"Vector"));var v=b.rotation,p=b.scale,N=b.translation,I=fa.create(),t=X.tv(v),F=new Float32Array([p[0],0,0,0,p[1],0,0,0,p[2]]);fa.multiply(t,F,I);I=X.kx(I,ja.create());switch(x){case "POINT":I[12]=N[0];I[13]=N[1];I[14]=N[2];break;case "TEXTURE":I[12]=N[0];I[13]=N[1];I[14]=N[2];I=ja.invert(I,I);break;case "NORMAL":ja.invert(I,I),ja.transpose(I,I)}switch(x){case "NORMAL":r.push(["MAPPING_IS_NORMAL",
1]);case "TEXTURE":r.push(["MAPPING_TRS_MATRIX",ca.s(I,16)]);break;case "POINT":0!==w.length(v)?r.push(["MAPPING_TRS_MATRIX",ca.s(I,16)]):(0!==w.length(p)&&r.push(["MAPPING_SCALE",ca.s(p,3)]),0!==w.length(N)&&r.push(["MAPPING_TRANSLATION",ca.s(N,3)]));break;case "VECTOR":0!==w.length(v)?r.push(["MAPPING_TRS_MATRIX",ca.s(I,16)]):0!==w.length(p)&&r.push(["MAPPING_SCALE",ca.s(p,3)])}b.use_min&&r.push(["MAPPING_MIN_CLIP",ca.s(b.min,3)]);b.use_max&&r.push(["MAPPING_MAX_CLIP",ca.s(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":n=
A(b,"Color");n.xb.splice(3);h.push(n);(n=A(b,"Alpha"))?h.push(n):h.push(B("Alpha","Alpha",1));n=A(b,"Spec");n.xb.splice(3);h.push(n);x=A(b,"Normal");x.xb.splice(3);h.push(x);k.push(G(b,"Color"));k.push(G(b,"Alpha"));k.push(G(b,"Normal"));"MATERIAL_EXT"==f&&((n=A(b,"Emit"))?h.push(n):h.push(B("Emit","Emit",0)),n=A(b,"Translucency"),n.xb=0,n.name="Translucency",n.identifier="Translucency",n?h.push(n):h.push(B(n.name,n.identifier,n.xb)),n=A(b,"Translucency"),n.xb=[0,0,0,0],n.name="TranslucencyParams",
n.identifier="TranslucencyParams",n?h.push(n):h.push(B(n.name,n.identifier,n.xb)),(n=A(b,"Ray Mirror"))?h.push(n):h.push(B("Ray Mirror","Ray Mirror",0)),(n=A(b,"SpecTra"))?h.push(n):h.push(B("SpecTra","SpecTra",0)),k.push(G(b,"Diffuse")),k.push(G(b,"Spec")));v=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":n=b.specular_hardness;break;case "WARDISO":n=b.specular_slope;break;case "TOON":n=b.specular_toon_size;v=b.specular_toon_smooth;break;default:ba.error("B4W Error: unsupported specular shader: "+
b.specular_shader+' (material "'+b.material_name+'")'),n=b.specular_hardness}switch(b.diffuse_shader){case "LAMBERT":N=p=0;break;case "OREN_NAYAR":p=b.roughness;N=0;break;case "FRESNEL":p=b.diffuse_fresnel;N=b.diffuse_fresnel_factor;break;default:ba.error("B4W Error: unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),N=p=0}m.push(H(l("param_MATERIAL_diffuse"),[p,N],2));m.push(H(l("param_MATERIAL_spec"),[b.specular_intensity,n,v],3));n={name:b.name,value:{Ty:b.specular_shader,
kv:b.diffuse_shader,Rf:b.use_shadeless,Mg:b.specular_alpha}};x.Ed&&r.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&r.push(["USE_MATERIAL_DIFFUSE",1]);b.use_specular&&r.push(["USE_MATERIAL_SPECULAR",1]);break;case "MATH":switch(b.operation){case "ADD":f="MATH_ADD";break;case "SUBTRACT":f="MATH_SUBTRACT";break;case "MULTIPLY":f="MATH_MULTIPLY";break;case "DIVIDE":f="MATH_DIVIDE";break;case "SINE":f="MATH_SINE";break;case "COSINE":f="MATH_COSINE";break;case "TANGENT":f="MATH_TANGENT";break;case "ARCSINE":f=
"MATH_ARCSINE";break;case "ARCCOSINE":f="MATH_ARCCOSINE";break;case "ARCTANGENT":f="MATH_ARCTANGENT";break;case "POWER":f="MATH_POWER";break;case "LOGARITHM":f="MATH_LOGARITHM";break;case "MINIMUM":f="MATH_MINIMUM";break;case "MAXIMUM":f="MATH_MAXIMUM";break;case "ROUND":f="MATH_ROUND";break;case "LESS_THAN":f="MATH_LESS_THAN";break;case "GREATER_THAN":f="MATH_GREATER_THAN";break;case "MODULO":f="MATH_MODULO";break;case "ABSOLUTE":f="MATH_ABSOLUTE";break;default:return ba.error("Unsupported MATH operation: "+
b.operation),!1}r.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);h=O(b);k=y(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":f="MIX_RGB_MIX";break;case "ADD":f="MIX_RGB_ADD";break;case "MULTIPLY":f="MIX_RGB_MULTIPLY";break;case "SUBTRACT":f="MIX_RGB_SUBTRACT";break;case "SCREEN":f="MIX_RGB_SCREEN";break;case "DIVIDE":f="MIX_RGB_DIVIDE";break;case "DIFFERENCE":f="MIX_RGB_DIFFERENCE";break;case "DARKEN":f="MIX_RGB_DARKEN";break;case "LIGHTEN":f="MIX_RGB_LIGHTEN";break;case "OVERLAY":f="MIX_RGB_OVERLAY";
break;case "DODGE":f="MIX_RGB_DODGE";break;case "BURN":f="MIX_RGB_BURN";break;case "HUE":f="MIX_RGB_HUE";break;case "SATURATION":f="MIX_RGB_SATURATION";break;case "VALUE":f="MIX_RGB_VALUE";break;case "COLOR":f="MIX_RGB_COLOR";break;case "SOFT_LIGHT":f="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":f="MIX_RGB_LINEAR_LIGHT";break;default:return ba.error("Unsupported MIX_RGB blend type: "+b.blend_type),!1}r.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);h=O(b);k=y(b);break;case "OUTPUT":h=O(b);k=[];
break;case "RGB":x=G(b,"Color");k.push(x);m.push(H(l("param_RGB_Color"),x.xb,3));break;case "SEPRGB":case "SEPHSV":h=O(b);k=y(b);break;case "TEXTURE":if(!b.texture)return ba.error("No texture attached to node: "+b.name),!1;a:{f=b.outputs;n=!1;for(x=0;x<f.length;x++)if(v=f[x],v.is_linked)switch(v.identifier){case "Color":f="ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";break a;case "Normal":f="TEXTURE_NORMAL";break a;case "Value":n=!0;break;default:throw"Unknown texture output";
}f=n?"ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR":void 0}h.push(A(b,"Vector"));if("TEXTURE_COLOR"==f||"TEXTURE_ENVIRONMENT"==f)k.push(G(b,"Color")),k.push(G(b,"Value"));if("TEXTURE_NORMAL"==f){if("ENVIRONMENT_MAP"==b.texture.type)return ba.error("Wrong output for ENVIRONMENT_MAP texture: "+b.name),!1;k.push(G(b,"Normal"));k.push(G(b,"Value"))}v=l("param_TEXTURE_texture");m.push(H(v));n={name:v,value:b.texture};break;case "VALUE":a:if(d){if(f=d.action)for(x in t=f.d.Aa,t)if(t=
x.match(/"(.*?)"/)[1],t==b.name){v=f.name+"_"+x;break a}v=d.nla_tracks;for(p=0;p<v.length;p++)for(N=v[p].strips,I=0;I<v[p].strips.length;I++)for(x in f=N[I].action,t=f.d.Aa,t)if(t=x.match(/"(.*?)"/)[1],t==b.name){v=f.name+"_"+x;break a}v=void 0}else v=null;x=G(b,"Value");v?(f="ANIM_VALUE",p={name:l("param_ANIM_VALUE_Value"),value:"0"},m.push(p),p={name:"-1",value:v},m.push(p)):(f="VALUE",m.push(H(l("param_value_value"),x.xb,1)));k.push(x);break;case "VECT_MATH":switch(b.operation){case "ADD":f="VECT_MATH_ADD";
break;case "SUBTRACT":f="VECT_MATH_SUBTRACT";break;case "AVERAGE":f="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":f="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":f="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":f="VECT_MATH_NORMALIZE";break;default:return ba.error("Unsupported VECT_MATH operation: "+b.operation),!1}h=O(b);k=y(b);break;default:h=O(b),k=y(b)}e={name:e,type:f,ui:g,F:h,Sa:k,Aa:m,data:n,xh:r};P.wk(a,P.cp(a),e);if(e="GEOMETRY"==b.type)a:{e=b.outputs;for(h=g=0;h<e.length;h++)if(e[h].is_linked&&
g++>c){e=!0;break a}e=!1}return e&&!u(a,b,++c,d)?!1:!0}function E(a,b,c){for(var d=a.inputs,e=a.outputs,f=a.node_tree_name,g=0;g<b.length;g++){var h=d[g],k=b[g];if(!h||h.default_value instanceof Array!=k)return ba.warn('B4W Warning: Wrong inputs for custom node group "'+a.name+'" of type: "',f,'".Processing as general node group.'),!1}for(g=0;g<c.length;g++)if(b=e[g],d=c[g],!b||b.default_value instanceof Array!=d)return ba.warn('B4W Warning: Wrong outputs for custom node group "'+a.name+'" of type: "',
f,'".Processing as general node group.'),!1;return!0}function q(a){var b=a.node_group.node_tree,d={},e;for(e in b)if("links"==e||"nodes"==e){d[e]=[];for(var f=0;f<b[e].length;f++){d[e][f]={};for(var g in b[e][f])if("links"==e){d[e][f][g]={};for(var h in b[e][f][g])d[e][f][g][h]=D(b[e][f][g][h])}else d[e][f][g]=D(b[e][f][g])}}else d[e]=D(b[e]);b=a.node_tree_name;if("B4W_REPLACE"==b||"B4W_LEVELS_OF_QUALITY"==b)e=v("Group input","GROUP_INPUT",[],a.inputs),f=v("Group output","GROUP_OUTPUT",a.outputs,
[]),g=null,g="B4W_REPLACE"==b||"B4W_LEVELS_OF_QUALITY"==b&&(qa.quality==aa.P_LOW||qa.ll)?{from_node:e,from_socket:e.outputs[1],to_node:f,to_socket:f.inputs[0]}:{from_node:e,from_socket:e.outputs[0],to_node:f,to_socket:f.inputs[0]},d.nodes=[e,f],d.links=[g];b=a.name;e=d.nodes;f=d.links;for(g=0;g<e.length;g++)e[g].name=L(e[g].type,b,e[g].name);for(g=0;g<f.length;g++)f[g].from_node.name=L(f[g].from_node.type,b,f[g].from_node.name),f[g].to_node.name=L(f[g].to_node.type,b,f[g].to_node.name);return{ux:c(d,
a.node_group.uuid,!0),vx:d.links}}function D(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?X.sh(a):a}function l(a){N[a]||(N[a]=0);var b=a+N[a],b=b.replace(/ /g,"_").replace(/\//g,"_");N[a]++;return b}function z(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";
case "Global":return"GEOMETRY_GL";default:return null}}}function A(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return t(e)}return null}function G(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return t(e)}return null}function t(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=X.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,Ed:d,xb:a}}function B(a,b,c){return{name:a,identifier:b,Ed:!1,xb:c}}function O(a){for(var b=[],
c=0;c<a.inputs.length;c++){var d=t(a.inputs[c]);d.xb.length&&d.xb.splice(3);b.push(d)}return b}function y(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=t(a.outputs[c]);b.push(d)}return b}function H(a,b,c){b=null===b||void 0===b?null:ca.s(b,c);return{name:a,value:b}}function L(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"*"+c}function Z(a){var b=[];P.P(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function J(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.ux,
f=c[d].data.vx;if(!e)return!1;P.P(e,function(b,c){P.wk(a,P.cp(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);T(c[d],b,a)}return!0}function F(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function U(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=c[e],g=null,h=0;h<b.length;h++)if(f.from_socket.identifier==b[h].to_socket.identifier){g=b[h];break}g?(f.from_node=g.from_node,
f.from_socket=g.from_socket):d.push(f)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function K(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function S(a,b,c,d){for(var e=0;e<d.length;e++){for(var f=d[e],h,k=0;k<c.F.length;k++)if(f.from_socket.identifier==c.F[k].identifier){h=c.F[k].xb;break}for(var k=f,l=b,m=h,n=g(k.to_node,l),r=0;r<n.length;r++)for(var q=P.Qa(l,n[r]),x=0;x<q.F.length;x++)if(q.F[x].identifier==k.to_socket.identifier){q.F[x].xb=
m;break}f=a.indexOf(f);-1!=f&&a.splice(f,1)}}function T(a,b,c){for(var d=a.name,e=[],f=[],g=[],h=[],k=0;k<b.length;k++){var l=b[k];F(l.from_node,d,l,e,g,h);F(l.to_node,d,l,f,g,h)}f=U(b,f,g);e=U(b,h,e);K(b,f);S(b,c,a,f);if(e.length){var m;P.P(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(m=b)});S(b,c,m,e)}}var ba=p("__print"),P=p("__graph"),ca=p("__shaders"),X=p("__util"),aa=p("__config"),w=p("vec3");p("vec4");var fa=p("mat3"),ja=p("mat4"),N={},I={},Y={},ga=0;new Float32Array(4);
var qa=aa.p;a.ou=c;a.pu=function(a){var b=[],c={};N={};var d=P.Mm(a);P.P(d,function(a,d){var e;e=[];for(var f=[],g=[],h=[],k=[],m=[],n=0;n<d.F.length;n++){var r=d.F[n];if(r.Ed)e.push(null),f.push(null);else{e.push(l("in_"+d.type+"_"+r.identifier));var q=ca.s(r.xb,0);qa.Zq&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==r.identifier||"Color2"==r.identifier||"Fac"==r.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==r.identifier||"Value_001"==r.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==
r.identifier)&&(r=q,r=r.replace(/(,)/g,"$1 "),r=r.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),r=r.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),q=r=r.replace(/\s+/g,""));f.push(q)}}for(n=0;n<d.Sa.length;n++)r=d.Sa[n],r.Ed?g.push(null):g.push(l("out_"+d.type+"_"+r.identifier));for(n=0;n<d.Aa.length;n++)r=d.Aa[n],h.push(r.name),k.push(r.value);for(n=0;n<d.ui.length;n++)m.push(d.ui[n].name);e={id:d.type,F:e,Gp:f,Sa:g,Aa:h,Mj:k,ui:m,xh:d.xh};b.push(e);c[a]=
e});P.De(d,function(a,b,e){var f=P.Qa(d,a);P.Qa(d,b);var g=f.Sa[e[0]];a=c[a].Sa;b=c[b].F;f=a[e[0]]||l("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.cleanup=function(){for(var a in I)delete I[a];for(var b in Y)delete Y[b];ga=0}};b4w.module.__animation=function(a,p){function c(a,b){var c=a.C[b];c&&c.il&&c.Bh&&(c.Bh=!1,c.il(a))}function b(a,b,c){c=a.C[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.$b=d;c.jd=b.name;for(e=d=0;e<a.data.b4w_vertex_anim.length;e++){var f=a.data.b4w_vertex_anim[e];if(f==b)break;else d+=f.frame_end-f.frame_start+1}c.Lr=d}function e(a,b,c){a=a.C[c];a.type=50;a.jd=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);
a.Oc=b}function d(a){return a.replace(/_B4W_BAKED$/,"")}function g(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:ca.fa("Wrong animation behavior")}}function k(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&d.animation_data&&(d=d.animation_data,d.action&&b.push(d.action))}return b}function f(a){return ca.is_mesh(a)&&a.d.lk?!0:!1}function m(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==
c.type)return c.object}return null}function h(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function r(a,b,d){D(a,b,d);c(a,d);a.d.Vd&&(A(a,b),z(a,b))}function n(a,b,c){var d=b.frame_range,e=b.d,f=a.C[c];f.jd=b.name;f.vn=d;f.pt=e.Dx;f.nt=e.St;f.start=d[0];f.length=d[1]-d[0];f.$b=d[0];d=ca.ff(e.Pi);if(ca.lf(a)&&d){f.type=10;var g=x(a,b);g||(g=G(a,b,E(a)),a.lh.push(b,g));f.g=g.g;f.pa=g.pa;var f=a.d,g=f.Yj,h=a.C[c],e=h.wm,k;a:{k=f.br;for(var l=0;l<k.length;l+=2)if(b==k[l]){k=
k[l+1];break a}k=null}if(k)h.wm=k;else{for(h=0;h<g.length;h++)k=G(a,b,g[h].nc),e.push(k);f.br.push(b,e)}f.Vd&&(b=f.fk,c>b[1]?(f=b[1],b[1]=c,b[0]=f):c>b[0]&&c<b[1]&&(b[0]=c),v(a))}else if(T.Fd(a)&&(e.Aa.volume||e.Aa.pitch))f.volume=e.Aa.volume||null,f.pitch=e.Aa.pitch||null,f.type=40;else if("MESH"==a.type&&q(b)){f.type=70;e=x(a,b);if(!e){e=[];h=[];k=b.d;l=a.d.Sh;for(g in k.Aa)for(var m=b.name+"_"+g,n=0;n<l.length;n+=2)if(m==l[n]){e.push(l[n+1]);h.push(k.Aa[g]);break}e={Qz:e,Rz:h};a.lh.push(b,e)}f.bq=
e.Qz;f.cq=e.Rz}else if(g=e.Aa.tsr){f.type=20;e=x(a,b);if(!e){e=b.d.fq;h=[];k=[];for(l=0;l<e;l++)h.push(g.subarray(8*l,8*l+4)),k.push(g.subarray(8*l+4,8*l+8));e={g:h,pa:k};a.lh.push(b,e)}f.g=e.g;f.pa=e.pa;F.sg(a)&&F.Kz(a,f.g,f.pa)}else K.warn('B4W Warning: Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),f.type=60;ca.lf(a)&&!d&&u(a,c)}function x(a,b){for(var c=a.lh,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function v(a){var b=a.d.fk;if(-1!=b[0]&&-1!=b[1]){var c=
a.C;a=c[b[1]].$b;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.$b;d=Math.floor(a);b.$b=d+e}}function u(a,b){var c=a.d.fk,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.C;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function E(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var e=b[d].name;c[e]={Sn:d,wh:d,jm:ca.vl(a,"name",e),Nr:-1}}return c}function q(a){a=a.d;for(var b in a.Aa)if(-1!=b.indexOf("nodes"))return!0;return!1}function D(a,b,c){if((c=
a.C[c])&&(c.play||0==b)){var d=a.d,e=c.$b,f=c.start,g=c.length,e=e+c.speed*b*aa.za,h=c.type,k=c.speed;if(0<=k&&e>=f+g||0>k&&e<f)switch(c.Bh=!0,c.behavior){case 10:e=0<=k?(e-f)%g+f:f+g-1E-6;break;case 20:e=0<=k?f:f+g-1E-6;c.play=!1;break;case 30:e=0<=k?f+g-1E-6:f,c.play=!1}c.$b=e;switch(h){case 10:if(!d.Vd){e=l(c,e,w);b=e[0];f=e[1];e=e[2];d.cc=c.pa[b];d.bc=c.pa[f];d.kc=c.g[b];d.jc=c.g[f];d.cf=e;d=d.Yj;c=c.wm;for(g=0;g<d.length;g++)h=d[g],k=c[g],h.cc=k.pa[b],h.bc=k.pa[f],h.kc=k.g[b],h.jc=k.g[f],h.cf=
e;ba.v(a)}break;case 20:h=e=l(c,e,w);(d=fa)||(d=new Float32Array(4));var f=h[0],g=h[1],h=h[2],k=c.g,m=k[f][1],n=k[f][2],r=k[g][1],q=k[g][2];d[0]=(1-h)*k[f][0]+h*k[g][0];d[1]=(1-h)*m+h*r;d[2]=(1-h)*n+h*q;f=e;(g=N)||(g=new Float32Array(4));h=c.pa;X.slerp(h[f[0]].subarray(0,4),h[f[1]].subarray(0,4),f[2],g);f=g;g=e[2];h=c.g;e=(1-g)*h[e[0]][3]+g*h[e[1]][3];c.Nm&&(g=ja,ba.get_translation(a,g),ca.smooth_v(d,g,b,c.Nm,d));c.lm&&(g=I,ba.get_rotation(a,g),ca.er(f,g,b,c.lm,f));ba.set_translation(a,d);ba.set_rotation(a,
f);ba.set_scale(a,e);ba.v(a);U.sync_transform(a);break;case 30:(a=w)||(a=Array(3));f=e-c.start;0>f&&(f=0);f>=c.length&&(f=c.length);b=Math.floor(f);e=b+1;f-=b;10!=c.behavior&&e==c.length&&(e=b-=1,f=1);c=c.Lr;a[0]=b+c;a[1]=e+c;a[2]=f;e=w;d.Tm=e[0];d.Kr=e[2];break;case 40:e=l(c,e,w);b=e[0];d=e[1];e=e[2];c.volume&&T.set_volume(a,(1-e)*c.volume[b]+e*c.volume[d]);c.pitch&&T.playrate(a,(1-e)*c.pitch[b]+e*c.pitch[d]);break;case 50:F.yy(c.Oc,e/aa.za);break;case 70:e=l(c,e,w);b=e[0];d=e[1];e=e[2];f=c.cq;c=
c.bq;for(g=0;g<c.length;g++)h=f[g],a.d.yf[c[g]]=(1-e)*h[b]+e*h[d];break;case 60:break;default:throw"Unknown animation type:"+h;}}}function l(a,b,c){c||(c=Array(3));var d=a.vn[0],e=a.vn[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.pt;e=Math.floor(b);a=a.nt[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function z(a,b){var c=a.d,d=c.Ud,e=c.fk,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var g=a.C[f];if(g.play||0==b)var h=l(g,g.$b,w),k=h[0],m=h[1],h=h[2],n=g.pa[k],r=g.pa[m],k=g.g[k],m=g.g[m];else d=1}else d=1;e=a.C[e];if(e.play||
0==b)var h=l(e,e.$b,w),q=h[0],x=h[1],h=h[2];else if(-1!=f&&g.play)d=0;else return;f=e.pa[q];g=e.pa[x];q=e.g[q];e=e.g[x];if(1==d)c.cc.set(f),c.bc.set(g),c.kc.set(q),c.jc.set(e);else if(0==d)c.cc.set(n),c.bc.set(r),c.kc.set(k),c.jc.set(m);else{for(x=0;x<n.length;x+=4){for(var v=N,p=I,u=0;4>u;u++)v[u]=n[x+u],p[u]=f[x+u];X.slerp(v,p,d,v);for(u=0;4>u;u++)c.cc[x+u]=v[u];for(u=0;4>u;u++)v[u]=r[x+u],p[u]=g[x+u];X.slerp(v,p,d,v);for(u=0;4>u;u++)c.bc[x+u]=v[u]}ca.On(k,q,d,c.kc);ca.On(m,e,d,c.jc)}ba.v(a);d=
c.Yj;n=c.Zp;for(x=0;x<d.length;x++){r=d[x];k=n[x];for(m=0;m<k.length;m+=2)for(q=k[m],f=k[m+1],g=0;4>g;g++)r.cc[q+g]=c.cc[f+g],r.bc[q+g]=c.bc[f+g],r.kc[q+g]=c.kc[f+g],r.jc[q+g]=c.jc[f+g];r.cf=h}}}function A(a,b){var c=a.d,d=c.Ud,e=c.vk;if(0!=e){var d=c.uk-d,f=e*b;ca.sign(d)==ca.sign(e)&&Math.abs(f)<Math.abs(d)?c.Ud+=f:(c.Ud=c.uk,c.vk=0)}}function G(a,b,c){for(var d=a.pose.bones,e=[],f=[],g=b.d.fq,h=0;h<g;h++){for(var k=0;k<d.length;k++){var l=d[k],m=P.create(),n=b.d.Pi[l.name];n&&P.copy(n.subarray(8*
h,8*h+8),m);l.tn=m;l.Fi=!1}k=t(a,c);e.push(k.g);f.push(k.pa)}return{g:e,pa:f}}function t(a,b){var c=[],d=[],e=a.pose.bones,f=new Float32Array(4),g=new Float32Array(4),h;for(h in b){var k=b[h],l=k.wh,m=e[k.jm],k=f,n=g,r=m.gt,q=r[r.length-1],x=q.rk;q.Fi||P.identity(x);for(q=r.length-1;0<=q;q--){var m=r[q],v=m.rk;if(m.Fi)x=v;else{var p=m.un,u=m.tn;P.invert(p,Y);P.multiply(u,Y,Y);P.multiply(p,Y,Y);P.multiply(x,Y,v);x=v;m.Fi=!0}}m=m.rk;k[0]=m[0];k[1]=m[1];k[2]=m[2];k[3]=m[3];n[0]=m[4];n[1]=m[5];n[2]=m[6];
n[3]=m[7];X.normalize(n,n);for(k=0;4>k;k++)n=4*l+k,c[n]=f[k],d[n]=g[k]}c=new Float32Array(c);d=new Float32Array(d);return{g:c,pa:d}}function B(a,b,c,d,e,f,g){var h=a+(b-a)/2,k=O(h,d,e,f,g)-c;return.02>Math.abs(k)?h:0<k?B(a,h,c,d,e,f,g):B(h,b,c,d,e,f,g)}function O(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function y(a,b){a.C||(a.C=[null,null,null,null,null,null,null,null]);a.C[b]={type:null,jd:null,pa:null,g:null,wm:[],play:!1,behavior:20,$b:0,start:0,length:0,Nm:0,lm:0,Bh:!1,
Lr:null,speed:1,volume:null,pitch:null,cq:[],bq:[]};a.lh=a.lh||[];-1==ga.indexOf(a)&&ga.push(a)}function H(a,b){ba.v(a);U.sync_transform(a);r(a,0,b)}function L(a,c,d){d=d||0;if(ca.is_mesh(a)){var f=ca.keysearch("name",c,a.data.b4w_vertex_anim);if(f)return y(a,d),b(a,f,d),H(a,d),!0;if((f=ca.keysearch("name",c,a.particle_systems))&&"EMITTER"==f.settings.type)return y(a,d),e(a,f,d),H(a,d),!0}if(f=ca.keysearch("name",c,qa)||ca.keysearch("name",c+"_B4W_BAKED",qa)){if(!ca.ff(f.fcurves))return K.error('No fcurves in action "'+
f.name+'"'),!1;y(a,d);n(a,f,d);H(a,d);return!0}K.error('Unsupported object: "',a.name,'" or animation name: "',c,'"');return!1}function Z(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&d.animation_data)return!0}return!1}var J=p("__config"),F=p("__particles"),U=p("__physics"),K=p("__print"),S=p("__scenes"),T=p("__sfx"),ba=p("__transform"),P=p("__tsr"),ca=p("__util");p("mat4");var X=p("quat");p("vec4");
var aa=J.hd;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_STATIC=60;a.OBJ_ANIM_TYPE_MATERIAL=70;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var w=Array(3),fa=new Float32Array(3),ja=new Float32Array(3),N=new Float32Array(4),I=new Float32Array(4),Y=new Float32Array(8);new Float32Array(16);
var ga=[],qa=[];a.frame_to_sec=function(a){return a/aa.za};a.update=function(a){for(var b=0;b<ga.length;b++){for(var d=ga[b],e=0;8>e;e++)D(d,a,e);d.d.Vd&&(A(d,a),z(d,a))}for(b=0;b<ga.length;b++)for(d=ga[b],e=0;8>e&&d.C;e++)c(d,e)};a.aw=function(){return qa};a.mw=function(a,b){var c=a.C[b];return c&&c.jd?d(c.jd):null};a.get_anim_names=function(a){var b=[];if(f(a))for(var c=0;c<a.data.b4w_vertex_anim.length;c++)b.push(a.data.b4w_vertex_anim[c].name);var e,c=[];for(e=0;e<qa.length;e++){var g=qa[e],h=
g.d;ca.ff(g.d.Pi)?"ARMATURE"==a.type&&c.push(g):h.Aa.volume||h.Aa.pitch?T.Fd(a)&&c.push(g):q(g)||c.push(g)}"MESH"==a.type&&(c=c.concat(k(a)));e=c;for(c=0;c<e.length;c++)b.push(d(e[c].name));if(F.sg(a)&&F.pj(a))for(c=0;c<a.particle_systems.length;c++)b.push(a.particle_systems[c].name);return b};a.az=d;a.get_anim_type=function(a,b){var c=a.C[b];return c?c.type:null};a.apply_def=function(a){var c=0,d;d=[];var h=a.animation_data;if(h&&h.action){var l=ca.ff(h.action.d.Pi);"ARMATURE"!=a.type&&l||d.push(h.action)}T.Fd(a)&&
a.data.animation_data&&a.data.animation_data.action&&d.push(a.data.animation_data.action);"MESH"==a.type&&(d=d.concat(k(a)));for(h=0;h<d.length;h++)l=d[h],ca.ff(l.fcurves)?(y(a,c),n(a,l,c),H(a,c),a.C[c].behavior=g(a.b4w_anim_behavior),c++):K.error('No fcurves in action "'+l.name+'"');l=a.particle_systems;for(h=0;h<l.length;h++){var m=l[h],r=m.settings;"EMITTER"==r.type&&(y(a,c),e(a,m,c),H(a,c),a.C[c].behavior=g(a.b4w_anim_behavior),r.b4w_cyclic&&(a.C[c].behavior=10),c++)}f(a)?(y(a,c),b(a,a.data.b4w_vertex_anim[0],
c),H(a,c),a.C[c].behavior=g(a.b4w_anim_behavior)):d.length||F.pj(a)||(y(a,0),d=a.C[0],d.type=60,d.jd=a.name+"_STATIC",h=S.vw(S.get_active()),d.start=h[0],d.length=h[1]-h[0]+1,H(a,c))};a.get_first_armature_object=m;a.play=function(a,b,c){h(a.C,c,function(a){a.play=!0;a.il=b?b:null;a.Bh=!1});a.d.Vd&&v(a)};a.stop=function(a,b){h(a.C,b,function(a){a.play=!1;a.il=null;a.Bh=!1})};a.is_play=function(a,b){var c=a.C[b];return c?c.play:!1};a.set_current_frame_float=function(a,b,c){var d=a.C;if(-1==c)for(c=
0;8>c;c++){var e=d[c];e&&(e.$b=b,r(a,0,c))}else if(e=d[c])e.$b=b,r(a,0,c)};a.get_current_frame_float=function(a,b){var c=a.C[b];return c&&c.$b?c.$b:0};a.is_cyclic=function(a,b){var c=a.C[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){h(a.C,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.C[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){h(a.C,d,function(a){a.Nm=b||0;a.lm=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.C[c]=null;
else a.C[b]=null;a.d.Vd&&u(a,b)};a.update_object_animation=r;a.sj=function(a){if("ARMATURE"==a.type||m(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||F.sg(a)&&F.pj(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||Z(a)?!0:!1};a.is_animated=function(a){return a.C?!0:!1};a.Zt=E;a.Vn=t;a.rt=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);X.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=
0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):(d=-1<a.indexOf("scale")?3:0,e=0);return d+e}function d(a,b,c,e){if(-1<c.search(f)){a=b;c=c.split('"')[1];var h=g}else-1<c.indexOf("location")?(c="tsr",h=g):-1<c.indexOf("rotation_quaternion")?(c="tsr",h=g):-1<c.indexOf("scale")?(c="tsr",h=g):h=0;if(!a[c]){b=a;var k=c;if("object"==typeof h&&h.length)for(var l=h.length,m=new Float32Array(e*l),n=0;n<e;n++)for(var r=0;r<l;r++)m[n*l+r]=h[r];else if("number"==typeof h)for(m=new Float32Array(e),
n=0;n<e;n++)m[n]=h;else throw"Wrong storage default value";b[k]=m}return a[c]}a.d={};var e=a.d;e.Dx=1/aa.df;var f=new RegExp(/pose.bones\[\".+\"\]/g),g=P.create(),h=a.fcurves,k={},l={},m=0,n;for(n in h){var r=h[n],q;for(q in r){var x=r[q].Xb;m||(m=x.length);for(var v=d(k,l,n,m),p=v.length/m,u=c(n,q|0),N=0;N<m;N++)v[N*p+u]=x[N]}}for(var A in k)"tsr"==A&&b(k[A],m);for(var I in l)b(l[I],m);e.Aa=k;e.Pi=l;e.St=a.ft;e.fq=m;qa.push(a)};a.ew=function(a,b){return(b-a)*aa.df+1};a.Jt=function(a,b,c,d,e,f){var g,
h,k=new Float32Array(2),l=new Float32Array(2),m=new Float32Array(2),n=new Float32Array(2),r=b[1],q=b[2],x=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var v=0,p=0,u=null;e<=f;e++)if(e<r)for(var N=0;N<aa.df;N++)c[v++]=q;else if(e>x)for(N=0;N<aa.df;N++)c[v++]=a;else{var A=b[p],I=3;0===A&&(I+=2);0===u&&(I+=2);var t=2===A?0:1;if(b[p+1]==b[p+I+1])u=A,p+=I;else{N=0;e==b[p+1]&&(t&&(d[v]=1),c[v]=b[p+2],v++,N++);if(e==x)for(;N<aa.df;N++)c[v++]=a;else for(k[0]=b[p+1],k[1]=b[p+2],0!==A?(l[0]=0,l[1]=
0):0===u?(l[0]=b[p+5],l[1]=b[p+6]):(l[0]=b[p+3],l[1]=b[p+4]),0!==A?(m[0]=0,m[1]=0):(m[0]=b[p+I+3],m[1]=b[p+I+4]),n[0]=b[p+I+1],n[1]=b[p+I+2];N<aa.df;N++){var z=e+N/aa.df;switch(A){case 0:g=k;h=l;var F=m,y=n,w=[],Y=[],E=void 0,D=void 0,G=void 0,E=void 0;w[0]=g[0]-h[0];w[1]=g[1]-h[1];Y[0]=y[0]-F[0];Y[1]=y[1]-F[1];G=y[0]-g[0];E=Math.abs(w[0]);D=Math.abs(Y[0]);0!=E+D&&E+D>G&&(E=G/(E+D),h[0]=g[0]-E*w[0],h[1]=g[1]-E*w[1],F[0]=y[0]-E*Y[0],F[1]=y[1]-E*Y[1]);t&&(d[v]=1);c[v]=O(B(0,1,z,k[0],l[0],m[0],n[0]),
k[1],l[1],m[1],n[1]);v++;break;case 1:h=k[0];F=k[1];g=y=(n[1]-F)/(n[0]-h);h=F-y*h;t&&(d[v]=1);c[v]=g*z+h;v++;break;case 2:t&&(d[v]=1);c[v]=b[p+2];v++;break;default:throw"Unknown keyframe intepolation mode: "+A;}}e+1==b[p+I+1]&&(u=A,p+=I)}}};a.lB=function(a){for(var b=0;b<a.length;b++)if(a[b].wA)return a[b];return!1};a.apply=L;a.get_slot_num_by_anim=function(a,b){for(var c=a.C,e=0;e<c.length;e++){var f=c[e];if(f&&d(f.jd)==d(b))return e}return-1};a.cw=function(a,b){var c=a.C[b];return c&&c.jd?d(c.jd):
null};a.remove=function(a){a.C=null;a=ga.indexOf(a);-1!=a&&ga.splice(a,1)};a.Sx=function(a){for(var b=qa.length-1;0<=b;b--)qa[b].ht==a&&qa.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.C)return L(a,b,0)?0:-1;for(var c=0;c<a.C.length;c++)if(!a.C[c])return L(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.d.vk=(b-a.d.Ud)/c;a.d.uk=b};a.set_speed=function(a,b,c){h(a.C,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.C[b].speed};a.get_anim_start_frame=function(a,b){return a.C[b].start};
a.get_anim_length=function(a,b){return a.C[b].length};a.Cl=Z;a.cleanup=function(){ga.length=0;qa.length=0};a.Cv=function(a,b){var c=a[b],d=(c[0]||c[1]||c[2]).Xb.length,e=N,f=fa,g=Boolean(c[0]);g||(c[0]={Xb:new Float32Array(d)});var h=Boolean(c[1]);h||(c[1]={Xb:new Float32Array(d)});var k=Boolean(c[2]);k||(c[2]={Xb:new Float32Array(d)});c[3]={Xb:new Float32Array(d)};for(var l=0;l<d;l++)f[0]=g?c[0].Xb[l]:0,f[1]=h?c[1].Xb[l]:0,f[2]=k?c[2].Xb[l]:0,ca.euler_to_quat(f,e),c[0].Xb[l]=e[3],c[1].Xb[l]=e[0],
c[2].Xb[l]=e[1],c[3].Xb[l]=e[2];d=b.replace("euler","quaternion");a[d]=c;delete a[b]}};b4w.module.__time=function(a,p){p("__util");var c=0,b=0,e=[],d=0;a.Uq=function(a){c=a;b=performance.now();for(a=0;a<e.length;a++){var d=e[a];c>d.vv&&(e.splice(a,1),a--,d.callback())}};a.pg=function(){return c};a.Vq=function(a,k){var f;d++;f=d;e.push({id:f,callback:a,vv:c+(performance.now()-b+k)/1E3});return f};a.Ui=function(a){for(var b=0;b<e.length;b++)if(e[b].id==a){e.splice(b,1);break}};a.reset=function(){b=c=0;d=e.length=0}};b4w.module.__transform=function(a,p){function c(a){var n=a.d;d.yz(a,l);e.wz(a);if("CAMERA"==a.type&&(e.mu(a),n.O==e.MS_TARGET_CONTROLS)){var q=r.quat_to_dir(n.quat,r.AXIS_Z,E);n.bk=0<q[1]}var q=n.g,x=n.scale,v=n.quat;h.ki(q,x,v,n.Pd);var p=n.K;u.identity(p);u.fromQuat(v,p);"CAMERA"!=a.type&&r.dy(p,x,p);p[12]=q[0];p[13]=q[1];p[14]=q[2];u.invert(p,n.Hp);a.C&&k.pj(a)&&k.zz(a);n.Kb&&n.Ma&&(b.Gk(n.Kb,p,n.Ma),b.Ik(n.wc,p,n.tb),b.Hk(n.Se,n.Pd,n.Te),n.Ub&&f.rm(f.get_active()));switch(a.type){case "SPEAKER":m.Sy(a,
l);break;case "CAMERA":e.Dr(a);f.Y()&&f.sl(f.get_active())==a&&m.fx(f.get_active(),q,v,l);break;case "LAMP":g.Bz(a);f.Y()&&f.Of(a,f.get_active());break;case "EMPTY":a.field&&f.Fr(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!f.Y()||(n=f.get_active(),f.rm(n),f.hy(n));a=a.Sd;for(n=0;n<a.length;n++)c(a[n])}var b=p("__boundings"),e=p("__camera"),d=p("__constraints"),g=p("__lights"),k=p("__particles"),f=p("__scenes"),m=p("__sfx"),h=p("__tsr"),r=p("__util"),n=p("vec3"),x=p("quat"),v=p("mat3"),u=p("mat4"),E=new Float32Array(3),
q=new Float32Array(4),D=new Float32Array(9),l=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){l=a};a.set_translation=function(a,b){d.Bd(a)==d.dd?h.zy(b,d.Ad(a)):a.d.g.set(b)};a.get_translation=function(a,b){d.Bd(a)==d.dd?n.copy(h.pp(d.Ad(a)),b):n.copy(a.d.g,b)};a.set_rotation=function(a,b){d.Bd(a)==d.dd?h.um(b,d.Ad(a)):a.d.quat.set(b)};a.get_rotation=function(a,b){d.Bd(a)==d.dd?x.copy(h.lp(d.Ad(a)),b):x.copy(a.d.quat,b)};a.set_rotation_euler=function(a,b){if(d.Bd(a)==d.dd){var c=r.euler_to_quat(b,
q);h.um(c,d.Ad(a))}else r.euler_to_quat(b,a.d.quat)};a.set_scale=function(a,b){d.Bd(a)==d.dd?h.set_scale(b,d.Ad(a)):a.d.scale=b};a.get_scale=function(a){return d.Bd(a)==d.dd?h.get_scale(d.Ad(a)):a.d.scale};a.Bw=function(a,b){if(d.Bd(a)==d.dd)h.copy(d.Ad(a),b);else{var c=a.d;h.ki(c.g,c.scale,c.quat,b)}};a.Wq=function(a,b){if(d.Bd(a)==d.dd)h.copy(b,d.Ad(a));else{var c=a.d;c.g[0]=b[0];c.g[1]=b[1];c.g[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}};a.get_object_size=
function(a){var b=a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(b=a.d,n.copy(b.tb.A,c)):(b=a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,n.transformMat4(c,b.K,c));return c};a.move_local=function(a,b,c,d){a=a.d;var e=E;e[0]=b;e[1]=c;e[2]=d;b=v.fromMat4(a.K,D);n.transformMat3(e,
b,e);n.add(a.g,e,a.g)};a.v=c;a.distance=function(a,b){return n.dist(a.d.g,b.d.g)};a.zx=function(a,b){return n.dist(a.d.g,b)};a.get_object_bounding_box=function(a){return{max_x:a.d.Ma.max_x,min_x:a.d.Ma.min_x,max_y:a.d.Ma.max_y,min_y:a.d.Ma.min_y,max_z:a.d.Ma.max_z,min_z:a.d.Ma.min_z}}};b4w.module.__tsr=function(a,p){function c(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function b(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],k=b[4],q=b[5],p=b[6];b=b[7];var l=a[0]*g,z=a[1]*g,A=a[2]*g;a=b*l+q*A-p*z;var g=b*z+p*l-k*A,G=b*A+k*z-q*l,l=-k*l-q*z-p*A;c[0]=a*b+l*-k+g*-p-G*-q;c[1]=g*b+l*-q+G*-k-a*-p;c[2]=G*b+l*-p+a*-q-g*-k;c[0]+=d;c[1]+=e;c[2]+=f;return c}var e=p("__util"),d=p("vec3"),g=p("quat");p("mat4");var k=new Float32Array(3),f=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.eg=function(a,b,d,e){e||(e=new Float32Array(8));c(a,b,d,e);return e};a.ki=c;a.zy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.Ay=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.um=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.pp=function(a){return a.subarray(0,
3)};a.get_scale=function(a){return a[3]};a.lp=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],e=a[1],k=a[2];f[0]=a[4];f[1]=a[5];f[2]=a[6];f[3]=a[7];g.invert(f,f);var p=f[0],E=f[1],q=f[2],D=f[3],d=d*c,e=e*c,l=k*c,k=D*d+E*l-q*e,z=D*e+q*d-p*l,A=D*l+p*e-E*d,d=-p*d-E*e-q*l;b[0]=-(k*D+d*-p+z*-q-A*-E);b[1]=-(z*D+d*-E+A*-p-k*-q);b[2]=-(A*D+d*-q+k*-E-z*-p);b[3]=c;b[4]=p;b[5]=E;b[6]=q;b[7]=D;return b};a.ap=function(a,b){var d=e.xf(a,k),g=e.Bj(a),x=e.matrix_to_quat(a,
f);c(d,g,x,b);return b};a.multiply=function(a,c,d){b(c,a,d);d[3]=a[3]*c[3];var e=a[4],f=a[5],g=a[6];a=a[7];var k=c[4],p=c[5],q=c[6];c=c[7];d[4]=e*c+a*k+f*q-g*p;d[5]=f*c+a*p+g*k-e*q;d[6]=g*c+a*q+e*p-f*k;d[7]=a*c-e*k-f*p-g*q;return d};a.oi=b;a.ek=function(a,b,c,d){d||(d=0);var e=a.length,f=b[0],g=b[1],k=b[2],q=b[3],p=b[4],l=b[5],z=b[6];b=b[7];for(var A=0;A<e;A+=3){var G=a[A]*q,t=a[A+1]*q,B=a[A+2]*q,O=b*G+l*B-z*t,y=b*t+z*G-p*B,H=b*B+p*t-l*G,G=-p*G-l*t-z*B;c[d+A]=O*b+G*-p+y*-z-H*-l;c[d+A+1]=y*b+G*-l+
H*-p-O*-z;c[d+A+2]=H*b+G*-z+O*-l-y*-p;c[d+A]+=f;c[d+A+1]+=g;c[d+A+2]+=k}};a.yr=function(a,b,c,d){d||(d=0);var e=a.length,f=b[3],g=b[4],k=b[5],q=b[6];b=b[7];for(var p=0;p<e;p+=3){var l=a[p]*f,z=a[p+1]*f,A=a[p+2]*f,G=b*l+k*A-q*z,t=b*z+q*l-g*A,B=b*A+g*z-k*l,l=-g*l-k*z-q*A;c[d+p]=G*b+l*-g+t*-q-B*-k;c[d+p+1]=t*b+l*-k+B*-g-G*-q;c[d+p+2]=B*b+l*-q+G*-k-t*-g}};a.dk=function(a,b,c){var d=b[3],e=b[4],f=b[5],g=b[6];b=b[7];var k=a[0]*d,q=a[1]*d,p=a[2]*d;a=b*k+f*p-g*q;var d=b*q+g*k-e*p,l=b*p+e*q-f*k,k=-e*k-f*q-
g*p;c[0]=a*b+k*-e+d*-g-l*-f;c[1]=d*b+k*-f+l*-e-a*-g;c[2]=l*b+k*-g+a*-f-d*-e};a.zr=function(a,b,c,d){d||(d=0);var e=a.length,f=b[3],g=b[4],k=b[5],q=b[6];b=b[7];for(var p=0;p<e;p+=4){var l=a[p]*f,z=a[p+1]*f,A=a[p+2]*f,G=b*l+k*A-q*z,t=b*z+q*l-g*A,B=b*A+g*z-k*l,l=-g*l-k*z-q*A;c[d+p]=G*b+l*-g+t*-q-B*-k;c[d+p+1]=t*b+l*-k+B*-g-G*-q;c[d+p+2]=B*b+l*-q+G*-k-t*-g;c[d+p+3]=a[p+3]}};a.translate=function(a,b,c){var d=a[3],e=a[4],f=a[5],g=a[6],k=a[7],q=b[0]*d,p=b[1]*d,l=b[2]*d;b=k*q+f*l-g*p;var d=k*p+g*q-e*l,z=
k*l+e*p-f*q,q=-e*q-f*p-g*l;c[0]=a[0]+b*k+q*-e+d*-g-z*-f;c[1]=a[1]+d*k+q*-f+z*-e-b*-g;c[2]=a[2]+z*k+q*-g+b*-f-d*-e;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.QB=function(a,b,c,e){e||(e=new Float32Array(8));d.lerp(a.subarray(0,3),b.subarray(0,3),c,e.subarray(0,3));var f=a[3];e[3]=f+c*(b[3]-f);g.slerp(a.subarray(4),b.subarray(4),c,e.subarray(4));return e};a.iB=function(a,b,c,d){d||(d=new Float32Array(8));var e=a.subarray(0,3),f=b.subarray(0,3),k=d.subarray(0,3);k[0]=f[0]*(c+1)-e[0]*
c;k[1]=f[1]*(c+1)-e[1]*c;k[2]=f[2]*(c+1)-e[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);e=d.subarray(4);e[0]=b[0]*(c+1)-a[0]*c;e[1]=b[1]*(c+1)-a[1]*c;e[2]=b[2]*(c+1)-a[2]*c;e[3]=b[3]*(c+1)-a[3]*c;g.normalize(e,e);return d};a.Tw=function(a,b,c,d,e){var f=a.subarray(0,3),k=e.subarray(0,3);k[0]=f[0]+b*c[0];k[1]=f[1]+b*c[1];k[2]=f[2]+b*c[2];e[3]=a[3];a=a.subarray(4);e=e.subarray(4);c=d[0];f=d[1];d=d[2];var k=a[0],p=a[1],q=a[2],D=a[3];e[0]=.5*(c*D+f*q-d*p);e[1]=.5*(f*D+d*k-c*q);e[2]=.5*
(d*D+c*p-f*k);e[3]=.5*(-c*k-f*p-d*q);e[0]=a[0]+e[0]*b;e[1]=a[1]+e[1]*b;e[2]=a[2]+e[2]*b;e[3]=a[3]+e[3]*b;g.normalize(e,e)}};b4w.module.__util=function(a,p){function c(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function b(a,c){var d=a instanceof Array?[]:{},e;for(e in a)d[e]=!a[e]||"object"!=typeof a[e]||-1!=c.indexOf(a[e])||a[e]instanceof Float32Array?a[e]:b(a[e],c);return d}function e(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function d(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function g(a,b){var c=b;switch(typeof a){case "number":return k(a,
c);case "string":return f(a,c);case "boolean":return k(a|0,c);case "function":case "undefined":return k(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=k(a[d],c);else if(d)for(d=0;d<a.length;d++)c=g(a[d],c);else for(var e in a)c=g(a[e],c)}else c=k(0,c)}return c}function k(a,b){var c=b;F[0]=a;c=(c<<5)-c+U[0];c&=c;c=(c<<5)-c+U[1];return c&c}function f(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),
c&=c;return c}function m(a){return(34*a+1)*a%289}function h(a){return a-Math.floor(a)}function r(a){return n((34*a+5)*a)}function n(a){return a-289*Math.floor(a/289)}function x(a){return a-7*Math.floor(a/7)}function v(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!u(a[c],b[c]))return!1}else if(d){if(a.length!=
b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!u(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function u(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return v(a,b);default:return!0}}var E=p("__print"),q=p("vec3"),D=p("vec4"),l=p("quat"),z=p("mat3"),A=p("mat4"),G=0,t={},B=new Float32Array(3),O=new Float32Array(3),y=new Float32Array(4),H=new Float32Array(4),
L=new Float32Array(9),Z=new Float32Array(16),J=new Float32Array(16),F=new Float64Array(1),U=new Uint32Array(F.buffer),K=new Float32Array([0,0,0]),S=new Float32Array([0,0,0,1]),T=new Float32Array([0,0,0,1,0,0,0,1]),ba=new Float32Array([1,0,0]),P=new Float32Array([0,1,0]),ca=new Float32Array([0,0,1]),X=new Float32Array([-1,0,0]),aa=new Float32Array([0,-1,0]),w=new Float32Array([0,0,-1]),fa=Math.floor(44488.07041494893);a.et=K;a.$s=S;a.tA=T;a.AXIS_X=ba;a.AXIS_Y=P;a.AXIS_Z=ca;a.AXIS_MX=X;a.AXIS_MY=aa;
a.AXIS_MZ=w;a.keyfind=c;a.Fv=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.rz=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.hu=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.Kt=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.sign=function(a){return 0<a?1:0>a?-1:0};a.$B=function(a,
b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.ZB=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.vl=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.Ft=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.RA=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<
a.length;d++)if(c==a[d])return!1;return!0};a.nC=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.lC=function(a,b){var d=c("name",b,a);1<d.length&&E.error("obj_by_name(): name resolution ambiguity");return d};a.mC=function(a,b){var d=c("name",b,a),e=d.length;1<e&&E.error("obj_by_name(): name resolution ambiguity");if(0>=e)return[];for(var f=[],g=0;g<e;g++){var h=d[g];if("EMPTY"==h.type&&h.dupli_group)for(var h=h.dupli_group.objects,k=0;k<h.length;k++)f.push(h[k])}return d=
d.concat(f)};a.oz=function(a,b,c,d){d||(d=new Float32Array(16));A.identity(d);d[12]=a;d[13]=b;d[14]=c};var ja=1;a.Mx=function(){ja=(69069*ja+5)%Math.pow(2,32);return Math.round(ja/65536)%32768/32767};a.Zy=function(a){ja=a};a.sc=function(a){var b=a[0]%fa*48271-3399*Math.floor(a[0]/fa);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.rj=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/
2),g=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.tv=function(a){var b=z.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),f=Math.sin(a[0]),g=Math.sin(a[1]);a=Math.sin(a[2]);var h=c*e,k=c*a,l=f*e,m=f*a;b[0]=d*e;b[1]=d*a;b[2]=-g;b[3]=g*l-k;b[4]=g*m+h;b[5]=d*f;b[6]=g*h+m;b[7]=g*k-l;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=e*e,h=c*d+e*f;.499999<h?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=
Math.PI/2):-.499999>h?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*g),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*g),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));q.transformQuat(b,a,c);return c};a.dB=function(a,b,c){c||(c=new Float32Array(4));a=q.normalize(a,B);var d=q.dot(b,a);a=q.cross(b,a,O);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.pz=
function(a,b,c,d){d||(d=new Float32Array(4));q.transformQuat(c,b,d);d[3]=-q.dot(a,d)};a.lv=function(a){var b=a.d.quat;switch(a.type){case "CAMERA":B[0]=0;B[1]=-1;B[2]=0;q.transformQuat(B,b,B);O[0]=0;O[1]=0;O[2]=-1;break;case "MESH":B[0]=0;B[1]=0;B[2]=1;q.transformQuat(B,b,B);O[0]=0;O[1]=0;O[2]=1;break;case "EMPTY":B[0]=0,B[1]=1,B[2]=0,q.transformQuat(B,b,B),O[0]=0,O[1]=1,O[2]=0}B[1]=0;q.normalize(B,B);a=q.dot(B,O);return Math.acos(a)*(0<-B[0]*O[2]?-1:1)};a.On=function(a,b,c,d){if(0!=c){d=d||[];for(var e=
0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.HC=function(){G++;return G.toString(16)};a.gk=function(a){t[a]||(t[a]=0);var b=a+t[a];t[a]++;return b};a.rd=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.vb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,H:0,ba:null,u:[],D:b}};a.Ep=function(a){return{name:a,type:"MESH",modifiers:[],particle_systems:[],data:null}};
a.We=function(a){return JSON.parse(JSON.stringify(a))};a.TA=function(a,c){var d=[],e;for(e in c){var f=c[e];if(f)for(var g=0;g<f.length;g++)d.push(f[g])}return b(a,d)};a.wa=function(b){var c=b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof Float32Array?new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.wa(b[d]):b[d];return c};a.sh=function(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=
a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?new Float32Array(a[c]):a[c]instanceof Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof Array?a[c].slice(0):a[c]:a[c];return b};a.is_mesh=function(a){return"MESH"===a.type?!0:!1};a.Xw=function(a){return"EMPTY"===a.type?!0:!1};a.lf=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));z.fromMat4(a,L);var c=L[0],d=L[3],e=L[6],f=L[1],g=L[4],h=L[7],k=
L[2],m=L[5],n=L[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+g*g+h*h)||1,k=Math.sqrt(k*k+m*m+n*n)||1;L[0]/=c;L[3]/=c;L[6]/=c;L[1]/=f;L[4]/=f;L[7]/=f;L[2]/=k;L[5]/=k;L[8]/=k;l.fromMat3(L,b);return b};a.xf=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.Bj=function(a){y[0]=.577350269189626;y[1]=.577350269189626;y[2]=.577350269189626;y[3]=0;D.transformMat4(y,a,y);return D.length(y)};a.Ro=function(a,b){var c=b.left,d=b.right,f=b.top,g=b.bottom,h=b.Ia,k=b.Pa;c[0]=
a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-a[8];d[3]=a[15]-a[12];f[0]=a[3]-a[1];f[1]=a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];h[0]=a[3]+a[2];h[1]=a[7]+a[6];h[2]=a[11]+a[10];h[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];e(c);e(d);e(f);e(g);e(h);e(k)};a.Uy=function(a,b,c){return c<-d(a,b.left)||c<-d(a,b.right)||c<-d(a,b.top)||c<-d(a,b.bottom)||c<
-d(a,b.Ia)||c<-d(a,b.Pa)?!0:!1};a.sv=function(a,b,c,e,f){g=q.dot(c,b.Pa);h=q.dot(e,b.Pa);k=q.dot(f,b.Pa);g=Math.sqrt(g*g+h*h+k*k);if(g<-d(a,b.Ia)||g<-d(a,b.Pa))return!0;var g=q.dot(c,b.left),h=q.dot(e,b.left),k=q.dot(f,b.left);if(Math.sqrt(g*g+h*h+k*k)<-d(a,b.left))return!0;g=q.dot(c,b.right);h=q.dot(e,b.right);k=q.dot(f,b.right);if(Math.sqrt(g*g+h*h+k*k)<-d(a,b.right))return!0;g=q.dot(c,b.top);h=q.dot(e,b.top);k=q.dot(f,b.top);if(Math.sqrt(g*g+h*h+k*k)<-d(a,b.top))return!0;g=q.dot(c,b.bottom);h=
q.dot(e,b.bottom);k=q.dot(f,b.bottom);return Math.sqrt(g*g+h*h+k*k)<-d(a,b.bottom)?!0:!1};a.pe=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*k+b[13];c[d+f+2]=b[2]*g+b[6]*h+b[10]*k+b[14]}};a.Uz=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k}};a.lz=function(a,b,c){for(var d=
0,d=0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k;c[d+f+3]=a[f+3]}};a.Sz=function(a,b,c){c||(c=new Float32Array(3));y[0]=a[0];y[1]=a[1];y[2]=a[2];y[3]=0;D.transformMat4(y,b,y);c[0]=y[0];c[1]=y[1];c[2]=y[2]};a.mB=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=
0;f<d;f++)b[e*d+f]=a[e][f];return b};a.Tz=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.Ni=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.Ni(b,c,d,f-1):b[f]<c?a.Ni(b,c,f+1,e):f};a.Zd=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.Vi=function(a,b){for(var c=0;c<a.length;c++)if(1E-7<Math.abs(a[c]-b[c]))return!1;return!0};a.dy=function(a,b,c){c||(c=new Float32Array(16));for(var d=
0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.Om=function(a,b,c,d){d||(d=new Float32Array(16));b=A.fromRotationTranslation(b,c,Z);A.multiply(b,a,d)};a.oi=function(a,b,c,d,e){e||(e=new Float32Array(3));c=A.fromRotationTranslation(c,d,Z);1!==b&&(d=A.identity(J),b=q.set(b,b,b,B),A.scale(d,b,d),A.multiply(c,d,c));q.transformMat4(a,c,e);return e};a.Pm=function(a,b,c,d){d||(d=new Float32Array(4));b=A.fromRotationTranslation(b,c,Z);D.transformMat4(a,b,d)};a.RB=function(a,b,c,
d,e){e||(e=new Float32Array(3));b=A.fromRotationTranslation(c,d,Z);A.invert(b,b);q.transformMat4(a,b,e);return e};a.EC=function(a,b,c){c||(c=new Float32Array(16));A.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.jC=function(b,c,d){a.xf(b,c);c[3]=a.Bj(b);a.matrix_to_quat(b,d)};a.Dn=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.$x=function(a,b,c,d){d||(d=new Float32Array(3));q.subtract(b,a,B);q.transformQuat(B,c,B);q.subtract(b,B,d)};
a.Sv=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16),g=new Float32Array(16);A.lookAt(a,[-1,0,0],[0,-1,0],b);A.scale(b,[-1,1,1],b);A.scale(b,[-1,1,-1],c);A.lookAt(a,[0,-1,0],[0,0,-1],d);A.scale(d,[1,1,-1],d);A.scale(d,[1,-1,-1],e);A.lookAt(a,[0,0,-1],[0,-1,0],f);A.scale(f,[-1,1,1],f);A.scale(f,[-1,1,-1],g);return[b,c,d,e,f,g]};a.qh=function(a,b){return g(a,b)};a.hash_code=g;a.KB=f;a.iC=function(a,
b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,k,l,m,n,r,q,p,x,v;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];h=a[2];k=a[3];l=a[4];m=a[5];n=a[6];r=a[7];q=a[8];p=a[9];x=a[10];v=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=k;c[4]=l;c[5]=m;c[6]=n;c[7]=r;c[8]=q;c[9]=p;c[10]=x;c[11]=v;c[12]=f*d+l*e+q*b+a[12];c[13]=g*d+m*e+p*b+a[13];c[14]=h*d+n*e+x*b+a[14];c[15]=k*d+r*e+v*b+a[15];return c};a.kx=function(a,
b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.Lx=function(a){return a*Math.PI/180};a.aB=function(a){return 180*a/Math.PI};
a.Am=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>a?1:0,g=1-f,e=b+.211324865405187-f,k=a+.211324865405187-g,l=b+-.577350269189626,n=a+-.577350269189626,c=c%289,d=d%289,r=m(m(d)+c),g=m(m(d+g)+c+f),q=m(m(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+k*k),0),f=Math.max(.5-(l*l+n*n),0),p=2*h(.024390243902439*r)-1,x=2*h(.024390243902439*g)-1,v=2*h(.024390243902439*
q)-1,r=Math.abs(p)-.5,g=Math.abs(x)-.5,q=Math.abs(v)-.5,p=p-Math.floor(p+.5),x=x-Math.floor(x+.5),v=v-Math.floor(v+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(p*p+r*r)),d=d*d*d*d*(1.79284291400159-.85373472095314*(x*x+g*g)),f=f*f*f*f*(1.79284291400159-.85373472095314*(v*v+q*q));return 130*(c*(p*b+r*a)+d*(x*e+g*k)+f*(v*l+q*n))};a.$n=function(a){var b=1/7,c=b/2,d=n(Math.floor(a[0])),e=n(Math.floor(a[1])),f=h(a[0]);a=h(a[1]);var g=f-.5,k=f-1.5,f=a-.5;a-=1.5;var l=r(d),m=r(d+1),q=l,d=m,l=r(l+e),
m=r(m+e),q=r(q+e+1),d=r(d+e+1),e=g+.7*(x(l)*b+c),p=k+.7*(x(m)*b+c),g=g+.7*(x(q)*b+c),k=k+.7*(x(d)*b+c),l=f+.7*(x(Math.floor(l*b))*b+c),f=f+.7*(x(Math.floor(m*b))*b+c),q=a+.7*(x(Math.floor(q*b))*b+c),b=a+.7*(x(Math.floor(d*b))*b+c);return Math.min(e*e+l*l,p*p+f*f,g*g+q*q,k*k+b*b)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=q.transformQuat(b,a,B);b=c[0];var f=c[1];c=c[2];L[0]=f*f+c*c;L[1]=-f*b;L[2]=-c*b;L[3]=-b*f;L[4]=b*b+c*c;L[5]=-c*f;L[6]=-b*c;L[7]=-f*c;L[8]=b*b+f*f;q.transformMat3(a,
L,a);q.normalize(a,a);l.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=y,d=H,c=l.setAxisAngle([0,1,0],Math.PI,l.create()),d=l.setAxisAngle([1,0,0],Math.PI/2,l.create());l.multiply(c,d,c);l.multiply(a,c,b);return b};a.cleanup=function(){G=0;t={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);
for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.er=function(a,b,c,d,e){e||(e=new Float32Array(a.length));l.slerp(a,b,Math.exp(-c/d),e)};a.SB=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=z.fromQuat(a,L);O[0]=0;O[1]=1;O[2]=0;B[0]=c[3];B[1]=c[4];B[2]=c[5];var d=q.cross(O,B,B);
q.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);O[0]=c[0];O[1]=c[1];O[2]=c[2];q.normalize(O,O);l.rotationTo(O,d,H);l.multiply(H,a,a)};a.ep=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],k=a[e*b+Math.min(c+1,g)],l=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+k*d)*(1-f)+(l*(1-d)+a*d)*f};a.Kf=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.Oq=function(a){for(var b=
[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.hi=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.Pv=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.ff=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,
c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];q.normalize(c,c)};a.FC=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var k=g*a-h*e,l=h*d-f*a,m=f*e-g*d,n=g*m-h*l,h=h*k-f*m,f=f*l-g*k;c[0]=d+2*k*b+2*n;c[1]=e+2*l*b+2*h;c[2]=a+2*m*b+2*f;return c};a.fa=function(a){a&&E.error.apply(E,arguments);throw"panic: see above for possible error messages";};a.Oe=function(a){return a-2*Math.floor(a/(2*Math.PI))*Math.PI};a.tl=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};
a.pr=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=v(e,f)}if(!d)return!1}return!0};a.Kx=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.Ov=function(a){a+=1;132651<a&&E.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return[b/51,c/51,a%51/51]};a.line_plane_intersect=function(a,b,c,d,e){y.set(a);y[3]=b;H.set(d);H[3]=0;a=D.dot(y,H);if(0==a)return null;
H.set(c);H[3]=1;a=-D.dot(y,H)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.VA=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.Rq=function(a,b,c){var d=q.dot(a,b);-.9999999>d?(q.cross(ba,a,B),1E-6>q.length(B)&&q.cross(P,a,B),q.normalize(B,B),l.setAxisAngle(B,Math.PI,c)):(q.cross(a,b,B),c.set(B),c[3]=1+d,l.normalize(c,c));return c}};b4w.module.__sfx=function(a,p){function c(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;E.warn("B4W warning: deprecated WebAudio implementation");return null}E.warn("B4W warning: WebAudio is not supported");return null}function b(a,b,c){var d=a.h;if("NONE"!=d.behavior){c||(c=0);var h=d.loop,l=d.pitch;if(d.src&&(h||0<=c)){d.zk=Math.floor(5E4*Math.random());var m=y.currentTime+b;d.fc=m;d.state=20;e(a);"POSITIONAL"==d.behavior||"BACKGROUND_SOUND"==d.behavior?
(b=y.createBufferSource(),b.buffer=d.src,b.playbackRate.value=l,h?(d.hb&&d.hb.disconnect(),b.loop=!0,b.start(m),d.duration=0):(h=b.buffer?b.buffer.duration:0,c>h?(h=m+c+d.xd,b.loop=!0,b.start(m),b.stop(h),d.duration=c):(b.loop=!1,b.start(m),d.duration=h)),b.connect(d.Sb),d.hb=b,g(d),k(d)):"BACKGROUND_MUSIC"==d.behavior&&(q.Ui(d.Dk),q.Ui(d.Ek),c=function(){var b=a.h,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.hb=b.hb||y.createMediaElementSource(c),b.hb.connect(b.Sb),20==b.state&&(c.currentTime&&(c.currentTime=
0),c.play()))},0==b?c():d.Dk=q.Vq(c,1E3*b),d.duration=h?0:v(a));f(d,m)}}}function e(a){var b=a.h;if(!b.Sb){var c=a.d.g;a=a.d.quat;if(z.Fj){var d=y.createBiquadFilter();d.type="peaking"}else d=null;var e=y.createGain();switch(b.behavior){case "POSITIONAL":var f=y.createPanner();"string"!=typeof f.panningModel?(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);b.Ol.set(c);c=A;D.quat_to_dir(a,D.AXIS_MY,
c);f.setOrientation(c[0],c[1],c[2]);b.direction.set(c);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.ru;f.coneOuterAngle=b.su;f.coneOuterGain=b.tu;var g=y.createGain();g.gain.value=x(b);d?(f.connect(d),d.connect(g)):f.connect(g);g.connect(e);b.Sb=f;if(b.gh){var h=y.createGain();e.connect(h);h.connect(y?H.h.Sb:null)}else h=null,e.connect(y?H.h.Sb:null);break;case "BACKGROUND_SOUND":f=null;g=y.createGain();g.gain.value=x(b);d?(b.Sb=d,d.connect(g)):
b.Sb=g;g.connect(e);b.gh?(h=y.createGain(),e.connect(h),h.connect(y?H.h.Sb:null)):(h=null,e.connect(y?H.h.Sb:null));break;case "BACKGROUND_MUSIC":h=f=null,g=y.createGain(),g.gain.value=x(b),d?(b.Sb=d,d.connect(g)):b.Sb=g,g.connect(e),e.connect(y?H.h.Sb:null)}b.Vh=f;b.Lc=d;b.mg=g;b.bf=e;b.Iq=h}}function d(a){var c=a.h,d=c.duration,c=c.delay+c.hv*Math.random();b(a,c,d)}function g(a){a.gh&&a.Iq.gain.cancelScheduledValues(a.fc);a.Zh&&a.hb.playbackRate.cancelScheduledValues(a.fc);a.ti=a.fc}function k(a){if(a.gh||
a.Zh){var b=a.Iq,c=a.hb,d=c.buffer?c.buffer.duration:0;if(d){var e=a.fc;Z[0]=a.zk;for(var f=0;5>f;){var g=a.pitch+a.Zh*D.sc(Z);if(e>=a.ti){if(a.gh){var h=1-D.clamp(a.gh,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.Zh&&c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.ti=e-.001}}}function f(a,b){if(a.hl||a.xd){var c=a.bf;c.gain.cancelScheduledValues(b);a.hl?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.hl)):c.gain.setValueAtTime(1,b);a.xd&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),
c.gain.linearRampToValueAtTime(0,b+a.duration+a.xd))}}function m(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.h;if(20==b.state||40==b.state){var c=b.bf,d=y.currentTime;b.xd&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.xd));"BACKGROUND_MUSIC"==b.behavior?b.src&&(q.Ui(b.Dk),q.Ui(b.Ek),b.Ek=q.Vq(function(){var b=a.h.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.xd)):(c=b.hb,b.duration<c.buffer.duration?b.xd&&20==b.state?c.stop(d+b.xd):20==b.state&&
(c.stop(0),c.disconnect()):c.disconnect(),b.fc=0,b.hm=0,b.Jk=0);b.state=30}}function h(a){a=a.h;if(20==a.state){var b=y.currentTime;a.hm=b;if("BACKGROUND_MUSIC"==a.behavior){var c=a.src;c&&c.pause()}else{if(b>a.fc){Z[0]=a.zk;for(var d=a.hb.buffer.duration,e=a.fc;e<b;)c=a.pitch+a.Zh*D.sc(Z),e+=d/c;c*=d/c-(e-b)}else c=0;a.Jk=c;a.hb.stop(0);a.hb.disconnect();g(a)}a.state=40}}function r(a){var b=a.h;if(40==b.state){var c=y.currentTime;b.fc+=c-b.hm;if("BACKGROUND_MUSIC"==b.behavior)b.src.play();else{a=
a.h;var d=y.createBufferSource();d.loop=a.hb.loop;d.buffer=a.hb.buffer;d.playbackRate.value=a.hb.playbackRate.value;a.Vh?d.connect(a.Vh):d.connect(a.mg);a.hb=d;b.ti=c;b.hb.start(b.fc,b.Jk);k(b)}f(b,b.fc);b.state=20}}function n(a){return!a.h||20!=a.h.state&&40!=a.h.state&&30!=a.h.state?!1:!0}function x(a){return a.muted?0:a.volume}function v(a){a=a.h;return(a=a.src)?a.duration:0}var u=p("__config"),E=p("__print"),q=p("__time"),D=p("__util"),l=p("vec3"),z=u.Ld;a.en=10;a.ok=20;a.dn=30;var A=new Float32Array(3),
G=new Float32Array(3),t=new Float32Array(3),B=[],O=[],y=null,H=null,L=[],Z=[1],J=null;a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(B.push("ogg"),B.push("ogv")),""!=a.canPlayType("audio/mpeg")&&B.push("mp3"),""!=a.canPlayType("audio/mp4")&&(B.push("mp4"),B.push("m4v")),""!=a.canPlayType("audio/webm")&&B.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&O.push("ogv"),""!=b.canPlayType("video/mp4")&&
O.push("m4v"),""!=b.canPlayType("video/webm")&&O.push("webm"));(y=z.$z?c():null)&&E.log("%cINIT WEBAUDIO: "+y.sampleRate+"Hz","color: #00a")};a.Hn=function(a){var b={uf:new Float32Array(3),Up:new Float32Array(3),vg:new Float32Array(3)};a.h=b;if(y){var c=y.createGain(),d=y.createGain();b.mg=c;b.bf=d;c.connect(d);d.connect(y.destination);if(a.b4w_enable_dynamic_compressor){var d=y.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=
e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.th=d;b.Sb=d}else b.th=null,b.Sb=c;c=y.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=!1;b.volume=1;b.af=0}};a.my=function(a){H=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<B.indexOf(a)?a:"ogg"==a&&-1<B.indexOf("mp4")?"mp4":"mp3"==a&&-1<B.indexOf("ogg")?"ogg":"mp4"==a&&-1<B.indexOf("ogg")?"ogg":"ogv"==a&&-1<B.indexOf("m4v")?"m4v":"webm"==a&&-1<B.indexOf("m4v")?"m4v":
"m4v"==a&&-1<B.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<O.indexOf(a)?a:"ogv"==a&&-1<O.indexOf("m4v")?"m4v":"webm"==a&&-1<O.indexOf("m4v")?"m4v":"m4v"==a&&-1<O.indexOf("webm")?"webm":""};a.append_object=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.h={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.h.behavior=y?b.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var c=a.h,d;y?(window.MediaElementAudioSourceNode?
d=!0:(E.warn("B4W warning: MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.h.behavior="NONE");a.h.mv=b.b4w_disable_doppler;a.h.muted=b.muted;a.h.volume=b.volume;a.h.pitch=b.pitch;a.h.attenuation=b.attenuation;a.h.dist_ref=b.distance_reference;a.h.dist_max=b.distance_max||1E4;a.h.ru=b.cone_angle_inner;a.h.su=b.cone_angle_outer;a.h.tu=b.cone_volume_outer;a.h.cyclic=b.b4w_cyclic_play;
a.h.loop=b.b4w_loop;a.h.delay=b.b4w_delay;a.h.hv=b.b4w_delay_random;a.h.gh=b.b4w_volume_random;a.h.Zh=b.b4w_pitch_random;a.h.hl=b.b4w_fade_in;a.h.xd=b.b4w_fade_out;a.h.fc=0;a.h.hm=0;a.h.Jk=0;a.h.duration=0;a.h.ti=0;a.h.zk=1;a.h.src=null;a.h.state=10;a.h.Ol=new Float32Array(3);a.h.direction=new Float32Array(3);a.h.Bm=new Float32Array(3);a.h.Dk=-1;a.h.Ek=-1;a.h.af=0;L.push(a)};a.fr=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.h.behavior){case "POSITIONAL":return a.ok;case "BACKGROUND_SOUND":return a.ok;
case "BACKGROUND_MUSIC":return a.dn;case "NONE":return a.en;default:throw"Wrong speaker behavior";}};a.Jz=function(a,b){var c=a.h;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.Ex=function(){var a=y.createBufferSource();a.buffer=y.createBuffer(1,22050,22050);a.connect(y.destination);a.start(0)};a.ev=function(a,b,c){y?y.decodeAudioData(a,b,c):c()};a.Qy=function(a){m(a);delete a.h;L.splice(L.indexOf(a),
1)};a.cleanup=function(){for(var a=0;a<L.length;a++){var b=L[a].h;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.hb&&b.hb.disconnect()}H&&H.h&&(a=H.h,a.uf[0]=0,a.uf[1]=0,a.uf[2]=0,a.vg[0]=0,a.vg[1]=0,a.vg[2]=0);H=null;L.splice(0);J=null};a.update=function(a){if(y&&0!=L.length){for(var b=0;b<L.length;b++){var c=L[b],e=c.h,f=y.currentTime;y&&!e.loop&&e.cyclic&&20==e.state&&e.duration&&e.fc+e.duration<f&&d(c);20==e.state&&3>e.ti-f&&k(e)}J&&(-1==J.Ba||a>J.xn+J.Jo[J.Ba])&&(b=J,-1<b.Ba&&m(b.ze[b.Ba]),
-1==b.Ba&&b.random?c=Math.round(Math.random()*(b.ze.length-1)):b.random?(c=1+Math.round(Math.random()*(b.ze.length-2)),c=(b.Ba+c)%b.ze.length):c=(b.Ba+1)%b.ze.length,d(b.ze[c]),b.Ba=c,b.xn=a)}};a.play=b;a.play_def=d;a.stop=m;a.is_play=function(a){return 20==a.h.state};a.Py=h;a.Ry=r;a.playrate=function(a,b){var c=a.h;c.pitch=b;!n(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.hb.playbackRate.value=b,g(c),k(c))};a.get_playrate=function(a){return a.h.pitch};a.cyclic=function(a,b){a.h.cyclic=
Boolean(b)};a.is_cyclic=function(a){return a.h.cyclic};a.fx=function(a,b,c,d){if(y&&a.h){var e=A;e[0]=0;e[1]=-1;e[2]=0;l.transformQuat(e,c,e);G[0]=0;G[1]=0;G[2]=-1;l.transformQuat(G,c,G);c=y.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],G[0],G[1],G[2]);a.h.Up.set(e);d&&(t[0]=(b[0]-a.h.uf[0])/d,t[1]=(b[1]-a.h.uf[1])/d,t[2]=(b[2]-a.h.uf[2])/d,D.smooth_v(t,a.h.vg,d,.3,t),c.setVelocity(t[0],t[1],t[2]),a.h.vg.set(t));a.h.uf.set(b)}};a.listener_reset_speed=function(a,b){if(y&&H.h){var c=
A;b?c.set(b):c.set(H.h.Up);l.scale(c,a,c);y.listener.setVelocity(c[0],c[1],c[2]);H.h.vg.set(c)}};a.Sy=function(a,b){var c=a.h;if(n(a)&&"POSITIONAL"==c.behavior){var d=a.d.g,e=c.Vh;e.setPosition(d[0],d[1],d[2]);var f=A;D.quat_to_dir(a.d.quat,D.AXIS_MY,f);e.setOrientation(f[0],f[1],f[2]);f=c.Ol;!c.mv&&b&&(G[0]=(d[0]-f[0])/b,G[1]=(d[1]-f[1])/b,G[2]=(d[2]-f[2])/b,D.smooth_v(G,c.Bm,b,.3,G),e.setVelocity(G[0],G[1],G[2]),c.Bm.set(G));f.set(d)}};a.speaker_reset_speed=function(a,b,c){var d=a.h;if(n(a)&&"POSITIONAL"==
d.behavior){var e=A;c?e.set(c):e.set(d.direction);l.scale(e,b,e);d.Vh.setVelocity(e[0],e[1],e[2]);d.Bm.set(e);d.Ol.set(a.d.g)}};a.Fd=function(a){return a.h?!0:!1};a.xl=function(a){return a.h.behavior};a.check_active_speakers=function(){for(var a=0;a<L.length;a++)if(n(L[a]))return!0;return!1};a.vy=function(a){var b=H.h;b&&(b.volume=a,y&&(b.mg.gain.value=x(b)))};a.sw=function(){var a=H.h;return a?a.volume:0};a.set_volume=function(a,b){var c=a.h;c.volume=b;n(a)&&(c.mg.gain.value=x(c))};a.get_volume=
function(a){return a.h.volume};a.mute=function(a,b){a.h.muted=Boolean(b);n(a)&&(a.h.mg.gain.value=x(a.h))};a.is_muted=function(a){return a.h.muted};a.sx=function(a){var b=H.h;b&&(b.muted=Boolean(a),y&&(b.mg.gain.value=x(b)))};a.bx=function(){var a=H.h;return a?a.muted:!1};a.get_speaker_objects=function(){return L};a.pause=function(){for(var a=0;a<L.length;a++)h(L[a])};a.resume=function(){for(var a=0;a<L.length;a++)r(L[a])};a.set_compressor_params=function(a,b){if(a.h&&a.h.th){var c=a.h.th;c.threshold.value=
b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.h||!a.h.th)return null;a=a.h.th;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(n(a)){a=a.h;var d=a.bf,e=y.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.af=c}};a.unduck=function(a){if(n(a)){a=a.h;var b=a.bf,c=y.currentTime;
b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.af);a.af=0}};a.ov=function(a,b){if(y){var c=H.h,d=c.bf,e=y.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.af=b}};a.sz=function(){if(y){var a=H.h,b=a.bf,c=y.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.af);a.af=0}};a.apply_playlist=function(a,b,c){J={Ba:-1,xn:0,random:c,ze:[],Jo:[]};for(c=0;c<a.length;c++){var d=a[c],e=v(d);0==e?E.warn("B4W warning: Ignoring speaker with zero duration: "+
d.name):(m(d),d.h.cyclic=!1,J.ze.push(d),J.Jo.push(e+b))}};a.get_duration=v;a.clear_playlist=function(){if(J)for(var a=J.ze,b=0;b<a.length;b++)m(a[b]);J=null};a.get_positional_params=function(a){return(a=a.h)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.h;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.Vh;d&&(d.refDistance=c.dist_ref,
d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.h;c&&c.Lc&&(c.Lc.frequency.value=b.freq,c.Lc.Q.value=b.Q,c.Lc.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.h)&&a.Lc?{freq:a.Lc.frequency.value,Q:a.Lc.Q.value,gain:a.Lc.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.h;if(!a||!a.Lc)return null;a.Lc.getFrequencyResponse(b,c,d)}};b4w.module.vec3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new p(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var c=new p(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.fromValues=function(a,c,d){var g=new p(3);g[0]=a;g[1]=c;g[2]=d;return g};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.set=function(a,c,d,g){g[0]=a;g[1]=c;g[2]=d;return g};a.add=function(a,c,d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];return d};
a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);return d};
a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;return d};a.scaleAndAdd=function(a,c,d,g){g[0]=a[0]+c[0]*d;g[1]=a[1]+c[1]*d;g[2]=a[2]+c[2]*d;return g};a.distance=function(a,c){var d=c[0]-a[0],g=c[1]-a[1],k=c[2]-a[2];return Math.sqrt(d*d+g*g+k*k)};a.dist=a.distance;a.squaredDistance=function(a,c){var d=c[0]-a[0],g=c[1]-a[1],k=c[2]-a[2];return d*d+g*g+k*k};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1];a=a[2];return Math.sqrt(c*c+d*d+a*a)};a.len=a.length;a.squaredLength=
function(a){var c=a[0],d=a[1];a=a[2];return c*c+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};a.normalize=function(a,c){var d=a[0],g=a[1],k=a[2],d=d*d+g*g+k*k;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};a.cross=function(a,c,d){var g=a[0],k=a[1];a=a[2];var f=c[0],m=c[1];c=c[2];d[0]=k*c-a*m;d[1]=
a*f-g*c;d[2]=g*m-k*f;return d};a.lerp=function(a,c,d,g){var k=a[0],f=a[1];a=a[2];g[0]=k+d*(c[0]-k);g[1]=f+d*(c[1]-f);g[2]=a+d*(c[2]-a);return g};a.random=function(a,e){a=a||1;var d=2*c()*Math.PI,g=2*c()-1,k=Math.sqrt(1-g*g)*a;e[0]=Math.cos(d)*k;e[1]=Math.sin(d)*k;e[2]=g*a;return e};a.transformMat4=function(a,c,d){var g=a[0],k=a[1];a=a[2];var f=c[3]*g+c[7]*k+c[11]*a+c[15],f=f||1;d[0]=(c[0]*g+c[4]*k+c[8]*a+c[12])/f;d[1]=(c[1]*g+c[5]*k+c[9]*a+c[13])/f;d[2]=(c[2]*g+c[6]*k+c[10]*a+c[14])/f;return d};a.transformMat3=
function(a,c,d){var g=a[0],k=a[1];a=a[2];d[0]=g*c[0]+k*c[3]+a*c[6];d[1]=g*c[1]+k*c[4]+a*c[7];d[2]=g*c[2]+k*c[5]+a*c[8];return d};a.transformQuat=function(a,c,d){var g=a[0],k=a[1],f=a[2];a=c[0];var m=c[1],h=c[2];c=c[3];var r=c*g+m*f-h*k,n=c*k+h*g-a*f,p=c*f+a*k-m*g,g=-a*g-m*k-h*f;d[0]=r*c+g*-a+n*-h-p*-m;d[1]=n*c+g*-m+p*-a-r*-h;d[2]=p*c+g*-h+r*-m-n*-a;return d};a.rotateX=function(a,c,d,g){var k=[],f=[];k[0]=a[0]-c[0];k[1]=a[1]-c[1];k[2]=a[2]-c[2];f[0]=k[0];f[1]=k[1]*Math.cos(d)-k[2]*Math.sin(d);f[2]=
k[1]*Math.sin(d)+k[2]*Math.cos(d);g[0]=f[0]+c[0];g[1]=f[1]+c[1];g[2]=f[2]+c[2];return g};a.rotateY=function(a,c,d,g){var k=[],f=[];k[0]=a[0]-c[0];k[1]=a[1]-c[1];k[2]=a[2]-c[2];f[0]=k[2]*Math.sin(d)+k[0]*Math.cos(d);f[1]=k[1];f[2]=k[2]*Math.cos(d)-k[0]*Math.sin(d);g[0]=f[0]+c[0];g[1]=f[1]+c[1];g[2]=f[2]+c[2];return g};a.rotateZ=function(a,c,d,g){var k=[],f=[];k[0]=a[0]-c[0];k[1]=a[1]-c[1];k[2]=a[2]-c[2];f[0]=k[0]*Math.cos(d)-k[1]*Math.sin(d);f[1]=k[0]*Math.sin(d)+k[1]*Math.cos(d);f[2]=k[2];g[0]=f[0]+
c[0];g[1]=f[1]+c[1];g[2]=f[2]+c[2];return g};a.forEach=function(){var b=a.create();return function(a,c,g,k,f,m){c||(c=3);g||(g=0);for(k=k?Math.min(k*c+g,a.length):a.length;g<k;g+=c)b[0]=a[g],b[1]=a[g+1],b[2]=a[g+2],f(b,m,b),a[g]=b[0],a[g+1]=b[1],a[g+2]=b[2];return a}}();a.zA=function(b,c){var d=a.fromValues(b[0],b[1],b[2]),g=a.fromValues(c[0],c[1],c[2]);a.normalize(d,d);a.normalize(g,g);d=a.dot(d,g);return 1<d?0:Math.acos(d)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==
typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new p(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var c=new p(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.fromValues=function(a,c,d,g){var k=new p(4);k[0]=a;k[1]=c;k[2]=d;k[3]=g;return k};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.set=function(a,c,d,g,k){k[0]=a;k[1]=c;k[2]=d;k[3]=g;return k};a.add=function(a,c,d){d[0]=
a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3]+c[3];return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];d[3]=a[3]-c[3];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];d[3]=a[3]*c[3];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];d[3]=a[3]/c[3];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);d[3]=
Math.min(a[3],c[3]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);d[3]=Math.max(a[3],c[3]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;return d};a.scaleAndAdd=function(a,c,d,g){g[0]=a[0]+c[0]*d;g[1]=a[1]+c[1]*d;g[2]=a[2]+c[2]*d;g[3]=a[3]+c[3]*d;return g};a.distance=function(a,c){var d=c[0]-a[0],g=c[1]-a[1],k=c[2]-a[2],f=c[3]-a[3];return Math.sqrt(d*d+g*g+k*k+f*f)};a.dist=a.distance;a.squaredDistance=
function(a,c){var d=c[0]-a[0],g=c[1]-a[1],k=c[2]-a[2],f=c[3]-a[3];return d*d+g*g+k*k+f*f};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1],g=a[2];a=a[3];return Math.sqrt(c*c+d*d+g*g+a*a)};a.len=a.length;a.squaredLength=function(a){var c=a[0],d=a[1],g=a[2];a=a[3];return c*c+d*d+g*g+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];c[3]=1/a[3];return c};a.normalize=
function(a,c){var d=a[0],g=a[1],k=a[2],f=a[3],d=d*d+g*g+k*k+f*f;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,d,g){var k=a[0],f=a[1],m=a[2];a=a[3];g[0]=k+d*(c[0]-k);g[1]=f+d*(c[1]-f);g[2]=m+d*(c[2]-m);g[3]=a+d*(c[3]-a);return g};a.random=function(b,e){b=b||1;e[0]=c();e[1]=c();e[2]=c();e[3]=c();a.normalize(e,e);a.scale(e,b,e);return e};a.transformMat4=function(a,c,d){var g=a[0],
k=a[1],f=a[2];a=a[3];d[0]=c[0]*g+c[4]*k+c[8]*f+c[12]*a;d[1]=c[1]*g+c[5]*k+c[9]*f+c[13]*a;d[2]=c[2]*g+c[6]*k+c[10]*f+c[14]*a;d[3]=c[3]*g+c[7]*k+c[11]*f+c[15]*a;return d};a.transformQuat=function(a,c,d){var g=a[0],k=a[1],f=a[2],m=c[0],h=c[1],r=c[2];c=c[3];var n=c*g+h*f-r*k,p=c*k+r*g-m*f,v=c*f+m*k-h*g,g=-m*g-h*k-r*f;d[0]=n*c+g*-m+p*-r-v*-h;d[1]=p*c+g*-h+v*-m-n*-r;d[2]=v*c+g*-r+n*-h-p*-m;d[3]=a[3];return d};a.forEach=function(){var b=a.create();return function(a,c,g,k,f,m){c||(c=4);g||(g=0);for(k=k?Math.min(k*
c+g,a.length):a.length;g<k;g+=c)b[0]=a[g],b[1]=a[g+1],b[2]=a[g+2],b[3]=a[g+3],f(b,m,b),a[g]=b[0],a[g+1]=b[1],a[g+2]=b[2],a[g+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,p){var c=p("vec3"),b=p("vec4"),e=p("mat3"),d="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new d(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=c.create(),d=c.fromValues(1,0,0),f=c.fromValues(0,1,0);return function(e,h,r){var n=c.dot(e,h);if(-.9999999>n)return c.cross(d,e,b),1E-6>c.length(b)&&c.cross(f,e,b),c.normalize(b,b),a.setAxisAngle(b,Math.PI,r),r;if(.9999999<n)return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r;c.cross(e,
h,b);r[0]=b[0];r[1]=b[1];r[2]=b[2];r[3]=1+n;return a.normalize(r,r)}}();a.setAxes=function(){var b=e.create();return function(c,d,e,h){b[0]=d[0];b[3]=d[1];b[6]=d[2];b[1]=e[0];b[4]=e[1];b[7]=e[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,h),h)}}();a.clone=b.clone;a.fromValues=b.fromValues;a.copy=b.copy;a.set=b.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=b.add;a.multiply=function(a,b,c){var d=a[0],e=a[1],r=a[2];a=a[3];var n=b[0],p=b[1],v=b[2];b=b[3];c[0]=d*b+a*n+e*v-r*p;c[1]=e*b+a*p+r*n-d*v;c[2]=r*b+a*v+d*p-e*n;c[3]=a*b-d*n-e*p-r*v;return c};a.mul=a.multiply;a.scale=b.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],e=a[1],r=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*n;c[1]=e*b+r*n;c[2]=r*b-e*n;c[3]=a*b-d*n;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],e=a[1],r=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*
b-r*n;c[1]=e*b+a*n;c[2]=r*b+d*n;c[3]=a*b-e*n;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],e=a[1],r=a[2];a=a[3];var n=Math.sin(b);b=Math.cos(b);c[0]=d*b+e*n;c[1]=e*b-d*n;c[2]=r*b+a*n;c[3]=a*b-r*n;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];b[0]=c;b[1]=d;b[2]=e;b[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};a.dot=b.dot;a.lerp=b.lerp;a.slerp=function(a,b,c,d){var e=a[0],r=a[1],n=a[2];a=a[3];var p=b[0],v=b[1],u=b[2];b=b[3];var E,q,D;q=e*p+r*v+n*u+a*b;0>q&&(q=-q,p=-p,v=-v,
u=-u,b=-b);1E-6<1-q?(E=Math.acos(q),D=Math.sin(E),q=Math.sin((1-c)*E)/D,c=Math.sin(c*E)/D):q=1-c;d[0]=q*e+c*p;d[1]=q*r+c*v;d[2]=q*n+c*u;d[3]=q*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],e=a[2],r=a[3],n=c*c+d*d+e*e+r*r,n=n?1/n:0;b[0]=-c*n;b[1]=-d*n;b[2]=-e*n;b[3]=r*n;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=b.length;a.len=a.length;a.squaredLength=b.squaredLength;a.sqrLen=a.squaredLength;a.normalize=b.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var e=(d+1)%3,r=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*e+e]-a[3*r+r]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*e+r]-a[3*r+e])*c;b[e]=(a[3*e+d]+a[3*d+e])*c;b[r]=(a[3*r+d]+a[3*d+r])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new p(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=
a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var e=a[1],d=a[2],g=a[5];b[1]=a[3];b[2]=a[6];b[3]=e;b[5]=a[7];b[6]=d;b[7]=g}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var e=a[0],d=a[1],g=a[2],k=a[3],f=a[4],m=a[5],h=a[6],r=a[7],n=a[8],p=n*f-m*r,v=-n*k+m*h,u=
r*k-f*h,E=e*p+d*v+g*u;if(!E)return null;E=1/E;b[0]=p*E;b[1]=(-n*d+g*r)*E;b[2]=(m*d-g*f)*E;b[3]=v*E;b[4]=(n*e-g*h)*E;b[5]=(-m*e+g*k)*E;b[6]=u*E;b[7]=(-r*e+d*h)*E;b[8]=(f*e-d*k)*E;return b};a.adjoint=function(a,b){var e=a[0],d=a[1],g=a[2],k=a[3],f=a[4],m=a[5],h=a[6],r=a[7],n=a[8];b[0]=f*n-m*r;b[1]=g*r-d*n;b[2]=d*m-g*f;b[3]=m*h-k*n;b[4]=e*n-g*h;b[5]=g*k-e*m;b[6]=k*r-f*h;b[7]=d*h-e*r;b[8]=e*f-d*k;return b};a.determinant=function(a){var b=a[3],e=a[4],d=a[5],g=a[6],k=a[7],f=a[8];return a[0]*(f*e-d*k)+a[1]*
(-f*b+d*g)+a[2]*(k*b-e*g)};a.multiply=function(a,b,e){var d=a[0],g=a[1],k=a[2],f=a[3],m=a[4],h=a[5],r=a[6],n=a[7];a=a[8];var p=b[0],v=b[1],u=b[2],E=b[3],q=b[4],D=b[5],l=b[6],z=b[7];b=b[8];e[0]=p*d+v*f+u*r;e[1]=p*g+v*m+u*n;e[2]=p*k+v*h+u*a;e[3]=E*d+q*f+D*r;e[4]=E*g+q*m+D*n;e[5]=E*k+q*h+D*a;e[6]=l*d+z*f+b*r;e[7]=l*g+z*m+b*n;e[8]=l*k+z*h+b*a;return e};a.mul=a.multiply;a.translate=function(a,b,e){var d=a[0],g=a[1],k=a[2],f=a[3],m=a[4],h=a[5],r=a[6],n=a[7];a=a[8];var p=b[0];b=b[1];e[0]=d;e[1]=g;e[2]=k;
e[3]=f;e[4]=m;e[5]=h;e[6]=p*d+b*f+r;e[7]=p*g+b*m+n;e[8]=p*k+b*h+a;return e};a.rotate=function(a,b,e){var d=a[0],g=a[1],k=a[2],f=a[3],m=a[4],h=a[5],r=a[6],n=a[7];a=a[8];var p=Math.sin(b);b=Math.cos(b);e[0]=b*d+p*f;e[1]=b*g+p*m;e[2]=b*k+p*h;e[3]=b*f-p*d;e[4]=b*m-p*g;e[5]=b*h-p*k;e[6]=r;e[7]=n;e[8]=a;return e};a.scale=function(a,b,e){var d=b[0];b=b[1];e[0]=d*a[0];e[1]=d*a[1];e[2]=d*a[2];e[3]=b*a[3];e[4]=b*a[4];e[5]=b*a[5];e[6]=a[6];e[7]=a[7];e[8]=a[8];return e};a.Mv=function(a,b){b[0]=1;b[1]=0;b[2]=
0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.Kv=function(a,b){var e=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=e;b[2]=0;b[3]=-e;b[4]=d;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.Lv=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var e=a[0],d=a[1],g=a[2],k=a[3],f=e+e,m=d+d,h=g+g,e=e*f,r=d*f,d=d*m,n=g*f,p=
g*m,g=g*h,f=k*f,m=k*m,k=k*h;b[0]=1-d-g;b[3]=r-k;b[6]=n+m;b[1]=r+k;b[4]=1-e-g;b[7]=p-f;b[2]=n-m;b[5]=p+f;b[8]=1-e-d;return b};a.normalFromMat4=function(a,b){var e=a[0],d=a[1],g=a[2],k=a[3],f=a[4],m=a[5],h=a[6],r=a[7],n=a[8],p=a[9],v=a[10],u=a[11],E=a[12],q=a[13],D=a[14],l=a[15],z=e*m-d*f,A=e*h-g*f,G=e*r-k*f,t=d*h-g*m,B=d*r-k*m,O=g*r-k*h,y=n*q-p*E,H=n*D-v*E,n=n*l-u*E,L=p*D-v*q,p=p*l-u*q,v=v*l-u*D,u=z*v-A*p+G*L+t*n-B*H+O*y;if(!u)return null;u=1/u;b[0]=(m*v-h*p+r*L)*u;b[1]=(h*n-f*v-r*H)*u;b[2]=(f*p-m*
n+r*y)*u;b[3]=(g*p-d*v-k*L)*u;b[4]=(e*v-g*n+k*H)*u;b[5]=(d*n-e*p-k*y)*u;b[6]=(q*O-D*B+l*t)*u;b[7]=(D*G-E*O-l*A)*u;b[8]=(E*B-q*G+l*z)*u;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.Jv=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new p(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];b[1]=
a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var e=a[1],d=a[2],g=a[3],k=a[6],f=a[7],m=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=e;b[6]=a[9];b[7]=a[13];b[8]=d;b[9]=k;b[11]=a[14];b[12]=g;b[13]=f;
b[14]=m}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var e=a[0],d=a[1],g=a[2],k=a[3],f=a[4],m=a[5],h=a[6],r=a[7],n=a[8],p=a[9],v=a[10],u=a[11],E=a[12],q=a[13],D=a[14],l=a[15],z=e*m-d*f,A=e*h-g*f,G=e*r-k*f,t=d*h-g*m,B=d*r-k*m,O=g*r-k*h,y=n*q-p*E,H=n*D-v*E,L=n*l-u*E,Z=p*D-v*q,J=p*l-u*q,F=v*l-u*D,U=z*F-A*J+G*Z+t*L-B*H+O*y;if(!U)return null;
U=1/U;b[0]=(m*F-h*J+r*Z)*U;b[1]=(g*J-d*F-k*Z)*U;b[2]=(q*O-D*B+l*t)*U;b[3]=(v*B-p*O-u*t)*U;b[4]=(h*L-f*F-r*H)*U;b[5]=(e*F-g*L+k*H)*U;b[6]=(D*G-E*O-l*A)*U;b[7]=(n*O-v*G+u*A)*U;b[8]=(f*J-m*L+r*y)*U;b[9]=(d*L-e*J-k*y)*U;b[10]=(E*B-q*G+l*z)*U;b[11]=(p*G-n*B-u*z)*U;b[12]=(m*H-f*Z-h*y)*U;b[13]=(e*Z-d*H+g*y)*U;b[14]=(q*A-E*t-D*z)*U;b[15]=(n*t-p*A+v*z)*U;return b};a.adjoint=function(a,b){var e=a[0],d=a[1],g=a[2],k=a[3],f=a[4],m=a[5],h=a[6],r=a[7],n=a[8],p=a[9],v=a[10],u=a[11],E=a[12],q=a[13],D=a[14],l=a[15];
b[0]=m*(v*l-u*D)-p*(h*l-r*D)+q*(h*u-r*v);b[1]=-(d*(v*l-u*D)-p*(g*l-k*D)+q*(g*u-k*v));b[2]=d*(h*l-r*D)-m*(g*l-k*D)+q*(g*r-k*h);b[3]=-(d*(h*u-r*v)-m*(g*u-k*v)+p*(g*r-k*h));b[4]=-(f*(v*l-u*D)-n*(h*l-r*D)+E*(h*u-r*v));b[5]=e*(v*l-u*D)-n*(g*l-k*D)+E*(g*u-k*v);b[6]=-(e*(h*l-r*D)-f*(g*l-k*D)+E*(g*r-k*h));b[7]=e*(h*u-r*v)-f*(g*u-k*v)+n*(g*r-k*h);b[8]=f*(p*l-u*q)-n*(m*l-r*q)+E*(m*u-r*p);b[9]=-(e*(p*l-u*q)-n*(d*l-k*q)+E*(d*u-k*p));b[10]=e*(m*l-r*q)-f*(d*l-k*q)+E*(d*r-k*m);b[11]=-(e*(m*u-r*p)-f*(d*u-k*p)+n*
(d*r-k*m));b[12]=-(f*(p*D-v*q)-n*(m*D-h*q)+E*(m*v-h*p));b[13]=e*(p*D-v*q)-n*(d*D-g*q)+E*(d*v-g*p);b[14]=-(e*(m*D-h*q)-f*(d*D-g*q)+E*(d*h-g*m));b[15]=e*(m*v-h*p)-f*(d*v-g*p)+n*(d*h-g*m);return b};a.determinant=function(a){var b=a[0],e=a[1],d=a[2],g=a[3],k=a[4],f=a[5],m=a[6],h=a[7],r=a[8],n=a[9],p=a[10],v=a[11],u=a[12],E=a[13],q=a[14];a=a[15];return(b*f-e*k)*(p*a-v*q)-(b*m-d*k)*(n*a-v*E)+(b*h-g*k)*(n*q-p*E)+(e*m-d*f)*(r*a-v*u)-(e*h-g*f)*(r*q-p*u)+(d*h-g*m)*(r*E-n*u)};a.multiply=function(a,b,e){var d=
a[0],g=a[1],k=a[2],f=a[3],m=a[4],h=a[5],r=a[6],n=a[7],p=a[8],v=a[9],u=a[10],E=a[11],q=a[12],D=a[13],l=a[14];a=a[15];var z=b[0],A=b[1],G=b[2],t=b[3];e[0]=z*d+A*m+G*p+t*q;e[1]=z*g+A*h+G*v+t*D;e[2]=z*k+A*r+G*u+t*l;e[3]=z*f+A*n+G*E+t*a;z=b[4];A=b[5];G=b[6];t=b[7];e[4]=z*d+A*m+G*p+t*q;e[5]=z*g+A*h+G*v+t*D;e[6]=z*k+A*r+G*u+t*l;e[7]=z*f+A*n+G*E+t*a;z=b[8];A=b[9];G=b[10];t=b[11];e[8]=z*d+A*m+G*p+t*q;e[9]=z*g+A*h+G*v+t*D;e[10]=z*k+A*r+G*u+t*l;e[11]=z*f+A*n+G*E+t*a;z=b[12];A=b[13];G=b[14];t=b[15];e[12]=z*d+
A*m+G*p+t*q;e[13]=z*g+A*h+G*v+t*D;e[14]=z*k+A*r+G*u+t*l;e[15]=z*f+A*n+G*E+t*a;return e};a.mul=a.multiply;a.translate=function(a,b,e){var d=b[0],g=b[1];b=b[2];var k,f,m,h,r,n,p,v,u,E,q,D;a===e?(e[12]=a[0]*d+a[4]*g+a[8]*b+a[12],e[13]=a[1]*d+a[5]*g+a[9]*b+a[13],e[14]=a[2]*d+a[6]*g+a[10]*b+a[14],e[15]=a[3]*d+a[7]*g+a[11]*b+a[15]):(k=a[0],f=a[1],m=a[2],h=a[3],r=a[4],n=a[5],p=a[6],v=a[7],u=a[8],E=a[9],q=a[10],D=a[11],e[0]=k,e[1]=f,e[2]=m,e[3]=h,e[4]=r,e[5]=n,e[6]=p,e[7]=v,e[8]=u,e[9]=E,e[10]=q,e[11]=D,
e[12]=k*d+r*g+u*b+a[12],e[13]=f*d+n*g+E*b+a[13],e[14]=m*d+p*g+q*b+a[14],e[15]=h*d+v*g+D*b+a[15]);return e};a.scale=function(a,b,e){var d=b[0],g=b[1];b=b[2];e[0]=a[0]*d;e[1]=a[1]*d;e[2]=a[2]*d;e[3]=a[3]*d;e[4]=a[4]*g;e[5]=a[5]*g;e[6]=a[6]*g;e[7]=a[7]*g;e[8]=a[8]*b;e[9]=a[9]*b;e[10]=a[10]*b;e[11]=a[11]*b;e[12]=a[12];e[13]=a[13];e[14]=a[14];e[15]=a[15];return e};a.rotate=function(a,b,e,d){var g=e[0],k=e[1];e=e[2];var f=Math.sqrt(g*g+k*k+e*e),m,h,r,n,p,v,u,E,q,D,l,z,A,G,t,B,O,y,H,L;if(1E-7>Math.abs(f))return null;
f=1/f;g*=f;k*=f;e*=f;m=Math.sin(b);h=Math.cos(b);r=1-h;b=a[0];f=a[1];n=a[2];p=a[3];v=a[4];u=a[5];E=a[6];q=a[7];D=a[8];l=a[9];z=a[10];A=a[11];G=g*g*r+h;t=k*g*r+e*m;B=e*g*r-k*m;O=g*k*r-e*m;y=k*k*r+h;H=e*k*r+g*m;L=g*e*r+k*m;g=k*e*r-g*m;k=e*e*r+h;d[0]=b*G+v*t+D*B;d[1]=f*G+u*t+l*B;d[2]=n*G+E*t+z*B;d[3]=p*G+q*t+A*B;d[4]=b*O+v*y+D*H;d[5]=f*O+u*y+l*H;d[6]=n*O+E*y+z*H;d[7]=p*O+q*y+A*H;d[8]=b*L+v*g+D*k;d[9]=f*L+u*g+l*k;d[10]=n*L+E*g+z*k;d[11]=p*L+q*g+A*k;a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);
return d};a.rotateX=function(a,b,e){var d=Math.sin(b);b=Math.cos(b);var g=a[4],k=a[5],f=a[6],m=a[7],h=a[8],r=a[9],n=a[10],p=a[11];a!==e&&(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[4]=g*b+h*d;e[5]=k*b+r*d;e[6]=f*b+n*d;e[7]=m*b+p*d;e[8]=h*b-g*d;e[9]=r*b-k*d;e[10]=n*b-f*d;e[11]=p*b-m*d;return e};a.rotateY=function(a,b,e){var d=Math.sin(b);b=Math.cos(b);var g=a[0],k=a[1],f=a[2],m=a[3],h=a[8],r=a[9],n=a[10],p=a[11];a!==e&&(e[4]=a[4],e[5]=a[5],e[6]=a[6],
e[7]=a[7],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[0]=g*b-h*d;e[1]=k*b-r*d;e[2]=f*b-n*d;e[3]=m*b-p*d;e[8]=g*d+h*b;e[9]=k*d+r*b;e[10]=f*d+n*b;e[11]=m*d+p*b;return e};a.rotateZ=function(a,b,e){var d=Math.sin(b);b=Math.cos(b);var g=a[0],k=a[1],f=a[2],m=a[3],h=a[4],r=a[5],n=a[6],p=a[7];a!==e&&(e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[0]=g*b+h*d;e[1]=k*b+r*d;e[2]=f*b+n*d;e[3]=m*b+p*d;e[4]=h*b-g*d;e[5]=r*b-k*d;e[6]=n*b-f*d;e[7]=p*b-m*d;return e};
a.Mv=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.Lv=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.Kv=function(a,b,e){var d=b[0],g=b[1];b=b[2];var k=Math.sqrt(d*d+g*g+b*b),f;if(1E-7>Math.abs(k))return null;k=1/k;d*=k;g*=k;b*=k;k=Math.sin(a);a=Math.cos(a);f=1-a;e[0]=d*d*f+a;e[1]=g*d*f+b*
k;e[2]=b*d*f-g*k;e[3]=0;e[4]=d*g*f-b*k;e[5]=g*g*f+a;e[6]=b*g*f+d*k;e[7]=0;e[8]=d*b*f+g*k;e[9]=g*b*f-d*k;e[10]=b*b*f+a;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};a.rB=function(a,b){var e=Math.sin(a),d=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=d;b[6]=e;b[7]=0;b[8]=0;b[9]=-e;b[10]=d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.sB=function(a,b){var e=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=0;b[2]=-e;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=e;b[9]=0;b[10]=d;b[11]=0;b[12]=0;b[13]=0;
b[14]=0;b[15]=1;return b};a.tB=function(a,b){var e=Math.sin(a),d=Math.cos(a);b[0]=d;b[1]=e;b[2]=0;b[3]=0;b[4]=-e;b[5]=d;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,e){var d=a[0],g=a[1],k=a[2],f=a[3],m=d+d,h=g+g,r=k+k;a=d*m;var n=d*h,d=d*r,p=g*h,g=g*r,k=k*r,m=f*m,h=f*h,f=f*r;e[0]=1-(p+k);e[1]=n+f;e[2]=d-h;e[3]=0;e[4]=n-f;e[5]=1-(a+k);e[6]=g+m;e[7]=0;e[8]=d+h;e[9]=g-m;e[10]=1-(a+p);e[11]=0;e[12]=b[0];e[13]=b[1];e[14]=b[2];
e[15]=1;return e};a.fromQuat=function(a,b){var e=a[0],d=a[1],g=a[2],k=a[3],f=e+e,m=d+d,h=g+g,e=e*f,r=d*f,d=d*m,n=g*f,p=g*m,g=g*h,f=k*f,m=k*m,k=k*h;b[0]=1-d-g;b[1]=r+k;b[2]=n-m;b[3]=0;b[4]=r-k;b[5]=1-e-g;b[6]=p+f;b[7]=0;b[8]=n+m;b[9]=p-f;b[10]=1-e-d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,e,d,g,k,f){var m=1/(b-a),h=1/(d-e),r=1/(g-k);f[0]=2*g*m;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*g*h;f[6]=0;f[7]=0;f[8]=(b+a)*m;f[9]=(d+e)*h;f[10]=(k+g)*r;f[11]=-1;f[12]=0;f[13]=0;f[14]=
k*g*2*r;f[15]=0;return f};a.perspective=function(a,b,e,d,g){a=1/Math.tan(a/2);var k=1/(e-d);g[0]=a/b;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=a;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=(d+e)*k;g[11]=-1;g[12]=0;g[13]=0;g[14]=2*d*e*k;g[15]=0;return g};a.pC=function(a,b,e,d){var g=Math.tan(a.IC*Math.PI/180),k=Math.tan(a.eB*Math.PI/180),f=Math.tan(a.bC*Math.PI/180);a=Math.tan(a.qC*Math.PI/180);var m=2/(f+a),h=2/(g+k);d[0]=m;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=h;d[6]=0;d[7]=0;d[8]=-((f-a)*m*.5);d[9]=(g-k)*h*.5;d[10]=e/
(b-e);d[11]=-1;d[12]=0;d[13]=0;d[14]=e*b/(b-e);d[15]=0;return d};a.ortho=function(a,b,e,d,g,k,f){var m=1/(a-b),h=1/(e-d),r=1/(g-k);f[0]=-2*m;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=-2*h;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=2*r;f[11]=0;f[12]=(a+b)*m;f[13]=(d+e)*h;f[14]=(k+g)*r;f[15]=1;return f};a.lookAt=function(c,b,e,d){var g,k,f,m,h,r,n,p,v=c[0],u=c[1];c=c[2];f=e[0];m=e[1];k=e[2];n=b[0];e=b[1];g=b[2];if(1E-7>Math.abs(v-n)&&1E-7>Math.abs(u-e)&&1E-7>Math.abs(c-g))return a.identity(d);b=v-n;e=u-e;n=c-g;p=1/Math.sqrt(b*
b+e*e+n*n);b*=p;e*=p;n*=p;g=m*n-k*e;k=k*b-f*n;f=f*e-m*b;(p=Math.sqrt(g*g+k*k+f*f))?(p=1/p,g*=p,k*=p,f*=p):f=k=g=0;m=e*f-n*k;h=n*g-b*f;r=b*k-e*g;(p=Math.sqrt(m*m+h*h+r*r))?(p=1/p,m*=p,h*=p,r*=p):r=h=m=0;d[0]=g;d[1]=m;d[2]=b;d[3]=0;d[4]=k;d[5]=h;d[6]=e;d[7]=0;d[8]=f;d[9]=r;d[10]=n;d[11]=0;d[12]=-(g*v+k*u+f*c);d[13]=-(m*v+h*u+r*c);d[14]=-(b*v+e*u+n*c);d[15]=1;return d};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+
a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.Jv=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.__gpp_eval=function(a){a.zq=function(){function a(c,b,e,d,g,k){this.message=c;this.offset=d;this.Qh=g;this.cg=k;this.name="SyntaxError"}(function(a,b){function e(){this.constructor=a}e.prototype=b.prototype;a.prototype=new e})(a,Error);return{SyntaxError:a,parse:function(c){function b(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function e(a){if(cb!==a){cb>a&&(cb=0,Wa={Qh:1,cg:1,ji:!1});var b=Wa,d,e;for(d=
cb;d<a;d++)e=c.charAt(d),"\n"===e?(b.ji||b.Qh++,b.cg=1,b.ji=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(b.Qh++,b.cg=1,b.ji=!0):(b.cg++,b.ji=!1);cb=a}return Wa}function d(a){C<Xa||(C>Xa&&(Xa=C,oa=[]),oa.push(a))}function g(){var a,b,e;a=C;b=P();b!==w?(b=k(),b!==w?(e=P(),e!==w?(W++,10===c.charCodeAt(C)?(e=kc,C++):(e=w,0===W&&d(Ta)),e===w&&(c.substr(C,2)===lc?(e=lc,C+=2):(e=w,0===W&&d(Wb)),e===w&&(13===c.charCodeAt(C)?(e=bb,C++):(e=w,0===W&&d(dc)))),W--,e===w&&0===W&&d(jc),e===w&&(e=null),e!==w?a=b:(C=
a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w);return a}function k(){var a,b,e,g,h,k,l,m;a=C;b=f();if(b!==w){e=[];g=C;h=P();h!==w?(44===c.charCodeAt(C)?(k=N,C++):(k=w,0===W&&d(I)),k!==w?(l=P(),l!==w?(m=f(),m!==w?g=h=[h,k,l,m]:(C=g,g=w)):(C=g,g=w)):(C=g,g=w)):(C=g,g=w);for(;g!==w;)e.push(g),g=C,h=P(),h!==w?(44===c.charCodeAt(C)?(k=N,C++):(k=w,0===W&&d(I)),k!==w?(l=P(),l!==w?(m=f(),m!==w?g=h=[h,k,l,m]:(C=g,g=w)):(C=g,g=w)):(C=g,g=w)):(C=g,g=w);e!==w?a=b=0==e.length?b:e[e.length-1]:(C=a,a=w)}else C=a,a=w;return a}
function f(){var a,b,e,f;a=C;b=m();b!==w?(e=P(),e!==w?(63===c.charCodeAt(C)?(e=Y,C++):(e=w,0===W&&d(ga)),e!==w?(e=P(),e!==w?(e=k(),e!==w?(f=P(),f!==w?(58===c.charCodeAt(C)?(f=qa,C++):(f=w,0===W&&d(M)),f!==w?(f=P(),f!==w?(f=k(),f!==w?a=b?e:f:(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w);a===w&&(a=m());return a}function m(){var a,b,c,d,e,f,g,k;a=C;b=h();if(b!==w){c=[];d=C;e=P();e!==w?(f=ba(),f!==w?(g=P(),g!==w?(k=h(),k!==w?d=e=[e,f,g,k]:(C=d,d=w)):
(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==w;)c.push(d),d=C,e=P(),e!==w?(f=ba(),f!==w?(g=P(),g!==w?(k=h(),k!==w?d=e=[e,f,g,k]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else C=a,a=w}else C=a,a=w;return a}function h(){var a,b,c,d,e,f,g,h;a=C;b=r();if(b!==w){c=[];d=C;e=P();e!==w?(f=T(),f!==w?(g=P(),g!==w?(h=r(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==w;)c.push(d),d=C,e=P(),e!==w?(f=T(),f!==w?(g=P(),g!==w?(h=r(),h!==w?d=e=
[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else C=a,a=w}else C=a,a=w;return a}function r(){var a,b,c,d,e,f,g,h;a=C;b=n();if(b!==w){c=[];d=C;e=P();e!==w?(f=S(),f!==w?(g=P(),g!==w?(h=n(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==w;)c.push(d),d=C,e=P(),e!==w?(f=S(),f!==w?(g=P(),g!==w?(h=n(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a|=c[b][3];else C=a,a=w}else C=
a,a=w;return a}function n(){var a,b,c,d,e,f,g,h;a=C;b=x();if(b!==w){c=[];d=C;e=P();e!==w?(f=K(),f!==w?(g=P(),g!==w?(h=x(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==w;)c.push(d),d=C,e=P(),e!==w?(f=K(),f!==w?(g=P(),g!==w?(h=x(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else C=a,a=w}else C=a,a=w;return a}function x(){var a,b,c,d,e,f,g,h;a=C;b=v();if(b!==w){c=[];d=C;e=P();e!==w?(f=U(),f!==w?(g=P(),g!==w?
(h=v(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==w;)c.push(d),d=C,e=P(),e!==w?(f=U(),f!==w?(g=P(),g!==w?(h=v(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else C=a,a=w}else C=a,a=w;return a}function v(){var a,b,c,d,e,f,g,h;a=C;b=u();if(b!==w){c=[];d=C;e=P();e!==w?(f=F(),f!==w?(g=P(),g!==w?(h=u(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==w;)c.push(d),d=C,e=P(),e!==w?(f=F(),
f!==w?(g=P(),g!==w?(h=u(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else C=a,a=w}else C=a,a=w;return a}function u(){var a,b,c,d,e,f,g,h;a=C;b=E();if(b!==w){c=[];d=C;e=P();e!==w?(f=J(),f!==w?(g=P(),g!==w?(h=E(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==w;)c.push(d),d=C,e=P(),e!==w?(f=J(),f!==w?(g=P(),g!==w?(h=E(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=
d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else C=a,a=w}else C=a,a=w;return a}function E(){var a,b,c,d,e,f,g,h;a=C;b=q();if(b!==w){c=[];d=C;e=P();e!==w?(f=Z(),f!==w?(g=P(),g!==w?(h=q(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==w;)c.push(d),d=C,e=P(),e!==w?(f=Z(),f!==w?(g=P(),g!==w?(h=q(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=
w)):(C=d,d=w)):(C=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else C=a,a=w}else C=a,a=w;return a}function q(){var a,b,c,d,e,f,g,h;a=C;b=D();if(b!==w){c=[];d=C;e=P();e!==w?(f=L(),f!==w?(g=P(),g!==w?(h=D(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==w;)c.push(d),d=C,e=P(),e!==w?(f=L(),f!==w?(g=P(),g!==w?(h=D(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "+":a+=
c[b][3];break;case "-":a-=c[b][3]}else C=a,a=w}else C=a,a=w;return a}function D(){var a,b,c,d,e,f,g,h;a=C;b=l();if(b!==w){c=[];d=C;e=P();e!==w?(f=H(),f!==w?(g=P(),g!==w?(h=l(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==w;)c.push(d),d=C,e=P(),e!==w?(f=H(),f!==w?(g=P(),g!==w?(h=l(),h!==w?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==w)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=Math.floor(a/c[b][3]);break;case "%":a%=
c[b][3]}else C=a,a=w}else C=a,a=w;return a}function l(){var a,e,f;a=C;c.substr(C,7)===R?(e=R,C+=7):(e=w,0===W&&d(s));e!==w?(f=P(),f!==w?(f=A(),f!==w?a=f:(C=a,a=w)):(C=a,a=w)):(C=a,a=w);if(a===w){a=C;e=z();if(e!==w)if(f=P(),f!==w)if(c.substr(C,2)===wa?(f=wa,C+=2):(f=w,0===W&&d(Ca)),f===w&&(c.substr(C,2)===ra?(f=ra,C+=2):(f=w,0===W&&d(Ha))),f!==w){a:{a=e;switch(f){case "++":e=++a;break a;case "--":e=--a;break a}e=void 0}a=e}else C=a,a=w;else C=a,a=w;else C=a,a=w;a===w&&(a=z());a===w&&(a=C,c.substr(C,
2)===wa?(e=wa,C+=2):(e=w,0===W&&d(Ca)),e===w&&(c.substr(C,2)===ra?(e=ra,C+=2):(e=w,0===W&&d(Ha)),e===w&&(43===c.charCodeAt(C)?(e=Ja,C++):(e=w,0===W&&d(kb)),e===w&&(45===c.charCodeAt(C)?(e=Lb,C++):(e=w,0===W&&d(mb)),e===w&&(126===c.charCodeAt(C)?(e=Tb,C++):(e=w,0===W&&d(nb)),e===w&&(33===c.charCodeAt(C)?(e=tc,C++):(e=w,0===W&&d(hc))))))),e!==w?(f=P(),f!==w?(f=l(),f!==w?a=e=b(e,f):(C=a,a=w)):(C=a,a=w)):(C=a,a=w))}return a}function z(){var a,b,e;W++;var f;a=C;48===c.charCodeAt(C)?(b=la,C++):(b=w,0===
W&&d(Q));if(b!==w)if(Ea.test(c.charAt(C))?(b=c.charAt(C),C++):(b=w,0===W&&d(vb)),b!==w){b=C;e=[];f=t();if(f!==w)for(;f!==w;)e.push(f),f=t();else e=w;b=e!==w?c.substring(b,C):e;b!==w?a=b=parseInt("0x"+b):(C=a,a=w)}else C=a,a=w;else C=a,a=w;if(a===w){a=C;48===c.charCodeAt(C)?(b=la,C++):(b=w,0===W&&d(Q));if(b===w)if(b=C,Za.test(c.charAt(C))?(e=c.charAt(C),C++):(e=w,0===W&&d(va)),e!==w){var g;f=[];g=G();if(g!==w)for(;g!==w;)f.push(g),g=G();else f=w;f===w&&(f=null);f!==w?b=e=[e,f]:(C=b,b=w)}else C=b,b=
w;a=b!==w?c.substring(a,C):b;a!==w&&(a=parseInt(a))}W--;a===w&&0===W&&d(ea);a===w&&(b=B(),b!==w&&(b=0),a=b,a===w&&(a=C,40===c.charCodeAt(C)?(b=V,C++):(b=w,0===W&&d(ma)),b!==w?(b=P(),b!==w?(b=k(),b!==w?(e=P(),e!==w?(41===c.charCodeAt(C)?(e=pa,C++):(e=w,0===W&&d(na)),e!==w?a=b:(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)));return a}function A(){var a,b,e,f,g;b=B();b!==w&&(b=0);a=b;if(a===w){b=[];f=e=C;W++;40===c.charCodeAt(C)?(g=V,C++):(g=w,0===W&&d(ma));g===w&&(41===c.charCodeAt(C)?(g=pa,
C++):(g=w,0===W&&d(na)));W--;g===w?f=void 0:(C=f,f=w);f!==w?(g=X(),g!==w?e=f=[f,g]:(C=e,e=w)):(C=e,e=w);if(e!==w)for(;e!==w;)b.push(e),f=e=C,W++,40===c.charCodeAt(C)?(g=V,C++):(g=w,0===W&&d(ma)),g===w&&(41===c.charCodeAt(C)?(g=pa,C++):(g=w,0===W&&d(na))),W--,g===w?f=void 0:(C=f,f=w),f!==w?(g=X(),g!==w?e=f=[f,g]:(C=e,e=w)):(C=e,e=w);else b=w;b!==w&&(b=1);a=b;a===w&&(a=C,40===c.charCodeAt(C)?(b=V,C++):(b=w,0===W&&d(ma)),b!==w?(e=P(),e!==w?(f=A(),f!==w?(g=P(),g!==w?(41===c.charCodeAt(C)?(b=pa,C++):(b=
w,0===W&&d(na)),b!==w?a=f:(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w))}return a}function G(){var a;Ba.test(c.charAt(C))?(a=c.charAt(C),C++):(a=w,0===W&&d(ia));return a}function t(){var a;lb.test(c.charAt(C))?(a=c.charAt(C),C++):(a=w,0===W&&d(gb));return a}function B(){var a,b;W++;b=a=C;W++;var e,f,g,h;e=C;c.substr(C,7)===R?(f=R,C+=7):(f=w,0===W&&d(s));f!==w?(g=C,W++,h=y(),W--,h===w?g=void 0:(C=g,g=w),g!==w?e=f=[f,g]:(C=e,e=w)):(C=e,e=w);W--;e===w?b=void 0:(C=b,b=w);if(b!==w){W++;b=C;e=O();
if(e!==w){f=[];for(g=y();g!==w;)f.push(g),g=y();f!==w?b=e+=f.join(""):(C=b,b=w)}else C=b,b=w;W--;b===w&&0===W&&d(Fa);b!==w?a=b:(C=a,a=w)}else C=a,a=w;W--;a===w&&0===W&&d(Fa);return a}function O(){var a;eb.test(c.charAt(C))?(a=c.charAt(C),C++):(a=w,0===W&&d(ta));a===w&&(36===c.charCodeAt(C)?(a=wb,C++):(a=w,0===W&&d(sa)),a===w&&(95===c.charCodeAt(C)?(a=bc,C++):(a=w,0===W&&d(ka))));return a}function y(){var a;a=O();a===w&&(a=G());return a}function H(){var a,b,e,f;a=C;42===c.charCodeAt(C)?(b=hb,C++):
(b=w,0===W&&d(xa));b===w&&(47===c.charCodeAt(C)?(b=ab,C++):(b=w,0===W&&d(zb)),b===w&&(37===c.charCodeAt(C)?(b=ic,C++):(b=w,0===W&&d(Ab))));b!==w?(e=C,W++,61===c.charCodeAt(C)?(f=Ua,C++):(f=w,0===W&&d($a)),W--,f===w?e=void 0:(C=e,e=w),e!==w?a=b:(C=a,a=w)):(C=a,a=w);return a}function L(){var a,b,e;a=C;43===c.charCodeAt(C)?(b=Ja,C++):(b=w,0===W&&d(kb));b!==w?(b=C,W++,43===c.charCodeAt(C)?(e=Ja,C++):(e=w,0===W&&d(kb)),e===w&&(61===c.charCodeAt(C)?(e=Ua,C++):(e=w,0===W&&d($a))),W--,e===w?b=void 0:(C=b,
b=w),b!==w?a="+":(C=a,a=w)):(C=a,a=w);a===w&&(a=C,45===c.charCodeAt(C)?(b=Lb,C++):(b=w,0===W&&d(mb)),b!==w?(b=C,W++,45===c.charCodeAt(C)?(e=Lb,C++):(e=w,0===W&&d(mb)),e===w&&(61===c.charCodeAt(C)?(e=Ua,C++):(e=w,0===W&&d($a))),W--,e===w?b=void 0:(C=b,b=w),b!==w?a="-":(C=a,a=w)):(C=a,a=w));return a}function Z(){var a;c.substr(C,2)===Ia?(a=Ia,C+=2):(a=w,0===W&&d(Zb));a===w&&(c.substr(C,2)===Sa?(a=Sa,C+=2):(a=w,0===W&&d(Ga)));return a}function J(){var a;c.substr(C,2)===Bb?(a=Bb,C+=2):(a=w,0===W&&d(Ub));
a===w&&(c.substr(C,2)===ob?(a=ob,C+=2):(a=w,0===W&&d(Ra)),a===w&&(60===c.charCodeAt(C)?(a=Va,C++):(a=w,0===W&&d(za)),a===w&&(62===c.charCodeAt(C)?(a=pb,C++):(a=w,0===W&&d(Mb)))));return a}function F(){var a;c.substr(C,2)===ua?(a=ua,C+=2):(a=w,0===W&&d(rb));a===w&&(c.substr(C,2)===da?(a=da,C+=2):(a=w,0===W&&d(Nb)));return a}function U(){var a,b,e;a=C;38===c.charCodeAt(C)?(b=ya,C++):(b=w,0===W&&d(Aa));b!==w?(b=C,W++,38===c.charCodeAt(C)?(e=ya,C++):(e=w,0===W&&d(Aa)),W--,e===w?b=void 0:(C=b,b=w),b!==
w?a="&":(C=a,a=w)):(C=a,a=w);return a}function K(){var a,b,e;a=C;94===c.charCodeAt(C)?(b=Da,C++):(b=w,0===W&&d(xb));b!==w?(b=C,W++,94===c.charCodeAt(C)?(e=Da,C++):(e=w,0===W&&d(xb)),W--,e===w?b=void 0:(C=b,b=w),b!==w?a="^":(C=a,a=w)):(C=a,a=w);return a}function S(){var a,b,e;a=C;124===c.charCodeAt(C)?(b=yb,C++):(b=w,0===W&&d(Oa));b!==w?(b=C,W++,124===c.charCodeAt(C)?(e=yb,C++):(e=w,0===W&&d(Oa)),W--,e===w?b=void 0:(C=b,b=w),b!==w?a="|":(C=a,a=w)):(C=a,a=w);return a}function T(){var a;c.substr(C,2)===
Ob?(a=Ob,C+=2):(a=w,0===W&&d(ib));a!==w&&(a="&&");return a}function ba(){var a;c.substr(C,2)===Pb?(a=Pb,C+=2):(a=w,0===W&&d(cc));a!==w&&(a="||");return a}function P(){var a,b;a=[];for(b=ca();b!==w;)a.push(b),b=ca();return a}function ca(){var a;W++;Vb.test(c.charAt(C))?(a=c.charAt(C),C++):(a=w,0===W&&d(Gb));W--;a===w&&0===W&&d(uc);return a}function X(){var a;c.length>C?(a=c.charAt(C),C++):(a=w,0===W&&d(sb));return a}var aa=1<arguments.length?arguments[1]:{},w={},fa={start:g},ja=g,N=",",I={type:"literal",
value:",",description:'","'},Y="?",ga={type:"literal",value:"?",description:'"?"'},qa=":",M={type:"literal",value:":",description:'":"'},R="defined",s={type:"literal",value:"defined",description:'"defined"'},V="(",ma={type:"literal",value:"(",description:'"("'},pa=")",na={type:"literal",value:")",description:'")"'},ea={type:"other",description:"number"},la="0",Q={type:"literal",value:"0",description:'"0"'},Ba=/^[0-9]/,ia={type:"class",value:"[0-9]",description:"[0-9]"},Za=/^[1-9]/,va={type:"class",
value:"[1-9]",description:"[1-9]"},Ea=/^[xX]/,vb={type:"class",value:"[xX]",description:"[xX]"},lb=/^[0-9a-fA-F]/,gb={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},Fa={type:"other",description:"identifier"},wb="$",sa={type:"literal",value:"$",description:'"$"'},bc="_",ka={type:"literal",value:"_",description:'"_"'},eb=/^[a-zA-Z]/,ta={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},wa="++",Ca={type:"literal",value:"++",description:'"++"'},ra="--",Ha={type:"literal",value:"--",description:'"--"'},
Ja="+",kb={type:"literal",value:"+",description:'"+"'},Lb="-",mb={type:"literal",value:"-",description:'"-"'},Tb="~",nb={type:"literal",value:"~",description:'"~"'},tc="!",hc={type:"literal",value:"!",description:'"!"'},hb="*",xa={type:"literal",value:"*",description:'"*"'},ab="/",zb={type:"literal",value:"/",description:'"/"'},ic="%",Ab={type:"literal",value:"%",description:'"%"'},Ua="=",$a={type:"literal",value:"=",description:'"="'},Ia="<<",Zb={type:"literal",value:"<<",description:'"<<"'},Sa=
">>",Ga={type:"literal",value:">>",description:'">>"'},Bb="<=",Ub={type:"literal",value:"<=",description:'"<="'},ob=">=",Ra={type:"literal",value:">=",description:'">="'},Va="<",za={type:"literal",value:"<",description:'"<"'},pb=">",Mb={type:"literal",value:">",description:'">"'},ua="==",rb={type:"literal",value:"==",description:'"=="'},da="!=",Nb={type:"literal",value:"!=",description:'"!="'},ya="&",Aa={type:"literal",value:"&",description:'"&"'},Da="^",xb={type:"literal",value:"^",description:'"^"'},
yb="|",Oa={type:"literal",value:"|",description:'"|"'},Ob="&&",ib={type:"literal",value:"&&",description:'"&&"'},Pb="||",cc={type:"literal",value:"||",description:'"||"'},uc={type:"other",description:"whitespace"},Vb=/^[\t\x0B\f ]/,Gb={type:"class",value:"[\\t\\v\\f ]",description:"[\\t\\v\\f ]"},jc={type:"other",description:"end of line"},kc="\n",Ta={type:"literal",value:"\n",description:'"\\n"'},lc="\r\n",Wb={type:"literal",value:"\r\n",description:'"\\r\\n"'},bb="\r",dc={type:"literal",value:"\r",
description:'"\\r"'},sb={type:"any",description:"any character"},C=0,cb=0,Wa={Qh:1,cg:1,ji:!1},Xa=0,oa=[],W=0,Ka;if("startRule"in aa){if(!(aa.lr in fa))throw Error("Can't start parsing from rule \""+aa.lr+'".');ja=fa[aa.lr]}Ka=ja();if(Ka!==w&&C===c.length)return Ka;Ka!==w&&C<c.length&&d({type:"end",description:"end of input"});throw function(b,d,f){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,
1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0100-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1000-\uFFFF]/g,function(a){return"\\u"+b(a)})}
var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var k=e(f),l=f<c.length?c.charAt(f):null;null!==d&&g(d);return new a(null!==b?b:h(d,l),0,0,f,k.Qh,k.cg)}(null,oa,Xa);}}}()};b4w.module.__md5=function(a){function p(a,f){var g=a[0],h=a[1],r=a[2],n=a[3],g=b(g,h,r,n,f[0],7,-680876936),n=b(n,g,h,r,f[1],12,-389564586),r=b(r,n,g,h,f[2],17,606105819),h=b(h,r,n,g,f[3],22,-1044525330),g=b(g,h,r,n,f[4],7,-176418897),n=b(n,g,h,r,f[5],12,1200080426),r=b(r,n,g,h,f[6],17,-1473231341),h=b(h,r,n,g,f[7],22,-45705983),g=b(g,h,r,n,f[8],7,1770035416),n=b(n,g,h,r,f[9],12,-1958414417),r=b(r,n,g,h,f[10],17,-42063),h=b(h,r,n,g,f[11],22,-1990404162),g=b(g,h,r,n,f[12],7,1804603682),n=b(n,g,h,r,
f[13],12,-40341101),r=b(r,n,g,h,f[14],17,-1502002290),h=b(h,r,n,g,f[15],22,1236535329),g=e(g,h,r,n,f[1],5,-165796510),n=e(n,g,h,r,f[6],9,-1069501632),r=e(r,n,g,h,f[11],14,643717713),h=e(h,r,n,g,f[0],20,-373897302),g=e(g,h,r,n,f[5],5,-701558691),n=e(n,g,h,r,f[10],9,38016083),r=e(r,n,g,h,f[15],14,-660478335),h=e(h,r,n,g,f[4],20,-405537848),g=e(g,h,r,n,f[9],5,568446438),n=e(n,g,h,r,f[14],9,-1019803690),r=e(r,n,g,h,f[3],14,-187363961),h=e(h,r,n,g,f[8],20,1163531501),g=e(g,h,r,n,f[13],5,-1444681467),n=
e(n,g,h,r,f[2],9,-51403784),r=e(r,n,g,h,f[7],14,1735328473),h=e(h,r,n,g,f[12],20,-1926607734),g=c(h^r^n,g,h,f[5],4,-378558),n=c(g^h^r,n,g,f[8],11,-2022574463),r=c(n^g^h,r,n,f[11],16,1839030562),h=c(r^n^g,h,r,f[14],23,-35309556),g=c(h^r^n,g,h,f[1],4,-1530992060),n=c(g^h^r,n,g,f[4],11,1272893353),r=c(n^g^h,r,n,f[7],16,-155497632),h=c(r^n^g,h,r,f[10],23,-1094730640),g=c(h^r^n,g,h,f[13],4,681279174),n=c(g^h^r,n,g,f[0],11,-358537222),r=c(n^g^h,r,n,f[3],16,-722521979),h=c(r^n^g,h,r,f[6],23,76029189),g=
c(h^r^n,g,h,f[9],4,-640364487),n=c(g^h^r,n,g,f[12],11,-421815835),r=c(n^g^h,r,n,f[15],16,530742520),h=c(r^n^g,h,r,f[2],23,-995338651),g=d(g,h,r,n,f[0],6,-198630844),n=d(n,g,h,r,f[7],10,1126891415),r=d(r,n,g,h,f[14],15,-1416354905),h=d(h,r,n,g,f[5],21,-57434055),g=d(g,h,r,n,f[12],6,1700485571),n=d(n,g,h,r,f[3],10,-1894986606),r=d(r,n,g,h,f[10],15,-1051523),h=d(h,r,n,g,f[1],21,-2054922799),g=d(g,h,r,n,f[8],6,1873313359),n=d(n,g,h,r,f[15],10,-30611744),r=d(r,n,g,h,f[6],15,-1560198380),h=d(h,r,n,g,f[13],
21,1309151649),g=d(g,h,r,n,f[4],6,-145523070),n=d(n,g,h,r,f[11],10,-1120210379),r=d(r,n,g,h,f[2],15,718787259),h=d(h,r,n,g,f[9],21,-343485551);a[0]=g+a[0]&4294967295;a[1]=h+a[1]&4294967295;a[2]=r+a[2]&4294967295;a[3]=n+a[3]&4294967295}function c(a,b,c,d,e,g){b=(b+a&4294967295)+(d+g&4294967295)&4294967295;return(b<<e|b>>>32-e)+c&4294967295}function b(a,b,d,e,g,n,p){return c(b&d|~b&e,a,b,g,n,p)}function e(a,b,d,e,g,n,p){return c(b&e|d&~e,a,b,g,n,p)}function d(a,b,d,e,g,n,p){return c(d^(b|~e),a,b,g,
n,p)}var g="0123456789abcdef".split("");a.Bp=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var e=b.substring(d-64,d),n=[],x=void 0,x=0;64>x;x+=4)n[x>>2]=e.charCodeAt(x)+(e.charCodeAt(x+1)<<8)+(e.charCodeAt(x+2)<<16)+(e.charCodeAt(x+3)<<24);p(a,n)}b=b.substring(d-64);e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)e[d>>2]|=b.charCodeAt(d)<<(d%4<<3);e[d>>2]|=128<<(d%4<<3);if(55<d)for(p(a,e),d=0;16>d;d++)e[d]=0;e[14]=8*
c;p(a,e);for(b=0;b<a.length;b++){c=a[b];d="";for(e=0;4>e;e++)d+=g[c>>8*e+4&15]+g[c>>8*e&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_glow_intensity",";"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",
b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_glow_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},
{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",
a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 cl = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"cl = mix ( cl , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 cm = vec3 ( 0.0 ) ; vec3 cn = vec3 ( 0.0 ) ; vec3 co = vec3 ( 0.0 ) ; bt ( cl , cm , cn , co ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","cp","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cp = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 cq = ( u_model_matrix * vec4 ( cp , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",
b:"mat4 cr = ag ( u_camera_eye , cq , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 cr = aa ( u_camera_eye , cq , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 cs = ( u_model_matrix * vec4 ( cp , 1.0 ) ) . xyz ; cr = cr * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , cs ) ;".split(" ")}]}}]},{type:"textline",b:"d ct = an ( cl - cp , cp , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , cr ) ; ct . b = cq ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"d ct = an ( cl , cp , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","cu","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cu = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ck ( ct . a , ct . b , cu ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( ct . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ;".split(" ")}]}}]},{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"shadow.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:"float ft = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ft = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( ft < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cs ( cF ) ;".split(" ")}]}},
{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( fn ( cL . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"WIND_BEND && MAIN_BEND_COL && DETAIL_BEND || SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:"BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cF",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},
{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 gw = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"gw = mix ( gw , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 gx = vec3 ( 0.0 ) ; vec3 gy = vec3 ( 0.0 ) ; vec3 gz = vec3 ( 0.0 ) ; bt ( gw , gx , gy , gz ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","gA","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d gB = gh ( gw , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gA , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gC = ( u_model_matrix * vec4 ( gA , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! HAIR_BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["mat4","gD","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["mat4","gD",
"=","u_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 gE = ag ( u_camera_eye , gC , gD , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gE = aa ( u_camera_eye , gC , gD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 gF = ( u_model_matrix * vec4 ( gA , 1.0 ) ) . xyz ; gE = gE * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , gF ) ;".split(" ")}]}}]},
{type:"textline",b:"d gB = an ( gw - gA , gA , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gE ) ; gB . b = gC ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d gB = an ( gw , gA , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","gG","=","a_normal",
";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gG = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ck ( gB . a , gB . b , gG ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gH = u_view_matrix * vec4 ( gB . a , 1.0 ) ; vec4 gI = u_proj_matrix * gH ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"gI . xy += u_subpixel_jitter * gI . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gr ( gB . a ) ; cL = gH ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"cF = - gH . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 gJ = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; float gK = SHADOW_TEX_RES / 2.0 ; gJ = floor ( gJ * gK + 0.5 ) / gK - gJ ; gI . xy += gJ ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gI",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gw",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gw",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( gw , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , gw ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",
b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gw",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gw",";"]}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gw",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gx = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 gy = aa ( u_camera_eye , gx , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"gy = gy * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"d gz = an ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gy ) ; gz . b = gx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d gz = an ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gA = u_proj_matrix * u_view_matrix * vec4 ( gz . a , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gw = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["gw","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gw","=","a_grass_color",";"]}]}}]}]}}]},
{type:"textline",b:["gl_Position","=","gA",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 gE ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float gF ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",
">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int gG = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int gG = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float gI ( float gH ) { return gH - floor ( gH * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void gR ( inout float gJ , in float gK [ gG ] , in float gL ) { for ( int gM = 0 ; gM < NUM_RINGS ; gM ++ ) { float gN = 40.0 * gK [ gM ] ; float gO = 300.0 * ( gI ( gN ) - 0.005 ) ; float gP = gN ; float gQ = abs ( gP * ( u_halo_size * gO - gL ) ) ; gJ += 1.0 - min ( gQ , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void g_ ( inout float gS , in float gT [ gG ] , in float gU ) { for ( int gV = 0 ; gV < NUM_LINES ; gV ++ ) { float gW = gT [ gV ] ; float gX = gW ; float gY = 1000.0 * ( gI ( gW ) - 0.005 ) ; float gZ = 20.0 * abs ( gX * a . x + gY * a . y ) ; gS += 1.0 - min ( gZ , 1.0 ) ; } gS *= gU ; }".split(" ")}]}}]},{type:"textline",b:"void hg ( inout float ha , in vec2 hb ) { float hc , hd ; hd = atan ( hb . y , hb . x ) ; hd *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float he = cos ( hd ) ; float hf = sin ( hd ) ; hd = ( he * hb . x + hf * hb . y ) * ( he * hb . y - hf * hb . x ) ; hc = abs ( hd ) ; if ( hc < 1.0 ) { hc = ( 0.01 * u_halo_size ) / ( hc ) ; ha *= sqrt ( min ( hc , 1.0 ) ) ; } } void main ( ) { float hh = ( a . x * a . x + a . y * a . y ) ; float hi = sqrt ( hh ) ; hh = max ( 1.0 - hh , 0.0 ) ; hh = pow ( hh , u_halo_hardness ) ; float hj = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hk [ gG ] ; for ( int hl = 0 ; hl < gG ; hl ++ ) { hk [ hl ] = fract ( gF / ( float ( hl ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"float hm = 0.0 ; gR ( hm , hk , hi ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hn = 0.0 ; g_ ( hn , hk , hh ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"hg ( hh , a ) ;".split(" ")}]}}]},{type:"textline",b:"hh *= hj ; vec3 ho = u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"hm *= hh ; ho += u_halo_rings_color * hm ; hh += hm ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"hn *= hj ; ho += u_halo_lines_color * hn ; hh += hn ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"hh *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float hp = u_halo_stars_blend * ( gE . y - u_halo_stars_height ) ; hh *= clamp ( hp , 0.0 , 1.0 ) ; hh *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"gA ( ho ) ; gD ( ho , hh ) ; gl_FragColor = vec4 ( ho , hh ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float gF ;".split(" ")},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gE",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 gG = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; a = a_halo_bb_vertex * 2.0 ; gF = fract ( gG . x + gG . y + gG . z ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",
a:[{type:"textline",b:"mat4 gH = z ( gG , u_view_matrix ) ; mat4 gI = u_view_matrix ; gI [ 3 ] [ 0 ] = 0.0 ; gI [ 3 ] [ 1 ] = 0.0 ; gI [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gH = z ( gG , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gJ = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 gK = gH * gJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"vec4 gL = u_proj_matrix * gI * gK ; gL . z = 0.99999 * gL . w ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["gE","=","gK",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 gL = u_proj_matrix * u_view_matrix * gK ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gL",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};
a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 gG = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( gG , 1.0 ) ; }".split(" ")}]};a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",
name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ; uniform int u_shadow_lamp_id ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D",
"u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_reflect_factor ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 kE ; varying vec3 kF ; varying vec3 kG ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kH",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],
group:{type:"group",a:[{type:"textline",b:"float lu = kF . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["vec2","lv","=","a",";"]}]}}]},{type:"textline",b:["vec3","lw","=","kG",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) lw = lw ; else lw = - lw ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:"vec3 lx = cross ( lw , kH . xyz ) * kH . w ; mat3 ly = mat3 ( kH . xyz , lx , lw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float lz = length ( cL ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"vec2 lA = normalize ( u_view_matrix_frag * vec4 ( kG , 0.0 ) ) . st ; lA = lA * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( lz < PARALLAX_LOD_DIST ) { float lB = clamp ( 0.5 * ( PARALLAX_LOD_DIST - lz ) , 0.0 , 1.0 ) ; float lC = u_parallax_scale * lB ; vec3 lD = normalize ( kE * ly ) ; float lE = 1.0 / PARALLAX_STEPS ; vec2 lF = lD . xy * lC / ( PARALLAX_STEPS * lD . z ) ; float lG = 1.0 ; float lH ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:["vec2","lI","=","lA",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","lI","=","lv",";"]}]}}]},{type:"textline",b:"lH = texture2D ( u_normalmap0 , lI ) . a ; for ( float lJ = 1.0 ; lJ <= PARALLAX_STEPS ; lJ ++ ) { if ( lH < lG ) { lG -= lE ; lI -= lF ; lH = texture2D ( u_normalmap0 , lI ) . a ; } } vec2 lK = lI + lF ; float lL = texture2D ( u_normalmap0 , lK ) . a - ( lG + lE ) ; float lM = lH - lG ; float lN = lM / ( lM - lL ) ; lI = lN * lK + ( 1.0 - lN ) * lI ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lv += lI - lA ;".split(" ")}]}}]},{type:"textline",b:["lA","=","lI",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lA += lI - lv ;".split(" ")}]}}]},{type:"textline",b:["lv","=","lI",";"]}]}}]},{type:"textline",
b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["vec4","lO",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lO = texture2D ( u_normalmap0 , lA ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lO = texture2D ( u_normalmap0 , lv ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lP = lO . rgb - 0.5 ; lP = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , lP , u_normal_factor ) ; vec3 lQ = ly * lP ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","lQ","=","lw",";"]}]}}]},{type:"textline",b:"lQ = normalize ( lQ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lA = normalize ( u_view_matrix_frag * vec4 ( lQ , 0.0 ) ) . st ; lA = lA * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lR = normalize ( kE ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],
group:{type:"group",a:[{type:"textline",b:"vec3 lS = kI ; gy ( lS ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec4 lT = vec4 ( lS , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","lT","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["float","lU","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:"vec4 lV = texture2D ( u_colormap0 , lA ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec4 lV = texture2D ( u_colormap0 , lv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"gy ( lV . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","lW",
";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lW = texture2D ( u_colormap1 , lA ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lW = texture2D ( u_colormap1 , lv ) ;".split(" ")}]}}]},{type:"textline",b:"gy ( lW . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec4 lX = texture2D ( u_stencil0 , lA ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 lX = texture2D ( u_stencil0 , lv ) ;".split(" ")}]}}]},{type:"textline",b:"lV = mix ( lV , lW , lX . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lT . rgb = mix ( lT . rgb , lV . rgb , u_diffuse_color_factor ) ; float lY = u_alpha_factor * lV . a ; lY += ( 1.0 - step ( 0.0 , lY ) ) ; lT . a = mix ( lY , 1.0 , u_diffuse_color . a ) ; lU = lV . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lT . rgb *= mix ( vec3 ( 1.0 ) , lV . rgb , u_diffuse_color_factor ) ; lT . a = lV . a ; lU = lV . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 lZ = u_diffuse_intensity * lT . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["vec3","l_","=","lZ",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ma = 0.5 * lQ . y + 0.5 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 mb = u_environment_energy * textureCube ( u_sky_texture , lQ ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mb = u_environment_energy * mix ( u_horizon_color , u_zenith_color , ma ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 mc = u_ambient * mb ; float md = fs ( lZ ) ; vec3 me = u_emit * lT . rgb ; vec3 mf = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"vec3 mg = vec3 ( lU ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 mg = texture2D ( u_specmap0 , lA ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mg = texture2D ( u_specmap0 , lv ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"gy ( mg . rgb ) ; mf = mix ( mf , mg , u_specular_color_factor ) ;".split(" ")}]}}]},
{type:"textline",b:"float mh = u_specular_params [ 0 ] ; vec2 mi = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 mj = mh * mf ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS","==","0"],group:{type:"group",a:[{type:"textline",b:"hw mk = kc ( me , mc , lZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hw mk = jY ( me , mc , lZ , mj , kF , lQ , lR , mi , u_diffuse_params , md , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , u_shadow_lamp_id ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 l_ = mk . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["float","ml","=","u_reflect_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","ml","=","0.0",";"]}]}}]},{type:"textline",b:"lf ( l_ , lR , lQ , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , ml ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"l_ += mk . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"l_ = max ( l_ - sqrt ( 0.01 * - min ( lu , 0.0 ) ) , 0.5 * l_ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"kD ( l_ , lu , u_time , md , lQ , u_sun_direction , u_sun_intensity , u_sun_quaternion , kF , lz ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"float mm = lT . a ; if ( mm <= 0.5 ) discard ; mm = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float mm = lT . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"mm += mk . a . a * mj . r * u_specular_alpha ;".split(" ")}]}}]}]}}]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["float","mm","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"l_ = mix ( lt ( cK , lQ . xz * u_refr_bump ) , l_ , mm ) ; mm = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float mn = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 mo = gS ( u_cube_fog , lR ) ; vec4 mp = vec4 ( mo , u_fog_color_density . a ) ; gy ( mp . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 mp = u_fog_color_density ; mp . rgb *= mn ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"hk ( l_ , lz , lR , u_cam_water_depth , u_underwater_fog_color_density , mp , lu , mn ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( l_ , lz , mp ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),group:{type:"group",a:[{type:"textline",b:"l_ = vec3 ( dT . a ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","l_",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"gD ( l_ , mm ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( l_ , mm ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 kE ; varying vec3 kF ; varying vec3 kG ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kI",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 lu = a_position ; vec3 lv = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec3 lw = vec3 ( a_tangent ) ; vec3 lx = a_tangent [ 3 ] * cross ( lv , lw ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 ly = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 lz = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vec3 lA = ly - u_camera_eye ; vec3 lx = cross ( lA , lz ) ; vec3 lw = cross ( lz , lx ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lw = vec3 ( 0.0 ) ; vec3 lx = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"lu = mix ( lu , a_position_next , u_va_frame_factor ) ; lv = mix ( lv , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vec3 lB = vec3 ( a_tangent ) ; vec3 lC = a_tangent_next [ 3 ] * cross ( a_normal_next , lB ) ; lw = mix ( lw , lB , u_va_frame_factor ) ; lx = mix ( lx , lC , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bt ( lu , lw , lx , lv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","lD","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lD = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d lE = gh ( lu , lw , lx , lv , lD , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lF = ( u_model_matrix * vec4 ( lD , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 lG = ag ( u_camera_eye , lF , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 lG = aa ( u_camera_eye , lF , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lH = ( u_model_matrix * vec4 ( lD , 1.0 ) ) . xyz ; lG = lG * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lH ) ;".split(" ")}]}}]},{type:"textline",b:"d lE = an ( lu - lD , lD , lw , lx , lv , lG ) ; lE . b = lF ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d lE = an ( lu , lD , lw , lx , lv , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"float lI = ( dot ( cross ( lE . e , lE . c ) , lE . d ) < 0.0 ) ? - 1.0 : 1.0 ; kH = vec4 ( lE . c , lI ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( lE . a , lE . b , lv ) ;".split(" ")}]}}]},{type:"textline",b:"kF = lE . a ; kG = lE . e ; kE = u_camera_eye - lE . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",
a:[{type:"textline",b:"a = aq ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kI = lE . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["kI","=","a_color",";"]}]}}]},{type:"textline",b:"vec4 lJ = u_view_matrix * vec4 ( lE . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),
group:{type:"group",a:[{type:"textline",b:["cL","=","lJ",";"]}]}}]},{type:"textline",b:"vec4 lK = u_proj_matrix * lJ ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"lK . xy += u_subpixel_jitter * lK . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gr","(","lK",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",
b:"gr ( lE . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:"float lL = lK . x ; float lM = lK . y ; float lN = lK . w ; cK . x = ( lL + lN ) / 2.0 ; cK . y = ( lM + lN ) / 2.0 ; cK . z = lN ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kJ = - lJ . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position",
"=","lK",";","}"]}]};a["nodes.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_ANIM_VALUES",b:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",b:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",
b:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",
b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ; uniform int u_shadow_lamp_id ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_VECTOR_VIEW","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_reflectmap ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform",
"sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_ANIM_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_anim_values [ NUM_ANIM_VALUES ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 kF ; varying vec4 cL ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","kH",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"textline",
b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 lu = vec3 ( ZERO_VALUE_NODES ) ; vec3 lv = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 lz ( in vec3 lw , in float lx ) { vec3 ly = lu ;".split(" ")},
{type:"condition",a:[{type:"if",c:["USE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"ly = lt ( cK , lw . xz * lx ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ly = texture2D ( u_refractmap , cK . xy / cK . z ) . rgb ; gy ( ly ) ;".split(" ")}]}}]},{type:"textline",b:["return","ly",";","}"]}]}}]},{type:"textline",b:"vec3 lC ( float lA , vec3 lB ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , lB ) . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"return mix ( u_horizon_color , u_zenith_color , lA ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 lJ ( vec3 lD ) { vec4 lE = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; vec4 lF = mix ( vec4 ( lD . bg , lE . wz ) , vec4 ( lD . gb , lE . xy ) , step ( lD . b , lD . g ) ) ; vec4 lG = mix ( vec4 ( lF . xyw , lD . r ) , vec4 ( lD . r , lF . yzx ) , step ( lF . x , lD . r ) ) ; float lH = lG . x - min ( lG . w , lG . y ) ; float lI = 1.0e-10 ; return vec3 ( abs ( lG . z + ( lG . w - lG . y ) / ( 6.0 * lH + lI ) ) , lH / ( lG . x + lI ) , lG . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 lN ( vec3 lK ) { vec4 lL = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; vec3 lM = abs ( fract ( vec3 ( lK . r , lK . r , lK . r ) + lL . xyz ) * 6.0 - lL . www ) ; return lK . b * mix ( lL . xxx , clamp ( lM - lL . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , lK . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_B4W_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 lP ( vec2 lO ) { return vec3 ( lO * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_TEXTURE_COLOR || USE_NODE_TEXTURE_NORMAL || USE_NODE_TEXTURE_COLOR2 || USE_NODE_TEXTURE_NORMAL2 || USE_NODE_TEXTURE_COLOR3 || USE_NODE_TEXTURE_NORMAL3 || USE_NODE_TEXTURE_NORMAL4 || USE_NODE_TEXTURE_COLOR4 || USE_NODE_B4W_PARALLAX".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lR ( vec3 lQ ) { return vec2 ( lQ . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},{type:"node",name:"CAMERA",k:[{type:"node_out",name:"mz",qualifier:["vec3"],e:!0},{type:"node_out",name:"mA",qualifier:["float"],e:!0},{type:"node_out",name:"mB",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mz"],f:[{type:"textline",b:"mz = normalize ( mp . xyz ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_mA"],f:[{type:"textline",b:"mA = abs ( mp . z ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_mB"],f:[{type:"textline",b:"mB = length ( mp . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",k:[{type:"node_in",name:"mC",qualifier:["float"],e:!1},{type:"node_in",name:"mD",qualifier:["float"],e:!1},{type:"node_in",name:"mE",qualifier:["float"],e:!1},{type:"node_out",name:"mF",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mF = vec3 ( mC , mD , mE ) ;".split(" ")}]},
{type:"node",name:"COMBHSV",k:[{type:"node_in",name:"mG",qualifier:["float"],e:!1},{type:"node_in",name:"mH",qualifier:["float"],e:!1},{type:"node_in",name:"mI",qualifier:["float"],e:!1},{type:"node_out",name:"mJ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mJ = lN ( vec3 ( mG , mH , mI ) ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_out",name:"mK",qualifier:["vec3"],e:!1},{type:"node_param",name:"lS",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"mK = lP ( lS ) ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC",k:[{type:"node_out",name:"mL",qualifier:["vec3"],e:!1},{type:"node_param",name:"lT",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["mL","=","lT",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_out",name:"mM",qualifier:["float"],e:!1},{type:"node_param",name:"lU",qualifier:["varying","float"]}],f:[{type:"textline",b:["mM","=","lU",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_out",name:"mN",qualifier:["float"],e:!1},{type:"node_out",name:"mO",
qualifier:["float"],e:!1},{type:"node_param",name:"lV",qualifier:["varying","vec2"]}],f:[{type:"textline",b:"mN = lV [ 0 ] ; mO = lV [ 1 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_out",name:"mP",qualifier:["float"],e:!1},{type:"node_out",name:"mQ",qualifier:["float"],e:!1},{type:"node_out",name:"mR",qualifier:["float"],e:!1},{type:"node_param",name:"lW",qualifier:["varying","vec3"]}],f:[{type:"textline",b:"mP = lW [ 0 ] ; mQ = lW [ 1 ] ; mR = lW [ 2 ] ;".split(" ")}]},{type:"node",
name:"GEOMETRY_NO",k:[{type:"node_out",name:"mS",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mS","=","mi",";"]}]},{type:"node",name:"GEOMETRY_FB",k:[{type:"node_out",name:"mT",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mT = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",k:[{type:"node_out",name:"mU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["mU","=","mn",";"]}]},{type:"node",name:"GEOMETRY_GL",k:[{type:"node_out",name:"mV",
qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"mV = vec3 ( mo . r , - mo . b , mo . g ) ;".split(" ")}]},{type:"node",name:"HUE_SAT",k:[{type:"node_in",name:"mW",qualifier:["float"],e:!1},{type:"node_in",name:"mX",qualifier:["float"],e:!1},{type:"node_in",name:"mY",qualifier:["float"],e:!1},{type:"node_in",name:"mZ",qualifier:["float"],e:!1},{type:"node_in",name:"m_",qualifier:["vec3"],e:!1},{type:"node_out",name:"na",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ vec3 nb = lJ ( m_ ) ; nb [ 0 ] += ( mW - 0.5 ) ; if ( nb [ 0 ] > UNITY_VALUE_NODES ) nb [ 0 ] -= UNITY_VALUE_NODES ; else if ( nb [ 0 ] < ZERO_VALUE_NODES ) nb [ 0 ] += UNITY_VALUE_NODES ; nb *= vec3 ( UNITY_VALUE_NODES , mX , mY ) ; nb = mix ( lv , mix ( lu , nb , step ( lu , nb ) ) , step ( nb , lv ) ) ; na = mix ( m_ , lN ( nb ) , mZ ) ; }".split(" ")}]},
{type:"node",name:"INVERT",k:[{type:"node_in",name:"nc",qualifier:["float"],e:!1},{type:"node_in",name:"nd",qualifier:["vec3"],e:!1},{type:"node_out",name:"ne",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ne = mix ( nd , lv - nd , nc ) ;".split(" ")}]},{type:"node",name:"LAMP",k:[{type:"node_out",name:"nf",qualifier:["vec3"],e:!1},{type:"node_out",name:"ng",qualifier:["vec3"],e:!1},{type:"node_out",name:"nh",qualifier:["float"],e:!1},{type:"node_out",name:"ni",qualifier:["float"],e:!1},{type:"node_param",
name:"lX",qualifier:["const","float"]}],f:[{type:"textline",b:"{ const int nj = int ( lX ) ; nf = u_lamp_light_color_intensities [ nj ] ; vec4 nk = u_lamp_light_factors [ nj ] ; vec3 nl = u_lamp_light_directions [ nj ] ; vec3 nm = u_lamp_light_positions [ nj ] ; float nn = nk . z ; if ( nn != - UNITY_VALUE_NODES ) { ng = nm - kF ; nh = length ( ng ) ; ng = normalize ( ng ) ; ni = nn / ( nn + nh * nh ) ; float no = nk . x ; float np = nk . y ; if ( no > - UNITY_VALUE_NODES ) { float nq = dot ( ng , nl ) ; nq *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( nq - no ) / np ) ; ni *= nq ; } } else { ng = nl ; nh = length ( nm - kF ) ; ni = UNITY_VALUE_NODES ; } }".split(" ")}]},
{type:"node",name:"NORMAL",k:[{type:"node_in",name:"nr",qualifier:["vec3"],e:!1},{type:"node_out",name:"ns",qualifier:["vec3"],e:!0},{type:"node_out",name:"nt",qualifier:["float"],e:!0},{type:"node_param",name:"lY",qualifier:["vec3"]}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_ns"],f:[{type:"textline",b:["ns","=","lY",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_nt"],f:[{type:"textline",b:"nt = - dot ( nr , lY ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_VECTOR_VIEW",
k:[{type:"node_in",name:"nu",qualifier:["vec3"],e:!1},{type:"node_out",name:"nv",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"nv = - ( u_view_matrix_frag * vec4 ( nu , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"MAPPING",k:[{type:"node_in",name:"nw",qualifier:["vec3"],e:!1},{type:"node_out",name:"nx",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:["nx","=","nw",";"]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",f:[{type:"textline",b:"nx = ( MAPPING_TRS_MATRIX * vec4 ( nx , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},
{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_SCALE",f:[{type:"textline",b:"nx = nx * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",f:[{type:"textline",b:"nx = nx + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",f:[{type:"textline",b:"nx = max ( nx , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",f:[{type:"textline",
b:"nx = min ( nx , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["MAPPING_IS_NORMAL"],f:[{type:"textline",b:"nx = normalize ( nx ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",k:[{type:"node_in",name:"ny",qualifier:["float"],e:!1},{type:"node_in",name:"nz",qualifier:["float"],e:!1},{type:"node_out",name:"nA",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nA = ny + nz ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",
b:"nA = clamp ( nA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",k:[{type:"node_in",name:"nB",qualifier:["float"],e:!1},{type:"node_in",name:"nC",qualifier:["float"],e:!1},{type:"node_out",name:"nD",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nD = nB - nC ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nD = clamp ( nD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_MULTIPLY",k:[{type:"node_in",name:"nE",qualifier:["float"],e:!1},{type:"node_in",name:"nF",qualifier:["float"],e:!1},{type:"node_out",name:"nG",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nG = nE * nF ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nG = clamp ( nG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_DIVIDE",k:[{type:"node_in",name:"nH",qualifier:["float"],e:!1},{type:"node_in",name:"nI",
qualifier:["float"],e:!1},{type:"node_out",name:"nJ",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nJ = ( nI != ZERO_VALUE_NODES ) ? nH / nI : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nJ = clamp ( nJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SINE",k:[{type:"node_in",name:"nK",qualifier:["float"],e:!1},{type:"node_in",name:"nL",qualifier:["float"],e:!1},{type:"node_out",name:"nM",
qualifier:["float"],e:!1}],f:[{type:"textline",b:"nM = sin ( nK ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nM = clamp ( nM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nL",";"]}]},{type:"node",name:"MATH_COSINE",k:[{type:"node_in",name:"nN",qualifier:["float"],e:!1},{type:"node_in",name:"nO",qualifier:["float"],e:!1},{type:"node_out",name:"nP",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nP = cos ( nN ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nP = clamp ( nP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nO",";"]}]},{type:"node",name:"MATH_TANGENT",k:[{type:"node_in",name:"nQ",qualifier:["float"],e:!1},{type:"node_in",name:"nR",qualifier:["float"],e:!1},{type:"node_out",name:"nS",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nS = tan ( nQ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],
f:[{type:"textline",b:"nS = clamp ( nS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nR",";"]}]},{type:"node",name:"MATH_ARCSINE",k:[{type:"node_in",name:"nT",qualifier:["float"],e:!1},{type:"node_in",name:"nU",qualifier:["float"],e:!1},{type:"node_out",name:"nV",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nV = ( nT <= UNITY_VALUE_NODES && nT >= - UNITY_VALUE_NODES ) ? asin ( nT ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nV = clamp ( nV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nU",";"]}]},{type:"node",name:"MATH_ARCCOSINE",k:[{type:"node_in",name:"nW",qualifier:["float"],e:!1},{type:"node_in",name:"nX",qualifier:["float"],e:!1},{type:"node_out",name:"nY",qualifier:["float"],e:!1}],f:[{type:"textline",b:"nY = ( nW <= UNITY_VALUE_NODES && nW >= - UNITY_VALUE_NODES ) ? acos ( nW ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",
a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"nY = clamp ( nY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["nX",";"]}]},{type:"node",name:"MATH_ARCTANGENT",k:[{type:"node_in",name:"nZ",qualifier:["float"],e:!1},{type:"node_in",name:"n_",qualifier:["float"],e:!1},{type:"node_out",name:"oa",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oa = atan ( nZ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",
b:"oa = clamp ( oa , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["n_",";"]}]},{type:"node",name:"MATH_POWER",k:[{type:"node_in",name:"ob",qualifier:["float"],e:!1},{type:"node_in",name:"oc",qualifier:["float"],e:!1},{type:"node_out",name:"od",qualifier:["float"],e:!1}],f:[{type:"textline",b:"if ( ob < ZERO_VALUE_NODES || ob == ZERO_VALUE_NODES && oc == ZERO_VALUE_NODES ) od = ZERO_VALUE_NODES ; else od = pow ( ob , oc ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"od = clamp ( od , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",k:[{type:"node_in",name:"oe",qualifier:["float"],e:!1},{type:"node_in",name:"of",qualifier:["float"],e:!1},{type:"node_out",name:"og",qualifier:["float"],e:!1}],f:[{type:"textline",b:"og = ( oe > ZERO_VALUE_NODES && of > ZERO_VALUE_NODES ) ? log2 ( oe ) / log2 ( of ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"og = clamp ( og , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",k:[{type:"node_in",name:"oh",qualifier:["float"],e:!1},{type:"node_in",name:"oi",qualifier:["float"],e:!1},{type:"node_out",name:"oj",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oj = min ( oh , oi ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oj = clamp ( oj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MAXIMUM",k:[{type:"node_in",name:"ok",qualifier:["float"],e:!1},{type:"node_in",name:"ol",qualifier:["float"],e:!1},{type:"node_out",name:"om",qualifier:["float"],e:!1}],f:[{type:"textline",b:"om = max ( ok , ol ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"om = clamp ( om , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",k:[{type:"node_in",name:"on",qualifier:["float"],e:!1},
{type:"node_in",name:"oo",qualifier:["float"],e:!1},{type:"node_out",name:"op",qualifier:["float"],e:!1}],f:[{type:"textline",b:"op = floor ( on + 0.5 ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"op = clamp ( op , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["oo",";"]}]},{type:"node",name:"MATH_LESS_THAN",k:[{type:"node_in",name:"oq",qualifier:["float"],e:!1},{type:"node_in",name:"or",qualifier:["float"],e:!1},
{type:"node_out",name:"os",qualifier:["float"],e:!1}],f:[{type:"textline",b:"os = ( oq < or ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"os = clamp ( os , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",k:[{type:"node_in",name:"ot",qualifier:["float"],e:!1},{type:"node_in",name:"ou",qualifier:["float"],e:!1},{type:"node_out",name:"ov",qualifier:["float"],
e:!1}],f:[{type:"textline",b:"ov = ( ot > ou ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"ov = clamp ( ov , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",k:[{type:"node_in",name:"ow",qualifier:["float"],e:!1},{type:"node_in",name:"ox",qualifier:["float"],e:!1},{type:"node_out",name:"oy",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oy = abs ( ox ) > 0.000001 ? mod ( ow , ox ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oy = clamp ( oy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ABSOLUTE",k:[{type:"node_in",name:"oz",qualifier:["float"],e:!1},{type:"node_in",name:"oA",qualifier:["float"],e:!1},{type:"node_out",name:"oB",qualifier:["float"],e:!1}],f:[{type:"textline",b:"oB = abs ( oz ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MATH_USE_CLAMP"],f:[{type:"textline",b:"oB = clamp ( oB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["oA",";"]}]},{type:"node",name:"MIX_RGB_MIX",k:[{type:"node_in",name:"oC",qualifier:["float"],e:!1},{type:"node_in",name:"oD",qualifier:["vec3"],e:!1},{type:"node_in",name:"oE",qualifier:["vec3"],e:!1},{type:"node_out",name:"oF",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oG = clamp ( oC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oF = mix ( oD , oE , oG ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oF = clamp ( oF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_ADD",k:[{type:"node_in",name:"oH",qualifier:["float"],e:!1},{type:"node_in",name:"oI",qualifier:["vec3"],e:!1},{type:"node_in",name:"oJ",qualifier:["vec3"],e:!1},{type:"node_out",name:"oK",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oL = clamp ( oH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oK = mix ( oI , oI + oJ , oL ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oK = clamp ( oK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_MULTIPLY",k:[{type:"node_in",name:"oM",qualifier:["float"],e:!1},{type:"node_in",name:"oN",qualifier:["vec3"],e:!1},{type:"node_in",name:"oO",qualifier:["vec3"],e:!1},{type:"node_out",name:"oP",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oQ = clamp ( oM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oP = mix ( oN , oN * oO , oQ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oP = clamp ( oP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SUBTRACT",k:[{type:"node_in",name:"oR",qualifier:["float"],e:!1},{type:"node_in",name:"oS",qualifier:["vec3"],e:!1},{type:"node_in",name:"oT",qualifier:["vec3"],e:!1},{type:"node_out",name:"oU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float oV = clamp ( oR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oU = mix ( oS , oS - oT , oV ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oU = clamp ( oU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SCREEN",k:[{type:"node_in",name:"oW",qualifier:["float"],e:!1},{type:"node_in",name:"oX",qualifier:["vec3"],e:!1},{type:"node_in",name:"oY",qualifier:["vec3"],e:!1},{type:"node_out",name:"oZ",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float o_ = clamp ( oW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pa = UNITY_VALUE_NODES - o_ ; oZ = lv - ( vec3 ( pa ) + o_ * ( lv - oY ) ) * ( lv - oX ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"oZ = clamp ( oZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DIVIDE",k:[{type:"node_in",name:"pb",qualifier:["float"],e:!1},{type:"node_in",name:"pc",qualifier:["vec3"],e:!1},{type:"node_in",name:"pd",qualifier:["vec3"],e:!1},{type:"node_out",name:"pe",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pf = clamp ( pb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pg = UNITY_VALUE_NODES - pf ; pd += step ( pd , lu ) ; pe = pg * pc + pf * pc / pd ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pe = clamp ( pe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",k:[{type:"node_in",name:"ph",qualifier:["float"],e:!1},{type:"node_in",name:"pi",qualifier:["vec3"],e:!1},{type:"node_in",name:"pj",qualifier:["vec3"],e:!1},{type:"node_out",name:"pk",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pl = clamp ( ph , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pk = mix ( pi , abs ( pi - pj ) , pl ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pk = clamp ( pk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DARKEN",k:[{type:"node_in",name:"pm",qualifier:["float"],e:!1},{type:"node_in",name:"pn",qualifier:["vec3"],e:!1},{type:"node_in",name:"po",qualifier:["vec3"],e:!1},{type:"node_out",name:"pp",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pq = clamp ( pm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pp = min ( pn . rgb , po . rgb * pq ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pp = clamp ( pp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_LIGHTEN",k:[{type:"node_in",name:"pr",qualifier:["float"],e:!1},{type:"node_in",name:"ps",qualifier:["vec3"],e:!1},{type:"node_in",name:"pt",qualifier:["vec3"],e:!1},{type:"node_out",name:"pu",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pv = clamp ( pr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pu = max ( ps . rgb , pt . rgb * pv ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pu = clamp ( pu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_OVERLAY",k:[{type:"node_in",name:"pw",qualifier:["float"],e:!1},{type:"node_in",name:"px",qualifier:["vec3"],e:!1},{type:"node_in",name:"py",qualifier:["vec3"],e:!1},{type:"node_out",name:"pz",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pA = clamp ( pw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pB = UNITY_VALUE_NODES - pA ; vec3 pC = vec3 ( pB ) ; pz = mix ( px * ( pC + 2.0 * pA * py ) , lv - ( pC + 2.0 * pA * ( lv - py ) ) * ( lv - px ) , step ( 0.5 , px ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pz = clamp ( pz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_DODGE",k:[{type:"node_in",name:"pD",qualifier:["float"],e:!1},{type:"node_in",name:"pE",qualifier:["vec3"],e:!1},{type:"node_in",name:"pF",qualifier:["vec3"],e:!1},{type:"node_out",name:"pG",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pH = clamp ( pD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pI = lv - pH * pF ; vec3 pJ = pE / ( pI + step ( pI , lu ) ) ; pG = ( lv - step ( pE , lu ) ) * mix ( mix ( lv , pJ , step ( pJ , lv ) ) , lv , step ( pI , lu ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pG = clamp ( pG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_BURN",k:[{type:"node_in",name:"pK",qualifier:["float"],e:!1},{type:"node_in",name:"pL",qualifier:["vec3"],e:!1},{type:"node_in",name:"pM",qualifier:["vec3"],e:!1},{type:"node_out",name:"pN",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pO = clamp ( pK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pP = lv - pO * ( lv - pM ) ; vec3 pQ = lv - ( lv - pL ) / ( pP + step ( pP , lu ) ) ; pN = mix ( mix ( lu , mix ( lv , pQ , step ( pQ , lv ) ) , step ( ZERO_VALUE_NODES , pQ ) ) , lu , step ( pP , lu ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pN = clamp ( pN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_HUE",k:[{type:"node_in",name:"pR",qualifier:["float"],e:!1},{type:"node_in",name:"pS",qualifier:["vec3"],e:!1},{type:"node_in",name:"pT",qualifier:["vec3"],e:!1},{type:"node_out",name:"pU",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float pV = clamp ( pR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pW , pX , pY ; pU = pS ; pX = lJ ( pT ) ; if ( pX . y != ZERO_VALUE_NODES ) { pW = lJ ( pU ) ; pW . x = pX . x ; pY = lN ( pW ) ; pU = mix ( pU , pY , pV ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"pU = clamp ( pU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SATURATION",k:[{type:"node_in",name:"pZ",qualifier:["float"],e:!1},{type:"node_in",name:"p_",qualifier:["vec3"],e:!1},{type:"node_in",name:"qa",qualifier:["vec3"],e:!1},{type:"node_out",name:"qb",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qc = clamp ( pZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qd = UNITY_VALUE_NODES - qc ; qb = p_ ; vec3 qe , qf ; qe = lJ ( qb ) ; if ( qe . y != ZERO_VALUE_NODES ) { qf = lJ ( qa ) ; qe . y = qd * qe . y + qc * qf . y ; qb = lN ( qe ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qb = clamp ( qb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_VALUE",k:[{type:"node_in",name:"qg",qualifier:["float"],e:!1},{type:"node_in",name:"qh",qualifier:["vec3"],e:!1},{type:"node_in",name:"qi",qualifier:["vec3"],e:!1},{type:"node_out",name:"qj",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qk = clamp ( qg , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float ql = UNITY_VALUE_NODES - qk ; vec3 qm , qn ; qm = lJ ( qh ) ; qn = lJ ( qi ) ; qm . z = ql * qm . z + qk * qn . z ; qj = lN ( qm ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qj = clamp ( qj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_COLOR",k:[{type:"node_in",name:"qo",qualifier:["float"],e:!1},{type:"node_in",name:"qp",qualifier:["vec3"],e:!1},{type:"node_in",name:"qq",qualifier:["vec3"],e:!1},{type:"node_out",name:"qr",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qs = clamp ( qo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qt , qu , qv ; qr = qp ; qu = lJ ( qq ) ; if ( qu . y != ZERO_VALUE_NODES ) { qt = lJ ( qr ) ; qt . x = qu . x ; qt . y = qu . y ; qv = lN ( qt ) ; qr = mix ( qr , qv , qs ) ; }".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qr = clamp ( qr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",k:[{type:"node_in",name:"qw",qualifier:["float"],e:!1},{type:"node_in",name:"qx",qualifier:["vec3"],e:!1},{type:"node_in",name:"qy",qualifier:["vec3"],e:!1},{type:"node_out",name:"qz",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qA = clamp ( qw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qB = UNITY_VALUE_NODES - qA ; vec3 qC = qy + qx - qy * qx ; qz = qx * ( vec3 ( qB ) + vec3 ( qA ) * ( ( lv - qx ) * qy + qC ) ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qz = clamp ( qz , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",k:[{type:"node_in",name:"qD",qualifier:["float"],e:!1},{type:"node_in",name:"qE",qualifier:["vec3"],e:!1},{type:"node_in",name:"qF",qualifier:["vec3"],e:!1},{type:"node_out",name:"qG",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"{ float qH = clamp ( qD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qG = clamp ( qE + qH * ( 2.0 * qF - lv ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["MIX_RGB_USE_CLAMP"],f:[{type:"textline",b:"qG = clamp ( qG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"OUTPUT",k:[{type:"node_in",name:"qI",qualifier:["vec3"],e:!1},{type:"node_in",name:"qJ",qualifier:["float"],e:!1}],f:[{type:"textline",b:"mt = qI ; my = qJ ;".split(" ")}]},{type:"node",name:"MATERIAL",k:[{type:"node_in",name:"qK",qualifier:["vec3"],e:!1},{type:"node_in",name:"qL",qualifier:["float"],
e:!1},{type:"node_in",name:"qM",qualifier:["vec3"],e:!1},{type:"node_in",name:"qN",qualifier:["vec3"],e:!0},{type:"node_out",name:"qO",qualifier:["vec3"],e:!0},{type:"node_out",name:"qP",qualifier:["float"],e:!0},{type:"node_out",name:"qQ",qualifier:["vec3"],e:!0},{type:"node_param",name:"lZ",qualifier:["const","vec2"]},{type:"node_param",name:"l_",qualifier:["const","vec3"]}],f:[{type:"textline",b:"{ vec3 qR = clamp ( qK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qS = l_ [ 0 ] * clamp ( qM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"vec3 qT = normalize ( qN ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["vec3","qT","=","mi",";"]}]}]},{type:"textline",b:["hw","qU",";"]},{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT"],f:[{type:"textline",b:"vec3 qV = mq * qR ; float qW = 0.5 * qT . y + 0.5 ; vec3 qX = ms * u_environment_energy * lC ( qW , qT ) ; float qY = fs ( qR ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"vec2 qZ = vec2 ( lZ [ 0 ] , lZ [ 1 ] ) ; vec2 q_ = vec2 ( l_ [ 1 ] , l_ [ 2 ] ) ; qU = jY ( qV , qX , qR , qS , mo , qT , mn , q_ , qZ , qY , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) , u_shadow_lamp_id ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:"qU = kc ( qV , qX , qR ) ;".split(" ")}]}]},{type:"textline",b:["mx","=","qY",";"]}]},
{type:"node_else",f:[{type:"textline",b:"qU . a = vec4 ( qR , ZERO_VALUE_NODES ) ; qU . b = lu ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qO"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"qO = qU . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["qO","=","lu",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"qO += qU . b ;".split(" ")}]}]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_qP"],f:[{type:"textline",b:"qP = clamp ( qL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"qP += qU . a . a * qS . r * mr ; qP = clamp ( qP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_qQ"],f:[{type:"textline",b:["qQ","=","qT",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],
f:[{type:"textline",b:"mu = qU . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["mu","=","lu",";"]}]}]},{type:"textline",b:["mv","=","qT",";","}"]}]},{type:"node",name:"MATERIAL_EXT",k:[{type:"node_in",name:"ra",qualifier:["vec3"],e:!1},{type:"node_in",name:"rb",qualifier:["float"],e:!1},{type:"node_in",name:"rc",qualifier:["vec3"],e:!1},{type:"node_in",name:"rd",qualifier:["vec3"],e:!0},{type:"node_in",name:"re",qualifier:["float"],e:!1},{type:"node_in",name:"rf",qualifier:["float"],
e:!1},{type:"node_in",name:"rg",qualifier:["vec4"],e:!1},{type:"node_in",name:"rh",qualifier:["float"],e:!1},{type:"node_in",name:"ri",qualifier:["float"],e:!1},{type:"node_out",name:"rj",qualifier:["vec3"],e:!0},{type:"node_out",name:"rk",qualifier:["float"],e:!0},{type:"node_out",name:"rl",qualifier:["vec3"],e:!0},{type:"node_out",name:"rm",qualifier:["vec3"],e:!0},{type:"node_out",name:"rn",qualifier:["vec3"],e:!0},{type:"node_param",name:"ma",qualifier:["const","vec2"]},{type:"node_param",name:"mb",
qualifier:["const","vec3"]}],f:[{type:"textline",b:"{ vec3 ro = clamp ( ra , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 rp = mb [ 0 ] * clamp ( rc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_NORMAL"],f:[{type:"textline",b:"vec3 rq = normalize ( rd ) ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["vec3","rq","=","mi",";"]}]}]},{type:"textline",b:["hw","rr",";"]},{type:"node_condition",a:[{type:"node_if",c:["!","SHADELESS_MAT"],
f:[{type:"textline",b:"float rs = fs ( ro ) ; vec3 rt = re * ro ; float ru = 0.5 * rq . y + 0.5 ; vec3 rv = ms * u_environment_energy * lC ( ru , rq ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["NUM_LIGHTS",">","0"],f:[{type:"textline",b:"vec2 rw = vec2 ( ma [ 0 ] , ma [ 1 ] ) ; vec2 rx = vec2 ( mb [ 1 ] , mb [ 2 ] ) ; rr = jY ( rt , rv , ro , rp , mo , rq , mn , rx , rw , rs , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , rf , rg , u_shadow_lamp_id ) ;".split(" ")}]},
{type:"node_else",f:[{type:"textline",b:"rr = kc ( rt , rv , ro ) ;".split(" ")}]}]},{type:"textline",b:["mx","=","rs",";"]}]},{type:"node_else",f:[{type:"textline",b:"rr . a = vec4 ( ro , ZERO_VALUE_NODES ) ; rr . b = lu ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rj"],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_DIFFUSE"],f:[{type:"textline",b:"rj = rr . a . rgb ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["rj","=","lu",";"]}]}]},{type:"node_condition",
a:[{type:"node_if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],f:[{type:"textline",b:"lf ( rj , mn , rq , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , rh ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"rj += rr . b ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rk"],f:[{type:"textline",b:"rk = clamp ( rb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_MATERIAL_SPECULAR"],
f:[{type:"textline",b:"rk += rr . a . a * rp . r * ri ; rk = clamp ( rk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rl"],f:[{type:"textline",b:["rl","=","rq",";"]}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rm"],f:[{type:"textline",b:"rm = rr . a . rgb ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rn"],f:[{type:"textline",b:"rn = rr . b ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",
c:["USE_MATERIAL_SPECULAR"],f:[{type:"textline",b:"mu = rr . b ;".split(" ")}]},{type:"node_else",f:[{type:"textline",b:["mu","=","lu",";"]}]}]},{type:"textline",b:["mv","=","rq",";","}"]}]},{type:"node",name:"RGB",k:[{type:"node_out",name:"ry",qualifier:["vec3"],e:!1},{type:"node_param",name:"mc",qualifier:["vec3"]}],f:[{type:"textline",b:["ry","=","mc",";"]}]},{type:"node",name:"RGBTOBW",k:[{type:"node_in",name:"rz",qualifier:["vec3"],e:!1},{type:"node_out",name:"rA",qualifier:["float"],e:!1}],
f:[{type:"textline",b:"rA = rz . r * 0.35 + rz . g * 0.45 + rz . b * 0.2 ;".split(" ")}]},{type:"node",name:"SEPRGB",k:[{type:"node_in",name:"rB",qualifier:["vec3"],e:!1},{type:"node_out",name:"rC",qualifier:["float"],e:!0},{type:"node_out",name:"rD",qualifier:["float"],e:!0},{type:"node_out",name:"rE",qualifier:["float"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rC"],f:[{type:"textline",b:"rC = rB . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rD"],
f:[{type:"textline",b:"rD = rB . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rE"],f:[{type:"textline",b:"rE = rB . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",k:[{type:"node_in",name:"rF",qualifier:["vec3"],e:!1},{type:"node_out",name:"rG",qualifier:["float"],e:!0},{type:"node_out",name:"rH",qualifier:["float"],e:!0},{type:"node_out",name:"rI",qualifier:["float"],e:!0}],f:[{type:"textline",b:"{ vec3 rJ = lJ ( rF ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",
c:["USE_OUT_rG"],f:[{type:"textline",b:"rG = rJ . r ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rH"],f:[{type:"textline",b:"rH = rJ . g ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_rI"],f:[{type:"textline",b:"rI = rJ . b ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"SQUEEZE",k:[{type:"node_in",name:"rK",qualifier:["float"],e:!1},{type:"node_in",name:"rL",qualifier:["float"],e:!1},{type:"node_in",name:"rM",qualifier:["float"],
e:!1},{type:"node_out",name:"rN",qualifier:["float"],e:!1}],f:[{type:"textline",b:"rN = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( rK - rM ) * rL ) ) ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",k:[{type:"node_in",name:"rO",qualifier:["vec3"],e:!1},{type:"node_out",name:"rP",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rP = max ( lu , rO ) ; rP = pow ( rP , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",k:[{type:"node_in",name:"rQ",
qualifier:["vec3"],e:!1},{type:"node_out",name:"rR",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"rR = max ( lu , rQ ) ; rR = pow ( rR , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},{type:"node",name:"TEXTURE_COLOR",k:[{type:"node_in",name:"rS",qualifier:["vec3"],e:!1},{type:"node_out",name:"rT",qualifier:["vec3"],e:!1},{type:"node_out",name:"rU",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 rV = texture2D ( node_TEXTURE_COLOR_var_texture , lR ( rS ) ) ; rT = rV . xyz ; gy ( rT ) ; rU = rV . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_NORMAL",k:[{type:"node_in",name:"rW",qualifier:["vec3"],e:!1},{type:"node_out",name:"rX",qualifier:["vec3"],e:!1},{type:"node_out",name:"rY",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 rZ = texture2D ( node_TEXTURE_NORMAL_var_texture , lR ( rW ) ) ; mw = rZ . xyz - 0.5 ; rX = normalize ( ml * mw ) ; rY = rZ . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_ENVIRONMENT",
k:[{type:"node_in",name:"r_",qualifier:["vec3"],e:!1},{type:"node_out",name:"sa",qualifier:["vec3"],e:!0},{type:"node_out",name:"sb",qualifier:["float"],e:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]}],f:[{type:"textline",b:"{ vec4 sc = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , r_ ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_sa"],f:[{type:"textline",b:"sa = sc . xyz ; gy ( sa ) ;".split(" ")}]}]},{type:"node_condition",
a:[{type:"node_if",c:["USE_OUT_sb"],f:[{type:"textline",b:"sb = sc . w ;".split(" ")}]}]},{type:"textline",b:["}"]}]},{type:"node",name:"TEXTURE_COLOR2",k:[{type:"node_in",name:"sd",qualifier:["vec3"],e:!1},{type:"node_in",name:"se",qualifier:["vec3"],e:!1},{type:"node_out",name:"sf",qualifier:["vec3"],e:!1},{type:"node_out",name:"sg",qualifier:["float"],e:!1},{type:"node_out",name:"sh",qualifier:["vec3"],e:!1},{type:"node_out",name:"si",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_COLOR2_var_texture",
qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sj = texture2D ( node_TEXTURE_COLOR2_var_texture , lR ( sd ) ) ; sf = sj . xyz ; gy ( sf ) ; sg = sj . w ; sj = texture2D ( node_TEXTURE_COLOR2_var_texture , lR ( se ) ) ; sh = sj . xyz ; gy ( sh ) ; si = sj . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_NORMAL2",k:[{type:"node_in",name:"sk",qualifier:["vec3"],e:!1},{type:"node_in",name:"sl",qualifier:["vec3"],e:!1},{type:"node_out",name:"sm",qualifier:["vec3"],e:!1},{type:"node_out",
name:"sn",qualifier:["float"],e:!1},{type:"node_out",name:"so",qualifier:["vec3"],e:!1},{type:"node_out",name:"sp",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL2_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sq = texture2D ( node_TEXTURE_NORMAL2_var_texture , lR ( sk ) ) ; mw = sq . xyz - 0.5 ; sm = normalize ( ml * mw ) ; sn = sq . w ; sq = texture2D ( node_TEXTURE_NORMAL2_var_texture , lR ( sl ) ) ; mw = sq . xyz - 0.5 ; so = normalize ( ml * mw ) ; sp = sq . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_COLOR3",k:[{type:"node_in",name:"sr",qualifier:["vec3"],e:!1},{type:"node_in",name:"ss",qualifier:["vec3"],e:!1},{type:"node_in",name:"st",qualifier:["vec3"],e:!1},{type:"node_out",name:"su",qualifier:["vec3"],e:!1},{type:"node_out",name:"sv",qualifier:["float"],e:!1},{type:"node_out",name:"sw",qualifier:["vec3"],e:!1},{type:"node_out",name:"sx",qualifier:["float"],e:!1},{type:"node_out",name:"sy",qualifier:["vec3"],e:!1},{type:"node_out",name:"sz",qualifier:["float"],e:!1},
{type:"node_param",name:"node_TEXTURE_COLOR3_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sA = texture2D ( node_TEXTURE_COLOR3_var_texture , lR ( sr ) ) ; su = sA . xyz ; gy ( su ) ; sv = sA . w ; sA = texture2D ( node_TEXTURE_COLOR3_var_texture , lR ( ss ) ) ; sw = sA . xyz ; gy ( sw ) ; sx = sA . w ; sA = texture2D ( node_TEXTURE_COLOR3_var_texture , lR ( st ) ) ; sy = sA . xyz ; gy ( sy ) ; sz = sA . w ; }".split(" ")}]},{type:"node",name:"TEXTURE_COLOR4",k:[{type:"node_in",
name:"sB",qualifier:["vec3"],e:!1},{type:"node_in",name:"sC",qualifier:["vec3"],e:!1},{type:"node_in",name:"sD",qualifier:["vec3"],e:!1},{type:"node_in",name:"sE",qualifier:["vec3"],e:!1},{type:"node_out",name:"sF",qualifier:["vec3"],e:!1},{type:"node_out",name:"sG",qualifier:["float"],e:!1},{type:"node_out",name:"sH",qualifier:["vec3"],e:!1},{type:"node_out",name:"sI",qualifier:["float"],e:!1},{type:"node_out",name:"sJ",qualifier:["vec3"],e:!1},{type:"node_out",name:"sK",qualifier:["float"],e:!1},
{type:"node_out",name:"sL",qualifier:["vec3"],e:!1},{type:"node_out",name:"sM",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_COLOR4_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sN = texture2D ( node_TEXTURE_COLOR4_var_texture , lR ( sB ) ) ; sF = sN . xyz ; gy ( sF ) ; sG = sN . w ; sN = texture2D ( node_TEXTURE_COLOR4_var_texture , lR ( sC ) ) ; sH = sN . xyz ; gy ( sH ) ; sI = sN . w ; sN = texture2D ( node_TEXTURE_COLOR4_var_texture , lR ( sD ) ) ; sJ = sN . xyz ; gy ( sJ ) ; sK = sN . w ; sN = texture2D ( node_TEXTURE_COLOR4_var_texture , lR ( sE ) ) ; sL = sN . xyz ; gy ( sL ) ; sM = sN . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_NORMAL3",k:[{type:"node_in",name:"sO",qualifier:["vec3"],e:!1},{type:"node_in",name:"sP",qualifier:["vec3"],e:!1},{type:"node_in",name:"sQ",qualifier:["vec3"],e:!1},{type:"node_out",name:"sR",qualifier:["vec3"],e:!1},{type:"node_out",name:"sS",qualifier:["float"],e:!1},{type:"node_out",name:"sT",qualifier:["vec3"],e:!1},{type:"node_out",name:"sU",qualifier:["float"],e:!1},{type:"node_out",name:"sV",qualifier:["vec3"],e:!1},{type:"node_out",name:"sW",qualifier:["float"],
e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL3_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 sX = texture2D ( node_TEXTURE_NORMAL3_var_texture , lR ( sO ) ) ; mw = sX . xyz - 0.5 ; sR = normalize ( ml * mw ) ; sS = sX . w ; sX = texture2D ( node_TEXTURE_NORMAL3_var_texture , lR ( sP ) ) ; mw = sX . xyz - 0.5 ; sT = normalize ( ml * mw ) ; sU = sX . w ; sX = texture2D ( node_TEXTURE_NORMAL3_var_texture , lR ( sQ ) ) ; mw = sX . xyz - 0.5 ; sV = normalize ( ml * mw ) ; sW = sX . w ; }".split(" ")}]},
{type:"node",name:"TEXTURE_NORMAL4",k:[{type:"node_in",name:"sY",qualifier:["vec3"],e:!1},{type:"node_in",name:"sZ",qualifier:["vec3"],e:!1},{type:"node_in",name:"s_",qualifier:["vec3"],e:!1},{type:"node_in",name:"ta",qualifier:["vec3"],e:!1},{type:"node_out",name:"tb",qualifier:["vec3"],e:!1},{type:"node_out",name:"tc",qualifier:["float"],e:!1},{type:"node_out",name:"td",qualifier:["vec3"],e:!1},{type:"node_out",name:"te",qualifier:["float"],e:!1},{type:"node_out",name:"tf",qualifier:["vec3"],e:!1},
{type:"node_out",name:"tg",qualifier:["float"],e:!1},{type:"node_out",name:"th",qualifier:["vec3"],e:!1},{type:"node_out",name:"ti",qualifier:["float"],e:!1},{type:"node_param",name:"node_TEXTURE_NORMAL4_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ vec4 tj = texture2D ( node_TEXTURE_NORMAL4_var_texture , lR ( sY ) ) ; mw = tj . xyz - 0.5 ; tb = normalize ( ml * mw ) ; tc = tj . w ; tj = texture2D ( node_TEXTURE_NORMAL4_var_texture , lR ( sZ ) ) ; mw = tj . xyz - 0.5 ; td = normalize ( ml * mw ) ; te = tj . w ; tj = texture2D ( node_TEXTURE_NORMAL4_var_texture , lR ( s_ ) ) ; mw = tj . xyz - 0.5 ; tf = normalize ( ml * mw ) ; tg = tj . w ; tj = texture2D ( node_TEXTURE_NORMAL4_var_texture , lR ( ta ) ) ; mw = tj . xyz - 0.5 ; th = normalize ( ml * mw ) ; ti = tj . w ; }".split(" ")}]},
{type:"node",name:"VALUE",k:[{type:"node_out",name:"tk",qualifier:["float"],e:!1},{type:"node_param",name:"md",qualifier:["const","float"]}],f:[{type:"textline",b:["tk","=","md",";"]}]},{type:"node",name:"ANIM_VALUE",k:[{type:"node_out",name:"tl",qualifier:["float"],e:!1},{type:"node_param",name:"me",qualifier:["const","int"]}],f:[{type:"textline",b:"tl = u_anim_values [ me ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",k:[{type:"node_in",name:"tm",qualifier:["vec3"],e:!1},{type:"node_in",name:"tn",
qualifier:["vec3"],e:!1},{type:"node_out",name:"to",qualifier:["vec3"],e:!1},{type:"node_out",name:"tp",qualifier:["float"],e:!0}],f:[{type:"textline",b:"to = tm + tn ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tp"],f:[{type:"textline",b:"tp = ( abs ( to [ 0 ] ) + abs ( to [ 1 ] ) + abs ( to [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_SUBTRACT",k:[{type:"node_in",name:"tq",qualifier:["vec3"],e:!1},{type:"node_in",name:"tr",qualifier:["vec3"],e:!1},{type:"node_out",
name:"ts",qualifier:["vec3"],e:!1},{type:"node_out",name:"tt",qualifier:["float"],e:!0}],f:[{type:"textline",b:"ts = tq - tr ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tt"],f:[{type:"textline",b:"tt = ( abs ( ts [ 0 ] ) + abs ( ts [ 1 ] ) + abs ( ts [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_AVERAGE",k:[{type:"node_in",name:"tu",qualifier:["vec3"],e:!1},{type:"node_in",name:"tv",qualifier:["vec3"],e:!1},{type:"node_out",name:"tw",qualifier:["vec3"],
e:!1},{type:"node_out",name:"tx",qualifier:["float"],e:!0}],f:[{type:"textline",b:"tw = tu + tv ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tx"],f:[{type:"textline",b:"tx = length ( tw ) ;".split(" ")}]}]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tw"],f:[{type:"textline",b:"tw = normalize ( tw ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",k:[{type:"node_in",name:"ty",qualifier:["vec3"],e:!1},{type:"node_in",name:"tz",qualifier:["vec3"],e:!1},
{type:"node_out",name:"tA",qualifier:["vec3"],e:!1},{type:"node_out",name:"tB",qualifier:["float"],e:!0}],f:[{type:"textline",b:["tA","=","lu",";"]},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tB"],f:[{type:"textline",b:"tB = dot ( ty , tz ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",k:[{type:"node_in",name:"tC",qualifier:["vec3"],e:!1},{type:"node_in",name:"tD",qualifier:["vec3"],e:!1},{type:"node_out",name:"tE",qualifier:["vec3"],e:!1},{type:"node_out",name:"tF",
qualifier:["float"],e:!0}],f:[{type:"textline",b:"tE = cross ( tC , tD ) ;".split(" ")},{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tF"],f:[{type:"textline",b:"tF = length ( tE ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",k:[{type:"node_in",name:"tG",qualifier:["vec3"],e:!1},{type:"node_in",name:"tH",qualifier:["vec3"],e:!1},{type:"node_out",name:"tI",qualifier:["vec3"],e:!1},{type:"node_out",name:"tJ",qualifier:["float"],e:!0}],f:[{type:"textline",b:"tI = normalize ( tG ) ;".split(" ")},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_tJ"],f:[{type:"textline",b:"tJ = length ( tG ) ;".split(" ")}]}]},{type:"textline",b:["tH",";"]}]},{type:"node",name:"B4W_REFLECT",k:[{type:"node_in",name:"tK",qualifier:["vec3"],e:!1},{type:"node_in",name:"tL",qualifier:["vec3"],e:!1},{type:"node_out",name:"tM",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"tM = reflect ( - tK , tL ) ;".split(" ")}]},{type:"node",name:"B4W_PARALLAX",k:[{type:"node_in",name:"tN",qualifier:["vec3"],e:!1},{type:"node_in",
name:"tO",qualifier:["float"],e:!1},{type:"node_in",name:"tP",qualifier:["const","float"],e:!1},{type:"node_in",name:"tQ",qualifier:["const","float"],e:!1},{type:"node_out",name:"tR",qualifier:["vec3"],e:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],f:[{type:"textline",b:"{ float tS = length ( mp ) ; if ( tS < tQ ) { vec2 tT = lR ( tN ) ; float tU = clamp ( 0.5 * ( tQ - tS ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float tV = tO * tU ; vec3 tW = normalize ( mn * ml ) ; float tX = UNITY_VALUE_NODES / tP ; vec2 tY = tW . xy * tV / ( tP * tW . z ) ; float tZ = UNITY_VALUE_NODES ; float t_ = texture2D ( node_B4W_PARALLAX_var_texture , tT ) . a ; for ( float ua = 1.0 ; ua <= tP ; ua ++ ) { if ( t_ < tZ ) { tZ -= tX ; tT -= tY ; t_ = texture2D ( node_B4W_PARALLAX_var_texture , tT ) . a ; } } vec2 ub = tT + tY ; float uc = texture2D ( node_B4W_PARALLAX_var_texture , ub ) . a - ( tZ + tX ) ; float ud = t_ - tZ ; float ue = ud / ( ud - uc ) ; tT = ue * ub + ( UNITY_VALUE_NODES - ue ) * tT ; tR = lP ( tT ) ; } else tR = tN ; }".split(" ")}]},
{type:"node",name:"B4W_CLAMP",k:[{type:"node_in",name:"uf",qualifier:["vec3"],e:!1},{type:"node_out",name:"ug",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"ug = clamp ( uf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",k:[{type:"node_in",name:"uh",qualifier:["vec3"],e:!1},{type:"node_in",name:"ui",qualifier:["float"],e:!1},{type:"node_out",name:"uj",qualifier:["vec3"],e:!1}],f:[{type:"textline",b:"uj = lz ( uh , ui ) ;".split(" ")}]},{type:"node",
name:"B4W_TRANSLUCENCY",k:[{type:"node_in",name:"uk",qualifier:["float"],e:!1},{type:"node_in",name:"ul",qualifier:["float"],e:!1},{type:"node_in",name:"um",qualifier:["float"],e:!1},{type:"node_in",name:"un",qualifier:["float"],e:!1},{type:"node_in",name:"uo",qualifier:["float"],e:!1},{type:"node_out",name:"up",qualifier:["float"],e:!0},{type:"node_out",name:"uq",qualifier:["vec4"],e:!0}],f:[{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_up"],f:[{type:"textline",b:["up","=","uk",";"]}]}]},
{type:"node_condition",a:[{type:"node_if",c:["USE_OUT_uq"],f:[{type:"textline",b:"uq = vec4 ( ul , um , un , uo ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",k:[{type:"node_out",name:"ur",qualifier:["float"],e:!1}],f:[{type:"textline",b:["ur","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",k:[{type:"node_in",name:"us",qualifier:["float"],e:!1},{type:"node_in",name:"ut",qualifier:["float"],e:!1},{type:"node_in",name:"uu",qualifier:["float"],e:!1},{type:"node_out",name:"uv",qualifier:["float"],
e:!1}],f:[{type:"textline",b:"uv = smoothstep ( ut , uu , us ) ;".split(" ")}]},{type:"nodes_global"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mf","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float mg = kF . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mh","=","kG",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) mh = mh ; else mh = - mh ;".split(" ")}]}}]},{type:"textline",b:"vec3 mi = normalize ( mh ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",
a:[{type:"textline",b:"vec3 mj = cross ( mh , kH . xyz ) * kH . w ; mat3 mk = mat3 ( kH . xyz , mj , mh ) ; mat3 ml = mk ;".split(" ")}]}}]},{type:"textline",b:"vec3 mm = u_camera_eye_frag - kF ; vec3 mn = normalize ( mm ) ; vec3 mo = kF ; vec4 mp = cL ; float mq = u_emit ; float mr = u_specular_alpha ; float ms = u_ambient ; vec3 mt ; vec3 mu ; vec3 mv ; vec3 mw ; float mx ; float my ;".split(" ")},{type:"nodes_main"},{type:"textline",b:"vec3 uw = mt ; float ux = my ;".split(" ")},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"uw = max ( uw - sqrt ( 0.01 * - min ( mg , ZERO_VALUE_NODES ) ) , 0.5 * uw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"kD ( uw , mg , u_time , mx , mv , u_sun_direction , mf , u_sun_quaternion , kF , length ( cL ) ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),
group:{type:"group",a:[{type:"textline",b:"float uy = clamp ( length ( u_sun_intensity ) + u_environment_energy , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 uz = gS ( u_cube_fog , mn ) ; vec4 uA = vec4 ( uz , u_fog_color_density . a ) ; gy ( uA . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec4 uA = u_fog_color_density ; uA . rgb *= uy ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"hk ( uw , length ( cL ) , mn , u_cam_water_depth , u_underwater_fog_color_density , uA , mg , uy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( uw , length ( cL ) , uA ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( ux < 0.5 ) discard ; ux = UNITY_VALUE_NODES ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 uB = texture2DProj ( u_shadow_mask , cK ) . rg ; float uC = uB . g ; uw = vec3 ( uC ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","uw",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( uw , ux ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( uw , ux ) ; }".split(" ")}]};
a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",
b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",
b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",
";"]}]}}]},{type:"textline",b:"varying vec3 kF ; varying vec4 cL ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kG",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kH",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cG",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cH",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cI",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cJ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_B4W_REFRACTION".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",k:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"lS",qualifier:["varying",
"vec2"]}],f:[{type:"textline",b:["lS","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",k:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"lX",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["lX","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",k:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute","float"]},{type:"node_param",name:"lY",
qualifier:["varying","float"]}],f:[{type:"textline",b:["lY","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",k:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"lZ",qualifier:["varying","vec2"]}],f:[{type:"textline",b:["lZ","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",k:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute",
"vec3"]},{type:"node_param",name:"l_",qualifier:["varying","vec3"]}],f:[{type:"textline",b:["l_","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec3 ma = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mb = a_normal ; vec3 mc = vec3 ( a_tangent ) ; vec3 md = a_tangent [ 3 ] * cross ( mb , mc ) ;".split(" ")}]}},{type:"elif",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec3 mb = a_normal ; vec3 mc = vec3 ( 0.0 ) ; vec3 md = vec3 ( 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mb = vec3 ( 0.0 ) ; vec3 mc = vec3 ( 0.0 ) ; vec3 md = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"ma = mix ( ma , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"mb = mix ( mb , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 me = vec3 ( a_tangent ) ; vec3 mf = a_tangent_next [ 3 ] * cross ( a_normal_next , me ) ; mc = mix ( mc , me , u_va_frame_factor ) ; md = mix ( md , mf , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",
b:"bt ( ma , mc , md , mb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","mg","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mg = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 mh = ( u_model_matrix * vec4 ( mg , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],
group:{type:"group",a:[{type:"textline",b:"mat4 mi = ag ( u_camera_eye , mh , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 mi = aa ( u_camera_eye , mh , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 mj = ( u_model_matrix * vec4 ( mg , 1.0 ) ) . xyz ; mi = mi * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , mj ) ;".split(" ")}]}}]},
{type:"textline",b:"d mk = an ( ma - mg , mg , mc , md , mb , mi ) ; mk . b = mh ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d mk = an ( ma , mg , mc , md , mb , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( mk . a , mk . b , mb ) ;".split(" ")}]}}]},{type:"textline",b:"kF = mk . a ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS || CALC_TBN_SPACE".split(" "),
group:{type:"group",a:[{type:"textline",b:"kG = mk . e ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"float ml = ( dot ( cross ( mk . e , mk . c ) , mk . d ) < 0.0 ) ? - 1.0 : 1.0 ; kH = vec4 ( mk . c , ml ) ;".split(" ")}]}}]},{type:"textline",b:"cL = u_view_matrix * vec4 ( mk . a , 1.0 ) ; vec4 mm = u_proj_matrix * cL ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"mm . xy += u_subpixel_jitter * mm . w ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gr","(","mm",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gr ( mk . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_B4W_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:"float mn = mm . x ; float mo = mm . y ; float mp = mm . w ; cK . x = ( mn + mp ) / 2.0 ; cK . y = ( mo + mp ) / 2.0 ; cK . z = mp ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kJ = - cL . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},{type:"textline",b:["gl_Position","=","mm",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float ma ; varying vec3 kI ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cL",";"]}]}}]},{type:"textline",b:"void main ( ) { float mb = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; float mc = smoothstep ( u_p_alpha_start , u_p_alpha_end , mb ) ; float md = u_diffuse_color . a * ma * ( 1.0 - clamp ( mc , 0.0 , 1.0 ) ) ; vec3 me = kI * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gL ( me , length ( cL ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["gA","(","me",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( me , md ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( me , md ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",
b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",
b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float ma ; varying vec3 kI ; varying vec3 cL ;".split(" ")},{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { mb mT ; mT = mS ( ) ; vec4 mU = u_view_matrix * vec4 ( mT . b , 1.0 ) ; gl_Position = u_proj_matrix * mU ; ma = mT . c ; kI = mT . d ; cL = mU . xyz ; float mV = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = mT . a * mV ; }".split(" ")}]};
a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float ma ; varying vec3 kI ; varying vec2 a ; varying vec3 kE ; varying vec3 kF ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 lu = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"vec4 lv = texture2D ( u_sampler , a ) ; gy ( lv . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lu . rgb = mix ( lu . rgb , lv . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lu . rgb *= mix ( vec3 ( 1.0 ) , lv . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"lu . a = lv . a ;".split(" ")}]}}]},{type:"textline",b:"lu . rgb *= kI ; vec3 lw = u_diffuse_intensity * lu . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"vec3 lx = u_emit * lu . rgb ; vec3 ly = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 lz = u_environment_energy * textureCube ( u_sky_texture , ly ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lA = 0.5 ; vec3 lz = u_environment_energy * mix ( u_horizon_color , u_zenith_color , lA ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lB = u_ambient * lz ; float lC = u_specular_params [ 0 ] ; vec2 lD = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 lE = lC * u_specular_color ; vec3 lF = normalize ( kE ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hw lG = jY ( lx , lB , lw , lE , kF , ly , lF , lD , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , 0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hw lG = kc ( lx , lB , lw ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lH = lG . a . rgb ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["vec3","lH","=","lw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gL ( lH , length ( cL ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"float lI = lu . a * ma ; gA ( lH ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gD ( lH , lI ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lH , lI ) ; }".split(" ")}]};
a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"varying float ma ; varying vec3 kI ; varying vec2 a ; varying vec3 kE ; varying vec3 kF ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cL",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float lw ( vec2 lu , vec2 lv ) { return ( atan ( lv . y , lv . x ) - atan ( lu . y , lu . x ) ) ; } void main ( ) { mb lx ; lx = mS ( ) ; float ly ; mat4 lz ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { ly = lx . e ; lz = z ( lx . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { ly = lx . e ; lz = k ( ) ; lz [ 3 ] = vec4 ( lx . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { ly = lx . e ; lz = o ( radians ( 90.0 ) ) ; lz [ 3 ] = vec4 ( lx . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { ly = lw ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + lx . e ; lz = m ( radians ( - 90.0 ) ) ; lz [ 3 ] = vec4 ( lx . b , 1.0 ) ; } vec4 lA = vec4 ( a_p_bb_vertex * 2.0 * lx . a * u_p_size , 0.0 , 1.0 ) ; vec4 lB = lz * q ( ly ) * lA ; vec4 lC = u_view_matrix * lB ; vec4 lD = u_proj_matrix * lC ; gl_Position = lD ; ma = lx . c ; kI = lx . d ; a = a_p_bb_vertex + 0.5 ; kF = lB . xyz ; kE = u_camera_eye - lB . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cL","=","lC",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 mT ; const float mU = 0.99 ; const float mV = 1.8 ; const int mW = 8 ; float nf ( vec3 mX , vec3 mY ) { float mZ = dot ( mY , mY ) ; float m_ = 2.0 * dot ( mY , mX ) ; float na = dot ( mX , mX ) - 1.0 ; float nb = m_ * m_ - 4.0 * mZ * na ; float nc = sqrt ( nb ) ; float nd = ( - m_ - nc ) / 2.0 ; float ne = na / nd ; return ne ; } float nm ( float ng , float nh ) { float ni = 3.0 * ( 1.0 - nh * nh ) ; float nj = 2.0 * ( 2.0 + nh * nh ) ; float nk = 1.0 + ng * ng ; float nl = pow ( 1.0 + nh * nh - 2.0 * nh * ng , 1.5 ) ; nl = max ( nl , 0.00001 ) ; return ( ni / nj ) * ( nk / nl ) ; } float nu ( vec3 nn , vec3 no , float np ) { float nq = dot ( no , - nn ) ; if ( nq < 0.0 ) { return 1.0 ; } vec3 nr = nn + nq * no ; if ( length ( nr ) < np ) { return 0.0 ; } else if ( length ( nr ) >= np ) { vec3 ns = normalize ( nr ) * np - nn ; float nt = acos ( dot ( normalize ( ns ) , no ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( nt * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 ny ( float nv , vec3 nw , float nx ) { return nw - nw * pow ( u_sky_color , vec3 ( nx / nv ) ) ; } void main ( ) { vec3 nz = normalize ( mT ) ; vec3 nA = u_sun_direction ; float nB = dot ( nz , nA ) ; float nC = nm ( nB , - 0.01 ) * u_rayleigh_brightness * nA . y ; float nD = nm ( nB - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - nA . y ) ; float nE = smoothstep ( 0.0 , 100.0 , nm ( nB , 0.9995 ) ) * u_spot_brightness ; vec3 nF = vec3 ( 0.0 , mU , 0.0 ) ; float nG = nf ( nF , nz ) ; float nH = nG / float ( mW ) ; float nI = nu ( nF , nz , mU - 0.3 ) ; vec3 nJ = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 nK = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int nL = 0 ; nL < mW ; nL ++ ) { float nM = nH * float ( nL ) ; vec3 nN = nF + nz * nM ; float nO = nu ( nN , nA , mU - 0.2 ) ; float nP = nf ( nN , nA ) ; vec3 nQ = ny ( nP , vec3 ( mV ) , u_scatter_strength ) * nO ; nJ += ny ( sqrt ( nM ) , u_sky_color * nQ , u_rayleigh_strength ) ; nK += ny ( nM , nQ , u_mie_strength ) ; } nJ = nJ * nI * pow ( nG , u_rayleigh_collection_power ) / float ( mW ) ; nK = ( nK * nI * pow ( nG , u_mie_collection_power ) ) / float ( mW ) ; vec3 nR = vec3 ( nE * nK + nD * nK + nC * nJ ) ; gA ( nR ) ; gl_FragColor = vec4 ( nR , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 mT ; void main ( ) { vec4 lu = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 lv = u_cube_view_matrix * lu ; mT = lv . xyz ; gl_Position = lu ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_sampler , a ) ; gA ( lu . rgb ) ; gD ( lu . rgb , lu . a ) ; gl_FragColor = lu ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { a = a_texcoord ; vec3 lu = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 lv = u_proj_matrix * u_view_matrix * vec4 ( lu , 0.0 ) ; lv . x /= lv . w ; lv . y /= lv . w ; lv += 99999.0 * step ( lv . z , 0.0 ) ; lv += 100.0 * ( step ( 1.0 , abs ( lv . x ) ) + step ( 1.0 , abs ( lv . y ) ) ) ; lv . x = - a_lf_dist * lv . x ; lv . y = - a_lf_dist * lv . y ; float lw = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 lx = vec2 ( a_lf_bb_vertex . x / lw , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float ly = 1.9 ; lx *= ( 1.0 + ly * length ( lv . xy ) ) ; } gl_Position = vec4 ( lv . xy + lx , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:["uniform","samplerCube","u_sky",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 mT ; void main ( ) { vec3 lu = textureCube ( u_sky , mT ) . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"gy ( lu . rgb ) ; float lv = u_camera_eye_frag . y - WATER_LEVEL ; lv = min ( - lv * 0.03 , 0.8 ) ; float lw = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; vec3 lx = normalize ( mT ) ; vec3 ly = vec3 ( 0.0 ) ; vec4 lz = u_underwater_fog_color_density ; lz . rgb = mix ( lz . rgb , ly , min ( - lx . y + lv , 1.0 ) ) * lw ; float lA = clamp ( sign ( lx . y - 0.05 * lv ) , 0.0 , 1.0 ) ; lu = mix ( lz . rgb , lu , lA ) ; gA ( lu . rgb ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( lu , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 mT ; void main ( ) { vec4 lu = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 lv = u_sky_vp_inverse * lu ; mT = lv . xyz ; gl_Position = lu ; }".split(" ")}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",
name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:"uniform float u_time ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"const float lu = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 kE ; varying vec3 kF ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kG",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 kH ; varying vec3 mU ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mV",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mW",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","&&","SHORE_SMOOTHING"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 nl ( in vec2 mY , in vec3 mZ , in vec3 m_ , in vec3 na , out float nb ) { vec3 nc = reflect ( - m_ , mZ ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nd = mY . xy + mZ . xz * REFL_BUMP / kJ ; nb = u_reflect_factor ; vec3 ne ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"ne = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ne = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"float nf = dot ( m_ , mZ ) ; nb *= max ( 1.0 - 1.0 / nf , 1.0 ) ; } else { ne = texture2D ( u_reflectmap , nd ) . rgb ; gy ( ne ) ; }".split(" ")}]}},
{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"nb = u_mirror_factor ; vec3 ne = na * textureCube ( u_mirrormap , nc ) . rgb ; gy ( ne ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nb = u_reflect_factor ; vec3 ne = na * vec3 ( 0.3 , 0.5 , 1.0 ) ; gy ( ne ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 ng = normalize ( nc + m_ ) ; float nh = 1.0 - dot ( m_ , ng ) ; float ni = u_fresnel_params [ 3 ] ; float nj = u_fresnel_params [ 2 ] ; float nk = ni + ( 1.0 - ni ) * pow ( nh , nj ) ; nb = min ( nb * nk , 1.0 ) ; return ne ; } void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 nm = mat3 ( kH , mU , kG ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nn = normalize ( kG ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 nm = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 nn = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","FOAM"],group:{type:"group",a:[{type:"textline",b:"float no = kF . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec2 np = vec2 ( mV . x , - mV . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 np = vec2 ( kF . x , - kF . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","np","=","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 nq = vec3 ( 0.0 ) ; vec3 nr = texture2D ( u_normalmap0 , np * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nq += nr ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"textline",b:"vec3 ns = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["ns","+=","nr",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"nr = texture2D ( u_normalmap0 , np * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nq += nr ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["ns","+=","nr",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"nr = texture2D ( u_normalmap0 , np * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nq += nr ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],
group:{type:"group",a:[{type:"textline",b:["ns","+=","nr",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"nr = texture2D ( u_normalmap0 , np * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; nq += nr ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["ns",
"+=","nr",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nt = nm * ns ; if ( ! g ( nt , vec3 ( 0.0 ) ) ) nt = normalize ( nt ) ; vec3 nu = mix ( nn , nt , 0.2 ) ; nu = normalize ( nu ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"nn = mix ( nn , normalize ( nm * nq ) , 0.3 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"nn = mix ( nn , normalize ( nm * nq ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"nn = normalize ( nn ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nv = normalize ( kE ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nw = cK . xy / cK . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",
b:"float nx = kJ * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float ny = u_diffuse_color . a ; vec4 nz = texture2DProj ( u_scene_depth , cK ) ; float nA = cw ( nz ) ; float nB = max ( nA - kJ , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nC = nw + nn . xz * u_refr_bump / kJ ; float nD = ll ( nA , nC , nw ) ; float nE = max ( nD - kJ , 0.0 ) ; float nF = u_view_max_depth / ABSORB * nE ; float nG ; if ( u_cam_water_depth < 0.0 ) nG = 0.0 ; else nG = min ( ny * nF , 1.0 ) ; float nH = u_view_max_depth / ABSORB * nB ; ny = min ( 15.0 * ny * u_view_max_depth * nB , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float nH = u_view_max_depth / ABSORB * nB ; if ( u_cam_water_depth > 0.0 ) ny = min ( ny * nH , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ny *= min ( 5.0 * nx , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ny = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float nG = 1.0 - ny ; vec2 nC = nw + nn . xz * REFR_BUMP / kJ ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 nI = texture2D ( u_refractmap , nC ) . rgb ; gy ( nI ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nJ = pow ( min ( mW . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 nK = mix ( u_shallow_water_col , u_diffuse_color . rgb , nJ ) ; nJ = pow ( min ( mW . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; nK = mix ( u_shore_water_col , nK , nJ ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nK = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nL = max ( 1.0 - u_view_max_depth * nB , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nL = 1.0 - ny ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:"float nM = max ( no / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 nN = normalize ( vec3 ( mW . r , 0.0 , mW . g ) ) ; vec3 nO = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , nN , 0.8 ) ) ; float nP = 1.25 * max ( dot ( nu , nO ) - 0.2 , 0.0 ) ; nP += max ( dot ( nu , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; nL += nP * ( 1.0 - mW . b ) ; nM *= ( 1.0 - 0.95 * pow ( mW . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"nL += nM ; nL = min ( u_foam_factor * nL , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 nQ = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + np * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"float nR = u_specular_params [ 0 ] ; vec2 nS = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 nT = nR * u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 nU = u_environment_energy * textureCube ( u_sky_texture , nn ) . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nU = u_environment_energy * u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"vec3 nV = u_ambient * nU ; vec3 nW = nV + u_sun_intensity ; float nX ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 nY = nl ( nw , nn , nv , nW , nX ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nY = nl ( vec2 ( 0.0 ) , nn , nv , nW , nX ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 nZ = u_diffuse_intensity * nK ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hw n_ = jY ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , nZ , nT , kF , nn , nv , nS , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) , 0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hw n_ = kc ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , nZ ) ;".split(" ")}]}}]},
{type:"textline",b:"nZ = n_ . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float oa = max ( dot ( u_sun_direction , - kG ) + SSS_WIDTH , 0.0 ) * max ( dot ( - nv , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; oa = clamp ( SSS_STRENGTH * oa , 0.0 , 1.0 ) ; nZ = mix ( nZ , u_shallow_water_col , oa ) ; nZ = mix ( nZ , u_shore_water_col , oa ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:"nZ = mix ( nI , nZ , nG ) ;".split(" ")}]}}]},{type:"textline",b:"nZ = mix ( nZ , nY , nX ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"float ob = mix ( nQ . g , nQ . r , max ( 4.0 * ( nL - 0.75 ) , 0.0 ) ) ; ob = mix ( nQ . b , ob , max ( 2.0 * nL - 1.0 , 0.0 ) ) ; ob = mix ( 0.0 , ob , nL ) ; nZ = mix ( nZ , nW , ob ) ;".split(" ")}]}}]},{type:"textline",b:"nZ += n_ . b ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 oc = gS ( u_cube_fog , nv ) ; vec4 od = vec4 ( oc , u_fog_color_density . a ) ; gy ( od . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","od","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { ht ( nZ , nx , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { gL ( nZ , nx , od ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gL ( nZ , nx , od ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["gA","(","nZ",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"ny = max ( ny , n_ . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["ny","+=","ob",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gD ( nZ , ny ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 oe = fwidth ( mX ) ; vec3 of = smoothstep ( vec3 ( 0.0 ) , oe * lu , mX ) ; float og = min ( min ( of . x , of . y ) , of . z ) ; og = clamp ( og , 0.0 , 1.0 ) ; nZ = mix ( u_wireframe_edge_color , nZ , og ) ; ny = mix ( 1.0 , ny , og ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( nZ , ny ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",
b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 kE ; varying vec3 kF ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","kG",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 kH ; varying vec3 mU ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mV",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mW",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cK",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","kJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mX",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"vec3 lA ( in vec2 lu ) { vec2 lv = 0.5 + vec2 ( ( lu . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( lu . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; vec4 lw = texture2D ( u_shore_dist_map , lv ) ; const vec2 lx = vec2 ( 1.0 / 255.0 , 1.0 ) ; float ly = dot ( lw . ba , lx ) ; vec2 lz = normalize ( lw . rg * 2.0 - 1.0 ) ; return vec3 ( lz , ly ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},
{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void lR ( inout vec3 lB , in float lC , in vec3 lD ) { float lE = dM ( DST_NOISE_SCALE_0 * ( lB . xz + DST_NOISE_FREQ_0 * lC ) ) * dM ( DST_NOISE_SCALE_1 * ( lB . zx - DST_NOISE_FREQ_1 * lC ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float lF = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float lG = lD . b ; float lH = sqrt ( lG ) ; float lI = max ( lG , DIR_MIN_SHR_FAC ) * sin ( lH / lF + DIR_FREQ * lC ) ; float lJ = max ( dM ( DIR_NOISE_SCALE * ( lB . xz + DIR_NOISE_FREQ * lC ) ) , DIR_MIN_NOISE_FAC ) ; lI *= lJ ; float lK = WAVES_HEIGHT * mix ( lI , lE , max ( lH , DST_MIN_FAC ) ) ; vec2 lL = lD . rg ; float lM = WAVES_HOR_FAC * lI * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - lG ) , 0.0 ) ; vec2 lN = lM * lL ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float lK = WAVES_HEIGHT * lE ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"vec2 lO = 2.0 * ( lB . xz - 0.1 * lC ) ; vec2 lP = 1.3 * ( lB . zx + 0.03 * lC ) ; float lQ = dg ( 0.5 * lO ) . x + dg ( 0.5 * lP ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lB . xz += lN ; lQ *= lG ;".split(" ")}]}}]},{type:"textline",
b:"lK += SMALL_WAVES_FAC * lQ ;".split(" ")}]}}]},{type:"textline",b:"lB . y += lK ; }".split(" ")}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) mX = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) mX = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) mX = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["vec3","mY","=","a_position",
";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float mZ = abs ( mY . y ) ; vec2 m_ = u_camera_eye . xz - mod ( u_camera_eye . xz , mZ ) ; mY . y = WATER_LEVEL ; mY . xz += m_ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},{type:"textline",b:"d na = an ( mY , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC",
"&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"mV = na . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"mW = lA ( na . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float nb = length ( u_wind ) ; float nc = u_time ; nc *= nb ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["float",
"nd","=","mZ",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","nd","=","0.1",";"]}]}}]},{type:"textline",b:"vec3 ne = na . a + vec3 ( nd , 0.0 , 0.0 ) ; vec3 nf = na . a + vec3 ( 0.0 , 0.0 , nd ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 ng = lA ( ne . xz ) ; vec3 nh = lA ( nf . xz ) ; lR ( ne , nc , ng ) ; lR ( nf , nc , nh ) ; lR ( na . a , nc , mW ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"lR ( ne , nc , vec3 ( 0.0 ) ) ; lR ( nf , nc , vec3 ( 0.0 ) ) ; lR ( na . a , nc , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_position . y < 0.0 ) { na . a . y = WATER_LEVEL - 1.0 ; ne . y = na . a . y ; nf . y = na . a . y ; }".split(" ")}]}}]},{type:"textline",b:"vec3 ni = normalize ( ne - na . a ) ; vec3 nj = normalize ( nf - na . a ) ; kG = normalize ( cross ( nj , ni ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"kH = nj ; mU = cross ( kG , kH ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nk = dot ( kG , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float nl = clamp ( 0.8 - nk , 0.0 , 1.0 ) ; kG = mix ( kG , vec3 ( 0.0 , 1.0 , 0.0 ) , nl ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"kF = na . a ; kE = u_camera_eye - na . a ; vec4 nm = u_view_matrix * vec4 ( na . a , 1.0 ) ; vec4 nn = u_proj_matrix * nm ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float no = nn . x ; float np = nn . y ; float nq = nn . w ; cK . x = ( no + nq ) / 2.0 ; cK . y = ( np + nq ) / 2.0 ; cK . z = nq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"kJ = - nm . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["gl_Position","=","nn",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 mX ; const float lu = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 lv = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lv = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lw = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 lx = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 ly = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec3 lz = vec3 ( 0.0 ) ; float lA = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"vec3 lB = sign ( mX - vec3 ( 0.02 * lu ) ) ; if ( lB . x < 0.0 || lB . y < 0.0 || lB . z < 0.0 ) { lz = lv ; lA = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lB = sign ( mX - vec3 ( 0.02 * lu ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( lB . x < 0.0 || lB . y < 0.0 || lB . z < 0.0 ) lz = u_wireframe_edge_color ; else lz = ly ; lA = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( lB . x < 0.0 || lB . y < 0.0 || lB . z < 0.0 ) lA = 1.0 ; else lA = 0.0 ; lz = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( lB . x < 0.0 || lB . y < 0.0 || lB . z < 0.0 ) lz = u_wireframe_edge_color ; else if ( gl_FrontFacing ) lz = lw ; else lz = lx ; lA = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 lC = fwidth ( mX ) ; vec3 lD = smoothstep ( vec3 ( 0.0 ) , lC * lu , mX ) ; float lE = min ( min ( lD . x , lD . y ) , lD . z ) ; lE = clamp ( lE , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { lz = vec3 ( mix ( u_wireframe_edge_color , ly , lE ) ) ; lA = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { lz = u_wireframe_edge_color ; lA = mix ( 1.0 , 0.0 , lE ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) lz = mix ( u_wireframe_edge_color , lw , lE ) ; else lz = mix ( u_wireframe_edge_color , lx , lE ) ; lA = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["gA","(","lz",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gD ( lz , lA ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lz , lA ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",b:["varying","vec3","mX",";"]},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { if ( a_polyindex == 0.0 ) mX = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) mX = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) mX = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 lu = a_position ; vec3 lv = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"d lw = an ( lu , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"lu = mix ( lu , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 lx = vec3 ( 0.0 ) ; vec3 ly = vec3 ( 0.0 ) ; bt ( lu , lx , ly , lv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["vec3","lz","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lz = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"d lw = gh ( lu , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lz , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lA = ( u_model_matrix * vec4 ( lz , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 lB = ag ( u_camera_eye , lA , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 lB = aa ( u_camera_eye , lA , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND",
"&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lC = ( u_model_matrix * vec4 ( lz , 1.0 ) ) . xyz ; lB = lB * Q ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lC ) ;".split(" ")}]}}]},{type:"textline",b:"d lw = an ( lu - lz , lz , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lB ) ; lw . b = lA ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"d lw = an ( lu , lz , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ck ( lw . a , lw . b , lv ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 lD = u_view_matrix * vec4 ( lw . a , 1.0 ) ; gl_Position = u_proj_matrix * lD ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_sampler_left , a ) ; vec4 lv = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( lu [ 0 ] , lv [ 1 ] , lv [ 2 ] , lu [ 3 ] + lv [ 3 ] ) ; }".split(" ")}]};
a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 lx ( float lu , float lv ) { vec2 lw = a + vec2 ( lu , lv ) * u_texel_size ; return texture2D ( u_color , lw ) ; } float lB ( vec4 ly ) { vec3 lz = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lA = dot ( ly . rgb , lz ) ; return lA ; } vec4 m_ ( ) { vec4 lC = lx ( - 1.0 , - 1.0 ) ; vec4 lD = lx ( 1.0 , - 1.0 ) ; vec4 lE = lx ( - 1.0 , 1.0 ) ; vec4 lF = lx ( 1.0 , 1.0 ) ; vec4 lG = lx ( 0.0 , 0.0 ) ; float lH = lB ( lC ) ; float lI = lB ( lD ) ; float lJ = lB ( lE ) ; float lK = lB ( lF ) ; float lL = lB ( lG ) ; float lM = min ( lL , min ( min ( lH , lI ) , min ( lJ , lK ) ) ) ; float lN = max ( lL , max ( max ( lH , lI ) , max ( lJ , lK ) ) ) ; vec2 lO ; lO . x = - ( ( lH + lI ) - ( lJ + lK ) ) ; lO . y = ( ( lH + lJ ) - ( lI + lK ) ) ; float lP = max ( ( lH + lI + lJ + lK ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float lQ = 1.0 / ( min ( abs ( lO . x ) , abs ( lO . y ) ) + lP ) ; lO = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , lO * lQ ) ) * u_texel_size ; vec4 lR = 0.5 * ( texture2D ( u_color , a + lO * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + lO * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 mY = lR * 0.5 + 0.25 * ( texture2D ( u_color , a + lO * - 0.5 ) + texture2D ( u_color , a + lO * 0.5 ) ) ; float mZ = lB ( mY ) ; if ( ( mZ < lM ) || ( mZ > lN ) ) return lR ; else return mY ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 oL ( ) { vec2 na ; na . x = a . x ; na . y = a . y ; vec4 nb = texture2D ( u_color , na ) ; vec4 nc = lx ( 0.0 , 1.0 ) ; vec4 nd = lx ( 1.0 , 0.0 ) ; vec4 ne = lx ( 0.0 , - 1.0 ) ; vec4 nf = lx ( - 1.0 , 0.0 ) ; float ng = lB ( nc ) ; float nh = lB ( nd ) ; float ni = lB ( ne ) ; float nj = lB ( nf ) ; float nk = lB ( nb ) ; float nl = max ( ng , nk ) ; float nm = min ( ng , nk ) ; float nn = max ( nh , nl ) ; float no = min ( nh , nm ) ; float np = max ( ni , nj ) ; float nq = min ( ni , nj ) ; float nr = max ( np , nn ) ; float ns = min ( nq , no ) ; float nt = nr * FXAA_QUALITY_EDGE_THRESHOLD ; float nu = nr - ns ; float nv = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , nt ) ; bool nw = nu < nv ; if ( nw ) return nb ; vec4 nx = lx ( - 1.0 , - 1.0 ) ; vec4 ny = lx ( 1.0 , 1.0 ) ; vec4 nz = lx ( 1.0 , - 1.0 ) ; vec4 nA = lx ( - 1.0 , 1.0 ) ; float nB = lB ( nx ) ; float nC = lB ( ny ) ; float nD = lB ( nz ) ; float nE = lB ( nA ) ; float nF = ni + ng ; float nG = nj + nh ; float nH = 1.0 / nu ; float nI = nF + nG ; float nJ = ( - 2.0 * nk ) + nF ; float nK = ( - 2.0 * nk ) + nG ; float nL = nD + nC ; float nM = nB + nD ; float nN = ( - 2.0 * nh ) + nL ; float nO = ( - 2.0 * ni ) + nM ; float nP = nB + nE ; float nQ = nE + nC ; float nR = ( abs ( nJ ) * 2.0 ) + abs ( nN ) ; float nS = ( abs ( nK ) * 2.0 ) + abs ( nO ) ; float nT = ( - 2.0 * nj ) + nP ; float nU = ( - 2.0 * ng ) + nQ ; float nV = abs ( nT ) + nR ; float nW = abs ( nU ) + nS ; float nX = nP + nL ; float nY = u_texel_size . x ; bool nZ = nV >= nW ; float n_ = nI * 2.0 + nX ; if ( ! nZ ) ni = nj ; if ( ! nZ ) ng = nh ; if ( nZ ) nY = u_texel_size . y ; float oa = ( n_ * ( 1.0 / 12.0 ) ) - nk ; float ob = ni - nk ; float oc = ng - nk ; float od = ni + nk ; float oe = ng + nk ; bool of = abs ( ob ) >= abs ( oc ) ; float og = max ( abs ( ob ) , abs ( oc ) ) ; if ( of ) nY = - nY ; float oh = clamp ( abs ( oa ) * nH , 0.0 , 1.0 ) ; vec2 oi ; oi . x = na . x ; oi . y = na . y ; vec2 oj ; oj . x = ( ! nZ ) ? 0.0 : u_texel_size . x ; oj . y = ( nZ ) ? 0.0 : u_texel_size . y ; if ( ! nZ ) oi . x += nY * 0.5 ; if ( nZ ) oi . y += nY * 0.5 ; vec2 ok ; ok . x = oi . x - oj . x ; ok . y = oi . y - oj . y ; vec2 ol ; ol . x = oi . x + oj . x ; ol . y = oi . y + oj . y ; float om = ( ( - 2.0 ) * oh ) + 3.0 ; float on = lB ( texture2D ( u_color , ok ) ) ; float oo = oh * oh ; float op = lB ( texture2D ( u_color , ol ) ) ; if ( ! of ) od = oe ; float oq = og * 1.0 / 4.0 ; float or = nk - od * 0.5 ; float os = om * oo ; bool ot = or < 0.0 ; on -= od * 0.5 ; op -= od * 0.5 ; bool ou = abs ( on ) >= oq ; bool ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 1.5 ; if ( ! ou ) ok . y -= oj . y * 1.5 ; bool ow = ( ! ou ) || ( ! ov ) ; if ( ! ov ) ol . x += oj . x * 1.5 ; if ( ! ov ) ol . y += oj . y * 1.5 ; if ( ow ) { if ( ! ou ) on = lB ( texture2D ( u_color , ok . xy ) ) ; if ( ! ov ) op = lB ( texture2D ( u_color , ol . xy ) ) ; if ( ! ou ) on = on - od * 0.5 ; if ( ! ov ) op = op - od * 0.5 ; ou = abs ( on ) >= oq ; ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 2.0 ; if ( ! ou ) ok . y -= oj . y * 2.0 ; ow = ( ! ou ) || ( ! ov ) ; if ( ! ov ) ol . x += oj . x * 2.0 ; if ( ! ov ) ol . y += oj . y * 2.0 ; if ( ow ) { if ( ! ou ) on = lB ( texture2D ( u_color , ok . xy ) ) ; if ( ! ov ) op = lB ( texture2D ( u_color , ol . xy ) ) ; if ( ! ou ) on = on - od * 0.5 ; if ( ! ov ) op = op - od * 0.5 ; ou = abs ( on ) >= oq ; ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 2.0 ; if ( ! ou ) ok . y -= oj . y * 2.0 ; ow = ( ! ou ) || ( ! ov ) ; if ( ! ov ) ol . x += oj . x * 2.0 ; if ( ! ov ) ol . y += oj . y * 2.0 ; if ( ow ) { if ( ! ou ) on = lB ( texture2D ( u_color , ok . xy ) ) ; if ( ! ov ) op = lB ( texture2D ( u_color , ol . xy ) ) ; if ( ! ou ) on = on - od * 0.5 ; if ( ! ov ) op = op - od * 0.5 ; ou = abs ( on ) >= oq ; ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 4.0 ; if ( ! ou ) ok . y -= oj . y * 4.0 ; ow = ( ! ou ) || ( ! ov ) ; if ( ! ov ) ol . x += oj . x * 4.0 ; if ( ! ov ) ol . y += oj . y * 4.0 ; if ( ow ) { if ( ! ou ) on = lB ( texture2D ( u_color , ok . xy ) ) ; if ( ! ov ) op = lB ( texture2D ( u_color , ol . xy ) ) ; if ( ! ou ) on = on - od * 0.5 ; if ( ! ov ) op = op - od * 0.5 ; ou = abs ( on ) >= oq ; ov = abs ( op ) >= oq ; if ( ! ou ) ok . x -= oj . x * 2.0 ; if ( ! ou ) ok . y -= oj . y * 2.0 ; if ( ! ov ) ol . x += oj . x * 2.0 ; if ( ! ov ) ol . y += oj . y * 2.0 ; } } } } float ox = na . x - ok . x ; float oy = ol . x - na . x ; if ( ! nZ ) ox = na . y - ok . y ; if ( ! nZ ) oy = ol . y - na . y ; bool oz = ( on < 0.0 ) != ot ; float oA = ( oy + ox ) ; bool oB = ( op < 0.0 ) != ot ; float oC = 1.0 / oA ; bool oD = ox < oy ; float oE = min ( ox , oy ) ; bool oF = oD ? oz : oB ; float oG = os * os ; float oH = ( oE * ( - oC ) ) + 0.5 ; float oI = oG * FXAA_QUALITY_SUBPIX ; float oJ = oF ? oH : 0.0 ; float oK = max ( oJ , oI ) ; if ( ! nZ ) na . x += oK * nY ; if ( nZ ) na . y += oK * nY ; return texture2D ( u_color , na ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = m_ ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = oL ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 lu = vec2 ( 0.0 , 0.0 ) ; vec2 lv = u_texel_size ; vec4 lw = texture2D ( u_color , a ) ; gl_FragColor = lw * 0.0875447373698 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0858112354248 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0808139781061 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0731235112908 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0635705267419 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0530985673112 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0426125984122 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0328565115809 ; lu += lv ; gl_FragColor += texture2D ( u_color , a + lu ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - lu ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * lw , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_main , a ) ; vec4 lv = texture2D ( u_bloom , a ) ; vec4 lw = lu ; lw += lv ; gl_FragColor = vec4 ( lw . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_color , a ) ; vec3 lv = lu . rgb ; if ( u_brightness < 0.0 ) lv = lv * ( 1.0 + u_brightness ) ; else lv = lv + ( ( 1.0 - lv ) * u_brightness ) ; lv = ( lv - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; lv *= u_exposure ; vec3 lw = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lx = dot ( lv , lw ) ; lv = mix ( vec3 ( lx ) , lv , u_saturation ) ; gl_FragColor = vec4 ( lv , lu . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cs ( clamp ( ne ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { vec4 nf = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { float ng = ne ( u_depth , a , u_camera_range ) ; ng *= u_view_max_depth ; float nh ; if ( ng < u_dof_dist ) nh = ( u_dof_dist - ng ) / u_dof_front ; else nh = ( ng - u_dof_dist ) / u_dof_rear ; nh = clamp ( nh , 0.0 , 1.0 ) ; vec4 ni = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( nf , ni , nh ) ; } else gl_FragColor = nf ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float lz ( float lu , float lv , float lw ) { vec2 lx = a + vec2 ( lu , lv ) * u_texel_size ; vec4 ly = texture2D ( u_sampler , lx ) * lw ; return cw ( ly ) ; } void main ( ) { float lA = ( lz ( - 1.0 , - 1.0 , - 1.0 ) + lz ( 0.0 , - 1.0 , - 1.0 ) + lz ( 1.0 , - 1.0 , - 1.0 ) + lz ( - 1.0 , 0.0 , - 1.0 ) + lz ( 0.0 , 0.0 , 8.0 ) + lz ( 1.0 , 0.0 , - 1.0 ) + lz ( - 1.0 , 1.0 , - 1.0 ) + lz ( 0.0 , 1.0 , - 1.0 ) + lz ( 1.0 , 1.0 , - 1.0 ) ) ; lA *= 1000.0 ; gl_FragColor = vec4 ( lA , lA , lA , 1.0 ) ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_glow_src ; uniform sampler2D u_glow_mask ; uniform sampler2D u_glow_mask_blurred ; uniform vec3 u_glow_color ; uniform float u_draw_glow ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_glow_src , a ) ; gl_FragColor = lu ; if ( u_draw_glow != 0.0 ) { vec4 lv = texture2D ( u_glow_mask , a ) ; vec4 lw = texture2D ( u_glow_mask_blurred , a ) ; float lx = lw . a - lv . a ; if ( lx != 0.0 ) { float ly = smoothstep ( 0.0 , 1.0 , lw . a ) ; if ( lv . a == 0.0 ) { vec3 lz = u_glow_color ; gA ( lz ) ; vec4 lA = vec4 ( clamp ( lz , 0.0 , 1.0 ) , ly ) ; gl_FragColor = mix ( lu , lA , ly ) ; } } } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float nf ; varying vec2 ng ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 nh ; void main ( ) { vec2 ni = ( nh . xy - a ) ; float nj = length ( ni ) ; vec2 nk = u_radial_blur_step * ni / nj ; float nl = nj / u_radial_blur_step ; nk *= min ( nl , STEPS_PER_PASS ) / STEPS_PER_PASS ; nl = max ( nl , STEPS_PER_PASS ) ; vec2 nm = a ; float nn = 0.0 ; for ( float no = 0.0 ; no < STEPS_PER_PASS ; no += 1.0 ) { if ( no <= nl ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"float np = ne ( u_input , nm , u_camera_range ) ; nn += max ( ( 1.0 - pow ( nj , 0.3 ) ) * step ( 0.9 , np ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 nq = texture2D ( u_input , nm ) ; nn += cw ( nq ) ;".split(" ")}]}}]},{type:"textline",b:"} nm += nk ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"vec2 nr = a + ng ; float ns = dg ( vec2 ( 2.5 * ( nr . x ) , 2.5 * ( nr . y ) + 1.0 * u_time ) ) . x + 0.75 * dg ( vec2 ( 5.0 * ( nr . x ) - 0.66 * u_time , 5.0 * ( nr . y ) + 0.66 * u_time ) ) . x + 0.5 * dM ( vec2 ( 7.5 * ( nr . x ) + 0.33 * u_time , 7.5 * ( nr . y ) - 0.33 * u_time ) ) ; ns *= clamp ( 1.2 - sqrt ( 0.2 * nj ) , 0.0 , 1.0 ) * nf ; nn = max ( ns , nn ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = cs ( nn / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform vec4 u_refl_plane ; varying float nf ; varying vec2 ng ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"varying vec2 a ; varying vec4 nh ; void lB ( in vec4 lu , in vec3 lv , out vec3 lw ) { float lx = lu . w * lv . x + lu . y * lv . z - lu . z * lv . y ; float ly = lu . w * lv . y + lu . z * lv . x - lu . x * lv . z ; float lz = lu . w * lv . z + lu . x * lv . y - lu . y * lv . x ; float lA = - lu . x * lv . x - lu . y * lv . y - lu . z * lv . z ; lw . x = lx * lu . w - lA * lu . x - ly * lu . z + lz * lu . y ; lw . y = ly * lu . w - lA * lu . y - lz * lu . x + lx * lu . z ; lw . z = lz * lu . w - lA * lu . z - lx * lu . y + ly * lu . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 lC = normalize ( u_sun_direction ) ; nh = u_proj_matrix * u_view_matrix * vec4 ( lC , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_camera_eye . y + a_bb_vertex . t < - u_refl_plane . w ) { nf = 1.0 ; vec3 lD = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 lE ; lB ( u_camera_quat , lD , lE ) ; lE = normalize ( lE ) ; float lF = dot ( lE , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lG = atan ( lE . x , lE . z ) ; ng = vec2 ( - lG , acos ( lF ) ) ; } else { nf = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"nh . x /= nh . w ; nh . y /= nh . w ; nh . x = 0.5 * ( nh . x + 1.0 ) ; nh . y = 0.5 * ( nh . y + 1.0 ) ; nh += 99999.0 * step ( nh . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_main , a ) ; vec3 lv = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; gy ( lu . rgb ) ; float lw = cw ( texture2D ( u_god_rays , a ) ) ; vec3 lx = lu . rgb + u_god_rays_intensity * vec3 ( lw ) * lv ; gA ( lx ) ; gl_FragColor . rgb = lx ; gl_FragColor . a = lu . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_color , a ) * 0.38026 ; lu += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; lu += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; lu += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; lu += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; lu += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; lu += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; lu += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; lu += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = lu ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_input , a ) ; float lv = dot ( lu . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( lv ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float lu ; float lv = 0.0 ; for ( float lw = 0.025 ; lw < 1.0 ; lw += 0.05 ) for ( float lx = 0.025 ; lx < 1.0 ; lx += 0.05 ) { lu = max ( texture2D ( u_input , vec2 ( lw , lx ) ) . r , 0.01 ) ; lv += log ( lu ) ; } float ly = exp ( lv / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( ly ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float ni ; void main ( ) { float nj = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float nk = texture2D ( u_luminance , a ) . r ; vec4 nl = texture2D ( u_main , a ) ; float nm = nk / nj ; float nn = u_bloom_edge_lum ; gl_FragColor = nl * max ( nm - nn , 0.0 ) * ni ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float ni ; const vec3 lu = vec3 ( 0.0 , 1.0 , 0.0 ) ; void lC ( in vec4 lv , in vec3 lw , out vec3 lx ) { float ly = lv . w * lw . x + lv . y * lw . z - lv . z * lw . y ; float lz = lv . w * lw . y + lv . z * lw . x - lv . x * lw . z ; float lA = lv . w * lw . z + lv . x * lw . y - lv . y * lw . x ; float lB = - lv . x * lw . x - lv . y * lw . y - lv . z * lw . z ; lx . x = ly * lv . w - lB * lv . x - lz * lv . z + lA * lv . y ; lx . y = lz * lv . w - lB * lv . y - lA * lv . x + ly * lv . z ; lx . z = lA * lv . w - lB * lv . z - ly * lv . y + lz * lv . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 lD ; lC ( u_camera_quat , lu , lD ) ; ni = dot ( - lD , u_sun_direction ) * u_bloom_key ; ni *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 lu = texture2D ( u_mb_tex_curr , a ) ; vec4 lv = texture2D ( u_mb_tex_accum , a ) ; if ( length ( lu - lv ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * lu + u_motion_blur_exp * lv ; } else { gl_FragColor = lu ; } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"vec4 lu = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( lu . r + lu . g + lu . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lv = vec2 ( 0.0 , 0.0 ) ; vec2 lw = u_texel_size ; vec4 lx ; lx = texture2D ( u_color , a ) ; gl_FragColor = lx * 0.2270270270 ; lv += lw ; lx = texture2D ( u_color , a + lv ) ; gl_FragColor += lx * 0.1945945946 ; lx = texture2D ( u_color , a - lv ) ; gl_FragColor += lx * 0.1945945946 ; lv += lw ; lx = texture2D ( u_color , a + lv ) ; gl_FragColor += lx * 0.1216216216 ; lx = texture2D ( u_color , a - lv ) ; gl_FragColor += lx * 0.1216216216 ; lv += lw ; lx = texture2D ( u_color , a + lv ) ; gl_FragColor += lx * 0.0540540541 ; lx = texture2D ( u_color , a - lv ) ; gl_FragColor += lx * 0.0540540541 ; lv += lw ; lx = texture2D ( u_color , a + lv ) ; gl_FragColor += lx * 0.0162162162 ; lx = texture2D ( u_color , a - lv ) ; gl_FragColor += lx * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 lw = u_texel_size ; vec4 lx = texture2D ( u_color , a ) ; gl_FragColor = lx ; if ( lx . a == 0.0 ) { lx = texture2D ( u_color , a + lw ) ; if ( lx . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , lx . a ) ; else { lx = texture2D ( u_color , a - lw ) ; if ( lx . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , lx . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; varying vec2 a ; void main ( ) { a = a_bb_vertex + 0.5 ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","nj",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nk ; varying vec4 nl ; varying vec4 nm ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nn",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 nt ( vec2 no , sampler2D np ) { float nq = texture2D ( np , no ) . r ; float nr = texture2D ( np , nk . xy ) . r ; float ns = texture2D ( np , nk . zw ) . r ; return vec3 ( nq , nr , ns ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nz ( vec2 nu , sampler2D nv ) { vec3 nw = nt ( nu , nv ) ; vec2 nx = abs ( nw . xx - nw . yz ) ; vec2 ny = step ( SMAA_PREDICATION_THRESHOLD , nx ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * ny ) ; }".split(" ")}]}}]},{type:"textline",b:"void nD ( bvec2 nA , inout vec2 nB , vec2 nC ) { if ( nA . x ) nB . x = nC . x ; if ( nA . y ) nB . y = nC . y ; } void nD ( bvec4 nE , inout vec4 nF , vec4 nG ) { nD ( nE . xy , nF . xy , nG . xy ) ; nD ( nE . zw , nF . zw , nG . zw ) ; } vec2 nI ( vec2 nH ) { return sign ( nH ) * floor ( abs ( nH ) + .5 ) ; } vec4 nI ( vec4 nJ ) { return sign ( nJ ) * floor ( abs ( nJ ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 n_ ( vec2 nK , sampler2D nL".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","nM"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 nN = nz ( nK , nM ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 nN = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nO = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float nP = dot ( texture2D ( nL , nK ) . rgb , nO ) ; float nQ = dot ( texture2D ( nL , nk . xy ) . rgb , nO ) ; float nR = dot ( texture2D ( nL , nk . zw ) . rgb , nO ) ; vec4 nS ; nS . xy = abs ( nP - vec2 ( nQ , nR ) ) ; vec2 nT = step ( nN , nS . xy ) ; if ( dot ( nT , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float nU = dot ( texture2D ( nL , nl . xy ) . rgb , nO ) ; float nV = dot ( texture2D ( nL , nl . zw ) . rgb , nO ) ; nS . zw = abs ( nP - vec2 ( nU , nV ) ) ; vec2 nW = max ( nS . xy , nS . zw ) ; float nX = dot ( texture2D ( nL , nm . xy ) . rgb , nO ) ; float nY = dot ( texture2D ( nL , nm . zw ) . rgb , nO ) ; nS . zw = abs ( vec2 ( nQ , nR ) - vec2 ( nX , nY ) ) ; nW = max ( nW . xy , nS . zw ) ; float nZ = max ( nW . x , nW . y ) ; nT . xy *= step ( nZ , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * nS . xy ) ; return nT ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 ob ( vec2 oa ) { oa . r = oa . r * abs ( 5.0 * oa . r - 5.0 * 0.75 ) ; return nI ( oa ) ; } vec4 ob ( vec4 oc ) { oc . rb = oc . rb * abs ( 5.0 * oc . rb - 5.0 * 0.75 ) ; return nI ( oc ) ; } vec2 ok ( sampler2D od , vec2 oe , vec2 of , out vec2 og ) { vec4 oh = vec4 ( oe , - 1.0 , 1.0 ) ; vec3 oi = vec3 ( u_texel_size , 1.0 ) ; for ( int oj = 0 ; oj < SMAA_MAX_SEARCH_STEPS_DIAG ; oj ++ ) { if ( oh . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && oh . w > 0.9 ) { oh . xyz += oi * vec3 ( of , 1.0 ) ; og = texture2D ( od , oh . xy , 0.0 ) . rg ; oh . w = dot ( og , vec2 ( 0.5 , 0.5 ) ) ; } } return oh . zw ; } vec2 os ( sampler2D ol , vec2 om , vec2 on , out vec2 oo ) { vec4 op = vec4 ( om , - 1.0 , 1.0 ) ; op . x += 0.25 * u_texel_size . x ; vec3 oq = vec3 ( u_texel_size , 1.0 ) ; for ( int or = 0 ; or < SMAA_MAX_SEARCH_STEPS_DIAG ; or ++ ) { if ( op . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && op . w > 0.9 ) { op . xyz = oq * vec3 ( on , 1.0 ) + op . xyz ; oo = texture2D ( ol , op . xy , 0.0 ) . rg ; oo = ob ( oo ) ; op . w = dot ( oo , vec2 ( 0.5 , 0.5 ) ) ; } } return op . zw ; } vec2 oy ( sampler2D ot , vec2 ou , vec2 ov , float ow ) { vec2 ox = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * ov + ou ; ox = SMAA_AREATEX_PIXEL_SIZE * ox + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; ox . x += 0.5 ; ox . y += SMAA_AREATEX_SUBTEX_SIZE * ow ; return texture2D ( ot , ox , 0.0 ) . rg ; } vec2 oN ( sampler2D oz , sampler2D oA , vec2 oB , vec2 oC , vec4 oD ) { vec2 oE = vec2 ( 0.0 , 0.0 ) ; vec4 oF ; vec2 oG ; if ( oC . r > 0.0 ) { oF . xz = ok ( oz , oB , vec2 ( - 1.0 , 1.0 ) , oG ) ; oF . x += float ( oG . y > 0.9 ) ; } else oF . xz = vec2 ( 0.0 , 0.0 ) ; oF . yw = ok ( oz , oB , vec2 ( 1.0 , - 1.0 ) , oG ) ; if ( oF . x + oF . y > 2.0 ) { vec4 oH = vec4 ( - oF . x + 0.25 , oF . x , oF . y , - oF . y - 0.25 ) * u_texel_size . xyxy + oB . xyxy ; vec4 oI ; oI . xy = texture2D ( oz , oH . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; oI . zw = texture2D ( oz , oH . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; oI . yxwz = ob ( oI . xyzw ) ; vec2 oJ = vec2 ( 2.0 , 2.0 ) * oI . xz + oI . yw ; nD ( bvec2 ( step ( 0.9 , oF . zw ) ) , oJ , vec2 ( 0.0 , 0.0 ) ) ; oE += oy ( oA , oF . xy , oJ , oD . z ) ; } oF . xz = os ( oz , oB , vec2 ( - 1 , - 1 ) , oG ) ; if ( texture2D ( oz , oB + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { oF . yw = os ( oz , oB , vec2 ( 1 , 1 ) , oG ) ; oF . y += float ( oG . y > 0.9 ) ; } else oF . yw = vec2 ( 0.0 , 0.0 ) ; if ( oF . x + oF . y > 2.0 ) { vec4 oK = vec4 ( - oF . x , - oF . x , oF . y , oF . y ) * u_texel_size . xyxy + oB . xyxy ; vec4 oL ; oL . x = texture2D ( oz , oK . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; oL . y = texture2D ( oz , oK . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; oL . zw = texture2D ( oz , oK . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 oM = vec2 ( 2.0 , 2.0 ) * oL . xz + oL . yw ; nD ( bvec2 ( step ( 0.9 , oF . zw ) ) , oM , vec2 ( 0 , 0 ) ) ; oE += oy ( oA , oF . xy , oM , oD . w ) . gr ; } return oE ; }".split(" ")}]}}]},
{type:"textline",b:"float oT ( sampler2D oO , vec2 oP , float oQ ) { vec2 oR = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 oS = SMAA_SEARCHTEX_SIZE * vec2 ( oQ , 1.0 ) ; oR += vec2 ( - 1.0 , 1.0 ) ; oS += vec2 ( 0.5 , - 0.5 ) ; oR *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; oS *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( oO , oR * oP + oS , 0.0 ) . r ; } float pa ( sampler2D oU , sampler2D oV , vec2 oW , float oX ) { vec2 oY = vec2 ( 0.0 , 1.0 ) ; for ( int oZ = 0 ; oZ < SMAA_MAX_SEARCH_STEPS ; oZ ++ ) { if ( oW . x > oX && oY . g > 0.8281 && oY . r == 0.0 ) { oY = texture2D ( oU , oW , 0.0 ) . rg ; oW = - vec2 ( 2.0 , 0.0 ) * u_texel_size + oW ; } } float o_ = - ( 255.0 / 127.0 ) * oT ( oV , oY , 0.0 ) + 3.25 ; return u_texel_size . x * o_ + oW . x ; } float pi ( sampler2D pb , sampler2D pc , vec2 pd , float pe ) { vec2 pf = vec2 ( 0.0 , 1.0 ) ; for ( int pg = 0 ; pg < SMAA_MAX_SEARCH_STEPS ; pg ++ ) { if ( pd . x < pe && pf . g > 0.8281 && pf . r == 0.0 ) { pf = texture2D ( pb , pd , 0.0 ) . rg ; pd = vec2 ( 2.0 , 0.0 ) * u_texel_size + pd ; } } float ph = - ( 255.0 / 127.0 ) * oT ( pc , pf , 0.5 ) + 3.25 ; return - u_texel_size . x * ph + pd . x ; } float pq ( sampler2D pj , sampler2D pk , vec2 pl , float pm ) { vec2 pn = vec2 ( 1.0 , 0.0 ) ; for ( int po = 0 ; po < SMAA_MAX_SEARCH_STEPS ; po ++ ) { if ( pl . y > pm && pn . r > 0.8281 && pn . g == 0.0 ) { pn = texture2D ( pj , pl , 0.0 ) . rg ; pl = - vec2 ( 0.0 , 2.0 ) * u_texel_size + pl ; } } float pp = - ( 255.0 / 127.0 ) * oT ( pk , pn . gr , 0.0 ) + 3.25 ; return u_texel_size . y * pp + pl . y ; } float py ( sampler2D pr , sampler2D ps , vec2 pt , float pu ) { vec2 pv = vec2 ( 1.0 , 0.0 ) ; for ( int pw = 0 ; pw < SMAA_MAX_SEARCH_STEPS ; pw ++ ) { if ( pt . y < pu && pv . r > 0.8281 && pv . g == 0.0 ) { pv = texture2D ( pr , pt , 0.0 ) . rg ; pt = vec2 ( 0.0 , 2.0 ) * u_texel_size + pt ; } } float px = - ( 255.0 / 127.0 ) * oT ( ps , pv . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * px + pt . y ; } vec2 pF ( sampler2D pz , vec2 pA , float pB , float pC , float pD ) { vec2 pE = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * nI ( 4.0 * vec2 ( pB , pC ) ) + pA ; pE = SMAA_AREATEX_PIXEL_SIZE * pE + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; pE . y = SMAA_AREATEX_SUBTEX_SIZE * pD + pE . y ; return texture2D ( pz , pE , 0.0 ) . rg ; } void pN ( sampler2D pG , inout vec2 pH , vec4 pI , vec2 pJ ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pK = step ( pJ . xy , pJ . yx ) ; vec2 pL = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pK ; pL /= pK . x + pK . y ; vec2 pM = vec2 ( 1.0 , 1.0 ) ; pM . x -= pL . x * texture2D ( pG , pI . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; pM . x -= pL . y * texture2D ( pG , pI . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; pM . y -= pL . x * texture2D ( pG , pI . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; pM . y -= pL . y * texture2D ( pG , pI . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; pH *= clamp ( pM , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void pV ( sampler2D pO , inout vec2 pP , vec4 pQ , vec2 pR ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pS = step ( pR . xy , pR . yx ) ; vec2 pT = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pS ; pT /= pS . x + pS . y ; vec2 pU = vec2 ( 1.0 , 1.0 ) ; pU . x -= pT . x * texture2D ( pO , pQ . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; pU . x -= pT . y * texture2D ( pO , pQ . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; pU . y -= pT . x * texture2D ( pO , pQ . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; pU . y -= pT . y * texture2D ( pO , pQ . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; pP *= clamp ( pU , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qn ( vec2 pW , vec2 pX , sampler2D pY , sampler2D pZ , sampler2D p_ , vec4 qa ) { vec4 qb = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 qc = texture2D ( pY , pW ) . rg ; if ( qc . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"qb . rg = oN ( pY , pZ , pW , qc , qa ) ; if ( qb . r == - qb . g ) {".split(" ")}]}}]},
{type:"textline",b:"vec2 qd ; vec3 qe ; qe . x = pa ( pY , p_ , nk . xy , nm . x ) ; qe . y = nl . y ; qd . x = qe . x ; float qf = texture2D ( pY , qe . xy , 0.0 ) . r ; qe . z = pi ( pY , p_ , nk . zw , nm . y ) ; qd . y = qe . z ; qd = abs ( nI ( qd / u_texel_size . xx - pX . xx ) ) ; vec2 qg = sqrt ( qd ) ; float qh = texture2D ( pY , qe . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; qb . rg = pF ( pZ , qg , qf , qh , qa . y ) ; qe . y = pW . y ; pN ( pY , qb . rg , qe . xyzy , qd ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else qc . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( qc . r > 0.0 ) { vec2 qi ; vec3 qj ; qj . y = pq ( pY , p_ , nl . xy , nm . z ) ; qj . x = nk . x ; qi . x = qj . y ; float qk = texture2D ( pY , qj . xy , 0.0 ) . g ; qj . z = py ( pY , p_ , nl . zw , nm . w ) ; qi . y = qj . z ; qi = abs ( nI ( qi / u_texel_size . yy - pX . yy ) ) ; vec2 ql = sqrt ( qi ) ; float qm = texture2D ( pY , qj . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; qb . ba = pF ( pZ , ql , qk , qm , qa . x ) ; qj . x = pW . x ; pV ( pY , qb . ba , qj . xyxz , qi ) ; } return qb ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qE ( vec2 qo , sampler2D qp , sampler2D qq".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qr"]}]}}]},{type:"textline",b:") { vec4 qs ; qs . x = texture2D ( qq , nj . xy ) . a ; qs . y = texture2D ( qq , nj . zw ) . g ; qs . wz = texture2D ( qq , qo ) . xz ; if ( dot ( qs , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 qt = texture2D ( qp , qo , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qu = texture2D ( qr , a ) ; vec2 qv = 2.0 * cE ( qu ) - 1.0 ; qt . a = sqrt ( 2.0 * length ( qv ) ) ;".split(" ")}]}}]},{type:"textline",b:"return qt ; } else { bool qw = max ( qs . x , qs . z ) > max ( qs . y , qs . w ) ; vec4 qx = vec4 ( 0.0 , qs . y , 0.0 , qs . w ) ; vec2 qy = qs . yw ; nD ( bvec4 ( qw , qw , qw , qw ) , qx , vec4 ( qs . x , 0.0 , qs . z , 0.0 ) ) ; nD ( bvec2 ( qw , qw ) , qy , qs . xz ) ; qy /= dot ( qy , vec2 ( 1.0 , 1.0 ) ) ; vec4 qz = qx * vec4 ( u_texel_size , - u_texel_size ) + qo . xyxy ; vec4 qA = qy . x * texture2D ( qp , qz . xy , 0.0 ) ; qA += qy . y * texture2D ( qp , qz . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qB = texture2D ( qr , qz . xy ) ; vec2 qC = 2.0 * cE ( qB ) - 1.0 ; vec2 qD = qy . x * qC ; qB = texture2D ( qr , qz . zw ) ; qC = 2.0 * cE ( qB ) - 1.0 ; qD += qy . y * qC ; qA . a = sqrt ( 2.0 * length ( qD ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","qA",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qQ ( vec2 qF , sampler2D qG , sampler2D qH".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qI"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qJ = texture2D ( qI , a ) ; vec2 qK ; qK = 2.0 * cE ( qJ ) - 1.0 ; vec4 qL = texture2D ( qG , qF ) ; vec4 qM = texture2D ( qH , qF - qK ) ; float qN = abs ( qL . a * qL . a - qM . a * qM . a ) / 2.0 ; float qO = 0.5 * clamp ( 1.0 - sqrt ( qN ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 qP = mix ( qL , qM , qO ) ; qP . a = 1.0 ; return qP ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qL = texture2D ( qG , qF ) ; vec4 qM = texture2D ( qH , qF ) ; return mix ( qL , qM , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qR = vec4 ( n_ ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qR = qn ( a , nn , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qR = qE ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qR = vec4 ( qQ ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qR = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","qR",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","nj",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nk ; varying vec4 nl ; varying vec4 nm ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nn",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void lv ( vec2 lu ) { nk = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + lu . xyxy ; nl = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + lu . xyxy ; nm = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + lu . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void ly ( vec2 lw , out vec2 lx ) { lx = lw / u_texel_size ; nk = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + lw . xyxy ; nl = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + lw . xyxy ; nm = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( nk . xz , nl . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void lA ( vec2 lz ) { nj = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + lz . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = a_bb_vertex + 0.5 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["lv","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"ly ( a , nn ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["lA","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},{type:"define",
name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float np ( in vec2 no ) { return ne ( u_depth , no , u_camera_range ) ; } void main ( ) { float nq = texture2D ( u_color , a ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( nq , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"vec3 nr = normalize ( 2.0 * texture2D ( u_ssao_special_tex , a * 0.25 / u_texel_size ) . rgb - 1.0 ) ; float ns = np ( a ) ; float nt = ns * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_8"],group:{type:"group",a:[{type:"textline",b:"const float nu = 8.0 ; const int nv = 1 ;".split(" ")}]}},
{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"const float nu = 16.0 ; const int nv = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_24"],group:{type:"group",a:[{type:"textline",b:"const float nu = 24.0 ; const int nv = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"const float nu = 32.0 ; const int nv = 4 ;".split(" ")}]}}]},{type:"textline",b:"float nw = u_ssao_radius_increase * 0.001 ; const float nx = 1.0 + 2.4 / nu ; float ny = 0.0 ; for ( int nz = 0 ; nz < nv ; nz ++ ) for ( int nA = - 1 ; nA <= 1 ; nA += 2 ) for ( int nB = - 1 ; nB <= 1 ; nB += 2 ) for ( int nC = - 1 ; nC <= 1 ; nC += 2 ) { vec3 nD = reflect ( normalize ( vec3 ( nA , nB , nC ) ) , nr ) * ( nw *= nx ) ; vec3 nE = vec3 ( a , nt ) ; nE += vec3 ( nD . xy , nD . z * nt * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nE . z -= 1.4 * ( nE . z - nt ) * step ( nt , nE . z ) ;".split(" ")}]}}]},{type:"textline",b:"float nF = np ( nE . xy ) * ( u_camera_range . y - u_camera_range . x ) ; float nG = clamp ( ( nt - nF ) / nF , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"ny += mix ( 1.0 , nG , step ( nF , nE . z ) ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"ny += mix ( step ( nE . z , nF ) , 0.5 , nG ) ;".split(" ")}]}}]},{type:"textline",b:"} ny = ny / nu ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"ny = clamp ( ny * ny + 0.6 * ny , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ny = clamp ( ny * ny + ny , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"float nH = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * ns ) ; ny = mix ( 1.0 , ny , nH ) ; gl_FragColor = vec4 ( nq , ny , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float np ( in vec2 no ) { return ne ( u_depth , no , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float nq = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nr = np ( a ) ; float ns = 0.0 ; float nt = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"vec2 nu = vec2 ( - 2.0 ) ; for ( int nv = 0 ; nv < 4 ; ++ nv ) { for ( int nw = 0 ; nw < 4 ; ++ nw ) { vec2 nx = ( nu + vec2 ( float ( nv ) , float ( nw ) ) ) * u_texel_size ; float ny = texture2D ( u_ssao_mask , a + nx ) . g ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nz = np ( a + nx ) ; float nA = 1.0 - clamp ( abs ( nz - nr ) * nt , 0.0 , 1.0 ) ; nq += ny * nA ; ns += nA ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nq","+=","ny",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nq / ns , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nq / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { float lu = texture2D ( u_depth , a ) . x ; vec4 lv = vec4 ( a * 2.0 - 1.0 , 2.0 * lu - 1.0 , 1.0 ) ; vec4 lw = u_view_proj_inverse * lv ; vec4 lx = lw / lw . w ; vec4 ly = u_view_proj_prev * lx ; ly /= ly . w ; vec2 lz = ( lv . xy - ly . xy ) / 4.0 + 0.5 ; lz = clamp ( lz , 0.0 , 1.0 ) ; gl_FragColor = cs ( lz ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; float c = 1.0 ; struct d { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool g ( vec3 e , vec3 f ) { return any ( lessThan ( abs ( e - f ) , vec3 ( EPSILON ) ) ) ; } vec3 j ( in vec4 h , in vec3 i ) { return i + 2.0 * cross ( h . xyz , cross ( h . xyz , i ) + h . w * i ) ; } mat4 k ( ) { return mat4 ( c , b , b , b , b , c , b , b , b , b , c , b , b , b , b , c ) ; } mat4 m ( float l ) { return mat4 ( c , b , b , b , b , cos ( l ) , sin ( l ) , b , b , - sin ( l ) , cos ( l ) , b , b , b , b , c ) ; } mat4 o ( float n ) { return mat4 ( cos ( n ) , b , - sin ( n ) , b , b , c , b , b , sin ( n ) , b , cos ( n ) , b , b , b , b , c ) ; } mat4 q ( float p ) { return mat4 ( cos ( p ) , sin ( p ) , b , b , - sin ( p ) , cos ( p ) , b , b , b , b , c , b , b , b , b , c ) ; } d s ( in d r ) { return d ( r . a , r . b , normalize ( r . c ) , normalize ( r . d ) , normalize ( r . e ) , r . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 t = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 z ( vec3 u , mat4 v ) { vec3 w = vec3 ( v [ 0 ] [ 0 ] , v [ 1 ] [ 0 ] , v [ 2 ] [ 0 ] ) ; vec3 x = vec3 ( v [ 0 ] [ 1 ] , v [ 1 ] [ 1 ] , v [ 2 ] [ 1 ] ) ; vec3 y = vec3 ( v [ 0 ] [ 2 ] , v [ 1 ] [ 2 ] , v [ 2 ] [ 2 ] ) ; x = cross ( y , w ) ; return mat4 ( vec4 ( w , 0.0 ) , vec4 ( x , 0.0 ) , vec4 ( y , 0.0 ) , vec4 ( u , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 F ( vec3 A , vec3 B ) { vec3 C = A - B ; C . y = 0.0 ; C = normalize ( C ) ; vec3 D = normalize ( cross ( t , C ) ) ; vec3 E = normalize ( cross ( C , D ) ) ; return mat4 ( vec4 ( D , 0.0 ) , vec4 ( E , 0.0 ) , vec4 ( C , 0.0 ) , vec4 ( B , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 Q ( in vec3 G , float H , float I , float J , vec3 L ) { float M = fract ( length ( L ) / 0.17 ) ; float N = J + M / 10.0 ; float O = M ; if ( J != 0.0 ) O /= J ; G *= 1.0 + 0.5 * sin ( H ) ; float P = length ( G ) * I * sin ( 2.0 * 3.14 * H * N + O ) ; return q ( P ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 aa ( in vec3 R , in vec3 S , in mat4 T ) {".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 U = z ( S , T ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"float V = fract ( ( S . x * 1.43 + S . y * 0.123 + S . z * 6.1 ) ) ; float W = 2.0 * M_PI * V ; vec3 X = normalize ( vec3 ( T [ 0 ] [ 2 ] , 0.0 , T [ 2 ] [ 2 ] ) ) ; float Y = acos ( X [ 2 ] ) ; if ( X [ 0 ] < 0.0 ) Y = 2.0 * M_PI - Y ; float Z = Y - W ; if ( Z < 0.0 ) Z = 2.0 * M_PI + Z ; float _ = W ; if ( Z <= MAX_BILLBOARD_ANGLE ) _ += Z ; else if ( Z <= M_PI - MAX_BILLBOARD_ANGLE ) _ += MAX_BILLBOARD_ANGLE * ( 2.0 * Z - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( Z <= M_PI + MAX_BILLBOARD_ANGLE ) _ += Z - M_PI ; else if ( Z <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) _ += MAX_BILLBOARD_ANGLE * ( 2.0 * Z - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else _ += Z - 2.0 * M_PI ; mat4 U = o ( _ ) ; U [ 3 ] = vec4 ( S , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 U = F ( R , S ) ;".split(" ")}]}}]},{type:"textline",b:["return","U",";","}"]},{type:"condition",a:[{type:"if",c:["BILLBOARD_PRES_GLOB_ORIENTATION"],group:{type:"group",a:[{type:"textline",b:"mat4 ag ( in vec3 ab , in vec3 ac , in mat4 ad , mat4 ae ) { mat4 af = aa ( ab , ac , ad ) ; ae [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; af *= ae ; return af ; }".split(" ")}]}}]},{type:"textline",b:"d an ( in vec3 ah , in vec3 ai , in vec3 aj , in vec3 ak , in vec3 al , in mat4 am ) { ah = ( am * vec4 ( ah , 1.0 ) ) . xyz ; ai = ( am * vec4 ( ai , 1.0 ) ) . xyz ; aj = ( am * vec4 ( aj , 0.0 ) ) . xyz ; ak = ( am * vec4 ( ak , 0.0 ) ) . xyz ; al = ( am * vec4 ( al , 0.0 ) ) . xyz ; return s ( d ( ah , ai , aj , ak , al , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};
a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 aq ( vec2 ao , vec3 ap ) { return ( ao + 0.5 ) * ap . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 az ( in vec4 ar , in vec4 as , in float at ) { float au = ar [ 0 ] * as [ 0 ] + ar [ 1 ] * as [ 1 ] + ar [ 2 ] * as [ 2 ] + ar [ 3 ] * as [ 3 ] ; if ( au < 0.0 ) { as *= - 1.0 ; au = - au ; } if ( abs ( au ) >= 1.0 ) return ar ; float av = acos ( au ) ; float aw = sqrt ( 1.0 - au * au ) ; if ( abs ( aw ) < 0.001 ) return vec4 ( ar * 0.5 + as * 0.5 ) ; float ax = sin ( ( 1.0 - at ) * av ) / aw ; float ay = sin ( at * av ) / aw ; return ar * ax + as * ay ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aO ( in vec3 aA , in vec4 aB , in vec4 aC , in vec4 aD , in vec4 aE , in float aF ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aG = az ( aB , aC , aF ) ; vec4 aH = mix ( aD , aE , aF ) ; vec3 aI = j ( aG , aA ) ; vec3 aJ = aI * aH . w + aH . xyz ; return aJ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aK = j ( aB , aA ) ; vec3 aL = j ( aC , aA ) ; vec3 aM = aK * aD . w + aD . xyz ; vec3 aN = aL * aE . w + aE . xyz ; return mix ( aM , aN , aF ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aX ( in vec3 aP , in vec4 aQ , in vec4 aR , in float aS ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aT = az ( aQ , aR , aS ) ; vec3 aU = j ( aT , aP ) ; return aU ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aV = j ( aQ , aP ) ; vec3 aW = j ( aR , aP ) ; return mix ( aV , aW , aS ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 aO ( in vec3 aY , in vec4 aZ , in vec4 a_ ) { vec3 ba = j ( aZ , aY ) ; vec3 bb = ba * a_ . w + a_ . xyz ; return bb ; } vec3 aX ( in vec3 bc , in vec4 bd ) { vec3 be = j ( bd , bc ) ; return be ; }".split(" ")}]}}]},{type:"textline",b:"void bt ( inout vec3 bf , inout vec3 bg , inout vec3 bh , inout vec3 bi ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["float","bj","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { vec3 bk = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bl = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bm = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bn = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec4 bo = a_influence ; for ( int bp = 0 ; bp < 4 ; bp ++ ) { int bq = int ( bo [ bp ] ) ; float br = fract ( bo [ bp ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bk += br * aO ( bf , u_quatsb [ bq ] , u_quatsa [ bq ] , u_transb [ bq ] , u_transa [ bq ] , bj ) ; bl += br * aX ( bg , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ; bm += br * aX ( bh , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ; bn += br * aX ( bi , u_quatsb [ bq ] , u_quatsa [ bq ] , bj ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bk += br * aO ( bf , u_quatsb [ bq ] , u_transb [ bq ] ) ; bl += br * aX ( bg , u_quatsb [ bq ] ) ; bm += br * aX ( bh , u_quatsb [ bq ] ) ; bn += br * aX ( bi , u_quatsb [ bq ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} bf = bk ; bg = bl ; bh = bm ; bi = bn ; } if ( ! ( a_influence . y > 0.0 ) ) { int bs = int ( a_influence [ 0 ] - 1.0 ) ; if ( bs > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bf = aO ( bf , u_quatsb [ bs ] , u_quatsa [ bs ] , u_transb [ bs ] , u_transa [ bs ] , bj ) ; bg = aX ( bg , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ; bh = aX ( bh , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ; bi = aX ( bi , u_quatsb [ bs ] , u_quatsa [ bs ] , bj ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bf = aO ( bf , u_quatsb [ bs ] , u_transb [ bs ] ) ; bg = aX ( bg , u_quatsb [ bs ] ) ; bh = aX ( bh , u_quatsb [ bs ] ) ; bi = aX ( bi , u_quatsb [ bs ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bH ( inout vec3 bu , in vec3 bv , in float bw , in float bx , in float by , in vec3 bz , in float bA ) { float bB = length ( bv ) ; float bC = bx * ( 1.0 + 0.1 * fract ( bB ) ) ; float bD = bw * bA * ( 1.0 + sin ( 2.0 * 3.14 * by * bC + bB ) ) ; float bE = ( bu . y - bv . y ) * abs ( bD ) ; bE += 1.0 ; bE *= bE ; bE = bE * bE - bE ; vec3 bF = bu ; bF . xz += bz . xz * bE * sign ( bD ) ; float bG = length ( bu - bv ) ; bu = bv + normalize ( bF - bv ) * bG ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bJ ( vec4 bI ) { return bI * bI * ( 3.0 - 2.0 * bI ) ; } vec4 bL ( vec4 bK ) { return abs ( fract ( bK + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bN ( vec4 bM ) { return bJ ( bL ( bM ) ) ; } void cd ( inout vec3 bO , in float bP , in vec3 bQ , in vec3 bR , in vec3 bS , in float bT , in float bU , in float bV , in vec3 bW ) { float bX ; float bY ; float bZ ; vec2 b_ ; vec4 ca ; vec2 cb ; vec3 cc ; bX = dot ( bS , vec3 ( 1.0 ) ) ; bY = bX + bW . g ; bZ = dot ( bO , vec3 ( bW . g ) ) ; b_ = ( bP + vec2 ( bZ , bY ) ) ; ca = ( ( fract ( ( b_ . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bR ) * bT ; ca = bN ( ca ) ; cb = ca . xz + ca . yw ; cb . y = 0.5 - cb . y ; cc = cb . xyx * bW . rbr * vec3 ( bU * bQ . x , bV , bU * bQ . z ) ; bO += cc ; }".split(" ")}]}}]},
{type:"textline",b:"void ck ( inout vec3 ce , inout vec3 cf , in vec3 cg ) { vec3 ch = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vec3 ci = cf ; vec3 cj = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ci = ce ; vec3 cj = cf ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"cd ( ci , u_time , cg , ch , cj , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bH ( ci , cj , au_wind_bending_amp , au_wind_bending_freq , u_time , ch , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bH ( ci , cj , au_wind_bending_amp , au_wind_bending_freq , u_time , ch , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"ce += ci - cf ; cf = ci ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ce = ci ; cf = cj ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",
b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",
b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",b:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",b:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",b:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",b:["3.0"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float cl = 255.0 ; float cm = 0.0 ; float cn = 1.0 ; vec4 cs ( const in float co ) { vec4 cp = vec4 ( cl * cl * cl , cl * cl , cl , cn ) ; vec4 cq = vec4 ( cm , cn / cl , cn / cl , cn / cl ) ; vec4 cr = fract ( co * cp ) ; cr -= cr . xxyz * cq ; return cr ; } float cw ( const in vec4 ct ) { float cu ; vec4 cv = vec4 ( cn / ( cl * cl * cl ) , cn / ( cl * cl ) , cn / cl , cn ) ; cu = dot ( ct , cv ) ; return cu ; } vec4 cs ( const in vec2 cx ) { vec2 cy = vec2 ( cl , cn ) ; vec2 cz = vec2 ( cm , cn / cl ) ; vec4 cA = fract ( cx . xxyy * cy . xyxy ) ; cA -= cA . xxzz * cz . xyxy ; if ( cx . r == cn ) cA . rg = vec2 ( cm , cn ) ; if ( cx . g == cn ) cA . ba = vec2 ( cm , cn ) ; return cA ; } vec2 cE ( const in vec4 cB ) { vec2 cC ; vec2 cD = vec2 ( cn / cl , cn ) ; cC . r = dot ( cB . rg , cD ) ; cC . g = dot ( cB . ba , cD ) ; return cC ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"float cM = 0.0 ; float cN = 1.0 ; vec4 cP ( vec4 cO ) { return cO - floor ( cO * ( cN / 289.0 ) ) * 289.0 ; } vec3 cP ( vec3 cQ ) { return cQ - floor ( cQ * ( cN / 289.0 ) ) * 289.0 ; } vec2 cP ( vec2 cR ) { return cR - floor ( cR * ( cN / 289.0 ) ) * 289.0 ; } vec4 cT ( vec4 cS ) { return cS - floor ( cS * ( cN / 7.0 ) ) * 7.0 ; } vec4 cV ( vec4 cU ) { return cP ( ( 34.0 * cU + 5.0 ) * cU ) ; }".split(" ")},{type:"define",name:"K",
b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 dg ( vec2 cW ) { vec2 cX = cP ( floor ( cW ) ) ; vec2 cY = fract ( cW ) ; vec4 cZ = cY . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 c_ = cY . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 da = cV ( cX . x + vec4 ( cM , cN , cM , cN ) ) ; da = cV ( da + cX . y + vec4 ( cM , cM , cN , cN ) ) ; vec4 db = cT ( da ) * K + K2 ; vec4 dc = cT ( floor ( da * K ) ) * K + K2 ; vec4 dd = cZ + JITTER * db ; vec4 de = c_ + JITTER * dc ; vec4 df = dd * dd + de * de ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"df . xy = min ( df . xy , df . zw ) ; df . x = min ( df . x , df . y ) ; return df . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"df . xy = ( df . x < df . y ) ? df . xy : df . yx ; df . xz = ( df . x < df . z ) ? df . xz : df . zx ; df . xw = ( df . x < df . w ) ? df . xw : df . wx ; df . y = min ( df . y , df . z ) ; df . y = min ( df . y , df . w ) ; return sqrt ( df . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 dw ( vec2 dh , float di ) { vec2 dj = cP ( floor ( dh ) ) ; vec2 dk = fract ( dh ) ; vec4 dl = dk . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 dm = dk . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 dn = cV ( dj . x + vec4 ( cM , cN , cM , cN ) ) ; dn = cV ( dn + dj . y + vec4 ( cM , cM , cN , cN ) ) ; vec4 dp = cT ( dn ) * K + K2 ; vec4 dq = cT ( floor ( dn * K ) ) * K + K2 ; vec4 dr = dl + JITTER * dp ; vec4 ds = dm + JITTER * dq ; vec4 dt = dr * dr + ds * ds ; dr += di ; ds += di ; vec4 du = dr * dr + ds * ds ; dr += di ; ds += di ; vec4 dv = dr * dr + ds * ds ; dt . xy = min ( dt . xy , dt . zw ) ; dt . x = min ( dt . x , dt . y ) ; du . xy = min ( du . xy , du . zw ) ; du . x = min ( du . x , du . y ) ; dv . xy = min ( dv . xy , dv . zw ) ; dv . x = min ( dv . x , dv . y ) ; return mat3 ( dt . xx , cM , du . xx , cM , dv . xx , cM ) ; } vec3 dy ( vec3 dx ) { return cP ( ( ( dx * 34.0 ) + cN ) * dx ) ; } float dM ( vec2 dz ) { const vec4 dA = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 dB = floor ( dz + dot ( dz , dA . yy ) ) ; vec2 dC = dz - dB + dot ( dB , dA . xx ) ; vec2 dD ; dD = ( dC . x > dC . y ) ? vec2 ( cN , cM ) : vec2 ( cM , cN ) ; vec4 dE = dC . xyxy + dA . xxzz ; dE . xy -= dD ; dB = cP ( dB ) ; vec3 dF = dy ( dy ( dB . y + vec3 ( cM , dD . y , cN ) ) + dB . x + vec3 ( cM , dD . x , cN ) ) ; vec3 dG = max ( 0.5 - vec3 ( dot ( dC , dC ) , dot ( dE . xy , dE . xy ) , dot ( dE . zw , dE . zw ) ) , cM ) ; dG = dG * dG ; dG = dG * dG ; vec3 dH = 2.0 * fract ( dF * dA . www ) - cN ; vec3 dI = abs ( dH ) - 0.5 ; vec3 dJ = floor ( dH + 0.5 ) ; vec3 dK = dH - dJ ; dG *= 1.79284291400159 - 0.85373472095314 * ( dK * dK + dI * dI ) ; vec3 dL ; dL . x = dK . x * dC . x + dI . x * dC . y ; dL . yz = dK . yz * dE . xz + dI . yz * dE . yw ; return 130.0 * dot ( dG , dL ) ; } vec2 dS ( vec2 dN ) { float dO = dot ( dN , vec2 ( 12.9898 , 78.233 ) ) ; float dP = dot ( dN , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float dQ = fract ( sin ( dO ) * 43758.5453 ) * 2.0 - cN ; float dR = fract ( sin ( dP ) * 43758.5453 ) * 2.0 - cN ; return vec2 ( dQ , dR ) ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","dT",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"const float dU = 0.1 ; const float dV = 0.1 ; const float dW = - 0.01 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"const float dX = 0.05 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mat4 dY = mat4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 , 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 , - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 , - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; mat4 dZ = mat4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 , - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 , - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 , - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"bool eb ( vec2 d_ , float ea ) { return all ( lessThanEqual ( d_ , vec2 ( 1.0 + ea ) ) ) && all ( greaterThanEqual ( d_ , vec2 ( 0.0 - ea ) ) ) ; }".split(" ")}]}}]},{type:"textline",b:"float eo ( vec3 ec , sampler2D ed , float ee ) { float ef ; ec . z = clamp ( ec . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",
a:[{type:"textline",b:"ef = 0.0 ; float eg = dS ( ec . xy ) . x * M_PI ; float eh = cos ( eg ) ; float ei = sin ( eg ) ; mat2 ej = mat2 ( eh , ei , - ei , eh ) ; vec2 ek , el ; for ( int em = 0 ; em < 4 ; em ++ ) for ( int en = 0 ; en < 4 ; en ++ ) { el . x = dY [ em ] [ en ] ; el . y = dZ [ em ] [ en ] ; el = ej * el ; ek = ec . xy + el * ee / SHADOW_TEX_RES ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ! eb ( ek , dW ) ) ef += 1.0 ; else".split(" ")}]}}]},
{type:"textline",b:"ef += step ( ec . z , texture2D ( ed , ek ) . r ) ; } ef /= 16.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["ef","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( ef , 0.0 , 1.0 ) ; } float eG ( vec3 ep , sampler2D eq , vec3 er , sampler2D es , float et , float eu , float ev ) { float ew , ex ; ep . z = clamp ( ep . z , 0.0 , 1.0 ) ; er . z = clamp ( er . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],
group:{type:"group",a:[{type:"textline",b:"ew = 0.0 ; ex = 0.0 ; float ey = dS ( ep . xy ) . x * M_PI ; float ez = cos ( ey ) ; float eA = sin ( ey ) ; mat2 eB = mat2 ( ez , eA , - eA , ez ) ; vec2 eC , eD ; for ( int eE = 0 ; eE < 4 ; eE ++ ) for ( int eF = 0 ; eF < 4 ; eF ++ ) { eD . x = dY [ eE ] [ eF ] ; eD . y = dZ [ eE ] [ eF ] ; eD = eB * eD ; eC = ep . xy + eD * et / SHADOW_TEX_RES ; ew += step ( ep . z , texture2D ( eq , eC ) . r ) ; eC = er . xy + eD * eu / SHADOW_TEX_RES ; ex += step ( er . z , texture2D ( es , eC ) . r ) ; } ew = mix ( ew , ex , ev ) ; ew /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["ew","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( ew , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"float eK ( vec2 eH ) { float eI = min ( eH . x , eH . y ) ; float eJ = min ( 1.0 - eH . x , 1.0 - eH . y ) ; return min ( eI , eJ ) ; } float eN ( float eL , float eM ) { if ( eM >= 0.0 && eM <= dV ) eL = ( eL - 1.0 ) / dV * eM + 1.0 ; return eL ; } float eZ ( vec3 eO , vec3 eP , sampler2D eQ , sampler2D eR , float eS , float eT , float eU , float eV ) { float eW ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"float eX = eK ( eO . xy ) ; if ( - eV > eU && eX >= 0.0 && eX <= dU && eb ( eP . xy , 0.0 ) ) { float eY = 1.0 - eX / dU ; eW = eG ( eO , eQ , eP , eR , eS , eT , eY ) ; } else".split(" ")}]}}]},{type:"textline",b:"eW = eo ( eO , eQ , eS ) ; return eW ; } float fg ( vec3 e_ , sampler2D fa , float fb , float fc , float fd ) { float fe = eo ( e_ , fa , fb ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - fd > fc ) { float ff = eK ( e_ . xy ) ; fe = eN ( fe , ff ) ; }".split(" ")}]}}]},{type:"textline",b:"return fe ; } float fn ( float fh ) { float fi = 1.0 ; vec3 fj = cG . xyz / cG . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"vec3 fk = cH . xyz / cH . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:"vec3 fl = cI . xyz / cI . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"vec3 fm = cJ . xyz / cJ . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( eb ( fj . xy , 0.0 ) ) { fi = eZ ( fj , fk , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , fh ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( eb ( fj . xy , dX ) ) { fi = fg ( fj , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , fh ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fk . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"fi = eZ ( fk , fl , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , fh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"fi = fg ( fk , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , fh ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fl . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"fi = eZ ( fl , fm , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , fh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"fi = fg ( fl , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , fh ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( eb ( fm . xy , 0.0 ) ) fi = fg ( fm , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , fh ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","fi",";","}"]}]}}]}]}}]},{type:"textline",b:"float fs ( inout vec3 fo ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 fp = texture2DProj ( u_shadow_mask , cK ) . rg ; vec3 fq = vec3 ( fp . r ) ; float fr = fp . g ; dT = vec4 ( fq , fr ) ; fo *= dT . a ; return dT . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return fn ( cL . z ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 fx ( vec3 ft , float fu , vec2 fv ) { vec2 fw = vec2 ( ( ft . x - fv . x ) / fu , - ( ft . z - fv . y ) / fu ) ; return fract ( fw ) ; } vec2 fB ( vec2 fy , float fz , vec2 fA ) { return vec2 ( fy . x * fz , - fy . y * fz ) + fA ; } d fC ( ) { return d ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } d gh ( vec3 fD , vec3 fE , vec3 fF , vec3 fG , vec3 fH , sampler2D fI , sampler2D fJ , vec3 fK , float fL , vec3 fM , vec4 fN , mat4 fO ) { vec3 fP = j ( fN , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float fQ = - fP . x ; float fR = - fP . z ; vec2 fS = vec2 ( fM . x + fL * ( - 1.0 - fQ ) / 2.0 , fM . z + fL * ( 1.0 - fR ) / 2.0 ) ; vec2 fT = fx ( fH , fL , fS ) ; float fU = fL / 2.0 ; vec2 fV = abs ( fB ( fT - vec2 ( 0.5 ) , fL , vec2 ( 0.0 ) ) ) ; float fW = fU * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( fV ) > fW ) return fC ( ) ; float fX = fL / fK . z ; vec2 fY = ( fT - vec2 ( 0.5 ) ) * fX + vec2 ( 0.5 ) ; vec3 fZ = fP * ( fL / fK . z - 1.0 ) / 2.0 ; fY . x += fZ . x ; fY . y -= fZ . z ; vec4 f_ = texture2D ( fJ , fY ) ; float ga = f_ . r ; if ( ga < u_scale_threshold ) return fC ( ) ; float gb = fK . y - fK . x ; float gc = fK . y - texture2D ( fI , fY ) . r * gb ; vec2 gd = fD . xz - fH . xz ; fH . xz = fB ( fT , fL , fS ) ; fH . y = gc ; fD . xz = fH . xz + gd ; fD . y *= ga ; fD . y += gc ; vec3 ge = f_ . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fD -= fH ; mat4 gf = aa ( fM , fH , fO ) ; d gg = an ( fD , fH , fE , fF , fG , gf ) ; gg . b = fH ; gg . f = ge ; return s ( gg ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return s ( d ( fD , fH , fE , fF , fG , ge ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"vec4 gn ( mat4 gi , vec4 gj ) { vec2 gk = ( gi * u_v_light_matrix [ 3 ] ) . xy ; float gl = SHADOW_TEX_RES / 2.0 ; gk = floor ( gk * gl + 0.5 ) / gl - gk ; vec4 gm = gi * gj ; gm . xy += gk ; gm = u_b_light_matrix * gm ; return gm ; } void gr ( vec3 go ) { vec3 gp = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ; vec4 gq = u_v_light_matrix * vec4 ( go + u_normal_offset * gp , 1.0 ) ; cG = gn ( u_p_light_matrix0 , gq ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cH = gn ( u_p_light_matrix1 , gq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cI = gn ( u_p_light_matrix2 , gq ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cJ = gn ( u_p_light_matrix3 , gq ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void gr ( vec4 gs ) { float gt = gs . x ; float gu = gs . y ; float gv = gs . w ; cK . x = ( gt + gv ) / 2.0 ; cK . y = ( gu + gv ) / 2.0 ; cK . z = gv ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void gy ( inout vec3 gx ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"gx = max ( vec3 ( 0.0 ) , gx ) ; gx = pow ( gx , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gA ( inout vec3 gz ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"gz = max ( vec3 ( 0.0 ) , gz ) ; gz = pow ( gz , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gD ( inout vec3 gB , in float gC ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"gB = gB * gC ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void gL ( inout vec3 gG , in float gH , in vec4 gI ) { float gJ = gI . w * gH ; float gK = exp ( - gJ * gJ ) ; gK = clamp ( gK , 0.0 , 1.0 ) ; gG = mix ( gI . rgb , gG , gK ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 gS ( in mat4 gM , in vec3 gN ) { vec3 gO = mix ( gM [ 0 ] . rgb , gM [ 1 ] . rgb , max ( sign ( gN . x ) , 0.0 ) ) ; vec3 gP = mix ( gM [ 2 ] . rgb , gM [ 3 ] . rgb , max ( sign ( gN . z ) , 0.0 ) ) ; vec3 gQ = vec3 ( gM [ 0 ] . a , gM [ 1 ] . a , gM [ 2 ] . a ) ; vec3 gR = mix ( gO , gP , abs ( gN . z ) ) ; gR = mix ( gR , gQ , abs ( gN . y ) ) ; return gR ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void gU ( inout float gT ) { gT -= 0.5 ; gT = 4.0 * ( gT * gT * gT ) + 0.5 ; } void hk ( inout vec3 gV , in float gW , in vec3 gX , in float gY , in vec4 gZ , in vec4 g_ , in float ha , in float hb ) { float hc = g_ . w * gW ; float hd = exp ( - hc * hc ) ; hd = clamp ( hd , 0.0 , 1.0 ) ; float he = max ( gX . y , 0.0 ) ; gW = max ( gW - max ( gY / he , 0.0 ) , 0.0 ) ; float hf = gZ . w * gW ; float hg = 1.0 - hf ; hg = max ( hg , 0.0 ) ; gU ( hg ) ; hg += max ( ha - 0.5 , 0.0 ) ; if ( hg < hd ) { vec3 hh = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 hi = gZ . rgb ; gY = clamp ( - gY * 0.03 , 0.0 , 0.8 ) ; vec3 hj = mix ( hi , hh , min ( he , 1.0 ) ) ; hj = mix ( hj , vec3 ( 0.0 ) , gY ) * hb ; gV = mix ( hj , gV , hg ) ; } if ( hg >= hd ) { gV = mix ( g_ . rgb , gV , hd ) ; } } void ht ( inout vec3 hl , in float hm , in float hn , in vec4 ho , in float hp ) { float hq = ho . w * hm ; float hr = 1.0 - hq ; hr = clamp ( hr , 0.0 , 1.0 ) ; gU ( hr ) ; hn = clamp ( - hn * 0.03 , 0.0 , 0.8 ) ; vec3 hs = mix ( ho . rgb , vec3 ( 0.0 ) , hn ) * hp ; hl = mix ( hs , hl , hr ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"float hu = 0.0 ; float hv = 1.0 ; struct hw { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float hE ( vec3 hx , vec3 hy , vec3 hz , vec4 hA , float hB ) { vec3 hC = normalize ( hx + hy ) ; float hD = hA [ 0 ] * max ( dot ( hz , hC ) , hu ) + hA [ 1 ] ; return pow ( hD , hB ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hP ( vec3 hF , vec3 hG , vec3 hH , float hI ) { vec3 hJ = normalize ( hF + hG ) ; float hK = max ( dot ( hH , hJ ) , 0.001 ) ; float hL = max ( dot ( hH , hG ) , 0.01 ) ; float hM = max ( dot ( hH , hF ) , 0.01 ) ; float hN = tan ( acos ( hK ) ) ; float hO = max ( hI , 0.001 ) ; return hM * ( hv / ( 4.0 * M_PI * hO * hO ) ) * ( exp ( - ( hN * hN ) / ( hO * hO ) ) / ( sqrt ( hL * hM ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hX ( vec3 hQ , vec3 hR , vec3 hS , float hT , float hU ) { vec3 hV = normalize ( hQ + hR ) ; float hW = acos ( dot ( hV , hS ) ) ; if ( hW < hT ) return hv ; else if ( hW >= hT + hU || hU == hu ) return hu ; else return hv - ( hW - hT ) / hU ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void is ( float hY , vec3 hZ , vec3 h_ , vec3 ia , float ib , inout float ic ) { if ( ib > hu ) { float id = max ( dot ( hZ , ia ) , hu ) ; float ie = ib * ib ; float ig = hv - 0.5 * ( ie / ( ie + 0.33 ) ) ; vec3 ih = h_ - hY * hZ ; vec3 ii = ia - id * hZ ; if ( length ( ih ) == hu || length ( ii ) == hu || abs ( hY ) > hv || abs ( id ) > hv ) ic = ic * ig ; else { float ij = acos ( hY ) ; float ik = acos ( id ) ; vec3 il = normalize ( ih ) ; vec3 im = normalize ( ii ) ; float io , ip ; io = max ( ij , ik ) ; ip = min ( ij , ik ) ; ip *= 0.95 ; float iq = max ( dot ( il , im ) , hu ) ; float ir = 0.45 * ( ie / ( ie + 0.09 ) ) ; ic = ic * ( ig + ( ir * iq * sin ( io ) * tan ( ip ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void iz ( vec3 it , vec3 iu , float iv , float iw , out float ix ) { float iy ; if ( iv == hu ) { ix = hv ; } else { iy = hv + abs ( dot ( iu , it ) ) ; iy = iw + ( hv - iw ) * pow ( iy , iv ) ; ix = clamp ( iy , hu , hv ) ; } }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS","&&","NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"void jg ( inout hw iA , vec3 iB , vec3 iC , vec3 iD , vec3 iE , vec3 iF , vec2 iG , vec2 iH , float iI , vec3 iJ , vec3 iK , vec3 iL , vec4 iM , vec4 iN , float iO , vec4 iP ) { if ( iM . w + iN . w == hu ) return ; vec3 iQ = vec3 ( hu ) ; vec3 iR = iL * iI ; float iS = iN . z ; if ( iS != - hv ) { iQ = iJ - iD ; float iT = length ( iQ ) ; iR *= iS / ( iS + iT * iT ) ; iQ = normalize ( iQ ) ; float iU = iN . x ; float iV = iN . y ; if ( iU > - hv ) { float iW = dot ( iQ , iK ) ; iW *= smoothstep ( hu , hv , ( iW - iU ) / iV ) ; iR *= iW ; } } else iQ = iK ; float iX = hu ; if ( iM . w != hu ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"iz ( iE , iQ , iH [ 0 ] , iH [ 1 ] , iX ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float iY = max ( dot ( iE , iQ ) , hu ) ; iX = iM [ 0 ] * iY + iM [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"is ( iY , iE , iQ , iF , iH [ 0 ] , iX ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float iZ = hu ; if ( iN . w != hu ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"iZ = hE ( iQ , iF , iE , iM , iG [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"iZ = hP ( iQ , iF , iE , iG [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"iZ = hX ( iQ , iF , iE , iG [ 0 ] , iG [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["iZ","=","hu",";"]}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( iQ , iE ) * dot ( iF , iE ) < hu ) { float i_ = iP . x ; float ja = iP . y ; float jb = iP . z ; float jc = iP . w ; float jd = clamp ( abs ( dot ( iQ , iE ) ) , hu , hv ) ; float je = clamp ( dot ( iF , - iQ ) , hu , hv ) ; float jf = pow ( je , ja ) ; iA . a += iO * vec4 ( iR * jd * pow ( iB , vec3 ( i_ ) ) , hv ) ; iA . a += jb * mix ( vec4 ( iB , hv ) , vec4 ( hv ) , jc ) * iO * vec4 ( iR * jd * vec3 ( jf ) , hv ) ; } else { iA . b += iR * iC * iZ ; iA . a += vec4 ( iR * iB * iX , iZ ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"iA . b += iR * iC * iZ ; iA . a += vec4 ( iR * iB * iX , iZ ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hw jY ( vec3 jh , vec3 ji , vec3 jj , vec3 jk , vec3 jl , vec3 jm , vec3 jn , vec2 jo , vec2 jp , float jq , vec3 jr [ NUM_LIGHTS ] , vec3 js [ NUM_LIGHTS ] , vec3 jt [ NUM_LIGHTS ] , vec4 ju [ NUM_LIGHTS ] , vec4 jv [ NUM_LIGHTS ] , float jw , vec4 jx , int jy ) { hw jz ; jz . a = vec4 ( jh + jj * ji , hu ) ; jz . b = vec3 ( hu ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"textline",b:"float jA = hv ; if ( jy == 0 ) jA = jq ; jg ( jz , jj , jk , jl , jm , jn , jo , jp , jA , jr [ 0 ] , js [ 0 ] , jt [ 0 ] , ju [ 0 ] , jv [ 0 ] , jw , jx ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","1"],group:{type:"group",a:[{type:"textline",b:"float jB = hv ; if ( jy == 1 ) jB = jq ; jg ( jz , jj , jk , jl , jm , jn , jo , jp , jB , jr [ 1 ] , js [ 1 ] , jt [ 1 ] , ju [ 1 ] , jv [ 1 ] , jw , jx ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","2"],group:{type:"group",a:[{type:"textline",b:"float jC = hv ; if ( jy == 2 ) jC = jq ; jg ( jz , jj , jk , jl , jm , jn , jo , jp , jC , jr [ 2 ] , js [ 2 ] , jt [ 2 ] , ju [ 2 ] , jv [ 2 ] , jw , jx ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","3"],group:{type:"group",a:[{type:"textline",b:"float jD = hv ; if ( jy == 3 ) jD = jq ; jg ( jz , jj , jk , jl , jm , jn , jo , jp , jD , jr [ 3 ] , js [ 3 ] , jt [ 3 ] , ju [ 3 ] , jv [ 3 ] , jw , jx ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int jE = 0 ; jE < NUM_LIGHTS ; jE ++ ) { vec4 jF = ju [ jE ] ; vec4 jG = jv [ jE ] ; if ( jF . w + jG . w != hu ) { vec3 jH = vec3 ( hu ) ; vec3 jI = jt [ jE ] ; if ( jE == jy ) jI *= jq ; float jJ = jG . z ; if ( jJ != - hv ) { jH = jr [ jE ] - jl ; float jK = length ( jH ) ; jI *= jJ / ( jJ + jK * jK ) ; jH = normalize ( jH ) ; float jL = jG . x ; float jM = jG . y ; if ( jL > - hv ) { float jN = dot ( jH , js [ jE ] ) ; jN *= smoothstep ( hu , hv , ( jN - jL ) / jM ) ; jI *= jN ; } } else jH = js [ jE ] ; float jO = hu ; if ( jF . w != hu ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"iz ( jm , jH , jp [ 0 ] , jp [ 1 ] , jO ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float jP = max ( dot ( jm , jH ) , hu ) ; jO = jF [ 0 ] * jP + jF [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"is ( jP , jm , jH , jn , jp [ 0 ] , jO ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float jQ = hu ; if ( jG . w != hu ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"jQ = hE ( jH , jn , jm , jF , jo [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"jQ = hP ( jH , jn , jm , jo [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"jQ = hX ( jH , jn , jm , jo [ 0 ] , jo [ 1 ] ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_B4W_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( jH , jm ) * dot ( jn , jm ) < hu ) { float jR = jx . x ; float jS = jx . y ; float jT = jx . z ; float jU = jx . w ; float jV = clamp ( abs ( dot ( jH , jm ) ) , hu , hv ) ; float jW = clamp ( dot ( jn , - jH ) , hu , hv ) ; float jX = pow ( jW , jS ) ; jz . a += jw * vec4 ( jI * jV * pow ( jj , vec3 ( jR ) ) , hv ) ; jz . a += jT * mix ( vec4 ( jj , hv ) , vec4 ( hv ) , jU ) * jw * vec4 ( jI * jV * vec3 ( jX ) , hv ) ; } else { jz . b += jI * jk * jQ ; jz . a += vec4 ( jI * jj * jO , jQ ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"jz . b += jI * jk * jQ ; jz . a += vec4 ( jI * jj * jO , jQ ) ;".split(" ")}]}}]},{type:"textline",b:["}","}"]}]}}]},{type:"textline",b:["return","jz",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hw kc ( vec3 jZ , vec3 j_ , vec3 ka ) { hw kb ; kb . a = vec4 ( jZ + ka * j_ , hu ) ; kb . b = vec3 ( hu ) ; return kb ; }".split(" ")}]}}]}]};a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2",
"(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void kD ( inout vec3 kd , float ke , float kf , float kg , vec3 kh , vec3 ki , vec3 kj , vec4 kk , vec3 kl , float km ) { if ( km > CAUSTICS_VIEW_DISTANCE ) return ; vec4 kn = kk ; vec3 ko = kl + kh ; ko . xz = 10.0 * sin ( 0.1 * ko . xz ) ; vec3 kp = ko + 2.0 * cross ( - kn . xyz , cross ( - kn . xyz , ko ) + kn . w * ko ) ; vec2 kq = kp . xz ; vec3 kr = ki ; float ks = max ( dot ( kh , kr ) , 0.0 ) ; float kt = 0.025 ; kq . s += 0.5 * sin ( dot ( kl + kf , vec3 ( 1.0 ) ) ) ; kq . t += 0.7 * ( - sin ( dot ( kl - kf , vec3 ( - 0.7 ) ) ) ) ; kq . st += 0.23 * cos ( 4.0 * ke - CAUST_SPEED . x * kf ) ; kq . st += 3.0 * sin ( ke - 0.3 * CAUST_SPEED . y * kf ) ; float ku = CAUST_SCALE * ( 1.0 + max ( 0.1 * ke , 0.0 ) ) ; mat3 kv = dw ( ( kq / ku ) , kt ) ; float kw = ( kv * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; float kx = ( kv * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; float ky = ( kv * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; vec3 kz = CAUST_BRIGHT * vec3 ( kw , kx , ky ) ; float kA = kg * ks ; float kB = max ( sign ( ke ) , 0.0 ) ; kA = min ( kA + 0.5 * sign ( - kh . y ) * kB , 1.0 ) ; kA *= 1.0 - kB * ( 0.1 * ke ) ; kz *= kA ; kz *= kz ; float kC = min ( - ke + 10.0 , 1.0 ) ; kd += max ( ( 2.0 * kj * kz ) * kC , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float kR ( in vec3 kK , in vec3 kL , in float kM , in float kN ) { vec3 kO = normalize ( kL + kK ) ; float kP = 1.0 - dot ( kK , kO ) ; float kQ = kN + ( 1.0 - kN ) * pow ( kP , kM ) ; return kQ ; } void lf ( inout vec3 kS , in vec3 kT , in vec3 kU , in float kV , in float kW , in float kX ) { vec3 kY = reflect ( - kT , kU ) ; float kZ = 1.0 ; if ( kV != 0.0 ) kZ = kR ( kT , kY , kV , kW ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 k_ = u_refl_plane . xyz * dot ( kU , u_refl_plane . xyz ) ; vec3 la = kU - k_ ; vec2 lb = ( u_view_matrix_frag * vec4 ( la , 0.0 ) ) . xy ; vec2 lc = cK . xy / cK . z ; lc += lb * REFL_BUMP ; vec3 ld = texture2D ( u_reflectmap , lc ) . rgb ; gy ( ld . rgb ) ; kS = mix ( kS , ld , kX * kZ ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"vec3 le = textureCube ( u_mirrormap , kY ) . xyz ; gy ( le . rgb ) ; kS = mix ( kS , le , u_mirror_factor * kZ ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float ll ( in float lg , inout vec2 lh , in vec2 li ) { vec4 lj = texture2D ( u_scene_depth , lh ) ; float lk = cw ( lj ) ; if ( lk < kJ ) { lh = li ; return lg ; } else { return lk ; } return lg ; } vec3 lt ( in vec3 lm , in vec2 ln ) { vec2 lo = lm . xy / lm . z ; vec2 lp = lo + ln ; vec4 lq = texture2DProj ( u_scene_depth , lm ) ; float lr = cw ( lq ) ; ll ( lr , lp , lo ) ; vec3 ls = texture2D ( u_refractmap , lp ) . rgb ; gy ( ls ) ; return ls ; }".split(" ")}]}}]}]};
a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct mb { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mi ( inout float mc , float md , vec2 me , vec2 mf ) { float mg = mf . x - me . x ; float mh = ( md - me . x ) / mg ; mc = mix ( mc , mf . y , clamp ( mh , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mp ( inout vec3 mj , float mk , vec4 ml , vec4 mm ) { float mn = mm . x - ml . x ; float mo = ( mk - ml . x ) / mn ; mj = mix ( mj , mm . yzw , clamp ( mo , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float mw ( float mq , float mr , vec2 ms [ SIZE_RAMP_LENGTH ] ) { float mt = mq / mr ; float mu = ms [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mi ( mu , mt , ms [ 0 ] , ms [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mi ( mu , mt , ms [ 1 ] , ms [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mi ( mu , mt , ms [ 2 ] , ms [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mv = 1 ; mv < SIZE_RAMP_LENGTH ; mv ++ ) mi ( mu , mt , ms [ mv - 1 ] , ms [ mv ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mu",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 mD ( float mx , float my , vec4 mz [ COLOR_RAMP_LENGTH ] ) { float mA = mx / my ; vec3 mB = mz [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mp ( mB , mA , mz [ 0 ] , mz [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mp ( mB , mA , mz [ 1 ] , mz [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mp ( mB , mA , mz [ 2 ] , mz [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mC = 1 ; mC < COLOR_RAMP_LENGTH ; mC ++ ) mp ( mB , mA , mz [ mC - 1 ] , mz [ mC ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mB",";","}"]}]}}]},{type:"textline",b:"float mM ( float mE , float mF , float mG , float mH ) { float mI = max ( 0.01 , min ( mF , mG ) ) ; float mJ = max ( 0.01 , min ( mF , mH ) ) ; float mK = mF - mJ ; float mL = clamp ( mE / mI , 0.0 , 1.0 ) - step ( mK , mE ) * ( mE - mK ) / mJ ; return mL ; } mb mS ( ) { mb mN ; float mO ; if ( u_p_cyclic == 1 ) { mO = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( mO < 0.0 ) mO += u_p_length ; } if ( u_p_cyclic != 1 ) { mO = u_p_time - a_p_delay ; } if ( mO < 0.0 || mO >= a_p_lifetime ) { mN . a = 0.0001 ; mN . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( mO < 0.0 || mO >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["WORLD_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mP = a_position ; vec3 mQ = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mP = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 mQ = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",b:"mP += u_p_nfactor * mO * mQ ; mP += a_p_vels . xyz * mO ; mP . y -= u_p_gravity * mO * mO / 2.0 ; float mR = max ( u_p_mass , EPSILON ) ; mP += ( u_p_wind / mR ) * mO * mO / 2.0 ; mN . b = mP ; mN . e = a_p_vels . w * mO ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mN . a = mw ( mO , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mN . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mN . d = mD ( mO , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mN . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"mN . c = mM ( mO , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return mN ; }".split(" ")}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float ne ( in sampler2D mY , in vec2 mZ , in vec2 m_ ) { float na = texture2D ( mY , mZ ) . r ; float nb = m_ . x ; float nc = m_ . y ; float nd = 2.0 * nb / ( nb + nc - ( 2.0 * na - 1.0 ) * ( nc - nb ) ) ; return nd ; }".split(" ")}]}};b4w.module.animation=function(a,p){var c=p("__animation"),b=p("__constraints");p("__physics");var e=p("__print"),d=p("__util");a.SLOT_0=c.SLOT_0;a.SLOT_1=c.SLOT_1;a.SLOT_2=c.SLOT_2;a.SLOT_3=c.SLOT_3;a.SLOT_4=c.SLOT_4;a.SLOT_5=c.SLOT_5;a.SLOT_6=c.SLOT_6;a.SLOT_7=c.SLOT_7;a.SLOT_ALL=c.SLOT_ALL;a.OBJ_ANIM_TYPE_ARMATURE=c.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=c.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=c.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=c.OBJ_ANIM_TYPE_SOUND;a.OBJ_ANIM_TYPE_PARTICLES=
c.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=c.OBJ_ANIM_TYPE_MATERIAL;a.OBJ_ANIM_TYPE_STATIC=c.OBJ_ANIM_TYPE_STATIC;a.AB_CYCLIC=c.AB_CYCLIC;a.AB_FINISH_RESET=c.AB_FINISH_RESET;a.AB_FINISH_STOP=c.AB_FINISH_STOP;var g=new Float32Array(4);a.is_animated=function(a){return c.is_animated(a)};a.get_actions=function(){for(var a=[],b=c.aw(),d=0;d<b.length;d++)a.push(c.az(b[d].name));return a};a.get_current_action=function(b,c){return a.get_current_anim_name(b,c)};a.get_anim_names=function(a){return c.sj(a)?
c.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.mw(a,b)};a.apply=function(a,b,d){if(d>c.SLOT_7)e.error("Can't apply animation to slot "+d+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{d=d||c.SLOT_0;if(c.is_animated(a)){var g=c.get_slot_num_by_anim(a,b);if(-1!=g&&g!=d){e.error('Animation "'+b+'" is already applied to object "'+a.name+'" (slot "'+g+'").');return}}c.apply(a,b,d)}};a.remove=function(a){c.remove(a)};
a.remove_slot_animation=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.remove_slot_animation(a,b))};a.apply_def=function(a){c.apply_def(a)};a.play=function(a,b,d){c.is_animated(a)?(d=d||c.SLOT_0,c.play(a,b,d),c.update_object_animation(a,0,d)):e.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,b){c.is_animated(a)&&(b=b||c.SLOT_0,c.stop(a,b))};a.is_play=function(a,b){if(!c.is_animated(a))return!1;b=b||c.SLOT_0;return c.is_play(a,b)};a.set_current_frame_float=function(b,c,d){a.set_frame(b,
c,d)};a.get_current_frame_float=function(b,c){return a.get_frame(b,c)};a.set_frame=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_current_frame_float(a,b,d),c.update_object_animation(a,0,d))};a.get_frame=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return c.get_current_frame_float(a,b)};a.set_speed=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_speed(a,b||1,d))};a.get_speed=function(a,b){if(!c.is_animated(a))return 0;b=b||c.SLOT_0;return c.get_speed(a,b)};a.get_frame_range=
function(a,b){if(c.is_animated(a)){b=b||c.SLOT_0;var d=a.C[b];if(d)return[d.start,d.start+d.length]}return null};a.get_anim_start_frame=function(a,b){return c.is_animated(a)?(b=b||c.SLOT_0,c.get_anim_start_frame(a,b)):-1};a.get_anim_length=function(a,b){return c.is_animated(a)?(b=b||c.SLOT_0,c.get_anim_length(a,b)):-1};a.cyclic=function(b,d,e){a.set_behavior(b,d?c.AB_CYCLIC:c.AB_FINISH_RESET,e)};a.is_cyclic=function(a,b){if(!c.is_animated(a))return!1;b=b||c.SLOT_0;return c.is_cyclic(a,b)};a.set_behavior=
function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.set_behavior(a,b,d))};a.get_behavior=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.get_behavior(a,b)};a.apply_smoothing=function(a,b,d,e){e=e||c.SLOT_0;c.is_animated(a)&&c.apply_smoothing(a,b,d,e)};a.update_object_animation=function(a,b,d){c.is_animated(a)&&(d=d||c.SLOT_0,c.update_object_animation(a,b||0,d))};a.frame_to_sec=function(a){return c.frame_to_sec(a)};a.get_bone_translation=function(a,c,e){if(!d.lf(a))return null;
e||(e=new Float32Array(3));b.gw(a,c,!1,g,null);e[0]=g[0];e[1]=g[1];e[2]=g[2];return e};a.get_first_armature_object=function(a){return d.is_mesh(a)?c.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,b){return c.is_animated(a)&&b?c.get_slot_num_by_anim(a,b):null};a.get_anim_name=function(a,b){if(!c.is_animated(a))return null;b=b||c.SLOT_0;return c.cw(a,b)};a.get_anim_type=function(a,b){return c.is_animated(a)?c.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,b){return c.apply_to_first_empty_slot(a,
b)};a.get_skel_mix_factor=function(a){return a.d.Ud};a.set_skel_mix_factor=function(a,b,g){d.lf(a)?(b=Math.min(Math.max(b,0),1),a.d.Ud!=b&&c.set_skel_mix_factor(a,b,g||0)):e.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.assets=function(a,p){var c=p("__assets");a.AT_ARRAYBUFFER=c.AT_ARRAYBUFFER;a.AT_JSON=c.AT_JSON;a.AT_TEXT=c.AT_TEXT;a.AT_AUDIOBUFFER=c.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=c.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=c.AT_AUDIO_ELEMENT;a.enqueue=function(a,e,d){c.enqueue(a,e,d)}};b4w.module.camera=function(a,p){function c(a,c){b.qb(a)?(m.copy(c,a.d.Ta),k.v(a),e.sync_transform(a)):d.error("set_pivot(): Wrong object or camera move style")}var b=p("__camera");p("__config");var e=p("__physics"),d=p("__print"),g=p("__constraints"),k=p("__transform"),f=p("__util"),m=p("vec3"),h=p("vec4"),r=p("quat"),n=p("mat3"),x=p("mat4"),v=new Float32Array(2),u=new Float32Array(3),E=new Float32Array(3),q=new Float32Array(4),D=new Float32Array(4),l=new Float32Array(4),z=new Float32Array(9);a.MS_STATIC=
b.MS_STATIC;a.MS_ANIMATION=b.MS_ANIMATION;a.MS_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.is_camera=function(a){return b.is_camera(a)};a.set_move_style=function(a,b){a.d.O=b};a.get_move_style=function(a){return b.is_camera(a)?b.get_move_style(a):(d.error("get_move_style(): Wrong object"),null)};a.set_velocity_params=function(a,c){if(!b.qb(a)&&!b.mf(a)&&!b.bb(a))return d.error("set_velocity_params(): Wrong object or camera move style"),
null;var e=a.d;e.Vm=c[0];e.Um=c[1];e.Wm=c[2]};a.get_velocity_params=function(a,c){if(!b.qb(a)&&!b.mf(a)&&!b.bb(a))return d.error("get_velocity_params(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));var e=a.d;c[0]=e.Vm;c[1]=e.Um;c[2]=e.Wm;return c};a.change_eye_target_dist=function(){d.error("change_eye_target_dist() deprecated")};a.set_look_at=function(a,c,d,f){var g=a.d;b.Bv(c,d,f,g.g,g.quat);k.v(a);e.sync_transform(a)};a.get_eye=function(a,c){if(b.is_camera(a))return c||(c=
new Float32Array(3)),m.copy(a.d.g,c),c;d.error("get_eye(): Wrong object")};a.set_pivot=c;a.set_trans_pivot=function(a,c,f){b.qb(a)?(m.copy(c,a.d.g),m.copy(f,a.d.Ta),k.v(a),e.sync_transform(a)):d.error("set_trans_pivot(): Wrong object or camera move style")};a.get_pivot=function(a,c){if(b.qb(a))return c||(c=new Float32Array(3)),m.copy(a.d.Ta,c),c;d.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(a,c,g){if(b.qb(a)){var h=a.d,l=b.get_angles(a,v);0<f.quat_to_dir(h.quat,
f.AXIS_Z,u)[1]&&(l[1]=f.sign(l[1])*Math.PI-l[1]);l=Math.abs(l[1]+g)%(2*Math.PI);h.bk=l>Math.PI/2&&l<3*Math.PI/2;u[0]=1;u[1]=0;u[2]=0;m.transformQuat(u,h.quat,u);r.setAxisAngle(u,g,q);u[0]=0;u[1]=1;u[2]=0;g=f.quat_to_dir(h.quat,f.AXIS_MY,E);.999999>Math.abs(m.dot(g,u))&&(r.setAxisAngle(u,c,D),r.multiply(D,q,q));f.$x(h.g,h.Ta,q,h.g);k.v(a);e.sync_transform(a)}else d.error("rotate_pivot(): wrong object")};a.move_pivot=function(a,c,f){if(b.qb(a)){var g=a.d;if(g.Ir){var h=n.fromMat4(g.K,z),l=m.subtract(g.g,
g.Ta,E);u[0]=c;u[1]=0;u[2]=f;m.scale(u,m.len(l),u);m.transformMat3(u,h,u);m.add(g.Ta,u,g.Ta);m.add(g.g,u,g.g);k.v(a);e.sync_transform(a)}}else d.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(a,c){if(b.bb(a)){var g=a.d;if(g.sb&&g.Mo&&c){var h=r.setAxisAngle(f.AXIS_Y,c,q);r.normalize(h,h);r.multiply(h,g.quat,g.quat);k.v(a);e.sync_transform(a)}}else d.error("rotate_hover_cam(): wrong object")};a.get_hover_cam_angle=function(a){return b.bb(a)?b.ip(a):(d.error("get_hover_cam_angle(): wrong object or camera move style"),
null)};a.set_hover_cam_angle=function(a,c){if(b.bb(a)){var g=a.d;if(g.sb){var h=f.quat_to_dir(g.quat,f.AXIS_X,u),l=b.ip(a)-c,h=r.setAxisAngle(h,l,q),g=r.multiply(h,g.quat,q);k.set_rotation(a,g);k.v(a);e.sync_transform(a)}else d.warn("set_hover_cam_angle(): undefined without distance limits")}else d.error("set_hover_cam_angle(): wrong object or camera move style")};a.get_hover_angle_limits=function(a,c){if(b.bb(a))return a.d.Ra?(c||(c=new Float32Array(2)),c[0]=a.d.Ra.Va,c[1]=a.d.Ra.Oa):d.warn("get_hover_angle_limits(): camera hasn't angle limits"),
c;d.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,c){if(b.bb(a)||b.qb(a))return a.d.sb?(c||(c=new Float32Array(2)),c[0]=a.d.fg,c[1]=a.d.ud):d.warn("get_cam_dist_limits(): camera hasn't distance limits"),c;d.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(a,c){if(b.bb(a)){var f=a.d;f.sb?m.copy(c,f.Cd):k.set_translation(a,c);k.v(a);e.sync_transform(a)}else d.error("translate_hover_cam_v(): wrong object")};a.get_hover_cam_pivot=function(a,
c){if(!b.bb(a))return d.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));m.copy(a.d.Cd,c);return c};a.has_distance_limits=function(a){return b.qb(a)||b.bb(a)?a.d.sb:(d.error("has_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,c,f,g){if(b.qb(a)||b.mf(a)){var h=a.d;h.Fa={Oa:c,Va:f};g==k.SPACE_LOCAL&&b.Vz(a);b.Xm(a)}else if(b.bb(a)){if(c>f){d.error("apply_vertical_limits(): wrong horizontal limits");return}h=a.d;h.Fa={Oa:-f,Va:-c}}else{d.error("apply_vertical_limits(): wrong object");
return}k.v(a);e.sync_transform(a)};a.clear_vertical_limits=function(a){a.d.Fa=null;(b.qb(a)||b.mf(a))&&b.Xm(a)};a.apply_horizontal_limits=function(a,c,f,g){if(b.qb(a)||b.mf(a)){var h=a.d;h.Ha={left:c,right:f};g==k.SPACE_LOCAL&&b.Qw(a);b.Xm(a)}else if(b.bb(a)){if(c>f){d.error("apply_horizontal_limits(): wrong horizontal limits");return}h=a.d;h.Ha={left:c,right:f}}else{d.error("apply_horizontal_limits(): wrong object");return}k.v(a);e.sync_transform(a)};a.clear_horizontal_limits=function(a){a.d.Ha=
null};a.get_horizontal_limits=function(a,c){if(b.qb(a)||b.mf(a)||b.bb(a)){var e=a.d;c=c||new Float32Array(2);if(e.Ha)return c[0]=e.Ha.left,c[1]=e.Ha.right,c}else d.error("get_horizontal_limits(): wrong object")};a.has_horizontal_limits=function(a){if(b.qb(a)||b.mf(a)||b.bb(a))return Boolean(a.d.Ha);d.error("has_horizontal_limits(): wrong object")};a.apply_hover_angle_limits=function(a,c,f){b.bb(a)?c>f?d.error("apply_hover_angle_limits(): wrong vertical limits"):(a.d.Ra={Oa:c,Va:f},k.v(a),e.sync_transform(a)):
d.error("apply_hover_angle_limits(): wrong object")};a.clear_hover_angle_limits=function(a){b.bb(a)?a.d.Ra=null:d.error("clear_hover_angle_limits(): wrong object")};a.apply_distance_limits=function(a,c,f){if(b.qb(a)||b.bb(a))if(c>f)d.error("apply_distance_limits(): wrong distance limits");else{var g=a.d;g.sb=!0;g.ud=c;g.fg=f;k.v(a);e.sync_transform(a)}else d.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){b.qb(a)||b.bb(a)?a.d.sb=!1:d.error("clear_distance_limits(): wrong object")};
a.set_eye_params=function(a,c,d){r.identity(a.d.quat);b.qm(a,Math.PI/2);b.Pq(a,c);b.qm(a,-d);k.v(a);e.sync_transform(a)};a.is_look_up=function(a){f.quat_to_dir(a.d.quat,f.AXIS_MY,u);return 0<=u[1]?!0:!1};a.rotate=function(a,c,d){b.Pq(a,c);b.qm(a,-d);k.v(a);e.sync_transform(a)};a.get_angles=function(a,c){c||(c=new Float32Array(2));b.get_angles(a,c);return c};a.set_stereo_distance=function(a,c){for(var d=a.d.J,e=0;e<d.length;e++){var f=d[e];f.type!=b.Db&&f.type!=b.Ib||b.xy(f,c,f.Wc)}};a.get_stereo_distance=
function(a){a=a.d.J;for(var c=0;c<a.length;c++){var d=a[c];if(d.type==b.Db||d.type==b.Ib)return d.ni}return 0};a.is_underwater=function(a){return a.d.Cr};a.translate_view=function(a,c,d,e){a=a.d.J;for(var f=0;f<a.length;f++){var g=a[f];g.Ab||b.Hg(g,g.Ya);var h=u;h[0]=-c;h[1]=-d;h[2]=0;x.translate(g.oa,h,g.oa);x.rotateZ(g.oa,e,g.oa);x.multiply(g.oa,g.ha,g.Vf);b.au(g);b.$t(g)}};a.correct_up=function(a,b){b||(b=f.AXIS_Y);g.correct_up(a,b)};a.zoom_object=function(a,f){if(b.qb(a)){k.get_object_center(f,
!1,u);c(a,u);k.v(a);var g=k.get_object_size(f),h=b.bw(a)/2,g=g/Math.sin(h),h=k.zx(a,u);k.move_local(a,0,g-h,0);k.v(a);e.sync_transform(a)}else d.error("zoom_object(): wrong object")};a.set_ortho_scale=function(c,e){if(b.is_camera(c)){var f=c.d;if(b.qb(c)){var g=m.dist(f.g,f.Ta);f.je=e/2*f.tg/g}else b.bb(c)&&a.has_distance_limits(c)?(g=b.rw(c),g=m.len(g),f.je=e/2*f.tg/g):f.je=e/2;b.Ez(c)}else d.error("set_ortho_scale(): wrong object")};a.get_ortho_scale=function(a){if(b.is_camera(a))return a.d.J[0].type==
b.fd?2*a.d.J[0].top:0;d.error("get_ortho_scale(): wrong object")};a.is_ortho_camera=function(a){if(b.is_camera(a))return a.d.J[0].type==b.fd;d.error("is_ortho_camera(): wrong object")};a.calc_ray=function(a,c,e,f){f||(f=new Float32Array(3));var g=a.d.J[0];switch(g.type){case b.lc:case b.Le:case b.Db:case b.Ib:var k=Math.tan(g.yd*Math.PI/360);l[0]=(2*c/g.width-1)*k*g.Ya;l[1]=-1;l[2]=(2*e/g.height-1)*k;l[3]=0;h.transformMat4(l,a.d.K,l);f[0]=l[0];f[1]=l[1];f[2]=l[2];m.normalize(f,f);return f;default:return d.error("Non-compatible camera"),
f}};a.project_point=function(a,c,e){e||(e=new Float32Array(2));var f=a.d.J[0];switch(f.type){case b.lc:case b.Le:case b.Db:case b.Ib:return k.get_translation(a,u),m.subtract(c,u,u),l.set(u),l[3]=0,h.transformMat4(l,f.Vf,l),a=-l[1]/l[3],e[0]=(l[0]/l[3]+1)/2*f.width|0,e[1]=(a+1)/2*f.height|0,e;default:return d.error("Non-compatible camera"),e}}};b4w.module.config=function(a,p){var c=p("__config");a.P_LOW=c.P_LOW;a.P_HIGH=c.P_HIGH;a.P_ULTRA=c.P_ULTRA;a.P_CUSTOM=c.P_CUSTOM;a.set=c.set;a.get=c.get;a.reset=c.reset;a.get_std_assets_path=c.get_std_assets_path};b4w.module.controls=function(a,p){var c=p("__controls");p("__print");a.CT_CONTINUOUS=c.CT_CONTINUOUS;a.CT_TRIGGER=c.CT_TRIGGER;a.CT_SHOT=c.CT_SHOT;a.CT_LEVEL=c.CT_LEVEL;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;
a.KEY_NUM9=105;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=
190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=c.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=c.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=c.PL_MULTITOUCH_MOVE_PAN;a.create_custom_sensor=c.create_custom_sensor;a.create_keyboard_sensor=c.create_keyboard_sensor;a.create_collision_sensor=c.create_collision_sensor;a.create_collision_impulse_sensor=c.create_collision_impulse_sensor;
a.create_ray_sensor=c.create_ray_sensor;a.create_mouse_click_sensor=c.create_mouse_click_sensor;a.create_mouse_wheel_sensor=c.create_mouse_wheel_sensor;a.create_mouse_move_sensor=c.create_mouse_move_sensor;a.create_touch_move_sensor=c.create_touch_move_sensor;a.create_touch_zoom_sensor=c.create_touch_zoom_sensor;a.create_motion_sensor=c.create_motion_sensor;a.create_vertical_velocity_sensor=c.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=c.create_gyro_angles_sensor;a.create_gyro_delta_sensor=
c.create_gyro_delta_sensor;a.create_timer_sensor=function(a,e){return c.create_timer_sensor(a,e||!1)};a.reset_timer_sensor=c.reset_timer_sensor;a.create_elapsed_sensor=c.create_elapsed_sensor;a.create_timeline_sensor=c.create_timeline_sensor;a.create_selection_sensor=function(a,e){return c.create_selection_sensor(a,e||!1)};a.set_custom_sensor=function(a,e){c.ky(a,e)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=c.get_sensor_value;a.get_sensor_payload=c.get_sensor_payload;a.sensor_make_positive=
function(){throw"Deprecated method execution";};a.sensor_make_negative=function(){throw"Deprecated method execution";};a.create_sensor_lock=function(a,e,d){a.Sl=e.slice(0);a.Rl=Array(e.length);a.Aj=d||c.cl};a.remove_sensor_lock=function(a){a.Sl=null;a.Rl=null;a.Aj=null};a.create_sensor_manifold=function(a,e,d,g,k,f,m){k=k||c.cl;c.create_sensor_manifold(a,e,d,g,k,f,void 0===m?null:m)};a.create_kb_sensor_manifold=function(a,e,d,g,k,f){g=c.create_keyboard_sensor(g);c.create_sensor_manifold(a,e,d,[g],
c.cl,k,void 0===f?null:f)};a.check_sensor_manifolds=function(a){return c.check_sensor_manifold(a,null)};a.check_sensor_manifold=c.check_sensor_manifold;a.remove_sensor_manifolds=function(a){c.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=c.remove_sensor_manifold;a.reset=c.reset;a.register_keyboard_events=c.register_keyboard_events;a.register_mouse_events=function(a,e,d){c.register_mouse_events(a,e,!!d)};a.register_wheel_events=c.register_wheel_events;a.register_touch_events=c.register_touch_events;
a.register_device_orientation=c.register_device_orientation;a.unregister_keyboard_events=c.unregister_keyboard_events;a.unregister_mouse_events=c.unregister_mouse_events;a.unregister_wheel_events=c.unregister_wheel_events;a.unregister_device_orientation=c.register_device_orientation;a.unregister_touch_events=c.unregister_touch_events};b4w.module.constraints=function(a,p){var c=p("__constraints"),b=p("__physics"),e=p("__transform");a.append_stiff=function(a,g,k,f,m){m=m||1;g instanceof Array&&2==g.length?c.Bn(a,g[0],g[1],k,f,m):c.Cn(a,g,k,f,m);e.v(a);b.sync_transform(a)};a.append_semi_stiff=function(a,g,k,f){c.zt(a,g,k,f);e.v(a);b.sync_transform(a)};a.append_semi_stiff_cam=function(a,g,k,f,m,h,p,n){c.yt(a,g,k,f,m,h,p,n);e.v(a);b.sync_transform(a)};a.append_semi_soft_cam=function(a,g,k,f){if(!f||0>f)f=.25;c.xt(a,g,k,f);e.v(a);b.sync_transform(a)};
a.append_stiff_trans=function(a,g,k){c.At(a,g,k);e.v(a);b.sync_transform(a)};a.append_copy_trans=function(a,g,k){c.tt(a,g,k);e.v(a);b.sync_transform(a)};a.append_stiff_trans_rot=function(a,g,k,f){c.Bt(a,g,k,f);e.v(a);b.sync_transform(a)};a.append_track=function(a,g){3==g.length?c.Et(a,g):c.Dt(a,g);e.v(a);b.sync_transform(a)};a.append_follow=function(a,g,k,f){3==g.length?c.vt(a,g,k,f):c.ut(a,g,k,f);e.v(a);b.sync_transform(a)};a.remove=function(a){a.jb&&c.remove(a)}};b4w.module.data=function(a,p){var c=p("__data");p("__print");var b=p("__util");a.load=c.load;a.unload=function(a){c.unload(a|0)};a.set_debug_resources_root=c.set_debug_resources_root;a.is_primary_loaded=c.is_primary_loaded;a.load_and_add_new=c.load;a.get_bpy_world=function(){b.fa("get_bpy_world() deprecated");return null};a.cleanup=a.unload};b4w.module.debug=function(a,p){p("__batch");var c=p("__print"),b=p("__controls"),e=p("__debug"),d=p("__physics"),g=p("__scenegraph"),k=p("__scenes"),f=p("__sfx"),m=p("__textures"),h=p("__util");p("__config");var r=p("vec3");a.physics_worker=function(){d.dv()};a.physics_id=function(a){c.log("O",d.Dv(a));for(var b=d.$v().l.o,e=0;e<b.length;e++){var f=b[e];f.rb.I==a&&c.log("B",f)}};a.visible_objects=function(){for(var a=k.get_active(),b=k.Da(a,"MESH",k.DATA_ID_ALL),a=k.ka(a,"MAIN_OPAQUE").o,d=0;d<b.length;d++){var e=
b[d],f=e.d;if("DYNAMIC"==f.type)for(var g=0;g<a.length;g++){var h=a[g];if(h.T&&h.eb==f){c.log(e.name,e);break}}}};a.object_info=function(a){for(var b=k.get_active(),d=k.Da(b,"MESH",k.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if(f.name==a){c.log("Object",f);for(var g=k.rl(b),h=0;h<g.length;h++){for(var l=g[h],m=l.o,p=[],r=0;r<m.length;r++)m[r].eb==f.d&&p.push(m[r]);c.log("Subscene "+l.type,p)}}}};a.objects_stat=function(){var a=k.get_active();console.log("Armatures: "+k.Da(a,"ARMATURE",k.DATA_ID_ALL).length);
console.log("Cameras: "+k.Da(a,"CAMERA",k.DATA_ID_ALL).length);console.log("Curves: "+k.Da(a,"CURVE",k.DATA_ID_ALL).length);console.log("Empties: "+k.Da(a,"EMPTY",k.DATA_ID_ALL).length);console.log("Lamps: "+k.Da(a,"LAMP",k.DATA_ID_ALL).length);console.log("Meshes: "+k.Da(a,"MESH",k.DATA_ID_ALL).length);console.log("Speakers: "+k.Da(a,"SPEAKER",k.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=k.get_active(),b=[k.ka(b,"MAIN_OPAQUE"),k.ka(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];
if(d)for(var d=d.o,e=0;e<d.length;e++){var f=d[e].n;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=k.get_active(),b=[k.ka(b,"MAIN_OPAQUE"),k.ka(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.o,e=0;e<d.length;e++){var f=d[e].n;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){var a=k.get_active(),a=[k.ka(a,"MAIN_OPAQUE"),k.ka(a,"MAIN_BLEND")];return a[0].o.length+a[1].o.length};a.geometry_stats=function(){for(var a=k.get_active(),b=k.rl(a),
a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.o,f=0;f<e.length;f++){var g=e[f].n,h=e[f].eb;g&&("COLOR_PICKING"!=d.type&&"GLOW_MASK"!=d.type||h.Jj)&&(a[g.id]=g)}}var e=d=c=b=0,m;for(m in a)g=a[m],g=g.lb,g.aj&&(d++,e+=g.aj/1048576),b++,c+=g.Eo/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=k.get_active(),c=[k.ka(c,"MAIN_OPAQUE"),k.ka(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=
e.o,f=0;f<e.length;f++){var g=e[f].n;if(g)for(var g=g.M,h=0;h<g.length;h++){var m=g[h];if("IMAGE"===m.source||"ENVIRONMENT_MAP"===m.source){var p=m.Ka;-1===a.indexOf(p)&&(a.push(p),m=m.width*m.height*4/1048576/m.Rk,m*=1.3333,b+=m)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=k.get_active(),c=k.rl(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var f=e.j,g=[f.ub,f.oc];g.push.apply(g,e.Yc);for(e=0;e<g.length;e++){var h=g[e];m.Oh(h)&&-1==a.indexOf(h)&&
(a.push(h),b+=f.width*f.height*m.Aw(h))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=k.get_active();(a=k.ka(a,"MAIN_OPAQUE"))&&k.Xp(a.j,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=k.get_active(),b=k.ka(a,"MAIN_OPAQUE"),a=k.fz(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}k.Xp(d.j,b,e)}};a.scenegraph_to_dot=function(){for(var a=
k.Hh(),b=0;b<a.length;b++)c.log(g.av(k.ul(a[b])))};a.scenes_to_dot=function(){};a.controls_info=b.debug;a.object_distance=function(a,b){return r.dist(a.d.g,b.d.g)};a.msg=e.msg;a.fbmsg=e.fbmsg;a.print_telemetry=e.print_telemetry;a.plot_telemetry=e.plot_telemetry;a.fbres=function(a,b){function c(){e.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,
0,1]),f=new Float32Array([-1,0,0]),g=new Float32Array([0,-1,0]),k=new Float32Array([0,0,-1]);if(!h.Zd(a,h.et))throw"Wrong VEC3_IDENT";if(!h.Zd(b,h.$s))throw"Wrong QUAT4_IDENT";if(!h.Zd(c,h.AXIS_X))throw"Wrong AXIS_X";if(!h.Zd(d,h.AXIS_Y))throw"Wrong AXIS_Y";if(!h.Zd(e,h.AXIS_Z))throw"Wrong AXIS_Z";if(!h.Zd(f,h.AXIS_MX))throw"Wrong AXIS_MX";if(!h.Zd(g,h.AXIS_MY))throw"Wrong AXIS_MY";if(!h.Zd(k,h.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=f.get_speaker_objects(),b=0;b<a.length;b++){var c=
a[b];"BACKGROUND_MUSIC"==f.xl(c)&&f.mute(c,!0)}};a.check_finite=function(a){e.check_finite(a)};a.set_debug_params=function(a){var b=k.get_active();if(b=k.ka(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&k.Dy(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&k.Cy(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return c.pw()};a.get_warning_quantity=function(){return c.Dw()};a.clear_errors_warnings=function(){return c.clear_errors_warnings()}};b4w.module.geometry=function(a,p){function c(a){return a&&a.d&&a.d.wd?!0:!1}var b=p("__batch"),e=p("__geometry"),d=p("__print"),g=p("__renderer");a.extract_vertex_array=function(a,f,g){if(!c(a))return d.error("Wrong object:",a.name),null;if(a=b.W(a,f,"MAIN")||b.W(a,f,"NODES")){if((f=a.lb)&&f.Rb&&f.Rb[g])return e.wv(f,g);d.error("Attribute not found:"+g);return null}d.error("Wrong material:",f);return null};a.extract_index_array=function(a,e){if(!c(a))return d.error("Wrong object:",a.name),null;var g=
b.W(a,e,"MAIN")||b.W(a,e,"NODES");if(g){if((g=g.lb)&&g.Rb)return g.he;d.error("Buffer data not found");return null}d.error("Wrong material:",e);return null};a.update_vertex_array=function(a,f,g,h){var p=["MAIN","NODES","DEPTH","COLOR_ID"];if(c(a))for(var n=0;n<p.length;n++){var x=b.W(a,f,p[n]);x&&(x=x.lb)&&x.Rb&&x.Rb[g]&&e.hk(x,g,0,h)}else d.error("Wrong object:",a.name)};a.override_geometry=function(a,f,m,h,p){var n=["MAIN","NODES","DEPTH","COLOR_ID"];if(c(a))if(m instanceof Uint16Array||m instanceof
Uint32Array)if(h instanceof Float32Array)for(var x=0;x<n.length;x++){var v=b.W(a,f,n[x]);if(v){var u=v.lb;if(u){e.vz(u,v.vd,m);var E=0,q;for(q in u.Rb)var D=u.Rb[q],E=E+h.length/3*D.Nc;u.$c=new Float32Array(E);var E=u.$c,l=0;for(q in u.Rb)switch(D=u.Rb[q],q){case "a_position":E.set(h,l);D.offset=l;D.length=h.length;l+=D.length;break;case "a_normal":var z;p&&(z=e.Wn(m,h,h));var A=e.Un(m,h,z);E.set(A,l);D.offset=l;D.length=h.length;l+=D.length;break;case "a_tangent":D.offset=l;D.length=h.length/3*D.Nc;
for(var G=new Float32Array(D.length),A=0;A<G.length;A+=4)G[A]=1,G[A+3]=1;E.set(G,l);l+=D.length;break;default:D.offset=l,D.length=h.length/3*D.Nc,A=new Float32Array(D.length),E.set(A,l),l+=D.length}e.Az(u);g.En(v);if(v.Eb)for(A=0;A<v.Eb.length;A++)(D=v.Eb[A])&&D.lb&&(D.lb=u)}}}else d.error("Wrong positions_array type");else d.error("Wrong ibo_array type");else d.error("Wrong object:",a.name)}};b4w.module.hud=function(a,p){var c=p("__hud");p("__print");a.draw_mixer_strip=c.draw_mixer_strip;a.plot_array=c.plot_array};b4w.module.lights=function(a,p){function c(a){for(var b=g.get_active(),c=g.Da(b,"LAMP",g.DATA_ID_ALL),n=0;n<c.length;n++){var p=c[n];if("SUN"==p.ja.type){var r=p;break}}if(!r)return e.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(c=(90-a.vert_position)/180*Math.PI,n=r.d,k.set_rotation_euler(r,[c,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),f.quat_to_dir(n.quat,f.AXIS_Y,a),n=m.length(n.g),m.copy(a,h),m.scale(h,n,h),k.set_translation(r,
h),k.v(r),a=r.ja,a.Ko&&(p=r.data.energy,n=b.world.light_settings.environment_energy,c=Math.cos(Math.abs(c)),p*=Math.max(Math.min(3*c,1),0),c=Math.max(c,.1)*n,d.Tq(a,p),g.set_environment_colors(b,c,null,null)),g.Of(r,b))}function b(a){if(d.Il(a))return a.ja.type;e.error("get_light_type(): Wrong object");return!1}var e=p("__print"),d=p("__lights"),g=p("__scenes"),k=p("__transform"),f=p("__util"),m=p("vec3"),h=new Float32Array(3),r,n=60;a.get_lamps=function(a){var b=g.get_active(),b=g.Da(b,"LAMP",g.DATA_ID_ALL);
if(!a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.ja.type===a&&c.push(e)}return c};a.get_sun_params=function(){for(var a=g.get_active(),a=g.Da(a,"LAMP",g.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.ja.type){b=d;break}}return b?(b=b.ja.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=c;a.set_day_time=function(a){for(var b=g.get_active(),
b=g.Da(b,"LAMP",g.DATA_ID_ALL),d=0;d<b.length;d++){var f=b[d];if("SUN"==f.ja.type){var h=f;break}}if(!h)return e.error("There is no sun on the scene"),null;h=-Math.cos(a/12*Math.PI)*n;b={};b.hor_position=12>a?15*a:15*(a-24);b.vert_position=h;c(b)};a.set_date=function(a){(r=a.getDate())?1582==r&&10==a.gC&&4<a.$u&&15>a.$u&&e.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):e.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){n=Math.min(Math.max(a,
0),90)};a.get_light_params=function(a){if(d.Il(a))var c=a.ja;else return e.error("get_light_params(): Wrong object"),!1;if(a=b(a))switch(a){case "SPOT":var f={light_type:a,light_color:c.color,light_energy:c.de,light_spot_blend:c.Zj,light_spot_size:c.Nf,light_distance:c.distance};break;case "POINT":f={light_type:a,light_color:c.color,light_energy:c.de,light_distance:c.distance};break;default:f={light_type:a,light_color:c.color,light_energy:c.de}}return f?f:!1};a.get_light_type=b;a.set_light_params=
function(a,b){if(d.Il(a))var c=a.ja;else return e.error("set_light_params(): Wrong object"),!1;var f=g.get_active();"number"==typeof b.light_energy&&(d.Tq(c,b.light_energy),g.Of(a,f));"object"==typeof b.light_color&&(d.ry(c,b.light_color),g.Of(a,f));"number"==typeof b.light_spot_blend&&(d.ty(c,b.light_spot_blend),g.Of(a,f));"number"==typeof b.light_spot_size&&(d.uy(c,b.light_spot_size),g.Of(a,f));"number"==typeof b.light_distance&&(d.sy(c,b.light_distance),g.Of(a,f))}};b4w.module.material=function(a,p){function c(a,b){for(var c=a.V,d=0;d<c.length;d++){var e=c[d];if(-1<e.yc.indexOf(b))return"MAIN"==e.type}return!1}function b(a,b){var c=d.W(a,b,"MAIN");return Boolean(c&&c.tc[0])}function e(a,b){var c=d.W(a,b,"MAIN");return Boolean(c&&c.tc[1])}var d=p("__batch"),g=p("__config"),k=p("__print"),f=p("__objects"),m=p("__shaders");p("__util");p("vec4");var h=g.p,r="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.max_bones=function(){k.error("max_bones() deprecated, return default value");
return h.max_bones};a.set_max_bones=function(){k.error("set_max_bones() deprecated")};a.set_batch_param=function(){k.error("set_batch_param() deprecated")};a.inherit_material=function(a,b,c,e){if(f.tj(c)&&f.tj(a)){for(var g=["MAIN","DEPTH","COLOR_ID"],h=!1,m=0;m<g.length;m++){var l=g[m],p=d.W(a,b,l),A=d.W(c,e,l);if(p&&A)for(h=!0,"MAIN"==l&&(A.yb.set(p.yb),A.Ze=p.Ze,A.Md.set(p.Md),A.tc.set(p.tc),A.ce=p.ce,A.Hc=p.Hc,A.Hc=p.Hc,A.Ye=p.Ye,A.Ne=p.Ne),l=0;l<A.hc.length;l++){var G=A.hc[l];if(-1!==r.indexOf(G)){var t=
p.hc.indexOf(G);if(-1!==t&&(A.M[l]=p.M[t],A.Eb))for(l=0;l<A.Eb.length;l++){var B=A.Eb[l],O=B.hc.indexOf(G);-1!==O&&(B.M[O]=p.M[t])}}}}h||k.error("Wrong objects for inheriting material!")}else k.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++)b.push(a[c].name);return b};a.set_diffuse_color=function(a,b,c){(a=d.W(a,b,"MAIN"))?a.yb.set(c):k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=
d.W(a,b,"MAIN");if(c){var e=Array(4);e[0]=c.yb[0];e[1]=c.yb[1];e[2]=c.yb[2];e[3]=c.yb[3];return e}k.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){(a=d.W(a,b,"MAIN"))?a.Ze=c:k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=d.W(a,b,"MAIN");if(c)return c.Ze;k.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){(a=d.W(a,b,"MAIN"))?a.Md.set(c):k.error('Couldn\'t set property "specular_color"!')};
a.get_specular_color=function(a,b){var c=d.W(a,b,"MAIN");if(c){var e=Array(3);e[0]=c.Md[0];e[1]=c.Md[1];e[2]=c.Md[2];return e}k.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,c,e){b(a,c)||k.error('Property "specular_intensity" is missing!');d.W(a,c,"MAIN").tc[0]=e};a.get_specular_intensity=function(a,c){b(a,c)||k.error('Property "specular_intensity" is missing!');return d.W(a,c,"MAIN").tc[0]};a.check_specular_intensity=b;a.set_specular_hardness=function(a,b,
c){e(a,b)||k.error('Property "specular_hardness" is missing!');d.W(a,b,"MAIN").tc[1]=c};a.get_specular_hardness=function(a,b){e(a,b)||k.error('Property "specular_hardness" is missing!');return d.W(a,b,"MAIN").tc[1]};a.check_specular_hardness=e;a.set_emit_factor=function(a,b,c){(a=d.W(a,b,"MAIN"))?a.ce=c:k.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=d.W(a,b,"MAIN");if(c)return c.ce;k.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,
b,c){(a=d.W(a,b,"MAIN"))?a.Hc=c:k.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=d.W(a,b,"MAIN");if(c)return c.Hc;k.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){(a=d.W(a,b,"MAIN"))?a.Ye=c:k.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=d.W(a,b,"MAIN");if(c)return c.Ye;k.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,
b){var c=d.W(a,b,"MAIN");c?c.Ne=alpha_factor:k.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=d.W(a,b,"MAIN");if(c)return c.Ne;k.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return k.error("B4W Error: missing arguments in get_material_params"),null;if(!c(a,b))return null;var e=d.W(a,b,"MAIN");if(!e)return null;var f={};"MAIN"==e.type&&(f.di=e.di,f.pB=e.zd[2],f.qB=5*(1-e.zd[3]),f.Xh=e.Xh,f.oC=d.ob(e,
"PARALLAX_STEPS")[1]);return f};a.get_water_material_params=function(a,b){if(!a||!b)return k.error("B4W Error: missing arguments in get_water_material_params"),null;if(!c(a,b))return null;var e=d.W(a,b,"MAIN");if(!e||!e.Ge)return null;if(!e)return k.warn("B4W Warning: material not found"),null;var f={};if("MAIN"==e.type){if(h.Ig){var g=f.shallow_water_col=Array(3);g[0]=e.shallow_water_col[0];g[1]=e.shallow_water_col[1];g[2]=e.shallow_water_col[2];g=f.shore_water_col=Array(3);g[0]=e.shore_water_col[0];
g[1]=e.shore_water_col[1];g[2]=e.shore_water_col[2];f.shallow_water_col_fac=e.shallow_water_col_fac;f.shore_water_col_fac=e.shore_water_col_fac}f.foam_factor=e.foam_factor;f.norm_uv_velocity=e.nk;f.absorb_factor=d.ob(e,"ABSORB")[1];f.sss_strength=d.ob(e,"SSS_STRENGTH")[1];f.sss_width=d.ob(e,"SSS_WIDTH")[1];f.dst_noise_scale0=d.ob(e,"DST_NOISE_SCALE_0")[1];f.dst_noise_scale1=d.ob(e,"DST_NOISE_SCALE_1")[1];f.dst_noise_freq0=d.ob(e,"DST_NOISE_FREQ_0")[1];f.dst_noise_freq1=d.ob(e,"DST_NOISE_FREQ_1")[1];
f.dir_min_shore_fac=d.ob(e,"DIR_MIN_SHR_FAC")[1];f.dir_freq=d.ob(e,"DIR_FREQ")[1];f.dir_noise_scale=d.ob(e,"DIR_NOISE_SCALE")[1];f.dir_noise_freq=d.ob(e,"DIR_NOISE_FREQ")[1];f.dir_min_noise_fac=d.ob(e,"DIR_MIN_NOISE_FAC")[1];f.dst_min_fac=d.ob(e,"DST_MIN_FAC")[1];f.waves_hor_fac=d.ob(e,"WAVES_HOR_FAC")[1]}return f};a.set_material_extended_params=function(a,b,e){if(a&&b&&e){if(!c(a,b))return k.warn("B4W Warning: setting material params is not possible"),null;a=d.W(a,b,"MAIN");a?"MAIN"==a.type&&("number"==
typeof e.material_reflectivity&&(a.di=e.material_reflectivity),"number"==typeof e.material_fresnel&&(a.zd[2]=e.material_fresnel),"number"==typeof e.material_fresnel_factor&&(a.zd[3]=1-e.material_fresnel_factor/5),"number"==typeof e.material_parallax_scale&&(a.Xh=e.material_parallax_scale),"number"==typeof e.material_parallax_steps&&(e=m.s(parseFloat(e.material_parallax_steps)),d.Z(a,"PARALLAX_STEPS",e),d.Cb(a,!0))):k.warn("B4W Warning: material not found")}else k.error("B4W Error: missing arguments in set_material_params")};
a.set_water_material_params=function(a,b,e){if(!a||!b||!e)return k.error("B4W Error: missing arguments in set_water_material_params"),null;if(!c(a,b))return k.warn("B4W Warning: setting water material params is not possible"),null;a=d.W(a,b,"MAIN");if(!a)return k.warn("B4W Warning: material not found"),null;"MAIN"==a.type&&(h.Ig&&("object"==typeof e.shallow_water_col&&a.shallow_water_col.set(e.shallow_water_col),"number"==typeof e.shallow_water_col_fac&&(a.shallow_water_col_fac=e.shallow_water_col_fac),
"object"==typeof e.shore_water_col&&a.shore_water_col.set(e.shore_water_col),"number"==typeof e.shore_water_col_fac&&(a.shore_water_col_fac=e.shore_water_col_fac)),h.shore_smoothing&&a.bn&&("boolean"==typeof e.shore_smoothing&&(e.shore_smoothing?d.Z(a,"SHORE_SMOOTHING",1):d.Z(a,"SHORE_SMOOTHING",0)),"number"==typeof e.absorb_factor&&(b=m.s(parseFloat(e.absorb_factor)),d.Z(a,"ABSORB",b))),"number"==typeof e.foam_factor&&h.kg&&(a.foam_factor=e.foam_factor),"number"==typeof e.norm_uv_velocity&&(a.nk=
e.norm_uv_velocity),h.water_dynamic&&a.water_dynamic&&("boolean"==typeof e.water_dynamic&&(e.water_dynamic?d.Z(a,"DYNAMIC",1):d.Z(a,"DYNAMIC",0)),"number"==typeof e.waves_height&&(b=m.s(parseFloat(e.waves_height)),d.Z(a,"WAVES_HEIGHT",b)),"number"==typeof e.waves_length&&(b=m.s(parseFloat(e.waves_length)),d.Z(a,"WAVES_LENGTH",b)),"number"==typeof e.sss_strength&&(b=m.s(parseFloat(e.sss_strength)),d.Z(a,"SSS_STRENGTH",b)),"number"==typeof e.sss_width&&(b=m.s(parseFloat(e.sss_width)),d.Z(a,"SSS_WIDTH",
b)),"number"==typeof e.dst_noise_scale0&&(b=m.s(parseFloat(e.dst_noise_scale0)),d.Z(a,"DST_NOISE_SCALE_0",b)),"number"==typeof e.dst_noise_scale1&&(b=m.s(parseFloat(e.dst_noise_scale1)),d.Z(a,"DST_NOISE_SCALE_1",b)),"number"==typeof e.dst_noise_freq0&&(b=m.s(parseFloat(e.dst_noise_freq0)),d.Z(a,"DST_NOISE_FREQ_0",b)),"number"==typeof e.dst_noise_freq1&&(b=m.s(parseFloat(e.dst_noise_freq1)),d.Z(a,"DST_NOISE_FREQ_1",b)),"number"==typeof e.dir_min_shore_fac&&(b=m.s(parseFloat(e.dir_min_shore_fac)),d.Z(a,
"DIR_MIN_SHR_FAC",b)),"number"==typeof e.dir_freq&&(b=m.s(parseFloat(e.dir_freq)),d.Z(a,"DIR_FREQ",b)),"number"==typeof e.dir_noise_scale&&(b=m.s(parseFloat(e.dir_noise_scale)),d.Z(a,"DIR_NOISE_SCALE",b)),"number"==typeof e.dir_noise_freq&&(b=m.s(parseFloat(e.dir_noise_freq)),d.Z(a,"DIR_NOISE_FREQ",b)),"number"==typeof e.dir_min_noise_fac&&(b=m.s(parseFloat(e.dir_min_noise_fac)),d.Z(a,"DIR_MIN_NOISE_FAC",b)),"number"==typeof e.dst_min_fac&&(b=m.s(parseFloat(e.dst_min_fac)),d.Z(a,"DST_MIN_FAC",b)),
"number"==typeof e.waves_hor_fac&&(e=m.s(parseFloat(e.waves_hor_fac)),d.Z(a,"WAVES_HOR_FAC",e))),d.Cb(a,!0));return!0}};b4w.module.particles=function(a,p){var c=p("__particles"),b=p("__print");a.set_size=function(a,d,g){c.sg(a)?c.set_size(a,d,g):b.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,d,g){c.sg(a)?c.set_normal_factor(a,d,g):b.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,d,g){c.sg(a)?(g=Math.min(g,1),g=Math.max(g,0),c.set_factor(a,d,g)):b.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,p){var c=p("__print"),b=p("__physics"),e=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){b.has_physics(a)?b.enable_simulation(a):c.error("No physics for object "+a.name)};a.disable_simulation=function(a){b.has_physics(a)?b.disable_simulation(a):c.error("No physics for object "+a.name)};a.has_physics=function(a){return b.has_physics(a)};a.has_simulated_physics=function(a){return b.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return b.has_dynamic_physics(a)};a.set_gravity=function(a,e){b.has_physics(a)?b.set_gravity(a,e):c.error("No physics for object "+a.name)};a.set_damping=function(a,e,k){b.has_physics(a)?b.q("set_damping",a.l.I,e,k):c.error("No physics for object "+a.name)};a.reset_damping=function(a){if(b.has_physics(a)){var e=a.game;b.q("set_damping",a.l.I,e.damping,e.rotation_damping)}else c.error("No physics for object "+a.name)};a.set_transform=function(a,e,k){b.has_physics(a)?b.set_transform.apply(this,
arguments):c.error("No physics for object "+a.name)};a.sync_transform=function(a){b.has_physics(a)?b.sync_transform(a):c.error("No physics for object "+a.name)};a.apply_velocity=function(a){b.has_physics(a)?b.apply_velocity.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){b.has_physics(a)?b.apply_velocity_world.apply(this,arguments):c.error("No physics for object "+a.name)};a.apply_force=function(a,e,k,f){b.has_physics(a)?b.apply_force.apply(this,
arguments):c.error("No physics for object "+a.name)};a.apply_torque=function(a,e,k,f){b.has_physics(a)?b.apply_torque.apply(this,arguments):c.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,g){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_throttle(a,e.clamp(g,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,g,k){if(b.has_physics(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");
g=e.clamp(g,0,1);var f=a.i.jg;-1==k||1==k?f=Math.max(-1,Math.min(f+k*g,1)):0==k&&0<=f?(f-=g,f=Math.max(0,f)):0==k&&0>f?(f+=g,f=Math.min(0,f)):c.error("Wrong steering direction");b.vehicle_throttle(a,e.clamp(f,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_steer=function(a,g){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_steer(a,e.clamp(g,-1,1))):c.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,g,k){if(b.has_physics(a)){b.is_vehicle_chassis(a)||
b.is_vehicle_hull(a)||c.error("Wrong object");g=e.clamp(g,0,1);var f=a.i.Qg;-1==k||1==k?f=Math.max(-1,Math.min(f+k*g,1)):0==k&&0<=f?(f-=g,f=Math.max(0,f)):0==k&&0>f?(f+=g,f=Math.min(0,f)):c.error("Wrong steering direction");b.vehicle_steer(a,e.clamp(f,-1,1))}else c.error("No physics for object "+a.name)};a.vehicle_brake=function(a,g){b.has_physics(a)?(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object"),b.vehicle_brake(a,e.clamp(g,0,1))):c.error("No physics for object "+a.name)};
a.vehicle_brake_inc=function(a,g){if(b.has_physics(a)){b.is_vehicle_chassis(a)||b.is_vehicle_hull(a)||c.error("Wrong object");g=e.clamp(g,-1,1);var k=a.i.ph;b.vehicle_brake(a,e.clamp(k+k*g,0,1))}else c.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return b.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return b.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;
c.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.i.jg;c.error("Wrong object")};a.get_vehicle_steering=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.i.Qg;c.error("Wrong object")};a.get_vehicle_brake=function(a){if(!b.has_physics(a))return c.error("No physics for object "+
a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return a.i.ph;c.error("Wrong object")};a.get_vehicle_speed=function(a){if(!b.has_physics(a))return c.error("No physics for object "+a.name),null;if(b.is_vehicle_chassis(a)||b.is_vehicle_hull(a))return b.get_vehicle_speed(a);c.error("Wrong object")};a.is_character=function(a){return b.is_character(a)};a.set_character_move_dir=function(a,e,k){b.has_physics(a)?b.set_character_move_dir(a,e,k):c.error("No physics for object "+a.name)};a.set_character_move_type=
function(a,e){b.has_physics(a)?b.set_character_move_type(a,e):c.error("No physics for object "+a.name)};a.set_character_dist_to_water=function(){c.warn("Function set_character_dist_to_water() is deprecated")};a.set_character_walk_velocity=function(a,e){b.has_physics(a)?b.set_character_walk_velocity(a,e):c.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,e){b.has_physics(a)?b.set_character_run_velocity(a,e):c.error("No physics for object "+a.name)};a.set_character_fly_velocity=
function(a,e){b.has_physics(a)?b.set_character_fly_velocity(a,e):c.error("No physics for object "+a.name)};a.character_jump=function(a){b.has_physics(a)?b.character_jump(a):c.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,e,k){b.has_physics(a)?b.character_rotation_inc(a,e,k):c.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,e){b.has_physics(a)?b.set_character_rotation_quat(a,e):c.error("No physics for object "+a.name)};a.set_character_rotation=
function(a,e,k){b.has_physics(a)?b.set_character_rotation(a,e,k):c.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,e){b.has_physics(a)?b.set_character_rotation_v(a,e):c.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,e){b.has_physics(a)?b.set_character_rotation_h(a,e):c.error("No physics for object "+a.name)};a.append_collision_test=function(a,e,k,f){b.has_physics(a)?b.append_collision_test(a,e,k,f):c.error("No physics for object "+a.name)};
a.remove_collision_test=function(a,e){b.has_physics(a)?b.remove_collision_test(a,e):c.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,e){b.has_physics(a)?b.apply_collision_impulse_test(a,e):c.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){b.has_physics(a)?b.clear_collision_impulse_test(a):c.error("No physics for object "+a.name)};a.append_ray_test=function(a,e,k,f,m,h){b.has_physics(a)?b.append_ray_test(a,e,k,f,m,h):c.error("No physics for object "+
a.name)};a.remove_ray_test=function(a,e,k,f,m){b.has_physics(a)?b.remove_ray_test(a,e,k,f,m):c.error("No physics for object "+a.name)};a.apply_constraint=function(a,e,k,f,m,h,p,n,x,v){b.has_physics(e)&&b.has_physics(m)?b.apply_constraint(a,e,k,f,m,h,p,n,x,v):c.error("Wrong objects")};a.clear_constraint=function(a){b.has_physics(a)&&b.Mw(a)?b.clear_constraint(a):c.error("Wrong object")};a.pull_to_constraint_pivot=function(a,e,k,f,m,h){b.has_physics(a)&&b.has_physics(f)?b.pull_to_constraint_pivot(a,
e,k,f,m,h):c.error("Wrong objects")}};b4w.module.scenes=function(a,p){var c=p("__batch"),b=p("__camera"),e=p("__graph"),d=p("__objects"),g=p("__print"),k=p("__physics"),f=p("__scenes"),m=p("__util");a.DATA_ID_ALL=f.DATA_ID_ALL;a.set_active=function(a){var b=f.Hh();f.set_active(m.keysearch("name",a,b))};a.get_active=function(){return f.Y()?f.get_active().name:""};a.get_scenes=function(){for(var a=f.Hh(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(f.Y())return f.sl(f.get_active());g.error("No active scene");
return!1};a.get_object_by_name=function(a,b){return f.Ih(f.Bi,a,b|0)};a.get_object_by_dupli_name=function(a,b,c){return f.Ih(f.jn,a,b,c|0)};a.get_object_by_dupli_name_list=function(a,b){return f.Ih(f.kn,a,b|0)};a.get_object_by_empty_name=function(b,c,d){g.warn("get_object_by_empty_name() deprecated, use get_object_by_dupli_name() instead");return a.get_object_by_dupli_name(b,c,d)};a.get_object_data_id=function(a){return f.get_object_data_id(a)};a.pick_object=f.pick_object;a.set_glow_intensity=function(a,
b){for(var c=0;c<a.V.length;c++){var d=a.V[c];"COLOR_ID"==d.type&&(d.qg=b)}};a.apply_glow_anim=function(a,b,c,d){a.d&&a.d.Qc&&f.apply_glow_anim(a,b,c,d)};a.apply_glow_anim_def=function(a){if(a.d&&a.d.Qc){var b=a.d.hj;f.apply_glow_anim(a,b.Fw,b.Hw,b.Iw)}};a.clear_glow_anim=function(a){a.d&&a.d.Qc&&f.clear_glow_anim(a)};a.set_glow_color=function(a){var b=f.get_active();if(b=f.ka(b,"GLOW"))b.Jh.set(a),b.ya=!0};a.get_shadow_params=function(){if(!f.Y())return g.error("No active scene"),!1;var a=f.get_active(),
b=f.ka(a,"SHADOW_CAST");if(!b)return null;var c=a.d.Sc,d=f.ka(a,"MAIN_OPAQUE"),e=f.ka(a,"DEPTH"),k={};k.csm_resolution=c.csm_resolution;k.self_shadow_polygon_offset=b.self_shadow_polygon_offset;e&&(k.self_shadow_normal_offset=e.self_shadow_normal_offset);k.enable_csm=c.enable_csm;k.csm_num=c.csm_num;k.csm_first_cascade_border=c.csm_first_cascade_border;k.first_cascade_blur_radius=c.first_cascade_blur_radius;k.csm_last_cascade_border=c.csm_last_cascade_border;k.last_cascade_blur_radius=c.last_cascade_blur_radius;
k.fade_last_cascade=c.fade_last_cascade;k.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(k.csm_borders=f.lw(a,d.j),k.blur_radii=new Float32Array(c.csm_num),k.blur_radii.set(d.j.Pj.subarray(0,c.csm_num))):(k.csm_borders=null,k.blur_radii=null);return k};a.set_shadow_params=function(a){if(!f.Y())return g.error("No active scene"),!1;var d=f.get_active();"number"==typeof a.self_shadow_polygon_offset&&e.P(d.d.pb,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});
var k=f.ka(d,"DEPTH");k&&("number"==typeof a.self_shadow_normal_offset&&(k.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(k.pcf_blur_radius=a.pcf_blur_radius));var m=f.ka(d,"MAIN_BLEND");m&&("number"==typeof a.self_shadow_normal_offset&&(m.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(m.pcf_blur_radius=a.pcf_blur_radius),m.ya=!0);m=d.d.Sc;"number"==typeof a.csm_first_cascade_border&&(m.csm_first_cascade_border=
a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(m.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(m.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(m.last_cascade_blur_radius=a.last_cascade_blur_radius);if(k){for(var p=k.o,u=0;u<p.length;u++){var E=p[u];E.eb.Bb&&(E=E.n,c.xk(E,m),c.Cb(E))}k.ya=!0}k=d.camera.d.J;for(u=0;u<k.length;u++)b.Rm(k[u],m);f.rm(d)};a.get_environment_colors=
function(){if(!f.Y())return g.error("No active scene"),!1;var a=f.get_active();return f.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(!f.Y())return g.error("No active scene"),!1;var d=f.get_active();f.set_environment_colors(d,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!f.Y())return g.error("No active scene"),!1;var b=f.get_active();return f.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!f.Y())return g.error("No active scene"),!1;var b=
f.get_active();f.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!f.Y())return g.error("No active scene"),!1;var a=f.get_active();return f.get_ssao_params(a)};a.set_ssao_params=function(a){if(!f.Y())return g.error("No active scene"),!1;var b=f.get_active();f.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!f.Y())return g.error("No active scene"),null;var a=f.get_active(),a=f.ka(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;
b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!f.Y())return g.error("No active scene"),null;var b=f.get_active(),b=f.ka(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.ya=!0};a.get_sky_params=function(){if(!f.Y())return g.error("No active scene"),
!1;var a=f.get_active();return f.get_sky_params(a)};a.set_sky_params=function(a){if(!f.Y())return g.error("No active scene"),!1;var b=f.get_active();f.set_sky_params(b,a)};a.get_dof_params=function(){if(!f.Y())return g.error("No active scene"),!1;var a=f.get_active();return f.ka(a,"DOF")?f.get_dof_params(a):null};a.set_dof_params=function(a){if(!f.Y())return g.error("No active scene"),!1;var b=f.get_active();f.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!f.Y())return g.error("No active scene"),
!1;var a=f.get_active();return f.ka(a,"GOD_RAYS")?f.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!f.Y())return g.error("No active scene"),!1;var b=f.get_active();f.set_god_rays_params(b,a)};a.get_bloom_params=function(){if(!f.Y())return g.error("No active scene"),!1;var a=f.get_active();return f.ka(a,"BLOOM")?f.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!f.Y())return g.error("No active scene"),!1;var b=f.get_active();f.set_bloom_params(b,a)};a.get_wind_params=
function(){return f.get_wind_params()};a.set_wind_params=function(a){if(!f.Y())return g.error("No active scene"),!1;var b=f.get_active();f.set_wind_params(b,a)};a.get_water_surface_level=f.get_water_surface_level;a.set_water_params=function(a){if(!f.Y())return g.error("No active scene"),!1;var b=f.get_active();f.set_water_params(b,a)};a.get_water_mat_params=function(a){if(!f.Y())return g.error("No active scene"),!1;var b=f.get_active();f.get_water_mat_params(b,a)};a.update_scene_materials_params=
function(){if(!f.Y())return g.error("No active scene"),!1;var a=f.get_active();f.Gr(a)};a.hide_object=function(a){d.tj(a)?f.hide_object(a):g.error("B4W Error: show/hide is only supported for dynamic meshes")};a.show_object=function(a){d.tj(a)?f.show_object(a):g.error("B4W Error: show/hide is only supported for dynamic meshes")};a.is_visible=function(a){return a.d.is_visible};a.check_object=function(a){return f.Y()?f.check_object(a,f.get_active()):(g.error("No active scene"),!1)};a.get_all_objects=
function(a,b){var c=f.get_active();a||(a="ALL");b||0===b||(b=f.DATA_ID_ALL);return f.Da(c,a,b)};a.get_appended_objs=function(b,c){g.warn("get_appended_objs() deprecated, use get_all_objects() instead");return a.get_all_objects(b,c)};a.get_object_name=function(a){return a?a.name:(g.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(g.error("Wrong object ID"),"UNDEFINED")};a.get_object_dg_parent=function(a){return a.Jb};a.get_object_children=function(a){return a.Sd.slice(0)};
a.get_first_character=function(){for(var a=f.Da(f.get_active(),"MESH",f.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(k.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return f.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return f.get_cam_water_depth()};a.get_type_mesh_object=function(a){return"MESH"==a.type?a.d.type:null};a.get_meta_tags=function(){if(!f.Y())return g.error("No active scene"),!1;var a=f.get_active();return f.get_meta_tags(a)};a.append_object=
function(){m.fa('Method "append_object" is deprecated')};a.add_object=function(){m.fa('Method "add_object" is deprecated')};a.remove_object=function(){m.fa('Method "remove_object" is deprecated')};a.get_screen_scenes=function(){m.fa("get_screen_scenes() deprecated")};a.set_light_pos=function(){m.fa("set_light_pos() deprecated, use lights module instead")};a.set_light_direction=function(){m.fa("set_light_direction() deprecated, use lights module instead")};a.set_dir_light_color=function(){m.fa("set_dir_light_color() deprecated, use lights module instead")};
a.get_lights_names=function(){m.fa("get_lights_names() deprecated, use lights module instead")};a.remove_all=function(){m.fa("remove_all() deprecated, use lights module instead")};a.check_collision=function(){m.fa("check_collision() deprecated, use lights module instead")};a.check_ray_hit=function(){m.fa("check_ray_hit() deprecated, use lights module instead")}};b4w.module.sfx=function(a,p){var c=p("__scenes"),b=p("__sfx"),e=p("__print");a.play=function(a,c,e){b.play(a,c,e)};a.play_def=function(a){b.play_def(a)};a.is_play=function(a){return b.is_play(a)};a.speaker_play=function(a,c,e,f){b.cyclic(a,c);f&&b.playrate(a,f);b.play(a,0,e)};a.speaker_stop=function(a){b.stop(a)};a.stop=function(a){b.stop(a)};a.pause=function(a){b.Py(a)};a.resume=function(a){b.Ry(a)};a.speaker_playback_rate=function(a,c){b.playrate(a,c)};a.playrate=function(a,c){b.playrate(a,c)};
a.get_playrate=function(a){return b.get_playrate(a)};a.cyclic=function(a,c){b.cyclic(a,c)};a.is_cyclic=function(a){return b.is_cyclic(a)};a.listener_reset_speed=function(a,c){b.listener_reset_speed(a,c)};a.speaker_reset_speed=function(a,c,e){b.speaker_reset_speed(a,c,e)};a.get_volume=function(a){return a&&"object"===typeof a?b.get_volume(a):b.sw()};a.set_volume=function(a,c){a&&"object"===typeof a?b.set_volume(a,c):b.vy(c)};a.mute=function(a,c){a&&"object"===typeof a?b.mute(a,c):b.sx(c)};a.is_muted=
function(a){return a&&"object"===typeof a?b.is_muted(a):b.bx()};a.get_speaker_objects=function(){return b.get_speaker_objects().slice(0)};a.get_speakers=function(){return a.get_speaker_objects()};a.check_active_speakers=b.check_active_speakers;a.set_compressor_params=function(a){b.set_compressor_params(c.get_active(),a)};a.get_compressor_params=function(){return b.get_compressor_params(c.get_active())};a.duck=function(a,c,e){a&&"object"===typeof a?b.duck(a,c,e):b.ov(c,e)};a.unduck=function(a){a&&
"object"===typeof a?b.unduck(a):b.sz()};a.apply_playlist=b.apply_playlist;a.clear_playlist=b.clear_playlist;a.detect_audio_container=b.detect_audio_container;a.detect_video_container=b.detect_video_container;a.set_positional_params=b.set_positional_params;a.get_positional_params=b.get_positional_params;a.set_filter_params=b.set_filter_params;a.get_filter_params=b.get_filter_params;a.get_filter_freq_response=b.get_filter_freq_response;a.get_duration=function(a){if(a&&b.Fd(a))return b.get_duration(a);
e.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.shaders=function(a,p){function c(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function b(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);
c.send(b);if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function e(a){for(var b=f.Hh(),c=0;c<b.length;c++)for(var d=f.Da(b[c],"MESH",f.DATA_ID_ALL),e=0;e<d.length;e++){var g=d[e];if(g.V)for(var k=0;k<g.V.length;k++){var m=g.V[k];if(m.Mb==a&&m.yc.length)return m.yc}}return null}function d(a){a.sort(function(a,b){return b.ol.ALU_OPS-a.ol.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.ol,f=c.Xz,k=e(c.Yu),k=k?"\t\t("+k.join(", ")+")":"\t\t(NA)";g.groupCollapsed("FRAG --\x3e",
"ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",f.ALU_OPS,"TEX",f.TEX_OPS,k);g.groupCollapsed("directives");for(var k=c.Ua.be,m=0;m<k.length;m++){var p=k[m];g.log(p[0],p[1])}g.groupEnd();g.groupCollapsed("vert src");g.log(c.Wz);g.groupEnd();g.groupCollapsed("vert stats");for(var D in f)"ALU_OPS"!=D&&"TEX_OPS"!=D&&g.log(D,f[D]);g.groupEnd();g.groupCollapsed("frag src");g.log(c.Nv);g.groupEnd();g.groupCollapsed("frag stats");for(D in d)"ALU_OPS"!=D&&"TEX_OPS"!=D&&g.log(D,d[D]);g.groupEnd();
g.groupEnd()}}p("__config");var g=p("__print"),k=p("__extensions"),f=p("__scenes"),m=p("__shaders");p("__util");a.report_repeatful_compilation=function(){var a=m.bv(),b=0,c;for(c in a){var d=a[c],e=d.count;1<e&&g.log(e-1,d.xC,d.LB);b+=e-1}g.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var e=m.jw(),f=0,p;for(p in e)a&&-1===p.indexOf(a)||f++;var f="of "+f+" analyzing...",v={};for(p in e)if(!a||-1!==p.indexOf(a)){var u=e[p],E;var q=u.Zm;E=u.bp;var D=k.fp();if(D){q=D.getTranslatedShaderSource(q);
E=D.getTranslatedShaderSource(E);var D=b("/nvidia_vert",q),l=c(D),z=b("/nvidia_frag",E),A=c(z);E={Wz:q,KC:D,Xz:l,Nv:E,oB:z,ol:A}}else g.error("B4W Error: WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),E=void 0;D=u.Ua;q=D.si+" + "+D.Ch;E.Yu=u;E.Ua=D;u=v[q]=v[q]||[];u.push(E);g.log(f)}for(q in v)g.group("%c"+q,"color: #800"),u=v[q],d(u),g.groupEnd()}};b4w.module.textures=function(a,p){var c=p("__textures"),b=p("__print");a.get_canvas_texture_context=function(a){var d=c.hw(a);if(d)return d;b.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a){c.xz(a)||b.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a){c.play_video(a)||b.error('Texture with name "'+a+'" not found!')};a.stop_video=function(c){b.warn("stop_video() deprecated, use pause_video() instead");return a.pause_video(c)};
a.pause_video=function(a){c.pause_video(a)||b.error('Texture with name "'+a+'" not found!')};a.reset_video=function(a){c.reset_video(a)||b.error('Texture with name "'+a+'" not found!')}};b4w.module.transform=function(a,p){var c=p("__print"),b=p("__physics"),e=p("__transform"),d=p("__util"),g=new Float32Array(3),k=new Float32Array(4);a.SPACE_LOCAL=e.SPACE_LOCAL;a.SPACE_WORLD=e.SPACE_WORLD;a.set_translation=function(a,c,d,k){g[0]=c;g[1]=d;g[2]=k;e.set_translation(a,g);e.v(a);b.sync_transform(a)};a.set_translation_v=function(a,c){e.set_translation(a,c);e.v(a);b.sync_transform(a)};a.set_translation_rel=function(a,c,h,k,n){g[0]=c;g[1]=h;g[2]=k;d.oi(g,1,n.d.quat,n.d.g,g);e.set_translation(a,
g);e.v(a);b.sync_transform(a)};a.get_translation=function(a,b){b||(b=new Float32Array(3));e.get_translation(a,b);return b};a.set_rotation=function(a,c,d,g,n){k[0]=c;k[1]=d;k[2]=g;k[3]=n;e.set_rotation(a,k);e.v(a);b.sync_transform(a)};a.set_rotation_quat=a.set_rotation;a.set_rotation_v=function(a,c){e.set_rotation(a,c);e.v(a);b.sync_transform(a)};a.set_rotation_quat_v=a.set_rotation_v;a.get_rotation=function(a,b){b||(b=new Float32Array(4));e.get_rotation(a,b);return b};a.get_rotation_quat=a.get_rotation;
a.set_rotation_euler=function(a,c,d,k){g[0]=c;g[1]=d;g[2]=k;e.set_rotation_euler(a,g);e.v(a);b.sync_transform(a)};a.set_rotation_euler_v=function(a,c){e.set_rotation_euler(a,c);e.v(a);b.sync_transform(a)};a.set_scale=function(a,b){e.set_scale(a,b);e.v(a)};a.get_scale=function(a){return e.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return c.error("Wrong object: "+a.name),!1;e.set_translation(a,[0,0,0]);e.set_rotation(a,[0,0,0,1]);e.set_scale(a,1);e.v(a);b.sync_transform(a)};
a.get_object_size=function(a){return d.is_mesh(a)?e.get_object_size(a):(c.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,b,g){return d.is_mesh(a)?e.get_object_center(a,b,g):(c.error("Wrong object: "+a.name),null)};a.move_local=function(a,c,d,g){e.move_local(a,c,d,g);e.v(a);b.sync_transform(a)};a.get_object_bounding_box=function(a){return e.get_object_bounding_box(a)}};b4w.module.util=function(a,p){var c=p("__print"),b=p("__util"),e=p("vec3");p("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=b.keyfind;a.keysearch=b.keysearch;a.matrix_to_quat=function(a){return b.matrix_to_quat(a)};a.euler_to_quat=function(a,c){c||(c=new Float32Array(4));return b.euler_to_quat(a,c)};a.quat_to_euler=
function(a,c){c||(c=new Float32Array(3));return b.quat_to_euler(a,c)};a.sign=b.sign;a.clamp=b.clamp;a.quat_to_dir=b.quat_to_dir;a.ground_project_quat=function(a,c){return b.quat_project(a,b.AXIS_MY,b.AXIS_Y,b.AXIS_MZ,c)};a.cam_quat_to_mesh_quat=function(a,c){return b.cam_quat_to_mesh_quat(a,c)};a.quat_project=function(a,g,k,f,m){return 0!=e.dot(k,f)?(c.error("Wrong in-plane direction"),null):b.quat_project(a,g,k,f,m)};a.hash_code=b.hash_code;a.smooth=b.smooth;a.smooth_v=b.smooth_v;a.is_vector=b.is_vector;
a.correct_cam_quat_up=b.correct_cam_quat_up;a.quat_to_angle_axis=b.quat_to_angle_axis;a.random_from_array=b.random_from_array;a.xz_direction=b.xz_direction;a.line_plane_intersect=b.line_plane_intersect;a.is_mesh=b.is_mesh};"object"==typeof module&&module.gl&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){var c=p("__version");a.version=c.version;a.type=c.type;a.date=c.date};"object"==typeof module&&module.gl&&b4w.module.version(exports);b4w.module.objects=function(a,p){var c=p("__objects");a.get_meta_tags=function(a){if(a&&a.b4w_object_tags)return c.get_meta_tags(a)}};b4w.module.main=function(a,p){function c(){}function b(){}function e(){}function d(){window.performance||(D.log("Apply performance workaround"),window.performance={});var a=Date.now();if(window.performance.now)b=a-performance.now();else{D.log("Apply performance.now() workaround");window.performance.now=function(){return Date.now()-a};var b=a}K.Uq(0);return b}function g(a,c){a.addEventListener("webglcontextlost",function(a){a.preventDefault();D.error("B4W Error: WebGL context lost");h()},!1);G.ec(c);
var d=G.mp();d&&D.log("%cRENDERER INFO:","color: #00a",c.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+c.getParameter(d.UNMASKED_RENDERER_WEBGL));L.ec(c);t.ec(c);U.ec(c);F.ec(c);A.ec(c);z.ec(c);Z.Yq(a.width,a.height,1,k("x"),k("y"));J.init();b=v();n()}function k(a){if("x"==a)var b=X.offsetLeft;else if("y"==a)b=X.offsetTop;else return 0;return f(b,X,a)}function f(a,b,c){a=a||0;if(b=b.offsetParent){if("x"==c)var d=b.offsetLeft;else"y"==c&&(d=b.offsetTop);a=f(a+d,b,c)}return a}function m(){c=function(){}}
function h(){r()||(fa=performance.now()/1E3,J.pause(),H.pause(),U.pause())}function r(){return ja<fa}function n(){qa(n);var a=performance.now()/1E3;w||(w=a);var c=a-w;if(!(c<1/ca.me)){for(var d=K.pg(),e=0;e<N.length;e++)N[e](d,c);r()||(ja>w&&(c-=ja-Math.max(fa,w)),d+=c,K.Uq(d),A.update(),y.update(),z.update(),x(d,c),b(c));w=a}}function x(a,b){z.is_primary_loaded()&&(B.reset(),S.update(b),O.update(a,b),J.update(a,b),u.update(b),z.is_primary_loaded()&&(H.update(a,b),z.is_primary_loaded()&&(c(b,a),z.is_primary_loaded()&&
(l.update(a,b),z.is_primary_loaded()&&(Z.update(a,b),I&&(I(X.toDataURL()),I=null))))))}function v(){var a=60,b=0,c=0,d=ca.Hv,f=ca.Gv;return function(g){a=T.smooth(1/g,a,g,d);b=T.smooth(0,b,g,d);c=(c+1)%f;0==c&&e(Math.round(a),Math.round(b))}}var u=p("__animation"),E=p("__compat"),q=p("__config"),D=p("__print"),l=p("__controls"),z=p("__data"),A=p("__debug"),G=p("__extensions"),t=p("__geometry"),B=p("__hud"),O=p("__nla"),y=p("__assets"),H=p("__physics"),L=p("__renderer"),Z=p("__scenes"),J=p("__sfx"),
F=p("__shaders"),U=p("__textures"),K=p("__time"),S=p("__transform"),T=p("__util"),ba=p("__version"),P=q.context,ca=q.p,X=null,aa=null,w=0,fa=0,ja=0,N=[],I=null,Y=["webgl","experimental-webgl"],ga=null,qa=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/ca.me)}}();a.init=function(a,b){q.wy();D.By(ca.console_verbose);var c=ba.version()+
" "+ba.type()+" ("+ba.date()+")";D.log("%cINIT B4W ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;c=d();X=a;E.Gt();var e;e=null;for(var f=0;f<Y.length;f++){var h=Y[f];try{e=a.getContext(h,P)}catch(k){}if(e)break}if(!e)return null;ga=e;g(X,e);q.It();E.qy(e);D.log("%cSET PRECISION:","color: #00a",ca.precision);b?(B.init(b),aa=b):(q.p.show_hud_debug_info=!1,q.Ld.Fj=!1);H.Sw(c);return e};a.set_check_gl_errors=function(a){A.set_check_gl_errors(a)};a.resize=function(a,b,c){!1!==c&&
(X.style.width=a+"px",X.style.height=b+"px",aa&&(aa.style.width=a+"px",aa.style.height=b+"px"));aa&&(aa.width=a,aa.height=b,B.$g());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))ca.canvas_resolution_factor=1;c=a*ca.canvas_resolution_factor;b*=ca.canvas_resolution_factor;ca.allow_hidpi&&1<window.devicePixelRatio&&(c*=window.devicePixelRatio,b*=window.devicePixelRatio);X.width=c;X.height=b;if(c>ga.drawingBufferWidth||b>ga.drawingBufferHeight){D.warn("B4W Warning: canvas size exceeds platform limits, downscaling");
var d=Math.min(ga.drawingBufferWidth/c,ga.drawingBufferHeight/b);c*=d;b*=d;X.width=c;X.height=b}Z.Yq(c,b,c/a,k("x"),k("y"));x(K.pg(),0);z.Cz(X.width,X.height)};a.set_fps_callback=function(a){e=a};a.clear_fps_callback=function(){e=function(){}};a.set_on_before_render_callback=function(a){c=a};a.set_render_callback=function(a){c=a};a.clear_on_before_render_callback=function(){m()};a.clear_render_callback=function(){m()};a.global_timeline=function(){return K.pg()};a.redraw=function(){x(K.pg(),0)};a.pause=
h;a.resume=function(){r()&&(ja=performance.now()/1E3,J.resume(),H.resume(),U.play(!0))};a.is_paused=r;a.reset=function(){z.unload(0);H.reset();aa=X=null;ja=fa=w=0;e=function(){};b=function(){};c=function(){};N.length=0;ga=null;K.reset()};a.canvas_data_url=function(a){I=a};a.get_canvas_elem=function(){return X};a.set_texture_quality=function(){T.fa("set_texture_quality() deprecated")};a.set_shaders_dir=function(){T.fa("set_shaders_dir() deprecated")};a.detect_mobile=function(){return E.detect_mobile()};
a.append_loop_cb=function(a){for(var b=0;b<N.length;b++)if(N[b]==a)return;N.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<N.length;b++)if(N[b]==a){N.splice(b,1);break}}};
