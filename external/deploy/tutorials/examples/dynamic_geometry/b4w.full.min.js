b4w={module:{},register:function(a,m){var b=b4w.module;if(b[a])throw Error('Module "'+a+'" already registered');b[a]=m},require:function(a){var m=b4w.require,b=b4w.module[a];if(!b)throw Error('Module "'+a+'" not found');b.Sj||(b.Sj={},b(b.Sj,m));return b.Sj},module_check:function(a){return b4w.module[a]?!0:!1}};"object"==typeof module&&module.Dk&&(GLOBAL.b4w={module:{}});b4w.module.__version=function(a){function m(){return"25.09.2014 06:03:42"}a.version=function(){return"14.09"};a.type=function(){return"RELEASE"};a.date=m;a.timestamp=function(){var a=m(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.Dk&&b4w.module.__version(exports);b4w.module.__config=function(a,m){function b(b,h){switch(b){case "all_objs_selectable":a.p.all_objs_selectable=h;break;case "alpha":a.context.alpha=h;break;case "alpha_sort":a.p.alpha_sort=h;break;case "alpha_sort_threshold":a.p.alpha_sort_threshold=h;break;case "anaglyph_use":a.p.anaglyph_use=h;break;case "animation_framerate":a.Ae.Xa=h;break;case "antialiasing":a.p.antialiasing=h;break;case "assets_dds_available":a.Dd.yk=h;break;case "assets_min50_available":a.Dd.jl=h;break;case "background_color":a.p.background_color=
h;break;case "built_in_module_name":a.rb.oi=h;break;case "console_verbose":a.p.console_verbose=h;break;case "context_antialias":a.context.antialias=h;break;case "debug_subs_enabled":a.dh.enabled=h;break;case "deferred_rendering":a.p.deferred_rendering=h;break;case "do_not_load_resources":a.p.do_not_load_resources=h;break;case "force_selectable":a.p.force_selectable=h;break;case "glow":a.p.glow=h;break;case "physics_enabled":a.Za.enabled=h;break;case "physics_uranium_path":a.Za.Uh=h;break;case "precision":a.p.precision=
h;break;case "quality":a.p.quality=h;break;case "resolution_factor":a.p.resolution_factor=h;break;case "sfx_mix_mode":a.lg.aj=h;break;case "shaders_dir":a.rb.shaders_dir=h;break;case "show_hud_debug_info":a.p.show_hud_debug_info=h;break;case "smaa":a.p.smaa=h;break;case "smaa_search_texture_path":a.rb.smaa_search_texture_path=h;break;case "smaa_area_texture_path":a.rb.smaa_area_texture_path=h;break;case "wireframe_debug":a.p.wireframe_debug=h;break;default:c.error("B4W config set - property unknown: "+
b)}}var c=m("__print"),h=m("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.gt=h.sa(a.context);a.p={alpha_sort:!0,alpha_sort_threshold:.1,Ro:5,Ud:1E4,console_verbose:!1,do_not_load_resources:!1,Lj:!1,uu:1.5,tu:10,background_color:[0,0,0,0],force_selectable:!1,all_objs_selectable:!1,ff:.01,resolution_factor:1,Aj:3,hi:!0,show_hud_debug_info:!1,mz:!0,ce:"DEPTH",anaglyph_use:!1,pj:!0,Nh:.5,$d:!0,glow:!0,wf:!0,Mf:!0,Wf:!0,Gf:!0,cg:!0,Jf:!0,
antialiasing:!0,smaa:!1,wireframe_debug:!1,Qf:!0,Ch:!0,xa:!0,Ih:!0,water_dynamic:!0,shore_smoothing:!0,mg:!0,il:1024,max_bones:53,uq:!0,precision:"highp",deferred_rendering:!0,quality:a.P_HIGH,Vj:!0,Ue:!1,Zv:!1,Fl:!1,Cn:!1,yq:!1};a.Wt=h.sa(a.p);a.Ae={Xa:24,Mn:!1,Se:1};a.controls={Ns:[5,5,5,5],Os:.1,Xv:1/120};a.Dd={Rv:15,up:!0,jl:!1,yk:!1};a.zs=h.sa(a.Dd);a.rb={shaders_dir:"../../shaders/",bx:"include/",Op:"shader_texts",oi:"built_in_data",smaa_search_texture_path:"",smaa_area_texture_path:"",zw:"./",
Cp:["b4w.min.js","b4w.full.min.js","embed.min.js","src/data.js"]};a.Za={enabled:!0,Ud:60,Uh:""};a.fw=h.sa(a.Za);a.ig={zh:1024,Ni:1024,ah:384};a.Gw=h.sa(a.ig);a.lg={oy:!0,aj:!1};a.ax=h.sa(a.lg);a.dh={enabled:!1,Dx:"MAIN_OPAQUE",Cx:0,ex:"COLOR"};a.Rt=h.sa(a.dh);a.ws=function(){var b=a.p,c=a.Za,k=a.ig;switch(b.quality){case a.P_ULTRA:b.ce="DEPTH";b.shore_smoothing=!0;b.glow=!0;b.wf=!0;b.Mf=!0;b.Wf=!0;b.Gf=!0;b.pj=!0;b.Nh=1;b.$d=!0;b.Qf=!0;b.Ch=!0;b.xa=!0;b.Ih=!0;b.resolution_factor=1.75;k.zh=2048;k.Ni=
2048;b.Aj=3;b.hi=!0;b.Lj=!1;b.max_bones=53;b.precision="highp";b.water_dynamic=!0;b.mg=!0;b.antialiasing=!0;b.smaa=!0;b.Jf=!0;b.cg=!0;c.Ud=120;break;case a.P_HIGH:b.ce="DEPTH";b.shore_smoothing=!0;b.glow=!0;b.wf=!0;b.Mf=!0;b.Wf=!0;b.Gf=!0;b.pj=!0;b.Nh=.5;b.$d=!0;b.Qf=!0;b.Ch=!0;b.xa=!0;b.Ih=!0;b.resolution_factor=1;k.zh=1024;k.Ni=1024;b.Aj=3;b.hi=!0;b.Lj=!1;b.max_bones=53;b.precision="highp";b.water_dynamic=!0;b.mg=!0;b.antialiasing=!0;b.smaa=!1;b.Jf=!0;b.cg=!0;c.Ud=60;break;case a.P_LOW:b.ce="NONE",
b.shore_smoothing=!1,b.glow=!1,b.wf=!1,b.Mf=!1,b.Wf=!1,b.Gf=!1,b.pj=!1,b.Nh=.5,b.$d=!1,b.Qf=!1,b.Ch=!1,b.xa=!1,b.Ih=!1,b.resolution_factor=1,k.zh=512,k.Ni=512,b.Aj=2,b.hi=!1,b.Lj=!0,b.max_bones=53,b.precision="mediump",b.water_dynamic=!1,b.mg=!1,b.antialiasing=!1,b.smaa=!1,b.Jf=!1,b.cg=!1,c.Ud=60}};a.set=b;a.get=function(b){switch(b){case "all_objs_selectable":return a.p.all_objs_selectable;case "alpha":return a.context.alpha;case "alpha_sort":return a.p.alpha_sort;case "alpha_sort_threshold":return a.p.alpha_sort_threshold;
case "anaglyph_use":return a.p.anaglyph_use;case "animation_framerate":return a.Ae.Xa;case "antialiasing":return a.p.antialiasing;case "assets_dds_available":return a.Dd.yk;case "assets_min50_available":return a.Dd.jl;case "background_color":return a.p.background_color;case "built_in_module_name":return a.rb.oi;case "console_verbose":return a.p.console_verbose;case "context_antialias":return a.context.antialias;case "debug_subs_enabled":return a.dh.enabled;case "deferred_rendering":return a.p.deferred_rendering;
case "do_not_load_resources":return a.p.do_not_load_resources;case "force_selectable":return a.p.force_selectable;case "glow":return a.p.glow;case "physics_enabled":return a.Za.enabled;case "physics_uranium_path":return a.Za.Uh;case "precision":return a.p.precision;case "quality":return a.p.quality;case "resolution_factor":return a.p.resolution_factor;case "sfx_mix_mode":return a.lg.aj;case "shaders_dir":return a.rb.shaders_dir;case "show_hud_debug_info":return a.p.show_hud_debug_info;case "smaa":return a.p.smaa;
case "smaa_search_texture_path":return a.rb.smaa_search_texture_path;case "smaa_area_texture_path":return a.rb.smaa_area_texture_path;case "wireframe_debug":return a.p.wireframe_debug;default:c.error("B4W config get - property unknown: "+b)}};a.reset=function(){a.context=h.sa(a.gt);a.p=h.sa(a.Wt);a.Dd=h.sa(a.zs);a.Za=h.sa(a.fw);a.ig=h.sa(a.Gw);a.lg=h.sa(a.ax);a.dh=h.sa(a.Rt)};a.Tw=function(){var c=a.rb,h=a.Za;if(""==c.smaa_search_texture_path||""==c.smaa_area_texture_path||""==h.Uh){for(var k=null,
g=document.getElementsByTagName("script"),e=0;e<g.length;e++){for(var n=g[e].src,z=0;z<c.Cp.length;z++)if(0<=n.indexOf(c.Cp[z])){k=n;break}if(null!==k)break}k=k||document.location.href;g=k.indexOf("?");0<=g&&(k=k.substring(0,g));k=k.substring(0,k.lastIndexOf("/")+1)+c.zw;b("physics_uranium_path",h.Uh||k+"uranium.js");b("smaa_search_texture_path",c.smaa_search_texture_path||k+"smaa_search_texture.png");b("smaa_area_texture_path",c.smaa_area_texture_path||k+"smaa_area_texture.png")}}};b4w.module.__boundings=function(a,m){function b(a,b){for(var c=a[0],p=a[1],f=a[2],e=a[0],d=a[1],g=a[2],k=3;k<a.length;k+=3)var h=a[k],n=a[k+1],y=a[k+2],c=Math.max(c,h),p=Math.max(p,n),f=Math.max(f,y),e=Math.min(e,h),d=Math.min(d,n),g=Math.min(g,y);b.max_x=c;b.max_y=p;b.max_z=f;b.min_x=e;b.min_y=d;b.min_z=g;return b}function c(a,b){b||(b=new Float32Array(24));var c=a.max_x,p=a.max_y,f=a.max_z,e=a.min_x,d=a.min_y,g=a.min_z;b[0]=e;b[1]=d;b[2]=g;b[3]=c;b[4]=d;b[5]=g;b[6]=c;b[7]=p;b[8]=g;b[9]=e;b[10]=
p;b[11]=g;b[12]=e;b[13]=d;b[14]=f;b[15]=c;b[16]=d;b[17]=f;b[18]=c;b[19]=p;b[20]=f;b[21]=e;b[22]=p;b[23]=f;return b}function h(a,b,c){g.add(b,c,a.s);g.scale(a.s,.5,a.s);a.na=g.distance(a.s,b);return a}var d=m("__geometry"),l=m("__util"),k=m("__tsr"),g=m("vec3"),e=new Float32Array(24),n=new Float32Array(3),z=new Float32Array(3),f=new Float32Array(3);a.ht=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.Ty=function(){return{max_x:1E12,min_x:-1E12,
max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.yd=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.En=function(a,b){var c=a.max_y,p=a.max_z,f=a.min_x,e=a.min_y,d=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,p);a.min_x=Math.min(b.min_x,f);a.min_y=Math.min(b.min_y,e);a.min_z=Math.min(b.min_z,d)};a.Sy=b;a.fk=function(f,d,r){r||(r=a.yd());f=c(f,e);l.rf(f,d,f);return b(f,r)};a.ku=c;a.BA=function(b,c,f){f||
(f=a.yd());var p=c.min_x,e=c.max_x,d=c.min_y,g=c.max_y,k=c.min_z;c=c.max_z;if(p>=b.max_x||e<=b.min_x||d>=b.max_y||g<=b.min_y||k>=b.max_z||c<=b.min_z)return f.min_x=-.1,f.max_x=.1,f.min_y=-.1,f.max_y=.1,f.min_z=-.2,f.max_z=-.1,f;f.min_x=Math.max(b.min_x,p);f.max_x=Math.min(b.max_x,e);f.min_y=Math.max(b.min_y,d);f.max_y=Math.min(b.max_y,g);f.min_z=Math.max(b.min_z,k);f.max_z=Math.min(b.max_z,c);return f};a.FA=function(b,c,f){f||(f=a.yd());var p=b.max_x-b.min_x,e=b.max_y-b.min_y,d=b.max_z-b.min_z;f.min_x=
b.min_x-.5*(c-1)*p;f.max_x=b.max_x+.5*(c-1)*p;f.min_y=b.min_y-.5*(c-1)*e;f.max_y=b.max_y+.5*(c-1)*e;f.min_z=b.min_z-.5*(c-1)*d;f.max_z=b.max_z+.5*(c-1)*d;return f};a.hk=function(b,c,f){f||(f=a.ai());g.transformMat4(b.s,c,f.s);f.na=b.na*l.Xi(c);return f};a.gk=function(a,b,c){c||(c={Ce:new Float32Array(3),De:new Float32Array(3),Ee:new Float32Array(3),s:new Float32Array([0,0,0])});k.Th(a.s,b,c.s);g.copy(a.Ce,c.Ce);g.copy(a.De,c.De);g.copy(a.Ee,c.Ee);k.Cj(c.Ce,b,c.Ce);k.Cj(c.De,b,c.De);k.Cj(c.Ee,b,c.Ee);
return c};a.sk=function(a,b){return{na:a,s:new Float32Array(b)}};a.ai=function(){return{s:new Float32Array([0,0,0]),na:0}};a.rk=function(a,b,c,f){return{Ce:new Float32Array(a),De:new Float32Array(b),Ee:new Float32Array(c),s:new Float32Array([f[0],f[1],f[2]])}};a.Fs=function(){return{s:new Float32Array([0,0,0]),na:1E12}};a.iu=function(a,b){var c=g.subtract(b.s,a.s,g.create());0==g.length(c)&&g.set(1,0,0,c);var f=g.normalize(c,g.create()),c=g.scale(f,a.na,g.create());g.add(c,a.s,c);var e=g.scale(f,
-a.na,g.create());g.add(e,a.s,e);var d=g.scale(f,b.na,g.create());g.add(d,b.s,d);var k=g.scale(f,-b.na,g.create());g.add(k,b.s,k);c=[c,e,d,k];f=g.normalize(f,g.create());e=c[0];d=c[0];for(k=1;k<c.length;k++){var h=g.dot(c[k],f);h<g.dot(e,f)&&(e=c[k]);h>g.dot(d,f)&&(d=c[k])}f=[e,d];c=f[0];f=f[1];a.s=g.scale(g.add(c,f,g.create()),.5,g.create());a.na=g.length(g.subtract(f,c,g.create()))/2};a.pn=function(a,b){var c=b.max_y,f=b.min_y,e=Math.max(0,c-f-2*a);return{na:a,height:e,s:new Float32Array([0,(c+
f)/2,0])}};a.rn=function(a,b){var c=b.max_y,f=b.min_y,e=Math.max(0,c-f);return{na:a,height:e,s:new Float32Array([0,(c+f)/2,0])}};a.qn=function(a,b){var c=b.max_y,f=b.min_y,e=Math.max(0,c-f);return{na:a,height:e,s:new Float32Array([0,(c+f)/2,0])}};a.Wy=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.rw=function(a){for(var b=0,c=0,f=0,e=0,d=0,g=0,k=0,h=0,n=0;n<a.submeshes.length;n++){var l=a.submeshes[n];if(l.position.length){b=
e=l.position[0];c=d=l.position[1];f=g=l.position[2];break}}for(n=0;n<a.submeshes.length;n++)for(var l=a.submeshes[n],l=l.position,y=0;y<l.length/3;y++)var C=l[3*y],B=l[3*y+1],G=l[3*y+2],b=Math.max(C,b),c=Math.max(B,c),f=Math.max(G,f),e=Math.min(C,e),d=Math.min(B,d),g=Math.min(G,g),k=Math.max(Math.sqrt(C*C+B*B+G*G),k),h=Math.max(Math.sqrt(C*C+G*G),h);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=e;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=d;a.b4w_bounding_box.max_z=f;a.b4w_bounding_box.min_z=
g;a.b4w_bounding_sphere_radius=k;a.b4w_bounding_cylinder_radius=h};a.Yu=function(b){var c=b.subarray(0,3),e=b.subarray(6,9),p=b.subarray(12,15),k=b.subarray(18,21);b=g.subtract(e,c,n);g.normalize(b,b);var q=d.$u(c,e,p,z),q=g.cross(q,b,q);g.normalize(q,q);var v=g.create(),l=g.create();g.subtract(e,c,f);l[0]=g.dot(f,b);l[1]=g.dot(f,q);e=g.create();g.subtract(p,c,f);e[0]=g.dot(f,b);e[1]=g.dot(f,q);p=g.create();g.subtract(k,c,f);p[0]=g.dot(f,b);p[1]=g.dot(f,q);k=a.ai();p=[v,l,e,p];v=h(k,p[0],p[1]);for(k=
2;k<p.length;k++)if(g.distance(v.s,p[k])>v.na){for(var A=v,v=p,l=p[k],e=k-1,A=h(A,l,v[0]),L=1;L<=e;L++)if(g.distance(A.s,v[L])>A.na){for(var I=A,A=v,y=l,C=v[L],B=L-1,I=h(I,y,C),G=0;G<=B;G++)if(g.distance(I.s,A[G])>I.na){var K=y,N=C,V=A[G],U=g.subtract(N,V,f),U=g.squaredLength(U),O=g.subtract(K,V,f),J=g.squaredLength(O),O=g.subtract(K,N,f),m=g.squaredLength(O),O=U*(J+m-U),Y=J*(m+U-J),U=m*(U+J-m),J=O+Y+U;g.copy(K,I.s);g.scale(I.s,O/J,I.s);g.scaleAndAdd(I.s,N,Y/J,I.s);g.scaleAndAdd(I.s,V,U/J,I.s);I.na=
g.distance(I.s,K)}A=I}v=A}k=v;b=g.scale(b,k.s[0],f);g.scaleAndAdd(b,q,k.s[1],b);g.add(b,c,k.s);return k}};b4w.module.__compat=function(a,m){function b(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}var c=m("__config"),h=m("__extensions"),d=m("__print"),l=m("__util");a.Qw=function(a){var g=c.Ae,e=c.p,n=c.context,z=c.ig;e.il=a.getParameter(a.MAX_TEXTURE_SIZE);var f=Boolean(h.Vu());b("Firefox/28.0")&&(b("Linux")||b("Macintosh"))&&(d.warn("Firefox 28 detected, applying depth hack"),f=!1);if(b("iPad")||b("iPhone"))d.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance."),
n.alpha||(e.background_color[3]=1),e.yq=!0,e.smaa=!1,e.wf=!1;if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))d.warn("Mobile detected, applying glsl loops unroll hack"),e.Ue=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&(d.warn("Not enough varyings, disable shadows on blend objects"),
e.Cn=!0);if(n=h.Zn())b("Macintosh")&&-1<a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(d.warn("OS X / Intel HD 3000 detected, applying depth and glsl loops unroll hacks"),f=!1,e.Ue=!0),-1<a.getParameter(n.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(f=!1,g.Mn=!0),-1<a.getParameter(n.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(d.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),
e.precision="highp",e.ce="NONE"),-1<a.getParameter(n.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&-1<a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(e.Fl=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(e.Vj=!1);f||(e.deferred_rendering=!1,e.Qf=!1,e.Ch=!1,e.xa=!1,e.Ih=!1,e.water_dynamic=!1,e.shore_smoothing=!1,e.mg=!1,e.smaa=!1);e.uq=Boolean(h.$n());g=l.clamp(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),128,Infinity);e.max_bones=l.trunc((g-50)/4);e.pA=l.trunc((g-50)/2);0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,
a.HIGH_FLOAT).precision&&(e.precision="mediump");!window.ActiveXObject&&"ActiveXObject"in window&&(d.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),z.ah=512)}};b4w.module.__constraints=function(a,m){function b(a){var b={};b.type=a;return b}function c(a,b){a.Sa&&a.Sa.L&&h(a.Sa.L,a);if(b.L){var c=b.L;if(-1==c.Ad.indexOf(a))c.Ad.push(a);else throw"Descendant object override is forbidden";}a.Sa=b}function h(a,b){var c=a.Ad.indexOf(b);if(-1!=c)a.Ad.splice(c,1);else throw"No descendant object";}function d(a,b,c){switch(b.type){case 1:var e=a.d.quat,d=b.L.d.I;c=b.L.d.quat;b.ae?(s.copy(b.ae,e),s.multiply(c,e,e)):s.copy(c,e);t.transformMat4(b.offset,d,a.d.e);a.d.scale=
b.Ip*b.L.d.scale;break;case 9:var h=a.d.e,e=a.d.quat,d=b.L.d.I;c=b.L.d.quat;s.multiply(s.invert(b.qf,b.qf),e,e);s.multiply(c,e,e);t.transformMat4(b.offset,d,h);s.copy(c,b.qf);break;case 10:h=a.d.e;e=a.d.quat;d=b.L.d.I;c=b.L.d.quat;s.multiply(s.invert(b.qf,b.qf),e,e);s.multiply(c,e,e);t.transformMat4(b.offset,d,h);s.copy(c,b.qf);var e=a.d.quat,h=b.L.d.quat,A=t.transformQuat(f.AXIS_Y,e,p),I=s.invert(h,x),m=t.transformQuat(A,I,F),P=q;P[0]=m[0];P[1]=0;P[2]=m[2];d=t.length(P);I=-P[2]/d;I=Math.acos(I)*
f.sign(P[0]);d/=t.length(m);d=Math.acos(d)*f.sign(m[1]);m=!1;I<-b.dn&&(I=-b.dn,m=!0);I>b.en&&(I=b.en,m=!0);d<-b.fn&&(d=-b.fn,m=!0);d>b.cn&&(d=b.cn,m=!0);m&&(b=Math.sin(d),d=Math.cos(d),m=Math.sin(I),I=Math.cos(I),P=F,P[0]=d*m,P[1]=b,P[2]=-d*I,t.transformQuat(P,h,P),b=s.rotationTo(A,P,x),s.multiply(b,e,e),s.normalize(e,e));"CAMERA"==a.d.type&&(b=t.transformQuat(f.AXIS_Y,c,F),g(a,b));break;case 12:h=a.d.e;e=a.d.quat;d=b.L.d.I;I=b.L.d.e;a=b.hx;m=p;A=x;t.transformMat4(b.offset,d,m);f.smooth_v(m,h,c,a,
h);b=p;t.sub(I,h,b);t.normalize(b,b);P=e;h=y;I=h.subarray(0,3);d=h.subarray(3,6);m=h.subarray(6,9);t.copy(b,d);t.negate(d,d);t.normalize(d,d);Boolean(.999999<Math.abs(t.dot(b,f.AXIS_Y)))?(b=r.fromQuat(s.normalize(P,A),C),t.copy(b.subarray(0,3),I)):t.cross(f.AXIS_Y,d,I);t.normalize(I,I);t.cross(I,d,m);t.normalize(m,m);s.fromMat3(h,A);s.normalize(A,A);f.Sp(A,e,c,.16*a,e);break;case 2:e=a.d.quat;I=v;c=x;n(b.L,b.Is,!0,I,c);b.ae?(s.copy(b.ae,e),s.multiply(c,e,e)):s.copy(c,e);f.Th(b.offset,1,c,I,a.d.e);
break;case 3:h=a.d.e;e=a.d.quat;c=b.L.d.e;l(h,e,c);"CAMERA"==a.d.type&&g(a,f.AXIS_Y);break;case 4:h=a.d.e;e=a.d.quat;c=b.target;l(h,e,c);"CAMERA"==a.d.type&&g(a,f.AXIS_Y);break;case 5:h=a.d.e;e=a.d.quat;c=b.L.d.e;e=k(h,e,c,b.td,B);A=t.dist(h,c);if(b=e?A+b.td:A>b.Ah?A-b.Ah:A<b.td?A-b.td:0)t.sub(c,h,p),t.normalize(p,p),t.scale(p,b,p),t.add(h,p,h);"CAMERA"==a.d.type&&g(a,f.AXIS_Y);break;case 6:h=a.d.e;e=a.d.quat;c=b.target;e=k(h,e,c,b.td,B);A=t.dist(h,c);if(b=e?A+b.td:A>b.Ah?A-b.Ah:A<b.td?A-b.td:0)t.sub(c,
h,p),t.normalize(p,p),t.scale(p,b,p),t.add(h,p,h);"CAMERA"==a.d.type&&g(a,f.AXIS_Y);break;case 7:d=b.L.d.I;t.transformMat4(b.offset,d,a.d.e);break;case 8:I=b.L.d.e;h=a.d.e;t.add(I,b.offset,h);break;case 13:e=a.d.quat;d=b.L.d.I;c=b.L.d.quat;b.ae?(s.copy(b.ae,e),s.multiply(c,e,e)):s.copy(c,e);t.transformMat4(b.offset,d,a.d.e);break;case 11:c=b.L.d,c=z.Kf(c.e,c.scale,c.quat,L),z.multiply(c,b.oq,c),h=a.d.e,h[0]=c[0],h[1]=c[1],h[2]=c[2],a.d.scale=c[3],e=a.d.quat,e[0]=c[4],e[1]=c[5],e[2]=c[6],e[3]=c[7]}}
function l(a,b,c){var B=p;f.quat_to_dir(b,f.AXIS_MY,B);t.normalize(B,B);var e=F;t.subtract(c,a,e);t.normalize(e,e);a=v;f.Hp(B,e,a);s.multiply(a,b,b)}function k(a,b,c,B,e){var d=!1,C=p;f.quat_to_dir(b,f.AXIS_MY,C);t.normalize(C,C);var g=F;t.subtract(c,a,g);a=t.length(g);t.normalize(g,g);t.dot(C,g)<Math.cos(e)&&(t.scale(g,-1,g),d=!0);a>B-.001&&(B=f.Hp(C,g,v),s.multiply(B,b,b),s.normalize(b,b));return d}function g(a,b){var c=a.d.quat,B=e(c,b,x);s.multiply(B,c,c)}function e(a,b,c){a=r.fromQuat(a,y);var B=
p;B[0]=a[3];B[1]=a[4];B[2]=a[5];if(.999<Math.abs(t.dot(b,B)))return s.identity(c),c;b=t.cross(b,B,B);t.normalize(b,b);0<a[7]&&(b[0]*=-1,b[1]*=-1,b[2]*=-1);B=F;B[0]=a[0];B[1]=a[1];B[2]=a[2];t.normalize(B,B);s.rotationTo(B,b,c);return c}function n(a,b,c,B,e){var f=a.d,d=f.Re,p=f.$b[b];b=p.eh;a=a.pose.bones[p.ul];var p=a.wm,C=v,g=f.Xb,r=f.Wb,k=f.Qb,q=f.Pb,F=g[4*b+1],h=g[4*b+2],n=g[4*b+3],l=r[4*b+1],w=r[4*b+2],u=r[4*b+3];C[0]=(1-d)*g[4*b]+d*r[4*b];C[1]=(1-d)*F+d*l;C[2]=(1-d)*h+d*w;C[3]=(1-d)*n+d*u;g=
x;r=A;g[0]=k[4*b];g[1]=k[4*b+1];g[2]=k[4*b+2];g[3]=k[4*b+3];r[0]=q[4*b];r[1]=q[4*b+1];r[2]=q[4*b+2];r[3]=q[4*b+3];s.slerp(g,r,d,g);d=L;z.Xw(C,d);z.El(g,d);c?(c=I,z.translate(p,a.as,c),z.multiply(d,c,d)):z.multiply(d,p,d);z.multiply(f.Qc,d,d);B[0]=d[0];B[1]=d[1];B[2]=d[2];B[3]=d[3];e&&(e[0]=d[4],e[1]=d[5],e[2]=d[6],e[3]=d[7])}var z=m("__tsr"),f=m("__util"),t=m("vec3"),s=m("quat"),r=m("mat3");m("mat4");a.zy=1;a.yy=2;a.Cy=3;a.Dy=4;a.ty=5;a.uy=6;a.Ay=7;a.sy=8;a.xy=9;a.wy=10;a.Uc=11;a.vy=12;a.By=13;var p=
new Float32Array(3),F=new Float32Array(3),q=new Float32Array(3),v=new Float32Array(4),x=new Float32Array(4),A=new Float32Array(4),L=new Float32Array(16),I=new Float32Array(16),y=new Float32Array(9),C=new Float32Array(9),L=new Float32Array(8),B=9*Math.PI/10;a.Jq=B;a.Em=function(a,B,e,f,p){var g=b(1);g.L=B;g.offset=new Float32Array(e);g.Ip=p||1;g.ae=f?new Float32Array(f):null;c(a,g);d(a,g,0)};a.Dm=function(a,B,e,f,p){var g=b(2);g.L=B;g.Is=e;g.offset=new Float32Array(f);g.ae=p?new Float32Array(p):null;
c(a,g);d(a,g,0)};a.os=function(a,B,e,f){var p=b(9),g=a.d.quat,C=B.d.quat;p.L=B;p.offset=new Float32Array(e);p.qf=new Float32Array(C);f&&(s.copy(f,g),s.multiply(C,g,g));c(a,p);d(a,p,0)};a.ns=function(a,B,e,f,p,g,C,r){var k=b(10),q=a.d.quat,F=B.d.quat;k.L=B;k.offset=new Float32Array(e);k.qf=new Float32Array(F);k.dn=p;k.en=g;k.fn=C;k.cn=r;f&&(s.copy(f,q),s.multiply(F,q,q));c(a,k);d(a,k,0)};a.ms=function(a,B,e,f){var p=b(12);p.L=B;p.offset=new Float32Array(e);p.hx=f;c(a,p);d(a,p,0)};a.qs=function(a,B,
e,f){var p=b(13);p.L=B;p.offset=new Float32Array(e);p.Ip=1;p.ae=f?new Float32Array(f):null;c(a,p);d(a,p,0)};a.ss=function(a,B){var e=b(3);e.L=B;c(a,e);d(a,e,0)};a.ts=function(a,B){var e=b(4);e.target=new Float32Array(B);c(a,e);d(a,e,0)};a.js=function(a,B,e,f){var p=b(5);p.L=B;p.td=e;p.Ah=f;c(a,p);d(a,p,0)};a.ks=function(a,B,e,f){var p=b(6);p.target=new Float32Array(B);p.td=e;p.Ah=f;c(a,p);d(a,p,0)};a.ps=function(a,B,e){var f=b(7);f.L=B;f.offset=new Float32Array(e);c(a,f);d(a,f,0)};a.hs=function(a,
B,e){var f=b(8);f.L=B;f.offset=new Float32Array(e);c(a,f);d(a,f,0)};a.gs=function(a,B,e){var f=b(11);f.L=B;f.oq=new Float32Array(e);c(a,f);d(a,f,0)};a.Tx=function(a,b){a.Sa&&d(a,a.Sa,b)};a.Aw=l;a.Bw=k;a.correct_up=g;a.Uy=e;a.remove=function(a){a.Sa.L&&h(a.Sa.L,a);a.Sa=null};a.md=function(a){return a.Sa?a.Sa.type:null};a.Kz=function(a){return a.Sa&&a.Sa.L?a.Sa.L:null};a.ld=function(a){return a.Sa&&11==a.Sa.type?a.Sa.oq:null};a.Qu=n};b4w.module.__controls=function(a,m){function b(a){return{type:a,value:0,fc:null,el:null,dl:null,Wi:null,Kd:!1,key:0,Mb:"",ok:null,ll:!1,nk:function(){},mk:null,hn:function(){},Kc:null,Pl:new Float32Array(3),Ck:new Float32Array(3),cl:!1,yp:function(){},axis:"",Vb:0,Fg:new Float32Array(3),mj:new Float32Array(4),threshold:0,wp:new Float32Array(4),ji:0,ii:0,Gp:0,ki:0,Eh:0,Km:!1}}function c(a,b){var c;if(a.Wi){c=a.el;for(var B=a.dl,H=0;H<c.length;H++)B[H]=c[H].value;c=a.Wi(B)}else c=!1;c||(a.value=Number(b))}
function h(a){a=C.indexOf(a);-1<a?C.splice(a,1):q.error("Wrong object")}function d(a,b){for(var c=0,B=0;B<b.length;B++)for(var H=b[B].we,e=0;e<H.length;e++)for(var f=H[e].Hc,u=0;u<f.length;u++)f[u]===a&&c++;return c}function l(a,b){switch(a.type){case 80:v.remove_collision_test(a.ok,a.Mb,a.nk);a.Kd=!0;break;case 90:v.clear_collision_impulse_test(a.mk);a.Kd=!0;break;case 100:v.remove_ray_test(a.Kc,a.Mb,a.Pl,a.Ck,a.cl),a.Kd=!0}var c=b.indexOf(a);-1<c&&b.splice(c,1)}function k(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];
return a[a.length-1]}function g(a){for(var b=0;b<B.length;b++){var e=B[b];20==e.type&&a.keyCode==e.key&&c(e,1)}ia&&a.preventDefault()}function e(a){for(var b=0;b<B.length;b++){var e=B[b];20==e.type&&0==a.keyCode&&16==e.key&&c(e,0);20==e.type&&a.keyCode==e.key&&c(e,0)}ia&&a.preventDefault()}function n(a){for(var b=!1,e=null,f=0;f<B.length;f++){var H=B[f];50==H.type&&c(H,1);160==H.type&&(b||(e=x.pick_object(a.clientX,a.clientY),b=!0),H.value=e==H.Kc?1:0)}R&&a.preventDefault()}function z(a){for(var b=
0;b<B.length;b++){var e=B[b];50==e.type&&c(e,0);160==e.type&&e.Km&&(e.value=0)}R&&a.preventDefault()}function f(a){var b=a.clientX,e=a.clientY;N=b;V=e;for(var b=b-U,e=e-O,f=Math.sqrt(b*b+e*e),H=0;H<B.length;H++){var u=B[H];if(40===u.type)switch(u.axis){case "X":c(u,b);break;case "Y":c(u,e);break;case "XY":c(u,f)}}R&&a.preventDefault()}function t(a){var b=a.wheelDelta||-40*a.detail,b=b*y.Xv;K+=b;for(b=0;b<B.length;b++){var e=B[b];30===e.type&&c(e,K)}w&&a.preventDefault()}function s(a){a=a.targetTouches;
if(1==a.length){var b=a[0];a=b.pageX;for(var b=b.pageY,c=!1,e=null,H=0;H<B.length;H++){var f=B[H];160==f.type&&(c||(e=x.pick_object(a,b),c=!0),f.value=e==f.Kc)}Y[0]=a;Y[1]=-1;P[0]=b;P[1]=-1}else 1<a.length&&(X=Z=p(a),Y[0]=a[0].pageX,Y[1]=a[1].pageX,P[0]=a[0].pageY,P[1]=a[1].pageY);J.set(Y);Q.set(P)}function r(a){var b=a.targetTouches;if(0!==b.length){if(1===b.length){J[0]=b[0].pageX;J[1]=-1;Q[0]=b[0].pageY;Q[1]=-1;var b=J[0]-Y[0],e=Q[0]-P[0],f=Math.sqrt(b*b+e*e);if(-1!=Y[1]&&-1!=P[1]){var H=J[0]-
Y[1],d=Q[0]-P[1],g=Math.sqrt(H*H+d*d);g<f&&(b=H,e=d,f=g)}for(H=0;H<B.length;H++)if(d=B[H],60===d.type)switch(d.axis){case "X":c(d,b);break;case "Y":c(d,e);break;case "XY":c(d,f)}}else if(1<b.length)for(J[0]=b[0].pageX,J[1]=b[1].pageX,Q[0]=b[0].pageY,Q[1]=b[1].pageY,X=p(b),b=X-Z,H=0;H<B.length;H++)d=B[H],70===d.type&&c(d,b);u&&a.preventDefault()}}function p(a){var b=a[0],c=a[1];a=b.pageX;var b=b.pageY,e=c.pageX,c=c.pageY;return Math.sqrt((a-e)*(a-e)+(b-c)*(b-c))}var F=m("__config"),q=m("__print"),
v=m("__physics"),x=m("__scenes"),A=m("__util"),L=m("vec3"),I=m("quat"),y=F.controls,C=[],B=[],G={},K=0,N=0,V=0,U=0,O=0,J=new Float32Array(2),Q=new Float32Array(2),Y=new Float32Array(2),P=new Float32Array(2),X=0,Z=0,S=0,da=!1,D=0,ia=!1,R=!1,w=!1,u=!1;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.update=function(b,e){S=b;for(var f=0;f<B.length;f++){var u=B[f],H=b,d=e;if(d)switch(u.type){case 110:var p=u.Kc,g=p.d.e,p=p.d.quat,r=L.dist(u.Fg,g),k=u.wp;I.invert(u.mj,k);I.multiply(p,k,
k);I.normalize(k,k);k=Math.abs(2*Math.acos(k[3]));r/=d;u.ji=A.smooth(r,u.ji,d,.3);u.fc[0]=r;r=k/d;u.ii=A.smooth(r,u.ii,d,.3);u.fc[1]=r;u.ji>=u.threshold||u.ii>=u.Gp?c(u,1):c(u,0);L.copy(g,u.Fg);I.copy(p,u.mj);u.Vb=H;break;case 120:p=u.Kc;g=p.d.e;p=Math.abs(g[1]-u.Fg[1])/d;u.ki=A.smooth(p,u.ki,d,.3);u.fc=p;u.ki>=u.threshold?c(u,1):c(u,0);L.copy(g,u.Fg);u.Vb=H;break;case 130:H-u.Vb>=u.Eh&&(c(u,1),u.Vb=H);break;case 140:u.Vb||(u.Vb=H);c(u,H-u.Vb);u.Vb=H;break;case 150:c(u,H)}}for(f=0;f<C.length;f++)for(d=
C[f],u=d.we,H=0;H<u.length;H++)if(g=u[H],g.rq!=D){g.rq=D;for(var p=g,r=p.Hc,k=p.Lw,q=0;q<r.length;q++)k[q]=r[q].value;var p=p.Lv(k),r=g,k=r.Io,F=q=void 0;switch(r.type){case a.CT_CONTINUOUS:p?F=q=1:1==k?F=q=-1:q=0;break;case a.CT_TRIGGER:p&&-1==k?F=q=1:p||1!=k?q=0:F=q=-1;break;case a.CT_SHOT:p&&-1==k?F=q=1:p||1!=k?q=0:(q=0,F=-1);break;case a.CT_LEVEL:q=r.Ho!=p?1:0;break;default:A.ba("Wrong sensor manifold type: "+r.type)}F&&(r.Io=F);if(r=q)if(k=d==G?null:d,da=!1,g.callback(k,g.id,r,g.Ms),g.Ho=p,da){f=
-1;break}}for(f=0;f<C.length;f++)for(d=C[f],u=d.we,H=0;H<u.length;H++)for(g=u[H],d=g.Hc,g=0;g<d.length;g++)switch(p=d[g],p.type){case 30:c(p,0);break;case 40:c(p,0);break;case 60:c(p,0);break;case 70:c(p,0);break;case 130:c(p,0)}K=0;U=N;O=V;Y.set(J);P.set(Q);Z=X;D++};a.create_custom_sensor=function(a){var e=b(10);c(e,a);return e};a.create_keyboard_sensor=function(a){var c=b(20);c.key=a;return c};a.create_collision_sensor=function(a,e,u){if(!a||!a.j)return q.error("Wrong collision object"),null;var B=
b(80);B.ok=a;B.Mb=e||"ANY";B.ll=u;B.nk=function(a,b){c(B,a);a&&b&&u&&(B.fc=B.fc||new Float32Array(3),B.fc[0]=b[0],B.fc[1]=b[1],B.fc[2]=b[2])};B.Kd=!0;return B};a.create_collision_impulse_sensor=function(a){if(!a||!a.j)return q.error("Wrong collision impulse object"),null;var e=b(90);e.mk=a;e.hn=function(a){c(e,a)};e.Kd=!0;return e};a.create_ray_sensor=function(a,e,B,u,f){if(!a)return q.error("Wrong collision object"),null;var d=b(100);d.Kc=a;d.Pl=e;d.Ck=B;d.cl=u;d.Mb=f||"ANY";d.yp=function(a,b){c(d,
a);a&&(d.fc=b)};d.Kd=!0;return d};a.create_mouse_click_sensor=function(){return b(50)};a.create_mouse_wheel_sensor=function(){return b(30)};a.create_mouse_move_sensor=function(a){var c=b(40);c.axis=a||"XY";return c};a.create_touch_move_sensor=function(a){var c=b(60);c.axis=a||"XY";return c};a.create_touch_zoom_sensor=function(){return b(70)};a.create_motion_sensor=function(a,c,e){if(!a)return q.error("Wrong collision object"),null;var B=b(110);B.Kc=a;var u=a.d.e;a=a.d.quat;B.wp=new Float32Array(4);
B.Fg=new Float32Array(u);B.mj=new Float32Array(a);B.ji=0;B.ii=0;B.threshold=c;B.Gp=e;B.Vb=0;B.fc=new Float32Array([0,0]);return B};a.create_vertical_velocity_sensor=function(a,c){if(!a)return q.error("Wrong collision object"),null;var e=b(120);e.Kc=a;var B=a.d.quat;e.Fg=new Float32Array(a.d.e);e.mj=new Float32Array(B);e.ki=0;e.threshold=c;e.Vb=0;e.fc=0;return e};a.create_timer_sensor=function(a){var c=b(130);c.Eh=a;c.Vb=S;return c};a.reset_timer_sensor=function(a,b,c,e){a=a||G;e=e||0;a=a.wc;if(!a||
!a[b])return q.error("reset_timer_sensor(): wrong object"),null;b=a[b].Hc[c];if(!b)return q.error("reset_timer_sensor(): sensor not found"),null;b.Vb=S+e};a.create_elapsed_sensor=function(){var a=b(140);a.Vb=0;return a};a.create_timeline_sensor=function(){return b(150)};a.create_selection_sensor=function(a,c){var e=b(160);e.Kc=a;e.Km=c;return e};a.Kw=c;a.get_sensor_value=function(a,b,c){a=a||G;a=a.wc;if(!a||!a[b])return q.error("get_sensor_value(): wrong object"),null;b=a[b].Hc[c];return b?b.value:
(q.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,b,c){a=a||G;a=a.wc;if(!a||!a[b])return q.error("get_sensor_payload(): wrong object"),null;b=a[b].Hc[c];return b?b.fc:(q.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){C=[];B=[];G={};S=0};a.check_sensor_manifold=function(a,b){a=a||G;if(!a.wc)return!1;if(b&&a.wc[b])return!0;if(!b)for(var c in a.wc)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||G;var c=a.wc,e=a.we;if(b){var u=
c[b];if(u){for(var f=u.Hc,p=0;p<f.length;p++)1===d(f[p],C)&&l(f[p],B);delete c[b];u=e.indexOf(u);-1<u?e.splice(u,1):A.ba("Incorrect manifolds array");Object.getOwnPropertyNames(c).length||h(a)}}else{for(b in c){u=c[b];f=u.Hc;for(p=0;p<f.length;p++)1===d(f[p],C)&&l(f[p],B);delete c[b];u=e.indexOf(u);-1<u?e.splice(u,1):A.ba("Incorrect manifolds array")}h(a);da=!0}};a.create_sensor_manifold=function(a,b,c,e,u,f,p){a=a||G;a.wc=a.wc||{};a.we=a.we||[];var g=a.wc,r=a.we,K=g[b];if(K){e=K.Hc;for(var q=0;q<
e.length;q++)1===d(e[q],C)&&l(e[q],B);K=r.indexOf(K);-1<K?r.splice(K,1):A.ba("Incorrect manifolds array")}c={id:b,type:c,Hc:e.slice(0),Lv:u||k,Lw:Array(e.length),callback:f,Ms:p||null,Io:-1,Ho:0,rq:-1};g[b]=c;r.push(c);-1==C.indexOf(a)&&C.push(a);a=c.Hc;for(b=0;b<a.length;b++){g=a[b];if(g.Kd){switch(g.type){case 80:v.append_collision_test(g.ok,g.Mb,g.nk,g.ll);break;case 90:v.apply_collision_impulse_test(g.mk,g.hn);break;case 100:v.append_ray_test(g.Kc,g.Mb,g.Pl,g.Ck,g.cl,g.yp)}g.Kd=!1}-1==B.indexOf(g)&&
B.push(g)}da=!0};a.Ut=k;a.Vt=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<C.length;a++){var b=C[a],c=b.wc,b=b.we,e;for(e in c)delete c[e];b.splice(0,b.length)}for(a=0;a<B.length;a++)l(B[a],B),a--;C.splice(0,C.length)};a.debug=function(){q.log(String(C.length)+" objects with manifolds",C);q.log(String(B.length)+" sensors",B);for(var a=[],b=[],c=0;c<B.length;c++){var e=B[c];80==e.type&&a.push(e);100==e.type&&b.push(e)}q.log(String(a.length)+
" collision sensors",a);q.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",g,!1);a.addEventListener("keyup",e,!1);ia=b};a.register_mouse_events=function(a,b){a.addEventListener("mousedown",n,!1);a.addEventListener("mouseup",z,!1);a.addEventListener("mousemove",f,!1);R=b};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",t,!1);a.addEventListener("DOMMouseScroll",t,!1);w=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",
s,!1);a.addEventListener("touchmove",r,!1);document.addEventListener("touchstart",function(){});u=b};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",g,!1);a.removeEventListener("keyup",e,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",n,!1);a.removeEventListener("mouseup",z,!1);a.removeEventListener("mousemove",f,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",t,!1);a.removeEventListener("DOMMouseScroll",t,!1)};a.unregister_touch_events=
function(a){a.removeEventListener("touchstart",s,!1);a.removeEventListener("touchmove",r,!1);document.removeEventListener("touchstart",function(){})}};b4w.module.__curve=function(a,m){function b(a,b,c,e,d){var h=e.length;d||(d=new Float32Array(h));for(var f=h+a,t=new Float32Array(f),s=1;s<=f-1;s++)t[s-1]=b>=c[s-1]&&b<c[s+1-1]?1:0;for(var r=2;r<=a;r++)for(s=1;s<=f-r;s++)t[s-1]=(0!=t[s-1]?(b-c[s-1])*t[s-1]/(c[s+r-1-1]-c[s-1]):0)+(0!=t[s+1-1]?(c[s+r-1]-b)*t[s+1-1]/(c[s+r-1]-c[s+1-1]):0);b==c[f-1]&&(t[h-1]=1);a=0;for(s=1;s<=h;s++)a+=t[s-1]*e[s-1];for(s=1;s<=h;s++)d[s-1]=0!=a?t[s-1]*e[s-1]/a:0;return d}function c(a){a=a.Ui;return a[a.length-1]}function h(a){a=
a.wn;return a[a.length-1]}var d=m("__util");a.Gt=function(a){var c={},d=a.data;a=d.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var e=a.order_u;c.Xd=e;a=a.points;var h=a.length/5,z=[],f=h+e,h=h+2;z[0]=0;for(var t=2;t<=f;t++)z[t-1]=t>e&&t<h?z[t-2]+1:z[t-2];c.Ui=z;if("2D"==d.dimensions)c.Rd=!1;else if("3D"==d.dimensions)c.Rd=!0;else throw"Wrong curve dimensions";e=[];z=[];for(d=0;d<a.length;d+=5)e.push(a[d]),e.push(a[d+1]),e.push(a[d+2]),c.Rd&&e.push(a[d+3]),z.push(a[d+4]);c.qk=
e;c.fm=z;a=[];for(var d=c.qk,e=c.Rd?4:3,z=c.fm,f=c.Ui,h=c.Xd,t=d.length/e,s=t+h,r=0,p=f[s-1]/999,F=0;1E3>F;F++){5E-6>f[s-1]-r&&(r=f[s-1]);for(var q=b(h,r,f,z),v=0;v<e;v++)for(var x=a[e*F+v]=0;x<t;x++)a[e*F+v]+=q[x]*d[e*x+v];r+=p}e=c.Rd?4:3;z=new Float32Array(1E3);z[0]=0;for(d=1;1E3>d;d+=1)f=a[(d-1)*e],h=a[(d-1)*e+1],t=a[(d-1)*e+2],s=a[d*e],r=a[d*e+1],p=a[d*e+2],z[d]=z[d-1]+Math.sqrt((s-f)*(s-f)+(r-h)*(r-h)+(p-t)*(p-t));c.wn=z;return c};a.qx=function(a,d,g){g||(g=[]);var e=d,h=Math.max(e,0);d=h=Math.min(e,
c(a));var e=a.qk,h=a.Rd?4:3,z=a.fm,f=a.Ui,t=a.Xd;a=e.length/h;var s=a+t;5E-6>f[s-1]-d&&(d=f[s-1]);s=new Float32Array(a);b(t,d,f,z,s);for(d=0;d<h;d++)for(z=g[d]=0;z<a;z++)g[d]+=s[z]*e[h*z+d]};a.nx=function(a,b,c){c||(c=[]);var e=a.qk,d=a.Rd?4:3,h=a.fm,f=a.Ui,t=a.Xd;a=e.length/d;var s=a+t;5E-6>f[s-1]-b&&(b=f[s-1]);var s=new Float32Array(a),r=b;b=s;var p=h.length;b||(b=new Float32Array(p));var F=new Float32Array(p),q=new Float32Array(p),v=F,x=q;v||(v=new Float32Array(p));x||(x=new Float32Array(p));for(var A=
p+t,L=new Float32Array(A),I=new Float32Array(A),y=1;y<=A-1;y++)L[y-1]=r>=f[y-1]&&r<f[y+1-1]?1:0;r==f[A-1]&&(L[p-1]=1);for(var C=2;C<=t;C++)for(y=1;y<=A-C;y++){var B=0!=L[y-1]?L[y-1]/(f[y+C-1-1]-f[y-1]):0,G=0!=L[y+1-1]?-L[y+1-1]/(f[y+C-1]-f[y+1-1]):0,K=0!=I[y-1]?(r-f[y-1])*I[y-1]/(f[y+C-1-1]-f[y-1]):0,N=0!=I[y+1-1]?(f[y+C-1]-r)*I[y+1-1]/(f[y+C-1]-f[y+1-1]):0;L[y-1]=(0!=L[y-1]?(r-f[y-1])*L[y-1]/(f[y+C-1-1]-f[y-1]):0)+(0!=L[y+1-1]?(f[y+C-1]-r)*L[y+1-1]/(f[y+C-1]-f[y+1-1]):0);I[y-1]=B+G+K+N}for(y=1;y<=
p;y++)v[y-1]=L[y-1],x[y-1]=I[y-1];f=0;for(t=1;t<=p;t++)f+=F[t-1]*h[t-1];r=0;for(t=1;t<=p;t++)r+=q[t-1]*h[t-1];for(t=1;t<=p;t++)b[t-1]=0!=f?q[t-1]*h[t-1]/f+F[t-1]*h[t-1]*r/(f*f):0;for(h=0;h<d;h++)for(f=c[h]=0;f<a;f++)c[h]+=s[f]*e[d*f+h]};a.DA=c;a.px=h;a.ox=function(a,b){if(0>=b)return 0;var g=c(a);if(b>=h(a))return g;var e=a.wn,n=d.mi(e,b,0,e.length-1);return g*(n+(b-e[n])/(e[n+1]-e[n]))/1E3}};b4w.module.__dds=function(a,m){function b(a,b,c,e){var d=new Uint16Array(4),p=new Uint16Array(c*e),g=0,q=0,h=0,k=q=g=0,n=0,l=0,I=0,y=c/4;e/=4;for(var C=0;C<e;C++)for(var B=0;B<y;B++)h=b+4*(C*y+B),d[0]=a[h],d[1]=a[h+1],g=d[0]&31,q=d[0]&2016,k=d[0]&63488,n=d[1]&31,l=d[1]&2016,I=d[1]&63488,d[2]=5*g+3*n>>3|5*q+3*l>>3&2016|5*k+3*I>>3&63488,d[3]=5*n+3*g>>3|5*l+3*q>>3&2016|5*I+3*k>>3&63488,g=a[h+2],q=4*C*c+4*B,p[q]=d[g&3],p[q+1]=d[g>>2&3],p[q+2]=d[g>>4&3],p[q+3]=d[g>>6&3],q+=c,p[q]=d[g>>8&3],p[q+1]=d[g>>
10&3],p[q+2]=d[g>>12&3],p[q+3]=d[g>>14],g=a[h+3],q+=c,p[q]=d[g&3],p[q+1]=d[g>>2&3],p[q+2]=d[g>>4&3],p[q+3]=d[g>>6&3],q+=c,p[q]=d[g>>8&3],p[q+1]=d[g>>10&3],p[q+2]=d[g>>12&3],p[q+3]=d[g>>14];return p}function c(a,c,d,h){var r=new Int32Array(d,0,31),p,F,q,v,x,A;if(542327876!=r[0])return k.error("Invalid magic number in DDS header"),0;if(!r[20]&4)return k.error("Unsupported format, must contain a FourCC code"),0;p=r[21];switch(p){case g:F=8;q=c?c.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case e:F=16;q=
c?c.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case n:F=16;q=c?c.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return k.error("Unsupported FourCC code:",l(p)),null}A=1;r[2]&131072&&!1!==h&&(A=Math.max(1,r[7]));v=r[4];x=r[3];r=r[1]+4;if(c)for(p=0;p<A;++p)h=Math.max(4,v)/4*Math.max(4,x)/4*F,c=new Uint8Array(d,r,h),a.compressedTexImage2D(a.TEXTURE_2D,p,q,v,x,0,c),r+=h,v=Math.max(.5*v,1),x=Math.max(.5*x,1);else if(p==g)Math.max(4,v),Math.max(4,x),c=new Uint16Array(d),d=b(c,r/2,v,x),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,v,x,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,d),h&&a.generateMipmap(a.TEXTURE_2D);else return k.error("No manual decoder for",l(p),"and no native support"),0;return A}function h(a,b,e,d,g,p){var h=new XMLHttpRequest;h.open("GET",e,!0);h.responseType="arraybuffer";h.onload=function(){if(200==h.status){a.bindTexture(a.TEXTURE_2D,d);var e=c(a,b,h.response,g);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<e?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}p&&
p(d)};h.send(null);return d}function d(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function l(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var k=m("__print"),g=d("DXT1"),e=d("DXT3"),n=d("DXT5");a.oz=b;a.by=c;a.fo=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.Su=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case g:b=6;break;case e:case n:b=4;break;default:k.error("Unsupported FourCC code:",l(a))}return b};
a.jA=h;a.iA=function(a,b,c,e){var d=a.createTexture();h(a,b,c,d,!0,e);return d}};b4w.module.__debug=function(a,m){function b(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function c(a,b){typeof a!=typeof b&&k.ba("Structure assertion failed: incompatible types");for(var c in a)c in b||k.ba("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||k.ba("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&k.ba("Structure assertion failed: incompatible types for key "+c)}var h=
m("__extensions"),d=m("__print"),l=m("__textures"),k=m("__util"),g=null,e={},n=!1,z={},f=[],t=-1,s=null,r=!1;a.qm={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.tc=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(e[a[d]]=d)}g=a};a.Ws=function(a){if(n){var b=g.getError();if(b!=g.NO_ERROR){if(b in e)throw"B4W Error: "+b+", gl."+e[b]+
" ("+a+")";throw"Unknown GL error: "+b+" ("+a+")";}}};a.Ts=function(){if(n)switch(g.checkFramebufferStatus(g.FRAMEBUFFER)){case g.FRAMEBUFFER_COMPLETE:break;case g.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case g.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case g.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case g.FRAMEBUFFER_UNSUPPORTED:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:d.error("B4W Error: FRAMEBUFFER CHECK FAILED")}};a.an=function(){if(-1!=t)return t;g.bindFramebuffer(g.FRAMEBUFFER,g.createFramebuffer());var a=l.zi("DEBUG",l.Qg);l.resize(a,1,1);g.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,a.Eb,a.Oa,0);g.checkFramebufferStatus(g.FRAMEBUFFER)!=g.FRAMEBUFFER_COMPLETE?(t=!0,d.warn("B4W warning: depth-only issue was found")):t=!1;g.bindFramebuffer(g.FRAMEBUFFER,
null);return t};a.Xs=function(a,c,e){if(n&&!g.getShaderParameter(a,g.COMPILE_STATUS))throw e=b(e),d.error("B4W Error: shader compilation failed:\n"+e+"\n"+g.getShaderInfoLog(a)+" ("+c+")"),"Engine failed: see above for error messages";};a.Ys=function(a,c,e,f,p,r){if(n&&!g.getProgramParameter(a,g.LINK_STATUS)){var k=h.Sn();k&&(p=k.getTranslatedShaderSource(e),r=k.getTranslatedShaderSource(f));p=b(p);r=b(r);d.error("B4W Error: shader linking failed:\n"+p+"\n\n\n"+r+"\n"+g.getProgramInfoLog(a)+" ("+
c+")");throw"Engine failed: see above for error messages";}};a.set_check_gl_errors=function(a){n=a};a.pz=function(a){z[a]=a in z?z[a]+1:1};a.update=function(){for(var a in z)d.log(a,z[a]),z[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(k.is_vector(c))for(var e=0;e<c.length;e++)a.push(c[e]);else a.push(arguments[b])}f.push(a)};a.msg=function(){for(var a=1,b=0;b<f.length;b++){var c=f[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=
arguments[b],k.is_vector(a))for(var e=0;e<a.length;e++)c.push(a[e]);else c.push(arguments[b]);f.push(c)};var p=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},e=Math.max(0,performance.now()-1E3*a),g=0;g<f.length;g++){var r=f[g];a=r[0];if(!(a<e)){var h=String(r[1]);c[h]||(c[h]=p[b++%p.length]);a=["%c"+(a/1E3).toFixed(6),c[h],h];for(h=2;h<r.length;h++)a.push(r[h]);d.log.apply(this,a)}}f.splice(0)};a.plot_telemetry=
function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-1E3*a),e=0;e<f.length;e++){var p=f[e];a=p[0];if(!(a<c))for(var g=2;g<p.length;g++){var r=String(p[1]);3<p.length&&(r+="_"+String(g-2));b[r]||(b[r]=r+"\n");b[r]+=String(a)+" "+p[g]+"\n"}}a="";for(r in b)a+=b[r]+"\n\n";d.log(a);f.splice(0)};a.Xy=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&
b("gecko")&&b("firefox");case "msie":return b("mozilla")&&b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(k.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.Qy=function(a,b){typeof a!=b&&k.ba("Type assertion failed: value type is not a {"+b+"}:",a)};a.Oy=c;a.Py=function(a){r?c(a,
s):r=!0;s=a}};b4w.module.__extensions=function(a,m){function b(a){if(a in d)return d[a];var b=h.getExtension(a)||null;d[a]=b;c.log("%cGET EXTENSION","color: #"+(b?"0a0":"a00"),a);return b}var c=m("__print"),h=null,d={};a.tc=function(a){h=a};a.$n=function(){return b("WEBGL_compressed_texture_s3tc")||b("WEBKIT_WEBGL_compressed_texture_s3tc")||b("MOZ_WEBGL_compressed_texture_s3tc")};a.Vu=function(){return b("WEBGL_depth_texture")||b("WEBKIT_WEBGL_depth_texture")||b("MOZ_WEBGL_depth_texture")};a.Nu=function(){return b("EXT_texture_filter_anisotropic")||
b("WEBKIT_EXT_texture_filter_anisotropic")||b("MOZ_EXT_texture_filter_anisotropic")};a.Sn=function(){return b("WEBGL_debug_shaders")};a.Zn=function(){return b("WEBGL_debug_renderer_info")};a.Tn=function(){return b("OES_element_index_uint")};a.dv=function(){return b("OES_standard_derivatives")};a.cleanup=function(){d={}}};b4w.module.__graph=function(a){function m(a,c,e){e||(e=null);if(b(a,c))throw"Graph already has node with given ID";a.ya.push(c,e)}function b(a,b){for(var c=a.ya,e=0;e<c.length;e+=2)if(c[e]==b)return!0;return!1}function c(a,c,e,d){d||(d=null);if(b(a,c)&&b(a,e))a.ta.push(c,e,d);else throw"Wrong node IDs";}function h(a,c){if(!b(a,c))throw"Node not found";for(var e=a.ya,d=0;d<e.length;d+=2)e[d]==c&&(e.splice(d,2),d-=2)}function d(a){a=a.ya;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}
function l(a,b){for(var c=a.ya,e=0;e<c.length;e+=2)if(c[e+1]==b)return c[e];return-1}function k(a){var b=[],c={};g(a,c);for(var d=a.ya,f=0;f<d.length;f+=2)0==q(a,d[f])&&e(a,d[f],c,b);return{ya:b,ta:a.ta.slice(0)}}function g(a,b){for(var c=a.ya,e=0;e<c.length;e+=2)b[c[e]]=!1}function e(a,b,c,d){if(!c[b]){c[b]=!0;for(var f=0;f<F(a,b);f++)e(a,v(a,b,f),c,d);d.unshift(b,p(a,b))}}function n(a,b,c,e){if(!c[b]){c[b]=!0;if(10==e||30==e)for(var d=0;d<F(a,b);d++){var f=v(a,b,d);n(a,f,c,e)}if(20==e||30==e)for(d=
0;d<q(a,b);d++)f=x(a,b,d),n(a,f,c,e)}}function z(a){var b=a.ya;a=a.ta;for(var c=[],e=[],d=[],f=0;f<b.length;f++)d[b[2*f]]=f,c.push(f,b[2*f+1]);for(f=0;f<a.length;f+=3)e.push(d[a[f]],d[a[f+1]],a[f+2]);return{ya:c,ta:e}}function f(a,b,c){if(c.zc==c.Wd){for(var e=0,d=0;e<c.Wd;e++)-1!=c.ad[e]&&(a[d]=e,b[d]=c.ad[e],d++);return!0}if(c.Wd>c.dg||c.ie>c.je||c.Bg>c.Dg||c.Ag>c.Cg)return!1;for(var d=e=-1,p=!1;!p&&t(c,C,e,d);)if(e=C[0],d=C[1],s(c,e,d)){var g;g=c;p={};p.lh=g.lh;p.mh=g.mh;p.nl=g.nl;p.Ei=g.Ei;p.Wd=
g.Wd;p.dg=g.dg;p.Xd=g.Xd;p.zc=p.ej=g.zc;p.Ag=g.Ag;p.Bg=g.Bg;p.ie=g.ie;p.Cg=g.Cg;p.Dg=g.Dg;p.je=g.je;p.Tg=-1;p.ad=g.ad;p.Je=g.Je;p.Xe=g.Xe;p.Ye=g.Ye;p.nf=g.nf;p.of=g.of;p.uj=g.uj;g.uj[0]+=1;var p=g=p,h=e,k=d,y=p.lh,n=p.mh,A=p.Wd,l=p.dg,z=p.ad,I=p.Je,L=p.Xe,m=p.Ye,R=p.nf,w=p.of;r(h<A);r(k<l);r(p.zc<A);r(p.zc<l);A=++p.zc;p.Tg=h;L[h]||(L[h]=A,p.Ag++,R[h]&&p.ie++);R[h]||(R[h]=A,p.Bg++,L[h]&&p.ie++);m[k]||(m[k]=A,p.Cg++,w[k]&&p.je++);w[k]||(w[k]=A,p.Dg++,m[k]&&p.je++);z[h]=k;I[k]=h;for(z=0;z<q(y,h);z++)I=
x(y,h,z),L[I]||(L[I]=A,p.Ag++,R[I]&&p.ie++);for(z=0;z<F(y,h);z++)I=v(y,h,z),R[I]||(R[I]=A,p.Bg++,L[I]&&p.ie++);for(z=0;z<q(n,k);z++)I=x(n,k,z),m[I]||(m[I]=A,p.Cg++,w[I]&&p.je++);for(z=0;z<F(n,k);z++)I=v(n,k,z),w[I]||(w[I]=A,p.Dg++,m[I]&&p.je++);p=f(a,b,g);r(1>=g.zc-g.ej);r(-1!=g.Tg);I=g.lh;h=g.mh;k=g.zc;y=g.Tg;n=g.ad;L=g.Je;A=g.Xe;m=g.Ye;l=g.nf;R=g.of;if(g.ej<k){A[y]==k&&(A[y]=0);for(w=0;w<q(I,y);w++)z=x(I,y,w),A[z]==k&&(A[z]=0);l[y]==k&&(l[y]=0);for(w=0;w<F(I,y);w++)z=v(I,y,w),l[z]==k&&(l[z]=0);
I=n[y];m[I]==k&&(m[I]=0);for(w=0;w<q(h,I);w++)z=x(h,I,w),m[z]==k&&(m[z]=0);R[I]==k&&(R[I]=0);for(w=0;w<F(h,I);w++)z=v(h,I,w),R[z]==k&&(R[z]=0);n[y]=-1;L[I]=-1;g.zc=g.ej;g.Tg=-1}}return p}function t(a,b,c,e){-1==c&&(c=0);-1==e?e=0:e++;var d=a.ie,f=a.je,p=a.Bg,g=a.Dg,C=a.Ag,r=a.Cg,h=a.zc,k=a.Wd,q=a.dg,s=a.ad,F=a.Je,y=a.Xe,n=a.Ye,v=a.nf,w=a.of;if(d>h&&f>h)for(;c<k&&(-1!=s[c]||0==v[c]||0==y[c]);)c++,e=0;else if(p>h&&g>h)for(;c<k&&(-1!=s[c]||0==v[c]);)c++,e=0;else if(C>h&&r>h)for(;c<k&&(-1!=s[c]||0==y[c]);)c++,
e=0;else if(0==c&&0!=a.Xd){for(y=0;y<k&&-1!=s[c=a.Xd[y]];)y++;y==k&&(c=k)}else for(;c<k&&-1!=s[c];)c++,e=0;if(d>h&&f>h)for(;e<q&&(-1!=F[e]||0==w[e]||0==n[e]);)e++;else if(p>h&&g>h)for(;e<q&&(-1!=F[e]||0==w[e]);)e++;else if(C>h&&r>h)for(;e<q&&(-1!=F[e]||0==n[e]);)e++;else for(;e<q&&-1!=F[e];)e++;return c<k&&e<q?(b[0]=c,b[1]=e,!0):!1}function s(a,b,c){var e=a.lh,d=a.mh,f=a.dg,g=a.ad,C=a.Je,h=a.Xe,k=a.Ye,s=a.nf,y=a.of;r(b<a.Wd);r(c<f);r(-1==g[b]);r(-1==C[c]);if(!(0,a.nl)(p(e,b),p(d,c)))return!1;for(var n=
f=0,l=0,t=0,z=0,I=0,R=0;R<F(e,b);R++){var w=v(e,b,R);if(-1!=g[w]){var u=g[w];if(!A(d,c,u)||!L(a.Ei,e,b,w,d,c,u))return!1}else h[w]&&l++,s[w]&&f++,h[w]||s[w]||z++}for(R=0;R<q(e,b);R++)if(w=x(e,b,R),-1!=g[w]){if(u=g[w],!A(d,u,c)||!L(a.Ei,e,w,b,d,u,c))return!1}else h[w]&&l++,s[w]&&f++,h[w]||s[w]||z++;for(R=0;R<F(d,c);R++)if(u=v(d,c,R),-1!=C[u]){if(w=C[u],!A(e,b,w))return!1}else k[u]&&t++,y[u]&&n++,k[u]||y[u]||I++;for(R=0;R<q(d,c);R++)if(u=x(d,c,R),-1!=C[u]){if(w=C[u],!A(e,w,b))return!1}else k[u]&&t++,
y[u]&&n++,k[u]||y[u]||I++;return l<=t&&f<=n&&z<=I}function r(a){if(!a)throw"Assertion failed";}function p(a,b){for(var c=a.ya,e=0;e<c.length;e+=2)if(c[e]==b)return c[e+1];return null}function F(a,b){for(var c=a.ta,e=0,d=0;d<c.length;d+=3)c[d]==b&&e++;return e}function q(a,b){for(var c=a.ta,e=0,d=0;d<c.length;d+=3)c[d+1]==b&&e++;return e}function v(a,b,c){a=a.ta;for(var e=0,d=0;d<a.length;d+=3)if(a[d]==b){if(e==c)return a[d+1];e++}return-1}function x(a,b,c){a=a.ta;for(var e=0,d=0;d<a.length;d+=3)if(a[d+
1]==b){if(e==c)return a[d];e++}return-1}function A(a,b,c){a=a.ta;for(var e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==c)return!0;return!1}function L(a,b,c,e,d,f,p){for(var g=I(b,c,e),C=I(d,f,p),h=0;h<g;h++){for(var r=!1,k=0;k<C;k++)if(a(y(b,c,e,h),y(d,f,p,k))){r=!0;break}if(!r)return!1}return!0}function I(a,b,c){var e=0;a=a.ta;for(var d=0;d<a.length;d+=3)a[d]==b&&a[d+1]==c&&e++;return e}function y(a,b,c,e){a=a.ta;for(var d=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(d==e)return a[f+2];d++}return null}
var C=[-1,-1];a.mm=-1;a.Fy=10;a.Iq=20;a.Iy=30;a.create=function(){for(var a=arguments,b=[],c=[],e=0;e<a.length;e++){var d=a[e];switch(d.length){case 2:b.push(d[0],d[1]);break;case 3:c.push(d[0],d[1],d[2]);break;default:throw"Wrong graph constructor params";}}return{ya:b,ta:c}};a.hz=function(a,b){for(var c=[],e=[],d=0;d<a.length;d++)c.push(a[d][0],a[d][1]);for(d=0;d<b.length;d++)e.push(b[d][0],b[d][1],b[d][2]);return{ya:c,ta:e}};a.Yj=m;a.Qz=b;a.Be=c;a.hg=h;a.gg=function(a,b,c,e){if(!A(a,b,c))throw"Edge not found";
a=a.ta;for(var d=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(-1==e)a.splice(f,3);else{if(e==d){a.splice(f,3);break}d++}f-=3}};a.n=function(a,b){if(-1==l(a,b))m(a,d(a),b);else throw"Non-unique attribute";};a.xw=function(a,b,c,e,d){a=a.ta;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&a[f+2]==e&&(a[f+2]=d)};a.Pn=d;a.xh=l;a.i=function(a,b,e,d){b=l(a,b);e=l(a,e);if(-1!=b&&-1!=e)c(a,b,e,d);else throw"Attributes not found";};a.K=function(a,b){for(var c=a.ya,e=0;e<c.length&&!b(c[e],c[e+1]);e+=2);};
a.ke=function(a,b){for(var c=a.ta,e=0;e<c.length&&!b(c[e],c[e+1],c[e+2]);e+=3);};a.le=function(a,b,c){for(var e=a.ta,d=0;d<e.length;d+=3)if(e[d+1]==b){var f=e[d];if(c(f,p(a,f),e[d+2]))break}};a.me=function(a,b,c){for(var e=a.ta,d=0;d<e.length;d+=3)if(e[d]==b){var f=e[d+1];if(c(f,p(a,f),e[d+2]))break}};a.lq=k;a.Jx=function(a){a=k(a).ya;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.Zz=function(){};a.wx=function(a,c,e){if(!b(a,c))throw"No such node";var d={};g(a,d);n(a,c,d,e);c=[];for(var f in d)d[f]&&
(f=Number(f),c.push(f,p(a,f)));a={ya:c,ta:a.ta.slice(0)};d=a.ta;for(f=0;f<d.length;f+=3)c=d[f+1],b(a,d[f])&&b(a,c)||(d.splice(f,3),f-=3);return a};a.cv=function(a){for(var b=[],c=a.ya,e=0;e<c.length;e+=2){var d=c[e];q(a,d)||b.push(d)}return b};a.bo=function(a){for(var b=[],c=a.ya,e=0;e<c.length;e+=2){var d=c[e];F(a,d)||b.push(d)}return b};a.match=function(a,b,c,e){var d={};d.lh=z(a);d.mh=z(b);d.nl=c||function(a,b){return a==b};d.Ei=e||function(a,b){return a==b};e=a.ya.length/2;var p=b.ya.length/2;
d.Wd=e;d.dg=p;d.Xd=0;d.zc=d.ej=0;d.ie=d.Ag=d.Bg=0;d.je=d.Cg=d.Dg=0;d.Tg=-1;d.ad=Array(e);d.Je=Array(p);d.Xe=Array(e);d.Ye=Array(p);d.nf=Array(e);d.of=Array(p);d.uj=[1];for(c=0;c<e;c++)d.ad[c]=-1,d.Xe[c]=0,d.nf[c]=0;for(c=0;c<p;c++)d.Je[c]=-1,d.Ye[c]=0,d.of[c]=0;p=Array(e);e=Array(e);if(f(p,e,d)){for(c=0;c<p.length;c++)p[c]=a.ya[2*p[c]],e[c]=b.ya[2*e[c]];return[p,e]}return null};a.Ba=p;a.fg=F;a.vo=q;a.Uf=v;a.Ii=x;a.Gz=I;a.Tf=y;a.replace=function(a,b,c){for(var e=a.ta,f=d(a),p=0;p<b.length;p++){var g=
b[p];h(a,g);for(var C=0;C<e.length;C+=3)e[C]==g&&(e[C]=f),e[C+1]==g&&(e[C+1]=f),e[C]==e[C+1]&&(e.splice(C,3),C-=3)}m(a,f,c)};a.iz=function(a,b){var c=a.ya,e=a.ta,d;d="digraph debug {\n    node [shape=box];\n";for(var f=0;f<c.length;f+=2){var p=c[f],g=c[f+1],g=b?b(p,g):String(p);d+="    ";d+=String(p)+' [label="'+g.replace(/\"/g,'\\"')+'"];\n'}for(f=0;f<e.length;f+=3)c=e[f],p=e[f+1],d+="    ",d+=String(c)+" -> "+String(p)+";\n";return d+="}"}};b4w.module.__ipc=function(a){var m=a.Nq=0;a.Oq=1;a.Pq=2;a.Qq=3;a.Rq=4;a.Sq=5;var b=a.Uq=6,c=a.Vq=7,h=a.Wq=8;a.Xq=9;a.Tq=10;a.vr=11;a.vc=12;a.Yq=13;a.Zq=14;a.$q=15;a.br=16;a.ar=17;a.cr=18;a.dr=19;a.er=20;a.fr=21;a.gr=22;a.hr=23;a.ir=24;a.jr=25;a.kr=26;a.lr=27;a.mr=28;a.nr=29;a.or=30;a.pr=31;a.qr=32;a.rr=33;a.tr=34;a.ur=35;a.wr=36;a.om=37;a.xr=38;a.yr=39;a.zr=40;a.Ar=41;a.Br=42;a.Cr=43;a.Dr=44;a.Er=45;a.Fr=46;a.Gr=47;a.Hr=48;a.Ir=49;a.Jr=50;a.pm=51;var d=a.Df=52;a.Kr=53;a.nm=54;a.Lr=55;a.Mr=56;a.Gy=
57;a.sr=58;for(var l=null,k=[],g=[],e=[],n=[],z=0;59>z;z++)k.push(null),g.push(null),e.push(null),n.push(null);g[h]={msg_id:0,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3)};g[b]={msg_id:0,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4)};g[c]={msg_id:0,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0};g[m]={msg_id:0,body_id_a:0,body_id_b:0,result:0,
coll_point:new Float32Array(3)};g[d]={msg_id:0,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4)};n[h]=["msg_id",1,"body_id",1,"time",1,"trans",3,"quat",4,"linvel",3,"angvel",3];n[b]=["msg_id",1,"chassis_hull_body_id",1,"prop_ind",1,"trans",3,"quat",4];n[c]=["msg_id",1,"body_id",1,"from",3,"to",3,"local",1,"body_id_b_hit",1,"cur_result",1];n[m]=["msg_id",1,"body_id_a",1,"body_id_b",1,"result",1,"coll_point",3];n[d]=["msg_id",1,"body_id",1,"trans",3,"quat",4];a.init=function(a,b){a.addEventListener("message",
function(a){var c=a.data;a=c[0]|0;if(n[a]){for(var e=g[a],d=n[a],f=0,h=0;h<d.length;h+=2){var k=d[h],A=d[h+1];if(1==A)e[k]="msg_id"==k||"body_id"==k||"body_id_a"==k||"body_id_b"==k?c[f]|0:c[f];else for(var l=0;l<A;l++)e[k][l]=c[f+l];f+=A}c=e}b(a,c)},!1);l=a};a.cleanup=function(){l=null};a.m=function(){var a=arguments[0]|0;if(n[a]){var b=g[a],c=n[a],d=0;if(!e[a]){for(var p=0,h=1;h<c.length;h+=2)p+=c[h];e[a]=new Float32Array(p)}p=e[a];for(h=0;h<c.length;h+=2){var q=b[c[h]],v=c[h+1];1==v?p[d]=q:p.set(q,
d);d+=v}k[a]||(k[a]=p);a=k[a]}else for(b=arguments.length,k[a]||(k[a]=Array(b),k[a][0]=a),a=k[a],c=1;c<b;c++)a[c]=arguments[c];l.postMessage(a)};a.Xn=function(a){return g[a]}};b4w.module.__hud=function(a,m){function b(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function c(a){h(' SCENE "'+a.name+'"');if(a.d){var b=0,c=0;g.K(a.d.Ja,function(a,e){if("SINK"==e.type)h(" (F)",e.type);else{var d=e.type,g=Math.round(e.h.width)+"x"+Math.round(e.h.height),k=e.l.length,n=e.bh,l=e.enqueue&&e.P;l?h(" (A)",d,e.lf,g,n,"of",k):h(" (P)",d,e.lf,g,n,"of",k);e.bh=0;l&&(b+=k,c+=n)}});return[b,c]}h("No INFO")}function h(){for(var a=80+20*n[0],b=[5,
18,3,10,4,3,5],c=arguments[0],d=1;d<arguments.length;d++){for(var g="",p=0;p<b[d]-String(arguments[d]).length;p++)g+=" ";c+=g+arguments[d]}n[0]++;e.fillText(c,30,a)}function d(a,b,c){b*=a.qa;c.x=a.x+b;c.y=a.y;c.qa=a.qa-2*b;c.ga=a.ga}function l(a){return a.x+a.qa/2}function k(a){var b=e,c={x:0,y:0,qa:0,ga:0},g=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.qa=g;c.ga=b;d(c,.01,c);g=.02*c.ga;c.x=c.x;c.y+=g;c.qa=c.qa;c.ga-=2*g;g=c.qa/8;c.x+=g*a;c.y=c.y;c.qa=g;c.ga=c.ga;d(c,.02,c);return c}var g=m("__graph"),
e=null,n=[0,0];a.init=function(a){a=a.getContext("2d");b(a);return e=a};a.Hg=function(){e&&b(e)};a.reset=function(){var a=e;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),n[0]=0,n[1]=0)};a.dx=function(a,b){var d=e;if(d){d.textAlign="left";d.fillStyle="rgba(0,255,0,255)";h(" FPS",(1/b).toFixed(2));n[0]++;for(var g=d=0,k=0;k<a.length;k++){var p=c(a[k]),d=d+p[0],g=g+p[1];n[0]++}h(" ---------------------------------------------");
h("    ","TOTAL ACTIVE","","",g,"of",d)}};a.print=function(){var a=e;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",h.apply(Math,arguments))};a.plot_array=function(a,b,c,d,g,p,h){var q=e;if(q){b=k(b);var n=b.ga/5;b.x=b.x;b.y+=4*n;b.qa=b.qa;b.ga=n;q.textAlign="center";q.fillStyle="#00FF00";e.fillText(a,l(b),b.y-10);q.strokeStyle="#00FF00";q.lineWidth=.5;q.beginPath();q.moveTo(b.x,b.y);q.lineTo(b.x+b.qa,b.y);q.lineTo(b.x+b.qa,b.y+b.ga);q.lineTo(b.x,b.y+b.ga);q.closePath();q.stroke();if(!p&&
!h)for(p=1E6,h=-1E6,a=0;a<c.length;a++)p=Math.min(p,c[a]),h=Math.max(h,c[a]);q.textAlign="right";e.fillText(String(p),b.x-10,b.y+b.ga);e.fillText(String(h),b.x-10,b.y);q.textAlign="center";e.fillText(String(d),b.x,b.y+b.ga+15);e.fillText(String(g),b.x+b.qa,b.y+b.ga+15);q.strokeStyle="#FF0000";q.lineWidth=1.5;q.beginPath();d=b.qa/(c.length-1);h=b.ga/(h-p);for(a=0;a<c.length;a++)g=b.x+d*a,n=b.y+b.ga-(c[a]-p)*h,0==a?q.moveTo(g,n):q.lineTo(g,n);q.stroke()}};a.draw_mixer_strip=function(a,b,c,d,g,p,h){var q=
e;if(q)for(q.textAlign="center",q.fillStyle="#00FF00",q.font="bold 12px Courier",c=k(c),e.fillText(b?"["+a+"]":a,l(c),c.y),0<=p&&e.fillText(p?"[M]":"[ ]",l(c)-15,c.y+30),0<=h&&e.fillText(h?"[S]":"[ ]",l(c)+15,c.y+30),a={x:0,y:0,qa:0,ga:0},b=0;b<d.length;b++){p=d[b];var n="VOLUME"==p[0];if(n){h=c.y+350;var x=c.qa,A=a;A.x=c.x;A.y=h;A.qa=x;A.ga=250}else{h=c.y+10+50*b;var x=c.qa,A=c.ga,L=a;L.x=c.x;L.y=h;L.qa=x;L.ga=A}h=q;var x=a,L=b==g,I=p[0],A=p[1],y=p[2],C=p[3],B=(C-y)/p[4],B=1>B?Math.floor(1/B-1E-5).toFixed(0).length:
0;p=p[5]?Math.log(A/y)/Math.log(C/y):(A-y)/(C-y);h.textAlign="center";L?h.fillText("["+I+"]",l(x),x.y):h.fillText(I,l(x),x.y);h.strokeStyle="#00FF00";h.lineWidth=n?3:1;n?(h.textAlign="right",h.fillText(C.toFixed(B),l(x)-10,x.y+15),h.textAlign="right",h.fillText(y.toFixed(B),l(x)-10,x.y+x.ga-15)):(h.textAlign="right",h.fillText(y.toFixed(B),x.x+28,x.y+15),h.textAlign="left",h.fillText(C.toFixed(B),x.x+x.qa-28,x.y+15));h.beginPath();if(n){var G=x.y+15+(x.ga-30)*(1-p);h.moveTo(l(x),x.y+15);h.lineTo(l(x),
x.y+x.ga-15);h.moveTo(l(x)-5,x.y+15);h.lineTo(l(x)+5,x.y+15);h.moveTo(l(x)-5,x.y+x.ga-15);h.lineTo(l(x)+5,x.y+x.ga-15);h.moveTo(l(x)-5,G);h.lineTo(l(x)+5,G)}else{var K=x.x+30+(x.qa-60)*p;h.moveTo(x.x+30,x.y+15);h.lineTo(x.x+x.qa-30,x.y+15);h.moveTo(x.x+30,x.y+15-5);h.lineTo(x.x+30,x.y+15+5);h.moveTo(x.x+x.qa-30,x.y+15-5);h.lineTo(x.x+x.qa-30,x.y+15+5);h.moveTo(K,x.y+15-5);h.lineTo(K,x.y+15+5)}h.stroke();"EQ_Q"==I?(p=Math.log(1+1/(2*A*A)+Math.sqrt((2+1/(A*A))*(2+1/(A*A))/4-1))/Math.log(2),n?(h.textAlign=
"left",h.fillText(A.toFixed(B),l(x)+10,G),h.textAlign="left",h.fillText("("+p.toFixed(B+1)+")",l(x)+10,G+10)):(h.textAlign="right",h.fillText(A.toFixed(B),K,x.y+30),h.textAlign="left",h.fillText("("+p.toFixed(B+1)+")",K,x.y+30))):n?(h.textAlign="left",h.fillText(A.toFixed(B),l(x)+10,G)):(h.textAlign="center",h.fillText(A.toFixed(B),K,x.y+30))}}};b4w.module.__renderer=function(a,m){function b(a){if(a){var b=(a.aa?r.COLOR_BUFFER_BIT:0)|(a.da?r.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=z;break;case "DEPTH":a=f;break;case "SHORE_SMOOTHING":a=z;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":a=t;break;case "GLOW_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=s;break;default:a=n.background_color}}else b=r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT,a=n.background_color;r.colorMask(!0,!0,!0,!0);
r.depthMask(!0);r.clearColor(a[0],a[1],a[2],a[3]);r.clear(b)}function c(a,b,c){r.bindBuffer(r.ARRAY_BUFFER,a.zf);for(var e=0;e<b.length;e++){var d=b[e];r.enableVertexAttribArray(d.ef);r.vertexAttribPointer(d.ef,d.Ec,r.FLOAT,!1,0,d.Cs+d.vu*c)}a.od?(r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a.od),r.drawElements(a.mode,a.count,a.Uk,0)):r.drawArrays(a.mode,0,a.count);for(e=0;e<b.length;e++)d=b[e],r.disableVertexAttribArray(d.ef)}function h(a){switch(a){case 0:return r.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 1:return r.TEXTURE_CUBE_MAP_POSITIVE_Y;
case 2:return r.TEXTURE_CUBE_MAP_POSITIVE_X;case 3:return r.TEXTURE_CUBE_MAP_NEGATIVE_X;case 4:return r.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return r.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function d(a){var b=a.xf,c=[],e=[],d={},p;for(p in b){var f=!1;switch(p){case "u_proj_matrix":var g=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,!1,g.ha)},f=!0;break;case "u_view_matrix":case "u_view_matrix_frag":g=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,!1,g.pa)};f=!0;break;case "u_view_proj_prev":g=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,
!1,g.lw)};f=!0;break;case "u_view_proj_inverse":g=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,!1,g.Lg)};f=!0;break;case "u_sky_vp_inverse":g=function(a,b,c,e,d,g){a.uniformMatrix4fv(b,!1,g.Jc)};f=!0;break;case "u_camera_eye":case "u_camera_eye_frag":g=function(a,b,c,e,d,g){a.uniform3fv(b,g.Nd)};f=!0;break;case "u_camera_eye_last":g=function(a,b,c,e,d,g){a.uniform3fv(b,g.In)};f=!0;break;case "u_camera_quat":g=function(a,b,c,e,d,g){a.uniform4fv(b,g.quat)};f=!0;break;case "u_view_max_depth":g=function(a,
b,c,e,d,g){a.uniform1f(b,g.Ha)};f=!0;break;case "u_camera_range":g=function(a,b,c,e,d,g){a.uniform2f(b,g.Ca,g.Ha)};break;case "u_csm_center_dists":g=function(a,b,c,e,d,g){a.uniform4fv(b,g.un)};break;case "u_cam_water_depth":g=function(a,b,c){a.uniform1f(b,c.jk)};f=!0;break;case "u_waves_height":g=function(a,b,c){a.uniform1f(b,c.qe)};break;case "u_waves_length":g=function(a,b,c){a.uniform1f(b,c.Cf)};break;case "u_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.Bb)};break;case "u_underwater_fog_color_density":g=
function(a,b,c){a.uniform4fv(b,c.uc)};break;case "u_bloom_key":g=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":g=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":g=function(a,b,c){a.uniform1f(b,c.time)};f=!0;break;case "u_wind":g=function(a,b,c){a.uniform3fv(b,c.Zh)};break;case "u_horizon_color":g=function(a,b,c){a.uniform3fv(b,c.bc)};break;case "u_zenith_color":g=function(a,b,c){a.uniform3fv(b,c.lc)};break;case "u_environment_energy":g=function(a,b,
c){a.uniform1f(b,c.Md)};break;case "u_sky_color":g=function(a,b,c){a.uniform3fv(b,c.og)};break;case "u_rayleigh_brightness":g=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":g=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":g=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":g=function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":g=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};
break;case "u_mie_strength":g=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":g=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":g=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":g=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":g=function(a,b,c){a.uniform3fv(b,c.cf)};break;case "u_light_directions":g=function(a,b,c){a.uniform3fv(b,c.$e)};
break;case "u_light_color_intensities":g=function(a,b,c){a.uniform3fv(b,c.Ze)};break;case "u_light_factors1":g=function(a,b,c){a.uniform4fv(b,c.af)};break;case "u_light_factors2":g=function(a,b,c){a.uniform4fv(b,c.bf)};break;case "u_sun_quaternion":g=function(a,b,c){a.uniform4fv(b,c.hq)};break;case "u_sun_intensity":g=function(a,b,c){a.uniform3fv(b,c.gq)};break;case "u_sun_direction":g=function(a,b,c){a.uniform3fv(b,c.zj)};break;case "u_height":g=function(a,b,c,e,d,g){a.uniform1f(b,g.height)};f=!0;
break;case "u_model_matrix":g=function(a,b,c,e){a.uniformMatrix4fv(b,!1,e.I)};f=!0;break;case "u_transb":g=function(a,b,c,e){a.uniform4fv(b,e.Xb)};f=!0;break;case "u_transa":g=function(a,b,c,e){a.uniform4fv(b,e.Wb)};f=!0;break;case "u_quat":g=function(a,b,c,e){a.uniform4fv(b,e.quat)};f=!0;break;case "u_quatsb":g=function(a,b,c,e){a.uniform4fv(b,e.Qb)};f=!0;break;case "u_quatsa":g=function(a,b,c,e){a.uniform4fv(b,e.Pb)};f=!0;break;case "u_frame_factor":g=function(a,b,c,e){a.uniform1f(b,e.Re)};f=!0;
break;case "au_center_pos":g=function(){};f=!0;break;case "au_wind_bending_amp":g=function(a,b,c,e){a.uniform1f(b,e.Tc)};f=!0;break;case "au_wind_bending_freq":g=function(a,b,c,e){a.uniform1f(b,e.re)};f=!0;break;case "au_detail_bending_freq":g=function(a,b,c,e){a.uniform1f(b,e.Jd)};f=!0;break;case "au_detail_bending_amp":g=function(a,b,c,e){a.uniform1f(b,e.Id)};f=!0;break;case "au_branch_bending_amp":g=function(a,b,c,e){a.uniform1f(b,e.Ed)};f=!0;break;case "u_anim_values":g=function(a,b,c,e){a.uniform1fv(b,
e.hf)};f=!0;break;case "u_diffuse_color":g=function(a,b,c,e,d){a.uniform4fv(b,d.ib)};f=!0;break;case "u_diffuse_intensity":g=function(a,b,c,e,d){a.uniform1f(b,d.Le)};f=!0;break;case "u_diffuse_params":g=function(a,b,c,e,d){a.uniform2fv(b,d.dd)};f=!0;break;case "u_emit":g=function(a,b,c,e,d){a.uniform1f(b,d.Ld)};f=!0;break;case "u_ambient":g=function(a,b,c,e,d){a.uniform1f(b,d.xc)};f=!0;break;case "u_specular_color":g=function(a,b,c,e,d){a.uniform3fv(b,d.vd)};f=!0;break;case "u_specular_alpha":g=function(a,
b,c,e,d){a.uniform1f(b,d.xj)};f=!0;break;case "u_specular_params":g=function(a,b,c,e,d){a.uniform3fv(b,d.jc)};f=!0;break;case "u_reflect_factor":g=function(a,b,c,e,d){a.uniform1f(b,d.Mh)};f=!0;break;case "u_mirror_factor":g=function(a,b,c,e,d){a.uniform1f(b,d.kl)};f=!0;break;case "u_grass_map_dim":g=function(a,b,c,e,d){a.uniform3fv(b,d.Fb)};f=!0;break;case "u_grass_size":g=function(a,b,c,e,d){a.uniform1f(b,d.Tk)};f=!0;break;case "u_scale_threshold":g=function(a,b,c,e,d){a.uniform1f(b,d.Mi)};f=!0;
break;case "u_cube_fog":g=function(a,b,c,e,d){a.uniformMatrix4fv(b,!1,d.Ac)};break;case "u_jitter_amp":g=function(a,b,c,e,d){a.uniform1f(b,d.Si)};f=!0;break;case "u_jitter_freq":g=function(a,b,c,e,d){a.uniform1f(b,d.Ti)};f=!0;break;case "u_wireframe_mode":g=function(a,b,c,e,d){a.uniform1i(b,d.wireframe_mode)};break;case "u_wireframe_edge_color":g=function(a,b,c,e,d){a.uniform3fv(b,d.wireframe_edge_color)};break;case "u_subpixel_jitter":g=function(a,b,c){a.uniform2fv(b,c.Hv)};f=!0;break;case "u_subsample_indices":g=
function(a,b,c){a.uniform4fv(b,c.Iv)};f=!0;break;case "u_refr_bump":g=function(a,b,c,e,d){a.uniform1f(b,d.zp)};f=!0;break;case "u_lamp_light_positions":g=function(a,b,c,e,d){a.uniform3fv(b,d.$k)};break;case "u_lamp_light_directions":g=function(a,b,c,e,d){a.uniform3fv(b,d.Yk)};break;case "u_lamp_light_color_intensities":g=function(a,b,c,e,d){a.uniform3fv(b,d.Xk)};break;case "u_lamp_light_factors":g=function(a,b,c,e,d){a.uniform4fv(b,d.Zk)};break;case "u_halo_size":g=function(a,b,c,e,d){a.uniform1f(b,
d.no)};f=!0;break;case "u_halo_hardness":g=function(a,b,c,e,d){a.uniform1f(b,d.ko)};f=!0;break;case "u_halo_rings_color":g=function(a,b,c,e,d){a.uniform3fv(b,d.mo)};f=!0;break;case "u_halo_lines_color":g=function(a,b,c,e,d){a.uniform3fv(b,d.lo)};f=!0;break;case "u_halo_stars_blend":g=function(a,b,c,e,d){a.uniform1f(b,d.oo)};f=!0;break;case "u_halo_stars_height":g=function(a,b,c,e,d){a.uniform1f(b,d.po)};f=!0;break;case "u_fresnel_params":g=function(a,b,c,e,d){a.uniform4fv(b,d.kd)};f=!0;break;case "u_texture_scale":g=
function(a,b,c,e,d){a.uniform3fv(b,d.Nc)};f=!0;break;case "u_parallax_scale":g=function(a,b,c,e,d){a.uniform1f(b,d.Dh)};f=!0;break;case "u_color_id":g=function(a,b,c,e,d){a.uniform3fv(b,d.ln)};f=!0;break;case "u_line_points":g=function(a,b,c,e,d){a.uniform3fv(b,d.hA)};f=!0;break;case "u_diffuse_color_factor":g=function(a,b,c,e,d){a.uniform1f(b,d.Ke)};f=!0;break;case "u_alpha_factor":g=function(a,b,c,e,d){a.uniform1f(b,d.ye)};f=!0;break;case "u_specular_color_factor":g=function(a,b,c,e,d){a.uniform1f(b,
d.Up)};f=!0;break;case "u_normal_factor":g=function(a,b,c,e,d){a.uniform1f(b,d.Vo)};f=!0;break;case "u_colormap0_uv_velocity":g=function(a,b,c,e,d){a.uniform2fv(b,d.Hd)};f=!0;break;case "u_normalmap0_uv_velocity":g=function(a,b,c,e,d){a.uniform2fv(b,d.kf[0])};f=!0;break;case "u_normalmap1_uv_velocity":g=function(a,b,c,e,d){a.uniform2fv(b,d.kf[1])};f=!0;break;case "u_normalmap2_uv_velocity":g=function(a,b,c,e,d){a.uniform2fv(b,d.kf[2])};f=!0;break;case "u_normalmap3_uv_velocity":g=function(a,b,c,e,
d){a.uniform2fv(b,d.kf[3])};f=!0;break;case "u_normalmap0_scale":g=function(a,b,c,e,d){a.uniform2fv(b,d.jf[0])};f=!0;break;case "u_normalmap1_scale":g=function(a,b,c,e,d){a.uniform2fv(b,d.jf[1])};f=!0;break;case "u_normalmap2_scale":g=function(a,b,c,e,d){a.uniform2fv(b,d.jf[2])};f=!0;break;case "u_normalmap3_scale":g=function(a,b,c,e,d){a.uniform2fv(b,d.jf[3])};f=!0;break;case "u_foam_factor":g=function(a,b,c,e,d){a.uniform1f(b,d.foam_factor)};f=!0;break;case "u_foam_uv_freq":g=function(a,b,c,e,d){a.uniform2fv(b,
d.Kn)};f=!0;break;case "u_foam_mag":g=function(a,b,c,e,d){a.uniform2fv(b,d.Jn)};f=!0;break;case "u_foam_scale":g=function(a,b,c,e,d){a.uniform2fv(b,d.Jk)};f=!0;break;case "u_shallow_water_col":g=function(a,b,c,e,d){a.uniform3fv(b,d.shallow_water_col)};f=!0;break;case "u_shore_water_col":g=function(a,b,c,e,d){a.uniform3fv(b,d.shore_water_col)};f=!0;break;case "u_water_shallow_col_fac":g=function(a,b,c,e,d){a.uniform1f(b,d.shallow_water_col_fac)};f=!0;break;case "u_water_shore_col_fac":g=function(a,
b,c,e,d){a.uniform1f(b,d.shore_water_col_fac)};f=!0;break;case "u_p_length":g=function(a,b,c,e,d){a.uniform1f(b,d.gp)};f=!0;break;case "u_p_cyclic":g=function(a,b,c,e,d){a.uniform1i(b,d.cp)};f=!0;break;case "u_p_max_lifetime":g=function(a,b,c,e,d){a.uniform1f(b,d.ip)};f=!0;break;case "u_p_fade_in":g=function(a,b,c,e,d){a.uniform1f(b,d.dp)};f=!0;break;case "u_p_fade_out":g=function(a,b,c,e,d){a.uniform1f(b,d.ep)};f=!0;break;case "u_p_size":g=function(a,b,c,e,d){a.uniform1f(b,d.ql)};f=!0;break;case "u_p_alpha_start":g=
function(a,b,c,e,d){a.uniform1f(b,d.$o)};f=!0;break;case "u_p_alpha_end":g=function(a,b,c,e,d){a.uniform1f(b,d.Zo)};f=!0;break;case "u_p_nfactor":g=function(a,b,c,e,d){a.uniform1f(b,d.pl)};f=!0;break;case "u_p_gravity":g=function(a,b,c,e,d){a.uniform1f(b,d.fp)};f=!0;break;case "u_p_mass":g=function(a,b,c,e,d){a.uniform1f(b,d.hp)};f=!0;break;case "u_p_size_ramp":g=function(a,b,c,e,d){a.uniform2fv(b,d.jp)};f=!0;break;case "u_p_color_ramp":g=function(a,b,c,e,d){a.uniform4fv(b,d.ap)};f=!0;break;case "u_p_wind":g=
function(a,b,c,e,d){a.uniform3fv(b,d.gj)};f=!0;break;case "u_texel_size":g=function(a,b,c,e,d){a.uniform2fv(b,d.Tl)};f=!0;break;case "u_p_time":g=function(a,b,c,e,d){a.uniform1f(b,d.Fc.G.time)};f=!0;break;case "u_va_frame_factor":g=function(a,b,c,e){a.uniform1f(b,e.wq)};f=!0;break;case "u_normal_offset":g=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":g=function(a,b,c,e,d,g){a.uniform4fv(b,g.sl)};break;case "u_v_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,
!1,c.vq)};f=!0;break;case "u_b_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Mm)};break;case "u_p_light_matrix0":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.pf[0])};f=!0;break;case "u_p_light_matrix1":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.pf[1])};f=!0;break;case "u_p_light_matrix2":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.pf[2])};f=!0;break;case "u_p_light_matrix3":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.pf[3])};f=!0;break;case "u_motion_blur_exp":g=function(a,b,c){a.uniform1f(b,
c.So)};f=!0;break;case "u_refl_plane":g=function(a,b,c){a.uniform4fv(b,c.ab)};break;case "u_radial_blur_step":g=function(a,b,c){a.uniform1f(b,c.oj)};break;case "u_god_rays_intensity":g=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":g=function(a,b,c){a.uniform1f(b,c.wg)};break;case "u_ssao_dithering_amount":g=function(a,b,c){a.uniform1f(b,c.rg)};break;case "u_ssao_gauss_center":g=function(a,b,c){a.uniform1f(b,c.sg)};break;case "u_ssao_gauss_width_square":g=
function(a,b,c){a.uniform1f(b,c.ug)};break;case "u_ssao_gauss_width_left_square":g=function(a,b,c){a.uniform1f(b,c.tg)};break;case "u_ssao_influence":g=function(a,b,c){a.uniform1f(b,c.vg)};break;case "u_ssao_dist_factor":g=function(a,b,c){a.uniform1f(b,c.qg)};break;case "u_dof_dist":g=function(a,b,c,e,d,g){a.uniform1f(b,g.dof_distance)};f=!0;break;case "u_dof_front":g=function(a,b,c,e,d,g){a.uniform1f(b,g.dof_front)};f=!0;break;case "u_dof_rear":g=function(a,b,c,e,d,g){a.uniform1f(b,g.dof_rear)};
f=!0;break;case "u_glow_intensity":g=function(a,b,c,e,d){a.uniform1f(b,d.Vf)};f=!0;break;case "u_glow_color":g=function(a,b,c){a.uniform3fv(b,c.nh)};break;case "u_draw_glow":g=function(a,b,c){a.uniform1f(b,c.Bk)};f=!0;break;case "u_brightness":g=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":g=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":g=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":g=function(a,b,c){a.uniform1f(b,c.saturation)};
break;default:g=null}g&&(g={name:p,Nk:g,ef:b[p]},f?c.push(g):(e.push(g),d[p]=g))}a.nq=c;a.Fh=e;a.tl=d}var l=m("__config"),k=m("__debug"),g=m("__textures"),e=m("__util"),n=l.p,z=[1,1,1,1],f=[1,1,1,1],t=[0,0,0,1],s=[0,0,0,0];new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var r=null,p=new Uint8Array(4);a.tc=function(a){var b=n.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);
a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);r=a};a.fh=function(a){if(a.P){var e=a.h;r.bindFramebuffer(r.FRAMEBUFFER,e.Od);if(a.$j){var g=e.Va;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,g.Eb,g.Oa,0)}r.viewport(0,0,e.width,e.height);b(a);a.ka?r.enable(r.BLEND):r.disable(r.BLEND);a.Ab?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST);if(a.va){for(var e=a.h,g=a.l,f=0;f<g.length;f++){var s=g[f],n=s.k,l=n.ub;r.useProgram(l.lj);
s=s.Pa;l.Fh.length||d(l);for(var l=l.Fh,y=l.length;y--;){var C=l[y];C.Nk(r,C.ef,a,s,n,e)}}a.va=!1}switch(a.type){case "SHADOW_CAST":r.enable(r.POLYGON_OFFSET_FILL);r.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);r.cullFace(r.BACK);break;case "MAIN_REFLECT":r.disable(r.POLYGON_OFFSET_FILL);r.cullFace(r.FRONT);break;default:r.disable(r.POLYGON_OFFSET_FILL),r.cullFace(r.BACK)}e=a.h;g=a.l;for(f=0;f<g.length;f++)if(s=g[f],s.P){var n=a,B=e,l=s.Pa,z=s.k,s=z.ub;r.useProgram(s.lj);
for(var C=z.Ua,y=z.Jm,K=s.nq,t=K.length;t--;){var m=K[t];m.Nk(r,m.ef,n,l,z,B)}B=z.mn;r.colorMask(B,B,B,B);r.depthMask(z.O);z.ia?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE);B=z.Ea;z=z.Ub;K=s.xf;t=B.length|0;if(0!==t)if(1===t)r.activeTexture(r.TEXTURE0),r.bindTexture(B[0].Eb,B[0].Oa);else for(m=0;m<t;m++){var U=B[m],O=z[m];r.activeTexture(r.TEXTURE0+m);r.bindTexture(U.Eb,U.Oa);r.uniform1i(K[O],m)}if("SKY"==n.type){B=n;z=B.h;s=s.xf;K=B.vn;for(t=0;6>t;t++)if(r.uniformMatrix4fv(s.u_cube_view_matrix,!1,
K[t]),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,h(t),z.Va.Oa,0),c(C,y,l.$l),B.bj&&0!=t){var m=B,U=t,J=p;r.readPixels(191,191,1,1,r.RGBA,r.UNSIGNED_BYTE,J);255!=J[0]&&255!=J[1]&&255!=J[2]||r.readPixels(191,220,1,1,r.RGBA,r.UNSIGNED_BYTE,J);var O=J[0],Q=J[1],J=J[2],O=O/255,Q=Q/255,J=J/255;1===U?(m.Ac[3]=O,m.Ac[7]=Q,m.Ac[11]=J):(m.Ac[4*(U-2)]=O,m.Ac[4*(U-2)+1]=Q,m.Ac[4*(U-2)+2]=J)}n.bh+=6}else c(C,y,l.$l),n.bh++}k.Ws("draw subscene: "+a.type);r.bindFramebuffer(r.FRAMEBUFFER,null)}};a.clear=
b;a.Gm=function(a){var b=a.Jm;b.length=0;var c=a.Ua;a=a.ub;c&&a||e.ba("Incomplete batch");c=c.Gb;a=a.attributes;for(var d in a){var g=c[d];b.push({ef:a[d],Cs:4*g.offset,vu:1<g.frames?4*g.length:0,Ec:g.Ec})}};a.Bs=d;a.qw=function(a,b,c){var d,g,f;d||(d=1);g||(g=1);f||(f=new Uint8Array(4*d*g));f.length!=4*d*g&&e.ba("read_pixels(): Wrong storage");r.bindFramebuffer(r.FRAMEBUFFER,a);r.readPixels(b,c,d,g,r.RGBA,r.UNSIGNED_BYTE,f);r.bindFramebuffer(r.FRAMEBUFFER,null);return f};a.Px=function(a){var b=a.ub;
r.useProgram(b.lj);b.Fh.length||d(b);b=b.tl.u_cube_fog;b.Nk(r,b.ef,null,null,a,null)};a.Bp=function(a,b){var c=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,c);if(a){var e=a,d=e.Oa,e=e.Eb==r.TEXTURE_CUBE_MAP?r.TEXTURE_CUBE_MAP_NEGATIVE_Z:e.Eb;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,e,d,0)}g.Bo(b)?r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,b.Ng):g.th(b)&&(e=b,d=e.Oa,e=e.Eb,r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,e,d,0));k.Ts();
r.bindFramebuffer(r.FRAMEBUFFER,null);return c};a.ww=function(a,b,c,e,d){null==a?(r.bindFramebuffer(r.FRAMEBUFFER,a),r.viewport(0,0,e,d),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)):(g.th(b)&&r.deleteTexture(b.Oa),g.Bo(c)?r.deleteRenderbuffer(c.Ng):g.th(c)&&r.deleteTexture(c.Oa),r.deleteFramebuffer(a))};a.Tz=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,m){function b(a,b,e){var d=a.U;"string"==typeof e&&(a=c(a,e))&&(e=a[1]);for(a=0;a<d.length;a++)if(d[a][0]==b){d[a][1]=e;return}d.push([b,e])}function c(a,b){for(var c=a.U,e=0;e<c.length;e++)if(c[e][0]==b)return c[e];return!1}function h(a,b){var c=a+b;if(x[c])return x[c];if(F){var e=F[b];if(!e)return null}else{e=r.ev(a+b);if(!e)return null;e=q.pp.parse(e)}return x[c]=e}function d(a,b,c,e){function d(b){b=b.a;for(var c=0;c<b.length;c++){var r=b[c];switch(r.type){case "condition":a:for(var r=
r.a,C=0;C<r.length;C++){var v=r[C];switch(v.type){case "if":case "elif":var A=v.c;try{var x,z=l(A,k,n,!0);x=s.pp.parse(z)}catch(t){throw"Failed to process #"+v.type+" expression: "+A.join(" ");}if(x){d(v.group);break a}break;case "else":d(v.group);break;case "ifdef":v.name in k&&d(v.group);break;case "ifndef":v.name in k||d(v.group)}}break;case "include":r=h(p.shaders_dir,p.bx+r.file);d(r);break;case "var":case "export":case "import":break;case "define":C=r.name;k[C]=r.b;r.B&&(n[C]=r.B);break;case "error":throw"Shader error: #error "+
r.b.join(" ");case "line":break;case "pragma":g.push("#pragma "+r.name+" "+r.b.join(" "));break;case "undef":r=r.name;delete k[r];delete n[r];break;case "warning":f.warn("Shader warning: #warning "+r.b.join(" "));break;case "extension":g.push("#extension "+l(r.b,k,n,!1));break;case "#":break;case "node":q[r.name]=r.group.a;break;case "nodes_global":r=e;for(C=0;C<r.length;C++)if(v=r[C],A=q[v.id])for(var F=0,R=0;R<A.length;R++){var w=A[R];"node_param"==w.type&&(w=w.qualifier.join(" ")+" ","vert"==a?
w+=v.Yh[F]:"frag"==a&&(w+=v.B[F],null!==v.ij[F]&&(w+=" = "+v.ij[F])),w+=";",g.push(w),F++)}break;case "nodes_main":r=e;for(C=0;C<r.length;C++)if(v=r[C],A=q[v.id]){var u=w=0,T=0;v.Oh={};for(F=0;F<A.length;F++)switch(R=A[F],R.type){case "node_in":var y=v.H[w];if(null!==v.xo[w]){var W=R.qualifier.join(" ")+" ",W=W+y,W=W+(" = "+v.xo[w]),W=W+";";g.push(W)}v.Oh[R.name]=y;w++;break;case "node_out":y=v.Ma[u];W=R.qualifier.join(" ")+" ";W+=y;W+=";";g.push(W);v.Oh[R.name]=y;u++;break;case "node_param":"vert"==
a?y=v.Yh[T]:"frag"==a&&(y=v.B[T]),v.Oh[R.name]=y,T++}}for(C=0;C<r.length;C++)if(v=r[C],A=q[v.id])for(F=0;F<A.length;F++)if(R=A[F],"textline"==R.type){w=[];for(u=0;u<R.b.length;u++)T=R.b[u],T in v.Oh?w.push(v.Oh[T]):w.push(T);g.push(l(w,k,n,!1))}break;case "textline":g.push(l(r.b,k,n,!1));break;default:throw"Unknown element type: "+r.type;}}}for(var g=[],k={},r=0;r<c.length;r++)k[c[r][0]]=[c[r][1]];for(r=0;r<e.length;r++)k["USE_NODE_"+e[r].id]=[1];var n={},q={};d(b);return g.join("\n")}function l(a,
b,c,e){var d=[];k(a,b,c,e,d);return d.join(" ")}function k(a,b,c,e,d){for(var g=0;g<a.length;g++){var f=a[g];f in b?(f=b[f],0==f.length&&e?d.push(0):k(f,b,c,e,d)):d.push(f)}}function g(a,b,c,e){e=a.createShader(e);a.shaderSource(e,c);a.compileShader(e);t.Xs(e,b,c);return e}function e(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return n(a);case 2:return"vec2("+n(a[0])+","+n(a[1])+")";case 3:return"vec3("+n(a[0])+","+n(a[1])+","+n(a[2])+")";case 4:return"vec4("+n(a[0])+","+n(a[1])+","+n(a[2])+
","+n(a[3])+")";case 9:return"mat3("+n(a[0])+","+n(a[1])+","+n(a[2])+","+n(a[3])+","+n(a[4])+","+n(a[5])+","+n(a[6])+","+n(a[7])+","+n(a[8])+")";case 16:return"mat4("+n(a[0])+","+n(a[1])+","+n(a[2])+","+n(a[3])+","+n(a[4])+","+n(a[5])+","+n(a[6])+","+n(a[7])+","+n(a[8])+","+n(a[9])+","+n(a[10])+","+n(a[11])+","+n(a[12])+","+n(a[13])+","+n(a[14])+","+n(a[15])+")";default:throw"Wrong glsl value dimension";}}function n(a){return a%1?String(a):String(a)+".0"}var z=m("__config"),f=m("__print"),t=m("__debug"),
s=m("__gpp_eval"),r=m("__assets");m("__util");var p=z.rb;if(b4w.module_check(z.rb.Op))var F=m(z.rb.Op),q=null;else F=null,q=m("__gpp_parser");var v={},x={},A=[],L=null;a.tc=function(a){L=a};a.J=b;a.Wu=c;a.$z=function(a,b){for(var c=a.U,e=0;e<c.length;e++)if(c[e][0]==b&&1==c[e][1])return!0;return!1};a.Nw=function(a){a.U=[];for(var c="ALPHA ALPHA_CLIP BEND_CENTER_ONLY CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING HAIR_BILLBOARD_JITTERED HAIR_BILLBOARD_SPHERICAL SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE SHORE_SMOOTHING SKINNED SKY_TEXTURE SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER HAIR_BILLBOARD HAIR_BILLBOARD_RANDOM PRECISION EPSILON WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
d=0;d<c.length;d++){var g=c[d],p;switch(g){case "ALPHA":case "ALPHA_CLIP":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "HAIR_BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_TEXTURE":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "HAIR_BILLBOARD":case "HAIR_BILLBOARD_RANDOM":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":p=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "HAIR_BILLBOARD_SPHERICAL":case "NUM_LIGHTS":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":p=1;break;case "SHADOW_TEX_RES":p=e(2048);break;case "AA_METHOD":p="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":p="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":p="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":p="POST_EFFECT_NONE";break;case "SHADOW_SRC":p="SHADOW_SRC_NONE";
break;case "SHADOW_DST":p="SHADOW_DST_NONE";break;case "SSAO_QUALITY":p="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":p="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":p="TEXTURE_COORDS_UV";break;case "PRECISION":p=z.p.precision;break;case "EPSILON":p="highp"==z.p.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":p="u_va_frame_factor";break;default:f.error("Unknown directive ("+a.ja+", "+a.ea+"): "+g)}b(a,g,p)}};a.Mz=function(a){return a.ja};a.Vn=function(a){return a.ea};a.vv=
function(a,e){for(var d=e.U,g=0;g<d.length;g++){var f=d[g][0],p=d[g][1];c(a,f)&&b(a,f,p)}};a.Qk=function(a,b){var c=JSON.stringify(a)+JSON.stringify(b),e=v[c];if(e)return e;var r=a.ea,e=h(p.shaders_dir,a.ja),r=h(p.shaders_dir,r);if(!e||!r)return null;var k=a.U||[],n=d("vert",e,k,b),k=d("frag",r,k,b),e=L,s=g(e,c,n,e.VERTEX_SHADER),q=g(e,c,k,e.FRAGMENT_SHADER),r=e.createProgram();e.attachShader(r,s);e.attachShader(r,q);e.linkProgram(r);e.validateProgram(r);e.getProgramParameter(r,e.VALIDATE_STATUS)==
e.Ey&&f.error("B4W Error - shader program is not valid",c);t.Ys(r,c,s,q,n,k);n={Aq:s,On:q,lj:r,attributes:{},xf:{},Fh:[],tl:{},nq:[],Da:a};s=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES);for(k=0;k<s;k++)q=e.getActiveAttrib(r,k).name,n.attributes[q]=e.getAttribLocation(r,q);s=e.getProgramParameter(r,e.ACTIVE_UNIFORMS);for(k=0;k<s;k++)q=e.getActiveUniform(r,k).name.split("[0]").join(""),n.xf[q]=e.getUniformLocation(r,q);return v[c]=e=n};a.Qt=function(){return A};a.Ru=function(){return v};a.cleanup=function(){for(var a in v){var b=
v[a];L.deleteProgram(b.lj);L.deleteShader(b.Aq);L.deleteShader(b.On);delete v[a]}for(var c in x)delete x[c];for(var e in A)delete A[e]};a.jz=function(a){var b=a.U;f.log("Shader: "+a.ja+" "+a.ea+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)f.log("  "+b[a][0],b[a][1])};a.t=e;a.bn=function(a,b){return b in a.xf?!0:!1}};b4w.module.shader_texts=function(a){a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_glow_intensity",";"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",
b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_glow_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},
{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",
a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 cd = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"cd = mix ( cd , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 ce = vec3 ( 0.0 ) ; vec3 cf = vec3 ( 0.0 ) ; vec3 cg = vec3 ( 0.0 ) ; bl ( cd , ce , cf , cg ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","ch","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ch = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ci = ( u_model_matrix * vec4 ( ch , 1.0 ) ) . xyz ; mat4 cj = _ ( u_camera_eye , ci , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 ck = ( u_model_matrix * vec4 ( ch , 1.0 ) ) . xyz ; cj = cj * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , ck ) ;".split(" ")}]}}]},{type:"textline",b:"c cl = ag ( cd - ch , ch , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , cj ) ; cl . b = ci ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c cl = ag ( cd , ch , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","cm","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cm = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cc ( cl . a , cl . b , cm ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = aj ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( cl . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC",
"!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ;".split(" ")}]}}]},{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cy",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4",
"cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"shadow.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float fg = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"float fg = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( fg < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = ck ( cx ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( fa ( cD . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",
b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"WIND_BEND && MAIN_BEND_COL && DETAIL_BEND || SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",
a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",
b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","cy",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 gj = a_position ;".split(" ")},{type:"condition",a:[{type:"if",
c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"gj = mix ( gj , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 gk = vec3 ( 0.0 ) ; vec3 gl = vec3 ( 0.0 ) ; vec3 gm = vec3 ( 0.0 ) ; bl ( gj , gk , gl , gm ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","gn","=","au_center_pos",
";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gn = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c go = fV ( gj , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gn , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",
a:[{type:"textline",b:"vec3 gp = ( u_model_matrix * vec4 ( gn , 1.0 ) ) . xyz ; mat4 gq = _ ( u_camera_eye , gp , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 gr = ( u_model_matrix * vec4 ( gn , 1.0 ) ) . xyz ; gq = gq * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , gr ) ;".split(" ")}]}}]},{type:"textline",b:"c go = ag ( gj - gn , gn , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gq ) ; go . b = gp ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"c go = ag ( gj , gn , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","gs","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gs = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",
b:"cc ( go . a , go . b , gs ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gt = u_view_matrix * vec4 ( go . a , 1.0 ) ; vec4 gu = u_proj_matrix * gt ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"gu . xy += u_subpixel_jitter * gu . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = aj ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"ge ( go . a ) ; cD = gt ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"cx = - gt . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 gv = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; float gw = SHADOW_TEX_RES / 2.0 ; gv = floor ( gv * gw + 0.5 ) / gw - gv ; gu . xy += gv ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","gu",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gj",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gj",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gj",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","gj",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( gj , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , gj ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4",
"u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gj",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gj",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gj",";"]}]}}]}]}}]},{type:"textline",b:["void",
"main","(",")","{"]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gk = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 gl = _ ( u_camera_eye , gk , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"gl = gl * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"c gm = ag ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gl ) ; gm . b = gk ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"c gm = ag ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gn = u_proj_matrix * u_view_matrix * vec4 ( gm . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gj = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["gj","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gj","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","gn",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",
b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS",
"&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 gr ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float gs ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int gt = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int gt = NUM_LINES ;".split(" ")}]}}]},
{type:"textline",b:"float gv ( float gu ) { return gu - floor ( gu * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void gE ( inout float gw , in float gx [ gt ] , in float gy ) { for ( int gz = NUM_RINGS ; gz > 0 ; gz -- ) { float gA = 40.0 * gx [ gz ] ; float gB = 300.0 * ( gv ( gA ) - 0.005 ) ; float gC = gA ; float gD = abs ( gC * ( u_halo_size * gB - gy ) ) ; gw += 1.0 - min ( gD , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void gN ( inout float gF , in float gG [ gt ] , in float gH ) { for ( int gI = NUM_LINES ; gI > 0 ; gI -- ) { float gJ = gG [ gI ] ; float gK = gJ ; float gL = 1000.0 * ( gv ( gJ ) - 0.005 ) ; float gM = 20.0 * abs ( gK * a . x + gL * a . y ) ; gF += 1.0 - min ( gM , 1.0 ) ; } gF *= gH ; }".split(" ")}]}}]},{type:"textline",b:"void gU ( inout float gO , in vec2 gP ) { float gQ , gR ; gR = atan ( gP . y , gP . x ) ; gR *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float gS = cos ( gR ) ; float gT = sin ( gR ) ; gR = ( gS * gP . x + gT * gP . y ) * ( gS * gP . y - gT * gP . x ) ; gQ = abs ( gR ) ; if ( gQ < 1.0 ) { gQ = ( 0.01 * u_halo_size ) / ( gQ ) ; gO *= sqrt ( min ( gQ , 1.0 ) ) ; } } void main ( ) { float gV = ( a . x * a . x + a . y * a . y ) ; float gW = sqrt ( gV ) ; gV = max ( 1.0 - gV , 0.0 ) ; gV = pow ( gV , u_halo_hardness ) ; float gX = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float gY [ gt ] ; for ( int gZ = 0 ; gZ < gt ; gZ ++ ) { gY [ gZ ] = fract ( gs / ( float ( gZ ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"float g_ = 0.0 ; gE ( g_ , gY , gW ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float ha = 0.0 ; gN ( ha , gY , gV ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"gU ( gV , a ) ;".split(" ")}]}}]},{type:"textline",b:"gV *= gX ; vec3 hb = u_diffuse_color . rgb * gV ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"g_ *= gV ; hb += u_halo_rings_color * g_ ; gV += g_ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"ha *= gX ; hb += u_halo_lines_color * ha ; gV += ha ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"gV *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float hc = u_halo_stars_blend * ( gr . y - u_halo_stars_height ) ; gV *= clamp ( hc , 0.0 , 1.0 ) ; gV *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"gn ( hb ) ; gq ( hb , gV ) ; gl_FragColor = vec4 ( hb , gV ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float gs ;".split(" ")},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gr",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 gt = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; a = a_halo_bb_vertex * 2.0 ; gs = fract ( gt . x + gt . y + gt . z ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",
a:[{type:"textline",b:"mat4 gu = y ( gt , u_view_matrix ) ; mat4 gv = u_view_matrix ; gv [ 3 ] [ 0 ] = 0.0 ; gv [ 3 ] [ 1 ] = 0.0 ; gv [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gu = y ( gt , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gw = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 gx = gu * gw ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"vec4 gy = u_proj_matrix * gv * gx ; gy . z = 0.99999 * gy . w ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["gr","=","gx",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 gy = u_proj_matrix * u_view_matrix * gx ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gy",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};
a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 gt = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( gt , 1.0 ) ; }".split(" ")}]};a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",
name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"TEXCOORD",b:"( TEXTURE_COLOR && TEXTURE_COORDS == TEXTURE_COORDS_UV || TEXTURE_STENCIL_ALPHA_MASK || TEXTURE_SPEC || TEXTURE_NORM )".split(" ")},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",
a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ; uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform",
"vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_NORMAL","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D",
"u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform float u_normal_factor ; uniform vec2 u_normalmap0_uv_velocity ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ; uniform vec2 u_colormap0_uv_velocity ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_reflect_factor ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",
a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 kf ; varying vec3 kg ; varying vec3 kh ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ki",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kj",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cy",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cC",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kk",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"float kW = kg . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["vec2","kX","=","a",";"]}]}}]},{type:"textline",b:["vec3","kY","=","kh",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) kY = kY ; else kY = - kY ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"vec3 kZ = cross ( kY , ki . xyz ) * ki . w ; mat3 k_ = mat3 ( ki . xyz , kZ , kY ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float la = length ( cD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( la < PARALLAX_LOD_DIST ) { float lb = clamp ( 5.0 - 0.5 * la , 0.0 , 1.0 ) ; float lc = u_parallax_scale * lb ; vec3 ld = normalize ( kf * k_ ) ; float le = 1.0 / PARALLAX_STEPS ; vec2 lf = ld . xy * lc / ( PARALLAX_STEPS * ld . z ) ; float lg = 1.0 ; float lh = texture2D ( u_normalmap0 , kX ) . a ; for ( float li = 1.0 ; li <= PARALLAX_STEPS ; li ++ ) { if ( lh < lg ) { lg -= le ; kX -= lf ; lh = texture2D ( u_normalmap0 , kX ) . a ; } } vec2 lj = kX + lf ; float lk = texture2D ( u_normalmap0 , lj ) . a - ( lg + le ) ; float ll = lh - lg ; float lm = ll / ( ll - lk ) ; kX = lm * lj + ( 1.0 - lm ) * kX ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"vec4 ln = texture2D ( u_normalmap0 , kX + u_time * u_normalmap0_uv_velocity ) ; vec3 lo = ln . rgb - 0.5 ; lo = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , lo , u_normal_factor ) ; vec3 lp = k_ * lo ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","lp","=","kY",";"]}]}}]},{type:"textline",b:"lp = normalize ( lp ) ; vec3 lq = normalize ( kf ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec3 lr = kj ; gl ( lr ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec4 ls = vec4 ( lr , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","ls","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["float","lt","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec2 lu = normalize ( u_view_matrix_frag * vec4 ( lp , 0.0 ) ) . st ; lu = lu * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:"vec4 lv = texture2D ( u_colormap0 , kX ) ; gl ( lv . rgb ) ; vec4 lw ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COORDS",
"==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lw = texture2D ( u_colormap1 , lu ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_UV"],group:{type:"group",a:[{type:"textline",b:"lw = texture2D ( u_colormap1 , kX ) ;".split(" ")}]}}]},{type:"textline",b:"gl ( lw . rgb ) ; vec4 lx = texture2D ( u_stencil0 , kX ) ; vec4 ly = mix ( lv , lw , lx . r ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COORDS",
"==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec4 ly = texture2D ( u_colormap0 , lu ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_UV"],group:{type:"group",a:[{type:"textline",b:"vec4 ly = texture2D ( u_colormap0 , kX + u_time * u_colormap0_uv_velocity ) ;".split(" ")}]}}]},{type:"textline",b:"gl ( ly . rgb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",
b:"ls . rgb = mix ( ls . rgb , ly . rgb , u_diffuse_color_factor ) ; float lz = u_alpha_factor * ly . a ; lz += ( 1.0 - step ( 0.0 , lz ) ) ; ls . a = mix ( lz , 1.0 , u_diffuse_color . a ) ; lt = ly . a ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"ls . rgb *= mix ( vec3 ( 1.0 ) , ly . rgb , u_diffuse_color_factor ) ; ls . a = ly . a ; lt = ly . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 lA = u_diffuse_intensity * ls . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["vec3","lB","=","lA",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lC = 0.5 * lp . y + 0.5 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 lD = u_environment_energy * textureCube ( u_sky_texture , lp ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lD = u_environment_energy * mix ( u_horizon_color , u_zenith_color , lC ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 lE = u_ambient * lD ; float lF = ff ( lA ) ; vec3 lG = u_emit * ls . rgb ; vec3 lH = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"vec3 lI = vec3 ( lt ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lI = texture2D ( u_specmap , kX ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"gl ( lI . rgb ) ; lH = mix ( lH , lI , u_specular_color_factor ) ;".split(" ")}]}}]},
{type:"textline",b:"float lJ = u_specular_params [ 0 ] ; vec2 lK = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 lL = lJ * lH ; hh lM = jE ( lG , lE , lA , lL , kg , lp , lq , lK , u_diffuse_params , lF , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ; vec3 lB = lM . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["float","lN","=","u_reflect_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","lN","=","0.0",";"]}]}}]},{type:"textline",b:"kH ( lB , lq , lp , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , lN ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"lB += lM . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"lB = max ( lB - sqrt ( 0.01 * - min ( kW , 0.0 ) ) , 0.5 * lB ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"ke ( lB , kW , u_time , lF , lp , u_sun_direction , u_sun_intensity , u_sun_quaternion , kg , la ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"float lO = ls . a ; if ( lO <= 0.5 ) discard ; lO = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lO = ls . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"lO += lM . a . a * lL . r * u_specular_alpha ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","lO","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:"lB = mix ( kV ( cC , lp . xz * u_refr_bump ) , lB , lO ) ; lO = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 lP = gF ( u_cube_fog , lq ) ; vec4 lQ = vec4 ( lP , u_fog_color_density . a ) ; gl ( lQ . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 lQ = u_fog_color_density ; lQ . rgb *= u_sun_intensity ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"gY ( lB , la , lq , u_cam_water_depth , u_underwater_fog_color_density , lQ , kW , length ( u_sun_intensity ) + u_environment_energy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gy ( lB , la , lQ ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),group:{type:"group",a:[{type:"textline",
b:"lB = vec3 ( dJ . a ) ;".split(" ")}]}}]},{type:"textline",b:["gn","(","lB",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gq ( lB , lO ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lB , lO ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",
b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"define",name:"TEXCOORD",b:"( TEXTURE_COLOR && TEXTURE_COORDS == TEXTURE_COORDS_UV || TEXTURE_STENCIL_ALPHA_MASK || TEXTURE_SPEC || TEXTURE_NORM )".split(" ")},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",
a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",
b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",
a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 kf ; varying vec3 kg ; varying vec3 kh ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4",
"cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ki",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kj",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cy",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kk",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 kW = a_position ; vec3 kX = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],
group:{type:"group",a:[{type:"textline",b:"vec3 kY = vec3 ( a_tangent ) ; vec3 kZ = a_tangent [ 3 ] * cross ( kX , kY ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 kY = vec3 ( 0.0 ) ; vec3 kZ = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"kW = mix ( kW , a_position_next , u_va_frame_factor ) ; kX = mix ( kX , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"vec3 k_ = vec3 ( a_tangent ) ; vec3 la = a_tangent_next [ 3 ] * cross ( a_normal_next , k_ ) ; kY = mix ( kY , k_ , u_va_frame_factor ) ; kZ = mix ( kZ , la , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bl ( kW , kY , kZ , kX ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["vec3","lb","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lb = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c lc = fV ( kW , kY , kZ , kX , lb , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ld = ( u_model_matrix * vec4 ( lb , 1.0 ) ) . xyz ; mat4 le = _ ( u_camera_eye , ld , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 lf = ( u_model_matrix * vec4 ( lb , 1.0 ) ) . xyz ; le = le * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , lf ) ;".split(" ")}]}}]},{type:"textline",b:"c lc = ag ( kW - lb , lb , kY , kZ , kX , le ) ; lc . b = ld ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"c lc = ag ( kW , lb , kY , kZ , kX , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"float lg = ( dot ( cross ( lc . e , lc . c ) , lc . d ) < 0.0 ) ? - 1.0 : 1.0 ; ki = vec4 ( lc . c , lg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cc ( lc . a , lc . b , kX ) ;".split(" ")}]}}]},{type:"textline",
b:"kg = lc . a ; kh = lc . e ; kf = u_camera_eye - lc . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"a = aj ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kj = lc . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["kj","=","a_color",";"]}]}}]},{type:"textline",b:"vec4 lh = u_view_matrix * vec4 ( lc . a , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["cD","=","lh",";"]}]}}]},{type:"textline",b:"vec4 li = u_proj_matrix * lh ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"li . xy += u_subpixel_jitter * li . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",
a:[{type:"textline",b:["ge","(","li",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"ge ( lc . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:"float lj = li . x ; float lk = li . y ; float ll = li . w ; cC . x = ( lj + ll ) / 2.0 ; cC . y = ( lk + ll ) / 2.0 ; cC . z = ll ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kk = - lh . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","li",";","}"]}]};a["nodes.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_ANIM_VALUES",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",
file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",
a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",
";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_VECTOR_VIEW","||","REFLECTIVE"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_reflectmap ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D",
"u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",
a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["USE_NODE_ANIM_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_anim_values [ NUM_ANIM_VALUES ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 kg ; varying vec4 cD ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kh",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec4","ki",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cy",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kk",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 kW = vec3 ( UNITY_VALUE_NODES ) ; vec3 kX = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},
{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"},{type:"textline",b:"vec3 la ( in vec3 kY , in float kZ ) { vec3 k_ = kX ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"k_ = kV ( cC , kY . xz * kZ ) ;".split(" ")}]}}]},{type:"textline",b:["return","k_",";","}"]}]}}]},{type:"textline",b:"vec3 ld ( float lb , vec3 lc ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , lc ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return mix ( u_horizon_color , u_zenith_color , lb ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec3 lk ( vec3 le ) { vec4 lf = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; vec4 lg = mix ( vec4 ( le . bg , lf . wz ) , vec4 ( le . gb , lf . xy ) , step ( le . b , le . g ) ) ; vec4 lh = mix ( vec4 ( lg . xyw , le . r ) , vec4 ( le . r , lg . yzx ) , step ( lg . x , le . r ) ) ; float li = lh . x - min ( lh . w , lh . y ) ; float lj = 1.0e-10 ; return vec3 ( abs ( lh . z + ( lh . w - lh . y ) / ( 6.0 * li + lj ) ) , li / ( lh . x + lj ) , lh . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 lo ( vec3 ll ) { vec4 lm = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; vec3 ln = abs ( fract ( vec3 ( ll . r , ll . r , ll . r ) + lm . xyz ) * 6.0 - lm . www ) ; return ll . b * mix ( lm . xxx , clamp ( ln - lm . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , ll . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 lq ( vec2 lp ) { return vec3 ( lp * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_TEXTURE_COLOR || USE_NODE_TEXTURE_NORMAL || USE_NODE_TEXTURE_COLOR2 || USE_NODE_TEXTURE_NORMAL2 || USE_NODE_TEXTURE_COLOR3 || USE_NODE_TEXTURE_NORMAL3 || USE_NODE_TEXTURE_NORMAL4 || USE_NODE_TEXTURE_COLOR4 || USE_NODE_PARALLAX".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 ls ( vec3 lr ) { return vec2 ( lr . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},{type:"textline",b:"void lx ( inout vec3 lt , vec3 lu , vec3 lv , float lw ) {".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"kH ( lt , lu , lv , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , lw ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kH ( lt , lu , lv , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , lw ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"} hh lQ ( vec3 ly , vec3 lz , vec3 lA , vec3 lB , vec3 lC , vec3 lD , vec3 lE , vec2 lF , vec2 lG , float lH , vec3 lI [ NUM_LIGHTS ] , vec3 lJ [ NUM_LIGHTS ] , vec3 lK [ NUM_LIGHTS ] , vec4 lL [ NUM_LIGHTS ] , vec4 lM [ NUM_LIGHTS ] , float lN , vec4 lO ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS_MAT"],
group:{type:"group",a:[{type:"textline",b:"return jE ( ly , lz , lA , lB , lC , lD , lE , lF , lG , lH , lI , lJ , lK , lL , lM , lN , lO ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hh lP ; lP . a = vec4 ( lA , ZERO_VALUE_NODES ) ; lP . b = kX ; return lP ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"node",name:"CAMERA",group:{type:"group",a:[{type:"node_out",name:"mG",qualifier:["vec3"]},{type:"node_out",name:"mH",qualifier:["float"]},{type:"node_out",name:"mI",
qualifier:["float"]},{type:"textline",b:"mG = normalize ( mw . xyz ) ; mH = abs ( mw . z ) ; mI = length ( mw . xyz ) ;".split(" ")}]}},{type:"node",name:"COMBRGB",group:{type:"group",a:[{type:"node_in",name:"mJ",qualifier:["float"]},{type:"node_in",name:"mK",qualifier:["float"]},{type:"node_in",name:"mL",qualifier:["float"]},{type:"node_out",name:"mM",qualifier:["vec3"]},{type:"textline",b:"mM = vec3 ( mJ , mK , mL ) ;".split(" ")}]}},{type:"node",name:"COMBHSV",group:{type:"group",a:[{type:"node_in",
name:"mN",qualifier:["float"]},{type:"node_in",name:"mO",qualifier:["float"]},{type:"node_in",name:"mP",qualifier:["float"]},{type:"node_out",name:"mQ",qualifier:["vec3"]},{type:"textline",b:"mQ = lo ( vec3 ( mN , mO , mP ) ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"lR",qualifier:["varying","vec2"]},{type:"node_out",name:"mR",qualifier:["vec3"]},{type:"textline",b:"mR = lq ( lR ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VC",group:{type:"group",
a:[{type:"node_param",name:"lS",qualifier:["varying","vec3"]},{type:"node_out",name:"mS",qualifier:["vec3"]},{type:"textline",b:["mS","=","lS",";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"lT",qualifier:["varying","float"]},{type:"node_out",name:"mT",qualifier:["float"]},{type:"textline",b:["mT","=","lT",";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"lU",qualifier:["varying","vec2"]},{type:"node_out",name:"mU",
qualifier:["float"]},{type:"node_out",name:"mV",qualifier:["float"]},{type:"textline",b:"mU = lU [ 0 ] ; mV = lU [ 1 ] ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VC3",group:{type:"group",a:[{type:"node_param",name:"lV",qualifier:["varying","vec3"]},{type:"node_out",name:"mW",qualifier:["float"]},{type:"node_out",name:"mX",qualifier:["float"]},{type:"node_out",name:"mY",qualifier:["float"]},{type:"textline",b:"mW = lV [ 0 ] ; mX = lV [ 1 ] ; mY = lV [ 2 ] ;".split(" ")}]}},{type:"node",name:"GEOMETRY_NO",
group:{type:"group",a:[{type:"node_out",name:"mZ",qualifier:["vec3"]},{type:"textline",b:["mZ","=","ms",";"]}]}},{type:"node",name:"GEOMETRY_FB",group:{type:"group",a:[{type:"node_out",name:"m_",qualifier:["float"]},{type:"textline",b:"m_ = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VW",group:{type:"group",a:[{type:"node_out",name:"na",qualifier:["vec3"]},{type:"textline",b:["na","=","mu",";"]}]}},{type:"node",name:"GEOMETRY_GL",group:{type:"group",
a:[{type:"node_out",name:"nb",qualifier:["vec3"]},{type:"textline",b:"nb = vec3 ( mv . r , - mv . b , mv . g ) ;".split(" ")}]}},{type:"node",name:"HUE_SAT",group:{type:"group",a:[{type:"node_in",name:"nc",qualifier:["float"]},{type:"node_in",name:"nd",qualifier:["float"]},{type:"node_in",name:"ne",qualifier:["float"]},{type:"node_in",name:"nf",qualifier:["float"]},{type:"node_in",name:"ng",qualifier:["vec3"]},{type:"node_out",name:"nh",qualifier:["vec3"]},{type:"textline",b:"{ vec3 ni = lk ( ng ) ; ni [ 0 ] += ( nc - 0.5 ) ; if ( ni [ 0 ] > UNITY_VALUE_NODES ) ni [ 0 ] -= UNITY_VALUE_NODES ; else if ( ni [ 0 ] < ZERO_VALUE_NODES ) ni [ 0 ] += UNITY_VALUE_NODES ; ni *= vec3 ( UNITY_VALUE_NODES , nd , ne ) ; ni = mix ( kW , mix ( kX , ni , step ( kX , ni ) ) , step ( ni , kW ) ) ; nh = mix ( ng , lo ( ni ) , nf ) ; }".split(" ")}]}},
{type:"node",name:"INVERT",group:{type:"group",a:[{type:"node_in",name:"nj",qualifier:["float"]},{type:"node_in",name:"nk",qualifier:["vec3"]},{type:"node_out",name:"nl",qualifier:["vec3"]},{type:"textline",b:"nl = mix ( nk , kW - nk , nj ) ;".split(" ")}]}},{type:"node",name:"LAMP",group:{type:"group",a:[{type:"node_param",name:"lW",qualifier:["const","float"]},{type:"node_out",name:"nm",qualifier:["vec3"]},{type:"node_out",name:"nn",qualifier:["vec3"]},{type:"node_out",name:"no",qualifier:["float"]},
{type:"node_out",name:"np",qualifier:["float"]},{type:"textline",b:"{ const int nq = int ( lW ) ; vec4 nr = u_lamp_light_factors [ nq ] ; vec3 ns = u_lamp_light_directions [ nq ] ; vec3 nt = u_lamp_light_positions [ nq ] ; float nu = nr . z ; nm = u_lamp_light_color_intensities [ nq ] ; if ( nu != - UNITY_VALUE_NODES ) { nn = nt - kg ; no = length ( nn ) ; nn = normalize ( nn ) ; np = nu / ( nu + no * no ) ; float nv = nr . x ; float nw = nr . y ; if ( nv > - UNITY_VALUE_NODES ) { float nx = dot ( nn , ns ) ; nx *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( nx - nv ) / nw ) ; np *= nx ; } } else { nn = ns ; no = length ( nt - kg ) ; np = UNITY_VALUE_NODES ; } }".split(" ")}]}},
{type:"node",name:"NORMAL",group:{type:"group",a:[{type:"node_param",name:"lX",qualifier:["vec3"]},{type:"node_in",name:"ny",qualifier:["vec3"]},{type:"node_out",name:"nz",qualifier:["vec3"]},{type:"node_out",name:"nA",qualifier:["float"]},{type:"textline",b:"nz = lX ; nA = - dot ( ny , lX ) ;".split(" ")}]}},{type:"node",name:"VECTOR_VIEW",group:{type:"group",a:[{type:"node_in",name:"nB",qualifier:["vec3"]},{type:"node_out",name:"nC",qualifier:["vec3"]},{type:"textline",b:"nC = - ( u_view_matrix_frag * vec4 ( nB , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]}},
{type:"node",name:"MAPPING_LIGHT",group:{type:"group",a:[{type:"node_param",name:"lY",qualifier:["vec3"]},{type:"node_in",name:"nD",qualifier:["vec3"]},{type:"node_out",name:"nE",qualifier:["vec3"]},{type:"textline",b:"nE = nD * lY ;".split(" ")}]}},{type:"node",name:"MAPPING_HEAVY",group:{type:"group",a:[{type:"node_param",name:"lZ",qualifier:["mat4"]},{type:"node_param",name:"l_",qualifier:["float"]},{type:"node_param",name:"ma",qualifier:["float"]},{type:"node_param",name:"mb",qualifier:["vec3"]},
{type:"node_param",name:"mc",qualifier:["vec3"]},{type:"node_in",name:"nF",qualifier:["vec3"]},{type:"node_out",name:"nG",qualifier:["vec3"]},{type:"textline",b:"nG = ( lZ * vec4 ( nF , UNITY_VALUE_NODES ) ) . xyz ; if ( l_ == UNITY_VALUE_NODES ) nG = max ( nG , mb ) ; if ( ma == UNITY_VALUE_NODES ) nG = min ( nG , mc ) ;".split(" ")}]}},{type:"node",name:"MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"nH",qualifier:["float"]},{type:"node_in",name:"nI",qualifier:["float"]},{type:"node_out",
name:"nJ",qualifier:["float"]},{type:"textline",b:"nJ = nH + nI ;".split(" ")}]}},{type:"node",name:"MATH_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"nK",qualifier:["float"]},{type:"node_in",name:"nL",qualifier:["float"]},{type:"node_out",name:"nM",qualifier:["float"]},{type:"textline",b:"nM = nK - nL ;".split(" ")}]}},{type:"node",name:"MATH_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"nN",qualifier:["float"]},{type:"node_in",name:"nO",qualifier:["float"]},{type:"node_out",name:"nP",
qualifier:["float"]},{type:"textline",b:"nP = nN * nO ;".split(" ")}]}},{type:"node",name:"MATH_DIVIDE",group:{type:"group",a:[{type:"node_in",name:"nQ",qualifier:["float"]},{type:"node_in",name:"nR",qualifier:["float"]},{type:"node_out",name:"nS",qualifier:["float"]},{type:"textline",b:"nS = ( nR != ZERO_VALUE_NODES ) ? nQ / nR : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_SINE",group:{type:"group",a:[{type:"node_in",name:"nT",qualifier:["float"]},{type:"node_in",name:"nU",qualifier:["float"]},
{type:"node_out",name:"nV",qualifier:["float"]},{type:"textline",b:"nV = sin ( nT ) ; nU ;".split(" ")}]}},{type:"node",name:"MATH_COSINE",group:{type:"group",a:[{type:"node_in",name:"nW",qualifier:["float"]},{type:"node_in",name:"nX",qualifier:["float"]},{type:"node_out",name:"nY",qualifier:["float"]},{type:"textline",b:"nY = cos ( nW ) ; nX ;".split(" ")}]}},{type:"node",name:"MATH_TANGENT",group:{type:"group",a:[{type:"node_in",name:"nZ",qualifier:["float"]},{type:"node_in",name:"n_",qualifier:["float"]},
{type:"node_out",name:"oa",qualifier:["float"]},{type:"textline",b:"oa = tan ( nZ ) ; n_ ;".split(" ")}]}},{type:"node",name:"MATH_ARCSINE",group:{type:"group",a:[{type:"node_in",name:"ob",qualifier:["float"]},{type:"node_in",name:"oc",qualifier:["float"]},{type:"node_out",name:"od",qualifier:["float"]},{type:"textline",b:"od = ( ob <= UNITY_VALUE_NODES && ob >= - UNITY_VALUE_NODES ) ? asin ( ob ) : ZERO_VALUE_NODES ; oc ;".split(" ")}]}},{type:"node",name:"MATH_ARCCOSINE",group:{type:"group",a:[{type:"node_in",
name:"oe",qualifier:["float"]},{type:"node_in",name:"of",qualifier:["float"]},{type:"node_out",name:"og",qualifier:["float"]},{type:"textline",b:"og = ( oe <= UNITY_VALUE_NODES && oe >= - UNITY_VALUE_NODES ) ? acos ( oe ) : ZERO_VALUE_NODES ; of ;".split(" ")}]}},{type:"node",name:"MATH_ARCTANGENT",group:{type:"group",a:[{type:"node_in",name:"oh",qualifier:["float"]},{type:"node_in",name:"oi",qualifier:["float"]},{type:"node_out",name:"oj",qualifier:["float"]},{type:"textline",b:"oj = atan ( oh ) ; oi ;".split(" ")}]}},
{type:"node",name:"MATH_POWER",group:{type:"group",a:[{type:"node_in",name:"ok",qualifier:["float"]},{type:"node_in",name:"ol",qualifier:["float"]},{type:"node_out",name:"om",qualifier:["float"]},{type:"textline",b:"if ( ok < ZERO_VALUE_NODES || ok == ZERO_VALUE_NODES && ol == ZERO_VALUE_NODES ) om = ZERO_VALUE_NODES ; else om = pow ( ok , ol ) ;".split(" ")}]}},{type:"node",name:"MATH_LOGARITHM",group:{type:"group",a:[{type:"node_in",name:"on",qualifier:["float"]},{type:"node_in",name:"oo",qualifier:["float"]},
{type:"node_out",name:"op",qualifier:["float"]},{type:"textline",b:"op = ( on > ZERO_VALUE_NODES && oo > ZERO_VALUE_NODES ) ? log2 ( on ) / log2 ( oo ) : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_MINIMUM",group:{type:"group",a:[{type:"node_in",name:"oq",qualifier:["float"]},{type:"node_in",name:"or",qualifier:["float"]},{type:"node_out",name:"os",qualifier:["float"]},{type:"textline",b:"os = min ( oq , or ) ;".split(" ")}]}},{type:"node",name:"MATH_MAXIMUM",group:{type:"group",a:[{type:"node_in",
name:"ot",qualifier:["float"]},{type:"node_in",name:"ou",qualifier:["float"]},{type:"node_out",name:"ov",qualifier:["float"]},{type:"textline",b:"ov = max ( ot , ou ) ;".split(" ")}]}},{type:"node",name:"MATH_ROUND",group:{type:"group",a:[{type:"node_in",name:"ow",qualifier:["float"]},{type:"node_in",name:"ox",qualifier:["float"]},{type:"node_out",name:"oy",qualifier:["float"]},{type:"textline",b:"oy = floor ( ow + 0.5 ) ; ox ;".split(" ")}]}},{type:"node",name:"MATH_LESS_THAN",group:{type:"group",
a:[{type:"node_in",name:"oz",qualifier:["float"]},{type:"node_in",name:"oA",qualifier:["float"]},{type:"node_out",name:"oB",qualifier:["float"]},{type:"textline",b:"oB = ( oz < oA ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_GREATER_THAN",group:{type:"group",a:[{type:"node_in",name:"oC",qualifier:["float"]},{type:"node_in",name:"oD",qualifier:["float"]},{type:"node_out",name:"oE",qualifier:["float"]},{type:"textline",b:"oE = ( oC > oD ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},
{type:"node",name:"MATH_MODULO",group:{type:"group",a:[{type:"node_in",name:"oF",qualifier:["float"]},{type:"node_in",name:"oG",qualifier:["float"]},{type:"node_out",name:"oH",qualifier:["float"]},{type:"textline",b:"oH = abs ( oG ) > 0.000001 ? mod ( oF , oG ) : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_ABSOLUTE",group:{type:"group",a:[{type:"node_in",name:"oI",qualifier:["float"]},{type:"node_in",name:"oJ",qualifier:["float"]},{type:"node_out",name:"oK",qualifier:["float"]},{type:"textline",
b:"oK = abs ( oI ) ; oJ ;".split(" ")}]}},{type:"node",name:"MIX_RGB_MIX",group:{type:"group",a:[{type:"node_in",name:"oL",qualifier:["float"]},{type:"node_in",name:"oM",qualifier:["vec3"]},{type:"node_in",name:"oN",qualifier:["vec3"]},{type:"node_out",name:"oO",qualifier:["vec3"]},{type:"textline",b:"{ float oP = clamp ( oL , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oO = mix ( oM , oN , oP ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_ADD",group:{type:"group",a:[{type:"node_in",name:"oQ",qualifier:["float"]},
{type:"node_in",name:"oR",qualifier:["vec3"]},{type:"node_in",name:"oS",qualifier:["vec3"]},{type:"node_out",name:"oT",qualifier:["vec3"]},{type:"textline",b:"{ float oU = clamp ( oQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oT = mix ( oR , oR + oS , oU ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"oV",qualifier:["float"]},{type:"node_in",name:"oW",qualifier:["vec3"]},{type:"node_in",name:"oX",qualifier:["vec3"]},{type:"node_out",name:"oY",
qualifier:["vec3"]},{type:"textline",b:"{ float oZ = clamp ( oV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oY = mix ( oW , oW * oX , oZ ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"o_",qualifier:["float"]},{type:"node_in",name:"pa",qualifier:["vec3"]},{type:"node_in",name:"pb",qualifier:["vec3"]},{type:"node_out",name:"pc",qualifier:["vec3"]},{type:"textline",b:"{ float pd = clamp ( o_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pc = mix ( pa , pa - pb , pd ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_SCREEN",group:{type:"group",a:[{type:"node_in",name:"pe",qualifier:["float"]},{type:"node_in",name:"pf",qualifier:["vec3"]},{type:"node_in",name:"pg",qualifier:["vec3"]},{type:"node_out",name:"ph",qualifier:["vec3"]},{type:"textline",b:"{ float pi = clamp ( pe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pj = UNITY_VALUE_NODES - pi ; ph = kW - ( vec3 ( pj ) + pi * ( kW - pg ) ) * ( kW - pf ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DIVIDE",group:{type:"group",
a:[{type:"node_in",name:"pk",qualifier:["float"]},{type:"node_in",name:"pl",qualifier:["vec3"]},{type:"node_in",name:"pm",qualifier:["vec3"]},{type:"node_out",name:"pn",qualifier:["vec3"]},{type:"textline",b:"{ float po = clamp ( pk , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pp = UNITY_VALUE_NODES - po ; pm += step ( pm , kX ) ; pn = pp * pl + po * pl / pm ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DIFFERENCE",group:{type:"group",a:[{type:"node_in",name:"pq",qualifier:["float"]},{type:"node_in",
name:"pr",qualifier:["vec3"]},{type:"node_in",name:"ps",qualifier:["vec3"]},{type:"node_out",name:"pt",qualifier:["vec3"]},{type:"textline",b:"{ float pu = clamp ( pq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pt = mix ( pr , abs ( pr - ps ) , pu ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DARKEN",group:{type:"group",a:[{type:"node_in",name:"pv",qualifier:["float"]},{type:"node_in",name:"pw",qualifier:["vec3"]},{type:"node_in",name:"px",qualifier:["vec3"]},{type:"node_out",name:"py",qualifier:["vec3"]},
{type:"textline",b:"{ float pz = clamp ( pv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; py = min ( pw . rgb , px . rgb * pz ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LIGHTEN",group:{type:"group",a:[{type:"node_in",name:"pA",qualifier:["float"]},{type:"node_in",name:"pB",qualifier:["vec3"]},{type:"node_in",name:"pC",qualifier:["vec3"]},{type:"node_out",name:"pD",qualifier:["vec3"]},{type:"textline",b:"{ float pE = clamp ( pA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pD = max ( pB . rgb , pC . rgb * pE ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_OVERLAY",group:{type:"group",a:[{type:"node_in",name:"pF",qualifier:["float"]},{type:"node_in",name:"pG",qualifier:["vec3"]},{type:"node_in",name:"pH",qualifier:["vec3"]},{type:"node_out",name:"pI",qualifier:["vec3"]},{type:"textline",b:"{ float pJ = clamp ( pF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pK = UNITY_VALUE_NODES - pJ ; vec3 pL = vec3 ( pK ) ; pI = mix ( pG * ( pL + 2.0 * pJ * pH ) , kW - ( pL + 2.0 * pJ * ( kW - pH ) ) * ( kW - pG ) , step ( 0.5 , pG ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_DODGE",group:{type:"group",a:[{type:"node_in",name:"pM",qualifier:["float"]},{type:"node_in",name:"pN",qualifier:["vec3"]},{type:"node_in",name:"pO",qualifier:["vec3"]},{type:"node_out",name:"pP",qualifier:["vec3"]},{type:"textline",b:"{ float pQ = clamp ( pM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pR = kW - pQ * pO ; vec3 pS = pN / ( pR + step ( pR , kX ) ) ; pP = ( kW - step ( pN , kX ) ) * mix ( mix ( kW , pS , step ( pS , kW ) ) , kW , step ( pR , kX ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_BURN",group:{type:"group",a:[{type:"node_in",name:"pT",qualifier:["float"]},{type:"node_in",name:"pU",qualifier:["vec3"]},{type:"node_in",name:"pV",qualifier:["vec3"]},{type:"node_out",name:"pW",qualifier:["vec3"]},{type:"textline",b:"{ float pX = clamp ( pT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pY = kW - pX * ( kW - pV ) ; vec3 pZ = kW - ( kW - pU ) / ( pY + step ( pY , kX ) ) ; pW = mix ( mix ( kX , mix ( kW , pZ , step ( pZ , kW ) ) , step ( ZERO_VALUE_NODES , pZ ) ) , kX , step ( pY , kX ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_HUE",group:{type:"group",a:[{type:"node_in",name:"p_",qualifier:["float"]},{type:"node_in",name:"qa",qualifier:["vec3"]},{type:"node_in",name:"qb",qualifier:["vec3"]},{type:"node_out",name:"qc",qualifier:["vec3"]},{type:"textline",b:"{ float qd = clamp ( p_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qe , qf , qg ; qc = qa ; qf = lk ( qb ) ; if ( qf . y != ZERO_VALUE_NODES ) { qe = lk ( qc ) ; qe . x = qf . x ; qg = lo ( qe ) ; qc = mix ( qc , qg , qd ) ; } }".split(" ")}]}},
{type:"node",name:"MIX_RGB_SATURATION",group:{type:"group",a:[{type:"node_in",name:"qh",qualifier:["float"]},{type:"node_in",name:"qi",qualifier:["vec3"]},{type:"node_in",name:"qj",qualifier:["vec3"]},{type:"node_out",name:"qk",qualifier:["vec3"]},{type:"textline",b:"{ float ql = clamp ( qh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qm = UNITY_VALUE_NODES - ql ; qk = qi ; vec3 qn , qo ; qn = lk ( qk ) ; if ( qn . y != ZERO_VALUE_NODES ) { qo = lk ( qj ) ; qn . y = qm * qn . y + ql * qo . y ; qk = lo ( qn ) ; } }".split(" ")}]}},
{type:"node",name:"MIX_RGB_VALUE",group:{type:"group",a:[{type:"node_in",name:"qp",qualifier:["float"]},{type:"node_in",name:"qq",qualifier:["vec3"]},{type:"node_in",name:"qr",qualifier:["vec3"]},{type:"node_out",name:"qs",qualifier:["vec3"]},{type:"textline",b:"{ float qt = clamp ( qp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qu = UNITY_VALUE_NODES - qt ; vec3 qv , qw ; qv = lk ( qq ) ; qw = lk ( qr ) ; qv . z = qu * qv . z + qt * qw . z ; qs = lo ( qv ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_COLOR",
group:{type:"group",a:[{type:"node_in",name:"qx",qualifier:["float"]},{type:"node_in",name:"qy",qualifier:["vec3"]},{type:"node_in",name:"qz",qualifier:["vec3"]},{type:"node_out",name:"qA",qualifier:["vec3"]},{type:"textline",b:"{ float qB = clamp ( qx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qC , qD , qE ; qA = qy ; qD = lk ( qz ) ; if ( qD . y != ZERO_VALUE_NODES ) { qC = lk ( qA ) ; qC . x = qD . x ; qC . y = qD . y ; qE = lo ( qC ) ; qA = mix ( qA , qE , qB ) ; } }".split(" ")}]}},{type:"node",
name:"MIX_RGB_SOFT_LIGHT",group:{type:"group",a:[{type:"node_in",name:"qF",qualifier:["float"]},{type:"node_in",name:"qG",qualifier:["vec3"]},{type:"node_in",name:"qH",qualifier:["vec3"]},{type:"node_out",name:"qI",qualifier:["vec3"]},{type:"textline",b:"{ float qJ = clamp ( qF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qK = UNITY_VALUE_NODES - qJ ; vec3 qL = qH + qG - qH * qG ; qI = qG * ( vec3 ( qK ) + vec3 ( qJ ) * ( ( kW - qG ) * qH + qL ) ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",
group:{type:"group",a:[{type:"node_in",name:"qM",qualifier:["float"]},{type:"node_in",name:"qN",qualifier:["vec3"]},{type:"node_in",name:"qO",qualifier:["vec3"]},{type:"node_out",name:"qP",qualifier:["vec3"]},{type:"textline",b:"{ float qQ = clamp ( qM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qP = clamp ( qN + qQ * ( 2.0 * qO - kW ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; }".split(" ")}]}},{type:"node",name:"OUTPUT",group:{type:"group",a:[{type:"node_in",name:"qR",qualifier:["vec3"]},{type:"node_in",
name:"qS",qualifier:["float"]},{type:"textline",b:"mA = qR ; mF = qS ;".split(" ")}]}},{type:"node",name:"MATERIAL",group:{type:"group",a:[{type:"node_param",name:"md",qualifier:["const","vec3"]},{type:"node_param",name:"me",qualifier:["const","vec4"]},{type:"node_param",name:"mf",qualifier:["const","float"]},{type:"node_in",name:"qT",qualifier:["vec3"]},{type:"node_in",name:"qU",qualifier:["float"]},{type:"node_in",name:"qV",qualifier:["vec3"]},{type:"node_in",name:"qW",qualifier:["vec3"]},{type:"node_out",
name:"qX",qualifier:["vec3"]},{type:"node_out",name:"qY",qualifier:["float"]},{type:"node_out",name:"qZ",qualifier:["vec3"]},{type:"textline",b:"{ qT = clamp ( qT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qU = clamp ( qU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qV = clamp ( qV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 q_ = qT ; float ra = md [ 0 ] ; vec2 rb = vec2 ( md [ 1 ] , md [ 2 ] ) ; vec3 rc = mx * qT ; vec3 rd = me [ 1 ] * qV ; float re = me [ 0 ] ; vec2 rf = vec2 ( me [ 2 ] , me [ 3 ] ) ; float rg = ff ( q_ ) ; vec3 rh ; if ( mf == UNITY_VALUE_NODES ) rh = normalize ( qW ) ; else rh = ms ; float ri = 0.5 * rh . y + 0.5 ; vec3 rj = mz * u_environment_energy * ld ( ri , rh ) ; hh rk = lQ ( rc , rj , q_ , rd , mv , rh , mu , rf , rb , rg , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) ) ; qX = ( ra == UNITY_VALUE_NODES ) ? rk . a . rgb : kX ; qY = qU ; qZ = rh ; if ( re == UNITY_VALUE_NODES ) { qY += rk . a . a * rd . r * my ; qY = clamp ( qY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qX += rk . b ; mB = rk . b ; } else { mB = kX ; } mC = rh ; mE = rg ; }".split(" ")}]}},
{type:"node",name:"MATERIAL_EXT",group:{type:"group",a:[{type:"node_param",name:"mg",qualifier:["const","vec3"]},{type:"node_param",name:"mh",qualifier:["const","vec4"]},{type:"node_param",name:"mi",qualifier:["const","float"]},{type:"node_in",name:"rl",qualifier:["vec3"]},{type:"node_in",name:"rm",qualifier:["float"]},{type:"node_in",name:"rn",qualifier:["vec3"]},{type:"node_in",name:"ro",qualifier:["vec3"]},{type:"node_in",name:"rp",qualifier:["float"]},{type:"node_in",name:"rq",qualifier:["float"]},
{type:"node_in",name:"rr",qualifier:["vec4"]},{type:"node_in",name:"rs",qualifier:["float"]},{type:"node_in",name:"rt",qualifier:["float"]},{type:"node_out",name:"ru",qualifier:["vec3"]},{type:"node_out",name:"rv",qualifier:["float"]},{type:"node_out",name:"rw",qualifier:["vec3"]},{type:"node_out",name:"rx",qualifier:["vec3"]},{type:"node_out",name:"ry",qualifier:["vec3"]},{type:"textline",b:"{ rl = clamp ( rl , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rm = clamp ( rm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rn = clamp ( rn , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 rz = rl ; float rA = mg [ 0 ] ; vec2 rB = vec2 ( mg [ 1 ] , mg [ 2 ] ) ; vec3 rC = rp * rl ; vec3 rD = mh [ 1 ] * rn ; float rE = mh [ 0 ] ; vec2 rF = vec2 ( mh [ 2 ] , mh [ 3 ] ) ; float rG = ff ( rz ) ; vec3 rH ; if ( mi == UNITY_VALUE_NODES ) rH = normalize ( ro ) ; else rH = ms ; float rI = 0.5 * rH . y + 0.5 ; vec3 rJ = mz * u_environment_energy * ld ( rI , rH ) ; hh rK = lQ ( rC , rJ , rz , rD , mv , rH , mu , rF , rB , rG , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , rq , rr ) ; ru = ( rA == UNITY_VALUE_NODES ) ? rK . a . rgb : kX ; rv = rm ; rw = rH ; rx = rK . a . rgb ; ry = rK . b ; lx ( ru , mu , rw , rs ) ; if ( rE == UNITY_VALUE_NODES ) { ru += rK . b ; rv += rK . a . a * rD . r * rt ; rv = clamp ( rv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mB = rK . b ; } else { mB = kX ; } mC = rH ; mE = rG ; }".split(" ")}]}},
{type:"node",name:"RGB",group:{type:"group",a:[{type:"node_param",name:"mj",qualifier:["vec3"]},{type:"node_out",name:"rL",qualifier:["vec3"]},{type:"textline",b:["rL","=","mj",";"]}]}},{type:"node",name:"RGBTOBW",group:{type:"group",a:[{type:"node_in",name:"rM",qualifier:["vec3"]},{type:"node_out",name:"rN",qualifier:["float"]},{type:"textline",b:"rN = rM . r * 0.35 + rM . g * 0.45 + rM . b * 0.2 ;".split(" ")}]}},{type:"node",name:"SEPRGB",group:{type:"group",a:[{type:"node_in",name:"rO",qualifier:["vec3"]},
{type:"node_out",name:"rP",qualifier:["float"]},{type:"node_out",name:"rQ",qualifier:["float"]},{type:"node_out",name:"rR",qualifier:["float"]},{type:"textline",b:"rP = rO . r ; rQ = rO . g ; rR = rO . b ;".split(" ")}]}},{type:"node",name:"SEPHSV",group:{type:"group",a:[{type:"node_in",name:"rS",qualifier:["vec3"]},{type:"node_out",name:"rT",qualifier:["float"]},{type:"node_out",name:"rU",qualifier:["float"]},{type:"node_out",name:"rV",qualifier:["float"]},{type:"textline",b:"{ vec3 rW = lk ( rS ) ; rT = rW . r ; rU = rW . g ; rV = rW . b ; }".split(" ")}]}},
{type:"node",name:"SQUEEZE",group:{type:"group",a:[{type:"node_in",name:"rX",qualifier:["float"]},{type:"node_in",name:"rY",qualifier:["float"]},{type:"node_in",name:"rZ",qualifier:["float"]},{type:"node_out",name:"r_",qualifier:["float"]},{type:"textline",b:"r_ = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( rX - rZ ) * rY ) ) ) ;".split(" ")}]}},{type:"node",name:"SRGB_TO_LINEAR",group:{type:"group",a:[{type:"node_in",name:"sa",qualifier:["vec3"]},{type:"node_out",name:"sb",
qualifier:["vec3"]},{type:"textline",b:"sb = max ( kX , sa ) ; sb = pow ( sb , vec3 ( 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"LINEAR_TO_SRGB",group:{type:"group",a:[{type:"node_in",name:"sc",qualifier:["vec3"]},{type:"node_out",name:"sd",qualifier:["vec3"]},{type:"textline",b:"sd = max ( kX , sc ) ; sd = pow ( sd , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform",
"sampler2D"]},{type:"node_in",name:"se",qualifier:["vec3"]},{type:"node_out",name:"sf",qualifier:["vec3"]},{type:"node_out",name:"sg",qualifier:["float"]},{type:"textline",b:"{ vec4 sh = texture2D ( node_TEXTURE_COLOR_var_texture , ls ( se ) ) ; sf = sh . xyz ; gl ( sf ) ; sg = sh . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"si",qualifier:["vec3"]},
{type:"node_out",name:"sj",qualifier:["vec3"]},{type:"node_out",name:"sk",qualifier:["float"]},{type:"textline",b:"{ vec4 sl = texture2D ( node_TEXTURE_NORMAL_var_texture , ls ( si ) ) ; mD = sl . xyz - 0.5 ; sj = normalize ( mr * mD ) ; sk = sl . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_ENVIRONMENT",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]},{type:"node_in",name:"sm",qualifier:["vec3"]},{type:"node_out",name:"sn",
qualifier:["vec3"]},{type:"node_out",name:"so",qualifier:["float"]},{type:"textline",b:"{ vec4 sp = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , sm ) ; sn = sp . xyz ; gl ( sn ) ; so = sp . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR2",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR2_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sq",qualifier:["vec3"]},{type:"node_in",name:"sr",qualifier:["vec3"]},{type:"node_out",name:"ss",qualifier:["vec3"]},
{type:"node_out",name:"st",qualifier:["float"]},{type:"node_out",name:"su",qualifier:["vec3"]},{type:"node_out",name:"sv",qualifier:["float"]},{type:"textline",b:"{ vec4 sw = texture2D ( node_TEXTURE_COLOR2_var_texture , ls ( sq ) ) ; ss = sw . xyz ; gl ( ss ) ; st = sw . w ; sw = texture2D ( node_TEXTURE_COLOR2_var_texture , ls ( sr ) ) ; su = sw . xyz ; gl ( su ) ; sv = sw . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL2",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL2_var_texture",
qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sx",qualifier:["vec3"]},{type:"node_in",name:"sy",qualifier:["vec3"]},{type:"node_out",name:"sz",qualifier:["vec3"]},{type:"node_out",name:"sA",qualifier:["float"]},{type:"node_out",name:"sB",qualifier:["vec3"]},{type:"node_out",name:"sC",qualifier:["float"]},{type:"textline",b:"{ vec4 sD = texture2D ( node_TEXTURE_NORMAL2_var_texture , ls ( sx ) ) ; mD = sD . xyz - 0.5 ; sz = normalize ( mr * mD ) ; sA = sD . w ; sD = texture2D ( node_TEXTURE_NORMAL2_var_texture , ls ( sy ) ) ; mD = sD . xyz - 0.5 ; sB = normalize ( mr * mD ) ; sC = sD . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_COLOR3",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sE",qualifier:["vec3"]},{type:"node_in",name:"sF",qualifier:["vec3"]},{type:"node_in",name:"sG",qualifier:["vec3"]},{type:"node_out",name:"sH",qualifier:["vec3"]},{type:"node_out",name:"sI",qualifier:["float"]},{type:"node_out",name:"sJ",qualifier:["vec3"]},{type:"node_out",name:"sK",qualifier:["float"]},{type:"node_out",name:"sL",
qualifier:["vec3"]},{type:"node_out",name:"sM",qualifier:["float"]},{type:"textline",b:"{ vec4 sN = texture2D ( node_TEXTURE_COLOR3_var_texture , ls ( sE ) ) ; sH = sN . xyz ; gl ( sH ) ; sI = sN . w ; sN = texture2D ( node_TEXTURE_COLOR3_var_texture , ls ( sF ) ) ; sJ = sN . xyz ; gl ( sJ ) ; sK = sN . w ; sN = texture2D ( node_TEXTURE_COLOR3_var_texture , ls ( sG ) ) ; sL = sN . xyz ; gl ( sL ) ; sM = sN . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR4",group:{type:"group",a:[{type:"node_param",
name:"node_TEXTURE_COLOR4_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sO",qualifier:["vec3"]},{type:"node_in",name:"sP",qualifier:["vec3"]},{type:"node_in",name:"sQ",qualifier:["vec3"]},{type:"node_in",name:"sR",qualifier:["vec3"]},{type:"node_out",name:"sS",qualifier:["vec3"]},{type:"node_out",name:"sT",qualifier:["float"]},{type:"node_out",name:"sU",qualifier:["vec3"]},{type:"node_out",name:"sV",qualifier:["float"]},{type:"node_out",name:"sW",qualifier:["vec3"]},{type:"node_out",
name:"sX",qualifier:["float"]},{type:"node_out",name:"sY",qualifier:["vec3"]},{type:"node_out",name:"sZ",qualifier:["float"]},{type:"textline",b:"{ vec4 s_ = texture2D ( node_TEXTURE_COLOR4_var_texture , ls ( sO ) ) ; sS = s_ . xyz ; gl ( sS ) ; sT = s_ . w ; s_ = texture2D ( node_TEXTURE_COLOR4_var_texture , ls ( sP ) ) ; sU = s_ . xyz ; gl ( sU ) ; sV = s_ . w ; s_ = texture2D ( node_TEXTURE_COLOR4_var_texture , ls ( sQ ) ) ; sW = s_ . xyz ; gl ( sW ) ; sX = s_ . w ; s_ = texture2D ( node_TEXTURE_COLOR4_var_texture , ls ( sR ) ) ; sY = s_ . xyz ; gl ( sY ) ; sZ = s_ . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_NORMAL3",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"ta",qualifier:["vec3"]},{type:"node_in",name:"tb",qualifier:["vec3"]},{type:"node_in",name:"tc",qualifier:["vec3"]},{type:"node_out",name:"td",qualifier:["vec3"]},{type:"node_out",name:"te",qualifier:["float"]},{type:"node_out",name:"tf",qualifier:["vec3"]},{type:"node_out",name:"tg",qualifier:["float"]},{type:"node_out",name:"th",
qualifier:["vec3"]},{type:"node_out",name:"ti",qualifier:["float"]},{type:"textline",b:"{ vec4 tj = texture2D ( node_TEXTURE_NORMAL3_var_texture , ls ( ta ) ) ; mD = tj . xyz - 0.5 ; td = normalize ( mr * mD ) ; te = tj . w ; tj = texture2D ( node_TEXTURE_NORMAL3_var_texture , ls ( tb ) ) ; mD = tj . xyz - 0.5 ; tf = normalize ( mr * mD ) ; tg = tj . w ; tj = texture2D ( node_TEXTURE_NORMAL3_var_texture , ls ( tc ) ) ; mD = tj . xyz - 0.5 ; th = normalize ( mr * mD ) ; ti = tj . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_NORMAL4",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL4_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"tk",qualifier:["vec3"]},{type:"node_in",name:"tl",qualifier:["vec3"]},{type:"node_in",name:"tm",qualifier:["vec3"]},{type:"node_in",name:"tn",qualifier:["vec3"]},{type:"node_out",name:"to",qualifier:["vec3"]},{type:"node_out",name:"tp",qualifier:["float"]},{type:"node_out",name:"tq",qualifier:["vec3"]},{type:"node_out",name:"tr",
qualifier:["float"]},{type:"node_out",name:"ts",qualifier:["vec3"]},{type:"node_out",name:"tt",qualifier:["float"]},{type:"node_out",name:"tu",qualifier:["vec3"]},{type:"node_out",name:"tv",qualifier:["float"]},{type:"textline",b:"{ vec4 tw = texture2D ( node_TEXTURE_NORMAL4_var_texture , ls ( tk ) ) ; mD = tw . xyz - 0.5 ; to = normalize ( mr * mD ) ; tp = tw . w ; tw = texture2D ( node_TEXTURE_NORMAL4_var_texture , ls ( tl ) ) ; mD = tw . xyz - 0.5 ; tq = normalize ( mr * mD ) ; tr = tw . w ; tw = texture2D ( node_TEXTURE_NORMAL4_var_texture , ls ( tm ) ) ; mD = tw . xyz - 0.5 ; ts = normalize ( mr * mD ) ; tt = tw . w ; tw = texture2D ( node_TEXTURE_NORMAL4_var_texture , ls ( tn ) ) ; mD = tw . xyz - 0.5 ; tu = normalize ( mr * mD ) ; tv = tw . w ; }".split(" ")}]}},
{type:"node",name:"VALUE",group:{type:"group",a:[{type:"node_param",name:"mk",qualifier:["const","float"]},{type:"node_out",name:"tx",qualifier:["float"]},{type:"textline",b:["tx","=","mk",";"]}]}},{type:"node",name:"ANIM_VALUE",group:{type:"group",a:[{type:"node_param",name:"ml",qualifier:["const","int"]},{type:"node_out",name:"ty",qualifier:["float"]},{type:"textline",b:"ty = u_anim_values [ ml ] ;".split(" ")}]}},{type:"node",name:"VECT_MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"tz",
qualifier:["vec3"]},{type:"node_in",name:"tA",qualifier:["vec3"]},{type:"node_out",name:"tB",qualifier:["vec3"]},{type:"node_out",name:"tC",qualifier:["float"]},{type:"textline",b:"tB = tz + tA ; tC = ( abs ( tB [ 0 ] ) + abs ( tB [ 1 ] ) + abs ( tB [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"tD",qualifier:["vec3"]},{type:"node_in",name:"tE",qualifier:["vec3"]},{type:"node_out",name:"tF",qualifier:["vec3"]},{type:"node_out",
name:"tG",qualifier:["float"]},{type:"textline",b:"tF = tD - tE ; tG = ( abs ( tF [ 0 ] ) + abs ( tF [ 1 ] ) + abs ( tF [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_AVERAGE",group:{type:"group",a:[{type:"node_in",name:"tH",qualifier:["vec3"]},{type:"node_in",name:"tI",qualifier:["vec3"]},{type:"node_out",name:"tJ",qualifier:["vec3"]},{type:"node_out",name:"tK",qualifier:["float"]},{type:"textline",b:"tJ = tH + tI ; tK = length ( tJ ) ; tJ = normalize ( tJ ) ;".split(" ")}]}},{type:"node",
name:"VECT_MATH_DOT_PRODUCT",group:{type:"group",a:[{type:"node_in",name:"tL",qualifier:["vec3"]},{type:"node_in",name:"tM",qualifier:["vec3"]},{type:"node_out",name:"tN",qualifier:["vec3"]},{type:"node_out",name:"tO",qualifier:["float"]},{type:"textline",b:"tN = kX ; tO = dot ( tL , tM ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",group:{type:"group",a:[{type:"node_in",name:"tP",qualifier:["vec3"]},{type:"node_in",name:"tQ",qualifier:["vec3"]},{type:"node_out",name:"tR",qualifier:["vec3"]},
{type:"node_out",name:"tS",qualifier:["float"]},{type:"textline",b:"tR = cross ( tP , tQ ) ; tS = length ( tR ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_NORMALIZE",group:{type:"group",a:[{type:"node_in",name:"tT",qualifier:["vec3"]},{type:"node_in",name:"tU",qualifier:["vec3"]},{type:"node_out",name:"tV",qualifier:["vec3"]},{type:"node_out",name:"tW",qualifier:["float"]},{type:"textline",b:"tV = normalize ( tT ) ; tW = length ( tT ) ; tU ;".split(" ")}]}},{type:"node",name:"REFLECT",group:{type:"group",
a:[{type:"node_in",name:"tX",qualifier:["vec3"]},{type:"node_in",name:"tY",qualifier:["vec3"]},{type:"node_out",name:"tZ",qualifier:["vec3"]},{type:"textline",b:"tZ = reflect ( - tX , tY ) ;".split(" ")}]}},{type:"node",name:"PARALLAX",group:{type:"group",a:[{type:"node_param",name:"node_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"t_",qualifier:["vec3"]},{type:"node_in",name:"ua",qualifier:["float"]},{type:"node_in",name:"ub",qualifier:["const","float"]},{type:"node_in",
name:"uc",qualifier:["const","float"]},{type:"node_out",name:"ud",qualifier:["vec3"]},{type:"textline",b:"{ float ue = length ( mw ) ; if ( ue < uc ) { vec2 uf = ls ( t_ ) ; float ug = clamp ( 0.5 * ( uc - ue ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float uh = ua * ug ; vec3 ui = normalize ( mu * mr ) ; float uj = UNITY_VALUE_NODES / ub ; vec2 uk = ui . xy * uh / ( ub * ui . z ) ; float ul = UNITY_VALUE_NODES ; float um = texture2D ( node_PARALLAX_var_texture , uf ) . a ; for ( float un = 1.0 ; un <= ub ; un ++ ) { if ( um < ul ) { ul -= uj ; uf -= uk ; um = texture2D ( node_PARALLAX_var_texture , uf ) . a ; } } vec2 uo = uf + uk ; float up = texture2D ( node_PARALLAX_var_texture , uo ) . a - ( ul + uj ) ; float uq = um - ul ; float ur = uq / ( uq - up ) ; uf = ur * uo + ( UNITY_VALUE_NODES - ur ) * uf ; ud = lq ( uf ) ; } else ud = t_ ; }".split(" ")}]}},
{type:"node",name:"CLAMP",group:{type:"group",a:[{type:"node_in",name:"us",qualifier:["vec3"]},{type:"node_out",name:"ut",qualifier:["vec3"]},{type:"textline",b:"ut = clamp ( us , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}},{type:"node",name:"REFRACTION",group:{type:"group",a:[{type:"node_in",name:"uu",qualifier:["vec3"]},{type:"node_in",name:"uv",qualifier:["float"]},{type:"node_out",name:"uw",qualifier:["vec3"]},{type:"textline",b:"uw = la ( uu , uv ) ;".split(" ")}]}},{type:"node",
name:"TRANSLUCENCY",group:{type:"group",a:[{type:"node_in",name:"ux",qualifier:["float"]},{type:"node_in",name:"uy",qualifier:["float"]},{type:"node_in",name:"uz",qualifier:["float"]},{type:"node_in",name:"uA",qualifier:["float"]},{type:"node_in",name:"uB",qualifier:["float"]},{type:"node_out",name:"uC",qualifier:["float"]},{type:"node_out",name:"uD",qualifier:["vec4"]},{type:"textline",b:"uC = ux ; uD = vec4 ( uy , uz , uA , uB ) ;".split(" ")}]}},{type:"node",name:"TIME",group:{type:"group",a:[{type:"node_out",
name:"uE",qualifier:["float"]},{type:"textline",b:["uE","=","u_time",";"]}]}},{type:"node",name:"SMOOTHSTEP",group:{type:"group",a:[{type:"node_in",name:"uF",qualifier:["float"]},{type:"node_in",name:"uG",qualifier:["float"]},{type:"node_in",name:"uH",qualifier:["float"]},{type:"node_out",name:"uI",qualifier:["float"]},{type:"textline",b:"uI = smoothstep ( uG , uH , uF ) ;".split(" ")}]}},{type:"nodes_global"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),
group:{type:"group",a:[{type:"textline",b:["vec3","mm","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float mn = kg . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mo","=","kh",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",
a:[{type:"textline",b:"if ( gl_FrontFacing ) mo = mo ; else mo = - mo ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mp = cross ( mo , ki . xyz ) * ki . w ; mat3 mq = mat3 ( ki . xyz , mp , mo ) ; mat3 mr = mq ;".split(" ")}]}}]},{type:"textline",b:"vec3 ms = normalize ( mo ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 mt = u_camera_eye_frag - kg ; vec3 mu = normalize ( mt ) ; vec3 mv = kg ; vec4 mw = cD ; float mx = u_emit ; float my = u_specular_alpha ; float mz = u_ambient ; vec3 mA ; vec3 mB ; vec3 mC ; vec3 mD ; float mE ; float mF ;".split(" ")},
{type:"nodes_main"},{type:"textline",b:"vec3 uJ = mA ; float uK = mF ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"uJ = max ( uJ - sqrt ( 0.01 * - min ( mn , ZERO_VALUE_NODES ) ) , 0.5 * uJ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"ke ( uJ , mn , u_time , mE , mo , u_sun_direction , mm , u_sun_quaternion , kg , length ( cD ) ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 uL = gF ( u_cube_fog , mu ) ; vec4 uM = vec4 ( uL , u_fog_color_density . a ) ; gl ( uM . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 uM = u_fog_color_density ; uM . rgb *= mm ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"gY ( uJ , length ( cD ) , mu , u_cam_water_depth , u_underwater_fog_color_density , uM , mn , length ( mm ) + u_environment_energy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gy ( uJ , length ( cD ) , uM ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( uK < 0.5 ) discard ; uK = UNITY_VALUE_NODES ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 uN = texture2DProj ( u_shadow_mask , cC ) . rg ; float uO = uN . g ; uJ = vec3 ( uO ) ;".split(" ")}]}}]},{type:"textline",b:["gn","(","uJ",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gq ( uJ , uK ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( uJ , uK ) ; }".split(" ")}]};a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",
b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float",
"a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",
b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",
";"]}]}}]},{type:"textline",b:"varying vec3 kg ; varying vec4 cD ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kh",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ki",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cy",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","kk",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",
name:"lR",qualifier:["varying","vec2"]},{type:"textline",b:["lR","=","node_GEOMETRY_UV_var_a_uv",";"]}]}},{type:"node",name:"GEOMETRY_VC",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"lW",qualifier:["varying","vec3"]},{type:"textline",b:["lW","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",
qualifier:["attribute","float"]},{type:"node_param",name:"lX",qualifier:["varying","float"]},{type:"textline",b:["lX","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"lY",qualifier:["varying","vec2"]},{type:"textline",b:["lY","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC3",group:{type:"group",
a:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"lZ",qualifier:["varying","vec3"]},{type:"textline",b:["lZ","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]}},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec3 l_ = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3",
"ma","=","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mb = vec3 ( a_tangent ) ; vec3 mc = a_tangent [ 3 ] * cross ( ma , mb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mb = vec3 ( 0.0 ) ; vec3 mc = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ma = vec3 ( 0.0 ) ; vec3 mb = vec3 ( 0.0 ) ; vec3 mc = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"l_ = mix ( l_ , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:"ma = mix ( ma , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 md = vec3 ( a_tangent ) ; vec3 me = a_tangent_next [ 3 ] * cross ( a_normal_next , md ) ; mb = mix ( mb , md , u_va_frame_factor ) ; mc = mix ( mc , me , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bl ( l_ , mb , mc , ma ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","mf","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mf = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 mg = ( u_model_matrix * vec4 ( mf , 1.0 ) ) . xyz ; mat4 mh = _ ( u_camera_eye , mg , u_view_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 mi = ( u_model_matrix * vec4 ( mf , 1.0 ) ) . xyz ; mh = mh * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , mi ) ;".split(" ")}]}}]},{type:"textline",b:"c mj = ag ( l_ - mf , mf , mb , mc , ma , mh ) ; mj . b = mg ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c mj = ag ( l_ , mf , mb , mc , ma , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cc ( mj . a , mj . b , ma ) ;".split(" ")}]}}]},{type:"textline",b:"kg = mj . a ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:"kh = mj . e ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"float mk = ( dot ( cross ( mj . e , mj . c ) , mj . d ) < 0.0 ) ? - 1.0 : 1.0 ; ki = vec4 ( mj . c , mk ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"cD = u_view_matrix * vec4 ( mj . a , 1.0 ) ; vec4 ml = u_proj_matrix * cD ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"ml . xy += u_subpixel_jitter * ml . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["ge","(","ml",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"ge ( mj . a ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:"float mm = ml . x ; float mn = ml . y ; float mo = ml . w ; cC . x = ( mm + mo ) / 2.0 ; cC . y = ( mn + mo ) / 2.0 ; cC . z = mo ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kk = - cD . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},
{type:"textline",b:["gl_Position","=","ml",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float l_ ; varying vec3 kj ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"textline",b:"void main ( ) { float ma = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; float mb = smoothstep ( u_p_alpha_start , u_p_alpha_end , ma ) ; float mc = u_diffuse_color . a * l_ * ( 1.0 - clamp ( mb , 0.0 , 1.0 ) ) ; vec3 md = kj * u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],
group:{type:"group",a:[{type:"textline",b:"gy ( md , length ( cD ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["gn","(","md",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gq ( md , mc ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( md , mc ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},
{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ; varying float l_ ; varying vec3 kj ; varying vec3 cD ;".split(" ")},{type:"include",file:"particles.glslv"},
{type:"textline",b:"void main ( ) { ma mS ; mS = mR ( ) ; vec4 mT = u_view_matrix * vec4 ( mS . b , 1.0 ) ; gl_Position = u_proj_matrix * mT ; l_ = mS . c ; kj = mS . d ; cD = mT . xyz ; float mU = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = mS . a * mU ; }".split(" ")}]};a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},
{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ; uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float l_ ; varying vec3 kj ; varying vec2 a ; varying vec3 kf ; varying vec3 kg ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 kW = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"vec4 kX = texture2D ( u_sampler , a ) ; gl ( kX . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"kW . rgb = mix ( kW . rgb , kX . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"kW . rgb *= mix ( vec3 ( 1.0 ) , kX . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"kW . a = kX . a ;".split(" ")}]}}]},{type:"textline",b:"kW . rgb *= kj ; vec3 kY = u_diffuse_intensity * kW . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"vec3 kZ = u_emit * kW . rgb ; vec3 k_ = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 la = u_environment_energy * textureCube ( u_sky_texture , k_ ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lb = 0.5 ; vec3 la = u_environment_energy * mix ( u_horizon_color , u_zenith_color , lb ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lc = u_ambient * la ; float ld = u_specular_params [ 0 ] ; vec2 le = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 lf = ld * u_specular_color ; vec3 lg = normalize ( kf ) ; hh lh = jE ( kZ , lc , kY , lf , kg , k_ , lg , le , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ; vec3 li = lh . a . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","li","=","kY",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gy ( li , length ( cD ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"float lj = kW . a * l_ ; gn ( li ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gq ( li , lj ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( li , lj ) ; }".split(" ")}]};
a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ; varying float l_ ; varying vec3 kj ; varying vec2 a ; varying vec3 kf ; varying vec3 kg ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cD",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float kY ( vec2 kW , vec2 kX ) { return ( atan ( kX . y , kX . x ) - atan ( kW . y , kW . x ) ) ; } void main ( ) { ma kZ ; kZ = mR ( ) ; float k_ ; mat4 la ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { k_ = kZ . e ; la = y ( kZ . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { k_ = kZ . e ; la = j ( ) ; la [ 3 ] = vec4 ( kZ . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { k_ = kZ . e ; la = n ( radians ( 90.0 ) ) ; la [ 3 ] = vec4 ( kZ . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { k_ = kY ( vec2 ( 0.0 , - 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + kZ . e ; la = l ( radians ( - 90.0 ) ) ; la [ 3 ] = vec4 ( kZ . b , 1.0 ) ; } vec4 lb = vec4 ( a_p_bb_vertex * 2.0 * kZ . a * u_p_size , 0.0 , 1.0 ) ; vec4 lc = la * p ( k_ ) * lb ; vec4 ld = u_view_matrix * lc ; vec4 le = u_proj_matrix * ld ; gl_Position = le ; l_ = kZ . c ; kj = kZ . d ; a = a_p_bb_vertex + 0.5 ; kg = lc . xyz ; kf = u_camera_eye - lc . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cD","=","ld",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 mS ; const float mT = 0.99 ; const float mU = 1.8 ; const int mV = 8 ; float ne ( vec3 mW , vec3 mX ) { float mY = dot ( mX , mX ) ; float mZ = 2.0 * dot ( mX , mW ) ; float m_ = dot ( mW , mW ) - 1.0 ; float na = mZ * mZ - 4.0 * mY * m_ ; float nb = sqrt ( na ) ; float nc = ( - mZ - nb ) / 2.0 ; float nd = m_ / nc ; return nd ; } float nl ( float nf , float ng ) { float nh = 3.0 * ( 1.0 - ng * ng ) ; float ni = 2.0 * ( 2.0 + ng * ng ) ; float nj = 1.0 + nf * nf ; float nk = pow ( 1.0 + ng * ng - 2.0 * ng * nf , 1.5 ) ; nk = max ( nk , 0.00001 ) ; return ( nh / ni ) * ( nj / nk ) ; } float nt ( vec3 nm , vec3 nn , float no ) { float np = dot ( nn , - nm ) ; if ( np < 0.0 ) { return 1.0 ; } vec3 nq = nm + np * nn ; if ( length ( nq ) < no ) { return 0.0 ; } else if ( length ( nq ) >= no ) { vec3 nr = normalize ( nq ) * no - nm ; float ns = acos ( dot ( normalize ( nr ) , nn ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( ns * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 nx ( float nu , vec3 nv , float nw ) { return nv - nv * pow ( u_sky_color , vec3 ( nw / nu ) ) ; } void main ( ) { vec3 ny = normalize ( mS ) ; vec3 nz = u_sun_direction ; float nA = dot ( ny , nz ) ; float nB = nl ( nA , - 0.01 ) * u_rayleigh_brightness * nz . y ; float nC = nl ( nA - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - nz . y ) ; float nD = smoothstep ( 0.0 , 100.0 , nl ( nA , 0.9995 ) ) * u_spot_brightness ; vec3 nE = vec3 ( 0.0 , mT , 0.0 ) ; float nF = ne ( nE , ny ) ; float nG = nF / float ( mV ) ; float nH = nt ( nE , ny , mT - 0.3 ) ; vec3 nI = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 nJ = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int nK = 0 ; nK < mV ; nK ++ ) { float nL = nG * float ( nK ) ; vec3 nM = nE + ny * nL ; float nN = nt ( nM , nz , mT - 0.2 ) ; float nO = ne ( nM , nz ) ; vec3 nP = nx ( nO , vec3 ( mU ) , u_scatter_strength ) * nN ; nI += nx ( sqrt ( nL ) , u_sky_color * nP , u_rayleigh_strength ) ; nJ += nx ( nL , nP , u_mie_strength ) ; } nI = nI * nH * pow ( nF , u_rayleigh_collection_power ) / float ( mV ) ; nJ = ( nJ * nH * pow ( nF , u_mie_collection_power ) ) / float ( mV ) ; vec3 nQ = vec3 ( nD * nJ + nC * nJ + nB * nI ) ; gn ( nQ ) ; gl_FragColor = vec4 ( nQ , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 mS ; void main ( ) { vec4 kW = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 kX = u_cube_view_matrix * kW ; mS = kX . xyz ; gl_Position = kW ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 kW = texture2D ( u_sampler , a ) ; gn ( kW . rgb ) ; gq ( kW . rgb , kW . a ) ; gl_FragColor = kW ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { a = a_texcoord ; vec3 kW = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 kX = u_proj_matrix * u_view_matrix * vec4 ( kW , 0.0 ) ; kX . x /= kX . w ; kX . y /= kX . w ; kX += 99999.0 * step ( kX . z , 0.0 ) ; kX += 100.0 * ( step ( 1.0 , abs ( kX . x ) ) + step ( 1.0 , abs ( kX . y ) ) ) ; kX . x = - a_lf_dist * kX . x ; kX . y = - a_lf_dist * kX . y ; float kY = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 kZ = vec2 ( a_lf_bb_vertex . x / kY , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float k_ = 1.9 ; kZ *= ( 1.0 + k_ * length ( kX . xy ) ) ; } gl_Position = vec4 ( kX . xy + kZ , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:["uniform","samplerCube","u_sky",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 mS ; void main ( ) { vec3 kW = textureCube ( u_sky , mS ) . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"gl ( kW . rgb ) ; float kX = u_camera_eye_frag . y - WATER_LEVEL ; kX = min ( - kX * 0.03 , 0.8 ) ; float kY = length ( u_sun_intensity ) + u_environment_energy ; vec3 kZ = normalize ( mS ) ; vec3 k_ = vec3 ( 0.0 ) ; vec4 la = u_underwater_fog_color_density ; la . rgb = mix ( la . rgb , k_ , min ( - kZ . y + kX , 1.0 ) ) * kY ; float lb = clamp ( sign ( kZ . y - 0.05 * kX ) , 0.0 , 1.0 ) ; kW = mix ( la . rgb , kW , lb ) ; gn ( kW . rgb ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( kW , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 mS ; void main ( ) { vec4 kW = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 kX = u_sky_vp_inverse * kW ; mS = kX . xyz ; gl_Position = kW ; }".split(" ")}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",
name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.001"]},{type:"textline",b:"uniform float u_time ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ; uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",
a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["!",
"DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap0_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap1_uv_velocity ; uniform vec2 u_normalmap1_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap2_uv_velocity ; uniform vec2 u_normalmap2_scale ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap3_uv_velocity ; uniform vec2 u_normalmap3_scale ;".split(" ")}]}}]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ; uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 kf ; varying vec3 kg ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kh",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",
">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 ki ; varying vec3 mT ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mU",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","kk",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","&&","SHORE_SMOOTHING"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 nj ( in vec2 mW , in vec3 mX , in vec3 mY , in vec3 mZ , out float m_ ) { vec3 na = reflect ( - mY , mX ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nb = mW . xy + mX . xz * REFL_BUMP / kk ; m_ = u_reflect_factor ; vec3 nc ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"nc = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nc = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"float nd = dot ( mY , mX ) ; m_ *= max ( 1.0 - 1.0 / nd , 1.0 ) ; } else { nc = texture2D ( u_reflectmap , nb ) . rgb ; gl ( nc ) ; }".split(" ")}]}},
{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"m_ = u_mirror_factor ; vec3 nc = mZ * textureCube ( u_mirrormap , na ) . rgb ; gl ( nc ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"m_ = 1.0 ; vec3 nc = mZ * vec3 ( 0.3 , 0.5 , 1.0 ) ; gl ( nc ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 ne = normalize ( na + mY ) ; float nf = 1.0 - dot ( mY , ne ) ; float ng = u_fresnel_params [ 3 ] ; float nh = u_fresnel_params [ 2 ] ; float ni = ng + ( 1.0 - ng ) * pow ( nf , nh ) ; m_ = min ( m_ * ni , 1.0 ) ; return nc ; } void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 nk = mat3 ( ki , mT , kh ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nl = normalize ( kh ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 nk = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 nl = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"DYNAMIC && ( REFLECTIVE || FOAM || ( WATER_EFFECTS && ! DISABLE_FOG ) ) || GENERATED_MESH".split(" "),group:{type:"group",a:[{type:"textline",b:"float nm = kg . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec2 nn = vec2 ( mU . x , - mU . z ) + 0.5 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec2 nn = vec2 ( kg . x , - kg . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","nn","=","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 no = vec3 ( 0.0 ) ; vec3 np = texture2D ( u_normalmap0 , nn * u_normalmap0_scale + u_normalmap0_uv_velocity * u_time ) . xyz - 0.5 ; no += np ;".split(" ")},{type:"condition",a:[{type:"if",
c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nq = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["nq","+=","np",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"np = texture2D ( u_normalmap0 , nn * u_normalmap1_scale + u_normalmap1_uv_velocity * u_time ) . xyz - 0.5 ; no += np ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["nq","+=","np",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"np = texture2D ( u_normalmap0 , nn * u_normalmap2_scale + u_normalmap2_uv_velocity * u_time ) . xyz - 0.5 ; no += np ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",
a:[{type:"textline",b:["nq","+=","np",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"np = texture2D ( u_normalmap0 , nn * u_normalmap3_scale + u_normalmap3_uv_velocity * u_time ) . xyz - 0.5 ; no += np ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["nq","+=","np",";"]}]}}]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nr = nk * nq ; if ( ! f ( nr , vec3 ( 0.0 ) ) ) nr = normalize ( nr ) ; vec3 ns = mix ( nl , nr , 0.2 ) ; ns = normalize ( ns ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"nl = mix ( nl , normalize ( nk * no ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"nl = mix ( nl , normalize ( nk * no ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"nl = normalize ( nl ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nt = normalize ( kf ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nu = cC . xy / cC . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float nv = kk * u_view_max_depth ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nw = u_diffuse_color . a ; vec4 nx = texture2DProj ( u_scene_depth , cC ) ; float ny = co ( nx ) ; float nz = max ( ny - kk , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nA = nu + nl . xz * u_refr_bump / kk ; float nB = kN ( ny , nA , nu ) ; float nC = max ( nB - kk , 0.0 ) ; float nD = u_view_max_depth / ABSORB * nC ; float nE ; if ( u_cam_water_depth < 0.0 ) nE = 0.0 ; else nE = min ( nw * nD , 1.0 ) ; float nF = u_view_max_depth / ABSORB * nz ; nw = min ( 15.0 * nw * u_view_max_depth * nz , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float nF = u_view_max_depth / ABSORB * nz ; if ( u_cam_water_depth > 0.0 ) nw = min ( nw * nF , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"nw *= min ( 5.0 * nv , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nw = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float nE = 1.0 - nw ; vec2 nA = nu + nl . xz * REFR_BUMP / kk ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 nG = texture2D ( u_refractmap , nA ) . rgb ; gl ( nG ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nH = pow ( min ( mV . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 nI = mix ( u_shallow_water_col , u_diffuse_color . rgb , nH ) ; nH = pow ( min ( mV . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; nI = mix ( u_shore_water_col , nI , nH ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nI = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nJ = max ( 1.0 - u_view_max_depth * nz , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nJ = 1.0 - nw ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:"float nK = max ( 3.0 * nm , 0.0 ) ; nK *= nK ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 nL = normalize ( vec3 ( mV . r , 0.0 , mV . g ) ) ; vec3 nM = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , nL , 0.8 ) ) ; float nN = max ( 2.5 * dot ( ns , nM ) - 0.7 , 0.0 ) ; nJ += nN * ( 1.0 - mV . b ) ; nK *= ( 1.0 - 0.95 * pow ( mV . b , 0.1 ) ) ;".split(" ")}]}}]},{type:"textline",b:"nJ += nK ; nJ = min ( u_foam_factor * nJ , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"vec4 nO = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + nn * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"float nP = u_specular_params [ 0 ] ; vec2 nQ = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 nR = nP * u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 nS = u_environment_energy * textureCube ( u_sky_texture , nl ) . rgb ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"vec3 nS = u_environment_energy * u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"vec3 nT = u_ambient * nS ; vec3 nU = nT + u_sun_intensity ; float nV ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 nW = nj ( nu , nl , nt , nU , nV ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nW = nj ( vec2 ( 0.0 ) , nl , nt , nU , nV ) ;".split(" ")}]}}]},{type:"textline",
b:"vec3 nX = u_diffuse_intensity * nI ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS","&&","DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float nY = max ( dot ( u_sun_direction , - kh ) + SSS_WIDTH , 0.0 ) * max ( dot ( - nt , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; nY = clamp ( SSS_STRENGTH * nY , 0.0 , 1.0 ) ; nX = mix ( nX , u_shallow_water_col , nY ) ; nX = mix ( nX , u_shore_water_col , nY ) ;".split(" ")}]}}]},{type:"textline",
b:"hh nZ = jE ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , nX , nR , kg , nl , nt , nQ , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ; nX = nZ . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"nX = mix ( nG , nX , nE ) ;".split(" ")}]}}]},{type:"textline",b:"nX = mix ( nX , nW , nV ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],
group:{type:"group",a:[{type:"textline",b:"float n_ = mix ( nO . g , nO . r , clamp ( 4.0 * ( nJ - 0.75 ) , 0.0 , 1.0 ) ) ; n_ = mix ( nO . b , n_ , clamp ( 2.0 * nJ - 1.0 , 0.0 , 1.0 ) ) ; n_ = mix ( 0.0 , n_ , nJ ) ; nX = mix ( nX , nU , n_ ) ;".split(" ")}]}}]},{type:"textline",b:"nX += nZ . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 oa = gF ( u_cube_fog , nt ) ; vec4 ob = vec4 ( oa , u_fog_color_density . a ) ; gl ( ob . rgb ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","ob","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { hg ( nX , nv , u_cam_water_depth , u_underwater_fog_color_density , length ( u_sun_intensity ) + u_environment_energy ) ; } else { gy ( nX , nv , ob ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gy ( nX , nv , ob ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["gn","(","nX",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"nw = max ( nw , nZ . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["nw","+=","n_",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gq ( nX , nw ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( nX , nw ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",
b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Z",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Z",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_cascad_step",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",
a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 kf ; varying vec3 kg ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",
b:["varying","vec3","kh",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 ki ; varying vec3 mT ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mU",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mV",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING",
"||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cC",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","kk",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 lb ( in vec2 kW ) { vec2 kX = vec2 ( ( kW . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( SHORE_MAP_CENTER_Z + kW . y ) / SHORE_MAP_SIZE_Z ) + 0.5 ; vec4 kY = texture2D ( u_shore_dist_map , kX ) ; const vec2 kZ = vec2 ( 1.0 / 255.0 , 1.0 ) ; float k_ = dot ( kY . ba , kZ ) ; vec2 la = normalize ( kY . rg * 2.0 - 1.0 ) ; return vec3 ( la , k_ ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"void lp ( inout vec3 lc , in float ld , in vec3 le ) { float lf = dC ( DST_NOISE_SCALE_0 * ( lc . xz + DST_NOISE_FREQ_0 * ld ) ) * dC ( DST_NOISE_SCALE_1 * ( lc . zx - DST_NOISE_FREQ_1 * ld ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float lg = le . b ; float lh = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float li = sqrt ( lg ) ; float lj = max ( lg , DIR_MIN_SHR_FAC ) * ( sin ( ( li / lh + DIR_FREQ * ld ) ) ) * max ( dC ( DIR_NOISE_SCALE * ( lc . xz + DIR_NOISE_FREQ * ld ) ) , DIR_MIN_NOISE_FAC ) ; float lk = WAVES_HEIGHT * mix ( lj , lf , max ( li , DST_MIN_FAC ) ) ; vec2 ll = le . rg ; float lm = WAVES_HOR_FAC * lj * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - lg ) , 0.0 ) ; vec2 ln = lm * ll ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float lk = WAVES_HEIGHT * lf ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float lo = cX ( 20.0 / WAVES_LENGTH * ( lc . xz - 0.25 * ld ) ) . x + cX ( 17.0 / WAVES_LENGTH * ( lc . zx + 0.1 * ld ) ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lc . xz += ln ; lo *= lg ;".split(" ")}]}}]},{type:"textline",
b:"lk += 0.05 * lo ;".split(" ")}]}}]},{type:"textline",b:"lc . y += lk ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec3 lq = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float lr = abs ( a_cascad_step ) ; vec2 ls = u_camera_eye . xz - mod ( u_camera_eye . xz , lr ) ; lq . y += WATER_LEVEL ; lq . xz += ls ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},
{type:"textline",b:"c lt = ag ( lq , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"mU = lt . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"mV = lb ( lt . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float lu = length ( u_wind ) ; float lv = u_time ; lv *= lu ;".split(" ")},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["float","lw","=","lr",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","lw","=","0.1",";"]}]}}]},{type:"textline",b:"vec3 lx = lt . a + vec3 ( lw , 0.0 , 0.0 ) ; vec3 ly = lt . a + vec3 ( 0.0 , 0.0 , lw ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 lz = lb ( lx . xz ) ; vec3 lA = lb ( ly . xz ) ; lp ( lx , lv , lz ) ; lp ( ly , lv , lA ) ; lp ( lt . a , lv , mV ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"lp ( lx , lv , vec3 ( 0.0 ) ) ; lp ( ly , lv , vec3 ( 0.0 ) ) ; lp ( lt . a , lv , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_cascad_step < 0.0 ) { lx . y = lt . a . y ; ly . y = lt . a . y ; }".split(" ")}]}}]},{type:"textline",b:"vec3 lB = normalize ( lx - lt . a ) ; vec3 lC = normalize ( ly - lt . a ) ; kh = normalize ( cross ( lC , lB ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"ki = lC ; mT = cross ( kh , ki ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float lD = dot ( kh , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lE = clamp ( 0.8 - lD , 0.0 , 1.0 ) ; kh = mix ( kh , vec3 ( 0.0 , 1.0 , 0.0 ) , lE ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"kg = lt . a ; kf = u_camera_eye - lt . a ; vec4 lF = u_view_matrix * vec4 ( lt . a , 1.0 ) ; vec4 lG = u_proj_matrix * lF ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float lH = lG . x ; float lI = lG . y ; float lJ = lG . w ; cC . x = ( lH + lJ ) / 2.0 ; cC . y = ( lI + lJ ) / 2.0 ; cC . z = lJ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"kk = - lF . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["gl_Position","=","lG",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 mW ; const float mX = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 mY = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 mY = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 mZ = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 m_ = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 na = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec3 nb = vec3 ( 0.0 ) ; float nc = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"vec3 nd = sign ( mW - vec3 ( 0.02 * mX ) ) ; if ( nd . x < 0.0 || nd . y < 0.0 || nd . z < 0.0 ) { nb = mY ; nc = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"vec3 nd = sign ( mW - vec3 ( 0.02 * mX ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( nd . x < 0.0 || nd . y < 0.0 || nd . z < 0.0 ) nb = u_wireframe_edge_color ; else nb = na ; nc = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( nd . x < 0.0 || nd . y < 0.0 || nd . z < 0.0 ) nc = 1.0 ; else nc = 0.0 ; nb = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( nd . x < 0.0 || nd . y < 0.0 || nd . z < 0.0 ) nb = u_wireframe_edge_color ; else if ( gl_FrontFacing ) nb = mZ ; else nb = m_ ; nc = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 ne = fwidth ( mW ) ; vec3 nf = smoothstep ( vec3 ( 0.0 ) , ne * mX , mW ) ; float ng = min ( min ( nf . x , nf . y ) , nf . z ) ; ng = clamp ( ng , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { nb = vec3 ( mix ( u_wireframe_edge_color , na , ng ) ) ; nc = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { nb = u_wireframe_edge_color ; nc = mix ( 1.0 , 0.0 , ng ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) nb = mix ( u_wireframe_edge_color , mZ , ng ) ; else nb = mix ( u_wireframe_edge_color , m_ , ng ) ; nc = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["gn","(","nb",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gq ( nb , nc ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( nb , nc ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||",
"HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",
b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",b:["varying","vec3","mW",";"]},{type:"condition",
a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { if ( a_polyindex == 0.0 ) mW = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) mW = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) mW = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 kW = a_position ; vec3 kX = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],
group:{type:"group",a:[{type:"textline",b:"c kY = ag ( kW , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"kW = mix ( kW , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 kZ = vec3 ( 0.0 ) ; vec3 k_ = vec3 ( 0.0 ) ; bl ( kW , kZ , k_ , kX ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","la","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 la = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c kY = fV ( kW , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , la , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lb = ( u_model_matrix * vec4 ( la , 1.0 ) ) . xyz ; mat4 lc = _ ( u_camera_eye , lb , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 ld = ( u_model_matrix * vec4 ( la , 1.0 ) ) . xyz ; lc = lc * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , ld ) ;".split(" ")}]}}]},
{type:"textline",b:"c kY = ag ( kW - la , la , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lc ) ; kY . b = lb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c kY = ag ( kW , la , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cc ( kY . a , kY . b , kX ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 le = u_view_matrix * vec4 ( kY . a , 1.0 ) ; gl_Position = u_proj_matrix * le ; }".split(" ")}]};
a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 kW = texture2D ( u_sampler_left , a ) ; vec4 kX = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( kW [ 0 ] , kX [ 1 ] , kX [ 2 ] , kW [ 3 ] + kX [ 3 ] ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 kZ ( float kW , float kX ) { vec2 kY = a + vec2 ( kW , kX ) * u_texel_size ; return texture2D ( u_color , kY ) ; } float lc ( vec4 k_ ) { vec3 la = vec3 ( 0.299 , 0.587 , 0.114 ) ; float lb = dot ( k_ . rgb , la ) ; return lb ; } vec4 lv ( ) { vec4 ld = kZ ( - 1.0 , - 1.0 ) ; vec4 le = kZ ( 1.0 , - 1.0 ) ; vec4 lf = kZ ( - 1.0 , 1.0 ) ; vec4 lg = kZ ( 1.0 , 1.0 ) ; vec4 lh = kZ ( 0.0 , 0.0 ) ; float li = lc ( ld ) ; float lj = lc ( le ) ; float lk = lc ( lf ) ; float ll = lc ( lg ) ; float lm = lc ( lh ) ; float ln = min ( lm , min ( min ( li , lj ) , min ( lk , ll ) ) ) ; float lo = max ( lm , max ( max ( li , lj ) , max ( lk , ll ) ) ) ; vec2 lp ; lp . x = - ( ( li + lj ) - ( lk + ll ) ) ; lp . y = ( ( li + lk ) - ( lj + ll ) ) ; float lq = max ( ( li + lj + lk + ll ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float lr = 1.0 / ( min ( abs ( lp . x ) , abs ( lp . y ) ) + lq ) ; lp = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , lp * lr ) ) * u_texel_size ; vec4 ls = 0.5 * ( texture2D ( u_color , a + lp * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + lp * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 lt = ls * 0.5 + 0.25 * ( texture2D ( u_color , a + lp * - 0.5 ) + texture2D ( u_color , a + lp * 0.5 ) ) ; float lu = lc ( lt ) ; if ( ( lu < ln ) || ( lu > lo ) ) return ls ; else return lt ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 om ( ) { vec2 lw ; lw . x = a . x ; lw . y = a . y ; vec4 lx = texture2D ( u_color , lw ) ; vec4 ly = kZ ( 0.0 , 1.0 ) ; vec4 lz = kZ ( 1.0 , 0.0 ) ; vec4 lA = kZ ( 0.0 , - 1.0 ) ; vec4 lB = kZ ( - 1.0 , 0.0 ) ; float lC = lc ( ly ) ; float lD = lc ( lz ) ; float lE = lc ( lA ) ; float lF = lc ( lB ) ; float lG = lc ( lx ) ; float lH = max ( lC , lG ) ; float lI = min ( lC , lG ) ; float lJ = max ( lD , lH ) ; float lK = min ( lD , lI ) ; float lL = max ( lE , lF ) ; float lM = min ( lE , lF ) ; float lN = max ( lL , lJ ) ; float lO = min ( lM , lK ) ; float lP = lN * FXAA_QUALITY_EDGE_THRESHOLD ; float lQ = lN - lO ; float mX = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , lP ) ; bool mY = lQ < mX ; if ( mY ) return lx ; vec4 mZ = kZ ( - 1.0 , - 1.0 ) ; vec4 m_ = kZ ( 1.0 , 1.0 ) ; vec4 na = kZ ( 1.0 , - 1.0 ) ; vec4 nb = kZ ( - 1.0 , 1.0 ) ; float nc = lc ( mZ ) ; float nd = lc ( m_ ) ; float ne = lc ( na ) ; float nf = lc ( nb ) ; float ng = lE + lC ; float nh = lF + lD ; float ni = 1.0 / lQ ; float nj = ng + nh ; float nk = ( - 2.0 * lG ) + ng ; float nl = ( - 2.0 * lG ) + nh ; float nm = ne + nd ; float nn = nc + ne ; float no = ( - 2.0 * lD ) + nm ; float np = ( - 2.0 * lE ) + nn ; float nq = nc + nf ; float nr = nf + nd ; float ns = ( abs ( nk ) * 2.0 ) + abs ( no ) ; float nt = ( abs ( nl ) * 2.0 ) + abs ( np ) ; float nu = ( - 2.0 * lF ) + nq ; float nv = ( - 2.0 * lC ) + nr ; float nw = abs ( nu ) + ns ; float nx = abs ( nv ) + nt ; float ny = nq + nm ; float nz = u_texel_size . x ; bool nA = nw >= nx ; float nB = nj * 2.0 + ny ; if ( ! nA ) lE = lF ; if ( ! nA ) lC = lD ; if ( nA ) nz = u_texel_size . y ; float nC = ( nB * ( 1.0 / 12.0 ) ) - lG ; float nD = lE - lG ; float nE = lC - lG ; float nF = lE + lG ; float nG = lC + lG ; bool nH = abs ( nD ) >= abs ( nE ) ; float nI = max ( abs ( nD ) , abs ( nE ) ) ; if ( nH ) nz = - nz ; float nJ = clamp ( abs ( nC ) * ni , 0.0 , 1.0 ) ; vec2 nK ; nK . x = lw . x ; nK . y = lw . y ; vec2 nL ; nL . x = ( ! nA ) ? 0.0 : u_texel_size . x ; nL . y = ( nA ) ? 0.0 : u_texel_size . y ; if ( ! nA ) nK . x += nz * 0.5 ; if ( nA ) nK . y += nz * 0.5 ; vec2 nM ; nM . x = nK . x - nL . x ; nM . y = nK . y - nL . y ; vec2 nN ; nN . x = nK . x + nL . x ; nN . y = nK . y + nL . y ; float nO = ( ( - 2.0 ) * nJ ) + 3.0 ; float nP = lc ( texture2D ( u_color , nM ) ) ; float nQ = nJ * nJ ; float nR = lc ( texture2D ( u_color , nN ) ) ; if ( ! nH ) nF = nG ; float nS = nI * 1.0 / 4.0 ; float nT = lG - nF * 0.5 ; float nU = nO * nQ ; bool nV = nT < 0.0 ; nP -= nF * 0.5 ; nR -= nF * 0.5 ; bool nW = abs ( nP ) >= nS ; bool nX = abs ( nR ) >= nS ; if ( ! nW ) nM . x -= nL . x * 1.5 ; if ( ! nW ) nM . y -= nL . y * 1.5 ; bool nY = ( ! nW ) || ( ! nX ) ; if ( ! nX ) nN . x += nL . x * 1.5 ; if ( ! nX ) nN . y += nL . y * 1.5 ; if ( nY ) { if ( ! nW ) nP = lc ( texture2D ( u_color , nM . xy ) ) ; if ( ! nX ) nR = lc ( texture2D ( u_color , nN . xy ) ) ; if ( ! nW ) nP = nP - nF * 0.5 ; if ( ! nX ) nR = nR - nF * 0.5 ; nW = abs ( nP ) >= nS ; nX = abs ( nR ) >= nS ; if ( ! nW ) nM . x -= nL . x * 2.0 ; if ( ! nW ) nM . y -= nL . y * 2.0 ; nY = ( ! nW ) || ( ! nX ) ; if ( ! nX ) nN . x += nL . x * 2.0 ; if ( ! nX ) nN . y += nL . y * 2.0 ; if ( nY ) { if ( ! nW ) nP = lc ( texture2D ( u_color , nM . xy ) ) ; if ( ! nX ) nR = lc ( texture2D ( u_color , nN . xy ) ) ; if ( ! nW ) nP = nP - nF * 0.5 ; if ( ! nX ) nR = nR - nF * 0.5 ; nW = abs ( nP ) >= nS ; nX = abs ( nR ) >= nS ; if ( ! nW ) nM . x -= nL . x * 2.0 ; if ( ! nW ) nM . y -= nL . y * 2.0 ; nY = ( ! nW ) || ( ! nX ) ; if ( ! nX ) nN . x += nL . x * 2.0 ; if ( ! nX ) nN . y += nL . y * 2.0 ; if ( nY ) { if ( ! nW ) nP = lc ( texture2D ( u_color , nM . xy ) ) ; if ( ! nX ) nR = lc ( texture2D ( u_color , nN . xy ) ) ; if ( ! nW ) nP = nP - nF * 0.5 ; if ( ! nX ) nR = nR - nF * 0.5 ; nW = abs ( nP ) >= nS ; nX = abs ( nR ) >= nS ; if ( ! nW ) nM . x -= nL . x * 4.0 ; if ( ! nW ) nM . y -= nL . y * 4.0 ; nY = ( ! nW ) || ( ! nX ) ; if ( ! nX ) nN . x += nL . x * 4.0 ; if ( ! nX ) nN . y += nL . y * 4.0 ; if ( nY ) { if ( ! nW ) nP = lc ( texture2D ( u_color , nM . xy ) ) ; if ( ! nX ) nR = lc ( texture2D ( u_color , nN . xy ) ) ; if ( ! nW ) nP = nP - nF * 0.5 ; if ( ! nX ) nR = nR - nF * 0.5 ; nW = abs ( nP ) >= nS ; nX = abs ( nR ) >= nS ; if ( ! nW ) nM . x -= nL . x * 2.0 ; if ( ! nW ) nM . y -= nL . y * 2.0 ; if ( ! nX ) nN . x += nL . x * 2.0 ; if ( ! nX ) nN . y += nL . y * 2.0 ; } } } } float nZ = lw . x - nM . x ; float n_ = nN . x - lw . x ; if ( ! nA ) nZ = lw . y - nM . y ; if ( ! nA ) n_ = nN . y - lw . y ; bool oa = ( nP < 0.0 ) != nV ; float ob = ( n_ + nZ ) ; bool oc = ( nR < 0.0 ) != nV ; float od = 1.0 / ob ; bool oe = nZ < n_ ; float of = min ( nZ , n_ ) ; bool og = oe ? oa : oc ; float oh = nU * nU ; float oi = ( of * ( - od ) ) + 0.5 ; float oj = oh * FXAA_QUALITY_SUBPIX ; float ok = og ? oi : 0.0 ; float ol = max ( ok , oj ) ; if ( ! nA ) lw . x += ol * nz ; if ( nA ) lw . y += ol * nz ; return texture2D ( u_color , lw ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = lv ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = om ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 kW = vec2 ( 0.0 , 0.0 ) ; vec2 kX = u_texel_size ; vec4 kY = texture2D ( u_color , a ) ; gl_FragColor = kY * 0.0875447373698 ; kW += kX ; gl_FragColor += texture2D ( u_color , a + kW ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - kW ) * 0.0858112354248 ; kW += kX ; gl_FragColor += texture2D ( u_color , a + kW ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - kW ) * 0.0808139781061 ; kW += kX ; gl_FragColor += texture2D ( u_color , a + kW ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - kW ) * 0.0731235112908 ; kW += kX ; gl_FragColor += texture2D ( u_color , a + kW ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - kW ) * 0.0635705267419 ; kW += kX ; gl_FragColor += texture2D ( u_color , a + kW ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - kW ) * 0.0530985673112 ; kW += kX ; gl_FragColor += texture2D ( u_color , a + kW ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - kW ) * 0.0426125984122 ; kW += kX ; gl_FragColor += texture2D ( u_color , a + kW ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - kW ) * 0.0328565115809 ; kW += kX ; gl_FragColor += texture2D ( u_color , a + kW ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - kW ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * kY , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 kW = texture2D ( u_main , a ) ; vec4 kX = texture2D ( u_bloom , a ) ; vec4 kY = kW ; kY += kX ; gl_FragColor = vec4 ( kY . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { vec4 kW = texture2D ( u_color , a ) ; vec3 kX = kW . rgb ; if ( u_brightness < 0.0 ) kX = kX * ( 1.0 + u_brightness ) ; else kX = kX + ( ( 1.0 - kX ) * u_brightness ) ; kX = ( kX - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; kX *= u_exposure ; vec3 kY = vec3 ( 0.299 , 0.587 , 0.114 ) ; float kZ = dot ( kX , kY ) ; kX = mix ( vec3 ( kZ ) , kX , u_saturation ) ; gl_FragColor = vec4 ( kX , kW . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = ck ( clamp ( nd ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { vec4 ne = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { float nf = nd ( u_depth , a , u_camera_range ) ; nf *= u_view_max_depth ; float ng ; if ( nf < u_dof_dist ) ng = ( u_dof_dist - nf ) / u_dof_front ; else ng = ( nf - u_dof_dist ) / u_dof_rear ; ng = clamp ( ng , 0.0 , 1.0 ) ; vec4 nh = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( ne , nh , ng ) ; } else gl_FragColor = ne ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float la ( float kW , float kX , float kY ) { vec2 kZ = a + vec2 ( kW , kX ) * u_texel_size ; vec4 k_ = texture2D ( u_sampler , kZ ) * kY ; return co ( k_ ) ; } void main ( ) { float lb = ( la ( - 1.0 , - 1.0 , - 1.0 ) + la ( 0.0 , - 1.0 , - 1.0 ) + la ( 1.0 , - 1.0 , - 1.0 ) + la ( - 1.0 , 0.0 , - 1.0 ) + la ( 0.0 , 0.0 , 8.0 ) + la ( 1.0 , 0.0 , - 1.0 ) + la ( - 1.0 , 1.0 , - 1.0 ) + la ( 0.0 , 1.0 , - 1.0 ) + la ( 1.0 , 1.0 , - 1.0 ) ) ; lb *= 1000.0 ; gl_FragColor = vec4 ( lb , lb , lb , 1.0 ) ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_glow_src ; uniform sampler2D u_glow_mask ; uniform sampler2D u_glow_mask_blurred ; uniform vec3 u_glow_color ; uniform float u_draw_glow ; varying vec2 a ; void main ( ) { vec4 kW = texture2D ( u_glow_src , a ) ; gl_FragColor = kW ; if ( u_draw_glow != 0.0 ) { vec4 kX = texture2D ( u_glow_mask , a ) ; vec4 kY = texture2D ( u_glow_mask_blurred , a ) ; float kZ = kY . a - kX . a ; if ( kZ != 0.0 ) { float k_ = smoothstep ( 0.0 , 1.0 , kY . a ) ; if ( kX . a == 0.0 ) { vec3 la = u_glow_color ; gn ( la ) ; vec4 lb = vec4 ( clamp ( la , 0.0 , 1.0 ) , k_ ) ; gl_FragColor = mix ( kW , lb , k_ ) ; } } } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float ne ; varying vec2 nf ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 ng ; void main ( ) { vec2 nh = ( ng . xy - a ) ; float ni = length ( nh ) ; vec2 nj = u_radial_blur_step * nh / ni ; float nk = ni / u_radial_blur_step ; nj *= min ( nk , STEPS_PER_PASS ) / STEPS_PER_PASS ; nk = max ( nk , STEPS_PER_PASS ) ; vec2 nl = a ; float nm = 0.0 ; for ( float nn = 0.0 ; nn < STEPS_PER_PASS ; nn += 1.0 ) { if ( nn <= nk ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"float no = nd ( u_input , nl , u_camera_range ) ; nm += max ( ( 1.0 - pow ( ni , 0.3 ) ) * step ( 0.9 , no ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 np = texture2D ( u_input , nl ) ; nm += co ( np ) ;".split(" ")}]}}]},{type:"textline",b:"} nl += nj ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"vec2 nq = a + nf ; float nr = cX ( vec2 ( 2.5 * ( nq . x ) , 2.5 * ( nq . y ) + 1.0 * u_time ) ) . x + 0.75 * cX ( vec2 ( 5.0 * ( nq . x ) - 0.66 * u_time , 5.0 * ( nq . y ) + 0.66 * u_time ) ) . x + 0.5 * dC ( vec2 ( 7.5 * ( nq . x ) + 0.33 * u_time , 7.5 * ( nq . y ) - 0.33 * u_time ) ) ; nr *= clamp ( 1.2 - sqrt ( 0.2 * ni ) , 0.0 , 1.0 ) * ne ; nm = max ( nr , nm ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = ck ( nm / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform vec4 u_refl_plane ; varying float ne ; varying vec2 nf ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"varying vec2 a ; varying vec4 ng ; void lc ( in vec4 kW , in vec3 kX , out vec3 kY ) { float kZ = kW . w * kX . x + kW . y * kX . z - kW . z * kX . y ; float k_ = kW . w * kX . y + kW . z * kX . x - kW . x * kX . z ; float la = kW . w * kX . z + kW . x * kX . y - kW . y * kX . x ; float lb = - kW . x * kX . x - kW . y * kX . y - kW . z * kX . z ; kY . x = kZ * kW . w - lb * kW . x - k_ * kW . z + la * kW . y ; kY . y = k_ * kW . w - lb * kW . y - la * kW . x + kZ * kW . z ; kY . z = la * kW . w - lb * kW . z - kZ * kW . y + k_ * kW . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 ld = normalize ( u_sun_direction ) ; ng = u_proj_matrix * u_view_matrix * vec4 ( ld , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_camera_eye . y + a_bb_vertex . t < - u_refl_plane . w ) { ne = 1.0 ; vec3 le = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 lf ; lc ( u_camera_quat , le , lf ) ; lf = normalize ( lf ) ; float lg = dot ( lf , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lh = atan ( lf . x , lf . z ) ; nf = vec2 ( - lh , acos ( lg ) ) ; } else { ne = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"ng . x /= ng . w ; ng . y /= ng . w ; ng . x = 0.5 * ( ng . x + 1.0 ) ; ng . y = 0.5 * ( ng . y + 1.0 ) ; ng += 99999.0 * step ( ng . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 a ; void main ( ) { vec4 kW = texture2D ( u_main , a ) ; vec3 kX = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; gl ( kW . rgb ) ; float kY = co ( texture2D ( u_god_rays , a ) ) ; vec3 kZ = kW . rgb + u_god_rays_intensity * vec3 ( kY ) * kX ; gn ( kZ ) ; gl_FragColor . rgb = kZ ; gl_FragColor . a = kW . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 kW = texture2D ( u_color , a ) * 0.38026 ; kW += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; kW += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; kW += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; kW += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; kW += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; kW += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; kW += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; kW += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = kW ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { vec4 kW = texture2D ( u_input , a ) ; float kX = dot ( kW . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( kX ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float kW ; float kX = 0.0 ; for ( float kY = 0.025 ; kY < 1.0 ; kY += 0.05 ) for ( float kZ = 0.025 ; kZ < 1.0 ; kZ += 0.05 ) { kW = max ( texture2D ( u_input , vec2 ( kY , kZ ) ) . r , 0.01 ) ; kX += log ( kW ) ; } float k_ = exp ( kX / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( k_ ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float nh ; void main ( ) { float ni = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float nj = texture2D ( u_luminance , a ) . r ; vec4 nk = texture2D ( u_main , a ) ; float nl = nj / ni ; float nm = u_bloom_edge_lum ; gl_FragColor = nk * max ( nl - nm , 0.0 ) * nh ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float nh ; const vec3 kW = vec3 ( 0.0 , 1.0 , 0.0 ) ; void ld ( in vec4 kX , in vec3 kY , out vec3 kZ ) { float k_ = kX . w * kY . x + kX . y * kY . z - kX . z * kY . y ; float la = kX . w * kY . y + kX . z * kY . x - kX . x * kY . z ; float lb = kX . w * kY . z + kX . x * kY . y - kX . y * kY . x ; float lc = - kX . x * kY . x - kX . y * kY . y - kX . z * kY . z ; kZ . x = k_ * kX . w - lc * kX . x - la * kX . z + lb * kX . y ; kZ . y = la * kX . w - lc * kX . y - lb * kX . x + k_ * kX . z ; kZ . z = lb * kX . w - lc * kX . z - k_ * kX . y + la * kX . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 le ; ld ( u_camera_quat , kW , le ) ; nh = dot ( - le , u_sun_direction ) * u_bloom_key ; nh *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 kW = texture2D ( u_mb_tex_curr , a ) ; vec4 kX = texture2D ( u_mb_tex_accum , a ) ; if ( length ( kW - kX ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * kW + u_motion_blur_exp * kX ; } else { gl_FragColor = kW ; } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"vec4 kW = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( kW . r + kW . g + kW . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 kX = vec2 ( 0.0 , 0.0 ) ; vec2 kY = u_texel_size ; vec4 kZ ; kZ = texture2D ( u_color , a ) ; gl_FragColor = kZ * 0.2270270270 ; kX += kY ; kZ = texture2D ( u_color , a + kX ) ; gl_FragColor += kZ * 0.1945945946 ; kZ = texture2D ( u_color , a - kX ) ; gl_FragColor += kZ * 0.1945945946 ; kX += kY ; kZ = texture2D ( u_color , a + kX ) ; gl_FragColor += kZ * 0.1216216216 ; kZ = texture2D ( u_color , a - kX ) ; gl_FragColor += kZ * 0.1216216216 ; kX += kY ; kZ = texture2D ( u_color , a + kX ) ; gl_FragColor += kZ * 0.0540540541 ; kZ = texture2D ( u_color , a - kX ) ; gl_FragColor += kZ * 0.0540540541 ; kX += kY ; kZ = texture2D ( u_color , a + kX ) ; gl_FragColor += kZ * 0.0162162162 ; kZ = texture2D ( u_color , a - kX ) ; gl_FragColor += kZ * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 kY = u_texel_size ; vec4 kZ = texture2D ( u_color , a ) ; gl_FragColor = kZ ; if ( kZ . a == 0.0 ) { kZ = texture2D ( u_color , a + kY ) ; if ( kZ . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , kZ . a ) ; else { kZ = texture2D ( u_color , a - kY ) ; if ( kZ . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , kZ . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; varying vec2 a ; void main ( ) { a = a_bb_vertex + 0.5 ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","ni",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nj ; varying vec4 nk ; varying vec4 nl ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nm",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 ns ( vec2 nn , sampler2D no ) { float np = texture2D ( no , nn ) . r ; float nq = texture2D ( no , nj . xy ) . r ; float nr = texture2D ( no , nj . zw ) . r ; return vec3 ( np , nq , nr ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 ny ( vec2 nt , sampler2D nu ) { vec3 nv = ns ( nt , nu ) ; vec2 nw = abs ( nv . xx - nv . yz ) ; vec2 nx = step ( SMAA_PREDICATION_THRESHOLD , nw ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * nx ) ; }".split(" ")}]}}]},{type:"textline",b:"void nC ( bvec2 nz , inout vec2 nA , vec2 nB ) { if ( nz . x ) nA . x = nB . x ; if ( nz . y ) nA . y = nB . y ; } void nC ( bvec4 nD , inout vec4 nE , vec4 nF ) { nC ( nD . xy , nE . xy , nF . xy ) ; nC ( nD . zw , nE . zw , nF . zw ) ; } vec2 nH ( vec2 nG ) { return sign ( nG ) * floor ( abs ( nG ) + .5 ) ; } vec4 nH ( vec4 nI ) { return sign ( nI ) * floor ( abs ( nI ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nZ ( vec2 nJ , sampler2D nK".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","nL"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 nM = ny ( nJ , nL ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 nM = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nN = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float nO = dot ( texture2D ( nK , nJ ) . rgb , nN ) ; float nP = dot ( texture2D ( nK , nj . xy ) . rgb , nN ) ; float nQ = dot ( texture2D ( nK , nj . zw ) . rgb , nN ) ; vec4 nR ; nR . xy = abs ( nO - vec2 ( nP , nQ ) ) ; vec2 nS = step ( nM , nR . xy ) ; if ( dot ( nS , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float nT = dot ( texture2D ( nK , nk . xy ) . rgb , nN ) ; float nU = dot ( texture2D ( nK , nk . zw ) . rgb , nN ) ; nR . zw = abs ( nO - vec2 ( nT , nU ) ) ; vec2 nV = max ( nR . xy , nR . zw ) ; float nW = dot ( texture2D ( nK , nl . xy ) . rgb , nN ) ; float nX = dot ( texture2D ( nK , nl . zw ) . rgb , nN ) ; nR . zw = abs ( vec2 ( nP , nQ ) - vec2 ( nW , nX ) ) ; nV = max ( nV . xy , nR . zw ) ; float nY = max ( nV . x , nV . y ) ; nS . xy *= step ( nY , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * nR . xy ) ; return nS ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 oa ( vec2 n_ ) { n_ . r = n_ . r * abs ( 5.0 * n_ . r - 5.0 * 0.75 ) ; return nH ( n_ ) ; } vec4 oa ( vec4 ob ) { ob . rb = ob . rb * abs ( 5.0 * ob . rb - 5.0 * 0.75 ) ; return nH ( ob ) ; } vec2 oj ( sampler2D oc , vec2 od , vec2 oe , out vec2 of ) { vec4 og = vec4 ( od , - 1.0 , 1.0 ) ; vec3 oh = vec3 ( u_texel_size , 1.0 ) ; for ( int oi = 0 ; oi < SMAA_MAX_SEARCH_STEPS_DIAG ; oi ++ ) { if ( og . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && og . w > 0.9 ) { og . xyz += oh * vec3 ( oe , 1.0 ) ; of = texture2D ( oc , og . xy , 0.0 ) . rg ; og . w = dot ( of , vec2 ( 0.5 , 0.5 ) ) ; } } return og . zw ; } vec2 or ( sampler2D ok , vec2 ol , vec2 om , out vec2 on ) { vec4 oo = vec4 ( ol , - 1.0 , 1.0 ) ; oo . x += 0.25 * u_texel_size . x ; vec3 op = vec3 ( u_texel_size , 1.0 ) ; for ( int oq = 0 ; oq < SMAA_MAX_SEARCH_STEPS_DIAG ; oq ++ ) { if ( oo . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && oo . w > 0.9 ) { oo . xyz = op * vec3 ( om , 1.0 ) + oo . xyz ; on = texture2D ( ok , oo . xy , 0.0 ) . rg ; on = oa ( on ) ; oo . w = dot ( on , vec2 ( 0.5 , 0.5 ) ) ; } } return oo . zw ; } vec2 ox ( sampler2D os , vec2 ot , vec2 ou , float ov ) { vec2 ow = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * ou + ot ; ow = SMAA_AREATEX_PIXEL_SIZE * ow + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; ow . x += 0.5 ; ow . y += SMAA_AREATEX_SUBTEX_SIZE * ov ; return texture2D ( os , ow , 0.0 ) . rg ; } vec2 oM ( sampler2D oy , sampler2D oz , vec2 oA , vec2 oB , vec4 oC ) { vec2 oD = vec2 ( 0.0 , 0.0 ) ; vec4 oE ; vec2 oF ; if ( oB . r > 0.0 ) { oE . xz = oj ( oy , oA , vec2 ( - 1.0 , 1.0 ) , oF ) ; oE . x += float ( oF . y > 0.9 ) ; } else oE . xz = vec2 ( 0.0 , 0.0 ) ; oE . yw = oj ( oy , oA , vec2 ( 1.0 , - 1.0 ) , oF ) ; if ( oE . x + oE . y > 2.0 ) { vec4 oG = vec4 ( - oE . x + 0.25 , oE . x , oE . y , - oE . y - 0.25 ) * u_texel_size . xyxy + oA . xyxy ; vec4 oH ; oH . xy = texture2D ( oy , oG . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; oH . zw = texture2D ( oy , oG . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; oH . yxwz = oa ( oH . xyzw ) ; vec2 oI = vec2 ( 2.0 , 2.0 ) * oH . xz + oH . yw ; nC ( bvec2 ( step ( 0.9 , oE . zw ) ) , oI , vec2 ( 0.0 , 0.0 ) ) ; oD += ox ( oz , oE . xy , oI , oC . z ) ; } oE . xz = or ( oy , oA , vec2 ( - 1 , - 1 ) , oF ) ; if ( texture2D ( oy , oA + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { oE . yw = or ( oy , oA , vec2 ( 1 , 1 ) , oF ) ; oE . y += float ( oF . y > 0.9 ) ; } else oE . yw = vec2 ( 0.0 , 0.0 ) ; if ( oE . x + oE . y > 2.0 ) { vec4 oJ = vec4 ( - oE . x , - oE . x , oE . y , oE . y ) * u_texel_size . xyxy + oA . xyxy ; vec4 oK ; oK . x = texture2D ( oy , oJ . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; oK . y = texture2D ( oy , oJ . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; oK . zw = texture2D ( oy , oJ . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 oL = vec2 ( 2.0 , 2.0 ) * oK . xz + oK . yw ; nC ( bvec2 ( step ( 0.9 , oE . zw ) ) , oL , vec2 ( 0 , 0 ) ) ; oD += ox ( oz , oE . xy , oL , oC . w ) . gr ; } return oD ; }".split(" ")}]}}]},
{type:"textline",b:"float oS ( sampler2D oN , vec2 oO , float oP ) { vec2 oQ = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 oR = SMAA_SEARCHTEX_SIZE * vec2 ( oP , 1.0 ) ; oQ += vec2 ( - 1.0 , 1.0 ) ; oR += vec2 ( 0.5 , - 0.5 ) ; oQ *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; oR *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( oN , oQ * oO + oR , 0.0 ) . r ; } float o_ ( sampler2D oT , sampler2D oU , vec2 oV , float oW ) { vec2 oX = vec2 ( 0.0 , 1.0 ) ; for ( int oY = 0 ; oY < SMAA_MAX_SEARCH_STEPS ; oY ++ ) { if ( oV . x > oW && oX . g > 0.8281 && oX . r == 0.0 ) { oX = texture2D ( oT , oV , 0.0 ) . rg ; oV = - vec2 ( 2.0 , 0.0 ) * u_texel_size + oV ; } } float oZ = - ( 255.0 / 127.0 ) * oS ( oU , oX , 0.0 ) + 3.25 ; return u_texel_size . x * oZ + oV . x ; } float ph ( sampler2D pa , sampler2D pb , vec2 pc , float pd ) { vec2 pe = vec2 ( 0.0 , 1.0 ) ; for ( int pf = 0 ; pf < SMAA_MAX_SEARCH_STEPS ; pf ++ ) { if ( pc . x < pd && pe . g > 0.8281 && pe . r == 0.0 ) { pe = texture2D ( pa , pc , 0.0 ) . rg ; pc = vec2 ( 2.0 , 0.0 ) * u_texel_size + pc ; } } float pg = - ( 255.0 / 127.0 ) * oS ( pb , pe , 0.5 ) + 3.25 ; return - u_texel_size . x * pg + pc . x ; } float pp ( sampler2D pi , sampler2D pj , vec2 pk , float pl ) { vec2 pm = vec2 ( 1.0 , 0.0 ) ; for ( int pn = 0 ; pn < SMAA_MAX_SEARCH_STEPS ; pn ++ ) { if ( pk . y > pl && pm . r > 0.8281 && pm . g == 0.0 ) { pm = texture2D ( pi , pk , 0.0 ) . rg ; pk = - vec2 ( 0.0 , 2.0 ) * u_texel_size + pk ; } } float po = - ( 255.0 / 127.0 ) * oS ( pj , pm . gr , 0.0 ) + 3.25 ; return u_texel_size . y * po + pk . y ; } float px ( sampler2D pq , sampler2D pr , vec2 ps , float pt ) { vec2 pu = vec2 ( 1.0 , 0.0 ) ; for ( int pv = 0 ; pv < SMAA_MAX_SEARCH_STEPS ; pv ++ ) { if ( ps . y < pt && pu . r > 0.8281 && pu . g == 0.0 ) { pu = texture2D ( pq , ps , 0.0 ) . rg ; ps = vec2 ( 0.0 , 2.0 ) * u_texel_size + ps ; } } float pw = - ( 255.0 / 127.0 ) * oS ( pr , pu . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * pw + ps . y ; } vec2 pE ( sampler2D py , vec2 pz , float pA , float pB , float pC ) { vec2 pD = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * nH ( 4.0 * vec2 ( pA , pB ) ) + pz ; pD = SMAA_AREATEX_PIXEL_SIZE * pD + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; pD . y = SMAA_AREATEX_SUBTEX_SIZE * pC + pD . y ; return texture2D ( py , pD , 0.0 ) . rg ; } void pM ( sampler2D pF , inout vec2 pG , vec4 pH , vec2 pI ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pJ = step ( pI . xy , pI . yx ) ; vec2 pK = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pJ ; pK /= pJ . x + pJ . y ; vec2 pL = vec2 ( 1.0 , 1.0 ) ; pL . x -= pK . x * texture2D ( pF , pH . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; pL . x -= pK . y * texture2D ( pF , pH . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; pL . y -= pK . x * texture2D ( pF , pH . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; pL . y -= pK . y * texture2D ( pF , pH . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; pG *= clamp ( pL , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void pU ( sampler2D pN , inout vec2 pO , vec4 pP , vec2 pQ ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pR = step ( pQ . xy , pQ . yx ) ; vec2 pS = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pR ; pS /= pR . x + pR . y ; vec2 pT = vec2 ( 1.0 , 1.0 ) ; pT . x -= pS . x * texture2D ( pN , pP . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; pT . x -= pS . y * texture2D ( pN , pP . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; pT . y -= pS . x * texture2D ( pN , pP . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; pT . y -= pS . y * texture2D ( pN , pP . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; pO *= clamp ( pT , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qm ( vec2 pV , vec2 pW , sampler2D pX , sampler2D pY , sampler2D pZ , vec4 p_ ) { vec4 qa = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 qb = texture2D ( pX , pV ) . rg ; if ( qb . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"qa . rg = oM ( pX , pY , pV , qb , p_ ) ; if ( qa . r == - qa . g ) {".split(" ")}]}}]},
{type:"textline",b:"vec2 qc ; vec3 qd ; qd . x = o_ ( pX , pZ , nj . xy , nl . x ) ; qd . y = nk . y ; qc . x = qd . x ; float qe = texture2D ( pX , qd . xy , 0.0 ) . r ; qd . z = ph ( pX , pZ , nj . zw , nl . y ) ; qc . y = qd . z ; qc = abs ( nH ( qc / u_texel_size . xx - pW . xx ) ) ; vec2 qf = sqrt ( qc ) ; float qg = texture2D ( pX , qd . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; qa . rg = pE ( pY , qf , qe , qg , p_ . y ) ; qd . y = pV . y ; pM ( pX , qa . rg , qd . xyzy , qc ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else qb . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( qb . r > 0.0 ) { vec2 qh ; vec3 qi ; qi . y = pp ( pX , pZ , nk . xy , nl . z ) ; qi . x = nj . x ; qh . x = qi . y ; float qj = texture2D ( pX , qi . xy , 0.0 ) . g ; qi . z = px ( pX , pZ , nk . zw , nl . w ) ; qh . y = qi . z ; qh = abs ( nH ( qh / u_texel_size . yy - pW . yy ) ) ; vec2 qk = sqrt ( qh ) ; float ql = texture2D ( pX , qi . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; qa . ba = pE ( pY , qk , qj , ql , p_ . x ) ; qi . x = pV . x ; pU ( pX , qa . ba , qi . xyxz , qh ) ; } return qa ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qD ( vec2 qn , sampler2D qo , sampler2D qp".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qq"]}]}}]},{type:"textline",b:") { vec4 qr ; qr . x = texture2D ( qp , ni . xy ) . a ; qr . y = texture2D ( qp , ni . zw ) . g ; qr . wz = texture2D ( qp , qn ) . xz ; if ( dot ( qr , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 qs = texture2D ( qo , qn , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qt = texture2D ( qq , a ) ; vec2 qu = 2.0 * cw ( qt ) - 1.0 ; qs . a = sqrt ( 2.0 * length ( qu ) ) ;".split(" ")}]}}]},{type:"textline",b:"return qs ; } else { bool qv = max ( qr . x , qr . z ) > max ( qr . y , qr . w ) ; vec4 qw = vec4 ( 0.0 , qr . y , 0.0 , qr . w ) ; vec2 qx = qr . yw ; nC ( bvec4 ( qv , qv , qv , qv ) , qw , vec4 ( qr . x , 0.0 , qr . z , 0.0 ) ) ; nC ( bvec2 ( qv , qv ) , qx , qr . xz ) ; qx /= dot ( qx , vec2 ( 1.0 , 1.0 ) ) ; vec4 qy = qw * vec4 ( u_texel_size , - u_texel_size ) + qn . xyxy ; vec4 qz = qx . x * texture2D ( qo , qy . xy , 0.0 ) ; qz += qx . y * texture2D ( qo , qy . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qA = texture2D ( qq , qy . xy ) ; vec2 qB = 2.0 * cw ( qA ) - 1.0 ; vec2 qC = qx . x * qB ; qA = texture2D ( qq , qy . zw ) ; qB = 2.0 * cw ( qA ) - 1.0 ; qC += qx . y * qB ; qz . a = sqrt ( 2.0 * length ( qC ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","qz",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qP ( vec2 qE , sampler2D qF , sampler2D qG".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qH"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qI = texture2D ( qH , a ) ; vec2 qJ ; qJ = 2.0 * cw ( qI ) - 1.0 ; vec4 qK = texture2D ( qF , qE ) ; vec4 qL = texture2D ( qG , qE - qJ ) ; float qM = abs ( qK . a * qK . a - qL . a * qL . a ) / 2.0 ; float qN = 0.5 * clamp ( 1.0 - sqrt ( qM ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 qO = mix ( qK , qL , qN ) ; qO . a = 1.0 ; return qO ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qK = texture2D ( qF , qE ) ; vec4 qL = texture2D ( qG , qE ) ; return mix ( qK , qL , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qQ = vec4 ( nZ ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qQ = qm ( a , nm , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qQ = qD ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qQ = vec4 ( qP ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qQ = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","qQ",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ni",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 nj ; varying vec4 nk ; varying vec4 nl ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nm",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void kX ( vec2 kW ) { nj = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + kW . xyxy ; nk = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + kW . xyxy ; nl = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + kW . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void k_ ( vec2 kY , out vec2 kZ ) { kZ = kY / u_texel_size ; nj = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + kY . xyxy ; nk = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + kY . xyxy ; nl = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( nj . xz , nk . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void lb ( vec2 la ) { ni = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + la . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = a_bb_vertex + 0.5 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["kX","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"k_ ( a , nm ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["lb","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_16",b:["1"]},{type:"define",
name:"SSAO_QUALITY_32",b:["2"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform vec2 u_texel_size ; uniform float u_view_max_depth ; uniform vec2 u_camera_range ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_dithering_amount ; uniform float u_ssao_gauss_center ; uniform float u_ssao_gauss_width_square ; uniform float u_ssao_gauss_width_left_square ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float no ( in vec2 nn ) { return nd ( u_depth , nn , u_camera_range ) ; } float nw ( in float np , in float nq , inout int nr ) { float ns = u_ssao_gauss_width_square ; float nt = ( np - nq ) * 100.0 ; if ( nt < u_ssao_gauss_center ) ns = u_ssao_gauss_width_left_square ; else nr = 1 ; float nu = nt - u_ssao_gauss_center ; float nv = exp ( - 2.0 * nu * nu / ns ) ; return nv ; } float nF ( float nx , vec2 ny ) { float nz = 0.0 ; float nA = 0.0 ; float nB = max ( 1.0 , u_view_max_depth / 100.0 ) ; nx *= nB ; ny /= nx ; vec2 nC = a + ny ; vec2 nD = a - ny ; int nE = 0 ; nz = nw ( nx , nB * no ( nC ) , nE ) ; if ( nE > 0 || nC . y < 0.0 || nC . y > 1.0 || nC . x < 0.0 || nC . x > 1.0 ) { nA = nw ( nB * no ( nD ) , nx , nE ) ; nz += ( 1.0 - nz ) * nA ; } return nz ; } void main ( ) { vec2 nG = dI ( a ) * u_ssao_dithering_amount ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:["nG","*=","1.5",";"]}]}}]},{type:"textline",b:"float nH = no ( a ) ; float nI = 0.0 ; vec2 nJ = u_texel_size * 0.5 ; for ( int nK = 0 ; nK < 4 ; nK ++ ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"if ( nK == 0 || nK == 2 ) {".split(" ")}]}}]},{type:"textline",b:"nI += nF ( nH , nJ ) ; nI += nF ( nH , vec2 ( nJ . x , - nJ . y ) ) ; nI += nF ( nH , vec2 ( - nJ . x , nJ . y ) ) ; nI += nF ( nH , vec2 ( - nJ . x , - nJ . y ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"} else if ( nK == 1 || nK == 3 ) {".split(" ")}]}}]},{type:"textline",b:"nI += nF ( nH , vec2 ( nJ . x * 1.2 , 0.0 ) ) ; nI += nF ( nH , vec2 ( - nJ . x * 1.2 , 0.0 ) ) ; nI += nF ( nH , vec2 ( 0.0 , nJ . y * 1.2 ) ) ; nI += nF ( nH , vec2 ( 0.0 , - nJ . y * 1.2 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",
b:["}"]}]}}]},{type:"textline",b:"nJ += nG ; nJ *= u_ssao_radius_increase ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"nI = 1.0 - nI / 16.0 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"nI = 1.0 - nI / 32.0 ;".split(" ")}]}}]},{type:"textline",b:"float nL = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * nH ) ; nI = ( 1.0 - nL ) + nI * nL ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:["nI","=","1.0",";"]}]}}]},{type:"textline",b:"float nM = texture2D ( u_color , a ) . r ; gl_FragColor = vec4 ( nM , nI , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { float kW = texture2D ( u_depth , a ) . x ; vec4 kX = vec4 ( a * 2.0 - 1.0 , 2.0 * kW - 1.0 , 1.0 ) ; vec4 kY = u_view_proj_inverse * kX ; vec4 kZ = kY / kY . w ; vec4 k_ = u_view_proj_prev * kZ ; k_ /= k_ . w ; vec2 la = ( kX . xy - k_ . xy ) / 4.0 + 0.5 ; la = clamp ( la , 0.0 , 1.0 ) ; gl_FragColor = ck ( la ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; struct c { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool f ( vec3 d , vec3 e ) { return any ( lessThan ( abs ( d - e ) , vec3 ( EPSILON ) ) ) ; } vec3 i ( in vec4 g , in vec3 h ) { return h + 2.0 * cross ( g . xyz , cross ( g . xyz , h ) + g . w * h ) ; } mat4 j ( ) { return mat4 ( 1.0 , b , b , b , b , 1.0 , b , b , b , b , 1.0 , b , b , b , b , 1.0 ) ; } mat4 l ( float k ) { return mat4 ( 1.0 , b , b , b , b , cos ( k ) , sin ( k ) , b , b , - sin ( k ) , cos ( k ) , b , b , b , b , 1.0 ) ; } mat4 n ( float m ) { return mat4 ( cos ( m ) , b , - sin ( m ) , b , b , 1.0 , b , b , sin ( m ) , b , cos ( m ) , b , b , b , b , 1.0 ) ; } mat4 p ( float o ) { return mat4 ( cos ( o ) , sin ( o ) , b , b , - sin ( o ) , cos ( o ) , b , b , b , b , 1.0 , b , b , b , b , 1.0 ) ; } c r ( in c q ) { return c ( q . a , q . b , normalize ( q . c ) , normalize ( q . d ) , normalize ( q . e ) , q . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 s = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"HAIR_BILLBOARD_SPHERICAL || ! HAIR_BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 y ( vec3 t , mat4 u ) { vec3 v = vec3 ( u [ 0 ] [ 0 ] , u [ 1 ] [ 0 ] , u [ 2 ] [ 0 ] ) ; vec3 w = vec3 ( u [ 0 ] [ 1 ] , u [ 1 ] [ 1 ] , u [ 2 ] [ 1 ] ) ; vec3 x = vec3 ( u [ 0 ] [ 2 ] , u [ 1 ] [ 2 ] , u [ 2 ] [ 2 ] ) ; w = cross ( x , v ) ; return mat4 ( vec4 ( v , 0.0 ) , vec4 ( w , 0.0 ) , vec4 ( x , 0.0 ) , vec4 ( t , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 E ( vec3 z , vec3 A ) { vec3 B = z - A ; B . y = 0.0 ; B = normalize ( B ) ; vec3 C = normalize ( cross ( s , B ) ) ; vec3 D = normalize ( cross ( B , C ) ) ; return mat4 ( vec4 ( C , 0.0 ) , vec4 ( D , 0.0 ) , vec4 ( B , 0.0 ) , vec4 ( A , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 P ( in vec3 F , float G , float H , float I , vec3 J ) { float L = fract ( length ( J ) / 0.17 ) ; float M = I + L / 10.0 ; float N = L ; if ( I != 0.0 ) N /= I ; F *= 1.0 + 0.5 * sin ( G ) ; float O = length ( F ) * H * sin ( 2.0 * 3.14 * G * M + N ) ; return p ( O ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 _ ( in vec3 Q , in vec3 R , in mat4 S ) {".split(" ")},{type:"condition",a:[{type:"if",c:"HAIR_BILLBOARD_SPHERICAL || ! HAIR_BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 T = y ( R , S ) ;".split(" ")}]}},{type:"elif",c:["HAIR_BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"float U = fract ( ( R . x * 1.43 + R . y * 0.123 + R . z * 6.1 ) ) ; float V = 2.0 * M_PI * U ; vec3 W = normalize ( vec3 ( S [ 0 ] [ 2 ] , 0.0 , S [ 2 ] [ 2 ] ) ) ; float X = acos ( W [ 2 ] ) ; if ( W [ 0 ] < 0.0 ) X = 2.0 * M_PI - X ; float Y = X - V ; if ( Y < 0.0 ) Y = 2.0 * M_PI + Y ; float Z = V ; if ( Y <= MAX_BILLBOARD_ANGLE ) Z += Y ; else if ( Y <= M_PI - MAX_BILLBOARD_ANGLE ) Z += MAX_BILLBOARD_ANGLE * ( 2.0 * Y - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( Y <= M_PI + MAX_BILLBOARD_ANGLE ) Z += Y - M_PI ; else if ( Y <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) Z += MAX_BILLBOARD_ANGLE * ( 2.0 * Y - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else Z += Y - 2.0 * M_PI ; mat4 T = n ( Z ) ; T [ 3 ] = vec4 ( R , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 T = E ( Q , R ) ;".split(" ")}]}}]},{type:"textline",b:"return T ; } c ag ( in vec3 aa , in vec3 ab , in vec3 ac , in vec3 ad , in vec3 ae , in mat4 af ) { aa = ( af * vec4 ( aa , 1.0 ) ) . xyz ; ab = ( af * vec4 ( ab , 1.0 ) ) . xyz ; ac = ( af * vec4 ( ac , 0.0 ) ) . xyz ; ad = ( af * vec4 ( ad , 0.0 ) ) . xyz ; ae = ( af * vec4 ( ae , 0.0 ) ) . xyz ; return r ( c ( aa , ab , ac , ad , ae , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]=
{type:"group",a:[{type:"textline",b:"vec2 aj ( vec2 ah , vec3 ai ) { return ( ah + 0.5 ) * ai . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 as ( in vec4 ak , in vec4 al , in float am ) { float an = ak [ 0 ] * al [ 0 ] + ak [ 1 ] * al [ 1 ] + ak [ 2 ] * al [ 2 ] + ak [ 3 ] * al [ 3 ] ; if ( an < 0.0 ) { al *= - 1.0 ; an = - an ; } if ( abs ( an ) >= 1.0 ) return ak ; float ao = acos ( an ) ; float ap = sqrt ( 1.0 - an * an ) ; if ( abs ( ap ) < 0.001 ) return vec4 ( ak * 0.5 + al * 0.5 ) ; float aq = sin ( ( 1.0 - am ) * ao ) / ap ; float ar = sin ( am * ao ) / ap ; return ak * aq + al * ar ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aH ( in vec3 at , in vec4 au , in vec4 av , in vec4 aw , in vec4 ax , in float ay ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 az = as ( au , av , ay ) ; vec4 aA = mix ( aw , ax , ay ) ; vec3 aB = i ( az , at ) ; vec3 aC = aB * aA . w + aA . xyz ; return aC ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aD = i ( au , at ) ; vec3 aE = i ( av , at ) ; vec3 aF = aD * aw . w + aw . xyz ; vec3 aG = aE * ax . w + ax . xyz ; return mix ( aF , aG , ay ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aQ ( in vec3 aI , in vec4 aJ , in vec4 aK , in float aL ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aM = as ( aJ , aK , aL ) ; vec3 aN = i ( aM , aI ) ; return aN ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aO = i ( aJ , aI ) ; vec3 aP = i ( aK , aI ) ; return mix ( aO , aP , aL ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 aH ( in vec3 aR , in vec4 aS , in vec4 aT ) { vec3 aU = i ( aS , aR ) ; vec3 aV = aU * aT . w + aT . xyz ; return aV ; } vec3 aQ ( in vec3 aW , in vec4 aX ) { vec3 aY = i ( aX , aW ) ; return aY ; }".split(" ")}]}}]},{type:"textline",b:"void bl ( inout vec3 aZ , inout vec3 a_ , inout vec3 ba , inout vec3 bb ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["float","bc","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { vec3 bd = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 be = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bf = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bg = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int bh = 0 ; bh < 4 ; bh ++ ) { int bi = int ( a_influence [ bh ] ) ; float bj = fract ( a_influence [ bh ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bd += bj * aH ( aZ , u_quatsb [ bi ] , u_quatsa [ bi ] , u_transb [ bi ] , u_transa [ bi ] , bc ) ; be += bj * aQ ( a_ , u_quatsb [ bi ] , u_quatsa [ bi ] , bc ) ; bf += bj * aQ ( ba , u_quatsb [ bi ] , u_quatsa [ bi ] , bc ) ; bg += bj * aQ ( bb , u_quatsb [ bi ] , u_quatsa [ bi ] , bc ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bd += bj * aH ( aZ , u_quatsb [ bi ] , u_transb [ bi ] ) ; be += bj * aQ ( a_ , u_quatsb [ bi ] ) ; bf += bj * aQ ( ba , u_quatsb [ bi ] ) ; bg += bj * aQ ( bb , u_quatsb [ bi ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} aZ = bd ; a_ = be ; ba = bf ; bb = bg ; } if ( ! ( a_influence . y > 0.0 ) ) { int bk = int ( a_influence [ 0 ] - 1.0 ) ; if ( bk > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"aZ = aH ( aZ , u_quatsb [ bk ] , u_quatsa [ bk ] , u_transb [ bk ] , u_transa [ bk ] , bc ) ; a_ = aQ ( a_ , u_quatsb [ bk ] , u_quatsa [ bk ] , bc ) ; ba = aQ ( ba , u_quatsb [ bk ] , u_quatsa [ bk ] , bc ) ; bb = aQ ( bb , u_quatsb [ bk ] , u_quatsa [ bk ] , bc ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"aZ = aH ( aZ , u_quatsb [ bk ] , u_transb [ bk ] ) ; a_ = aQ ( a_ , u_quatsb [ bk ] ) ; ba = aQ ( ba , u_quatsb [ bk ] ) ; bb = aQ ( bb , u_quatsb [ bk ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bz ( inout vec3 bm , in vec3 bn , in float bo , in float bp , in float bq , in vec3 br , in float bs ) { float bt = length ( bn ) ; float bu = bp * ( 1.0 + 0.1 * fract ( bt ) ) ; float bv = bo * bs * ( 1.0 + sin ( 2.0 * 3.14 * bq * bu + bt ) ) ; float bw = ( bm . y - bn . y ) * abs ( bv ) ; bw += 1.0 ; bw *= bw ; bw = bw * bw - bw ; vec3 bx = bm ; bx . xz += br . xz * bw * sign ( bv ) ; float by = length ( bm - bn ) ; bm = bn + normalize ( bx - bn ) * by ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bB ( vec4 bA ) { return bA * bA * ( 3.0 - 2.0 * bA ) ; } vec4 bD ( vec4 bC ) { return abs ( fract ( bC + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bF ( vec4 bE ) { return bB ( bD ( bE ) ) ; } void bW ( inout vec3 bG , in float bH , in vec3 bI , in vec3 bJ , in vec3 bK , in float bL , in float bM , in float bN , in vec3 bO ) { float bP ; float bQ ; float bR ; vec2 bS ; vec4 bT ; vec2 bU ; vec3 bV ; bP = dot ( bK , vec3 ( 1.0 ) ) ; bQ = bP + bO . g ; bR = dot ( bG , vec3 ( bO . g ) ) ; bS = ( bH + vec2 ( bR , bQ ) ) ; bT = ( ( fract ( ( bS . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bJ ) * bL ; bT = bF ( bT ) ; bU = bT . xz + bT . yw ; bU . y = 0.5 - bU . y ; bV = bU . xyx * bO . rbr * vec3 ( bM * bI . x , bN , bM * bI . z ) ; bG += bV ; }".split(" ")}]}}]},
{type:"textline",b:"void cc ( inout vec3 bX , inout vec3 bY , in vec3 bZ ) { vec3 b_ = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vec3 ca = bY ; vec3 cb = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ca = bX ; vec3 cb = bY ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"bW ( ca , u_time , bZ , b_ , cb , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bz ( ca , cb , au_wind_bending_amp , au_wind_bending_freq , u_time , b_ , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bz ( ca , cb , au_wind_bending_amp , au_wind_bending_freq , u_time , b_ , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"bX += ca - bY ; bY = ca ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bX = ca ; bY = cb ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",b:["2"]},
{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",
b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float cd = 255.0 ; float ce = 0.0 ; float cf = 1.0 ; vec4 ck ( const in float cg ) { vec4 ch = vec4 ( cd * cd * cd , cd * cd , cd , cf ) ; vec4 ci = vec4 ( ce , cf / cd , cf / cd , cf / cd ) ; vec4 cj = fract ( cg * ch ) ; cj -= cj . xxyz * ci ; return cj ; } float co ( const in vec4 cl ) { float cm ; vec4 cn = vec4 ( cf / ( cd * cd * cd ) , cf / ( cd * cd ) , cf / cd , cf ) ; cm = dot ( cl , cn ) ; return cm ; } vec4 ck ( const in vec2 cp ) { vec2 cq = vec2 ( cd , cf ) ; vec2 cr = vec2 ( ce , cf / cd ) ; vec4 cs = fract ( cp . xxyy * cq . xyxy ) ; cs -= cs . xxzz * cr . xyxy ; if ( cp . r == cf ) cs . rg = vec2 ( ce , cf ) ; if ( cp . g == cf ) cs . ba = vec2 ( ce , cf ) ; return cs ; } vec2 cw ( const in vec4 ct ) { vec2 cu ; vec2 cv = vec2 ( cf / cd , cf ) ; cu . r = dot ( ct . rg , cv ) ; cu . g = dot ( ct . ba , cv ) ; return cu ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"vec4 cF ( vec4 cE ) { return cE - floor ( cE * ( 1.0 / 289.0 ) ) * 289.0 ; } vec3 cF ( vec3 cG ) { return cG - floor ( cG * ( 1.0 / 289.0 ) ) * 289.0 ; } vec2 cF ( vec2 cH ) { return cH - floor ( cH * ( 1.0 / 289.0 ) ) * 289.0 ; } vec4 cJ ( vec4 cI ) { return cI - floor ( cI * ( 1.0 / 7.0 ) ) * 7.0 ; } vec4 cL ( vec4 cK ) { return cF ( ( 34.0 * cK + 5.0 ) * cK ) ; }".split(" ")},{type:"define",name:"K",b:["0.142857142857"]},{type:"define",
name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 cX ( vec2 cM ) { vec2 cN = cF ( floor ( cM ) ) ; vec2 cO = fract ( cM ) ; vec4 cP = cO . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 cQ = cO . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 cR = cL ( cN . x + vec4 ( 0.0 , 1.0 , 0.0 , 1.0 ) ) ; cR = cL ( cR + cN . y + vec4 ( 0.0 , 0.0 , 1.0 , 1.0 ) ) ; vec4 cS = cJ ( cR ) * K + K2 ; vec4 cT = cJ ( floor ( cR * K ) ) * K + K2 ; vec4 cU = cP + JITTER * cS ; vec4 cV = cQ + JITTER * cT ; vec4 cW = cU * cU + cV * cV ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"cW . xy = min ( cW . xy , cW . zw ) ; cW . x = min ( cW . x , cW . y ) ; return cW . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cW . xy = ( cW . x < cW . y ) ? cW . xy : cW . yx ; cW . xz = ( cW . x < cW . z ) ? cW . xz : cW . zx ; cW . xw = ( cW . x < cW . w ) ? cW . xw : cW . wx ; cW . y = min ( cW . y , cW . z ) ; cW . y = min ( cW . y , cW . w ) ; return sqrt ( cW . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 dl ( vec2 cY , float cZ ) { vec2 c_ = cF ( floor ( cY ) ) ; vec2 da = fract ( cY ) ; vec4 db = da . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 dc = da . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 dd = cL ( c_ . x + vec4 ( 0.0 , 1.0 , 0.0 , 1.0 ) ) ; dd = cL ( dd + c_ . y + vec4 ( 0.0 , 0.0 , 1.0 , 1.0 ) ) ; vec4 de = cJ ( dd ) * K + K2 ; vec4 df = cJ ( floor ( dd * K ) ) * K + K2 ; vec4 dg = db + JITTER * de ; vec4 dh = dc + JITTER * df ; vec4 di = dg * dg + dh * dh ; dg += cZ ; dh += cZ ; vec4 dj = dg * dg + dh * dh ; dg += cZ ; dh += cZ ; vec4 dk = dg * dg + dh * dh ; di . xy = min ( di . xy , di . zw ) ; di . x = min ( di . x , di . y ) ; dj . xy = min ( dj . xy , dj . zw ) ; dj . x = min ( dj . x , dj . y ) ; dk . xy = min ( dk . xy , dk . zw ) ; dk . x = min ( dk . x , dk . y ) ; return mat3 ( di . xx , 0.0 , dj . xx , 0.0 , dk . xx , 0.0 ) ; } vec3 dn ( vec3 dm ) { return cF ( ( ( dm * 34.0 ) + 1.0 ) * dm ) ; } float dC ( vec2 dp ) { const vec4 dq = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 dr = floor ( dp + dot ( dp , dq . yy ) ) ; vec2 ds = dp - dr + dot ( dr , dq . xx ) ; vec2 dt ; dt = ( ds . x > ds . y ) ? vec2 ( 1.0 , 0.0 ) : vec2 ( 0.0 , 1.0 ) ; vec4 du = ds . xyxy + dq . xxzz ; du . xy -= dt ; dr = cF ( dr ) ; vec3 dv = dn ( dn ( dr . y + vec3 ( 0.0 , dt . y , 1.0 ) ) + dr . x + vec3 ( 0.0 , dt . x , 1.0 ) ) ; vec3 dw = max ( 0.5 - vec3 ( dot ( ds , ds ) , dot ( du . xy , du . xy ) , dot ( du . zw , du . zw ) ) , 0.0 ) ; dw = dw * dw ; dw = dw * dw ; vec3 dx = 2.0 * fract ( dv * dq . www ) - 1.0 ; vec3 dy = abs ( dx ) - 0.5 ; vec3 dz = floor ( dx + 0.5 ) ; vec3 dA = dx - dz ; dw *= 1.79284291400159 - 0.85373472095314 * ( dA * dA + dy * dy ) ; vec3 dB ; dB . x = dA . x * ds . x + dy . x * ds . y ; dB . yz = dA . yz * du . xz + dy . yz * du . yw ; return 130.0 * dot ( dw , dB ) ; } vec2 dI ( vec2 dD ) { float dE = dot ( dD , vec2 ( 12.9898 , 78.233 ) ) ; float dF = dot ( dD , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float dG = fract ( sin ( dE ) * 43758.5453 ) * 2.0 - 1.0 ; float dH = fract ( sin ( dF ) * 43758.5453 ) * 2.0 - 1.0 ; return vec2 ( dG , dH ) ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","dJ",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"const float dK = 0.1 ; const float dL = 0.1 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mat4 dM = mat4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 , 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 , - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 , - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; mat4 dN = mat4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 , - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 , - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 , - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}}]},
{type:"textline",b:"float d_ ( vec3 dO , sampler2D dP , float dQ ) { float dR ; dO . z = clamp ( dO . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"dR = 0.0 ; float dS = dI ( dO . xy ) . x * M_PI ; float dT = cos ( dS ) ; float dU = sin ( dS ) ; mat2 dV = mat2 ( dT , dU , - dU , dT ) ; vec2 dW , dX ; for ( int dY = 0 ; dY < 4 ; dY ++ ) for ( int dZ = 0 ; dZ < 4 ; dZ ++ ) { dX . x = dM [ dY ] [ dZ ] ; dX . y = dN [ dY ] [ dZ ] ; dX = dV * dX ; dW = dO . xy + dX * dQ / SHADOW_TEX_RES ; dR += step ( dO . z , texture2D ( dP , dW ) . r ) ; } dR /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["dR","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( dR , 0.0 , 1.0 ) ; } float er ( vec3 ea , sampler2D eb , vec3 ec , sampler2D ed , float ee , float ef , float eg ) { float eh , ei ; ea . z = clamp ( ea . z , 0.0 , 1.0 ) ; ec . z = clamp ( ec . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"eh = 0.0 ; ei = 0.0 ; float ej = dI ( ea . xy ) . x * M_PI ; float ek = cos ( ej ) ; float el = sin ( ej ) ; mat2 em = mat2 ( ek , el , - el , ek ) ; vec2 en , eo ; for ( int ep = 0 ; ep < 4 ; ep ++ ) for ( int eq = 0 ; eq < 4 ; eq ++ ) { eo . x = dM [ ep ] [ eq ] ; eo . y = dN [ ep ] [ eq ] ; eo = em * eo ; en = ea . xy + eo * ee / SHADOW_TEX_RES ; eh += step ( ea . z , texture2D ( eb , en ) . r ) ; en = ec . xy + eo * ef / SHADOW_TEX_RES ; ei += step ( ec . z , texture2D ( ed , en ) . r ) ; } eh = mix ( eh , ei , eg ) ; eh /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["eh","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( eh , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"bool et ( vec2 es ) { return all ( lessThanEqual ( es , vec2 ( 1.0 ) ) ) && all ( greaterThanEqual ( es , vec2 ( 0.0 ) ) ) ; } float ex ( vec2 eu ) { float ev = min ( eu . x , eu . y ) ; float ew = min ( 1.0 - eu . x , 1.0 - eu . y ) ; return min ( ev , ew ) ; } float eA ( float ey , float ez ) { if ( ez >= 0.0 && ez <= dL ) ey = ( ey - 1.0 ) / dL * ez + 1.0 ; return ey ; } float eM ( vec3 eB , vec3 eC , sampler2D eD , sampler2D eE , float eF , float eG , float eH , float eI ) { float eJ ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"float eK = ex ( eB . xy ) ; if ( - eI > eH && eK >= 0.0 && eK <= dK && et ( eC . xy ) ) { float eL = 1.0 - eK / dK ; eJ = er ( eB , eD , eC , eE , eF , eG , eL ) ; } else".split(" ")}]}}]},{type:"textline",b:"eJ = d_ ( eB , eD , eF ) ; return eJ ; } float eU ( vec3 eN , sampler2D eO , float eP , float eQ , float eR ) { float eS = d_ ( eN , eO , eP ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - eR > eQ ) { float eT = ex ( eN . xy ) ; eS = eA ( eS , eT ) ; }".split(" ")}]}}]},{type:"textline",b:"return eS ; } float fa ( float eV ) { float eW = 1.0 ; vec3 eX = cy . xyz / cy . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"vec3 eY = cz . xyz / cz . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:"vec3 eZ = cA . xyz / cA . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"vec3 e_ = cB . xyz / cB . w ;".split(" ")}]}}]},{type:"textline",b:"if ( et ( eX . xy ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"eW = eM ( eX , eY , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , eV ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"eW = eU ( eX , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , eV ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( et ( eY . xy ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"eW = eM ( eY , eZ , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , eV ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eW = eU ( eY , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , eV ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( et ( eZ . xy ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"eW = eM ( eZ , e_ , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , eV ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eW = eU ( eZ , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , eV ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( et ( e_ . xy ) ) eW = eU ( e_ , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , eV ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","eW",";","}"]}]}}]}]}}]},{type:"textline",b:"float ff ( inout vec3 fb ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 fc = texture2DProj ( u_shadow_mask , cC ) . rg ; vec3 fd = vec3 ( fc . r ) ; float fe = fc . g ; dJ = vec4 ( fd , fe ) ; fb *= dJ . a ; return dJ . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return fa ( cD . z ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 fk ( vec3 fg , float fh , vec2 fi ) { vec2 fj = vec2 ( ( fg . x - fi . x ) / fh , - ( fg . z - fi . y ) / fh ) ; return fract ( fj ) ; } vec2 fo ( vec2 fl , float fm , vec2 fn ) { return vec2 ( fl . x * fm , - fl . y * fm ) + fn ; } c fp ( ) { return c ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } c fV ( vec3 fq , vec3 fr , vec3 fs , vec3 ft , vec3 fu , sampler2D fv , sampler2D fw , vec3 fx , float fy , vec3 fz , vec4 fA , mat4 fB ) { vec3 fC = i ( fA , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float fD = - fC . x ; float fE = - fC . z ; vec2 fF = vec2 ( fz . x + fy * ( - 1.0 - fD ) / 2.0 , fz . z + fy * ( 1.0 - fE ) / 2.0 ) ; vec2 fG = fk ( fu , fy , fF ) ; float fH = fy / 2.0 ; vec2 fI = abs ( fo ( fG - vec2 ( 0.5 ) , fy , vec2 ( 0.0 ) ) ) ; float fJ = fH * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( fI ) > fJ ) return fp ( ) ; float fK = fy / fx . z ; vec2 fL = ( fG - vec2 ( 0.5 ) ) * fK + vec2 ( 0.5 ) ; vec3 fM = fC * ( fy / fx . z - 1.0 ) / 2.0 ; fL . x += fM . x ; fL . y -= fM . z ; vec4 fN = texture2D ( fw , fL ) ; float fO = fN . r ; if ( fO < u_scale_threshold ) return fp ( ) ; float fP = fx . y - fx . x ; float fQ = fx . y - texture2D ( fv , fL ) . r * fP ; vec2 fR = fq . xz - fu . xz ; fu . xz = fo ( fG , fy , fF ) ; fu . y = fQ ; fq . xz = fu . xz + fR ; fq . y *= fO ; fq . y += fQ ; vec3 fS = fN . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"fq -= fu ; mat4 fT = _ ( fz , fu , fB ) ; c fU = ag ( fq , fu , fr , fs , ft , fT ) ; fU . b = fu ; fU . f = fS ; return r ( fU ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return r ( c ( fq , fu , fr , fs , ft , fS ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"vec4 ga ( mat4 fW , vec4 fX ) { vec2 fY = ( fW * u_v_light_matrix [ 3 ] ) . xy ; float fZ = SHADOW_TEX_RES / 2.0 ; fY = floor ( fY * fZ + 0.5 ) / fZ - fY ; vec4 f_ = fW * fX ; f_ . xy += fY ; f_ = u_b_light_matrix * f_ ; return f_ ; } void ge ( vec3 gb ) { vec3 gc = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ; vec4 gd = u_v_light_matrix * vec4 ( gb + u_normal_offset * gc , 1.0 ) ; cy = ga ( u_p_light_matrix0 , gd ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cz = ga ( u_p_light_matrix1 , gd ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cA = ga ( u_p_light_matrix2 , gd ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cB = ga ( u_p_light_matrix3 , gd ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void ge ( vec4 gf ) { float gg = gf . x ; float gh = gf . y ; float gi = gf . w ; cC . x = ( gg + gi ) / 2.0 ; cC . y = ( gh + gi ) / 2.0 ; cC . z = gi ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void gl ( inout vec3 gk ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"gk = max ( vec3 ( 0.0 ) , gk ) ; gk = pow ( gk , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gn ( inout vec3 gm ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"gm = max ( vec3 ( 0.0 ) , gm ) ; gm = pow ( gm , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gq ( inout vec3 go , in float gp ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"go = go * gp ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void gy ( inout vec3 gt , in float gu , in vec4 gv ) { float gw = gv . w * gu ; float gx = exp ( - gw * gw ) ; gx = clamp ( gx , 0.0 , 1.0 ) ; gt = mix ( gv . rgb , gt , gx ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 gF ( in mat4 gz , in vec3 gA ) { vec3 gB = mix ( gz [ 0 ] . rgb , gz [ 1 ] . rgb , max ( sign ( gA . x ) , 0.0 ) ) ; vec3 gC = mix ( gz [ 2 ] . rgb , gz [ 3 ] . rgb , max ( sign ( gA . z ) , 0.0 ) ) ; vec3 gD = vec3 ( gz [ 0 ] . a , gz [ 1 ] . a , gz [ 2 ] . a ) ; vec3 gE = mix ( gB , gC , abs ( gA . z ) ) ; gE = mix ( gE , gD , abs ( gA . y ) ) ; return gE ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void gH ( inout float gG ) { gG -= 0.5 ; gG = 4.0 * ( gG * gG * gG ) + 0.5 ; } void gY ( inout vec3 gI , in float gJ , in vec3 gK , in float gL , in vec4 gM , in vec4 gN , in float gO , in float gP ) { float gQ = gN . w * gJ ; float gR = exp ( - gQ * gQ ) ; gR = clamp ( gR , 0.0 , 1.0 ) ; float gS = max ( gK . y , 0.0 ) ; gJ = max ( gJ - max ( gL / gS , 0.0 ) , 0.0 ) ; float gT = gM . w * gJ ; float gU = 1.0 - gT ; gU = max ( gU , 0.0 ) ; gH ( gU ) ; gU += max ( gO - 0.5 , 0.0 ) ; if ( gU < gR ) { vec3 gV = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 gW = gM . rgb ; gL = clamp ( - gL * 0.03 , 0.0 , 0.8 ) ; vec3 gX = mix ( gW , gV , min ( gS , 1.0 ) ) ; gX = mix ( gX , vec3 ( 0.0 ) , gL ) * gP ; gI = mix ( gX , gI , gU ) ; } if ( gU >= gR ) { gI = mix ( gN . rgb , gI , gR ) ; } } void hg ( inout vec3 gZ , in float g_ , in float ha , in vec4 hb , in float hc ) { float hd = hb . w * g_ ; float he = 1.0 - hd ; he = clamp ( he , 0.0 , 1.0 ) ; gH ( he ) ; ha = clamp ( - ha * 0.03 , 0.0 , 0.8 ) ; vec3 hf = mix ( hb . rgb , vec3 ( 0.0 ) , ha ) * hc ; gZ = mix ( hf , gZ , he ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"struct hh { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float hp ( vec3 hi , vec3 hj , vec3 hk , vec4 hl , float hm ) { vec3 hn = normalize ( hi + hj ) ; float ho = hl [ 0 ] * max ( dot ( hk , hn ) , 0.0 ) + hl [ 1 ] ; return pow ( ho , hm ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hA ( vec3 hq , vec3 hr , vec3 hs , float ht ) { vec3 hu = normalize ( hq + hr ) ; float hv = max ( dot ( hs , hu ) , 0.001 ) ; float hw = max ( dot ( hs , hr ) , 0.01 ) ; float hx = max ( dot ( hs , hq ) , 0.01 ) ; float hy = tan ( acos ( hv ) ) ; float hz = max ( ht , 0.001 ) ; return hx * ( 1.0 / ( 4.0 * M_PI * hz * hz ) ) * ( exp ( - ( hy * hy ) / ( hz * hz ) ) / ( sqrt ( hw * hx ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hI ( vec3 hB , vec3 hC , vec3 hD , float hE , float hF ) { vec3 hG = normalize ( hB + hC ) ; float hH = acos ( dot ( hG , hD ) ) ; if ( hH < hE ) return 1.0 ; else if ( hH >= hE + hF || hF == 0.0 ) return 0.0 ; else return 1.0 - ( hH - hE ) / hF ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void ib ( float hJ , vec3 hK , vec3 hL , vec3 hM , float hN , inout float hO ) { if ( hN > 0.0 ) { float hP = max ( dot ( hK , hM ) , 0.0 ) ; float hQ = hN * hN ; float hR = 1.0 - 0.5 * ( hQ / ( hQ + 0.33 ) ) ; vec3 hS = hL - hJ * hK ; vec3 hT = hM - hP * hK ; if ( length ( hS ) == 0.0 || length ( hT ) == 0.0 || abs ( hJ ) > 1.0 || abs ( hP ) > 1.0 ) hO = hO * hR ; else { float hU = acos ( hJ ) ; float hV = acos ( hP ) ; vec3 hW = normalize ( hS ) ; vec3 hX = normalize ( hT ) ; float hY , hZ ; hY = max ( hU , hV ) ; hZ = min ( hU , hV ) ; hZ *= 0.95 ; float h_ = max ( dot ( hW , hX ) , 0.0 ) ; float ia = 0.45 * ( hQ / ( hQ + 0.09 ) ) ; hO = hO * ( hR + ( ia * h_ * sin ( hY ) * tan ( hZ ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void ij ( vec3 ic , vec3 id , float ie , float ig , out float ih ) { float ii ; if ( ie == 0.0 ) { ih = 1.0 ; } else { ii = 1.0 + abs ( dot ( id , ic ) ) ; ii = ig + ( 1.0 - ig ) * pow ( ii , ie ) ; ih = clamp ( ii , 0.0 , 1.0 ) ; } }".split(" ")}]}}]},{type:"textline",b:"void iS ( inout hh ik , vec3 il , vec3 im , vec3 io , vec3 ip , vec3 iq , vec2 ir , vec2 is , float it , vec3 iu , vec3 iv , vec3 iw , vec4 ix , vec4 iy , float iz , vec4 iA ) { vec3 iB = vec3 ( 0.0 ) ; vec3 iC = iw * it ; float iD = iy . z ; if ( iD != - 1.0 ) { iB = iu - io ; float iE = length ( iB ) ; iC *= iD / ( iD + iE * iE ) ; iB = normalize ( iB ) ; float iF = iy . x ; float iG = iy . y ; if ( iF > - 1.0 ) { float iH = dot ( iB , iv ) ; iH *= smoothstep ( 0.0 , 1.0 , ( iH - iF ) / iG ) ; iC *= iH ; } } else iB = iv ; float iI ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"ij ( ip , iB , is [ 0 ] , is [ 1 ] , iI ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float iJ = max ( dot ( ip , iB ) , 0.0 ) ; iI = ix [ 0 ] * iJ + ix [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"ib ( iJ , ip , iB , iq , is [ 0 ] , iI ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float iK = hp ( iB , iq , ip , ix , ir [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float iK = hA ( iB , iq , ip , ir [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float iK = hI ( iB , iq , ip , ir [ 0 ] , ir [ 1 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["float","iK","=","0.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( iB , ip ) * dot ( iq , ip ) < 0.0 ) { float iL = iA . x ; float iM = iA . y ; float iN = iA . z ; float iO = iA . w ; float iP = clamp ( abs ( dot ( iB , ip ) ) , 0.0 , 1.0 ) ; float iQ = clamp ( dot ( iq , - iB ) , 0.0 , 1.0 ) ; float iR = pow ( iQ , iM ) ; ik . a += iz * vec4 ( iC * iP * pow ( il , vec3 ( iL ) ) , 1.0 ) ; ik . a += iN * mix ( vec4 ( il , 1.0 ) , vec4 ( 1.0 ) , iO ) * iz * vec4 ( iC * iP * vec3 ( iR ) , 1.0 ) ; } else { ik . b += iC * im * iK ; ik . a += vec4 ( iC * il * iI , iK ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ik . b += iC * im * iK ; ik . a += vec4 ( iC * il * iI , iK ) ;".split(" ")}]}}]},{type:"textline",b:"} hh jE ( vec3 iT , vec3 iU , vec3 iV , vec3 iW , vec3 iX , vec3 iY , vec3 iZ , vec2 i_ , vec2 ja , float jb , vec3 jc [ NUM_LIGHTS ] , vec3 jd [ NUM_LIGHTS ] , vec3 je [ NUM_LIGHTS ] , vec4 jf [ NUM_LIGHTS ] , vec4 jg [ NUM_LIGHTS ] , float jh , vec4 ji ) { hh jj ; jj . a = vec4 ( iT + iV * iU , 0.0 ) ; jj . b = vec3 ( 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"iS ( jj , iV , iW , iX , iY , iZ , i_ , ja , jb , jc [ 0 ] , jd [ 0 ] , je [ 0 ] , jf [ 0 ] , jg [ 0 ] , jh , ji ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","1"],group:{type:"group",a:[{type:"textline",b:"iS ( jj , iV , iW , iX , iY , iZ , i_ , ja , jb , jc [ 1 ] , jd [ 1 ] , je [ 1 ] , jf [ 1 ] , jg [ 1 ] , jh , ji ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","2"],group:{type:"group",a:[{type:"textline",b:"iS ( jj , iV , iW , iX , iY , iZ , i_ , ja , jb , jc [ 2 ] , jd [ 2 ] , je [ 2 ] , jf [ 2 ] , jg [ 2 ] , jh , ji ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","3"],group:{type:"group",a:[{type:"textline",b:"iS ( jj , iV , iW , iX , iY , iZ , i_ , ja , jb , jc [ 3 ] , jd [ 3 ] , je [ 3 ] , jf [ 3 ] , jg [ 3 ] , jh , ji ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"for ( int jk = 0 ; jk < NUM_LIGHTS ; jk ++ ) { vec4 jl = jf [ jk ] ; vec4 jm = jg [ jk ] ; if ( jl [ 3 ] + jm [ 3 ] != 0.0 ) { vec3 jn = vec3 ( 0.0 ) ; vec3 jo = je [ jk ] ; jo *= jb ; float jp = jm . z ; if ( jp != - 1.0 ) { jn = jc [ jk ] - iX ; float jq = length ( jn ) ; jo *= jp / ( jp + jq * jq ) ; jn = normalize ( jn ) ; float jr = jm . x ; float js = jm . y ; if ( jr > - 1.0 ) { float jt = dot ( jn , jd [ jk ] ) ; jt *= smoothstep ( 0.0 , 1.0 , ( jt - jr ) / js ) ; jo *= jt ; } } else jn = jd [ jk ] ; float ju = 0.0 ; if ( jl [ 3 ] != 0.0 ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"ij ( iY , jn , ja [ 0 ] , ja [ 1 ] , ju ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float jv = max ( dot ( iY , jn ) , 0.0 ) ; ju = jl [ 0 ] * jv + jl [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"ib ( jv , iY , jn , iZ , ja [ 0 ] , ju ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float jw = 0.0 ; if ( jm [ 3 ] != 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"jw = hp ( jn , iZ , iY , jl , i_ [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"jw = hA ( jn , iZ , iY , i_ [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"jw = hI ( jn , iZ , iY , i_ [ 0 ] , i_ [ 1 ] ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( jn , iY ) * dot ( iZ , iY ) < 0.0 ) { float jx = ji . x ; float jy = ji . y ; float jz = ji . z ; float jA = ji . w ; float jB = clamp ( abs ( dot ( jn , iY ) ) , 0.0 , 1.0 ) ; float jC = clamp ( dot ( iZ , - jn ) , 0.0 , 1.0 ) ; float jD = pow ( jC , jy ) ; jj . a += jh * vec4 ( jo * jB * pow ( iV , vec3 ( jx ) ) , 1.0 ) ; jj . a += jz * mix ( vec4 ( iV , 1.0 ) , vec4 ( 1.0 ) , jA ) * jh * vec4 ( jo * jB * vec3 ( jD ) , 1.0 ) ; } else { jj . b += jo * iW * jw ; jj . a += vec4 ( jo * iV * ju , jw ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"jj . b += jo * iW * jw ; jj . a += vec4 ( jo * iV * ju , jw ) ;".split(" ")}]}}]},{type:"textline",b:["}","}"]}]}}]},{type:"textline",b:["return","jj",";","}"]}]};a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void ke ( inout vec3 jF , float jG , float jH , float jI , vec3 jJ , vec3 jK , vec3 jL , vec4 jM , vec3 jN , float jO ) { if ( jO > CAUSTICS_VIEW_DISTANCE ) return ; vec4 jP = jM ; vec3 jQ = jN + jJ ; jQ . xz = 10.0 * sin ( 0.1 * jQ . xz ) ; vec3 jR = jQ + 2.0 * cross ( - jP . xyz , cross ( - jP . xyz , jQ ) + jP . w * jQ ) ; vec2 jS = jR . xz ; vec3 jT = jK ; float jU = max ( dot ( jJ , jT ) , 0.0 ) ; float jV = 0.025 ; jS . s += 0.5 * sin ( dot ( jN + jH , vec3 ( 1.0 ) ) ) ; jS . t += 0.7 * ( - sin ( dot ( jN - jH , vec3 ( - 0.7 ) ) ) ) ; jS . st += 0.23 * cos ( 4.0 * jG - CAUST_SPEED . x * jH ) ; jS . st += 3.0 * sin ( jG - 0.3 * CAUST_SPEED . y * jH ) ; float jW = CAUST_SCALE * ( 1.0 + max ( 0.1 * jG , 0.0 ) ) ; mat3 jX = dl ( ( jS / jW ) , jV ) ; float jY = ( jX * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; float jZ = ( jX * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; float j_ = ( jX * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; vec3 ka = CAUST_BRIGHT * vec3 ( jY , jZ , j_ ) ; float kb = jI * jU ; float kc = max ( sign ( jG ) , 0.0 ) ; kb = min ( kb + 0.5 * sign ( - jJ . y ) * kc , 1.0 ) ; kb *= 1.0 - kc * ( 0.1 * jG ) ; ka *= kb ; ka *= ka ; float kd = min ( - jG + 10.0 , 1.0 ) ; jF += max ( ( 2.0 * jL * ka ) * kd , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float ks ( in vec3 kl , in vec3 km , in float kn , in float ko ) { vec3 kp = normalize ( km + kl ) ; float kq = 1.0 - dot ( kl , kp ) ; float kr = ko + ( 1.0 - ko ) * pow ( kq , kn ) ; return kr ; } void kH ( inout vec3 kt , in vec3 ku , in vec3 kv , in float kw , in float kx , in float ky ) { vec3 kz = reflect ( - ku , kv ) ; float kA = 1.0 ; if ( kw != 0.0 ) kA = ks ( ku , kz , kw , kx ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 kB = u_refl_plane . xyz * dot ( kv , u_refl_plane . xyz ) ; vec3 kC = kv - kB ; vec2 kD = ( u_view_matrix_frag * vec4 ( kC , 0.0 ) ) . xy ; vec2 kE = cC . xy / cC . z ; kE += kD * REFL_BUMP ; vec3 kF = texture2D ( u_reflectmap , kE ) . rgb ; gl ( kF . rgb ) ; kt = mix ( kt , kF , ky * kA ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"vec3 kG = textureCube ( u_mirrormap , kz ) . xyz ; gl ( kG . rgb ) ; kt = mix ( kt , kG , u_mirror_factor * kA ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float kN ( in float kI , inout vec2 kJ , in vec2 kK ) { vec4 kL = texture2D ( u_scene_depth , kJ ) ; float kM = co ( kL ) ; if ( kM < kk ) { kJ = kK ; return kI ; } else { return kM ; } return kI ; } vec3 kV ( in vec3 kO , in vec2 kP ) { vec2 kQ = kO . xy / kO . z ; vec2 kR = kQ + kP ; vec4 kS = texture2DProj ( u_scene_depth , kO ) ; float kT = co ( kS ) ; kN ( kT , kR , kQ ) ; vec3 kU = texture2D ( u_refractmap , kR ) . rgb ; gl ( kU ) ; return kU ; }".split(" ")}]}}]}]};
a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct ma { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mh ( inout float mb , float mc , vec2 md , vec2 me ) { float mf = me . x - md . x ; float mg = ( mc - md . x ) / mf ; mb = mix ( mb , me . y , clamp ( mg , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mo ( inout vec3 mi , float mj , vec4 mk , vec4 ml ) { float mm = ml . x - mk . x ; float mn = ( mj - mk . x ) / mm ; mi = mix ( mi , ml . yzw , clamp ( mn , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float mv ( float mp , float mq , vec2 mr [ SIZE_RAMP_LENGTH ] ) { float ms = mp / mq ; float mt = mr [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mh ( mt , ms , mr [ 0 ] , mr [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mh ( mt , ms , mr [ 1 ] , mr [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mh ( mt , ms , mr [ 2 ] , mr [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mu = 1 ; mu < SIZE_RAMP_LENGTH ; mu ++ ) mh ( mt , ms , mr [ mu - 1 ] , mr [ mu ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mt",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 mC ( float mw , float mx , vec4 my [ COLOR_RAMP_LENGTH ] ) { float mz = mw / mx ; vec3 mA = my [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mo ( mA , mz , my [ 0 ] , my [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mo ( mA , mz , my [ 1 ] , my [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mo ( mA , mz , my [ 2 ] , my [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mB = 1 ; mB < COLOR_RAMP_LENGTH ; mB ++ ) mo ( mA , mz , my [ mB - 1 ] , my [ mB ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mA",";","}"]}]}}]},{type:"textline",b:"float mL ( float mD , float mE , float mF , float mG ) { float mH = max ( 0.01 , min ( mE , mF ) ) ; float mI = max ( 0.01 , min ( mE , mG ) ) ; float mJ = mE - mI ; float mK = clamp ( mD / mH , 0.0 , 1.0 ) - step ( mJ , mD ) * ( mD - mJ ) / mI ; return mK ; } ma mR ( ) { ma mM ; float mN ; if ( u_p_cyclic == 1 ) { mN = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( mN < 0.0 ) mN += u_p_length ; } if ( u_p_cyclic != 1 ) { mN = u_p_time - a_p_delay ; } if ( mN < 0.0 || mN >= a_p_lifetime ) { mM . a = 0.0001 ; mM . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( mN < 0.0 || mN >= a_p_lifetime ) ) { vec3 mO = a_position ; vec3 mP = a_normal ; mO += u_p_nfactor * mN * mP ; mO += a_p_vels . xyz * mN ; mO . y -= u_p_gravity * mN * mN / 2.0 ; float mQ = max ( u_p_mass , EPSILON ) ; mO += ( u_p_wind / mQ ) * mN * mN / 2.0 ; mM . b = mO ; mM . e = a_p_vels . w * mN ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mM . a = mv ( mN , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mM . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mM . d = mC ( mN , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mM . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"mM . c = mL ( mN , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return mM ; }".split(" ")}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float nd ( in sampler2D mX , in vec2 mY , in vec2 mZ ) { float m_ = texture2D ( mX , mY ) . r ; float na = mZ . x ; float nb = mZ . y ; float nc = 2.0 * na / ( na + nb - ( 2.0 * m_ - 1.0 ) * ( nb - na ) ) ; return nc ; }".split(" ")}]}};b4w.module.__geometry=function(a,m){function b(a){return 65536<a.A?L.Tn()?!1:!0:!1}function c(a){return 0<a.V.length?!0:!1}function h(a,b,c){c||v.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.A*(b||1)+", will use drawArrays","color: #aa0");b=a.V;c=a.A;var e=a.u,g=a.q,f;for(f in e){var p=e[f],h=t(p,c);e[f]=d(b,p,h)}for(e=0;e<g.length;e++){var r=g[e];for(f in r)p=r[f],h=t(p,c),r[f]=d(b,p,h)}a.A=b.length;a.V=new Uint16Array(0);return a}function d(a,b,c){if(0==b.length)return new Float32Array(0);
for(var e=new Float32Array(a.length*c),d=0;d<a.length;d++)for(var g=a[d],f=0;f<c;f++)e[c*d+f]=b[c*g+f];return e}function l(a,b){var c=a.Rc,e=a.Gb[b];if(e)return c.subarray(e.offset,e.offset+e.length);throw"extract_array() failed; invalid name: "+b;}function k(b,c){var e,d;switch(c){case a.Pg:case a.bi:e=G.TRIANGLES;d=G.STATIC_DRAW;break;case a.jm:e=G.POINTS;d=G.STATIC_DRAW;break;case a.im:e=G.TRIANGLES;d=G.DYNAMIC_DRAW;break;case a.Kq:e=G.POINTS;d=G.DYNAMIC_DRAW;break;case a.Lq:e=G.LINES;d=G.STATIC_DRAW;
break;default:throw"Wrong draw_mode";}b.mode=e;b.Vh=d}function g(a){a.Pd?(a.od||(a.od=G.createBuffer()),G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,a.od),G.bufferData(G.ELEMENT_ARRAY_BUFFER,a.Pd,a.Vh),a.Ai=a.Pd.byteLength):a.Ai=0;a.zf||(a.zf=G.createBuffer());G.bindBuffer(G.ARRAY_BUFFER,a.zf);G.bufferData(G.ARRAY_BUFFER,a.Rc,a.Vh);a.zn=a.Rc.byteLength}function e(a){for(var b=A.gb("JOIN_"+a.length+"_SUBMESHES"),c=0,e=0;e<a.length;e++)c+=a[e].V.length;b.V=new Uint32Array(c);for(e=c=0;e<a.length;e++)c+=a[e].A;
b.A=c;var d=a[0],g;for(g in d.u){for(e=c=0;e<a.length;e++)c+=a[e].u[g].length;b.u[g]=new Float32Array(c)}for(g in d.q[0]){for(e=c=0;e<a.length;e++)c+=a[e].q[0][g].length;for(e=0;e<d.q.length;e++)b.q[e]=b.q[e]||{},b.q[e][g]=new Float32Array(c)}for(d=e=c=0;d<a.length;d++){g=a[d];for(var f=g.V,p=g.A,h=g.u,r=0;r<f.length;r++)b.V[c+r]=f[r]+e;var c=c+f.length,k;for(k in h){var f=h[k],s=e*t(f,p);b.u[k].set(f,s)}for(r=0;r<g.q.length;r++){var h=g.q[r],q=b.q[r];for(k in h)f=h[k],s=e*t(f,p),q[k].set(f,s)}e+=
p}return b}function n(a,b,c,e,d,g){var p=A.gb("SUBMESH_"+a.name+"_"+b);b=a.submeshes[b];var r=b.base_length;p.A=r;var k=z(c,"a_texcoord")?new Float32Array(b.texcoord):new Float32Array(0),s,q=b.group;if(z(c,"a_influence")&&e){s=new Float32Array(4*r);for(var n=q.length/r,l=new Float32Array(n),C=0;C<n;C++){l[C]=-1;for(var x in e){var R=e[x];if(R.zq===C){l[C]=R.eh;break}}}var w=3<n?n:4;e=new Float32Array(w);x=new Uint32Array(w);for(var C=new Float32Array(4),R=new Float32Array(w),w=new Uint32Array(w),
u=new Float32Array(4),T=0;T<r;T++)e.set(R),x.set(w),C.set(u),s.set(f(q,n,T,r,l,e,x,C),4*T)}else s=new Float32Array(0);q=d?A.sa(d):{};q.a_color={Te:!0};q.a_color.src=z(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,ec:7}]:[];d={a_texcoord:k,a_influence:s};k=b.vertex_colors;s=b.color;n=a.name;l=[];for(e=0;e<k.length;e++)l.push(k[e].name);for(var B in q)if(e=q[B].src,e.length){for(C=x=0;C<e.length;C++)x+=A.tf(e[C].ec);d[B]=new Float32Array(x*r);for(C=R=0;C<e.length;C++){var t=e[C].name,w=
e[C].ec,u=A.Dp(w),y=l.indexOf(t);if(-1==y)throw'B4W Error: vertex color "'+t+'" for mesh "'+n+'" not found.';var T=k[y].mask,H=A.tf(T);(w&T)!==w&&v.error("B4W Error: Wrong color extraction from "+t+" to "+B+".");for(var ca=t=0;ca<y;ca++)t+=A.tf(k[ca].mask);y=t*r;for(t=0;t<r;t++)for(ca=0;3>ca;ca++)u[ca]&&(d[B][t*x+(R+A.Ph(w,ca))]=s[y+t*H+A.Ph(T,ca)]);R+=H}}else d[B]=new Float32Array(0);B=a.uv_textures;q=b.texcoord;k=b.texcoord2;a=a.name;if(g)for(var G in g){s=B.indexOf(G);if(-1==s)throw'B4W Error: uv map "'+
G+'" for mesh "'+a+'" not found';if(0==s)var L=new Float32Array(q);else 1==s&&(L=new Float32Array(k));d[g[G]]=L}p.u=d;p.V=new Uint32Array(b.indices);G=b.position.length/r/3;a=(L=z(c,"a_normal")&&b.normal.length?!0:!1)&&z(c,"a_tangent")&&b.tangent.length?!0:!1;for(B=0;B<G;B++)g={},d=new Float32Array(3*r),q=new Float32Array(L?3*r:0),k=new Float32Array(a?4*r:0),s=B*r*3,n=s+3*r,d.set(b.position.subarray(s,n),0),L&&(s=B*r*3,n=s+3*r,q.set(b.normal.subarray(s,n),0)),a&&(s=B*r*4,n=s+4*r,k.set(b.tangent.subarray(s,
n),0)),g.a_position=d,g.a_normal=q,g.a_tangent=k,p.q.push(g);if(1<G){b=p.q[0];g={};for(var m in b)g[m]=new Float32Array(b[m]);p.q.push(g)}z(c,"a_polyindex")&&(h(p,1,!0),p.u.a_polyindex=F(p));return p}function z(a,b){return-1<a.indexOf(b)?!0:!1}function f(a,b,c,e,d,g,f,p){for(var h=!0,r=0;r<b;r++){var k=a[r*e+c];if(-1!==k){var q=d[r];-1!==q&&(g[r]=k,f[r]=q,h=!1)}}if(h)return p;s(g,f,!1);for(r=a=0;4>r;r++)a+=g[r];if(.01>a)return p;for(r=0;4>r;r++)g[r]/=a;if(.01>Math.abs(g[0]-1))p[0]=f[0]+1;else for(r=
0;4>r;r++)p[r]=f[r]+g[r];return p}function t(a,b){if(0==b)return 0;var c=a.length,e=c/b;if(e!=Math.floor(e))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return e}function s(a,b,c){var e=a.length,d=e,g=!1;for(c=c?-1:1;1<d||g;){1<d&&(d=Math.floor(d/1.247330950103979));for(var g=!1,f=0;d+f<e;f++)0>c*(a[f]-a[f+d])&&(g=a[f],a[f]=a[f+d],a[f+d]=g,g=b[f],b[f]=b[f+d],b[f+d]=g,g=!0)}}function r(a,b,c){var e=[],d=[];I.subtract(b,a,e);I.subtract(c,a,d);I.normalize(e,
e);I.normalize(d,d);return Math.acos(I.dot(e,d))}function p(a,b,e){b||(b=[]);e=e?a.q[0].a_normal:a.q[0].a_position;if(c(a)){a=a.V;for(var d=a.length/3,g=0;g<d;g++){var f=new Float32Array(9),p=a[3*g];f[0]=e[3*p];f[1]=e[3*p+1];f[2]=e[3*p+2];p=a[3*g+1];f[3]=e[3*p];f[4]=e[3*p+1];f[5]=e[3*p+2];p=a[3*g+2];f[6]=e[3*p];f[7]=e[3*p+1];f[8]=e[3*p+2];b[g]=f}}else for(g=0;g<e.length;g++)f=new Float32Array(9),f[0]=e[9*g],f[1]=e[9*g+1],f[2]=e[9*g+2],f[3]=e[9*g+3],f[4]=e[9*g+4],f[5]=e[9*g+5],f[6]=e[9*g+6],f[7]=e[9*
g+7],f[8]=e[9*g+8],b[g]=f;return b}function F(a){for(var b=new Float32Array(a.A),c=0;c<a.A;c++)b[c]=c%3;return b}function q(a,b,c){var e=I.dist(a,b);a=I.dist(a,c);b=I.dist(b,c);c=(e+a+b)/2;return c*(c-e)*(c-a)*(c-b)}var v=m("__print"),x=m("__tsr"),A=m("__util"),L=m("__extensions"),I=m("vec3"),y=new Float32Array(3),C=new Float32Array(3),B=new Float32Array(3);a.Vc=10;a.rm=20;a.Jy=30;a.bi=10;a.jm=20;a.im=30;a.Kq=40;a.Lq=50;a.Pg=a.bi;var G=null;a.tc=function(a){G=a};a.lz=function(a){var b=_buffers[a];
G.deleteBuffer(b.od);G.deleteBuffer(b.zf);delete _buffers[a]};a.Ax=function(e,d,f,p){b(e)&&c(e)&&h(e);var r=e.V,s=e.A,q=e.q,n={},l;for(l in e.u)l in p&&!p[l].Te||(n[l]=e.u[l]);p={Pd:null,Rc:null,Uk:0,count:0,Gb:{},mode:0,Vh:0,Ai:0,zn:0,zf:null,od:null,Pi:null};if(r.length)if(l=r.length,65536>=s)var v=new Uint16Array(r),C=G.UNSIGNED_SHORT;else v=new Uint32Array(r),C=G.UNSIGNED_INT;else l=s,v=null;var A=0,x=q.length,B;for(B in q[0])var F=q[0][B],A=A+F.length*x;for(B in n)F=n[B],A+=F.length;B=new Float32Array(A);
var A=0,x={},R;for(R in n){var w=n[R];if(F=w.length)B.set(w,A),x[R]={Ry:R,Ec:t(w,s),offset:A,frames:1,length:F},A+=F}n=q.length;for(R in q[0])if(w=q[0][R],F=w.length,w=t(w,s),F){x[R]={Ec:w,offset:A,frames:n,length:F};1<n&&(x[R+"_next"]={Ec:w,offset:A+F,frames:n,length:F});for(var u=0;u<n;u++)w=q[u][R],B.set(w,A),A+=F}p.count=l;p.Pd=v;p.Rc=B;p.Uk=C;p.Gb=x;k(p,f);g(p);d!=a.Vc&&c(e)&&(p.Pi={Uv:new Float32Array(r.length),Vv:new Float32Array(r.length),bu:new Float32Array(r.length/3),type:d});return p};
a.Fv=b;a.Ev=c;a.eq=h;a.Rx=function(a,b,c){k(a,b);a.count=c.length;a.Pd=c;a.Uk=c instanceof Uint16Array?G.UNSIGNED_SHORT:G.UNSIGNED_INT};a.Gj=function(a,b,c,e){var d=a.Rc,f=a.Gb,p=f[b];if(p){if(c&&p.Ec!=c)throw'Error: invalid num_comp for "'+b+'"';d.set(e,p.offset)}else d=d.length,p=new Float32Array(d+e.length),p.set(a.Rc),p.set(e,d),a.Rc=p,f[b]={Ec:c,offset:d};g(a)};a.ju=l;a.mA=function(a){a.Vh=G.STATIC_DRAW};a.Ov=function(a){a.Vh=G.DYNAMIC_DRAW};a.Vx=g;a.gn=function(a){a.od&&G.deleteBuffer(a.od);
a.zf&&G.deleteBuffer(a.zf)};a.ro=function(a,b){return a.submeshes[b].base_length?!1:!0};a.dq=function(a,b){for(var c=0;c<a.q.length;c++){var e=a.q[c].a_position;x.Gg(e,b,e,0);e=a.q[c].a_normal;0<e.length&&x.Dj(e,b,e,0);e=a.q[c].a_tangent;0<e.length&&x.mq(e,b,e,0)}(c=a.u.au_center_pos)&&c.length&&x.Gg(c,b,c,0);return a};a.yx=function(a,b){var c=a.u.au_center_pos;if(c&&c.length){var e=new Float32Array(c);x.Gg(e,b,e,0);for(var d=0;d<a.q.length;d++)for(var g=0;g<e.length;g++)a.q[d].a_position[g]+=e[g]-
c[g];c.set(e)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.xx=function(a,b){var c=a.A,e;for(e in b){var d=b[e].length;a.u[e]=new Float32Array(d*c);for(var g=0;g<c;g++)for(var f=0;f<d;f++)a.u[e][g*d+f]=b[e][f]}};a.zx=e;a.Nv=function(a,b,c){if(!a.A)return A.gb("EMPTY");var e=c.length;65536<a.A*e&&!L.Tn()&&h(a,e);var d=a.V,g=a.A,f=a.u;a=a.q;for(var p in b){var r=b[p].length,k=r*g;f[p]=new Float32Array(k);for(var s=0;s<g;s++)for(k=0;k<r;k++)f[p][s*r+k]=b[p][k]}b=A.gb("CLONE_"+
e+"_SUBMESHES");b.A=g*e;b.V=new Uint32Array(d.length*e);for(s=0;s<e;s++)for(r=d.length*s,p=g*s,k=0;k<d.length;k++)b.V[r+k]=d[k]+p;for(var q in f)for(d=f[q],k=d.length*e,r=t(d,g),b.u[q]=new Float32Array(k),s=0;s<e;s++)p=g*r*s,b.u[q].set(d,p);for(q in a[0])for(s=0;s<a.length;s++)for(d=a[s][q],k=d.length*e,r=t(d,g),b.q[s]=b.q[s]||{},b.q[s][q]=new Float32Array(k),k=0;k<e;k++)switch(f=c[k],p=g*r*k,q){case "a_position":x.Gg(d,f,b.q[s][q],p);break;case "a_normal":x.Dj(d,f,b.q[s][q],p);break;case "a_tangent":x.mq(d,
f,b.q[s][q],p);break;default:throw"Wrong attribute name: "+q;}return b};a.Hn=n;a.mu=function(a){var b=a.A,c=a.q[0].a_position,e=new Float32Array(12*b),d=new Float32Array(8*b);a=new Uint16Array(4*a.V.length);for(var g=0;g<b;g++)e[12*g]=c[3*g],e[12*g+1]=c[3*g+1],e[12*g+2]=c[3*g+2],e[12*g+3]=c[3*g],e[12*g+4]=c[3*g+1],e[12*g+5]=c[3*g+2],e[12*g+6]=c[3*g],e[12*g+7]=c[3*g+1],e[12*g+8]=c[3*g+2],e[12*g+9]=c[3*g],e[12*g+10]=c[3*g+1],e[12*g+11]=c[3*g+2],d[8*g]=-.5,d[8*g+1]=-.5,d[8*g+2]=-.5,d[8*g+3]=.5,d[8*g+
4]=.5,d[8*g+5]=.5,d[8*g+6]=.5,d[8*g+7]=-.5,a[6*g]=4*g+2,a[6*g+1]=4*g+1,a[6*g+2]=4*g,a[6*g+3]=4*g+2,a[6*g+4]=4*g,a[6*g+5]=4*g+3;c=A.gb("HALO");c.q=[];c.q[0]={};c.A=4*b;c.q[0].a_position=e;c.u.a_halo_bb_vertex=d;c.V=a;return c};a.pv=z;a.ou=function(a){for(var b=["a_position","a_normal"],c=[],d=0;d<a.submeshes.length;d++){var g=n(a,d,b,null,null,null);g.A&&c.push(g)}return 0==c.length?A.gb("EMPTY"):1==c.length?c[0]:e(c)};a.Qx=function(a,b,c){for(var e=a.Pd,d=l(a,"a_position"),g=a.Pi,f=g.Uv,p=g.Vv,g=
g.bu,h=e,r=h.length/3,k=0;k<r;k++){var s=h[3*k],q=h[3*k+1],n=h[3*k+2],v=d[3*s+1],R=d[3*s+2],w=d[3*q+1],u=d[3*q+2],T=d[3*n+1],C=d[3*n+2];f[3*k]=(d[3*s]+d[3*q]+d[3*n])/3;f[3*k+1]=(v+w+T)/3;f[3*k+2]=(R+u+C)/3}A.rf(f,b,p);b=f.length/3;for(d=0;d<b;d++)p=f[3*d]-c[0],h=f[3*d+1]-c[1],r=f[3*d+2]-c[2],g[d]=p*p+h*h+r*r;c=e;e=g.length;if(!(2>e))for(f=e,d=!1;1<f||d;)for(1<f&&(f=Math.floor(f/1.247330950103979)),d=!1,b=0;f+b<e;b++)0>g[b]-g[b+f]&&(d=g[b],g[b]=g[b+f],g[b+f]=d,d=c,p=b,h=b+f,r=d[3*p],k=d[3*p+1],s=d[3*
p+2],d[3*p]=d[3*h],d[3*p+1]=d[3*h+1],d[3*p+2]=d[3*h+2],d[3*h]=r,d[3*h+1]=k,d[3*h+2]=s,d=!0);e=c;G.bindBuffer(G.ELEMENT_ARRAY_BUFFER,a.od);G.bufferData(G.ELEMENT_ARRAY_BUFFER,e,G.DYNAMIC_DRAW)};a.ix=s;a.Um=function(a,b,c){for(var e=b.length/3,d=a.length/3,g=[],f=Array(3),p=Array(3),h=Array(3),k=0;k<d;k++){for(var s=a[3*k],q=a[3*k+1],n=a[3*k+2],l=0;3>l;l++)f[l]=b[3*s+l],p[l]=b[3*q+l],h[l]=b[3*n+l];if(c)var l=r(f,p,h),v=r(p,h,f),R=Math.PI-l-v;else R=v=l=1;var w=g,u;u=f;var T=h,C=[],A=[],x=[];I.subtract(p,
u,C);I.subtract(T,u,A);I.cross(C,A,x);I.normalize(x,x);u=x;for(T=0;3>T;T++)C=3*q+T,A=3*n+T,w[3*s+T]=l*u[T],w[C]=v*u[T],w[A]=R*u[T]}if(c)for(var H in c)for(k=c[H],a=0;3>a;a++){b=3*k[0]+a;for(d=1;d<k.length;d++)f=3*k[d]+a,g[b]+=g[f];for(d=1;d<k.length;d++)f=3*k[d]+a,g[f]=g[b]}for(k=0;k<e;k++){c=k;H=g;a=new Float32Array(3);for(b=0;3>b;b++)d=3*c+b,a[b]=H[d];I.normalize(a,a);for(b=0;3>b;b++)d=3*c+b,H[d]=a[b]}return g};a.Wm=function(a,b,c){for(var e={},d=b.length/3,g=0;g<d;g++){var f=String(b[3*g])+String(b[3*
g+1])+String(b[3*g+2]);e[f]=[]}d=a.length;for(g=0;g<d;g++)b=a[g],f=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),f in e&&e[f].push(b);return e};a.Ok=function(a,b,c,e){var d=p(a,null,!1);if(c)var g=p(a,null,!0);var f=d.length,h=new Float32Array(f);for(a=0;a<f;a++){var r=d[a];y.set(r.subarray(0,3));C.set(r.subarray(3,6));B.set(r.subarray(6));h[a]=Math.sqrt(q(y,C,B))}var k=new Float32Array(f);k[0]=h[0];for(a=1;a<f;a++)k[a]=k[a-1]+h[a];f=k[h.length-1];h=[];for(a=0;a<b;a++){var s=f*A.gc(e),s=A.mi(k,
s,0,k.length-1),r=c?g[s]:d[s],s=a,n=r,l=e,r=void 0,r=new Float32Array(3),v=n[0],x=n[1],R=n[2],w=n[3],u=n[4],T=n[5],F=n[6],t=n[7],z=n[8],n=A.gc(l),l=A.gc(l);1<n+l&&(n=1-n,l=1-l);var H=1-n-l,x=H*x+n*u+l*t,R=H*R+n*T+l*z;r[0]=H*v+n*w+l*F;r[1]=x;r[2]=R;h[s]=r}return h};a.qz=p;a.nu=F;a.JA=q;a.$u=function(a,b,c,e){var d=b[0]-a[0],g=c[0]-a[0],f=b[1]-a[1],p=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];e[0]=f*a-b*p;e[1]=g*b-d*a;e[2]=d*p-f*g;return e};a.Ew=function(a,b,c){a=a.q[0].a_position;for(var e=0;e<a.length;e+=
3)a[e]=(a[e]-c[0])*b[0]+c[0],a[e+1]=(a[e+1]-c[1])*b[1]+c[1],a[e+2]=(a[e+2]-c[2])*b[2]+c[2]}};b4w.module.__objects=function(a,m){function b(a){a={type:a,cd:0,ov:[0,0],e:new Float32Array(3),quat:new Float32Array(4),Qc:new Float32Array(8),I:new Float32Array(16),yo:new Float32Array(16),sb:new Float32Array(3),Ka:0,Bj:0,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Ne:null,pq:!1,Me:0,Ci:0,Ig:!1,cc:null,lb:null,N:null,Ki:null,kh:0,gh:0,Kk:0,vh:0,ff:0,qp:"",Kj:!1,Kb:!1,kb:!1,Lb:!1,Rb:!1,Jb:!1,hc:!1,He:!1,Sc:!1,Bi:!1,fd:!1,xa:!1,Lf:!1,oh:!1,Vi:!1,Gc:!1,fj:!1,Wk:!1,is_visible:!1,$h:0,Tc:0,re:0,
Jd:0,Id:0,Ed:0,rd:"",pb:null,li:!1,Oi:"",Xf:!1,io:!1,Re:0,time:0,$l:0,wq:0,max_bones:0,jh:!1,Wh:!1,sh:!1,Cd:!1,Bd:1,Xj:0,Wj:1,Ej:new Int8Array([-1,-1]),wj:[],Qo:[],Pp:[],Qb:null,Pb:null,Xb:null,Wb:null,$b:null,rp:null,hf:null,wh:null,zb:null,dk:null,bk:null,ck:null,Fa:null,pc:null,cb:null,Fe:null,Ge:null,scale:1,Td:1E4};q.identity(a.quat);p.identity(a.Qc);x.identity(a.I);x.identity(a.yo);return a}function c(a,b,c,e){var d=a.d.B,g;for(g in d){var f=a.name+"_"+g;g in e||(e[g]=b.length,b.push(d[g][0]));
c.push(f,e[g])}}var h=m("__animation"),d=m("__batch"),l=m("__boundings"),k=m("__camera"),g=m("__config"),e=m("__constraints"),n=m("__curve"),z=m("__lights"),f=m("__nla"),t=m("__particles");m("__print");var s=m("__scenes"),r=m("__transform"),p=m("__tsr"),F=m("__util"),q=m("quat"),v=m("vec3"),x=m("mat4"),A=g.p,L=0,I=new Float32Array(4);a.yi=b;a.Zl=function(a,g){var q;q=a.parent;if(!(q=q&&q.Xr)&&!(q="ARMATURE"===a.type||"CAMERA"===a.type)&&(q="MESH"===a.type)){var G=a.b4w_do_not_batch,m=a.b4w_dynamic_geometry,
N=a.b4w_collision,V=a.b4w_vehicle,U=a.b4w_floating;q=a.b4w_character;var O=t.rv(a),J=f.sv(a);if(!(G=h.Vk(a)||G||m||N||V||U))a:{G=a.data;for(m=0;m<G.materials.length;m++)if("LENS_FLARES"===G.materials[m].name){G=!0;break a}G=!1}q=G||O||q||J}q=q?!0:!1;a.Xr=q;a.d=b("MESH"===a.type?q?"DYNAMIC":"STATIC":a.type);a.Sa=null;a.Ad=[];a.wb||(a.wb=null);q=a.d;J=a.location;O=a.scale[0];F.nw(a.rotation_quaternion,I);r.set_translation(a,J);r.set_rotation(a,I);r.set_scale(a,O);switch(a.type){case "ARMATURE":J=a.pose.bones;
for(O=0;O<J.length;O++){G=J[O];m=G.bone;N=new Float32Array(m.matrix_local);V=new Float32Array(16);x.invert(N,V);var U=new Float32Array(G.matrix_basis),Q=new Float32Array(3);v.subtract(m.tail_local,m.head_local,Q);F.gy(Q,V,Q);G.as=Q;G.Ur=[G].concat(G.parent_recursive);G.wm=p.Nn(N,p.create());G.vm=p.Nn(U,p.create());G.Tj=p.create();G.fi=!1}J=h.Js(a);q.$b=J;J=h.Vm(a,J);a.b4w_animation_mixing?(q.Qb=new Float32Array(J.ma),q.Pb=new Float32Array(J.ma),q.Xb=new Float32Array(J.e),q.Wb=new Float32Array(J.e)):
(q.Qb=J.ma,q.Pb=J.ma,q.Xb=J.e,q.Wb=J.e);q.rp=J;q.Re=0;q.Cd=a.b4w_animation_mixing;break;case "MESH":q.Gc=A.all_objs_selectable||a.b4w_selectable;q.fj=a.b4w_selectable;q.Ki={jv:a.b4w_glow_settings.glow_duration,lv:a.b4w_glow_settings.glow_period,mv:a.b4w_glow_settings.glow_relapses};q.Gc&&(a.sm=F.yu(L),L++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.Wh=a.data.b4w_vertex_anim.length?!0:!1;if(O=h.get_first_armature_object(a)){J=a.d;G=a.data.vertex_groups;if(G.length){m=O.data.bones;N=O.pose.bones;
V=0;U={};for(Q=0;Q<m.length;Q++){var Y=m[Q].name,P=F.keysearch("name",Y,G);if(P){var X=F.Sk(N,"name",Y);U[Y]={Sm:Q,eh:V++,ul:X,zq:P.index}}}J.$b=U;J.max_bones=V;J.sh=!0}J=a.d.$b;J=h.Vm(O,J);O.b4w_animation_mixing?(q.Qb=new Float32Array(J.ma),q.Pb=new Float32Array(J.ma),q.Xb=new Float32Array(J.e),q.Wb=new Float32Array(J.e)):(q.Qb=J.ma,q.Pb=J.ma,q.Xb=J.e,q.Wb=J.e);q.rp=J;q.Re=0}if(h.qo(a)){O=a.d;J=a.data.materials;G=[];m=[];for(N=0;N<J.length;N++)if(V=J[N].node_tree,Q=V.animation_data,V&&V.animation_data)for(V=
{},(U=Q.action)&&c(U,G,m,V),Q=Q.nla_tracks,Y=0;Y<Q.length;Y++)for(P=Q[Y].strips,X=0;X<Q[Y].strips.length;X++)U=P[X].action,c(U,G,m,V);O.hf=G;O.wh=m}a.M=[];q.Kb=a.b4w_shadow_cast;q.kb=a.b4w_shadow_receive;q.Lb=a.b4w_shadow_cast_only&&q.Kb;q.Rb=a.b4w_reflexible;q.Jb=a.b4w_reflexible_only&&q.Rb;q.hc=a.b4w_reflective;q.He=a.b4w_caustics;q.Sc=a.b4w_wind_bending;q.$h=a.b4w_wind_bending_angle;O=d.ny(a.b4w_wind_bending_angle,d.Ds(a.data.b4w_bounding_box),a.scale[0]);q.Tc=O;q.re=a.b4w_wind_bending_freq;q.Jd=
a.b4w_detail_bending_freq;q.Id=a.b4w_detail_bending_amp;q.Ed=a.b4w_branch_bending_amp;q.oh=!1;q.rd=a.b4w_main_bend_stiffness_col;O=a.b4w_detail_bend_colors;q.pb={};q.pb.Ko=O.leaves_stiffness_col;q.pb.Jo=O.leaves_phase_col;q.pb.Yo=O.overall_stiffness_col;q.Lf=a.b4w_do_not_cull;q.Bi=a.b4w_disable_fogging;q.fd=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";O=a.data.materials[0];q.kh=O.physics.friction;q.gh=O.physics.elasticity;q.vh=0;q.Td=1E4;q.ff=a.b4w_lod_transition;q.Vi=!0;break;case "CAMERA":k.Ps(a);
k.As(a);break;case "LAMP":z.Jv(a);break;case "CURVE":if(O=n.Gt(a))a.$r=O;break;case "EMPTY":q.zb=l.yd(),O=l.ai(),q.pc=O}if(!g&&(a.parent&&"OBJECT"==a.parent_type?(J=q.e,G=q.quat,O=q.scale,e.Em(a,a.parent,J,G,O)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(J=q.e,G=q.quat,e.Dm(a,a.parent,a.parent_bone,J,G)):a.wb&&a.wb.b4w_group_relative?(O=p.Kf(q.e,q.scale,q.quat),e.gs(a,a.wb,O)):a.wb&&!a.wb.b4w_group_relative&&(r.F(a),G=q.I,x.multiply(a.wb.d.I,G,G),J=F.gf(G),O=F.Xi(G),G=F.matrix_to_quat(G),
r.set_translation(a,J),r.set_rotation(a,G),r.set_scale(a,O)),O=a.dupli_group))for(J=O.objects,O=0;O<J.length;O++)J[O].wb=a;a.field&&(q.Kk=a.field.strength,s.sq(a));q.Kj=a.game.use_collision_compound;q.qp=a.game.physics_type;r.F(a)};a.Xx=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.d||"DYNAMIC"!=c.d.type&&"CAMERA"!=c.d.type||r.F(c);c.b4w_use_default_animation&&h.Vk(c)&&(h.apply_def(c),h.play(c,null,h.SLOT_ALL))}};a.cleanup=function(){L=0}};b4w.module.__particles=function(a,m){function b(){throw"_rand() undefined";}function c(a,b,c,d,g,h,k){var n=a.G.Ak,l=a.G.Cc,z=a.G.time;a=a.G.tp;for(var y=b?4:1,C=0;C<n.length;C+=y){var B=n[C];if(B>a&&B<=z)for(B=0;8>B;B++)l[8*C+B]=g[B];for(B=0;8>B;B++)f[B]=l[8*C+B];B=t;B[0]=c[3*C];B[1]=c[3*C+1];B[2]=c[3*C+2];e.Th(B,f,B);h[3*C]=B[0];h[3*C+1]=B[1];h[3*C+2]=B[2];var G=t;G[0]=d[3*C];G[1]=d[3*C+1];G[2]=d[3*C+2];e.Cj(G,f,G);k[3*C]=G[0];k[3*C+1]=G[1];k[3*C+2]=G[2];if(b)for(B=1;4>B;B++)h[3*(C+B)]=h[3*C],h[3*
(C+B)+1]=h[3*C+1],h[3*(C+B)+2]=h[3*C+2],k[3*(C+B)]=G[0],k[3*(C+B)+1]=G[1],k[3*(C+B)+2]=G[2]}}function h(a){a?(g.tx(a),b=function(){return g.pw()}):b=function(){return Math.random()}}var d=m("__config"),l=m("__geometry"),k=m("__scenes"),g=m("__util"),e=m("__tsr"),n=m("vec3"),z=d.Ae,f=new Float32Array(8),t=new Float32Array(3);a.nd=function(a){return 0<a.particle_systems.length?!0:!1};a.We=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.Oz=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.rv=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.Du=function(a,d,f,k){f.G=f.G||{};var q=l.ou(d),v=f.settings.count,x=f.settings.frame_start/z.Xa,A=f.settings.frame_end/z.Xa,t=f.settings.lifetime/z.Xa,m=f.settings.lifetime_random,y=f.settings.emit_from,C=
f.settings.factor_random,B=f.settings.angular_velocity_mode,G=f.settings.angular_velocity_factor,K=f.settings.b4w_randomize_emission;h(f.seed);var N=f.G.fy="WORLD"==f.settings.b4w_coordinate_system?!0:!1;f.G.frame=0;if(d=!a.Ve){var V;V=[];for(var U=0;U<v;U++)V.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);V=new Float32Array(V);for(var U=[],O=0;O<v;O++)U.push(4*O,4*O+2,4*O+1,4*O,4*O+3,4*O+2);U=new Uint16Array(U)}switch(y){case "VERT":for(var O=q.q[0].a_position,q=q.q[0].a_normal,J=O.length/3,y=[],Q=0;Q<v;Q++){var Y=
Math.round((J-1)*b());y.push(Y);d&&(y.push(Y),y.push(Y),y.push(Y))}J=[];for(Q=0;Q<y.length;Q++)J.push(O[3*y[Q]]),J.push(O[3*y[Q]+1]),J.push(O[3*y[Q]+2]);O=new Float32Array(J);J=[];for(Q=0;Q<y.length;Q++)J.push(q[3*y[Q]]),J.push(q[3*y[Q]+1]),J.push(q[3*y[Q]+2]);y=new Float32Array(J);break;case "FACE":O=[];y=[];Q=[];g.Qi(0,Q);J=l.Ok(q,v,!1,Q);g.Qi(0,Q);q=l.Ok(q,v,!0,Q);for(Q=0;Q<J.length;Q++)O.push(J[Q][0],J[Q][1],J[Q][2]),d&&(O.push(J[Q][0],J[Q][1],J[Q][2]),O.push(J[Q][0],J[Q][1],J[Q][2]),O.push(J[Q][0],
J[Q][1],J[Q][2])),y.push(q[Q][0],q[Q][1],q[Q][2]),d&&(y.push(q[Q][0],q[Q][1],q[Q][2]),y.push(q[Q][0],q[Q][1],q[Q][2]),y.push(q[Q][0],q[Q][1],q[Q][2]));O=new Float32Array(O);y=new Float32Array(y);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}y=[O,y];q=y[0];y=y[1];f.G.hw=new Float32Array(q);f.G.bw=new Float32Array(y);f.G.iw=new Float32Array(q.length);f.G.cw=new Float32Array(y.length);f.G.time=0;f.G.tp=-1;O=[];A=(A-x)/v;for(J=0;J<v;J++)Q=
K?A*J+10*A*(.5-b()):A*J,Q+=x,O.push(Q),d&&(O.push(Q),O.push(Q),O.push(Q));x=new Float32Array(O);f.G.Ak=new Float32Array(x);f.G.An=new Float32Array(x);f.G.Cc=new Float32Array(8*x.length);for(K=0;K<8*x.length;K++)for(A=0;8>A;A++)f.G.Cc[8*K+A]=k[A];N?c(f,d,q,y,k,q,y):(e.Gg(q,k,q,0),e.Dj(y,k,y,0));f=[];k=t*m;for(m=0;m<v;m++)N=k*b(),f.push(t-N),d&&(f.push(t-N),f.push(t-N),f.push(t-N));t=new Float32Array(f);f=[];for(k=0;k<v;k++){m=[b()-.5,b()-.5,b()-.5];n.normalize(m,m);f.push(C*m[0]);f.push(C*m[1]);f.push(C*
m[2]);switch(B){case "NONE":f.push(0);break;case "SPIN":case "VELOCITY":f.push(G);break;case "RAND":f.push(2*G*(b()-.5));break;default:throw"Undefined velocity factor";}if(d)for(m=f.slice(-4),N=0;12>N;N++)f.push(m[N%4])}v=new Float32Array(f);C=g.gb("EMITTER_PARTICLES");B=g.bd();B.a_position=q;B.a_normal=y;C.q[0]=B;d?C.V=U:(a.ed=l.jm,C.V=new Uint16Array(0));C.A=q.length/3;C.u.a_p_delay=x;C.u.a_p_lifetime=t;C.u.a_p_vels=v;d&&(C.u.a_p_bb_vertex=V);return C};a.Ux=function(a){for(var b=a.M,d=0;d<b.length;d++){var g=
b[d],f=b[d].Fc;if(f){var h=g.Ua,k=f.G.iw,n=f.G.cw,t=f.G.hw,z=f.G.bw;f.G.fy?c(f,!g.Ve,t,z,a.d.Qc,k,n):(g=z,f=a.d.Qc,z=n,e.Gg(t,f,k,0),e.Dj(g,f,z,0));l.Ov(h);l.Gj(h,"a_position",3,k);l.Gj(h,"a_normal",3,n)}}};a.Ow=function(a,b,c){var e=b.settings.lifetime/z.Xa,d=b.settings.normal_factor,g=9.81*b.settings.effector_weights.gravity,f=b.settings.effector_weights.wind,h=b.settings.mass,n=b.settings.b4w_fade_in/z.Xa,l=b.settings.b4w_fade_out/z.Xa,t=b.settings.b4w_cyclic;a.gp=b.settings.frame_end/z.Xa-b.settings.frame_start/
z.Xa;a.cp=t?1:0;a.pl=d;a.fp=g;d=k.iv();a.gj[0]=d[0]*f;a.gj[1]=d[1]*f;a.gj[2]=d[2]*f;a.ip=e;a.hp=h;a.dp=n;a.ep=l;a.Ve?(e=c.halo.size,f=c.halo.hardness,30>f?(f=.5,h=.9):40>f?(f=.1,h=1):50>f?(f=0,h=.8):(f=0,h=.5)):(e=b.settings.particle_size,h=f=1);a.ql=e;a.$o=f;a.Zo=h;e=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(e[0]&&e[0].use_map_size&&e[0].texture&&"BLEND"==e[0].texture.type&&e[0].texture.use_color_ramp){e=e[0].texture.color_ramp.elements;f=Math.min(2*e.length,b.length);for(h=0;h<f;h+=2)n=
e[h/2],b[h]=n.position,b[h+1]=(n.color[0]+n.color[1]+n.color[2])/3;a.kp=e.length}a.jp.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){e=b[0].texture.color_ramp.elements;f=Math.min(4*e.length,c.length);for(h=0;h<f;h+=4)n=e[h/4],c[h]=n.position,c[h+1]=n.color[0],c[h+2]=n.color[1],c[h+3]=n.color[2];a.bp=e.length}a.ap.set(c)};a.Vw=function(a,b){a.G.tp=a.G.time;a.G.time=b};a.jw=
function(a){for(var b=a.A,c=a.q[0].a_position,e=a.u.a_texcoord,d=[],g=[],f=0;f<b;f++)g.push(c[3*f]),g.push(c[3*f+1]),d.push(c[3*f+2]);d=new Float32Array(d);g=new Float32Array(g);a.u.a_lf_dist=d;a.u.a_lf_bb_vertex=g;a.u.a_texcoord=e;return a};a.set_size=function(a,b,c){a=a.M;for(var e=0;e<a.length;e++){var d=a[e],g=d.Fc;g&&g.name==b&&(d.ql=c)}};a.set_normal_factor=function(a,b,c){a=a.M;for(var e=0;e<a.length;e++){var d=a[e],g=d.Fc;g&&g.name==b&&(d.pl=c)}};a.set_factor=function(a,b,c){a=a.M;for(var e=
0;e<a.length;e++){var d=a[e],g=d.Fc;if(g&&g.name==b){var f=g.G.Ak;if(1==c)g=f;else if(0==c)for(var h=!d.Ve,k=h?4:1,g=g.G.An,n=0;n<g.length;n+=k)g[n]=1E4,h&&(g[n+1]=g[n],g[n+2]=g[n],g[n+3]=g[n]);else for(var t=1/c,g=g.G.An,k=(h=!d.Ve)?4:1,C=0,n=0;n<g.length;n+=k)n>=C?(g[n]=f[n],C+=t):g[n]=1E4,h&&(g[n+1]=g[n],g[n+2]=g[n],g[n+3]=g[n]);l.Gj(d.Ua,"a_p_delay",1,g)}}};a.ay=function(a,b,c){a=a.particle_systems;for(var e=0;e<a.length;e++){var d=a[e];if("EMITTER"==d.settings.type)for(var g=d.G.Ak,e=0;e<8*g.length;e++)d.G.Cc[8*
e]=b[0],d.G.Cc[8*e+1]=b[1],d.G.Cc[8*e+2]=b[2],d.G.Cc[8*e+3]=b[3],d.G.Cc[8*e+4]=c[0],d.G.Cc[8*e+5]=c[1],d.G.Cc[8*e+6]=c[2],d.G.Cc[8*e+7]=c[3]}}};b4w.module.__primitives=function(a,m){function b(a,b,c,d){for(var f=[],h=[],s=[],r=[],p=2*c/(a-1),l=2*d/(b-1),q=0;q<a;q++)for(var v=-c+q*p,x=0;x<b;x++)if(h.push(v,0,-d+x*l),s.push(0,1,0),r.push(q/(a-1),x/(b-1)),q&&x){var A=q*b+x,m=A-1,I=(q-1)*b+x,y=I-1;f.push(A,m,I);f.push(m,y,I)}a=k.bd();a.a_position=new Float32Array(h);a.a_normal=new Float32Array(s);s=k.gb("GRID_PLANE");s.q[0]=a;s.u.a_texcoord=new Float32Array(r);s.V=new Uint32Array(f);s.A=h.length/3;return s}function c(a){var b=a.length;if(b%4)throw"Wrong array";
for(var c=[],h=[],f=0;f<b;f+=4){var l=a[f+1],s=a[f+2],r=a[f+3];d(a[f],h);d(l,h);d(s,h);d(r,h);c.push(f,f+1,f+2);c.push(f,f+2,f+3)}a=k.bd();a.a_position=new Float32Array(h);b=k.gb("FROM_QUADS");b.q[0]=a;b.V=new Uint32Array(c);b.A=h.length/3;return b}function h(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function d(a,b){b.push(a[0],a[1],a[2])}var l=m("__geometry"),k=m("__util");a.Dz=function(a){for(var b=k.gb("LINE"),c=[],d=0;d<2*a;d++)c.push(d);d=k.bd();d.a_point=new Float32Array(c);b.q[0]=d;b.V=new Uint32Array(c);
b.A=2*a;return b};a.Ez=function(a,c){var d=b(2,2,a,c);d.name="PLANE";return d};a.Cz=b;a.Hu=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==r-1)||1==b%2&&(0==a||a==s-1)?!0:!1}var f=c/Math.pow(2,a-1),h=c=f,s=b+1,r=b+1;b=[];for(var f=[],p=[],l=0,q=0,v=-1,x=[],A=0;A<a;A++){for(var m=2*c/(s-1),I=2*h/(r-1),y=[],C=[],B=0,G=0;G<s;G++){for(var K=-c+G*m,N=[],V=0;V<r;V++){var U=-h+V*I;if(K>-l&&K<l&&U>-q&&U<q)N.push(-1),B++;else{for(var O=null,J=0;J<x.length;J+=3)if(K==x[J]&&U==x[J+1]){O=x[J+2];break}J=
null!==O?O:v+1;d(G,V)?(N.push(-2),B++):(null==O&&(0!=V&&V!=r-1&&0!=G&&G!=s-1||A==a-1?p.push(m):(p.push(2*m),y.push(K,U,J)),f.push(K,0,U),v++),N.push(J));if(G&&V)if(1==G)if(d(G-1,V)){if(1<V){var U=J-1,O=C[G-1][V+1],Q=O-1;b.push(J,U,Q)}else O=C[G-1][V+1],Q=O-1;b.push(J,Q,O)}else d(G,V)||(U=J-1,O=C[G-1][V],b.push(J,U,O));else if(G==s-1){if(!d(G,V))if(V==r-1)U=J-1,O=C[G-1][V-1],Q=C[G-2][V],b.push(J,U,O),b.push(J,O,Q);else{var U=J-1,O=C[G-1][V],Q=O-1,Y=O+1;b.push(J,U,Q);b.push(J,Q,O);b.push(J,O,Y);2==
V&&(Y=C[G-2][V-2],b.push(U,Y,Q))}}else 1==V?d(G,V-1)?(U=C[G-1][V],O=C[G-1][V-1],b.push(J,O,U)):(U=N[V-1],O=C[G-1][V],Q=C[G-2][V-1],b.push(J,U,O),b.push(U,Q,O)):V==r-1?d(G,V)||(U=N[V-1],O=C[G-1][V-1],Q=C[G-2][V],b.push(J,U,O),b.push(J,O,Q)):-1!=C[G-1][V]&&-1!=C[G-1][V-1]&&-1!=N[V-1]?(U=N[V-1],O=C[G-1][V],Q=C[G-1][V-1],b.push(J,U,O),b.push(U,Q,O),V==r-2&&d(G,V+1)&&(Y=C[G-1][V+1],b.push(J,O,Y))):V==r-2&&d(G,V+1)&&(O=C[G-1][V],Y=C[G-1][V+1],b.push(J,O,Y))}}C.push(N)}x=y;l=c;q=h;c*=2;h*=2}if(2E4>l)for(K=
-2E4,f.push(-2E4,-1,-2E4),f.push(-2E4,-1,2E4),f.push(-l,-1,-q),f.push(-l,-1,q),f.push(2E4,-1,-2E4),f.push(2E4,-1,2E4),f.push(l,-1,-q),f.push(l,-1,q),J=v+1,b.push(J+3,J+2,J+1,J+2,J+0,J+1,J+6,J+4,J+2,J+4,J+0,J+2,J+5,J+7,J+1,J+7,J+3,J+1,J+5,J+4,J+7,J+7,J+4,J+6),m=2*l/(s-1),G=0;8>G;G++)p.push(-m);a=k.bd();a.a_position=new Float32Array(f);a.a_cascad_step=new Float32Array(p);c=k.gb("multigrid_plane");c.q[0]=a;c.V=new Uint32Array(b);c.A=f.length/3;return c};a.Bz=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var c=[],h=[],f=0;f<b;f+=3){var l=a[f+1],s=a[f+2];d(a[f],h);d(l,h);d(s,h);c.push(f,f+1,f+2)}a=k.bd();a.a_position=new Float32Array(h);b=k.gb("FROM_TRIANGLES");b.q[0]=a;b.V=new Uint32Array(c);b.A=h.length/3;return b};a.Az=c;a.Eu=function(a){a=k.hy(a);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=c(b);a.name="FRUSTUM";return a};a.Fu=function(){var a=k.gb("BILLBOARD"),
b=k.bd();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.q[0]=b;a.V=new Uint32Array([0,2,1,1,2,3]);a.A=4;return a};a.Aa=function(){var a=k.gb("BILLBOARD"),b=k.bd();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.q[0]=b;a.V=new Uint32Array([0,2,1,0,3,2]);a.A=4;return a};a.Bu=function(){var a=k.gb("CUBEMAP_BOARD"),b=k.bd();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.q[0]=b;a.V=new Uint32Array([0,2,1,0,3,2]);a.A=4;return a};a.Qn=function(a,b){var c=k.gb("UV_SPHERE"),
z,f,t=[],s=[],r=[];for(f=0;8>=f;f++)for(z=0;16>=z;z++){var p=z/16,F=f/8;s.push(-a*Math.cos(2*p*Math.PI)*Math.sin(F*Math.PI)+b[0],a*Math.cos(F*Math.PI)+b[1],a*Math.sin(2*p*Math.PI)*Math.sin(F*Math.PI)+b[2])}for(f=p=0;8>f;f++)for(z=0;16>z;z++){var F=h(s,17*f+z+1),q=h(s,17*f+z),v=h(s,17*(f+1)+z),x=h(s,17*(f+1)+z+1);Math.abs(F[1])==a+b[1]?(d(F,t),d(v,t),d(x,t),r.push(p,p+1,p+2),p+=3):Math.abs(v[1])==a+b[1]?(d(F,t),d(q,t),d(v,t),r.push(p,p+1,p+2),p+=3):(d(F,t),d(q,t),d(v,t),d(x,t),r.push(p,p+1,p+2),r.push(p,
p+2,p+3),p+=4)}z={};z.a_position=t;s=l.Wm(r,s,t);z.a_normal=l.Um(r,t,s);z.a_tangent=[];c.u.a_influence=[];c.u.a_color=[];c.u.a_texcoord=[];c.q[0]=z;c.V=r;c.A=t.length/3;return c}};b4w.module.__prerender=function(a,m){var b=m("__config"),c=m("__debug"),h=m("__geometry"),d=m("__util"),l=m("vec3"),k=b.p,g="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH GLOW_MASK WIREFRAME COLOR_PICKING".split(" ");a.vl=function(a){if(-1<g.indexOf(a.type)){for(var b=!1,z=a.l,f=0;f<z.length;f++){var t=z[f],s=t,r=a,p=s.Pa,F=r.h;s.P=!0;p.is_visible=!1;if(p)if(p.oh)s.P=!1;else{var q=F.Nd,v=p.cb.s,x=p.Td,q=Math.sqrt((v[0]-q[0])*(v[0]-q[0])+(v[1]-q[1])*(v[1]-q[1])+(v[2]-q[2])*(v[2]-q[2])),v=p.ff*
p.cb.na;q>=p.vh&&q<x+v?(p.is_visible=!0,"GLOW_MASK"!=r.type||Boolean(s.k.Vf)?(F=F.Lk,p.Lf?p=!1:"STATIC"===p.type?(x=p.cb,p=x.s,p=d.mx(p,F,x.na)):(x=p.Ge,p=x.s,p=d.hu(p,F,x.Ce,x.De,x.Ee)),p?s.P=!1:"WIREFRAME"==r.type&&(s.P=s.k.wireframe_mode==c.qm.WM_DEBUG_SPHERES?s.k.zk:!s.k.zk)):s.P=!1):s.P=!1}else s.P=!1;t.P&&(b=!0)}switch(a.type){case "WIREFRAME":break;default:a.P="MAIN_OPAQUE"===a.type||"DEPTH"===a.type||b?!0:!1}}if("MAIN_BLEND"==a.type&&(b=a.h.Nd,l.dist(b,a.Hq)>k.alpha_sort_threshold&&k.alpha_sort&&
a.l)){for(z=0;z<a.l.length;z++)t=a.l[z],s=t.k,f=t.Pa.I,s&&s.ka&&s.zd!=h.Vc&&(s=s.Ua)&&t.P&&(t=s.Pi)&&t.type==h.rm&&h.Qx(s,f,b);a.Hq.set(b)}}};b4w.module.__print=function(a){var m=!1,b=0,c=0;a.Yw=function(a){m=a};a.log=function(){m&&console.log.apply(console,arguments)};a.error=function(){b++;console.error.apply(console,arguments)};a.warn=function(){m&&(c++,console.warn.apply(console,arguments))};a.time=function(){m&&console.time.apply(console,arguments)};a.timeEnd=function(){m&&console.timeEnd.apply(console,arguments)};a.group=function(){m&&console.group.apply(console,arguments)};a.groupCollapsed=function(){m&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){m&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.hv=function(){return c};a.Xu=function(){return b};a.clear_errors_warnings=function(){b=c=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,m){function b(a,b,c){g.warn("WARNING "+String(c)+" for "+String(a)+' "'+b.name+'" undefined, reexport '+(b.library?"library "+h(b):"main scene"))}function c(a,b,c){g.warn('B4W Warning: "'+String(c)+'" for '+String(a)+' "'+b.name+'" is deprecated, reexport '+(b.library?'library "'+h(b)+'"':"main scene."))}function h(a){return a.library.split("/").slice(-1)[0]}function d(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var f=
e.Fd(a);a.materials=c;a.submeshes=d;f.name=b;f.materials=a.materials.slice(0);f.submeshes=[];for(c=0;c<d.length;c++){var g=e.ti(d[c]);f.submeshes.push(g)}return f}var l=m("__boundings"),k=m("__curve"),g=m("__print"),e=m("__util"),n=m("vec3"),z=m("vec4"),f=m("quat"),t=m("mat4");a.Us=function(a){var d=a.worlds;if(0==d.length){g.warn("WARNING Datablock world is missing, reexport scene");var f={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,
environment_color:"PLAIN"},b4w_fog_color:[.5,.5,.5],b4w_fog_density:0};d.push(f)}for(var d=a.worlds,k=0;k<d.length;k++){var f=d[k],q=f.b4w_shadow_settings;"csm_num"in q||(b("world",f,"b4w_shadow_settings.csm_num"),q.csm_num=1);"csm_first_cascade_border"in q||(b("world",f,"b4w_shadow_settings.csm_first_cascade_border"),q.csm_first_cascade_border=10);"first_cascade_blur_radius"in q||(b("world",f,"b4w_shadow_settings.first_cascade_blur_radius"),q.first_cascade_blur_radius=3);"csm_last_cascade_border"in
q||(b("world",f,"b4w_shadow_settings.csm_last_cascade_border"),q.csm_last_cascade_border=100);"last_cascade_blur_radius"in q||(b("world",f,"b4w_shadow_settings.last_cascade_blur_radius"),q.last_cascade_blur_radius=1.5);"csm_resolution"in q||(b("world",f,"b4w_shadow_settings.csm_resolution"),q.csm_resolution=2048);"self_shadow_polygon_offset"in q||(b("world",f,"b4w_shadow_settings.self_shadow_polygon_offset"),q.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in q||(b("world",f,"b4w_shadow_settings.self_shadow_normal_offset"),
q.self_shadow_normal_offset=.01);"fade_last_cascade"in q||(b("world",f,"b4w_shadow_settings.fade_last_cascade"),q.fade_last_cascade=!0);"blend_between_cascades"in q||(b("world",f,"b4w_shadow_settings.blend_between_cascades"),q.blend_between_cascades=!0);q=f.b4w_ssao_settings;"dist_factor"in q||(b("world",f,"b4w_ssao_settings.dist_factor"),q.dist_factor=0,q.samples=16);"b4w_glow_color"in f||(f.b4w_glow_color=[1,1,1],b("object",f,"b4w_glow_color"));"b4w_glow_factor"in f||(f.b4w_glow_factor=1,b("object",
f,"b4w_glow_factor"));"b4w_fog_density"in f||(b("world",f,"b4w_fog_density"),f.b4w_fog_density=0);"b4w_sky_settings"in f&&"rayleigh_brightness"in f.b4w_sky_settings||(b("world",f,"rayleigh_brightness"),f.b4w_sky_settings={procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"b4w_bloom_settings"in
f?("blur"in f.b4w_bloom_settings||(b("world",f,"b4w_bloom_settings.blur"),f.b4w_bloom_settings.blur=4),"edge_lum"in f.b4w_bloom_settings||(b("world",f,"b4w_bloom_settings.edge_lum"),f.b4w_bloom_settings.edge_lum=1)):(b("world",f,"b4w_bloom_settings"),f.b4w_bloom_settings={key:.2,blur:4});"b4w_motion_blur_settings"in f?("motion_blur_factor"in f.b4w_motion_blur_settings||(b("world",f,"b4w_motion_blur_settings.motion_blur_factor"),f.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in
f.b4w_motion_blur_settings||(b("world",f,"b4w_motion_blur_settings.motion_blur_decay_threshold"),f.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(b("world",f,"b4w_motion_blur_settings"),f.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});"b4w_color_correction_settings"in f||(b("world",f,"b4w_color_correction_settings"),f.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in f.b4w_god_rays_settings||(b("world",
f,"b4w_god_rays_settings.steps_per_pass"),f.b4w_god_rays_settings.steps_per_pass=10)}d=a.scenes;for(k=0;k<d.length;k++)f=d[k],"b4w_use_nla"in f||(f.b4w_use_nla=!1,b("scene",f,"b4w_use_nla")),"b4w_nla_cyclic"in f||(f.b4w_nla_cyclic=!1,b("scene",f,"b4w_nla_cyclic")),"b4w_nla_script"in f||(f.b4w_nla_script=[],b("scene",f,"b4w_nla_script")),"b4w_detect_collisions"in f&&(c("scene",f,"b4w_detect_collisions"),delete f.b4w_detect_collisions),"audio_doppler_speed"in f||(f.audio_doppler_speed=343.3),"audio_doppler_factor"in
f||(f.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in f||(f.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",f,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in f||(f.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in f||(f.b4w_enable_bloom=!1,b("scene",f,"b4w_enable_bloom")),"b4w_enable_motion_blur"in f||(f.b4w_enable_motion_blur=!1,b("scene",f,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in f||(f.b4w_enable_color_correction=
!1,b("scene",f,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in f||(f.b4w_enable_antialiasing=!0,b("scene",f,"b4w_enable_antialiasing"));d=a.meshes;for(k=0;k<d.length;k++)f=d[k],f.b4w_bounding_box||(b("mesh",f,"b4w_bounding_box"),f.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0}),f.uv_textures||(b("mesh",f,"uv_textures"),f.uv_textures=[]),f.b4w_bounding_sphere_center||(f.b4w_bounding_sphere_center=[0,0,0]),f.b4w_bounding_cylinder_center||(f.b4w_bounding_cylinder_center=
[0,0,0]),f.b4w_bounding_ellipsoid_center||(f.b4w_bounding_ellipsoid_center=[0,0,0]),f.b4w_bounding_ellipsoid_axes||(q=f.b4w_bounding_box,f.b4w_bounding_ellipsoid_axes=[(q.max_x-q.min_x)/2,(q.max_y-q.min_y)/2,(q.max_z-q.min_z)/2]);d=a.cameras;for(k=0;k<d.length;k++)f=d[k],f.type||(f.type="PERSP",b("camera",f,"type")),"b4w_eye_target_dist"in f&&(delete f.b4w_eye_target_dist,c("camera",f,"b4w_eye_target_dist")),"b4w_use_distance_limits"in f||(f.b4w_use_distance_limits=!1,b("camera",f,"b4w_use_distance_limits")),
"b4w_distance_min"in f||(f.b4w_distance_min=1,b("camera",f,"b4w_distance_min")),"b4w_distance_max"in f||(f.b4w_distance_max=100,b("camera",f,"b4w_distance_max")),"b4w_use_horizontal_clamping"in f||(f.b4w_use_horizontal_clamping=!1,b("camera",f,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in f||(f.b4w_rotation_left_limit=-Math.PI,b("camera",f,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in f||(f.b4w_rotation_right_limit=Math.PI,b("camera",f,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in
f||(f.b4w_horizontal_clamping_type="LOCAL",b("camera",f,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in f||(f.b4w_use_vertical_clamping=!1,b("camera",f,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in f||(f.b4w_rotation_down_limit=-Math.PI/2,b("camera",f,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in f||(f.b4w_rotation_up_limit=Math.PI/2,b("camera",f,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in f||(f.b4w_vertical_clamping_type="LOCAL",b("camera",f,"b4w_vertical_clamping_type"));
d=a.lamps;for(k=0;k<d.length;k++)f=d[k],"b4w_generate_shadows"in f||(f.b4w_generate_shadows=!1,b("lamp",f,"b4w_generate_shadows")),"b4w_dynamic_intensity"in f||(f.b4w_dynamic_intensity=!1,b("lamp",f,"b4w_dynamic_intensity")),"use_diffuse"in f||(f.use_diffuse=!0,b("lamp",f,"use_diffuse")),"use_specular"in f||(f.use_specular=!0,b("lamp",f,"use_specular"));d=a.speakers;for(k=0;k<d.length;k++)f=d[k],"b4w_behavior"in f||(f.b4w_behavior=f.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in
f||(f.b4w_disable_doppler=!1),"b4w_delay"in f||(f.b4w_delay=0),"b4w_delay_random"in f||(f.b4w_delay_random=0),"b4w_volume_random"in f||(f.b4w_volume_random=0),"b4w_pitch_random"in f||(f.b4w_pitch_random=0),"b4w_fade_in"in f||(f.b4w_fade_in=0),"b4w_fade_out"in f||(f.b4w_fade_out=0),"b4w_loop"in f||(f.b4w_loop=!1),"b4w_loop_count"in f||(f.b4w_loop_count=0),"b4w_loop_count_random"in f||(f.b4w_loop_count_random=0),"b4w_playlist_id"in f||(f.b4w_playlist_id="");d=a.textures;for(k=0;k<d.length;k++)f=d[k],
"b4w_anisotropic_filtering"in f||(f.b4w_anisotropic_filtering="OFF",b("texture",f,"b4w_anisotropic_filtering")),"b4w_water_foam"in f||(f.b4w_water_foam=!1,b("texture",f,"b4w_water_foam")),"b4w_foam_uv_freq"in f||(f.b4w_foam_uv_freq=[1,1],b("texture",f,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in f||(f.b4w_foam_uv_magnitude=[1,1],b("texture",f,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in f||(f.b4w_parallax_steps=5,b("material",f,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in f||(f.b4w_parallax_lod_dist=
10,b("material",f,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in f||(f.b4w_shore_dist_map=!1,b("texture",f,"b4w_shore_dist_map")),"b4w_shore_boundings"in f||(f.b4w_shore_boundings=new Float32Array(4),f.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",f,"b4w_shore_boundings")),"b4w_max_shore_dist"in f||(f.b4w_max_shore_dist=100,b("texture",f,"b4w_max_shore_dist")),"b4w_disable_compression"in f||(f.b4w_disable_compression=!1,b("texture",f,"b4w_disable_compression"));d=a.materials;for(k=0;k<d.length;k++)for(f=
d[k],("b4w_node_mat_type"in f)&&c("material",f,"b4w_node_mat_type"),("b4w_skydome"in f)&&c("material",f,"b4w_skydome"),("b4w_procedural_skydome"in f)&&c("material",f,"b4w_procedural_skydome"),f.b4w_water&&("b4w_water_shore_smoothing"in f||(f.b4w_water_shore_smoothing=!1,b("material",f,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in f||(f.b4w_water_dynamic=!1,b("material",f,"b4w_water_dynamic")),"b4w_waves_height"in f||(f.b4w_waves_height=1,b("material",f,"b4w_waves_height")),"b4w_waves_length"in
f||(f.b4w_waves_length=1,b("material",f,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in f||(f.b4w_water_dst_noise_scale0=.05,b("material",f,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in f||(f.b4w_water_dst_noise_scale1=.03,b("material",f,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in f||(f.b4w_water_dst_noise_freq0=1.3,b("material",f,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in f||(f.b4w_water_dst_noise_freq1=1,b("material",f,"b4w_water_dst_noise_freq1")),
"b4w_water_dir_min_shore_fac"in f||(f.b4w_water_dir_min_shore_fac=.4,b("material",f,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in f||(f.b4w_water_dir_freq=.5,b("material",f,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in f||(f.b4w_water_dir_noise_scale=.05,b("material",f,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in f||(f.b4w_water_dir_noise_freq=.07,b("material",f,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in f||(f.b4w_water_dir_min_noise_fac=.5,b("material",
f,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in f||(f.b4w_water_dst_min_fac=.2,b("material",f,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in f||(f.b4w_water_waves_hor_fac=5,b("material",f,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in f||(f.b4w_water_absorb_factor=6,b("material",f,"b4w_water_absorb_factor")),"b4w_water_fog_color"in f||(f.b4w_water_fog_color=new Float32Array(3),f.b4w_water_fog_color=[.5,.7,.7],b("material",f,"b4w_water_fog_color")),"b4w_foam_factor"in f||
(f.b4w_foam_factor=5,b("material",f,"b4w_foam_factor")),"b4w_generated_mesh"in f||(f.b4w_generated_mesh=!1,b("material",f,"b4w_generated_mesh")),"b4w_water_num_cascads"in f||(f.b4w_water_num_cascads=5,b("material",f,"b4w_water_num_cascads")),"b4w_water_subdivs"in f||(f.b4w_water_subdivs=64,b("material",f,"b4w_water_subdivs")),"b4w_water_detailed_dist"in f||(f.b4w_water_detailed_dist=1E3,b("material",f,"b4w_water_detailed_dist"))),("b4w_dynamic_grass_size"in f)||(f.b4w_dynamic_grass_size=""),("b4w_dynamic_grass_color"in
f)||(f.b4w_dynamic_grass_color=""),("diffuse_intensity"in f)||(f.diffuse_intensity=1,b("material",f,"diffuse_intensity")),("b4w_use_ghost"in f)||(f.b4w_use_ghost=!1),("b4w_collision_group"in f)||(f.b4w_collision_group=128,b("material",f,"b4w_collision_group")),("b4w_collision_mask"in f)||(f.b4w_collision_mask=127,b("material",f,"b4w_collision_mask")),"HALO"!=f.type||("b4w_halo_sky_stars"in f)||(f.b4w_halo_sky_stars=!1,b("material",f,"b4w_halo_sky_stars")),"HALO"!=f.type||("b4w_halo_stars_blend_height"in
f)||(f.b4w_halo_stars_blend_height=10,b("material",f,"b4w_halo_stars_blend_height")),"HALO"!=f.type||("b4w_halo_stars_min_height"in f)||(f.b4w_halo_stars_min_height=0,b("material",f,"b4w_halo_stars_min_height")),("specular_shader"in f)||(f.specular_shader="COOKTORR",b("material",f,"specular_shader")),("diffuse_shader"in f)||(f.diffuse_shader="LAMBERT",b("material",f,"diffuse_shader")),("roughness"in f)||(f.roughness=.5,b("material",f,"roughness")),("diffuse_fresnel"in f)||(f.diffuse_fresnel=.1,b("material",
f,"diffuse_fresnel")),("diffuse_fresnel_factor"in f)||(f.diffuse_fresnel_factor=.5,b("material",f,"diffuse_fresnel_factor")),("specular_slope"in f)||(f.specular_slope=.2,b("material",f,"specular_slope")),("specular_toon_size"in f)||(f.specular_toon_size=.5,b("material",f,"specular_toon_size")),("specular_toon_smooth"in f)||(f.specular_toon_smooth=.1,b("material",f,"specular_toon_smooth")),("specular_alpha"in f)||(f.specular_alpha=1,b("material",f,"specular_alpha")),("b4w_wettable"in f)||(f.b4w_wettable=
!1,b("material",f,"b4w_wettable")),("b4w_refractive"in f)||(f.b4w_refractive=!1,b("material",f,"b4w_refractive")),("b4w_refr_bump"in f)||(f.b4w_refr_bump=0,b("material",f,"b4w_refr_bump")),("b4w_shallow_water_col"in f)||(f.b4w_shallow_water_col=[0,.8,.3],b("material",f,"b4w_shallow_water_col")),("b4w_shore_water_col"in f)||(f.b4w_shore_water_col=[0,.9,.2],b("material",f,"b4w_shore_water_col")),("b4w_shallow_water_col_fac"in f)||(f.b4w_shallow_water_col_fac=1,b("material",f,"b4w_shallow_water_col_fac")),
("b4w_shore_water_col_fac"in f)||(f.b4w_shore_water_col_fac=.5,b("material",f,"b4w_shore_water_col_fac")),("b4w_water_sss_strength"in f)||(f.b4w_water_sss_strength=5.9,b("material",f,"b4w_water_sss_strength")),("b4w_water_sss_width"in f)||(f.b4w_water_sss_width=.45,b("material",f,"b4w_water_sss_width")),("b4w_render_above_all"in f)||(f.b4w_render_above_all=!1,b("material",f,"b4w_render_above_all")),q=f.texture_slots,f=0;f<q.length;f++){var n=q[f];"blend_type"in n||(n.blend_type="MIX",b("texture_slot",
n,"blend_type"))}a=a.objects;for(k=0;k<a.length;k++){d=a[k];switch(d.type){case "MESH":"b4w_dynamic_geometry"in d||(d.b4w_dynamic_geometry=!1);"b4w_reflexible"in d||(d.b4w_reflexible=!1);"b4w_reflexible_only"in d||(d.b4w_reflexible_only=!1);"b4w_reflective"in d||(d.b4w_reflective=!1);"b4w_wind_bending"in d||(d.b4w_wind_bending=!1,b("object",d,"b4w_wind_bending"));"b4w_wind_bending_angle"in d||(d.b4w_wind_bending_angle=10,d.b4w_wind_bending_freq=.25,b("object",d,"wind bending params"));"b4w_detail_bending_amp"in
d||(d.b4w_detail_bending_amp=.1,d.b4w_branch_bending_amp=.3,b("object",d,"detail bending params"));"b4w_detail_bending_freq"in d||(d.b4w_detail_bending_freq=1,b("object",d,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in d||(d.b4w_main_bend_stiffness_col="",b("object",d,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in d||(d.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",d,"b4w_detail_bend_colors"));"b4w_caustics"in d||
(d.b4w_caustics=!1);"vertex_groups"in d&&d.vertex_groups.length&&d.data&&0==d.data.vertex_groups.length&&(d.data.vertex_groups=d.vertex_groups,delete d.vertex_groups,b("object",d,"vertex_groups"));"b4w_vertex_anim"in d&&d.b4w_vertex_anim.length&&d.data&&0==d.data.b4w_vertex_anim.length&&(d.data.b4w_vertex_anim=d.b4w_vertex_anim,delete d.b4w_vertex_anim,b("object",d,"b4w_vertex_anim"));"b4w_do_not_render"in d||(d.b4w_do_not_render=!1);"use_ghost"in d.game||(d.game.use_ghost=!1);"use_sleep"in d.game||
(d.game.use_sleep=!1);"velocity_min"in d.game||(d.game.velocity_min=0);"velocity_max"in d.game||(d.game.velocity_max=0);"collision_group"in d.game||(d.game.collision_group=1);"collision_mask"in d.game||(d.game.collision_mask=255);"b4w_vehicle_settings"in d?d.b4w_vehicle_settings&&("steering_ratio"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.steering_ratio=10),"steering_max"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.steering_max=1),"inverse_control"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.inverse_control=
!1),"force_max"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.force_max=1500),"brake_max"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.brake_max=100),"speed_ratio"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.suspension_compression=
4.4),"suspension_stiffness"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in d.b4w_vehicle_settings||
(d.b4w_vehicle_settings.floating_factor=3),"floating_factor"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in d.b4w_vehicle_settings||(d.b4w_vehicle_settings.water_rot_damp=.9)):(d.b4w_vehicle_settings=null,b("object",d,"b4w_vehicle_settings"));"b4w_floating_settings"in d?d.b4w_floating_settings&&("floating_factor"in d.b4w_floating_settings||(d.b4w_floating_settings.floating_factor=
3),"water_lin_damp"in d.b4w_floating_settings||(d.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in d.b4w_floating_settings||(d.b4w_floating_settings.water_rot_damp=.8)):(d.b4w_floating_settings=null,b("object",d,"b4w_floating_settings"));"b4w_character_settings"in d?d.b4w_character_settings&&("walk_speed"in d.b4w_character_settings||(d.b4w_character_settings.walk_speed=4),"run_speed"in d.b4w_character_settings||(d.b4w_character_settings.run_speed=8),"step_height"in d.b4w_character_settings||
(d.b4w_character_settings.step_height=.25),"jump_strength"in d.b4w_character_settings||(d.b4w_character_settings.jump_strength=5),"waterline"in d.b4w_character_settings||(d.b4w_character_settings.waterline=0)):(d.b4w_character_settings=null,b("object",d,"b4w_character_settings"));"b4w_selectable"in d||(d.b4w_selectable=!1,b("object",d,"b4w_selectable"));"b4w_glow_settings"in d||(d.b4w_glow_settings={},d.b4w_glow_settings.glow_duration=1,d.b4w_glow_settings.glow_period=1,d.b4w_glow_settings.glow_relapses=
0,b("object",d,"b4w_glow_settings"));"b4w_lod_transition"in d||(d.b4w_lod_transition=.01,b("object",d,"b4w_lod_transition"));"lod_levels"in d||(d.lod_levels=[],b("object",d,"lod_levels"));"b4w_animation_mixing"in d||(d.b4w_animation_mixing=!1,b("object",d,"b4w_animation_mixing"));break;case "EMPTY":"b4w_group_relative"in d||(d.b4w_group_relative=!1,b("object",d,"b4w_group_relative"))}if(!("rotation_quaternion"in d)){f=[0,0,0,1];e.euler_to_quat(d.rotation_euler,f);var q=f,n=f[0],l=f[1],A=f[2];q[0]=
f[3];q[1]=n;q[2]=l;q[3]=A;d.rotation_quaternion=f;b("object",d,"rotation_quaternion")}"webgl_do_not_batch"in d&&(d.b4w_do_not_batch=d.webgl_do_not_batch)&&c("object",d,"webgl_do_not_batch");"b4w_shadow_cast_only"in d||(d.b4w_shadow_cast_only=!1,b("object",d,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in d||(d.b4w_correct_bounding_offset="AUTO",b("object",d,"b4w_correct_bounding_offset"));q=d.particle_systems;for(f=0;f<q.length;f++)n=q[f],l=n.settings,"use_whole_group"in l||(l.use_whole_group=
!1,b("object",l,"use_whole_group")),n.transforms||(n.transforms=new Float32Array,b("particle_system",n,"transforms")),"b4w_billboard_align"in l||(l.b4w_billboard_align="VIEW",b("particle_settings",l,"b4w_billboard_align")),"b4w_dynamic_grass"in l||(l.b4w_dynamic_grass=!1,b("object",l,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in l||(l.b4w_dynamic_grass_scale_threshold=.01,b("object",l,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in l||(l.b4w_initial_rand_rotation=
!1,b("particle_settings",l,"b4w_initial_rand_rotation")),"b4w_rotation_type"in l||(l.b4w_rotation_type="Z",b("particle_settings",l,"b4w_rotation_type")),"b4w_rand_rotation_strength"in l||(l.b4w_rand_rotation_strength=1,b("particle_settings",l,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in l||(l.b4w_hair_billboard=!1,b("particle_settings",l,"b4w_hair_billboard")),"b4w_hair_billboard_type"in l||(l.b4w_hair_billboard_type="BASIC",b("particle_settings",l,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in
l||(l.b4w_hair_billboard_jitter_amp=0,b("particle_settings",l,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in l||(l.b4w_hair_billboard_jitter_freq=0,b("particle_settings",l,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in l||(l.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",l,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in l||(l.b4w_wind_bend_inheritance="PARENT",b("particle_settings",l,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in
l||(l.b4w_shadow_inheritance="PARENT",b("particle_settings",l,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in l||(l.b4w_reflection_inheritance="PARENT",b("particle_settings",l,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in l||(l.b4w_vcol_from_name="",b("particle_settings",l,"b4w_vcol_from_name")),"b4w_vcol_to_name"in l||(l.b4w_vcol_to_name="",b("particle_settings",l,"b4w_vcol_to_name")),"b4w_coordinate_system"in l||(l.b4w_coordinate_system="LOCAL",b("particle_settings",l,"b4w_coordinate_system"));
"constraints"in d||(d.constraints=[],b("object",d,"constraints"));q=d.modifiers;for(f=0;f<q.length;f++){a:{n=q[f];switch(n.type){case "ARRAY":if(!("fit_type"in n)){g.error("WARNING Incomplete modifier "+String(n.type)+' for "'+d.name+'", reexport '+(d.library?"library"+h(d):"main scene"));n=!1;break a}}n=!0}n||(q.splice(f,1),f--)}"animation_data"in d||(d.animation_data={action:null,nla_tracks:[]},b("object",d,"animation_data"));if(d.animation_data)for(("action"in d.animation_data)||(d.animation_data.action=
null,g.warn("B4W Warning: no action in animation data "+d.name)),("nla_tracks"in d.animation_data)||(d.animation_data.nla_tracks=[],g.warn("B4W Warning: no NLA in animation data "+d.name)),q=d.animation_data.nla_tracks,f=0;f<q.length;f++)for(n=q[f],l=0;l<n.strips.length;l++)A=n.strips[l],"action"in A||(A.action=null,g.warn("B4W Warning: no action in NLA strip "+d.name)),"action_frame_start"in A||(A.action_frame_start=0,g.warn("B4W Warning: no action_frame_start in NLA strip "+d.name)),"action_frame_end"in
A||(A.action_frame_end=A.frame_end-A.frame_start,g.warn("B4W Warning: no action_frame_start in NLA strip "+d.name));"b4w_collision_id"in d||(d.b4w_collision_id="",b("material",d,"b4w_collision_id"));f=d.scale;q=Math.abs((f[1]-f[2])/f[1]);.001>Math.abs((f[0]-f[1])/f[0])&&.001>q||g.warn("B4W Warning: non-uniform scale for object "+d.name)}};a.vs=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var g=b[c].type;if("ARRAY"==g||"CURVE"==g){b=!0;break a}}b=!1}if(!b)return null;b=d(a.data,a.data.name+
"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var h=a[c];switch(h.type){case "ARRAY":for(var g=b,v=h,x=0,A=0,m=0,I=new Float32Array(16),h=[],y=1;y<v.count;y++){v.use_constant_offset&&(x+=v.constant_offset_displace[0],A+=v.constant_offset_displace[1],m+=v.constant_offset_displace[2]);if(v.use_relative_offset)var C=g.b4w_bounding_box,x=x+(C.max_x-C.min_x)*v.relative_offset_displace[0],A=A+(C.max_y-C.min_y)*v.relative_offset_displace[1],m=m+(C.max_z-C.min_z)*v.relative_offset_displace[2];e.Kx(x,A,m,
I);for(var B=C=d(g),G=I,K=0;K<B.submeshes.length;K++){var N=B.submeshes[K];e.rf(N.position,G,N.position,0);e.iy(N.normal,G,N.normal);e.Hx(N.tangent,G,N.tangent)}h.push(C)}for(y=0;y<h.length;y++)for(v=g,x=h[y],A=0;A<v.submeshes.length;A++){m=v.submeshes[A];I=x.submeshes[A];C=m.base_length;B=m.indices.length;m.base_length+=I.base_length;for(var V in m)if("base_length"!=V)if("indices"==V)for(m[V]=e.Nx(m[V],I[V]),G=B;G<m.indices.length;G++)m.indices[G]+=C;else m[V]=e.su(m[V],I[V])}break;case "CURVE":for(var g=
b,y=h.object.$r,v=new Float32Array(16),A=y.Rd?4:3,x=new Float32Array(A),A=new Float32Array(A),m=new Float32Array(3),I=new Float32Array(4),C=new Float32Array(4),B=new Float32Array(3),G=new Float32Array(3),K=new Float32Array(3),N=new Float32Array(4),U=new Float32Array(4),O=0;O<g.submeshes.length;O++){var J=g.submeshes[O],Q=J.position,Y=J.normal,J=J.tangent,P;a:switch(P=h.deform_axis,P){case "POS_X":case "NEG_X":P=0;break a;case "POS_Y":case "NEG_Y":P=1;break a;case "POS_Z":case "NEG_Z":P=2;break a;
default:throw"Wrong deform axis value "+P;}B[0]=0;B[1]=0;B[2]=0;B[P]=1;for(var X=k.px(y),Z=0;Z<Q.length/3;Z++){K[0]=Q[3*Z];K[1]=Q[3*Z+1];K[2]=Q[3*Z+2];var S=K[P],da=k.ox(y,S);k.qx(y,da,x);m[0]=x[0];m[1]=x[1];m[2]=x[2];k.nx(y,da,A);G[0]=A[0];G[1]=0;G[2]=A[2];n.normalize(G,G);f.rotationTo(B,G,I);0>S?(x[0]=G[0],x[1]=G[1],x[2]=G[2],n.scale(x,S,x),n.add(m,x,m)):S>X&&(x[0]=G[0],x[1]=G[1],x[2]=G[2],n.scale(x,S-X,x),n.add(m,x,m));t.fromRotationTranslation(I,m,v);y.Rd&&(f.setAxisAngle(B,x[3],C),n.transformQuat(K,
C,K));K[P]=0;n.transformMat4(K,v,K);Q[3*Z]=K[0];Q[3*Z+1]=K[1];Q[3*Z+2]=K[2];Y.length&&(N[0]=Y[3*Z],N[1]=Y[3*Z+1],N[2]=Y[3*Z+2],N[3]=0,z.transformMat4(N,v,N),Y[3*Z]=N[0],Y[3*Z+1]=N[1],Y[3*Z+2]=N[2]);J.length&&(U[0]=J[3*Z],U[1]=J[3*Z+1],U[2]=J[3*Z+2],U[3]=0,z.transformMat4(U,v,U),J[3*Z]=U[0],J[3*Z+1]=U[1],J[3*Z+2]=U[2])}}}l.rw(b)}return b};a.gz=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,
fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,
b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}}};b4w.module.__scenegraph=function(a,m){function b(a){a=pa.sa(a);a.Od=null;a.Va=null;a.ac=null;return a}function c(a,b){var c=[];M.ke(a,function(b,d,f){-1<c.indexOf(f)?M.xw(a,b,d,f,l(f)):c.push(f)});M.K(a,function(b,d){for(var f=0;f<d.W.length;f++){var e=d.W[f];-1<c.indexOf(e)?d.W[f]=l(e):c.push(e)}"ANTIALIASING"==d.type&&M.le(a,b,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.W.length;c++){var d=b.W[c];d.Y=fa.r;d.X=fa.r}})});M.K(a,function(c){var f={};h(a,c,f);for(var e in f){c=f[e];if(b)for(var g=
0;g<c.length;g++){var u=c[g];if("DEPTH"==u.D){if(d(u))throw"Failed to use renderbuffer as input texture: "+u.D+"->"+u.S;u.Jg=!0}}u=c[0];for(g=0;g<c.length;g++)if(c[g].Y==fa.r){u=c[g];break}for(var H=c[0],g=0;g<c.length;g++)if(c[g].X==fa.r){H=c[g];break}for(var k=c[0],g=0;g<c.length;g++)if(!c[g].Jg){k=c[g];break}for(g=0;g<c.length;g++)c[g].Y=u.Y,c[g].X=H.X,c[g].Jg=k.Jg}})}function h(a,b,c){M.le(a,b,function(b,d,f){f.wa&&f.D==f.S&&(c[f.D]=c[f.D]||[],-1==c[f.D].indexOf(f)&&c[f.D].push(f),h(a,b,c))});
M.me(a,b,function(a,b,d){d.wa&&(c[d.D]=c[d.D]||[],-1==c[d.D].indexOf(d)&&c[d.D].push(d))});b=M.Ba(a,b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.W.length;d++){var f=b.W[d];c[f.D].push(f)}}function d(a){switch(a.S){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "NONE":return!1;default:return!0}}function l(a){if(a.oa)throw"Failed to clone slink with attached texture";return pa.Fd(a)}function k(a){var b=M.lq(a),c=[];M.K(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var g=
[];break;default:g=c}for(var u=0;u<d.W.length;u++){var h=d.W[u],H=f(g,h,e(h));h.oa=H;d.Oc[u]=H}for(u=0;u<d.Oc.length;u++)H=d.Oc[u],z(g,H);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":g=[]}M.me(b,a,function(c,d,u){if((c=n(b,a,u.D))&&u.wa&&!u.oa){d=g;for(var h=c,H=0;H<d.length;H++){var k=d[H];k.Sl===h&&k.Lh++}}else c=f(g,u,e(u));u.oa=c});M.le(b,a,function(a,b,c){z(g,c.oa)});M.me(b,a,function(a,b,c){c.oa&&"NONE"==c.S&&z(g,c.oa)})})}function g(a){s(a,
function(b,c,d){b.Hg&&(T(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||T(a,d,"ANTIALIASING"))&&(b.ge*=ab.resolution_factor)})}function e(a){a=pa.Fd(a);delete a.S;delete a.wa;return JSON.stringify(a)}function n(a,b,c){var d=null;M.le(a,b,function(a,b,f){if(f.wa&&f.D==f.S&&f.D==c&&f.oa)return d=f.oa,!0});M.me(a,b,function(a,b,f){if(f.wa&&f.D==c&&f.oa)return d=f.oa,!0});return d}function z(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.Sl===b&&d.Lh&&d.Lh--}}function f(a,b,c){for(var d=
null,f=0;f<a.length;f++){var e=a[f];if(e.id==c&&0===e.Lh){d=e;break}}if(d)return d.Lh++,d.Sl;b=t(b);a.push({id:c,Lh:1,Sl:b});return b}function t(a){var b=a.ge*a.size;switch(a.D){case "COLOR":var c=fa.zi("COLOR",fa.ue);fa.resize(c,b,b);fa.sj(c,a.Y,a.X);return c;case "DEPTH":return a.Jg?(c=fa.zi("DEPTH_RBUF",fa.Ef),fa.resize(c,b,b)):(c=fa.zi("DEPTH_TEX",fa.Qg),fa.resize(c,b,b),fa.sj(c,a.Y,a.X)),c;case "CUBEMAP":return c=fa.ot(b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.D;}}function s(a,
b){var c=!1;M.ke(a,function(d,f,e){if(e&&(d=M.Ba(a,d),f=M.Ba(a,f),b(e,!1,d,f)))return c=!0});c||M.K(a,function(a,c){for(var d=0;d<c.W.length;d++)if(b(c.W[d],!0,c,null))return!0})}function r(a){M.K(a,function(b,c){if("SINK"!=c.type){var d=c.h;M.me(a,b,function(a,b,c){c.wa&&c.oa&&(ka.rj(d,c.D,c.oa),c.D==c.S&&b.h&&ka.rj(b.h,c.D,c.oa))});for(var f=0;f<c.W.length;f++){var e=c.W[f];e.wa&&e.D==e.S&&ka.rj(d,e.D,c.Oc[f])}!d.Va&&!d.ac||d.Od||(d.Od=ua.Bp(d.Va,d.ac))}})}function p(a,b){var c=F("SHADOW_CAST");
c.tk=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;c.h=ka.fb(ka.Sg);return c}function F(a){return{type:a,ka:!1,lp:!1,$j:!1,bj:!1,bh:0,time:0,h:null,vn:null,ab:null,l:[],W:[],Oc:[],Zh:new Float32Array(3),Hq:new Float32Array(3),Fb:new Float32Array(3),Bb:new Float32Array(4),Ac:new Float32Array(16),Md:0,lf:0,$e:null,cf:null,Ze:null,af:null,bf:null,bc:new Float32Array(3),lc:new Float32Array(3),gq:new Float32Array([1,1,1]),zj:new Float32Array(3),hq:new Float32Array(4),pg:null,Li:0,Bk:0,rh:!1,
nh:new Float32Array(3),oe:0,za:null,Nj:!1,de:new Float32Array(2),ee:new Float32Array(2),ng:0,bg:0,jk:0,uc:null,qe:0,Cf:0,pe:0,He:!1,Ym:0,Zm:new Float32Array(2),Xm:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,og:new Float32Array(3),wg:0,rg:0,sg:0,ug:0,tg:0,vg:0,qg:0,Yp:0,ssao_only:0,brightness:0,contrast:0,exposure:0,
saturation:0,god_rays_intensity:0,ag:0,oj:0,zg:0,tk:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,vq:null,Mm:null,pf:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,Qm:0,Fn:0,Yi:0,Zi:0,So:0,Hh:"",Hv:new Float32Array(2),P:!0,enqueue:!0,aa:!0,da:!0,Ab:!0,va:!0}}function q(a,b,c,d,f){return{D:a,S:b,size:c,ge:d,Hg:f,wa:!0,oa:null,Jg:!1,Y:fa.mc,X:fa.mc}}function v(){var a=F("GRASS_MAP");a.h=ka.fb(ka.Rg);return a}function x(a){var b=F("POSTPROCESSING");b.aa=!1;b.da=!1;b.Ab=!1;b.h=ka.fb(ka.Ra);
b.Hh=a;return b}function A(a){var b=F("BLOOM_BLUR");b.aa=!1;b.da=!1;b.Ab=!1;b.h=ka.fb(ka.Ra);b.Hh=a;return b}function L(a,b,c,d,f,e,g,u){var h=F("MAIN_"+a);if("OPAQUE"===a)h.aa=!0,h.da=c,h.ka=!1;else if("BLEND"===a)h.aa=!1,h.da=!1,h.ka=!0;else if("XRAY"===a)h.aa=!1,h.da=!0,h.ka=!0;else if("REFLECT"===a)h.aa=!0,h.da=!0,h.ka=!1;else throw"wrong main subscene type";h.ka&&u&&(h.self_shadow_normal_offset=u.self_shadow_normal_offset);h.h=b;h.bc.set(g.bc);h.lc.set(g.lc);h.Md=g.Md;h.pg=g.pg;h.Bb=e;d&&(h.za=
d,d.Bb&&(h.uc=new Float32Array(d.Bb)),h.qe=d.waves_height,h.Cf=d.waves_length,h.pe=d.pe,d.si&&(h.He=!0,h.Ym=d.si,h.Zm.set(d.lk),h.Xm=d.kk),d.vj&&(h.Nj=!0,a=d.cx,h.de[0]=(a[0]+a[1])/2,h.de[1]=(a[2]+a[3])/2,h.ee[0]=a[0]-a[1],h.ee[1]=a[2]-a[3],h.ng=d.ng,h.bg=d.bg));h.$e=new Float32Array(3*f);h.cf=new Float32Array(3*f);h.Ze=new Float32Array(3*f);h.af=new Float32Array(4*f);h.bf=new Float32Array(4*f);return h}function I(a,b){var c=F("COLOR_PICKING");b&&(c.type+="_XRAY",c.aa=!1,c.da=!0);c.enqueue=!1;c.h=
a;return c}function y(a){var b=F("WIREFRAME");b.P=!1;b.aa=!1;b.da=!1;b.h=a;return b}function C(a,b){var c=F("DEPTH");c.h=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function B(a){var b=F("DEPTH_PACK");b.aa=!1;b.da=!1;b.h=a;return b}function G(a,b,c){var d=F("SSAO");d.aa=!1;d.da=!1;d.Ab=!1;d.h=a;d.Bb=b;d.uc=new Float32Array(b);d.wg=c.radius_increase;d.rg=c.dithering_amount/1E3;d.sg=c.gauss_center;d.ug=c.gauss_width_square;d.tg=c.gauss_width_left_square;d.vg=c.influence;d.qg=
c.dist_factor;d.Yp=c.Cw;return d}function K(){var a=F("ANTIALIASING");a.aa=!1;a.da=!1;a.Ab=!1;a.h=ka.fb(ka.Ra);return a}function N(a){var b=F(a);b.aa="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.da=!1;b.Ab=!1;b.h=ka.fb(ka.Ra);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.Iv=new Float32Array(4));return b}function V(a,b,c,d){var f=F("COMPOSITING");f.aa=!1;f.da=!1;f.Ab=!1;f.h=ka.fb(ka.Ra);f.brightness=a;f.contrast=b;f.exposure=c;f.saturation=d;return f}function U(a,b){var c=F("MOTION_BLUR");
c.aa=!1;c.da=!1;c.Ab=!1;c.h=ka.fb(ka.Ra);c.$j=!0;c.Yi=a;c.Zi=b;return c}function O(a){var b=F("DOF");b.aa=!1;b.da=!1;b.Ab=!1;b.h=a;return b}function J(a){var b=F("GLOW_MASK");b.h=a;b.Ab=!1;return b}function Q(a){var b=F("GLOW");b.nh.set(a.nh);b.Li=a.Li;b.Fn=5;b.Qm=3;b.Ab=!1;b.h=ka.fb(ka.Ra);return b}function Y(){var a=F("REFRACT");a.aa=!1;a.da=!1;a.Ab=!1;a.h=ka.fb(ka.Ra);return a}function P(a,b,c,d,f,e,g){var u=F("GOD_RAYS");u.aa=!1;u.da=!1;u.Ab=!1;u.bc[0]=1;u.bc[1]=1;u.bc[2]=1;u.lc[0]=1;u.lc[1]=
1;u.lc[2]=1;u.Md=1;u.lp=d;u.oe=b;u.oj=f;u.ag=c;u.zg=g;u.h=a;u.lf=e;u.$e=new Float32Array(3*e);u.cf=new Float32Array(3*e);u.Ze=new Float32Array(3*e);u.af=new Float32Array(4*e);u.bf=new Float32Array(4*e);return u}function X(a,b){var c=F("GOD_RAYS_COMBINE");c.aa=!1;c.da=!1;c.Ab=!1;c.h=ka.fb(ka.Ra);c.god_rays_intensity=a;c.lf=b;c.$e=new Float32Array(3*b);c.cf=new Float32Array(3*b);c.Ze=new Float32Array(3*b);c.af=new Float32Array(4*b);c.bf=new Float32Array(4*b);return c}function Z(a,b){var c=F("SKY");
c.enqueue=!1;c.aa=!1;c.da=!1;c.Ab=!1;var d=ka.fb(ka.Ra);d.width=bb.ah;d.height=bb.ah;c.h=d;c.vn=pa.Cu();c.lf=a;c.$e=new Float32Array(3*a);c.cf=new Float32Array(3*a);c.Ze=new Float32Array(3*a);c.af=new Float32Array(4*a);c.bf=new Float32Array(4*a);c.bc[0]=1;c.bc[1]=1;c.bc[2]=1;c.lc[0]=1;c.lc[1]=1;c.lc[2]=1;c.Md=1;c.og.set(b.og);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;
c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function S(){var a=F("SCREEN");a.aa=!1;a.da=!1;a.h=ka.fb(ka.Ra);return a}function da(){var a=F("ANAGLYPH");a.aa=!1;a.da=!1;a.h=ka.fb(ka.Ra);return a}function D(){var a=F("LUMINANCE");a.aa=!1;a.da=!1;a.h=ka.fb(ka.Ra);
return a}function ia(){var a=F("AVERAGE_LUMINANCE");a.aa=!1;a.da=!1;a.h=ka.fb(ka.Ra);return a}function R(a,b,c,d){var f=F("LUMINANCE_TRUNCED");f.aa=!1;f.da=!1;f.bloom_key=a;f.bloom_edge_lum=b;f.h=d;f.$e=new Float32Array(3*c);f.cf=new Float32Array(3*c);f.Ze=new Float32Array(3*c);f.af=new Float32Array(4*c);f.bf=new Float32Array(4*c);return f}function w(a){var b=F("BLOOM");b.aa=!1;b.da=!1;b.h=ka.fb(ka.Ra);b.bloom_blur=a;return b}function u(){var a=F("SINK");a.enqueue=!1;return a}function T(a,b,c){if(b.type===
c)return!0;b=H(a,b);for(var d=0;d<b.length;d++)if(T(a,b[d],c))return!0;return!1}function ma(a,b,c){if(b.type===c)return!0;b=ea(a,b);for(var d=0;d<b.length;d++)if(ma(a,b[d],c))return!0;return!1}function W(a,b,c){if(b.type===c)return b;b=ea(a,b);for(var d=0;d<b.length;d++){var f=W(a,b[d],c);if(f)return f}return null}function ea(a,b){var c=M.xh(a,b);if(c==M.mm)throw"Subscene not in graph";for(var d=[],f=M.vo(a,c),e=0;e<f;e++){var g=M.Ii(a,c,e);g!=c&&d.push(M.Ba(a,g))}return d}function H(a,b){var c=M.xh(a,
b);if(c==M.mm)throw"Subscene not in graph";for(var d=[],f=M.fg(a,c),e=0;e<f;e++){var g=M.Uf(a,c,e);g!=c&&d.push(M.Ba(a,g))}return d}function ca(a){var b=[],c=[];s(a,function(a){a.oa&&-1==b.indexOf(a.oa)&&(b.push(a.oa),c.push(a.oa,b.length-1))});return c}function ja(a,b){var c;c=""+(a.D+"\\n");c+="NONE"!=a.S?a.S+"\\n":"";c+="(";if(a.Hg){var d=a.ge;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.D){c+=" ";if(a.Jg)c+="RR";else{var d=a.Y,f=a.X,
e="";d==fa.r?e+="L":d==fa.mc&&(e+="N");f==fa.r?e+="L":f==fa.mc&&(e+="N");c+=e}for(d=0;d<b.length;d+=2)b[d]==a.oa&&(c+=" "+b[d+1])}return c+")\\n"}var ka=m("__camera"),ha=m("__config"),ta=m("__debug"),M=m("__graph"),ua=m("__renderer"),fa=m("__textures"),pa=m("__util");m("vec4");var Ta=ha.dh,ab=ha.p,bb=ha.ig;a.At=function(a,d){var f=M.create(),e=a.N[0],h=d.Fo,H=d.Gq,n=d.Bb,l=d.za,p=L("OPAQUE",e,!0,l,h,n,H);M.n(f,p);var w=L("BLEND",e,!0,l,h,n,H,null);M.n(f,w);M.i(f,p,w,q("SCREEN","NONE",1,1,!0));if(d.kc){var T=
L("XRAY",e,!1,l,h,n,H,null);M.n(f,T);M.i(f,w,T,q("SCREEN","NONE",1,1,!0))}H=u();M.n(f,H);ab.wireframe_debug?(e=y(e),M.n(f,e),d.kc?M.i(f,T,e,q("SCREEN","NONE",1,1,!0)):M.i(f,w,e,q("SCREEN","NONE",1,1,!0)),M.i(f,e,H,q("SCREEN","NONE",1,1,!0))):M.i(f,w,H,q("SCREEN","NONE",1,1,!0));d.pk&&(e=b(p.h),a.N.push(e),w=I(e,!1),M.n(f,w),d.kc?(e=b(p.h),a.N.push(e),p=I(e,!0),M.n(f,p),M.i(f,w,p,q("COLOR","COLOR",1,1,!0)),M.i(f,p,H,q("COLOR","NONE",1,1,!0)),M.i(f,p,H,q("DEPTH","NONE",1,1,!0))):(M.i(f,w,H,q("COLOR",
"NONE",1,1,!0)),M.i(f,w,H,q("DEPTH","NONE",1,1,!0))));d.Jh&&(h=Z(h,d.Qp),M.n(f,h),M.i(f,h,H,q("CUBEMAP","u_sky",bb.ah,1,!1)));c(f,!0);1<ab.resolution_factor&&g(f);k(f);r(f);return f};a.Zs=d;a.Mx=s;a.zt=function(a,d,f){var e=M.create(),h=[],H=[],n=[],l=[],T=[],s=[],ca=[],t=[],z=[],F=[],W=[],ma=d.Fo,ea=d.za,m=d.zl,ja=d.wf,ua=d.Wf,ic=d.$d,eb=d.sw,Uc=d.Gf,Vc=d.cg,Qc=d.Jf,ha=d.antialiasing,Yb=d.Gq,nb=d.Bb,Va=d.Ic,Eb=d.Tv,jc=d.Gs,Zb=d.Rs,Sb=d.nv,Tb=d.kv,$b=d.Mf,wa=[];if(ab.anaglyph_use&&!a){var ob=f.N[0],
wb=b(ob);ka.Po(ob,ka.mb);ka.Po(wb,ka.vb);wa.push(ob,wb);f.N.push(wb)}else{var sa=f.N[0];wa.push(sa)}if(m){var pb=Va.csm_num;if(!pb)throw"Zero CSM sections is forbidden";ka.Hj(wa[0],Va);for(var aa=0;aa<pb;aa++){var Ka=p(aa,Va);M.n(e,Ka);F.push(Ka);var Wa=Va.csm_resolution,sa=Ka.h;sa.width=Wa;sa.height=Wa;Ka.aa=!1;W.push(q("DEPTH","u_shadow_map"+aa,Wa,1,!1));ta.an()&&Ka.W.push(q("COLOR","COLOR",Wa,1,!1))}}if(0<eb.length&&!a)for(aa=0;aa<wa.length;aa++){sa=b(wa[aa]);f.N.push(sa);var la=L("REFLECT",sa,
!1,ea,ma,nb,Yb);la.ab=eb[0];la.h.ab=eb[0];M.n(e,la);s.push(la);ca.push(q("COLOR","u_reflectmap",1,ab.Nh,!0));la.W.push(q("DEPTH","DEPTH",1,ab.Nh,!0))}h=[];H=[];if(d.xa){var Ba=v();M.n(e,Ba);Wa=bb.Ni;Ba.h.width=Wa;Ba.h.height=Wa;var xb=q("DEPTH","u_grass_map_depth",Wa,1,!1);xb.Y=fa.r;xb.X=fa.r;var fb=q("COLOR","u_grass_map_color",Wa,1,!1);fb.Y=fa.r;fb.X=fa.r}else fb=xb=Ba=null;for(aa=0;aa<wa.length;aa++){var sa=wa[aa],qa=b(sa);f.N.push(qa);if(m){var na=C(qa,Va);M.n(e,na);for(var ya=0;ya<F.length;ya++){var Ka=
F[ya],yb=W[ya];M.i(e,Ka,na,yb)}var kc=q("COLOR","u_color",1,1,!0),ac=q("DEPTH","u_depth",1,1,!0);if(ja){var bc=b(sa);f.N.push(bc);var Ib=G(bc,nb,d.ux);M.n(e,Ib);var qb=q("COLOR","u_shadow_mask",1,1,!0);M.i(e,na,Ib,kc);M.i(e,na,Ib,ac)}var Jb=b(qa);f.N.push(Jb);var gb=B(Jb);M.n(e,gb);M.i(e,na,gb,q("DEPTH","u_depth",1,1,!0));n.push(gb);var Qa=q("DEPTH","DEPTH",1,1,!0);T.push(Qa)}else na=C(qa,Va),M.n(e,na),Qa=q("DEPTH","DEPTH",1,1,!0),T.push(Qa),ta.an()&&na.W.push(q("COLOR","COLOR",1,1,!0)),Jb=b(qa),
f.N.push(Jb),gb=B(Jb),M.n(e,gb),M.i(e,na,gb,q("DEPTH","u_depth",1,1,!0)),n.push(gb);Ba&&(M.i(e,Ba,na,xb),M.i(e,Ba,na,fb));la=L("OPAQUE",sa,!1,ea,ma,nb,Yb);M.n(e,la);H.push(la);M.i(e,na,la,T[aa]);qb?M.i(e,Ib,la,qb):M.i(e,na,la,q("COLOR","u_shadow_mask",1,1,!0));var Kb=q("COLOR","u_color",1,1,!0);l.push(q("COLOR","COLOR",1,1,!0));Ba&&(M.i(e,Ba,la,xb),M.i(e,Ba,la,fb));s.length&&(M.i(e,s[aa],la,ca[aa]),la.ab=eb[0])}h=H;H=[];if(!a&&d.pk){sa=b(h[0].h);f.N.push(sa);var rb=I(sa,!1);M.n(e,rb);if(d.kc){sa=
b(h[0].h);f.N.push(sa);var Ca=I(sa,!0);M.n(e,Ca);M.i(e,rb,Ca,q("COLOR","COLOR",1,1,!0));M.i(e,rb,Ca,q("DEPTH","DEPTH",1,1,!0))}}else rb=null;if(ic&&!a)for(aa=0;aa<wa.length;aa++){var Xa=Y();M.n(e,Xa);M.i(e,h[aa],Xa,Kb);t.push(Xa);z.push(q("COLOR","u_refractmap",1,1,!0))}for(var Lb=[],aa=0;aa<wa.length;aa++){na=n[aa];sa=b(wa[aa]);f.N.push(sa);la=L("BLEND",sa,!1,ea,ma,nb,Yb,Va);H.push(la);M.n(e,la);M.i(e,h[aa],la,l[aa]);M.i(e,h[aa],la,T[aa]);Ba&&(M.i(e,Ba,la,xb),M.i(e,Ba,la,fb));for(ya=0;ya<F.length;ya++)Ka=
F[ya],yb=W[ya],M.i(e,Ka,la,yb);if("DEPTH_PACK"==na.type){var va=q("COLOR","u_scene_depth",1,1,!0);va.Y=fa.mc;va.X=fa.mc}else va=q("DEPTH","u_scene_depth",1,1,!0),va.Y=fa.r,va.X=fa.r;M.i(e,na,la,va);s.length&&(M.i(e,s[aa],la,ca[aa]),la.ab=eb[0]);t.length&&M.i(e,t[aa],la,z[aa]);Lb.push(la)}h=H;H=[];if(d.kc){for(aa=0;aa<wa.length;aa++){na=n[aa];sa=b(wa[aa]);f.N.push(sa);la=L("XRAY",sa,!1,ea,ma,nb,Yb,Va);H.push(la);M.n(e,la);M.i(e,h[aa],la,l[aa]);M.i(e,h[aa],la,T[aa]);Ba&&(M.i(e,Ba,la,xb),M.i(e,Ba,la,
fb));for(ya=0;ya<F.length;ya++)Ka=F[ya],yb=W[ya],M.i(e,Ka,la,yb);"DEPTH_PACK"==na.type?(va=q("COLOR","u_scene_depth",1,1,!0),va.Y=fa.mc,va.X=fa.mc):(va=q("DEPTH","u_scene_depth",1,1,!0),va.Y=fa.r,va.X=fa.r);M.i(e,na,la,va);s.length&&(M.i(e,s[aa],la,ca[aa]),la.ab=eb[0]);t.length&&M.i(e,t[aa],la,z[aa])}h=H;H=[]}if(ab.wireframe_debug){for(aa=0;aa<wa.length;aa++){sa=pa.sa(wa[aa]);f.N.push(sa);var La=y(sa);H.push(La);M.n(e,La);M.i(e,h[aa],La,l[aa]);M.i(e,h[aa],La,T[aa]);Ba&&(M.i(e,Ba,La,xb),M.i(e,Ba,La,
fb))}h=H;H=[]}if(ua&&!a){for(aa=0;aa<wa.length;aa++){var Ia=Sb.ag,cc=Sb.yv,Ma=Sb.zg,oa=h[aa],Ya=ea?1:0,E=q("DEPTH","u_input",1,1,!0);E.Y=fa.r;E.X=fa.r;var Da=q("COLOR","u_input",1,.25,!0);Da.Y=fa.r;Da.X=fa.r;var ra=Ia/Ma,jb=b(wa[aa]);f.N.push(jb);var xa=P(jb,Ya,Ia,!0,ra,ma,Ma);M.n(e,xa);M.i(e,oa,xa,E);var ra=Ia/Ma*.5,ba=b(wa[aa]);f.N.push(ba);var Za=P(ba,Ya,Ia,!1,ra,ma,Ma);M.n(e,Za);M.i(e,xa,Za,Da);var ra=Ia/Ma*.25,dc=b(wa[aa]);f.N.push(dc);var zb=P(dc,Ya,Ia,!1,ra,ma,Ma);M.n(e,zb);M.i(e,Za,zb,Da);
s.length&&(xa.ab=eb[0],Za.ab=eb[0],zb.ab=eb[0]);var Ab=X(cc,ma);H.push(Ab);M.n(e,Ab);M.i(e,oa,Ab,q("COLOR","u_main",1,1,!0));M.i(e,zb,Ab,q("COLOR","u_god_rays",1,1,!0))}h=H;H=[]}if(Uc&&!a){for(aa=0;aa<wa.length;aa++){var oa=h[aa],Bb=D();M.n(e,Bb);M.i(e,oa,Bb,q("COLOR","u_input",1,1,!0));var Cb=ia();M.n(e,Cb);Cb.h.width=1;Cb.h.height=1;var Mb=q("COLOR","u_input",1,.25,!0);Mb.Y=fa.r;Mb.X=fa.r;var Nb=q("COLOR","u_luminance",1,.25,!0);Nb.Y=fa.r;Nb.X=fa.r;M.i(e,Bb,Cb,Mb);var Ea=jc.key,Fa=jc.eu,Ra=b(wa[aa]);
f.N.push(Ra);var Ob=R(Ea,Fa,ma,Ra);M.n(e,Ob);M.i(e,oa,Ob,q("COLOR","u_main",1,1,!0));M.i(e,Bb,Ob,Nb);M.i(e,Cb,Ob,q("COLOR","u_average_lum",1,1,!1));var cb=q("COLOR","u_color",1,.25,!0);cb.Y=fa.r;cb.X=fa.r;var Fb=A("X_BLUR");M.n(e,Fb);M.i(e,Ob,Fb,cb);var kb=A("Y_BLUR");M.n(e,kb);M.i(e,Fb,kb,cb);var Pb=w(jc.blur);M.n(e,Pb);var sb=q("COLOR","u_bloom",1,.25,!0);sb.Y=fa.r;sb.X=fa.r;M.i(e,kb,Pb,sb);M.i(e,oa,Pb,q("COLOR","u_main",1,1,!0));H.push(Pb)}h=H;H=[]}if(Vc&&!a){for(aa=0;aa<h.length;aa++){var Qb=
h[aa],hb=U(Eb.Yi,Eb.Zi);H.push(hb);M.n(e,hb);M.i(e,Qb,hb,q("COLOR","u_mb_tex_curr",1,1,!0));hb.W.push(q("COLOR","u_mb_tex_accum",1,1,!0))}h=H;H=[]}if($b&&!a){for(aa=0;aa<h.length;aa++){var oa=h[aa],Ub=b(wa[aa]);f.N.push(Ub);cb=q("COLOR","u_color",1,1,!0);cb.Y=fa.r;cb.X=fa.r;var tb=x("X_BLUR");M.n(e,tb);M.i(e,oa,tb,cb);var ub=x("Y_BLUR");M.n(e,ub);M.i(e,tb,ub,cb);var na=Lb[aa],Vb=O(Ub);Ub.dof_distance=f.dof_distance;Ub.Ne=f.Ne;Ub.dof_front=f.dof_front;Ub.dof_rear=f.dof_rear;Ub.dof_power=f.dof_power;
Ub.dof_on=1;H.push(Vb);M.n(e,Vb);M.i(e,oa,Vb,q("COLOR","u_sharp",1,1,!0));M.i(e,ub,Vb,q("COLOR","u_blurred",1,1,!0));M.i(e,na,Vb,q("DEPTH","u_depth",1,1,!0))}h=H;H=[]}if(!a&&d.glow){for(aa=0;aa<wa.length;aa++){var oa=h[aa],ib=b(wa[aa]);f.N.push(ib);var vc=J(ib);M.n(e,vc);var rc=x("X_EXTEND"),sc=q("COLOR","u_color",1,1,!0),Dc=q("COLOR","u_glow_mask",1,1,!0);rc.rh=!0;M.n(e,rc);M.i(e,vc,rc,sc);var za=q("COLOR","u_color",1,.5,!0);za.Y=fa.r;za.X=fa.r;var lc=x("Y_EXTEND");lc.rh=!0;M.n(e,lc);M.i(e,rc,lc,
za);tb=x("X_BLUR");tb.rh=!0;M.n(e,tb);M.i(e,lc,tb,za);var Ec=q("COLOR","u_color",1,.25,!0);Ec.Y=fa.r;Ec.X=fa.r;var wc=q("COLOR","u_glow_mask_blurred",1,.25,!0);wc.Y=fa.r;wc.X=fa.r;ub=x("Y_BLUR");ub.rh=!0;M.n(e,ub);M.i(e,tb,ub,Ec);var xc=Q(Tb);M.n(e,xc);M.i(e,oa,xc,q("COLOR","u_glow_src",1,1,!0));M.i(e,vc,xc,Dc);M.i(e,ub,xc,wc);H.push(xc)}h=H;H=[]}if(Qc&&!a){for(aa=0;aa<h.length;aa++){var oa=h[aa],Fc=V(Zb.brightness,Zb.contrast,Zb.exposure,Zb.saturation);M.n(e,Fc);M.i(e,oa,Fc,q("COLOR","u_color",1,
1,!0));H.push(Fc)}h=H;H=[]}if(ha&&!a){for(aa=0;aa<h.length;aa++)if(oa=h[aa],ab.smaa){var yc=q("COLOR","u_color",1,1,!0);yc.Y=fa.r;yc.X=fa.r;var Rc=N("SMAA_EDGE_DETECTION");M.n(e,Rc);M.i(e,oa,Rc,yc);var zc=N("SMAA_BLENDING_WEIGHT_CALCULATION");M.n(e,zc);M.i(e,Rc,zc,yc);var Sc=q("COLOR","u_search_tex",1,1,!1),Gc=q("COLOR","u_area_tex",1,1,!1);Sc.Y=fa.r;Sc.X=fa.r;Gc.Y=fa.r;Gc.X=fa.r;zc.W.push(Sc);zc.W.push(Gc);var Wb=N("SMAA_NEIGHBORHOOD_BLENDING");M.n(e,Wb);M.i(e,oa,Wb,yc);var mc=q("COLOR","u_blend",
1,1,!0);mc.Y=fa.r;mc.X=fa.r;M.i(e,zc,Wb,mc);H.push(Wb)}else{var ec=K();M.n(e,ec);var Hc=q("COLOR","u_color",1,1,!0);Hc.Y=fa.r;Hc.X=fa.r;M.i(e,oa,ec,Hc);if(1<ab.resolution_factor){var Ic=x("NONE");M.n(e,Ic);M.i(e,ec,Ic,Hc);H.push(Ic)}else H.push(ec)}h=H;H=[]}if(ab.anaglyph_use&&!a){var Ac=da();M.n(e,Ac);M.i(e,h[0],Ac,q("COLOR","u_sampler_left",1,1,!0));M.i(e,h[1],Ac,q("COLOR","u_sampler_right",1,1,!0));H.push(Ac)}else H.push(h[0]);var Wc=M.xh(e,h[0]),Jc=!1;M.le(e,Wc,function(a,b,c){if(c.D==c.S)return Jc=
!0});if(Jc||a){var Lc=S();M.n(e,Lc);M.i(e,h[0],Lc,q("COLOR","u_color",1,1,!0));h=H;H=[];H.push(Lc)}rb&&(Ca?H.push(Ca):H.push(rb));if(!a&&d.Jh){var Gb=Z(ma,d.Qp);M.n(e,Gb);H.push(Gb)}if(Ta.enabled){var Mc=x("NONE");M.n(e,Mc);var nc=null,fc=0;M.K(e,function(a,b){if(b.type==Ta.Dx){if(fc==Ta.Cx)return nc=b,!0;fc++}});if(nc){var tc=M.xh(e,nc);M.ke(e,function(a,b,c){if(a==tc)return M.i(e,nc,Mc,q(Ta.ex,"u_color",c.size,c.ge,c.Hg)),!0})}}var oc=u();M.n(e,oc);for(aa=0;aa<H.length;aa++)switch(H[aa].type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":M.i(e,
H[aa],oc,q("COLOR","NONE",1,1,!0));M.i(e,H[aa],oc,q("DEPTH","NONE",1,1,!0));break;case "SKY":M.i(e,Gb,oc,q("CUBEMAP","u_sky",bb.ah,1,!1));break;default:M.i(e,H[aa],Ta.enabled?Mc:oc,q("SCREEN","NONE",1,1,!0))}Ta.enabled&&M.i(e,Mc,oc,q("SCREEN","NONE",.5,.5,!0));for(var ga=M.bo(e),aa=0;aa<ga.length;aa++)for(var Ga=ga[aa],ya=0;ya<n.length;ya++)na=n[ya],M.Ba(e,Ga)==na&&M.hg(e,Ga);c(e,!1);1<ab.resolution_factor&&g(e);k(e);r(e);return e};a.Vz=F;a.tz=function(a){var b=null;M.K(a,function(a,c){return c.h&&
null===c.h.Od?(b=c,!0):!1});return b};a.Wa=function(a,b,c){a=ea(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.Pz=T;a.tv=ma;a.ru=W;a.Wn=ea;a.Jz=H;a.Ia=function(a,b){var c=null;M.K(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.Pt=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=ca(a);M.K(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g,
" ");"POSTPROCESSING"==d.type&&(f+=" ("+d.Hh.replace(/_/g," ")+")");if(d.h){for(var f=f+"\\n",g=0;g<c.length;g+=2)c[g]==d.h.Va&&(f+="C"+c[g+1]+" ");for(g=0;g<c.length;g+=2)c[g]==d.h.ac&&(f+="D"+c[g+1])}d.W.length&&(f+="\\n-----\\n");for(g=0;g<d.W.length;g++)f+=ja(d.W[g],c);g="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(g+",bold")+'"];\n')});M.ke(a,function(a,d,f){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+ja(f,c)+'" style="'+(f.wa?
"solid":"dotted")+'"];\n'});return b+="}"};a.tn=function(a){a=M.Jx(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,m){function b(){return{name:"",type:0,source:"",width:0,height:0,Yg:1,gi:!0,canvas:null,Qs:null,Eb:0,Oa:null,Ng:null}}function c(a){f.texParameteri(a,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(a,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.texParameteri(a,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(a,f.TEXTURE_MIN_FILTER,f.LINEAR)}function h(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function d(a,b){(a>
z.il||b>z.il)&&n.ba("Maximum texture size exceeded")}var l=m("__config"),k=m("__print"),g=m("__dds"),e=m("__extensions"),n=m("__util"),z=l.p;a.mc=0;a.r=0;a.Rr=0;a.Pr=0;a.Qr=0;a.Or=0;a.ue=10;a.Qj=20;a.ci=30;a.di=40;a.Qg=50;a.Ef=60;var f=null,t;a.tc=function(b){t=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.mc=b.NEAREST;a.r=b.LINEAR;a.Rr=b.NEAREST_MIPMAP_NEAREST;a.Pr=b.LINEAR_MIPMAP_NEAREST;a.Qr=b.NEAREST_MIPMAP_LINEAR;a.Or=b.LINEAR_MIPMAP_LINEAR;
f=b};a.zi=function(c,d){var e=b();e.name=c;e.type=d;e.source="NONE";if(d==a.Ef)e.Ng=f.createRenderbuffer();else{var g=f.TEXTURE_2D,h=f.createTexture();f.bindTexture(g,h);f.texParameteri(g,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(g,f.TEXTURE_MIN_FILTER,f.LINEAR);f.texParameteri(g,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(g,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.bindTexture(g,null);e.Eb=g;e.Oa=h}return e};a.ot=function(c){var d=f.createTexture(),e=f.TEXTURE_CUBE_MAP;f.bindTexture(e,d);f.texParameteri(e,
f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(e,f.TEXTURE_MIN_FILTER,f.LINEAR);f.texParameteri(e,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(e,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);for(var g="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),h=0;6>h;h++)f.texImage2D(f[g[h]],0,f.RGBA,c,c,0,f.RGBA,f.UNSIGNED_BYTE,null);f.bindTexture(e,null);e=b();e.name="CUBEMAP";e.type=
a.ue;e.source="NONE";e.width=3*c;e.height=2*c;e.Yg=1;e.Oa=d;e.Eb=f.TEXTURE_CUBE_MAP;return e};a.sj=function(b,c,d){if(b.type!=a.Ef){var e=b.Eb;f.bindTexture(e,b.Oa);c&&f.texParameteri(e,f.TEXTURE_MIN_FILTER,c);d&&f.texParameteri(e,f.TEXTURE_MAG_FILTER,d);f.bindTexture(e,null)}};a.Hz=function(b){if(b.type==a.Ef)return{min:a.mc,Mv:a.mc};var c=b.Eb;f.bindTexture(c,b.Oa);b=f.getTexParameter(c,f.TEXTURE_MIN_FILTER);var d=f.getTexParameter(c,f.TEXTURE_MAG_FILTER);f.bindTexture(c,null);return{min:b,Mv:d}};
a.resize=function(b,c,e){c=Math.max(c,1);e=Math.max(e,1);d(c,e);if(b.width!=c||b.height!=e){if(b.type==a.Ef)f.bindRenderbuffer(f.RENDERBUFFER,b.Ng),f.renderbufferStorage(f.RENDERBUFFER,f.DEPTH_COMPONENT16,c,e),f.bindRenderbuffer(f.RENDERBUFFER,null);else{var g=b.Eb;f.bindTexture(g,b.Oa);var h;switch(b.type){case a.ue:h=f.RGBA;break;case a.Qj:h=f.RGB;break;case a.ci:h=f.RGBA;break;case a.di:h=f.RGB;break;case a.Qg:h=f.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}var k;switch(b.type){case a.ue:k=
f.UNSIGNED_BYTE;break;case a.Qj:k=f.UNSIGNED_BYTE;break;case a.ci:k=f.FLOAT;break;case a.di:k=f.FLOAT;break;case a.Qg:k=f.UNSIGNED_INT;break;default:throw"Wrong texture type";}f.texImage2D(g,0,h,c,e,0,h,k,null);f.bindTexture(g,null)}b.width=c;b.height=e}};a.It=function(c,d,g){var h=c.type,q=new Uint8Array([204,204,204,255]),l=b();switch(h){case "IMAGE":g=f.createTexture();var x=f.TEXTURE_2D;f.bindTexture(x,g);f.texImage2D(x,0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,q);break;case "NONE":if(c.b4w_render_scene)if(g=
n.keysearch("name",c.b4w_render_scene,g))l.dj=g,g.um=!0,g=f.createTexture(),x=f.TEXTURE_2D,f.bindTexture(x,g),f.texImage2D(x,0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,q);else return;else return;break;case "ENVIRONMENT_MAP":g=f.createTexture();x=f.TEXTURE_CUBE_MAP;f.bindTexture(x,g);for(var A="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" "),m=0;6>m;m++)f.texImage2D(f["TEXTURE_CUBE_MAP_"+A[m]],0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,q);break;case "VORONOI":case "BLEND":return;
default:k.error('B4W warning: texture "'+c.name+'" has unsupported type "'+h+'"');return}"NONE"==h?f.texParameteri(x,f.TEXTURE_MIN_FILTER,f.LINEAR):f.texParameteri(x,f.TEXTURE_MIN_FILTER,t[z.Aj]);f.texParameteri(x,f.TEXTURE_MAG_FILTER,f.LINEAR);q=x;A=c.b4w_anisotropic_filtering;"DEFAULT"===A&&(A=d);"OFF"!==A&&z.hi&&(d=e.Nu())&&(A=parseFloat(A.split("x")[0]),f.texParameterf(q,d.TEXTURE_MAX_ANISOTROPY_EXT,A));"REPEAT"!=c.extension||"NONE"==h||c.b4w_shore_dist_map?(f.texParameteri(x,f.TEXTURE_WRAP_S,
f.CLAMP_TO_EDGE),f.texParameteri(x,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE)):(f.texParameteri(x,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(x,f.TEXTURE_WRAP_T,f.REPEAT));f.generateMipmap(x);f.bindTexture(x,null);l.name=c.name;l.type=a.ue;l.source=h;l.width=1;l.height=1;l.Yg=1;l.Oa=g;l.Eb=x;c.d=l};a.Jt=function(){var c=f.createTexture(),d=f.TEXTURE_2D;f.bindTexture(d,c);f.texParameteri(d,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(d,f.TEXTURE_MIN_FILTER,f.LINEAR);f.texParameteri(d,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);
f.texParameteri(d,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.bindTexture(d,null);var e=document.createElement("canvas");e.width=1;e.height=1;var g=e.getContext("2d"),h=b();h.name="HUD";h.type=a.ue;h.source="CANVAS";h.width=1;h.height=1;h.Yg=1;h.Oa=c;h.Eb=d;h.canvas=e;h.Qs=g;return h};a.Jj=function(a,b,n,l){var q=a.source,t=a.Eb;f.bindTexture(t,a.Oa);if(4==b.length){var z=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==q)z?(f.texImage2D(t,0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,b),a.width=
1,a.height=1):n?(g.by(f,e.$n(),b,!0),n=g.fo(b),h(n.width,n.height)&&(a.Lm||k.warn("B4W warning: using NPOT-texture",l),c(t)),a.width=n.width,a.height=n.height,a.Yg=g.Su(b)):(f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!0),d(b.width,b.height),f.texImage2D(t,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,b),a.width=b.width,a.height=b.height,h(b.width,b.height)?(a.Lm||k.warn("B4W warning: using NPOT-texture",l),c(t)):f.generateMipmap(t));else if("ENVIRONMENT_MAP"==q)if(n=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",
1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],z){for(z=0;6>z;z++)q=n[z],f.texImage2D(f["TEXTURE_CUBE_MAP_"+q[0]],0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1);for(var A=b.width/3,z=0;6>z;z++){var q=n[z],m=document.createElement("canvas");m.width=A;m.height=A;var I=m.getContext("2d");"POSITIVE_Y"==q[0]||"NEGATIVE_Y"==q[0]?(I.translate(0,A),I.scale(1,-1)):(I.translate(A,0),I.scale(-1,1));I.drawImage(b,q[1]*A,q[2]*A,A,A,0,
0,A,A);f.texImage2D(f["TEXTURE_CUBE_MAP_"+q[0]],0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,m)}a.width=3*A;a.height=2*A;h(b.width/3,b.height/2)?(k.warn("B4W warning: using NPOT cube map texture",l),c(t)):f.generateMipmap(t)}f.bindTexture(t,null)};a.Yt=function(a){f.deleteTexture(a)};a.th=function(a){return a&&a.name&&(a.Oa||a.Ng)?!0:!1};a.Bo=function(a){return a&&a.name&&a.Ng?!0:!1};a.aA=function(b){return b.type==a.ci||b.type==a.di?!0:!1};a.fv=function(b){var c=0;switch(b.type){case a.ue:case a.Qj:c=4;break;
case a.ci:case a.di:c=16;break;case a.Qg:c=3;break;case a.Ef:c=2}return c}};b4w.module.__assets=function(a,m){function b(){return z()?m(f.rb.oi).data:null}function c(){var a={ei:null,Yr:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.ei=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var c=b();c&&a.ei in c&&(a.status=200,c[a.ei]&&(a.response=a.Yr(c[a.ei])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function h(b){for(var c=0,e=0;e<b.length;e++){var f=b[e];20===f.state&&c++;if(c>=F.Rv)break;if(10===f.state)switch(f.state=20,c++,f.type){case a.AT_ARRAYBUFFER:d(f,"arraybuffer");break;case a.AT_JSON:d(f,"json");break;case a.AT_TEXT:d(f,"text");break;case a.AT_AUDIOBUFFER:l(f);break;case a.AT_IMAGE_ELEMENT:k(f);
break;case a.AT_AUDIO_ELEMENT:g(f);break;default:throw"Wrong asset type: "+f.type;}}}function d(a,d){var e=b(),f=e&&a.w in e?new c:new XMLHttpRequest;f.open("GET",a.w,!0);"text"==d?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==d?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=d;f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;if(b){if("json"==d&&"string"==typeof b)try{b=JSON.parse(b)}catch(c){a.Zb(null,
a.uri,a.type,a.w);t.error(c+" (parsing JSON "+a.w+")");return}a.Zb(b,a.uri,a.type,a.w)}else a.Zb(null,a.uri,a.type,a.w),t.error("B4W Error: empty responce when trying to get "+a.w)}else a.Zb(null,a.uri,a.type,a.w),t.error("B4W Error: "+f.status+" when trying to get "+a.w);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.mw(b.loaded/b.total)},!1);f.send(null)}function l(a){var d=b(),e=d&&a.w in d?new c:new XMLHttpRequest;e.open("GET",a.w,!0);e.responseType="arraybuffer";
e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?s.Tt(b,function(b){a.Zb(b,a.uri,a.type,a.w);a.state=30},function(){a.Zb(null,a.uri,a.type,a.w);t.error("B4W Error: failed to decode "+a.w);a.state=30}):(a.Zb(null,a.uri,a.type,a.w),t.error("B4W Error: empty responce when trying to get "+a.w),a.state=30)}else a.Zb(null,a.uri,a.type,a.w),t.error("B4W Error: "+e.status+" when trying to get "+a.w),a.state=30};e.send(null)}function k(a){var c=
document.createElement("img");c.onload=function(){40!=a.state&&(a.Zb(c,a.uri,a.type,a.w),a.state=30)};c.addEventListener("error",function(){40!=a.state&&(a.Zb(null,a.uri,a.type,a.w),t.error("B4W Error: could not load image: "+a.w),a.state=30)},!1);var d=b();if(d&&a.w in d)if(d[a.w]){var f=e(a.w);c.src="data:"+f+";base64,"+d[a.w]}else d=new CustomEvent("error"),c.dispatchEvent(d);else c.src=a.w}function g(a){var c=document.createElement("audio");c.addEventListener("loadeddata",function(){40!=a.state&&
(a.Zb(c,a.uri,a.type,a.w),a.state=30)},!1);c.addEventListener("error",function(){40!=a.state&&(a.Zb(null,a.uri,a.type,a.w),t.error("B4W Error: could not load sound: "+a.w),a.state=30)},!1);var d=b();if(d&&a.w in d)if(d[a.w]){var e=n(a.w);c.src="data:"+e+";base64,"+d[a.w]}else d=new CustomEvent("error"),c.dispatchEvent(d);else c.src=a.w;setTimeout(function(){c.CA=1},5E3)}function e(a){var b="image";switch(r.Un(a)){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function n(a){var b=
"audio";switch(r.Un(a)){case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "mp4":b+="/mp4"}return b}function z(){return b4w.module_check(f.rb.oi)}var f=m("__config"),t=m("__print"),s=m("__sfx"),r=m("__util"),p=m("__version"),F=f.Dd;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;var q=[],v=0,x={};a.Nl=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.ev=function(a){if(x[a])return x[a];
var b=F.up?a+p.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return x[a]=b;throw"Error XHR: responce is empty, GET "+a;}throw"Error XHR: "+c.status+", GET "+a;};a.cleanup=function(){for(var a=0;a<q.length;a++)q[a].state=40;q=[];v=0;x={}};a.enqueue=function(a,c,d,e){for(var f=0;f<a.length;f++){var g=a[f],g={uri:g[0],type:g[1],w:g[2],name:g[3],state:10,Zb:c||function(){},mp:d||function(){},
mw:e||function(){},np:v};if(F.up){var k=b();k&&g.w in k||(g.w+=p.timestamp())}q.push(g)}h(q);v++};a.update=function(){h(q);for(var a=q,b=0,c=!0,d=0;d<a.length;d++){var e=a[d];e.np===a[b].np?30!==e.state&&(c=!1):(c&&(a[d-1].mp(),c=d-b,a.splice(b,c),d-=c),b=d,c=30===a[d].state?!0:!1);d===a.length-1&&c&&(a[d].mp(),a.splice(b))}};a.Av=z};b4w.module.__loader=function(a,m){function b(b,d,e,g,h){var k=p,n=t.create(),l;for(l in d){var r=c(d[l]);(g&&r.qb||!b&&r.Hb)&&f(r);t.n(n,r)}for(l in d)for(r=d[l],r.name=l,b=0;b<r.H.length;b++)t.i(n,d[r.H[b]],r,null);d=c({name:"out",$a:a.Mq,eb:function(a,b,c,d,e){0===b.id&&(k.vp=!0);3!=b.status&&(b.status=2);h(b.id);e(b,c);s.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")}});var z=[];if(e)for(e=t.bo(n),b=0;b<e.length;b++)z.push(t.Ba(n,e[b]));else t.K(n,function(a,b){b.nb||z.push(b)});t.n(n,
d);for(b=0;b<z.length;b++)d.H.push(z[b].name),t.i(n,z[b],d,null);return n}function c(a){a.nb=a.nb||!1;a.$a||0===a.$a||(a.$a=a.te);a.H=a.H||[];a.qh=a.qh||!1;a.Il=a.Il||!1;a.Cb=a.Cb||0;a.qb=a.qb||!1;a.Hb=a.Hb||!1;a.status=0;a.kA=0;a.bl=0;a.Ie=a.Ie||null;return a}function h(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];t.Ba(a.Lc,f).qh&&(t.me(a.Lc,f,function(d){var e=!0;t.le(a.Lc,d,function(a,b){if(!b.qh)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-
1;0<=e;e--)b.splice(d[e],1);return c}function d(a){function b(c,d){var e=t.Ba(a.Lc,c),f=t.Ba(a.Lc,d),g=f.$a-e.$a;0==g&&(g=e.nb-f.nb);return g}var c=[],d=a.wd,e=!1;do{var f=h(a,d);c.push.apply(c,d);0<f.length&&(e=!0);d=f}while(0<f.length);e&&c.sort(b);a.wd=c;return a.wd.length}function l(a,b,c){if(b.Il)return b.qh=!0,g(a,b),!1;if(!b.eb&&!b.Xg&&!b.Wg)return g(a,b),!1;if(0==b.status&&(b.status++,b.eb))return b.eb(c,a,b,b.Ie,g,e),!0;if(1==b.status){if(b.Xg)return b.Xg(c,a,b,b.Ie,g,e),!0;b.status++}return 2==
b.status&&(b.status++,b.Wg)?(b.Wg(c,a,b,b.Ie,g,e),!0):!1}function k(a){if(0==a.yj)return 100;var b=0;t.K(a.Lc,function(c,d){a.do_not_load_resources&&d.qb||(b+=d.bl*d.Cb)});return r.trunc(100*b/a.yj)}function g(a,b){b.qh=!0;b.status=3;n(a,b,1)}function e(a,b,c){1>c?n(a,b,c):b.status++}function n(a,b,c){var d=p;if(b.eb||b.Xg||b.Wg)if(b.bl=c,b=k(a),a.xn!=b||1==c)a.Ol(b,performance.now()-a.kq),a.xn=b,d.fl=!0}function z(a,b){var c=null;t.K(a.Lc,function(a,d){if(d.name==b)return c=d,1});return c}function f(a){a.Il=
!0;a.bl=1}var t=m("__graph"),s=m("__print"),r=m("__util");a.te=0;a.se=1;a.Mq=2;var p=null;a.ao=function(){return p};a.Bt=function(){var a={Pc:[],xk:0,Uj:0,vp:!1,fl:!1};return p=a};a.Kt=function(a,c,d,e,f,g,h,k){var n=p,l={id:n.Pc.length,status:0,w:c,Om:"",No:k||!1,NA:g,kq:0,xn:0,yj:0,Al:!1,Ol:e||function(){},nn:f||function(){},Lc:null,wd:null};a=b(0===l.id,a,g,h,d||function(){});l.Lc=a;c=[];d=t.cv(a);for(e=0;e<d.length;e++)c.push(d[e]);l.wd=c;t.K(a,function(a,b){!(b.eb||b.Xg||b.Wg)||l.do_not_load_resources&&
b.qb||(l.yj+=b.Cb)});n.Pc.push(l);n.Uj++;return l.id};a.Zx=function(b){var c=p;if(c&&0!=p.Uj)if(c.fl)c.fl=!1;else{var e=performance.now();do{var f=c.Pc[c.xk],g=b[f.id];if(3!=f.status)if(0==f.status&&(f.status=1,f.kq=performance.now(),f.Ol(0,0)),d(f)){var h=f,k=h.wd.length;do{var n=t.Ba(h.Lc,h.wd[0]),r=l(h,n,g);n.$a==a.se&&(h.Al=!0);n=h.wd.shift();h.wd.push(n);k--}while(!r&&0!=k)}else f.nn(g,f),f.status=3,c.Uj--,h=f,h.Ol=null,h.nn=null,h.Lc=null,h.wd=null;c.vp&&(c.xk=(c.xk+1)%c.Pc.length);if(f.Al){f.Al=
!1;break}}while(16>performance.now()-e)}};a.EA=e;a.Jl=function(a,b){var c=z(a,b);null!==c&&f(c)};a.Ix=function(a){return a&&3==a.status};a.is_primary_loaded=function(a){var b=p;if(!b)return!1;a|=0;return b.Pc[a]&&(3==b.Pc[a].status||2==b.Pc[a].status)};a.cleanup=function(){p=null}};b4w.module.__nla=function(a,m){function b(a,b){for(var c=a.b4w_nla_script,d=b.uf,g=0;g<c.length;g++){var h=c[g];switch(h.type){case "PLAY":d.push({type:"PLAY",ua:h.frame_range[0],jb:h.frame_range[1],Qd:!1});break;case "JUMP":d.push({type:"JUMP",fx:h.target_slot});break;case "SELECT":case "SELECT_PLAY":var k=t.Ji(t.Pj,h.object,0),n=t.bv(a),l=n.indexOf(k);if(-1==l){f.error("NLA script error: non-selectable object");return}for(var h={type:h.type,Rp:"SELECT"==h.type?h.target_slot:g+1,gx:g+1,be:-1,Jw:n.length,
Iw:l,ua:h.frame_range[0],jb:h.frame_range[1],Qd:!1},l=[],p=0;p<n.length;p++)l.push(e.create_selection_sensor(n[p],!0));e.create_sensor_manifold(k,"NLA_SELECT_"+g,e.CT_SHOT,l,e.Vt,function(a,c,d,f){if(!(b.Bc>=b.uf.length)&&(d=b.uf[b.Bc],"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.Qd)){for(d=0;d<f.Jw;d++)if(e.get_sensor_value(a,c,d)&&d==f.Iw){f.be=1;return}f.be=0}},h);d.push(h);break;case "NOOP":d.push({type:"NOOP"})}}}function c(a,b,e,f){if(a.uf.length){if(a.Bc>=a.uf.length)if(a.cyclic)a.Bc=0;else{a.jd-=
p.Xa*e;return}var g=a.uf[a.Bc];switch(g.type){case "PLAY":var k=d(a,b,f);g.Qd?k>=g.jb&&(g.Qd=!1,a.Bc++,c(a,b,e,f)):(a.jd+=g.ua-k,g.Qd=!0,h(a,g));break;case "JUMP":a.Bc=g.fx;c(a,b,e,f);break;case "SELECT":case "SELECT_PLAY":-1<g.be?"SELECT"==g.type||"SELECT_PLAY"==g.type&&0==g.be?(a.Bc=g.be?g.Rp:g.gx,g.be=-1,c(a,b,e,f)):(k=d(a,b,f),g.Qd)?k>=g.jb&&(g.Qd=!1,a.Bc=g.Rp,g.be=-1,c(a,b,e,f)):(a.jd+=g.ua-k,g.Qd=!0,h(a,g)):a.jd-=p.Xa*e;break;case "NOOP":a.Bc++,c(a,b,e,f)}}}function h(a,b){for(var c=a.uf,d=
0;d<c.length;d++){var e=c[d];e!=b&&(e.be=-1)}}function d(a,b,c){b=(b-c)*p.Xa-a.ua+a.jd;a.cyclic&&(b%=a.jb-a.ua+1);return b+=a.ua}function l(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].strips;if(d)for(var e=0;e<d.length;e++){var f=d[e];b.push({ua:f.frame_start,jb:f.frame_end,jg:!1,action:f.action?f.action.name:null,ym:f.action_frame_start,cs:f.action_frame_end,Fk:0,Ek:0})}}return b}var k=m("__animation"),g=m("__camera"),e=m("__controls"),n=m("__config");m("__loader");var z=m("__particles"),f=m("__print"),
t=m("__scenes"),s=m("__sfx"),r=m("__util"),p=n.Ae,F=[],q=-1;a.Yx=function(a,c){var d={ua:a.frame_start,jb:a.frame_end,jd:0,Go:-1,cyclic:c,rc:[],uf:[],Bc:0};b(a,d);for(var e=t.la(a,"ALL",t.DATA_ID_ALL),h=0;h<e.length;h++){var n=e[h],p=n.animation_data;if(p&&p.nla_tracks.length){p=p.nla_tracks;if(r.pd(n)||g.is_camera(n)||r.dc(n)){var q=l(p);n.Wc=q}s.Sd(n)&&(q=l(p),n.Wc=q)}if(k.qo(n))for(var m=n.data.materials,K=0;K<m.length;K++)q=m[K].node_tree,p=q.animation_data,q&&p&&(p=p.nla_tracks,q=l(p),n.Wc=n.Wc?
n.Wc.concat(q):q);n.Wc&&d.rc.push(n)}for(h=0;h<e.length;h++)n=e[h],z.nd(n)&&z.We(n)&&(n.Wc=[{ua:d.ua,jb:d.jb+1,jg:!1,paused:!1,action:null,ym:0,cs:0,Fk:0,Ek:0}],d.rc.push(n));e=d.ua;h=d.jb;for(n=0;n<d.rc.length;n++)for(m=d.rc[n],K=m.Wc,p=0;p<K.length;p++){var q=K[p],N=m.name+" ["+q.ua+":"+q.jb+"]";q.ua=Math.max(e,q.ua);q.jb=Math.min(h+1,q.jb);q.ua>q.jb&&(f.warn("NLA: out of scene range: "+N),K.splice(p,1),p--)}for(e=0;e<d.rc.length;e++)for(h=d.rc[e].Wc,n=0;n<h.length;n++){m=h[n];K=d.ua;p=d.jb+1;for(q=
0;q<h.length;q++)N=h[q],N.jb<=m.ua&&(K=m.ua),N.ua>=m.jb&&(p=Math.min(p,N.ua));m.Fk=K;m.Ek=p}F.push(d)};a.update=function(a,b){-1==q&&(q=a);for(var e=0;e<F.length;e++){var f=F[e];c(f,a,b,q);for(var h=d(f,a,q),n=0;n<f.rc.length;n++){for(var l=f.rc[n],t=l.Wc,m=0;m<t.length;m++){var K=t[m];h<f.Go&&s.Sd(l)&&(K.jg=!1)}for(m=0;m<t.length;m++){K=t[m];if(K.Fk<=h&&h<K.Ek&&!K.jg){var N=l,V=K,U=h;z.nd(N)&&z.We(N)?(k.apply_def(N),k.set_behavior(N,k.AB_FINISH_STOP,k.SLOT_0)):r.pd(N)||r.dc(N)||g.is_camera(N)?(k.apply(N,
V.action,k.SLOT_0),k.set_behavior(N,k.AB_FINISH_STOP,k.SLOT_0)):s.Sd(N)&&s.play(N,(V.ua-U)/p.Xa,(V.jb-V.ua)/p.Xa);for(N=0;N<t.length;N++)t[N]!=K&&(t[N].jg=!1);K.jg=!0}K.jg&&(N=l,V=h,z.nd(N)&&z.We(N)||r.pd(N)||r.dc(N)||g.is_camera(N))&&(k.set_current_frame_float(N,V-K.ua+K.ym,k.SLOT_0),k.update_object_animation(N,0,k.SLOT_0))}}f.Go=h}};a.cleanup=function(){F.length=0;q=-1};a.sv=function(a){return(a=a.animation_data)&&a.nla_tracks.length?!0:!1}};b4w.module.__camera=function(a,m){function b(b){var c={type:b,name:"",ge:1,width:0,height:0,Od:null,Va:null,ac:null,bb:0,hd:0,Ca:0,Ha:0,left:0,right:0,top:0,bottom:0,Nd:new Float32Array(3),In:new Float32Array(3),quat:new Float32Array(4),pa:new Float32Array(16),ha:new Float32Array(16),Lg:new Float32Array(16),lw:new Float32Array(16),Jc:new Float32Array(16),Bf:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Ne:null,dof_on:0,Lk:{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,
0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Ca:new Float32Array([0,0,0,0]),Ha:new Float32Array([0,0,0,0])},Sh:0,Mc:0,ab:null,$g:null,uk:null,un:new Float32Array(4),sl:new Float32Array(4)};if(b==a.Ra)return c;switch(b){case a.nc:d(c,40,.1,1E3);break;case a.Ff:d(c,2.5,.1,1E3);break;case a.ve:break;case a.Rg:break;case a.Sg:break;case a.mb:case a.vb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function c(b,c,
d){if(b.type!=a.mb&&b.type!=a.vb)throw"set_stereo_params(): wrong camera type";b.Sh=c;b.Mc=d;t(b,b.bb);if(C.T())for(b=C.get_active(),c=b.camera.d.N,d=0;d<c.length;d++)q(c[d],b.d.Ic)}function h(a,b){var c=a.d,d=B.quat_to_dir(c.quat,B.AXIS_MY,Q),e=Math.asin(d[1]/G.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?B.quat_to_dir(c.quat,B.AXIS_MZ,Y):B.quat_to_dir(c.quat,B.AXIS_Z,Y)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b}function d(b,
c,d,e,f){switch(b.type){case a.nc:case a.mb:case a.vb:b.hd=c;b.bb=1;break;case a.Ff:b.top=c;b.bb=1;break;case a.ve:delete b.hd;b.hd=c;b.bb=f/c;break;case a.Rg:b.top=c;b.bb=f/c;break;default:y.error("set_frustum(): Unsupported camera type: "+b.type)}b.Ca=d;b.Ha=e}function l(b,c){var d=c.d.e,e=c.d.quat,f=da;U.rotateX(c.d.I,-Math.PI/2,f);U.invert(f,b.pa);if(b.ab){var f=b.ab[0],g=b.ab[1],h=b.ab[2],k=b.ab[3],H=da;H[0]=1-2*f*f;H[1]=-2*f*g;H[2]=-2*f*h;H[3]=0;H[4]=-2*f*g;H[5]=1-2*g*g;H[6]=-2*g*h;H[7]=0;H[8]=
-2*f*h;H[9]=-2*g*h;H[10]=1-2*h*h;H[11]=0;H[12]=-2*f*k;H[13]=-2*g*k;H[14]=-2*h*k;H[15]=1;U.multiply(b.pa,H,b.pa);t(b,b.bb,!0);f=X;g=da;U.invert(b.pa,g);U.transpose(g,g);K.transformMat4(b.ab,g,f);g=Z;g[0]=(B.sign(f[0])+b.ha[8])/b.ha[0];g[1]=(B.sign(f[1])+b.ha[9])/b.ha[5];g[2]=-1;g[3]=(1+b.ha[10])/b.ha[14];K.scale(f,2/(f[0]*g[0]+f[1]*g[1]+f[2]*g[2]+f[3]*g[3]),f);b.ha[2]=f[0];b.ha[6]=f[1];b.ha[10]=f[2]+1;b.ha[14]=f[3]}b.type==a.mb?b.pa[12]+=b.Mc/2:b.type==a.vb&&(b.pa[12]-=b.Mc/2);U.multiply(b.ha,b.pa,
b.Bf);r(b);s(b);G.copy(b.Nd,b.In);G.copy(d,b.Nd);N.copy(e,b.quat)}function k(b,c,d,e){U.lookAt(c,d,e,b.pa);b.type==a.mb?b.pa[12]+=b.Mc/2:b.type==a.vb&&(b.pa[12]-=b.Mc/2);U.multiply(b.ha,b.pa,b.Bf);r(b);s(b);G.copy(c,b.Nd)}function g(b){b=b.d;if(b.cc){var c=Q;b.Ka==a.MS_TARGET_CONTROLS?G.subtract(b.e,b.sb,c):B.quat_to_dir(b.quat,B.AXIS_MY,c);c[1]=0;G.normalize(c,c);var d=-Math.acos(-c[2]);0>c[0]&&(d=-2*Math.PI-d);b.Ka==a.MS_EYE_CONTROLS&&(d*=-1);b.cc.left+=d;b.cc.right+=d}}function e(b){b=b.d;if(b.lb){var c=
Q;b.Ka==a.MS_TARGET_CONTROLS?G.subtract(b.e,b.sb,c):B.quat_to_dir(b.quat,B.AXIS_MY,c);G.normalize(c,c);c=Math.asin(c[1]);b.lb.ne+=c;b.lb.Oe+=c}}function n(a){a=a.d;if(a.cc)if(a.lb){var b=B.ze(a.lb.ne+Math.PI/2),c=B.ze(a.lb.Oe+Math.PI/2);if(c>Math.PI)a.lb={Oe:-Math.PI/2,ne:Math.PI/2};else if(b>Math.PI||b<c)a.lb.ne=Math.PI/2}else a.lb={Oe:-Math.PI/2,ne:Math.PI/2}}function z(a,b,c){if(b==c)return c-a;a=B.ze(a);b=B.ze(b);c=B.ze(c);if(.001>Math.abs(b-c))return 0;b=2*Math.PI-b;c=B.ze(c+b);a=B.ze(a+b);return a>
c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0}function f(a,b,c){a=a.d;var d=G.subtract(a.sb,a.e,Q);b=N.setAxisAngle(b,c,P);G.transformQuat(d,b,d);G.subtract(a.sb,d,a.e);N.multiply(b,a.quat,a.quat)}function t(b,c,d){switch(b.type){case a.nc:if(!c)throw"No aspect ratio";b.bb=c;case a.ve:U.perspective(B.ow(b.hd),b.bb,b.Ca,b.Ha,b.ha);break;case a.Ff:if(!c)throw"No aspect ratio";b.bb=c;case a.Rg:c=b.top*b.bb;U.ortho(-c,c,-b.top,b.top,b.Ca,b.Ha,b.ha);break;case a.Sg:U.ortho(b.left,b.right,b.bottom,b.top,b.Ca,b.Ha,
b.ha);break;case a.mb:case a.vb:if(!c)throw"No aspect ratio";b.bb=c;var e=Math.tan(b.hd*Math.PI/360);c=b.Ca*e;var f=b.bb*b.Sh*e;b.type==a.mb?(e=f-b.Mc/2,f+=b.Mc/2):(e=f+b.Mc/2,f-=b.Mc/2);e=-(b.Ca/b.Sh*e);f*=b.Ca/b.Sh;U.frustum(e,f,-c,c,b.Ca,b.Ha,b.ha);b.left=e;b.right=f;break;case a.Ra:return;default:throw"Wrong camera type: "+b.type;}d||(U.multiply(b.ha,b.pa,b.Bf),r(b),s(b))}function s(a){U.copy(a.pa,a.Jc);a.Jc[12]=0;a.Jc[13]=0;a.Jc[14]=0;a.Jc[15]=1;U.multiply(a.ha,a.Jc,a.Jc);U.invert(a.Jc,a.Jc)}
function r(a){U.copy(a.pa,a.Lg);U.multiply(a.ha,a.Lg,a.Lg);U.invert(a.Lg,a.Lg)}function p(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=b.Ca);d||(d=b.Ha);var g,h,k,H,n,l,p,q;switch(b.type){case a.Ra:throw"Extraction from NONE camera is not possible";case a.nc:case a.ve:g=c*Math.tan(b.hd*Math.PI/360);H=-g;h=g*b.bb;k=-h;n=d/c*g;q=-n;l=n*b.bb;p=-l;break;case a.Ff:case a.Rg:k=b.top*b.bb;g=n=b.top;h=l=k;H=q=-b.top;k=p=-k;break;case a.Sg:g=n=b.top;h=l=b.right;H=q=b.bottom;k=p=b.left;break;case a.mb:case a.vb:n=
c/b.Ca;g=c*Math.tan(b.hd*Math.PI/360);H=-g;h=b.right*n;k=b.left*n;p=d/c;n=g*p;q=-n;l=h*p;p*=k;break;default:throw"Wrong camera type: "+b.type;}e[0]=k;e[1]=H;e[2]=-c;e[3]=h;e[4]=H;e[5]=-c;e[6]=h;e[7]=g;e[8]=-c;e[9]=k;e[10]=g;e[11]=-c;e[12]=p;e[13]=q;e[14]=-d;e[15]=p;e[16]=n;e[17]=-d;e[18]=l;e[19]=n;e[20]=-d;e[21]=l;e[22]=q;e[23]=-d;f&&(c=da,U.invert(b.pa,c),B.rf(e,c,e,0));return e}function F(a){return"CAMERA"===a.type?!0:!1}function q(a,b){var c=b.csm_num;if(!a.$g){var d=b.csm_num;a.$g=Array(d);for(var e=
0;e<d;e++)a.$g[e]=new Float32Array(3);a.uk=new Float32Array(d);q(a,b)}for(d=0;d<c;d++){var e=0==d?a.Ca:v(b,a,d-1),f=v(b,a,d),e=p(a,e,f,D),e=A.Yu(e);a.$g[d].set(e.s);a.uk[d]=e.na;a.un[d]=G.length(e.s);a.sl[d]=x(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}function v(a,b,c){var d=a.csm_num,e=B.clamp(a.csm_first_cascade_border,b.Ca,b.Ha);a=B.clamp(a.csm_last_cascade_border,b.Ca,b.Ha);return B.clamp(x(e,a,d,c),b.Ca,b.Ha)}function x(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=
0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var A=m("__boundings"),L=m("__config"),I=m("__constraints"),y=m("__print"),C=m("__scenes"),B=m("__util"),G=m("vec3"),K=m("vec4"),N=m("quat"),V=m("mat3"),U=m("mat4"),O=L.controls;a.Ra=10;a.nc=20;a.Ff=30;a.ve=40;a.Rg=50;a.Sg=60;a.mb=70;a.vb=80;a.MS_STATIC=0;a.MS_ANIMATION=1;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;var J=new Float32Array(2),Q=new Float32Array(3),Y=new Float32Array(3),P=new Float32Array(4),X=new Float32Array(4),Z=new Float32Array(4),S=new Float32Array(16),
da=new Float32Array(16),D=new Float32Array(24);a.Ps=function(c){var f=c.d,h=c.data;switch(h.type){case "PERSP":var u=b(a.nc);if(h.angle_y)var k=h.angle_y/Math.PI*180;d(u,k,h.clip_start,h.clip_end);break;case "ORTHO":u=b(a.Ff),d(u,h.ortho_scale/2,h.clip_start,h.clip_end)}u.name=c.name;f.Bj=O.Ns.slice();f.pq=!1;a:switch(h.b4w_move_style){case "STATIC":k=a.MS_STATIC;break a;case "TARGET":k=a.MS_TARGET_CONTROLS;break a;case "EYE":k=a.MS_EYE_CONTROLS;break a;default:throw"Unknown move style";}f.Ka=k;f.dof_distance=
c.data.dof_distance;f.Ne=c.data.dof_object;f.dof_front=c.data.b4w_dof_front;f.dof_rear=c.data.b4w_dof_rear;f.dof_power=c.data.b4w_dof_power;f.N=[u];f.Ka==a.MS_TARGET_CONTROLS&&f.sb.set(h.b4w_target);f=c.d;if(f.Ka===a.MS_TARGET_CONTROLS||f.Ka===a.MS_EYE_CONTROLS)h=c.data,h.b4w_use_horizontal_clamping&&(f.cc={left:h.b4w_rotation_left_limit,right:h.b4w_rotation_right_limit}),h.b4w_use_vertical_clamping&&(f.lb={Oe:h.b4w_rotation_down_limit,ne:h.b4w_rotation_up_limit}),"LOCAL"==h.b4w_horizontal_clamping_type&&
g(c),"LOCAL"==h.b4w_vertical_clamping_type&&e(c),n(c),f.Ig=h.b4w_use_distance_limits&&h.b4w_distance_min<=h.b4w_distance_max,f.Ig&&(f.Me=h.b4w_distance_min,f.Ci=h.b4w_distance_max)};a.fb=b;a.Vy=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.Va);case "DEPTH":return Boolean(a.ac);case "SCREEN":return!Boolean(a.Va)&&!Boolean(a.ac);default:throw"Wrong attachment type: "+b;}};a.rj=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.Va=c;break;case "DEPTH":a.ac=c;break;case "SCREEN":a.Va=
null;a.ac=null;break;default:throw"Wrong attachment type: "+b;}};a.Fz=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.Va;case "DEPTH":return a.ac;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.Po=function(b,d){if(b.type!=a.nc||d!=a.mb&&d!=a.vb)throw"make_stereo(): wrong camera type";b.type=d;c(b,6,.065)};a.Uw=c;a.Ep=function(a,b){var c=a.d.quat,d=P,e=Q;e[0]=0;e[1]=1;e[2]=0;N.setAxisAngle(e,b,d);N.multiply(d,c,c)};a.wA=function(a,b){var c=a.d.quat,d=P,e=Q;e[0]=
1;e[1]=0;e[2]=0;N.setAxisAngle(e,b,d);N.multiply(d,c,c)};a.vA=function(a,b){var c=a.d.quat;N.invert(c,c);var d=P,e=Q;e[0]=0;e[1]=0;e[2]=1;N.setAxisAngle(e,-b,d);N.multiply(d,c,c);N.invert(c,c)};a.Bl=function(a,b){var c=a.d.quat;N.invert(c,c);var d=P,e=Q;e[0]=1;e[1]=0;e[2]=0;N.setAxisAngle(e,-b,d);N.multiply(d,c,c);N.invert(c,c)};a.get_angles=h;a.Jp=d;a.Pw=function(b,c,d,e,f,g,h){switch(b.type){case a.Sg:b.left=c;b.right=d;b.bottom=e;b.top=f;b.Ca=g;b.Ha=h;break;default:y.error("set_frustum_asymmetric(): Unsupported camera type: "+
b.type)}};a.get_move_style=function(a){return a.d.Ka};a.yA=l;a.zA=k;a.Mp=function(a,b,c){var d=Q;d[0]=0;d[1]=-1;d[2]=0;G.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=Y;e[0]=0;e[1]=0;e[2]=-1;G.transformQuat(e,c,e);k(a,b,d,e)};a.xA=function(a,b,c){if("CAMERA"!=a.type)throw"Wrong camera object";a=a.d;a.e.set(b);a.quat.set(c)};a.pu=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];U.lookAt(a,b,c,da);U.invert(da,da);U.rotateX(da,Math.PI/2,da);V.fromMat4(da,S);N.fromMat3(S,e)};a.qq=function(a){var b=
a.d.N;if(!b)throw"Wrong object";for(var c=a.d,d=0;d<b.length;d++){var e=b[d];l(e,a);B.Gn(e.Bf,e.Lk);if(e.Ne)if(e.dof_on){var f=G.dist(c.e,e.Ne.location);e.dof_distance=f}else e.dof_distance=0}};a.Sx=function(b){var c=b.d;if(c.Ka==a.MS_TARGET_CONTROLS)if(c.Ig){if(I.Bw(c.e,c.quat,c.sb,c.Me,I.Jq)){var d=G.subtract(c.e,c.sb,Q);G.scale(d,-c.Me/G.length(d),d);G.add(c.sb,d,c.e)}}else I.Aw(c.e,c.quat,c.sb);c.Ka!=a.MS_TARGET_CONTROLS&&c.Ka!=a.MS_EYE_CONTROLS||I.correct_up(b,B.AXIS_Y)};a.uv=g;a.jy=e;a.am=n;
a.$s=function(b){var c=b.d;if(c.Ka===a.MS_TARGET_CONTROLS||c.Ka===a.MS_EYE_CONTROLS){if(c.cc){var d=c.cc.left,e=c.cc.right,g=h(b,J),g=g[0],g=c.Ka==a.MS_TARGET_CONTROLS?g-Math.PI:-1*g;if(g=z(g,d,e))c.Ka==a.MS_TARGET_CONTROLS?f(b,B.AXIS_Y,g):(g=N.setAxisAngle(B.AXIS_MY,g,P),N.multiply(g,b.d.quat,b.d.quat))}c.lb&&(d=c.lb.Oe,e=c.lb.ne,g=h(b,J),g=g[1],c.Ka==a.MS_TARGET_CONTROLS&&(g*=-1),g=0<B.quat_to_dir(c.quat,B.AXIS_Z,Q)[1]?B.sign(g)*Math.PI-g:g,g=z(g,d,e))&&(c.Ka==a.MS_TARGET_CONTROLS?(d=B.quat_to_dir(b.d.quat,
B.AXIS_MX,Y),f(b,d,g)):(d=g,g=b.d,e=B.quat_to_dir(g.quat,B.AXIS_X,Q),d=N.setAxisAngle(e,d,P),N.multiply(d,g.quat,g.quat)));c.Ka==a.MS_TARGET_CONTROLS&&c.Ig&&(b=b.d,c=G.subtract(b.e,b.sb,Q),g=G.length(c),g>b.Ci?(G.scale(c,b.Ci/g,c),G.add(b.sb,c,b.e)):g<b.Me&&(g=B.quat_to_dir(b.quat,B.AXIS_MY,Y),G.scale(g,100*b.Me,g),G.add(c,g,c),G.scale(c,-b.Me/G.length(c),c),G.add(b.sb,c,b.e)))}};a.bA=function(b){switch(b.type){case a.nc:case a.Ff:case a.mb:case a.vb:return!0;default:return!1}};a.Lu=function(b){b=
b.d.N[0];switch(b.type){case a.nc:case a.ve:case a.mb:case a.vb:return Math.PI*b.hd/180;default:return y.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.kg=t;a.Ks=s;a.Ls=r;a.lu=p;a.As=function(a){a=a.d;var b=A.yd();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.zb=b;var c=A.sk(1,[0,0,0]);a.pc=c;a.bk=A.pn(1,b);a.dk=A.rn(1,b);a.ck=A.qn(1,b)};a.is_camera=F;a.Yf=function(b){return F(b)&&b.d&&b.d.Ka==a.MS_TARGET_CONTROLS?!0:!1};a.Hj=q;a.Nt=v};b4w.module.__lights=function(a,m){function b(a){a.Hf[0]=a.color[0]*a.Of;a.Hf[1]=a.color[1]*a.Of;a.Hf[2]=a.color[2]*a.Of}var c=m("__util"),h=m("vec3");a.Jv=function(a){var l={};l.direction=new Float32Array(3);h.normalize(l.direction,l.direction);l.color=new Float32Array(3);l.Of=1;l.Hf=new Float32Array(3);b(l);l.distance=25;l.Iu=!1;l.name=a.name;var k=a.data;l.type=k.type;l.cy=k.use_diffuse;l.ey=k.use_specular;var g=c.quat_to_dir(a.d.quat,c.AXIS_Y,[]);h.normalize(g,g);l.direction[0]=g[0];l.direction[1]=
g[1];l.direction[2]=g[2];l.color[0]=k.color[0];l.color[1]=k.color[1];l.color[2]=k.color[2];l.Of=k.energy;b(l);l.distance=k.distance;if("POINT"===l.type||"SPOT"===l.type)l.sz=k.falloff_type;"SPOT"===l.type&&(l.sx=k.spot_size,l.rx=k.spot_blend);l.Iu=k.b4w_generate_shadows;l.du=k.b4w_dynamic_intensity;a.xb=l};a.Rw=function(a,c){a.color[0]=c[0];a.color[1]=c[1];a.color[2]=c[2];b(a)};a.Kp=function(a,c){a.Of=c;b(a)};a.Wx=function(a){if("LAMP"!=a.type)throw"Wrong light object";var b=a.xb;b&&c.quat_to_dir(a.d.quat,
c.AXIS_Y,b.direction)}};b4w.module.__scenes=function(a,m){function b(){if(!Pa)throw"no active scene";return Pa}function c(){return Pa?!0:!1}function h(a,b,c,d){d|=0;for(var e=null,f=0;f<b.length;f++){var g=b[f];if((c?g.origin_name:g.name)==a&&g.d.cd==d){e=g;break}}return e}function d(a,b){b||(b="ALL");var c=[];l(a.objects,b,c);return c}function l(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&l(e.objects,b,c)}}function k(a,b,c){c=u.xh(a,b);u.le(a,c,function(a,c,d){if(d.wa){switch(d.D){case "COLOR":case "CUBEMAP":a=
c.h.Va;break;case "DEPTH":a=c.h.ac;break;case "SCREEN":a=null;break;default:throw"Wrong slink";}switch(d.S){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:if(!a)throw"Connection of SCREEN is forbidden";c=b.l;for(var e=0;e<c.length;e++){var f=c[e].k;ha.bn(f.ub,d.S)&&S.Ug(f,a,d.S)}}}});for(a=0;a<b.W.length;a++){var d=b.W[a],e=b.Oc[a];switch(d.S){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:for(var f=b.l,g=0;g<f.length;g++)c=f[g].k,
ha.bn(c.ub,d.S)&&S.Ug(c,e,d.S)}}}function g(a,b,c,d,f){for(var g=b.d,h=b.M,l=0;l<h.length;l++){var p=h[l];if(!(p.Lb||p.Jb||"MAIN"!=p.type&&"NODES"!=p.type&&"PARTICLES"!=p.type||r(a,p))){if("OPAQUE"===d){if(p.ka)continue;var q=ja.Ia(c,"SHADOW_CAST")&&p.kb?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE"}else if("BLEND"===d||"XRAY"===d){if(!p.ka)continue;if("XRAY"==d!=p.kc)continue;if(ja.Ia(c,"SHADOW_CAST")&&p.kb)switch(pa.ce){case "DEPTH":q="SHADOW_SRC_DEPTH";break;default:throw"Wrong shadows type";}else q="SHADOW_SRC_NONE"}else throw"Wrong main subscene type";
"NODES"==p.type&&p.es&&(b.d.My.push(p.es),b.d.Ly.push(p.Ny));var w=p.Da,T=f.d.Ic;ha.J(w,"SHADOW_SRC",q);S.Zj(p,T);ha.J(w,"NUM_LIGHTS",a.lf);"special_skydome.glslf"==ha.Vn(w)&&ha.J(w,"REFLECTION_PASS",0);ha.J(w,"SSAO_ONLY",0);a.za&&a.uc?ha.J(w,"WATER_EFFECTS",1):ha.J(w,"WATER_EFFECTS",0);a.za&&a.He&&g.He?(ha.J(w,"CAUSTICS",1),ha.J(w,"CAUST_SCALE",a.Ym),ha.J(w,"CAUST_SPEED",ha.t(a.Zm,2)),ha.J(w,"CAUST_BRIGHT",a.Xm)):ha.J(w,"CAUSTICS",0);a.za&&(ha.J(w,"WAVES_HEIGHT",ha.t(a.qe)),ha.J(w,"WAVES_LENGTH",
ha.t(a.Cf)),ha.J(w,"WATER_LEVEL",ha.t(a.pe)));p.hc&&ja.Ia(c,"MAIN_REFLECT")&&-1===p.Ub.indexOf("u_mirrormap")?ha.J(w,"REFLECTIVE",1):ha.J(w,"REFLECTIVE",0);if(T=ja.Ia(c,"SKY"))if(p.Jh){var v=T.h.Va;S.Ug(p,v,"u_sky")}else!pa.Ih||"MAIN_OPAQUE"!==a.type&&"MAIN_BLEND"!==a.type?ha.J(w,"PROCEDURAL_FOG",0):(p.Ac=T.Ac,ha.J(w,"PROCEDURAL_FOG",1));else ha.J(w,"PROCEDURAL_FOG",0);if("SKY_TEXTURE"==f.world.light_settings.environment_color){v=null;if(f.world.b4w_sky_settings.procedural_skydome&&f.world.b4w_sky_settings.use_as_environment_lighting)v=
T.h.Va;else for(l=0;l<a.pg.length;l++)if(a.pg[l].texture.b4w_use_as_environment_lighting){v=S.Pu(a.pg[l],!1);break}v?(ha.J(w,"SKY_TEXTURE",1),S.Ug(p,v,"u_sky_texture")):H.warn("B4W Warning: environment lighting is set to 'Sky Texture', but there is no world texture with environment map")}p.xa&&(T=ja.Ia(c,"GRASS_MAP"))&&s(p,T,g);ja.Ia(c,"REFRACT")&&p.xl?ha.J(w,"REFRACTIVE",1):ha.J(w,"REFRACTIVE",0);p.oe&&(p.em&&ja.Ia(c,"DEPTH")?ha.J(w,"SHORE_SMOOTHING",1):ha.J(w,"SHORE_SMOOTHING",0),p.water_dynamic&&
a.za&&a.qe?ha.J(w,"DYNAMIC",1):ha.J(w,"DYNAMIC",0));"PARTICLES"==p.type&&(ha.J(w,"SIZE_RAMP_LENGTH",p.kp),ha.J(w,"COLOR_RAMP_LENGTH",p.bp));if("OPAQUE"===d||"BLEND"===d){for(var T=p.Ea,R=0;R<T.length;R++){var v=T[R],m=v.dj;if(m){var B=m.d.Ja,x=null,W=null;u.ke(B,function(a,b,c){if("SCREEN"==c.D)return x=u.Ba(B,a),W=c,!0});if(!x||!W)throw"Failed to assign RTT";ta.sj(v,ta.r,ta.r);W.oa=v;var A=x.h;A.Va=v;A.Od=ca.Bp(v,null);C(m,Ta.zh,Ta.zh,!0);v=ja.tn(B);for(A=v.length-1;0<=A;A--){var ea=v[A],ma=ea.h;
D.kg(ma,1);"MAIN_OPAQUE"==a.type&&ma.type==D.nc&&D.Hj(ma,m.d.Ic);f.d.nj.unshift(ea)}}}if(p.Zf){var T=0,G;for(G in p.Zf)T++;ha.J(w,"NUM_LAMP_LIGHTS",T);p.$k=new Float32Array(3*T);p.Yk=new Float32Array(3*T);p.Xk=new Float32Array(3*T);p.Zk=new Float32Array(4*T);for(R=0;R<f.yb.LAMP.length;R++)e(p,f.yb.LAMP[R])}}t(c,a,q);S.Db(p);q={P:!0,Pa:g,k:p};n(p);a.l.push(q);k(c,a,p);z(p)}}a.l.sort(function(a,b){var c;if(a.k&&b.k){c=a.k.ka;var d=b.k.ka;(c=c==d?0:c>d?1:-1)||(c=a.k.mf,d=b.k.mf,c=c==d?0:c>d?1:-1)}else c=
0;return c})}function e(a,b){var c=b.uuid;if(c in a.Zf){c=a.Zf[c];a.$k.set(b.d.e,3*c);a.Yk.set(b.xb.direction,3*c);a.Xk.set(b.xb.Hf,3*c);var d=Rb;x(b.xb,uc,d);a.Zk.set(d,4*c)}}function n(a){var b=a.ub.attributes,c=a.Ua.Gb,d;for(d in b)if(!c[d])throw'B4W Error: missing data for "'+d+'" attribute';"MAIN"==a.type&&(b=4+f(a.ub.attributes,["a_color","a_tangent","a_texcoord"]),b+=f(a.ub.xf,["u_shadow_map0","u_shadow_map1","u_shadow_map2","u_shadow_map3","u_shadow_mask"]),10<b&&H.warn("B4W Warning: Varying limit exceeded for main shader - "+
b+', materials "'+a.qc.join(", ")+'"'));"NODES"==a.type&&(b=2,d=c=0,a.yf&&(c+=M.Sf(a.yf),b+=c),a.Na&&(d+=M.Sf(a.Na),b+=d),b+=f(a.ub.attributes,["a_color","a_normal","a_tangent"]),b+=f(a.ub.xf,["u_shadow_map0","u_shadow_map1","u_shadow_map2","u_shadow_map3","u_shadow_mask"]),10<b&&H.warn("B4W Warning: Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials "'+a.qc.join(", ")+'"'))}function z(a){8<a.Ea.length&&H.warn("B4W Warning: too many textures used - "+a.Ea.length+' (max 8), materials "'+
a.qc.join(", ")+'"')}function f(a,b){for(var c=0,d=0;d<b.length;d++)b[d]in a&&c++;return c}function t(a,b,c){for(var d=0,e=ja.Wn(a,b),f=0;f<e.length;f++){var g=e[f];"SHADOW_SRC_DEPTH"!=c||"SHADOW_CAST"!=g.type&&"POSTPROCESSING"!=g.type||(g=ja.ru(a,g,"SHADOW_CAST").h,b.vq=g.pa,b.Mm=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.pf=b.pf||[],b.pf[d]=g.ha,d++)}}function s(a,b,c){a.Fb=b.Fb;var d=b.Fb[0],e=b.Fb[1],f=b.Fb[2];c=c.zb;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,
c);b.Fb[2]=f;b=b.h;D.Jp(b,f/2,-e,-d,f/2);D.kg(b);d=a.Tk||0;d=0==d?c:Math.max(d,c);a.Tk=d}function r(a,b){for(var c=a.l,d=0;d<c.length;d++){var e=c[d].k;if(e&&e.id==b.id)return!0}return!1}function p(a){var b=K(a,"MAIN_OPAQUE"),c=!0;u.K(a.d.Ja,function(d,e){"SHADOW_CAST"===e.type&&(F(e,b,e.l,a,c),c=!1)})}function F(b,c,d,e,f){if(0!=d.length){var g=b.h;c=c.h;e=I(e,"LAMP",a.DATA_ID_ALL);var h;a:{for(h=0;h<e.length;h++){var H=e[h];if(H.data.b4w_generate_shadows){h=H;break a}}h=!1}e=(h||e[0]).d;D.Mp(g,
e.e,e.quat);ua.copy(c.Nd,g.Nd);e=ua.copy(c.$g[b.tk],Db);h=fa.invert(c.pa,mb);M.rf(e,h,e);M.rf(e,g.pa,e);b=c.uk[b.tk];if(f){f=g.pa;c=qc;da.yd(c);h=!1;for(H=0;H<d.length;H++){var k=d[H].Pa;h?da.En(c,k.Fa):(da.ht(k.Fa,c),h=!0)}d=da.ku(c,Ua);M.rf(d,f,d);f=0;for(c=2;c<d.length;c+=3)f=Math.min(f,d[c]);hc=f}d=qc;d.max_x=e[0]+b;d.max_y=e[1]+b;d.max_z=0;d.min_x=e[0]-b;d.min_y=e[1]-b;d.min_z=hc;D.Pw(g,d.min_x,d.max_x,d.min_y,d.max_y,-d.max_z,-d.min_z);D.kg(g);M.Gn(g.Bf,g.Lk)}}function q(a,b){for(var c=b.d,
d=b.M,e="COLOR_PICKING_XRAY"==a.type,f=0;f<d.length;f++){var g=d[f];if(g.kc==e&&"COLOR_ID"==g.type&&!r(a,g)){S.Z(g,"USE_GLOW",0);S.Db(g);var h={P:!0,Pa:c,k:g};n(g);a.l.push(h)}}}function v(a){var b=M.ti(a);a.Da=JSON.parse(JSON.stringify(a.Da));return b}function x(a,b,c){b[0]=1;b[1]=0;b[2]=0;b[3]=a.cy?1:0;c[0]=-1;c[1]=-1;c[2]=-1;c[3]=a.ey?1:0;switch(a.type){case "HEMI":b[0]=.5;b[1]=.5;break;case "POINT":c[2]=a.distance;break;case "SPOT":c[2]=a.distance,b=c[0]=Math.cos(a.sx/2),c[1]=a.rx*(1-b)}}function A(a,
b){for(var c=G(b,Hb),d=a.xb,f=a.d,g=d.index,h=0;h<c.length;h++){var k=c[h];k.cf.set(f.e,3*g);k.$e.set(d.direction,3*g);k.Ze.set(d.Hf,3*g);var u=uc,n=Rb;x(d,u,n);switch(d.type){case "SUN":if(k.hq.set(f.quat),k.gq=d.Hf,"SKY"===k.type){var l=Db;l[0]=l[1]=l[2]=1;var p=Math.acos(ua.dot(k.zj,l)),l=Math.acos(ua.dot(d.direction,l));k.bj=Math.floor(p/.025)!=Math.floor(l/.025)?!0:!1;ua.copy(d.direction,k.zj);L(b,k)}else ua.copy(d.direction,k.zj);case "HEMI":case "POINT":case "SPOT":break;default:H.error("B4W Warning: unknown light type: "+
d.type)}k.af.set(u,4*g);k.bf.set(n,4*g);k.va=!0;for(u=0;u<k.l.length;u++)n=k.l[u].k,n.Zf&&e(n,a)}}function L(a,b){ca.fh(b);if(b.bj)for(var c=G(a,["MAIN_OPAQUE","MAIN_BLEND"]),d=0;d<c.length;d++)for(var e=c[d].l,f=0;f<e.length;f++){var g=e[f];g.P&&(g=g.k,S.Ss(g)&&ca.Px(g))}}function I(b,c,d){if(!b.yb)throw"Access to uninitialized scene";b=b.yb[c];if(d==a.DATA_ID_ALL)return b;c=[];for(var e=0;e<b.length;e++){var f=b[e];f.d.cd==d&&c.push(f)}return c}function y(b){var c=[];b=I(b,"MESH",a.DATA_ID_ALL);
for(var d=0;d<b.length;d++)for(var e=b[d].data,f=0;f<e.materials.length;f++){var g=e.materials[f];-1==c.indexOf(g)&&c.push(g)}return c}function C(a,b,c,d){for(var e=a.d,f=a.camera.d.N,g=0;g<f.length;g++){var h=f[g];D.kg(h,b/c);e.zl&&D.Hj(h,e.Ic)}e.zl&&(e.cj=!0,K(a,"DEPTH").va=!0,K(a,"MAIN_BLEND").va=!0);D.qq(a.camera);ja.Mx(e.Ja,function(e,f,g){if(d||e.Hg){var h=e.ge*b,H=e.ge*c;if(f)for(f=0;f<g.W.length;f++)g.W[f]==e&&ta.resize(e.oa,h,H);else ta.th(e.oa)&&ta.resize(e.oa,h,H),e=g.h,e.width=h,e.height=
H,"DOF"==g.type&&N(a,{dof_power:g.h.dof_power,dof_on:g.h.dof_on}),B(g,1/b,1/c)}})}function B(a,b,c){a=a.l;for(var d=0;d<a.length;d++){var e=a[d].k;e&&S.tj(e,b,c)}}function G(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];u.K(a.d.Ja,function(a,b){b.type==e&&c.push(b)})}return c}function K(a,b){return ja.Ia(a.d.Ja,b)}function N(a,b){var c=K(a,"DOF");if(!c)return H.error("DOF is not enabled on scene. Check camera settings"),0;var d=a.d.Ja;"boolean"==typeof b.dof_on&&(c.h.dof_on=parseFloat(b.dof_on));
"number"==typeof b.dof_distance&&(c.h.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.h.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.h.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.h.dof_power=b.dof_power;for(var e=ja.Wa(d,c,"POSTPROCESSING"),d=ja.Wa(d,e,"POSTPROCESSING"),e=[e,d],d=0;d<e.length;d++){var f=e[d].l[0].k;f&&(S.vf(f,c.h.dof_power),B(e[d],1/c.h.width,1/c.h.height))}}c.va=!0}function V(a,b){var c=K(Pa,"MAIN_OPAQUE");if(!c||!c.za)return H.error("get_water_surface_level() - no water parameters on this scene"),
0;var d=c.qe,e=c.Cf,f=c.pe,g=c.za;if(!d||!g.Nf)return g.pe;var h=ua.length(c.Zh),k=c.time;h&&(k*=h);var u=Cc;u[0]=20/e*(a-.25*k);u[1]=20/e*(b-.25*k);h=M.$m(u);u[0]=17/e*(b+.1*k);u[1]=17/e*(a+.1*k);var u=M.$m(u),h=h+u-1,n=g.dst_noise_scale0,u=g.dst_noise_scale1,l=g.dst_noise_freq0,p=g.dst_noise_freq1,q=Cc;q[0]=n*(a+l*k);q[1]=n*(b+l*k);n=M.Kl(q);q[0]=u*(b-p*k);q[1]=u*(a-p*k);u=M.Kl(q);u*=d*n;if(c.Nj)if(p=(a-c.de[0])/c.ee[0],q=(c.de[1]+b)/c.ee[1],p+=.5,q+=.5,1<p||0>p||1<q||0>q)d=u;else var p=M.Rn(Pa.d.Gl,
c.ng,p,q),n=g.dir_freq,r=g.dir_noise_scale,ca=g.dir_noise_freq,l=g.dir_min_noise_fac,q=g.dst_min_fac,c=e/c.bg/Math.PI,r=[r/e*(a+ca*k),r/e*(b+ca*k)],e=Math.sqrt(p),d=d*Math.max(p,g.dir_min_shore_fac)*Math.sin(e/c+n*k)*Math.max(M.Kl(r),l),g=Math.max(e,q),d=d*(1-g)+u*g,h=h*p;else d=u;return f+(d+.05*h)}function U(a,b){a.rh&&"POSTPROCESSING"==a.type&&b.P!=a.P&&(a.P=b.P);b.P||"GLOW"!=a.type||(a.Bk=0)}function O(a,b,c,d){var e=u.Ba(a,b);D.rj(e.h,c,d);e.$j=!0;u.me(a,b,function(b,e,f){f.wa&&f.D==c&&ja.Zs(f)&&
J(a,b,f.S,d)});u.le(a,b,function(b,e,f){f.wa&&f.D==c&&f.D==f.S&&O(a,b,c,d)})}function J(a,b,c,d){a=u.Ba(a,b).l;for(b=0;b<a.length;b++)S.yw(a[b].k,d,c)}function Q(a){var b=K(a,"GRASS_MAP");if(b){var c=b.h,d=a.camera.d,e=d.e;a=Db;a[0]=0;a[1]=-b.Fb[2]/2;a[2]=0;ua.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=Xb;b[0]=0;b[1]=0;b[2]=0;b[3]=1;D.Mp(c,a,b)}}function Y(a,b){u.K(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.W[0]||!d.Oc[0])throw"Wrong MOTION_BLUR subscene";var e=d.W[0],f=d.Oc[0];
d.Oc[0]=d.h.Va;u.me(a,c,function(b,c,d){d.wa&&J(a,b,d.S,f)});O(a,c,e.D,f);J(a,c,e.S,d.Oc[0]);d.So=Math.exp(-b/d.Zi)}})}function P(b,c){var d=0,e=b.Wr;0==e.Ul&&(e.Ul=c);var f=c-e.Ul;if(e.Ap&&f/e.Eh>=e.Ap)a.clear_glow_anim(b);else{f%=e.Eh;if(f<e.ho)switch(e=f/(e.ho/5),f=Math.floor(e),f){case 0:d=(e-f)/2;break;case 1:d=(e-f)/2+.5;break;case 2:d=1;break;case 3:d=1-(e-f)/2;break;case 4:d=.5-(e-f)/2}for(e=0;e<b.M.length;e++)f=b.M[e],"COLOR_ID"==f.type&&(f.Vf=d)}}function X(a){u.K(a.d.Ja,function(a,b){b.va=
!0})}function Z(a){if("WIND"==a.field.type){a=a.d;M.quat_to_dir(a.quat,M.AXIS_Y,Ja);ua.normalize(Ja,Ja);ua.scale(Ja,a.Kk,Ja);a=Ha;for(var b=0;b<a.length;b++)for(var c=G(a[b],Na),d=0;d<c.length;d++)c[d].Zh.set(Ja)}}var S=m("__batch"),da=m("__boundings"),D=m("__camera"),ia=m("__config"),R=m("__debug"),w=m("__geometry"),u=m("__graph"),T=m("__hud"),ma=m("__objects");m("__particles");var W=m("__prerender"),ea=m("__primitives"),H=m("__print"),ca=m("__renderer"),ja=m("__scenegraph"),ka=m("__sfx"),ha=m("__shaders"),
ta=m("__textures"),M=m("__util"),ua=m("vec3"),fa=m("mat4"),pa=ia.p,Ta=ia.ig,ab="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),bb=["ARMATURE","EMPTY","MESH","SPEAKER"],vb="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GLOW_MASK WIREFRAME".split(" "),Hb="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),Oa=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],Na="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS GLOW_MASK WIREFRAME".split(" "),
$a=["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],Pa=null,Ha=[],db=[],gc,Bc;a.Pj=0;a.km=1;a.lm=2;a.DATA_ID_ALL=-1;var Cc=new Float32Array(2),Db=new Float32Array(3),uc=new Float32Array(4),Rb=new Float32Array(4),Xb=new Float32Array(4),mb=new Float32Array(16),Ua=new Float32Array(24),qc=da.yd(),Ja=new Float32Array(3),hc=null;a.set_active=function(a){Pa=a;ka.Mw(a)};a.kw=function(a){if(!a.um){for(var b=a.d,c=ja.tn(b.Ja),d=0;d<c.length;d++)b.nj.push(c[d]);C(a,gc,Bc,!1)}a=G(a,Na);for(b=0;b<a.length;b++)a[b].Zh.set(Ja)};
a.get_active=b;a.T=c;a.Hi=function(){return Ha};a.Ji=function(b,c,d,e){for(var f=Ha,g=null,k="",u=0;u<f.length;u++){var n=I(f[u],"ALL",a.DATA_ID_ALL);switch(b){case a.Pj:k=c;g=h(c,n,!1,d);break;case a.km:k=d;g=null;(n=h(c,n,!1,e))&&n.dupli_group&&(g=h(d,n.dupli_group.objects,!0,e));break;case a.lm:for(var k=c[c.length-1],g=null,l=0;l<c.length;l++)if((g=h(c[l],n,0!=l,d))&&g.dupli_group)n=g.dupli_group.objects;else break}if(g)break}g||H.warn("get object "+k+": not found");return g};a.rs=function(a,
b){for(var c in bb){var e=bb[c],f=d(a,e);e in b.yb||(b.yb[e]=[]);for(var g=0;g<f.length;g++)M.pd(f[g])&&f[g].proxy||(b.yb.ALL.push(f[g]),b.yb[e].push(f[g]))}};a.ls=function(b){b.yb={ALL:[]};for(var c in ab){var e=ab[c],f=d(b,e);b.yb[e]=[];for(var g=0;g<f.length;g++)M.pd(f[g])&&f[g].proxy||(b.yb.ALL.push(f[g]),b.yb[e].push(f[g]))}b.d=b.d||{};c=b.d;e=b.camera.d;f=b.world.b4w_shadow_settings;g=c.Ic={};g.csm_num=f.csm_num;g.csm_first_cascade_border=f.csm_first_cascade_border;g.first_cascade_blur_radius=
f.first_cascade_blur_radius;g.csm_last_cascade_border=f.csm_last_cascade_border;g.last_cascade_blur_radius=f.last_cascade_blur_radius;g.csm_resolution=f.csm_resolution;g.self_shadow_polygon_offset=f.self_shadow_polygon_offset;g.self_shadow_normal_offset=f.self_shadow_normal_offset;g.fade_last_cascade=f.fade_last_cascade;g.blend_between_cascades=f.blend_between_cascades;f=b.world.b4w_fog_color;c.Bb=new Float32Array([f[0],f[1],f[2],b.world.b4w_fog_density]);f={};g=b.world.b4w_sky_settings;f.procedural_skydome=
g.procedural_skydome;f.use_as_environment_lighting=g.use_as_environment_lighting;f.og=g.color;f.rayleigh_brightness=g.rayleigh_brightness;f.mie_brightness=g.mie_brightness;f.spot_brightness=g.spot_brightness;f.scatter_strength=g.scatter_strength;f.rayleigh_strength=g.rayleigh_strength;f.mie_strength=g.mie_strength;f.rayleigh_collection_power=g.rayleigh_collection_power;f.mie_collection_power=g.mie_collection_power;f.mie_distribution=g.mie_distribution;if(f.procedural_skydome){for(var g=I(b,"LAMP",
a.DATA_ID_ALL),h=null,k=0;k<g.length;k++){var u=g[k];if("SUN"==u.data.type){h=u;break}}h||H.warn("B4W Warning: There is no sun on the scene. Procedural sky won't be rendered")}c.Qp=f;u=b.world;f=[0,0,0];g=[0,0,0];h=u.light_settings;k=u.texture_slots;if(h.use_environment_light)if("SKY_COLOR"==h.environment_color||"SKY_TEXTURE"==h.environment_color)f=u.horizon_color.slice(0),g=u.zenith_color.slice(0);else if("PLAIN"==h.environment_color)f=[1,1,1],g=[1,1,1];else throw"Unsupported world environment color"+
h.environment_color;u={};u.Md=h.environment_energy;u.bc=f;u.lc=g;u.pg=k;c.Gq=u;c.Fo=I(b,"LAMP",a.DATA_ID_ALL).length;c.Jh=b.world.b4w_sky_settings.procedural_skydome?!0:!1;f=y(b);g=[];h=I(b,"MESH",a.DATA_ID_ALL);for(k=0;k<f.length;k++){var n=f[k];if(n.b4w_water){for(var u={},l=0;l<h.length;l++)for(var p=h[l],q=p.data.materials,r=0;r<q.length;r++)q[r]==n&&(u.pe=p.location[1]);if(pa.deferred_rendering)for(u.Bb=n.b4w_water_fog_color.slice(0),u.Bb.push(n.b4w_water_fog_density),n.b4w_water_dynamic?(u.Nf=
!0,u.waves_height=n.b4w_waves_height,u.waves_length=n.b4w_waves_length,u.dst_noise_scale0=n.b4w_water_dst_noise_scale0,u.dst_noise_scale1=n.b4w_water_dst_noise_scale1,u.dst_noise_freq0=n.b4w_water_dst_noise_freq0,u.dst_noise_freq1=n.b4w_water_dst_noise_freq1,u.dir_min_shore_fac=n.b4w_water_dir_min_shore_fac,u.dir_freq=n.b4w_water_dir_freq,u.dir_noise_scale=n.b4w_water_dir_noise_scale,u.dir_noise_freq=n.b4w_water_dir_noise_freq,u.dir_min_noise_fac=n.b4w_water_dir_min_noise_fac,u.dst_min_fac=n.b4w_water_dst_min_fac,
u.waves_hor_fac=n.b4w_water_waves_hor_fac):(u.Nf=!1,u.waves_height=0,u.waves_length=0),u.si=null,u.kk=null,u.lk=new Float32Array(2),u.vj=null,n=n.texture_slots,l=0;l<n.length;l++)p=n[l].texture,"VORONOI"==p.type&&(u.si=p.noise_scale,u.lk.set(p.b4w_uv_velocity_trans),u.kk=p.noise_intensity),!0===p.b4w_shore_dist_map&&(u.vj=p.image,u.ng=p.image.size[0],u.cx=p.b4w_shore_boundings,u.bg=p.b4w_max_shore_dist);else u.waves_height=0,u.waves_length=0,u.si=null,u.kk=null,u.lk=null,u.Bb=null,u.Nf=!1;g.push(u)}}if(0<
g.length){u=g[0];if(!u.Nf)for(k=0;k<g.length;k++)g[k].Nf&&(u=g[k]);f=u}else f=null;c.za=f;a:{f=I(b,"MESH",a.DATA_ID_ALL);for(g=0;g<f.length;g++)if(f[g].d.Gc){f=!0;break a}f=!1}c.pk=f||pa.force_selectable;a:{f=I(b,"MESH",a.DATA_ID_ALL);for(g=0;g<f.length;g++)for(h=f[g].data.materials,k=0;k<h.length;k++)if(u=h[k],l=u.game_settings.alpha_blend,u.b4w_render_above_all&&"OPAQUE"!=l&&"CLIP"!=l){f=!0;break a}f=!1}c.kc=f;c.dw=0;if(pa.deferred_rendering){f=b.um;a:{if("NONE"!=pa.ce&&b.b4w_render_shadows)for(h=
g=!1,k=I(b,"MESH",a.DATA_ID_ALL),u=0;u<k.length;u++)if(l=k[u],l.b4w_shadow_cast&&(g=!0),l.b4w_shadow_receive&&(h=!0),g&&h){g=!0;break a}g=!1}c.zl=g;c.wz=b.world.b4w_fog_color;a:{if(pa.shore_smoothing)for(g=y(b),h=0;h<g.length;h++)if(k=g[h],k.b4w_water&&k.b4w_water_shore_smoothing){g=!0;break a}g=!1}c.shore_smoothing=g;if(pa.pj&&b.b4w_render_reflections)for(g=[],h=I(b,"MESH",a.DATA_ID_ALL),k=0;k<h.length;k++){if(u=h[k],u.b4w_reflective){b:{u=u.constraints;for(l=0;l<u.length;l++)if(n=u[l],"LOCKED_TRACK"==
n.type&&"REFLECTION PLANE"==n.name){l=n.target;break b}l=null}l&&(u=l.location,l=l.d.quat,n=new Float32Array(4),M.Lx(u,l,M.AXIS_Y,n),g.push(n))}}else g=!1;c.sw=g;g={};h=b.world.b4w_bloom_settings;g.blur=h.blur;g.eu=h.edge_lum;g.key=h.key;c.Gs=g;g={};h=b.world.b4w_motion_blur_settings;g.Yi=h.motion_blur_decay_threshold;g.Zi=h.motion_blur_factor;c.Tv=g;g={};h=b.world.b4w_color_correction_settings;g.brightness=h.brightness;g.contrast=h.contrast;g.exposure=h.exposure;g.saturation=h.saturation;c.Rs=g;
g={};h=b.world.b4w_god_rays_settings;g.yv=h.intensity;g.ag=h.max_ray_length;g.zg=h.steps_per_pass;c.nv=g;g={};h=b.world;g.nh=h.b4w_glow_color;g.Li=h.b4w_glow_factor;c.kv=g;c.Mf=pa.Mf&&(0<e.dof_distance||e.Ne);a:{if(pa.xa)for(h=g=!1,k=I(b,"MESH",a.DATA_ID_ALL),u=0;u<k.length;u++){n=k[u];p=n.data.materials;for(l=0;l<p.length;l++)p[l].b4w_terrain&&(g=!0);n=n.particle_systems;for(l=0;l<n.length;l++)p=n[l].settings,"HAIR"==p.type&&p.b4w_dynamic_grass&&(h=!0);if(g&&h){g=!0;break a}}g=!1}c.xa=g;c.cg=pa.cg&&
b.b4w_enable_motion_blur;c.Jf=pa.Jf&&b.b4w_enable_color_correction;c.antialiasing=pa.antialiasing&&b.b4w_enable_antialiasing;c.Gf=pa.Gf&&b.b4w_enable_bloom;c.wf=pa.wf&&b.b4w_enable_ssao;g={};h=b.world.b4w_ssao_settings;g.radius_increase=h.radius_increase;g.dithering_amount=h.dithering_amount;g.gauss_center=h.gauss_center;g.gauss_width_square=h.gauss_width*h.gauss_width;g.gauss_width_left_square=h.gauss_width_left*h.gauss_width_left;g.influence=h.influence;g.dist_factor=h.dist_factor;g.Cw=h.samples;
c.ux=g;c.Wf=pa.Wf&&b.b4w_enable_god_rays;c.$d=pa.$d&&b.b4w_render_refractions;c.glow=pa.glow?c.pk:!1;c.Ja=ja.zt(f,c,e)}else c.Ja=ja.At(e,c);c.nj=[];c.cj=!1;c.ml=!1;Ha.push(b)};a.wi=d;a.Rk=function(a){return a.d.Ja};a.Au=function(a){u.K(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=S.sn(c.Hh);break;case "SSAO":d=S.Ht(c.Yp);break;case "DEPTH_PACK":d=S.pt();break;case "REFRACT":case "SCREEN":d=S.sn("NONE");break;case "GOD_RAYS":ja.Wa(a,c,"WIREFRAME")||ja.Wa(a,c,"MAIN_BLEND")||ja.Wa(a,
c,"GOD_RAYS");d=S.st(c.lp|0,(c.ab&&c.oe)|0,c.zg);break;case "GOD_RAYS_COMBINE":ja.Wa(a,c,"WIREFRAME")||ja.Wa(a,c,"MAIN_BLEND");ja.Wa(a,c,"GOD_RAYS");d=S.tt();break;case "MOTION_BLUR":d=S.yt(c.Yi);break;case "DOF":d=S.qt();S.vf(d,c.h.dof_power);for(var e=ja.Wa(a,c,"POSTPROCESSING"),f=ja.Wa(a,e,"POSTPROCESSING"),g=[e,f],h=0;h<g.length;h++){var u=g[h].l;(e=u[0].k)&&S.vf(e,c.h.dof_power)}break;case "GLOW":g=ja.Wa(a,c,"POSTPROCESSING");h=ja.Wa(a,g,"POSTPROCESSING");e=ja.Wa(a,h,"POSTPROCESSING");f=ja.Wa(a,
e,"POSTPROCESSING");d=S.rt();g=[h,g];for(h=0;h<g.length;h++)u=g[h].l,(u=u[0].k)&&S.vf(u,c.Qm);g=[f,e];for(h=0;h<g.length;h++)u=g[h].l,(u=u[0].k)&&S.vf(u,c.Fn*c.Li);break;case "COMPOSITING":d=S.nt();break;case "ANTIALIASING":d=S.jt();break;case "LANCZOS":d=S.vt(c.gA);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=S.Ft(c.type);break;case "ANAGLYPH":d=S.it();break;case "HUD":d=S.ut();e=ta.Jt();S.Ug(d,e);break;case "SKY":d=
S.Et();S.tj(d,1/c.h.width,1/c.h.height);break;case "LUMINANCE":d=S.wt();break;case "AVERAGE_LUMINANCE":d=S.kt();break;case "LUMINANCE_TRUNCED":d=S.xt();break;case "BLOOM_BLUR":d=S.lt(c.Hh);S.tj(d,1/c.h.width,1/c.h.height);break;case "BLOOM":d=ja.Wa(a,c,"BLOOM_BLUR");g=[ja.Wa(a,d,"BLOOM_BLUR"),d];for(h=0;h<g.length;h++)u=g[h].l,(u=u[0].k)&&S.vf(u,c.bloom_blur);d=S.mt();break;case "VELOCITY":d=S.Lt()}d&&(e={P:!0,Pa:ma.yi("NONE"),k:d},n(d),c.l.push(e),k(a,c,d),z(d))})};a.append_object=function(a,b){switch(b.type){case "MESH":var c=
a.d.Ja,d=b.d;!ja.Ia(c,"SHADOW_CAST")&&d.kb&&(d.kb=!1);for(var d=G(a,vb),e=0;e<d.length;e++){var f=d[e],h=b,u=c,H=a;switch(f.type){case "MAIN_OPAQUE":g(f,h,u,"OPAQUE",H);break;case "MAIN_BLEND":g(f,h,u,"BLEND",H);break;case "MAIN_XRAY":g(f,h,u,"XRAY",H);break;case "MAIN_REFLECT":u=h.d;h=h.M;for(H=0;H<h.length;H++){var l=h[H],p=v(l);if(!("MAIN"!=p.type&&"NODES"!=p.type&&"PARTICLES"!=p.type||r(f,p)||p.ka)&&p.Rb){var ca=p.Da;ha.J(ca,"DISABLE_FOG",0);ha.J(ca,"WATER_EFFECTS",0);"special_skydome.glslf"==
ha.Vn(ca)&&ha.J(ca,"REFLECTION_PASS",1);ha.J(ca,"SHADOW_SRC","SHADOW_SRC_NONE");ha.J(ca,"TEXTURE_NORM",0);S.Db(p);ca={P:!0,Pa:u,k:p};n(p);f.l.push(ca);"MAIN"==p.type&&(l.ob||(l.ob=[]),l.ob.push(p))}}break;case "DEPTH":l=h.d;h=h.M;for(p=0;p<h.length;p++){var w=h[p];if("DEPTH"==w.type&&!r(f,w)&&!w.Lb){if(ja.tv(u,f,"SHADOW_CAST"))if(w.kb){switch(pa.ce){case "DEPTH":var ca="SHADOW_SRC_DEPTH",T="SHADOW_DST_MASK";break;default:throw"Wrong shadows type";}w=S.Yl(w,ca,T);S.Zj(w,H.d.Ic);ja.Wn(u,f);t(u,f,ca)}else w=
S.Yl(w,"SHADOW_SRC_NONE","SHADOW_DST_MASK");else w=S.Yl(w,"SHADOW_SRC_NONE","SHADOW_DST_NONE");w.xa&&(ca=ja.Ia(u,"GRASS_MAP"))&&s(w,ca,l);S.Db(w);ca={P:!0,Pa:l,k:w};n(w);f.l.push(ca);k(u,f,w);z(w)}}break;case "SHADOW_CAST":l=!1;p=h.d;h=h.M;for(ca=0;ca<h.length;ca++)if(w=h[ca],w.Kb||w.kb)if(l=!0,"DEPTH"==w.type&&!r(f,w)&&w.Kb){switch(pa.ce){case "DEPTH":T="SHADOW_DST_DEPTH";break;default:throw"Wrong shadows type";}w=S.Dt(w,T);w.xa&&(T=ja.Ia(u,"GRASS_MAP"))&&s(w,T,p);S.Z(w,"SHADOW_TEX_RES",ha.t(H.d.Ic.csm_resolution));
S.Db(w);T={P:!0,Pa:p,k:w};n(w);f.l.push(T)}l&&F(f,ja.Ia(u,"MAIN_OPAQUE"),f.l,H,!0);break;case "COLOR_PICKING":q(f,h);break;case "COLOR_PICKING_XRAY":q(f,h);break;case "GRASS_MAP":u=h.d;h=h.M;for(H=0;H<h.length;H++)l=h[H],"GRASS_MAP"!=l.type||r(f,l)||(S.Db(l),p={P:!0,Pa:u,k:l},n(l),f.l.push(p),l=f.h,T=u.Fa,p=f.Fb[0],ca=f.Fb[1],w=f.Fb[2],0==p&&0==ca?(p=T.min_y,ca=T.max_y):(p=Math.min(p,T.min_y),ca=Math.max(ca,T.max_y)),T=1E-4*(ca-p),f.Fb[0]=p-T,f.Fb[1]=ca+T,D.Jp(l,w/2,-ca,-p,w/2),D.kg(l));break;case "GLOW_MASK":u=
h.d;h=h.M;for(H=0;H<h.length;H++)l=h[H],"COLOR_ID"!=l.type||r(f,l)||(p=v(l),S.Z(p,"USE_GLOW",1),S.Db(p),h.push(p),ca={P:!0,Pa:u,k:p},n(p),f.l.push(ca),l.ob||(l.ob=[]),l.ob.push(p));break;case "WIREFRAME":for(H=h.d,h=h.M,l=0;l<h.length;l++)p=h[l],"WIREFRAME"!=p.type||r(f,p)||(p.xa&&(ca=ja.Ia(u,"GRASS_MAP"))&&s(p,ca,H),S.Db(p),ca={P:!0,Pa:H,k:p},n(p),f.l.push(ca),k(u,f,p),z(p))}}break;case "LAMP":b.xb.index=a.d.dw++;c=G(a,Hb);for(d=0;d<c.length;d++)c[d].lf++;A(b,a)}};a.Nz=r;a.Dl=function(a){a.d.cj=
!0};a.Tu=function(a,b){for(var c=a.d.Ic,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=D.Nt(c,b,e);return d};a.hide_object=function(a){a.d.oh=!0};a.show_object=function(a){a.d.oh=!1};a.vw=function(a,b){for(var c=b.d,d=G(a,vb),e=0;e<d.length;e++)for(var f=d[e].l,g=f.length-1;0<=g;g--){var h=f[g];h.Pa==c&&(h.k&&w.gn(h.k.Ua),f.splice(g,1))}};a.check_object=function(a,b){return b.yb[a.type]&&-1<b.yb[a.type].indexOf(a)?!0:!1};a.Ij=A;a.cleanup=function(){for(var a=0;a<Ha.length;a++){var b=Ha[a];
u.K(b.d.Ja,function(a,b){if("SINK"!=b.type){var c=b.h;ca.ww(c.Od,c.Va,c.ac,c.width,c.height);for(var c=b.l,d=0;d<c.length;d++){var e=c[d].k;e&&S.at(e)}}});b.d.Ja=[];b.d.nj=[]}Pa=null;Ha.length=0;db.length=0;Ja[0]=0;Ja[1]=0;Ja[2]=0};a.Oo=function(a,b,c){a=D.lu(a,a.Ca,a.Ha,null,!0);var d=ea.Eu(a);a=ma.yi("DYNAMIC");a.Fa=a.zb={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.cb=a.pc=da.Fs();var e=a.cb.na;a.Ge=a.Fe=da.rk([e,0,0],[0,e,0],[0,0,e],a.cb.s);c=S.Ct(d,c);b.l.push({P:!0,
Pa:a,k:c})};a.la=I;a.av=function(a){return[a.frame_start,a.frame_end]};a.Np=function(a,b){gc=a;Bc=b;Pa&&C(Pa,a,b,!1)};a.tj=B;a.Bx=G;a.fa=K;a.get_environment_colors=function(a){a=G(a,Hb)[0];var b=a.bc,c=a.lc,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.Md,d,e]};a.set_environment_colors=function(a,b,c,d){a=G(a,Hb);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.Md=b);c&&f.bc.set(c);d&&f.lc.set(d);f.va=!0}};a.get_sky_params=function(a){if(a=K(a,"SKY")){var b={};
b.color=Array(3);ua.copy(a.og,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;
return b}return null};a.set_sky_params=function(a,c){for(var d=G(a,["SKY"]),e=0;e<d.length;e++){var f=d[e];"number"==typeof c.procedural_skydome&&(f.procedural_skydome=c.procedural_skydome);"number"==typeof c.use_as_environment_lighting&&(f.use_as_environment_lighting=c.use_as_environment_lighting);"object"==typeof c.color&&f.og.set(c.color);"number"==typeof c.rayleigh_brightness&&(f.rayleigh_brightness=c.rayleigh_brightness);"number"==typeof c.mie_brightness&&(f.mie_brightness=c.mie_brightness);
"number"==typeof c.spot_brightness&&(f.spot_brightness=c.spot_brightness);"number"==typeof c.scatter_strength&&(f.scatter_strength=c.scatter_strength);"number"==typeof c.rayleigh_strength&&(f.rayleigh_strength=c.rayleigh_strength);"number"==typeof c.mie_strength&&(f.mie_strength=c.mie_strength);"number"==typeof c.rayleigh_collection_power&&(f.rayleigh_collection_power=c.rayleigh_collection_power);"number"==typeof c.mie_collection_power&&(f.mie_collection_power=c.mie_collection_power);"number"==typeof c.mie_distribution&&
(f.mie_distribution=c.mie_distribution);f.va=!0;f.bj=!0;L(b(),f);ca.fh(f)}};a.get_fog_color_density=function(a,b){var c=b||[],d=G(a,Oa)[0].Bb;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=G(a,Oa),d=0;d<c.length;d++){var e=c[d];e.Bb.set(b);e.va=!0}};a.get_ssao_params=function(a){a=K(a,"SSAO");if(!a)return null;var b=a.l[0].k,c={};c.ssao_quality=S.Ya(b,"SSAO_QUALITY")[1];c.radius_increase=a.wg;c.dithering_amount=a.rg;c.gauss_center=a.sg;c.gauss_width_square=
a.ug;c.gauss_width_left_square=a.tg;c.influence=a.vg;c.dist_factor=a.qg;c.ssao_only=a.ssao_only;c.ssao_white=S.Ya(b,"SSAO_WHITE")[1];return c};a.set_ssao_params=function(a,b){var c=K(a,"SSAO");if(!c)return H.error("SSAO is not enabled on scene"),0;if("string"==typeof b.ssao_quality){var d=c.l[0].k;S.Z(d,"SSAO_QUALITY",b.ssao_quality);S.Db(d,!0)}"number"==typeof b.wg&&(c.wg=b.wg);"number"==typeof b.rg&&(c.rg=b.rg);"number"==typeof b.sg&&(c.sg=b.sg);"number"==typeof b.ug&&(c.ug=b.ug);"number"==typeof b.tg&&
(c.tg=b.tg);"number"==typeof b.vg&&(c.vg=b.vg);"number"==typeof b.qg&&(c.qg=b.qg);if("number"==typeof b.ssao_only){c=K(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var e=0;e<c.l.length;e++)d=c.l[e].k,S.Z(d,"SSAO_ONLY",b.ssao_only),S.Db(d,!0)}"number"==typeof b.ssao_white&&(d=c.l[0].k,S.Z(d,"SSAO_WHITE",b.ssao_white),S.Db(d,!0));c.va=!0};a.get_dof_params=function(a){a=K(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.h.dof_distance;b.dof_front=a.h.dof_front;b.dof_rear=a.h.dof_rear;b.dof_power=
a.h.dof_power;return b};a.set_dof_params=N;a.get_god_rays_params=function(a){var b=G(a,["GOD_RAYS"]);a=K(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].ag;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=S.Ya(b[0].l[0].k,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=G(a,["GOD_RAYS"]),d=K(a,"GOD_RAYS_COMBINE");if(!c||!d)return H.error("God Rays are not enabled on scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=
b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].ag=e,c[f].oj=e/c[f].zg/(f+1),c[f].va=!0;if("number"==typeof b.god_rays_steps)for(var g=ha.t(b.god_rays_steps,1),e=c[0].ag,f=0;f<c.length;f++){c[f].zg=g;c[f].oj=e/g/(f+1);c[f].va=!0;var h=c[f].l[0].k;S.Z(h,"STEPS_PER_PASS",g);S.Db(h,!0)}d.va=!0};a.get_bloom_params=function(a){var b=K(a,["LUMINANCE_TRUNCED"]);a=K(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;
c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=function(a,b){var c=K(a,"LUMINANCE_TRUNCED"),d=K(a,"BLOOM");if(!c||!d)return H.error("Bloom is not enabled on scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.va=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.va=!0);if("number"==typeof b.bloom_blur)for(var e=a.d.Ja,c=ja.Wa(e,d,"BLOOM_BLUR"),e=ja.Wa(e,c,"BLOOM_BLUR"),c=[c,e],e=0;e<c.length;e++){var f=c[e].l[0].k;f&&
(S.vf(f,b.bloom_blur),B(c[e],1/d.h.width,1/d.h.height))}};a.get_wind_params=function(){var a=Ja,b=ua.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.set_wind_params=function(b,c){for(var d=I(b,"ALL",a.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if("EMPTY"===f.type&&f.field&&"WIND"===f.field.type)var g=f}if(!g)return H.error("There is no wind on the scene"),0;d=g.d;"number"==typeof c.wind_dir&&(Db=[0,c.wind_dir/180*Math.PI,-Math.PI/2],
M.euler_to_quat(Db,Xb),d.quat.set(Xb),Z(g));"number"==typeof c.wind_strength&&(d.Kk=c.wind_strength,Z(g));X(b)};a.Hw=function(a){a.d.ml=!0};a.get_water_surface_level=V;a.get_water_mat_params=function(a,b){var c=K(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.qe,b.waves_length=c.Cf,c.uc)){b.water_fog_density=c.uc[3];var d=b.water_fog_color=[];d[0]=c.uc[0];d[1]=c.uc[1];d[2]=c.uc[2]}};a.set_water_params=function(a,b){var c=K(a,"MAIN_OPAQUE");if(!c||!c.za)return H.error("set_water_params() - no water parameters on this scene"),
null;c=c.za;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=
b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.Nf=b.water_dynamic);for(var d=G(a,$a),e=0;e<d.length;e++){var f=d[e];"number"==typeof b.water_fog_density&&c.Bb&&(f.uc[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&
c.Bb&&f.uc.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.qe=b.waves_height);"number"==typeof b.waves_length&&(f.Cf=b.waves_length);f.va=!0}};a.get_shore_dist=function(a,b){var c=K(Pa,"MAIN_OPAQUE");if(!c.Nj)return 100;var d=c.bg,e=c.pe,f=(a[0]-c.de[0])/c.ee[0],g=(c.de[1]+a[2])/c.ee[1],f=f+.5,g=g+.5;if(1<f||0>f||1<g||0>g)e=1;else return c=d*M.Rn(Pa.d.Gl,c.ng,f,g),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,c){for(var d=b().camera.d,e=0;e<Ha.length;e++){var f=Ha[e],g=f.d.Ja;
if(f.d.za)var h=d.e[1]-V(d.e[0],d.e[2]);u.K(g,function(b,c){-1<Na.indexOf(c.type)&&(c.time=a);-1<$a.indexOf(c.type)&&f.d.za&&(c.jk=h)})}if(pa.deferred_rendering)for(e=0;e<db.length;e++)P(db[e],a);for(e=0;e<Ha.length;e++)if(f=Ha[e],g=f.d,d=g.nj,g.cj&&(p(f),g.cj=!1),g.ml&&(Q(f),g.ml=!1),d.length){f.b4w_enable_motion_blur&&Y(g.Ja,c);if(pa.deferred_rendering&&g.glow){for(var H=K(f,"GLOW_MASK").l,k=0,g=0;g<H.length;g++)k+=H[g].k.Vf;u.K(f.d.Ja,function(a,b){"GLOW"===b.type&&(b.Bk=k)})}H=null;for(g=0;g<
d.length;g++)"GLOW_MASK"==d[g].type&&(H=g);for(g=0;g<d.length;g++){var n=d[g];W.vl(n);null!==H&&U(n,d[H]);ca.fh(n)}}pa.show_hud_debug_info&&T.dx(Ha,c)};a.Pk=function(a){var b=[];u.K(a.d.Ja,function(a,c){b.push(c)});return b};a.apply_glow_anim=function(a,b,c,d){a.Wr={Ul:0,ho:b,Eh:c,Ap:d};-1==db.indexOf(a)&&db.push(a)};a.clear_glow_anim=function(a){if(a.M)for(var b=0;b<a.M.length;b++){var c=a.M[b];"COLOR_ID"==c.type&&(c.Vf=0)}a=db.indexOf(a);-1!=a&&db.splice(a,1)};a.bz=function(){db=[]};a.get_cam_water_depth=
function(){var a=K(Pa,"MAIN_BLEND"),b=Pa;return a||b.d.za?a.jk:null};a.get_object_data_id=function(a){return a.d.cd};a.tq=X;a.$w=function(a,b){switch(b){case "WM_NONE":a.P=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.l.length;c++)a.l[c].k.wireframe_mode=R.qm[b];a.P=!0}a.ka="WM_TRANSPARENT_WIREFRAME"==b;a.va=!0};a.Zw=function(a,b){for(var c=0;c<a.l.length;c++)a.l[c].k.wireframe_edge_color=b,a.va=!0};a.Am=function(a,
b){for(var c=0;c<b.length;c++)a.yb.ALL.push(b[c]),a.yb.MESH.push(b[c])};a.sq=Z;a.pick_object=function(d,e){if(!c())return H.error("No active scene"),null;var f=b(),g=K(f,"COLOR_PICKING");if(g){W.vl(g);ca.fh(g);var h=K(f,"COLOR_PICKING_XRAY");h?(W.vl(h),ca.fh(h),g=h.h):g=g.h;e=g.height-e;g=ca.qw(g.Od,d,e);f=I(f,"MESH",a.DATA_ID_ALL);for(h=0;h<f.length;h++){var u=f[h].sm;if(u&&5>Math.abs(255*u[0]-g[0])&&5>Math.abs(255*u[1]-g[1])&&5>Math.abs(255*u[2]-g[2]))return f[h]}}else H.error("Color picking is not available");
return null};a.iv=function(){return Ja};a.bv=function(b){var c=[];b=I(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var e=b[d];e.d.Gc&&c.push(e)}return c}};b4w.module.__physics=function(a,m){function b(a,c){for(var d=a.Ad,e=0;e<d.length;e++)d[e].d.Kj&&c.push(d[e]),b(d[e],c)}function c(a,b){if(Y)switch(a){case y.Sq:L.log(b);break;case y.Pq:L.error(b);break;case y.Qq:I.fbmsg.apply(this,b.slice(1));break;case y.Wq:var c=h(b.body_id);if(c){var d=b.trans,e=b.quat,f=b.linvel,g=b.angvel,c=c.j;c.vk=b.time;G.Rh(d,1,e,c.wk);V.copy(f,c.Lo);V.copy(g,c.Cm)}break;case y.Uq:(d=h(b.chassis_hull_body_id))&&G.Rh(b.trans,1,b.quat,d.f.Kh[b.prop_ind]);break;case y.Rq:if(c=
h(b[1]))d=b[4],c=c.oc.ni[b[2]],B.set_translation(c,b[3]),B.set_rotation(c,d),B.F(c);break;case y.Xq:if(c=h(b[1]))c.f.speed=b[2];break;case y.Nq:for(var d=b.body_id_a,c=b.body_id_b,e=b.result,f=b.coll_point,d=parseInt(d),g=Y.j.l,k=0;k<g.length;k++)for(var n=g[k].Za,l=0;l<n.yc.length;l++){for(var p=n.yc[l],q=p.hj,r=!1,w=0;w<q.length;w++){var s=q[w];if(s[0]===d&&s[1]===c){p.op[w]=e;r=!0;break}}if(r){q=p.op;for(w=r=0;w<q.length;w++)r=r||q[w];p.callback(r,f)}}break;case y.Oq:if(c=h(b[1]))c=c.j,c.vi&&c.vi(b[2]);
break;case y.Vq:if(c=h(b.body_id))for(c=c.j,e=b.from,f=b.to,g=b.local,k=b.body_id_b_hit,n=b.cur_result,l=0;l<c.Yd.length;l++)if(q=c.Yd[l],K.ui(q.D,e)&&K.ui(q.S,f)&&q.local==g){for(d in q.ud)q.ud[d]=1;-1!=k&&(q.ud[k]=n);for(var p=q.Mb,w=q.callback,q=q.ud,r=!1,s=1,t=0;t<Y.j.l.length;t++){var z=Y.j.l[t].Za;if(("ANY"==p||z.id==p)&&z.C in q&&1!==q[z.C]){r=!0;s=q[z.C];break}}w(r,s)}break;case y.Tq:console.log("Physics message ping: ",performance.now()-b[1]);break;default:L.error("Wrong message: "+a)}}function h(a){return X[a]||
null}function d(){Z.body++;return Z.body}function l(a){return{C:a,gl:0,Ri:!1,fe:!0,dA:!1,is_character:!1,Cv:!1,xi:null,id:"",dz:{},yc:[],vi:null,Yd:[],vk:0,wk:new Float32Array([0,0,0,1,0,0,0,1]),Lo:new Float32Array(3),Cm:new Float32Array(3),qi:new Float32Array(3),pi:new Float32Array(4)}}function k(a,b){switch(a){case "BOX":var c=b.zb;break;case "CYLINDER":c=b.dk;break;case "CONE":c=b.ck;break;case "SPHERE":c=b.pc;break;case "CAPSULE":c=b.bk}return c}function g(a){if(!a)return null;var b={};"number"===
typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.s&&(b.center=a.s);"number"===typeof a.na&&(b.radius=a.na);"number"===typeof a.height&&(b.height=a.height);return b}function e(a,b,c,d){var e=a.d.e,f=b.d.I,g=new Float32Array(16);O.invert(f,g);f=new Float32Array(3);V.transformMat4(e,
g,f);switch(b.f.type){case 10:b=b.b4w_vehicle_settings;a=a.d.zb;y.m(y.Zq,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:y.m(y.Yq,c,f,a.GA)}}function n(a){return a.j&&a.j.xi?!0:!1}function z(a,b,c,d,e,f,g,h,k,n){var l;Z.on++;l=Z.on.toString(16);y.m(y.fr,l,a,h,b.j.C,c,d,e.j.C,f,g,k,n);b.j.xi=l}function f(a){var b=a.j;if(b&&(0===b.gl||!0===b.Ri||!1===b.fe||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.e[0]!=a.j.qi[0]||a.d.e[1]!=a.j.qi[1]||a.d.e[2]!=a.j.qi[2]||a.d.quat[0]!=
a.j.pi[0]||a.d.quat[1]!=a.j.pi[1]||a.d.quat[2]!=a.j.pi[2])){a.j.qi.set(a.d.e);a.j.pi.set(a.d.quat);var b=a.j,c=y.Xn(y.Df);c.msg_id=y.Df;c.body_id=a.j.C;c.trans=a.d.e;"DYNAMIC"===b.type?(c.quat=da,U.identity(da)):c.quat=a.d.quat;y.m(y.Df,c)}a=a.Ad;for(b=0;b<a.length;b++)f(a[b])}function t(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.quat;e[0]=b;e[1]=c;e[2]=d;V.transformQuat(e,a,e)}function s(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.j.l.length;e++){var f=b.j.l[e];if("ANY"==
a||f.Za.id==a)f=f.Za.C,c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function r(a,b){y.m(y.vc,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=K.Fm(e.D)+K.Fm(e.S)+String(e.local);c[f]=c[f]||{D:e.D,S:e.S,local:e.local,Rm:[]};var g=c[f].Rm,h;for(h in e.ud)-1==g.indexOf(h)&&g.push(h)}for(f in c)d=c[f].D,e=c[f].S,h=c[f].local,g=c[f].Rm,y.m(y.om,a,d,e,h,g)}else y.m(y.om,a,null,null,!1,null)}function p(a,b){if(b.yg){var c=a.j.C,d=b.Pf*b.Ln,e=b.Vg*b.Tm,f=-b.xg*b.Ql*2*Math.PI/b.$p;b.zo&&(f*=-1);
switch(b.type){case 10:y.m(y.vc,c);y.m(y.Mr,c,d,e,f);break;case 20:y.m(y.vc,c),y.m(y.Lr,c,d,e,f)}}}function F(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function q(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function v(a){return a.b4w_character?!0:!1}function x(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}m("__camera");var A=m("__config");m("__constraints");var L=m("__print"),I=m("__debug"),y=m("__ipc");m("__renderer");
var C=m("__scenes"),B=m("__transform"),G=m("__tsr"),K=m("__util"),N=m("__version"),V=m("vec3"),U=m("quat"),O=m("mat4"),J=A.Za,Q=A.p,Y=null,P=[],X=[],Z={Fq:0,body:0,on:0,shape:0},S=new Float32Array(3),da=new Float32Array(4),D=new Float32Array(4),ia=new Float32Array(16),R=new Float32Array(8),w=new Float32Array(8);a.wv=function(a){if(J.enabled){var b=J.Uh+N.timestamp();L.log("%cLOAD PHYSICS","color: #0a0",b,"Max FPS: "+J.Ud);b=new Worker(b);y.init(b,c);y.m(y.vr,a,J.Ud)}};a.Hm=function(a){var b;Z.Fq++;
b=Z.Fq;y.m(y.kr,b);a.j={};a.j.ry=b;a.j.l=[]};a.cleanup=function(){if(J.enabled){y.m(y.qr);Y=null;P.length=0;X.length=0;for(var a in Z)Z[a]=0}};a.append_object=function(a,c){Y=c;y.m(y.Ar,c.j.ry);var f=a.d;if(!f)throw"No object render: "+a.name;if(a.parent&&f.Kj)return null;var h=[];f.Kj&&b(a,h);for(var w=a.M||[],H=0;H<w.length;H++){var r=w[H],s;if(s="PHYSICS"==r.type){var t;a:{for(var R=c.j.l,m=0;m<R.length;m++){var B=R[m].k;if(B&&B.id==r.id){t=!0;break a}}t=!1}s=!t}if(s)if(r.Tb.A)if(r.oe&&c.d.za){var A=
r;y.m(y.jr);var G=Y,J=C.fa(G,"MAIN_OPAQUE");if(J.za&&A.my){var I={};I.dst_noise_scale0=A.dst_noise_scale0;I.dst_noise_scale1=A.dst_noise_scale1;I.dst_noise_freq0=A.dst_noise_freq0;I.dst_noise_freq1=A.dst_noise_freq1;I.dir_min_shore_fac=A.dir_min_shore_fac;I.dir_freq=A.dir_freq;I.dir_noise_scale=A.dir_noise_scale;I.dir_noise_freq=A.dir_noise_freq;I.dir_min_noise_fac=A.dir_min_noise_fac;I.dst_min_fac=A.dst_min_fac;I.waves_hor_fac=A.waves_hor_fac;var N=J.qe,Q=J.Cf,S=J.pe;J.Nj?y.m(y.nm,I,J.ee[0],J.ee[1],
J.de[0],J.de[1],J.bg,N,Q,S,J.ng,G.d.Gl):y.m(y.nm,I,0,0,0,0,0,N,Q,S,0,null)}}else{var Z;if(r.dy){var Oa=a,da=r,$a=d(),Pa=da.Tb;y.m(y.hr,$a,Pa.q[0].a_position,Pa.V||null,Oa.d.e,da.jn,da.kn);var Ha=l($a);Ha.Ri=!0;Z=Ha}else{var db=a,gc=r,Bc=d(),Cc=gc.Tb;y.m(y.ir,Bc,Cc.q[0].a_position,Cc.V||null,db.d.e,gc.kh,gc.gh,gc.jn,gc.kn);Z=l(Bc)}var Db=Z;Db.id=r.Mb;var uc={k:r,Za:Db};c.j.l.push(uc)}else L.error("Object "+a.name+" has collision material with no assigned vertices")}if(F(a)||q(a)||v(a)||x(a)||a.b4w_collision){var Rb=
a,Xb=f.qp,mb=Rb.d,Ua=Rb.game,qc=d();if("CAMERA"==Rb.type)var Ja=Ua.use_collision_bounds?Ua.collision_bounds_type:"BOX",hc=k(Ja,mb),ic=mb.kh,eb=mb.gh,ic=.5,eb=0;else"EMPTY"==Rb.type?(Ja="EMPTY",hc=null,eb=ic=0):(Ja=Ua.use_collision_bounds?Ua.collision_bounds_type:"BOX",hc=k(Ja,mb),ic=mb.kh,eb=mb.gh);var Uc=mb.e,Vc=mb.quat,Qc=Ua.use_ghost,ad=Ua.use_sleep,Yb=Ua.mass,nb=Ua.velocity_min,Va=Ua.velocity_max,Eb=Ua.damping,jc=Ua.rotation_damping,Zb=Ua.collision_group,Sb=Ua.collision_mask,Tb=mb.pc.na,$b=g(hc),
wa=Rb.b4w_correct_bounding_offset,ob;var wb=Ja;if(h.length){var sa=[],pb={};pb.quat=new Float32Array([0,0,0,1]);pb.trans=new Float32Array(3);pb.worker_bounding=$b;pb.bounding_type=wb;sa.push(pb);O.invert(mb.I,ia);U.invert(mb.quat,D);for(var aa=0;aa<h.length;aa++){var Ka={},Wa=h[aa],la=Wa.game.collision_bounds_type,Ba=new Float32Array(4),xb=new Float32Array(3);V.transformMat4(Wa.d.e,ia,xb);U.multiply(D,Wa.d.quat,Ba);Ka.trans=xb;Ka.quat=Ba;Ka.bounding_type=la;Ka.worker_bounding=g(k(la,Wa.d));sa.push(Ka)}ob=
sa}else ob=[];y.m(y.br,qc,Uc,Vc,Xb,Qc,ad,Yb,nb,Va,Eb,jc,Zb,Sb,Ja,$b,Tb,ic,eb,ob,wa);P.push(Rb);X[qc]=Rb;var fb=l(qc);fb.type=Xb;fb.gl=Yb;fb.Ri=Qc;Db=fb;a.j=Db;uc={k:null,Za:Db};c.j.l.push(uc)}if(F(a)||q(a)){var qa=a,na=qa.j.C;F(qa)?(qa.f.type=10,y.m(y.cr,na,qa.f.Ex,qa.f.Gx,qa.f.Fx,qa.f.py,qa.f.Sv)):q(qa)&&(qa.f.type=20,y.m(y.ar,na,qa.f.Ik,qa.f.cm,qa.f.dm));if(qa.f.sf){var ya=qa.f.sf;switch(qa.f.type){case 10:e(ya[1],qa,na,!0);e(ya[0],qa,na,!0);e(ya[3],qa,na,!1);e(ya[2],qa,na,!1);break;case 20:for(var yb=
0;yb<ya.length;yb++)e(ya[yb],qa,na,!1)}}qa.j.id=qa.b4w_vehicle_settings.name;p(a,a.f)}else if(v(a)){var kc=a.d,ac=a.j,bc=kc.zb.max_y-kc.zb.min_y,Ib=ac.C,qb=a.b4w_character_settings,Jb=qb.walk_speed,gb=qb.run_speed,Qa=qb.step_height,Kb=qb.jump_strength,rb=qb.waterline,Ca=K.$t(a);y.m(y.dr,Ib,Ca,bc,Jb,gb,Qa,Kb,rb);ac.is_character=!0}else if(x(a)){var Xa=a,Lb=Xa.j.C;y.m(y.gr,Lb,Xa.oc.Ik,Xa.oc.cm,Xa.oc.dm);if(Xa.oc.ni)for(var va=Xa.oc.ni,La=0;La<va.length;La++){var Ia=va[La],cc=Ia.d.e,Ma=Xa.d.I,oa=new Float32Array(16);
O.invert(Ma,oa);var Ya=new Float32Array(3);V.transformMat4(cc,oa,Ya);y.m(y.$q,Lb,Ya,Ia.Hs)}Xa.j.Cv=!0}else a.b4w_collision&&(Db.id=a.b4w_collision_id);for(H=0;H<P.length;H++)if(a=P[H],a.j){var E=a;if(!n(E))for(var Da=0;Da<E.constraints.length;Da++){var ra=E.constraints[Da],jb=ra.target,xa=ra.pivot_type;if("RIGID_BODY_JOINT"==ra.type&&jb.j){var ba=new Float32Array([ra.pivot_x,ra.pivot_y,ra.pivot_z]),Za,dc=new Float32Array([ra.axis_x,ra.axis_y,ra.axis_z]);Za=K.euler_to_quat(dc,new Float32Array(4));
var zb=O.fromRotationTranslation(Za,ba,new Float32Array(16)),Ab=O.multiply(E.d.I,zb,new Float32Array(16)),Bb=O.invert(jb.d.I,new Float32Array(16)),Cb=O.multiply(Bb,Ab,Bb),Mb=K.gf(Cb),Nb=K.matrix_to_quat(Cb),Ea=ra,Fa={};Fa.use_limit_x=Ea.use_limit_x;Fa.use_limit_y=Ea.use_limit_y;Fa.use_limit_z=Ea.use_limit_z;Fa.use_angular_limit_x=Ea.use_angular_limit_x;Fa.use_angular_limit_y=Ea.use_angular_limit_y;Fa.use_angular_limit_z=Ea.use_angular_limit_z;Fa.limit_max_x=Ea.limit_max_x;Fa.limit_min_x=Ea.limit_min_x;
Fa.limit_max_y=Ea.limit_max_y;Fa.limit_min_y=Ea.limit_min_y;Fa.limit_max_z=Ea.limit_max_z;Fa.limit_min_z=Ea.limit_min_z;Fa.limit_angle_max_x=Ea.limit_angle_max_x;Fa.limit_angle_min_x=Ea.limit_angle_min_x;Fa.limit_angle_max_y=Ea.limit_angle_max_y;Fa.limit_angle_min_y=Ea.limit_angle_min_y;Fa.limit_angle_max_z=Ea.limit_angle_max_z;Fa.limit_angle_min_z=Ea.limit_angle_min_z;z(xa,E,ba,Za,jb,Mb,Nb,Fa,null,null)}}}};a.qu=h;a.update=function(){for(var a=0;a<P.length;a++){var b=P[a],c=b.j;if(c.fe&&c.vk){var d=
performance.now()/1E3-c.vk,d=Math.min(d,10/60);Q.Zv&&(d=0);var e=R;G.xv(c.wk,d,c.Lo,c.Cm,R);B.set_translation(b,G.eo(e));B.set_rotation(b,G.Yn(e));B.F(b);f(b);if(b.f)for(var c=b,d=c.f.sf,e=c.d.Qc,g=R,h=0;h<d.length;h++){var k=d[h];G.multiply(e,c.f.Kh[h],g);B.Lp(k,g);B.F(k)}b.f&&b.f.yg&&(c=b.f,d=c.yg)&&(e=b.f.aq,k=ia,g=b.d.e,h=b.d.quat,K.Wl(b.f.bq,h,g,k),K.gf(k,d.d.e),K.matrix_to_quat(k,d.d.quat),k=da,K.Xl(e,h,g,k),e=D,U.setAxisAngle(k,-c.xg*c.Ql*2*Math.PI,e),U.multiply(e,d.d.quat,d.d.quat),B.F(d));
b.f&&b.f.Ml&&(c=b.f,d=c.Ml)&&(g=b.f.Wp,e=ia,h=b.d.e,k=b.d.quat,K.Wl(b.f.Xp,k,h,e),K.gf(e,d.d.e),K.matrix_to_quat(e,d.d.quat),e=da,K.Xl(g,k,h,e),g=D,h=Math.abs(c.speed)*c.Vp,h>c.hl&&(h=c.hl),U.setAxisAngle(e,-h,g),U.multiply(g,d.d.quat,d.d.quat),B.F(d));b.f&&b.f.Rl&&(c=b.f,d=c.Rl)&&(e=b.f.iq,k=ia,g=b.d.e,h=b.d.quat,K.Wl(b.f.jq,h,g,k),K.gf(k,d.d.e),K.matrix_to_quat(k,d.d.quat),b=da,K.Xl(e,h,g,b),e=D,U.setAxisAngle(b,-Math.abs(c.Pf)*c.Bn,e),U.multiply(e,d.d.quat,d.d.quat),B.F(d))}}if(a=Y)a=C.fa(a,"MAIN_OPAQUE"),
a.za&&0<a.za.waves_height&&(b=V.length(a.Zh),y.m(y.Kr,a.time*b))};a.Ju=function(){return Y};a.pause=function(){J.enabled&&y.m(y.wr)};a.resume=function(){J.enabled&&y.m(y.zr)};a.enable_simulation=function(a){a=a.j;if(!a)throw"No object physics";if(!a.fe){var b=a.C;a.fe=!0;y.m(y.ur,b)}};a.disable_simulation=function(a){a=a.j;if(!a)throw"No object physics";if(a.fe){var b=a.C;a.fe=!1;y.m(y.tr,b)}};a.has_physics=function(a){return a.j?!0:!1};a.has_dynamic_physics=function(a){return(a=a.j)&&a.fe&&("RIGID_BODY"==
a.type||"DYNAMIC"==a.type)&&0<a.gl&&0==a.Ri?!0:!1};a.has_simulated_physics=function(a){return(a=a.j)&&a.fe?!0:!1};a.set_gravity=function(a,b){y.m(y.Jr,a.j.C,b)};a.qv=n;a.apply_constraint=z;a.clear_constraint=function(a){a=a.j;y.m(y.yr,a.xi);a.xi=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,g){c=G.Kf(c,1,d,R);f=G.Kf(f,1,g,w);G.invert(c,c);G.multiply(f,c,c);B.gv(e,f);G.multiply(f,c,c);B.Lp(b,c);B.F(b);a.set_transform(b,b.d.e,b.d.quat)};a.set_transform=function(a,b,c){G.Rh(a.d.e,1,a.d.quat,a.j.wk);
var d=y.Xn(y.Df);d.msg_id=y.Df;d.body_id=a.j.C;d.trans=b;d.quat=c;y.m(y.vc,a.j.C);y.m(y.Df,d)};a.sync_transform=f;a.apply_velocity=function(a,b,c,d){t(a,b,c,d,S);a=a.j.C;y.m(y.vc,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(S[0]),f=Math.abs(S[1]),g=Math.abs(S[2]);S[0]=e?S[0]/e*Math.max(e,b):0;S[1]=f?S[1]/f*Math.max(f,c):0;S[2]=g?S[2]/g*Math.max(g,d):0;y.m(y.pm,a,S[0],S[1],S[2])};a.apply_velocity_world=function(a,b,c,d){a=a.j.C;y.m(y.vc,a);y.m(y.pm,a,b,c,d)};a.apply_force=function(a,
b,c,d){t(a,b,c,d,S);a=a.j.C;y.m(y.vc,a);y.m(y.lr,a,S[0],S[1],S[2])};a.apply_torque=function(a,b,c,d){t(a,b,c,d,S);a=a.j.C;y.m(y.vc,a);y.m(y.nr,a,S[0],S[1],S[2])};a.set_character_move_dir=function(a,b,c){a=a.j.C;y.m(y.vc,a);y.m(y.Dr,a,b,c)};a.set_character_move_type=function(a,b){y.m(y.Er,a.j.C,b)};a.set_character_walk_velocity=function(a,b){y.m(y.Ir,a.j.C,b)};a.set_character_run_velocity=function(a,b){y.m(y.Gr,a.j.C,b)};a.set_character_fly_velocity=function(a,b){y.m(y.Br,a.j.C,b)};a.character_jump=
function(a){y.m(y.or,a.j.C)};a.character_rotation_inc=function(a,b,c){y.m(y.pr,a.j.C,b,c)};a.set_character_rotation=function(a,b,c){y.m(y.Fr,a.j.C,b,c)};a.set_character_rotation_h=function(a,b){y.m(y.Cr,a.j.C,b)};a.set_character_rotation_v=function(a,b){y.m(y.Hr,a.j.C,b)};a.$y=function(){return!1};a.Zy=function(){return!1};a.check_collision=function(){L.error("check_collision() deprecated");return!1};a.Yy=function(){L.error("check_collision_any() deprecated");return!1};a.check_ray_hit=function(){L.error("check_ray_hit() deprecated");
return!1};a.LA=function(){L.error("update_object_coords() deprecated")};a.append_collision_test=function(a,b,c,d){var e=a.j,f=e.C;b=b||"ANY";for(var g=0;g<e.yc.length;g++){var h=e.yc[g];if(h.Mb==b&&h.callback==c)return}g=[];a=a.j.C;h=[];s(b,Y,h,null);for(var k=0;k<h.length;k++){var n=h[k];a<n?g.push([a,n]):a>n&&g.push([n,a])}h={Mb:b,callback:c,hj:g,op:new Uint8Array(g.length),ll:d||!1};e.yc.push(h);y.m(y.vc,f);y.m(y.er,g,d)};a.remove_collision_test=function(a,b,c){a=a.j;b=b||"ANY";for(var d=0;d<a.yc.length;d++){var e=
a.yc[d];if(e.Mb==b&&e.callback==c){a.yc.splice(d,1);d--;for(var e=e.hj,f=Y.j.l,g=0;g<f.length;g++)for(var h=f[g].Za,k=0;k<h.yc.length;k++)for(var n=h.yc[k],l=0;l<n.hj.length;l++)for(var p=n.hj[l],q=0;q<e.length;q++){var r=e[q];p[0]===r[0]&&p[1]===r[1]&&(e.splice(q,1),q--)}e.length&&y.m(y.xr,e)}}};a.apply_collision_impulse_test=function(a,b){var c=a.j;c?(y.m(y.mr,c.C),c.vi=b):L.error("Object "+a.name+" has no physics")};a.clear_collision_impulse_test=function(a){var b=a.j;b?(y.m(y.rr,b.C),b.vi=null):
L.error("Object "+a.name+" has no physics")};a.append_ray_test=function(a,b,c,d,e,f){var g=a.j;if(g){a=g.C;b=b||"ANY";c={D:new Float32Array(c),S:new Float32Array(d),local:e,callback:f,Mb:b,ud:{}};s(b,Y,null,c.ud);delete c.ud[a];for(var h in c.ud)c.ud[h]=1;g.Yd.push(c);r(a,g.Yd)}else L.error("Object "+a.name+" has no physics")};a.remove_ray_test=function(a,b,c,d,e){if(b=a.j){a=b.C;for(var f=0;f<b.Yd.length;f++){var g=b.Yd[f];K.ui(g.D,c)&&K.ui(g.S,d)&&g.local==e&&(b.Yd.splice(f,1),f--)}r(a,b.Yd)}else L.error("Object "+
a.name+" has no physics")};a.vehicle_throttle=function(a,b){var c=a.f;c.Pf=b;p(a,c)};a.vehicle_steer=function(a,b){var c=a.f;c.xg=b;p(a,c)};a.vehicle_brake=function(a,b){var c=a.f;c.Vg=b;p(a,c)};a.is_vehicle_chassis=F;a.is_vehicle_hull=q;a.Bv=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.zv=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.Dv=
function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.Do=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.Co=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.Eo=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.f.speed};a.qy=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;
case "WHEEL_BACK_RIGHT":return 3}};a.is_character=v;a.cA=x;a.Iz=function(){return 0};a.St=function(){y.m(y.sr)};a.uw=function(a){var b=P.indexOf(a);-1!=b?(P.splice(b,1),a=X.indexOf(a),-1!=a&&X.splice(a,1)):L.error("Object ",a.name," doesn't have bounding physics")}};b4w.module.__data=function(a,m){function b(a,b){for(var c=U(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}bb[b.id]=null;vb[b.id]=null}function c(a,b,c){var d;a instanceof ArrayBuffer&&(a=S.fo(a));d=a.width;a=a.height;T.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(Hb)&&c&&T.warn("B4W Warning: image",b,"is not from app root.")}function h(a,b,c,d,e,f){d=b.w;if(!d)throw"Nothing requested";ia.enqueue([[d,ia.AT_JSON,
d]],function(d,f,g,h){if(d){T.log("%cLOAD METADATA","color: #616",h);f=d.b4w_format_version;if(Number(f)<fa.Ro)throw"Incompatible file version: "+f+". Required: "+fa.Ro;for(var k in d)a[k]=d[k];(d=a.binaries[0].binfile)?b.Om=d:(D.Jl(b,"load_binaries"),D.Jl(b,"prepare_bindata"));if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)T.error("EXPORT WARNING:",a.b4w_export_warnings[d]);e(b,c)}},null,function(a){f(b,c,a)})}function d(a,b,c,d,e,f){d=N(b.w)+b.Om;if(!d)throw"Binary data is missing";
ia.enqueue([[d,ia.AT_ARRAYBUFFER,d]],function(d,f,g,h){d&&(T.log("%cLOAD BINARY","color: #616",h),a.bin_data=d,e(b,c))},null,function(a){f(b,c,a)})}function l(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],g=a.objects,h=a.meshes;a=a.actions;for(var H=ta.Vs(),n=["indices"],l=["normal","tangent"],u=["color","group"],p=["position","texcoord","texcoord2"],q=0;q<h.length;q++)for(var r=h[q].submeshes,w=0;w<r.length;w++)for(var s in r[w]){var ca=r[w][s][1];if(-1!=n.indexOf(s)){var t=4*r[w][s][0]+f["int"],z=
r[w],C=s,v=d;if(H)var R=new Uint32Array(v,t,ca);else for(var R=new Uint32Array(ca),v=new DataView(v),m=0;m<ca;m++)R[m]=v.getUint32(t+4*m,!0);z[C]=R}else if(-1!=p.indexOf(s))t=4*r[w][s][0]+f["float"],r[w][s]=k(d,t,ca,H);else if(-1!=l.indexOf(s)){t=2*r[w][s][0]+f["short"];z=r[w];C=s;v=d;R=new Float32Array(ca);v=new DataView(v);for(m=0;m<ca;m++)R[m]=v.getInt16(t+2*m,!0)/32767;z[C]=R}else if(-1!=u.indexOf(s)){t=2*r[w][s][0]+f.ushort;z=r[w];C=s;v=d;R=new Float32Array(ca);v=new DataView(v);for(m=0;m<ca;m++)R[m]=
v.getUint16(t+2*m,!0)/65535;z[C]=R}}for(s=0;s<g.length;s++)for(h=g[s].particle_systems,n=0;n<h.length;n++)l=h[n],l.transforms=k(d,4*l.transforms[0]+f["float"],l.transforms[1],H);for(g=0;g<a.length;g++){s=a[g];var h=s.fcurves,l=s.frame_range,n=l[0],l=l[1],u=Y.Ou(n,l),p=null,B;for(B in h){var q=h[B],x;for(x in q)r=q[x],w=k(d,f["float"]+4*r.bin_data_pos[0],r.bin_data_pos[1],H),ca=new Float32Array(u),null===p&&(p=new Int8Array(u)),Y.xs(r,w,ca,p,n,l),r.Zr=ca}s.Tr=p}e(b,c)}function k(a,b,c,d){if(d)d=new Float32Array(a,
b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function g(a,b,c,d,e){var f=a.cameras,g=a.groups,h=a.materials,k=a.meshes,H=a.node_groups,n=a.objects,l=a.particles,p=a.scenes,q=a.speakers,r=a.textures,ca=a.worlds;H||(T.warn('B4W Warning: "node_groups" datablock undefined. reexport main scene.'),H=a.node_groups=[]);for(var z="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),
C={},v=0;v<z.length;v++)for(var R=a[z[v]],m=0;m<R.length;m++){var B=R[m];C[B.uuid]=B}for(var x=0;x<p.length;x++){for(var G=p[x],F=G.objects,W=0;W<F.length;W++)s(F,W,C);G.camera&&s(G,"camera",C);G.world&&s(G,"world",C)}for(x=0;x<g.length;x++)for(var ja=g[x].objects,W=0;W<ja.length;W++)s(ja,W,C);for(x=0;x<n.length;x++){var K=n[x];K.dupli_group&&s(K,"dupli_group",C);K.parent&&s(K,"parent",C);if(K.animation_data){var y=K.animation_data;y.action&&s(y,"action",C);if(y.nla_tracks)for(W=0;W<y.nla_tracks.length;W++)for(var D=
y.nla_tracks[W],J=0;J<D.strips.length;J++)D.strips[J].action&&s(D.strips[J],"action",C)}switch(K.type){case "MESH":if(!K.data)throw"mesh not found for object "+K.name;s(K,"data",C);for(var I=K.modifiers,W=0;W<I.length;W++){var N=I[W];"ARMATURE"==N.type?s(N,"object",C):"CURVE"==N.type&&s(N,"object",C)}var V=K.particle_systems;if(V)for(W=0;W<V.length;W++)s(V[W],"settings",C);break;case "ARMATURE":s(K,"data",C);for(var ha=K.pose.bones,Q=K.data.bones,W=0;W<ha.length;W++){var Ta=ha[W];Ta.bone=Q[Ta.bone];
for(var pa=Ta.parent_recursive,J=0;J<pa.length;J++)pa[J]=ha[pa[J]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":s(K,"data",C)}var P=K.constraints;if(P)for(W=0;W<P.length;W++){var S=P[W];S.target&&s(S,"target",C)}var X=K.lod_levels;if(X)for(W=0;W<X.length;W++){var Z=X[W];Z.object&&s(Z,"object",C)}}for(x=0;x<k.length;x++)for(var vb=k[x].materials,W=0;W<vb.length;W++)s(vb,W,C);for(x=0;x<h.length;x++){for(var bb=h[x],da=bb.texture_slots,W=0;W<da.length;W++)s(da[W],"texture",C);var Ha=bb.node_tree;
Ha&&t(Ha,C)}for(x=0;x<H.length;x++)(Ha=H[x].node_tree)&&t(Ha,C);for(x=0;x<r.length;x++){var Hb=r[x],ia=Hb.type;"IMAGE"!=ia&&"ENVIRONMENT_MAP"!=ia||s(Hb,"image",C)}for(x=0;x<f.length;x++){var db=f[x];db.dof_object&&s(db,"dof_object",C)}for(x=0;x<q.length;x++){var $a=q[x];$a.sound&&s($a,"sound",C);$a.animation_data&&$a.animation_data.action&&s($a.animation_data,"action",C)}for(x=0;x<l.length;x++){for(var Qa=l[x],da=Qa.texture_slots,W=0;W<da.length;W++)s(da[W],"texture",C);Qa.dupli_group&&s(Qa,"dupli_group",
C);Qa.dupli_object&&s(Qa,"dupli_object",C)}for(x=0;x<ca.length;x++)if(da=ca[x].texture_slots)for(W=0;W<da.length;W++)s(da[W],"texture",C);ma.Us(a);Oa=0===b.id;Na||(Na=a.scenes[0]);for(var Kb=a.textures,rb=Oa?a.scenes[0].b4w_anisotropic_filtering:Na.b4w_anisotropic_filtering,Ca=0;Ca<Kb.length;Ca++)Oa||(Kb[Ca].b4w_render_scene=""),ka.It(Kb[Ca],rb,a.scenes);for(var Xa={},Lb=a.objects,va=0;va<Lb.length;va++){var La=Lb[va];if("MESH"===La.type&&!La.particle_systems.length)for(var Ia=La.data,cc=Ia.name,
Ma=Ia.submeshes,oa=Ia.materials,Ya=0;Ya<Ma.length;Ya++)0!==Ma[Ya].base_length||Xa[cc]||(oa[Ya]?T.warn('B4W Warning: material "'+oa[Ya].name+'" is not assigned to any face (object "'+La.name+'").'):T.warn('B4W Warning: Mesh "'+Ia.name+'" has no faces (object "'+La.name+'").'),Xa[cc]=!0)}for(var E=a.meshes,Da=0;Da<E.length;Da++){var ra=E[Da];ra.materials.length||ra.uv_textures.length&&T.warn('B4W Warning: mesh "'+ra.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",
use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,
b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});
for(var jb=a.meshes,xa=ta.keysearch("name","DEFAULT",a.materials),ba=0;ba<jb.length;ba++){var Za=jb[ba];0==Za.materials.length&&Za.materials.push(xa)}for(var dc=a.actions,zb=b.id,Ab=0;Ab<dc.length;Ab++){var Bb=dc[Ab];Bb.Vr=zb;Y.fs(Bb)}for(var Cb=a.scenes,Mb=0;Mb<Cb.length;Mb++){for(var Nb=Cb[Mb],Ea=ea.wi(Nb,"ALL"),Fa=[],Ra=0;Ra<Ea.length;Ra++)for(var Ob=Ea[Ra].particle_systems,cb=0;cb<Ob.length;cb++){var Fb=Ob[cb].settings;if("HAIR"==Fb.type)if("OBJECT"==Fb.render_type)w.Zl(Fb.dupli_object,!0);else if("GROUP"==
Fb.render_type){for(var kb=Fb.dupli_group,Pb=ea.wi(Nb,"EMPTY"),sb=0;sb<Pb.length;sb++)Pb[sb].dupli_group==kb&&Fa.push(Pb[sb]);for(sb=0;sb<kb.objects.length;sb++)w.Zl(kb.objects[sb],!0)}else T.warn("B4W Warning: render type",Fb.render_type,"not supported for particle systems ("+Fb.name+").")}for(Ra=0;Ra<Fa.length;Ra++)L(Fa[Ra],[Nb])}O(a,b.id);for(var Qb=a.scenes,hb=0;hb<Qb.length;hb++){for(var Ub=Qb[hb],tb=[],ub=[],Vb=Qb[hb].objects,ib=0;ib<Vb.length;ib++){var vc=Vb[ib];A(Vb,vc,tb,ub);var rc=vc.dupli_group;
if(rc)for(var sc=rc.objects,Dc=0;Dc<sc.length;Dc++)A(sc,sc[Dc],tb,ub)}for(ib=0;ib<ub.length;ib++)L(ub[ib],[Ub]);for(ib=0;ib<tb.length;ib++)ta.us(tb[ib][0],tb[ib][1])}O(a,b.id);for(var za=U(a,b.id),Ca=0;Ca<za.length;Ca++){var lc=za[Ca];!Oa&&lc.parent&&-1<Pa.indexOf(lc.parent.type)&&(lc.parent="");w.Zl(lc,!1);lc.d.cd=b.id}for(var Ec=0;Ec<za.length;Ec++){var wc=za[Ec];if("MESH"==wc.type){var xc=Y.get_first_armature_object(wc);if(xc){var Fc=xc.d;if(Fc.Cd){var yc=wc.d.$b,Rc=[],zc;for(zc in yc){var Sc=
yc[zc];Rc.push(4*Sc.eh,4*Sc.Sm)}Fc.Qo.push(Rc)}Fc.wj.push(wc.d)}}}for(var Gc=-1,Wb=0;Wb<za.length;Wb++){var mc=za[Wb],ec=mc.d;if(ta.dc(mc)&&ec.sh){var Hc=ec.max_bones;Hc>Gc&&(Gc=Hc)}}for(Wb=0;Wb<za.length;Wb++)if(mc=za[Wb],ec=mc.d,ta.dc(mc)&&ec.sh){ec.max_bones=Gc;var Ic=mc,Ac=ec.max_bones,Wc=fa.max_bones,Jc=Ic.d;Ac>2*Wc?ta.ba('B4W Error: too many bones for "'+Ic.name+'"'):Ac>Wc?(T.warn('B4W Warning: too many bones for "'+Ic.name+'" / '+Ac+" bones (max "+Wc+"). Blending between frames will be disabled."),
Jc.jh=!1):Jc.jh=!0;Jc.jh=Jc.jh&&!ab.Mn}for(var Lc=0;Lc<za.length;Lc++){var Gb=za[Lc];if(ta.dc(Gb)){var Mc=Gb.lod_levels.length;if(Mc)for(var nc=Gb,fc=0;fc<Mc;fc++){var tc=Gb.lod_levels[fc].object;if(!tc){nc.d.Vi=!0;nc.d.Td=Gb.lod_levels[fc].distance;break}tc.d.ff=Gb.d.ff;nc.d.Td=Gb.lod_levels[fc].distance;tc.d.vh=Gb.lod_levels[fc].distance;if(Gb.lod_levels[fc+1])tc.d.Td=Gb.lod_levels[fc+1].distance;else{tc.d.Vi=!0;tc.d.Td=1E4;break}nc.d.Vi=!1;nc=tc}}}for(var oc=0;oc<za.length;oc++){var ga=za[oc];
if(ga.b4w_vehicle){var Ga=ga.b4w_vehicle_settings;if("CHASSIS"==Ga.part){ga.f={};ga.f.Ln=Ga.force_max;ga.f.Tm=Ga.brake_max;ga.f.Ex=Ga.suspension_compression;ga.f.Gx=Ga.suspension_stiffness;ga.f.Fx=Ga.suspension_damping;ga.f.py=Ga.wheel_friction;ga.f.uA=Ga.roll_influence;ga.f.Sv=Ga.max_suspension_travel_cm;ga.f.Pf=0;ga.f.Vg=1;ga.f.xg=0;ga.f.speed=0;ga.f.sf=[];ga.f.Kh=[];ga.f.yg=null;for(var dd=ga.wb?ga.wb.dupli_group.objects:za,Kc=0;Kc<dd.length;Kc++){var Aa=dd[Kc];if(Aa.b4w_vehicle){var Sa=Aa.b4w_vehicle_settings;
if(u.Bv(Aa)&&Ga.name==Sa.name){var ed=u.qy(Aa.b4w_vehicle_settings.part);ga.f.sf[ed]=Aa;ga.f.Kh[ed]=new Float32Array(8)}else if(u.Do(Aa)&&Ga.name==Sa.name){ga.f.yg=Aa;ga.f.Ql=Sa.steering_max;ga.f.$p=Sa.steering_ratio;ga.f.zo=Sa.inverse_control;var lb=ua.invert(ga.d.I,new Float32Array(16)),Xc=ua.multiply(lb,Aa.d.I,lb);ga.f.bq=Xc;var Nc=new Float32Array([1,0,0,0]);M.transformMat4(Nc,Xc,Nc);ga.f.aq=Nc}else if(u.Co(Aa)&&Ga.name==Sa.name){ga.f.Ml=Aa;ga.f.Vp=Sa.speed_ratio;ga.f.hl=Sa.max_speed_angle;var lb=
ua.invert(ga.d.I,new Float32Array(16)),Yc=ua.multiply(lb,Aa.d.I,lb);ga.f.Xp=Yc;var Oc=new Float32Array([1,0,0,0]);M.transformMat4(Oc,Yc,Oc);ga.f.Wp=Oc}else if(u.Eo(Aa)&&Ga.name==Sa.name){ga.f.Rl=Aa;ga.f.Bn=Sa.delta_tach_angle;var lb=ua.invert(ga.d.I,new Float32Array(16)),Zc=ua.multiply(lb,Aa.d.I,lb);ga.f.jq=Zc;var Pc=new Float32Array([1,0,0,0]);M.transformMat4(Pc,Zc,Pc);ga.f.iq=Pc}}}if(4!=ga.f.sf.length)throw"Not enough wheels for chassis "+ga.name;}else if("HULL"==Ga.part){ga.f={};ga.f.sf=[];ga.f.Kh=
[];ga.f.Ln=Ga.force_max;ga.f.Tm=Ga.brake_max;ga.f.Ik=Ga.floating_factor;ga.f.cm=Ga.water_lin_damp;ga.f.dm=Ga.water_rot_damp;ga.f.Pf=0;ga.f.Vg=1;ga.f.xg=0;ga.f.speed=0;ga.f.yg=null;for(var fd=ga.wb?ga.wb.dupli_group.objects:za,Kc=0;Kc<fd.length;Kc++)Aa=fd[Kc],Aa.b4w_vehicle&&(Sa=Aa.b4w_vehicle_settings,u.zv(Aa)&&Ga.name==Sa.name?(ga.f.sf.push(Aa),ga.f.Kh.push(new Float32Array(8))):u.Do(Aa)&&Ga.name==Sa.name?(ga.f.yg=Aa,ga.f.Ql=Sa.steering_max,ga.f.$p=Sa.steering_ratio,ga.f.zo=Sa.inverse_control,lb=
ua.invert(ga.d.I,new Float32Array(16)),Xc=ua.multiply(lb,Aa.d.I,lb),ga.f.bq=Xc,Nc=new Float32Array([1,0,0,0]),M.transformMat4(Nc,Xc,Nc),ga.f.aq=Nc):u.Co(Aa)&&Ga.name==Sa.name?(ga.f.Ml=Aa,ga.f.Vp=Sa.speed_ratio,ga.f.hl=Sa.max_speed_angle,lb=ua.invert(ga.d.I,new Float32Array(16)),Yc=ua.multiply(lb,Aa.d.I,lb),ga.f.Xp=Yc,Oc=new Float32Array([1,0,0,0]),M.transformMat4(Oc,Yc,Oc),ga.f.Wp=Oc):u.Eo(Aa)&&Ga.name==Sa.name&&(ga.f.Rl=Aa,ga.f.Bn=Sa.delta_tach_angle,lb=ua.invert(ga.d.I,new Float32Array(16)),Zc=
ua.multiply(lb,Aa.d.I,lb),ga.f.jq=Zc,Pc=new Float32Array([1,0,0,0]),M.transformMat4(Pc,Zc,Pc),ga.f.iq=Pc))}}}for(var bd=0;bd<za.length;bd++){var pc=za[bd];if(pc.b4w_floating){var $c=pc.b4w_floating_settings;if("MAIN_BODY"==$c.part){pc.oc={};pc.oc.Ik=$c.floating_factor;pc.oc.cm=$c.water_lin_damp;pc.oc.dm=$c.water_rot_damp;pc.oc.ni=[];for(var gd=pc.wb?pc.wb.dupli_group.objects:za,cd=0;cd<gd.length;cd++){var Tc=gd[cd];if(Tc.b4w_floating){var hd=Tc.b4w_floating_settings;u.Dv(Tc)&&$c.name==hd.name&&(pc.oc.ni.push(Tc),
Tc.Hs=Tc.b4w_floating_settings.synchronize_position)}}}}}e(b,c)}function e(a,b,c,d,e){!Oa&&1<a.scenes.length&&(a.scenes=[a.scenes[0]],T.warn("B4W Warning: loading data contains multiple scenes.","Only the first one will be loaded."));for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];if(Oa){if(!f.camera)throw"Scene check failed: No camera";if(!ea.wi(f,"LAMP").length)throw"Scene check failed: No lamp";}for(var g=ea.wi(f,"MESH"),h=0;h<g.length;h++){var k=g[h],H=ma.vs(k);H&&(a.meshes.push(H),k.data=H)}for(var h=
U(a,b.id),k=a.meshes,H=k.slice(0),n=0;n<h.length;n++){var l=h[n];"MESH"==l.type&&(l=H.indexOf(l.data),-1<l&&H.splice(l,1))}for(n=0;n<H.length;n++)k.splice(k.indexOf(H[n]),1);Oa?(ea.ls(f),Ta.enabled&&f.b4w_enable_physics&&u.Hm(f),f.b4w_enable_audio&&ca.Im(f),h=ea.Rk(f),k=f.b4w_batch_grid_size):(ea.rs(f,Na),Ta.enabled&&f.b4w_enable_physics&&!Na.j&&u.Hm(Na),f.b4w_enable_audio&&!Na.g&&ca.Im(Na),h=ea.Rk(Na),k=Na.b4w_batch_grid_size);g=P.Gu(h,k,g,f.world);Oa?(ea.Am(f,g),ea.Au(h)):ea.Am(Na,g)}d=a.materials;
if(pa.yk&&fa.uq)for(a=0;a<d.length;a++){f=d[a];k=f.texture_slots;for(g=0;g<k.length;g++)if(H=k[g],n=H.texture,"IMAGE"==n.type||"ENVIRONMENT_MAP"==n.type)h=n.image,h.Yb||(-1<h.filepath.indexOf(".dds")?h.Yb=!0:(h.Yb=!n.b4w_disable_compression&&!H.use_map_normal&&"ENVIRONMENT_MAP"!=n.type&&!n.b4w_shore_dist_map,h.Yb&&(h.filepath+=".dds")));if(g=f.node_tree)for(k=g.nodes,g=0;g<k.length;g++)h=k[g],"TEXTURE"==h.type&&((H=h.texture)?(h=H.image,h.Yb||(h.Yb=H.d.gi&&!H.b4w_disable_compression,h.Yb&&(h.filepath+=
".dds"))):T.warn("B4W Warning: material ",f.name," has empty textures."))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],f.Yb=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));e(b,c)}function n(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},g={},h={},k={},H=0;H<d.length;H++){var n=d[H];f[n.uuid]=n;h[n.uuid]=n}for(H=0;H<a.length;H++)n=a[H],g[n.uuid]=n,k[n.uuid]=n;z(a,null,k,h);for(var l in h)l in f||d.push(h[l]);for(l in k)l in g||a.push(k[l]);e(b,c)}function z(a,b,c,d){for(var e=[],g=0;g<a.length;g++){var h=
a[g],k=c[h.uuid];if(h=k.proxy){b&&-1==e.indexOf(h.uuid)&&e.push(h.uuid);for(var H=c[h.uuid],n=H.constraints,h=0;h<n.length;h++){var l=ta.Fd(n[h]);l.name+="_CLONE";k.constraints.push(l)}"b4w_proxy_inherit_anim"in k&&!k.b4w_proxy_inherit_anim||(k.animation_data&&(H.animation_data=ta.Fd(k.animation_data)),H.b4w_use_default_animation=k.b4w_use_default_animation,H.b4w_auto_skel_anim=k.b4w_auto_skel_anim,H.b4w_cyclic_animation=k.b4w_cyclic_animation)}}for(g=0;g<e.length;g++)k=ta.Sk(a,"uuid",e[g]),-1<k&&
a.splice(k,1);e={};for(g=0;g<a.length;g++)h=a[g],k=c[h.uuid],b&&(n=ta.Fd(k),k="origin_name"in k?k.origin_name:k.name,n.name=b+"*"+k,n.origin_name=k,f(n),c[n.uuid]=n,e[h.uuid]=n.uuid,h.uuid=n.uuid),k=c[h.uuid],k.dupli_group&&(h=k.dupli_group,n=d[h.uuid],H=ta.Fd(n),H.name=ta.Fj(n.name+"_CLONE"),H.uuid=R.so("Group"+H.name),d[H.uuid]=H,h.uuid=H.uuid,z(H.objects,k.name,c,d));if(b)for(g=0;g<a.length;g++){h=a[g];k=c[h.uuid];k.parent&&k.parent.uuid in e?k.parent.uuid=e[k.parent.uuid]:k.parent&&(T.warn("B4W Warning: Object's \""+
k.name+'" parent is not in dupli group. Disabling parenting.'),k.parent=null);n=k.constraints;for(h=0;h<n.length;h++)b=n[h],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=k.modifiers;for(h=0;h<b.length;h++)d=b[h],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((k=k.lod_levels)&&k.length)for(h=0;h<k.length;h++)b=k[h],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var u in e)$a[u]=e[u]}function f(a){a.uuid=R.so("Object"+a.name)}function t(a,b){for(var c=
a.nodes,d=0;d<c.length;d++){var e=c[d];"MATERIAL"!=e.type&&"MATERIAL_EXT"!=e.type||!e.material||s(e,"material",b);"TEXTURE"==e.type&&e.texture&&s(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in $a&&(e.lamp.uuid=$a[e.lamp.uuid]),b[e.lamp.uuid]||T.error("Dangling link found:","lamp",e));"GROUP"==e.type&&e.node_group&&s(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var f=e[d];r(f,"from_node",c);r(f,"to_node",c);p(f,"from_socket",f.from_node.outputs);p(f,"to_socket",f.to_node.inputs)}if(c=
a.animation_data)if(c.action&&s(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],f=0;f<e.strips.length;f++)e.strips[f].action&&s(e.strips[f],"action",b)}function s(a,b,c){(c=c[a[b].uuid])||T.error("Dangling link found:",b,a);a[b]=c}function r(a,b,c){c=ta.keysearch("name",a[b].name,c);a[b]=c}function p(a,b,c){c=ta.keysearch("identifier",a[b].identifier,c);a[b]=c}function F(a,b,d,e,f,g){if(!fa.do_not_load_resources){for(var h=N(b.w),k=a.images,H={},n=[],l=0;l<k.length;l++){var u=
k[l],p=u.uuid;if("FILE"===u.source){var r=q(u,a.textures);if(!r.length)T.warn("B4W Warning: image ",u.name," has no users.");else if(!r[0].b4w_shore_dist_map){var w=V(h+u.filepath),r=u.Yb?ia.AT_ARRAYBUFFER:ia.AT_IMAGE_ELEMENT;pa.jl&&fa.Lj&&(w=ia.Nl(w),"dds"==w[1]?(w=ia.Nl(w[0]),w=w[0]+".min50."+w[1]+".dds"):w=w[0]+".min50."+w[1]);n.push([p,r,w,u.name]);H[p]=u}}}n.length?(e.uo=0,ia.enqueue(n,function(f,h,k,l){if(f)for(c(f,l,!0),h=H[h],k=q(h,a.textures),l=0;l<k.length;l++){var u=k[l];ka.Jj(u.d,f,h.Yb,
u.image.filepath)}f=++e.uo/n.length;g(b,d,f)},function(){T.log("%cLOADED ALL IMAGES","color: #0a0");f(b,d)})):f(b,d)}}function q(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function v(a,b,c,d,e,f){if(!fa.do_not_load_resources){a=U(a,b.id);for(var g=N(b.w),h=[],k={},H=0;H<a.length;H++){var n=a[H];if(x(n)){var l=n.data.sound,u=l.uuid;"BACKGROUND_MUSIC"==ca.co(n)&&(u=ta.zu());if(!(u in k)){k[u]=[];l=V(g+l.filepath);switch(ca.Tp(n)){case ca.Oj:var p=ia.AT_AUDIOBUFFER;
break;case ca.gm:p=ia.AT_AUDIO_ELEMENT}var l=ia.Nl(l),q=ca.Zt(l[1]);if(q!=l[1]){if(ia.Av()){D.Jl(b,"load_speakers");return}l=l[0]+".lossconv."+q}else l=l[0]+"."+q;h.push([u,p,l])}k[u].push(n)}}h.length?ia.enqueue(h,function(a,e,g,H){if(a)for(T.log("%cLOAD SOUND","color: #0aa",H),-1==H.indexOf(Hb)&&T.warn("B4W Warning: sound",H,"is not from app root."),e=k[e],g=0;g<e.length;g++)ca.$x(e[g],a);a=++d.jx/h.length;f(b,c,a)},function(){T.log("%cLOADED ALL SOUNDS","color: #0aa");for(var a=ea.get_active(),
a=ea.la(a,"SPEAKER",ea.DATA_ID_ALL),d=0;d<a.length;d++){var f=a[d];ca.Sd(f)&&ca.is_cyclic(f)&&ca.play_def(f)}e(b,c)}):e(b,c)}}function x(a){return ca.Sd(a)&&ca.Tp(a)!=ca.hm?!0:!1}function A(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,g=0;g<e;g++){var h=b.lod_levels[g],k=h.object;if(k){var H=ta.ti(k);H.name=b.name+"_LOD_"+String(g+1);f(H);H.lod_levels=[];c.push([a,H]);d.push(k);h.object=H}}}function L(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=
d[e].dupli_group;f&&(f=f.objects,g=f.indexOf(a),-1<g&&f.splice(g,1))}var g=d.indexOf(a);-1<g&&d.splice(g,1)}}function I(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d],g=Oa?f.b4w_enable_physics:Na.b4w_enable_physics||f.b4w_enable_physics;Oa||(f=Na);for(var h=0;h<Ha.length;h++)for(var k=ea.la(f,Ha[h],ea.DATA_ID_ALL),H=0;H<k.length;H++){var n=k[H];n.d.cd==b.id&&Ta.enabled&&g&&(u.append_object(n,f),b.No&&u.has_physics(n)&&u.disable_simulation(n))}}e(b,c)}function y(a,b,d,e,f){var g={};e=
[];for(var h=a.scenes,k=0;k<a.scenes.length;k++){var H=h[k];if(H.d.za&&(H=H.d.za.vj)&&"FILE"===H.source){var n=H.uuid,l=V(N(b.w)+H.filepath);e.push([n,H.Yb?ia.AT_ARRAYBUFFER:ia.AT_IMAGE_ELEMENT,l,H.name]);g[n]=H}}e.length?ia.enqueue(e,function(b,d,e,f){if(b){c(b,f,!0);d=g[d];f=q(d,a.textures);for(e=0;e<f.length;e++){var k=f[e];ka.Jj(k.d,b,d.Yb,k.image.filepath)}for(e=0;e<h.length;e++)if(f=h[e],f.d.za.vj===d){var H=b,n=d,l=document.createElement("canvas"),k=n.size[0],n=n.size[1];l.width=k;l.height=
n;l=l.getContext("2d");l.drawImage(H,0,0);H=l.getImageData(0,0,k,n).data;l=new Float32Array(4);l[0]=1/16581375;l[1]=1/65025;l[2]=1/255;l[3]=1;for(var k=k*n,n=new Float32Array(k),u=0;u<k;u++)n[u]=l[1]*H[4*u+2]+l[2]*H[4*u+3];f.d.Gl=n}}},function(){f(b,d)}):f(b,d)}function C(a,b,d,e,f){if(fa.antialiasing&&fa.smaa){e=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],h=0;h<g.length;h++){var k=ea.fa(e,g[h]);k&&a.push(k)}if(a.length){e=
[];h=ia.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",h,X.rb.smaa_search_texture_path,"smaa_search_texture"]);e.push(["AREA_TEXTURE",h,X.rb.smaa_area_texture_path,"smaa_area_texture"]);for(h=0;h<a.length;h++)if(g=a[h],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.W;for(h=0;h<a.length;h++)if(g=a[h],"u_search_tex"==g.S)var H=g.oa;else if("u_area_tex"==g.S)var n=g.oa;break}e.length?ia.enqueue(e,function(a,b,d,e){a&&(c(a,e,!1),b="SEARCH_TEXTURE"==b?H:n,b.source="IMAGE",b.Lm=!0,ka.Jj(b,a,-1!=e.indexOf(".dds")?
1:0,e),ka.sj(b,ka.r,ka.r))},function(){f(b,d)}):f(b,d)}else f(b,d)}else f(b,d)}function B(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];Oa||(e=Na);for(var f=ea.la(e,"ALL",ea.DATA_ID_ALL),g=0;g<f.length;g++){var h=f[g];h.d.cd==b.id&&(b.No&&ea.hide_object(h),d.Bm.push({Fw:e,obj:h}))}}}function G(a,b,c,d,e,f){a=d.Bm;var g=d.Xo;a?(e=a[g].obj,g=a[g].Fw,ea.append_object(g,e),-1!=db.indexOf(e.type)&&g.b4w_enable_audio&&ca.append_object(e,g),d=++d.Xo/a.length):d=1;f(b,c,d)}function K(a,b,c,d,
e){if(Oa){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];ea.kw(f);f.b4w_use_nla&&H.Yx(f,f.b4w_nla_cyclic)}ea.set_active(a.scenes[0])}else ea.tq(Na);a=U(a,b.id);w.Xx(a);e(b,c)}function N(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function V(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&
c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function U(a,b){vb[b]||O(a,b);return vb[b]}function O(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)J(c[e].objects,0,d);vb[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var g=c[f],h=0;h<g.length;h++)vb[b].push(g[h])}function J(a,b,c){c[b]=c[b]||[];for(var d=c[b],e=0;e<a.length;e++){var f=a[e],g=Q(f);d[g]=d[g]||[];(Oa||-1==Pa.indexOf(f.type))&&-1==d[g].indexOf(f)&&d[g].push(f);(f=f.dupli_group)&&J(f.objects,b+1,c)}}
function Q(a){return(a=a.parent||Y.get_first_armature_object(a))?1+Q(a):0}var Y=m("__animation"),P=m("__batch"),X=m("__config"),Z=m("__controls"),S=m("__dds"),da=m("__extensions");m("__lights");var D=m("__loader"),ia=m("__assets"),R=m("__md5"),w=m("__objects"),u=m("__physics"),T=m("__print"),ma=m("__reformer"),W=m("__renderer"),ea=m("__scenes"),H=m("__nla"),ca=m("__sfx"),ja=m("__shaders"),ka=m("__textures"),ha=m("__nodemat"),ta=m("__util"),M=m("vec4"),ua=m("mat4"),fa=X.p,pa=X.Dd,Ta=X.Za,ab=X.Ae,bb=
null,vb=null,Hb="",Oa=!1,Na=null,$a={},Pa=["LAMP","CAMERA"],Ha=["MESH","CAMERA","EMPTY"],db=["SPEAKER"];a.is_primary_loaded=function(a){return D.is_primary_loaded(a)};a.update=function(){D.Zx(bb)};a.load=function(a,c,f,k,H){var u={load_main:{$a:D.se,nb:!1,H:[],qb:!1,Cb:500,Hb:!1,eb:h},duplicate_objects:{$a:D.te,nb:!1,H:["load_main"],qb:!1,Cb:50,Hb:!1,eb:n},load_binaries:{$a:D.se,nb:!1,H:["load_main"],qb:!1,Cb:500,Hb:!1,eb:d},prepare_bindata:{$a:D.te,nb:!1,H:["duplicate_objects","load_binaries"],qb:!1,
Cb:0,Hb:!1,eb:l},prepare_root_datablocks:{$a:D.te,nb:!1,H:["duplicate_objects","prepare_bindata"],qb:!1,Cb:150,Hb:!1,eb:g},prepare_root_scenes:{$a:D.te,nb:!1,H:["prepare_root_datablocks"],qb:!1,Cb:350,Hb:!1,eb:e},load_smaa_textures:{$a:D.se,nb:!0,H:["prepare_root_scenes"],qb:!1,Cb:10,Hb:!0,eb:C},load_shoremap:{$a:D.se,nb:!0,H:["prepare_root_scenes"],qb:!1,Cb:10,Hb:!0,eb:y},load_textures:{$a:D.se,nb:!0,H:["prepare_root_scenes"],qb:!0,Cb:500,Hb:!1,eb:F,Ie:{uo:0}},add_physics_objects:{$a:D.te,nb:!1,
H:["load_shoremap"],qb:!1,Cb:20,Hb:!1,eb:I},add_objects:{$a:D.te,nb:!1,H:["add_physics_objects"],qb:!1,Cb:800,Hb:!1,eb:B,Xg:G,Wg:K,Ie:{Bm:[],Xo:0}},load_speakers:{$a:D.se,nb:!0,H:["add_objects"],qb:!0,Cb:30,Hb:!1,eb:v,Ie:{jx:0}}},p=D.ao();p||(p=D.Bt(),bb=[],vb=[],$a={});bb[p.Pc.length]={};return D.Kt(u,a,c,f,b,k,fa.do_not_load_resources,H)};a.unload=function(a){var b=D.ao();if(!b||!b.Pc.length||a&&!D.Ix(b.Pc[a]))T.error("Unable to unload data!");else if(0==a)T.log("%cUNLOAD ALL","color: #00a"),Y.cleanup(),
ca.cleanup(),H.cleanup(),ea.cleanup(),D.cleanup(),u.cleanup(),w.cleanup(),ta.cleanup(),W.cleanup(),ha.cleanup(),ja.cleanup(),Z.cleanup(),da.cleanup(),ia.cleanup(),vb=null,$a={},Oa=!1,bb=Na=null;else{T.log("%cUNLOAD DATA "+a,"color: #00a");Y.tw(a);for(var b=ea.Hi(),c=0;c<b.length;c++)for(var d=b[c],e=ea.la(d,"ALL",ea.DATA_ID_ALL),f=e.length-1;0<=f;f--){var g=e[f];if(g.d.cd==a){var h=d,k=g;Y.is_animated(k)&&Y.remove(k);ea.clear_glow_anim(k);u.has_physics(k)&&(u.disable_simulation(k),u.uw(k));Z.check_sensor_manifold(k)&&
Z.remove_sensor_manifold(k);ea.vw(h,k);ca.Sd(k)&&ca.kx(k);e.splice(f,1);h=ea.la(d,g.type,ea.DATA_ID_ALL);g=h.indexOf(g);-1!=g&&h.splice(g,1)}}}};a.set_debug_resources_root=function(a){Hb=a}};b4w.module.__batch=function(a,m){function b(a){a={type:a,id:0,yl:0,eg:"",Ea:[],Ub:[],qc:[],ol:[],$c:[],yf:null,Na:{},ub:null,Da:null,Jm:[],Fc:null,Ua:null,$b:null,ob:null,yn:!1,num_vertices:0,num_triangles:0,Si:0,Ti:0,Vf:0,Mi:0,Tk:0,Fb:new Float32Array(3),ln:new Float32Array(3),Ac:new Float32Array(16),ka:!1,mn:!1,O:!1,kc:!1,ia:!1,Mj:!1,fd:!1,Kb:!1,Lb:!1,kb:!1,Rb:!1,Jb:!1,hc:!1,xa:!1,Jh:!1,ed:J.Pg,zd:J.Vc,Eg:0,Tl:new Float32Array(2),o:new Float32Array(2),jo:!1,no:0,ko:0,oo:0,po:0,mo:new Float32Array(3),
lo:new Float32Array(3),Ve:!1,xc:0,Ld:0,Le:1,Mh:0,Up:0,xj:1,Dh:0,Ke:0,ye:1,Vo:0,kl:0,mf:0,zp:0,dd:Array(2),kf:Array(4),Hd:new Float32Array(2),jc:new Float32Array(3),Nc:new Float32Array(3),vd:new Float32Array(3),ib:new Float32Array(4),kd:new Float32Array(4),Zf:null,$k:null,Yk:null,Xk:null,Zk:null,oe:!1,water_dynamic:!1,em:!1,Cq:!1,Dq:0,Eq:0,Bq:0,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,Kn:new Float32Array(2),Jn:new Float32Array(2),Jk:new Float32Array(2),shallow_water_col:new Float32Array(3),
shore_water_col:new Float32Array(3),jf:null,xl:!1,gp:0,cp:0,pl:0,fp:0,ip:0,hp:0,dp:0,ep:0,ql:0,$o:0,Zo:0,kp:0,bp:0,gj:new Float32Array(3),jp:new Float32Array(8),ap:new Float32Array(16)};a.ib[3]=1;a.mn=!0;a.O=!0;a.Eg=1;return a}function c(a,b){for(var c=[],e=0;e<a.length;e++){var f=a[e],g=f.d,h=l(f.data.b4w_bounding_box);g.zb=h;var k=f.data.b4w_bounding_cylinder_radius,n=g,u=k,p=h;n.dk=N.rn(u,p);n.bk=N.pn(k,p);n.ck=N.qn(u,p);h=N.fk(h,g.I);g.Fa=h;h=N.sk(f.data.b4w_bounding_sphere_radius,f.data.b4w_bounding_sphere_center);
g.pc=h;h=N.hk(h,g.I);g.cb=h;h=f.data.b4w_bounding_ellipsoid_axes;h=N.rk([h[0],0,0],[0,h[1],0],[0,0,h[2]],f.data.b4w_bounding_ellipsoid_center);g.Fe=h;h=N.gk(h,g.Qc);g.Ge=h;c=c.concat(d(f,g,b))}return c}function h(a,b,c){for(var e=[],f=[],g={},h=0;h<a.length;h++){var k=a[h],n=k.d,u=l(k.data.b4w_bounding_box),p=N.fk(u,n.I),q=N.sk(k.data.b4w_bounding_sphere_radius,k.data.b4w_bounding_sphere_center),r=N.hk(q,n.I),s=k.data.b4w_bounding_ellipsoid_axes,s=N.rk([s[0],0,0],[0,s[1],0],[0,0,s[2]],k.data.b4w_bounding_ellipsoid_center),
t=N.gk(s,n.Qc);n.zb=u;n.Fa=p;n.pc=q;n.cb=r;n.Fe=s;n.Ge=t;u={};u.Kb=n.Kb;u.Lb=n.Lb;u.kb=n.kb;u.Gc=n.Gc;u.fj=n.fj;u.Ki=n.Ki;u.Rb=n.Rb;u.Jb=n.Jb;u.hc=n.hc;u.He=n.He;u.Sc=n.Sc;u.rd=n.rd;u.pb=n.pb;u.Xf=n.Xf;u.Oi=n.Oi;u.xa=n.xa;u.Lf=n.Lf;u.Bi=n.Bi;u.fd=n.fd;p=n.cb.s;u.ov=0==c?[0,0]:[Math.floor(p[0]/c),Math.floor(p[2]/c)];u.Td=n.Td;u.vh=n.vh;u.ff=n.ff;n=JSON.stringify(u);g[n]=g[n]||[];g[n].push(k)}for(var C in g){u=JSON.parse(C);c=g[C];var k=P.yi("STATIC"),z;for(z in u)k[z]=u[z];k.cd=a[0].d.cd;k.Tc=0;k.re=
0;k.Jd=0;k.Id=0;k.Ed=0;k.oh=!1;for(h=0;h<c.length;h++)n=c[h],0==h?(k.Fa=w.sa(n.d.Fa),k.cb=w.sa(n.d.cb),k.Fe=w.sa(n.d.Fe),k.Ge=w.sa(n.d.Ge)):(N.En(k.Fa,n.d.Fa),N.iu(k.cb,n.d.cb));k.zb=w.sa(k.Fa);k.pc=w.sa(k.cb);f.push({tb:k,rc:c})}for(a=0;a<f.length;a++)for(g=f[a].tb,h=f[a].rc,C=0;C<h.length;C++){n=h[C];z=d(n,g,b);c=L(n.d)||L(g);k={};g.Sc&&(k.au_center_pos=[c[0],c[1],c[2]],k.au_wind_bending_amp=[n.d.Tc],k.au_wind_bending_freq=[n.b4w_wind_bending_freq],k.au_detail_bending_amp=[n.b4w_detail_bending_amp],
k.au_detail_bending_freq=[n.b4w_detail_bending_freq],k.au_branch_bending_amp=[n.b4w_branch_bending_amp]);for(n=0;n<z.length;n++)u=z[n].tb,p=z[n].Tb,u.Wk?u.Xf?J.yx(p,c):J.dq(p,c):(p=J.dq(p,c),J.xx(p,k));e=e.concat(z)}for(a=0;a<f.length;a++)for(g=f[a].tb,h=f[a].rc,C=0;C<h.length;C++)n=h[C],n.tm=n.d,n.d=g;return e}function d(a,c,d){var e=[];if(a.b4w_do_not_render)return e;for(var f=k(d,c),h=w.ri(c,0),n=a.data,l=n.materials,p=0;p<f.length;p++)for(var q=f[p],r=0;r<l.length;r++)if(!J.ro(n,r)){var s=b(q),
t=l[r];if(g(s,t,!0)){s.ed=n.ed||J.Pg;"COLOR_ID"===q&&s.ln.set(a.sm);F(s,c);for(var C=s,z=a.particle_systems,x=0;x<z.length;x++){var m=z[x].settings.b4w_vcol_from_name,R=z[x].settings.b4w_vcol_to_name;""!==m&&""!==R&&(C.Na[m]={Te:!1,src:[{name:m,ec:7}]})}"DYNAMIC"==c.type&&(s.eg=a.uuid);I(s,h);C=J.Hn(n,r,s.$c,s.$b,s.Na,s.yf);"LENS_FLARES"==t.name&&(C=X.jw(C));e.push({k:s,Tb:C,Ob:[t.name],tb:c,sc:[a]})}}n=a.particle_systems;if(0<n.length&&e.length){f=!0;for(p=0;p<n.length;p++)if(n[p].settings.use_render_emitter){f=
!1;break}p=e[0].k;n=e[0].Tb;l=[];q=a.particle_systems;r=a.data;for(s=0;s<q.length;s++)if(t=q[s],C=t.settings,C.count)if("EMITTER"==C.type){if("DYNAMIC"==c.type){z=b("PARTICLES");x=r.materials;m=t.settings.material-1;m>=x.length&&(U.warn('B4W Warning: Wrong material used for rendering particle system "'+t.name+'"'),m=0);x=x[m];"HALO"===t.settings.render_type&&(z.Ve=!0);g(z,x);F(z,c);m=z;switch(t.settings.b4w_billboard_align){case "VIEW":v(m,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":v(m,
"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":v(m,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":v(m,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}z.fd=!0;z.eg=a.name+"_"+C.uuid;I(z,h);z.Fc=t;C=X.Du(z,r,t,a.d.Qc);X.Ow(z,t,x);l.push({k:z,Tb:C,Ob:[x.name],tb:c,sc:[a]})}}else if("HAIR"==C.type){z=w.Qi(t.seed);C.b4w_dynamic_grass&&(c.Lf=!0);if(t.transforms.length)var B=t.transforms;else for(var x=J.Ok(n,C.count,!1,z),B=new Float32Array(4*
x.length),T=0;T<x.length;T++)m=.75+.5*w.gc(z),B[4*T]=x[T][0],B[4*T+1]=x[T][1],B[4*T+2]=x[T][2],B[4*T+3]=m;x=da.Ia(d,"GRASS_MAP")?!0:!1;if("OBJECT"==C.render_type)m=[k(d,C.dupli_object.d)],t=A(a,c,p,n,[C.dupli_object],m,[B],C,t,x,z,!1),l=l.concat(t);else if("GROUP"==C.render_type){for(var R=C.dupli_group.objects,G=!1,m=[],T=0;T<R.length;T++){var W=k(d,C.dupli_group.objects[T].d);m.push(W)}if(C.use_whole_group){G=B;B=R;T={};for(W=0;W<G.length;W+=4)for(var ea=0;ea<B.length;ea++){var K=u.create();u.scale(B[ea].d.e,
B[ea].d.scale,K);var y=u.clone([G[W],G[W+1],G[W+2]]);u.add(y,K,y);T[ea]||(T[ea]=new Float32Array(G.length));T[ea][W]=y[0];T[ea][W+1]=y[1];T[ea][W+2]=y[2];T[ea][W+3]=G[W+3]}B=T;G=!0}else if(C.use_group_count){for(var y=R,ma=C.dupli_weights,T=z,W={},ea=[],K=0;K<y.length;K++)for(var D=y[K],D=D.origin_name||D.name,L=0;L<ma.length;L++){var O=ma[L];D==O.name.split(": ")[0]&&ea.push(O)}ma.length!=ea.length&&U.error("B4W Error: dupli weights match failed");for(K=0;K<B.length;K+=4){var N,ma=ea;N=[0];for(y=
0;y<ma.length;y++)N[y+1]=N[y]+ma[y].count;ma=N[N.length-1]*w.gc(T);for(y=D=0;y<N.length;y++)if(ma>=N[y]&&ma<N[y+1]){D=y;break}N=D;W[N]=W[N]||[];W[N].push(B[K],B[K+1],B[K+2],B[K+3])}for(N in W)W[N]=new Float32Array(W[N]);B=W}else{T=z;W=R.length;ea={};for(K=0;K<B.length;K+=4){var V=Math.floor(W*w.gc(T));ea[V]=ea[V]||[];ea[V].push(B[K],B[K+1],B[K+2],B[K+3])}for(V in ea)ea[V]=new Float32Array(ea[V]);B=ea}t=A(a,c,p,n,R,m,B,C,t,x,z,G);l=l.concat(t)}"INSTANCE"==C.b4w_wind_bend_inheritance&&(a.d.Tc=0)}else throw"Unknown particle settings type";
a=l;e=f?a:e.concat(a)}return e}function l(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function k(a,b){var c=["MAIN","NODES"];b.Gc&&(da.Ia(a,"COLOR_PICKING")||da.Ia(a,"GLOW_MASK"))&&c.push("COLOR_ID");da.Ia(a,"WIREFRAME")&&c.push("WIREFRAME");c.push("PHYSICS");(da.Ia(a,"DEPTH")||da.Ia(a,"SHADOW_CAST"))&&c.push("DEPTH");da.Ia(a,"GRASS_MAP")&&c.push("GRASS_MAP");if(b.Lb||b.Jb){var d=null;b.Lb&&(d=["MAIN","NODES","COLOR_ID","PHYSICS","WIREFRAME"]);if(b.Jb)var e=
["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],d=null!==d?w.ys(d,e):e;for(e=0;e<d.length;e++){var f=c.indexOf(d[e]);-1!==f&&c.splice(f,1)}}return c}function g(a,b,c){var d,g;switch(a.type){case "MAIN":if(b.b4w_collision||b.use_nodes)a=!1;else{for(var h=0;4>h;h++)a.kf[h]=new Float32Array([0,0]);e(a,b);h=b.game_settings.alpha_blend;a.kc=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;a.mf=b.offset_z;a.Nc.set([1,1,1]);var k=b.texture_slots;T.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,
a.ib);switch(b.name){case "LENS_FLARES":C(a,"special_lens_flares.glslv","special_lens_flares.glslf");q(a,"a_position");q(a,"a_texcoord");var l=c?[1,1,1,0]:null,l=n(k[0],l);B(a,l);break;default:C(a,"main.glslv","main.glslf");var h=z("use_map_color_diffuse",k)[0],u=z("use_map_color_spec",k)[0],p=z("use_map_normal",k)[0],w=z("use_map_mirror",k)[0],x=z("use_map_color_diffuse",k)[1],m=z("use_rgb_to_intensity",k)[0]&&z("use_stencil",k)[0];if(h){switch(h.blend_type){case "MIX":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");
break;case "MULTIPLY":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}l="IMAGE"==h.texture.d.source&&c?[a.ib[0],a.ib[1],a.ib[2],1]:"ENVIRONMENT_MAP"==h.texture.d.source&&c?[.8,.8,.8,1]:null;l=n(h,l);B(a,l,"u_colormap0");a.Ke=h.diffuse_color_factor;a.ye=h.use_map_alpha?h.alpha_factor:0;a.Hd.set(h.texture.b4w_uv_velocity_trans);a.Nc.set(h.scale)}var R=h&&h==u;u&&(R||(l=c?[.5,.5,.5,1]:null,l=n(u,l),B(a,l,"u_specmap")),a.Up=u.specular_color_factor);if(p&&(q(a,"a_normal"),q(a,"a_tangent"),l=c?
[.5,.5,1,1]:null,l=n(p,l),B(a,l,"u_normalmap0"),a.Vo=p.normal_factor,k=p.texture,a.kf[0].set(k.b4w_uv_velocity_trans),k.b4w_use_map_parallax&&W.Ch)){var l=D.t(k.b4w_parallax_steps),A=D.t(k.b4w_parallax_lod_dist);v(a,"PARALLAX",1);v(a,"PARALLAX_STEPS",l);v(a,"PARALLAX_LOD_DIST",A);a.Dh=k.b4w_parallax_scale}w&&(l=c?[0,0,.5,1]:null,l=n(w,l),B(a,l,"u_mirrormap"),a.kl=w.mirror_factor);if(k=h&&x&&m?1:0)l=c?[.8,.8,.8,1]:null,l=n(x,l),B(a,l,"u_colormap1"),l=c?[.5,.5,.5,1]:null,l=n(m,l),B(a,l,"u_stencil0");
(c=h||u||p)&&a.Nc.set(c.scale);v(a,"TEXTURE_COLOR",void 0==h?0:1);v(a,"TEXTURE_SPEC",void 0==u?0:1);v(a,"TEXTURE_NORM",void 0==p?0:1);v(a,"TEXTURE_MIRROR",void 0==w?0:1);v(a,"ALPHA_AS_SPEC",R?1:0);v(a,"TEXTURE_STENCIL_ALPHA_MASK",k);q(a,"a_position");q(a,"a_normal");(h||u||p)&&q(a,"a_texcoord");if(b.b4w_water){a.oe=!0;a.em=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;c=b.texture_slots;C(a,"special_water.glslv","special_water.glslf");q(a,"a_position");q(a,"a_texcoord");q(a,"a_normal");
q(a,"a_tangent");p=z("use_map_normal",c);u=z("use_map_mirror",c)[0];p.length&&(w=n(p[0]),B(a,w,"u_normalmap0"));v(a,"NUM_NORMALMAPS",p.length);a.jf=Array(p.length);for(w=0;w<p.length;w++)a.kf[w].set(p[w].texture.b4w_uv_velocity_trans),a.jf[w]=new Float32Array(2),a.jf[w].set([p[w].scale[0],p[w].scale[1]]);u?(v(a,"TEXTURE_MIRROR",1),p=n(u),B(a,p,"u_mirrormap"),a.kl=u.mirror_factor):v(a,"TEXTURE_MIRROR",0);u=null;for(w=0;w<c.length;w++)if(d=c[w],!0===d.texture.b4w_water_foam){u=d;break}u&&W.Qf?(v(a,
"FOAM",1),p=n(u),B(a,p,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.Kn.set(u.texture.b4w_foam_uv_freq),a.Jn.set(u.texture.b4w_foam_uv_magnitude),a.Jk[0]=u.scale[0],a.Jk[1]=u.scale[1]):v(a,"FOAM",0);for(w=0;w<c.length;w++)if(d=c[w],!0===d.texture.b4w_shore_dist_map){g=d;break}g&&W.Vj?(g=n(g),B(a,g,"u_shore_dist_map"),v(a,"SHORE_PARAMS",1),g=d.texture.b4w_shore_boundings,v(a,"MAX_SHORE_DIST",D.t(d.texture.b4w_max_shore_dist)),v(a,"SHORE_MAP_SIZE_X",D.t(g[0]-g[1])),v(a,"SHORE_MAP_SIZE_Z",D.t(g[2]-g[3])),
v(a,"SHORE_MAP_CENTER_X",D.t((g[0]+g[1])/2)),v(a,"SHORE_MAP_CENTER_Z",D.t((g[2]+g[3])/2))):v(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&W.deferred_rendering?(v(a,"GENERATED_MESH",1),a.Cq=!0,a.Dq=b.b4w_water_num_cascads,a.Eq=b.b4w_water_subdivs,a.Bq=b.b4w_water_detailed_dist):v(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){d=D.t(b.b4w_water_dst_noise_scale0);g=D.t(b.b4w_water_dst_noise_scale1);c=D.t(b.b4w_water_dst_noise_freq0);var u=D.t(b.b4w_water_dst_noise_freq1),p=D.t(b.b4w_water_dir_min_shore_fac),
w=D.t(b.b4w_water_dir_freq),R=D.t(b.b4w_water_dir_noise_scale),m=D.t(b.b4w_water_dir_noise_freq),l=D.t(b.b4w_water_dir_min_noise_fac),A=D.t(b.b4w_water_dst_min_fac),G=D.t(b.b4w_water_waves_hor_fac);v(a,"DST_NOISE_SCALE_0",d);v(a,"DST_NOISE_SCALE_1",g);v(a,"DST_NOISE_FREQ_0",c);v(a,"DST_NOISE_FREQ_1",u);v(a,"DIR_MIN_SHR_FAC",p);v(a,"DIR_FREQ",w);v(a,"DIR_NOISE_SCALE",R);v(a,"DIR_NOISE_FREQ",m);v(a,"DIR_MIN_NOISE_FAC",l);v(a,"DST_MIN_FAC",A);v(a,"WAVES_HOR_FAC",G)}t(a,b);s(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);
a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;v(a,"ABSORB",D.t(b.b4w_water_absorb_factor));v(a,"SSS_STRENGTH",D.t(b.b4w_water_sss_strength));v(a,"SSS_WIDTH",D.t(b.b4w_water_sss_width));d=a.Da;g=a.$c;a.Da=d;a.$c=g}"HALO"===b.type&&(d=b.halo,C(a,"halo.glslv","halo.glslf"),v(a,"NUM_RINGS",d.ring_count),v(a,"NUM_LINES",d.line_count),v(a,"NUM_STARS",d.star_tip_count),v(a,"SKY_STARS",b.b4w_halo_sky_stars?
1:0),a.$c=["a_position"],a.no=d.size,a.ko=d.hardness/20,a.mo.set(d.b4w_halo_rings_color),a.lo.set(d.b4w_halo_lines_color),a.oo=1/b.b4w_halo_stars_blend_height,a.po=b.b4w_halo_stars_min_height,a.jo=!0);h&&"NORMAL"==h.texture_coords||k&&"NORMAL"==x.texture_coords?v(a,"TEXTURE_COORDS","TEXTURE_COORDS_NORMAL"):h&&"UV"==h.texture_coords?v(a,"TEXTURE_COORDS","TEXTURE_COORDS_UV"):v(a,"TEXTURE_COORDS",0);v(a,"SHADELESS",b.use_shadeless?1:0);a.Mj=b.use_shadeless}h=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===
h?0:1);v(a,"ALPHA_CLIP","CLIP"===h?1:0);v(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(v(a,"VERTEX_COLOR",1),q(a,"a_color")):v(a,"VERTEX_COLOR",0);a.xc=b.ambient;a.Le=b.diffuse_intensity;a.Ld=b.emit;a.vd.set(b.specular_color);a.xj=b.specular_alpha;t(a,b);s(a,b);b.b4w_wettable?v(a,"WETTABLE",1):v(a,"WETTABLE",0);f(a,b);b.b4w_refractive&&W.$d?(a.xl=!0,a.zp=b.b4w_refr_bump,v(a,"REFRACTIVE",1)):v(a,"REFRACTIVE",0);W.Ue?v(a,"UNROLL_LOOPS",1):v(a,"UNROLL_LOOPS",0);
a=!0}break;case "NODES":a=r(a,b);break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_collision||"HALO"===b.type)a=!1;else if(e(a,b),a.ka)a=!1;else{C(a,"depth.glslv","depth.glslf");q(a,"a_position");q(a,"a_normal");h=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===h?0:1);a.Nc.set([1,1,1]);if((b=z("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===h){a.Nc.set(b.scale);v(a,"TEXTURE_COLOR",1);q(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)h=
n(b),B(a,h,"u_colormap0"),a.Hd.set(b.texture.b4w_uv_velocity_trans);"NONE"==b.texture.d.source&&(h=n(b),B(a,h,"u_colormap0"),a.Hd.set(b.texture.b4w_uv_velocity_trans))}else v(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.dy=b.b4w_use_ghost,a.Mb=b.b4w_collision_id,a.jn=b.b4w_collision_group,a.kn=b.b4w_collision_mask,a.kh=b.physics.friction,a.gh=b.physics.elasticity,a=!0):b.b4w_water?(a.oe=!0,a.my=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=
b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_collision||"HALO"===
b.type)a=!1;else{e(a,b);a.zd=J.Vc;a.O=!0;a.ka=!1;h=b.game_settings.alpha_blend;a.kc=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;C(a,"color_id.glslv","color_id.glslf");q(a,"a_position");h=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===h?0:1);a.Nc.set([1,1,1]);if((b=z("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===h){a.Nc.set(b.scale);v(a,"TEXTURE_COLOR",1);q(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)h=n(b),B(a,h,"u_colormap0"),a.Hd.set(b.texture.b4w_uv_velocity_trans);
"NONE"==b.texture.d.source&&(h=n(b),B(a,h,"u_colormap0"),a.Hd.set(b.texture.b4w_uv_velocity_trans))}else v(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":b.b4w_terrain?(e(a,b),a.ka=!1,a.zd=J.Vc,a.O=!0,C(a,"grass_map.glslv","grass_map.glslf"),q(a,"a_position"),h=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.Na.a_grass_size={Te:!0,src:[]},h?(a.Na.a_grass_size.src.push({name:h,ec:4}),v(a,"DYNAMIC_GRASS_SIZE",1)):v(a,"DYNAMIC_GRASS_SIZE",
0),a.Na.a_grass_color={Te:!0,src:[]},b?(a.Na.a_grass_color.src.push({name:b,ec:7}),v(a,"DYNAMIC_GRASS_COLOR",1)):v(a,"DYNAMIC_GRASS_COLOR",0),W.Ue?v(a,"UNROLL_LOOPS",1):v(a,"UNROLL_LOOPS",0),a=!0):a=!1;break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_collision||"HALO"===b.type?a=!1:(C(a,"wireframe.glslv","wireframe.glslf"),q(a,"a_position"),q(a,"a_normal"),q(a,"a_polyindex"),a.O=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],W.Ue?v(a,"UNROLL_LOOPS",1):v(a,"UNROLL_LOOPS",0),
a=!0);break;case "PARTICLES":h=b.texture_slots;if(a.Ve)C(a,"particles_color.glslv","particles_color.glslf");else if(C(a,"particles_texture.glslv","particles_texture.glslf"),h=z("use_map_color_diffuse",h)[0]){v(a,"TEXTURE_COLOR",1);switch(h.blend_type){case "MIX":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Ke=h.diffuse_color_factor;a.ye=h.use_map_alpha?h.alpha_factor:0;h=n(h);B(a,h)}T.set(b.diffuse_color[0],b.diffuse_color[1],
b.diffuse_color[2],b.alpha,a.ib);a.xc=b.ambient;a.Le=b.diffuse_intensity;a.Ld=b.emit;a.vd.set(b.specular_color);a.xj=b.specular_alpha;q(a,"a_position");q(a,"a_normal");h=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===h?0:1);v(a,"ALPHA_CLIP","CLIP"===h?1:0);v(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);t(a,b);s(a,b);e(a,b);h=b.game_settings.alpha_blend;a.kc=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;a.mf=b.offset_z;W.Ue?v(a,"UNROLL_LOOPS",1):v(a,"UNROLL_LOOPS",0);a=!0;break;default:throw"Wrong batch type: "+
a.type;}return a}function e(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.ka=!0;a.zd=J.rm;a.O=!0;break;case "ALPHA":a.ka=!0;a.zd=J.Vc;a.O=!0;break;case "CLIP":a.ka=!1;a.zd=J.Vc;a.O=!0;break;case "ADD":a.ka=!0;a.zd=J.Vc;a.O=!1;break;case "OPAQUE":a.ka=!1;a.zd=J.Vc;a.O=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.ia=c.use_backface_culling}function n(a,b){var c=a.texture,d=c.d,c=c.image;d&&b&&c&&ia.Jj(d,b,c.Yb,c.filepath);return d}function z(a,b){for(var c=
[],d=b.length,e=0;e<d;e++){var f=b[e];1==f[a]&&f.texture&&f.texture.d&&c.push(f)}return c}function f(a,b){var c=b.raytrace_transparency;a.kd[0]=c.fresnel;a.kd[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.Mh=c.reflect_factor;a.kd[2]=c.fresnel;a.kd[3]=1-c.fresnel_factor/5}function t(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":v(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":v(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;
case "TOON":v(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;d=b.specular_toon_smooth;break;default:U.error("B4W Error: unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.jc[0]=b.specular_intensity;a.jc[1]=c;a.jc[2]=d}function s(a,b){switch(b.diffuse_shader){case "LAMBERT":v(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.dd[0]=0;a.dd[1]=0;break;case "OREN_NAYAR":v(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.dd[0]=b.roughness;a.dd[1]=0;break;case "FRESNEL":v(a,
"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.dd[0]=b.diffuse_fresnel;a.dd[1]=b.diffuse_fresnel_factor;break;default:U.error("B4W Error: unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.dd[0]=0,a.dd[1]=0}}function r(a,b){if(!b.use_nodes)return!1;var c=Y.bt(b.node_tree,b.uuid,!1);if(!c)return U.error('Failed to create node graph for material "'+b.name+'", disable nodes'),p(a,b),!0;C(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===d?0:1);v(a,
"ALPHA_CLIP","CLIP"===d?1:0);v(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);q(a,"a_position");e(a,b);a.mf=b.offset_z;d=b.game_settings.alpha_blend;a.kc=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;T.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.ib);a.Ld=b.emit;a.xc=b.ambient;f(a,b);b.b4w_wettable?v(a,"WETTABLE",1):v(a,"WETTABLE",0);a.ol=Y.ct(c);var g=!1;Q.K(c,function(c,d){switch(d.type){case "GEOMETRY_UV":var e=d.data.name,f=d.data.value;a.yf||(a.yf={});a.yf[f]=
e;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":e=d.data.name;a.Na[e]={Te:!0,src:[{name:d.data.value}]};f=0;if("GEOMETRY_VC"==d.type)f=7;else for(var h=0;h<d.Ma.length;h++){var k="RGB".indexOf(d.Ma[h].identifier);-1<k&&(f|=1<<2-k)}a.Na[e].src[0].ec=f;break;case "GEOMETRY_NO":q(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":e=d.data.value;q(a,"a_normal");v(a,"DIFFUSE_SHADER","DIFFUSE_"+e.diffuse_shader);v(a,"SPECULAR_SHADER","SPECULAR_"+e.specular_shader);
v(a,"SHADELESS_MAT",e.use_shadeless?1:0);a.Mj=e.use_shadeless;a.xj=e.specular_alpha;g=!0;break;case "TEXTURE_COLOR":case "TEXTURE_COLOR2":case "TEXTURE_COLOR3":case "TEXTURE_COLOR4":case "TEXTURE_ENVIRONMENT":e=d.data.name;f=d.data.value;!1!==f.d.gi&&(f.d.gi="TEXTURE_ENVIRONMENT"!=d.type?!0:!1);B(a,f.d,e);break;case "TEXTURE_NORMAL":case "TEXTURE_NORMAL2":case "TEXTURE_NORMAL3":case "TEXTURE_NORMAL4":case "PARALLAX":v(a,"CALC_TBN_SPACE",1);q(a,"a_normal");q(a,"a_tangent");e=d.data.name;(f=d.data.value)?
(f.d.gi=!1,B(a,f.d,e)):U.error("Missing texture in node ",d.name,"for material ",b.name);break;case "LAMP":d.data&&(a.Zf=d.data);break;case "REFRACTION":W.$d&&(a.xl=!0)}});g||(a.Mj=!0);W.Ue?v(a,"UNROLL_LOOPS",1):v(a,"UNROLL_LOOPS",0);return!0}function p(a,b){C(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===c?0:1);v(a,"ALPHA_CLIP","CLIP"===c?1:0);v(a,"SHADELESS",1);q(a,"a_position");q(a,"a_normal");T.set(1,0,1,1,a.ib);v(a,"VERTEX_COLOR",0);a.mf=b.offset_z;e(a,
b)}function F(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.Wk?v(a,"AU_QUALIFIER","attribute"):v(a,"AU_QUALIFIER","uniform"),v(a,"STATIC_BATCH",0)):(v(a,"AU_QUALIFIER","attribute"),v(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(O.dv()?v(a,"WIREFRAME_QUALITY",1):v(a,"WIREFRAME_QUALITY",0),a.zk?(v(a,"DEBUG_SPHERE",1),a.yn?v(a,"DEBUG_SPHERE_DYNAMIC",1):v(a,"DEBUG_SPHERE_DYNAMIC",0)):v(a,"DEBUG_SPHERE",0),v(a,"ALPHA",1));b.Sc?(""!==b.rd?(a.Na.a_bending_col_main={Te:!0,src:[{name:b.rd,ec:4}]},q(a,"a_bending_col_main"),
""!==b.pb.Ko&&""!==b.pb.Jo&&""!==b.pb.Yo?(a.Na.a_bending_col_detail={Te:!0,src:[{name:b.pb.Ko,ec:4},{name:b.pb.Jo,ec:2},{name:b.pb.Yo,ec:1}]},q(a,"a_bending_col_detail"),q(a,"a_normal"),v(a,"DETAIL_BEND",1)):v(a,"DETAIL_BEND",0),v(a,"MAIN_BEND_COL",1)):v(a,"MAIN_BEND_COL",0),v(a,"WIND_BEND",1)):v(a,"WIND_BEND",0);b.li?v(a,"BEND_CENTER_ONLY",1):v(a,"BEND_CENTER_ONLY",0);b.Xf?v(a,"HAIR_BILLBOARD",1):v(a,"HAIR_BILLBOARD",0);b.io?v(a,"HAIR_BILLBOARD_SPHERICAL",1):v(a,"HAIR_BILLBOARD_SPHERICAL",0);switch(b.Oi){case "RANDOM":v(a,
"HAIR_BILLBOARD_RANDOM",1);v(a,"HAIR_BILLBOARD_JITTERED",0);break;case "JITTERED":v(a,"HAIR_BILLBOARD_RANDOM",0);v(a,"HAIR_BILLBOARD_JITTERED",1);break;default:v(a,"HAIR_BILLBOARD_RANDOM",0),v(a,"HAIR_BILLBOARD_JITTERED",0)}b.xa&&W.Vj?v(a,"DYNAMIC_GRASS",1):v(a,"DYNAMIC_GRASS",0);a.xa=b.xa;a.fd=b.fd;a.Kb=b.Kb;a.Lb=b.Lb;a.kb=b.kb&&!a.Mj&&!(a.ka&&W.Cn);a.Rb=b.Rb;a.Jb=b.Jb;a.hc=b.hc;b.sh?(q(a,"a_influence"),v(a,"SKINNED",1),b.jh?v(a,"FRAMES_BLENDING",1):v(a,"FRAMES_BLENDING",0),v(a,"MAX_BONES",b.max_bones)):
(v(a,"SKINNED",0),v(a,"FRAMES_BLENDING",0));b.Wh?(v(a,"VERTEX_ANIM",1),W.yq?v(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):v(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):v(a,"VERTEX_ANIM",0);if(b.sh&&b.Wh)throw"Skinning and vertex animation are mutually exlusive";b.Bi?v(a,"DISABLE_FOG",1):v(a,"DISABLE_FOG",0);b.$b&&(a.$b=b.$b);if(b.hf&&"NODES"==a.type){for(var c=a.ol,d=0;d<c.length;d++){var e=c[d];switch(e.id){case "ANIM_VALUE":for(var f=e.ij[1],g=b.wh,h=0;h<g.length;h+=2)if(g[h]==f){e.ij[0]=
g[h+1];break}}}v(a,"NUM_ANIM_VALUES",b.hf.length)}}}function q(a,b){var c=a.$c;-1==c.indexOf(b)&&c.push(b)}function v(a,b,c){D.J(a.Da,b,c)}function x(a,b){if("PHYSICS"==a.type)a.Tb=b;else{var c=a.zd,d=a.ed;a.jo&&(b=J.mu(b));a.Cq&&(b=Z.Hu(a.Dq,a.Eq,a.Bq));c=J.Ax(b,c,d,a.Na);a.fd||c.Pi||(c.Pd=null,c.Rc=null);a.Ua=c;c=b.q.length;a.num_vertices=b.A*c;a:switch(a.ed){case J.Pg:case J.bi:case J.im:d=!0;break a;default:d=!1}d?J.Ev(b)?a.num_triangles=b.V.length/3*c:a.num_triangles=b.A/3*c:a.num_triangles=
0}}function A(a,c,d,e,f,h,k,n,l,p,q,r){var s=[],t=n.b4w_dynamic_grass;if(!p&&t)return s;for(var C="INSTANCE"==n.b4w_wind_bend_inheritance,z="INSTANCE"==n.b4w_shadow_inheritance,x="INSTANCE"==n.b4w_reflection_inheritance,m=[],v=[],B=0;B<f.length;B++){var A=f[B],G=w.ti(c);G.Xf=n.b4w_hair_billboard;G.Oi=n.b4w_hair_billboard_type;G.xa=t;G.io="SPHERICAL"==n.b4w_hair_billboard_geometry;G.Wk=!0;G.hf=A.d.hf;G.wh=A.d.wh;C?(G.Sc=A.d.Sc,G.$h=A.d.$h,G.re=A.d.re,G.Jd=A.d.Jd,G.rd=A.d.rd,G.Id=A.d.Id,G.Ed=A.d.Ed,
G.Tc=A.d.Tc,G.pb=A.d.pb,G.li=!1):(G.Sc=a.d.Sc,G.$h=a.d.$h,G.re=a.d.re,G.Jd=a.d.Jd,G.rd=a.d.rd,G.Id=a.d.Id,G.Ed=a.d.Ed,G.Tc=a.d.Tc,G.pb=a.d.pb,G.li=!0);z?(G.Kb=A.d.Kb,G.Lb=A.d.Lb,G.kb=A.d.kb):(G.Kb=a.d.Kb,G.Lb=a.d.Lb,G.kb=a.d.kb);x?(G.Rb=A.d.Rb,G.Jb=A.d.Jb,G.hc=A.d.hc):(G.Rb=a.d.Rb,G.Jb=a.d.Jb,G.hc=a.d.hc);m.push(G);var W=k[B];W||(W=new Float32Array);r&&w.Qi(l.seed,q);for(var ea=new Float32Array(3),K=new Float32Array([0,0,0,1]),y=[],D=0;D<W.length;D+=4){ea[0]=W[D];ea[1]=W[D+1];ea[2]=W[D+2];var L=W[D+
3];if(n.b4w_initial_rand_rotation){switch(n.b4w_rotation_type){case "XYZ":var O=new Float32Array([w.gc(q),w.gc(q),w.gc(q)]);u.normalize(O,O);break;case "Z":O=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+n.b4w_rotation_type;}ma.setAxisAngle(O,n.b4w_rand_rotation_strength*(2*Math.PI*w.gc(q)-Math.PI),K)}var N=R.Kf(ea,L,K);y.push(N)}v.push(y)}for(var V={},B=0;B<f.length;B++){var Q=h[B],G=m[B],P=w.ri(G,0),y=v[B];if(y.length)for(var X=f[B].data,S=X.materials,D=0;D<S.length;D++)if(!J.ro(X,
D))for(var Y=0;Y<Q.length;Y++){var Z=Q[Y];if("COLOR_ID"!==Z){var da=b(Z),ia=S[D];if(g(da,ia,!0)){da.ed=X.ed||J.Pg;F(da,G);da.eg=n.uuid;"JITTERED"==n.b4w_hair_billboard_type&&(da.Si=n.b4w_hair_billboard_jitter_amp,da.Ti=n.b4w_hair_billboard_jitter_freq);t&&(da.Mi=n.b4w_dynamic_grass_scale_threshold);C||(delete da.Na.a_bending_col_main,delete da.Na.a_bending_col_detail);I(da,P);var Yb=J.Hn(X,D,da.$c,da.$b,da.Na,da.yf),nb=[];if(G.Sc||G.xa||G.Xf)nb.au_wind_bending_amp=[G.Tc],nb.au_wind_bending_freq=[G.re],
nb.au_detail_bending_freq=[G.Jd],nb.au_detail_bending_amp=[G.Id],nb.au_branch_bending_amp=[G.Ed];var Va=J.Nv(Yb,nb,y),Eb=Va,jc=y;Eb.u.au_center_pos=new Float32Array(3*Eb.A);for(var Zb=jc.length,Sb=Eb.A/Zb,Tb=0;Tb<Zb;Tb++)for(var $b=jc[Tb],wa=3*Sb*Tb,ob=0;ob<Sb;ob++)Eb.u.au_center_pos[wa+3*ob]=$b[0],Eb.u.au_center_pos[wa+3*ob+1]=$b[1],Eb.u.au_center_pos[wa+3*ob+2]=$b[2];Va=Eb;if(G.li){var wb=Va,sa=a.d.I;wb.u.a_emitter_center=new Float32Array(3*wb.A);var pb=T.fromValues(0,0,0,1);T.transformMat4(pb,
sa,pb);for(var aa=0;aa<wb.A;aa++)wb.u.a_emitter_center[3*aa]=pb[0],wb.u.a_emitter_center[3*aa+1]=pb[1],wb.u.a_emitter_center[3*aa+2]=pb[2];Va=wb}var Ka=n.b4w_vcol_from_name,Wa=n.b4w_vcol_to_name,la=da,Ba=d,xb=!C,fb=X,qa=[];if(""!==Ka&&""!==Wa){var na,ya=Wa,yb=la.Na,kc=[],ac=void 0;for(ac in yb)for(var bc=yb[ac].src,Ib=0,qb=0;qb<bc.length;qb++){var Jb=bc[qb].ec;ya==bc[qb].name&&kc.push(ac,Jb,Ib);Ib+=w.tf(Jb)}na=kc;if(0<na.length)for(var gb=0;gb<na.length;gb+=3)qa.push({hh:Ka,Fi:7,jj:na[gb],kj:na[gb+
1],Di:na[gb+2]});else J.pv(la.$c,"a_color")&&Wa==fb.active_vcol_name&&qa.push({hh:Ka,Fi:7,jj:"a_color",kj:7,Di:0})}xb&&("a_bending_col_main"in Ba.Na&&qa.push({hh:"a_bending_col_main",Fi:4,jj:"a_bending_col_main",kj:4,Di:0}),"a_bending_col_detail"in Ba.Na&&qa.push({hh:"a_bending_col_detail",Fi:7,jj:"a_bending_col_detail",kj:7,Di:0}));for(var Qa=Va,Kb=y,rb=e,Ca=qa,Xa=da.Na,Lb=!1,va=0;va<Ca.length;va++){var La=Ca[va].hh,Ia=rb.u[La];if(Ia&&0<Ia.length){Lb=!0;break}}if(Lb){var cc,Ma=a.d.zb,oa=rb.q[0].a_position,
Ya=Kb,E=V,Da=new Float32Array(3),ra=new Float32Array(3),jb=new Uint32Array(Ya.length);if(!("verts_indices"in E)){E.Zc=new Float32Array(3);E.Yc=new Float32Array(3);E.bm=new Uint32Array(oa.length/3);E.yh=new Uint32Array(oa.length/3);E.Zc[0]=(Ma.max_x-Ma.min_x)/20;E.Zc[1]=(Ma.max_y-Ma.min_y)/20;E.Zc[2]=(Ma.max_z-Ma.min_z)/20;E.Yc[0]=Ma.min_x;E.Yc[1]=Ma.min_y;E.Yc[2]=Ma.min_z;for(var xa=0;xa<oa.length/3;xa++){var ba=w.trunc((oa[3*xa]-E.Yc[0])/E.Zc[0]),Za=w.trunc((oa[3*xa+1]-E.Yc[1])/E.Zc[1]),dc=w.trunc((oa[3*
xa+2]-E.Yc[2])/E.Zc[2]),ba=w.clamp(ba,0,19),Za=w.clamp(Za,0,19),dc=w.clamp(dc,0,19);E.bm[xa]=xa;E.yh[xa]=dc*Math.pow(20,2)+20*Za+ba}J.ix(E.yh,E.bm,!0);E.Af=new Uint32Array(Math.pow(20,3));for(xa=0;xa<E.yh.length;xa++)E.Af[E.yh[xa]]++;delete E.yh;for(xa=1;xa<E.Af.length;xa++)E.Af[xa]+=E.Af[xa-1]}for(var zb=0;zb<Ya.length;zb++){Da[0]=Ya[zb][0];Da[1]=Ya[zb][1];Da[2]=Ya[zb][2];for(var Ab=1E10,Bb=-1,Cb=w.trunc((Da[0]-E.Yc[0])/E.Zc[0]),Mb=w.trunc((Da[1]-E.Yc[1])/E.Zc[1]),Nb=w.trunc((Da[2]-E.Yc[2])/E.Zc[2]),
Cb=w.clamp(Cb,0,19),Mb=w.clamp(Mb,0,19),Nb=w.clamp(Nb,0,19),Ea=Nb*Math.pow(20,2)+20*Mb+Cb,Fa=E.Af[Ea],Ra=0==Ea?0:E.Af[Ea-1];Ra<Fa;Ra++){var Ob=E.bm[Ra];ra[0]=oa[3*Ob];ra[1]=oa[3*Ob+1];ra[2]=oa[3*Ob+2];u.sub(ra,Da,ra);var cb=u.sqrLen(ra);cb<=Ab&&(Ab=cb,Bb=Ob)}if(-1==Bb)for(Ra=0;Ra<oa.length/3;Ra++)ra[0]=oa[3*Ra],ra[1]=oa[3*Ra+1],ra[2]=oa[3*Ra+2],u.sub(ra,Da,ra),cb=u.sqrLen(ra),cb<=Ab&&(Ab=cb,Bb=Ra);jb[zb]=Bb}cc=jb;for(var Fb=Qa.A/Kb.length,va=0;va<Ca.length;va++){var kb=Ca[va].jj,Pb=Ca[va].kj,La=Ca[va].hh,
sb=Ca[va].Fi,Ia=rb.u[La];switch(kb){case "a_bending_col_main":var Qb=1;break;case "a_bending_col_detail":Qb=3;break;case "a_color":Qb=3;break;default:for(var hb=Qb=0;hb<Xa[kb].src.length;hb++)Qb+=w.tf(Xa[kb].src[hb].ec)}if(Ia&&0<Ia.length){var Ub=w.tf(sb),tb=w.tf(Pb),ub=sb&Pb,Vb=w.Dp(ub);ub!=Pb&&U.error("Wrong color extraction from "+La+" to "+kb+".");if("a_bending_col_main"==kb||"a_bending_col_detail"==kb)Qa.u[kb]=new Float32Array(Qa.A*tb);for(hb=0;hb<Kb.length;hb++){var ib=cc[hb],vc=ib*Ub,rc=hb*
Fb*Qb;if(-1!=ib)for(var sc=0;sc<Fb;sc++)for(var Dc=sc*Qb,za=0;za<Vb.length;za++)Vb[za]&&(Qa.u[kb][rc+Dc+(Ca[va].Di+w.Ph(Pb,za))]=Ia[vc+w.Ph(sb,za)])}}else Qa.u[kb]=new Float32Array(0)}}Va=Qa;s.push({k:da,Tb:Va,Ob:[ia.name],tb:G,sc:[a]})}}}}return s}function L(a){return R.Kf(a.e,a.scale,a.quat)}function I(a,b){for(var c=null,d=0;d<a.Ea.length;d++){var e=a.Ea[d].dj;e&&(c||(c={}),c[d]=e,a.Ea[d].dj=null)}a.id=0;a.yl=b;a.id=w.ri(a,b);if(c)for(d in c)a.Ea[d].dj=c[d]}function y(a,c,d,e,f){var g=b("WIREFRAME");
C(g,"wireframe.glslv","wireframe.glslf");g.wireframe_mode=0;g.zk=!0;g.O=!0;g.eg=d;f&&(g.yn=!0);F(g,c);I(g,w.ri(c,0));e?(c=Z.Qn(1,a.s),J.Ew(c,[a.Ce[0],a.De[1],a.Ee[2]],a.s)):c=Z.Qn(a.na,a.s);J.eq(c,1,!0);c.u.a_polyindex=J.nu(c);x(g,c);return g}function C(a,b,c){a.Da={ja:b,ea:c,U:[]};D.Nw(a.Da)}function B(a,b,c){1==a.Ea.length&&0==a.Ub.length&&a.Ub.push("default0");c=c||"default"+String(a.Ea.length);-1==a.Ub.indexOf(c)&&(a.Ea.push(b),a.Ub.push(c))}function G(a){if(!a.Da)throw"No shaders info for batch "+
a.name;a.ub=D.Qk(a.Da,a.ol);S.Bs(a.ub);S.Gm(a)}function K(a,b,c){var d=a.Da;D.J(d,"SHADOW_SRC",b);D.J(d,"SHADOW_DST",c);return a}var N=m("__boundings"),V=m("__config"),U=m("__print"),O=m("__extensions"),J=m("__geometry"),Q=m("__graph"),Y=m("__nodemat"),P=m("__objects"),X=m("__particles"),Z=m("__primitives");m("__reformer");var S=m("__renderer"),da=m("__scenegraph"),D=m("__shaders"),ia=m("__textures"),R=m("__tsr"),w=m("__util"),u=m("vec3"),T=m("vec4"),ma=m("quat"),W=V.p,ea=["MAIN","NODES"];a.Uz=b;
a.Gu=function(a,d,e,f){for(var g=[],k=[],l=0;l<e.length;l++){var u=e[l];switch(u.d.type){case "DYNAMIC":g.push(u);break;case "STATIC":k.push(u)}}e=[];e=e.concat(c(g,a));a=e=e.concat(h(k,a,d));l=[];e=[];d={};for(u=0;u<a.length;u++){var k=a[u].k,p=a[u].tb,g=null;if(k.id in d){var r=d[k.id],s=e[r].tb;w.cq(k,e[r].k)&&w.cq(p,s)&&(g=e[r]);if(!g){do k.id++;while(d[k.id])}}g||(g={k:k,tb:a[u].tb,sc:[],fq:[],Ob:[]},d[k.id]=e.length,e.push(g));g.sc=g.sc.concat(a[u].sc);a[u].Tb&&a[u].Tb.A&&g.fq.push(a[u].Tb);
if(g.Ob.length)for(k=0;k<a[u].Ob.length;k++)p=a[u].Ob[k],-1==g.Ob.indexOf(p)&&g.Ob.push(p);else g.Ob=a[u].Ob}for(u=0;u<e.length;u++){a=e[u].fq;if(0==a.length)a=w.gb(w.Fj("%empty"));else if(1==a.length)a=a[0];else{d=[];for(k=0;k<a.length;k++)J.Fv(a[k])||d.push(k);if(d.length<a.length)for(k=0;k<d.length;k++)J.eq(a[d[k]]);a=J.zx(a)}l.push({k:e[u].k,tb:e[u].tb,Tb:a,Ob:e[u].Ob,sc:e[u].sc})}e=l;for(l=0;l<e.length;l++)x(e[l].k,e[l].Tb),e[l].k.qc=e[l].Ob;a=[];for(l=0;l<e.length;l++)"STATIC"==e[l].tb.type&&
(d=e[l].k,"COLOR_ID"!==d.type&&(u=w.wo(w.Fj("%meta")),u.d=e[l].tb,u.M=[d],a.push(u)));for(l=0;l<e.length;l++)if(d=e[l].k,u=e[l].tb.type,"DYNAMIC"==u||"STATIC"==u&&"COLOR_ID"==d.type)for(g=[],k=0;k<e[l].sc.length;k++)if(u=e[l].sc[k],-1==g.indexOf(u.name)){for(p=0;p<u.M.length;p++)if(u.M[p]==d)throw"Batch already exist in object";u.M.push(d);g.push(u.name)}if(W.wireframe_debug){for(l=0;l<e.length;l++)d=e[l].tb,"DYNAMIC"==d.type&&(u=e[l].sc[0],-1<ea.indexOf(e[l].k.type)&&(d=y(d.Fe,d,u.name,!0,!0),u.M.push(d)));
for(l=0;l<a.length;l++)u=a[l],d=u.d,-1<ea.indexOf(u.M[0].type)&&(d=y(d.pc,d,u.name,!1),u.M.push(d))}e=null;if(f.texture_slots)for(l=0;l<f.texture_slots.length;l++)if(f.texture_slots[l].texture.b4w_use_as_skydome){e=n(f.texture_slots[l],null);break}if(f.b4w_sky_settings.procedural_skydome||e)d=b("MAIN"),C(d,"special_skydome.glslv","special_skydome.glslf"),f.b4w_sky_settings.procedural_skydome?d.Jh=!0:B(d,e,"u_sky"),f.b4w_sky_settings.reflexible&&(d.Rb=!0,f.b4w_sky_settings.reflexible_only&&(d.Jb=!0)),
q(d,"a_position"),d.mf=99999,f=Z.Fu(),x(d,f),u=w.wo(w.Fj("%meta")),u.d=P.yi("DYNAMIC"),u.d.Lf=!0,u.d.zb=N.yd(),u.d.pc=N.ai(),u.d.Fa=N.yd(),u.d.cb=N.ai(),u.M=[d],a.push(u);return a};a.ny=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.Ds=l;a.Pu=n;a.Zj=function(a,b){v(a,"CSM_SECTION0",0);v(a,"CSM_SECTION1",0);v(a,"CSM_SECTION2",0);v(a,"CSM_SECTION3",0);for(var c=0;c<b.csm_num;c++)v(a,
"CSM_SECTION"+String(c),1);v(a,"SHADOW_TEX_RES",D.t(b.csm_resolution));v(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);v(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.Z=v;a.Ya=function(a,b){return D.Wu(a.Da,b)};a.Ug=B;a.yw=function(a,b,c){c=a.Ub.indexOf(c);-1<c&&(a.Ea[c]=b)};a.Ct=function(a,c){var d=b("MAIN");d.ka=!0;T.set(c[0],c[1],c[2],.5,d.ib);d.ed=J.bi;x(d,a);C(d,"main.glslv","main.glslf");v(d,"SHADELESS",1);G(d);return d};a.Db=G;a.Ss=function(a){return a.ub.Fh.length?a.ub.tl.u_cube_fog?
!0:!1:!1};a.Dt=function(a,c){var d=b("DEPTH");d.ia=a.ia;d.Nc.set(a.Nc);d.xa=a.xa;d.Ua=a.Ua;d.id=a.id;d.yl=a.yl;a.Ea.length&&(d.Ea[0]=a.Ea[0],d.Ub[0]=a.Ub[0]);d.Hd.set(a.Hd);d.$c=a.$c;d.Si=a.Si;d.Ti=a.Ti;d.Mi=a.Mi;d.num_triangles=a.num_triangles;d.num_vertices=a.num_vertices;d.eg=a.eg;for(var e=0;e<a.qc.length;e++)d.qc.push(a.qc[e]);d.Fc=a.Fc;a.ob||(a.ob=[]);a.ob.push(d);C(d,"depth.glslv","depth.glslf");D.vv(d.Da,a.Da);return d=K(d,"SHADOW_SRC_NONE",c)};a.Yl=K;a.pt=function(){var a=b("DEPTH_PACK");
a.ia=!0;a.O=!1;var c=Z.Aa();x(a,c);C(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");G(a);return a};a.ut=function(){var a=b("HUD");a.ia=!0;a.ka=!0;a.O=!1;a.o[0]=1;a.o[1]=1;var c=Z.Aa();x(a,c);C(a,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");G(a);return a};a.sn=function(a){var c=b("POSTPROCESSING");C(c,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":v(c,"POST_EFFECT","POST_EFFECT_NONE");c.o[0]=
1;c.o[1]=1;break;case "GRAYSCALE":v(c,"POST_EFFECT","POST_EFFECT_GRAYSCALE");c.o[0]=1;c.o[1]=1;break;case "X_BLUR":v(c,"POST_EFFECT","POST_EFFECT_X_BLUR");c.o[0]=1;c.o[1]=0;break;case "Y_BLUR":v(c,"POST_EFFECT","POST_EFFECT_Y_BLUR");c.o[0]=0;c.o[1]=1;break;case "X_EXTEND":v(c,"POST_EFFECT","POST_EFFECT_X_EXTEND");c.o[0]=1;c.o[1]=0;break;case "Y_EXTEND":v(c,"POST_EFFECT","POST_EFFECT_Y_EXTEND");c.o[0]=0;c.o[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}c.ia=!0;c.O=!1;a=Z.Aa();x(c,a);G(c);
return c};a.fz=function(){var a=b("EDGE");a.O=!1;a.ia=!0;a.o[0]=1;a.o[1]=1;var c=Z.Aa();x(a,c);C(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");G(a);return a};a.Ht=function(a){var c=b("SSAO");c.O=!1;c.ia=!0;c.o[0]=1;c.o[1]=1;var d=Z.Aa();x(c,d);C(c,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");v(c,"SSAO_QUALITY","SSAO_QUALITY_"+a);G(c);return c};a.qt=function(){var a=b("DOF");a.O=!1;a.ia=!0;a.o[0]=1;a.o[1]=1;var c=Z.Aa();x(a,c);C(a,"postprocessing/postprocessing.glslv",
"postprocessing/dof.glslf");v(a,"DEPTH_RGBA",1);G(a);return a};a.rt=function(){var a=b("GLOW");a.O=!1;a.ia=!0;a.o[0]=1;a.o[1]=1;var c=Z.Aa();x(a,c);C(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");G(a);return a};a.st=function(a,c,d){var e=b("GOD_RAYS");e.O=!1;e.ia=!0;e.o[0]=1;e.o[1]=1;var f=Z.Aa();x(e,f);C(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");v(e,"DEPTH_RGBA",a);v(e,"WATER_EFFECTS",c);v(e,"STEPS_PER_PASS",D.t(d,1));G(e);return e};a.tt=function(){var a=
b("GOD_RAYS_COM");a.O=!1;a.ia=!0;a.o[0]=1;a.o[1]=1;var c=Z.Aa();x(a,c);C(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");G(a);return a};a.Et=function(){var a=b("SKY");a.O=!1;a.ia=!0;a.o[0]=1;a.o[1]=1;var c=Z.Bu();x(a,c);C(a,"procedural_skydome.glslv","procedural_skydome.glslf");v(a,"NUM_LIGHTS",1);v(a,"WATER_EFFECTS",1);G(a);return a};a.jt=function(){var a=b("ANTIALIASING");a.O=!1;a.ia=!0;a.o[0]=1;a.o[1]=1;a.Eg=1/W.resolution_factor;var c=Z.Aa();x(a,c);C(a,"postprocessing/postprocessing.glslv",
"postprocessing/antialiasing.glslf");v(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");G(a);return a};a.Ft=function(a){var c=b("SMAA"),d=Z.Aa();x(c,d);C(c,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");v(c,"AA_METHOD","AA_METHOD_SMAA_HIGH");v(c,"SMAA_PASS",a);v(c,"SMAA_PREDICATION",0);v(c,"SMAA_REPROJECTION",0);G(c);c.O=!1;c.ia=!0;c.o[0]=1;c.o[1]=1;c.Eg=1/W.resolution_factor;return c};a.vt=function(a){var c=b("LANCZOS");c.O=!1;c.ia=!0;c.Eg=1/W.resolution_factor;"LANCZOS_X"==a?(c.o[0]=1,c.o[1]=0):
"LANCZOS_Y"==a&&(c.o[0]=0,c.o[1]=1);a=Z.Aa();x(c,a);C(c,"postprocessing/postprocessing.glslv","postprocessing/lanczos.glslf");G(c);return c};a.nt=function(){var a=b("COMPOSITING");a.O=!1;a.ia=!0;a.o[0]=1;a.o[1]=1;var c=Z.Aa();x(a,c);C(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");G(a);return a};a.yt=function(a){var c=b("MOTION_BLUR");c.ia=!0;c.O=!1;var d=Z.Aa();x(c,d);C(c,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");v(c,"BLUR_DECAY_THRESHOLD",
D.t(a));G(c);return c};a.it=function(){var a=b("ANAGLYPH");a.ia=!0;a.O=!1;var c=Z.Aa();x(a,c);C(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");G(a);return a};a.wt=function(){var a=b("LUMINANCE");a.O=!1;a.ia=!0;a.o[0]=1;a.o[1]=1;var c=Z.Aa();x(a,c);C(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");G(a);return a};a.kt=function(){var a=b("LUMINANCE");a.O=!1;a.ia=!0;a.o[0]=1;a.o[1]=1;var c=Z.Aa();x(a,c);C(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");
G(a);return a};a.xt=function(){var a=b("LUMINANCE_X_BLUR");a.O=!1;a.ia=!0;a.o[0]=1;a.o[1]=1;var c=Z.Aa();x(a,c);C(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");G(a);return a};a.lt=function(a){var c=b("POSTPROCESSING");switch(a){case "X_BLUR":c.o[0]=1;c.o[1]=0;break;case "Y_BLUR":c.o[0]=0;c.o[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}c.ia=!0;c.O=!1;a=Z.Aa();x(c,a);C(c,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");
G(c);return c};a.mt=function(){var a=b("BLOOM");a.O=!1;a.ia=!0;a.o[0]=1;a.o[1]=1;var c=Z.Aa();x(a,c);C(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");G(a);return a};a.Lt=function(){var a=b("VELOCITY");a.O=!1;a.ia=!0;a.o[0]=1;a.o[1]=1;var c=Z.Aa();x(a,c);C(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");G(a);return a};a.tj=function(a,b,c){var d=a.Eg;a.Tl[0]=b*a.o[0]*d;a.Tl[1]=c*a.o[1]*d};a.vf=function(a,b){a.Eg=b};a.R=function(a,b,c){a=a.M;for(var d=
null,e=0;e<a.length;e++){var f=a[e];if(-1<f.qc.indexOf(b)&&(c&&f.type==c||!c)){if(f.ob)return f;d=null===d?f:d}}return d};a.at=function(a){for(var b=a.Ea,c=0;c<b.length;c++)ia.Yt(b[c].Oa);J.gn(a.Ua)}};b4w.module.__nodemat=function(a,m){function b(a,b,d){if(b in w)return w[b];for(var e=P.create(),f=a.nodes,u=a.links,q=a.animation_data,r=0;r<f.length;r++)if(!p(e,f[r],0,q))return w[b]=null;if(d&&-1==s(a,e,"GROUP_OUTPUT","group"))return null;r=K(e);if(!N(e,u,r))return null;if(d)return e;for(r=0;r<u.length;r++){d=u[r];for(var f=k(d.from_node,e),q=k(d.to_node,e),C=0;C<f.length;C++)for(var x=0;x<q.length;x++){for(var m=f[C],v=q[x],B=P.Ba(e,m),R=P.Ba(e,v),G=e,A=R,R=[],T=d.from_socket.identifier,F=d.to_socket.identifier,
y=B.Ma,B=0;B<y.length;B++)if(y[B].identifier==T){R.push(B);break}A=A.H;for(B=0;B<A.length;B++)if(A[B].identifier==F){R.push(B);break}2==R.length&&P.Be(G,m,v,R)}}l(e);a=s(a,e,"OUTPUT","material");if(-1==a)return w[b]=null;g(e);e=P.wx(e,a,P.Iq);h(e);n(e);z(e);t(e);return c(e)?w[b]=e:(Y.error("Material has normalmap node but no material node"),w[b]=null)}function c(a){var b=!1,c=!1;P.K(a,function(a,d){if("MATERIAL"==d.type||"MATERIAL_EXT"==d.type)c=!0;"TEXTURE_NORMAL"==d.type&&(b=!0)});return b&&!c?
!1:!0}function h(a){P.K(a,function(b,c){for(var e=c.H,f=c.Ma,g=0;g<e.length;g++)d(a,e[g],b,g,1);for(g=0;g<f.length;g++)d(a,f[g],b,g,0)})}function d(a,b,c,d,e){if(b.qd){var f=!0;P.ke(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&g[1]==d)f=!1});f&&(b.qd=!1)}}function l(a){var b=[];P.K(a,function(c,d){switch(d.type){case "TRANSLUCENCY":P.ke(a,function(a,e,f){a==c&&"Translucency"==d.Ma[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)P.Be(a,b[c],b[c+1],b[c+2])}function k(a,
b){var c=[];P.K(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function g(a){var b=[];P.K(a,function(a,c){"PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],f=b[c+1];if("PARALLAX"==f.type){var g=e(a,d);if(-1!=g){var h=P.Ii(a,g,0);P.gg(a,g,d,-1);-1!=h&&P.gg(a,h,g,-1);d=P.Ba(a,g);f.data=d.data;f.B[0]=d.B[0];P.hg(a,g)}f.H.splice(1,1)}else if("REROUTE"==f.type){for(var f=P.Ii(a,d,0),k=P.fg(a,d),g=[],h=[],n=[],l=0;l<k;l++){var u=
P.Uf(a,d,l),p=h.indexOf(u);-1!=p?n[p]+=1:(h.push(u),n.push(1),g.push(d,u))}if(-1!=f)for(k=P.Tf(a,f,d,0)[0],l=0;l<h.length;l++)for(u=0;u<n[l];u++)p=P.Tf(a,d,h[l],u)[1],P.Be(a,f,h[l],[k,p]);for(l=0;l<g.length;l+=2)P.gg(a,g[l],g[l+1],-1)}}}function e(a,b){for(var c=a.ta,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function n(a){var b=[];P.K(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=
c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],g=b[d+1],h=!0,k=0;k<c.length;k++){var n=c[k];if(f(g,n.ra)){h=[];k=P.fg(a,e);for(p=0;p<k;p++){var l=P.Uf(a,e,p),u=P.Tf(a,e,l,0);h.push(e,l,u);P.Be(a,n.id,l,u)}for(var p=0;p<h.length;p+=3)P.gg(a,h[p],h[p+1],0);P.hg(a,e);h=!1;break}}h&&(n={id:e,ra:g},c.push(n))}}function z(a){var b=[];P.K(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],g=b[d+1],h=!0,
k=0;k<c.length;k++){var n=c[k];if(!(3<=n.$i.length)&&f(g,n.ra)){for(var k=[],l=P.vo(a,e),h={},u=0;u<l;u++){var p=P.Ii(a,e,u);p in h||(h[p]=0);var q=P.Tf(a,p,e,h[p]++);k.push(p,e,q)}for(var l=[],h=P.fg(a,e),r={},u=0;u<h;u++)p=P.Uf(a,e,u),p in r||(r[p]=0),q=P.Tf(a,e,p,r[p]++),l.push(e,p,q);for(var h=k.concat(l),u=0;u<h.length;u+=3)P.gg(a,h[u],h[u+1],0);P.hg(a,e);u={ra:g,fu:k,gu:l};n.$i.push(u);h=!1;break}}h&&(n={id:e,ra:g,$i:[]},c.push(n))}for(d=0;d<c.length;d++){n=c[d];e=n.$i.length;l=n.ra.H.length;
h=n.ra.Ma.length;for(k=0;k<e;k++){q=n.$i[k];u=q.ra;g=q.fu;r=q.gu;n.ra.H=n.ra.H.concat(u.H);n.ra.Ma=n.ra.Ma.concat(u.Ma);for(u=0;u<n.ra.H.length;u++)n.ra.H[u].identifier+=Z.trunc(u/l)+1;for(u=0;u<n.ra.Ma.length;u++)n.ra.Ma[u].identifier+=Z.trunc(u/h)+1;for(u=0;u<g.length;u+=3)p=g[u],q=g[u+2],q[1]+=(k+1)*l,P.Be(a,p,n.id,q);for(u=0;u<r.length;u+=3)p=r[u+1],q=r[u+2],q[0]+=(k+1)*h,P.Be(a,n.id,p,q)}switch(e){case 1:n.ra.type+="2";break;case 2:n.ra.type+="3";break;case 3:n.ra.type+="4"}P.hg(a,n.id);P.Yj(a,
n.id,n.ra)}}function f(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function t(a){var b=[];P.K(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],h=[],k=[[],[],[]],n=P.fg(a,d),u=0;u<
n;u++){var l=P.Uf(a,d,u);if("SEPRGB"!=P.Ba(a,l).type){f=!1;break}g.push(d,l);for(var p={},q=P.fg(a,l),f=0;f<q;f++){var r=P.Uf(a,l,f);r in p||(p[r]=0);var w=P.Tf(a,l,r,p[r]++);g.push(l,r);k[w[0]].push(d,r,w)}h.push(l);f=!0}if(f){for(u=d=n=0;u<k.length;u++)k[u].length&&(n++,d|=1<<2-u);if(n){e.type+=n;e.Ma=[];for(u=0;u<k.length;u++)if(k[u].length)for(e.Ma.push({hb:0,identifier:"RGB"[u],qd:!0,name:"RGB"[u]}),f=0;f<k[u].length;f+=3)k[u][f+2][0]=Z.Ph(d,u);for(u=0;u<g.length;u+=2)P.gg(a,g[u],g[u+1],0);for(u=
0;u<h.length;u++)P.hg(a,h[u]);for(u=0;u<k.length;u++)for(f=0;f<k[u].length;f+=3)P.Be(a,k[u][f],k[u][f+1],k[u][f+2])}}}}function s(a,b,c,d){a=a.nodes;for(var e=null,f=0;f<a.length;f++){var g=a[f];g.type==c&&(e=g)}return e?k(e,b)[0]:(Y.error('No "'+c+'" node in node '+d),-1)}function r(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function p(a,c,d,e){var f=c.name,g=c.type,h=[],k=[],n=[],l=[],w=null;switch(g){case "CAMERA":k=[];n=y(c);break;case "COMBRGB":case "COMBHSV":k=I(c);n=y(c);break;case "GEOMETRY":a:{for(var g=
c.outputs,s=0;s<g.length;s++)if(g[s].is_linked){g=!0;break a}g=!1}if(!g)return!0;g=q(c,d);if(!g)return Y.error("Geometry output is not supported"),!1;switch(g){case "GEOMETRY_UV":if(!c.uv_layer)return Y.error('Missing uv layer in node "',c.name,'"'),!1;w=F("param_GEOMETRY_UV_a");s=F("param_GEOMETRY_UV_v");h.push(C(w));h.push(C(s));n.push(x(c,"UV"));l.push(C(s));w={name:w,value:c.uv_layer};break;case "GEOMETRY_VC":if(!c.color_layer)return Y.error("Missing vertex color layer in node ",c.name),!1;w=
F("param_GEOMETRY_VC_a");s=F("param_GEOMETRY_VC_v");h.push(C(w));h.push(C(s));n.push(x(c,"Vertex Color"));l.push(C(s));w={name:w,value:c.color_layer};break;case "GEOMETRY_NO":n.push(x(c,"Normal"));break;case "GEOMETRY_FB":n.push(x(c,"Front/Back"));break;case "GEOMETRY_VW":n.push(x(c,"View"));break;case "GEOMETRY_GL":n.push(x(c,"Global"))}break;case "GROUP":s=c.node_tree_name.replace(/\.[0-9]{3,}$/g,"");switch(s){case "LINEAR_TO_SRGB":g="LINEAR_TO_SRGB";break;case "NORMAL_VIEW":case "VECTOR_VIEW":g=
"VECTOR_VIEW";break;case "SRGB_TO_LINEAR":g="SRGB_TO_LINEAR";break;case "REFLECT":g="REFLECT";break;case "REFRACTION":g="REFRACTION";break;case "PARALLAX":g="PARALLAX";if(!c.inputs[1].is_linked)return Y.error('Missing texture in node "',c.name,'"'),!1;var t=F("temp_texture");l.push(C(t));break;case "CLAMP":g="CLAMP";break;case "TRANSLUCENCY":g="TRANSLUCENCY";break;case "TIME":g="TIME";break;case "SMOOTHSTEP":g="SMOOTHSTEP";break;default:k=Z.Fd(c.node_group.node_tree);if("REPLACE"==s||"LEVELS_OF_QUALITY"==
s)n=r("Group input","GROUP_INPUT",[],c.inputs),w=r("Group output","GROUP_OUTPUT",c.outputs,[]),t=null,t="REPLACE"==s||"LEVELS_OF_QUALITY"==s&&S.get("quality")==S.P_LOW?{from_node:n,from_socket:n.outputs[1],to_node:w,to_socket:w.inputs[0]}:{from_node:n,from_socket:n.outputs[0],to_node:w,to_socket:w.inputs[0]},k.nodes=[n,w],k.links=[t];for(var n=c.name,w=k.nodes,t=k.links,z=0;z<w.length;z++)w[z].name=G(w[z].type,n,w[z].name);for(z=0;z<t.length;z++)t[z].from_node.name=G(t[z].from_node.type,n,t[z].from_node.name),
t[z].to_node.name=G(t[z].to_node.type,n,t[z].to_node.name);w={$v:b(k,c.node_group.uuid,!0),aw:k.links}}k=I(c);n=y(c);"TRANSLUCENCY"==s&&(s=L("TranslucencyParams","TranslucencyParams",[0,0,0,0]),s.qd=n[0].qd,n.push(s));break;case "LAMP":n.push(x(c,"Color"));n.push(x(c,"Light Vector"));n.push(x(c,"Distance"));n.push(x(c,"Visibility Factor"));w=c.lamp;if(!w)return Y.error("There is no lamp in node: "+c.name),!1;w.uuid in u?l.push(C(F("param_LAMP_lamp_index"),u[w.uuid],1)):(u[w.uuid]=T,l.push(C(F("param_LAMP_lamp_index"),
T++,1)));w=u;break;case "NORMAL":k=I(c);n=y(c);s=x(c,"Normal");l.push(C(F("param_NORMAL_Normal"),s.hb,3));break;case "MAPPING":k.push(v(c,"Vector"));n.push(x(c,"Vector"));if(0!=da.length(c.translation)||0!=da.length(c.rotation)||c.use_max||c.use_min){var g="MAPPING_HEAVY",m=c.rotation,s=D.create(),t=Math.cos(m[0]),z=Math.cos(m[1]),B=Math.cos(m[2]),R=Math.sin(m[0]),A=Math.sin(m[1]),m=Math.sin(m[2]),K=t*B,ma=t*m,J=R*B,O=R*m;s[0]=z*B;s[1]=z*m;s[2]=-A;s[3]=A*J-ma;s[4]=A*O+K;s[5]=z*R;s[6]=A*K+O;s[7]=A*
ma-J;s[8]=z*t;t=c.scale;z=new Float32Array([t[0],0,0,0,t[1],0,0,0,t[2]]);t=D.create();D.multiply(s,z,t);s=c.translation;t=Z.Pv(t,ia.create());t[12]=s[0];t[13]=s[1];t[14]=s[2];l.push(C(F("param_MAPPING_HEAVY_trs_matrix"),t,16));l.push(C(F("param_MAPPING_HEAVY_use_min"),~~c.use_min,1));l.push(C(F("param_MAPPING_HEAVY_use_max"),~~c.use_max,1));l.push(C(F("param_MAPPING_LIGHT_min_clip"),c.min,3));l.push(C(F("param_MAPPING_LIGHT_max_clip"),c.max,3))}else g="MAPPING_LIGHT",l.push(C(F("param_MAPPING_LIGHT_scale"),
c.scale,3));break;case "MATERIAL":case "MATERIAL_EXT":w=c.material;if(!w)return Y.error("Emtpy material slot in node: "+c.name),!1;t=v(c,"Color");t.hb.splice(3);k.push(t);(t=v(c,"Alpha"))?k.push(t):k.push(L("Alpha","Alpha",1));t=v(c,"Spec");t.hb.splice(3);k.push(t);s=v(c,"Normal");s.hb.splice(3);k.push(s);n.push(x(c,"Color"));n.push(x(c,"Alpha"));n.push(x(c,"Normal"));"MATERIAL_EXT"==g&&((t=v(c,"Emit"))?k.push(t):k.push(L("Emit","Emit",0)),t=v(c,"Translucency"),t.hb=0,t.name="Translucency",t.identifier=
"Translucency",t?k.push(t):k.push(L(t.name,t.identifier,t.hb)),t=v(c,"Translucency"),t.hb=[0,0,0,0],t.name="TranslucencyParams",t.identifier="TranslucencyParams",t?k.push(t):k.push(L(t.name,t.identifier,t.hb)),(t=v(c,"Ray Mirror"))?k.push(t):k.push(L("Ray Mirror","Ray Mirror",0)),(t=v(c,"SpecTra"))?k.push(t):k.push(L("SpecTra","SpecTra",0)),n.push(x(c,"Diffuse")),n.push(x(c,"Spec")));z=0;switch(w.specular_shader){case "COOKTORR":case "PHONG":t=w.specular_hardness;break;case "WARDISO":t=w.specular_slope;
break;case "TOON":t=w.specular_toon_size;z=w.specular_toon_smooth;break;default:Y.error("B4W Error: unsupported specular shader: "+w.specular_shader+' (material "'+w.name+'")'),t=w.specular_hardness}switch(w.diffuse_shader){case "LAMBERT":R=B=0;break;case "OREN_NAYAR":B=w.roughness;R=0;break;case "FRESNEL":B=w.diffuse_fresnel;R=w.diffuse_fresnel_factor;break;default:Y.error("B4W Error: unsupported diffuse shader: "+w.diffuse_shader+' (material "'+w.name+'")'),R=B=0}l.push(C(F("param_MATERIAL_diffuse"),
[c.use_diffuse?1:0,B,R],3));l.push(C(F("param_MATERIAL_spec"),[c.use_specular?1:0,w.specular_intensity,t,z],4));l.push(C(F("param_MATERIAL_norm"),s.qd?1:0,1));w={name:c.name,value:w};break;case "MATH":switch(c.operation){case "ADD":g="MATH_ADD";break;case "SUBTRACT":g="MATH_SUBTRACT";break;case "MULTIPLY":g="MATH_MULTIPLY";break;case "DIVIDE":g="MATH_DIVIDE";break;case "SINE":g="MATH_SINE";break;case "COSINE":g="MATH_COSINE";break;case "TANGENT":g="MATH_TANGENT";break;case "ARCSINE":g="MATH_ARCSINE";
break;case "ARCCOSINE":g="MATH_ARCCOSINE";break;case "ARCTANGENT":g="MATH_ARCTANGENT";break;case "POWER":g="MATH_POWER";break;case "LOGARITHM":g="MATH_LOGARITHM";break;case "MINIMUM":g="MATH_MINIMUM";break;case "MAXIMUM":g="MATH_MAXIMUM";break;case "ROUND":g="MATH_ROUND";break;case "LESS_THAN":g="MATH_LESS_THAN";break;case "GREATER_THAN":g="MATH_GREATER_THAN";break;case "MODULO":g="MATH_MODULO";break;case "ABSOLUTE":g="MATH_ABSOLUTE";break;default:return Y.error("Unsupported MATH operation: "+c.operation),
!1}k=I(c);n=y(c);break;case "MIX_RGB":switch(c.blend_type){case "MIX":g="MIX_RGB_MIX";break;case "ADD":g="MIX_RGB_ADD";break;case "MULTIPLY":g="MIX_RGB_MULTIPLY";break;case "SUBTRACT":g="MIX_RGB_SUBTRACT";break;case "SCREEN":g="MIX_RGB_SCREEN";break;case "DIVIDE":g="MIX_RGB_DIVIDE";break;case "DIFFERENCE":g="MIX_RGB_DIFFERENCE";break;case "DARKEN":g="MIX_RGB_DARKEN";break;case "LIGHTEN":g="MIX_RGB_LIGHTEN";break;case "OVERLAY":g="MIX_RGB_OVERLAY";break;case "DODGE":g="MIX_RGB_DODGE";break;case "BURN":g=
"MIX_RGB_BURN";break;case "HUE":g="MIX_RGB_HUE";break;case "SATURATION":g="MIX_RGB_SATURATION";break;case "VALUE":g="MIX_RGB_VALUE";break;case "COLOR":g="MIX_RGB_COLOR";break;case "SOFT_LIGHT":g="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":g="MIX_RGB_LINEAR_LIGHT";break;default:return Y.error("Unsupported MIX_RGB blend type: "+c.blend_type),!1}k=I(c);n=y(c);break;case "OUTPUT":k=I(c);n=[];break;case "RGB":t=x(c,"Color");n.push(t);l.push(C(F("param_RGB_Color"),t.hb,3));break;case "SEPRGB":case "SEPHSV":k=
I(c);n=y(c);break;case "TEXTURE":if(!c.texture)return Y.error("No texture attached to node: "+c.name),!1;a:{g=c.outputs;w=!1;for(s=0;s<g.length;s++)if(t=g[s],t.is_linked)switch(t.identifier){case "Color":g="ENVIRONMENT_MAP"==c.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";break a;case "Normal":g="TEXTURE_NORMAL";break a;case "Value":w=!0;break;default:throw"Unknown texture output";}g=w?"ENVIRONMENT_MAP"==c.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR":void 0}k.push(v(c,"Vector"));if("TEXTURE_COLOR"==
g||"TEXTURE_ENVIRONMENT"==g)n.push(x(c,"Color")),n.push(x(c,"Value"));"TEXTURE_NORMAL"==g&&(n.push(x(c,"Normal")),n.push(x(c,"Value")));t=F("param_TEXTURE_texture");l.push(C(t));w={name:t,value:c.texture};break;case "VALUE":s=null;if(e){if(g=e.action)for(t in m=g.d.B,m)if(m=t.substring(7,7+c.name.length),m==c.name){s=g.name+"_"+t;break}z=e.nla_tracks;for(B=0;B<z.length;B++)for(R=z[B].strips,A=0;A<z[B].strips.length;A++)for(t in g=R[A].action,m=g.d.B,m)if(m=t.substring(7,7+c.name.length),m==c.name){s=
g.name+"_"+t;break}}t=x(c,"Value");s?(g="ANIM_VALUE",z={name:F("param_ANIM_VALUE_Value"),value:"0"},l.push(z),z={name:"-1",value:s},l.push(z)):(g="VALUE",l.push(C(F("param_value_value"),t.hb,1)));n.push(t);break;case "VECT_MATH":switch(c.operation){case "ADD":g="VECT_MATH_ADD";break;case "SUBTRACT":g="VECT_MATH_SUBTRACT";break;case "AVERAGE":g="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":g="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":g="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":g="VECT_MATH_NORMALIZE";
break;default:return Y.error("Unsupported VECT_MATH operation: "+c.operation),!1}k=I(c);n=y(c);break;default:k=I(c),n=y(c)}f={name:f,type:g,Yh:h,H:k,Ma:n,B:l,data:w};P.Yj(a,P.Pn(a),f);if(f="GEOMETRY"==c.type)a:{f=c.outputs;for(l=h=0;l<f.length;l++)if(f[l].is_linked&&h++>d){f=!0;break a}f=!1}return f&&!p(a,c,++d,e)?!1:!0}function F(a){R[a]||(R[a]=0);var b=a+R[a],b=b.replace(/ /g,"_").replace(/\//g,"_");R[a]++;return b}function q(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&
!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";default:return null}}}function v(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return A(e)}return null}function x(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return A(e)}return null}function A(a){var b=a.name,
c=a.identifier,d=a.is_linked;a=a.default_value;a=Z.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,qd:d,hb:a}}function L(a,b,c){return{name:a,identifier:b,qd:!1,hb:c}}function I(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=A(a.inputs[c]);d.hb.length&&d.hb.splice(3);b.push(d)}return b}function y(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=A(a.outputs[c]);b.push(d)}return b}function C(a,b,c){b=null===b||void 0===b?null:X.t(b,c);if(ma.Fl&&b){c=["param_MAPPING_HEAVY_trs_matrix","param_MAPPING_LIGHT_min_clip",
"param_MAPPING_LIGHT_max_clip","param_MAPPING_HEAVY_use_min","param_MAPPING_HEAVY_use_max"];for(var d=!1,e=0;e<c.length;e++)if(0<=a.indexOf(c[e])){d=!0;break}d&&(b=B(b))}return{name:a,value:b}}function B(a){a=a.replace(/(,)/g,"$1 ");a=a.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3");a=a.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3");return a=a.replace(/\s+/g,"")}function G(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"*"+c}function K(a){var b=
[];P.K(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function N(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.$v,f=c[d].data.aw;if(!e)return!1;P.K(e,function(b,c){P.Yj(a,P.Pn(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);Q(c[d],b,a)}return!0}function V(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function U(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=
c[e],g=null,h=0;h<b.length;h++)if(f.from_socket.identifier==b[h].to_socket.identifier){g=b[h];break}g?(f.from_node=g.from_node,f.from_socket=g.from_socket):d.push(f)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function O(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function J(a,b,c,d){for(var e=0;e<d.length;e++){for(var f=d[e],g,h=0;h<c.H.length;h++)if(f.from_socket.identifier==c.H[h].identifier){g=c.H[h].hb;break}for(var h=
f,n=b,u=g,l=k(h.to_node,n),p=0;p<l.length;p++)for(var q=P.Ba(n,l[p]),w=0;w<q.H.length;w++)if(q.H[w].identifier==h.to_socket.identifier){q.H[w].hb=u;break}f=a.indexOf(f);-1!=f&&a.splice(f,1)}}function Q(a,b,c){for(var d=a.name,e=[],f=[],g=[],h=[],k=0;k<b.length;k++){var n=b[k];V(n.from_node,d,n,e,g,h);V(n.to_node,d,n,f,g,h)}f=U(b,f,g);e=U(b,h,e);O(b,f);J(b,c,a,f);if(e.length){var u;P.K(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(u=b)});J(b,c,u,e)}}var Y=m("__print"),P=m("__graph"),
X=m("__shaders"),Z=m("__util"),S=m("__config"),da=m("vec3"),D=m("mat3"),ia=m("mat4"),R={},w={},u={},T=0,ma=S.p;a.bt=b;a.ct=function(a){var b=[],c={};R={};var d=P.lq(a);P.K(d,function(a,d){var e;e=[];for(var f=[],g=[],h=[],k=[],n=[],u=0;u<d.H.length;u++){var l=d.H[u];if(l.qd)e.push(null),f.push(null);else{e.push(F("in_"+d.type+"_"+l.identifier));var p=X.t(l.hb,0);ma.Fl&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==l.identifier||"Color2"==l.identifier||"Fac"==l.identifier)||0<=d.type.indexOf("MATH_")&&
("Value"==l.identifier||"Value_001"==l.identifier))&&(p=B(p));f.push(p)}}for(u=0;u<d.Ma.length;u++)l=d.Ma[u],l.qd?g.push(null):g.push(F("out_"+d.type+"_"+l.identifier));for(u=0;u<d.B.length;u++)l=d.B[u],h.push(l.name),k.push(l.value);for(u=0;u<d.Yh.length;u++)n.push(d.Yh[u].name);e={id:d.type,H:e,xo:f,Ma:g,B:h,ij:k,Yh:n};b.push(e);c[a]=e});P.ke(d,function(a,b,e){var f=P.Ba(d,a);P.Ba(d,b);var g=f.Ma[e[0]];a=c[a].Ma;b=c[b].H;f=a[e[0]]||F("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};
a.cleanup=function(){for(var a in w)delete w[a];for(var b in u)delete u[b];T=0}};b4w.module.__animation=function(a,m){function b(a,b){var c=a.v[b];c&&c.Hk&&c.ih&&(c.ih=!1,c.Hk(a))}function c(a,b,c){c=a.v[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.Nb=d;c.Xc=b.name;for(e=d=0;e<a.data.b4w_vertex_anim.length;e++){var f=a.data.b4w_vertex_anim[e];if(f==b)break;else d+=f.frame_end-f.frame_start+1}c.xq=d}function h(a,b,c){a=a.v[c];a.type=50;a.Xc=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);
a.Fc=b}function d(a){return a.replace(/_B4W_BAKED$/,"")}function l(a){var b=[],c=a.animation_data;if(c&&c.action){var d=Q.Sf(c.action.d.ek);"ARMATURE"!=a.type&&d||b.push(c.action)}U.Sd(a)&&a.data.animation_data&&a.data.animation_data.action&&b.push(a.data.animation_data.action);if("MESH"==a.type)for(a=a.data.materials,c=0;c<a.length;c++)(d=a[c].node_tree)&&d.animation_data&&d.animation_data.action&&b.push(d.animation_data.action);return b}function k(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=
a[b];if("ARMATURE"==c.type)return c.object}return null}function g(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function e(a,c,d){s(a,c,d);b(a,d);a.d.Cd&&(F(a,c),p(a,c))}function n(a,b,c){var d=b.frame_range,e=b.d,g=a.v[c];g.Xc=b.name;g.xm=d;g.ds=e.gw;g.bs=e.Es;g.start=d[0];g.length=d[1]-d[0];g.Nb=d[0];var d=Q.Sf(e.ek),h=!1,k;for(k in e.B)if(-1!=k.indexOf("nodes")){h=k;break}if(Q.pd(a)&&d){g.type=10;a:{for(var e=a.Rj,n=0;n<e.length;n+=2)if(b==e[n]){e=e[n+1];break a}e=null}e||
(e=q(a,b,t(a)),a.Rj.push(b,e));g.e=e.e;g.ma=e.ma;g=a.d;e=g.wj;k=a.v[c];n=k.Hl;a:{for(var h=g.Pp,l=0;l<h.length;l+=2)if(b==h[l]){h=h[l+1];break a}h=null}if(h)k.Hl=h;else{for(k=0;k<e.length;k++)h=q(a,b,e[k].$b),n.push(h);g.Pp.push(b,n)}g.Cd&&(b=g.Ej,c>b[1]?(g=b[1],b[1]=c,b[0]=g):c>b[0]&&c<b[1]&&(b[0]=c),z(a))}else if(U.Sd(a)&&(e.B.volume||e.B.pitch))g.volume=e.B.volume||null,g.pitch=e.B.pitch||null,g.type=40;else if("MESH"==a.type&&h)for(n in g.type=70,h=a.d.wh,e.B)for(l=b.name+"_"+n,k=0;k<h.length;k+=
2){if(l==h[k]){g.To.push(h[k+1]);g.Uo.push(e.B[n]);break}}else if(n=e.B.tsr){g.e=[];g.ma=[];b=e.Wo;for(k=0;k<b;k++)g.e.push(n.subarray(8*k,8*k+4)),g.ma.push(n.subarray(8*k+4,8*k+8));g.type=20;G.nd(a)&&G.ay(a,g.e,g.ma)}else N.warn('B4W Warning: Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),g.type=60;Q.pd(a)&&!d&&f(a,c)}function z(a){var b=a.d.Ej;if(-1!=b[0]&&-1!=b[1]){var c=a.v;a=c[b[1]].Nb;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.Nb;d=Math.floor(a);b.Nb=d+e}}function f(a,
b){var c=a.d.Ej,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.v;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function t(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var e=b[d].name;c[e]={Sm:d,eh:d,ul:Q.Sk(a,"name",e),zq:-1}}return c}function s(a,b,c){if((c=a.v[c])&&(c.play||0==b)){var d=a.d,e=c.Nb,f=c.start,g=c.length,e=e+c.speed*b*P.Xa,h=c.type,k=c.speed;if(0<=k&&e>=f+g||0>k&&e<f)switch(c.ih=!0,c.behavior){case 10:e=0<=k?(e-f)%g+f:f+
g-1E-6;break;case 20:e=0<=k?f:f+g-1E-6;c.play=!1;break;case 30:e=0<=k?f+g-1E-6:f,c.play=!1}c.Nb=e;switch(h){case 10:if(!d.Cd){e=r(c,e,X);b=e[0];f=e[1];e=e[2];d.Qb=c.ma[b];d.Pb=c.ma[f];d.Xb=c.e[b];d.Wb=c.e[f];d.Re=e;d=d.wj;c=c.Hl;for(g=0;g<d.length;g++)h=d[g],k=c[g],h.Qb=k.ma[b],h.Pb=k.ma[f],h.Xb=k.e[b],h.Wb=k.e[f],h.Re=e;O.F(a)}break;case 20:h=e=r(c,e,X);(d=Z)||(d=new Float32Array(4));var f=h[0],g=h[1],h=h[2],k=c.e,n=k[f][1],l=k[f][2],p=k[g][1],q=k[g][2];d[0]=(1-h)*k[f][0]+h*k[g][0];d[1]=(1-h)*n+
h*p;d[2]=(1-h)*l+h*q;f=e;(g=da)||(g=new Float32Array(4));h=c.ma;Y.slerp(h[f[0]].subarray(0,4),h[f[1]].subarray(0,4),f[2],g);f=g;g=e[2];h=c.e;e=(1-g)*h[e[0]][3]+g*h[e[1]][3];c.Vl&&(g=S,O.get_translation(a,g),Q.smooth_v(d,g,b,c.Vl,d));c.wl&&(g=D,O.get_rotation(a,g),Q.Sp(f,g,b,c.wl,f));O.set_translation(a,d);O.set_rotation(a,f);O.set_scale(a,e);O.F(a);K.sync_transform(a);break;case 30:(a=X)||(a=Array(3));f=e-c.start;0>f&&(f=0);f>=c.length&&(f=c.length);b=Math.floor(f);e=b+1;f-=b;10!=c.behavior&&e==c.length&&
(e=b-=1,f=1);c=c.xq;a[0]=b+c;a[1]=e+c;a[2]=f;e=X;d.$l=e[0];d.wq=e[2];break;case 40:e=r(c,e,X);b=e[0];d=e[1];e=e[2];c.volume&&U.set_volume(a,(1-e)*c.volume[b]+e*c.volume[d]);c.pitch&&U.playrate(a,(1-e)*c.pitch[b]+e*c.pitch[d]);break;case 50:G.Vw(c.Fc,e/P.Xa);break;case 70:e=r(c,e,X);b=e[0];d=e[1];e=e[2];f=c.Uo;c=c.To;for(g=0;g<c.length;g++)h=f[g],a.d.hf[c[g]]=(1-e)*h[b]+e*h[d];break;case 60:break;default:throw"Unknown animation type:"+h;}}}function r(a,b,c){c||(c=Array(3));var d=a.xm[0],e=a.xm[1]-
d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.ds;e=Math.floor(b);a=a.bs[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function p(a,b){var c=a.d,d=c.Bd,e=c.Ej,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var g=a.v[f];if(g.play||0==b)var h=r(g,g.Nb,X),k=h[0],n=h[1],h=h[2],l=g.ma[k],p=g.ma[n],k=g.e[k],n=g.e[n];else d=1}else d=1;e=a.v[e];if(e.play||0==b)var h=r(e,e.Nb,X),q=h[0],w=h[1],h=h[2];else if(-1!=f&&g.play)d=0;else return;f=e.ma[q];g=e.ma[w];q=e.e[q];e=e.e[w];if(1==d)c.Qb.set(f),c.Pb.set(g),c.Xb.set(q),c.Wb.set(e);else if(0==
d)c.Qb.set(l),c.Pb.set(p),c.Xb.set(k),c.Wb.set(n);else{for(w=0;w<l.length;w+=4){for(var t=da,s=D,z=0;4>z;z++)t[z]=l[w+z],s[z]=f[w+z];Y.slerp(t,s,d,t);for(z=0;4>z;z++)c.Qb[w+z]=t[z];for(z=0;4>z;z++)t[z]=p[w+z],s[z]=g[w+z];Y.slerp(t,s,d,t);for(z=0;4>z;z++)c.Pb[w+z]=t[z]}Q.Pm(k,q,d,c.Xb);Q.Pm(n,e,d,c.Wb)}d=c.wj;l=c.Qo;for(w=0;w<d.length;w++){p=d[w];k=l[w];for(n=0;n<k.length;n+=2)for(q=k[n],f=k[n+1],g=0;4>g;g++)p.Qb[q+g]=c.Qb[f+g],p.Pb[q+g]=c.Pb[f+g],p.Xb[q+g]=c.Xb[f+g],p.Wb[q+g]=c.Wb[f+g];p.Re=h}}}function F(a,
b){var c=a.d,d=c.Bd,e=c.Xj;if(0!=e){var d=c.Wj-d,f=e*b;Math.sign(d)==Math.sign(e)&&Math.abs(f)<Math.abs(d)?c.Bd+=f:(c.Bd=c.Wj,c.Xj=0)}}function q(a,b,c){for(var d=a.pose.bones,e=[],f=[],g=b.d.Wo,h=0;h<g;h++){for(var k=0;k<d.length;k++){var n=d[k],l=J.create(),p=b.d.ek[n.name];p&&J.copy(p.subarray(8*h,8*h+8),l);n.vm=l;n.fi=!1}k=v(a,c);e.push(k.e);f.push(k.ma)}return{e:e,ma:f}}function v(a,b){var c=[],d=[],e=a.pose.bones,f=new Float32Array(4),g=new Float32Array(4),h;for(h in b){var k=b[h],n=k.eh,l=
e[k.ul],k=f,p=g,q=l.Ur,w=q[q.length-1],r=w.Tj;w.fi||J.identity(r);for(w=q.length-1;0<=w;w--){var l=q[w],t=l.Tj;if(l.fi)r=t;else{var s=l.wm,z=l.vm;J.invert(s,ia);J.multiply(z,ia,ia);J.multiply(s,ia,ia);J.multiply(r,ia,t);r=t;l.fi=!0}}l=l.Tj;k[0]=l[0];k[1]=l[1];k[2]=l[2];k[3]=l[3];p[0]=l[4];p[1]=l[5];p[2]=l[6];p[3]=l[7];Y.normalize(p,p);for(k=0;4>k;k++)p=4*n+k,c[p]=f[k],d[p]=g[k]}c=new Float32Array(c);d=new Float32Array(d);return{e:c,ma:d}}function x(a,b,c,d,e,f,g){var h=a+(b-a)/2,k=A(h,d,e,f,g)-c;
return.02>Math.abs(k)?h:0<k?x(a,h,c,d,e,f,g):x(h,b,c,d,e,f,g)}function A(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function L(a,b){a.v||(a.v=[null,null,null,null,null,null,null,null]);a.v[b]={type:null,Xc:null,ma:null,e:null,Hl:[],play:!1,behavior:20,Nb:0,start:0,length:0,Vl:0,wl:0,ih:!1,xq:null,speed:1,volume:null,pitch:null,Uo:[],To:[]};a.Rj=a.Rj||[];-1==R.indexOf(a)&&R.push(a)}function I(a,b){O.F(a);K.sync_transform(a);e(a,0,b)}function y(a,b,d){d=d||0;if(Q.dc(a)){var e=Q.keysearch("name",
b,a.data.b4w_vertex_anim);if(e)return L(a,d),c(a,e,d),I(a,d),1;if((e=Q.keysearch("name",b,a.particle_systems))&&"EMITTER"==e.settings.type)return L(a,d),h(a,e,d),I(a,d),1}if(e=Q.keysearch("name",b,w)||Q.keysearch("name",b+"_B4W_BAKED",w)){if(!Q.Sf(e.fcurves))return N.error('No fcurves in action "'+e.name+'"'),0;L(a,d);n(a,e,d);I(a,d);return 1}N.error('Unsupported object: "',a.name,'" or animation name: "',b,'"');return 0}function C(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;
for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&d.animation_data)return!0}return!1}var B=m("__config"),G=m("__particles"),K=m("__physics"),N=m("__print"),V=m("__scenes"),U=m("__sfx"),O=m("__transform"),J=m("__tsr"),Q=m("__util");m("mat4");var Y=m("quat"),P=B.Ae;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_STATIC=60;a.OBJ_ANIM_TYPE_MATERIAL=70;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=
2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var X=Array(3),Z=new Float32Array(3),S=new Float32Array(3),da=new Float32Array(4),D=new Float32Array(4),ia=new Float32Array(8);new Float32Array(16);var R=[],w=[];a.frame_to_sec=function(a){return a/P.Xa};a.update=function(a){for(var c=0;c<R.length;c++){for(var d=R[c],e=0;8>e;e++)s(d,a,e);d.d.Cd&&(F(d,a),p(d,a))}for(c=0;c<R.length;c++)for(d=R[c],e=0;8>e&&d.v;e++)b(d,e)};a.Ku=
function(){return w};a.Uu=function(a,b){var c=a.v[b];return c&&c.Xc?d(c.Xc):null};a.get_anim_names=function(a){var b=[];if(Q.dc(a)&&a.d.Wh)for(var c=0;c<a.data.b4w_vertex_anim.length;c++)b.push(a.data.b4w_vertex_anim[c].name);for(var e=l(a),c=0;c<e.length;c++)b.push(d(e[c].name));if(G.nd(a)&&G.We(a))for(c=0;c<a.particle_systems.length;c++)b.push(a.particle_systems[c].name);return b};a.vx=d;a.get_anim_type=function(a,b){var c=a.v[b];return c?c.type:null};a.apply_def=function(a){for(var b=0,d=l(a),
e=0;e<d.length;e++){var f=d[e];Q.Sf(f.fcurves)?(L(a,b),n(a,f,b),I(a,b),a.v[b].behavior=a.b4w_cyclic_animation?10:20,b++):N.error('No fcurves in action "'+f.name+'"')}f=a.particle_systems;for(e=0;e<f.length;e++){var g=f[e],k=g.settings;"EMITTER"==k.type&&(L(a,b),h(a,g,b),I(a,b),a.v[b].behavior=a.b4w_cyclic_animation||k.b4w_cyclic?10:20,b++)}Q.dc(a)&&a.d.Wh?(L(a,b),c(a,a.data.b4w_vertex_anim[0],b),I(a,b),a.v[b].behavior=a.b4w_cyclic_animation?10:20):d.length||G.We(a)||(L(a,0),d=a.v[0],d.type=60,d.Xc=
a.name+"_STATIC",e=V.av(V.get_active()),d.start=e[0],d.length=e[1]-e[0]+1,I(a,b))};a.get_first_armature_object=k;a.play=function(a,b,c){g(a.v,c,function(a){a.play=!0;a.Hk=b?b:null;a.ih=!1});a.d.Cd&&z(a)};a.stop=function(a,b){g(a.v,b,function(a){a.play=!1;a.Hk=null;a.ih=!1})};a.is_play=function(a,b){var c=a.v[b];return c?c.play:!1};a.set_current_frame_float=function(a,b,c){var d=a.v;if(-1==c)for(c=0;8>c;c++){var f=d[c];f&&(f.Nb=b,e(a,0,c))}else if(f=d[c])f.Nb=b,e(a,0,c)};a.get_current_frame_float=
function(a,b){var c=a.v[b];return c&&c.Nb?c.Nb:0};a.is_cyclic=function(a,b){var c=a.v[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){g(a.v,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.v[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){g(a.v,d,function(a){a.Vl=b||0;a.wl=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.v[c]=null;else a.v[b]=null;a.d.Cd&&f(a,b)};a.update_object_animation=e;a.Vk=function(a){if("ARMATURE"==a.type||
k(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||G.nd(a)&&G.We(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||C(a)?!0:!1};a.is_animated=function(a){return a.v?!0:!1};a.Js=t;a.Vm=v;a.fs=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);Y.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):(d=-1<a.indexOf("scale")?
3:0,e=0);return d+e}function d(a,b,c,e){if(-1<c.search(f)){a=b;c=c.split('"')[1];var h=g}else-1<c.indexOf("location")?(c="tsr",h=g):-1<c.indexOf("rotation_quaternion")?(c="tsr",h=g):-1<c.indexOf("scale")?(c="tsr",h=g):h=0;if(!a[c]){b=a;var k=c;if("object"==typeof h&&h.length)for(var n=h.length,l=new Float32Array(e*n),p=0;p<e;p++)for(var u=0;u<n;u++)l[p*n+u]=h[u];else if("number"==typeof h)for(l=new Float32Array(e),p=0;p<e;p++)l[p]=h;else throw"Wrong storage default value";b[k]=l}return a[c]}a.d={};
var e=a.d;e.gw=1/P.Se;var f=new RegExp(/pose.bones\[\".+\"\]/g),g=J.create(),h=a.fcurves,k={},n={},l=0,p;for(p in h){var q=h[p],r;for(r in q){var t=q[r].Zr;l||(l=t.length);for(var s=d(k,n,p,l),z=s.length/l,C=c(p,r|0),m=0;m<l;m++)s[m*z+C]=t[m]}}for(var x in k)"tsr"==x&&b(k[x],l);for(var B in n)b(n[B],l);e.B=k;e.ek=n;e.Es=a.Tr;e.Wo=l;w.push(a)};a.Ou=function(a,b){return(b-a)*P.Se+1};a.xs=function(a,b,c,d,e,f){var g,h,k=new Float32Array(2),n=new Float32Array(2),l=new Float32Array(2),p=new Float32Array(2),
q=b[1],w=b[2],r=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var t=0,s=0,z=null;e<=f;e++)if(e<q)for(var C=0;C<P.Se;C++)c[t++]=w;else if(e>r)for(C=0;C<P.Se;C++)c[t++]=a;else{var m=b[s],B=3;0===m&&(B+=2);0===z&&(B+=2);var R=2===m?0:1;if(b[s+1]==b[s+B+1])z=m,s+=B;else{C=0;e==b[s+1]&&(R&&(d[t]=1),c[t]=b[s+2],t++,C++);if(e==r)for(;C<P.Se;C++)c[t++]=a;else for(k[0]=b[s+1],k[1]=b[s+2],0!==m?(n[0]=0,n[1]=0):0===z?(n[0]=b[s+5],n[1]=b[s+6]):(n[0]=b[s+3],n[1]=b[s+4]),0!==m?(l[0]=0,l[1]=0):(l[0]=b[s+
B+3],l[1]=b[s+B+4]),p[0]=b[s+B+1],p[1]=b[s+B+2];C<P.Se;C++){var v=e+C/P.Se;switch(m){case 0:g=k;h=n;var G=l,F=p,K=[],y=[],D=void 0,J=void 0,L=void 0,D=void 0;K[0]=g[0]-h[0];K[1]=g[1]-h[1];y[0]=F[0]-G[0];y[1]=F[1]-G[1];L=F[0]-g[0];D=Math.abs(K[0]);J=Math.abs(y[0]);0!=D+J&&D+J>L&&(D=L/(D+J),h[0]=g[0]-D*K[0],h[1]=g[1]-D*K[1],G[0]=F[0]-D*y[0],G[1]=F[1]-D*y[1]);R&&(d[t]=1);c[t]=A(x(0,1,v,k[0],n[0],l[0],p[0]),k[1],n[1],l[1],p[1]);t++;break;case 1:h=k[0];G=k[1];g=F=(p[1]-G)/(p[0]-h);h=G-F*h;R&&(d[t]=1);
c[t]=g*v+h;t++;break;case 2:R&&(d[t]=1);c[t]=b[s+2];t++;break;default:throw"Unknown keyframe intepolation mode: "+m;}}e+1==b[s+B+1]&&(z=m,s+=B)}}};a.uz=function(a){for(var b=0;b<a.length;b++)if(a[b].Ky)return a[b];return!1};a.apply=y;a.get_slot_num_by_anim=function(a,b){for(var c=a.v,e=0;e<c.length;e++){var f=c[e];if(f&&d(f.Xc)==d(b))return e}return-1};a.Mu=function(a,b){var c=a.v[b];return c&&c.Xc?d(c.Xc):null};a.remove=function(a){a.v=null;a=R.indexOf(a);-1!=a&&R.splice(a,1)};a.tw=function(a){for(var b=
w.length-1;0<=b;b--)w[b].Vr==a&&w.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.v)return y(a,b,0)?0:-1;for(var c=0;c<a.v.length;c++)if(!a.v[c])return y(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.d.Xj=(b-a.d.Bd)/c;a.d.Wj=b};a.set_speed=function(a,b,c){g(a.v,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.v[b].speed};a.get_anim_start_frame=function(a,b){return a.v[b].start};a.get_anim_length=function(a,b){return a.v[b].length};a.qo=C;a.cleanup=function(){R.length=
0;w.length=0}};b4w.module.__transform=function(a,m){function b(a){var f=a.d;d.Tx(a,v);h.Sx(a);"CAMERA"==a.type&&h.$s(a);var p=f.e,q=f.scale,t=f.quat;n.Rh(p,q,t,f.Qc);var s=f.I;r.identity(s);r.fromQuat(t,s);"CAMERA"!=a.type&&z.Dw(s,q,s);s[12]=p[0];s[13]=p[1];s[14]=p[2];r.invert(s,f.yo);a.v&&k.We(a)&&k.Ux(a);f.zb&&f.Fa&&(c.fk(f.zb,s,f.Fa),c.hk(f.pc,s,f.cb),c.gk(f.Fe,f.Qc,f.Ge),f.Kb&&g.Dl(g.get_active()));switch(a.type){case "SPEAKER":e.lx(a,v);break;case "CAMERA":h.qq(a);g.T()&&e.Kv(g.get_active(),p,t,v);break;case "LAMP":l.Wx(a);
g.T()&&g.Ij(a,g.get_active());break;case "EMPTY":a.field&&g.sq(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!g.T()||(f=g.get_active(),g.Dl(f),g.Hw(f));a=a.Ad;for(f=0;f<a.length;f++)b(a[f])}var c=m("__boundings"),h=m("__camera"),d=m("__constraints"),l=m("__lights"),k=m("__particles"),g=m("__scenes"),e=m("__sfx"),n=m("__tsr"),z=m("__util"),f=m("vec3"),t=m("quat"),s=m("mat3"),r=m("mat4"),p=new Float32Array(3),F=new Float32Array(4),q=new Float32Array(9),v=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){v=
a};a.set_translation=function(a,b){d.md(a)==d.Uc?n.Ww(b,d.ld(a)):a.d.e.set(b)};a.get_translation=function(a,b){d.md(a)==d.Uc?f.copy(n.eo(d.ld(a)),b):f.copy(a.d.e,b)};a.set_rotation=function(a,b){d.md(a)==d.Uc?n.El(b,d.ld(a)):a.d.quat.set(b)};a.get_rotation=function(a,b){d.md(a)==d.Uc?t.copy(n.Yn(d.ld(a)),b):t.copy(a.d.quat,b)};a.set_rotation_euler=function(a,b){if(d.md(a)==d.Uc){var c=z.euler_to_quat(b,F);n.El(c,d.ld(a))}else z.euler_to_quat(b,a.d.quat)};a.set_scale=function(a,b){d.md(a)==d.Uc?n.set_scale(b,
d.ld(a)):a.d.scale=b};a.get_scale=function(a){return d.md(a)==d.Uc?n.get_scale(d.ld(a)):a.d.scale};a.gv=function(a,b){if(d.md(a)==d.Uc)n.copy(d.ld(a),b);else{var c=a.d;n.Rh(c.e,c.scale,c.quat,b)}};a.Lp=function(a,b){if(d.md(a)==d.Uc)n.copy(b,d.ld(a));else{var c=a.d;c.e[0]=b[0];c.e[1]=b[1];c.e[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}};a.get_object_size=function(a){var b="STATIC"==a.d.type?a.tm:a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=
b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(b=a.d,f.copy(b.cb.s,c)):(b="STATIC"==a.d.type?a.tm:a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,f.transformMat4(c,b.I,c));return c};a.move_local=function(a,b,c,d){a=a.d;p[0]=b;p[1]=c;p[2]=d;b=s.fromMat4(a.I,q);f.transformMat3(p,b,p);f.add(a.e,p,a.e)};a.F=b;a.distance=function(a,b){return f.dist(a.d.e,
b.d.e)};a.ew=function(a,b){return f.dist(a.d.e,b)};a.get_object_bounding_box=function(a){return{max_x:a.d.Fa.max_x,min_x:a.d.Fa.min_x,max_y:a.d.Fa.max_y,min_y:a.d.Fa.min_y,max_z:a.d.Fa.max_z,min_z:a.d.Fa.min_z}}};b4w.module.__tsr=function(a,m){function b(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function c(a,b,c){var d=b[0],g=b[1],h=b[2],k=b[3],l=b[4],m=b[5],q=b[6];b=b[7];var v=a[0]*k,x=a[1]*k,A=a[2]*k;a=b*v+m*A-q*x;var k=b*x+q*v-l*A,L=b*A+l*x-m*v,v=-l*v-m*x-q*A;c[0]=a*b+v*-l+k*-q-L*-m;c[1]=k*b+v*-m+L*-l-a*-q;c[2]=L*b+v*-q+a*-m-k*-l;c[0]+=d;c[1]+=g;c[2]+=h;return c}var h=m("__util"),d=m("vec3"),l=m("quat");m("mat4");var k=new Float32Array(3),g=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.Kf=function(a,c,d,f){f||(f=new Float32Array(8));b(a,c,d,f);return f};a.Rh=b;a.Ww=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.Xw=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.El=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.eo=function(a){return a.subarray(0,
3)};a.get_scale=function(a){return a[3]};a.Yn=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],h=a[1],k=a[2];g[0]=a[4];g[1]=a[5];g[2]=a[6];g[3]=a[7];l.invert(g,g);var r=g[0],p=g[1],m=g[2],q=g[3],d=d*c,h=h*c,v=k*c,k=q*d+p*v-m*h,x=q*h+m*d-r*v,A=q*v+r*h-p*d,d=-r*d-p*h-m*v;b[0]=-(k*q+d*-r+x*-m-A*-p);b[1]=-(x*q+d*-p+A*-r-k*-m);b[2]=-(A*q+d*-m+k*-p-x*-r);b[3]=c;b[4]=r;b[5]=p;b[6]=m;b[7]=q;return b};a.Nn=function(a,c){var d=h.gf(a,k),f=h.Xi(a),l=h.matrix_to_quat(a,
g);b(d,f,l,c);return c};a.multiply=function(a,b,d){c(b,a,d);d[3]=a[3]*b[3];var f=a[4],g=a[5],h=a[6];a=a[7];var k=b[4],l=b[5],m=b[6];b=b[7];d[4]=f*b+a*k+g*m-h*l;d[5]=g*b+a*l+h*k-f*m;d[6]=h*b+a*m+f*l-g*k;d[7]=a*b-f*k-g*l-h*m;return d};a.Th=c;a.Gg=function(a,b,c,d){d||(d=0);var g=a.length,h=b[0],k=b[1],l=b[2],m=b[3],q=b[4],v=b[5],x=b[6];b=b[7];for(var A=0;A<g;A+=3){var L=a[A]*m,I=a[A+1]*m,y=a[A+2]*m,C=b*L+v*y-x*I,B=b*I+x*L-q*y,G=b*y+q*I-v*L,L=-q*L-v*I-x*y;c[d+A]=C*b+L*-q+B*-x-G*-v;c[d+A+1]=B*b+L*-v+
G*-q-C*-x;c[d+A+2]=G*b+L*-x+C*-v-B*-q;c[d+A]+=h;c[d+A+1]+=k;c[d+A+2]+=l}};a.Dj=function(a,b,c,d){d||(d=0);var g=a.length,h=b[3],k=b[4],l=b[5],m=b[6];b=b[7];for(var q=0;q<g;q+=3){var v=a[q]*h,x=a[q+1]*h,A=a[q+2]*h,L=b*v+l*A-m*x,I=b*x+m*v-k*A,y=b*A+k*x-l*v,v=-k*v-l*x-m*A;c[d+q]=L*b+v*-k+I*-m-y*-l;c[d+q+1]=I*b+v*-l+y*-k-L*-m;c[d+q+2]=y*b+v*-m+L*-l-I*-k}};a.Cj=function(a,b,c){var d=b[3],g=b[4],h=b[5],k=b[6];b=b[7];var l=a[0]*d,m=a[1]*d,q=a[2]*d;a=b*l+h*q-k*m;var d=b*m+k*l-g*q,v=b*q+g*m-h*l,l=-g*l-h*m-
k*q;c[0]=a*b+l*-g+d*-k-v*-h;c[1]=d*b+l*-h+v*-g-a*-k;c[2]=v*b+l*-k+a*-h-d*-g};a.mq=function(a,b,c,d){d||(d=0);var g=a.length,h=b[3],k=b[4],l=b[5],m=b[6];b=b[7];for(var q=0;q<g;q+=4){var v=a[q]*h,x=a[q+1]*h,A=a[q+2]*h,L=b*v+l*A-m*x,I=b*x+m*v-k*A,y=b*A+k*x-l*v,v=-k*v-l*x-m*A;c[d+q]=L*b+v*-k+I*-m-y*-l;c[d+q+1]=I*b+v*-l+y*-k-L*-m;c[d+q+2]=y*b+v*-m+L*-l-I*-k;c[d+q+3]=a[q+3]}};a.translate=function(a,b,c){var d=a[3],g=a[4],h=a[5],k=a[6],l=a[7],m=b[0]*d,q=b[1]*d,v=b[2]*d;b=l*m+h*v-k*q;var d=l*q+k*m-g*v,x=
l*v+g*q-h*m,m=-g*m-h*q-k*v;c[0]=a[0]+b*l+m*-g+d*-k-x*-h;c[1]=a[1]+d*l+m*-h+x*-g-b*-k;c[2]=a[2]+x*l+m*-k+b*-h-d*-g;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.Wz=function(a,b,c,f){f||(f=new Float32Array(8));d.lerp(a.subarray(0,3),b.subarray(0,3),c,f.subarray(0,3));var g=a[3];f[3]=g+c*(b[3]-g);l.slerp(a.subarray(4),b.subarray(4),c,f.subarray(4));return f};a.rz=function(a,b,c,d){d||(d=new Float32Array(8));var g=a.subarray(0,3),h=b.subarray(0,3),k=d.subarray(0,3);k[0]=h[0]*(c+1)-g[0]*
c;k[1]=h[1]*(c+1)-g[1]*c;k[2]=h[2]*(c+1)-g[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);g=d.subarray(4);g[0]=b[0]*(c+1)-a[0]*c;g[1]=b[1]*(c+1)-a[1]*c;g[2]=b[2]*(c+1)-a[2]*c;g[3]=b[3]*(c+1)-a[3]*c;l.normalize(g,g);return d};a.xv=function(a,b,c,d,g){var h=a.subarray(0,3),k=g.subarray(0,3);k[0]=h[0]+b*c[0];k[1]=h[1]+b*c[1];k[2]=h[2]+b*c[2];g[3]=a[3];a=a.subarray(4);g=g.subarray(4);c=d[0];h=d[1];d=d[2];var k=a[0],p=a[1],m=a[2],q=a[3];g[0]=.5*(c*q+h*m-d*p);g[1]=.5*(h*q+d*k-c*m);g[2]=.5*
(d*q+c*p-h*k);g[3]=.5*(-c*k-h*p-d*m);g[0]=a[0]+g[0]*b;g[1]=a[1]+g[1]*b;g[2]=a[2]+g[2]*b;g[3]=a[3]+g[3]*b;l.normalize(g,g)}};b4w.module.__util=function(a,m){function b(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function c(a,b){var d=a instanceof Array?[]:{},e;for(e in a)d[e]=!a[e]||"object"!=typeof a[e]||-1!=b.indexOf(a[e])||a[e]instanceof Float32Array?a[e]:c(a[e],b);return d}function h(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function d(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function l(a,b){var c=b;switch(typeof a){case "number":return k(a,
c);case "string":return g(a,c);case "boolean":return k(a|0,c);case "function":case "undefined":return k(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=k(a[d],c);else if(d)for(d=0;d<a.length;d++)c=l(a[d],c);else for(var e in a)c=l(a[e],c)}else c=k(0,c)}return c}function k(a,b){var c=b;V[0]=a;c=(c<<5)-c+U[0];c&=c;c=(c<<5)-c+U[1];return c&c}function g(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),
c&=c;return c}function e(a){return(34*a+1)*a%289}function n(a){return a-Math.floor(a)}function z(a){return f((34*a+5)*a)}function f(a){return a-289*Math.floor(a/289)}function t(a){return a-7*Math.floor(a/7)}function s(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!r(a[c],b[c]))return!1}else if(d){if(a.length!=
b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!r(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function r(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return s(a,b);default:return!0}}var p=m("__print"),F=m("vec3"),q=m("vec4"),v=m("quat"),x=m("mat3"),A=m("mat4"),L=0,I={},y=new Float32Array(3),C=new Float32Array(3),B=new Float32Array(4),G=new Float32Array(4),
K=new Float32Array(9),N=new Float32Array(16),V=new Float64Array(1),U=new Uint32Array(V.buffer),O=new Float32Array([0,0,0]),J=new Float32Array([0,0,0,1]),Q=new Float32Array([0,0,0,1,0,0,0,1]),Y=new Float32Array([1,0,0]),P=new Float32Array([0,1,0]),X=new Float32Array([0,0,1]),Z=new Float32Array([-1,0,0]),S=new Float32Array([0,-1,0]),da=new Float32Array([0,0,-1]),D=Math.floor(44488.07041494893);a.Sr=O;a.Nr=J;a.Hy=Q;a.AXIS_X=Y;a.AXIS_Y=P;a.AXIS_Z=X;a.AXIS_MX=Z;a.AXIS_MY=S;a.AXIS_MZ=da;a.keyfind=b;a.su=
function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Nx=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Vs=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.ys=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.sign=function(a){return 0<a?1:0>a?-1:0};a.fA=function(a,b,c){for(var d=c.length,
e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.eA=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.Sk=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.us=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.az=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;
return!0};a.sA=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.qA=function(a,c){var d=b("name",c,a);1<d.length&&p.error("obj_by_name(): name resolution ambiguity");return d};a.rA=function(a,c){var d=b("name",c,a),e=d.length;1<e&&p.error("obj_by_name(): name resolution ambiguity");if(0>=e)return[];for(var f=[],g=0;g<e;g++){var h=d[g];if("EMPTY"==h.type&&h.dupli_group)for(var h=h.dupli_group.objects,k=0;k<h.length;k++)f.push(h[k])}return d=d.concat(f)};a.Kx=
function(a,b,c,d){d||(d=new Float32Array(16));A.identity(d);d[12]=a;d[13]=b;d[14]=c};var ia=1;a.pw=function(){ia=(69069*ia+5)%Math.pow(2,32);return Math.round(ia/65536)%32768/32767};a.tx=function(a){ia=a};a.gc=function(a){var b=a[0]%D*48271-3399*Math.floor(a[0]/D);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.Qi=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/
2),g=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.quat_to_euler=function(a){var b=[],c=a[0],d=a[1],e=a[2];a=a[3];var f=e*e,g=c*d+e*a;.499999<g?(b[0]=0,b[1]=2*Math.atan2(c,a),b[2]=Math.PI/2):-.499999>g?(b[0]=0,b[1]=-2*Math.atan2(c,a),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*a-2*d*e,1-2*c*c-2*f),b[1]=Math.atan2(2*d*a-2*c*e,1-2*d*d-2*f),b[2]=Math.asin(2*c*d+2*e*a));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));F.transformQuat(b,
a,c);return c};a.nz=function(a,b,c){c||(c=new Float32Array(4));a=F.normalize(a,y);var d=F.dot(b,a);a=F.cross(b,a,C);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.Lx=function(a,b,c,d){d||(d=new Float32Array(4));F.transformQuat(c,b,d);d[3]=-F.dot(a,d)};a.$t=function(a){var b=a.d.quat;switch(a.type){case "CAMERA":y[0]=0;y[1]=-1;y[2]=0;F.transformQuat(y,b,y);C[0]=0;C[1]=0;C[2]=-1;break;case "MESH":y[0]=0;y[1]=0;y[2]=1;F.transformQuat(y,
b,y);C[0]=0;C[1]=0;C[2]=1;break;case "EMPTY":y[0]=0,y[1]=1,y[2]=0,F.transformQuat(y,b,y),C[0]=0,C[1]=1,C[2]=0}y[1]=0;F.normalize(y,y);a=F.dot(y,C);return Math.acos(a)*(0<-y[0]*C[2]?-1:1)};a.Pm=function(a,b,c,d){if(0!=c){d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.KA=function(){L++;return L.toString(16)};a.Fj=function(a){I[a]||(I[a]=0);var b=a+I[a];I[a]++;return b};a.bd=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.gb=
function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,A:0,V:null,q:[],u:b}};a.wo=function(a){return{name:a,type:"MESH",modifiers:[],particle_systems:[]}};a.Fd=function(a){return JSON.parse(JSON.stringify(a))};a.cz=function(a,b){var d=[],e;for(e in b){var f=b[e];if(f)for(var g=0;g<f.length;g++)d.push(f[g])}return c(a,d)};a.sa=function(b){var c=b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof
Float32Array?new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.sa(b[d]):b[d];return c};a.ti=function(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?new Float32Array(a[c]):a[c]instanceof Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof Array?a[c].slice(0):a[c]:a[c];return b};a.dc=function(a){return"MESH"===a.type?!0:!1};
a.Ao=function(a){return"MESH"===a.type&&a.d&&"DYNAMIC"===a.d.type?!0:!1};a.pd=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));x.fromMat4(a,K);var c=K[0],d=K[3],e=K[6],f=K[1],g=K[4],h=K[7],k=K[2],l=K[5],n=K[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+g*g+h*h)||1,k=Math.sqrt(k*k+l*l+n*n)||1;K[0]/=c;K[3]/=c;K[6]/=c;K[1]/=f;K[4]/=f;K[7]/=f;K[2]/=k;K[5]/=k;K[8]/=k;v.fromMat3(K,b);return b};a.gf=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];
b[1]=a[13];b[2]=a[14];return b};a.Xi=function(a){B[0]=.577350269189626;B[1]=.577350269189626;B[2]=.577350269189626;B[3]=0;q.transformMat4(B,a,B);return q.length(B)};a.Gn=function(a,b){var c=b.left,d=b.right,e=b.top,f=b.bottom,g=b.Ca,k=b.Ha;c[0]=a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-a[8];d[3]=a[15]-a[12];e[0]=a[3]-a[1];e[1]=a[7]-a[5];e[2]=a[11]-a[9];e[3]=a[15]-a[13];f[0]=a[3]+a[1];f[1]=a[7]+a[5];f[2]=a[11]+a[9];f[3]=a[15]+a[13];g[0]=a[3]+
a[2];g[1]=a[7]+a[6];g[2]=a[11]+a[10];g[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];h(c);h(d);h(e);h(f);h(g);h(k)};a.mx=function(a,b,c){return c<-d(a,b.left)||c<-d(a,b.right)||c<-d(a,b.top)||c<-d(a,b.bottom)||c<-d(a,b.Ca)||c<-d(a,b.Ha)?!0:!1};a.hu=function(a,b,c,e,f){g=F.dot(c,b.Ha);h=F.dot(e,b.Ha);k=F.dot(f,b.Ha);g=Math.sqrt(g*g+h*h+k*k);if(g<-d(a,b.Ca)||g<-d(a,b.Ha))return!0;var g=F.dot(c,b.left),h=F.dot(e,b.left),k=F.dot(f,b.left);if(Math.sqrt(g*g+h*h+k*k)<-d(a,
b.left))return!0;g=F.dot(c,b.right);h=F.dot(e,b.right);k=F.dot(f,b.right);if(Math.sqrt(g*g+h*h+k*k)<-d(a,b.right))return!0;g=F.dot(c,b.top);h=F.dot(e,b.top);k=F.dot(f,b.top);if(Math.sqrt(g*g+h*h+k*k)<-d(a,b.top))return!0;g=F.dot(c,b.bottom);h=F.dot(e,b.bottom);k=F.dot(f,b.bottom);return Math.sqrt(g*g+h*h+k*k)<-d(a,b.bottom)?!0:!1};a.rf=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*k+b[13];c[d+
f+2]=b[2]*g+b[6]*h+b[10]*k+b[14]}};a.iy=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k}};a.Hx=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k;c[d+f+3]=a[f+3]}};a.gy=function(a,b,c){c||(c=new Float32Array(3));B[0]=a[0];B[1]=a[1];B[2]=a[2];B[3]=0;q.transformMat4(B,
b,B);c[0]=B[0];c[1]=B[1];c[2]=B[2]};a.vz=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.hy=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.mi=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.mi(b,c,d,f-1):b[f]<c?a.mi(b,
c,f+1,e):f};a.Gd=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.ui=function(a,b){for(var c=0;c<a.length;c++)if(1E-7<Math.abs(a[c]-b[c]))return!1;return!0};a.Dw=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.Wl=function(a,b,c,d){d||(d=new Float32Array(16));b=A.fromRotationTranslation(b,c,N);A.multiply(b,a,d)};a.Th=function(a,b,c,d,e){e||(e=new Float32Array(3));b=A.fromRotationTranslation(c,
d,N);F.transformMat4(a,b,e);return e};a.Xl=function(a,b,c,d){d||(d=new Float32Array(4));b=A.fromRotationTranslation(b,c,N);q.transformMat4(a,b,d)};a.Xz=function(a,b,c,d,e){e||(e=new Float32Array(3));b=A.fromRotationTranslation(c,d,N);A.invert(b,b);F.transformMat4(a,b,e);return e};a.HA=function(a,b,c){c||(c=new Float32Array(16));A.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.oA=function(b,c,d){a.gf(b,c);c[3]=a.Xi(b);a.matrix_to_quat(b,d)};a.Fm=function(a){for(var b=[],
c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.Fp=function(a,b,c,d){d||(d=new Float32Array(3));F.subtract(b,a,y);F.transformQuat(y,c,y);F.subtract(b,y,d)};a.Cu=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16),g=new Float32Array(16);A.lookAt(a,[-1,0,0],[0,-1,0],b);A.scale(b,[-1,1,1],b);A.scale(b,[-1,1,-1],c);A.lookAt(a,[0,0,-1],[0,-1,0],d);A.scale(d,[-1,1,1],d);A.scale(d,[-1,1,
-1],e);A.lookAt(a,[0,-1,0],[0,0,-1],g);A.scale(g,[1,1,-1],g);A.scale(g,[-1,-1,-1],f);return[f,g,b,c,d,e]};a.ri=function(a,b){return l(a,b)};a.hash_code=l;a.Rz=g;a.nA=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,k,l,n,p,q,s,r,t,C;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];h=a[2];k=a[3];l=a[4];n=a[5];p=a[6];q=a[7];s=a[8];r=a[9];t=a[10];C=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=
k;c[4]=l;c[5]=n;c[6]=p;c[7]=q;c[8]=s;c[9]=r;c[10]=t;c[11]=C;c[12]=f*d+l*e+s*b+a[12];c[13]=g*d+n*e+r*b+a[13];c[14]=h*d+p*e+t*b+a[14];c[15]=k*d+q*e+C*b+a[15];return c};a.Pv=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):
(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.ow=function(a){return a*Math.PI/180};a.kz=function(a){return 180*a/Math.PI};a.Kl=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),f=.211324865405187*c+.211324865405187*d,b=a[0]-c+f;a=a[1]-d+f;var g=b>a?1:0,h=1-g,f=b+.211324865405187-g,k=a+.211324865405187-h,l=b+-.577350269189626,p=a+-.577350269189626,c=c%289,d=d%289,q=e(e(d)+c),h=e(e(d+
h)+c+g),s=e(e(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(f*f+k*k),0),g=Math.max(.5-(l*l+p*p),0),r=2*n(.024390243902439*q)-1,t=2*n(.024390243902439*h)-1,C=2*n(.024390243902439*s)-1,q=Math.abs(r)-.5,h=Math.abs(t)-.5,s=Math.abs(C)-.5,r=r-Math.floor(r+.5),t=t-Math.floor(t+.5),C=C-Math.floor(C+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(r*r+q*q)),d=d*d*d*d*(1.79284291400159-.85373472095314*(t*t+h*h)),g=g*g*g*g*(1.79284291400159-.85373472095314*(C*C+s*s));return 130*(c*(r*b+q*a)+d*(t*f+h*
k)+g*(C*l+s*p))};a.$m=function(a){var b=1/7,c=b/2,d=f(Math.floor(a[0])),e=f(Math.floor(a[1])),g=n(a[0]);a=n(a[1]);var h=g-.5,k=g-1.5,g=a-.5;a-=1.5;var l=z(d),p=z(d+1),q=l,d=p,l=z(l+e),p=z(p+e),q=z(q+e+1),d=z(d+e+1),e=h+.7*(t(l)*b+c),r=k+.7*(t(p)*b+c),h=h+.7*(t(q)*b+c),k=k+.7*(t(d)*b+c),l=g+.7*(t(Math.floor(l*b))*b+c),g=g+.7*(t(Math.floor(p*b))*b+c),q=a+.7*(t(Math.floor(q*b))*b+c),b=a+.7*(t(Math.floor(d*b))*b+c);return Math.min(e*e+l*l,r*r+g*g,h*h+q*q,k*k+b*b)};a.quat_project=function(a,b,c,d,e){e||
(e=new Float32Array(4));a=F.transformQuat(b,a,y);b=c[0];var f=c[1];c=c[2];K[0]=f*f+c*c;K[1]=-f*b;K[2]=-c*b;K[3]=-b*f;K[4]=b*b+c*c;K[5]=-c*f;K[6]=-b*c;K[7]=-f*c;K[8]=b*b+f*f;F.transformMat3(a,K,a);F.normalize(a,a);v.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=B,d=G,c=v.setAxisAngle([0,1,0],Math.PI,v.create()),d=v.setAxisAngle([1,0,0],Math.PI/2,v.create());v.multiply(c,d,c);v.multiply(a,c,b);return b};a.cleanup=function(){L=0;I={}};a.clamp=function(a,
b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.Sp=function(a,b,c,d,e){e||(e=new Float32Array(a.length));v.slerp(a,b,Math.exp(-c/d),e)};a.Yz=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof
ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=x.fromQuat(a,K);C[0]=0;C[1]=1;C[2]=0;y[0]=c[3];y[1]=c[4];y[2]=c[5];var d=F.cross(C,y,y);F.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);C[0]=c[0];C[1]=c[1];C[2]=c[2];F.normalize(C,C);v.rotationTo(C,d,G);v.multiply(G,a,a)};a.Rn=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],k=a[e*b+Math.min(c+1,g)],l=a[Math.min(e+
1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+k*d)*(1-f)+(l*(1-d)+a*d)*f};a.tf=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.Dp=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.Ph=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.zu=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.Sf=function(a){var b=0,c;
for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];F.normalize(c,c)};a.IA=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var k=g*a-h*e,l=h*d-f*a,n=f*e-g*d,p=g*n-h*l,h=h*k-f*n,f=f*l-g*k;c[0]=d+2*k*b+2*p;c[1]=e+2*l*b+2*h;c[2]=a+2*n*b+2*f;return c};a.ba=function(a){a&&p.error.apply(p,
arguments);throw"panic: see above for possible error messages";};a.ze=function(a){return a-2*Math.floor(a/(2*Math.PI))*Math.PI};a.Un=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.cq=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=s(e,f)}if(!d)return!1}return!0};a.nw=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.yu=function(a){a+=1;132651<a&&p.error("Color ID pool depleted");
var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return[b/51,c/51,a%51/51]};a.line_plane_intersect=function(a,b,c,d,e){B.set(a);B[3]=b;G.set(d);G[3]=0;a=q.dot(B,G);if(0==a)return null;G.set(c);G[3]=1;a=-q.dot(B,G)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.ez=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.Hp=function(a,b,c){var d=F.dot(a,b);-.9999999>d?(F.cross(Y,a,y),1E-6>F.length(y)&&F.cross(P,a,y),F.normalize(y,y),v.setAxisAngle(y,Math.PI,c)):(F.cross(a,
b,y),c.set(y),c[3]=1+d,v.normalize(c,c));return c}};b4w.module.__sfx=function(a,m){function b(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;f.warn("B4W warning: deprecated WebAudio implementation");return null}f.warn("B4W warning: WebAudio is not supported");return null}function c(a,b,c){var e=a.g;if("NONE"!=e.behavior){c||(c=0);var f=e.loop,g=e.pitch;if(e.src&&(f||0<=c)){e.ak=Math.floor(5E4*Math.random());b=x.currentTime+b;e.Sb=b;e.state=20;var h=a.g;if(!h.Ib){var q=a.d.e,s=a.d.quat;if(r.aj){var m=x.createBiquadFilter();
m.type="peaking"}else m=null;var z=x.createGain();switch(h.behavior){case "POSITIONAL":var v=x.createPanner();v.panningModel=v.EQUALPOWER;v.distanceModel=v.INVERSE_DISTANCE;v.setPosition(q[0],q[1],q[2]);h.al.set(q);var y=p;t.quat_to_dir(s,t.AXIS_MY,y);v.setOrientation(y[0],y[1],y[2]);h.direction.set(y);v.refDistance=h.dist_ref;v.maxDistance=h.dist_max;v.rolloffFactor=h.attenuation;v.coneInnerAngle=h.dt;v.coneOuterAngle=h.et;v.coneOuterGain=h.ft;y=x.createGain();y.gain.value=n(h);m?(v.connect(m),m.connect(y)):
v.connect(y);y.connect(z);h.Ib=v;if(h.Mg){var F=x.createGain();z.connect(F);F.connect(x?A.g.Ib:null)}else F=null,z.connect(x?A.g.Ib:null);break;case "BACKGROUND_SOUND":v=null;y=x.createGain();y.gain.value=n(h);m?(h.Ib=m,m.connect(y)):h.Ib=y;y.connect(z);h.Mg?(F=x.createGain(),z.connect(F),F.connect(x?A.g.Ib:null)):(F=null,z.connect(x?A.g.Ib:null));break;case "BACKGROUND_MUSIC":F=v=null,y=x.createGain(),y.gain.value=n(h),m?(h.Ib=m,m.connect(y)):h.Ib=y,y.connect(z),z.connect(x?A.g.Ib:null)}h.Bh=v;h.Dc=
m;h.Rf=y;h.Qe=z;h.xp=F}if("POSITIONAL"==e.behavior||"BACKGROUND_SOUND"==e.behavior)a=x.createBufferSource(),a.buffer=e.src,a.playbackRate.value=g,f?(e.Qa&&e.Qa.disconnect(),a.loop=!0,a.start(b),e.duration=0):(f=a.buffer?a.buffer.duration:0,c>f?(f=b+c+e.gd,a.loop=!0,a.start(b),a.stop(f),e.duration=c):(a.loop=!1,a.start(b),e.duration=f)),a.connect(e.Ib),e.Qa=a,d(e),l(e);else if("BACKGROUND_MUSIC"==e.behavior){window.clearTimeout(e.Nm);c=a.g;if(f=c.src)f.volume=1,f.loop=c.cyclic,c.Qa=c.Qa||x.createMediaElementSource(f),
c.Qa.connect(c.Ib),20==c.state&&f.play();e.duration=1E6}k(e,b)}}}function h(a){var b=a.g,d=b.duration,b=b.delay+b.Xt*Math.random();c(a,b,d)}function d(a){a.Mg&&a.xp.gain.cancelScheduledValues(a.Sb);a.Gh&&a.Qa.playbackRate.cancelScheduledValues(a.Sb);a.Xh=a.Sb}function l(a){if(a.Mg||a.Gh){var b=a.xp,c=a.Qa,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Sb;I[0]=a.ak;for(var f=0;5>f;){var g=a.pitch+a.Gh*t.gc(I);if(e>=a.Xh){if(a.Mg){var h=1-t.clamp(a.Mg,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.Gh&&
c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.Xh=e-.001}}}function k(a,b){if(a.Gk||a.gd){var c=a.Qe;c.gain.cancelScheduledValues(b);a.Gk?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.Gk)):c.gain.setValueAtTime(1,b);a.gd&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.gd))}}function g(a){if("SPEAKER"!=a.type)throw"Wrong object type";a=a.g;if(20==a.state||40==a.state){var b=a.Qe,c=x.currentTime;a.gd&&(b.gain.setValueAtTime(b.gain.value,
c),b.gain.linearRampToValueAtTime(0,c+a.gd));if("BACKGROUND_MUSIC"==a.behavior){var d=a.src;d&&(a.Nm=window.setTimeout(function(){d.currentTime&&(d.currentTime=0);d.pause()},1E3*a.gd))}else b=a.Qa,a.duration<b.buffer.duration?a.gd&&20==a.state?b.stop(c+a.gd):20==a.state&&(b.stop(0),b.disconnect()):b.disconnect(),a.Sb=0,a.rl=0,a.ik=0;a.state=30}}function e(a){return!a.g||20!=a.g.state&&40!=a.g.state&&30!=a.g.state?!1:!0}function n(a){return a.muted?0:a.volume}var z=m("__config"),f=m("__print"),t=m("__util"),
s=m("vec3"),r=z.lg;a.hm=10;a.Oj=20;a.gm=30;var p=new Float32Array(3),F=new Float32Array(3),q=new Float32Array(3),v=[],x=null,A=null,L=[],I=[1],y=null;a.init=function(){var a=document.createElement("audio");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&v.push("ogg"),""!=a.canPlayType("audio/mpeg")&&v.push("mp3"),""!=a.canPlayType("audio/mp4")&&v.push("mp4"));(x=r.oy?b():null)&&f.log("%cINIT WEBAUDIO: "+x.sampleRate+"Hz","color: #00a")};a.Im=function(a){var b={df:new Float32Array(3),Mo:new Float32Array(3),
$f:new Float32Array(3)};a.g=b;if(x){var c=x.createGain(),d=x.createGain();b.Rf=c;b.Qe=d;c.connect(d);d.connect(x.destination);if(a.b4w_enable_dynamic_compressor){var d=x.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.Zg=d;b.Ib=d}else b.Zg=null,b.Ib=c;c=x.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=
!1;b.volume=1;b.Pe=0}};a.Mw=function(a){A=a};a.Zt=function(a){a||(a="ogg");new Audio;return-1<v.indexOf(a)?a:"ogg"==a&&-1<v.indexOf("mp4")?"mp4":"mp3"==a&&-1<v.indexOf("ogg")?"ogg":"mp4"==a&&-1<v.indexOf("ogg")?"ogg":""};a.append_object=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.g={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.g.behavior=x?b.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var c=a.g,d;x?(window.MediaElementAudioSourceNode?d=
!0:(f.warn("B4W warning: MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.g.behavior="NONE");a.g.au=b.b4w_disable_doppler;a.g.muted=b.muted;a.g.volume=b.volume;a.g.pitch=b.pitch;a.g.attenuation=b.attenuation;a.g.dist_ref=b.distance_reference;a.g.dist_max=b.distance_max||1E4;a.g.dt=b.cone_angle_inner;a.g.et=b.cone_angle_outer;a.g.ft=b.cone_volume_outer;a.g.cyclic=b.b4w_cyclic_play;
a.g.loop=b.b4w_loop;a.g.delay=b.b4w_delay;a.g.Xt=b.b4w_delay_random;a.g.Mg=b.b4w_volume_random;a.g.Gh=b.b4w_pitch_random;a.g.Gk=b.b4w_fade_in;a.g.gd=b.b4w_fade_out;a.g.Sb=0;a.g.rl=0;a.g.ik=0;a.g.duration=0;a.g.Xh=0;a.g.ak=1;a.g.src=null;a.g.state=10;a.g.al=new Float32Array(3);a.g.direction=new Float32Array(3);a.g.Ll=new Float32Array(3);a.g.Nm=null;a.g.Pe=0;L.push(a)};a.Tp=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.g.behavior){case "POSITIONAL":return a.Oj;case "BACKGROUND_SOUND":return a.Oj;
case "BACKGROUND_MUSIC":return a.gm;case "NONE":return a.hm;default:throw"Wrong speaker behavior";}};a.$x=function(a,b){if("SPEAKER"!=a.type)throw"Wrong object type";var c=a.g;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.Tt=function(a,b,c){x?x.decodeAudioData(a,b,c):c()};a.kx=function(a){g(a);delete a.g;L.splice(L.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<L.length;a++){var b=
L[a].g;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.Qa&&b.Qa.disconnect()}A&&A.g&&(a=A.g,a.df[0]=0,a.df[1]=0,a.df[2]=0,a.$f[0]=0,a.$f[1]=0,a.$f[2]=0);A=null;L.splice(0);y=null};a.update=function(a){if(x&&0!=L.length){for(var b=0;b<L.length;b++){var c=L[b],d=c.g,e=x.currentTime;!d.loop&&d.cyclic&&20==d.state&&d.duration&&x&&d.Sb+d.duration<e&&h(c);20==d.state&&3>d.Xh-e&&l(d)}y&&(-1==y.wa||a>y.zm+y.Dn[y.wa])&&(b=y,-1<b.wa&&g(b.he[b.wa]),-1==b.wa&&b.random?c=Math.round(Math.random()*(b.he.length-
1)):b.random?(c=1+Math.round(Math.random()*(b.he.length-2)),c=(b.wa+c)%b.he.length):c=(b.wa+1)%b.he.length,h(b.he[c]),b.wa=c,b.zm=a)}};a.play=c;a.play_def=h;a.stop=g;a.is_play=function(a){return 20==a.g.state};a.playrate=function(a,b){var c=a.g;c.pitch=b;!e(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.Qa.playbackRate.value=b,d(c),l(c))};a.Lz=function(a){return a.g.pitch};a.cyclic=function(a,b){a.g.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.g.cyclic};a.Kv=function(a,b,
c,d){if(x&&a.g){var e=p;e[0]=0;e[1]=-1;e[2]=0;s.transformQuat(e,c,e);F[0]=0;F[1]=0;F[2]=-1;s.transformQuat(F,c,F);c=x.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],F[0],F[1],F[2]);a.g.Mo.set(e);d&&(q[0]=(b[0]-a.g.df[0])/d,q[1]=(b[1]-a.g.df[1])/d,q[2]=(b[2]-a.g.df[2])/d,t.smooth_v(q,a.g.$f,d,.3,q),c.setVelocity(q[0],q[1],q[2]),a.g.$f.set(q));a.g.df.set(b)}};a.listener_reset_speed=function(a,b){if(x&&A.g){var c=p;b?c.set(b):c.set(A.g.Mo);s.scale(c,a,c);x.listener.setVelocity(c[0],
c[1],c[2]);A.g.$f.set(c)}};a.lx=function(a,b){var c=a.g;if(e(a)&&"POSITIONAL"==c.behavior){var d=a.d.e,f=c.Bh;f.setPosition(d[0],d[1],d[2]);var g=p;t.quat_to_dir(a.d.quat,t.AXIS_MY,g);f.setOrientation(g[0],g[1],g[2]);g=c.al;!c.au&&b&&(F[0]=(d[0]-g[0])/b,F[1]=(d[1]-g[1])/b,F[2]=(d[2]-g[2])/b,t.smooth_v(F,c.Ll,b,.3,F),f.setVelocity(F[0],F[1],F[2]),c.Ll.set(F));g.set(d)}};a.speaker_reset_speed=function(a,b,c){var d=a.g;if(e(a)&&"POSITIONAL"==d.behavior){var f=p;c?f.set(c):f.set(d.direction);s.scale(f,
b,f);d.Bh.setVelocity(f[0],f[1],f[2]);d.Ll.set(f);d.al.set(a.d.e)}};a.Sd=function(a){return a.g?!0:!1};a.co=function(a){return a.g.behavior};a.Sw=function(a){var b=A.g;b&&(b.volume=a,x&&(b.Rf.gain.value=n(b)))};a.Zu=function(){var a=A.g;return a?a.volume:0};a.set_volume=function(a,b){var c=a.g;c.volume=b;e(a)&&(c.Rf.gain.value=n(c))};a.get_volume=function(a){return a.g.volume};a.mute=function(a,b){a.g.muted=Boolean(b);e(a)&&(a.g.Rf.gain.value=n(a.g))};a.is_muted=function(a){return a.g.muted};a.Yv=
function(a){var b=A.g;b&&(b.muted=Boolean(a),x&&(b.Rf.gain.value=n(b)))};a.Gv=function(){var a=A.g;return a?a.muted:!1};a.get_speaker_objects=function(){return L};a.pause=function(){for(var a=0;a<L.length;a++){var b=L[a].g;if(20==b.state){if("BACKGROUND_MUSIC"==b.behavior){var c=b.src;c&&c.pause()}else{var e=x.currentTime;b.rl=e;if(e>b.Sb){c=b;I[0]=c.ak;for(var f=c.Qa.buffer.duration,g=c.Sb,h=void 0;g<e;)h=c.pitch+c.Gh*t.gc(I),g+=f/h;c=(f/h-(g-e))*h}else c=0;b.ik=c;b.Qa.stop(0);b.Qa.disconnect();
d(b)}b.state=40}}};a.resume=function(){for(var a=0;a<L.length;a++){var b=L[a],c=b.g;if(40==c.state){if("BACKGROUND_MUSIC"==c.behavior)c.src.play();else{var b=b.g,d=x.createBufferSource();d.loop=b.Qa.loop;d.buffer=b.Qa.buffer;d.playbackRate.value=b.Qa.playbackRate.value;b.Bh?d.connect(b.Bh):d.connect(b.Rf);b.Qa=d;b=x.currentTime;c.Sb+=b-c.rl;c.Xh=b;c.Qa.start(c.Sb,c.ik);l(c);k(c,c.Sb)}c.state=20}}};a.set_compressor_params=function(a,b){if(a.g&&a.g.Zg){var c=a.g.Zg;c.threshold.value=b.threshold;c.knee.value=
b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.g||!a.g.Zg)return null;a=a.g.Zg;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(e(a)){a=a.g;var d=a.Qe,f=x.currentTime;d.gain.setValueAtTime(d.gain.value,f);d.gain.linearRampToValueAtTime(b,f+c);a.Pe=c}};a.unduck=function(a){if(e(a)){a=a.g;var b=a.Qe,c=x.currentTime;b.gain.setValueAtTime(b.gain.value,
c);b.gain.linearRampToValueAtTime(1,c+a.Pe);a.Pe=0}};a.cu=function(a,b){if(x){var c=A.g,d=c.Qe,e=x.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.Pe=b}};a.Ox=function(){if(x){var a=A.g,b=a.Qe,c=x.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Pe);a.Pe=0}};a.apply_playlist=function(a,b,c){y={wa:-1,zm:0,random:c,he:[],Dn:[]};for(c=0;c<a.length;c++){var d=a[c];g(d);y.he.push(d);d=d.g;d=(d=d.src)?d.duration:0;y.Dn.push(d+
b)}};a.clear_playlist=function(){if(y)for(var a=y.he,b=0;b<a.length;b++)g(a[b]);y=null};a.get_positional_params=function(a){return(a=a.g)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.g;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.Bh;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=
function(a,b){var c=a.g;c&&c.Dc&&(c.Dc.frequency.value=b.freq,c.Dc.Q.value=b.Q,c.Dc.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.g)&&a.Dc?{freq:a.Dc.frequency.value,Q:a.Dc.Q.value,gain:a.Dc.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.g;if(!a||!a.Dc)return null;a.Dc.getFrequencyResponse(b,c,d)}};b4w.module.vec3=function(a){var m="undefined"!==typeof Float32Array?Float32Array:Array,b=Math.random;a.create=function(){var a=new m(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var b=new m(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.fromValues=function(a,b,d){var l=new m(3);l[0]=a;l[1]=b;l[2]=d;return l};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set=function(a,b,d,l){l[0]=a;l[1]=b;l[2]=d;return l};a.add=function(a,b,d){d[0]=a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];return d};
a.subtract=function(a,b,d){d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];return d};a.sub=a.subtract;a.multiply=function(a,b,d){d[0]=a[0]*b[0];d[1]=a[1]*b[1];d[2]=a[2]*b[2];return d};a.mul=a.multiply;a.divide=function(a,b,d){d[0]=a[0]/b[0];d[1]=a[1]/b[1];d[2]=a[2]/b[2];return d};a.div=a.divide;a.min=function(a,b,d){d[0]=Math.min(a[0],b[0]);d[1]=Math.min(a[1],b[1]);d[2]=Math.min(a[2],b[2]);return d};a.max=function(a,b,d){d[0]=Math.max(a[0],b[0]);d[1]=Math.max(a[1],b[1]);d[2]=Math.max(a[2],b[2]);return d};
a.scale=function(a,b,d){d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;return d};a.scaleAndAdd=function(a,b,d,l){l[0]=a[0]+b[0]*d;l[1]=a[1]+b[1]*d;l[2]=a[2]+b[2]*d;return l};a.distance=function(a,b){var d=b[0]-a[0],l=b[1]-a[1],k=b[2]-a[2];return Math.sqrt(d*d+l*l+k*k)};a.dist=a.distance;a.squaredDistance=function(a,b){var d=b[0]-a[0],l=b[1]-a[1],k=b[2]-a[2];return d*d+l*l+k*k};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],d=a[1];a=a[2];return Math.sqrt(b*b+d*d+a*a)};a.len=a.length;a.squaredLength=
function(a){var b=a[0],d=a[1];a=a[2];return b*b+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];return b};a.normalize=function(a,b){var d=a[0],l=a[1],k=a[2],d=d*d+l*l+k*k;0<d&&(d=1/Math.sqrt(d),b[0]=a[0]*d,b[1]=a[1]*d,b[2]=a[2]*d);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};a.cross=function(a,b,d){var l=a[0],k=a[1];a=a[2];var g=b[0],e=b[1];b=b[2];d[0]=k*b-a*e;d[1]=
a*g-l*b;d[2]=l*e-k*g;return d};a.lerp=function(a,b,d,l){var k=a[0],g=a[1];a=a[2];l[0]=k+d*(b[0]-k);l[1]=g+d*(b[1]-g);l[2]=a+d*(b[2]-a);return l};a.random=function(a,h){a=a||1;var d=2*b()*Math.PI,l=2*b()-1,k=Math.sqrt(1-l*l)*a;h[0]=Math.cos(d)*k;h[1]=Math.sin(d)*k;h[2]=l*a;return h};a.transformMat4=function(a,b,d){var l=a[0],k=a[1];a=a[2];var g=b[3]*l+b[7]*k+b[11]*a+b[15],g=g||1;d[0]=(b[0]*l+b[4]*k+b[8]*a+b[12])/g;d[1]=(b[1]*l+b[5]*k+b[9]*a+b[13])/g;d[2]=(b[2]*l+b[6]*k+b[10]*a+b[14])/g;return d};a.transformMat3=
function(a,b,d){var l=a[0],k=a[1];a=a[2];d[0]=l*b[0]+k*b[3]+a*b[6];d[1]=l*b[1]+k*b[4]+a*b[7];d[2]=l*b[2]+k*b[5]+a*b[8];return d};a.transformQuat=function(a,b,d){var l=a[0],k=a[1],g=a[2];a=b[0];var e=b[1],n=b[2];b=b[3];var m=b*l+e*g-n*k,f=b*k+n*l-a*g,t=b*g+a*k-e*l,l=-a*l-e*k-n*g;d[0]=m*b+l*-a+f*-n-t*-e;d[1]=f*b+l*-e+t*-a-m*-n;d[2]=t*b+l*-n+m*-e-f*-a;return d};a.rotateX=function(a,b,d,l){var k=[],g=[];k[0]=a[0]-b[0];k[1]=a[1]-b[1];k[2]=a[2]-b[2];g[0]=k[0];g[1]=k[1]*Math.cos(d)-k[2]*Math.sin(d);g[2]=
k[1]*Math.sin(d)+k[2]*Math.cos(d);l[0]=g[0]+b[0];l[1]=g[1]+b[1];l[2]=g[2]+b[2];return l};a.rotateY=function(a,b,d,l){var k=[],g=[];k[0]=a[0]-b[0];k[1]=a[1]-b[1];k[2]=a[2]-b[2];g[0]=k[2]*Math.sin(d)+k[0]*Math.cos(d);g[1]=k[1];g[2]=k[2]*Math.cos(d)-k[0]*Math.sin(d);l[0]=g[0]+b[0];l[1]=g[1]+b[1];l[2]=g[2]+b[2];return l};a.rotateZ=function(a,b,d,l){var k=[],g=[];k[0]=a[0]-b[0];k[1]=a[1]-b[1];k[2]=a[2]-b[2];g[0]=k[0]*Math.cos(d)-k[1]*Math.sin(d);g[1]=k[0]*Math.sin(d)+k[1]*Math.cos(d);g[2]=k[2];l[0]=g[0]+
b[0];l[1]=g[1]+b[1];l[2]=g[2]+b[2];return l};a.forEach=function(){var b=a.create();return function(a,d,l,k,g,e){d||(d=3);l||(l=0);for(k=k?Math.min(k*d+l,a.length):a.length;l<k;l+=d)b[0]=a[l],b[1]=a[l+1],b[2]=a[l+2],g(b,e,b),a[l]=b[0],a[l+1]=b[1],a[l+2]=b[2];return a}}();a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a){var m="undefined"!==typeof Float32Array?Float32Array:Array,b=Math.random;a.create=function(){var a=new m(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var b=new m(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=function(a,b,d,l){var k=new m(4);k[0]=a;k[1]=b;k[2]=d;k[3]=l;return k};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set=function(a,b,d,l,k){k[0]=a;k[1]=b;k[2]=d;k[3]=l;return k};a.add=function(a,b,d){d[0]=
a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];d[3]=a[3]+b[3];return d};a.subtract=function(a,b,d){d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];d[3]=a[3]-b[3];return d};a.sub=a.subtract;a.multiply=function(a,b,d){d[0]=a[0]*b[0];d[1]=a[1]*b[1];d[2]=a[2]*b[2];d[3]=a[3]*b[3];return d};a.mul=a.multiply;a.divide=function(a,b,d){d[0]=a[0]/b[0];d[1]=a[1]/b[1];d[2]=a[2]/b[2];d[3]=a[3]/b[3];return d};a.div=a.divide;a.min=function(a,b,d){d[0]=Math.min(a[0],b[0]);d[1]=Math.min(a[1],b[1]);d[2]=Math.min(a[2],b[2]);d[3]=
Math.min(a[3],b[3]);return d};a.max=function(a,b,d){d[0]=Math.max(a[0],b[0]);d[1]=Math.max(a[1],b[1]);d[2]=Math.max(a[2],b[2]);d[3]=Math.max(a[3],b[3]);return d};a.scale=function(a,b,d){d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;d[3]=a[3]*b;return d};a.scaleAndAdd=function(a,b,d,l){l[0]=a[0]+b[0]*d;l[1]=a[1]+b[1]*d;l[2]=a[2]+b[2]*d;l[3]=a[3]+b[3]*d;return l};a.distance=function(a,b){var d=b[0]-a[0],l=b[1]-a[1],k=b[2]-a[2],g=b[3]-a[3];return Math.sqrt(d*d+l*l+k*k+g*g)};a.dist=a.distance;a.squaredDistance=
function(a,b){var d=b[0]-a[0],l=b[1]-a[1],k=b[2]-a[2],g=b[3]-a[3];return d*d+l*l+k*k+g*g};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],d=a[1],l=a[2];a=a[3];return Math.sqrt(b*b+d*d+l*l+a*a)};a.len=a.length;a.squaredLength=function(a){var b=a[0],d=a[1],l=a[2];a=a[3];return b*b+d*d+l*l+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];b[3]=1/a[3];return b};a.normalize=
function(a,b){var d=a[0],l=a[1],k=a[2],g=a[3],d=d*d+l*l+k*k+g*g;0<d&&(d=1/Math.sqrt(d),b[0]=a[0]*d,b[1]=a[1]*d,b[2]=a[2]*d,b[3]=a[3]*d);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};a.lerp=function(a,b,d,l){var k=a[0],g=a[1],e=a[2];a=a[3];l[0]=k+d*(b[0]-k);l[1]=g+d*(b[1]-g);l[2]=e+d*(b[2]-e);l[3]=a+d*(b[3]-a);return l};a.random=function(c,h){c=c||1;h[0]=b();h[1]=b();h[2]=b();h[3]=b();a.normalize(h,h);a.scale(h,c,h);return h};a.transformMat4=function(a,b,d){var l=a[0],
k=a[1],g=a[2];a=a[3];d[0]=b[0]*l+b[4]*k+b[8]*g+b[12]*a;d[1]=b[1]*l+b[5]*k+b[9]*g+b[13]*a;d[2]=b[2]*l+b[6]*k+b[10]*g+b[14]*a;d[3]=b[3]*l+b[7]*k+b[11]*g+b[15]*a;return d};a.transformQuat=function(a,b,d){var l=a[0],k=a[1],g=a[2];a=b[0];var e=b[1],n=b[2];b=b[3];var m=b*l+e*g-n*k,f=b*k+n*l-a*g,t=b*g+a*k-e*l,l=-a*l-e*k-n*g;d[0]=m*b+l*-a+f*-n-t*-e;d[1]=f*b+l*-e+t*-a-m*-n;d[2]=t*b+l*-n+m*-e-f*-a;return d};a.forEach=function(){var b=a.create();return function(a,d,l,k,g,e){d||(d=4);l||(l=0);for(k=k?Math.min(k*
d+l,a.length):a.length;l<k;l+=d)b[0]=a[l],b[1]=a[l+1],b[2]=a[l+2],b[3]=a[l+3],g(b,e,b),a[l]=b[0],a[l+1]=b[1],a[l+2]=b[2],a[l+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,m){var b=m("vec3"),c=m("vec4"),h=m("mat3"),d="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new d(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var c=b.create(),d=b.fromValues(1,0,0),g=b.fromValues(0,1,0);return function(e,h,m){var f=b.dot(e,h);if(-.9999999>f)return b.cross(d,e,c),1E-6>b.length(c)&&b.cross(g,e,c),b.normalize(c,c),a.setAxisAngle(c,Math.PI,m),m;if(.9999999<f)return m[0]=0,m[1]=0,m[2]=0,m[3]=1,m;b.cross(e,
h,c);m[0]=c[0];m[1]=c[1];m[2]=c[2];m[3]=1+f;return a.normalize(m,m)}}();a.setAxes=function(){var b=h.create();return function(c,d,e,h){b[0]=d[0];b[3]=d[1];b[6]=d[2];b[1]=e[0];b[4]=e[1];b[7]=e[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,h),h)}}();a.clone=c.clone;a.fromValues=c.fromValues;a.copy=c.copy;a.set=c.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=c.add;a.multiply=function(a,b,c){var d=a[0],h=a[1],m=a[2];a=a[3];var f=b[0],t=b[1],s=b[2];b=b[3];c[0]=d*b+a*f+h*s-m*t;c[1]=h*b+a*t+m*f-d*s;c[2]=m*b+a*s+d*t-h*f;c[3]=a*b-d*f-h*t-m*s;return c};a.mul=a.multiply;a.scale=c.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],h=a[1],m=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*f;c[1]=h*b+m*f;c[2]=m*b-h*f;c[3]=a*b-d*f;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],h=a[1],m=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=d*
b-m*f;c[1]=h*b+a*f;c[2]=m*b+d*f;c[3]=a*b-h*f;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],h=a[1],m=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=d*b+h*f;c[1]=h*b-d*f;c[2]=m*b+a*f;c[3]=a*b-m*f;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],h=a[2];b[0]=c;b[1]=d;b[2]=h;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-h*h));return b};a.dot=c.dot;a.lerp=c.lerp;a.slerp=function(a,b,c,d){var h=a[0],m=a[1],f=a[2];a=a[3];var t=b[0],s=b[1],r=b[2];b=b[3];var p,F,q;F=h*t+m*s+f*r+a*b;0>F&&(F=-F,t=-t,s=-s,
r=-r,b=-b);1E-6<1-F?(p=Math.acos(F),q=Math.sin(p),F=Math.sin((1-c)*p)/q,c=Math.sin(c*p)/q):F=1-c;d[0]=F*h+c*t;d[1]=F*m+c*s;d[2]=F*f+c*r;d[3]=F*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],h=a[2],m=a[3],f=c*c+d*d+h*h+m*m,f=f?1/f:0;b[0]=-c*f;b[1]=-d*f;b[2]=-h*f;b[3]=m*f;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=c.length;a.len=a.length;a.squaredLength=c.squaredLength;a.sqrLen=a.squaredLength;a.normalize=c.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var h=(d+1)%3,m=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*h+h]-a[3*m+m]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*h+m]-a[3*m+h])*c;b[h]=(a[3*h+d]+a[3*d+h])*c;b[m]=(a[3*m+d]+a[3*d+m])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a){var m="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new m(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[4];c[4]=a[5];c[5]=a[6];c[6]=a[8];c[7]=a[9];c[8]=a[10];return c};a.clone=function(a){var c=new m(9);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=
a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,c){if(c===a){var h=a[1],d=a[2],l=a[5];c[1]=a[3];c[2]=a[6];c[3]=h;c[5]=a[7];c[6]=d;c[7]=l}else c[0]=a[0],c[1]=a[3],c[2]=a[6],c[3]=a[1],c[4]=a[4],c[5]=a[7],c[6]=a[2],c[7]=a[5],c[8]=a[8];return c};a.invert=function(a,c){var h=a[0],d=a[1],l=a[2],k=a[3],g=a[4],e=a[5],n=a[6],m=a[7],f=a[8],t=f*g-e*m,s=-f*k+e*n,r=
m*k-g*n,p=h*t+d*s+l*r;if(!p)return null;p=1/p;c[0]=t*p;c[1]=(-f*d+l*m)*p;c[2]=(e*d-l*g)*p;c[3]=s*p;c[4]=(f*h-l*n)*p;c[5]=(-e*h+l*k)*p;c[6]=r*p;c[7]=(-m*h+d*n)*p;c[8]=(g*h-d*k)*p;return c};a.adjoint=function(a,c){var h=a[0],d=a[1],l=a[2],k=a[3],g=a[4],e=a[5],n=a[6],m=a[7],f=a[8];c[0]=g*f-e*m;c[1]=l*m-d*f;c[2]=d*e-l*g;c[3]=e*n-k*f;c[4]=h*f-l*n;c[5]=l*k-h*e;c[6]=k*m-g*n;c[7]=d*n-h*m;c[8]=h*g-d*k;return c};a.determinant=function(a){var c=a[3],h=a[4],d=a[5],l=a[6],k=a[7],g=a[8];return a[0]*(g*h-d*k)+a[1]*
(-g*c+d*l)+a[2]*(k*c-h*l)};a.multiply=function(a,c,h){var d=a[0],l=a[1],k=a[2],g=a[3],e=a[4],n=a[5],m=a[6],f=a[7];a=a[8];var t=c[0],s=c[1],r=c[2],p=c[3],F=c[4],q=c[5],v=c[6],x=c[7];c=c[8];h[0]=t*d+s*g+r*m;h[1]=t*l+s*e+r*f;h[2]=t*k+s*n+r*a;h[3]=p*d+F*g+q*m;h[4]=p*l+F*e+q*f;h[5]=p*k+F*n+q*a;h[6]=v*d+x*g+c*m;h[7]=v*l+x*e+c*f;h[8]=v*k+x*n+c*a;return h};a.mul=a.multiply;a.translate=function(a,c,h){var d=a[0],l=a[1],k=a[2],g=a[3],e=a[4],n=a[5],m=a[6],f=a[7];a=a[8];var t=c[0];c=c[1];h[0]=d;h[1]=l;h[2]=k;
h[3]=g;h[4]=e;h[5]=n;h[6]=t*d+c*g+m;h[7]=t*l+c*e+f;h[8]=t*k+c*n+a;return h};a.rotate=function(a,c,h){var d=a[0],l=a[1],k=a[2],g=a[3],e=a[4],n=a[5],m=a[6],f=a[7];a=a[8];var t=Math.sin(c);c=Math.cos(c);h[0]=c*d+t*g;h[1]=c*l+t*e;h[2]=c*k+t*n;h[3]=c*g-t*d;h[4]=c*e-t*l;h[5]=c*n-t*k;h[6]=m;h[7]=f;h[8]=a;return h};a.scale=function(a,c,h){var d=c[0];c=c[1];h[0]=d*a[0];h[1]=d*a[1];h[2]=d*a[2];h[3]=c*a[3];h[4]=c*a[4];h[5]=c*a[5];h[6]=a[6];h[7]=a[7];h[8]=a[8];return h};a.fromMat2d=function(a,c){c[0]=a[0];c[1]=
a[1];c[2]=0;c[3]=a[2];c[4]=a[3];c[5]=0;c[6]=a[4];c[7]=a[5];c[8]=1;return c};a.fromQuat=function(a,c){var h=a[0],d=a[1],l=a[2],k=a[3],g=h+h,e=d+d,n=l+l,h=h*g,m=d*g,d=d*e,f=l*g,t=l*e,l=l*n,g=k*g,e=k*e,k=k*n;c[0]=1-d-l;c[3]=m-k;c[6]=f+e;c[1]=m+k;c[4]=1-h-l;c[7]=t-g;c[2]=f-e;c[5]=t+g;c[8]=1-h-d;return c};a.normalFromMat4=function(a,c){var h=a[0],d=a[1],l=a[2],k=a[3],g=a[4],e=a[5],n=a[6],m=a[7],f=a[8],t=a[9],s=a[10],r=a[11],p=a[12],F=a[13],q=a[14],v=a[15],x=h*e-d*g,A=h*n-l*g,L=h*m-k*g,I=d*n-l*e,y=d*m-
k*e,C=l*m-k*n,B=f*F-t*p,G=f*q-s*p,f=f*v-r*p,K=t*q-s*F,t=t*v-r*F,s=s*v-r*q,r=x*s-A*t+L*K+I*f-y*G+C*B;if(!r)return null;r=1/r;c[0]=(e*s-n*t+m*K)*r;c[1]=(n*f-g*s-m*G)*r;c[2]=(g*t-e*f+m*B)*r;c[3]=(l*t-d*s-k*K)*r;c[4]=(h*s-l*f+k*G)*r;c[5]=(d*f-h*t-k*B)*r;c[6]=(F*C-q*y+v*I)*r;c[7]=(q*L-p*C-v*A)*r;c[8]=(p*y-F*L+v*x)*r;return c};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.wu=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],
2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a){var m="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new m(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var c=new m(16);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.copy=function(a,c){c[0]=a[0];c[1]=
a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,c){if(c===a){var h=a[1],d=a[2],l=a[3],k=a[6],g=a[7],e=a[11];c[1]=a[4];c[2]=a[8];c[3]=a[12];c[4]=h;c[6]=a[9];c[7]=a[13];c[8]=d;c[9]=k;c[11]=a[14];c[12]=l;c[13]=g;
c[14]=e}else c[0]=a[0],c[1]=a[4],c[2]=a[8],c[3]=a[12],c[4]=a[1],c[5]=a[5],c[6]=a[9],c[7]=a[13],c[8]=a[2],c[9]=a[6],c[10]=a[10],c[11]=a[14],c[12]=a[3],c[13]=a[7],c[14]=a[11],c[15]=a[15];return c};a.invert=function(a,c){var h=a[0],d=a[1],l=a[2],k=a[3],g=a[4],e=a[5],n=a[6],m=a[7],f=a[8],t=a[9],s=a[10],r=a[11],p=a[12],F=a[13],q=a[14],v=a[15],x=h*e-d*g,A=h*n-l*g,L=h*m-k*g,I=d*n-l*e,y=d*m-k*e,C=l*m-k*n,B=f*F-t*p,G=f*q-s*p,K=f*v-r*p,N=t*q-s*F,V=t*v-r*F,U=s*v-r*q,O=x*U-A*V+L*N+I*K-y*G+C*B;if(!O)return null;
O=1/O;c[0]=(e*U-n*V+m*N)*O;c[1]=(l*V-d*U-k*N)*O;c[2]=(F*C-q*y+v*I)*O;c[3]=(s*y-t*C-r*I)*O;c[4]=(n*K-g*U-m*G)*O;c[5]=(h*U-l*K+k*G)*O;c[6]=(q*L-p*C-v*A)*O;c[7]=(f*C-s*L+r*A)*O;c[8]=(g*V-e*K+m*B)*O;c[9]=(d*K-h*V-k*B)*O;c[10]=(p*y-F*L+v*x)*O;c[11]=(t*L-f*y-r*x)*O;c[12]=(e*G-g*N-n*B)*O;c[13]=(h*N-d*G+l*B)*O;c[14]=(F*A-p*I-q*x)*O;c[15]=(f*I-t*A+s*x)*O;return c};a.adjoint=function(a,c){var h=a[0],d=a[1],l=a[2],k=a[3],g=a[4],e=a[5],n=a[6],m=a[7],f=a[8],t=a[9],s=a[10],r=a[11],p=a[12],F=a[13],q=a[14],v=a[15];
c[0]=e*(s*v-r*q)-t*(n*v-m*q)+F*(n*r-m*s);c[1]=-(d*(s*v-r*q)-t*(l*v-k*q)+F*(l*r-k*s));c[2]=d*(n*v-m*q)-e*(l*v-k*q)+F*(l*m-k*n);c[3]=-(d*(n*r-m*s)-e*(l*r-k*s)+t*(l*m-k*n));c[4]=-(g*(s*v-r*q)-f*(n*v-m*q)+p*(n*r-m*s));c[5]=h*(s*v-r*q)-f*(l*v-k*q)+p*(l*r-k*s);c[6]=-(h*(n*v-m*q)-g*(l*v-k*q)+p*(l*m-k*n));c[7]=h*(n*r-m*s)-g*(l*r-k*s)+f*(l*m-k*n);c[8]=g*(t*v-r*F)-f*(e*v-m*F)+p*(e*r-m*t);c[9]=-(h*(t*v-r*F)-f*(d*v-k*F)+p*(d*r-k*t));c[10]=h*(e*v-m*F)-g*(d*v-k*F)+p*(d*m-k*e);c[11]=-(h*(e*r-m*t)-g*(d*r-k*t)+f*
(d*m-k*e));c[12]=-(g*(t*q-s*F)-f*(e*q-n*F)+p*(e*s-n*t));c[13]=h*(t*q-s*F)-f*(d*q-l*F)+p*(d*s-l*t);c[14]=-(h*(e*q-n*F)-g*(d*q-l*F)+p*(d*n-l*e));c[15]=h*(e*s-n*t)-g*(d*s-l*t)+f*(d*n-l*e);return c};a.determinant=function(a){var c=a[0],h=a[1],d=a[2],l=a[3],k=a[4],g=a[5],e=a[6],n=a[7],m=a[8],f=a[9],t=a[10],s=a[11],r=a[12],p=a[13],F=a[14];a=a[15];return(c*g-h*k)*(t*a-s*F)-(c*e-d*k)*(f*a-s*p)+(c*n-l*k)*(f*F-t*p)+(h*e-d*g)*(m*a-s*r)-(h*n-l*g)*(m*F-t*r)+(d*n-l*e)*(m*p-f*r)};a.multiply=function(a,c,h){var d=
a[0],l=a[1],k=a[2],g=a[3],e=a[4],n=a[5],m=a[6],f=a[7],t=a[8],s=a[9],r=a[10],p=a[11],F=a[12],q=a[13],v=a[14];a=a[15];var x=c[0],A=c[1],L=c[2],I=c[3];h[0]=x*d+A*e+L*t+I*F;h[1]=x*l+A*n+L*s+I*q;h[2]=x*k+A*m+L*r+I*v;h[3]=x*g+A*f+L*p+I*a;x=c[4];A=c[5];L=c[6];I=c[7];h[4]=x*d+A*e+L*t+I*F;h[5]=x*l+A*n+L*s+I*q;h[6]=x*k+A*m+L*r+I*v;h[7]=x*g+A*f+L*p+I*a;x=c[8];A=c[9];L=c[10];I=c[11];h[8]=x*d+A*e+L*t+I*F;h[9]=x*l+A*n+L*s+I*q;h[10]=x*k+A*m+L*r+I*v;h[11]=x*g+A*f+L*p+I*a;x=c[12];A=c[13];L=c[14];I=c[15];h[12]=x*d+
A*e+L*t+I*F;h[13]=x*l+A*n+L*s+I*q;h[14]=x*k+A*m+L*r+I*v;h[15]=x*g+A*f+L*p+I*a;return h};a.mul=a.multiply;a.translate=function(a,c,h){var d=c[0],l=c[1];c=c[2];var k,g,e,n,m,f,t,s,r,p,F,q;a===h?(h[12]=a[0]*d+a[4]*l+a[8]*c+a[12],h[13]=a[1]*d+a[5]*l+a[9]*c+a[13],h[14]=a[2]*d+a[6]*l+a[10]*c+a[14],h[15]=a[3]*d+a[7]*l+a[11]*c+a[15]):(k=a[0],g=a[1],e=a[2],n=a[3],m=a[4],f=a[5],t=a[6],s=a[7],r=a[8],p=a[9],F=a[10],q=a[11],h[0]=k,h[1]=g,h[2]=e,h[3]=n,h[4]=m,h[5]=f,h[6]=t,h[7]=s,h[8]=r,h[9]=p,h[10]=F,h[11]=q,
h[12]=k*d+m*l+r*c+a[12],h[13]=g*d+f*l+p*c+a[13],h[14]=e*d+t*l+F*c+a[14],h[15]=n*d+s*l+q*c+a[15]);return h};a.scale=function(a,c,h){var d=c[0],l=c[1];c=c[2];h[0]=a[0]*d;h[1]=a[1]*d;h[2]=a[2]*d;h[3]=a[3]*d;h[4]=a[4]*l;h[5]=a[5]*l;h[6]=a[6]*l;h[7]=a[7]*l;h[8]=a[8]*c;h[9]=a[9]*c;h[10]=a[10]*c;h[11]=a[11]*c;h[12]=a[12];h[13]=a[13];h[14]=a[14];h[15]=a[15];return h};a.rotate=function(a,c,h,d){var l=h[0],k=h[1];h=h[2];var g=Math.sqrt(l*l+k*k+h*h),e,n,m,f,t,s,r,p,F,q,v,x,A,L,I,y,C,B,G,K;if(1E-7>Math.abs(g))return null;
g=1/g;l*=g;k*=g;h*=g;e=Math.sin(c);n=Math.cos(c);m=1-n;c=a[0];g=a[1];f=a[2];t=a[3];s=a[4];r=a[5];p=a[6];F=a[7];q=a[8];v=a[9];x=a[10];A=a[11];L=l*l*m+n;I=k*l*m+h*e;y=h*l*m-k*e;C=l*k*m-h*e;B=k*k*m+n;G=h*k*m+l*e;K=l*h*m+k*e;l=k*h*m-l*e;k=h*h*m+n;d[0]=c*L+s*I+q*y;d[1]=g*L+r*I+v*y;d[2]=f*L+p*I+x*y;d[3]=t*L+F*I+A*y;d[4]=c*C+s*B+q*G;d[5]=g*C+r*B+v*G;d[6]=f*C+p*B+x*G;d[7]=t*C+F*B+A*G;d[8]=c*K+s*l+q*k;d[9]=g*K+r*l+v*k;d[10]=f*K+p*l+x*k;d[11]=t*K+F*l+A*k;a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);
return d};a.rotateX=function(a,c,h){var d=Math.sin(c);c=Math.cos(c);var l=a[4],k=a[5],g=a[6],e=a[7],n=a[8],m=a[9],f=a[10],t=a[11];a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[4]=l*c+n*d;h[5]=k*c+m*d;h[6]=g*c+f*d;h[7]=e*c+t*d;h[8]=n*c-l*d;h[9]=m*c-k*d;h[10]=f*c-g*d;h[11]=t*c-e*d;return h};a.rotateY=function(a,c,h){var d=Math.sin(c);c=Math.cos(c);var l=a[0],k=a[1],g=a[2],e=a[3],n=a[8],m=a[9],f=a[10],t=a[11];a!==h&&(h[4]=a[4],h[5]=a[5],h[6]=a[6],
h[7]=a[7],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[0]=l*c-n*d;h[1]=k*c-m*d;h[2]=g*c-f*d;h[3]=e*c-t*d;h[8]=l*d+n*c;h[9]=k*d+m*c;h[10]=g*d+f*c;h[11]=e*d+t*c;return h};a.rotateZ=function(a,c,h){var d=Math.sin(c);c=Math.cos(c);var l=a[0],k=a[1],g=a[2],e=a[3],n=a[4],m=a[5],f=a[6],t=a[7];a!==h&&(h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[0]=l*c+n*d;h[1]=k*c+m*d;h[2]=g*c+f*d;h[3]=e*c+t*d;h[4]=n*c-l*d;h[5]=m*c-k*d;h[6]=f*c-g*d;h[7]=t*c-e*d;return h};
a.fromRotationTranslation=function(a,c,h){var d=a[0],l=a[1],k=a[2],g=a[3],e=d+d,n=l+l,m=k+k;a=d*e;var f=d*n,d=d*m,t=l*n,l=l*m,k=k*m,e=g*e,n=g*n,g=g*m;h[0]=1-(t+k);h[1]=f+g;h[2]=d-n;h[3]=0;h[4]=f-g;h[5]=1-(a+k);h[6]=l+e;h[7]=0;h[8]=d+n;h[9]=l-e;h[10]=1-(a+t);h[11]=0;h[12]=c[0];h[13]=c[1];h[14]=c[2];h[15]=1;return h};a.fromQuat=function(a,c){var h=a[0],d=a[1],l=a[2],k=a[3],g=h+h,e=d+d,n=l+l,h=h*g,m=d*g,d=d*e,f=l*g,t=l*e,l=l*n,g=k*g,e=k*e,k=k*n;c[0]=1-d-l;c[1]=m+k;c[2]=f-e;c[3]=0;c[4]=m-k;c[5]=1-h-l;
c[6]=t+g;c[7]=0;c[8]=f+e;c[9]=t-g;c[10]=1-h-d;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.frustum=function(a,c,h,d,l,k,g){var e=1/(c-a),n=1/(d-h),m=1/(l-k);g[0]=2*l*e;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2*l*n;g[6]=0;g[7]=0;g[8]=(c+a)*e;g[9]=(d+h)*n;g[10]=(k+l)*m;g[11]=-1;g[12]=0;g[13]=0;g[14]=k*l*2*m;g[15]=0;return g};a.perspective=function(a,c,h,d,l){a=1/Math.tan(a/2);var k=1/(h-d);l[0]=a/c;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=a;l[6]=0;l[7]=0;l[8]=0;l[9]=0;l[10]=(d+h)*k;l[11]=-1;l[12]=0;l[13]=0;
l[14]=2*d*h*k;l[15]=0;return l};a.ortho=function(a,c,h,d,l,k,g){var e=1/(a-c),n=1/(h-d),m=1/(l-k);g[0]=-2*e;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=-2*n;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=2*m;g[11]=0;g[12]=(a+c)*e;g[13]=(d+h)*n;g[14]=(k+l)*m;g[15]=1;return g};a.lookAt=function(b,c,h,d){var l,k,g,e,n,m,f,t,s=b[0],r=b[1];b=b[2];g=h[0];e=h[1];k=h[2];f=c[0];h=c[1];l=c[2];if(1E-7>Math.abs(s-f)&&1E-7>Math.abs(r-h)&&1E-7>Math.abs(b-l))return a.identity(d);c=s-f;h=r-h;f=b-l;t=1/Math.sqrt(c*c+h*h+f*f);c*=t;h*=t;f*=
t;l=e*f-k*h;k=k*c-g*f;g=g*h-e*c;(t=Math.sqrt(l*l+k*k+g*g))?(t=1/t,l*=t,k*=t,g*=t):g=k=l=0;e=h*g-f*k;n=f*l-c*g;m=c*k-h*l;(t=Math.sqrt(e*e+n*n+m*m))?(t=1/t,e*=t,n*=t,m*=t):m=n=e=0;d[0]=l;d[1]=e;d[2]=c;d[3]=0;d[4]=k;d[5]=n;d[6]=h;d[7]=0;d[8]=g;d[9]=m;d[10]=f;d[11]=0;d[12]=-(l*s+k*r+g*b);d[13]=-(e*s+n*r+m*b);d[14]=-(c*s+h*r+f*b);d[15]=1;return d};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+
", "+a[13]+", "+a[14]+", "+a[15]+")"};a.wu=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.__gpp_eval=function(a){a.pp=function(){function a(b,c,h,d,l,k){this.message=b;this.offset=d;this.uh=l;this.If=k;this.name="SyntaxError"}(function(a,c){function h(){this.constructor=a}h.prototype=c.prototype;a.prototype=new h})(a,Error);return{SyntaxError:a,parse:function(b){function c(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function h(a){if(Da!==a){Da>a&&(Da=0,ra={uh:1,If:1,Qh:!1});var c=ra,d,e;for(d=
Da;d<a;d++)e=b.charAt(d),"\n"===e?(c.Qh||c.uh++,c.If=1,c.Qh=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(c.uh++,c.If=1,c.Qh=!0):(c.If++,c.Qh=!1);Da=a}return ra}function d(a){E<jb||(E>jb&&(jb=E,xa=[]),xa.push(a))}function l(){var a,c,e;a=E;c=X();c!==D?(c=k(),c!==D?(e=X(),e!==D?(ba++,10===b.charCodeAt(E)?(e=va,E++):(e=D,0===ba&&d(La)),e===D&&(b.substr(E,2)===Ia?(e=Ia,E+=2):(e=D,0===ba&&d(cc)),e===D&&(13===b.charCodeAt(E)?(e=Ma,E++):(e=D,0===ba&&d(oa)))),ba--,e===D&&0===ba&&d(Lb),e===D&&(e=u),e!==D?a=c:
(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w);return a}function k(){var a,c,e,f,h,k,l,n;a=E;c=g();if(c!==D){e=[];f=E;h=X();h!==D?(44===b.charCodeAt(E)?(k=T,E++):(k=D,0===ba&&d(ma)),k!==D?(l=X(),l!==D?(n=g(),n!==D?f=h=[h,k,l,n]:(E=f,f=w)):(E=f,f=w)):(E=f,f=w)):(E=f,f=w);for(;f!==D;)e.push(f),f=E,h=X(),h!==D?(44===b.charCodeAt(E)?(k=T,E++):(k=D,0===ba&&d(ma)),k!==D?(l=X(),l!==D?(n=g(),n!==D?f=h=[h,k,l,n]:(E=f,f=w)):(E=f,f=w)):(E=f,f=w)):(E=f,f=w);e!==D?a=c=0==e.length?c:e[e.length-1]:(E=a,a=w)}else E=
a,a=w;return a}function g(){var a,c,f,g;a=E;c=e();c!==D?(f=X(),f!==D?(63===b.charCodeAt(E)?(f=W,E++):(f=D,0===ba&&d(ea)),f!==D?(f=X(),f!==D?(f=k(),f!==D?(g=X(),g!==D?(58===b.charCodeAt(E)?(g=H,E++):(g=D,0===ba&&d(ca)),g!==D?(g=X(),g!==D?(g=k(),g!==D?a=c?f:g:(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w);a===D&&(a=e());return a}function e(){var a,b,c,d,e,f,g,h;a=E;b=n();if(b!==D){c=[];d=E;e=X();e!==D?(f=P(),f!==D?(g=X(),g!==D?(h=n(),h!==D?d=e=[e,f,
g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==D;)c.push(d),d=E,e=X(),e!==D?(f=P(),f!==D?(g=X(),g!==D?(h=n(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else E=a,a=w}else E=a,a=w;return a}function n(){var a,b,c,d,e,f,g,h;a=E;b=z();if(b!==D){c=[];d=E;e=X();e!==D?(f=Y(),f!==D?(g=X(),g!==D?(h=z(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==D;)c.push(d),d=E,e=X(),e!==D?(f=Y(),f!==D?(g=X(),g!==D?(h=
z(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else E=a,a=w}else E=a,a=w;return a}function z(){var a,b,c,d,e,g,h,k;a=E;b=f();if(b!==D){c=[];d=E;e=X();e!==D?(g=Q(),g!==D?(h=X(),h!==D?(k=f(),k!==D?d=e=[e,g,h,k]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==D;)c.push(d),d=E,e=X(),e!==D?(g=Q(),g!==D?(h=X(),h!==D?(k=f(),k!==D?d=e=[e,g,h,k]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)a|=c[b][3];
else E=a,a=w}else E=a,a=w;return a}function f(){var a,b,c,d,e,f,g,h;a=E;b=t();if(b!==D){c=[];d=E;e=X();e!==D?(f=J(),f!==D?(g=X(),g!==D?(h=t(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==D;)c.push(d),d=E,e=X(),e!==D?(f=J(),f!==D?(g=X(),g!==D?(h=t(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else E=a,a=w}else E=a,a=w;return a}function t(){var a,b,c,d,e,f,g,h;a=E;b=s();if(b!==D){c=[];d=E;e=X();e!==D?(f=O(),
f!==D?(g=X(),g!==D?(h=s(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==D;)c.push(d),d=E,e=X(),e!==D?(f=O(),f!==D?(g=X(),g!==D?(h=s(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else E=a,a=w}else E=a,a=w;return a}function s(){var a,b,c,d,e,f,g,h;a=E;b=r();if(b!==D){c=[];d=E;e=X();e!==D?(f=U(),f!==D?(g=X(),g!==D?(h=r(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==D;)c.push(d),d=E,
e=X(),e!==D?(f=U(),f!==D?(g=X(),g!==D?(h=r(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else E=a,a=w}else E=a,a=w;return a}function r(){var a,b,c,d,e,f,g,h;a=E;b=p();if(b!==D){c=[];d=E;e=X();e!==D?(f=V(),f!==D?(g=X(),g!==D?(h=p(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==D;)c.push(d),d=E,e=X(),e!==D?(f=V(),f!==D?(g=X(),g!==D?(h=p(),h!==D?d=e=[e,
f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else E=a,a=w}else E=a,a=w;return a}function p(){var a,b,c,d,e,f,g,h;a=E;b=F();if(b!==D){c=[];d=E;e=X();e!==D?(f=N(),f!==D?(g=X(),g!==D?(h=F(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==D;)c.push(d),d=E,e=X(),e!==D?(f=N(),f!==D?(g=X(),g!==D?(h=F(),h!==D?d=e=[e,f,g,
h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else E=a,a=w}else E=a,a=w;return a}function F(){var a,b,c,d,e,f,g,h;a=E;b=q();if(b!==D){c=[];d=E;e=X();e!==D?(f=K(),f!==D?(g=X(),g!==D?(h=q(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==D;)c.push(d),d=E,e=X(),e!==D?(f=K(),f!==D?(g=X(),g!==D?(h=q(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==D)for(a=
b,b=0;b<c.length;b++)switch(c[b][1]){case "+":a+=c[b][3];break;case "-":a-=c[b][3]}else E=a,a=w}else E=a,a=w;return a}function q(){var a,b,c,d,e,f,g,h;a=E;b=v();if(b!==D){c=[];d=E;e=X();e!==D?(f=G(),f!==D?(g=X(),g!==D?(h=v(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);for(;d!==D;)c.push(d),d=E,e=X(),e!==D?(f=G(),f!==D?(g=X(),g!==D?(h=v(),h!==D?d=e=[e,f,g,h]:(E=d,d=w)):(E=d,d=w)):(E=d,d=w)):(E=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=
Math.floor(a/c[b][3]);break;case "%":a%=c[b][3]}else E=a,a=w}else E=a,a=w;return a}function v(){var a,e,f;a=E;b.substr(E,7)===ja?(e=ja,E+=7):(e=D,0===ba&&d(ka));e!==D?(f=X(),f!==D?(f=A(),f!==D?a=f:(E=a,a=w)):(E=a,a=w)):(E=a,a=w);if(a===D){a=E;e=x();if(e!==D)if(f=X(),f!==D)if(b.substr(E,2)===Xb?(f=Xb,E+=2):(f=D,0===ba&&d(mb)),f===D&&(b.substr(E,2)===Ua?(f=Ua,E+=2):(f=D,0===ba&&d(qc))),f!==D){a:{a=e;switch(f){case "++":e=++a;break a;case "--":e=--a;break a}e=void 0}a=e}else E=a,a=w;else E=a,a=w;else E=
a,a=w;a===D&&(a=x());a===D&&(a=E,b.substr(E,2)===Xb?(e=Xb,E+=2):(e=D,0===ba&&d(mb)),e===D&&(b.substr(E,2)===Ua?(e=Ua,E+=2):(e=D,0===ba&&d(qc)),e===D&&(43===b.charCodeAt(E)?(e=Ja,E++):(e=D,0===ba&&d(hc)),e===D&&(45===b.charCodeAt(E)?(e=ic,E++):(e=D,0===ba&&d(eb)),e===D&&(126===b.charCodeAt(E)?(e=Uc,E++):(e=D,0===ba&&d(Vc)),e===D&&(33===b.charCodeAt(E)?(e=Qc,E++):(e=D,0===ba&&d(ad))))))),e!==D?(f=X(),f!==D?(f=v(),f!==D?a=e=c(e,f):(E=a,a=w)):(E=a,a=w)):(E=a,a=w))}return a}function x(){var a,c,e;ba++;
var f;a=E;48===b.charCodeAt(E)?(c=Ta,E++):(c=D,0===ba&&d(ab));if(c!==D)if(Na.test(b.charAt(E))?(c=b.charAt(E),E++):(c=D,0===ba&&d($a)),c!==D){c=E;e=[];f=I();if(f!==D)for(;f!==D;)e.push(f),f=I();else e=w;e!==D&&(e=b.substring(c,E));c=e;c!==D?a=c=parseInt("0x"+c):(E=a,a=w)}else E=a,a=w;else E=a,a=w;if(a===D){a=E;48===b.charCodeAt(E)?(c=Ta,E++):(c=D,0===ba&&d(ab));if(c===D)if(c=E,Hb.test(b.charAt(E))?(e=b.charAt(E),E++):(e=D,0===ba&&d(Oa)),e!==D){var g;f=[];g=L();if(g!==D)for(;g!==D;)f.push(g),g=L();
else f=w;f===D&&(f=u);f!==D?c=e=[e,f]:(E=c,c=w)}else E=c,c=w;c!==D&&(c=b.substring(a,E));a=c;a!==D&&(a=parseInt(a))}ba--;a===D&&0===ba&&d(pa);a===D&&(c=y(),c!==D&&(c=0),a=c,a===D&&(a=E,40===b.charCodeAt(E)?(c=ha,E++):(c=D,0===ba&&d(ta)),c!==D?(c=X(),c!==D?(c=k(),c!==D?(e=X(),e!==D?(41===b.charCodeAt(E)?(e=M,E++):(e=D,0===ba&&d(ua)),e!==D?a=c:(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)));return a}function A(){var a,c,e,f,g;c=y();c!==D&&(c=0);a=c;if(a===D){c=[];f=e=E;ba++;40===b.charCodeAt(E)?
(g=ha,E++):(g=D,0===ba&&d(ta));g===D&&(41===b.charCodeAt(E)?(g=M,E++):(g=D,0===ba&&d(ua)));ba--;g===D?f=fa:(E=f,f=w);f!==D?(g=S(),g!==D?e=f=[f,g]:(E=e,e=w)):(E=e,e=w);if(e!==D)for(;e!==D;)c.push(e),f=e=E,ba++,40===b.charCodeAt(E)?(g=ha,E++):(g=D,0===ba&&d(ta)),g===D&&(41===b.charCodeAt(E)?(g=M,E++):(g=D,0===ba&&d(ua))),ba--,g===D?f=fa:(E=f,f=w),f!==D?(g=S(),g!==D?e=f=[f,g]:(E=e,e=w)):(E=e,e=w);else c=w;c!==D&&(c=1);a=c;a===D&&(a=E,40===b.charCodeAt(E)?(c=ha,E++):(c=D,0===ba&&d(ta)),c!==D?(e=X(),e!==
D?(f=A(),f!==D?(g=X(),g!==D?(41===b.charCodeAt(E)?(c=M,E++):(c=D,0===ba&&d(ua)),c!==D?a=f:(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w)):(E=a,a=w))}return a}function L(){var a;bb.test(b.charAt(E))?(a=b.charAt(E),E++):(a=D,0===ba&&d(vb));return a}function I(){var a;Pa.test(b.charAt(E))?(a=b.charAt(E),E++):(a=D,0===ba&&d(Ha));return a}function y(){var a,c;ba++;c=a=E;ba++;var e,f,g,h;e=E;b.substr(E,7)===ja?(f=ja,E+=7):(f=D,0===ba&&d(ka));f!==D?(g=E,ba++,h=B(),ba--,h===D?g=fa:(E=g,g=w),g!==D?e=f=[f,g]:(E=
e,e=w)):(E=e,e=w);ba--;e===D?c=fa:(E=c,c=w);if(c!==D){ba++;c=E;e=C();if(e!==D){f=[];for(g=B();g!==D;)f.push(g),g=B();f!==D?c=e+=f.join(""):(E=c,c=w)}else E=c,c=w;ba--;c===D&&0===ba&&d(db);c!==D?a=c:(E=a,a=w)}else E=a,a=w;ba--;a===D&&0===ba&&d(db);return a}function C(){var a;uc.test(b.charAt(E))?(a=b.charAt(E),E++):(a=D,0===ba&&d(Rb));a===D&&(36===b.charCodeAt(E)?(a=gc,E++):(a=D,0===ba&&d(Bc)),a===D&&(95===b.charCodeAt(E)?(a=Cc,E++):(a=D,0===ba&&d(Db))));return a}function B(){var a;a=C();a===D&&(a=
L());return a}function G(){var a,c,e,f;a=E;42===b.charCodeAt(E)?(c=Yb,E++):(c=D,0===ba&&d(nb));c===D&&(47===b.charCodeAt(E)?(c=Va,E++):(c=D,0===ba&&d(Eb)),c===D&&(37===b.charCodeAt(E)?(c=jc,E++):(c=D,0===ba&&d(Zb))));c!==D?(e=E,ba++,61===b.charCodeAt(E)?(f=Sb,E++):(f=D,0===ba&&d(Tb)),ba--,f===D?e=fa:(E=e,e=w),e!==D?a=c:(E=a,a=w)):(E=a,a=w);return a}function K(){var a,c,e;a=E;43===b.charCodeAt(E)?(c=Ja,E++):(c=D,0===ba&&d(hc));c!==D?(c=E,ba++,43===b.charCodeAt(E)?(e=Ja,E++):(e=D,0===ba&&d(hc)),e===
D&&(61===b.charCodeAt(E)?(e=Sb,E++):(e=D,0===ba&&d(Tb))),ba--,e===D?c=fa:(E=c,c=w),c!==D?a="+":(E=a,a=w)):(E=a,a=w);a===D&&(a=E,45===b.charCodeAt(E)?(c=ic,E++):(c=D,0===ba&&d(eb)),c!==D?(c=E,ba++,45===b.charCodeAt(E)?(e=ic,E++):(e=D,0===ba&&d(eb)),e===D&&(61===b.charCodeAt(E)?(e=Sb,E++):(e=D,0===ba&&d(Tb))),ba--,e===D?c=fa:(E=c,c=w),c!==D?a="-":(E=a,a=w)):(E=a,a=w));return a}function N(){var a;b.substr(E,2)===$b?(a=$b,E+=2):(a=D,0===ba&&d(wa));a===D&&(b.substr(E,2)===ob?(a=ob,E+=2):(a=D,0===ba&&d(wb)));
return a}function V(){var a;b.substr(E,2)===sa?(a=sa,E+=2):(a=D,0===ba&&d(pb));a===D&&(b.substr(E,2)===aa?(a=aa,E+=2):(a=D,0===ba&&d(Ka)),a===D&&(60===b.charCodeAt(E)?(a=Wa,E++):(a=D,0===ba&&d(la)),a===D&&(62===b.charCodeAt(E)?(a=Ba,E++):(a=D,0===ba&&d(xb)))));return a}function U(){var a;b.substr(E,2)===fb?(a=fb,E+=2):(a=D,0===ba&&d(qa));a===D&&(b.substr(E,2)===na?(a=na,E+=2):(a=D,0===ba&&d(ya)));return a}function O(){var a,c,e;a=E;38===b.charCodeAt(E)?(c=yb,E++):(c=D,0===ba&&d(kc));c!==D?(c=E,ba++,
38===b.charCodeAt(E)?(e=yb,E++):(e=D,0===ba&&d(kc)),ba--,e===D?c=fa:(E=c,c=w),c!==D?a="&":(E=a,a=w)):(E=a,a=w);return a}function J(){var a,c,e;a=E;94===b.charCodeAt(E)?(c=ac,E++):(c=D,0===ba&&d(bc));c!==D?(c=E,ba++,94===b.charCodeAt(E)?(e=ac,E++):(e=D,0===ba&&d(bc)),ba--,e===D?c=fa:(E=c,c=w),c!==D?a="^":(E=a,a=w)):(E=a,a=w);return a}function Q(){var a,c,e;a=E;124===b.charCodeAt(E)?(c=Ib,E++):(c=D,0===ba&&d(qb));c!==D?(c=E,ba++,124===b.charCodeAt(E)?(e=Ib,E++):(e=D,0===ba&&d(qb)),ba--,e===D?c=fa:(E=
c,c=w),c!==D?a="|":(E=a,a=w)):(E=a,a=w);return a}function Y(){var a;b.substr(E,2)===Jb?(a=Jb,E+=2):(a=D,0===ba&&d(gb));a!==D&&(a="&&");return a}function P(){var a;b.substr(E,2)===Qa?(a=Qa,E+=2):(a=D,0===ba&&d(Kb));a!==D&&(a="||");return a}function X(){var a,b;a=[];for(b=Z();b!==D;)a.push(b),b=Z();return a}function Z(){var a;ba++;Ca.test(b.charAt(E))?(a=b.charAt(E),E++):(a=D,0===ba&&d(Xa));ba--;a===D&&0===ba&&d(rb);return a}function S(){var a;b.length>E?(a=b.charAt(E),E++):(a=D,0===ba&&d(Ya));return a}
var da=1<arguments.length?arguments[1]:{},D={},ia={start:l},R=l,w=D,u=null,T=",",ma={type:"literal",value:",",description:'","'},W="?",ea={type:"literal",value:"?",description:'"?"'},H=":",ca={type:"literal",value:":",description:'":"'},ja="defined",ka={type:"literal",value:"defined",description:'"defined"'},ha="(",ta={type:"literal",value:"(",description:'"("'},M=")",ua={type:"literal",value:")",description:'")"'},fa=void 0,pa={type:"other",description:"number"},Ta="0",ab={type:"literal",value:"0",
description:'"0"'},bb=/^[0-9]/,vb={type:"class",value:"[0-9]",description:"[0-9]"},Hb=/^[1-9]/,Oa={type:"class",value:"[1-9]",description:"[1-9]"},Na=/^[xX]/,$a={type:"class",value:"[xX]",description:"[xX]"},Pa=/^[0-9a-fA-F]/,Ha={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},db={type:"other",description:"identifier"},gc="$",Bc={type:"literal",value:"$",description:'"$"'},Cc="_",Db={type:"literal",value:"_",description:'"_"'},uc=/^[a-zA-Z]/,Rb={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},
Xb="++",mb={type:"literal",value:"++",description:'"++"'},Ua="--",qc={type:"literal",value:"--",description:'"--"'},Ja="+",hc={type:"literal",value:"+",description:'"+"'},ic="-",eb={type:"literal",value:"-",description:'"-"'},Uc="~",Vc={type:"literal",value:"~",description:'"~"'},Qc="!",ad={type:"literal",value:"!",description:'"!"'},Yb="*",nb={type:"literal",value:"*",description:'"*"'},Va="/",Eb={type:"literal",value:"/",description:'"/"'},jc="%",Zb={type:"literal",value:"%",description:'"%"'},
Sb="=",Tb={type:"literal",value:"=",description:'"="'},$b="<<",wa={type:"literal",value:"<<",description:'"<<"'},ob=">>",wb={type:"literal",value:">>",description:'">>"'},sa="<=",pb={type:"literal",value:"<=",description:'"<="'},aa=">=",Ka={type:"literal",value:">=",description:'">="'},Wa="<",la={type:"literal",value:"<",description:'"<"'},Ba=">",xb={type:"literal",value:">",description:'">"'},fb="==",qa={type:"literal",value:"==",description:'"=="'},na="!=",ya={type:"literal",value:"!=",description:'"!="'},
yb="&",kc={type:"literal",value:"&",description:'"&"'},ac="^",bc={type:"literal",value:"^",description:'"^"'},Ib="|",qb={type:"literal",value:"|",description:'"|"'},Jb="&&",gb={type:"literal",value:"&&",description:'"&&"'},Qa="||",Kb={type:"literal",value:"||",description:'"||"'},rb={type:"other",description:"whitespace"},Ca=/^[\t\x0B\f ]/,Xa={type:"class",value:"[\\t\\x0B\\f ]",description:"[\\t\\x0B\\f ]"},Lb={type:"other",description:"end of line"},va="\n",La={type:"literal",value:"\n",description:'"\\n"'},
Ia="\r\n",cc={type:"literal",value:"\r\n",description:'"\\r\\n"'},Ma="\r",oa={type:"literal",value:"\r",description:'"\\r"'},Ya={type:"any",description:"any character"},E=0,Da=0,ra={uh:1,If:1,Qh:!1},jb=0,xa=[],ba=0,Za;if("startRule"in da){if(!(da.Zp in ia))throw Error("Can't start parsing from rule \""+da.Zp+'".');R=ia[da.Zp]}Za=R();if(Za!==D&&E===b.length)return Za;Za!==D&&E<b.length&&d({type:"end",description:"end of input"});throw function(c,d,e){function f(a){var b=1;for(a.sort(function(a,b){return a.description<
b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function g(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,
function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var k=h(e),l=e<b.length?b.charAt(e):null;null!==d&&f(d);return new a(null!==c?c:g(d,l),0,0,e,k.uh,k.If)}(null,xa,jb);}}}()};b4w.module.__md5=function(a){function m(a,g){var e=a[0],l=a[1],m=a[2],f=a[3],e=c(e,l,m,f,g[0],7,-680876936),f=c(f,e,l,m,g[1],12,-389564586),m=c(m,f,e,l,g[2],17,606105819),l=c(l,m,f,e,g[3],22,-1044525330),e=c(e,l,m,f,g[4],7,-176418897),f=c(f,e,l,m,g[5],12,1200080426),m=c(m,f,e,l,g[6],17,-1473231341),l=c(l,m,f,e,g[7],22,-45705983),e=c(e,l,m,f,g[8],7,1770035416),f=c(f,e,l,m,g[9],12,-1958414417),m=c(m,f,e,l,g[10],17,-42063),l=c(l,m,f,e,g[11],22,-1990404162),e=c(e,l,m,f,g[12],7,1804603682),f=c(f,e,l,m,
g[13],12,-40341101),m=c(m,f,e,l,g[14],17,-1502002290),l=c(l,m,f,e,g[15],22,1236535329),e=h(e,l,m,f,g[1],5,-165796510),f=h(f,e,l,m,g[6],9,-1069501632),m=h(m,f,e,l,g[11],14,643717713),l=h(l,m,f,e,g[0],20,-373897302),e=h(e,l,m,f,g[5],5,-701558691),f=h(f,e,l,m,g[10],9,38016083),m=h(m,f,e,l,g[15],14,-660478335),l=h(l,m,f,e,g[4],20,-405537848),e=h(e,l,m,f,g[9],5,568446438),f=h(f,e,l,m,g[14],9,-1019803690),m=h(m,f,e,l,g[3],14,-187363961),l=h(l,m,f,e,g[8],20,1163531501),e=h(e,l,m,f,g[13],5,-1444681467),f=
h(f,e,l,m,g[2],9,-51403784),m=h(m,f,e,l,g[7],14,1735328473),l=h(l,m,f,e,g[12],20,-1926607734),e=b(l^m^f,e,l,g[5],4,-378558),f=b(e^l^m,f,e,g[8],11,-2022574463),m=b(f^e^l,m,f,g[11],16,1839030562),l=b(m^f^e,l,m,g[14],23,-35309556),e=b(l^m^f,e,l,g[1],4,-1530992060),f=b(e^l^m,f,e,g[4],11,1272893353),m=b(f^e^l,m,f,g[7],16,-155497632),l=b(m^f^e,l,m,g[10],23,-1094730640),e=b(l^m^f,e,l,g[13],4,681279174),f=b(e^l^m,f,e,g[0],11,-358537222),m=b(f^e^l,m,f,g[3],16,-722521979),l=b(m^f^e,l,m,g[6],23,76029189),e=
b(l^m^f,e,l,g[9],4,-640364487),f=b(e^l^m,f,e,g[12],11,-421815835),m=b(f^e^l,m,f,g[15],16,530742520),l=b(m^f^e,l,m,g[2],23,-995338651),e=d(e,l,m,f,g[0],6,-198630844),f=d(f,e,l,m,g[7],10,1126891415),m=d(m,f,e,l,g[14],15,-1416354905),l=d(l,m,f,e,g[5],21,-57434055),e=d(e,l,m,f,g[12],6,1700485571),f=d(f,e,l,m,g[3],10,-1894986606),m=d(m,f,e,l,g[10],15,-1051523),l=d(l,m,f,e,g[1],21,-2054922799),e=d(e,l,m,f,g[8],6,1873313359),f=d(f,e,l,m,g[15],10,-30611744),m=d(m,f,e,l,g[6],15,-1560198380),l=d(l,m,f,e,g[13],
21,1309151649),e=d(e,l,m,f,g[4],6,-145523070),f=d(f,e,l,m,g[11],10,-1120210379),m=d(m,f,e,l,g[2],15,718787259),l=d(l,m,f,e,g[9],21,-343485551);a[0]=e+a[0]&4294967295;a[1]=l+a[1]&4294967295;a[2]=m+a[2]&4294967295;a[3]=f+a[3]&4294967295}function b(a,b,c,d,h,f){b=(b+a&4294967295)+(d+f&4294967295)&4294967295;return(b<<h|b>>>32-h)+c&4294967295}function c(a,c,d,h,l,f,m){return b(c&d|~c&h,a,c,l,f,m)}function h(a,c,d,h,l,f,m){return b(c&h|d&~h,a,c,l,f,m)}function d(a,c,d,h,l,f,m){return b(d^(c|~h),a,c,l,
f,m)}var l="0123456789abcdef".split("");a.so=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var h=b.substring(d-64,d),f=[],t=void 0,t=0;64>t;t+=4)f[t>>2]=h.charCodeAt(t)+(h.charCodeAt(t+1)<<8)+(h.charCodeAt(t+2)<<16)+(h.charCodeAt(t+3)<<24);m(a,f)}b=b.substring(d-64);h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)h[d>>2]|=b.charCodeAt(d)<<(d%4<<3);h[d>>2]|=128<<(d%4<<3);if(55<d)for(m(a,h),d=0;16>d;d++)h[d]=0;h[14]=8*
c;m(a,h);for(b=0;b<a.length;b++){c=a[b];d="";for(h=0;4>h;h++)d+=l[c>>8*h+4&15]+l[c>>8*h&15];a[b]=d}return a.join("")}};b4w.module.animation=function(a,m){var b=m("__animation"),c=m("__constraints");m("__physics");var h=m("__print"),d=m("__util");a.SLOT_0=b.SLOT_0;a.SLOT_1=b.SLOT_1;a.SLOT_2=b.SLOT_2;a.SLOT_3=b.SLOT_3;a.SLOT_4=b.SLOT_4;a.SLOT_5=b.SLOT_5;a.SLOT_6=b.SLOT_6;a.SLOT_7=b.SLOT_7;a.SLOT_ALL=b.SLOT_ALL;a.OBJ_ANIM_TYPE_ARMATURE=b.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=b.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=b.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=b.OBJ_ANIM_TYPE_SOUND;a.OBJ_ANIM_TYPE_PARTICLES=
b.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=b.OBJ_ANIM_TYPE_MATERIAL;a.OBJ_ANIM_TYPE_STATIC=b.OBJ_ANIM_TYPE_STATIC;a.AB_CYCLIC=b.AB_CYCLIC;a.AB_FINISH_RESET=b.AB_FINISH_RESET;a.AB_FINISH_STOP=b.AB_FINISH_STOP;var l=new Float32Array(4);a.is_animated=function(a){return b.is_animated(a)};a.get_actions=function(){for(var a=[],c=b.Ku(),d=0;d<c.length;d++)a.push(b.vx(c[d].name));return a};a.get_current_action=function(b,c){return a.get_current_anim_name(b,c)};a.get_anim_names=function(a){return b.Vk(a)?
b.get_anim_names(a):[]};a.get_current_anim_name=function(a,c){if(!b.is_animated(a))return null;c=c||b.SLOT_0;return b.Uu(a,c)};a.apply=function(a,c,d){if(d>b.SLOT_7)h.error("Can't apply animation to slot "+d+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{d=d||b.SLOT_0;if(b.is_animated(a)){var l=b.get_slot_num_by_anim(a,c);if(-1!=l&&l!=d){h.error('Animation "'+c+'" is already applied to object "'+a.name+'" (slot "'+l+'").');return}}b.apply(a,c,d)}};a.remove=function(a){b.remove(a)};
a.remove_slot_animation=function(a,c){b.is_animated(a)&&(c=c||b.SLOT_0,b.remove_slot_animation(a,c))};a.apply_def=function(a){b.apply_def(a)};a.play=function(a,c,d){b.is_animated(a)?(d=d||b.SLOT_0,b.play(a,c,d),b.update_object_animation(a,0,d)):h.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,c){b.is_animated(a)&&(c=c||b.SLOT_0,b.stop(a,c))};a.is_play=function(a,c){if(!b.is_animated(a))return!1;c=c||b.SLOT_0;return b.is_play(a,c)};a.set_current_frame_float=function(b,c,d){a.set_frame(b,
c,d)};a.get_current_frame_float=function(b,c){return a.get_frame(b,c)};a.set_frame=function(a,c,d){b.is_animated(a)&&(d=d||b.SLOT_0,b.set_current_frame_float(a,c,d),b.update_object_animation(a,0,d))};a.get_frame=function(a,c){if(!b.is_animated(a))return 0;c=c||b.SLOT_0;return b.get_current_frame_float(a,c)};a.set_speed=function(a,c,d){b.is_animated(a)&&(d=d||b.SLOT_0,b.set_speed(a,c||1,d))};a.get_speed=function(a,c){if(!b.is_animated(a))return 0;c=c||b.SLOT_0;return b.get_speed(a,c)};a.get_frame_range=
function(a,c){if(b.is_animated(a)){c=c||b.SLOT_0;var d=a.v[c];if(d)return[d.start,d.start+d.length]}return null};a.get_anim_start_frame=function(a,c){return b.is_animated(a)?(c=c||b.SLOT_0,b.get_anim_start_frame(a,c)):-1};a.get_anim_length=function(a,c){return b.is_animated(a)?(c=c||b.SLOT_0,b.get_anim_length(a,c)):-1};a.cyclic=function(c,d,e){a.set_behavior(c,d?b.AB_CYCLIC:b.AB_FINISH_RESET,e)};a.is_cyclic=function(a,c){if(!b.is_animated(a))return!1;c=c||b.SLOT_0;return b.is_cyclic(a,c)};a.set_behavior=
function(a,c,d){b.is_animated(a)&&(d=d||b.SLOT_0,b.set_behavior(a,c,d))};a.get_behavior=function(a,c){if(!b.is_animated(a))return null;c=c||b.SLOT_0;return b.get_behavior(a,c)};a.apply_smoothing=function(a,c,d,h){h=h||b.SLOT_0;b.is_animated(a)&&b.apply_smoothing(a,c,d,h)};a.update_object_animation=function(a,c,d){b.is_animated(a)&&(d=d||b.SLOT_0,b.update_object_animation(a,c||0,d))};a.frame_to_sec=function(a){return b.frame_to_sec(a)};a.get_bone_translation=function(a,b,e){if(!d.pd(a))return null;
e||(e=new Float32Array(3));c.Qu(a,b,!1,l,null);e[0]=l[0];e[1]=l[1];e[2]=l[2];return e};a.get_first_armature_object=function(a){return d.dc(a)?b.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,c){return b.is_animated(a)&&c?b.get_slot_num_by_anim(a,c):null};a.get_anim_name=function(a,c){if(!b.is_animated(a))return null;c=c||b.SLOT_0;return b.Mu(a,c)};a.get_anim_type=function(a,c){return b.is_animated(a)?b.get_anim_type(a,c):null};a.apply_to_first_empty_slot=function(a,c){return b.apply_to_first_empty_slot(a,
c)};a.get_skel_mix_factor=function(a){return a.d.Bd};a.set_skel_mix_factor=function(a,c,e){d.pd(a)?(c=Math.min(Math.max(c,0),1),a.d.Bd!=c&&b.set_skel_mix_factor(a,c,e||0)):h.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.assets=function(a,m){var b=m("__assets");a.AT_ARRAYBUFFER=b.AT_ARRAYBUFFER;a.AT_JSON=b.AT_JSON;a.AT_TEXT=b.AT_TEXT;a.AT_AUDIOBUFFER=b.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=b.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=b.AT_AUDIO_ELEMENT;a.enqueue=function(a,h,d){b.enqueue(a,h,d)}};b4w.module.camera=function(a,m){function b(a,b){c.Yf(a)?n.copy(b,a.d.sb):l.error("set_pivot(): Wrong object or camera move style")}var c=m("__camera"),h=m("__config"),d=m("__physics"),l=m("__print"),k=m("__constraints"),g=m("__transform"),e=m("__util"),n=m("vec3"),z=m("vec4"),f=m("quat"),t=m("mat4"),s=h.controls,r=new Float32Array(3);new Float32Array(3);var p=new Float32Array(4),F=new Float32Array(4);a.MS_STATIC=c.MS_STATIC;a.MS_ANIMATION=c.MS_ANIMATION;a.MS_CONTROLS=c.MS_TARGET_CONTROLS;a.MS_TARGET_CONTROLS=
c.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=c.MS_EYE_CONTROLS;a.is_camera=function(a){return c.is_camera(a)};a.set_move_style=function(a,b){a.d.Ka=b};a.get_move_style=function(a){return c.is_camera(a)?c.get_move_style(a):(l.error("Wrong object"),null)};a.change_eye_target_dist=function(){l.error("change_eye_target_dist() deprecated")};a.change_trans_speed=function(a,b){var c=a.d,d=c.Bj[0],d=d*(1+b*s.Os);c.Bj=[d,d,d]};a.get_trans_speed=function(a){return c.is_camera(a)?a.d.Bj[0]:(l.error("Wrong object"),
0)};a.set_look_at=function(a,b,e,f){var h=a.d;c.pu(b,e,f,h.e,h.quat);g.F(a);d.sync_transform(a)};a.get_eye=function(a){return a.d.e};a.set_pivot=b;a.get_pivot=function(a,b){if(c.Yf(a))return b||(b=new Float32Array(3)),n.copy(a.d.sb,b),b;l.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(a,b,h){if(c.Yf(a)){var k=a.d;r[0]=0;r[1]=1;r[2]=0;f.setAxisAngle(r,b,p);e.Fp(k.e,k.sb,p,k.e);r[0]=1;r[1]=0;r[2]=0;n.transformQuat(r,k.quat,r);f.setAxisAngle(r,h,p);e.Fp(k.e,k.sb,p,k.e);
g.F(a);d.sync_transform(a)}else l.error("rotate_pivot(): wrong object")};a.apply_vertical_limits=function(a,b,d,e){a.d.lb={Oe:b,ne:d};e==g.SPACE_LOCAL&&c.jy(a);c.am(a)};a.clear_vertical_limits=function(a){a.d.lb=null;c.am(a)};a.apply_horizontal_limits=function(a,b,d,e){a.d.cc={left:b,right:d};e==g.SPACE_LOCAL&&c.uv(a);c.am(a)};a.clear_horizontal_limits=function(a){a.d.cc=null};a.apply_distance_limits=function(a,b,d){c.Yf(a)?b>d?l.error("apply_distance_limits(): wrong distance limits"):(a=a.d,a.Ig=
!0,a.Me=b,a.Ci=d):l.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){c.Yf(a)?a.d.Ig=!1:l.error("clear_distance_limits(): wrong object")};a.set_eye_params=function(a,b,e){f.identity(a.d.quat);c.Bl(a,Math.PI/2);c.Ep(a,b);c.Bl(a,-e);g.F(a);d.sync_transform(a)};a.is_look_up=function(a){e.quat_to_dir(a.d.quat,e.AXIS_MY,r);return 0<=r[1]?!0:!1};a.rotate=function(a,b,e){c.Ep(a,b);c.Bl(a,-e);g.F(a);d.sync_transform(a)};a.get_angles=function(a,b){b||(b=new Float32Array(2));
c.get_angles(a,b);return b};a.set_stereo_distance=function(a,b){for(var d=a.d.N,e=0;e<d.length;e++){var f=d[e];f.type!=c.mb&&f.type!=c.vb||c.Uw(f,b,f.Mc)}};a.get_stereo_distance=function(a){a=a.d.N;for(var b=0;b<a.length;b++){var d=a[b];if(d.type==c.mb||d.type==c.vb)return d.Sh}return 0};a.is_underwater=function(a){return a.d.pq};a.translate_view=function(a,b,d,e){a=a.d.N;for(var f=0;f<a.length;f++){var g=a[f];g.ab||c.kg(g,g.bb);var h=r;h[0]=-b;h[1]=-d;h[2]=0;t.translate(g.ha,h,g.ha);t.rotateZ(g.ha,
e,g.ha);t.multiply(g.ha,g.pa,g.Bf);c.Ls(g);c.Ks(g)}};a.correct_up=function(a,b){b||(b=e.AXIS_Y);k.correct_up(a,b)};a.zoom_object=function(a,e){if(c.Yf(a)){g.get_object_center(e,!1,r);b(a,r);g.F(a);var f=g.get_object_size(e),h=c.Lu(a)/2,f=f/Math.sin(h),h=g.ew(a,r);g.move_local(a,0,f-h,0);g.F(a);d.sync_transform(a)}else l.error("zoom_object(): wrong object")};a.calc_ray=function(a,b,d,e){e||(e=new Float32Array(3));var f=a.d.N[0];switch(f.type){case c.nc:case c.ve:case c.mb:case c.vb:var g=Math.tan(f.hd*
Math.PI/360);F[0]=(2*b/f.width-1)*g*f.bb;F[1]=-1;F[2]=(2*d/f.height-1)*g;F[3]=0;z.transformMat4(F,a.d.I,F);e[0]=F[0];e[1]=F[1];e[2]=F[2];n.normalize(e,e);return e;default:return l.error("Non-compatible camera"),e}};a.project_point=function(a,b,d){d||(d=new Float32Array(2));var e=a.d.N[0];switch(e.type){case c.nc:case c.ve:case c.mb:case c.vb:return g.get_translation(a,r),n.subtract(b,r,r),F.set(r),F[3]=0,z.transformMat4(F,e.Bf,F),a=-F[1]/F[3],d[0]=(F[0]/F[3]+1)/2*e.width|0,d[1]=(a+1)/2*e.height|0,
d;default:return l.error("Non-compatible camera"),d}}};b4w.module.config=function(a,m){var b=m("__config");a.P_LOW=b.P_LOW;a.P_HIGH=b.P_HIGH;a.P_ULTRA=b.P_ULTRA;a.P_CUSTOM=b.P_CUSTOM;a.set=b.set;a.get=b.get;a.reset=b.reset};b4w.module.controls=function(a,m){var b=m("__controls");m("__print");a.CT_CONTINUOUS=b.CT_CONTINUOUS;a.CT_TRIGGER=b.CT_TRIGGER;a.CT_SHOT=b.CT_SHOT;a.CT_LEVEL=b.CT_LEVEL;a.KEY_SHIFT=16;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=
74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=
221;a.KEY_SINGLE_QUOTE=222;a.create_custom_sensor=b.create_custom_sensor;a.create_keyboard_sensor=b.create_keyboard_sensor;a.create_collision_sensor=b.create_collision_sensor;a.create_collision_impulse_sensor=b.create_collision_impulse_sensor;a.create_ray_sensor=b.create_ray_sensor;a.create_mouse_click_sensor=b.create_mouse_click_sensor;a.create_mouse_wheel_sensor=b.create_mouse_wheel_sensor;a.create_mouse_move_sensor=b.create_mouse_move_sensor;a.create_touch_move_sensor=b.create_touch_move_sensor;
a.create_touch_zoom_sensor=b.create_touch_zoom_sensor;a.create_motion_sensor=b.create_motion_sensor;a.create_vertical_velocity_sensor=b.create_vertical_velocity_sensor;a.create_timer_sensor=b.create_timer_sensor;a.reset_timer_sensor=b.reset_timer_sensor;a.create_elapsed_sensor=b.create_elapsed_sensor;a.create_timeline_sensor=b.create_timeline_sensor;a.create_selection_sensor=function(a,h){return b.create_selection_sensor(a,h||!1)};a.set_custom_sensor=function(a,h){b.Kw(a,h)};a.get_custom_sensor=function(a){return a.value};
a.get_sensor_value=b.get_sensor_value;a.get_sensor_payload=b.get_sensor_payload;a.sensor_make_positive=function(){throw"Deprecated method execution";};a.sensor_make_negative=function(){throw"Deprecated method execution";};a.create_sensor_lock=function(a,h,d){a.el=h.slice(0);a.dl=Array(h.length);a.Wi=d||b.Ut};a.remove_sensor_lock=function(a){a.el=null;a.dl=null;a.Wi=null};a.create_sensor_manifold=b.create_sensor_manifold;a.create_kb_sensor_manifold=function(a,h,d,l,k,g){l=b.create_keyboard_sensor(l);
b.create_sensor_manifold(a,h,d,[l],null,k,g)};a.check_sensor_manifolds=function(a){return b.check_sensor_manifold(a,null)};a.check_sensor_manifold=b.check_sensor_manifold;a.remove_sensor_manifolds=function(a){b.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=b.remove_sensor_manifold;a.reset=b.reset;a.register_keyboard_events=b.register_keyboard_events;a.register_mouse_events=b.register_mouse_events;a.register_wheel_events=b.register_wheel_events;a.register_touch_events=b.register_touch_events;
a.unregister_keyboard_events=b.unregister_keyboard_events;a.unregister_mouse_events=b.unregister_mouse_events;a.unregister_wheel_events=b.unregister_wheel_events;a.unregister_touch_events=b.unregister_touch_events};b4w.module.constraints=function(a,m){var b=m("__constraints"),c=m("__physics"),h=m("__transform");a.append_stiff=function(a,l,k,g){l instanceof Array&&2==l.length?b.Dm(a,l[0],l[1],k,g):b.Em(a,l,k,g);h.F(a);c.sync_transform(a)};a.append_semi_stiff=function(a,l,k,g){b.os(a,l,k,g);h.F(a);c.sync_transform(a)};a.append_semi_stiff_cam=function(a,l,k,g,e,n,m,f){b.ns(a,l,k,g,e,n,m,f);h.F(a);c.sync_transform(a)};a.append_semi_soft_cam=function(a,l,k,g){if(!g||0>g)g=.25;b.ms(a,l,k,g);h.F(a);c.sync_transform(a)};
a.append_stiff_trans=function(a,l,k){b.ps(a,l,k);h.F(a);c.sync_transform(a)};a.append_copy_trans=function(a,l,k){b.hs(a,l,k);h.F(a);c.sync_transform(a)};a.append_stiff_trans_rot=function(a,l,k,g){b.qs(a,l,k,g);h.F(a);c.sync_transform(a)};a.append_track=function(a,l){3==l.length?b.ts(a,l):b.ss(a,l);h.F(a);c.sync_transform(a)};a.append_follow=function(a,l,k,g){3==l.length?b.ks(a,l,k,g):b.js(a,l,k,g);h.F(a);c.sync_transform(a)};a.remove=function(a){a.Sa&&b.remove(a)}};b4w.module.data=function(a,m){var b=m("__data");m("__print");var c=m("__util");a.load=b.load;a.unload=function(a){b.unload(a|0)};a.set_debug_resources_root=b.set_debug_resources_root;a.is_primary_loaded=b.is_primary_loaded;a.load_and_add_new=b.load;a.get_bpy_world=function(){c.ba("get_bpy_world() deprecated");return null};a.cleanup=a.unload};b4w.module.debug=function(a,m){m("__batch");var b=m("__print"),c=m("__controls"),h=m("__debug"),d=m("__physics"),l=m("__scenegraph"),k=m("__scenes"),g=m("__sfx"),e=m("__textures"),n=m("__util"),z=m("vec3");a.physics_worker=function(){d.St()};a.physics_id=function(a){b.log("O",d.qu(a));for(var c=d.Ju().j.l,e=0;e<c.length;e++){var g=c[e];g.Za.C==a&&b.log("B",g)}};a.visible_objects=function(){for(var a=k.get_active(),c=k.la(a,"MESH",k.DATA_ID_ALL),a=k.fa(a,"MAIN_OPAQUE").l,d=0;d<c.length;d++){var e=
c[d],g=e.d;if("DYNAMIC"==g.type)for(var h=0;h<a.length;h++){var l=a[h];if(l.P&&l.Pa==g){b.log(e.name,e);break}}}};a.object_info=function(a){for(var c=k.get_active(),d=k.la(c,"MESH",k.DATA_ID_ALL),e=0;e<d.length;e++){var g=d[e];if(g.name==a){b.log("Object",g);for(var h=k.Pk(c),l=0;l<h.length;l++){for(var n=h[l],m=n.l,A=[],z=0;z<m.length;z++)m[z].Pa==g.d&&A.push(m[z]);b.log("Subscene "+n.type,A)}}}};a.objects_stat=function(){var a=k.get_active();console.log("Armatures: "+k.la(a,"ARMATURE",k.DATA_ID_ALL).length);
console.log("Cameras: "+k.la(a,"CAMERA",k.DATA_ID_ALL).length);console.log("Curves: "+k.la(a,"CURVE",k.DATA_ID_ALL).length);console.log("Empties: "+k.la(a,"EMPTY",k.DATA_ID_ALL).length);console.log("Lamps: "+k.la(a,"LAMP",k.DATA_ID_ALL).length);console.log("Meshes: "+k.la(a,"MESH",k.DATA_ID_ALL).length);console.log("Speakers: "+k.la(a,"SPEAKER",k.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=k.get_active(),b=[k.fa(b,"MAIN_OPAQUE"),k.fa(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];
if(d)for(var d=d.l,e=0;e<d.length;e++){var g=d[e].k;g&&(a+=g.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=k.get_active(),b=[k.fa(b,"MAIN_OPAQUE"),k.fa(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.l,e=0;e<d.length;e++){var g=d[e].k;g&&(a+=g.num_triangles)}}return a};a.num_draw_calls=function(){var a=k.get_active(),a=[k.fa(a,"MAIN_OPAQUE"),k.fa(a,"MAIN_BLEND")];return a[0].l.length+a[1].l.length};a.geometry_stats=function(){for(var a=k.get_active(),b=k.Pk(a),
a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.l,g=0;g<e.length;g++){var h=e[g].k,l=e[g].Pa;h&&("COLOR_PICKING"!=d.type&&"GLOW_MASK"!=d.type||l.fj)&&(a[h.id]=h)}}var e=d=c=b=0,n;for(n in a)h=a[n],h=h.Ua,h.Ai&&(d++,e+=h.Ai/1048576),b++,c+=h.zn/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=k.get_active(),c=[k.fa(c,"MAIN_OPAQUE"),k.fa(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=
e.l,g=0;g<e.length;g++){var h=e[g].k;if(h)for(var h=h.Ea,l=0;l<h.length;l++){var n=h[l];if("IMAGE"===n.source||"ENVIRONMENT_MAP"===n.source){var m=n.Oa;-1===a.indexOf(m)&&(a.push(m),n=n.width*n.height*4/1048576/n.Yg,n*=1.3333,b+=n)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=k.get_active(),c=k.Pk(c),d=0;d<c.length;d++){var g=c[d];if("SINK"!=g.type){var h=g.h,l=[h.Va,h.ac];l.push.apply(l,g.Oc);for(g=0;g<l.length;g++){var n=l[g];e.th(n)&&-1==a.indexOf(n)&&
(a.push(n),b+=h.width*h.height*e.fv(n))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=k.get_active();(a=k.fa(a,"MAIN_OPAQUE"))&&k.Oo(a.h,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=k.get_active(),b=k.fa(a,"MAIN_OPAQUE"),a=k.Bx(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}k.Oo(d.h,b,e)}};a.scenegraph_to_dot=function(){var a=k.get_active();
b.log(l.Pt(k.Rk(a)))};a.controls_info=c.debug;a.object_distance=function(a,b){return z.dist(a.d.e,b.d.e)};a.msg=h.msg;a.fbmsg=h.fbmsg;a.print_telemetry=h.print_telemetry;a.plot_telemetry=h.plot_telemetry;a.fbres=function(a,b){function c(){h.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),g=new Float32Array([-1,0,0]),h=new Float32Array([0,
-1,0]),k=new Float32Array([0,0,-1]);if(!n.Gd(a,n.Sr))throw"Wrong VEC3_IDENT";if(!n.Gd(b,n.Nr))throw"Wrong QUAT4_IDENT";if(!n.Gd(c,n.AXIS_X))throw"Wrong AXIS_X";if(!n.Gd(d,n.AXIS_Y))throw"Wrong AXIS_Y";if(!n.Gd(e,n.AXIS_Z))throw"Wrong AXIS_Z";if(!n.Gd(g,n.AXIS_MX))throw"Wrong AXIS_MX";if(!n.Gd(h,n.AXIS_MY))throw"Wrong AXIS_MY";if(!n.Gd(k,n.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=g.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==g.co(c)&&g.mute(c,!0)}};
a.check_finite=function(a){h.check_finite(a)};a.set_debug_params=function(a){var b=k.get_active();if(b=k.fa(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&k.$w(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&k.Zw(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return b.Xu()};a.get_warning_quantity=function(){return b.hv()};a.clear_errors_warnings=function(){return b.clear_errors_warnings()}};b4w.module.geometry=function(a,m){function b(a){return a&&a.d&&a.d.fd?!0:!1}var c=m("__batch"),h=m("__geometry"),d=m("__print"),l=m("__renderer");a.extract_vertex_array=function(a,g,e){if(!b(a))return d.error("Wrong object:",a.name),null;if(a=c.R(a,g,"MAIN")||c.R(a,g,"NODES")){if((g=a.Ua)&&g.Gb&&g.Gb[e])return h.ju(g,e);d.error("Attribute not found:"+e);return null}d.error("Wrong material:",g);return null};a.extract_index_array=function(a,g){if(!b(a))return d.error("Wrong object:",a.name),null;var e=
c.R(a,g,"MAIN")||c.R(a,g,"NODES");if(e){if((e=e.Ua)&&e.Gb)return e.Pd;d.error("Buffer data not found");return null}d.error("Wrong material:",g);return null};a.update_vertex_array=function(a,g,e,l){var m=["MAIN","NODES","DEPTH","COLOR_ID"];if(b(a))for(var f=0;f<m.length;f++){var t=c.R(a,g,m[f]);t&&(t=t.Ua)&&t.Gb&&t.Gb[e]&&h.Gj(t,e,0,l)}else d.error("Wrong object:",a.name)};a.override_geometry=function(a,g,e,n,m){var f=["MAIN","NODES","DEPTH","COLOR_ID"];if(b(a))if(e instanceof Uint16Array||e instanceof
Uint32Array)if(n instanceof Float32Array)for(var t=0;t<f.length;t++){var s=c.R(a,g,f[t]);if(s){var r=s.Ua;if(r){h.Rx(r,s.ed,e);var p=0,F;for(F in r.Gb)var q=r.Gb[F],p=p+n.length/3*q.Ec;r.Rc=new Float32Array(p);var p=r.Rc,v=0;for(F in r.Gb)switch(q=r.Gb[F],F){case "a_position":p.set(n,v);q.offset=v;q.length=n.length;v+=q.length;break;case "a_normal":var x;m&&(x=h.Wm(e,n,n));var A=h.Um(e,n,x);p.set(A,v);q.offset=v;q.length=n.length;v+=q.length;break;case "a_tangent":q.offset=v;q.length=n.length/3*q.Ec;
for(var L=new Float32Array(q.length),A=0;A<L.length;A+=4)L[A]=1,L[A+3]=1;p.set(L,v);v+=q.length;break;default:q.offset=v,q.length=n.length/3*q.Ec,A=new Float32Array(q.length),p.set(A,v),v+=q.length}h.Vx(r);l.Gm(s);if(s.ob)for(A=0;A<s.ob.length;A++)(q=s.ob[A])&&q.Ua&&(q.Ua=r)}}}else d.error("Wrong positions_array type");else d.error("Wrong ibo_array type");else d.error("Wrong object:",a.name)}};b4w.module.hud=function(a,m){var b=m("__hud");m("__print");a.draw_mixer_strip=b.draw_mixer_strip;a.plot_array=b.plot_array};b4w.module.lights=function(a,m){function b(a){for(var b=d.get_active(),n=d.la(b,"LAMP",d.DATA_ID_ALL),m=0;m<n.length;m++){var p=n[m];if("SUN"==p.xb.type){var z=p;break}}if(!z)return c.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(n=(90-a.vert_position)/180*Math.PI,m=z.d,l.set_rotation_euler(z,[n,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),k.quat_to_dir(m.quat,k.AXIS_Y,a),m=g.length(m.e),g.copy(a,e),g.scale(e,m,e),l.set_translation(z,
e),l.F(z),a=z.xb,a.du&&(p=z.data.energy,m=b.world.light_settings.environment_energy,n=Math.cos(Math.abs(n)),p*=Math.max(Math.min(3*n,1),0),n=Math.max(n,.1)*m,h.Kp(a,p),d.set_environment_colors(b,n,null,null)),d.Ij(z,b))}var c=m("__print"),h=m("__lights"),d=m("__scenes"),l=m("__transform"),k=m("__util"),g=m("vec3"),e=new Float32Array(3),n,z=60;a.get_lamps=function(a){var b=d.get_active(),b=d.la(b,"LAMP",d.DATA_ID_ALL);if(!a)return b;for(var c=[],e=0;e<b.length;e++){var g=b[e];g.xb.type===a&&c.push(g)}return c};
a.get_sun_params=function(){for(var a=d.get_active(),a=d.la(a,"LAMP",d.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var e=a[c];if("SUN"==e.xb.type){b=e;break}}return b?(b=b.xb.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=b;a.set_day_time=function(a){for(var e=d.get_active(),e=d.la(e,"LAMP",d.DATA_ID_ALL),g=0;g<e.length;g++){var h=e[g];if("SUN"==h.xb.type){var k=
h;break}}if(!k)return c.error("There is no sun on the scene"),null;k=-Math.cos(a/12*Math.PI)*z;e={};e.hor_position=12>a?15*a:15*(a-24);e.vert_position=k;b(e)};a.set_date=function(a){(n=a.getDate())?1582==n&&10==a.lA&&4<a.Ot&&15>a.Ot&&c.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):c.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){z=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){var b=d.get_active();if(!b)return c.error("No active scene"),
!1;for(var b=d.la(b,"LAMP",d.DATA_ID_ALL),e=0;e<b.length;e++){var g=b[e];if(g.name===a){var h=g.xb;break}}return h?{light_color:h.color,light_energy:h.Of}:(c.error('B4W Warning: light "'+a+'" not found'),!1)};a.set_light_params=function(a,b){var e=d.get_active();if(!e)return c.error("No active scene"),!1;for(var g=d.la(e,"LAMP",d.DATA_ID_ALL),k=0;k<g.length;k++){var l=g[k];if(l.name===a){var n=l.xb;break}}if(!n)return c.error('B4W Warning: light "'+a+'" not found'),!1;"number"==typeof b.light_energy&&
(h.Kp(n,b.light_energy),d.Ij(l,e));"object"==typeof b.light_color&&(h.Rw(n,b.light_color),d.Ij(l,e))};a.get_lights_names=function(){var a=d.get_active();if(!a)return c.error("No active scene"),!1;for(var b=[],a=d.la(a,"LAMP",d.DATA_ID_ALL),e=0;e<a.length;e++)b.push(a[e].xb.name);return b}};b4w.module.material=function(a,m){function b(a,b){for(var c=a.M,d=0;d<c.length;d++){var e=c[d];if(-1<e.qc.indexOf(b))return"MAIN"==e.type}return!1}function c(a,b){var c=d.R(a,b,"MAIN");return Boolean(c&&c.jc[0])}function h(a,b){var c=d.R(a,b,"MAIN");return Boolean(c&&c.jc[1])}var d=m("__batch"),l=m("__config"),k=m("__print"),g=m("__shaders"),e=m("__util");m("vec4");var n=l.p,z="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.max_bones=function(){k.error("max_bones() deprecated, return default value");
return n.max_bones};a.set_max_bones=function(){k.error("set_max_bones() deprecated")};a.set_batch_param=function(){k.error("set_batch_param() deprecated")};a.inherit_material=function(a,b,c,g){if(e.Ao(c)&&e.Ao(a)){for(var h=["MAIN","DEPTH","COLOR_ID"],l=!1,n=0;n<h.length;n++){var m=h[n],x=d.R(a,b,m),A=d.R(c,g,m);if(x&&A)for(l=!0,"MAIN"==m&&(A.ib.set(x.ib),A.Le=x.Le,A.vd.set(x.vd),A.jc.set(x.jc),A.Ld=x.Ld,A.xc=x.xc,A.xc=x.xc,A.Ke=x.Ke,A.ye=x.ye),m=0;m<A.Ub.length;m++){var L=A.Ub[m];if(-1!==z.indexOf(L)){var I=
x.Ub.indexOf(L);if(-1!==I&&(A.Ea[m]=x.Ea[I],A.ob))for(m=0;m<A.ob.length;m++){var y=A.ob[m],C=y.Ub.indexOf(L);-1!==C&&(y.Ea[C]=x.Ea[I])}}}}l||k.error("Wrong objects for inheriting material!")}else k.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++)b.push(a[c].name);return b};a.set_diffuse_color=function(a,b,c){(a=d.R(a,b,"MAIN"))?a.ib.set(c):k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,
b){var c=d.R(a,b,"MAIN");if(c){var e=Array(4);e[0]=c.ib[0];e[1]=c.ib[1];e[2]=c.ib[2];e[3]=c.ib[3];return e}k.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){(a=d.R(a,b,"MAIN"))?a.Le=c:k.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=d.R(a,b,"MAIN");if(c)return c.Le;k.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){(a=d.R(a,b,"MAIN"))?a.vd.set(c):k.error('Couldn\'t set property "specular_color"!')};
a.get_specular_color=function(a,b){var c=d.R(a,b,"MAIN");if(c){var e=Array(3);e[0]=c.vd[0];e[1]=c.vd[1];e[2]=c.vd[2];return e}k.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,b,e){c(a,b)||k.error('Property "specular_intensity" is missing!');d.R(a,b,"MAIN").jc[0]=e};a.get_specular_intensity=function(a,b){c(a,b)||k.error('Property "specular_intensity" is missing!');return d.R(a,b,"MAIN").jc[0]};a.check_specular_intensity=c;a.set_specular_hardness=function(a,b,
c){h(a,b)||k.error('Property "specular_hardness" is missing!');d.R(a,b,"MAIN").jc[1]=c};a.get_specular_hardness=function(a,b){h(a,b)||k.error('Property "specular_hardness" is missing!');return d.R(a,b,"MAIN").jc[1]};a.check_specular_hardness=h;a.set_emit_factor=function(a,b,c){(a=d.R(a,b,"MAIN"))?a.Ld=c:k.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=d.R(a,b,"MAIN");if(c)return c.Ld;k.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,
b,c){(a=d.R(a,b,"MAIN"))?a.xc=c:k.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=d.R(a,b,"MAIN");if(c)return c.xc;k.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){(a=d.R(a,b,"MAIN"))?a.Ke=c:k.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=d.R(a,b,"MAIN");if(c)return c.Ke;k.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,
b){var c=d.R(a,b,"MAIN");c?c.ye=alpha_factor:k.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=d.R(a,b,"MAIN");if(c)return c.ye;k.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,c){if(!a||!c)return k.error("B4W Error: missing arguments in get_material_params"),null;if(!b(a,c))return null;var e=d.R(a,c,"MAIN");if(!e)return null;var g={};"MAIN"==e.type&&(g.Mh=e.Mh,g.yz=e.kd[2],g.zz=5*(1-e.kd[3]),g.Dh=e.Dh,g.tA=d.Ya(e,
"PARALLAX_STEPS")[1]);return g};a.get_water_material_params=function(a,c){if(!a||!c)return k.error("B4W Error: missing arguments in get_water_material_params"),null;if(!b(a,c))return null;var e=d.R(a,c,"MAIN");if(!e||!e.oe)return null;if(!e)return k.warn("B4W Warning: material not found"),null;var g={};if("MAIN"==e.type){if(n.mg){var h=g.shallow_water_col=Array(3);h[0]=e.shallow_water_col[0];h[1]=e.shallow_water_col[1];h[2]=e.shallow_water_col[2];h=g.shore_water_col=Array(3);h[0]=e.shore_water_col[0];
h[1]=e.shore_water_col[1];h[2]=e.shore_water_col[2];g.shallow_water_col_fac=e.shallow_water_col_fac;g.shore_water_col_fac=e.shore_water_col_fac}g.foam_factor=e.foam_factor;g.absorb_factor=d.Ya(e,"ABSORB")[1];g.sss_strength=d.Ya(e,"SSS_STRENGTH")[1];g.sss_width=d.Ya(e,"SSS_WIDTH")[1];g.dst_noise_scale0=d.Ya(e,"DST_NOISE_SCALE_0")[1];g.dst_noise_scale1=d.Ya(e,"DST_NOISE_SCALE_1")[1];g.dst_noise_freq0=d.Ya(e,"DST_NOISE_FREQ_0")[1];g.dst_noise_freq1=d.Ya(e,"DST_NOISE_FREQ_1")[1];g.dir_min_shore_fac=d.Ya(e,
"DIR_MIN_SHR_FAC")[1];g.dir_freq=d.Ya(e,"DIR_FREQ")[1];g.dir_noise_scale=d.Ya(e,"DIR_NOISE_SCALE")[1];g.dir_noise_freq=d.Ya(e,"DIR_NOISE_FREQ")[1];g.dir_min_noise_fac=d.Ya(e,"DIR_MIN_NOISE_FAC")[1];g.dst_min_fac=d.Ya(e,"DST_MIN_FAC")[1];g.waves_hor_fac=d.Ya(e,"WAVES_HOR_FAC")[1]}return g};a.set_material_extended_params=function(a,c,e){if(a&&c&&e){if(!b(a,c))return k.warn("B4W Warning: setting material params is not possible"),null;c=d.R(a,c,"MAIN");c?"MAIN"==c.type&&("number"==typeof e.material_reflectivity&&
a.d.hc&&(c.Mh=e.material_reflectivity),"number"==typeof e.material_fresnel&&(c.kd[2]=e.material_fresnel),"number"==typeof e.material_fresnel_factor&&(c.kd[3]=1-e.material_fresnel_factor/5),"number"==typeof e.material_parallax_scale&&(c.Dh=e.material_parallax_scale),"number"==typeof e.material_parallax_steps&&(a=g.t(parseFloat(e.material_parallax_steps)),d.Z(c,"PARALLAX_STEPS",a),d.Db(c,!0))):k.warn("B4W Warning: material not found")}else k.error("B4W Error: missing arguments in set_material_params")};
a.set_water_material_params=function(a,c,e){if(!a||!c||!e)return k.error("B4W Error: missing arguments in set_water_material_params"),null;if(!b(a,c))return k.warn("B4W Warning: setting water material params is not possible"),null;a=d.R(a,c,"MAIN");if(!a)return k.warn("B4W Warning: material not found"),null;"MAIN"==a.type&&(n.mg&&("object"==typeof e.shallow_water_col&&a.shallow_water_col.set(e.shallow_water_col),"number"==typeof e.shallow_water_col_fac&&(a.shallow_water_col_fac=e.shallow_water_col_fac),
"object"==typeof e.shore_water_col&&a.shore_water_col.set(e.shore_water_col),"number"==typeof e.shore_water_col_fac&&(a.shore_water_col_fac=e.shore_water_col_fac)),n.shore_smoothing&&a.em&&("boolean"==typeof e.shore_smoothing&&(e.shore_smoothing?d.Z(a,"SHORE_SMOOTHING",1):d.Z(a,"SHORE_SMOOTHING",0)),"number"==typeof e.absorb_factor&&(c=g.t(parseFloat(e.absorb_factor)),d.Z(a,"ABSORB",c))),"number"==typeof e.foam_factor&&n.Qf&&(a.foam_factor=e.foam_factor),n.water_dynamic&&a.water_dynamic&&("boolean"==
typeof e.water_dynamic&&(e.water_dynamic?d.Z(a,"DYNAMIC",1):d.Z(a,"DYNAMIC",0)),"number"==typeof e.waves_height&&(c=g.t(parseFloat(e.waves_height)),d.Z(a,"WAVES_HEIGHT",c)),"number"==typeof e.waves_length&&(c=g.t(parseFloat(e.waves_length)),d.Z(a,"WAVES_LENGTH",c)),"number"==typeof e.sss_strength&&(c=g.t(parseFloat(e.sss_strength)),d.Z(a,"SSS_STRENGTH",c)),"number"==typeof e.sss_width&&(c=g.t(parseFloat(e.sss_width)),d.Z(a,"SSS_WIDTH",c)),"number"==typeof e.dst_noise_scale0&&(c=g.t(parseFloat(e.dst_noise_scale0)),
d.Z(a,"DST_NOISE_SCALE_0",c)),"number"==typeof e.dst_noise_scale1&&(c=g.t(parseFloat(e.dst_noise_scale1)),d.Z(a,"DST_NOISE_SCALE_1",c)),"number"==typeof e.dst_noise_freq0&&(c=g.t(parseFloat(e.dst_noise_freq0)),d.Z(a,"DST_NOISE_FREQ_0",c)),"number"==typeof e.dst_noise_freq1&&(c=g.t(parseFloat(e.dst_noise_freq1)),d.Z(a,"DST_NOISE_FREQ_1",c)),"number"==typeof e.dir_min_shore_fac&&(c=g.t(parseFloat(e.dir_min_shore_fac)),d.Z(a,"DIR_MIN_SHR_FAC",c)),"number"==typeof e.dir_freq&&(c=g.t(parseFloat(e.dir_freq)),
d.Z(a,"DIR_FREQ",c)),"number"==typeof e.dir_noise_scale&&(c=g.t(parseFloat(e.dir_noise_scale)),d.Z(a,"DIR_NOISE_SCALE",c)),"number"==typeof e.dir_noise_freq&&(c=g.t(parseFloat(e.dir_noise_freq)),d.Z(a,"DIR_NOISE_FREQ",c)),"number"==typeof e.dir_min_noise_fac&&(c=g.t(parseFloat(e.dir_min_noise_fac)),d.Z(a,"DIR_MIN_NOISE_FAC",c)),"number"==typeof e.dst_min_fac&&(c=g.t(parseFloat(e.dst_min_fac)),d.Z(a,"DST_MIN_FAC",c)),"number"==typeof e.waves_hor_fac&&(e=g.t(parseFloat(e.waves_hor_fac)),d.Z(a,"WAVES_HOR_FAC",
e))),d.Db(a,!0));return!0}};b4w.module.particles=function(a,m){var b=m("__particles"),c=m("__print");a.set_size=function(a,d,l){b.nd(a)?b.set_size(a,d,l):c.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,d,l){b.nd(a)?b.set_normal_factor(a,d,l):c.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,d,l){b.nd(a)?(l=Math.min(l,1),l=Math.max(l,0),b.set_factor(a,d,l)):c.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,m){var b=m("__print"),c=m("__physics"),h=m("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){c.has_physics(a)?c.enable_simulation(a):b.error("No physics for object "+a.name)};a.disable_simulation=function(a){c.has_physics(a)?c.disable_simulation(a):b.error("No physics for object "+a.name)};a.has_physics=function(a){return c.has_physics(a)};a.has_simulated_physics=function(a){return c.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return c.has_dynamic_physics(a)};a.set_gravity=function(a,h){c.has_physics(a)?c.set_gravity(a,h):b.error("No physics for object "+a.name)};a.set_damping=function(a,h,k){c.has_physics(a)?c.m("set_damping",a.j.C,h,k):b.error("No physics for object "+a.name)};a.reset_damping=function(a){if(c.has_physics(a)){var h=a.game;c.m("set_damping",a.j.C,h.damping,h.rotation_damping)}else b.error("No physics for object "+a.name)};a.set_transform=function(a,h,k){c.has_physics(a)?c.set_transform.apply(this,
arguments):b.error("No physics for object "+a.name)};a.sync_transform=function(a){c.has_physics(a)?c.sync_transform(a):b.error("No physics for object "+a.name)};a.apply_velocity=function(a){c.has_physics(a)?c.apply_velocity.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){c.has_physics(a)?c.apply_velocity_world.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_force=function(a,h,k,g){c.has_physics(a)?c.apply_force.apply(this,
arguments):b.error("No physics for object "+a.name)};a.apply_torque=function(a,h,k,g){c.has_physics(a)?c.apply_torque.apply(this,arguments):b.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_throttle(a,h.clamp(l,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,l,k){if(c.has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");
l=h.clamp(l,0,1);var g=a.f.Pf;-1==k||1==k?g=Math.max(-1,Math.min(g+k*l,1)):0==k&&0<=g?(g-=l,g=Math.max(0,g)):0==k&&0>g?(g+=l,g=Math.min(0,g)):b.error("Wrong steering direction");c.vehicle_throttle(a,h.clamp(g,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_steer=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_steer(a,h.clamp(l,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,l,k){if(c.has_physics(a)){c.is_vehicle_chassis(a)||
c.is_vehicle_hull(a)||b.error("Wrong object");l=h.clamp(l,0,1);var g=a.f.xg;-1==k||1==k?g=Math.max(-1,Math.min(g+k*l,1)):0==k&&0<=g?(g-=l,g=Math.max(0,g)):0==k&&0>g?(g+=l,g=Math.min(0,g)):b.error("Wrong steering direction");c.vehicle_steer(a,h.clamp(g,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_brake=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_brake(a,h.clamp(l,0,1))):b.error("No physics for object "+a.name)};
a.vehicle_brake_inc=function(a,l){if(c.has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");l=h.clamp(l,-1,1);var k=a.f.Vg;c.vehicle_brake(a,h.clamp(k+k*l,0,1))}else b.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return c.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return c.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!c.has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;
b.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!c.has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.f.Pf;b.error("Wrong object")};a.get_vehicle_steering=function(a){if(!c.has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.f.xg;b.error("Wrong object")};a.get_vehicle_brake=function(a){if(!c.has_physics(a))return b.error("No physics for object "+
a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.f.Vg;b.error("Wrong object")};a.get_vehicle_speed=function(a){if(!c.has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return c.get_vehicle_speed(a);b.error("Wrong object")};a.is_character=function(a){return c.is_character(a)};a.set_character_move_dir=function(a,h,k){c.has_physics(a)?c.set_character_move_dir(a,h,k):b.error("No physics for object "+a.name)};a.set_character_move_type=
function(a,h){c.has_physics(a)?c.set_character_move_type(a,h):b.error("No physics for object "+a.name)};a.set_character_dist_to_water=function(){b.warn("Function set_character_dist_to_water() is deprecated")};a.set_character_walk_velocity=function(a,h){c.has_physics(a)?c.set_character_walk_velocity(a,h):b.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,h){c.has_physics(a)?c.set_character_run_velocity(a,h):b.error("No physics for object "+a.name)};a.set_character_fly_velocity=
function(a,h){c.has_physics(a)?c.set_character_fly_velocity(a,h):b.error("No physics for object "+a.name)};a.character_jump=function(a){c.has_physics(a)?c.character_jump(a):b.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,h,k){c.has_physics(a)?c.character_rotation_inc(a,h,k):b.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,h){c.has_physics(a)?c.set_character_rotation_quat(a,h):b.error("No physics for object "+a.name)};a.set_character_rotation=
function(a,h,k){c.has_physics(a)?c.set_character_rotation(a,h,k):b.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,h){c.has_physics(a)?c.set_character_rotation_v(a,h):b.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,h){c.has_physics(a)?c.set_character_rotation_h(a,h):b.error("No physics for object "+a.name)};a.append_collision_test=function(a,h,k,g){c.has_physics(a)?c.append_collision_test(a,h,k,g):b.error("No physics for object "+a.name)};
a.remove_collision_test=function(a,h){c.has_physics(a)?c.remove_collision_test(a,h):b.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,h){c.has_physics(a)?c.apply_collision_impulse_test(a,h):b.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){c.has_physics(a)?c.clear_collision_impulse_test(a):b.error("No physics for object "+a.name)};a.append_ray_test=function(a,h,k,g,e,n){c.has_physics(a)?c.append_ray_test(a,h,k,g,e,n):b.error("No physics for object "+
a.name)};a.remove_ray_test=function(a,h,k,g,e){c.has_physics(a)?c.remove_ray_test(a,h,k,g,e):b.error("No physics for object "+a.name)};a.apply_constraint=function(a,h,k,g,e,n,m,f,t,s){c.has_physics(h)&&c.has_physics(e)?c.apply_constraint(a,h,k,g,e,n,m,f,t,s):b.error("Wrong objects")};a.clear_constraint=function(a){c.has_physics(a)&&c.qv(a)?c.clear_constraint(a):b.error("Wrong object")};a.pull_to_constraint_pivot=function(a,h,k,g,e,n){c.has_physics(a)&&c.has_physics(g)?c.pull_to_constraint_pivot(a,
h,k,g,e,n):b.error("Wrong objects")}};b4w.module.scenes=function(a,m){var b=m("__batch"),c=m("__camera"),h=m("__graph"),d=m("__print"),l=m("__physics"),k=m("__scenes"),g=m("__util");a.DATA_ID_ALL=k.DATA_ID_ALL;a.set_active=function(a){var b=k.Hi();k.set_active(g.keysearch("name",a,b))};a.get_active=function(){return k.T()?k.get_active().name:""};a.get_scenes=function(){for(var a=k.Hi(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(k.T())return k.get_active().camera;d.error("No active scene");return!1};
a.get_object_by_name=function(a,b){return k.Ji(k.Pj,a,b)};a.get_object_by_dupli_name=function(a,b,c){return k.Ji(k.km,a,b,c)};a.get_object_by_dupli_name_list=function(a,b){return k.Ji(k.lm,a,b)};a.get_object_by_empty_name=function(b,c,g){d.warn("get_object_by_empty_name() deprecated, use get_object_by_dupli_name() instead");return a.get_object_by_dupli_name(b,c,g)};a.get_object_data_id=function(a){return k.get_object_data_id(a)};a.pick_object=k.pick_object;a.set_glow_intensity=function(a,b){for(var c=
0;c<a.M.length;c++){var d=a.M[c];"COLOR_ID"==d.type&&(d.Vf=b)}};a.apply_glow_anim=function(a,b,c,d){a.d&&a.d.Gc&&k.apply_glow_anim(a,b,c,d)};a.apply_glow_anim_def=function(a){if(a.d&&a.d.Gc){var b=a.d.Ki;k.apply_glow_anim(a,b.jv,b.lv,b.mv)}};a.clear_glow_anim=function(a){a.d&&a.d.Gc&&k.clear_glow_anim(a)};a.set_glow_color=function(a){var b=k.get_active();if(b=k.fa(b,"GLOW"))b.nh.set(a),b.va=!0};a.get_shadow_params=function(){if(!k.T())return d.error("No active scene"),!1;var a=k.get_active(),b=k.fa(a,
"SHADOW_CAST");if(!b)return null;var c={};c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;if(b=k.fa(a,"DEPTH"))c.self_shadow_normal_offset=b.self_shadow_normal_offset;var b=k.fa(a,"MAIN_OPAQUE"),f=a.d.Ic;c.csm_num=f.csm_num;c.csm_first_cascade_border=f.csm_first_cascade_border;c.first_cascade_blur_radius=f.first_cascade_blur_radius;c.csm_last_cascade_border=f.csm_last_cascade_border;c.last_cascade_blur_radius=f.last_cascade_blur_radius;c.csm_resolution=f.csm_resolution;c.fade_last_cascade=
f.fade_last_cascade;c.blend_between_cascades=f.blend_between_cascades;c.csm_borders=k.Tu(a,b.h);c.blur_radii=new Float32Array(f.csm_num);c.blur_radii.set(b.h.sl.subarray(0,f.csm_num));return c};a.set_shadow_params=function(a){if(!k.T())return d.error("No active scene"),!1;var g=k.get_active();"number"==typeof a.self_shadow_polygon_offset&&h.K(g.d.Ja,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var l=k.fa(g,"DEPTH");l&&("number"==typeof a.self_shadow_normal_offset&&
(l.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(l.pcf_blur_radius=a.pcf_blur_radius));var f=k.fa(g,"MAIN_BLEND");f&&("number"==typeof a.self_shadow_normal_offset&&(f.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(f.pcf_blur_radius=a.pcf_blur_radius),f.va=!0);f=g.d.Ic;"number"==typeof a.csm_first_cascade_border&&(f.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&
(f.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(f.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(f.last_cascade_blur_radius=a.last_cascade_blur_radius);if(l){for(var m=l.l,s=0;s<m.length;s++){var r=m[s];r.Pa.kb&&(r=r.k,b.Zj(r,f),b.Db(r))}l.va=!0}l=g.camera.d.N;for(s=0;s<l.length;s++)c.Hj(l[s],f);k.Dl(g)};a.get_environment_colors=function(){if(!k.T())return d.error("No active scene"),!1;var a=k.get_active();
return k.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(!k.T())return d.error("No active scene"),!1;var f=k.get_active();k.set_environment_colors(f,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!k.T())return d.error("No active scene"),!1;var b=k.get_active();return k.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!k.T())return d.error("No active scene"),!1;var b=k.get_active();k.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!k.T())return d.error("No active scene"),
!1;var a=k.get_active();return k.get_ssao_params(a)};a.set_ssao_params=function(a){if(!k.T())return d.error("No active scene"),!1;var b=k.get_active();k.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!k.T())return d.error("No active scene"),null;var a=k.get_active(),a=k.fa(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!k.T())return d.error("No active scene"),
null;var b=k.get_active(),b=k.fa(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.va=!0};a.get_sky_params=function(){if(!k.T())return d.error("No active scene"),!1;var a=k.get_active();return k.get_sky_params(a)};a.set_sky_params=function(a){if(!k.T())return d.error("No active scene"),!1;
var b=k.get_active();k.set_sky_params(b,a)};a.get_dof_params=function(){if(!k.T())return d.error("No active scene"),!1;var a=k.get_active();return k.fa(a,"DOF")?k.get_dof_params(a):null};a.set_dof_params=function(a){if(!k.T())return d.error("No active scene"),!1;var b=k.get_active();k.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!k.T())return d.error("No active scene"),!1;var a=k.get_active();return k.fa(a,"GOD_RAYS")?k.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!k.T())return d.error("No active scene"),
!1;var b=k.get_active();k.set_god_rays_params(b,a)};a.get_bloom_params=function(){if(!k.T())return d.error("No active scene"),!1;var a=k.get_active();return k.fa(a,"BLOOM")?k.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!k.T())return d.error("No active scene"),!1;var b=k.get_active();k.set_bloom_params(b,a)};a.get_wind_params=function(){return k.get_wind_params()};a.set_wind_params=function(a){if(!k.T())return d.error("No active scene"),!1;var b=k.get_active();k.set_wind_params(b,a)};
a.get_water_surface_level=k.get_water_surface_level;a.set_water_params=function(a){if(!k.T())return d.error("No active scene"),!1;var b=k.get_active();k.set_water_params(b,a)};a.get_water_mat_params=function(a){if(!k.T())return d.error("No active scene"),!1;var b=k.get_active();k.get_water_mat_params(b,a)};a.update_scene_materials_params=function(){if(!k.T())return d.error("No active scene"),!1;var a=k.get_active();k.tq(a)};a.hide_object=function(a){k.hide_object(a)};a.show_object=function(a){k.show_object(a)};
a.is_visible=function(a){return a.d.is_visible};a.check_object=function(a){return k.T()?k.check_object(a,k.get_active()):(d.error("No active scene"),!1)};a.get_all_objects=function(a,b){var c=k.get_active();a||(a="ALL");b||0===b||(b=k.DATA_ID_ALL);return k.la(c,a,b)};a.get_appended_objs=function(b,c){d.warn("get_appended_objs() deprecated, use get_all_objects() instead");return a.get_all_objects(b,c)};a.get_object_name=function(a){return a?a.name:(d.error("Wrong object name"),"")};a.get_object_type=
function(a){return a&&a.type?a.type:(d.error("Wrong object ID"),"UNDEFINED")};a.get_object_dg_parent=function(a){return a.wb};a.get_object_children=function(a){return a.Ad.slice(0)};a.get_first_character=function(){for(var a=k.la(k.get_active(),"MESH",k.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(l.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return k.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return k.get_cam_water_depth()};a.get_type_mesh_object=
function(a){return"MESH"==a.type?a.d.type:null};a.append_object=function(){g.ba('Method "append_object" is deprecated')};a.add_object=function(){g.ba('Method "add_object" is deprecated')};a.remove_object=function(){g.ba('Method "remove_object" is deprecated')};a.get_screen_scenes=function(){g.ba("get_screen_scenes() deprecated")};a.set_light_pos=function(){g.ba("set_light_pos() deprecated, use lights module instead")};a.set_light_direction=function(){g.ba("set_light_direction() deprecated, use lights module instead")};
a.set_dir_light_color=function(){g.ba("set_dir_light_color() deprecated, use lights module instead")};a.get_lights_names=function(){g.ba("get_lights_names() deprecated, use lights module instead")};a.remove_all=function(){g.ba("remove_all() deprecated, use lights module instead")};a.check_collision=function(){g.ba("check_collision() deprecated, use lights module instead")};a.check_ray_hit=function(){g.ba("check_ray_hit() deprecated, use lights module instead")}};b4w.module.sfx=function(a,m){var b=m("__scenes"),c=m("__sfx");a.play=function(a,b,l){c.play(a,b,l)};a.play_def=function(a){c.play_def(a)};a.is_play=function(a){return c.is_play(a)};a.speaker_play=function(a,b,l,k){c.cyclic(a,b);k&&c.playrate(a,k);c.play(a,0,l)};a.speaker_stop=function(a){c.stop(a)};a.stop=function(a){c.stop(a)};a.speaker_playback_rate=function(a,b){c.playrate(a,b)};a.playrate=function(a,b){c.playrate(a,b)};a.cyclic=function(a,b){c.cyclic(a,b)};a.is_cyclic=function(a){return c.is_cyclic(a)};
a.listener_reset_speed=function(a,b){c.listener_reset_speed(a,b)};a.speaker_reset_speed=function(a,b,l){c.speaker_reset_speed(a,b,l)};a.get_volume=function(a){return a&&"object"===typeof a?c.get_volume(a):c.Zu()};a.set_volume=function(a,b){a&&"object"===typeof a?c.set_volume(a,b):c.Sw(b)};a.mute=function(a,b){a&&"object"===typeof a?c.mute(a,b):c.Yv(b)};a.is_muted=function(a){return a&&"object"===typeof a?c.is_muted(a):c.Gv()};a.get_speaker_objects=function(){return c.get_speaker_objects().slice(0)};
a.get_speakers=function(){return a.get_speaker_objects()};a.set_compressor_params=function(a){c.set_compressor_params(b.get_active(),a)};a.get_compressor_params=function(){return c.get_compressor_params(b.get_active())};a.duck=function(a,b,l){a&&"object"===typeof a?c.duck(a,b,l):c.cu(b,l)};a.unduck=function(a){a&&"object"===typeof a?c.unduck(a):c.Ox()};a.apply_playlist=c.apply_playlist;a.clear_playlist=c.clear_playlist;a.set_positional_params=c.set_positional_params;a.get_positional_params=c.get_positional_params;
a.set_filter_params=c.set_filter_params;a.get_filter_params=c.get_filter_params;a.get_filter_freq_response=c.get_filter_freq_response};b4w.module.shaders=function(a,m){function b(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function c(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);
c.send(b);if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function h(a){for(var b=1;999>=b;b++){var c={ja:"main.glslv",ea:"main.glslf",U:[["MAX_BONES",b],["SKINNED",1],["FRAMES_BLENDING",a],["WIND_BEND",0],["DETAIL_BEND",0],["DYNAMIC_GRASS",0],["VERTEX_ANIM",0],["TEXTURE_COLOR",1],["TEXTURE_SPEC",1],["TEXTURE_NORM",1],["TEXTURE_MIRROR",1],["VERTEX_COLOR",1],["WATER_EFFECTS",1],["REFLECTIVE",0],["REFLECTION_PASS",0],["SHADOW_SRC_NONE",10],["SHADOW_SRC_DEPTH",20],["SHADOW_SRC_MASK",
30],["SHADOW_SRC","SHADOW_SRC_DEPTH"],["CSM_SECTION1",1],["CSM_SECTION2",1],["CSM_SECTION3",0],["NUM_LIGHTS",4],["DOUBLE_SIDED_LIGHTING",1],["NUM_CAUSTS",3],["TEXTURE_COORDS_UV",10],["TEXTURE_COORDS_NORMAL",20],["TEXTURE_COORDS","TEXTURE_COORDS_NORMAL"],["DISABLE_FOG",0],["ALPHA_AS_SPEC",0],["TEXTURE_STENCIL_ALPHA_MASK",0],["PARALLAX",0],["PARALLAX_STEPS",0],["TEXTURE_BLEND_TYPE_MIX",10],["TEXTURE_BLEND_TYPE_MULTIPLY",20],["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX"],["ALPHA",1],["ALPHA_CLIP",0],
["SSAO_ONLY",0]]};try{z.Qk(c,null)}catch(d){return g.log("vertex uniforms limit exceeded, max bones =",b-1),b-1}g.log("shaders successfully compiled and linked")}return 999}function d(a){for(var b=n.Hi(),c=0;c<b.length;c++)for(var d=n.la(b[c],"MESH",n.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if(f.M)for(var g=0;g<f.M.length;g++){var h=f.M[g];if(h.ub==a&&h.qc.length)return h.qc}}return null}function l(a){a.sort(function(a,b){return b.Mk.ALU_OPS-a.Mk.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],
e=c.Mk,f=c.ly,h=d(c.Mt),h=h?"\t\t("+h.join(", ")+")":"\t\t(NA)";g.groupCollapsed("FRAG --\x3e","ALU",e.ALU_OPS,"TEX",e.TEX_OPS,"\t\tVERT --\x3e","ALU",f.ALU_OPS,"TEX",f.TEX_OPS,h);g.groupCollapsed("directives");for(var h=c.Da.U,k=0;k<h.length;k++){var l=h[k];g.log(l[0],l[1])}g.groupEnd();g.groupCollapsed("vert src");g.log(c.ky);g.groupEnd();g.groupCollapsed("vert stats");for(var n in f)"ALU_OPS"!=n&&"TEX_OPS"!=n&&g.log(n,f[n]);g.groupEnd();g.groupCollapsed("frag src");g.log(c.xu);g.groupEnd();g.groupCollapsed("frag stats");
for(n in e)"ALU_OPS"!=n&&"TEX_OPS"!=n&&g.log(n,e[n]);g.groupEnd();g.groupEnd()}}function k(a){function b(a){for(var c=k-1;0<=c;c--)if(a[c]+1>d[c].Kg.length-1)a[c]=0;else{a[c]++;break}}function c(a){for(var b=Array(a.length),d=0;d<a.length;d++)b[d]=a[d];return b}for(var d=[],e=0;e<a.Ta.length;e++)d.push({name:a.Ta[e],Kg:[0,1]});for(e=0;e<a.La.length;e++){var f=a.La[e][0];d.push({name:f,Kg:a.La[e][1]})}for(e=0;e<a.Ga.length;e++){for(var f=a.Ga[e][0],g=a.Ga[e][1],h=0;h<g.length;h++)d.push({name:g[h],
Kg:[10+10*h]});d.push({name:f,Kg:g})}var k=d.length;a=[];for(var l,f=1,e=0;e<d.length;e++)f*=d[e].Kg.length;for(e=0;e<f;e++){if(l)l=c(l),b(l);else for(l=Array(k),h=0;h<k;h++)l[h]=0;a.push(l)}f=[];for(e=0;e<a.length;e++){l=a[e];g=[];for(h=0;h<l.length;h++){var n=d[h];g.push([n.name,n.Kg[l[h]]])}f.push(g)}return f}m("__config");var g=m("__print"),e=m("__extensions"),n=m("__scenes"),z=m("__shaders");m("__util");var f=[{ja:"depth.glslv",ea:"depth.glslf",U:{Ta:"SKINNED FRAMES_BLENDING WIND_BEND DETAIL_BEND VERTEX_ANIM TEXTURE_COLOR VERTEX_COLOR DEPTH_RGBA ALPHA CSM_SECTION1 CSM_SECTION2 CSM_SECTION3".split(" "),
La:[["MAX_BONES",[100]]],Ga:[["SHADOW_SOURCE",["SHADOW_SOURCE_NONE","SHADOW_SOURCE_MAP","SHADOW_SOURCE_MASK"]]]}},{ja:"color_id.glslv",ea:"color_id.glslf",U:{Ta:"SKINNED FRAMES_BLENDING WIND_BEND DETAIL_BEND VERTEX_ANIM TEXTURE_COLOR ALPHA_CLIP".split(" "),La:[["MAX_BONES",[100]]],Ga:[]}},{ja:"postprocessing/postprocessing.glslv",ea:"postprocessing/anaglyph.glslf",U:{Ta:[],La:[],Ga:[]}},{ja:"postprocessing/postprocessing.glslv",ea:"postprocessing/antialiasing.glslf",U:{Ta:[],La:[],Ga:[["AA_METHOD",
["AA_METHOD_PASS","AA_METHOD_LIGHT","AA_METHOD_QUALITY"]]]}},{ja:"postprocessing/postprocessing.glslv",ea:"postprocessing/compositing.glslf",U:{Ta:[],La:[],Ga:[]}},{ja:"postprocessing/postprocessing.glslv",ea:"postprocessing/depth_pack.glslf",U:{Ta:["DEPTH_RGBA"],La:[],Ga:[]}},{ja:"postprocessing/postprocessing.glslv",ea:"postprocessing/dof.glslf",U:{Ta:["DEPTH_RGBA"],La:[],Ga:[]}},{ja:"postprocessing/postprocessing.glslv",ea:"postprocessing/edge.glslf",U:{Ta:["DEPTH_RGBA"],La:[],Ga:[]}},{ja:"postprocessing/postprocessing.glslv",
ea:"postprocessing/bloom_combine.glslf",U:{Ta:[],La:[],Ga:[]}},{ja:"postprocessing/postprocessing.glslv",ea:"postprocessing/luminance.glslf",U:{Ta:[],La:[],Ga:[]}},{ja:"postprocessing/postprocessing.glslv",ea:"postprocessing/luminance_av.glslf",U:{Ta:[],La:[],Ga:[]}},{ja:"postprocessing/postprocessing.glslv",ea:"postprocessing/luminance_trunced.glslf",U:{Ta:[],La:[],Ga:[]}},{ja:"postprocessing/god_rays.glslv",ea:"postprocessing/god_rays.glslf",U:{Ta:["DEPTH_RGBA","WATER_EFFECTS"],La:[["NUM_LIGHTS",
[1,10,100]]],Ga:[]}},{ja:"postprocessing/postprocessing.glslv",ea:"postprocessing/god_rays_combine.glslf",U:{Ta:[],La:[],Ga:[]}},{ja:"special_skydome.glslv",ea:"procedural_skydome.glslf",U:{La:[["NUM_LIGHTS",[1,10,100]]],Ga:[]}},{ja:"postprocessing/postprocessing.glslv",ea:"postprocessing/motion_blur.glslf",U:{Ta:[],La:[["MAX_STEPS",[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,100]]],Ga:[]}},{ja:"postprocessing/postprocessing.glslv",ea:"postprocessing/postprocessing.glslf",U:{Ta:[],La:[],Ga:[["POST_EFFECT",
["POST_EFFECT_NONE","POST_EFFECT_GRAYSCALE","POST_EFFECT_X_BLUR","POST_EFFECT_Y_BLUR"]]]}},{ja:"postprocessing/postprocessing.glslv",ea:"postprocessing/ssao.glslf",U:{Ta:["SSAO_WHITE"],La:[],Ga:[]}}];a.determine_max_bones=function(){return{max_bones:h(1),max_bones_no_blending:h(0)}};a.report_repeatful_compilation=function(){var a=z.Qt(),b=0,c;for(c in a){var d=a[c],e=d.count;1<e&&g.log(e-1,d.AA,d.Sz);b+=e-1}g.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var d=z.Ru(),f=0,h;for(h in d)a&&
-1===h.indexOf(a)||f++;var f="of "+f+" analyzing...",k={};for(h in d)if(!a||-1!==h.indexOf(a)){var n=d[h],m;var x=n.Aq;m=n.On;var A=e.Sn();if(A){x=A.getTranslatedShaderSource(x);m=A.getTranslatedShaderSource(m);var A=c("/nvidia_vert",x),L=b(A),I=c("/nvidia_frag",m),y=b(I);m={ky:x,MA:A,ly:L,xu:m,xz:I,Mk:y}}else g.error("B4W Error: WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),m=void 0;A=n.Da;x=A.ja+" + "+A.ea;m.Mt=n;m.Da=A;n=k[x]=k[x]||[];n.push(m);g.log(f)}for(x in k)g.group("%c"+
x,"color: #800"),n=k[x],l(n),g.groupEnd()};a.compile_all=function(a,b){function c(){cleanup();for(var a=100;d.length&&a--;){var b=d.shift();g.log(b.msg);z.Qk(b.Da,null)}setTimeout(c,50)}for(var d=[],e=0;e<f.length;e++){var h=f[e].ja,l=f[e].ea,n=k(f[e].U),m=n.length,L="of "+m+" "+h+" + "+l,I=a||0,y=b||m;y>m&&(y=m);for(m=I;m<y;m++)d.push({Da:{ja:h,ea:l,U:n[m]},msg:L})}setTimeout(c,0)}};b4w.module.transform=function(a,m){var b=m("__print"),c=m("__physics"),h=m("__transform"),d=m("__util"),l=new Float32Array(3),k=new Float32Array(4);a.SPACE_LOCAL=h.SPACE_LOCAL;a.SPACE_WORLD=h.SPACE_WORLD;a.set_translation=function(a,b,d,k){l[0]=b;l[1]=d;l[2]=k;h.set_translation(a,l);h.F(a);c.sync_transform(a)};a.set_translation_v=function(a,b){h.set_translation(a,b);h.F(a);c.sync_transform(a)};a.set_translation_rel=function(a,b,k,m,f){l[0]=b;l[1]=k;l[2]=m;d.Th(l,1,f.d.quat,f.d.e,l);h.set_translation(a,
l);h.F(a);c.sync_transform(a)};a.get_translation=function(a,b){b||(b=new Float32Array(3));h.get_translation(a,b);return b};a.set_rotation=function(a,b,d,l,f){k[0]=b;k[1]=d;k[2]=l;k[3]=f;h.set_rotation(a,k);h.F(a);c.sync_transform(a)};a.set_rotation_quat=a.set_rotation;a.set_rotation_v=function(a,b){h.set_rotation(a,b);h.F(a);c.sync_transform(a)};a.set_rotation_quat_v=a.set_rotation_v;a.get_rotation=function(a,b){b||(b=new Float32Array(4));h.get_rotation(a,b);return b};a.get_rotation_quat=a.get_rotation;
a.set_rotation_euler=function(a,b,d,k){l[0]=b;l[1]=d;l[2]=k;h.set_rotation_euler(a,l);h.F(a);c.sync_transform(a)};a.set_rotation_euler_v=function(a,b){h.set_rotation_euler(a,b);h.F(a);c.sync_transform(a)};a.set_scale=function(a,b){h.set_scale(a,b);h.F(a)};a.get_scale=function(a){return h.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return b.error("Wrong object: "+a.name),!1;h.set_translation(a,[0,0,0]);h.set_rotation(a,[0,0,0,1]);h.set_scale(a,1);h.F(a);c.sync_transform(a)};
a.get_object_size=function(a){return d.dc(a)?h.get_object_size(a):(b.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,c,k){return d.dc(a)?h.get_object_center(a,c,k):(b.error("Wrong object: "+a.name),null)};a.move_local=function(a,b,d,k){h.move_local(a,b,d,k);h.F(a);c.sync_transform(a)};a.get_object_bounding_box=function(a){return h.get_object_bounding_box(a)}};b4w.module.util=function(a,m){var b=m("__print"),c=m("__util"),h=m("vec3");m("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=c.keyfind;a.keysearch=c.keysearch;a.matrix_to_quat=function(a){return c.matrix_to_quat(a)};a.euler_to_quat=function(a){return c.euler_to_quat(a)};a.quat_to_euler=function(a){return c.quat_to_euler(a)};
a.sign=c.sign;a.clamp=c.clamp;a.quat_to_dir=c.quat_to_dir;a.ground_project_quat=function(a,b){return c.quat_project(a,c.AXIS_MY,c.AXIS_Y,c.AXIS_MZ,b)};a.cam_quat_to_mesh_quat=function(a,b){return c.cam_quat_to_mesh_quat(a,b)};a.quat_project=function(a,l,k,g,e){return 0!=h.dot(k,g)?(b.error("Wrong in-plane direction"),null):c.quat_project(a,l,k,g,e)};a.hash_code=c.hash_code;a.smooth=c.smooth;a.smooth_v=c.smooth_v;a.is_vector=c.is_vector;a.correct_cam_quat_up=c.correct_cam_quat_up;a.quat_to_angle_axis=
c.quat_to_angle_axis;a.random_from_array=c.random_from_array;a.xz_direction=c.xz_direction;a.line_plane_intersect=c.line_plane_intersect};"object"==typeof module&&module.Dk&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,m){var b=m("__version");a.version=b.version;a.type=b.type;a.date=b.date};"object"==typeof module&&module.Dk&&b4w.module.version(exports);b4w.module.main=function(a,m){function b(){}function c(){}function h(){}function d(){Z=0;window.performance||(p.log("Apply performance workaround"),window.performance={});var a=Date.now();if(window.performance.now)return a-performance.now();p.log("Apply performance.now() workaround");window.performance.now=function(){return Date.now()-a};return a}function l(a,b){a.addEventListener("webglcontextlost",function(a){a.preventDefault();p.error("B4W Error: WebGL context lost");g()},!1);x.tc(b);var d=x.Zn();
d&&p.log("%cRENDERER INFO:","color: #00a",b.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+b.getParameter(d.UNMASKED_RENDERER_WEBGL));B.tc(b);A.tc(b);V.tc(b);N.tc(b);v.tc(b);G.Np(a.width,a.height);K.init();c=f();n()}function k(){b=function(){}}function g(){e()||(da=performance.now()/1E3,K.pause(),C.pause())}function e(){return D<da}function n(){R(n);var a=performance.now()/1E3;S||(S=a);var b=a-S;b<1/Y.Ud||(e()||(D>S&&(b-=D-Math.max(da,S)),Z+=b,v.update(),y.update(),q.update(),z(Z,b),c(b)),S=a)}function z(a,
c){q.is_primary_loaded()&&(L.reset(),U.update(c),I.update(a,c),K.update(a,c),t.update(c),q.is_primary_loaded()&&(C.update(a,c),q.is_primary_loaded()&&(b(c,a),q.is_primary_loaded()&&(F.update(a,c),q.is_primary_loaded()&&G.update(a,c)))))}function f(){var a=60,b=0,c=0,d=Y.uu,e=Y.tu;return function(f){a=O.smooth(1/f,a,f,d);b=O.smooth(0,b,f,d);c=(c+1)%e;0==c&&h(Math.round(a),Math.round(b))}}var t=m("__animation"),s=m("__compat"),r=m("__config"),p=m("__print"),F=m("__controls"),q=m("__data"),v=m("__debug"),
x=m("__extensions"),A=m("__geometry"),L=m("__hud"),I=m("__nla"),y=m("__assets"),C=m("__physics"),B=m("__renderer"),G=m("__scenes"),K=m("__sfx"),N=m("__shaders"),V=m("__textures"),U=m("__transform"),O=m("__util"),J=m("__version"),Q=r.context,Y=r.p,P=null,X=null,Z=0,S=0,da=0,D=0,ia=["webgl","experimental-webgl"],R=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,
1E3/Y.Ud)}}();a.init=function(a,b){r.Tw();p.Yw(Y.console_verbose);var c=J.version()+" "+J.type()+" ("+J.date()+")";p.log("%cINIT B4W ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;c=d();P=a;var e;e=null;for(var f=0;f<ia.length;f++){var g=ia[f];try{e=a.getContext(g,Q)}catch(h){}if(e)break}if(!e)return null;l(P,e);r.ws();s.Qw(e);p.log("%cSET PRECISION:","color: #00a",Y.precision);b?(L.init(b),X=b):(r.p.show_hud_debug_info=!1,r.lg.aj=!1);C.wv(c);return e};a.set_check_gl_errors=
function(a){v.set_check_gl_errors(a)};a.resize=function(a,b){P.style.width=a+"px";P.style.height=b+"px";X&&(X.style.width=a+"px",X.style.height=b+"px");P.width=a;P.height=b;X&&(X.width=a,X.height=b);L.Hg();G.Np(a,b);B.clear();z(Z,0)};a.set_fps_callback=function(a){h=a};a.clear_fps_callback=function(){h=function(){}};a.set_on_before_render_callback=function(a){b=a};a.set_render_callback=function(a){b=a};a.clear_on_before_render_callback=function(){k()};a.clear_render_callback=function(){k()};a.global_timeline=
function(){return Z};a.redraw=function(){z(Z,0)};a.pause=g;a.resume=function(){e()&&(D=performance.now()/1E3,K.resume(),C.resume())};a.is_paused=e;a.reset=function(){q.unload();X=P=null;D=da=S=Z=0;h=function(){};c=function(){};b=function(){}};a.canvas_data_url=function(){};a.get_canvas_elem=function(){return P};a.set_texture_quality=function(){O.ba("set_texture_quality() deprecated")};a.set_shaders_dir=function(){O.ba("set_shaders_dir() deprecated")}};b4w.module.app=function(a,m){function b(){var a=f.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=f.is_paused(),f.pause()):a||f.resume()},!1)}function c(a,b){var c=String(a);b&&(c+="/"+String(b));A.innerHTML=c}function h(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function d(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div"),
k=document.createElement("div");if(d)for(var l=0;l<d.length;l++){var n=document.getElementById(d[l]);n&&n.parentNode.removeChild(n)}e.style.cssText="z-index:10;width:100%;height:100%;position:absolute;";h.style.cssText="position:absolute;bottom:0;width:100%;height:auto;";k.style.cssText="position:relative;float:right;margin:20px;width:70px;height:70px;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAABGCAYAAABxLuKEAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABgbSURBVHic7Vx5VFPX1t8JxDDJLGESQSwCFVAI4ICiURAFHNFa0epSsEKltnXGoYMVqKWvfVLLE6k+i8UBoaACQR5aLfg9BEGoBRmEMCcEqMyZ7/dHctOTSxKC2n7vW+v91lLusM+9e+/sc87eZ+9zSRiGwV8FEolkAQB2AGAEAMbIX/wYAKAfAF7I/vUjf1sxDOv+y3j9MxVDIpFIAGAPAB4AMBsArF7xkV0A8AQAqgCAhf2JzP8piiGRSC4A4AUA7vCHJbxu9ANANQA8xjCs9nU//LUqhkQizQCA9QAwfTxaMpkMEonkdb26CQAyMQxrfF0PfC2KIZFIVgCwFqRdRinMzMwooaGhFkuWLLHy8vKydHJysmhoaOAGBAQUdHZ2ClBaGo02qaioKPCNN96waGho6H78+DH73r17Xbdu3eru7e0VqmGlCgB+wjCs65VlehXFkEgkYwAIBYD5AEAm3qfRaJOOHDkyMyQkZIaDg4MZmUweQxMXF/fg6NGjz9Brp06dco6NjV1EpJVIJJLm5ube27dvN8bHx9dxOBwBkQYAJADwEABuYRj24qVle1nFyMaRXQCgR7xHp9MNY2NjZ61YsWKmjo4ORdUzRCKROCQkJLugoKAXvR4YGGiWm5u7RltbW0tVWx6PJ8zPz6+Li4t7Wl5ePqCEZAQAUl52/HkpxZBIJAYAbACClfj7+5ucPn3a29vbe5psRhrL7cgIv7a2llNeXs7+7rvvGqurq4eU0bm7uxtER0fPoNPpli4uLjQ9PT2qMjoMw7CysrKWAwcOPHrw4AHRQiQAkIFh2N0JyzgRxZBIJC0A2AwAfuh1CoVCOnPmjEdERISXsl+5vr6ek52d3XDnzh32vXv3+iY66JLJZFiyZIlpYGCg5Zo1a95wcnKiEWmEQqE4JSWlbO/evb+KxWKiUMUAkI5hmFjTd2qsGBKJNBkA3gWAN9Drfn5+xhcvXlw8Y8YMC/S6WCyWFBcXN3399ddPc3JyXqtjtnr1aouPPvpo1oIFC6ZraWkpWG1dXR1727ZtP5eWlhK7VwMAnMMwbFCTd2ikGJlSDgHAFPT6V199NSsmJsaXQqHIrQTDMCwnJ+e3o0ePVtXU1AxrwsTLwtXVVf/UqVMeq1evfhPtugKBQJSYmPiQOKgDABcAvtBEOeMqRtZ9PgSCpVy6dIn+zjvveKLX2Gx2//vvv38/IyODPd6LidDS0iJhGIa9jG+zYcMGyzNnzvhbWloqOJOpqallkZGRlQTyBgD4erxuNWb6VILNQFDK9evX56JKwTAMy8rK+tXZ2TlzokoJDw+3Li0tDRwcHNw2NDS0vbS0NDA8PNx6Is/IyMhgOzs7Z2ZlZf2KhgkRERHe6enpPgTyN2QyqYVai5HNPm/h52QyGXJycvxCQkJc8WtCoVD03nvvFZ4/f75NU0GoVCr5gw8+cHj33Xc9HBwczJXRNDc395w7d67qm2++aebz+RqbUWRk5NSzZ88GUCgUbfzazZs3f1u7dm0JwRqvqZutVCpG5qe8D4hVZWVlzV+7du0s/JzP5wt37NjBTE9P18jTNDMzoxw/ftw5PDzczdzc3ECTNj09PUM//vjjrydPnnw2jtcrx+bNm60uXLgQRKVS5T7UTz/99HTdunUPETIJAJxR5ecoVYzMo/0YEOctJibG/syZM4H4+ejoqGDr1q35mZmZnPEYdXFx0Ttx4sSsVatWuerp6U3SRDgiRkZGBDdv3qz57LPPntbW1o6MR79+/XpaWlraCl1dXfn73n///TtJSUks9LEA8KkyD1mVYrYC4qu4urrql5aWrjcwMNABAODz+aL169ffzM3N7VHHHIPBMD1y5Ij74sWLZ2hra2syno0LkUgk+fnnnxvj4+Or796926eONjg42DwzM3MVlUrVBgAYGhri+fr6ZhJmy2IMw9KIbccwKwsI5+PnWlpapOvXry/BlQIAkJCQUKxOKdu2bbOpqKhYUVRUFLZs2TKn16UUAABtbW3ysmXLnIqKisIqKipWbNu2zUYVbW5ubk9CQkIxfm5gYKBz/fr1JVpaWqhXPl8mswLGWAyJRIoGJEpOSUmZExkZ6Y2f379/v3Hx4sVjBi0qlUrev3//9IiICHd7e3ulA+qfBRaL1ZOamlqdmJjYpGyg/vnnnxn+/v4z8PPz58+X7dq1C53GqzAM+w5to6AY2XrKAfzcwcFB59mzZ5snTZqkDQDQ3d094O7unkWMav38/IwzMzODLCwsDF9ZyldAd3f3wPr165nFxcUKYwaNRptUXV29DudPIBCInJ2d05ubm3kI2Zfoeg7RxNejJ/Hx8R64UgAAdu/efVdZqF9cXPyCwWDcKigoeCaRSP66RWQE1dXV7QEBAbeJSgEA4HA4gt27d8utfNKkSdrx8fHEtSMF2eUWI5ueP8Bv2NnZ6dTX17+NT3llZWUtPj4+BeMx6OfnZ5yYmOjj6+trPxHBXhZCoVD87bfflu7fv//peF7zo0ePlnt7e08DkLoaTk5OV1pbW1Gr+QafvlGL8UIfEhcX54b6AZ9//nkF8UWZmZnzent7w/Pz8xe5u7sbAEitZ+7cuXfCwsJynj17NuHQYCJgsVg9y5Yty/zoo4+eSiQSMDMzo+Tk5Czo7e0Nv3r1qi+RHpWBSqVS4uLi3Agkf+hAZjEkADgNAOcA4JylpeXF0dFRASZDZWVlG34P/zd37tyrGAKhUCi6ceNGlZ2d3SWULjo6Or+tra0Xe42QSCSSH3/8sVJHR+c8/p4NGzbkcDicfpRuzpw56US+Kysr2/D7o6OjAktLy4vI/dMg60XS/0gkBwA4jCvr4MGDjl988cVS/Hzjxo03iTEQjUabVFNTs8HU1FQfvT46OipIT0+vPnjwYHVfX58IQDrlb9iwgTZ//nwLDw8PcxqNZtDZ2TnY0tIy0NHRMdzd3c3jcrl8GxsbXScnJ6Pp06cb+fj42E2ePFkHCBCJROLDhw/f++qrr5oAAPT09Mjff/89/a233vJAI+y+vr4hJyenDKK3vGHDBsvr16+vws8PHTpUdPr06ecISQKGYc24YtYAwAr8zp07d/wDAgJmAkhHehqNdpXIIIB0CfMf//jHfC8vLzvivYGBgdGUlJSK48eP1/J4vAmHzFQqlRwRETF13759Xng8NTo6KoiIiCjAQ5C5c+caXbt2LcDOzs4UbdvW1ta3adOmwocPH/YrezaHw9mEz1CFhYV1gYGB95Hb+RiGZeNjzGyCwLb4cVlZWTvxwfr6+loAAOXl5QN0Op0ZHR3NZLPZCkwYGhrq7t+/f0FLS8vG06dPu+JjEFF4X19fw+DgYPOwsDDam2++qY+vl/P5fMnZs2dbXFxcsr///vtyLpc7GBoaehNXysaNGy0LCwtXE5XCZDKfubm5ZeNKwXlFgcqEykrUhQUgfZDBYGSg/XTPnj1MIPTTmJiYgszMzGpra2t5/9TT0zufnJxcyuPxBJgKdHR0/F5ZWdlWWlra3N7e3icSicREGoFAILx9+/Zvenp659F3amlppeDHhw8fLhIKhSK0HY/HExw5cqQIp6FQKCk//PDD45iYmAIi/3v27GGibRkMRgaBxoIM0lyyHGvXrpVrUCwWS65cudJJ1HhFRcWLdevWudXV1W2Kj493oVAopJGREUlUVNQTZ2fnKxcvXiwfGBgYJbaztrY2nj17tq2Pj4+9jY2NCXFZEgCAQqFoBwcHu65cuVJhtRBfxz116pRzXFwcA11bbm1t7WUwGFnx8fGNANLYrqqqKmTr1q2eFRUVY/yaK1eudIrFYnn3RmWWwY4MhBTq7Nmz5QzV19dzlIX6jx496heJRGIDAwOdw4cPL2xsbFy/detWawAAFovF27FjR4WtrW16XFzcg+fPn3OxCWYieDyesLGxccyyaEREhO3hw4f90AREXl5e7axZs+RdJyoqyq60tHS9i4uLlUgkEj969GjMONPb2yusr6+XrwqgMstgpA3SSgM5TE1N5UsN7e3tyvI1IBQKsa6urv6pU6eaAgDY2dmZ/vDDDyHR0dGshISEJzk5Od2Dg4Pio0ePPjt69Ogze3t7nU2bNtnS6XRzQ0NDqq6uLoXNZg81Njb219bW9g8ODoqmTJlCNTMzo2pra5Pu37/PffLkiUJaZe7cuUZJSUkBeNJOIpFgJ06cuHfq1KlGAAAdHR3y5cuXfdatW+eOK66rq6tfKBQq/VXa29sHXFxcrIgyy2CsDQSLMTEx0cWPuVzumO6Ag8Vi/Y4rBmHePjs72/758+fctLS03/72t789HxwcFLNYLF5CQkIjALx0bvnvf/+7L5q8S0xMLMGVQqfTDa9evbrU0dFR4ZdnsVi/q3oeKhsqswxGZCBYjLGxsVx7HA5H5YJQQ0ODypc6OjpO+eSTTxZ3dnaGMxgMU1V0miIsLIzm4+Njj5/n5eXVHjp0qAYAYNGiRcYPHjxYR1TKeDyisqEy45cUFDN58mQtdMWLzWartJinT5+qfCkOAwMDHYFA8MolDVu2bHHEj0dGRgRRUVFlOL9paWnLUJ415RGVTVdXd9LkyZPRad1YYfB1dHRUMKmOjg6ViikrKxtXMQAAtbW1r5xbWrBgwTT8uLi4uAkP/C5fvjyX6MdoyiNRNoLsRgrTZX9/vwg9NzAw0AYVKCsrGxCJRGqtYWRkRIDOal5eXpM///xzZ2tra43XfRkMhqm5uflk/JzJZLYBAEydOpWKZiuIEIlEkrKyMqWTB8BY2Yiya4O0MkkHAKC5uZknFArFeGZx2rRpCnEQCj6fL2Gz2S9sbW1V/mICgUD+Ml9fX8OSkpKNWlpa5KCgIHs6nc5U1Q7FwYMH5VkJsVgsuXz5cjsAwPbt2+3IZLLSwgEAADab/UJd2gWVTSgUigmLVv1kkBb/yfH777/LTd/W1lalYgAAWCyW2voTY2NjPRcXFz0AAB8fH1PcofPy8rLTJKnGYDBM8ZgNAODRo0ctXC5XCAAQHBzs8Cq8obKhMsvwYoxiuFyu3H+wtLRUq5iGhga1q/QAAEFBQTQAgOzs7C6RSCRPix47dow+XtvExERf1CrOnTtXAwBgb2+vQ6fTxwSuE+ENlQ2VWYYXZJB2JTm6u7vl2qPRaGoV89tvv41bseTv728FANDW1sYvKSlpxq87Oztbqlvhd3V11Z8zZ85U/Ly0tJR16dKlDgCAvXv3zlAWTkyEN1Q2VGYZxnYlNpstJxovW1hWVjauxaxcudIZj6zj4uKqJMj6Y2Jiov/MmTPHVGQBSGMjoVAoAgAYHh7mv/POO8UAADY2NtTt27fPVtZmIryhsqEyyzDWYtrb2+VmZWFhYahuBiktLR1AgzFloFAo2klJST4AAHfu3OlNT09/gjJ3586dlZaWlmPeUVdXNxIeHp538eLFcj8/v8z6+voRAIDLly8vUOKQKUAsFkuU1MfIYW1tPQnNaKAyy9BPBoBW9EpOTo48mtbW1iZHR0erLE3l8/mSrq4upYtBKBYtWjQjLCyMBgAQGRlZIVsqBQBpnMVkMpcpa5eRkcHesWNHBR43ffjhhw6LFy+eoYwWRVdXV7+6GSkqKmo6mgREZZahlYxJy9DlSfmSkpIXzc3N8izjmjVr1DLS0tKikaN3+vTpBfr6+lo8Hk+ybNmywufPn3Pxex4eHrbHjh17Q1376Ohou4SEhCWavGs8nlCZmpube0pKStDhpAvDsG5ca0/Qhrm5ufJgz9XV1crV1VXlIPz48eNxk/oAAA4ODuaFhYUMLS0tUl9fnyggICAfXbPZt2+fL5VKHTOgkslkSEhIcE1KSlqO5rjUQR1PLi4uem+++aY8JYvKKsMTgD/SJ1XoneTk5OeYbBGFRCKRoqKiHEEFYmNjazgcjsr+jGLevHkO2dnZCwCkzuS1a9ee4veMjY31duzYIV8w0tLSIh08eNCxubk57NChQ37qnDkUHA5nIDY2tkbV/d27dzvii+YYhmHJycnPCSRVAH8ohgXIIFxTUzNcU1Mj717BwcEqu9Pw8LD4wIEDD/AZZDyEhIS47ty50xYA4NNPP63h8/nykGHz5s1O+PG9e/cYX3zxxVJ1sRARQqFQdODAgQfDw8Mqy8hCQkLkstTU1HQRKh/6QaoLqWJk1lGNPiA7O1tuYra2tibqGEpLS+sMDQ3N6e7u1shy9u7d6wEA0NHRwc/Ly6vDr8+ZM0fu1/T29qoMYJWhu7t7IDQ0NCctLW3MUiwKdA0JlVGGarynoH36MUqRlJTU1Nra2gcAUFVV1TEeYwUFBb2enp4/PX78uHU8Wjc3Nxt/f38TAIBffvlFbpn6+vpU3K+pqakZ10eSM/74caunp+dPxApzZXj69GknAEBra2tfUlJSE/FR+IFcMZg0Zysn5HA4AjqdnrN06dIbixcvLtSEwY6ODr6Pjw/zwoUL5dg4C70eHh5GsjYKljFv3jwTAIDy8vJxFYNhGHbhwoVyHx8fZkdHB18THpcsWVIYFBSUSafTcwgFCk0YUnZGnAUy0RMulyu8e/dun7o+S4REIoGdO3dW7Nq1K39oaIinim7KlCk6AACtra0KinF3dzcBkC64q3vP0NAQb9euXfk7d+6smEgJbH9/v6igoKAXD0YRKMiuoBhMWh+iMEO9LFJTU9sXLlyYhfpEKMzMzKgAACwWS0ExpqamVAAANpstUGV0zc3NPQsXLsxKTU0dkwx8SVRhhL1OygKxn0Ba0agSOjo6GpWOPXnyZMjNzS2noKCAWKENpqamOgBSBaBRt76+PgVAGisJBIIxqZuCgoJnbm5uOcQsgipQKBQSobSMCAlIZVbAGAEx6Saoh8TrAABubm4GnZ2dGzkcTvjJkyedNWFseHhYHBQU9ODkyZP3hUKhXAG4YgCkeW78WFdXV+7EjY6OyhUjFArFJ0+evB8UFKR2Okbx2WefzWSz2W9zudzNCxYsMFZB9hBTsvFL1S9/C6SlngrYvXu3o5WVlbGhoaHusWPHFqWlpY27poLjxIkTdWvWrMnp6ekZBAAwMjKSb7Pp7++Xj0V6enryFMno6KgAAKCnp2dwzZo1OSdOnKgDDZGWlkY/fvy4v6mpqYGJiYl+ZGSkMid1BKSyjoFSxWDSutcUIHSpvLy8DnS22bJliyeTyVxEoVA08krz8vJ6PD09syorK9sMDQ3lFtPT0yN3stANGzweT1RZWdnm6emZlZeXp7Z0FmlPYjKZi7Zs2aJQ0p+bm0t0OSQg3eildN1G5Vghm7oy0Gu5ubk9+/bt+xc6Jixfvty5pKQk0MjISKM4pq2tje/t7c3Mysqqx6/dvn1bvoBVWFgo94OuXLlS4+3tzWxra9NoKjYyMtIuKSkJXL58ubybi0Qi8b59+/6lZI9DBqZm95smu08UiqEBAN5++22r1NTU5WiVd1NTEzcmJuYXTX9ZIvBliRs3bmgUlBKxcuVK86SkpIXTp0+XJ95GRkYEERERBVeuXCGOIUqLnlG89LacpUuXmt64cWMlumiEYRiWn5//LCoqqoxQ9Penwc7OTic5Odl7xYoVzmhF1YsXL0bCwsLyioqKiI6iRttyXmkjl7u7u0F+fv5Ka2trhRF/ZGSE/91335XHxsbWqEqqvyooFAopLi7ONTo6mk7cL9nZ2flixYoVeUr2W76+jVxyQhVb/8zMzCjffvvtnLCwMHdiaXxXV9cLJpPZ+M9//rNJyUbOl8KiRYuMt2/fPj0oKGiGlZWVwg8iEokkN27cqN6zZ0+lkvKV17/1T06sYrMogLRM4+zZs/M8PT2VpjU6Ojp+Lyoqar506VLTeJsjiGAwGKbbtm2bvnTpUgcbGxulkX5FRUXre++99z///ve/lYUSf95mUYVGKrYXA0gLdz7++OP5NBpNZfk8j8cT9vX1Dff09AxxOJxhNps93N7ePgwgTYRZWlrq02g0fXNzcwNTU1N9dXu3ORzOwKeffvowOTlZWVT/12wvVmioZkO6np4e+cCBAzNWrVo13cPDw3a8HNBEIRaLJVVVVe03b95s+vLLLxtHRkaUhTB//YZ0eeNxPmEAIE1V7Nq1yz40NPSVlIQr49atW00pKSks4vcgEPzffsJA4SEafPQCQKqkt956y2batGkGNjY2+jQaTX/KlCn6ZmZm+iYmJvoA0jxyb2/vMJfLHeZwOMMdHR3DLS0tQ9euXetQowwc/xkfvRjzsAl8JoUIvL73JT+d8p/5mZQxD/3vh3XGefh/P8Wk4cv+H328638B28gWIGwyefAAAAAASUVORK5CYII=')";
f.style.cssText="position:relative;top:0;width:100%;background-color:#000;opacity:0.6;height:auto;color:#ffd42a;text-align:center;font-size:32px;padding:10px 0;font-family: Arial;";g.style.cssText="position:relative;clear:both;bottom:0;width:100%;background-color:#000;opacity:0.6;height:auto;color:#fff;text-align:center;font-size:20px;padding:10px 0;font-family: Arial;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#ffd42a;font-size:20px;width:100%;" href="'+c+'">'+c+"</a>";h.appendChild(k);h.appendChild(g);
e.appendChild(f);e.appendChild(h);document.body.appendChild(e)}m("animation");var l=m("camera"),k=m("config"),g=m("constraints"),e=m("controls"),n=m("data"),z=m("debug"),f=m("main"),t=m("physics"),s=m("print"),r=m("scenes"),p=m("transform"),F=m("util"),q=m("vec3"),v=null,x=null,A=null,L=new Float32Array(2),I=new Float32Array(3),y=new Float32Array(3);a.init=function(a){function g(){var a;a=p;var e=F,h=z,k=document.createElement("canvas");k.style.cssText="position: absolute;left:0px; top:0px;";if(da){var n=
document.createElement("canvas");n.style.cssText="z-index: 2; position:absolute; left:0px; top:0px; pointer-events: none;"}else n=null;f.init(k,n)?(x=k,e=document.getElementById(a),e||(s.error('Warning: canvas container "'+a+'" not found, appending to body'),e=document.body),e.appendChild(k),n&&e.appendChild(n),a=e):(e&&d("Browser could not initialize WebGL","For more info visit","http://blend4web.com/troubleshooting",h),a=null);a?(v=a,f.set_check_gl_errors(m),t&&(y?A=document.getElementById(y):(A=
document.createElement("div"),A.innerHTML=0,A.style.cssText="             position:absolute;            top: 23px;            right: 20px;            font-size: 45px;            line-height: 50px;            font-weight: bold;            color: #000;            z-index: 1;        ",document.body.appendChild(A)),f.set_fps_callback(c)),I&&b(),l(x,!0)):l(x,!1)}function h(a){a.keyCode==e.KEY_P&&(f.is_paused()?f.resume():f.pause())}function l(){}a=a||{};var p=null,m=!1,q=!1,r=!1,t=!1,y=null,z=null,F=!0,
I=!0,L=!0,S;for(S in a)switch(S){case "canvas_container_id":p=a.canvas_container_id;break;case "callback":l=a.callback;break;case "do_not_use_onload":break;case "gl_debug":m=a.gl_debug;break;case "show_hud_debug_info":q=a.show_hud_debug_info;break;case "sfx_mix_mode":r=a.sfx_mix_mode;break;case "show_fps":t=a.show_fps;break;case "fps_elem_id":y=a.fps_elem_id;break;case "error_purge_elements":z=a.error_purge_elements;break;case "report_init_failure":F=a.report_init_failure;break;case "pause_invisible":I=
a.pause_invisible;break;case "key_pause_enabled":L=a.key_pause_enabled;break;default:k.set(S,a[S])}L&&document.addEventListener("keydown",h,!1);k.set("show_hud_debug_info",q);k.set("sfx_mix_mode",r);var da=q||r||null;"complete"==document.readyState?window.setTimeout(g,0):window.addEventListener("load",g,!1);window.addEventListener("unload",function(){f.pause();n.cleanup()},!1)};a.get_canvas_container=function(){return v};a.set_onclick=function(a,b){var c=h(a);c.addEventListener("mouseup",function(){b(c.value)},
!1)};a.set_onchange=function(a,b){var c=h(a);c.addEventListener("change",function(){var a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=h(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=function(a,b,c,d){function f(a,c,d,g){1==d&&(d=.005*b,a=e.get_sensor_value(a,c,0),ka+="X"==g?-a*d:0,ha+="Y"==g?-a*d:0)}function h(a,c,d,f){1==d&&(a=e.get_sensor_value(a,c,1),c=.003*b,ca+="X"==f?-a*c:0,ja+="Y"==f?-a*c:0)}function k(a){return a[0]&&
(a[1]||a[2])}function n(c,d,f){if(!x||!e.get_sensor_value(c,"CAMERA_COLLISION",1)){if(1==f){f=e.get_sensor_value(c,d,0);var g=l.get_trans_speed(c);switch(d){case "FORWARD":v?S[0]=1:p.move_local(c,0,-a*g*f,0);break;case "BACKWARD":v?S[0]=-1:p.move_local(c,0,a*g*f,0);break;case "UP":v||p.move_local(c,0,0,-a*g*f);break;case "DOWN":v||p.move_local(c,0,0,a*g*f);break;case "LEFT":v?S[1]=1:p.move_local(c,-a*g*f,0,0);break;case "RIGHT":v?S[1]=-1:p.move_local(c,a*g*f,0,0);break;case "ROT_LEFT":s?l.rotate_pivot(c,
2*-b*f,0):l.rotate(c,2*b*f,0);break;case "ROT_RIGHT":s?l.rotate_pivot(c,2*b*f,0):l.rotate(c,2*-b*f,0);break;case "ROT_UP":s?l.rotate_pivot(c,0,2*-b*f):l.rotate(c,0,2*-b*f);break;case "ROT_DOWN":s?l.rotate_pivot(c,0,2*b*f):l.rotate(c,0,2*b*f)}}else switch(d){case "FORWARD":case "BACKWARD":v&&(S[0]=0);break;case "LEFT":case "RIGHT":v&&(S[1]=0)}v&&(t.set_character_move_dir(v,S[0],S[1]),l.get_angles(c,L),L[0]+=Math.PI,L[1]*=-1,t.set_character_rotation(v,L[0],L[1]))}}a||(a=1);b||(b=1);c||(c=1);var m=r.get_active_camera();
switch(l.get_move_style(m)){case l.MS_TARGET_CONTROLS:var s=!d,v=null;break;case l.MS_EYE_CONTROLS:s=!1;v=r.get_first_character();break;case l.MS_STATIC:return}d=e.create_elapsed_sensor();if(t.has_simulated_physics(m)){var x=e.create_collision_sensor(m,null,!0);e.create_sensor_manifold(m,"CAMERA_COLLISION",e.CT_CONTINUOUS,[d,x],null,function(a,b,c){1==c&&(b=e.get_sensor_payload(a,b,1),c=p.get_translation(a,I),q.sub(c,b,y),q.normalize(y,y),q.scale(y,.01,y),q.add(c,y,c),p.set_translation_v(a,c))})}if(v){var A=
p.get_translation(m),z=p.get_rotation(m),z=F.cam_quat_to_mesh_quat(z);A[1]-=.5;t.set_transform(v,A,z);g.append_stiff_trans(m,v,[0,.5,0]);var S=new Float32Array(2),da=!0;t.set_character_move_type(v,t.CM_FLY);e.create_kb_sensor_manifold(m,"TOGGLE_CHAR_MOVE_TYPE",e.CT_SHOT,e.KEY_C,function(){da=!da;t.set_character_move_type(v,da?t.CM_FLY:t.CM_WALK)})}var A=e.create_keyboard_sensor(e.KEY_W),z=e.create_keyboard_sensor(e.KEY_S),D=e.create_keyboard_sensor(e.KEY_A),ia=e.create_keyboard_sensor(e.KEY_D),R=
e.create_keyboard_sensor(e.KEY_R),w=e.create_keyboard_sensor(e.KEY_F),u=e.create_keyboard_sensor(e.KEY_UP),T=e.create_keyboard_sensor(e.KEY_DOWN),ma=e.create_keyboard_sensor(e.KEY_LEFT),W=e.create_keyboard_sensor(e.KEY_RIGHT);e.create_sensor_manifold(m,"FORWARD",e.CT_CONTINUOUS,[d,A],null,n);e.create_sensor_manifold(m,"BACKWARD",e.CT_CONTINUOUS,[d,z],null,n);s?(e.create_sensor_manifold(m,"ROT_UP",e.CT_CONTINUOUS,[d,u,R],k,n),e.create_sensor_manifold(m,"ROT_DOWN",e.CT_CONTINUOUS,[d,T,w],k,n),e.create_sensor_manifold(m,
"ROT_LEFT",e.CT_CONTINUOUS,[d,ma,D],k,n),e.create_sensor_manifold(m,"ROT_RIGHT",e.CT_CONTINUOUS,[d,W,ia],k,n)):(e.create_sensor_manifold(m,"UP",e.CT_CONTINUOUS,[d,R],k,n),e.create_sensor_manifold(m,"DOWN",e.CT_CONTINUOUS,[d,w],k,n),e.create_sensor_manifold(m,"LEFT",e.CT_CONTINUOUS,[d,D],k,n),e.create_sensor_manifold(m,"RIGHT",e.CT_CONTINUOUS,[d,ia],k,n),e.create_sensor_manifold(m,"ROT_UP",e.CT_CONTINUOUS,[d,u],k,n),e.create_sensor_manifold(m,"ROT_DOWN",e.CT_CONTINUOUS,[d,T],k,n),e.create_sensor_manifold(m,
"ROT_LEFT",e.CT_CONTINUOUS,[d,ma],k,n),e.create_sensor_manifold(m,"ROT_RIGHT",e.CT_CONTINUOUS,[d,W],k,n));var ea=0,A=e.create_mouse_wheel_sensor();e.create_sensor_manifold(m,"MOUSE_WHEEL",e.CT_LEVEL,[A],null,function(b,d,f){1==f&&(d=e.get_sensor_value(b,d,0),s?(f=l.get_eye(b),l.get_pivot(b,I),b=q.dist(I,f),ea+=-d*b*.1*a):(b=d*c,d=r.get_active_camera(),l.change_trans_speed(d,b)))});var H=0,A=e.create_touch_zoom_sensor();e.create_sensor_manifold(m,"TOUCH_ZOOM",e.CT_LEVEL,[A],null,function(b,c,d){1==
d&&s&&(c=e.get_sensor_value(b,c,0),d=l.get_eye(b),l.get_pivot(b,I),b=q.dist(I,d),H+=-c*b*.005*a)});e.create_sensor_manifold(m,"ZOOM_INTERPOL",e.CT_CONTINUOUS,[d],null,function(a,b,c){1==c&&(.001<Math.abs(ea)||.001<Math.abs(H))&&s&&(c=e.get_sensor_value(a,b,0),b=F.smooth(ea,0,c,.1),ea-=b,c=F.smooth(H,0,c,.15),H-=c,x&&e.get_sensor_value(a,"CAMERA_COLLISION",1)||p.move_local(a,0,b+c,0))});var ca=0,ja=0,A=e.create_mouse_move_sensor("X"),z=e.create_mouse_move_sensor("Y"),D=e.create_mouse_click_sensor();
e.create_sensor_manifold(m,"MOUSE_X",e.CT_LEVEL,[D,A],null,h,"X");e.create_sensor_manifold(m,"MOUSE_Y",e.CT_LEVEL,[D,z],null,h,"Y");var ka=0,ha=0,A=e.create_touch_move_sensor("X"),z=e.create_touch_move_sensor("Y");e.create_sensor_manifold(m,"TOUCH_X",e.CT_LEVEL,[A],null,f,"X");e.create_sensor_manifold(m,"TOUCH_Y",e.CT_LEVEL,[z],null,f,"Y");e.create_sensor_manifold(m,"ROT_INTERPOL",e.CT_CONTINUOUS,[d],null,function(a,b,c){if(1==c&&(.001<Math.abs(ca)||.001<Math.abs(ja)||.001<Math.abs(ka)||.001<Math.abs(ha))){var d=
e.get_sensor_value(a,b,0);b=F.smooth(ca,0,d,.08);c=F.smooth(ja,0,d,.08);ca-=b;ja-=c;var f=F.smooth(ka,0,d,.12),d=F.smooth(ha,0,d,.12);ka-=f;ha-=d;s?l.rotate_pivot(a,b+f,c+d):(l.rotate(a,.5*(b+f),.5*-(c+d)),v&&(l.get_angles(a,L),L[0]+=Math.PI,L[1]*=-1,t.set_character_rotation(v,L[0],L[1])))}});e.create_kb_sensor_manifold(m,"DEC_STEREO_DIST",e.CT_SHOT,e.KEY_LEFT_SQ_BRACKET,function(a){var b=l.get_stereo_distance(a);l.set_stereo_distance(a,.9*b)});e.create_kb_sensor_manifold(m,"INC_STEREO_DIST",e.CT_SHOT,
e.KEY_RIGHT_SQ_BRACKET,function(a){var b=l.get_stereo_distance(a);l.set_stereo_distance(a,1.1*b)})};a.disable_camera_controls=function(){for(var a=r.get_active_camera(),b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_INTERPOL".split(" "),c=0;c<b.length;c++)e.remove_sensor_manifold(a,b[c])};a.enable_object_controls=function(a){function b(a){return a[0]&&(a[1]||a[2])}function c(a,b,f){if(1==f)switch(f=
e.get_sensor_value(a,b,0),b){case "FORWARD":d?t.vehicle_throttle(a,1):p.move_local(a,0,0,1*f);break;case "BACKWARD":d?t.vehicle_throttle(a,-1):p.move_local(a,0,0,-1*f);break;case "LEFT":d?t.vehicle_steer(a,-1):p.move_local(a,1*f,0,0);break;case "RIGHT":d?t.vehicle_steer(a,1):p.move_local(a,-1*f,0,0)}else switch(b){case "FORWARD":case "BACKWARD":d&&t.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":d&&t.vehicle_steer(a,0)}}var d=t.is_vehicle_chassis(a)||t.is_vehicle_hull(a),f=e.create_elapsed_sensor(),
g=e.create_keyboard_sensor(e.KEY_W),h=e.create_keyboard_sensor(e.KEY_S),k=e.create_keyboard_sensor(e.KEY_A),l=e.create_keyboard_sensor(e.KEY_D),n=e.create_keyboard_sensor(e.KEY_UP),m=e.create_keyboard_sensor(e.KEY_DOWN),q=e.create_keyboard_sensor(e.KEY_LEFT),r=e.create_keyboard_sensor(e.KEY_RIGHT);e.create_sensor_manifold(a,"FORWARD",e.CT_CONTINUOUS,[f,g,n],b,c);e.create_sensor_manifold(a,"BACKWARD",e.CT_CONTINUOUS,[f,h,m],b,c);e.create_sensor_manifold(a,"LEFT",e.CT_CONTINUOUS,[f,k,q],b,c);e.create_sensor_manifold(a,
"RIGHT",e.CT_CONTINUOUS,[f,l,r],b,c)};a.disable_object_controls=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)e.remove_sensor_manifold(a,b[c])};a.enable_controls=function(a){e.register_keyboard_events(document,!1);e.register_mouse_events(a,!0);e.register_wheel_events(a,!0);e.register_touch_events(a,!0)};a.disable_controls=function(a){e.unregister_keyboard_events(document);e.unregister_mouse_events(a);e.unregister_wheel_events(a);e.unregister_touch_events(a)};a.enable_debug_controls=
function(){e.create_kb_sensor_manifold(null,"CAMERA_SHOT",e.CT_SHOT,e.KEY_K,function(){z.make_camera_frustum_shot()});e.create_kb_sensor_manifold(null,"LIGHT_SHOT",e.CT_SHOT,e.KEY_L,function(){z.make_light_frustum_shot()});e.create_kb_sensor_manifold(null,"TELEMETRY",e.CT_SHOT,e.KEY_T,function(){z.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===a||document.OA===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||document.msFullscreenElement===
a?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",d,!1);a.qj=a.qj||
a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.qj==a.webkitRequestFullScreen?a.qj(Element.ALLOW_KEYBOARD_INPUT):a.qj()};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||
window.document.PA?!0:!1};a.report_app_error=d;a.get_url_params=function(){var a=location.href.toString();if(-1==a.indexOf("?"))return null;for(var a=a.split("?")[1].split("&"),b={},c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]=1<d.length?d[1]:""}return b}};b4w.module.camera_anim=function(a,m){var b=m("camera"),c=m("controls"),h=m("scenes"),d=m("transform"),l=m("util"),k=new Float32Array(3),g=new Float32Array(3),e=new Float32Array(3),n=new Float32Array(4),z=m("vec3"),f=m("quat");a.track_to_target=function(a,h,m,p,F,q,v,x){if(a&&h){if(l.is_vector(h))var A=h;else A=e,d.get_object_center(h,!1,A);h=m||1;m=p||2;var L=F||1;F=q||1;g[0]=0;g[1]=-1;g[2]=0;var I=d.get_rotation_quat(a);q=l.quat_to_dir(I,g);p=b.get_angles(a);var y=d.get_translation(a);z.subtract(A,
y,k);z.normalize(k,k);var C=f.rotationTo(q,k,f.create());f.multiply(C,I,n);l.correct_cam_quat_up(n,!1);z.subtract(A,y,g);var B=z.length(g)*(1-1/m),A=Math.asin(k[1]);m=Math.acos(-k[2]/Math.abs(Math.cos(A)));0<k[0]&&(m=2*Math.PI-m);var G=m-p[0],K=A-p[1];e[0]=0;e[1]=0;e[2]=-1;m=d.get_rotation_quat(a);0>l.quat_to_dir(m,e)[1]?(K=0<q[1]?A-Math.PI+p[1]:A+Math.PI+p[1],G=0<G?-Math.PI+G:Math.PI+G):Math.abs(G)>Math.PI&&(G=0<G?G-2*Math.PI:G+2*Math.PI);var K=-K,N=0,A=c.create_elapsed_sensor();q=Math.abs(G/h);
h=Math.abs(K/h);var V=q>h?q:h,U=V+L,O=U+F,J=O+L,Q=G,Y=K,P=B;c.create_sensor_manifold(a,"TRACK_TO_TARGET",c.CT_CONTINUOUS,[A],null,function(a,e,f){if(f)if(f=c.get_sensor_value(a,e,0),N+=f,N<V){var g=G/V*f;f*=K/V;e=N/V;e=6*e*(1-e);g*=e;f*=e;Q-=g;Y-=f;b.rotate(a,g,f)}else N<U?(Q&&(b.rotate(a,Q,Y),Q=0,x&&x()),e=(N-V)/L,f=-B*f/L,P-=g,d.move_local(a,0,6*f*e*(1-e),0)):N<O?P&&(d.move_local(a,0,P,0),P=0):N<J?(e=(N-O)/L,f=B*f/L,f=6*f*e*(1-e),d.move_local(a,0,f,0)):(d.set_translation_v(a,y),c.remove_sensor_manifold(a,
e),v&&v())})}};a.auto_rotate=function(a,d){function e(d,f,g){if(1==g)switch(f=c.get_sensor_value(d,f,0),k){case b.MS_TARGET_CONTROLS:b.rotate_pivot(d,f*a,0);break;case b.MS_EYE_CONTROLS:b.rotate(d,f*a,0)}}function f(){c.remove_sensor_manifold(g,"AUTO_ROTATE");c.remove_sensor_manifold(g,"DISABLE_AUTO_ROTATE");d()}d=d||function(){};var g=h.get_active_camera(),k=b.get_move_style(g);if(k==b.MS_STATIC)throw"wrong camera type";if(c.check_sensor_manifold(g,"AUTO_ROTATE"))f();else{var l=c.create_mouse_move_sensor("X"),
n=c.create_mouse_move_sensor("Y"),m=c.create_mouse_click_sensor(),z=c.create_elapsed_sensor();c.create_sensor_manifold(g,"DISABLE_AUTO_ROTATE",c.CT_LEVEL,[l,n,m],function(a){return a[0]&&a[2]||a[1]&&a[2]},f);c.create_sensor_manifold(g,"AUTO_ROTATE",c.CT_CONTINUOUS,[z],function(a){return a[0]},e)}}};b4w.module.mixer=function(a,m){function b(){F=p.length=0;q=c();v=new Float32Array(q.length);x=new Float32Array(q.length);var a=s.get_speakers();if(a.length){p.push(h());for(var b=0;b<a.length;b++)p.push(l(a[b]));p.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function c(){for(var a=new Float32Array(100),b=0,c=0;100>c;c++)a[c]=20*Math.pow(1E3,b),b+=1/99;return a}
function h(){var a=d("MASTER");a.B.push(["VOLUME",s.get_volume(null),0,1,50,!1]);var b=s.get_compressor_params();b&&(a.B.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.B.push(["KNEE",b.knee,0,40,40,!1]),a.B.push(["RATIO",b.ratio,1,20,20,!1]),a.B.push(["ATTACK",b.attack,0,1,1E3,!1]),a.B.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=s.is_muted(null)?1:0;a.ic=-1;return a}function d(a){return{id:a,B:[],xe:0,mute:-1,ic:-1,ca:null}}function l(a){var b=d(t.get_object_name(a));b.mute=s.is_muted(a)?1:0;
b.ic=0;b.ca=a;return b}function k(a){if(a.ca){a.B.length=0;a.B.push(["VOLUME",s.get_volume(a.ca),0,1,50,!1]);var b=s.get_positional_params(a.ca);b&&(a.B.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.B.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.B.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=s.get_filter_params(a.ca))a.B.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.B.push(["EQ_Q",b.Q,0,10,100,!1]),a.B.push(["EQ_GAIN",b.gain,-70,30,100,!1]);r.clamp(a.xe,0,a.B.length-1)}}function g(a){for(var b=
0;b<p.length;b++){var c=p[b];if(c!=a&&1==c.ic)return!0}return!1}function e(a){for(var b=0;b<p.length;b++){var c=p[b];c!=a&&0==c.mute&&0==c.ic&&s.mute(c.ca,!1)}}function n(){if(0==p.length)return[0,-1];var a=8*Math.floor(F/8),b=a+7,a=r.clamp(a,0,p.length-1),b=r.clamp(b,0,p.length-1);return[a,b]}var z=m("controls");m("debug");var f=m("hud"),t=m("scenes"),s=m("sfx"),r=m("util"),p=[],F=0,q=null,v=null,x=null;a.enable_mixer_controls=function(){function a(b,c,d){if(1==d){var e=Boolean(z.get_sensor_value(b,
c,2))?-1:1,f=p[F];if(f)switch(d=f.B[f.xe],d[1]=d[5]?d[1]*Math.pow(d[3]/d[2],e/d[4]):d[1]+(d[3]-d[2])/d[4]*e,d[1]=r.clamp(d[1],d[2],d[3]),d[0]){case "VOLUME":"MASTER"!=f.id?s.set_volume(f.ca,d[1]):s.set_volume(null,d[1]);break;case "DIST_REF":e=s.get_positional_params(f.ca);e.dist_ref=d[1];s.set_positional_params(f.ca,e);break;case "ATTENUATION":e=s.get_positional_params(f.ca);e.attenuation=d[1];s.set_positional_params(f.ca,e);break;case "DIST_MAX":e=s.get_positional_params(f.ca);e.dist_max=d[1];s.set_positional_params(f.ca,
e);break;case "EQ_FREQ":e=s.get_filter_params(f.ca);e.freq=d[1];s.set_filter_params(f.ca,e);break;case "EQ_Q":e=s.get_filter_params(f.ca);e.Q=d[1];s.set_filter_params(f.ca,e);break;case "EQ_GAIN":e=s.get_filter_params(f.ca);e.gain=d[1];s.set_filter_params(f.ca,e);break;case "THRESHOLD":f=s.get_compressor_params();f.threshold=d[1];s.set_compressor_params(f);break;case "KNEE":f=s.get_compressor_params();f.knee=d[1];s.set_compressor_params(f);break;case "RATIO":f=s.get_compressor_params();f.ratio=d[1];
s.set_compressor_params(f);break;case "ATTACK":f=s.get_compressor_params();f.attack=d[1];s.set_compressor_params(f);break;case "RELEASE":f=s.get_compressor_params();f.release=d[1];s.set_compressor_params(f);break;default:throw"Unknown strip param";}"INC_DEC"==c?z.reset_timer_sensor(b,c,6,.3):z.reset_timer_sensor(b,c,6,0)}else z.reset_timer_sensor(b,c,6,10)}function c(a,b,d){if(1==d){d=Boolean(z.get_sensor_value(a,b,0))?-1:1;if(p.length){1==d&&F<p.length-1?F++:-1==d&&0<F&&F--;d=n();for(var e=d[0];e<=
d[1];e++)k(p[e])}"SWITCH_STRIP"==b?z.reset_timer_sensor(a,b,5,.3):z.reset_timer_sensor(a,b,5,0)}else z.reset_timer_sensor(a,b,5,10)}b();var d=z.create_keyboard_sensor(z.KEY_LEFT_SQ_BRACKET),h=z.create_keyboard_sensor(z.KEY_RIGHT_SQ_BRACKET),l=z.create_keyboard_sensor(z.KEY_SEMI_COLON),m=z.create_keyboard_sensor(z.KEY_SINGLE_QUOTE),t=z.create_keyboard_sensor(z.KEY_SHIFT),K=z.create_timer_sensor(.15),N=z.create_timer_sensor(.05),d=[d,h,l,m,t,K,N];z.create_sensor_manifold(null,"SWITCH_STRIP",z.CT_TRIGGER,
d,function(a){return(a[0]||a[1])&&!a[4]},c);z.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",z.CT_SHOT,d,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},c);z.create_sensor_manifold(null,"SWITCH_PARAM",z.CT_SHOT,d,function(a){return(a[0]||a[1])&&a[4]},function(a,b){var c=Boolean(z.get_sensor_value(a,b,0))?-1:1,d=p[F];d&&(1==c&&d.xe<d.B.length-1?d.xe++:-1==c&&0<d.xe&&d.xe--)});z.create_sensor_manifold(null,"INC_DEC",z.CT_TRIGGER,d,function(a){return(a[2]||a[3])&&!a[4]},a);z.create_sensor_manifold(null,
"INC_DEC_HOLD",z.CT_SHOT,d,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},a);z.create_sensor_manifold(null,"MUTE_SOLO",z.CT_SHOT,d,function(a){return(a[2]||a[3])&&a[4]},function(a,b){if(Boolean(z.get_sensor_value(a,b,2))){var c=p[F];c&&0<=c.mute&&("MASTER"!=c.id?0==c.mute?(c.mute=1,s.mute(c.ca,!0),1==c.ic&&(c.ic=0,g(c)||e(c))):(c.mute=0,g(c)||s.mute(c.ca,!1)):0==c.mute?(c.mute=1,s.mute(null,!0)):(c.mute=0,s.mute(null,!1)))}else if((c=p[F])&&0<=c.ic)if(0==c.ic){c.ic=1;s.mute(c.ca,!1);1==c.mute&&(c.mute=
0);for(var d=0;d<p.length;d++){var f=p[d];f!=c&&0==f.mute&&0==f.ic&&s.mute(f.ca,!0)}}else c.ic=0,g(c)?s.mute(c.ca,!0):e(c)});d=z.create_elapsed_sensor();z.create_sensor_manifold(null,"MIXER_DRAW",z.CT_CONTINUOUS,[d],null,function(){if(p[F])for(var a=n(),b=a[0];b<=a[1];b++){var c=p[b];f.draw_mixer_strip(c.id,b==F,b%8,c.B,c.xe,c.mute,c.ic);if(c.ca&&s.get_filter_params(c.ca)){s.get_filter_freq_response(c.ca,q,v,x);for(c=0;c<v.length;c++)v[c]=20*Math.log(v[c])/Math.LN10;f.plot_array("EQ",b%8,v,20,2E4,
-10,10)}}});d=z.create_timer_sensor(1);z.create_sensor_manifold(null,"MIXER_UPDATE",z.CT_TRIGGER,[d],null,function(){for(var a=n(),b=a[0];b<=a[1];b++)k(p[b])})}};b4w.module.npc_ai=function(a,m){function b(a,b){var c=b.destination,d=F;r.get_translation(b.empty,d);var h=q;r.get_translation(b.collider,h);var l=0;b.Og?l=b.Og:b.xd&&(l=b.xd,b.type==y&&(l*=.5),b.type==B&&(l*=a));switch(b.type){case y:if(b.random&&b.Zd){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var m=L,d=v,p=b.speed,t=b.rot_speed;r.get_rotation_quat(b.collider,m);g.transformQuat(f.AXIS_Z,m,d);d[1]=0;g.normalize(d,d);m=.5*p/Math.sin(t/2);p=g.dist(c,h);p<2*m&&g.scaleAndAdd(c,
d,2*m-p,c);b.Zd=!1}c[1]=h[1];l&&(c[1]+=l);break;case C:case B:b.random&&b.Zd&&(b.type==B?(b.speed=Math.random()+.1,m=b.Qv-b.Wv):m=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=h[1]+(Math.random()*m-.5*m),c[2]=10*Math.random()-5+d[2],b.Zd=!1),l&&(c[1]=h[1]+l)}var c=F,d=q,p=v,h=I,s=b.rig,m=b.collider,l=b.destination,z=b.speed,Z=b.actions,S=n.get_current_action(s);if(!n.is_play(s)||!Z.ph||-1==Z.ph.indexOf(S)){r.get_translation(m,c);var t=l[0]-c[0],da=l[2]-c[2],t=Math.sqrt(t*t+da*da);if(t>
2*z*a)b.state=20,f.xz_direction(l,c,p),Z=b.rig,n.is_animated(Z)&&(s=b.speed,z=n.get_current_frame_float(Z),Z=n.get_anim_length(Z),s*=Z/24*(1-z/Z),.9>t/s&&g.scaleAndAdd(l,p,s-t,l)),t=L,s=x,r.get_rotation_quat(b.collider,t),g.transformQuat(f.AXIS_Z,t,d),s[0]=d[0],s[1]=0,s[2]=d[2],g.normalize(s,s),z=g.dot(s,p),Z=a/(Math.abs(Math.acos(z))/Math.PI)*b.rot_speed*b.Cl,e.rotationTo(s,p,h),e.rotationTo(f.AXIS_Z,s,t),1<=Math.abs(z)?e.copy(t,h):(e.multiply(h,t,h),e.slerp(t,h,Math.min(Z,1),h)),p=a,b.type!=C&&
(p=Math.max(p,1/60),t=A,s=L,e.setAxisAngle(f.AXIS_X,-Math.asin(d[1]),s),e.setAxisAngle(f.AXIS_X,-Math.atan(b.xd/(b.speed*p)),t),e.slerp(s,t,p,t),e.multiply(h,t,h)),r.set_rotation_quat_v(m,h),d=v,m=x,f.quat_to_dir(h,f.AXIS_Z,d),g.scale(d,b.speed*a,m),g.add(m,c,m),m[1]=b.type!=y?(l[1]-c[1])*a*.1+c[1]:l[1],r.set_translation_v(b.collider,m);else if(b.type==y)Z.move?S&&-1!=Z.move.indexOf(S)&&n.is_play(s)?b.state=20:(b.state=10,b.Zd=!0):(b.state=10,b.Zd=!0);else if(b.type==B||b.type==C)b.Zd=!0;if(k(b)&&
(c=b.rig,!n.is_play(c))){h=null;switch(b.state){case 10:h=b.actions;h=h.ph?f.random_from_array(h.ph):null;break;case 20:h=n.get_current_action(b.rig),d=l=b.actions,d.sd&&-1==d.sd.indexOf(h)&&d.move&&-1!=d.move.indexOf(h)&&.33<Math.random()?(l=b.actions,h=l.sd[l.move.indexOf(h)]):(d=b.actions,d.move&&(-1!=d.move.indexOf(h)||!d.sd&&!d.Vd||!d.Vd&&!h||d.sd&&-1!=d.sd.indexOf(h)||d.Vd&&-1!=d.Vd.indexOf(h))?(l=b.actions,l.sd?(d=l.sd.indexOf(h),-1!=d?(h=d+1,h=h<l.move.length?h:0,h=l.move[h]):h=-1!=l.move.indexOf(h)?
h:f.random_from_array(l.move)):h=f.random_from_array(l.move)):(d=b.actions,h=d.Vd&&-1==d.Vd.indexOf(h)&&d.move&&-1==d.move.indexOf(h)?f.random_from_array(l.Vd):null))}h&&(n.apply(c,h),n.cyclic(c,!1),n.set_current_frame_float(c,0),n.play(c))}}}function c(a,b,c,d){if(d)if(1==c)switch(d.type){case C:a:{for(c=0;3>c;c++){var e=z.get_sensor_payload(a,b,c);if(e){b=e;break a}}b=void 0}a=100*b;d.xd=a<d.min_height?10:a>d.max_height?-10:0;break;case y:a=z.get_sensor_payload(a,b,0);d.xd=d.sp==a?0:1-100*a;d.sp=
a;break;case B:a=z.get_sensor_payload(a,b,0),"CLOSE_GROUND"==b?(d.xd=100*a-1,d.xd=.1>d.xd?.05:0):"CLOSE_WATER"==b&&(d.Og=100*a,d.Og=d.Og<d.Wv?-.02:d.Og>d.Qv?.02:0)}else d.xd=0}function h(){for(var a=0;a<p.length;a++){var b=p[a];d(b);l(b);b.rig&&n.get_current_action(b.rig)&&n.play(b.rig)}}function d(a){var b=[0,0,0],d=a.collider;switch(a.type){case C:var e=z.create_ray_sensor(d,b,[0,-100,0],!1,"TERRAIN"),f=z.create_ray_sensor(d,b,[0,-100,0],!1,"STONE"),b=z.create_ray_sensor(d,b,[0,-100,0],!1,"WATER"),
e=[e,f,b];z.create_sensor_manifold(d,"CLOSE_GROUND",z.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},c,a);break;case y:e=z.create_ray_sensor(d,[0,1,0],[0,-99,0],!1,"TERRAIN");e=[e];z.create_sensor_manifold(d,"CLOSE_GROUND",z.CT_CONTINUOUS,e,null,c,a);break;case B:e=z.create_ray_sensor(d,[0,1,0],[0,-99,0],!1,"TERRAIN"),b=z.create_ray_sensor(d,[0,0,0],[0,100,0],!1,"WATER"),e=[e],z.create_sensor_manifold(d,"CLOSE_WATER",z.CT_CONTINUOUS,[b],null,c,a),z.create_sensor_manifold(d,"CLOSE_GROUND",z.CT_CONTINUOUS,
e,null,c,a)}}function l(a){function b(c,d,e){1==e?(r.get_translation(a.empty,a.destination),a.Cl=4):a.Cl=1}var c=a.collider;if(a.type==y){var d=z.create_collision_sensor(c,"CONSTRUCTION",!1);z.create_sensor_manifold(c,"CONSTRUCTION_COLL",z.CT_CONTINUOUS,[d],null,b)}}function k(a){var b=a.rig;if(!n.is_play(b))return!0;b=n.get_current_action(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.ph)return!1;if(-1==c.ph.indexOf(b))break;break;case 20:if(!c.move||-1!=c.move.indexOf(b)||c.Vd&&
-1!=c.Vd.indexOf(b)||c.sd&&-1!=c.sd.indexOf(b))return!1;break;default:return!1}return!0}var g=m("vec3"),e=m("quat"),n=m("animation"),z=m("controls"),f=m("util"),t=m("scenes"),s=m("main"),r=m("transform"),p=[];new Float32Array(9);var F=new Float32Array(3),q=new Float32Array(3),v=new Float32Array(3),x=new Float32Array(3),A=new Float32Array(4),L=new Float32Array(4),I=new Float32Array(4),y=a.NT_WALKING=10,C=a.NT_FLYING=20,B=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=new Float32Array(3);
a.start=[];a.ended=[];a.Gi=[];a.xd=null;a.sp=null;a.Og=null;a.Zd=!0;a.Cl=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.Gi[b]=!1;p.push(a)};a.enable_animation=function(){if(p.length){h();var a=z.create_elapsed_sensor();z.create_sensor_manifold(p[0].collider,"ELAPSED",z.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,c,d){if(1==d)for(a=z.get_sensor_value(a,c,0),c=0;c<p.length;c++){d=p[c];var e=a;if(t.is_visible(d.obj))if(d.random)b(e,d);else{for(var f=s.global_timeline(),
g=0;g<d.path.length;g++)if(!d.ended[g]){d.Gi[g]||(d.Gi[g]=!0,d.destination[0]=d.path[g][0],d.destination[1]=d.path[g][1],d.destination[2]=d.path[g][2],d.start[g]=f+d.delay[g]);if(f<d.start[g])break;b(e,d);d.ended[g]=d.Zd;break}a:{for(e=0;e<d.path.length;e++)if(0==d.ended[e]){e=!1;break a}e=!0}if(e)for(e=0;e<d.path.length;e++)d.Gi[e]=!1,d.ended[e]=!1}}})}};a.disable_animation=function(){if(!(0>=p.length))for(var a=0;a<p.length;a++){var b=p[a];z.check_sensor_manifolds(b.collider)&&z.remove_sensor_manifolds(b.collider);
n.is_play(b.rig)&&n.stop(b.rig)}}};b4w.module.pointerlock=function(a,m){function b(){var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document)}function c(a){a.removeEventListener("mousedown",d,!1);a.removeEventListener("mouseup",l,!1);a.removeEventListener("mousemove",h,!1)}function h(a){q()&&(p[0]+=2*(a.clientX-s),p[1]+=2*(a.clientY-r),s=a.clientX,r=a.clientY);a.preventDefault()}function d(a){s=a.clientX;r=a.clientY;a.currentTarget.addEventListener("mousemove",
h,!1);a.preventDefault()}function l(a){a.currentTarget.removeEventListener("mousemove",h,!1);a.preventDefault()}function k(a,b){if(.01<Math.abs(p[0])||.01<Math.abs(p[1])){var c=e.get_sensor_value(a,b,0),d=t.smooth(p[0],0,c,.1),h=t.smooth(p[1],0,c,.1),c=f.get_first_character(),k=f.get_active_camera();g.rotate(k,4E-4*-d,4E-4*h);p[0]-=d;p[1]-=h;c&&(d=F,g.get_angles(k,d),d[0]+=Math.PI,d[1]*=-1,n.set_character_rotation(c,d[0],d[1]))}}var g=m("camera"),e=m("controls"),n=m("physics"),z=m("print"),f=m("scenes"),
t=m("util"),s=0,r=0,p=new Float32Array(2),F=new Float32Array(2),q=null;a.request_pointerlock=function(a,b,d,g,h){function l(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){c(a);a.addEventListener("mousemove",g,!1);var h=f.get_active_camera();if(!e.check_sensor_manifold(h,"SMOOTH_PL")){var n=e.create_elapsed_sensor();e.create_sensor_manifold(h,"SMOOTH_PL",e.CT_CONTINUOUS,[n],null,k)}b()}else a.removeEventListener("mousemove",g,!1),document.removeEventListener("pointerlockchange",
l,!1),document.removeEventListener("webkitpointerlockchange",l,!1),document.removeEventListener("mozpointerlockchange",l,!1),d()}b=b||function(){};d=d||function(){};h=h||function(){return!0};g=g||function(a){if(h()){var b=a.movementY||a.webkitMovementY||a.mozMovementY||0;p[0]+=a.movementX||a.webkitMovementX||a.mozMovementX||0;p[1]+=b}};document.addEventListener("pointerlockchange",l,!1);document.addEventListener("webkitpointerlockchange",l,!1);document.addEventListener("mozpointerlockchange",l,!1);
var n=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof n?n.apply(a):z.error("Pointer lock is not available")};a.exit_pointerlock=b;a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,c){b();q=c||function(){return!0};a.addEventListener("mousedown",d,!1);a.addEventListener("mouseup",l,!1);var g=f.get_active_camera();if(!e.check_sensor_manifold(g,
"SMOOTH_DRAG")){var h=e.create_elapsed_sensor();e.create_sensor_manifold(g,"SMOOTH_DRAG",e.CT_CONTINUOUS,[h],null,k)}};a.exit_mouse_drag=c};b4w.module.preloader=function(a){var m,b,c,h,d,l,k,g,e=null;a.create_simple_preloader=function(a){var g=null,f=null,k="#bf9221",l="#000",r;for(r in a)switch(r){case "canvas_container_id":g=a.canvas_container_id;break;case "background_container_id":f=a.background_container_id;break;case "bg_color":l=a.bg_color;break;case "bar_color":k=a.bar_color}a=document.createElement("div");r=document.createElement("div");var p=document.createElement("div"),F=document.createElement("div"),f=document.getElementById(f);
e=document.getElementById(g);a.style.cssText="         z-index: 4;        background-color: "+l+";        width: 100%;        height: 100%;        position: absolute;        margin: 0;        padding: 0;    ";r.style.cssText="         position: absolute;        left: 50%;        top: 82%;        width: 400px;        height: 20px;        margin-left: -200px;        margin-top: -10px;        border-style:solid;        border-width:2px;        border-color: "+k+";        border-radius: 6px;    ";p.style.cssText=
"         position: absolute;        left: 0px;        top: 1px;        width: 0px;        height: 18px;        background-color: "+k+";        border-radius: 4px;    ";F.style.cssText="         position: absolute;        left: 50%;        top: 50%;        width: 100%;        height: 100%;        margin-left: -200px;        margin-top: -10px;        text-align: center;        font-size: 17px;        color: #ffffff;        font-family: Verdana;    ";r.appendChild(p);r.appendChild(F);a.appendChild(r);
document.body.appendChild(a);m="SIMPLE";b=a;c=p;h=F;d=f};a.create_rotation_preloader=function(a){var c=null,f=null,g="rgba(0,0,0,0)",k="",r="",p;for(p in a)switch(p){case "canvas_container_id":c=a.canvas_container_id;break;case "background_container_id":f=a.background_container_id;break;case "frame_bg_color":g=a.frame_bg_color;break;case "frame_class":k=a.frame_class;break;case "anim_elem_class":r=a.anim_elem_class}a=document.createElement("div");p=document.createElement("div");var F=document.createElement("div"),
q=document.createElement("div"),f=document.getElementById(f);e=document.getElementById(c);a.style.cssText="         z-index: 4;        background-color: rgba(0,0,0,0);        width: 100%;        height: 100%;        position: absolute;        margin: 0;        padding: 0;    ";p.style.cssText="         position: absolute;        left: 50%;        top: 50%;        width: 117px;        height: 117px;        margin-left: -58px;        margin-top: -58px;        background-color: "+g+";    ";F.style.cssText=
"         position: absolute;        left: 0px;        top: 0px;        width: 100%;        height: 100%;        background-position: center;        background-repeat: no-repeat;    ";q.style.cssText="         position: absolute;        width: 100%;        height: 100%;        text-align: center;        margin-top: 38px;        font-size: 36px;        color: #ffffff;        font-family: Arial;        font-weight: bold;    ";F.className=r;p.appendChild(F);p.className=k;p.appendChild(q);a.appendChild(p);
document.body.appendChild(a);m="ROTATION";b=a;l=F;h=q;d=f};a.create_advanced_preloader=function(a){var l=a.preloader_width,l=l/(l-a.img_width),f=document.getElementById(a.preloader_bar_id),t=document.getElementById(a.fill_band_id),s=document.getElementById(a.preloader_caption_id),r=document.getElementById(a.preloader_container_id),p=document.getElementById(a.background_container_id);e=document.getElementById(a.canvas_container_id);m="ADVANCED";c=f;k=t;g=l;h=s;b=r;d=p};a.update_preloader=function(a){h.innerHTML=
a+"%";"SIMPLE"==m&&(c.style.width=a+"%");"ADVANCED"==m&&(c.style.width=a/g+"%",k.style.width=100-a+"%");"ROTATION"==m&&(l.style.transform="rotate("+a+"deg)");100==a&&(b.style.zIndex=0,e.style.zIndex=1,d&&(d.style.zIndex=0))}};b4w.module.storage=function(a,m){function b(a){d=a;try{l=window.localStorage}catch(b){h.warn("Applying chrome localStorage bug workaround"),l=null}l||(h.warn("localStorage is not available, initializing temporary storage"),l={})}function c(){return l[d]?JSON.parse(l[d]):{}}var h=m("__print"),d="",l=null;a.init=b;a.set=function(a,b){var e=c();e[a]=String(b);l[d]=JSON.stringify(e)};a.cleanup=function(){delete l[d]};a.get=function(a){var b=c();return b[a]?b[a]:""};a.debug=function(){h.log(c())};b("b4w")};
