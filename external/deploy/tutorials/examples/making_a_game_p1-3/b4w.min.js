b4w={module:{},register:function(a,n){var b=b4w.module;if(b[a])throw Error('Module "'+a+'" already registered');b[a]=n},require:function(a){var n=b4w.require,b=b4w.module[a];if(!b)throw Error('Module "'+a+'" not found');b.Zj||(b.Zj={},b(b.Zj,n));return b.Zj},module_check:function(a){return b4w.module[a]?!0:!1}};"object"==typeof module&&module.Ok&&(GLOBAL.b4w={module:{}});b4w.module.__version=function(a){function n(){return"28.11.2014 03:24:42"}a.version=function(){return"14.11"};a.type=function(){return"RELEASE"};a.date=n;a.timestamp=function(){var a=n(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.Ok&&b4w.module.__version(exports);b4w.module.__config=function(a,n){function b(){return b4w.module_check(a.yb.vi)}var c=n("__print"),g=n("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.Pt=g.ra(a.context);a.n={alpha_sort:!0,alpha_sort_threshold:.1,tp:5,$d:1E4,console_verbose:!1,do_not_load_resources:!1,Rj:!1,Zu:1.5,Yu:10,background_color:[0,0,0,0],force_selectable:!1,all_objs_selectable:!1,ff:.01,resolution_factor:1,yi:1,Gj:3,Tg:!1,Tk:!1,mi:!0,show_hud_debug_info:!1,
Zz:!0,ge:"DEPTH",anaglyph_use:!1,vj:!0,Mh:.5,jg:!0,glow:!0,yf:!0,Rf:!0,ag:!0,If:!0,gg:!0,Nf:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,Uj:!1,Wf:!0,Ch:!0,xa:!0,Ih:!0,water_dynamic:!0,shore_smoothing:!0,ng:!0,jf:1024,xl:512,max_bones:53,ar:!0,precision:"highp",deferred_rendering:!0,quality:a.P_HIGH,ck:!0,Te:!1,Fw:!1,Wl:!1,ao:!1,fr:!1,Ye:!1,$o:!1,Fn:!1};a.Bu=g.ra(a.n);a.Hd={ua:-1,so:!1,Qe:1};a.controls={vt:[5,5,5,5],wt:.1,Dw:1/120};a.Id={yw:15,Yp:!0,zl:!1,Ik:!1};a.ft=g.ra(a.Id);a.yb={shaders_dir:"../../shaders/",
Lx:"include/",tq:"shader_texts",vi:"built_in_data",smaa_search_texture_path:"",smaa_area_texture_path:"",ix:"./",hq:["b4w.min.js","b4w.full.min.js","webplayer.min.js","src/data.js"]};a.fb={enabled:!0,$d:60,Fg:""};a.Nw=g.ra(a.fb);a.Qh={Hl:1024,Qi:1024,ah:384};a.px=g.ra(a.Qh);a.yd={az:!0,gj:!1,dn:!1,Bn:!1,bo:!1};a.Kx=g.ra(a.yd);a.dh={enabled:!1,ly:"MAIN_OPAQUE",ky:0,Ox:"COLOR"};a.xu=g.ra(a.dh);a.ct=function(){var b=a.n,c=a.fb,h=a.Qh;switch(b.quality){case a.P_ULTRA:b.ge="DEPTH";b.shore_smoothing=!0;
b.glow=!0;b.yf=!0;b.Rf=!0;b.ag=!0;b.If=!0;b.vj=!0;b.Mh=1;b.jg=!0;b.Wf=!0;b.Ch=!0;b.xa=!0;b.Ih=!0;b.resolution_factor=1.75;h.Hl=2048;h.Qi=2048;b.Gj=3;b.mi=!0;b.Rj=!1;b.max_bones=53;b.precision="highp";b.water_dynamic=!0;b.ng=!0;b.antialiasing=!0;b.smaa=!0;b.Nf=!0;b.gg=!0;c.$d=120;break;case a.P_HIGH:b.ge="DEPTH";b.shore_smoothing=!0;b.glow=!0;b.yf=!0;b.Rf=!0;b.ag=!0;b.If=!0;b.vj=!0;b.Mh=.5;b.jg=!0;b.Wf=!0;b.Ch=!0;b.xa=!0;b.Ih=!0;b.resolution_factor=1;h.Hl=1024;h.Qi=1024;b.Gj=3;b.mi=!0;b.Rj=!1;b.max_bones=
53;b.precision="highp";b.water_dynamic=!0;b.ng=!0;b.antialiasing=!0;b.smaa=!1;b.Nf=!0;b.gg=!0;c.$d=60;break;case a.P_LOW:b.ge="NONE",b.shore_smoothing=!1,b.glow=!1,b.yf=!1,b.Rf=!1,b.ag=!1,b.If=!1,b.vj=!1,b.Mh=.5,b.jg=!1,b.Wf=!1,b.Ch=!1,b.xa=!1,b.Ih=!1,b.resolution_factor=1,h.Hl=512,h.Qi=512,b.Gj=2,b.mi=!1,b.Rj=!0,b.max_bones=53,b.precision="mediump",b.water_dynamic=!1,b.ng=!1,b.antialiasing=!1,b.smaa=!1,b.Nf=!1,b.gg=!1,c.$d=60}};a.set=function(b,g){switch(b){case "all_objs_selectable":a.n.all_objs_selectable=
g;break;case "alpha":a.context.alpha=g;break;case "alpha_sort":a.n.alpha_sort=g;break;case "alpha_sort_threshold":a.n.alpha_sort_threshold=g;break;case "allow_cors":a.n.Tg=g;break;case "anaglyph_use":a.n.anaglyph_use=g;break;case "animation_framerate":a.Hd.ua=g;break;case "antialiasing":a.n.antialiasing=g;break;case "assets_dds_available":a.Id.Ik=g;break;case "assets_min50_available":a.Id.zl=g;break;case "background_color":a.n.background_color=g;break;case "built_in_module_name":a.yb.vi=g;break;case "console_verbose":a.n.console_verbose=
g;break;case "context_antialias":a.context.antialias=g;break;case "debug_subs_enabled":a.dh.enabled=g;break;case "deferred_rendering":a.n.deferred_rendering=g;break;case "do_not_load_resources":a.n.do_not_load_resources=g;break;case "force_selectable":a.n.force_selectable=g;break;case "glow":a.n.glow=g;break;case "physics_enabled":a.fb.enabled=g;break;case "physics_uranium_path":a.fb.Fg=g;break;case "precision":a.n.precision=g;break;case "quality":a.n.quality=g;break;case "resolution_factor":a.n.resolution_factor=
g;break;case "sfx_mix_mode":a.yd.gj=g;break;case "shaders_dir":a.yb.shaders_dir=g;break;case "show_hud_debug_info":a.n.show_hud_debug_info=g;break;case "smaa":a.n.smaa=g;break;case "smaa_search_texture_path":a.yb.smaa_search_texture_path=g;break;case "smaa_area_texture_path":a.yb.smaa_area_texture_path=g;break;case "wireframe_debug":a.n.wireframe_debug=g;break;case "water_wireframe_debug":a.n.Uj=g;break;default:c.error("B4W config set - property unknown: "+b)}};a.get=function(b){switch(b){case "all_objs_selectable":return a.n.all_objs_selectable;
case "allow_cors":return a.n.Tg;case "alpha":return a.context.alpha;case "alpha_sort":return a.n.alpha_sort;case "alpha_sort_threshold":return a.n.alpha_sort_threshold;case "anaglyph_use":return a.n.anaglyph_use;case "animation_framerate":return a.Hd.ua;case "antialiasing":return a.n.antialiasing;case "assets_dds_available":return a.Id.Ik;case "assets_min50_available":return a.Id.zl;case "background_color":return a.n.background_color;case "built_in_module_name":return a.yb.vi;case "console_verbose":return a.n.console_verbose;
case "context_antialias":return a.context.antialias;case "debug_subs_enabled":return a.dh.enabled;case "deferred_rendering":return a.n.deferred_rendering;case "do_not_load_resources":return a.n.do_not_load_resources;case "force_selectable":return a.n.force_selectable;case "glow":return a.n.glow;case "physics_enabled":return a.fb.enabled;case "physics_uranium_path":return a.fb.Fg;case "precision":return a.n.precision;case "quality":return a.n.quality;case "resolution_factor":return a.n.resolution_factor;
case "sfx_mix_mode":return a.yd.gj;case "shaders_dir":return a.yb.shaders_dir;case "show_hud_debug_info":return a.n.show_hud_debug_info;case "smaa":return a.n.smaa;case "smaa_search_texture_path":return a.yb.smaa_search_texture_path;case "smaa_area_texture_path":return a.yb.smaa_area_texture_path;case "wireframe_debug":return a.n.wireframe_debug;case "water_wireframe_debug":return a.n.Uj;default:c.error("B4W config get - property unknown: "+b)}};a.reset=function(){a.context=g.ra(a.Pt);a.n=g.ra(a.Bu);
a.Id=g.ra(a.ft);a.fb=g.ra(a.Nw);a.Qh=g.ra(a.px);a.yd=g.ra(a.Kx);a.dh=g.ra(a.xu)};a.dp=b;a.Cx=function(){var d=a.yb,g=a.fb;if(b())d.smaa_search_texture_path="smaa_search_texture.png",d.smaa_area_texture_path="smaa_area_texture.png";else if(""==d.smaa_search_texture_path||""==d.smaa_area_texture_path||""==g.Fg){for(var h=null,k=document.getElementsByTagName("script"),f=0;f<k.length;f++){for(var p=k[f].src,v=0;v<d.hq.length;v++)if(0<=p.indexOf(d.hq[v])){h=p;break}if(null!==h)break}h||(c.error("Couldn't determine path to external resources, fallback to current page URL"),
h=document.location.href);k=h.indexOf("?");0<=k&&(h=h.substring(0,k));h=h.substring(0,h.lastIndexOf("/")+1)+d.ix;g.Fg=g.Fg||h+"uranium.js";d.smaa_search_texture_path=d.smaa_search_texture_path||h+"smaa_search_texture.png";d.smaa_area_texture_path=d.smaa_area_texture_path||h+"smaa_area_texture.png"}}};b4w.module.__boundings=function(a,n){function b(a,b){for(var c=a[0],e=a[1],d=a[2],f=a[0],h=a[1],m=a[2],q=3;q<a.length;q+=3)var k=a[q],g=a[q+1],y=a[q+2],c=Math.max(c,k),e=Math.max(e,g),d=Math.max(d,y),f=Math.min(f,k),h=Math.min(h,g),m=Math.min(m,y);b.max_x=c;b.max_y=e;b.max_z=d;b.min_x=f;b.min_y=h;b.min_z=m;return b}function c(a,b){b||(b=new Float32Array(24));var c=a.max_x,e=a.max_y,d=a.max_z,f=a.min_x,h=a.min_y,m=a.min_z;b[0]=f;b[1]=h;b[2]=m;b[3]=c;b[4]=h;b[5]=m;b[6]=c;b[7]=e;b[8]=m;b[9]=f;b[10]=
e;b[11]=m;b[12]=f;b[13]=h;b[14]=d;b[15]=c;b[16]=h;b[17]=d;b[18]=c;b[19]=e;b[20]=d;b[21]=f;b[22]=e;b[23]=d;return b}function g(a,b,c){k.add(b,c,a.t);k.scale(a.t,.5,a.t);a.ma=k.distance(a.t,b);return a}var d=n("__geometry"),l=n("__util"),h=n("__tsr"),k=n("vec3"),f=new Float32Array(24),p=new Float32Array(3),v=new Float32Array(3),m=new Float32Array(3);a.Nn=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.Ez=function(){return{max_x:1E12,min_x:-1E12,
max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.Xc=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.ho=function(a,b){var c=a.max_y,e=a.max_z,d=a.min_x,f=a.min_y,h=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,e);a.min_x=Math.min(b.min_x,d);a.min_y=Math.min(b.min_y,f);a.min_z=Math.min(b.min_z,h)};a.kt=b;a.nk=function(d,h,m){m||(m=a.Xc());d=c(d,f);l.ce(d,h,d);return b(d,m)};a.Ou=c;a.nB=function(b,c,d){d||
(d=a.Xc());var e=c.min_x,f=c.max_x,h=c.min_y,m=c.max_y,k=c.min_z;c=c.max_z;if(e>=b.max_x||f<=b.min_x||h>=b.max_y||m<=b.min_y||k>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,e);d.max_x=Math.min(b.max_x,f);d.min_y=Math.max(b.min_y,h);d.max_y=Math.min(b.max_y,m);d.min_z=Math.max(b.min_z,k);d.max_z=Math.min(b.max_z,c);return d};a.qB=function(b,c,d){d||(d=a.Xc());var e=b.max_x-b.min_x,f=b.max_y-b.min_y,h=b.max_z-b.min_z;d.min_x=
b.min_x-.5*(c-1)*e;d.max_x=b.max_x+.5*(c-1)*e;d.min_y=b.min_y-.5*(c-1)*f;d.max_y=b.max_y+.5*(c-1)*f;d.min_z=b.min_z-.5*(c-1)*h;d.max_z=b.max_z+.5*(c-1)*h;return d};a.pk=function(b,c,d){d||(d=a.fi());k.transformMat4(b.t,c,d.t);d.ma=b.ma*l.cj(c);return d};a.ok=function(a,b,c){c||(c={Be:new Float32Array(3),Ce:new Float32Array(3),De:new Float32Array(3),t:new Float32Array([0,0,0])});h.Wh(a.t,b,c.t);k.copy(a.Be,c.Be);k.copy(a.Ce,c.Ce);k.copy(a.De,c.De);h.Ij(c.Be,b,c.Be);h.Ij(c.Ce,b,c.Ce);h.Ij(c.De,b,c.De);
return c};a.Ck=function(a,b){return{ma:a,t:new Float32Array(b)}};a.fi=function(){return{t:new Float32Array([0,0,0]),ma:0}};a.Bk=function(a,b,c,e){return{Be:new Float32Array(a),Ce:new Float32Array(b),De:new Float32Array(c),t:new Float32Array([e[0],e[1],e[2]])}};a.mt=function(){return{t:new Float32Array([0,0,0]),ma:1E12}};a.Mu=function(a,b){var c=k.subtract(b.t,a.t,k.create());0==k.length(c)&&k.set(1,0,0,c);var e=k.normalize(c,k.create()),c=k.scale(e,a.ma,k.create());k.add(c,a.t,c);var d=k.scale(e,
-a.ma,k.create());k.add(d,a.t,d);var f=k.scale(e,b.ma,k.create());k.add(f,b.t,f);var h=k.scale(e,-b.ma,k.create());k.add(h,b.t,h);c=[c,d,f,h];e=k.normalize(e,k.create());d=c[0];f=c[0];for(h=1;h<c.length;h++){var m=k.dot(c[h],e);m<k.dot(d,e)&&(d=c[h]);m>k.dot(f,e)&&(f=c[h])}e=[d,f];c=e[0];e=e[1];a.t=k.scale(k.add(c,e,k.create()),.5,k.create());a.ma=k.length(k.subtract(e,c,k.create()))/2};a.On=function(a,b){var c=b.max_y,e=b.min_y,d=Math.max(0,c-e-2*a);return{ma:a,height:d,t:new Float32Array([0,(c+
e)/2,0])}};a.Qn=function(a,b){var c=b.max_y,e=b.min_y,d=Math.max(0,c-e);return{ma:a,height:d,t:new Float32Array([0,(c+e)/2,0])}};a.Pn=function(a,b){var c=b.max_y,e=b.min_y,d=Math.max(0,c-e);return{ma:a,height:d,t:new Float32Array([0,(c+e)/2,0])}};a.Iz=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.$w=function(a){for(var b=0,c=0,e=0,d=0,f=0,h=0,m=0,q=0,k=0;k<a.submeshes.length;k++){var g=a.submeshes[k];if(g.position.length){b=
d=g.position[0];c=f=g.position[1];e=h=g.position[2];break}}for(k=0;k<a.submeshes.length;k++)for(var g=a.submeshes[k],g=g.position,y=0;y<g.length/3;y++)var p=g[3*y],r=g[3*y+1],F=g[3*y+2],b=Math.max(p,b),c=Math.max(r,c),e=Math.max(F,e),d=Math.min(p,d),f=Math.min(r,f),h=Math.min(F,h),m=Math.max(Math.sqrt(p*p+r*r+F*F),m),q=Math.max(Math.sqrt(p*p+F*F),q);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=d;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=f;a.b4w_bounding_box.max_z=e;a.b4w_bounding_box.min_z=
h;a.b4w_bounding_sphere_radius=m;a.b4w_bounding_cylinder_radius=q};a.Fv=function(b){var c=b.subarray(0,3),f=b.subarray(6,9),e=b.subarray(12,15),h=b.subarray(18,21);b=k.subtract(f,c,p);k.normalize(b,b);var l=d.Hv(c,f,e,v),l=k.cross(l,b,l);k.normalize(l,l);var u=k.create(),s=k.create();k.subtract(f,c,m);s[0]=k.dot(m,b);s[1]=k.dot(m,l);f=k.create();k.subtract(e,c,m);f[0]=k.dot(m,b);f[1]=k.dot(m,l);e=k.create();k.subtract(h,c,m);e[0]=k.dot(m,b);e[1]=k.dot(m,l);h=a.fi();e=[u,s,f,e];u=g(h,e[0],e[1]);for(h=
2;h<e.length;h++)if(k.distance(u.t,e[h])>u.ma){for(var q=u,u=e,s=e[h],f=h-1,q=g(q,s,u[0]),K=1;K<=f;K++)if(k.distance(q.t,u[K])>q.ma){for(var H=q,q=u,y=s,J=u[K],r=K-1,H=g(H,y,J),F=0;F<=r;F++)if(k.distance(H.t,q[F])>H.ma){var G=y,W=J,T=q[F],S=k.subtract(W,T,m),S=k.squaredLength(S),R=k.subtract(G,T,m),L=k.squaredLength(R),R=k.subtract(G,W,m),n=k.squaredLength(R),R=S*(L+n-S),Q=L*(n+S-L),S=n*(S+L-n),L=R+Q+S;k.copy(G,H.t);k.scale(H.t,R/L,H.t);k.scaleAndAdd(H.t,W,Q/L,H.t);k.scaleAndAdd(H.t,T,S/L,H.t);H.ma=
k.distance(H.t,G)}q=H}u=q}h=u;b=k.scale(b,h.t[0],m);k.scaleAndAdd(b,l,h.t[1],b);k.add(b,c,h.t);return h}};b4w.module.__compat=function(a,n){function b(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}var c=n("__config"),g=n("__extensions"),d=n("__print"),l=n("__util");a.zx=function(a){var k=c.Hd,f=c.n,p=c.context,v=c.Qh,m=c.yd;f.jf=a.getParameter(a.MAX_TEXTURE_SIZE);f.xl=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var x=Boolean(g.Cv());b("Firefox/28.0")&&(b("Linux")||b("Macintosh"))&&(d.warn("Firefox 28 detected, applying depth hack"),x=!1);b("iPad")||b("iPhone")?(d.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),
p.alpha||(f.background_color[3]=1),f.fr=!0,f.smaa=!1,f.yf=!1,f.precision="highp",f.$o=!0):b("Mac OS X")&&b("Safari")&&!b("Chrome")&&(d.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),m.dn=!0,m.Bn=!0);b("Windows")&&(b("Firefox/33")||b("Chrome/40")||b("Chrome/41"))&&(d.warn("Condititions for clear procedural skydome hack detected"),f.Fn=!0);if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||
navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))d.warn("Mobile detected, applying glsl loops unroll hack, applying various hacks for video textures."),f.Te=!0,f.Ye=!0,b("iPad")||b("iPhone")||(d.warn("Mobile (not iOS) detected, disable playback rate for video textures."),m.bo=!0);10>a.getParameter(a.MAX_VARYING_VECTORS)&&(d.warn("Not enough varyings, disable shadows on blend objects"),f.ao=
!0);if(p=g.Go())b("Macintosh")&&-1<a.getParameter(p.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(d.warn("OS X / Intel HD 3000 detected, applying depth and glsl loops unroll hacks"),x=!1,f.Te=!0),-1<a.getParameter(p.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(p.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(d.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),x=!1,k.so=!0),-1<a.getParameter(p.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(p.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&
(d.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),f.precision="highp",f.ge="NONE"),-1<a.getParameter(p.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&-1<a.getParameter(p.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(d.warn("Qualcomm Adreno detected, applying shader constants hack."),f.Wl=!0,-1<a.getParameter(p.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(d.warn('Qualcomm Adreno305 detected, set "highp" precision.'),f.precision="highp"),-1<a.getParameter(p.UNMASKED_RENDERER_WEBGL).indexOf("330")&&
(d.warn('Qualcomm Adreno330 detected, set "highp" precision.'),f.precision="highp")),-1<a.getParameter(p.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(p.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&(d.warn("NVIDIA Tegra 3 detected, force low quality for LEVELS_OF_QUALITY nodes."),f.Tk=!0);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(d.warn("Vertex textures are not allowed. Disabling vertex textures"),f.ck=!1);x||(f.deferred_rendering=!1,f.Wf=!1,f.Ch=!1,f.xa=!1,f.Ih=!1,f.water_dynamic=
!1,f.shore_smoothing=!1,f.ng=!1,f.smaa=!1);f.ar=Boolean(g.Ho());k=l.clamp(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),128,Infinity);f.max_bones=l.trunc((k-50)/4);f.bB=l.trunc((k-50)/2);0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(f.precision="mediump");!window.ActiveXObject&&"ActiveXObject"in window&&(d.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),v.ah=512);128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(d.warn("Not enough fragment uniforms, force low quality for LEVELS_OF_QUALITY nodes."),
f.Tk=!0)}};b4w.module.__constraints=function(a,n){function b(a){var b={};b.type=a;return b}function c(a,b){a.Za&&a.Za.K&&g(a.Za.K,a);if(b.K){var r=b.K;if(-1==r.Dd.indexOf(a))r.Dd.push(a);else throw"Descendant object override is forbidden";}a.Za=b}function g(a,b){var r=a.Dd.indexOf(b);if(-1!=r)a.Dd.splice(r,1);else throw"No descendant object";}function d(a,b,c){switch(b.type){case 1:var d=a.d.quat,f=b.K.d.G;c=b.K.d.quat;b.ee?(t.copy(b.ee,d),t.multiply(c,d,d)):t.copy(c,d);x.transformMat4(b.offset,f,a.d.e);a.d.scale=
b.nq*b.K.d.scale;break;case 9:var q=a.d.e,d=a.d.quat,f=b.K.d.G;c=b.K.d.quat;t.multiply(t.invert(b.sf,b.sf),d,d);t.multiply(c,d,d);x.transformMat4(b.offset,f,q);t.copy(c,b.sf);break;case 10:q=a.d.e;d=a.d.quat;f=b.K.d.G;c=b.K.d.quat;t.multiply(t.invert(b.sf,b.sf),d,d);t.multiply(c,d,d);x.transformMat4(b.offset,f,q);t.copy(c,b.sf);var d=a.d.quat,q=b.K.d.quat,g=x.transformQuat(m.AXIS_Y,d,e),H=t.invert(q,s),n=x.transformQuat(g,H,B),Z=A;Z[0]=n[0];Z[1]=0;Z[2]=n[2];f=x.length(Z);H=-Z[2]/f;H=Math.acos(H)*
m.sign(Z[0]);f/=x.length(n);f=Math.acos(f)*m.sign(n[1]);n=!1;H<-b.An&&(H=-b.An,n=!0);H>b.Cn&&(H=b.Cn,n=!0);f<-b.Dn&&(f=-b.Dn,n=!0);f>b.zn&&(f=b.zn,n=!0);n&&(b=Math.sin(f),f=Math.cos(f),n=Math.sin(H),H=Math.cos(H),Z=B,Z[0]=f*n,Z[1]=b,Z[2]=-f*H,x.transformQuat(Z,q,Z),b=t.rotationTo(g,Z,s),t.multiply(b,d,d),t.normalize(d,d));"CAMERA"==a.d.type&&(b=x.transformQuat(m.AXIS_Y,c,B),k(a,b));break;case 12:q=a.d.e;d=a.d.quat;f=b.K.d.G;H=b.K.d.e;a=b.Qx;n=e;g=s;x.transformMat4(b.offset,f,n);m.smooth_v(n,q,c,a,
q);b=e;x.sub(H,q,b);x.normalize(b,b);Z=d;q=y;H=q.subarray(0,3);f=q.subarray(3,6);n=q.subarray(6,9);x.copy(b,f);x.negate(f,f);x.normalize(f,f);Boolean(.999999<Math.abs(x.dot(b,m.AXIS_Y)))?(b=z.fromQuat(t.normalize(Z,g),J),x.copy(b.subarray(0,3),H)):x.cross(m.AXIS_Y,f,H);x.normalize(H,H);x.cross(H,f,n);x.normalize(n,n);t.fromMat3(q,g);t.normalize(g,g);m.xq(g,d,c,.16*a,d);break;case 2:d=a.d.quat;H=u;c=s;p(b.K,b.qt,!0,H,c);b.ee?(t.copy(b.ee,d),t.multiply(c,d,d)):t.copy(c,d);m.Wh(b.offset,1,c,H,a.d.e);
break;case 3:q=a.d.e;d=a.d.quat;c=b.K.d.e;l(q,d,c);"CAMERA"==a.d.type&&k(a,m.AXIS_Y);break;case 4:q=a.d.e;d=a.d.quat;c=b.target;l(q,d,c);"CAMERA"==a.d.type&&k(a,m.AXIS_Y);break;case 5:q=a.d.e;d=a.d.quat;c=b.K.d.e;d=h(q,d,c,b.ud,r);g=x.dist(q,c);if(b=d?g+b.ud:g>b.Ah?g-b.Ah:g<b.ud?g-b.ud:0)x.sub(c,q,e),x.normalize(e,e),x.scale(e,b,e),x.add(q,e,q);"CAMERA"==a.d.type&&k(a,m.AXIS_Y);break;case 6:q=a.d.e;d=a.d.quat;c=b.target;d=h(q,d,c,b.ud,r);g=x.dist(q,c);if(b=d?g+b.ud:g>b.Ah?g-b.Ah:g<b.ud?g-b.ud:0)x.sub(c,
q,e),x.normalize(e,e),x.scale(e,b,e),x.add(q,e,q);"CAMERA"==a.d.type&&k(a,m.AXIS_Y);break;case 7:f=b.K.d.G;x.transformMat4(b.offset,f,a.d.e);break;case 8:H=b.K.d.e;q=a.d.e;x.add(H,b.offset,q);break;case 13:d=a.d.quat;f=b.K.d.G;c=b.K.d.quat;b.ee?(t.copy(b.ee,d),t.multiply(c,d,d)):t.copy(c,d);x.transformMat4(b.offset,f,a.d.e);break;case 11:c=b.K.d,c=v.Of(c.e,c.scale,c.quat,K),v.multiply(c,b.Vq,c),q=a.d.e,q[0]=c[0],q[1]=c[1],q[2]=c[2],a.d.scale=c[3],d=a.d.quat,d[0]=c[4],d[1]=c[5],d[2]=c[6],d[3]=c[7]}}
function l(a,b,r){var c=e;m.quat_to_dir(b,m.AXIS_MY,c);x.normalize(c,c);var d=B;x.subtract(r,a,d);x.normalize(d,d);a=u;m.mq(c,d,a);t.multiply(a,b,b)}function h(a,b,r,c,d){var f=!1,q=e;m.quat_to_dir(b,m.AXIS_MY,q);x.normalize(q,q);var h=B;x.subtract(r,a,h);a=x.length(h);x.normalize(h,h);x.dot(q,h)<Math.cos(d)&&(x.scale(h,-1,h),f=!0);a>c-.001&&(c=m.mq(q,h,u),t.multiply(c,b,b),t.normalize(b,b));return f}function k(a,b){var r=a.d.quat,c=f(r,b,s);t.multiply(c,r,r)}function f(a,b,r){a=z.fromQuat(a,y);var c=
e;c[0]=a[3];c[1]=a[4];c[2]=a[5];if(.999<Math.abs(x.dot(b,c)))return t.identity(r),r;b=x.cross(b,c,c);x.normalize(b,b);0<a[7]&&(b[0]*=-1,b[1]*=-1,b[2]*=-1);c=B;c[0]=a[0];c[1]=a[1];c[2]=a[2];x.normalize(c,c);t.rotationTo(c,b,r);return r}function p(a,b,r,c,e){var d=a.d,f=d.Pe,h=d.fc[b];b=h.eh;a=a.pose.bones[h.Ml];var h=a.Qm,m=u,g=d.cc,y=d.bc,k=d.Ub,B=d.Tb,p=g[4*b+1],l=g[4*b+2],A=g[4*b+3],J=y[4*b+1],w=y[4*b+2],I=y[4*b+3];m[0]=(1-f)*g[4*b]+f*y[4*b];m[1]=(1-f)*p+f*J;m[2]=(1-f)*l+f*w;m[3]=(1-f)*A+f*I;g=
s;y=q;g[0]=k[4*b];g[1]=k[4*b+1];g[2]=k[4*b+2];g[3]=k[4*b+3];y[0]=B[4*b];y[1]=B[4*b+1];y[2]=B[4*b+2];y[3]=B[4*b+3];t.slerp(g,y,f,g);f=K;v.Gx(m,f);v.Vl(g,f);r?(r=H,v.translate(h,a.Is,r),v.multiply(f,r,f)):v.multiply(f,h,f);v.multiply(d.Tc,f,f);c[0]=f[0];c[1]=f[1];c[2]=f[2];c[3]=f[3];e&&(e[0]=f[4],e[1]=f[5],e[2]=f[6],e[3]=f[7])}var v=n("__tsr"),m=n("__util"),x=n("vec3"),t=n("quat"),z=n("mat3");n("mat4");a.lz=1;a.kz=2;a.oz=3;a.pz=4;a.fz=5;a.gz=6;a.mz=7;a.ez=8;a.jz=9;a.iz=10;a.Yc=11;a.hz=12;a.nz=13;var e=
new Float32Array(3),B=new Float32Array(3),A=new Float32Array(3),u=new Float32Array(4),s=new Float32Array(4),q=new Float32Array(4),K=new Float32Array(16),H=new Float32Array(16),y=new Float32Array(9),J=new Float32Array(9),K=new Float32Array(8),r=9*Math.PI/10;a.pr=r;a.Ym=function(a,r,e,f,q){var h=b(1);h.K=r;h.offset=new Float32Array(e);h.nq=q||1;h.ee=f?new Float32Array(f):null;c(a,h);d(a,h,0)};a.Xm=function(a,r,e,f,q){var h=b(2);h.K=r;h.qt=e;h.offset=new Float32Array(f);h.ee=q?new Float32Array(q):null;
c(a,h);d(a,h,0)};a.Vs=function(a,r,e,f){var q=b(9),h=a.d.quat,m=r.d.quat;q.K=r;q.offset=new Float32Array(e);q.sf=new Float32Array(m);f&&(t.copy(f,h),t.multiply(m,h,h));c(a,q);d(a,q,0)};a.Us=function(a,r,e,f,q,h,m,g){var y=b(10),k=a.d.quat,B=r.d.quat;y.K=r;y.offset=new Float32Array(e);y.sf=new Float32Array(B);y.An=q;y.Cn=h;y.Dn=m;y.zn=g;f&&(t.copy(f,k),t.multiply(B,k,k));c(a,y);d(a,y,0)};a.Ts=function(a,r,e,f){var q=b(12);q.K=r;q.offset=new Float32Array(e);q.Qx=f;c(a,q);d(a,q,0)};a.Xs=function(a,r,
e,f){var q=b(13);q.K=r;q.offset=new Float32Array(e);q.nq=1;q.ee=f?new Float32Array(f):null;c(a,q);d(a,q,0)};a.Zs=function(a,r){var e=b(3);e.K=r;c(a,e);d(a,e,0)};a.$s=function(a,r){var e=b(4);e.target=new Float32Array(r);c(a,e);d(a,e,0)};a.Qs=function(a,r,e,f){var q=b(5);q.K=r;q.ud=e;q.Ah=f;c(a,q);d(a,q,0)};a.Rs=function(a,r,e,f){var q=b(6);q.target=new Float32Array(r);q.ud=e;q.Ah=f;c(a,q);d(a,q,0)};a.Ws=function(a,r,e){var f=b(7);f.K=r;f.offset=new Float32Array(e);c(a,f);d(a,f,0)};a.Ps=function(a,
r,e){var f=b(8);f.K=r;f.offset=new Float32Array(e);c(a,f);d(a,f,0)};a.Os=function(a,r,e){var f=b(11);f.K=r;f.Vq=new Float32Array(e);c(a,f);d(a,f,0)};a.Cy=function(a,b){a.Za&&d(a,a.Za,b)};a.jx=l;a.kx=h;a.correct_up=k;a.Gz=f;a.remove=function(a){a.Za.K&&g(a.Za.K,a);a.Za=null};a.pd=function(a){return a.Za?a.Za.type:null};a.vA=function(a){return a.Za&&a.Za.K?a.Za.K:null};a.od=function(a){return a.Za&&11==a.Za.type?a.Za.Vq:null};a.vv=p};b4w.module.__controls=function(a,n){function b(a){return{type:a,value:0,Sb:null,ul:null,tl:null,bj:null,Pd:!1,key:0,Ob:"",wk:null,Bl:!1,vk:function(){},uk:null,Gn:function(){},Nc:null,gm:new Float32Array(3),Nk:new Float32Array(3),sl:!1,cq:function(){},axis:"",ac:0,Cg:new Float32Array(3),tj:new Float32Array(4),threshold:0,aq:new Float32Array(4),pi:0,oi:0,lq:0,qi:0,Eh:0,en:!1}}function c(a,b){var r;if(a.bj){r=a.ul;for(var c=a.tl,e=0;e<r.length;e++)c[e]=r[e].value;r=a.bj(c)}else r=!1;r||(a.value=Number(b))}
function g(a){a=y.indexOf(a);-1<a?y.splice(a,1):B.error("Wrong object")}function d(a,b){for(var r=0,c=0;c<b.length;c++)for(var e=b[c].xe,d=0;d<e.length;d++)for(var E=e[d].Lc,f=0;f<E.length;f++)E[f]===a&&r++;return r}function l(a,b){switch(a.type){case 80:A.remove_collision_test(a.wk,a.Ob,a.vk);a.Pd=!0;break;case 90:A.clear_collision_impulse_test(a.uk);a.Pd=!0;break;case 100:A.remove_ray_test(a.Nc,a.Ob,a.gm,a.Nk,a.sl),a.Pd=!0}var r=b.indexOf(a);-1<r&&b.splice(r,1)}function h(a){for(var b=0;b<J.length;b++){var r=
J[b];20==r.type&&a.keyCode==r.key&&c(r,1)}D&&a.preventDefault()}function k(a){for(var b=0;b<J.length;b++){var r=J[b];20==r.type&&0==a.keyCode&&16==r.key&&c(r,0);20==r.type&&a.keyCode==r.key&&c(r,0)}D&&a.preventDefault()}function f(a){for(var b=!1,r=null,e=0;e<J.length;e++){var d=J[e];50==d.type&&(c(d,1),d.Sb=a.which);160==d.type&&(b||(r=u.pick_object(a.clientX,a.clientY),b=!0),d.value=r==d.Nc?1:0)}ga&&a.preventDefault()}function p(a){for(var b=0;b<J.length;b++){var r=J[b];50==r.type&&c(r,0);160==
r.type&&r.en&&(r.value=0)}ga&&a.preventDefault()}function v(a){var b=a.clientX,r=a.clientY;G=b;W=r;for(var b=b-T,r=r-S,e=Math.sqrt(b*b+r*r),d=0;d<J.length;d++){var f=J[d];if(40===f.type)switch(f.axis){case "X":c(f,b);break;case "Y":c(f,r);break;case "XY":c(f,e)}}ga&&a.preventDefault()}function m(a){var b=a.wheelDelta||-40*a.detail,b=b*H.Dw;F+=b;for(b=0;b<J.length;b++){var r=J[b];30===r.type&&c(r,F)}V&&a.preventDefault()}function x(a){a=a.targetTouches;if(1==a.length){var b=a[0];a=b.pageX;for(var b=
b.pageY,r=!1,c=null,e=0;e<J.length;e++){var d=J[e];160==d.type&&(r||(c=u.pick_object(a,b),r=!0),d.value=c==d.Nc)}O[0]=a;O[1]=-1;Q[0]=b;Q[1]=-1}else 1<a.length&&(Z=N=z(a),O[0]=a[0].pageX,O[1]=a[1].pageX,Q[0]=a[0].pageY,Q[1]=a[1].pageY);R.set(O);L.set(Q)}function t(a){var b=a.targetTouches;if(0!==b.length){if(1===b.length){R[0]=b[0].pageX;R[1]=-1;L[0]=b[0].pageY;L[1]=-1;var b=R[0]-O[0],r=L[0]-Q[0],e=Math.sqrt(b*b+r*r);if(-1!=O[1]&&-1!=Q[1]){var d=R[0]-O[1],f=L[0]-Q[1],E=Math.sqrt(d*d+f*f);E<e&&(b=d,
r=f,e=E)}for(d=0;d<J.length;d++)if(f=J[d],60===f.type)switch(f.axis){case "X":c(f,b);break;case "Y":c(f,r);break;case "XY":c(f,e)}}else if(1<b.length)for(R[0]=b[0].pageX,R[1]=b[1].pageX,L[0]=b[0].pageY,L[1]=b[1].pageY,Z=z(b),b=Z-N,d=0;d<J.length;d++)f=J[d],70===f.type&&c(f,b);w&&a.preventDefault()}}function z(a){var b=a[0],r=a[1];a=b.pageX;var b=b.pageY,c=r.pageX,r=r.pageY;return Math.sqrt((a-c)*(a-c)+(b-r)*(b-r))}var e=n("__config"),B=n("__print"),A=n("__physics"),u=n("__scenes"),s=n("__util"),q=
n("vec3"),K=n("quat"),H=e.controls,y=[],J=[],r={},F=0,G=0,W=0,T=0,S=0,R=new Float32Array(2),L=new Float32Array(2),O=new Float32Array(2),Q=new Float32Array(2),Z=0,N=0,da=0,P=!1,ja=0,D=!1,ga=!1,V=!1,w=!1;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.update=function(b,e){da=b;for(var d=0;d<J.length;d++){var f=J[d],w=b,h=e;if(h)switch(f.type){case 110:var E=f.Nc,m=E.d.e,E=E.d.quat,g=q.dist(f.Cg,m),k=f.aq;K.invert(f.tj,k);K.multiply(E,k,k);K.normalize(k,k);k=Math.abs(2*Math.acos(k[3]));
g/=h;f.pi=s.smooth(g,f.pi,h,.3);f.Sb[0]=g;g=k/h;f.oi=s.smooth(g,f.oi,h,.3);f.Sb[1]=g;f.pi>=f.threshold||f.oi>=f.lq?c(f,1):c(f,0);q.copy(m,f.Cg);K.copy(E,f.tj);f.ac=w;break;case 120:E=f.Nc;m=E.d.e;E=Math.abs(m[1]-f.Cg[1])/h;f.qi=s.smooth(E,f.qi,h,.3);f.Sb=E;f.qi>=f.threshold?c(f,1):c(f,0);q.copy(m,f.Cg);f.ac=w;break;case 130:w-f.ac>=f.Eh&&(c(f,1),f.ac=w);break;case 140:f.ac||(f.ac=w);c(f,w-f.ac);f.ac=w;break;case 150:c(f,w)}}for(d=0;d<y.length;d++)for(h=y[d],f=h.xe,w=0;w<f.length;w++)if(m=f[w],m.Yq!=
ja){m.Yq=ja;for(var E=m,g=E.Lc,k=E.ux,B=0;B<g.length;B++)k[B]=g[B].value;var E=E.tw(k),g=m,k=g.kp,p=B=void 0;switch(g.type){case a.CT_CONTINUOUS:E?p=B=1:1==k?p=B=-1:B=0;break;case a.CT_TRIGGER:E&&-1==k?p=B=1:E||1!=k?B=0:p=B=-1;break;case a.CT_SHOT:E&&-1==k?p=B=1:E||1!=k?B=0:(B=0,p=-1);break;case a.CT_LEVEL:B=g.jp!=E?1:0;break;default:s.da("Wrong sensor manifold type: "+g.type)}p&&(g.kp=p);if(g=B)if(k=h==r?null:h,P=!1,m.callback(k,m.id,g,m.ut),m.jp=E,P){d=-1;break}}for(d=0;d<y.length;d++)for(h=y[d],
f=h.xe,w=0;w<f.length;w++)for(m=f[w],h=m.Lc,m=0;m<h.length;m++)switch(E=h[m],E.type){case 30:c(E,0);break;case 40:c(E,0);break;case 60:c(E,0);break;case 70:c(E,0);break;case 130:c(E,0)}F=0;T=G;S=W;O.set(R);Q.set(L);N=Z;ja++};a.create_custom_sensor=function(a){var r=b(10);c(r,a);return r};a.create_keyboard_sensor=function(a){var r=b(20);r.key=a;return r};a.create_collision_sensor=function(a,r,e){if(!a||!a.j)return B.error("Wrong collision object"),null;var d=b(80);d.wk=a;d.Ob=r||"ANY";d.Bl=e;d.vk=
function(a,b){c(d,a);a&&b&&e&&(d.Sb=d.Sb||new Float32Array(3),d.Sb[0]=b[0],d.Sb[1]=b[1],d.Sb[2]=b[2])};d.Pd=!0;return d};a.create_collision_impulse_sensor=function(a){if(!a||!a.j)return B.error("Wrong collision impulse object"),null;var r=b(90);r.uk=a;r.Gn=function(a){c(r,a)};r.Pd=!0;return r};a.create_ray_sensor=function(a,r,e,d,f){if(!a)return B.error("Wrong collision object"),null;var w=b(100);w.Nc=a;w.gm=r;w.Nk=e;w.sl=d;w.Ob=f||"ANY";w.cq=function(a,b){c(w,a);a&&(w.Sb=b)};w.Pd=!0;return w};a.create_mouse_click_sensor=
function(){return b(50)};a.create_mouse_wheel_sensor=function(){return b(30)};a.create_mouse_move_sensor=function(a){var r=b(40);r.axis=a||"XY";return r};a.create_touch_move_sensor=function(a){var r=b(60);r.axis=a||"XY";return r};a.create_touch_zoom_sensor=function(){return b(70)};a.create_motion_sensor=function(a,r,c){if(!a)return B.error("Wrong collision object"),null;var e=b(110);e.Nc=a;var d=a.d.e;a=a.d.quat;e.aq=new Float32Array(4);e.Cg=new Float32Array(d);e.tj=new Float32Array(a);e.pi=0;e.oi=
0;e.threshold=r;e.lq=c;e.ac=0;e.Sb=new Float32Array([0,0]);return e};a.create_vertical_velocity_sensor=function(a,r){if(!a)return B.error("Wrong collision object"),null;var c=b(120);c.Nc=a;var e=a.d.quat;c.Cg=new Float32Array(a.d.e);c.tj=new Float32Array(e);c.qi=0;c.threshold=r;c.ac=0;c.Sb=0;return c};a.create_timer_sensor=function(a){var r=b(130);r.Eh=a;r.ac=da;return r};a.reset_timer_sensor=function(a,b,c,e){a=a||r;e=e||0;a=a.Ac;if(!a||!a[b])return B.error("reset_timer_sensor(): wrong object"),
null;b=a[b].Lc[c];if(!b)return B.error("reset_timer_sensor(): sensor not found"),null;b.ac=da+e};a.create_elapsed_sensor=function(){var a=b(140);a.ac=0;return a};a.create_timeline_sensor=function(){return b(150)};a.create_selection_sensor=function(a,r){var c=b(160);c.Nc=a;c.en=r;return c};a.tx=c;a.get_sensor_value=function(a,b,c){a=a||r;a=a.Ac;if(!a||!a[b])return B.error("get_sensor_value(): wrong object"),null;b=a[b].Lc[c];return b?b.value:(B.error("get_sensor_value(): sensor not found"),null)};
a.get_sensor_payload=function(a,b,c){a=a||r;a=a.Ac;if(!a||!a[b])return B.error("get_sensor_payload(): wrong object"),null;b=a[b].Lc[c];return b?b.Sb:(B.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){y=[];J=[];r={};da=0};a.check_sensor_manifold=function(a,b){a=a||r;if(!a.Ac)return!1;if(b&&a.Ac[b])return!0;if(!b)for(var c in a.Ac)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||r;var c=a.Ac,e=a.xe;if(b){var f=c[b];if(f){for(var w=f.Lc,E=0;E<w.length;E++)1===
d(w[E],y)&&l(w[E],J);delete c[b];f=e.indexOf(f);-1<f?e.splice(f,1):s.da("Incorrect manifolds array");Object.getOwnPropertyNames(c).length||g(a)}}else{for(b in c){f=c[b];w=f.Lc;for(E=0;E<w.length;E++)1===d(w[E],y)&&l(w[E],J);delete c[b];f=e.indexOf(f);-1<f?e.splice(f,1):s.da("Incorrect manifolds array")}g(a);P=!0}};a.create_sensor_manifold=function(a,b,c,e,f,w,E){a=a||r;a.Ac=a.Ac||{};a.xe=a.xe||[];var q=a.Ac,G=a.xe,h=q[b];if(h){e=h.Lc;for(var m=0;m<e.length;m++)1===d(e[m],y)&&l(e[m],J);h=G.indexOf(h);
-1<h?G.splice(h,1):s.da("Incorrect manifolds array")}c={id:b,type:c,Lc:e.slice(0),tw:f,ux:Array(e.length),callback:w,ut:E,kp:-1,jp:0,Yq:-1};q[b]=c;G.push(c);-1==y.indexOf(a)&&y.push(a);a=c.Lc;for(b=0;b<a.length;b++){q=a[b];if(q.Pd){switch(q.type){case 80:A.append_collision_test(q.wk,q.Ob,q.vk,q.Bl);break;case 90:A.apply_collision_impulse_test(q.uk,q.Gn);break;case 100:A.append_ray_test(q.Nc,q.Ob,q.gm,q.Nk,q.sl,q.cq)}q.Pd=!1}-1==J.indexOf(q)&&J.push(q)}P=!0};a.Kk=function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];
return a[a.length-1]};a.Au=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<y.length;a++){var b=y[a],r=b.Ac,b=b.xe,c;for(c in r)delete r[c];b.splice(0,b.length)}for(a=0;a<J.length;a++)l(J[a],J),a--;y.splice(0,y.length)};a.debug=function(){B.log(String(y.length)+" objects with manifolds",y);B.log(String(J.length)+" sensors",J);for(var a=[],b=[],r=0;r<J.length;r++){var c=J[r];80==c.type&&a.push(c);100==c.type&&b.push(c)}B.log(String(a.length)+
" collision sensors",a);B.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",h,!1);a.addEventListener("keyup",k,!1);D=b};a.register_mouse_events=function(a,b){a.addEventListener("mousedown",f,!1);a.addEventListener("mouseup",p,!1);a.addEventListener("mousemove",v,!1);ga=b};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",m,!1);a.addEventListener("DOMMouseScroll",m,!1);V=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",
x,!1);a.addEventListener("touchmove",t,!1);document.addEventListener("touchstart",function(){});w=b};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",h,!1);a.removeEventListener("keyup",k,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",f,!1);a.removeEventListener("mouseup",p,!1);a.removeEventListener("mousemove",v,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",m,!1);a.removeEventListener("DOMMouseScroll",m,!1)};a.unregister_touch_events=
function(a){a.removeEventListener("touchstart",x,!1);a.removeEventListener("touchmove",t,!1);document.removeEventListener("touchstart",function(){})}};b4w.module.__curve=function(a,n){function b(a,b,c,d,g){var v=d.length;g||(g=new Float32Array(v));for(var m=v+a,x=new Float32Array(m),t=1;t<=m-1;t++)x[t-1]=b>=c[t-1]&&b<c[t+1-1]?1:0;for(var z=2;z<=a;z++)for(t=1;t<=m-z;t++)x[t-1]=(0!=x[t-1]?(b-c[t-1])*x[t-1]/(c[t+z-1-1]-c[t-1]):0)+(0!=x[t+1-1]?(c[t+z-1]-b)*x[t+1-1]/(c[t+z-1]-c[t+1-1]):0);b==c[m-1]&&(x[v-1]=1);a=0;for(t=1;t<=v;t++)a+=x[t-1]*d[t-1];for(t=1;t<=v;t++)g[t-1]=0!=a?x[t-1]*d[t-1]/a:0;return g}function c(a){a=a.$i;return a[a.length-1]}function g(a){a=
a.Vn;return a[a.length-1]}var d=n("__util");a.mu=function(a){var c={},d=a.data;a=d.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var f=a.order_u;c.be=f;a=a.points;var g=a.length/5,v=[],m=g+f,g=g+2;v[0]=0;for(var x=2;x<=m;x++)v[x-1]=x>f&&x<g?v[x-2]+1:v[x-2];c.$i=v;if("2D"==d.dimensions)c.Xd=!1;else if("3D"==d.dimensions)c.Xd=!0;else throw"Wrong curve dimensions";f=[];v=[];for(d=0;d<a.length;d+=5)f.push(a[d]),f.push(a[d+1]),f.push(a[d+2]),c.Xd&&f.push(a[d+3]),v.push(a[d+4]);c.Ak=
f;c.Am=v;a=[];for(var d=c.Ak,f=c.Xd?4:3,v=c.Am,m=c.$i,g=c.be,x=d.length/f,t=x+g,z=0,e=m[t-1]/999,B=0;1E3>B;B++){5E-6>m[t-1]-z&&(z=m[t-1]);for(var A=b(g,z,m,v),u=0;u<f;u++)for(var s=a[f*B+u]=0;s<x;s++)a[f*B+u]+=A[s]*d[f*s+u];z+=e}f=c.Xd?4:3;v=new Float32Array(1E3);v[0]=0;for(d=1;1E3>d;d+=1)m=a[(d-1)*f],g=a[(d-1)*f+1],x=a[(d-1)*f+2],t=a[d*f],z=a[d*f+1],e=a[d*f+2],v[d]=v[d-1]+Math.sqrt((t-m)*(t-m)+(z-g)*(z-g)+(e-x)*(e-x));c.Vn=v;return c};a.ay=function(a,d,g){g||(g=[]);var f=d,p=Math.max(f,0);d=p=Math.min(f,
c(a));var f=a.Ak,p=a.Xd?4:3,v=a.Am,m=a.$i,x=a.be;a=f.length/p;var t=a+x;5E-6>m[t-1]-d&&(d=m[t-1]);t=new Float32Array(a);b(x,d,m,v,t);for(d=0;d<p;d++)for(v=g[d]=0;v<a;v++)g[d]+=t[v]*f[p*v+d]};a.Yx=function(a,b,c){c||(c=[]);var d=a.Ak,g=a.Xd?4:3,v=a.Am,m=a.$i,x=a.be;a=d.length/g;var t=a+x;5E-6>m[t-1]-b&&(b=m[t-1]);var t=new Float32Array(a),z=b;b=t;var e=v.length;b||(b=new Float32Array(e));var B=new Float32Array(e),A=new Float32Array(e),u=B,s=A;u||(u=new Float32Array(e));s||(s=new Float32Array(e));for(var q=
e+x,K=new Float32Array(q),H=new Float32Array(q),y=1;y<=q-1;y++)K[y-1]=z>=m[y-1]&&z<m[y+1-1]?1:0;z==m[q-1]&&(K[e-1]=1);for(var J=2;J<=x;J++)for(y=1;y<=q-J;y++){var r=0!=K[y-1]?K[y-1]/(m[y+J-1-1]-m[y-1]):0,F=0!=K[y+1-1]?-K[y+1-1]/(m[y+J-1]-m[y+1-1]):0,G=0!=H[y-1]?(z-m[y-1])*H[y-1]/(m[y+J-1-1]-m[y-1]):0,W=0!=H[y+1-1]?(m[y+J-1]-z)*H[y+1-1]/(m[y+J-1]-m[y+1-1]):0;K[y-1]=(0!=K[y-1]?(z-m[y-1])*K[y-1]/(m[y+J-1-1]-m[y-1]):0)+(0!=K[y+1-1]?(m[y+J-1]-z)*K[y+1-1]/(m[y+J-1]-m[y+1-1]):0);H[y-1]=r+F+G+W}for(y=1;y<=
e;y++)u[y-1]=K[y-1],s[y-1]=H[y-1];m=0;for(x=1;x<=e;x++)m+=B[x-1]*v[x-1];z=0;for(x=1;x<=e;x++)z+=A[x-1]*v[x-1];for(x=1;x<=e;x++)b[x-1]=0!=m?A[x-1]*v[x-1]/m+B[x-1]*v[x-1]*z/(m*m):0;for(v=0;v<g;v++)for(m=c[v]=0;m<a;m++)c[v]+=t[m]*d[g*m+v]};a.oB=c;a.$x=g;a.Zx=function(a,b){if(0>=b)return 0;var k=c(a);if(b>=g(a))return k;var f=a.Vn,p=d.si(f,b,0,f.length-1);return k*(p+(b-f[p])/(f[p+1]-f[p]))/1E3}};b4w.module.__dds=function(a,n){function b(a,b,c,d){var f=new Uint16Array(4),e=new Uint16Array(c*d),g=0,h=0,k=0,p=h=g=0,q=0,l=0,H=0,y=c/4;d/=4;for(var J=0;J<d;J++)for(var r=0;r<y;r++)k=b+4*(J*y+r),f[0]=a[k],f[1]=a[k+1],g=f[0]&31,h=f[0]&2016,p=f[0]&63488,q=f[1]&31,l=f[1]&2016,H=f[1]&63488,f[2]=5*g+3*q>>3|5*h+3*l>>3&2016|5*p+3*H>>3&63488,f[3]=5*q+3*g>>3|5*l+3*h>>3&2016|5*H+3*p>>3&63488,g=a[k+2],h=4*J*c+4*r,e[h]=f[g&3],e[h+1]=f[g>>2&3],e[h+2]=f[g>>4&3],e[h+3]=f[g>>6&3],h+=c,e[h]=f[g>>8&3],e[h+1]=f[g>>
10&3],e[h+2]=f[g>>12&3],e[h+3]=f[g>>14],g=a[k+3],h+=c,e[h]=f[g&3],e[h+1]=f[g>>2&3],e[h+2]=f[g>>4&3],e[h+3]=f[g>>6&3],h+=c,e[h]=f[g>>8&3],e[h+1]=f[g>>10&3],e[h+2]=f[g>>12&3],e[h+3]=f[g>>14];return e}function c(a,c,d,g){var z=new Int32Array(d,0,31),e,B,A,u,s,q;if(542327876!=z[0])return h.error("Invalid magic number in DDS header"),0;if(!z[20]&4)return h.error("Unsupported format, must contain a FourCC code"),0;e=z[21];switch(e){case k:B=8;A=c?c.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case f:B=16;A=
c?c.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case p:B=16;A=c?c.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return h.error("Unsupported FourCC code:",l(e)),null}q=1;z[2]&131072&&!1!==g&&(q=Math.max(1,z[7]));u=z[4];s=z[3];z=z[1]+4;if(c)for(e=0;e<q;++e)g=Math.max(4,u)/4*Math.max(4,s)/4*B,c=new Uint8Array(d,z,g),a.compressedTexImage2D(a.TEXTURE_2D,e,A,u,s,0,c),z+=g,u=Math.max(.5*u,1),s=Math.max(.5*s,1);else if(e==k)Math.max(4,u),Math.max(4,s),c=new Uint16Array(d),d=b(c,z/2,u,s),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,u,s,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,d),g&&a.generateMipmap(a.TEXTURE_2D);else return h.error("No manual decoder for",l(e),"and no native support"),0;return q}function g(a,b,d,f,g,e){var h=new XMLHttpRequest;h.open("GET",d,!0);h.responseType="arraybuffer";h.onload=function(){if(200==h.status){a.bindTexture(a.TEXTURE_2D,f);var d=c(a,b,h.response,g);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}e&&
e(f)};h.send(null);return f}function d(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function l(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var h=n("__print"),k=d("DXT1"),f=d("DXT3"),p=d("DXT5");a.aA=b;a.Ny=c;a.Lo=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.zv=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case k:b=6;break;case f:case p:b=4;break;default:h.error("Unsupported FourCC code:",l(a))}return b};
a.WA=g;a.VA=function(a,b,c,d){var f=a.createTexture();g(a,b,c,f,!0,d);return f}};b4w.module.__debug=function(a,n){function b(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function c(a,b){typeof a!=typeof b&&h.da("Structure assertion failed: incompatible types");for(var c in a)c in b||h.da("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||h.da("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&h.da("Structure assertion failed: incompatible types for key "+c)}var g=
n("__extensions"),d=n("__print"),l=n("__textures"),h=n("__util"),k=null,f={},p=!1,v={},m=[],x=-1,t=null,z=!1;a.Lm={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.Wb=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(f[a[d]]=d)}k=a};a.Dt=function(a){if(p){var b=k.getError();if(b!=k.NO_ERROR){if(b in f)throw"B4W Error: "+b+", gl."+f[b]+
" ("+a+")";throw"Unknown GL error: "+b+" ("+a+")";}}};a.At=function(){if(p)switch(k.checkFramebufferStatus(k.FRAMEBUFFER)){case k.FRAMEBUFFER_COMPLETE:break;case k.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case k.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case k.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case k.FRAMEBUFFER_UNSUPPORTED:d.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:d.error("B4W Error: FRAMEBUFFER CHECK FAILED")}};a.xn=function(){if(-1!=x)return x;k.bindFramebuffer(k.FRAMEBUFFER,k.createFramebuffer());var a=l.Ei("DEBUG",l.Og);l.resize(a,1,1);k.framebufferTexture2D(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,a.Ab,a.Fa,0);k.checkFramebufferStatus(k.FRAMEBUFFER)!=k.FRAMEBUFFER_COMPLETE?(x=!0,d.warn("B4W warning: depth-only issue was found")):x=!1;k.bindFramebuffer(k.FRAMEBUFFER,
null);return x};a.Et=function(a,c,e){if(p&&!k.getShaderParameter(a,k.COMPILE_STATUS))throw e=b(e),d.error("B4W Error: shader compilation failed:\n"+e+"\n"+k.getShaderInfoLog(a)+" ("+c+")"),"Engine failed: see above for error messages";};a.Ft=function(a,c,e,f,q,h){if(p&&!k.getProgramParameter(a,k.LINK_STATUS)){var m=g.zo();m&&(q=m.getTranslatedShaderSource(e),h=m.getTranslatedShaderSource(f));q=b(q);h=b(h);d.error("B4W Error: shader linking failed:\n"+q+"\n\n\n"+h+"\n"+k.getProgramInfoLog(a)+" ("+
c+")");throw"Engine failed: see above for error messages";}};a.set_check_gl_errors=function(a){p=a};a.bA=function(a){v[a]=a in v?v[a]+1:1};a.update=function(){for(var a in v)d.log(a,v[a]),v[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(h.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}m.push(a)};a.msg=function(){for(var a=1,b=0;b<m.length;b++){var c=m[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=
arguments[b],h.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);m.push(c)};var e=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},f=Math.max(0,performance.now()-1E3*a),q=0;q<m.length;q++){var g=m[q];a=g[0];if(!(a<f)){var h=String(g[1]);c[h]||(c[h]=e[b++%e.length]);a=["%c"+(a/1E3).toFixed(6),c[h],h];for(h=2;h<g.length;h++)a.push(g[h]);d.log.apply(this,a)}}m.splice(0)};a.plot_telemetry=
function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-1E3*a),e=0;e<m.length;e++){var f=m[e];a=f[0];if(!(a<c))for(var g=2;g<f.length;g++){var h=String(f[1]);3<f.length&&(h+="_"+String(g-2));b[h]||(b[h]=h+"\n");b[h]+=String(a)+" "+f[g]+"\n"}}a="";for(h in b)a+=b[h]+"\n\n";d.log(a);m.splice(0)};a.Jz=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&
b("gecko")&&b("firefox");case "msie":return b("mozilla")&&b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(h.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.Cz=function(a,b){typeof a!=b&&h.da("Type assertion failed: value type is not a {"+b+"}:",a)};a.Az=c;a.Bz=function(a){z?c(a,
t):z=!0;t=a}};b4w.module.__extensions=function(a,n){function b(a){if(a in d)return d[a];var b=g.getExtension(a)||null;d[a]=b;c.log("%cGET EXTENSION","color: #"+(b?"0a0":"a00"),a);return b}var c=n("__print"),g=null,d={};a.Wb=function(a){g=a};a.Ho=function(){return b("WEBGL_compressed_texture_s3tc")||b("WEBKIT_WEBGL_compressed_texture_s3tc")||b("MOZ_WEBGL_compressed_texture_s3tc")};a.Cv=function(){return b("WEBGL_depth_texture")||b("WEBKIT_WEBGL_depth_texture")||b("MOZ_WEBGL_depth_texture")};a.sv=function(){return b("EXT_texture_filter_anisotropic")||
b("WEBKIT_EXT_texture_filter_anisotropic")||b("MOZ_EXT_texture_filter_anisotropic")};a.zo=function(){return b("WEBGL_debug_shaders")};a.Go=function(){return b("WEBGL_debug_renderer_info")};a.Ao=function(){return b("OES_element_index_uint")};a.Lv=function(){return b("OES_standard_derivatives")};a.cleanup=function(){d={}}};b4w.module.__graph=function(a){function n(a,c,d){d||(d=null);if(b(a,c))throw"Graph already has node with given ID";a.ya.push(c,d)}function b(a,b){for(var c=a.ya,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function c(a,c,d,e){e||(e=null);if(b(a,c)&&b(a,d))a.sa.push(c,d,e);else throw"Wrong node IDs";}function g(a,c){if(!b(a,c))throw"Node not found";for(var d=a.ya,e=0;e<d.length;e+=2)d[e]==c&&(d.splice(e,2),e-=2)}function d(a){a=a.ya;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}
function l(a,b){for(var c=a.ya,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function h(a){var b=[],c={};k(a,c);for(var d=a.ya,e=0;e<d.length;e+=2)0==A(a,d[e])&&f(a,d[e],c,b);return{ya:b,sa:a.sa.slice(0)}}function k(a,b){for(var c=a.ya,d=0;d<c.length;d+=2)b[c[d]]=!1}function f(a,b,c,d){if(!c[b]){c[b]=!0;for(var q=0;q<B(a,b);q++)f(a,u(a,b,q),c,d);d.unshift(b,e(a,b))}}function p(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var e=0;e<B(a,b);e++){var f=u(a,b,e);p(a,f,c,d)}if(20==d||30==d)for(e=
0;e<A(a,b);e++)f=s(a,b,e),p(a,f,c,d)}}function v(a){var b=a.ya;a=a.sa;for(var c=[],d=[],e=[],f=0;f<b.length;f++)e[b[2*f]]=f,c.push(f,b[2*f+1]);for(f=0;f<a.length;f+=3)d.push(e[a[f]],e[a[f+1]],a[f+2]);return{ya:c,sa:d}}function m(a,b,c){if(c.Dc==c.ae){for(var d=0,e=0;d<c.ae;d++)-1!=c.ed[d]&&(a[e]=d,b[e]=c.ed[d],e++);return!0}if(c.ae>c.hg||c.me>c.ne||c.yg>c.Ag||c.xg>c.zg)return!1;for(var e=d=-1,f=!1;!f&&x(c,J,d,e);)if(d=J[0],e=J[1],t(c,d,e)){var q;q=c;f={};f.mh=q.mh;f.nh=q.nh;f.Dl=q.Dl;f.Ii=q.Ii;f.ae=
q.ae;f.hg=q.hg;f.be=q.be;f.Dc=f.kj=q.Dc;f.xg=q.xg;f.yg=q.yg;f.me=q.me;f.zg=q.zg;f.Ag=q.Ag;f.ne=q.ne;f.Sg=-1;f.ed=q.ed;f.Je=q.Je;f.Ve=q.Ve;f.We=q.We;f.pf=q.pf;f.qf=q.qf;f.zj=q.zj;q.zj[0]+=1;var f=q=f,g=d,h=e,y=f.mh,k=f.nh,p=f.ae,H=f.hg,l=f.ed,v=f.Je,K=f.Ve,n=f.We,V=f.pf,w=f.qf;z(g<p);z(h<H);z(f.Dc<p);z(f.Dc<H);p=++f.Dc;f.Sg=g;K[g]||(K[g]=p,f.xg++,V[g]&&f.me++);V[g]||(V[g]=p,f.yg++,K[g]&&f.me++);n[h]||(n[h]=p,f.zg++,w[h]&&f.ne++);w[h]||(w[h]=p,f.Ag++,n[h]&&f.ne++);l[g]=h;v[h]=g;for(l=0;l<A(y,g);l++)v=
s(y,g,l),K[v]||(K[v]=p,f.xg++,V[v]&&f.me++);for(l=0;l<B(y,g);l++)v=u(y,g,l),V[v]||(V[v]=p,f.yg++,K[v]&&f.me++);for(l=0;l<A(k,h);l++)v=s(k,h,l),n[v]||(n[v]=p,f.zg++,w[v]&&f.ne++);for(l=0;l<B(k,h);l++)v=u(k,h,l),w[v]||(w[v]=p,f.Ag++,n[v]&&f.ne++);f=m(a,b,q);z(1>=q.Dc-q.kj);z(-1!=q.Sg);v=q.mh;g=q.nh;h=q.Dc;y=q.Sg;k=q.ed;K=q.Je;p=q.Ve;n=q.We;H=q.pf;V=q.qf;if(q.kj<h){p[y]==h&&(p[y]=0);for(w=0;w<A(v,y);w++)l=s(v,y,w),p[l]==h&&(p[l]=0);H[y]==h&&(H[y]=0);for(w=0;w<B(v,y);w++)l=u(v,y,w),H[l]==h&&(H[l]=0);
v=k[y];n[v]==h&&(n[v]=0);for(w=0;w<A(g,v);w++)l=s(g,v,w),n[l]==h&&(n[l]=0);V[v]==h&&(V[v]=0);for(w=0;w<B(g,v);w++)l=u(g,v,w),V[l]==h&&(V[l]=0);k[y]=-1;K[v]=-1;q.Dc=q.kj;q.Sg=-1}}return f}function x(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var e=a.me,f=a.ne,q=a.yg,g=a.Ag,h=a.xg,y=a.zg,m=a.Dc,k=a.ae,p=a.hg,H=a.ed,l=a.Je,J=a.Ve,B=a.We,t=a.pf,w=a.qf;if(e>m&&f>m)for(;c<k&&(-1!=H[c]||0==t[c]||0==J[c]);)c++,d=0;else if(q>m&&g>m)for(;c<k&&(-1!=H[c]||0==t[c]);)c++,d=0;else if(h>m&&y>m)for(;c<k&&(-1!=H[c]||0==J[c]);)c++,
d=0;else if(0==c&&0!=a.be){for(J=0;J<k&&-1!=H[c=a.be[J]];)J++;J==k&&(c=k)}else for(;c<k&&-1!=H[c];)c++,d=0;if(e>m&&f>m)for(;d<p&&(-1!=l[d]||0==w[d]||0==B[d]);)d++;else if(q>m&&g>m)for(;d<p&&(-1!=l[d]||0==w[d]);)d++;else if(h>m&&y>m)for(;d<p&&(-1!=l[d]||0==B[d]);)d++;else for(;d<p&&-1!=l[d];)d++;return c<k&&d<p?(b[0]=c,b[1]=d,!0):!1}function t(a,b,c){var d=a.mh,f=a.nh,g=a.hg,h=a.ed,m=a.Je,y=a.Ve,k=a.We,p=a.pf,H=a.qf;z(b<a.ae);z(c<g);z(-1==h[b]);z(-1==m[c]);if(!(0,a.Dl)(e(d,b),e(f,c)))return!1;for(var l=
g=0,J=0,t=0,x=0,v=0,V=0;V<B(d,b);V++){var w=u(d,b,V);if(-1!=h[w]){var I=h[w];if(!q(f,c,I)||!K(a.Ii,d,b,w,f,c,I))return!1}else y[w]&&J++,p[w]&&g++,y[w]||p[w]||x++}for(V=0;V<A(d,b);V++)if(w=s(d,b,V),-1!=h[w]){if(I=h[w],!q(f,I,c)||!K(a.Ii,d,w,b,f,I,c))return!1}else y[w]&&J++,p[w]&&g++,y[w]||p[w]||x++;for(V=0;V<B(f,c);V++)if(I=u(f,c,V),-1!=m[I]){if(w=m[I],!q(d,b,w))return!1}else k[I]&&t++,H[I]&&l++,k[I]||H[I]||v++;for(V=0;V<A(f,c);V++)if(I=s(f,c,V),-1!=m[I]){if(w=m[I],!q(d,w,b))return!1}else k[I]&&t++,
H[I]&&l++,k[I]||H[I]||v++;return J<=t&&g<=l&&x<=v}function z(a){if(!a)throw"Assertion failed";}function e(a,b){for(var c=a.ya,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function B(a,b){for(var c=a.sa,d=0,e=0;e<c.length;e+=3)c[e]==b&&d++;return d}function A(a,b){for(var c=a.sa,d=0,e=0;e<c.length;e+=3)c[e+1]==b&&d++;return d}function u(a,b,c){a=a.sa;for(var d=0,e=0;e<a.length;e+=3)if(a[e]==b){if(d==c)return a[e+1];d++}return-1}function s(a,b,c){a=a.sa;for(var d=0,e=0;e<a.length;e+=3)if(a[e+
1]==b){if(d==c)return a[e];d++}return-1}function q(a,b,c){a=a.sa;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function K(a,b,c,d,e,f,q){for(var g=H(b,c,d),h=H(e,f,q),m=0;m<g;m++){for(var k=!1,p=0;p<h;p++)if(a(y(b,c,d,m),y(e,f,q,p))){k=!0;break}if(!k)return!1}return!0}function H(a,b,c){var d=0;a=a.sa;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&d++;return d}function y(a,b,c,d){a=a.sa;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(e==d)return a[f+2];e++}return null}
var J=[-1,-1];a.Hm=-1;a.rz=10;a.or=20;a.uz=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var e=a[d];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:c.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{ya:b,sa:c}};a.Uz=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)d.push(b[e][0],b[e][1],b[e][2]);return{ya:c,sa:d}};a.fk=n;a.BA=b;a.Ae=c;a.lg=g;a.kg=function(a,b,c,d){if(!q(a,b,c))throw"Edge not found";
a=a.sa;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(-1==d)a.splice(f,3);else{if(d==e){a.splice(f,3);break}e++}f-=3}};a.o=function(a,b){if(-1==l(a,b))n(a,d(a),b);else throw"Non-unique attribute";};a.gx=function(a,b,c,d,e){a=a.sa;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&a[f+2]==d&&(a[f+2]=e)};a.wo=d;a.yh=l;a.i=function(a,b,d,e){b=l(a,b);d=l(a,d);if(-1!=b&&-1!=d)c(a,b,d,e);else throw"Attributes not found";};a.J=function(a,b){for(var c=a.ya,d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};
a.oe=function(a,b){for(var c=a.sa,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.pe=function(a,b,c){for(var d=a.sa,f=0;f<d.length;f+=3)if(d[f+1]==b){var q=d[f];if(c(q,e(a,q),d[f+2]))break}};a.qe=function(a,b,c){for(var d=a.sa,f=0;f<d.length;f+=3)if(d[f]==b){var q=d[f+1];if(c(q,e(a,q),d[f+2]))break}};a.Sq=h;a.ry=function(a){a=h(a).ya;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.LA=function(){};a.ey=function(a,c,d){if(!b(a,c))throw"No such node";var f={};k(a,f);p(a,c,f,d);c=[];for(var q in f)f[q]&&
(q=Number(q),c.push(q,e(a,q)));a={ya:c,sa:a.sa.slice(0)};f=a.sa;for(q=0;q<f.length;q+=3)c=f[q+1],b(a,f[q])&&b(a,c)||(f.splice(q,3),q-=3);return a};a.Kv=function(a){for(var b=[],c=a.ya,d=0;d<c.length;d+=2){var e=c[d];A(a,e)||b.push(e)}return b};a.Jo=function(a){for(var b=[],c=a.ya,d=0;d<c.length;d+=2){var e=c[d];B(a,e)||b.push(e)}return b};a.match=function(a,b,c,d){var e={};e.mh=v(a);e.nh=v(b);e.Dl=c||function(a,b){return a==b};e.Ii=d||function(a,b){return a==b};d=a.ya.length/2;var f=b.ya.length/2;
e.ae=d;e.hg=f;e.be=0;e.Dc=e.kj=0;e.me=e.xg=e.yg=0;e.ne=e.zg=e.Ag=0;e.Sg=-1;e.ed=Array(d);e.Je=Array(f);e.Ve=Array(d);e.We=Array(f);e.pf=Array(d);e.qf=Array(f);e.zj=[1];for(c=0;c<d;c++)e.ed[c]=-1,e.Ve[c]=0,e.pf[c]=0;for(c=0;c<f;c++)e.Je[c]=-1,e.We[c]=0,e.qf[c]=0;f=Array(d);d=Array(d);if(m(f,d,e)){for(c=0;c<f.length;c++)f[c]=a.ya[2*f[c]],d[c]=b.ya[2*d[c]];return[f,d]}return null};a.Ca=e;a.ig=B;a.Yo=A;a.Zf=u;a.Li=s;a.rA=H;a.Yf=y;a.replace=function(a,b,c){for(var e=a.sa,f=d(a),q=0;q<b.length;q++){var h=
b[q];g(a,h);for(var m=0;m<e.length;m+=3)e[m]==h&&(e[m]=f),e[m+1]==h&&(e[m+1]=f),e[m]==e[m+1]&&(e.splice(m,3),m-=3)}n(a,f,c)};a.Vz=function(a,b){var c=a.ya,d=a.sa,e;e="digraph debug {\n    node [shape=box];\n";for(var f=0;f<c.length;f+=2){var q=c[f],g=c[f+1],g=b?b(q,g):String(q);e+="    ";e+=String(q)+' [label="'+g.replace(/\"/g,'\\"')+'"];\n'}for(f=0;f<d.length;f+=3)c=d[f],q=d[f+1],e+="    ",e+=String(c)+" -> "+String(q)+";\n";return e+="}"}};b4w.module.__ipc=function(a){var n=a.tr=0;a.ur=1;a.vr=2;a.wr=3;a.xr=4;a.yr=5;var b=a.Ar=6,c=a.Br=7,g=a.Cr=8;a.Dr=9;a.zr=10;a.bs=11;a.yc=12;a.Er=13;a.Fr=14;a.Gr=15;a.Ir=16;a.Hr=17;a.Jr=18;a.Kr=19;a.Lr=20;a.Mr=21;a.Nr=22;a.Or=23;a.Pr=24;a.Qr=25;a.Rr=26;a.Sr=27;a.Tr=28;a.Ur=29;a.Vr=30;a.Wr=31;a.Xr=32;a.Yr=33;a.$r=34;a.as=35;a.cs=36;a.Jm=37;a.ds=38;a.es=39;a.fs=40;a.gs=41;a.hs=42;a.js=43;a.ks=44;a.ls=45;a.ms=46;a.ns=47;a.os=48;a.ps=49;a.qs=50;a.Km=51;var d=a.Ef=52;a.rs=53;a.Im=54;a.ss=55;a.ts=56;a.sz=
57;a.Zr=58;for(var l=null,h=[],k=[],f=[],p=[],v=0;59>v;v++)h.push(null),k.push(null),f.push(null),p.push(null);k[g]={msg_id:0,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3)};k[b]={msg_id:0,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4)};k[c]={msg_id:0,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0};k[n]={msg_id:0,body_id_a:0,body_id_b:0,result:0,
coll_point:new Float32Array(3)};k[d]={msg_id:0,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4)};p[g]=["msg_id",1,"body_id",1,"time",1,"trans",3,"quat",4,"linvel",3,"angvel",3];p[b]=["msg_id",1,"chassis_hull_body_id",1,"prop_ind",1,"trans",3,"quat",4];p[c]=["msg_id",1,"body_id",1,"from",3,"to",3,"local",1,"body_id_b_hit",1,"cur_result",1];p[n]=["msg_id",1,"body_id_a",1,"body_id_b",1,"result",1,"coll_point",3];p[d]=["msg_id",1,"body_id",1,"trans",3,"quat",4];a.init=function(a,b){a.addEventListener("message",
function(a){var c=a.data;a=c[0]|0;if(p[a]){for(var d=k[a],f=p[a],g=0,h=0;h<f.length;h+=2){var m=f[h],q=f[h+1];if(1==q)d[m]="msg_id"==m||"body_id"==m||"body_id_a"==m||"body_id_b"==m?c[g]|0:c[g];else for(var l=0;l<q;l++)d[m][l]=c[g+l];g+=q}c=d}b(a,c)},!1);l=a};a.cleanup=function(){l=null};a.m=function(){var a=arguments[0]|0;if(p[a]){var b=k[a],c=p[a],d=0;if(!f[a]){for(var e=0,g=1;g<c.length;g+=2)e+=c[g];f[a]=new Float32Array(e)}e=f[a];for(g=0;g<c.length;g+=2){var v=b[c[g]],u=c[g+1];1==u?e[d]=v:e.set(v,
d);d+=u}h[a]||(h[a]=e);a=h[a]}else for(b=arguments.length,h[a]||(h[a]=Array(b),h[a][0]=a),a=h[a],c=1;c<b;c++)a[c]=arguments[c];l.postMessage(a)};a.Eo=function(a){return k[a]}};b4w.module.__hud=function(a,n){function b(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function c(a){g(' SCENE "'+a.name+'"');if(a.d){var b=0,c=0;k.J(a.d.Ma,function(a,d){if("SINK"==d.type)g(" (F)",d.type);else{var e=d.type,f=Math.round(d.h.width)+"x"+Math.round(d.h.height),h=d.l.length,k=d.bh,p=d.enqueue&&d.P;p?g(" (A)",e,d.mf,f,k,"of",h):g(" (P)",e,d.mf,f,k,"of",h);d.bh=0;p&&(b+=h,c+=k)}});return[b,c]}g("No INFO")}function g(){for(var a=80+20*p[0],b=[5,
18,3,10,4,3,5],c=arguments[0],d=1;d<arguments.length;d++){for(var g="",e=0;e<b[d]-String(arguments[d]).length;e++)g+=" ";c+=g+arguments[d]}p[0]++;f.fillText(c,30,a)}function d(a,b,c){b*=a.oa;c.x=a.x+b;c.y=a.y;c.oa=a.oa-2*b;c.ha=a.ha}function l(a){return a.x+a.oa/2}function h(a){var b=f,c={x:0,y:0,oa:0,ha:0},g=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.oa=g;c.ha=b;d(c,.01,c);g=.02*c.ha;c.x=c.x;c.y+=g;c.oa=c.oa;c.ha-=2*g;g=c.oa/8;c.x+=g*a;c.y=c.y;c.oa=g;c.ha=c.ha;d(c,.02,c);return c}var k=n("__graph"),
f=null,p=[0,0];a.init=function(a){a=a.getContext("2d");b(a);return f=a};a.Eg=function(){f&&b(f)};a.reset=function(){var a=f;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),p[0]=0,p[1]=0)};a.Nx=function(a,b){var d=f;if(d){d.textAlign="left";d.fillStyle="rgba(0,255,0,255)";g(" FPS",(1/b).toFixed(2));p[0]++;for(var h=d=0,k=0;k<a.length;k++){var e=c(a[k]),d=d+e[0],h=h+e[1];p[0]++}g(" ---------------------------------------------");
g("    ","TOTAL ACTIVE","","",h,"of",d)}};a.print=function(){var a=f;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",g.apply(Math,arguments))};a.plot_array=function(a,b,c,d,g,e,k){var p=f;if(p){b=h(b);var u=b.ha/5;b.x=b.x;b.y+=4*u;b.oa=b.oa;b.ha=u;p.textAlign="center";p.fillStyle="#00FF00";f.fillText(a,l(b),b.y-10);p.strokeStyle="#00FF00";p.lineWidth=.5;p.beginPath();p.moveTo(b.x,b.y);p.lineTo(b.x+b.oa,b.y);p.lineTo(b.x+b.oa,b.y+b.ha);p.lineTo(b.x,b.y+b.ha);p.closePath();p.stroke();if(!e&&
!k)for(e=1E6,k=-1E6,a=0;a<c.length;a++)e=Math.min(e,c[a]),k=Math.max(k,c[a]);p.textAlign="right";f.fillText(String(e),b.x-10,b.y+b.ha);f.fillText(String(k),b.x-10,b.y);p.textAlign="center";f.fillText(String(d),b.x,b.y+b.ha+15);f.fillText(String(g),b.x+b.oa,b.y+b.ha+15);p.strokeStyle="#FF0000";p.lineWidth=1.5;p.beginPath();d=b.oa/(c.length-1);k=b.ha/(k-e);for(a=0;a<c.length;a++)g=b.x+d*a,u=b.y+b.ha-(c[a]-e)*k,0==a?p.moveTo(g,u):p.lineTo(g,u);p.stroke()}};a.draw_mixer_strip=function(a,b,c,d,g,e,k){var p=
f;if(p)for(p.textAlign="center",p.fillStyle="#00FF00",p.font="bold 12px Courier",c=h(c),f.fillText(b?"["+a+"]":a,l(c),c.y),0<=e&&f.fillText(e?"[M]":"[ ]",l(c)-15,c.y+30),0<=k&&f.fillText(k?"[S]":"[ ]",l(c)+15,c.y+30),a={x:0,y:0,oa:0,ha:0},b=0;b<d.length;b++){e=d[b];var u="VOLUME"==e[0];if(u){k=c.y+350;var s=c.oa,q=a;q.x=c.x;q.y=k;q.oa=s;q.ha=250}else{k=c.y+10+50*b;var s=c.oa,q=c.ha,K=a;K.x=c.x;K.y=k;K.oa=s;K.ha=q}k=p;var s=a,K=b==g,H=e[0],q=e[1],y=e[2],J=e[3],r=(J-y)/e[4],r=1>r?Math.floor(1/r-1E-5).toFixed(0).length:
0;e=e[5]?Math.log(q/y)/Math.log(J/y):(q-y)/(J-y);k.textAlign="center";K?k.fillText("["+H+"]",l(s),s.y):k.fillText(H,l(s),s.y);k.strokeStyle="#00FF00";k.lineWidth=u?3:1;u?(k.textAlign="right",k.fillText(J.toFixed(r),l(s)-10,s.y+15),k.textAlign="right",k.fillText(y.toFixed(r),l(s)-10,s.y+s.ha-15)):(k.textAlign="right",k.fillText(y.toFixed(r),s.x+28,s.y+15),k.textAlign="left",k.fillText(J.toFixed(r),s.x+s.oa-28,s.y+15));k.beginPath();if(u){var F=s.y+15+(s.ha-30)*(1-e);k.moveTo(l(s),s.y+15);k.lineTo(l(s),
s.y+s.ha-15);k.moveTo(l(s)-5,s.y+15);k.lineTo(l(s)+5,s.y+15);k.moveTo(l(s)-5,s.y+s.ha-15);k.lineTo(l(s)+5,s.y+s.ha-15);k.moveTo(l(s)-5,F);k.lineTo(l(s)+5,F)}else{var G=s.x+30+(s.oa-60)*e;k.moveTo(s.x+30,s.y+15);k.lineTo(s.x+s.oa-30,s.y+15);k.moveTo(s.x+30,s.y+15-5);k.lineTo(s.x+30,s.y+15+5);k.moveTo(s.x+s.oa-30,s.y+15-5);k.lineTo(s.x+s.oa-30,s.y+15+5);k.moveTo(G,s.y+15-5);k.lineTo(G,s.y+15+5)}k.stroke();"EQ_Q"==H?(e=Math.log(1+1/(2*q*q)+Math.sqrt((2+1/(q*q))*(2+1/(q*q))/4-1))/Math.log(2),u?(k.textAlign=
"left",k.fillText(q.toFixed(r),l(s)+10,F),k.textAlign="left",k.fillText("("+e.toFixed(r+1)+")",l(s)+10,F+10)):(k.textAlign="right",k.fillText(q.toFixed(r),G,s.y+30),k.textAlign="left",k.fillText("("+e.toFixed(r+1)+")",G,s.y+30))):u?(k.textAlign="left",k.fillText(q.toFixed(r),l(s)+10,F)):(k.textAlign="center",k.fillText(q.toFixed(r),G,s.y+30))}}};b4w.module.__renderer=function(a,n){function b(a){if(a){var b=(a.Z?z.COLOR_BUFFER_BIT:0)|(a.fa?z.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=v;break;case "DEPTH":a=m;break;case "SHORE_SMOOTHING":a=v;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":a=x;break;case "GLOW_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=t;break;default:a=p.background_color}}else b=z.COLOR_BUFFER_BIT|z.DEPTH_BUFFER_BIT,a=p.background_color;z.colorMask(!0,!0,!0,!0);
z.depthMask(!0);z.clearColor(a[0],a[1],a[2],a[3]);z.clear(b)}function c(a,b,c){z.bindBuffer(z.ARRAY_BUFFER,a.Af);for(var d=0;d<b.length;d++){var e=b[d];z.enableVertexAttribArray(e.ef);z.vertexAttribPointer(e.ef,e.Ic,z.FLOAT,!1,0,e.it+e.$u*c)}a.qd?(z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,a.qd),z.drawElements(a.mode,a.count,a.il,0)):z.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)e=b[d],z.disableVertexAttribArray(e.ef)}function g(a){switch(a){case 0:return z.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 1:return z.TEXTURE_CUBE_MAP_POSITIVE_Y;
case 2:return z.TEXTURE_CUBE_MAP_POSITIVE_X;case 3:return z.TEXTURE_CUBE_MAP_NEGATIVE_X;case 4:return z.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return z.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function d(a){var b=a.Xh,c=[],d=[],e={},f;for(f in b){var g=!1;switch(f){case "u_proj_matrix":var h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.ia)},g=!0;break;case "u_view_matrix":case "u_view_matrix_frag":h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.ea)};g=!0;break;case "u_shadow_cast_billboard_view_matrix":h=function(a,
b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.uq)};g=!0;break;case "u_view_proj_prev":h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Uw)};g=!0;break;case "u_view_proj_inverse":h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Kg)};g=!0;break;case "u_sky_vp_inverse":h=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Mc)};g=!0;break;case "u_camera_eye":case "u_camera_eye_frag":h=function(a,b,c,d,e,f){a.uniform3fv(b,f.Sd)};g=!0;break;case "u_camera_eye_last":h=function(a,b,c,d,e,f){a.uniform3fv(b,f.oo)};g=
!0;break;case "u_camera_quat":h=function(a,b,c,d,e,f){a.uniform4fv(b,f.quat)};g=!0;break;case "u_view_max_depth":h=function(a,b,c,d,e,f){a.uniform1f(b,f.Ka)};g=!0;break;case "u_camera_range":h=function(a,b,c,d,e,f){a.uniform2f(b,f.Da,f.Ka)};break;case "u_csm_center_dists":h=function(a,b,c,d,e,f){a.uniform4fv(b,f.Tn)};break;case "u_cam_water_depth":h=function(a,b,c){a.uniform1f(b,c.rk)};g=!0;break;case "u_waves_height":h=function(a,b,c){a.uniform1f(b,c.te)};break;case "u_waves_length":h=function(a,
b,c){a.uniform1f(b,c.Df)};break;case "u_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.Eb)};break;case "u_underwater_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.xc)};break;case "u_bloom_key":h=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":h=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":h=function(a,b,c){a.uniform1f(b,c.time)};g=!0;break;case "u_wind":h=function(a,b,c){a.uniform3fv(b,c.di)};break;case "u_horizon_color":h=function(a,
b,c){a.uniform3fv(b,c.hc)};break;case "u_zenith_color":h=function(a,b,c){a.uniform3fv(b,c.nc)};break;case "u_environment_energy":h=function(a,b,c){a.uniform1f(b,c.Rd)};break;case "u_sky_color":h=function(a,b,c){a.uniform3fv(b,c.pg)};break;case "u_rayleigh_brightness":h=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":h=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":h=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":h=
function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":h=function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":h=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":h=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":h=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":h=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;
case "u_light_positions":h=function(a,b,c){a.uniform3fv(b,c.cf)};break;case "u_light_directions":h=function(a,b,c){a.uniform3fv(b,c.$e)};break;case "u_light_color_intensities":h=function(a,b,c){a.uniform3fv(b,c.Ze)};break;case "u_light_factors1":h=function(a,b,c){a.uniform4fv(b,c.af)};break;case "u_light_factors2":h=function(a,b,c){a.uniform4fv(b,c.bf)};break;case "u_sun_quaternion":h=function(a,b,c){a.uniform4fv(b,c.Oq)};break;case "u_sun_intensity":h=function(a,b,c){a.uniform3fv(b,c.Nq)};break;
case "u_sun_direction":h=function(a,b,c){a.uniform3fv(b,c.Fj)};break;case "u_height":h=function(a,b,c,d,e,f){a.uniform1f(b,f.height)};g=!0;break;case "u_model_matrix":h=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.G)};g=!0;break;case "u_transb":h=function(a,b,c,d){a.uniform4fv(b,d.cc)};g=!0;break;case "u_transa":h=function(a,b,c,d){a.uniform4fv(b,d.bc)};g=!0;break;case "u_quat":h=function(a,b,c,d){a.uniform4fv(b,d.quat)};g=!0;break;case "u_quatsb":h=function(a,b,c,d){a.uniform4fv(b,d.Ub)};g=!0;break;
case "u_quatsa":h=function(a,b,c,d){a.uniform4fv(b,d.Tb)};g=!0;break;case "u_frame_factor":h=function(a,b,c,d){a.uniform1f(b,d.Pe)};g=!0;break;case "au_center_pos":h=function(){};g=!0;break;case "au_wind_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.Wc)};g=!0;break;case "au_wind_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.ue)};g=!0;break;case "au_detail_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.Nd)};g=!0;break;case "au_detail_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.Md)};
g=!0;break;case "au_branch_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.Jd)};g=!0;break;case "u_anim_values":h=function(a,b,c,d){a.uniform1fv(b,d.hf)};g=!0;break;case "u_diffuse_color":h=function(a,b,c,d,e){a.uniform4fv(b,e.nb)};g=!0;break;case "u_diffuse_intensity":h=function(a,b,c,d,e){a.uniform1f(b,e.Le)};g=!0;break;case "u_diffuse_params":h=function(a,b,c,d,e){a.uniform2fv(b,e.hd)};g=!0;break;case "u_emit":h=function(a,b,c,d,e){a.uniform1f(b,e.Qd)};g=!0;break;case "u_ambient":h=function(a,
b,c,d,e){a.uniform1f(b,e.Bc)};g=!0;break;case "u_specular_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.zd)};g=!0;break;case "u_specular_alpha":h=function(a,b,c,d,e){a.uniform1f(b,e.Cj)};g=!0;break;case "u_specular_params":h=function(a,b,c,d,e){a.uniform3fv(b,e.lc)};g=!0;break;case "u_reflect_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.Lh)};g=!0;break;case "u_mirror_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.Al)};g=!0;break;case "u_grass_map_dim":h=function(a,b,c,d,e){a.uniform3fv(b,e.Hb)};g=
!0;break;case "u_grass_size":h=function(a,b,c,d,e){a.uniform1f(b,e.el)};g=!0;break;case "u_scale_threshold":h=function(a,b,c,d,e){a.uniform1f(b,e.Pi)};g=!0;break;case "u_cube_fog":h=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.Ec)};break;case "u_jitter_amp":h=function(a,b,c,d,e){a.uniform1f(b,e.Yi)};g=!0;break;case "u_jitter_freq":h=function(a,b,c,d,e){a.uniform1f(b,e.Zi)};g=!0;break;case "u_wireframe_mode":h=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":h=
function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":h=function(a,b,c){a.uniform2fv(b,c.pw)};g=!0;break;case "u_subsample_indices":h=function(a,b,c){a.uniform4fv(b,c.qw)};g=!0;break;case "u_refr_bump":h=function(a,b,c,d,e){a.uniform1f(b,e.dq)};g=!0;break;case "u_lamp_light_positions":h=function(a,b,c,d,e){a.uniform3fv(b,e.ol)};break;case "u_lamp_light_directions":h=function(a,b,c,d,e){a.uniform3fv(b,e.ml)};break;case "u_lamp_light_color_intensities":h=function(a,
b,c,d,e){a.uniform3fv(b,e.ll)};break;case "u_lamp_light_factors":h=function(a,b,c,d,e){a.uniform4fv(b,e.nl)};break;case "u_halo_size":h=function(a,b,c,d,e){a.uniform1f(b,e.Ro)};g=!0;break;case "u_halo_hardness":h=function(a,b,c,d,e){a.uniform1f(b,e.Oo)};g=!0;break;case "u_halo_rings_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.Qo)};g=!0;break;case "u_halo_lines_color":h=function(a,b,c,d,e){a.uniform3fv(b,e.Po)};g=!0;break;case "u_halo_stars_blend":h=function(a,b,c,d,e){a.uniform1f(b,e.So)};g=!0;
break;case "u_halo_stars_height":h=function(a,b,c,d,e){a.uniform1f(b,e.To)};g=!0;break;case "u_fresnel_params":h=function(a,b,c,d,e){a.uniform4fv(b,e.nd)};g=!0;break;case "u_texture_scale":h=function(a,b,c,d,e){a.uniform3fv(b,e.Qc)};g=!0;break;case "u_parallax_scale":h=function(a,b,c,d,e){a.uniform1f(b,e.Dh)};g=!0;break;case "u_color_id":h=function(a,b,c,d,e){a.uniform3fv(b,e.Jn)};g=!0;break;case "u_line_points":h=function(a,b,c,d,e){a.uniform3fv(b,e.UA)};g=!0;break;case "u_diffuse_color_factor":h=
function(a,b,c,d,e){a.uniform1f(b,e.Ke)};g=!0;break;case "u_alpha_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.ye)};g=!0;break;case "u_specular_color_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.zq)};g=!0;break;case "u_normal_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.yp)};g=!0;break;case "u_colormap0_uv_velocity":h=function(a,b,c,d,e){a.uniform2fv(b,e.Ld)};g=!0;break;case "u_normalmap0_uv_velocity":h=function(a,b,c,d,e){a.uniform2fv(b,e.lf[0])};g=!0;break;case "u_normalmap1_uv_velocity":h=function(a,
b,c,d,e){a.uniform2fv(b,e.lf[1])};g=!0;break;case "u_normalmap2_uv_velocity":h=function(a,b,c,d,e){a.uniform2fv(b,e.lf[2])};g=!0;break;case "u_normalmap3_uv_velocity":h=function(a,b,c,d,e){a.uniform2fv(b,e.lf[3])};g=!0;break;case "u_normalmap0_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.kf[0])};g=!0;break;case "u_normalmap1_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.kf[1])};g=!0;break;case "u_normalmap2_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.kf[2])};g=!0;break;case "u_normalmap3_scale":h=
function(a,b,c,d,e){a.uniform2fv(b,e.kf[3])};g=!0;break;case "u_foam_factor":h=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};g=!0;break;case "u_foam_uv_freq":h=function(a,b,c,d,e){a.uniform2fv(b,e.qo)};g=!0;break;case "u_foam_mag":h=function(a,b,c,d,e){a.uniform2fv(b,e.po)};g=!0;break;case "u_foam_scale":h=function(a,b,c,d,e){a.uniform2fv(b,e.Sk)};g=!0;break;case "u_shallow_water_col":h=function(a,b,c,d,e){a.uniform3fv(b,e.shallow_water_col)};g=!0;break;case "u_shore_water_col":h=function(a,b,
c,d,e){a.uniform3fv(b,e.shore_water_col)};g=!0;break;case "u_water_shallow_col_fac":h=function(a,b,c,d,e){a.uniform1f(b,e.shallow_water_col_fac)};g=!0;break;case "u_water_shore_col_fac":h=function(a,b,c,d,e){a.uniform1f(b,e.shore_water_col_fac)};g=!0;break;case "u_p_length":h=function(a,b,c,d,e){a.uniform1f(b,e.Lp)};g=!0;break;case "u_p_cyclic":h=function(a,b,c,d,e){a.uniform1i(b,e.Hp)};g=!0;break;case "u_p_max_lifetime":h=function(a,b,c,d,e){a.uniform1f(b,e.Np)};g=!0;break;case "u_p_fade_in":h=function(a,
b,c,d,e){a.uniform1f(b,e.Ip)};g=!0;break;case "u_p_fade_out":h=function(a,b,c,d,e){a.uniform1f(b,e.Jp)};g=!0;break;case "u_p_size":h=function(a,b,c,d,e){a.uniform1f(b,e.Jl)};g=!0;break;case "u_p_alpha_start":h=function(a,b,c,d,e){a.uniform1f(b,e.Ep)};g=!0;break;case "u_p_alpha_end":h=function(a,b,c,d,e){a.uniform1f(b,e.Dp)};g=!0;break;case "u_p_nfactor":h=function(a,b,c,d,e){a.uniform1f(b,e.Il)};g=!0;break;case "u_p_gravity":h=function(a,b,c,d,e){a.uniform1f(b,e.Kp)};g=!0;break;case "u_p_mass":h=
function(a,b,c,d,e){a.uniform1f(b,e.Mp)};g=!0;break;case "u_p_size_ramp":h=function(a,b,c,d,e){a.uniform2fv(b,e.Op)};g=!0;break;case "u_p_color_ramp":h=function(a,b,c,d,e){a.uniform4fv(b,e.Fp)};g=!0;break;case "u_p_wind":h=function(a,b,c,d,e){a.uniform3fv(b,e.mj)};g=!0;break;case "u_texel_size":h=function(a,b,c,d,e){a.uniform2fv(b,e.mm)};g=!0;break;case "u_p_time":h=function(a,b,c,d,e){a.uniform1f(b,e.Jc.H.time)};g=!0;break;case "u_va_frame_factor":h=function(a,b,c,d){a.uniform1f(b,d.dr)};g=!0;break;
case "u_normal_offset":h=function(a,b,c){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":h=function(a,b,c,d,e,f){a.uniform4fv(b,f.rj)};break;case "u_v_light_matrix":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.cr)};g=!0;break;case "u_b_light_matrix":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.gn)};break;case "u_p_light_matrix0":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.rf[0])};g=!0;break;case "u_p_light_matrix1":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.rf[1])};g=!0;break;
case "u_p_light_matrix2":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.rf[2])};g=!0;break;case "u_p_light_matrix3":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.rf[3])};g=!0;break;case "u_motion_blur_exp":h=function(a,b,c){a.uniform1f(b,c.up)};g=!0;break;case "u_refl_plane":h=function(a,b,c){a.uniform4fv(b,c.gb)};break;case "u_radial_blur_step":h=function(a,b,c){a.uniform1f(b,c.uj)};break;case "u_god_rays_intensity":h=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":h=
function(a,b,c){a.uniform1f(b,c.tg)};break;case "u_ssao_blur_discard_value":h=function(a,b,c){a.uniform1f(b,c.ssao_blur_discard_value)};g=!0;break;case "u_ssao_influence":h=function(a,b,c){a.uniform1f(b,c.sg)};break;case "u_ssao_dist_factor":h=function(a,b,c){a.uniform1f(b,c.rg)};break;case "u_dof_dist":h=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_distance)};g=!0;break;case "u_dof_front":h=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_front)};g=!0;break;case "u_dof_rear":h=function(a,b,c,d,e,f){a.uniform1f(b,
f.dof_rear)};g=!0;break;case "u_glow_intensity":h=function(a,b,c,d,e){a.uniform1f(b,e.$f)};g=!0;break;case "u_glow_color":h=function(a,b,c){a.uniform3fv(b,c.oh)};break;case "u_draw_glow":h=function(a,b,c){a.uniform1f(b,c.Mk)};g=!0;break;case "u_brightness":h=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":h=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":h=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":h=function(a,b,c){a.uniform1f(b,c.saturation)};
break;default:h=null}h&&(h={name:f,Yk:h,ef:b[f]},g?c.push(h):(d.push(h),e[f]=h))}a.Uq=c;a.Fh=d;a.Ll=e}var l=n("__config"),h=n("__debug"),k=n("__textures"),f=n("__util"),p=l.n,v=[1,1,1,1],m=[1,1,1,1],x=[0,0,0,1],t=[0,0,0,0];new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var z=null,e=new Uint8Array(4);a.Wb=function(a){var b=p.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);
a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);z=a};a.Sf=function(a){if(a.P){var f=a.h;z.bindFramebuffer(z.FRAMEBUFFER,f.Td);if(a.hk){var k=f.bb;z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,k.Ab,k.Fa,0)}z.viewport(0,0,f.width,f.height);b(a);a.qa?z.enable(z.BLEND):z.disable(z.BLEND);a.wb?z.enable(z.DEPTH_TEST):z.disable(z.DEPTH_TEST);if(a.ta){for(var f=a.h,k=a.l,m=0;m<k.length;m++){var q=k[m],l=q.k,t=l.Xb;z.useProgram(t.sj);
q=q.Ua;t.Fh.length||d(t);for(var t=t.Fh,y=t.length;y--;){var v=t[y];v.Yk(z,v.ef,a,q,l,f)}}a.ta=!1}switch(a.type){case "SHADOW_CAST":z.enable(z.POLYGON_OFFSET_FILL);z.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);z.cullFace(z.BACK);break;case "MAIN_REFLECT":z.disable(z.POLYGON_OFFSET_FILL);z.cullFace(z.FRONT);break;default:z.disable(z.POLYGON_OFFSET_FILL),z.cullFace(z.BACK)}f=a.h;k=a.l;for(m=0;m<k.length;m++)if(q=k[m],q.P){var l=a,v=f,t=q.Ua,r=q.k,q=r.Xb;z.useProgram(q.sj);
for(var x=r.ab,y=r.cn,G=q.Uq,W=G.length;W--;){var n=G[W];n.Yk(z,n.ef,l,t,r,v)}v=r.Kn;z.colorMask(v,v,v,v);z.depthMask(r.M);r.ka?z.enable(z.CULL_FACE):z.disable(z.CULL_FACE);v=r.R;r=r.$b;G=q.Xh;W=v.length|0;if(0!==W)if(1===W)z.activeTexture(z.TEXTURE0),z.bindTexture(v[0].Ab,v[0].Fa);else for(n=0;n<W;n++){var S=v[n],R=r[n];z.activeTexture(z.TEXTURE0+n);z.bindTexture(S.Ab,S.Fa);z.uniform1i(G[R],n)}if("SKY"==l.type){v=l;q=q.Xh;r=v.h.bb.Fa;G=v.Un;for(W=0;6>W;W++)if(n=g(W),p.Fn)S=new Uint8Array([91.8,142.8,
.96*255,255]),z.bindTexture(z.TEXTURE_CUBE_MAP,r),z.texImage2D(n,0,z.RGBA,1,1,0,z.RGBA,z.UNSIGNED_BYTE,S);else if(z.uniformMatrix4fv(q.u_cube_view_matrix,!1,G[W]),z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,n,r,0),c(x,y,t.tm),v.hj&&0!=W){var n=v,S=W,L=e;z.readPixels(191,191,1,1,z.RGBA,z.UNSIGNED_BYTE,L);255!=L[0]&&255!=L[1]&&255!=L[2]||z.readPixels(191,220,1,1,z.RGBA,z.UNSIGNED_BYTE,L);var R=L[0],O=L[1],L=L[2],R=R/255,O=O/255,L=L/255;1===S?(n.Ec[3]=R,n.Ec[7]=O,n.Ec[11]=L):(n.Ec[4*(S-
2)]=R,n.Ec[4*(S-2)+1]=O,n.Ec[4*(S-2)+2]=L)}l.bh+=6}else c(x,y,t.tm),l.bh++}h.Dt("draw subscene: "+a.type);z.bindFramebuffer(z.FRAMEBUFFER,null)}};a.clear=b;a.$m=function(a){var b=a.cn;b.length=0;var c=a.ab;a=a.Xb;c&&a||f.da("Incomplete batch");c=c.Ib;a=a.attributes;for(var d in a){var e=c[d];b.push({ef:a[d],it:4*e.offset,$u:1<e.frames?4*e.length:0,Ic:e.Ic})}};a.ht=d;a.Zw=function(a,b,c){var d,e,h;d||(d=1);e||(e=1);h||(h=new Uint8Array(4*d*e));h.length!=4*d*e&&f.da("read_pixels(): Wrong storage");
z.bindFramebuffer(z.FRAMEBUFFER,a);z.readPixels(b,c,d,e,z.RGBA,z.UNSIGNED_BYTE,h);z.bindFramebuffer(z.FRAMEBUFFER,null);return h};a.xy=function(a){var b=a.Xb;z.useProgram(b.sj);b.Fh.length||d(b);b=b.Ll.u_cube_fog;b.Yk(z,b.ef,null,null,a,null)};a.fq=function(a,b){var c=z.createFramebuffer();z.bindFramebuffer(z.FRAMEBUFFER,c);if(a){var d=a,e=d.Fa,d=d.Ab==z.TEXTURE_CUBE_MAP?z.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.Ab;z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,d,e,0)}k.fp(b)?z.framebufferRenderbuffer(z.FRAMEBUFFER,
z.DEPTH_ATTACHMENT,z.RENDERBUFFER,b.Mg):k.th(b)&&(d=b,e=d.Fa,d=d.Ab,z.framebufferTexture2D(z.FRAMEBUFFER,z.DEPTH_ATTACHMENT,d,e,0));h.At();z.bindFramebuffer(z.FRAMEBUFFER,null);return c};a.fx=function(a,b,c,d,e){null==a?(z.bindFramebuffer(z.FRAMEBUFFER,a),z.viewport(0,0,d,e),z.clear(z.COLOR_BUFFER_BIT|z.DEPTH_BUFFER_BIT)):(k.th(b)&&z.deleteTexture(b.Fa),k.fp(c)?z.deleteRenderbuffer(c.Mg):k.th(c)&&z.deleteTexture(c.Fa),z.deleteFramebuffer(a))};a.EA=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,n){function b(a,b,d){var e=a.Od;"string"==typeof d&&(a=c(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==b){e[a][1]=d;return}e.push([b,d])}function c(a,b){for(var c=a.Od,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function g(a,b){var c=a+b;if(s[c])return s[c];if(B){var d=B[b];if(!d)return null}else{d=z.Mv(a+b);if(!d)return null;d=A.Up.parse(d)}return s[c]=d}function d(a,b,c,d){function f(b){b=b.a;for(var c=0;c<b.length;c++){var k=b[c];switch(k.type){case "condition":a:for(var k=
k.a,y=0;y<k.length;y++){var s=k[y];switch(s.type){case "if":case "elif":var x=s.c;try{var z,A=l(x,q,p,!0);z=t.Up.parse(A)}catch(u){throw"Failed to process #"+s.type+" expression: "+x.join(" ");}if(z){f(s.group);break a}break;case "else":f(s.group);break;case "ifdef":s.name in q&&f(s.group);break;case "ifndef":s.name in q||f(s.group)}}break;case "include":k=g(e.shaders_dir,e.Lx+k.file);f(k);break;case "var":case "export":case "import":break;case "define":y=k.name;q[y]=k.b;k.va&&(p[y]=k.va);break;case "error":throw"Shader error: #error "+
k.b.join(" ");case "line":break;case "pragma":h.push("#pragma "+k.name+" "+k.b.join(" "));break;case "undef":k=k.name;delete q[k];delete p[k];break;case "warning":m.warn("Shader warning: #warning "+k.b.join(" "));break;case "extension":h.push("#extension "+l(k.b,q,p,!1));break;case "#":break;case "node":v[k.name]=k.group.a;break;case "nodes_global":k=d;for(y=0;y<k.length;y++)if(s=k[y],x=v[s.id])for(var B=0,V=0;V<x.length;V++){var w=x[V];"node_param"==w.type&&(w=w.qualifier.join(" ")+" ","vert"==a?
w+=s.ci[B]:"frag"==a&&(w+=s.va[B],null!==s.oj[B]&&(w+=" = "+s.oj[B])),w+=";",h.push(w),B++)}break;case "nodes_main":k=d;y={};for(s=0;s<k.length;s++)if(w=k[s],x=v[w.id]){var I=0,ia=0,K=0;y[s]={};for(B=0;B<x.length;B++)switch(V=x[B],V.type){case "node_in":var fa=w.B[I];if(null!==w.ap[I]){var U=V.qualifier.join(" ")+" ",U=U+fa,U=U+(" = "+w.ap[I]),U=U+";";h.push(U)}y[s][V.name]=fa;I++;break;case "node_out":fa=w.Oa[ia];U=V.qualifier.join(" ")+" ";U+=fa;U+=";";h.push(U);y[s][V.name]=fa;ia++;break;case "node_param":"vert"==
a?fa=w.ci[K]:"frag"==a&&(fa=w.va[K]),y[s][V.name]=fa,K++}}for(s=0;s<k.length;s++)if(w=k[s],x=v[w.id])for(B=0;B<x.length;B++)if(V=x[B],"textline"==V.type){w=[];for(I=0;I<V.b.length;I++)ia=V.b[I],ia in y[s]?w.push(y[s][ia]):w.push(ia);h.push(l(w,q,p,!1))}break;case "textline":h.push(l(k.b,q,p,!1));break;default:throw"Unknown element type: "+k.type;}}}for(var h=[],q={},k=0;k<c.length;k++)q[c[k][0]]=[c[k][1]];for(k=0;k<d.length;k++)q["USE_NODE_"+d[k].id]=[1];var p={},v={};f(b);return h.join("\n")}function l(a,
b,c,d){var e=[];h(a,b,c,d,e);return e.join(" ")}function h(a,b,c,d,e){for(var f=0;f<a.length;f++){var g=a[f];g in b?(g=b[g],0==g.length&&d?e.push(0):h(g,b,c,d,e)):e.push(g)}}function k(a,b,c,d){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);x.Et(d,b,c);return d}function f(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return p(a);case 2:return"vec2("+p(a[0])+","+p(a[1])+")";case 3:return"vec3("+p(a[0])+","+p(a[1])+","+p(a[2])+")";case 4:return"vec4("+p(a[0])+","+p(a[1])+","+p(a[2])+
","+p(a[3])+")";case 9:return"mat3("+p(a[0])+","+p(a[1])+","+p(a[2])+","+p(a[3])+","+p(a[4])+","+p(a[5])+","+p(a[6])+","+p(a[7])+","+p(a[8])+")";case 16:return"mat4("+p(a[0])+","+p(a[1])+","+p(a[2])+","+p(a[3])+","+p(a[4])+","+p(a[5])+","+p(a[6])+","+p(a[7])+","+p(a[8])+","+p(a[9])+","+p(a[10])+","+p(a[11])+","+p(a[12])+","+p(a[13])+","+p(a[14])+","+p(a[15])+")";default:throw"Wrong glsl value dimension";}}function p(a){return a%1?String(a):String(a)+".0"}var v=n("__config"),m=n("__print"),x=n("__debug"),
t=n("__gpp_eval"),z=n("__assets");n("__util");var e=v.yb;if(b4w.module_check(v.yb.tq))var B=n(v.yb.tq),A=null;else B=null,A=n("__gpp_parser");var u={},s={},q=[],K=null;a.Wb=function(a){K=a};a.I=b;a.Dv=c;a.MA=function(a,b){for(var c=a.Od,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.wx=function(a){a.Od=[];for(var c="ALPHA ALPHA_CLIP BEND_CENTER_ONLY CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE SHORE_SMOOTHING SKINNED SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
d=0;d<c.length;d++){var e=c[d],h;switch(e){case "ALPHA":case "ALPHA_CLIP":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_LIGHTS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":h=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":h=1;break;case "SHADOW_TEX_RES":h=f(2048);break;case "AA_METHOD":h="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":h="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":h="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":h="POST_EFFECT_NONE";break;case "SHADOW_SRC":h="SHADOW_SRC_NONE";break;case "SHADOW_DST":h=
"SHADOW_DST_NONE";break;case "SSAO_QUALITY":h="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":h="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":h="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":h=v.n.precision;break;case "EPSILON":h="highp"==v.n.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":h="u_va_frame_factor";break;default:m.error("Unknown directive ("+a.$h+", "+a.jh+"): "+e)}b(a,e,h)}};a.xA=function(a){return a.$h};a.Bo=function(a){return a.jh};a.dw=function(a,d){for(var e=
d.Od,f=0;f<e.length;f++){var h=e[f][0],g=e[f][1];c(a,h)&&b(a,h,g)}};a.xv=function(a,b){var c=JSON.stringify(a)+JSON.stringify(b),f=u[c];if(f)return f;var h=a.jh,f=g(e.shaders_dir,a.$h),h=g(e.shaders_dir,h);if(!f||!h)return null;var q=a.Od||[],p=d("vert",f,q,b),q=d("frag",h,q,b),f=K,l=k(f,c,p,f.VERTEX_SHADER),t=k(f,c,q,f.FRAGMENT_SHADER),h=f.createProgram();f.attachShader(h,l);f.attachShader(h,t);f.linkProgram(h);f.validateProgram(h);f.getProgramParameter(h,f.VALIDATE_STATUS)==f.qz&&m.error("B4W Error - shader program is not valid",
c);x.Ft(h,c,l,t,p,q);p={wm:l,vo:t,sj:h,attributes:{},Xh:{},Fh:[],Ll:{},Uq:[],Wa:a};l=f.getProgramParameter(h,f.ACTIVE_ATTRIBUTES);for(q=0;q<l;q++)t=f.getActiveAttrib(h,q).name,p.attributes[t]=f.getAttribLocation(h,t);l=f.getProgramParameter(h,f.ACTIVE_UNIFORMS);for(q=0;q<l;q++)t=f.getActiveUniform(h,q).name.split("[0]").join(""),p.Xh[t]=f.getUniformLocation(h,t);return u[c]=f=p};a.wu=function(){return q};a.yv=function(){return u};a.cleanup=function(){for(var a in u){var b=u[a];K.deleteProgram(b.sj);
K.deleteShader(b.wm);K.deleteShader(b.vo);delete u[a]}for(var c in s)delete s[c];for(var d in q)delete q[d]};a.Wz=function(a){var b=a.Od;m.log("Shader: "+a.$h+" "+a.jh+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)m.log("  "+b[a][0],b[a][1])};a.u=f;a.yn=function(a,b){return b in a.Xh?!0:!1};a.Pv=function(a){return(K.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,n){function b(a){return 65536<a.C?K.Ao()?!1:!0:!1}function c(a){return 0<a.X.length?!0:!1}function g(a,b,e){if(!c(a))return a;e||u.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.C*(b||1)+", will use drawArrays","color: #aa0");b=a.X;e=a.C;var f=a.A,h=a.r,g;for(g in f){var q=f[g],k=x(q,e);f[g]=d(b,q,k)}for(f=0;f<h.length;f++){var r=h[f];for(g in r)q=r[g],k=x(q,e),r[g]=d(b,q,k)}a.C=b.length;a.X=new Uint16Array(0);return a}function d(a,b,c){if(0==
b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var f=a[e],h=0;h<c;h++)d[c*e+h]=b[c*f+h];return d}function l(a,b){var c=a.Uc,d=a.Ib[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function h(b,c){var d,e;switch(c){case a.Ng:case a.gi:d=F.TRIANGLES;e=F.STATIC_DRAW;break;case a.Em:d=F.POINTS;e=F.STATIC_DRAW;break;case a.Dm:d=F.TRIANGLES;e=F.DYNAMIC_DRAW;break;case a.qr:d=F.POINTS;e=F.DYNAMIC_DRAW;
break;case a.rr:d=F.LINES;e=F.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.Yh=e}function k(a){a.Vd?(a.qd||(a.qd=F.createBuffer()),F.bindBuffer(F.ELEMENT_ARRAY_BUFFER,a.qd),F.bufferData(F.ELEMENT_ARRAY_BUFFER,a.Vd,a.Yh),a.Fi=a.Vd.byteLength):a.Fi=0;a.Af||(a.Af=F.createBuffer());F.bindBuffer(F.ARRAY_BUFFER,a.Af);F.bufferData(F.ARRAY_BUFFER,a.Uc,a.Yh);a.Yn=a.Uc.byteLength}function f(a){for(var b=q.lb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].X.length;b.X=new Uint32Array(c);
for(d=c=0;d<a.length;d++)c+=a[d].C;b.C=c;var e=a[0],f;for(f in e.A){for(d=c=0;d<a.length;d++)c+=a[d].A[f].length;b.A[f]=new Float32Array(c)}for(f in e.r[0]){for(d=c=0;d<a.length;d++)c+=a[d].r[0][f].length;for(d=0;d<e.r.length;d++)b.r[d]=b.r[d]||{},b.r[d][f]=new Float32Array(c)}for(e=d=c=0;e<a.length;e++){f=a[e];for(var h=f.X,g=f.C,k=f.A,r=0;r<h.length;r++)b.X[c+r]=h[r]+d;var c=c+h.length,m;for(m in k){var h=k[m],p=d*x(h,g);b.A[m].set(h,p)}for(r=0;r<f.r.length;r++){var k=f.r[r],l=b.r[r];for(m in k)h=
k[m],p=d*x(h,g),l[m].set(h,p)}d+=g}return b}function p(a,b,c,d,e,f){var h=q.lb("SUBMESH_"+a.name+"_"+b),k=a.submeshes[b],r=k.base_length,p=a.materials[b];h.C=r;if(v(c,"a_texcoord")){var l=null,t=a.materials[b];b=a.submeshes[b];if(t.texture_slots.length)switch(t=t.texture_slots[0],t.texture_coords){case "UV":t=a.uv_textures.indexOf(t.uv_layer);-1==t||0==t?l=new Float32Array(b.texcoord):1==t&&(l=new Float32Array(b.texcoord2));break;case "ORCO":for(var s=a.b4w_bounding_box,l=new Float32Array(2*b.base_length),
t=(s.max_x+s.min_x)/2,x=(s.max_z+s.min_z)/2,z=s.max_x-s.min_x,s=s.max_z-s.min_z,A=0,w=0;w<b.position.length;w+=3)l[A++]=(b.position[w]-t)/z+.5,l[A++]=(x-b.position[w+2])/s+.5}null===l&&(l=new Float32Array(b.texcoord));b=l}else b=new Float32Array(0);var I,l=k.group;if(v(c,"a_influence")&&d){t=new Float32Array(4*r);x=l.length/r;z=new Float32Array(x);for(s=0;s<x;s++)for(I in z[s]=-1,d)if(A=d[I],A.gr===s){z[s]=A.eh;break}w=3<x?x:4;d=new Float32Array(w);I=new Uint32Array(w);for(var s=new Float32Array(4),
A=new Float32Array(w),w=new Uint32Array(w),ia=new Float32Array(4),F=0;F<r;F++)d.set(A),I.set(w),s.set(ia),t.set(m(l,x,F,r,z,d,I,s),4*F)}else t=new Float32Array(0);I=t;d=e?q.ra(e):{};d.a_color={Re:!0};d.a_color.src=v(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,jc:7}]:[];e={a_texcoord:b,a_influence:I};I=k.vertex_colors;b=k.color;l=a.name;t=[];for(x=0;x<I.length;x++)t.push(I[x].name);for(var fa in d)if(x=d[fa].src,x.length){for(s=z=0;s<x.length;s++)z+=q.vf(x[s].jc);e[fa]=new Float32Array(z*
r);for(s=A=0;s<x.length;s++){var U=x[s].name,w=x[s].jc,ia=q.iq(w),Y=t.indexOf(U);if(-1==Y)throw'B4W Error: vertex color "'+U+'" for mesh "'+l+'" not found.';var F=I[Y].mask,E=q.vf(F);(w&F)!==w&&u.error("B4W Error: Wrong color extraction from "+U+" to "+fa+".");for(var ea=U=0;ea<Y;ea++)U+=q.vf(I[ea].mask);Y=U*r;for(U=0;U<r;U++)for(ea=0;3>ea;ea++)ia[ea]&&(e[fa][U*z+(A+q.Ph(w,ea))]=b[Y+U*E+q.Ph(F,ea)]);A+=E}}else e[fa]=new Float32Array(0);fa=a.uv_textures;d=k.texcoord;I=k.texcoord2;b=a.name;if(f)for(var na in f){l=
fa.indexOf(na);if(-1==l)throw'B4W Error: uv map "'+na+'" for mesh "'+b+'" not found';if(0==l)var aa=new Float32Array(d);else 1==l&&(aa=new Float32Array(I));e[f[na]]=aa}h.A=e;h.X=new Uint32Array(k.indices);f=k.position.length/r/3;aa=(na=v(c,"a_normal")&&k.normal.length?!0:!1)&&v(c,"a_tangent")&&k.tangent.length?!0:!1;fa=na&&p.texture_slots.length&&v(c,"a_tangent")&&"ORCO"==p.texture_slots[0].texture_coords?!0:!1;for(e=0;e<f;e++){p={};d=new Float32Array(3*r);I=new Float32Array(na?3*r:0);b=new Float32Array(aa||
fa?4*r:0);l=e*r*3;t=l+3*r;d.set(k.position.subarray(l,t),0);na&&(l=e*r*3,t=l+3*r,I.set(k.normal.subarray(l,t),0));if(aa)l=e*r*4,t=l+4*r,b.set(k.tangent.subarray(l,t),0);else if(fa)for(l=I,t=b,x=r,u.warn('B4W Warning: Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+a.name+'". Please add a UV-map.'),z=0;z<x;z++)s=y,A=J,s[0]=l[3*z],s[1]=l[3*z+1],s[2]=l[3*z+2],H.cross(s,q.AXIS_Z,A),0==H.length(A)&&H.cross(s,q.AXIS_X,A),H.normalize(A,A),t[4*z]=A[0],t[4*z+
1]=A[1],t[4*z+2]=A[2],t[4*z+3]=1;else if(na&&v(c,"a_tangent"))for(b=new Float32Array(4*r),e=0;e<b.length;e++)b[e]=1;p.a_position=d;p.a_normal=I;p.a_tangent=b;h.r.push(p)}if(1<f){a=h.r[0];var p={},K;for(K in a)p[K]=new Float32Array(a[K]);h.r.push(p)}v(c,"a_polyindex")&&(g(h,1,!0),h.A.a_polyindex=B(h));return h}function v(a,b){return-1<a.indexOf(b)?!0:!1}function m(a,b,c,d,e,f,h,g){for(var q=!0,k=0;k<b;k++){var r=a[k*d+c];if(-1!==r){var m=e[k];-1!==m&&(f[k]=r,h[k]=m,q=!1)}}if(q)return g;t(f,h,!1);for(k=
a=0;4>k;k++)a+=f[k];if(.01>a)return g;for(k=0;4>k;k++)f[k]/=a;if(.01>Math.abs(f[0]-1))g[0]=h[0]+1;else for(k=0;4>k;k++)g[k]=h[k]+f[k];return g}function x(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function t(a,b,c){var d=a.length,e=d,f=!1;for(c=c?-1:1;1<e||f;){1<e&&(e=Math.floor(e/1.247330950103979));for(var f=!1,h=0;e+h<d;h++)0>c*(a[h]-a[h+e])&&(f=a[h],a[h]=a[h+e],a[h+e]=f,f=b[h],
b[h]=b[h+e],b[h+e]=f,f=!0)}}function z(a,b,c){var d=[],e=[];H.subtract(b,a,d);H.subtract(c,a,e);H.normalize(d,d);H.normalize(e,e);return Math.acos(H.dot(d,e))}function e(a,b,d){b||(b=[]);d=d?a.r[0].a_normal:a.r[0].a_position;if(c(a)){a=a.X;for(var e=a.length/3,f=0;f<e;f++){var h=new Float32Array(9),g=a[3*f];h[0]=d[3*g];h[1]=d[3*g+1];h[2]=d[3*g+2];g=a[3*f+1];h[3]=d[3*g];h[4]=d[3*g+1];h[5]=d[3*g+2];g=a[3*f+2];h[6]=d[3*g];h[7]=d[3*g+1];h[8]=d[3*g+2];b[f]=h}}else for(f=0;f<d.length;f++)h=new Float32Array(9),
h[0]=d[9*f],h[1]=d[9*f+1],h[2]=d[9*f+2],h[3]=d[9*f+3],h[4]=d[9*f+4],h[5]=d[9*f+5],h[6]=d[9*f+6],h[7]=d[9*f+7],h[8]=d[9*f+8],b[f]=h;return b}function B(a){for(var b=new Float32Array(a.C),c=0;c<a.C;c++)b[c]=c%3;return b}function A(a,b,c){var d=H.dist(a,b);a=H.dist(a,c);b=H.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}var u=n("__print"),s=n("__tsr"),q=n("__util"),K=n("__extensions"),H=n("vec3"),y=new Float32Array(3),J=new Float32Array(3),r=new Float32Array(3);a.Zc=10;a.Mm=20;a.vz=30;a.gi=10;a.Em=
20;a.Dm=30;a.qr=40;a.rr=50;a.Ng=a.gi;var F=null;a.Wb=function(a){F=a};a.Yz=function(a){var b=_buffers[a];F.deleteBuffer(b.qd);F.deleteBuffer(b.Af);delete _buffers[a]};a.iy=function(d,e,f,q){b(d)&&g(d);var r=d.X,m=d.C,p=d.r,l={},y;for(y in d.A)y in q&&!q[y].Re||(l[y]=d.A[y]);q={Vd:null,Uc:null,il:0,count:0,Ib:{},mode:0,Yh:0,Fi:0,Yn:0,Af:null,qd:null,Si:null};if(r.length)if(y=r.length,65536>=m)var t=new Uint16Array(r),s=F.UNSIGNED_SHORT;else t=new Uint32Array(r),s=F.UNSIGNED_INT;else y=m,t=null;var v=
0,z=p.length,A;for(A in p[0])var u=p[0][A],v=v+u.length*z;for(A in l)u=l[A],v+=u.length;A=new Float32Array(v);var v=0,z={},B;for(B in l){var w=l[B];if(u=w.length)A.set(w,v),z[B]={Dz:B,Ic:x(w,m),offset:v,frames:1,length:u},v+=u}l=p.length;for(B in p[0])if(w=p[0][B],u=w.length,w=x(w,m),u){z[B]={Ic:w,offset:v,frames:l,length:u};1<l&&(z[B+"_next"]={Ic:w,offset:v+u,frames:l,length:u});for(var I=0;I<l;I++)w=p[I][B],A.set(w,v),v+=u}q.count=y;q.Vd=t;q.Uc=A;q.il=s;q.Ib=z;h(q,f);k(q);e!=a.Zc&&c(d)&&(q.Si={Bw:new Float32Array(r.length),
Cw:new Float32Array(r.length),Gu:new Float32Array(r.length/3),type:e});return q};a.nw=b;a.mw=c;a.jm=g;a.zy=function(a,b,c){h(a,b);a.count=c.length;a.Vd=c;a.il=c instanceof Uint16Array?F.UNSIGNED_SHORT:F.UNSIGNED_INT};a.Mj=function(a,b,c,d){var e=a.Uc,f=a.Ib,h=f[b];if(h){if(c&&h.Ic!=c)throw'Error: invalid num_comp for "'+b+'"';e.set(d,h.offset)}else e=e.length,h=new Float32Array(e+d.length),h.set(a.Uc),h.set(d,e),a.Uc=h,f[b]={Ic:c,offset:e};k(a)};a.Nu=l;a.ZA=function(a){a.Yh=F.STATIC_DRAW};a.ww=function(a){a.Yh=
F.DYNAMIC_DRAW};a.Ey=k;a.En=function(a){a.qd&&F.deleteBuffer(a.qd);a.Af&&F.deleteBuffer(a.Af)};a.Uo=function(a,b){return a.submeshes[b].base_length?!1:!0};a.Lq=function(a,b){for(var c=0;c<a.r.length;c++){var d=a.r[c].a_position;s.Dg(d,b,d,0);d=a.r[c].a_normal;0<d.length&&s.Jj(d,b,d,0);d=a.r[c].a_tangent;0<d.length&&s.Tq(d,b,d,0)}(c=a.A.au_center_pos)&&c.length&&s.Dg(c,b,c,0);return a};a.gy=function(a,b){var c=a.A.au_center_pos;if(c&&c.length){var d=new Float32Array(c);s.Dg(d,b,d,0);for(var e=0;e<
a.r.length;e++)for(var f=0;f<d.length;f++)a.r[e].a_position[f]+=d[f]-c[f];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.fy=function(a,b){var c=a.C,d;for(d in b){var e=b[d].length;a.A[d]=new Float32Array(e*c);for(var f=0;f<c;f++)for(var h=0;h<e;h++)a.A[d][f*e+h]=b[d][h]}};a.hy=f;a.vw=function(a,b,c){if(!a.C)return q.lb("EMPTY");var d=c.length;65536<a.C*d&&!K.Ao()&&g(a,d);var e=a.X,f=a.C,h=a.A;a=a.r;for(var k in b){var r=b[k].length,m=r*f;h[k]=new Float32Array(m);
for(var p=0;p<f;p++)for(m=0;m<r;m++)h[k][p*r+m]=b[k][m]}b=q.lb("CLONE_"+d+"_SUBMESHES");b.C=f*d;b.X=new Uint32Array(e.length*d);for(p=0;p<d;p++)for(r=e.length*p,k=f*p,m=0;m<e.length;m++)b.X[r+m]=e[m]+k;for(var l in h)for(e=h[l],m=e.length*d,r=x(e,f),b.A[l]=new Float32Array(m),p=0;p<d;p++)k=f*r*p,b.A[l].set(e,k);for(l in a[0])for(p=0;p<a.length;p++)for(e=a[p][l],m=e.length*d,r=x(e,f),b.r[p]=b.r[p]||{},b.r[p][l]=new Float32Array(m),m=0;m<d;m++)switch(h=c[m],k=f*r*m,l){case "a_position":s.Dg(e,h,b.r[p][l],
k);break;case "a_normal":s.Jj(e,h,b.r[p][l],k);break;case "a_tangent":s.Tq(e,h,b.r[p][l],k);break;default:throw"Wrong attribute name: "+l;}return b};a.no=p;a.Qu=function(a){var b=a.C,c=a.r[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint16Array(4*a.X.length);for(var f=0;f<b;f++)d[12*f]=c[3*f],d[12*f+1]=c[3*f+1],d[12*f+2]=c[3*f+2],d[12*f+3]=c[3*f],d[12*f+4]=c[3*f+1],d[12*f+5]=c[3*f+2],d[12*f+6]=c[3*f],d[12*f+7]=c[3*f+1],d[12*f+8]=c[3*f+2],d[12*f+9]=c[3*f],d[12*f+10]=c[3*f+
1],d[12*f+11]=c[3*f+2],e[8*f]=-.5,e[8*f+1]=-.5,e[8*f+2]=-.5,e[8*f+3]=.5,e[8*f+4]=.5,e[8*f+5]=.5,e[8*f+6]=.5,e[8*f+7]=-.5,a[6*f]=4*f+2,a[6*f+1]=4*f+1,a[6*f+2]=4*f,a[6*f+3]=4*f+2,a[6*f+4]=4*f,a[6*f+5]=4*f+3;c=q.lb("HALO");c.r=[];c.r[0]={};c.C=4*b;c.r[0].a_position=d;c.A.a_halo_bb_vertex=e;c.X=a;return c};a.Yv=v;a.Ru=function(a){for(var b=["a_position","a_normal"],c=[],d=0;d<a.submeshes.length;d++){var e=p(a,d,b,null,null,null);e.C&&c.push(e)}return 0==c.length?q.lb("EMPTY"):1==c.length?c[0]:f(c)};a.yy=
function(a,b,c){for(var d=a.Vd,e=l(a,"a_position"),f=a.Si,h=f.Bw,g=f.Cw,f=f.Gu,k=d,r=k.length/3,m=0;m<r;m++){var p=k[3*m],y=k[3*m+1],t=k[3*m+2],s=e[3*p+1],v=e[3*p+2],w=e[3*y+1],I=e[3*y+2],ia=e[3*t+1],x=e[3*t+2];h[3*m]=(e[3*p]+e[3*y]+e[3*t])/3;h[3*m+1]=(s+w+ia)/3;h[3*m+2]=(v+I+x)/3}q.ce(h,b,g);b=h.length/3;for(e=0;e<b;e++)g=h[3*e]-c[0],k=h[3*e+1]-c[1],r=h[3*e+2]-c[2],f[e]=g*g+k*k+r*r;c=d;d=f.length;if(!(2>d))for(h=d,e=!1;1<h||e;)for(1<h&&(h=Math.floor(h/1.247330950103979)),e=!1,b=0;h+b<d;b++)0>f[b]-
f[b+h]&&(e=f[b],f[b]=f[b+h],f[b+h]=e,e=c,g=b,k=b+h,r=e[3*g],m=e[3*g+1],p=e[3*g+2],e[3*g]=e[3*k],e[3*g+1]=e[3*k+1],e[3*g+2]=e[3*k+2],e[3*k]=r,e[3*k+1]=m,e[3*k+2]=p,e=!0);d=c;F.bindBuffer(F.ELEMENT_ARRAY_BUFFER,a.qd);F.bufferData(F.ELEMENT_ARRAY_BUFFER,d,F.DYNAMIC_DRAW)};a.Tx=t;a.qn=function(a,b,c){for(var d=b.length/3,e=a.length/3,f=[],h=Array(3),g=Array(3),q=Array(3),k=0;k<e;k++){for(var r=a[3*k],m=a[3*k+1],p=a[3*k+2],l=0;3>l;l++)h[l]=b[3*r+l],g[l]=b[3*m+l],q[l]=b[3*p+l];if(c)var l=z(h,g,q),y=z(g,
q,h),t=Math.PI-l-y;else t=y=l=1;var w=f,I;I=h;var s=q,v=[],fa=[],x=[];H.subtract(g,I,v);H.subtract(s,I,fa);H.cross(v,fa,x);H.normalize(x,x);I=x;for(s=0;3>s;s++)v=3*m+s,fa=3*p+s,w[3*r+s]=l*I[s],w[v]=y*I[s],w[fa]=t*I[s]}if(c)for(var Y in c)for(k=c[Y],a=0;3>a;a++){b=3*k[0]+a;for(e=1;e<k.length;e++)h=3*k[e]+a,f[b]+=f[h];for(e=1;e<k.length;e++)h=3*k[e]+a,f[h]=f[b]}for(k=0;k<d;k++){c=k;Y=f;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=Y[e];H.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,Y[e]=a[b]}return f};
a.sn=function(a,b,c){for(var d={},e=b.length/3,f=0;f<e;f++){var h=String(b[3*f])+String(b[3*f+1])+String(b[3*f+2]);d[h]=[]}e=a.length;for(f=0;f<e;f++)b=a[f],h=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),h in d&&d[h].push(b);return d};a.Zk=function(a,b,c,d){var f=e(a,null,!1);if(c)var h=e(a,null,!0);var g=f.length,k=new Float32Array(g),m=y,p=J;for(a=0;a<g;a++){var l=f[a];m.set(l.subarray(0,3));p.set(l.subarray(3,6));r.set(l.subarray(6));k[a]=Math.sqrt(A(m,p,r))}m=new Float32Array(g);m[0]=k[0];
for(a=1;a<g;a++)m[a]=m[a-1]+k[a];g=m[k.length-1];k=[];for(a=0;a<b;a++){var p=g*q.kc(d),p=q.si(m,p,0,m.length-1),l=c?h[p]:f[p],p=a,t=l,s=d,l=void 0,l=new Float32Array(3),v=t[0],x=t[1],z=t[2],w=t[3],I=t[4],ia=t[5],u=t[6],fa=t[7],U=t[8],t=q.kc(s),s=q.kc(s);1<t+s&&(t=1-t,s=1-s);var Y=1-t-s,x=Y*x+t*I+s*fa,z=Y*z+t*ia+s*U;l[0]=Y*v+t*w+s*u;l[1]=x;l[2]=z;k[p]=l}return k};a.cA=e;a.mo=B;a.uB=A;a.Hv=function(a,b,c,d){var e=b[0]-a[0],f=c[0]-a[0],h=b[1]-a[1],g=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=h*a-b*g;d[1]=
f*b-e*a;d[2]=e*g-h*f;return d};a.nx=function(a,b,c){a=a.r[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]}};b4w.module.__objects=function(a,n){function b(a){a={type:a,gd:0,Xv:[0,0],e:new Float32Array(3),quat:new Float32Array(4),Tc:new Float32Array(8),G:new Float32Array(16),bp:new Float32Array(16),Va:new Float32Array(3),Ud:new Float32Array(3),br:!1,ca:0,Hj:0,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Me:null,Wq:!1,Fc:0,Pf:0,zb:!1,pb:null,za:null,Na:null,fo:!0,L:null,Ni:null,lh:0,fh:0,Uk:0,wh:0,ff:0,Vp:"",Qj:!1,Lb:!1,rb:!1,Mb:!1,Vb:!1,Kb:!1,uc:!1,Ge:!1,Vc:!1,Gi:!1,kd:!1,xa:!1,Qf:!1,ph:!1,aj:!1,Kc:!1,
lj:!1,Wi:!1,is_visible:!1,ei:0,Wc:0,ue:0,Nd:0,Md:0,Jd:0,sd:"",xb:null,ri:!1,bd:!1,Ug:"",mk:!1,Pe:0,time:0,tm:0,dr:0,max_bones:0,kh:!1,ai:!1,sh:!1,Fd:!1,Ed:1,ek:0,dk:1,Kj:new Int8Array([-1,-1]),Bj:[],sp:[],vq:[],Ub:null,Tb:null,cc:null,bc:null,fc:null,Wp:null,hf:null,xh:null,Db:null,lk:null,jk:null,kk:null,Ha:null,rc:null,jb:null,Ee:null,Fe:null,scale:1,Zd:1E4};A.identity(a.quat);e.identity(a.Tc);s.identity(a.G);s.identity(a.bp);return a}function c(a,b,c,d){var e=a.d.va,f;for(f in e){var h=a.name+
"_"+f;f in d||(d[f]=b.length,b.push(e[f][0]));c.push(h,d[f])}}var g=n("__animation"),d=n("__batch"),l=n("__boundings"),h=n("__camera"),k=n("__config"),f=n("__constraints"),p=n("__curve"),v=n("__lights"),m=n("__nla"),x=n("__particles");n("__print");var t=n("__scenes"),z=n("__transform"),e=n("__tsr"),B=n("__util"),A=n("quat"),u=n("vec3"),s=n("mat4"),q=k.n,K=0,H=new Float32Array(4);a.Di=b;a.sm=function(a,k){var r;r=a.parent;if(!(r=r&&r.Es)){if(!(r="ARMATURE"===a.type||"CAMERA"===a.type)&&(r="MESH"===
a.type)){var A=g.Ui(a),G=a.b4w_do_not_batch,n=a.b4w_dynamic_geometry,T=a.b4w_collision,S=a.b4w_vehicle,R=a.b4w_floating;r=a.b4w_character;var L=a.b4w_billboard,O=x.$v(a),Q=m.Vo(a);if(!(A=A||G||n||T||S||R))a:{A=a.data;for(G=0;G<A.materials.length;G++)if("LENS_FLARES"===A.materials[G].name){A=!0;break a}A=!1}r=A||O||r||L||Q}!r&&(r="EMPTY"===a.type)&&(r=g.Ui(a),L=m.Vo(a),r=r||L)}r=r?!0:!1;a.Es=r;a.d=b("MESH"===a.type?r?"DYNAMIC":"STATIC":a.type);a.Za=null;a.Dd=[];a.Cb||(a.Cb=null);r=a.d;O=a.location;
L=a.scale[0];B.Ww(a.rotation_quaternion,H);z.set_translation(a,O);z.set_rotation(a,H);z.set_scale(a,L);switch(a.type){case "ARMATURE":O=a.pose.bones;for(L=0;L<O.length;L++)Q=O[L],A=Q.bone,G=new Float32Array(A.matrix_local),n=new Float32Array(16),s.invert(G,n),T=new Float32Array(Q.matrix_basis),S=new Float32Array(3),u.subtract(A.tail_local,A.head_local,S),B.Ty(S,n,S),Q.Is=S,Q.Bs=[Q].concat(Q.parent_recursive),Q.Qm=e.uo(G,e.create()),Q.Pm=e.uo(T,e.create()),Q.ak=e.create(),Q.ki=!1;O=g.rt(a);r.fc=O;
O=g.rn(a,O);a.b4w_animation_mixing?(r.Ub=new Float32Array(O.ja),r.Tb=new Float32Array(O.ja),r.cc=new Float32Array(O.e),r.bc=new Float32Array(O.e)):(r.Ub=O.ja,r.Tb=O.ja,r.cc=O.e,r.bc=O.e);r.Wp=O;r.Pe=0;r.Fd=a.b4w_animation_mixing;break;case "MESH":r.Kc=q.all_objs_selectable||a.b4w_selectable;r.lj=a.b4w_selectable;r.bd=a.b4w_billboard;r.Ug="BASIC";r.mk="SPHERICAL"==a.b4w_billboard_geometry;r.Ni={Sv:a.b4w_glow_settings.glow_duration,Uv:a.b4w_glow_settings.glow_period,Vv:a.b4w_glow_settings.glow_relapses};
r.Kc&&(a.Nm=B.cv(K),K++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.ai=a.data.b4w_vertex_anim.length?!0:!1;if(L=g.get_first_armature_object(a)){O=a.d;Q=a.data.vertex_groups;if(Q.length){A=L.data.bones;G=L.pose.bones;n=0;T={};for(S=0;S<A.length;S++){var R=A[S].name,Z=B.keysearch("name",R,Q);if(Z){var N=B.cl(G,"name",R);T[R]={on:S,eh:n++,Ml:N,gr:Z.index}}}O.fc=T;O.max_bones=n;O.sh=!0}O=a.d.fc;O=g.rn(L,O);L.b4w_animation_mixing?(r.Ub=new Float32Array(O.ja),r.Tb=new Float32Array(O.ja),r.cc=
new Float32Array(O.e),r.bc=new Float32Array(O.e)):(r.Ub=O.ja,r.Tb=O.ja,r.cc=O.e,r.bc=O.e);r.Wp=O;r.Pe=0}if(g.fl(a)){L=a.d;O=a.data.materials;Q=[];A=[];for(G=0;G<O.length;G++)if((n=O[G].node_tree)&&n.animation_data)for(S=n.animation_data,n={},(T=S.action)&&c(T,Q,A,n),S=S.nla_tracks,R=0;R<S.length;R++)for(Z=S[R].strips,N=0;N<S[R].strips.length;N++)T=Z[N].action,c(T,Q,A,n);L.hf=Q;L.xh=A}a.O=[];r.Lb=a.b4w_shadow_cast;r.rb=a.b4w_shadow_receive;r.Mb=a.b4w_shadow_cast_only&&r.Lb;r.Vb=a.b4w_reflexible;r.Kb=
a.b4w_reflexible_only&&r.Vb;r.uc=a.b4w_reflective;r.Ge=a.b4w_caustics;r.Vc=a.b4w_wind_bending;r.ei=a.b4w_wind_bending_angle;L=d.$y(a.b4w_wind_bending_angle,d.jt(a.data.b4w_bounding_box),a.scale[0]);r.Wc=L;r.ue=a.b4w_wind_bending_freq;r.Nd=a.b4w_detail_bending_freq;r.Md=a.b4w_detail_bending_amp;r.Jd=a.b4w_branch_bending_amp;r.ph=!1;r.sd=a.b4w_main_bend_stiffness_col;L=a.b4w_detail_bend_colors;r.xb={};r.xb.mp=L.leaves_stiffness_col;r.xb.lp=L.leaves_phase_col;r.xb.Cp=L.overall_stiffness_col;r.Qf=a.b4w_do_not_cull;
r.Gi=a.b4w_disable_fogging;r.kd=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";L=a.data.materials[0];r.lh=L.physics.friction;r.fh=L.physics.elasticity;r.wh=0;r.Zd=1E4;r.ff=a.b4w_lod_transition;r.aj=!0;break;case "CAMERA":h.xt(a);h.gt(a);break;case "LAMP":v.rw(a);break;case "CURVE":if(L=p.mu(a))a.Hs=L;break;case "EMPTY":r.Db=l.Xc(),L=l.fi(),r.rc=L}if(!k&&(a.parent&&"OBJECT"==a.parent_type?(O=r.e,Q=r.quat,L=r.scale,f.Ym(a,a.parent,O,Q,L)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==
a.parent.type?(O=r.e,Q=r.quat,f.Xm(a,a.parent,a.parent_bone,O,Q)):a.Cb&&a.Cb.b4w_group_relative?(L=e.Of(r.e,r.scale,r.quat),f.Os(a,a.Cb,L)):a.Cb&&!a.Cb.b4w_group_relative&&(z.v(a),Q=r.G,s.multiply(a.Cb.d.G,Q,Q),O=B.gf(Q),L=B.cj(Q),Q=B.matrix_to_quat(Q),z.set_translation(a,O),z.set_rotation(a,Q),z.set_scale(a,L)),L=a.dupli_group))for(O=L.objects,L=0;L<O.length;L++)O[L].Cb=a;a.field&&(r.Uk=a.field.strength,t.Zq(a));r.Qj=a.game.use_collision_compound;r.Vp=a.game.physics_type;z.v(a)};a.Hy=function(a){for(var b=
0;b<a.length;b++){var c=a[b];!c.d||"DYNAMIC"!=c.d.type&&"CAMERA"!=c.d.type||z.v(c);c.b4w_use_default_animation&&g.Ui(c)&&(g.apply_def(c),g.play(c,null,g.SLOT_ALL))}};a.cleanup=function(){K=0}};b4w.module.__particles=function(a,n){function b(){throw"_rand() undefined";}function c(a,b,c,d,h,g,k){var q=a.H.Lk,p=a.H.Gc,l=a.H.time;a=a.H.Xp;for(var v=b?4:1,n=0;n<q.length;n+=v){var r=q[n];if(r>a&&r<=l)for(r=0;8>r;r++)p[8*n+r]=h[r];for(r=0;8>r;r++)m[r]=p[8*n+r];r=x;r[0]=c[3*n];r[1]=c[3*n+1];r[2]=c[3*n+2];f.Wh(r,m,r);g[3*n]=r[0];g[3*n+1]=r[1];g[3*n+2]=r[2];var F=x;F[0]=d[3*n];F[1]=d[3*n+1];F[2]=d[3*n+2];f.Ij(F,m,F);k[3*n]=F[0];k[3*n+1]=F[1];k[3*n+2]=F[2];if(b)for(r=1;4>r;r++)g[3*(n+r)]=g[3*n],g[3*
(n+r)+1]=g[3*n+1],g[3*(n+r)+2]=g[3*n+2],k[3*(n+r)]=F[0],k[3*(n+r)+1]=F[1],k[3*(n+r)+2]=F[2]}}function g(a){a?(k.by(a),b=function(){return k.Yw()}):b=function(){return Math.random()}}var d=n("__config"),l=n("__geometry"),h=n("__scenes"),k=n("__util"),f=n("__tsr"),p=n("vec3"),v=d.Hd,m=new Float32Array(8),x=new Float32Array(3);a.bg=function(a){return 0<a.particle_systems.length?!0:!1};a.Ri=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.zA=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.$v=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.hv=function(a,d,e,h){e.H=e.H||{};var m=l.Ru(d),x=e.settings.count,s=e.settings.frame_start/v.ua,q=e.settings.frame_end/v.ua,n=e.settings.lifetime/v.ua,H=e.settings.lifetime_random,y=e.settings.emit_from,J=
e.settings.factor_random,r=e.settings.angular_velocity_mode,F=e.settings.angular_velocity_factor,G=e.settings.b4w_randomize_emission,W=e.settings.b4w_cyclic;g(e.seed);var T=e.H.Qy="WORLD"==e.settings.b4w_coordinate_system?!0:!1;e.H.frame=0;if(d=!a.Ue){var S;S=[];for(var R=0;R<x;R++)S.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);S=new Float32Array(S);for(var R=[],L=0;L<x;L++)R.push(4*L,4*L+2,4*L+1,4*L,4*L+3,4*L+2);R=new Uint16Array(R)}switch(y){case "VERT":for(var L=m.r[0].a_position,m=m.r[0].a_normal,O=L.length/
3,y=[],Q=0;Q<x;Q++){var Z=Math.round((O-1)*b());y.push(Z);d&&(y.push(Z),y.push(Z),y.push(Z))}O=[];for(Q=0;Q<y.length;Q++)O.push(L[3*y[Q]]),O.push(L[3*y[Q]+1]),O.push(L[3*y[Q]+2]);L=new Float32Array(O);O=[];for(Q=0;Q<y.length;Q++)O.push(m[3*y[Q]]),O.push(m[3*y[Q]+1]),O.push(m[3*y[Q]+2]);y=new Float32Array(O);break;case "FACE":L=[];y=[];Q=[];k.Ti(0,Q);O=l.Zk(m,x,!1,Q);k.Ti(0,Q);m=l.Zk(m,x,!0,Q);for(Q=0;Q<O.length;Q++)L.push(O[Q][0],O[Q][1],O[Q][2]),d&&(L.push(O[Q][0],O[Q][1],O[Q][2]),L.push(O[Q][0],
O[Q][1],O[Q][2]),L.push(O[Q][0],O[Q][1],O[Q][2])),y.push(m[Q][0],m[Q][1],m[Q][2]),d&&(y.push(m[Q][0],m[Q][1],m[Q][2]),y.push(m[Q][0],m[Q][1],m[Q][2]),y.push(m[Q][0],m[Q][1],m[Q][2]));L=new Float32Array(L);y=new Float32Array(y);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}y=[L,y];m=y[0];y=y[1];e.H.Qw=new Float32Array(m);e.H.Iw=new Float32Array(y);e.H.Rw=new Float32Array(m.length);e.H.Jw=new Float32Array(y.length);e.H.time=0;e.H.Xp=
-1;L=[];q=(q-s)/x;for(O=0;O<x;O++)Q=G?q*O+10*q*(.5-b()):q*O,W||(Q+=s),L.push(Q),d&&(L.push(Q),L.push(Q),L.push(Q));s=new Float32Array(L);e.H.Lk=new Float32Array(s);e.H.Zn=new Float32Array(s);e.H.Gc=new Float32Array(8*s.length);for(G=0;G<8*s.length;G++)for(W=0;8>W;W++)e.H.Gc[8*G+W]=h[W];T?c(e,d,m,y,h,m,y):(f.Dg(m,h,m,0),f.Jj(y,h,y,0));e=[];h=n*H;for(H=0;H<x;H++)T=h*b(),e.push(n-T),d&&(e.push(n-T),e.push(n-T),e.push(n-T));n=new Float32Array(e);e=[];for(h=0;h<x;h++){H=[b()-.5,b()-.5,b()-.5];p.normalize(H,
H);e.push(J*H[0]);e.push(J*H[1]);e.push(J*H[2]);switch(r){case "NONE":e.push(0);break;case "SPIN":case "VELOCITY":e.push(F);break;case "RAND":e.push(2*F*(b()-.5));break;default:throw"Undefined velocity factor";}if(d)for(H=e.slice(-4),T=0;12>T;T++)e.push(H[T%4])}x=new Float32Array(e);J=k.lb("EMITTER_PARTICLES");r=k.fd();r.a_position=m;r.a_normal=y;J.r[0]=r;d?J.X=R:(a.jd=l.Em,J.X=new Uint16Array(0));J.C=m.length/3;J.A.a_p_delay=s;J.A.a_p_lifetime=n;J.A.a_p_vels=x;d&&(J.A.a_p_bb_vertex=S);return J};
a.Dy=function(a){for(var b=a.O,d=0;d<b.length;d++){var h=b[d],g=b[d].Jc;if(g){var k=h.ab,m=g.H.Rw,q=g.H.Jw,p=g.H.Qw,v=g.H.Iw;g.H.Qy?c(g,!h.Ue,p,v,a.d.Tc,m,q):(h=v,g=a.d.Tc,v=q,f.Dg(p,g,m,0),f.Jj(h,g,v,0));l.ww(k);l.Mj(k,"a_position",3,m);l.Mj(k,"a_normal",3,q)}}};a.xx=function(a,b,c){var d=b.settings.lifetime/v.ua,f=b.settings.normal_factor,g=9.81*b.settings.effector_weights.gravity,k=b.settings.effector_weights.wind,q=b.settings.mass,m=b.settings.b4w_fade_in/v.ua,p=b.settings.b4w_fade_out/v.ua,l=
b.settings.b4w_cyclic;a.Lp=b.settings.frame_end/v.ua-b.settings.frame_start/v.ua;a.Hp=l?1:0;a.Il=f;a.Kp=g;f=h.Rv();a.mj[0]=f[0]*k;a.mj[1]=f[1]*k;a.mj[2]=f[2]*k;a.Np=d;a.Mp=q;a.Ip=m;a.Jp=p;a.Ue?(d=c.halo.size,k=c.halo.hardness,30>k?(k=.5,q=.9):40>k?(k=.1,q=1):50>k?(k=0,q=.8):(k=0,q=.5)):(d=b.settings.particle_size,q=k=1);a.Jl=d;a.Ep=k;a.Dp=q;d=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;
k=Math.min(2*d.length,b.length);for(q=0;q<k;q+=2)m=d[q/2],b[q]=m.position,b[q+1]=(m.color[0]+m.color[1]+m.color[2])/3;a.Pp=d.length}a.Op.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;k=Math.min(4*d.length,c.length);for(q=0;q<k;q+=4)m=d[q/4],c[q]=m.position,c[q+1]=m.color[0],c[q+2]=m.color[1],c[q+3]=m.color[2];a.Gp=d.length}a.Fp.set(c)};
a.Ex=function(a,b){a.H.Xp=a.H.time;a.H.time=b};a.Sw=function(a){for(var b=a.C,c=a.r[0].a_position,d=a.A.a_texcoord,f=[],h=[],g=0;g<b;g++)h.push(c[3*g]),h.push(c[3*g+1]),f.push(c[3*g+2]);f=new Float32Array(f);h=new Float32Array(h);a.A.a_lf_dist=f;a.A.a_lf_bb_vertex=h;a.A.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.O;for(var d=0;d<a.length;d++){var f=a[d],h=f.Jc;h&&h.name==b&&(f.Jl=c)}};a.set_normal_factor=function(a,b,c){a=a.O;for(var d=0;d<a.length;d++){var f=a[d],h=f.Jc;h&&h.name==b&&(f.Il=
c)}};a.set_factor=function(a,b,c){a=a.O;for(var d=0;d<a.length;d++){var f=a[d],h=f.Jc;if(h&&h.name==b){var g=h.H.Lk;if(1==c)h=g;else if(0==c)for(var k=!f.Ue,m=k?4:1,h=h.H.Zn,p=0;p<h.length;p+=m)h[p]=1E4,k&&(h[p+1]=h[p],h[p+2]=h[p],h[p+3]=h[p]);else for(var v=1/c,h=h.H.Zn,m=(k=!f.Ue)?4:1,x=0,p=0;p<h.length;p+=m)p>=x?(h[p]=g[p],x+=v):h[p]=1E4,k&&(h[p+1]=h[p],h[p+2]=h[p],h[p+3]=h[p]);l.Mj(f.ab,"a_p_delay",1,h)}}};a.Ly=function(a,b,c){a=a.particle_systems;for(var d=0;d<a.length;d++){var f=a[d];if("EMITTER"==
f.settings.type)for(var h=f.H.Lk,d=0;d<8*h.length;d++)f.H.Gc[8*d]=b[0],f.H.Gc[8*d+1]=b[1],f.H.Gc[8*d+2]=b[2],f.H.Gc[8*d+3]=b[3],f.H.Gc[8*d+4]=c[0],f.H.Gc[8*d+5]=c[1],f.H.Gc[8*d+6]=c[2],f.H.Gc[8*d+7]=c[3]}}};b4w.module.__primitives=function(a,n){function b(a,b,c,d){for(var g=[],k=[],l=[],e=[],B=2*c/(a-1),A=2*d/(b-1),u=0;u<a;u++)for(var s=-c+u*B,q=0;q<b;q++)if(k.push(s,0,-d+q*A),l.push(0,1,0),e.push(u/(a-1),q/(b-1)),u&&q){var n=u*b+q,H=n-1,y=(u-1)*b+q,J=y-1;g.push(n,H,y);g.push(H,J,y)}a=h.fd();a.a_position=new Float32Array(k);a.a_normal=new Float32Array(l);l=h.lb("GRID_PLANE");l.r[0]=a;l.A.a_texcoord=new Float32Array(e);l.X=new Uint32Array(g);l.C=k.length/3;return l}function c(a){var b=a.length;if(b%4)throw"Wrong array";
for(var c=[],g=[],k=0;k<b;k+=4){var l=a[k+1],z=a[k+2],e=a[k+3];d(a[k],g);d(l,g);d(z,g);d(e,g);c.push(k,k+1,k+2);c.push(k,k+2,k+3)}a=h.fd();a.a_position=new Float32Array(g);b=h.lb("FROM_QUADS");b.r[0]=a;b.X=new Uint32Array(c);b.C=g.length/3;return b}function g(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function d(a,b){b.push(a[0],a[1],a[2])}var l=n("__geometry"),h=n("__util"),k=n("__config").n;a.oA=function(a){for(var b=h.lb("LINE"),c=[],d=0;d<2*a;d++)c.push(d);d=h.fd();d.a_point=new Float32Array(c);
b.r[0]=d;b.X=new Uint32Array(c);b.C=2*a;return b};a.pA=function(a,c){var d=b(2,2,a,c);d.name="PLANE";return d};a.nA=b;a.lv=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==e-1)||1==b%2&&(0==a||a==z-1)?!0:!1}var g=c/=Math.pow(2,a-1),t=c,z=b+1,e=b+1;b=[];c=[];for(var B=0,A=0,u=-1,s=[],q=0;q<a;q++){for(var n=2*g/(z-1),H=2*t/(e-1),y=[],J=[],r=0,F=0;F<z;F++){for(var G=-g+F*n,W=[],T=0;T<e;T++){var S=-t+T*H;if(G>-B&&G<B&&S>-A&&S<A)W.push(-1),r++;else{for(var R=null,L=0;L<s.length;L+=3)if(G==s[L]&&
S==s[L+1]){R=s[L+2];break}L=null!==R?R:u+1;d(F,T)?(W.push(-2),r++):(null==R&&(0==T||T==e-1||0==F||F==z-1?(R=q==a-1?n:2*n,y.push(G,S,L)):R=n,c.push(G,R,S),u++),W.push(L));if(F&&T)if(1==F)if(d(F-1,T)){if(1<T){var S=L-1,R=J[F-1][T+1],O=R-1;b.push(L,S,O)}else R=J[F-1][T+1],O=R-1;b.push(L,O,R)}else d(F,T)||(S=L-1,R=J[F-1][T],b.push(L,S,R));else if(F==z-1){if(!d(F,T))if(T==e-1)S=L-1,R=J[F-1][T-1],O=J[F-2][T],b.push(L,S,R),b.push(L,R,O);else{var S=L-1,R=J[F-1][T],O=R-1,Q=R+1;b.push(L,S,O);b.push(L,O,R);
b.push(L,R,Q);2==T&&(Q=J[F-2][T-2],b.push(S,Q,O))}}else 1==T?d(F,T-1)?(S=J[F-1][T],R=J[F-1][T-1],b.push(L,R,S)):(S=W[T-1],R=J[F-1][T],O=J[F-2][T-1],b.push(L,S,R),b.push(S,O,R)):T==e-1?d(F,T)||(S=W[T-1],R=J[F-1][T-1],O=J[F-2][T],b.push(L,S,R),b.push(L,R,O)):-1!=J[F-1][T]&&-1!=J[F-1][T-1]&&-1!=W[T-1]?(S=W[T-1],R=J[F-1][T],O=J[F-1][T-1],b.push(L,S,R),b.push(S,O,R),T==e-2&&d(F,T+1)&&(Q=J[F-1][T+1],b.push(L,R,Q))):T==e-2&&d(F,T+1)&&(R=J[F-1][T],Q=J[F-1][T+1],b.push(L,R,Q))}}J.push(W)}s=y;B=g;A=t;g*=2;
t*=2}2E4>B&&(a=-(2*B)/(z-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-B,a,-A),c.push(-B,a,A),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(B,a,-A),c.push(B,a,A),L=u+1,b.push(L+3,L+2,L+1,L+2,L+0,L+1,L+6,L+4,L+2,L+4,L+0,L+2,L+5,L+7,L+1,L+7,L+3,L+1,L+5,L+4,L+7,L+7,L+4,L+6));a=h.fd();a.a_position=new Float32Array(c);g=h.lb("multigrid_plane");g.r[0]=a;g.X=new Uint32Array(b);g.C=c.length/3;k.Uj&&(l.jm(g,1,!0),a.a_polyindex=l.mo(g));return g};a.mA=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var c=[],g=[],k=0;k<b;k+=3){var l=a[k+1],z=a[k+2];d(a[k],g);d(l,g);d(z,g);c.push(k,k+1,k+2)}a=h.fd();a.a_position=new Float32Array(g);b=h.lb("FROM_TRIANGLES");b.r[0]=a;b.X=new Uint32Array(c);b.C=g.length/3;return b};a.lA=c;a.iv=function(a){a=h.Uy(a);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=c(b);a.name="FRUSTUM";return a};a.jv=function(){var a=h.lb("BILLBOARD"),
b=h.fd();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.r[0]=b;a.X=new Uint32Array([0,2,1,1,2,3]);a.C=4;return a};a.Ba=function(){var a=h.lb("BILLBOARD"),b=h.fd();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.r[0]=b;a.X=new Uint32Array([0,2,1,0,3,2]);a.C=4;return a};a.fv=function(){var a=h.lb("CUBEMAP_BOARD"),b=h.fd();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.r[0]=b;a.X=new Uint32Array([0,2,1,0,3,2]);a.C=4;return a};a.xo=function(a,b){var c=h.lb("UV_SPHERE"),
k,x,t=[],z=[],e=[];for(x=0;8>=x;x++)for(k=0;16>=k;k++){var B=k/16,A=x/8;z.push(-a*Math.cos(2*B*Math.PI)*Math.sin(A*Math.PI)+b[0],a*Math.cos(A*Math.PI)+b[1],a*Math.sin(2*B*Math.PI)*Math.sin(A*Math.PI)+b[2])}for(x=B=0;8>x;x++)for(k=0;16>k;k++){var A=g(z,17*x+k+1),u=g(z,17*x+k),s=g(z,17*(x+1)+k),q=g(z,17*(x+1)+k+1);Math.abs(A[1])==a+b[1]?(d(A,t),d(s,t),d(q,t),e.push(B,B+1,B+2),B+=3):Math.abs(s[1])==a+b[1]?(d(A,t),d(u,t),d(s,t),e.push(B,B+1,B+2),B+=3):(d(A,t),d(u,t),d(s,t),d(q,t),e.push(B,B+1,B+2),e.push(B,
B+2,B+3),B+=4)}k={};k.a_position=t;z=l.sn(e,z,t);k.a_normal=l.qn(e,t,z);k.a_tangent=[];c.A.a_influence=[];c.A.a_color=[];c.A.a_texcoord=[];c.r[0]=k;c.X=e;c.C=t.length/3;return c}};b4w.module.__prerender=function(a,n){var b=n("__config"),c=n("__debug"),g=n("__geometry"),d=n("__util"),l=n("vec3"),h=b.n,k="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH GLOW_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");a.Nl=function(a){if(-1<k.indexOf(a.type)){for(var b=!1,v=a.l,m=0;m<v.length;m++){var x=v[m],t=x,z=a,e=t.Ua,B=z.h;t.P=!0;e.is_visible=!1;if(e)if(e.ph)t.P=!1;else{var A=B.Sd,u=e.jb.t,s=e.Zd,A=Math.sqrt((u[0]-A[0])*(u[0]-A[0])+(u[1]-A[1])*(u[1]-A[1])+
(u[2]-A[2])*(u[2]-A[2])),u=e.ff*e.jb.ma;A>=e.wh&&A<s+u?(e.is_visible=!0,"GLOW_MASK"!=z.type||Boolean(t.k.$f)?(B=B.Wk,e.Qf?e=!1:"STATIC"===e.type?(s=e.jb,e=s.t,e=d.Xx(e,B,s.ma)):(s=e.Fe,e=s.t,e=d.Lu(e,B,s.Be,s.Ce,s.De)),e?t.P=!1:"WIREFRAME"==z.type&&(t.P=t.k.wireframe_mode==c.Lm.WM_DEBUG_SPHERES?t.k.Jk:!t.k.Jk)):t.P=!1):t.P=!1}else t.P=!1;x.P&&(b=!0)}switch(a.type){case "WIREFRAME":break;default:a.P="MAIN_OPAQUE"===a.type||"DEPTH"===a.type||b?!0:!1}}if("MAIN_BLEND"==a.type&&(b=a.h.Sd,l.dist(b,a.nr)>
h.alpha_sort_threshold&&h.alpha_sort&&a.l)){for(v=0;v<a.l.length;v++)x=a.l[v],t=x.k,m=x.Ua.G,t&&t.qa&&t.Cd!=g.Zc&&(t=t.ab)&&x.P&&(x=t.Si)&&x.type==g.Mm&&g.yy(t,m,b);a.nr.set(b)}}};b4w.module.__print=function(a){var n=!1,b=0,c=0;a.Hx=function(a){n=a};a.log=function(){n&&console.log.apply(console,arguments)};a.error=function(){b++;console.error.apply(console,arguments)};a.warn=function(){c++;console.warn.apply(console,arguments)};a.time=function(){n&&console.time.apply(console,arguments)};a.timeEnd=function(){n&&console.timeEnd.apply(console,arguments)};a.group=function(){n&&console.group.apply(console,arguments)};a.groupCollapsed=function(){n&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){n&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.Qv=function(){return c};a.Ev=function(){return b};a.clear_errors_warnings=function(){b=c=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,n){function b(a,b,c){c=c+">>"+a;c in x||(x[c]={im:[],gq:"undefined",type:a});x[c].im.push(b.name)}function c(a,b){param_id in x||(x[param_id]={im:[],gq:"deprecated",type:a});x[param_id].im.push(b.name)}function g(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var f=k.Ie(a);a.materials=c;a.submeshes=d;f.name=b;f.materials=a.materials.slice(0);f.submeshes=[];for(c=0;c<d.length;c++){var h=k.Yg(d[c]);f.submeshes.push(h)}return f}
var d=n("__boundings"),l=n("__curve"),h=n("__print"),k=n("__util"),f=n("vec3"),p=n("vec4"),v=n("quat"),m=n("mat4"),x={};a.Bt=function(a){x={};var d=a.worlds;if(0==d.length){h.warn("WARNING Datablock world is missing, reexport scene");var e={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},b4w_fog_color:[.5,.5,.5],b4w_fog_density:0};d.push(e)}for(var d=a.worlds,f=0;f<d.length;f++){var e=d[f],g=e.b4w_shadow_settings;
"csm_resolution"in g||(b("world",e,"b4w_shadow_settings.csm_resolution"),g.csm_resolution=2048);"self_shadow_polygon_offset"in g||(b("world",e,"b4w_shadow_settings.self_shadow_polygon_offset"),g.self_shadow_polygon_offset=1);"self_shadow_normal_offset"in g||(b("world",e,"b4w_shadow_settings.self_shadow_normal_offset"),g.self_shadow_normal_offset=.01);"b4w_enable_csm"in g||(b("world",e,"b4w_shadow_settings.b4w_enable_csm"),g.b4w_enable_csm=!1);"csm_num"in g||(b("world",e,"b4w_shadow_settings.csm_num"),
g.csm_num=1);"csm_first_cascade_border"in g||(b("world",e,"b4w_shadow_settings.csm_first_cascade_border"),g.csm_first_cascade_border=10);"first_cascade_blur_radius"in g||(b("world",e,"b4w_shadow_settings.first_cascade_blur_radius"),g.first_cascade_blur_radius=3);"csm_last_cascade_border"in g||(b("world",e,"b4w_shadow_settings.csm_last_cascade_border"),g.csm_last_cascade_border=100);"last_cascade_blur_radius"in g||(b("world",e,"b4w_shadow_settings.last_cascade_blur_radius"),g.last_cascade_blur_radius=
1.5);"fade_last_cascade"in g||(b("world",e,"b4w_shadow_settings.fade_last_cascade"),g.fade_last_cascade=!0);"blend_between_cascades"in g||(b("world",e,"b4w_shadow_settings.blend_between_cascades"),g.blend_between_cascades=!0);g=e.b4w_ssao_settings;"dist_factor"in g||(b("world",e,"b4w_ssao_settings.dist_factor"),g.dist_factor=0,g.samples=16);"hemisphere"in g||(b("world",e,"b4w_ssao_settings.hemisphere"),g.hemisphere=!1);"blur_depth"in g||(b("world",e,"b4w_ssao_settings.blur_depth"),g.blur_depth=!1);
"blur_discard_value"in g||(b("world",e,"b4w_ssao_settings.blur_discard_value"),g.blur_discard_value=1);"b4w_glow_color"in e||(e.b4w_glow_color=[1,1,1],b("object",e,"b4w_glow_color"));"b4w_glow_factor"in e||(e.b4w_glow_factor=1,b("object",e,"b4w_glow_factor"));"b4w_fog_density"in e||(b("world",e,"b4w_fog_density"),e.b4w_fog_density=0);"b4w_sky_settings"in e&&"rayleigh_brightness"in e.b4w_sky_settings||(b("world",e,"rayleigh_brightness"),e.b4w_sky_settings={procedural_skydome:!1,use_as_enviroment_map:!1,
color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"b4w_bloom_settings"in e?("blur"in e.b4w_bloom_settings||(b("world",e,"b4w_bloom_settings.blur"),e.b4w_bloom_settings.blur=4),"edge_lum"in e.b4w_bloom_settings||(b("world",e,"b4w_bloom_settings.edge_lum"),e.b4w_bloom_settings.edge_lum=1)):(b("world",e,"b4w_bloom_settings"),e.b4w_bloom_settings=
{key:.2,blur:4});"b4w_motion_blur_settings"in e?("motion_blur_factor"in e.b4w_motion_blur_settings||(b("world",e,"b4w_motion_blur_settings.motion_blur_factor"),e.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in e.b4w_motion_blur_settings||(b("world",e,"b4w_motion_blur_settings.motion_blur_decay_threshold"),e.b4w_motion_blur_settings.motion_blur_decay_threshold=.01)):(b("world",e,"b4w_motion_blur_settings"),e.b4w_motion_blur_settings={motion_blur_factor:.01,motion_blur_decay_threshold:.01});
"b4w_color_correction_settings"in e||(b("world",e,"b4w_color_correction_settings"),e.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in e.b4w_god_rays_settings||(b("world",e,"b4w_god_rays_settings.steps_per_pass"),e.b4w_god_rays_settings.steps_per_pass=10)}d=a.scenes;for(f=0;f<d.length;f++)e=d[f],"b4w_use_nla"in e||(e.b4w_use_nla=!1,b("scene",e,"b4w_use_nla")),"fps"in e||(e.fps=24,b("scene",e,"fps")),"b4w_nla_cyclic"in e||(e.b4w_nla_cyclic=!1,b("scene",
e,"b4w_nla_cyclic")),"b4w_nla_script"in e||(e.b4w_nla_script=[],b("scene",e,"b4w_nla_script")),"b4w_detect_collisions"in e&&(c("scene",e),delete e.b4w_detect_collisions),"audio_doppler_speed"in e||(e.audio_doppler_speed=343.3),"audio_doppler_factor"in e||(e.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in e||(e.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",e,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in e||(e.b4w_enable_convolution_engine=
!1),"b4w_enable_bloom"in e||(e.b4w_enable_bloom=!1,b("scene",e,"b4w_enable_bloom")),"b4w_enable_motion_blur"in e||(e.b4w_enable_motion_blur=!1,b("scene",e,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in e||(e.b4w_enable_color_correction=!1,b("scene",e,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in e||(e.b4w_enable_antialiasing=!0,b("scene",e,"b4w_enable_antialiasing"));d=a.meshes;for(f=0;f<d.length;f++)for(e=d[f],e.b4w_bounding_box||(b("mesh",e,"b4w_bounding_box"),e.b4w_bounding_box=
{max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0}),e.uv_textures||(b("mesh",e,"uv_textures"),e.uv_textures=[]),e.b4w_bounding_sphere_center||(e.b4w_bounding_sphere_center=[0,0,0]),e.b4w_bounding_cylinder_center||(e.b4w_bounding_cylinder_center=[0,0,0]),e.b4w_bounding_ellipsoid_center||(e.b4w_bounding_ellipsoid_center=[0,0,0]),e.b4w_bounding_ellipsoid_axes||(g=e.b4w_bounding_box,e.b4w_bounding_ellipsoid_axes=[(g.max_x-g.min_x)/2,(g.max_y-g.min_y)/2,(g.max_z-g.min_z)/2]),g=0;g<e.b4w_vertex_anim.length;g++){var m=
e.b4w_vertex_anim[g];"allow_nla"in m||(b('mesh["b4w_vertex_anim"]',e,"allow_nla"),m.allow_nla=!0)}d=a.cameras;for(f=0;f<d.length;f++)e=d[f],e.type||(e.type="PERSP",b("camera",e,"type")),"b4w_eye_target_dist"in e&&(delete e.b4w_eye_target_dist,c("camera",e)),"b4w_use_distance_limits"in e||(e.b4w_use_distance_limits=!1,b("camera",e,"b4w_use_distance_limits")),"b4w_distance_min"in e||(e.b4w_distance_min=1,b("camera",e,"b4w_distance_min")),"b4w_distance_max"in e||(e.b4w_distance_max=100,b("camera",e,
"b4w_distance_max")),"b4w_horizontal_translation_min"in e||(e.b4w_horizontal_translation_min=-100,b("camera",e,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in e||(e.b4w_horizontal_translation_max=100,b("camera",e,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in e||(e.b4w_vertical_translation_min=-100,b("camera",e,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in e||(e.b4w_vertical_translation_max=100,b("camera",e,"b4w_vertical_translation_max")),
"b4w_use_horizontal_clamping"in e||(e.b4w_use_horizontal_clamping=!1,b("camera",e,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in e||(e.b4w_rotation_left_limit=-Math.PI,b("camera",e,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in e||(e.b4w_rotation_right_limit=Math.PI,b("camera",e,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in e||(e.b4w_horizontal_clamping_type="LOCAL",b("camera",e,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in e||(e.b4w_use_vertical_clamping=
!1,b("camera",e,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in e||(e.b4w_rotation_down_limit=-Math.PI/2,b("camera",e,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in e||(e.b4w_rotation_up_limit=Math.PI/2,b("camera",e,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in e||(e.b4w_vertical_clamping_type="LOCAL",b("camera",e,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in e||(e.b4w_hover_angle_min=Math.PI/6,b("camera",e,"b4w_hover_angle_min")),"b4w_hover_angle_max"in e||(e.b4w_hover_angle_max=
Math.PI/6,b("camera",e,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in e||(e.b4w_enable_hover_hor_rotation=!0,b("camera",e,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in e||(e.b4w_use_panning=!0,b("camera",e,"b4w_use_panning"));d=a.lamps;for(f=0;f<d.length;f++)e=d[f],"b4w_generate_shadows"in e||(e.b4w_generate_shadows=!1,b("lamp",e,"b4w_generate_shadows")),"b4w_dynamic_intensity"in e||(e.b4w_dynamic_intensity=!1,b("lamp",e,"b4w_dynamic_intensity")),"use_diffuse"in e||(e.use_diffuse=
!0,b("lamp",e,"use_diffuse")),"use_specular"in e||(e.use_specular=!0,b("lamp",e,"use_specular"));d=a.speakers;for(f=0;f<d.length;f++)e=d[f],"b4w_behavior"in e||(e.b4w_behavior=e.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in e||(e.b4w_disable_doppler=!1),"b4w_delay"in e||(e.b4w_delay=0),"b4w_delay_random"in e||(e.b4w_delay_random=0),"b4w_volume_random"in e||(e.b4w_volume_random=0),"b4w_pitch_random"in e||(e.b4w_pitch_random=0),"b4w_fade_in"in e||(e.b4w_fade_in=0),"b4w_fade_out"in
e||(e.b4w_fade_out=0),"b4w_loop"in e||(e.b4w_loop=!1),"b4w_loop_count"in e||(e.b4w_loop_count=0),"b4w_loop_count_random"in e||(e.b4w_loop_count_random=0),"b4w_playlist_id"in e||(e.b4w_playlist_id="");d=a.textures;for(f=0;f<d.length;f++)e=d[f],"b4w_anisotropic_filtering"in e||(e.b4w_anisotropic_filtering="OFF",b("texture",e,"b4w_anisotropic_filtering")),"b4w_water_foam"in e||(e.b4w_water_foam=!1,b("texture",e,"b4w_water_foam")),"b4w_foam_uv_freq"in e||(e.b4w_foam_uv_freq=[1,1],b("texture",e,"b4w_foam_uv_freq")),
"b4w_foam_uv_magnitude"in e||(e.b4w_foam_uv_magnitude=[1,1],b("texture",e,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in e||(e.b4w_parallax_steps=5,b("material",e,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in e||(e.b4w_parallax_lod_dist=10,b("material",e,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in e||(e.b4w_shore_dist_map=!1,b("texture",e,"b4w_shore_dist_map")),"b4w_shore_boundings"in e||(e.b4w_shore_boundings=new Float32Array(4),e.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",e,"b4w_shore_boundings")),
"b4w_max_shore_dist"in e||(e.b4w_max_shore_dist=100,b("texture",e,"b4w_max_shore_dist")),"b4w_disable_compression"in e||(e.b4w_disable_compression=!1,b("texture",e,"b4w_disable_compression")),"b4w_source_type"in e||(e.b4w_source_type="",b("texture",e,"b4w_source_type")),"b4w_source_id"in e||(e.b4w_source_id="",b("texture",e,"b4w_source_id")),"b4w_source_size"in e||(e.b4w_source_size=1024,b("texture",e,"b4w_source_size"));d=a.materials;for(f=0;f<d.length;f++)for(e=d[f],("b4w_node_mat_type"in e)&&c("material",
e),("b4w_skydome"in e)&&c("material",e),("b4w_procedural_skydome"in e)&&c("material",e),e.b4w_water&&("b4w_water_shore_smoothing"in e||(e.b4w_water_shore_smoothing=!1,b("material",e,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in e||(e.b4w_water_dynamic=!1,b("material",e,"b4w_water_dynamic")),"b4w_waves_height"in e||(e.b4w_waves_height=1,b("material",e,"b4w_waves_height")),"b4w_waves_length"in e||(e.b4w_waves_length=1,b("material",e,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in e||(e.b4w_water_dst_noise_scale0=
.05,b("material",e,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in e||(e.b4w_water_dst_noise_scale1=.03,b("material",e,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in e||(e.b4w_water_dst_noise_freq0=1.3,b("material",e,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in e||(e.b4w_water_dst_noise_freq1=1,b("material",e,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in e||(e.b4w_water_dir_min_shore_fac=.4,b("material",e,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in
e||(e.b4w_water_dir_freq=.5,b("material",e,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in e||(e.b4w_water_dir_noise_scale=.05,b("material",e,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in e||(e.b4w_water_dir_noise_freq=.07,b("material",e,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in e||(e.b4w_water_dir_min_noise_fac=.5,b("material",e,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in e||(e.b4w_water_dst_min_fac=.2,b("material",e,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in
e||(e.b4w_water_waves_hor_fac=5,b("material",e,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in e||(e.b4w_water_absorb_factor=6,b("material",e,"b4w_water_absorb_factor")),"b4w_water_fog_color"in e||(e.b4w_water_fog_color=new Float32Array(3),e.b4w_water_fog_color=[.5,.7,.7],b("material",e,"b4w_water_fog_color")),"b4w_foam_factor"in e||(e.b4w_foam_factor=5,b("material",e,"b4w_foam_factor")),"b4w_generated_mesh"in e||(e.b4w_generated_mesh=!1,b("material",e,"b4w_generated_mesh")),"b4w_water_num_cascads"in
e||(e.b4w_water_num_cascads=5,b("material",e,"b4w_water_num_cascads")),"b4w_water_subdivs"in e||(e.b4w_water_subdivs=64,b("material",e,"b4w_water_subdivs")),"b4w_water_detailed_dist"in e||(e.b4w_water_detailed_dist=1E3,b("material",e,"b4w_water_detailed_dist"))),("b4w_dynamic_grass_size"in e)||(e.b4w_dynamic_grass_size=""),("b4w_dynamic_grass_color"in e)||(e.b4w_dynamic_grass_color=""),("diffuse_intensity"in e)||(e.diffuse_intensity=1,b("material",e,"diffuse_intensity")),("b4w_use_ghost"in e)||(e.b4w_use_ghost=
!1),("b4w_collision_group"in e)||(e.b4w_collision_group=128,b("material",e,"b4w_collision_group")),("b4w_collision_mask"in e)||(e.b4w_collision_mask=127,b("material",e,"b4w_collision_mask")),"HALO"!=e.type||("b4w_halo_sky_stars"in e)||(e.b4w_halo_sky_stars=!1,b("material",e,"b4w_halo_sky_stars")),"HALO"!=e.type||("b4w_halo_stars_blend_height"in e)||(e.b4w_halo_stars_blend_height=10,b("material",e,"b4w_halo_stars_blend_height")),"HALO"!=e.type||("b4w_halo_stars_min_height"in e)||(e.b4w_halo_stars_min_height=
0,b("material",e,"b4w_halo_stars_min_height")),("specular_shader"in e)||(e.specular_shader="COOKTORR",b("material",e,"specular_shader")),("diffuse_shader"in e)||(e.diffuse_shader="LAMBERT",b("material",e,"diffuse_shader")),("roughness"in e)||(e.roughness=.5,b("material",e,"roughness")),("diffuse_fresnel"in e)||(e.diffuse_fresnel=.1,b("material",e,"diffuse_fresnel")),("diffuse_fresnel_factor"in e)||(e.diffuse_fresnel_factor=.5,b("material",e,"diffuse_fresnel_factor")),("specular_slope"in e)||(e.specular_slope=
.2,b("material",e,"specular_slope")),("specular_toon_size"in e)||(e.specular_toon_size=.5,b("material",e,"specular_toon_size")),("specular_toon_smooth"in e)||(e.specular_toon_smooth=.1,b("material",e,"specular_toon_smooth")),("specular_alpha"in e)||(e.specular_alpha=1,b("material",e,"specular_alpha")),("b4w_wettable"in e)||(e.b4w_wettable=!1,b("material",e,"b4w_wettable")),("b4w_refractive"in e)||(e.b4w_refractive=!1,b("material",e,"b4w_refractive")),("b4w_refr_bump"in e)||(e.b4w_refr_bump=0,b("material",
e,"b4w_refr_bump")),("b4w_shallow_water_col"in e)||(e.b4w_shallow_water_col=[0,.8,.3],b("material",e,"b4w_shallow_water_col")),("b4w_shore_water_col"in e)||(e.b4w_shore_water_col=[0,.9,.2],b("material",e,"b4w_shore_water_col")),("b4w_shallow_water_col_fac"in e)||(e.b4w_shallow_water_col_fac=1,b("material",e,"b4w_shallow_water_col_fac")),("b4w_shore_water_col_fac"in e)||(e.b4w_shore_water_col_fac=.5,b("material",e,"b4w_shore_water_col_fac")),("b4w_water_sss_strength"in e)||(e.b4w_water_sss_strength=
5.9,b("material",e,"b4w_water_sss_strength")),("b4w_water_sss_width"in e)||(e.b4w_water_sss_width=.45,b("material",e,"b4w_water_sss_width")),("b4w_render_above_all"in e)||(e.b4w_render_above_all=!1,b("material",e,"b4w_render_above_all")),e=e.texture_slots,g=0;g<e.length;g++)m=e[g],"blend_type"in m||(m.blend_type="MIX",b("texture_slot",m,"blend_type"));d=a.objects;for(f=0;f<d.length;f++){e=d[f];switch(e.type){case "MESH":"b4w_dynamic_geometry"in e||(e.b4w_dynamic_geometry=!1);"b4w_reflexible"in e||
(e.b4w_reflexible=!1);"b4w_reflexible_only"in e||(e.b4w_reflexible_only=!1);"b4w_reflective"in e||(e.b4w_reflective=!1);"b4w_wind_bending"in e||(e.b4w_wind_bending=!1,b("object",e,"b4w_wind_bending"));"b4w_wind_bending_angle"in e||(e.b4w_wind_bending_angle=10,e.b4w_wind_bending_freq=.25,b("object",e,"wind bending params"));"b4w_detail_bending_amp"in e||(e.b4w_detail_bending_amp=.1,e.b4w_branch_bending_amp=.3,b("object",e,"detail bending params"));"b4w_detail_bending_freq"in e||(e.b4w_detail_bending_freq=
1,b("object",e,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in e||(e.b4w_main_bend_stiffness_col="",b("object",e,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in e||(e.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",e,"b4w_detail_bend_colors"));"b4w_caustics"in e||(e.b4w_caustics=!1);"vertex_groups"in e&&e.vertex_groups.length&&e.data&&0==e.data.vertex_groups.length&&(e.data.vertex_groups=e.vertex_groups,delete e.vertex_groups,
b("object",e,"vertex_groups"));"b4w_vertex_anim"in e&&e.b4w_vertex_anim.length&&e.data&&0==e.data.b4w_vertex_anim.length&&(e.data.b4w_vertex_anim=e.b4w_vertex_anim,delete e.b4w_vertex_anim,b("object",e,"b4w_vertex_anim"));"b4w_do_not_render"in e||(e.b4w_do_not_render=!1);"use_ghost"in e.game||(e.game.use_ghost=!1);"use_sleep"in e.game||(e.game.use_sleep=!1);"velocity_min"in e.game||(e.game.velocity_min=0);"velocity_max"in e.game||(e.game.velocity_max=0);"collision_group"in e.game||(e.game.collision_group=
1);"collision_mask"in e.game||(e.game.collision_mask=255);"b4w_vehicle_settings"in e?e.b4w_vehicle_settings&&("steering_ratio"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.steering_ratio=10),"steering_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.steering_max=1),"inverse_control"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.inverse_control=!1),"force_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.force_max=1500),"brake_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.brake_max=
100),"speed_ratio"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in e.b4w_vehicle_settings||
(e.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.floating_factor=3),"floating_factor"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.floating_factor=3),
"water_lin_damp"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.water_rot_damp=.9)):(e.b4w_vehicle_settings=null,b("object",e,"b4w_vehicle_settings"));"b4w_floating_settings"in e?e.b4w_floating_settings&&("floating_factor"in e.b4w_floating_settings||(e.b4w_floating_settings.floating_factor=3),"water_lin_damp"in e.b4w_floating_settings||(e.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in e.b4w_floating_settings||
(e.b4w_floating_settings.water_rot_damp=.8)):(e.b4w_floating_settings=null,b("object",e,"b4w_floating_settings"));"b4w_character_settings"in e?e.b4w_character_settings&&("walk_speed"in e.b4w_character_settings||(e.b4w_character_settings.walk_speed=4),"run_speed"in e.b4w_character_settings||(e.b4w_character_settings.run_speed=8),"step_height"in e.b4w_character_settings||(e.b4w_character_settings.step_height=.25),"jump_strength"in e.b4w_character_settings||(e.b4w_character_settings.jump_strength=5),
"waterline"in e.b4w_character_settings||(e.b4w_character_settings.waterline=0)):(e.b4w_character_settings=null,b("object",e,"b4w_character_settings"));"b4w_selectable"in e||(e.b4w_selectable=!1,b("object",e,"b4w_selectable"));"b4w_billboard"in e||(e.b4w_billboard=!1,b("object",e,"b4w_billboard"));"b4w_billboard_geometry"in e||(e.b4w_billboard_geometry="SPHERICAL",b("object",e,"b4w_billboard_geometry"));"b4w_glow_settings"in e||(e.b4w_glow_settings={},e.b4w_glow_settings.glow_duration=1,e.b4w_glow_settings.glow_period=
1,e.b4w_glow_settings.glow_relapses=0,b("object",e,"b4w_glow_settings"));"b4w_lod_transition"in e||(e.b4w_lod_transition=.01,b("object",e,"b4w_lod_transition"));"lod_levels"in e||(e.lod_levels=[],b("object",e,"lod_levels"));"b4w_animation_mixing"in e||(e.b4w_animation_mixing=!1,b("object",e,"b4w_animation_mixing"));break;case "EMPTY":"b4w_group_relative"in e||(e.b4w_group_relative=!1,b("object",e,"b4w_group_relative"))}"b4w_anim_behavior"in e||(e.b4w_anim_behavior=e.b4w_cyclic_animation?"CYCLIC":
"FINISH_STOP",b("object",e,"b4w_anim_behavior"));if(!("rotation_quaternion"in e)){g=[0,0,0,1];k.euler_to_quat(e.rotation_euler,g);var m=g,p=g[0],q=g[1],l=g[2];m[0]=g[3];m[1]=p;m[2]=q;m[3]=l;e.rotation_quaternion=g;b("object",e,"rotation_quaternion")}"webgl_do_not_batch"in e&&(e.b4w_do_not_batch=e.webgl_do_not_batch)&&c("object",e);"b4w_shadow_cast_only"in e||(e.b4w_shadow_cast_only=!1,b("object",e,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in e||(e.b4w_correct_bounding_offset="AUTO",b("object",
e,"b4w_correct_bounding_offset"));m=e.particle_systems;for(g=0;g<m.length;g++)p=m[g],q=p.settings,"use_whole_group"in q||(q.use_whole_group=!1,b("object",q,"use_whole_group")),p.transforms||(p.transforms=new Float32Array,b("particle_system",p,"transforms")),"b4w_billboard_align"in q||(q.b4w_billboard_align="VIEW",b("particle_settings",q,"b4w_billboard_align")),"b4w_dynamic_grass"in q||(q.b4w_dynamic_grass=!1,b("object",q,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in q||(q.b4w_dynamic_grass_scale_threshold=
.01,b("object",q,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in q||(q.b4w_initial_rand_rotation=!1,b("particle_settings",q,"b4w_initial_rand_rotation")),"b4w_rotation_type"in q||(q.b4w_rotation_type="Z",b("particle_settings",q,"b4w_rotation_type")),"b4w_rand_rotation_strength"in q||(q.b4w_rand_rotation_strength=1,b("particle_settings",q,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in q||(q.b4w_hair_billboard=!1,b("particle_settings",q,"b4w_hair_billboard")),"b4w_hair_billboard_type"in
q||(q.b4w_hair_billboard_type="BASIC",b("particle_settings",q,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in q||(q.b4w_hair_billboard_jitter_amp=0,b("particle_settings",q,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in q||(q.b4w_hair_billboard_jitter_freq=0,b("particle_settings",q,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in q||(q.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",q,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in
q||(q.b4w_wind_bend_inheritance="PARENT",b("particle_settings",q,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in q||(q.b4w_shadow_inheritance="PARENT",b("particle_settings",q,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in q||(q.b4w_reflection_inheritance="PARENT",b("particle_settings",q,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in q||(q.b4w_vcol_from_name="",b("particle_settings",q,"b4w_vcol_from_name")),"b4w_vcol_to_name"in q||(q.b4w_vcol_to_name="",b("particle_settings",
q,"b4w_vcol_to_name")),"b4w_coordinate_system"in q||(q.b4w_coordinate_system="LOCAL",b("particle_settings",q,"b4w_coordinate_system")),"b4w_allow_nla"in q||(q.b4w_allow_nla=!0,b("particle_settings",q,"b4w_allow_nla"));"constraints"in e||(e.constraints=[],b("object",e,"constraints"));m=e.modifiers;for(g=0;g<m.length;g++){a:{p=m[g];switch(p.type){case "ARRAY":if(!("fit_type"in p)){h.error("WARNING Incomplete modifier "+String(p.type)+' for "'+e.name+'", reexport '+(e.library?"library"+e.library.split("/").slice(-1)[0]:
"main scene"));p=!1;break a}}p=!0}p||(m.splice(g,1),g--)}"animation_data"in e||(e.animation_data={action:null,nla_tracks:[]},b("object",e,"animation_data"));if(e.animation_data)for(("action"in e.animation_data)||(e.animation_data.action=null,h.warn("B4W Warning: no action in animation data "+e.name)),("nla_tracks"in e.animation_data)||(e.animation_data.nla_tracks=[],h.warn("B4W Warning: no NLA in animation data "+e.name)),m=e.animation_data.nla_tracks,g=0;g<m.length;g++)for(p=m[g],q=0;q<p.strips.length;q++)l=
p.strips[q],"action"in l||(l.action=null,h.warn("B4W Warning: no action in NLA strip "+e.name)),"action_frame_start"in l||(l.action_frame_start=0,h.warn("B4W Warning: no action_frame_start in NLA strip "+e.name)),"action_frame_end"in l||(l.action_frame_end=l.frame_end-l.frame_start,h.warn("B4W Warning: no action_frame_start in NLA strip "+e.name));"b4w_collision_id"in e||(e.b4w_collision_id="",b("material",e,"b4w_collision_id"));g=e.scale;m=Math.abs((g[1]-g[2])/g[1]);.001>Math.abs((g[0]-g[1])/g[0])&&
.001>m||h.warn("B4W Warning: non-uniform scale for object "+e.name)}for(var v in x)f=x[v],d=v.match(/.*?(?=>>|$)/i)[0],h.warn("WARNING "+String(d)+" is "+f.gq+" for "+f.type+", reexport "+a.b4w_filepath_blend)};a.bt=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var h=b[c].type;if("ARRAY"==h||"CURVE"==h){b=!0;break a}}b=!1}if(!b)return null;b=g(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var x=a[c];switch(x.type){case "ARRAY":for(var h=b,u=x,s=0,q=0,n=0,H=new Float32Array(16),
x=[],y=1;y<u.count;y++){u.use_constant_offset&&(s+=u.constant_offset_displace[0],q+=u.constant_offset_displace[1],n+=u.constant_offset_displace[2]);if(u.use_relative_offset)var J=h.b4w_bounding_box,s=s+(J.max_x-J.min_x)*u.relative_offset_displace[0],q=q+(J.max_y-J.min_y)*u.relative_offset_displace[1],n=n+(J.max_z-J.min_z)*u.relative_offset_displace[2];k.sy(s,q,n,H);for(var r=J=g(h),F=H,G=0;G<r.submeshes.length;G++){var W=r.submeshes[G];k.ce(W.position,F,W.position,0);k.Vy(W.normal,F,W.normal);k.py(W.tangent,
F,W.tangent)}x.push(J)}for(y=0;y<x.length;y++)for(u=h,s=x[y],q=0;q<u.submeshes.length;q++){n=u.submeshes[q];H=s.submeshes[q];J=n.base_length;r=n.indices.length;n.base_length+=H.base_length;for(var T in n)if("base_length"!=T)if("indices"==T)for(n[T]=k.vy(n[T],H[T]),F=r;F<n.indices.length;F++)n.indices[F]+=J;else n[T]=k.Xu(n[T],H[T])}break;case "CURVE":for(var h=b,y=x.object.Hs,u=new Float32Array(16),q=y.Xd?4:3,s=new Float32Array(q),q=new Float32Array(q),n=new Float32Array(3),H=new Float32Array(4),
J=new Float32Array(4),r=new Float32Array(3),F=new Float32Array(3),G=new Float32Array(3),W=new Float32Array(4),S=new Float32Array(4),R=0;R<h.submeshes.length;R++){var L=h.submeshes[R],O=L.position,Q=L.normal,L=L.tangent,Z;a:switch(Z=x.deform_axis,Z){case "POS_X":case "NEG_X":Z=0;break a;case "POS_Y":case "NEG_Y":Z=1;break a;case "POS_Z":case "NEG_Z":Z=2;break a;default:throw"Wrong deform axis value "+Z;}r[0]=0;r[1]=0;r[2]=0;r[Z]=1;for(var N=l.$x(y),da=0;da<O.length/3;da++){G[0]=O[3*da];G[1]=O[3*da+
1];G[2]=O[3*da+2];var P=G[Z],ja=l.Zx(y,P);l.ay(y,ja,s);n[0]=s[0];n[1]=s[1];n[2]=s[2];l.Yx(y,ja,q);F[0]=q[0];F[1]=0;F[2]=q[2];f.normalize(F,F);v.rotationTo(r,F,H);0>P?(s[0]=F[0],s[1]=F[1],s[2]=F[2],f.scale(s,P,s),f.add(n,s,n)):P>N&&(s[0]=F[0],s[1]=F[1],s[2]=F[2],f.scale(s,P-N,s),f.add(n,s,n));m.fromRotationTranslation(H,n,u);y.Xd&&(v.setAxisAngle(r,s[3],J),f.transformQuat(G,J,G));G[Z]=0;f.transformMat4(G,u,G);O[3*da]=G[0];O[3*da+1]=G[1];O[3*da+2]=G[2];Q.length&&(W[0]=Q[3*da],W[1]=Q[3*da+1],W[2]=Q[3*
da+2],W[3]=0,p.transformMat4(W,u,W),Q[3*da]=W[0],Q[3*da+1]=W[1],Q[3*da+2]=W[2]);L.length&&(S[0]=L[3*da],S[1]=L[3*da+1],S[2]=L[3*da+2],S[3]=0,p.transformMat4(S,u,S),L[3*da]=S[0],L[3*da+1]=S[1],L[3*da+2]=S[2])}}}d.$w(b)}return b};a.Tz=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,
specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,
offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}}};b4w.module.__scenegraph=function(a,n){function b(a){a=gb.ra(a);a.Td=null;a.bb=null;a.gc=null;return a}function c(a,b){var c=[];M.oe(a,function(b,d,e){-1<c.indexOf(e)?M.gx(a,b,d,e,l(e)):c.push(e)});M.J(a,function(b,d){for(var e=0;e<d.Y.length;e++){var f=d.Y[e];-1<c.indexOf(f)?d.Y[e]=l(f):c.push(f)}"ANTIALIASING"==d.type&&M.pe(a,b,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.Y.length;c++){var d=b.Y[c];d.ba=X.s;d.aa=X.s}})});M.J(a,function(c){var e={};g(a,c,e);for(var f in e){c=e[f];if(b)for(var h=
0;h<c.length;h++){var E=c[h];if("DEPTH"==E.F){if(d(E))throw"Failed to use renderbuffer as input texture: "+E.F+"->"+E.U;E.Hg=!0}}E=c[0];for(h=0;h<c.length;h++)if(c[h].ba==X.s){E=c[h];break}for(var k=c[0],h=0;h<c.length;h++)if(c[h].aa==X.s){k=c[h];break}for(var q=c[0],h=0;h<c.length;h++)if(!c[h].Hg){q=c[h];break}for(h=0;h<c.length;h++)c[h].ba=E.ba,c[h].aa=k.aa,c[h].Hg=q.Hg}})}function g(a,b,c){M.pe(a,b,function(b,d,e){e.wa&&e.F==e.U&&(c[e.F]=c[e.F]||[],-1==c[e.F].indexOf(e)&&c[e.F].push(e),g(a,b,c))});
M.qe(a,b,function(a,b,d){d.wa&&(c[d.F]=c[d.F]||[],-1==c[d.F].indexOf(d)&&c[d.F].push(d))});b=M.Ca(a,b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.Y.length;d++){var e=b.Y[d];c[e.F].push(e)}}function d(a){switch(a.U){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "NONE":return!1;default:return!0}}function l(a){if(a.na)throw"Failed to clone slink with attached texture";return gb.Ie(a)}function h(a){var b=M.Sq(a),c=[];M.J(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var e=
[];break;default:e=c}for(var h=0;h<d.Y.length;h++){var g=d.Y[h],E=m(e,g,f(g));g.na=E;d.Rc[h]=E}for(h=0;h<d.Rc.length;h++)E=d.Rc[h],v(e,E);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":e=[]}M.qe(b,a,function(c,d,h){if((c=p(b,a,h.F))&&h.wa&&!h.na){d=e;for(var g=c,E=0;E<d.length;E++){var k=d[E];k.lm===g&&k.Kh++}}else c=m(e,h,f(h));h.na=c});M.pe(b,a,function(a,b,c){v(e,c.na)});M.qe(b,a,function(a,b,c){c.na&&"NONE"==c.U&&v(e,c.na)})})}function k(a){t(a,
function(b,c,d){b.Eg&&(oa(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||oa(a,d,"ANTIALIASING"))&&(b.ke*=Ha.resolution_factor)})}function f(a){a=gb.Ie(a);delete a.U;delete a.wa;return JSON.stringify(a)}function p(a,b,c){var d=null;M.pe(a,b,function(a,b,e){if(e.wa&&e.F==e.U&&e.F==c&&e.na)return d=e.na,!0});M.qe(a,b,function(a,b,e){if(e.wa&&e.F==c&&e.na)return d=e.na,!0});return d}function v(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.lm===b&&d.Kh&&d.Kh--}}function m(a,b,
c){for(var d=null,e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===f.Kh){d=f;break}}if(d)return d.Kh++,d.lm;b=x(b);a.push({id:c,Kh:1,lm:b});return b}function x(a){var b=a.ke*a.size;switch(a.F){case "COLOR":var c=X.Ei("COLOR",X.Gf);X.resize(c,b,b);X.yj(c,a.ba,a.aa);return c;case "DEPTH":return a.Hg?(c=X.Ei("DEPTH_RBUF",X.Ff),X.resize(c,b,b)):(c=X.Ei("DEPTH_TEX",X.Og),X.resize(c,b,b),X.yj(c,a.ba,a.aa)),c;case "CUBEMAP":return c=X.Wt(b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.F;
}}function t(a,b){var c=!1;M.oe(a,function(d,e,f){if(f&&(d=M.Ca(a,d),e=M.Ca(a,e),b(f,!1,d,e)))return c=!0});c||M.J(a,function(a,c){for(var d=0;d<c.Y.length;d++)if(b(c.Y[d],!0,c,null))return!0})}function z(a){M.J(a,function(b,c){if("SINK"!=c.type){var d=c.h;M.qe(a,b,function(a,b,c){c.wa&&c.na&&(aa.xj(d,c.F,c.na),c.F==c.U&&b.h&&aa.xj(b.h,c.F,c.na))});for(var e=0;e<c.Y.length;e++){var f=c.Y[e];f.wa&&f.F==f.U&&aa.xj(d,f.F,c.Rc[e])}!d.bb&&!d.gc||d.Td||(d.Td=Da.fq(d.bb,d.gc))}})}function e(a,b){var c=B("SHADOW_CAST");
c.Dk=a;c.self_shadow_polygon_offset=b.self_shadow_polygon_offset;c.h=aa.kb(aa.Qg);return c}function B(a){return{type:a,qa:!1,Qp:!1,hk:!1,hj:!1,bh:0,time:0,h:null,Un:null,gb:null,l:[],Y:[],Rc:[],di:new Float32Array(3),nr:new Float32Array(3),Hb:new Float32Array(3),Eb:new Float32Array(4),Ec:new Float32Array(16),Rd:0,mf:0,$e:null,cf:null,Ze:null,af:null,bf:null,hc:new Float32Array(3),nc:new Float32Array(3),Nq:new Float32Array([0,0,0]),Fj:new Float32Array(3),Oq:new Float32Array(4),qg:null,Oi:0,Mk:0,rh:!1,
oh:new Float32Array(3),re:0,Aa:null,Tj:!1,he:new Float32Array(2),ie:new Float32Array(2),og:0,fg:0,rk:0,xc:null,te:0,Df:0,se:0,Ge:!1,un:0,vn:new Float32Array(2),tn:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,pg:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,tg:0,sg:0,rg:0,Fq:0,
ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,eg:0,uj:0,wg:0,Dk:0,self_shadow_polygon_offset:0,self_shadow_normal_offset:0,cr:null,gn:null,rf:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,mn:0,ko:0,dj:0,ej:0,up:0,Hh:"",pw:new Float32Array(2),P:!0,enqueue:!0,Z:!0,fa:!0,wb:!0,ta:!0}}function A(a,b,c,d,e){return{F:a,U:b,size:c,ke:d,Eg:e,wa:!0,na:null,Hg:!1,ba:X.oc,aa:X.oc}}function u(){var a=B("GRASS_MAP");a.h=aa.kb(aa.Pg);return a}function s(a){var b=
B("POSTPROCESSING");b.Z=!1;b.fa=!1;b.wb=!1;b.h=aa.kb(aa.Ya);b.Hh=a;return b}function q(a){var b=B("BLOOM_BLUR");b.Z=!1;b.fa=!1;b.wb=!1;b.h=aa.kb(aa.Ya);b.Hh=a;return b}function K(a,b,c,d,e,f,h,g,E){var k=B("MAIN_"+a);if("OPAQUE"===a)k.Z=!0,k.fa=c,k.qa=!1;else if("BLEND"===a)k.Z=!1,k.fa=!1,k.qa=!0;else if("XRAY"===a)k.Z=!1,k.fa=!0,k.qa=!0;else if("REFLECT"===a)k.Z=!0,k.fa=!0,k.qa=!1;else throw"wrong main subscene type";k.qa&&g&&(k.self_shadow_normal_offset=g.self_shadow_normal_offset);k.h=b;k.hc.set(h.hc);
k.nc.set(h.nc);k.Rd=h.Rd;k.qg=h.qg;k.Eb=f;d&&(k.Aa=d,d.Eb&&(k.xc=new Float32Array(d.Eb)),k.te=d.waves_height,k.Df=d.waves_length,k.se=d.se,d.zi&&E&&(k.Ge=!0,k.un=d.zi,k.vn.set(d.tk),k.tn=d.sk),d.Aj&&(k.Tj=!0,a=d.Mx,k.he[0]=(a[0]+a[1])/2,k.he[1]=(a[2]+a[3])/2,k.ie[0]=a[0]-a[1],k.ie[1]=a[2]-a[3],k.og=d.og,k.fg=d.fg));k.$e=new Float32Array(3*e);k.cf=new Float32Array(3*e);k.Ze=new Float32Array(3*e);k.af=new Float32Array(4*e);k.bf=new Float32Array(4*e);return k}function H(a,b){var c=B("COLOR_PICKING");
b&&(c.type+="_XRAY",c.Z=!1,c.fa=!0);c.enqueue=!1;c.h=a;return c}function y(a){var b=B("WIREFRAME");b.P=!1;b.Z=!1;b.fa=!1;b.h=a;return b}function J(a,b){var c=B("DEPTH");c.h=a;c.self_shadow_normal_offset=b.self_shadow_normal_offset;return c}function r(a){var b=B("DEPTH_PACK");b.Z=!1;b.fa=!1;b.h=a;return b}function F(a,b,c){var d=B("SSAO");d.Z=!1;d.fa=!1;d.wb=!1;d.h=a;d.Eb=b;d.xc=new Float32Array(b);d.tg=c.radius_increase;d.ssao_hemisphere=c.bw;d.sg=c.influence;d.rg=c.dist_factor;d.Fq=c.lx;return d}
function G(a,b){var c=B("SSAO_BLUR");c.Z=!1;c.fa=!1;c.wb=!1;c.ssao_blur_depth=b.ot;c.ssao_blur_discard_value=b.ln;c.h=a;return c}function W(){var a=B("ANTIALIASING");a.Z=!1;a.fa=!1;a.wb=!1;a.h=aa.kb(aa.Ya);return a}function T(a){var b=B(a);b.Z="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.fa=!1;b.wb=!1;b.h=aa.kb(aa.Ya);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.qw=new Float32Array(4));return b}function S(a,b,c,d){var e=B("COMPOSITING");e.Z=!1;e.fa=!1;e.wb=!1;e.h=aa.kb(aa.Ya);
e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function R(a,b){var c=B("MOTION_BLUR");c.Z=!1;c.fa=!1;c.wb=!1;c.h=aa.kb(aa.Ya);c.hk=!0;c.dj=a;c.ej=b;return c}function L(a){var b=B("DOF");b.Z=!1;b.fa=!1;b.wb=!1;b.h=a;return b}function O(a){var b=B("GLOW_MASK");b.h=a;b.wb=!1;return b}function Q(a){var b=B("GLOW");b.oh.set(a.oh);b.Oi=a.Oi;b.ko=5;b.mn=3;b.wb=!1;b.h=aa.kb(aa.Ya);return b}function Z(){var a=B("REFRACT");a.Z=!1;a.fa=!1;a.wb=!1;a.h=aa.kb(aa.Ya);return a}function N(a,b,c,
d,e,f,h){var g=B("GOD_RAYS");g.Z=!1;g.fa=!1;g.wb=!1;g.hc[0]=1;g.hc[1]=1;g.hc[2]=1;g.nc[0]=1;g.nc[1]=1;g.nc[2]=1;g.Rd=1;g.Qp=d;g.re=b;g.uj=e;g.eg=c;g.wg=h;g.h=a;g.mf=f;g.$e=new Float32Array(3*f);g.cf=new Float32Array(3*f);g.Ze=new Float32Array(3*f);g.af=new Float32Array(4*f);g.bf=new Float32Array(4*f);return g}function da(a,b){var c=B("GOD_RAYS_COMBINE");c.Z=!1;c.fa=!1;c.wb=!1;c.h=aa.kb(aa.Ya);c.god_rays_intensity=a;c.mf=b;c.$e=new Float32Array(3*b);c.cf=new Float32Array(3*b);c.Ze=new Float32Array(3*
b);c.af=new Float32Array(4*b);c.bf=new Float32Array(4*b);return c}function P(a,b){var c=B("SKY");c.enqueue=!1;c.Z=!1;c.fa=!1;c.wb=!1;var d=aa.kb(aa.Ya);d.width=za.ah;d.height=za.ah;c.h=d;c.Un=gb.gv();c.mf=a;c.$e=new Float32Array(3*a);c.cf=new Float32Array(3*a);c.Ze=new Float32Array(3*a);c.af=new Float32Array(4*a);c.bf=new Float32Array(4*a);c.hc[0]=1;c.hc[1]=1;c.hc[2]=1;c.nc[0]=1;c.nc[1]=1;c.nc[2]=1;c.Rd=1;c.pg.set(b.pg);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;
c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function ja(){var a=B("SCREEN");a.Z=!1;a.fa=!1;a.h=aa.kb(aa.Ya);return a}function D(){var a=B("ANAGLYPH");a.Z=!1;a.fa=!1;a.h=aa.kb(aa.Ya);
return a}function ga(){var a=B("LUMINANCE");a.Z=!1;a.fa=!1;a.h=aa.kb(aa.Ya);return a}function V(){var a=B("AVERAGE_LUMINANCE");a.Z=!1;a.fa=!1;a.h=aa.kb(aa.Ya);return a}function w(a,b,c,d){var e=B("LUMINANCE_TRUNCED");e.Z=!1;e.fa=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.h=d;e.$e=new Float32Array(3*c);e.cf=new Float32Array(3*c);e.Ze=new Float32Array(3*c);e.af=new Float32Array(4*c);e.bf=new Float32Array(4*c);return e}function I(a){var b=B("BLOOM");b.Z=!1;b.fa=!1;b.h=aa.kb(aa.Ya);b.bloom_blur=a;return b}
function ia(){var a=B("SINK");a.enqueue=!1;return a}function oa(a,b,c){if(b.type===c)return!0;b=E(a,b);for(var d=0;d<b.length;d++)if(oa(a,b[d],c))return!0;return!1}function fa(a,b,c){if(b.type===c)return!0;b=Y(a,b);for(var d=0;d<b.length;d++)if(fa(a,b[d],c))return!0;return!1}function U(a,b,c){if(b.type===c)return b;b=Y(a,b);for(var d=0;d<b.length;d++){var e=U(a,b[d],c);if(e)return e}return null}function Y(a,b){var c=M.yh(a,b);if(c==M.Hm)throw"Subscene not in graph";for(var d=[],e=M.Yo(a,c),f=0;f<
e;f++){var h=M.Li(a,c,f);h!=c&&d.push(M.Ca(a,h))}return d}function E(a,b){var c=M.yh(a,b);if(c==M.Hm)throw"Subscene not in graph";for(var d=[],e=M.ig(a,c),f=0;f<e;f++){var h=M.Zf(a,c,f);h!=c&&d.push(M.Ca(a,h))}return d}function ea(a){var b=[],c=[];t(a,function(a){a.na&&-1==b.indexOf(a.na)&&(b.push(a.na),c.push(a.na,b.length-1))});return c}function na(a,b){var c;c=""+(a.F+"\\n");c+="NONE"!=a.U?a.U+"\\n":"";c+="(";if(a.Eg){var d=a.ke;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=
a.size+"x"+a.size;if("SCREEN"!=a.F){c+=" ";if(a.Hg)c+="RR";else{var d=a.ba,e=a.aa,f="";d==X.s?f+="L":d==X.oc&&(f+="N");e==X.s?f+="L":e==X.oc&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.na&&(c+=" "+b[d+1])}return c+")\\n"}var aa=n("__camera"),Ua=n("__config"),la=n("__debug"),M=n("__graph"),Da=n("__renderer"),X=n("__textures"),gb=n("__util");n("vec4");var Pa=Ua.dh,Ha=Ua.n,za=Ua.Qh;a.gu=function(a,d){var e=M.create(),f=a.L[0],g=d.pl,E=d.mr,q=d.Eb,I=d.Aa,w=K("OPAQUE",f,!0,I,g,q,E,null,d.Bd);M.o(e,
w);var r=K("BLEND",f,!0,I,g,q,E,null,null);M.o(e,r);M.i(e,w,r,A("SCREEN","NONE",1,1,!0));if(d.mc){var m=K("XRAY",f,!1,I,g,q,E,null,d.Bd);M.o(e,m);M.i(e,r,m,A("SCREEN","NONE",1,1,!0))}E=ia();M.o(e,E);Ha.wireframe_debug?(f=y(f),M.o(e,f),d.mc?M.i(e,m,f,A("SCREEN","NONE",1,1,!0)):M.i(e,r,f,A("SCREEN","NONE",1,1,!0)),M.i(e,f,E,A("SCREEN","NONE",1,1,!0))):M.i(e,r,E,A("SCREEN","NONE",1,1,!0));d.xk&&(f=b(w.h),a.L.push(f),r=H(f,!1),M.o(e,r),d.mc?(f=b(w.h),a.L.push(f),w=H(f,!0),M.o(e,w),M.i(e,r,w,A("COLOR",
"COLOR",1,1,!0)),M.i(e,w,E,A("COLOR","NONE",1,1,!0)),M.i(e,w,E,A("DEPTH","NONE",1,1,!0))):(M.i(e,r,E,A("COLOR","NONE",1,1,!0)),M.i(e,r,E,A("DEPTH","NONE",1,1,!0))));d.Uh.procedural_skydome&&(g=P(g,d.Uh),M.o(e,g),M.i(e,g,E,A("CUBEMAP","u_sky",za.ah,1,!1)));c(e,!0);1<Ha.resolution_factor&&k(e);h(e);z(e);return e};a.Gt=d;a.uy=t;a.fu=function(a,d,f){var g=M.create(),E=[],m=[],p=[],l=[],ea=[],fa=[],Y=[],t=[],v=[],x=[],U=[],n=d.pl,B=d.Aa,na=d.Rl,oa=d.yf,Da=d.ag,Ua=d.jg,Lb=d.ax,bd=d.If,Sc=d.gg,cd=d.Nf,Tc=
d.antialiasing,uc=d.mr,lb=d.Eb,Ya=d.wc,yb=d.Aw,dc=d.nt,Mb=d.yt,Ub=d.Wv,Vb=d.Tv,lc=d.Rf,ua=[];if(Ha.anaglyph_use&&!a){var Nb=f.L[0],bb=b(Nb);aa.rp(Nb,aa.tb);aa.rp(bb,aa.Bb);ua.push(Nb,bb);f.L.push(bb)}else{var ra=f.L[0];ua.push(ra)}if(na){aa.Nj(ua[0],Ya);for(var zb=Ya.csm_num,ca=0;ca<zb;ca++){var Sa=e(ca,Ya);M.o(g,Sa);x.push(Sa);var cb=Ya.csm_resolution,ra=Sa.h;ra.width=cb;ra.height=cb;Sa.Z=!1;U.push(A("DEPTH","u_shadow_map"+ca,cb,1,!1));la.xn()&&Sa.Y.push(A("COLOR","COLOR",cb,1,!1))}}if(0<Lb.length&&
!a)for(ca=0;ca<ua.length;ca++){ra=b(ua[ca]);f.L.push(ra);var ma=K("REFLECT",ra,!1,B,n,lb,uc,null,d.Bd);ma.gb=Lb[0];ma.h.gb=Lb[0];M.o(g,ma);fa.push(ma);Y.push(A("COLOR","u_reflectmap",1,Ha.Mh,!0));ma.Y.push(A("DEPTH","DEPTH",1,Ha.Mh,!0))}E=[];m=[];if(d.xa){var Ja=u();M.o(g,Ja);cb=za.Qi;Ja.h.width=cb;Ja.h.height=cb;var db=A("DEPTH","u_grass_map_depth",cb,1,!1);db.ba=X.s;db.aa=X.s;var ta=A("COLOR","u_grass_map_color",cb,1,!1);ta.ba=X.s;ta.aa=X.s}else ta=db=Ja=null;for(ca=0;ca<ua.length;ca++){var ra=
ua[ca],Ta=b(ra);f.L.push(Ta);if(na){var pa=J(Ta,Ya);M.o(g,pa);for(var Ka=0;Ka<x.length;Ka++){var Sa=x[Ka],Ab=U[Ka];M.i(g,Sa,pa,Ab)}var ec=A("COLOR","u_color",1,1,!0),$b=A("DEPTH","u_depth",1,1,!0);if(oa){var ac=b(ra);f.L.push(ac);var tb=d.cy,Bb=F(ac,lb,tb);M.o(g,Bb);var mc=A("COLOR","u_ssao_mask",1,1,!0);M.i(g,pa,Bb,ec);M.i(g,pa,Bb,$b);var Cb=b(ra);f.L.push(Cb);var ub=G(Cb,tb);M.o(g,ub);var nc=A("COLOR","u_shadow_mask",1,1,!0);M.i(g,Bb,ub,mc);M.i(g,pa,ub,$b)}var Ob=b(Ta);f.L.push(Ob);var La=r(Ob);
M.o(g,La);M.i(g,pa,La,A("DEPTH","u_depth",1,1,!0));p.push(La);var bc=A("DEPTH","DEPTH",1,1,!0);ea.push(bc)}else pa=J(Ta,Ya),M.o(g,pa),bc=A("DEPTH","DEPTH",1,1,!0),ea.push(bc),la.xn()&&pa.Y.push(A("COLOR","COLOR",1,1,!0)),Ob=b(Ta),f.L.push(Ob),La=r(Ob),M.o(g,La),M.i(g,pa,La,A("DEPTH","u_depth",1,1,!0)),p.push(La);Ja&&(M.i(g,Ja,pa,db),M.i(g,Ja,pa,ta));ma=K("OPAQUE",ra,!1,B,n,lb,uc,null,d.Bd);M.o(g,ma);m.push(ma);M.i(g,pa,ma,ea[ca]);mc?M.i(g,ub,ma,nc):M.i(g,pa,ma,A("COLOR","u_shadow_mask",1,1,!0));var oc=
A("COLOR","u_color",1,1,!0);l.push(A("COLOR","COLOR",1,1,!0));Ja&&(M.i(g,Ja,ma,db),M.i(g,Ja,ma,ta));fa.length&&(M.i(g,fa[ca],ma,Y[ca]),ma.gb=Lb[0])}E=m;m=[];if(!a&&d.xk){ra=b(E[0].h);f.L.push(ra);var Oa=H(ra,!1);M.o(g,Oa);if(d.mc){ra=b(E[0].h);f.L.push(ra);var mb=H(ra,!0);M.o(g,mb);M.i(g,Oa,mb,A("COLOR","COLOR",1,1,!0));M.i(g,Oa,mb,A("DEPTH","DEPTH",1,1,!0))}}else Oa=null;if(Ua&&!a)for(ca=0;ca<ua.length;ca++){var Db=Z();M.o(g,Db);M.i(g,E[ca],Db,oc);t.push(Db);v.push(A("COLOR","u_refractmap",1,1,!0))}for(var pc=
[],ca=0;ca<ua.length;ca++){pa=p[ca];ra=b(ua[ca]);f.L.push(ra);ma=K("BLEND",ra,!1,B,n,lb,uc,Ya,d.Bd);m.push(ma);M.o(g,ma);M.i(g,E[ca],ma,l[ca]);M.i(g,E[ca],ma,ea[ca]);Ja&&(M.i(g,Ja,ma,db),M.i(g,Ja,ma,ta));for(Ka=0;Ka<x.length;Ka++)Sa=x[Ka],Ab=U[Ka],M.i(g,Sa,ma,Ab);if("DEPTH_PACK"==pa.type){var Ea=A("COLOR","u_scene_depth",1,1,!0);Ea.ba=X.oc;Ea.aa=X.oc}else Ea=A("DEPTH","u_scene_depth",1,1,!0),Ea.ba=X.s,Ea.aa=X.s;M.i(g,pa,ma,Ea);fa.length&&(M.i(g,fa[ca],ma,Y[ca]),ma.gb=Lb[0]);t.length&&M.i(g,t[ca],
ma,v[ca]);pc.push(ma)}E=m;m=[];if(d.mc){for(ca=0;ca<ua.length;ca++){pa=p[ca];ra=b(ua[ca]);f.L.push(ra);ma=K("XRAY",ra,!1,B,n,lb,uc,Ya,d.Bd);m.push(ma);M.o(g,ma);M.i(g,E[ca],ma,l[ca]);M.i(g,E[ca],ma,ea[ca]);Ja&&(M.i(g,Ja,ma,db),M.i(g,Ja,ma,ta));for(Ka=0;Ka<x.length;Ka++)Sa=x[Ka],Ab=U[Ka],M.i(g,Sa,ma,Ab);"DEPTH_PACK"==pa.type?(Ea=A("COLOR","u_scene_depth",1,1,!0),Ea.ba=X.oc,Ea.aa=X.oc):(Ea=A("DEPTH","u_scene_depth",1,1,!0),Ea.ba=X.s,Ea.aa=X.s);M.i(g,pa,ma,Ea);fa.length&&(M.i(g,fa[ca],ma,Y[ca]),ma.gb=
Lb[0]);t.length&&M.i(g,t[ca],ma,v[ca])}E=m;m=[]}if(Ha.wireframe_debug){for(ca=0;ca<ua.length;ca++){ra=gb.ra(ua[ca]);f.L.push(ra);var Ma=y(ra);m.push(Ma);M.o(g,Ma);M.i(g,E[ca],Ma,l[ca]);M.i(g,E[ca],Ma,ea[ca]);Ja&&(M.i(g,Ja,Ma,db),M.i(g,Ja,Ma,ta))}E=m;m=[]}if(Da&&!a){for(ca=0;ca<ua.length;ca++){var C=Ub.eg,ka=Ub.gw,Ba=Ub.wg,qa=E[ca],Wb=B?1:0,ba=A("DEPTH","u_input",1,1,!0);ba.ba=X.s;ba.aa=X.s;var ib=A("COLOR","u_input",1,.25,!0);ib.ba=X.s;ib.aa=X.s;var jb=C/Ba,Pb=b(ua[ca]);f.L.push(Pb);var nb=N(Pb,Wb,
C,!0,jb,n,Ba);M.o(g,nb);M.i(g,qa,nb,ba);var jb=C/Ba*.5,Qb=b(ua[ca]);f.L.push(Qb);var vb=N(Qb,Wb,C,!1,jb,n,Ba);M.o(g,vb);M.i(g,nb,vb,ib);var jb=C/Ba*.25,Eb=b(ua[ca]);f.L.push(Eb);var Rb=N(Eb,Wb,C,!1,jb,n,Ba);M.o(g,Rb);M.i(g,vb,Rb,ib);fa.length&&(nb.gb=Lb[0],vb.gb=Lb[0],Rb.gb=Lb[0]);var Aa=da(ka,n);m.push(Aa);M.o(g,Aa);M.i(g,qa,Aa,A("COLOR","u_main",1,1,!0));M.i(g,Rb,Aa,A("COLOR","u_god_rays",1,1,!0))}E=m;m=[]}if(bd&&!a){for(ca=0;ca<ua.length;ca++){var qa=E[ca],Fa=ga();M.o(g,Fa);M.i(g,qa,Fa,A("COLOR",
"u_input",1,1,!0));var Ec=V();M.o(g,Ec);Ec.h.width=1;Ec.h.height=1;var Fb=A("COLOR","u_input",1,.25,!0);Fb.ba=X.s;Fb.aa=X.s;var vc=A("COLOR","u_luminance",1,.25,!0);vc.ba=X.s;vc.aa=X.s;M.i(g,Fa,Ec,Fb);var Fc=dc.key,jd=dc.Iu,Xb=b(ua[ca]);f.L.push(Xb);var fc=w(Fc,jd,n,Xb);M.o(g,fc);M.i(g,qa,fc,A("COLOR","u_main",1,1,!0));M.i(g,Fa,fc,vc);M.i(g,Ec,fc,A("COLOR","u_average_lum",1,1,!1));var ob=A("COLOR","u_color",1,.25,!0);ob.ba=X.s;ob.aa=X.s;var Gb=q("X_BLUR");M.o(g,Gb);M.i(g,fc,Gb,ob);var pb=q("Y_BLUR");
M.o(g,pb);M.i(g,Gb,pb,ob);var gc=I(dc.blur);M.o(g,gc);var wc=A("COLOR","u_bloom",1,.25,!0);wc.ba=X.s;wc.aa=X.s;M.i(g,pb,gc,wc);M.i(g,qa,gc,A("COLOR","u_main",1,1,!0));m.push(gc)}E=m;m=[]}if(Sc&&!a){for(ca=0;ca<E.length;ca++){var xc=E[ca],wb=R(yb.dj,yb.ej);m.push(wb);M.o(g,wb);M.i(g,xc,wb,A("COLOR","u_mb_tex_curr",1,1,!0));wb.Y.push(A("COLOR","u_mb_tex_accum",1,1,!0))}E=m;m=[]}if(lc&&!a){for(ca=0;ca<E.length;ca++){var qa=E[ca],Hb=b(ua[ca]);f.L.push(Hb);ob=A("COLOR","u_color",1,1,!0);ob.ba=X.s;ob.aa=
X.s;var Ib=s("X_BLUR");M.o(g,Ib);M.i(g,qa,Ib,ob);var eb=s("Y_BLUR");M.o(g,eb);M.i(g,Ib,eb,ob);var pa=pc[ca],Sb=L(Hb);Hb.dof_distance=f.dof_distance;Hb.Me=f.Me;Hb.dof_front=f.dof_front;Hb.dof_rear=f.dof_rear;Hb.dof_power=f.dof_power;Hb.dof_on=1;m.push(Sb);M.o(g,Sb);M.i(g,qa,Sb,A("COLOR","u_sharp",1,1,!0));M.i(g,eb,Sb,A("COLOR","u_blurred",1,1,!0));M.i(g,pa,Sb,A("DEPTH","u_depth",1,1,!0))}E=m;m=[]}if(!a&&d.glow){for(ca=0;ca<ua.length;ca++){var qa=E[ca],yc=b(ua[ca]);f.L.push(yc);var fb=O(yc);M.o(g,fb);
var zc=s("X_EXTEND"),Uc=A("COLOR","u_color",1,1,!0),ld=A("COLOR","u_glow_mask",1,1,!0);zc.rh=!0;M.o(g,zc);M.i(g,fb,zc,Uc);var hc=A("COLOR","u_color",1,.5,!0);hc.ba=X.s;hc.aa=X.s;var qc=s("Y_EXTEND");qc.rh=!0;M.o(g,qc);M.i(g,zc,qc,hc);Ib=s("X_BLUR");Ib.rh=!0;M.o(g,Ib);M.i(g,qc,Ib,hc);var Gc=A("COLOR","u_color",1,.25,!0);Gc.ba=X.s;Gc.aa=X.s;var qb=A("COLOR","u_glow_mask_blurred",1,.25,!0);qb.ba=X.s;qb.aa=X.s;eb=s("Y_BLUR");eb.rh=!0;M.o(g,eb);M.i(g,Ib,eb,Gc);var Ac=Q(Vb);M.o(g,Ac);M.i(g,qa,Ac,A("COLOR",
"u_glow_src",1,1,!0));M.i(g,fb,Ac,ld);M.i(g,eb,Ac,qb);m.push(Ac)}E=m;m=[]}if(cd&&!a){for(ca=0;ca<E.length;ca++){var qa=E[ca],Vc=S(Mb.brightness,Mb.contrast,Mb.exposure,Mb.saturation);M.o(g,Vc);M.i(g,qa,Vc,A("COLOR","u_color",1,1,!0));m.push(Vc)}E=m;m=[]}if(Tc&&!a){for(ca=0;ca<E.length;ca++)if(qa=E[ca],Ha.smaa){var rc=A("COLOR","u_color",1,1,!0);rc.ba=X.s;rc.aa=X.s;var Hc=T("SMAA_EDGE_DETECTION");M.o(g,Hc);M.i(g,qa,Hc,rc);var Qa=T("SMAA_BLENDING_WEIGHT_CALCULATION");M.o(g,Qa);M.i(g,Hc,Qa,rc);var sc=
A("COLOR","u_search_tex",1,1,!1),Ic=A("COLOR","u_area_tex",1,1,!1);sc.ba=X.s;sc.aa=X.s;Ic.ba=X.s;Ic.aa=X.s;Qa.Y.push(sc);Qa.Y.push(Ic);var tc=T("SMAA_NEIGHBORHOOD_BLENDING");M.o(g,tc);M.i(g,qa,tc,rc);var Wc=A("COLOR","u_blend",1,1,!0);Wc.ba=X.s;Wc.aa=X.s;M.i(g,Qa,tc,Wc);m.push(tc)}else{var Bc=W();M.o(g,Bc);var Jc=A("COLOR","u_color",1,1,!0);Jc.ba=X.s;Jc.aa=X.s;M.i(g,qa,Bc,Jc);if(1<Ha.resolution_factor){var Xc=s("NONE");M.o(g,Xc);M.i(g,Bc,Xc,Jc);m.push(Xc)}else m.push(Bc)}E=m;m=[]}if(Ha.anaglyph_use&&
!a){var Kc=D();M.o(g,Kc);M.i(g,E[0],Kc,A("COLOR","u_sampler_left",1,1,!0));M.i(g,E[1],Kc,A("COLOR","u_sampler_right",1,1,!0));m.push(Kc)}else m.push(E[0]);var kd=M.yh(g,E[0]),Yc=!1;M.pe(g,kd,function(a,b,c){if(c.F==c.U)return Yc=!0});if(Yc||a){var cc=ja();M.o(g,cc);M.i(g,E[0],cc,A("COLOR","u_color",1,1,!0));E=m;m=[];m.push(cc)}Oa&&(mb?m.push(mb):m.push(Oa));if(!a&&d.Uh.procedural_skydome){var jc=P(n,d.Uh);M.o(g,jc);m.push(jc)}var Tb=ia();M.o(g,Tb);if(Pa.enabled){var Lc=s("NONE");M.o(g,Lc)}for(ca=
0;ca<m.length;ca++)switch(m[ca].type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":M.i(g,m[ca],Tb,A("COLOR","NONE",1,1,!0));M.i(g,m[ca],Tb,A("DEPTH","NONE",1,1,!0));break;case "SKY":M.i(g,jc,Tb,A("CUBEMAP","u_sky",za.ah,1,!1));break;default:M.i(g,m[ca],Pa.enabled?Lc:Tb,A("SCREEN","NONE",1,1,!0))}if(Pa.enabled){var Cc=null,Zc=0;M.J(g,function(a,b){if(b.type==Pa.ly){if(Zc==Pa.ky)return Cc=b,!0;Zc++}});if(Cc){var ed=M.yh(g,Cc);M.oe(g,function(a,b,c){if(a==ed)return M.i(g,Cc,Lc,A(Pa.Ox,"u_color",c.size,
c.ke,c.Eg)),M.i(g,Lc,Tb,A("SCREEN","NONE",.5,.5,!0)),!0})}}for(var Mc=M.Jo(g),ca=0;ca<Mc.length;ca++)for(var $c=Mc[ca],Ka=0;Ka<p.length;Ka++)pa=p[Ka],M.Ca(g,$c)==pa&&M.lg(g,$c);c(g,!1);1<Ha.resolution_factor&&k(g);h(g);z(g);return g};a.HA=B;a.eA=function(a){var b=null;M.J(a,function(a,c){return c.h&&null===c.h.Td?(b=c,!0):!1});return b};a.cb=function(a,b,c){a=Y(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.AA=oa;a.aw=fa;a.Wu=U;a.Do=Y;a.uA=E;a.La=function(a,b){var c=null;
M.J(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.vu=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=ea(a);M.J(a,function(a,d){var e=b+="    ",f="",f=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(f+=" ("+d.Hh.replace(/_/g," ")+")");if(d.h){for(var f=f+"\\n",g=0;g<c.length;g+=2)c[g]==d.h.bb&&(f+="C"+c[g+1]+" ");for(g=0;g<c.length;g+=2)c[g]==d.h.gc&&(f+="D"+
c[g+1])}d.Y.length&&(f+="\\n-----\\n");for(g=0;g<d.Y.length;g++)f+=na(d.Y[g],c);g="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+f+'" color="black" style="'+(g+",bold")+'"];\n')});M.oe(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+na(e,c)+'" style="'+(e.wa?"solid":"dotted")+'"];\n'});return b+="}"};a.Sn=function(a){a=M.ry(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,n){function b(){return{name:"",type:0,source:"",width:0,height:0,zk:1,li:!0,cm:1024,Jf:null,Ra:null,Xi:!1,N:0,ob:0,Vk:0,Oy:!1,Zh:!1,vp:0,ih:0,Ab:0,Fa:null,Mg:null}}function c(c,d,e){var f=c.type,h=new Uint8Array([204,204,204,255]),k=b();switch(f){case "DATA_TEX2D":case "IMAGE":var l=u.createTexture(),v=u.TEXTURE_2D;u.bindTexture(v,l);u.texImage2D(v,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,h);c.image&&"MOVIE"==c.image.source&&(k.Xi=!0,k.N=c.frame_start,k.ob=c.frame_offset,
k.Vk=c.frame_duration,k.Oy=c.use_auto_refresh,k.Zh=c.use_cyclic,k.vp=c.movie_length,0!=k.ob&&p.warn('Frame offset for texture "'+c.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":l=u.createTexture();v=u.TEXTURE_2D;u.bindTexture(v,l);if("NONE"==c.b4w_source_type)return null;if("SCENE"==c.b4w_source_type)if(c.b4w_source_id&&(e=x.keysearch("name",c.b4w_source_id,e)))k.jj=e,k.cm=c.b4w_source_size,e.Om=!0,u.texImage2D(v,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,
h);else return null;break;case "ENVIRONMENT_MAP":l=u.createTexture();v=u.TEXTURE_CUBE_MAP;u.bindTexture(v,l);e="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var n=0;6>n;n++)u.texImage2D(u["TEXTURE_CUBE_MAP_"+e[n]],0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,h);break;case "VORONOI":case "BLEND":return null;default:return p.error('B4W warning: texture "'+c.name+'" has unsupported type "'+f+'"'),null}"NONE"==f||"DATA_TEX2D"==f?u.texParameteri(v,u.TEXTURE_MIN_FILTER,u.LINEAR):
u.texParameteri(v,u.TEXTURE_MIN_FILTER,s[t.Gj]);u.texParameteri(v,u.TEXTURE_MAG_FILTER,u.LINEAR);h=v;e=c.b4w_anisotropic_filtering;"DEFAULT"===e&&(e=d);"OFF"!==e&&t.mi&&(d=m.sv())&&(e=parseFloat(e.split("x")[0]),u.texParameterf(h,d.TEXTURE_MAX_ANISOTROPY_EXT,e));"REPEAT"!=c.extension||c.b4w_shore_dist_map?(u.texParameteri(v,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(v,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE)):(u.texParameteri(v,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(v,u.TEXTURE_WRAP_T,u.REPEAT));
k.type=a.Gf;k.width=1;k.height=1;k.Fa=l;k.Ab=v;"CANVAS"==c.b4w_source_type&&"NONE"==f?(f=c.b4w_source_id,l=c.b4w_source_size,k.name=f,k.source="CANVAS",v=document.createElement("canvas"),v.setAttribute("id",f),v.width=l,v.height=l,k.Jf=v.getContext("2d"),B[f]=k,g(k)):(k.name=c.name,k.source=f,u.generateMipmap(v),u.bindTexture(v,null));return c.d=k}function g(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.Ab;u.bindTexture(b,a.Fa);var c=h(a),d=k(a),e=a.Jf.canvas;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,
!0);u.texImage2D(b,0,c,c,d,e);u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,!1);u.bindTexture(b,null);a.width=e.width;a.height=e.height}function d(a){u.texParameteri(a,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE);u.texParameteri(a,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE);u.texParameteri(a,u.TEXTURE_MAG_FILTER,u.LINEAR);u.texParameteri(a,u.TEXTURE_MIN_FILTER,u.LINEAR)}function l(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function h(b){switch(b.type){case a.Gf:b=
u.RGBA;break;case a.Yj:b=u.RGB;break;case a.hi:b=u.RGBA;break;case a.ii:b=u.RGB;break;case a.Og:b=u.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function k(b){switch(b.type){case a.Gf:b=u.UNSIGNED_BYTE;break;case a.Yj:b=u.UNSIGNED_BYTE;break;case a.hi:b=u.FLOAT;break;case a.ii:b=u.FLOAT;break;case a.Og:b=u.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}var f=n("__config"),p=n("__print"),v=n("__dds"),m=n("__extensions"),x=n("__util"),t=f.n,z=f.Hd,e=f.yd;a.oc=0;
a.s=0;a.ys=0;a.ws=0;a.xs=0;a.vs=0;a.Gf=10;a.Yj=20;a.hi=30;a.ii=40;a.Og=50;a.Ff=60;var B={},A={},u=null,s;a.Wb=function(b){s=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.oc=b.NEAREST;a.s=b.LINEAR;a.ys=b.NEAREST_MIPMAP_NEAREST;a.ws=b.LINEAR_MIPMAP_NEAREST;a.xs=b.NEAREST_MIPMAP_LINEAR;a.vs=b.LINEAR_MIPMAP_LINEAR;u=b};a.wv=function(a){return a in B?B[a].Jf:null};a.By=function(a){return a in B?(g(B[a]),!0):!1};a.Ei=function(c,d){var e=b();e.name=c;
e.type=d;e.source="NONE";if(d==a.Ff)e.Mg=u.createRenderbuffer();else{var f=u.TEXTURE_2D,g=u.createTexture();u.bindTexture(f,g);u.texParameteri(f,u.TEXTURE_MAG_FILTER,u.LINEAR);u.texParameteri(f,u.TEXTURE_MIN_FILTER,u.LINEAR);u.texParameteri(f,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE);u.texParameteri(f,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE);u.bindTexture(f,null);e.Ab=f;e.Fa=g}return e};a.Wt=function(c){var d=u.createTexture(),e=u.TEXTURE_CUBE_MAP;u.bindTexture(e,d);u.texParameteri(e,u.TEXTURE_MAG_FILTER,u.LINEAR);
u.texParameteri(e,u.TEXTURE_MIN_FILTER,u.LINEAR);u.texParameteri(e,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE);u.texParameteri(e,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),g=0;6>g;g++)u.texImage2D(u[f[g]],0,u.RGBA,c,c,0,u.RGBA,u.UNSIGNED_BYTE,null);u.bindTexture(e,null);e=b();e.name="CUBEMAP";e.type=a.Gf;e.source="NONE";e.width=
3*c;e.height=2*c;e.zk=1;e.Fa=d;e.Ab=u.TEXTURE_CUBE_MAP;return e};a.yj=function(b,c,d){if(b.type!=a.Ff){var e=b.Ab;u.bindTexture(e,b.Fa);c&&u.texParameteri(e,u.TEXTURE_MIN_FILTER,c);d&&u.texParameteri(e,u.TEXTURE_MAG_FILTER,d);u.bindTexture(e,null)}};a.sA=function(b){if(b.type==a.Ff)return{min:a.oc,uw:a.oc};var c=b.Ab;u.bindTexture(c,b.Fa);b=u.getTexParameter(c,u.TEXTURE_MIN_FILTER);var d=u.getTexParameter(c,u.TEXTURE_MAG_FILTER);u.bindTexture(c,null);return{min:b,uw:d}};a.resize=function(b,c,d){c=
Math.max(c,1);d=Math.max(d,1);if(b.width!=c||b.height!=d){if(b.type==a.Ff)u.bindRenderbuffer(u.RENDERBUFFER,b.Mg),u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_COMPONENT16,c,d),u.bindRenderbuffer(u.RENDERBUFFER,null);else{var e=b.Ab;u.bindTexture(e,b.Fa);var f=h(b),g=k(b);u.texImage2D(e,0,f,c,d,0,f,g,null);u.bindTexture(e,null)}c>t.jf||d>t.jf?p.error("B4W warning: texture has unsupported size",filepath):(b.width=c,b.height=d)}};a.pu=c;a.My=function(a){var b=a.Ab;u.bindTexture(b,a.Fa);u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,
!0);4!=a.Ra.length?u.texImage2D(b,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,a.Ra):u.texImage2D(b,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,a.Ra);u.bindTexture(b,null)};a.Pj=function(a,b,c,f){var g=a.source,h=a.Ab;u.bindTexture(h,a.Fa);if(4==b.length){var k=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==g)if(k)u.texImage2D(h,0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(c){c=v.Lo(b);if(c.width>t.jf||c.height>t.jf){p.error("B4W warning: texture has unsupported size",
f);return}v.Ny(u,m.Ho(),b,!0);l(c.width,c.height)&&(a.fn||p.warn("B4W warning: using NPOT-texture",f),d(h));a.width=c.width;a.height=c.height;a.zk=v.zv(b)}else{u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,!0);if(b.width>t.jf||b.height>t.jf){p.error("B4W warning: texture has unsupported size",f);return}a.Xi?(a.Ra=b,a.Ra.loop=a.Zh,A[a.name]=a,a.ih=z.ua,b.duration&&(a.ih=a.vp/b.duration),e.bo||(b.playbackRate=z.ua/a.ih,e.Bn&&2<b.playbackRate&&(b.playbackRate=2))):u.texImage2D(h,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,
b);a.width=b.width;a.height=b.height;l(b.width,b.height)?(a.fn||p.warn("B4W warning: using NPOT-texture",f),d(h)):u.generateMipmap(h)}else if("ENVIRONMENT_MAP"==g)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],k){for(k=0;6>k;k++)g=c[k],u.texImage2D(u["TEXTURE_CUBE_MAP_"+g[0]],0,u.RGBA,1,1,0,u.RGBA,u.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,!1);var s=b.width/3;if(s>t.xl||s>t.xl){p.error("B4W warning: cubemap has unsupported size",
f);return}for(k=0;6>k;k++){var g=c[k],x=document.createElement("canvas");x.width=s;x.height=s;var n=x.getContext("2d");"POSITIVE_Y"==g[0]||"NEGATIVE_Y"==g[0]?(n.translate(0,s),n.scale(1,-1)):(n.translate(s,0),n.scale(-1,1));n.drawImage(b,g[1]*s,g[2]*s,s,s,0,0,s,s);u.texImage2D(u["TEXTURE_CUBE_MAP_"+g[0]],0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,x)}a.width=3*s;a.height=2*s;l(b.width/3,b.height/2)?(p.warn("B4W warning: using NPOT cube map texture",f),d(h)):u.generateMipmap(h)}else"DATA_TEX2D"==g&&(u.texImage2D(h,
0,u.RGBA,b.width,b.height,0,u.RGBA,u.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);u.bindTexture(h,null)};a.Du=function(a){u.deleteTexture(a)};a.th=function(a){return a&&a.name&&(a.Fa||a.Mg)?!0:!1};a.fp=function(a){return a&&a.name&&a.Mg?!0:!1};a.NA=function(b){return b.type==a.hi||b.type==a.ii?!0:!1};a.Nv=function(b){var c=0;switch(b.type){case a.Gf:case a.Yj:c=4;break;case a.hi:case a.ii:c=16;break;case a.Og:c=3;break;case a.Ff:c=2}return c};a.nv=function(a){var b=null,b={name:"special_ssao_texture",
type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"};c(b,null,a);b.image={filepath:null};return b};a.cleanup=function(){B={};A={}};a.play_video=function(a){return a in A?(A[a].Ra.play(),!0):null};a.stop_video=function(a){return a in A?(A[a].Ra.pause(),!0):null};a.pause=function(){for(var a in A)A[a].Ra&&A[a].Ra.pause()};a.play=function(){for(var a in A)A[a].Ra&&A[a].Ra.play()}};b4w.module.__assets=function(a,n){function b(){return x.dp()?n(x.yb.vi).data:null}function c(){var a={ji:null,Gs:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.ji=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var c=b();c&&a.ji in c&&(a.status=200,c[a.ji]&&(a.response=a.Gs(c[a.ji])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function g(b){for(var c=0,e=0;e<b.length;e++){var g=b[e];20===g.state&&c++;if(c>=A.yw)break;if(10===g.state)switch(g.state=20,c++,g.type){case a.AT_ARRAYBUFFER:d(g,"arraybuffer");break;case a.AT_JSON:d(g,"json");break;case a.AT_TEXT:d(g,"text");break;case a.AT_AUDIOBUFFER:l(g);break;case a.AT_IMAGE_ELEMENT:h(g);
break;case a.AT_AUDIO_ELEMENT:k(g);break;case a.Wj:f(g);break;default:throw"Wrong asset type: "+g.type;}}}function d(a,d){var e=b(),f=e&&a.q in e?new c:new XMLHttpRequest;f.open("GET",a.q,!0);"text"==d?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==d?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=d;f.onreadystatechange=function(){if(40!=a.state&&4==f.readyState){if(200==f.status||0==f.status){var b=f.response;if(b){if("json"==d&&"string"==typeof b)try{b=
JSON.parse(b)}catch(c){a.ub(null,a.uri,a.type,a.q);t.error(c+" (parsing JSON "+a.q+")");return}a.ub(b,a.uri,a.type,a.q)}else a.ub(null,a.uri,a.type,a.q),t.error("B4W Error: empty responce when trying to get "+a.q)}else a.ub(null,a.uri,a.type,a.q),t.error("B4W Error: "+f.status+" when trying to get "+a.q);a.state=30}};f.addEventListener("progress",function(b){b.lengthComputable&&a.Vw(b.loaded/b.total)},!1);f.send(null)}function l(a){var d=b(),e=d&&a.q in d?new c:new XMLHttpRequest;e.open("GET",a.q,
!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(40!=a.state&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?z.zu(b,function(b){a.ub(b,a.uri,a.type,a.q);a.state=30},function(){a.ub(null,a.uri,a.type,a.q);t.error("B4W Error: failed to decode "+a.q);a.state=30}):(a.ub(null,a.uri,a.type,a.q),t.error("B4W Error: empty responce when trying to get "+a.q),a.state=30)}else a.ub(null,a.uri,a.type,a.q),t.error("B4W Error: "+e.status+" when trying to get "+a.q),a.state=
30};e.send(null)}function h(a){var c=document.createElement("img");u.Tg&&(c.crossOrigin="Anonymous");c.onload=function(){40!=a.state&&(a.ub(c,a.uri,a.type,a.q),a.state=30)};c.addEventListener("error",function(){40!=a.state&&(a.ub(null,a.uri,a.type,a.q),t.error("B4W Error: could not load image: "+a.q),a.state=30)},!1);var d=b();if(d&&a.q in d)if(d[a.q]){var e=p(a.q);c.src="data:"+e+";base64,"+d[a.q]}else d=new CustomEvent("error"),c.dispatchEvent(d);else c.src=a.q}function k(a){var c=document.createElement("audio");
u.Tg&&(c.crossOrigin="Anonymous");c.addEventListener("loadeddata",function(){40!=a.state&&(a.ub(c,a.uri,a.type,a.q),a.state=30)},!1);c.addEventListener("error",function(){40!=a.state&&(a.ub(null,a.uri,a.type,a.q),t.error("B4W Error: could not load sound: "+a.q),a.state=30)},!1);var d=b();if(d&&a.q in d)if(d[a.q]){var e=v(a.q);c.src="data:"+e+";base64,"+d[a.q];40!=a.state&&(a.ub(c,a.uri,a.type,a.q),a.state=30)}else d=new CustomEvent("error"),c.dispatchEvent(d);else c.src=a.q,u.Ye&&c.load();setTimeout(function(){c.Rx=
1},5E3)}function f(a){var c=document.createElement("video");c.muted=!0;if(u.Tg||u.Ye)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",function(){40!=a.state&&(a.ub(c,a.uri,a.type,a.q),a.state=30)},!1);c.addEventListener("error",function(){40!=a.state&&(a.ub(null,a.uri,a.type,a.q),t.error("B4W Error: could not load video: "+a.q),a.state=30)},!1);var d=b();if(d&&a.q in d)if(d[a.q]){var e=m(a.q);c.src="data:"+e+";base64,"+d[a.q];40!=a.state&&(a.ub(c,a.uri,a.type,a.q),a.state=30)}else d=new CustomEvent("error"),
c.dispatchEvent(d);else c.src=a.q,u.Ye&&c.load();setTimeout(function(){c.Rx=1},1E4)}function p(a){var b="image";switch(e.al(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function v(a){var b="audio";switch(e.al(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function m(a){var b="video";switch(e.al(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+=
"/webm";break;case "m4v":b+="/mp4"}return b}var x=n("__config"),t=n("__print"),z=n("__sfx"),e=n("__util"),B=n("__version"),A=x.Id,u=x.n;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.Wj=70;var s=[],q=0,K={};a.Dj=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.Mv=function(a){if(K[a])return K[a];var b=A.Yp?a+B.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");
c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return K[a]=b;throw"Error XHR: responce is empty, GET "+a;}throw"Error XHR: "+c.status+", GET "+a;};a.cleanup=function(){for(var a=0;a<s.length;a++)s[a].state=40;s=[];q=0;K={}};a.enqueue=function(a,c,d,e){for(var f=0;f<a.length;f++){var h=a[f],h={uri:h[0],type:h[1],q:h[2],name:h[3],state:10,ub:c||function(){},Rp:d||function(){},Vw:e||function(){},Sp:q};if(A.Yp){var k=b();k&&h.q in k||(h.q+=B.timestamp())}s.push(h)}g(s);
q++};a.update=function(){g(s);for(var a=s,b=0,c=!0,d=0;d<a.length;d++){var e=a[d];e.Sp===a[b].Sp?30!==e.state&&(c=!1):(c&&(a[d-1].Rp(),c=d-b,a.splice(b,c),d-=c),b=d,c=30===a[d].state?!0:!1);d===a.length-1&&c&&(a[d].Rp(),a.splice(b))}}};b4w.module.__loader=function(a,n){function b(b,d,f,g,h){var k=e,p=x.create(),l;for(l in d){var v=c(d[l]);(g&&v.Ta||!b&&v.qb)&&m(v);x.o(p,v)}for(l in d)for(v=d[l],v.name=l,b=0;b<v.B.length;b++)x.i(p,d[v.B[b]],v,null);d=c({name:"out",Ea:a.sr,Ia:function(a,b,c,d,e){0===b.id&&(k.Zp=!0);3!=b.status&&(b.status=2);h(b.id);e(b,c);t.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")}});var r=[];if(f)for(f=x.Jo(p),b=0;b<f.length;b++)r.push(x.Ca(p,f[b]));else x.J(p,function(a,b){b.Sa||r.push(b)});x.o(p,
d);for(b=0;b<r.length;b++)d.B.push(r[b].name),x.i(p,r[b],d,null);return p}function c(a){a.Sa=a.Sa||!1;a.Ea||0===a.Ea||(a.Ea=a.zc);a.B=a.B||[];a.qh=a.qh||!1;a.Zl=a.Zl||!1;a.hb=a.hb||0;a.Ta=a.Ta||!1;a.qb=a.qb||!1;a.status=0;a.XA=0;a.rl=0;a.He=a.He||null;return a}function g(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];x.Ca(a.Oc,f).qh&&(x.qe(a.Oc,f,function(d){var e=!0;x.pe(a.Oc,d,function(a,b){if(!b.qh)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-
1;0<=e;e--)b.splice(d[e],1);return c}function d(a){function b(c,d){var e=x.Ca(a.Oc,c),f=x.Ca(a.Oc,d),g=f.Ea-e.Ea;0==g&&(g=e.Sa-f.Sa);return g}var c=[],d=a.Ad,e=!1;do{var f=g(a,d);c.push.apply(c,d);0<f.length&&(e=!0);d=f}while(0<f.length);e&&c.sort(b);a.Ad=c;return a.Ad.length}function l(a,b,c){if(b.Zl)return b.qh=!0,k(a,b),!1;if(!b.Ia&&!b.Kf&&!b.Xg)return k(a,b),!1;if(0==b.status&&(b.status++,b.Ia))return b.Ia(c,a,b,b.He,k,f),!0;if(1==b.status){if(b.Kf)return b.Kf(c,a,b,b.He,k,f),!0;b.status++}return 2==
b.status&&(b.status++,b.Xg)?(b.Xg(c,a,b,b.He,k,f),!0):!1}function h(a){if(0==a.Ej)return 100;var b=0;x.J(a.Oc,function(c,d){a.do_not_load_resources&&d.Ta||(b+=d.rl*d.hb)});return z.trunc(100*b/a.Ej)}function k(a,b){b.qh=!0;b.status=3;p(a,b,1)}function f(a,b,c){1>c?p(a,b,c):b.status++}function p(a,b,c){var d=e;if(b.Ia||b.Kf||b.Xg)if(b.rl=c,b=h(a),a.Wn!=b||1==c)a.fm(b,performance.now()-a.Rq),a.Wn=b,d.vl=!0}function v(a,b){var c=null;x.J(a.Oc,function(a,d){if(d.name==b)return c=d,1});return c}function m(a){a.Zl=
!0;a.rl=1}var x=n("__graph"),t=n("__print"),z=n("__util");a.zc=0;a.ve=1;a.sr=2;var e=null;a.Io=function(){return e};a.hu=function(){var a={Sc:[],Hk:0,bk:0,Zp:!1,vl:!1};return e=a};a.qu=function(a,c,d,f,g,h,k,m){var p=e,r={id:p.Sc.length,status:0,q:c,jn:"",pp:m||!1,yB:h,Rq:0,Wn:0,Ej:0,Sl:!1,fm:f||function(){},Ln:g||function(){},Oc:null,Ad:null,hl:!1,gl:!1,jl:!1};a=b(0===r.id,a,h,k,d||function(){});r.Oc=a;c=[];d=x.Kv(a);for(f=0;f<d.length;f++)c.push(d[f]);r.Ad=c;x.J(a,function(a,b){!(b.Ia||b.Kf||b.Xg)||
r.do_not_load_resources&&b.Ta||(r.Ej+=b.hb)});p.Sc.push(r);p.bk++;return r.id};a.Jy=function(b){var c=e;if(c&&0!=e.bk)if(c.vl)c.vl=!1;else{var f=performance.now();do{var g=c.Sc[c.Hk],h=b[g.id];if(3!=g.status)if(0==g.status&&(g.status=1,g.Rq=performance.now(),g.fm(0,0)),d(g)){var k=g,m=k.Ad.length;do{var p=x.Ca(k.Oc,k.Ad[0]),v=l(k,p,h);p.Ea==a.ve&&(k.Sl=!0);p=k.Ad.shift();k.Ad.push(p);m--}while(!v&&0!=m)}else g.Ln(h,g),g.status=3,c.bk--,k=g,k.fm=null,k.Ln=null,k.Oc=null,k.Ad=null;c.Zp&&(c.Hk=(c.Hk+
1)%c.Sc.length);if(g.Sl){g.Sl=!1;break}}while(16>performance.now()-f)}};a.pB=f;a.$l=function(a,b){var c=v(a,b);null!==c&&m(c)};a.qy=function(a){return a&&3==a.status};a.is_primary_loaded=function(a){var b=e;if(!b)return!1;a|=0;return b.Sc[a]&&(3==b.Sc[a].status||2==b.Sc[a].status)};a.cleanup=function(){e=null}};b4w.module.__nla=function(a,n){function b(){return{type:"CLIP",N:0,W:0,xd:!1,paused:!1,Gd:"",ec:0,Sm:0,Ks:0,jo:0,io:0,stop_video:!1}}function c(a,b){for(var c=a.b4w_nla_script,d=b.wf,e=0;e<c.length;e++){var f=c[e];switch(f.type){case "PLAY":d.push({type:"PLAY",N:f.frame_range[0],W:f.frame_range[1],Wd:!1});break;case "SELECT":case "SELECT_PLAY":var g=z.Mi(z.Xj,f.object,0),h=z.Jv(a),k=h.indexOf(g);if(-1==k){t.error("NLA script error: non-selectable object");return}for(var f={type:f.type,wq:"SELECT"==
f.type?f.target_slot:e+1,Px:e+1,fe:-1,sx:h.length,rx:k,N:f.frame_range[0],W:f.frame_range[1],Wd:!1},k=[],p=0;p<h.length;p++)k.push(m.create_selection_sensor(h[p],!0));m.create_sensor_manifold(g,"NLA_SELECT_"+e,m.CT_SHOT,k,m.Au,function(a,c,d,e){if(!(b.Gb>=b.wf.length)&&(d=b.wf[b.Gb],"SELECT"==d.type||"SELECT_PLAY"==d.type&&!d.Wd)){for(d=0;d<e.sx;d++)if(m.get_sensor_value(a,c,d)&&d==e.rx){e.fe=1;return}e.fe=0}},f);d.push(f);break;case "JUMP":d.push({type:"JUMP",am:f.target_slot});break;case "CONDJUMP":d.push({type:"CONDJUMP",
am:f.target_slot,Lt:f.condition,Nh:f.register1,Oh:f.register2,Fl:f.number1,Gl:f.number2});break;case "REGSTORE":d.push({type:"REGSTORE",bx:f.registerd,Kw:f.number1});break;case "MATH":d.push({type:"MATH",Mw:f.operation,Nh:f.register1,Oh:f.register2,Fl:f.number1,Gl:f.number2,wj:f.registerd});break;case "NOOP":d.push({type:"NOOP"})}}}function g(a,b,c,e){if(a.wf.length){if(a.Gb>=a.wf.length)if(a.cyclic)a.Gb=0;else{a.ob-=A.ua*c;return}var f=l(a,b,e,!1),h=a.wf[a.Gb];switch(h.type){case "PLAY":h.Wd?f>=
h.W&&(h.Wd=!1,a.Gb++,g(a,b,c,e)):(a.ob+=h.N-f,h.Wd=!0,d(a,h));break;case "SELECT":case "SELECT_PLAY":-1<h.fe?"SELECT"==h.type||"SELECT_PLAY"==h.type&&0==h.fe?(a.Gb=h.fe?h.wq:h.Px,h.fe=-1,g(a,b,c,e)):h.Wd?f>=h.W&&(h.Wd=!1,a.Gb=h.wq,h.fe=-1,g(a,b,c,e)):(a.ob+=h.N-f,h.Wd=!0,d(a,h)):a.ob-=A.ua*c;break;case "JUMP":a.Gb=h.am;g(a,b,c,e);break;case "CONDJUMP":var f=-1==h.Nh?h.Fl:a.vd[h.Nh],k=-1==h.Oh?h.Gl:a.vd[h.Oh],m=!1;switch(h.Lt){case "EQUAL":f==k&&(m=!0);break;case "NOTEQUAL":f!=k&&(m=!0);break;case "LESS":f<
k&&(m=!0);break;case "GREATER":f>k&&(m=!0);break;case "LEQUAL":f<=k&&(m=!0);break;case "GEQUAL":f>=k&&(m=!0)}m?a.Gb=h.am:a.Gb++;g(a,b,c,e);break;case "REGSTORE":a.vd[h.bx]=h.Kw;a.Gb++;g(a,b,c,e);break;case "MATH":f=-1==h.Nh?h.Fl:a.vd[h.Nh];k=-1==h.Oh?h.Gl:a.vd[h.Oh];switch(h.Mw){case "ADD":a.vd[h.wj]=f+k;break;case "MUL":a.vd[h.wj]=f*k;break;case "SUB":a.vd[h.wj]=f-k;break;case "DIV":0==k&&B.da("Division by zero in NLA script"),a.vd[h.wj]=f/k}a.Gb++;g(a,b,c,e);break;case "NOOP":a.Gb++,g(a,b,c,e)}}}
function d(a,b){for(var c=a.wf,d=0;d<c.length;d++){var e=c[d];e!=b&&(e.fe=-1)}}function l(a,b,c,d){b=(b-c)*A.ua+a.ob-a.N;a.cyclic&&d&&(b%=a.W-a.N+1);return b+=a.N}function h(a,b){b?a.Ra.pause():(a.Ra.currentTime=a.ob/A.ua,a.Ra.play())}function k(a,c){for(var d=[],e=0;e<a.length;e++){var f=a[e].strips;if(f)for(var g=0;g<f.length;g++){var h=f[g],k=b();k.type=h.type;k.N=h.frame_start;k.W=h.frame_end;k.Gd=h.action?h.action.name:"";k.ec=c;k.Sm=h.action_frame_start;k.Ks=h.action_frame_end;d.push(k)}}return d}
function f(a){return e.Yd(a)&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}var p=n("__animation"),v=n("__camera"),m=n("__controls"),x=n("__config");n("__loader");n("__particles");var t=n("__print"),z=n("__scenes"),e=n("__sfx"),B=n("__util"),A=x.Hd,u=[],s=-1;a.Iy=function(a,d){var g={N:a.frame_start,W:a.frame_end,ob:0,uh:-1,cyclic:d,td:[],R:[],wf:[],Gb:0,vd:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}};c(a,g);for(var h=z.la(a,"ALL",z.DATA_ID_ALL),m=0;m<h.length;m++){var l=h[m],
x=0,s=[],n=l.animation_data;if(n&&n.nla_tracks.length&&(n=n.nla_tracks,B.Xe(l)||v.is_camera(l)||B.sc(l)||B.jw(l)||e.Yd(l))){var A=k(n,x);A.length&&(s=s.concat(A),x++)}f(l)&&(n=l.data.animation_data.nla_tracks,A=k(n,x),A.length&&(s=s.concat(A),x++));if(p.fl(l))for(var S=l.data.materials,R=0;R<S.length;R++)if(A=S[R].node_tree,n=A.animation_data,A&&n){for(var n=n.nla_tracks,A=k(n,-1),L=[],O=0;O<A.length;O++)n=A[O],-1==L.indexOf(n.Gd)&&L.push(n.Gd),n.ec=x+L.indexOf(n.Gd),s.push(n);x+=L.length}for(R=0;R<
l.particle_systems.length;R++)S=l.particle_systems[R],n=S.settings,"EMITTER"==n.type&&n.b4w_allow_nla&&(n=b(),n.type="CLIP",n.N=g.N,n.W=g.W+1,n.Gd=S.name,n.ec=x,s.push(n),x++);S=x+1;if(B.sc(l)&&l.data)for(R=0;R<l.data.b4w_vertex_anim.length;R++)A=l.data.b4w_vertex_anim[R],A.allow_nla&&(x=S,n=b(),n.type="CLIP",n.N=g.N,n.W=g.W+1,n.Gd=A.name,n.ec=x,s.push(n));s.length&&(l.$j=s,g.td.push(l))}h=a.d.Jg;for(R=0;R<h.length;R++)n=b(),m=h[R].d,n.type="VIDEO",n.N=Math.min(m.N,g.W),n.W=m.Zh?g.W:Math.min(m.Vk+
m.N+m.ob,g.W),n.Gd=h[R].name,m.Fs=n,g.R.push(m);R=g.N;h=g.W;for(m=0;m<g.td.length;m++)for(l=g.td[m],x=l.$j,s=0;s<x.length;s++)n=x[s],S=l.name+" ["+n.N+":"+n.W+"]",n.N=Math.max(R,n.N),n.W=Math.min(h+1,n.W),n.N>n.W&&(t.warn("NLA: out of scene range: "+S),x.splice(s,1),s--);for(R=0;R<g.td.length;R++)for(h=g.td[R].$j,m=0;m<h.length;m++){l=h[m];x=g.N;s=g.W+1;for(n=0;n<h.length;n++)S=h[n],l.ec==S.ec&&(S.W<=l.N&&(x=l.N),S.N>=l.W&&(s=Math.min(s,S.N)));l.jo=x;l.io=s}u.push(g)};a.start=function(){s=0};a.update=
function(a,b){if(!(0>s)){0==s&&(s=a);for(var c=0;c<u.length;c++){var d=u[c];g(d,a,b,s);for(var f=l(d,a,s,!0),k=0;k<d.td.length;k++){for(var m=d.td[k],v=m.$j,x=0;x<v.length;x++){var t=v[x];"SOUND"==t.type&&f<d.uh&&(t.xd=!1)}for(x=0;x<v.length;x++)switch(t=v[x],t.type){case "CLIP":if(t.jo<=f&&f<t.io&&!t.xd){var n=m,z=t;p.apply(n,z.Gd,z.ec);p.set_behavior(n,p.AB_FINISH_STOP,z.ec);for(n=0;n<v.length;n++)v[n]!=t&&v[n].ec==t.ec&&(v[n].xd=!1);t.xd=!0}t.xd&&(n=m,p.set_current_frame_float(n,f-t.N+t.Sm,t.ec),
p.update_object_animation(n,0,t.ec));break;case "SOUND":(f<d.uh||d.uh<t.N)&&t.N<=f&&f<t.W&&!t.xd&&(e.play(m,(t.N-f)/A.ua,(t.W-t.N)/A.ua),t.xd=!0),d.uh<t.W&&t.W<=f&&t.xd&&(t.xd=!1)}}for(k=0;k<d.R.length;k++)t=d.R[k].Fs,t.N<=Math.round(f)&&Math.round(f)<t.W&&!t.stop_video&&(h(d.R[k],t.stop_video),t.stop_video=!0),t.W<=Math.round(f)&&t.stop_video&&(h(d.R[k],t.stop_video),t.stop_video=!1);d.uh=f}}};a.cleanup=function(){u.length=0;s=-1};a.Vo=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||
f(a)||p.fl(a)?!0:!1}};b4w.module.__camera=function(a,n){function b(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function c(b){var c={type:b,name:"",ke:1,width:0,height:0,Td:null,bb:null,gc:null,ib:0,md:0,Da:0,Ka:0,left:0,right:0,top:0,bottom:0,Sd:new Float32Array(3),oo:new Float32Array(3),quat:new Float32Array(4),ea:new Float32Array(16),Fz:new Float32Array(16),ia:new Float32Array(16),
Kg:new Float32Array(16),Uw:new Float32Array(16),Mc:new Float32Array(16),uq:new Float32Array(16),Cf:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,Me:null,dof_on:0,Wk:{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),Da:new Float32Array([0,0,0,0]),Ka:new Float32Array([0,0,0,0])},Vh:0,Pc:0,gb:null,$g:null,Ek:null,Tn:new Float32Array(4),rj:new Float32Array(4)};if(b==a.Ya)return c;switch(b){case a.pc:l(c,
40,.1,1E3);break;case a.Hf:l(c,2.5,.1,1E3);break;case a.we:break;case a.Pg:break;case a.Qg:break;case a.tb:case a.Bb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function g(b,c,d){if(b.type!=a.tb&&b.type!=a.Bb)throw"set_stereo_params(): wrong camera type";b.Vh=c;b.Pc=d;z(b,b.ib);if(F.V())for(c=F.get_active(),b=c.d.wc,c=c.camera.d.L,d=0;d<c.length;d++)s(c[d],b)}function d(a,b){var c=a.d,d=G.quat_to_dir(c.quat,G.AXIS_MY,Z),e=Math.asin(d[1]/
W.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?G.quat_to_dir(c.quat,G.AXIS_MZ,N):G.quat_to_dir(c.quat,G.AXIS_Z,N)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b}function l(b,c,d,e,f){switch(b.type){case a.pc:case a.tb:case a.Bb:b.md=c;b.ib=1;break;case a.Hf:b.top=c;b.ib=1;break;case a.we:delete b.md;b.md=c;b.ib=f/c;break;case a.Pg:b.top=c;b.ib=f/c;break;default:r.error("set_frustum(): Unsupported camera type: "+b.type)}b.Da=
d;b.Ka=e}function h(b,c){var d=c.d.e,f=c.d.quat,g=ga;L.rotateX(c.d.G,-Math.PI/2,g);L.invert(g,b.ea);if(b.gb){var g=b.gb[0],h=b.gb[1],k=b.gb[2],E=b.gb[3],m=ga;m[0]=1-2*g*g;m[1]=-2*g*h;m[2]=-2*g*k;m[3]=0;m[4]=-2*g*h;m[5]=1-2*h*h;m[6]=-2*h*k;m[7]=0;m[8]=-2*g*k;m[9]=-2*h*k;m[10]=1-2*k*k;m[11]=0;m[12]=-2*g*E;m[13]=-2*h*E;m[14]=-2*k*E;m[15]=1;L.multiply(b.ea,m,b.ea);z(b,b.ib,!0);g=P;h=ga;L.invert(b.ea,h);L.transpose(h,h);T.transformMat4(b.gb,h,g);h=ja;h[0]=(G.sign(g[0])+b.ia[8])/b.ia[0];h[1]=(G.sign(g[1])+
b.ia[9])/b.ia[5];h[2]=-1;h[3]=(1+b.ia[10])/b.ia[14];T.scale(g,2/(g[0]*h[0]+g[1]*h[1]+g[2]*h[2]+g[3]*h[3]),g);b.ia[2]=g[0];b.ia[6]=g[1];b.ia[10]=g[2]+1;b.ia[14]=g[3]}b.type==a.tb?b.ea[12]+=b.Pc/2:b.type==a.Bb&&(b.ea[12]-=b.Pc/2);L.multiply(b.ia,b.ea,b.Cf);B(b);e(b);W.copy(b.Sd,b.oo);W.copy(d,b.Sd);S.copy(f,b.quat)}function k(b,c,d,f){L.lookAt(c,d,f,b.ea);b.type==a.tb?b.ea[12]+=b.Pc/2:b.type==a.Bb&&(b.ea[12]-=b.Pc/2);L.multiply(b.ia,b.ea,b.Cf);B(b);e(b);W.copy(c,b.Sd)}function f(b){b=b.d;if(b.pb){var c=
Z;b.ca==a.MS_TARGET_CONTROLS?W.subtract(b.e,b.Va,c):G.quat_to_dir(b.quat,G.AXIS_MY,c);c[1]=0;W.normalize(c,c);var d=-Math.acos(-c[2]);0>c[0]&&(d=-2*Math.PI-d);b.ca==a.MS_EYE_CONTROLS&&(d*=-1);b.pb.left+=d;b.pb.right+=d}}function p(b){b=b.d;if(b.za){var c=Z;b.ca==a.MS_TARGET_CONTROLS?W.subtract(b.e,b.Va,c):G.quat_to_dir(b.quat,G.AXIS_MY,c);W.normalize(c,c);c=Math.asin(c[1]);b.za.Pa+=c;b.za.Ja+=c}}function v(a){a=a.d;if(a.pb)if(a.za){var b=G.ze(a.za.Pa+Math.PI/2),c=G.ze(a.za.Ja+Math.PI/2);if(c>Math.PI)a.za=
{Ja:-Math.PI/2,Pa:Math.PI/2};else if(b>Math.PI||b<c)a.za.Pa=Math.PI/2}else a.za={Ja:-Math.PI/2,Pa:Math.PI/2}}function m(a){a=G.quat_to_dir(a.d.quat,G.AXIS_MY,Z);W.normalize(a,a);return-Math.asin(a[1])}function x(a,b,c){if(b==c)return c-a;a=G.ze(a);b=G.ze(b);c=G.ze(c);if(.001>Math.abs(b-c))return 0;b=2*Math.PI-b;c=G.ze(c+b);a=G.ze(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0}function t(a,b,c){a=a.d;var d=W.subtract(a.Va,a.e,Z);b=S.setAxisAngle(b,c,da);W.transformQuat(d,b,d);W.subtract(a.Va,d,a.e);
S.multiply(b,a.quat,a.quat)}function z(b,c,d){switch(b.type){case a.pc:if(!c)throw"No aspect ratio";b.ib=c;case a.we:L.perspective(G.Xw(b.md),b.ib,b.Da,b.Ka,b.ia);break;case a.Hf:if(!c)throw"No aspect ratio";b.ib=c;case a.Pg:c=b.top*b.ib;L.ortho(-c,c,-b.top,b.top,b.Da,b.Ka,b.ia);break;case a.Qg:L.ortho(b.left,b.right,b.bottom,b.top,b.Da,b.Ka,b.ia);break;case a.tb:case a.Bb:if(!c)throw"No aspect ratio";b.ib=c;var f=Math.tan(b.md*Math.PI/360);c=b.Da*f;var g=b.ib*b.Vh*f;b.type==a.tb?(f=g-b.Pc/2,g+=b.Pc/
2):(f=g+b.Pc/2,g-=b.Pc/2);f=-(b.Da/b.Vh*f);g*=b.Da/b.Vh;L.frustum(f,g,-c,c,b.Da,b.Ka,b.ia);b.left=f;b.right=g;break;case a.Ya:return;default:throw"Wrong camera type: "+b.type;}d||(L.multiply(b.ia,b.ea,b.Cf),B(b),e(b))}function e(a){L.copy(a.ea,a.Mc);a.Mc[12]=0;a.Mc[13]=0;a.Mc[14]=0;a.Mc[15]=1;L.multiply(a.ia,a.Mc,a.Mc);L.invert(a.Mc,a.Mc)}function B(a){L.copy(a.ea,a.Kg);L.multiply(a.ia,a.Kg,a.Kg);L.invert(a.Kg,a.Kg)}function A(b,c,d,e,f){e||(e=new Float32Array(24));c||(c=b.Da);d||(d=b.Ka);var g,h,
k,m,l,p,q,r;switch(b.type){case a.Ya:throw"Extraction from NONE camera is not possible";case a.pc:case a.we:g=c*Math.tan(b.md*Math.PI/360);m=-g;h=g*b.ib;k=-h;l=d/c*g;r=-l;p=l*b.ib;q=-p;break;case a.Hf:case a.Pg:k=b.top*b.ib;g=l=b.top;h=p=k;m=r=-b.top;k=q=-k;break;case a.Qg:g=l=b.top;h=p=b.right;m=r=b.bottom;k=q=b.left;break;case a.tb:case a.Bb:l=c/b.Da;g=c*Math.tan(b.md*Math.PI/360);m=-g;h=b.right*l;k=b.left*l;q=d/c;l=g*q;r=-l;p=h*q;q*=k;break;default:throw"Wrong camera type: "+b.type;}e[0]=k;e[1]=
m;e[2]=-c;e[3]=h;e[4]=m;e[5]=-c;e[6]=h;e[7]=g;e[8]=-c;e[9]=k;e[10]=g;e[11]=-c;e[12]=q;e[13]=r;e[14]=-d;e[15]=q;e[16]=l;e[17]=-d;e[18]=p;e[19]=l;e[20]=-d;e[21]=p;e[22]=r;e[23]=-d;f&&(c=ga,L.invert(b.ea,c),G.ce(e,c,e,0));return e}function u(a){return"CAMERA"===a.type?!0:!1}function s(a,b){if(b.b4w_enable_csm){var c=b.csm_num;if(!a.$g){var d=b.csm_num;a.$g=Array(d);for(var e=0;e<d;e++)a.$g[e]=new Float32Array(3);a.Ek=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.Da:q(b,a,d-1),f=q(b,a,d),e=A(a,e,
f,V),e=H.Fv(e);a.$g[d].set(e.t);a.Ek[d]=e.ma;a.Tn[d]=W.length(e.t);a.rj[d]=K(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.rj[0]=b.first_cascade_blur_radius}function q(a,b,c){var d=a.csm_num,e=G.clamp(a.csm_first_cascade_border,b.Da,b.Ka);a=G.clamp(a.csm_last_cascade_border,b.Da,b.Ka);return G.clamp(K(e,a,d,c),b.Da,b.Ka)}function K(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var H=n("__boundings"),y=n("__config"),J=n("__constraints"),
r=n("__print"),F=n("__scenes"),G=n("__util"),W=n("vec3"),T=n("vec4"),S=n("quat"),R=n("mat3"),L=n("mat4"),O=y.controls;a.Ya=10;a.pc=20;a.Hf=30;a.we=40;a.Pg=50;a.Qg=60;a.tb=70;a.Bb=80;a.MS_STATIC=0;a.MS_ANIMATION=1;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var Q=new Float32Array(2),Z=new Float32Array(3),N=new Float32Array(3),da=new Float32Array(4);new Float32Array(4);var P=new Float32Array(4),ja=new Float32Array(4),D=new Float32Array(16),ga=new Float32Array(16),V=new Float32Array(24);
a.xt=function(d){var e=d.d,g=d.data;switch(g.type){case "PERSP":var h=c(a.pc);if(g.angle_y)var k=g.angle_y/Math.PI*180;l(h,k,g.clip_start,g.clip_end);break;case "ORTHO":h=c(a.Hf),l(h,g.ortho_scale/2,g.clip_start,g.clip_end)}h.name=d.name;e.Hj=O.vt.slice();e.Wq=!1;e.ca=b(g.b4w_move_style);e.dof_distance=d.data.dof_distance;e.Me=d.data.dof_object;e.dof_front=d.data.b4w_dof_front;e.dof_rear=d.data.b4w_dof_rear;e.dof_power=d.data.b4w_dof_power;e.fo=d.data.b4w_enable_hover_hor_rotation;e.L=[h];e.ca==a.MS_TARGET_CONTROLS&&
e.Va.set(g.b4w_target);e=d.d;if(e.ca===a.MS_TARGET_CONTROLS||e.ca===a.MS_EYE_CONTROLS||e.ca===a.MS_HOVER_CONTROLS)g=d.data,e.ca===a.MS_TARGET_CONTROLS||e.ca===a.MS_EYE_CONTROLS?(g.b4w_use_horizontal_clamping&&(e.pb={left:g.b4w_rotation_left_limit,right:g.b4w_rotation_right_limit}),g.b4w_use_vertical_clamping&&(e.za={Ja:g.b4w_rotation_down_limit,Pa:g.b4w_rotation_up_limit}),"LOCAL"==g.b4w_horizontal_clamping_type&&f(d),"LOCAL"==g.b4w_vertical_clamping_type&&p(d),v(d),g.b4w_use_panning&&(e.br=g.b4w_use_panning)):
e.ca===a.MS_HOVER_CONTROLS&&(g.b4w_use_horizontal_clamping&&g.b4w_horizontal_translation_min<=g.b4w_horizontal_translation_max&&(e.pb={left:g.b4w_horizontal_translation_min,right:g.b4w_horizontal_translation_max}),g.b4w_use_vertical_clamping&&g.b4w_vertical_translation_min<=g.b4w_vertical_translation_max&&(e.za={Ja:-g.b4w_vertical_translation_max,Pa:-g.b4w_vertical_translation_min}),g.b4w_use_distance_limits&&g.b4w_hover_angle_min<=g.b4w_hover_angle_max&&(e.Na={Ja:g.b4w_hover_angle_min,Pa:g.b4w_hover_angle_max})),
e.zb=g.b4w_use_distance_limits&&g.b4w_distance_min<=g.b4w_distance_max,e.zb&&(e.Fc=g.b4w_distance_min,e.Pf=g.b4w_distance_max);e=d.d;if(e.ca===a.MS_HOVER_CONTROLS&&e.zb)if(e.Na){if(g=m(d),h=G.quat_to_dir(e.quat,G.AXIS_Z,Z),d=0,0<h[1]&&(d-=Math.asin(h[1]/W.len(h))),g>e.Na.Pa?d+=g-e.Na.Pa:g<e.Na.Ja&&(d+=e.Na.Ja-g),(d||0>g)&&r.warn("B4W Warning: Active hover camera has wrong orientation"),d&&(g=G.quat_to_dir(e.quat,G.AXIS_X,N),d=S.setAxisAngle(g,-d,da),S.normalize(d,d),S.multiply(d,e.quat,e.quat)),d=
G.quat_to_dir(e.quat,G.AXIS_MY,Z),g=P,g.set(G.AXIS_Y),g[3]=0,d=G.line_plane_intersect(g,0,e.e,d,e.Ud),!d||100<W.len(d))e.Ud[0]=e.e[0],e.Ud[1]=0,e.Ud[2]=e.e[2]}else e.zb=!1};a.kb=c;a.Hz=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.bb);case "DEPTH":return Boolean(a.gc);case "SCREEN":return!Boolean(a.bb)&&!Boolean(a.gc);default:throw"Wrong attachment type: "+b;}};a.xj=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.bb=c;break;case "DEPTH":a.gc=c;break;case "SCREEN":a.bb=
null;a.gc=null;break;default:throw"Wrong attachment type: "+b;}};a.qA=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.bb;case "DEPTH":return a.gc;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.rp=function(b,c){if(b.type!=a.pc||c!=a.tb&&c!=a.Bb)throw"make_stereo(): wrong camera type";b.type=c;g(b,6,.065)};a.Dx=g;a.jq=function(a,b){var c=a.d.quat,d=da,e=Z;e[0]=0;e[1]=1;e[2]=0;S.setAxisAngle(e,b,d);S.multiply(d,c,c)};a.iB=function(a,b){var c=a.d.quat,d=da,e=Z;e[0]=
1;e[1]=0;e[2]=0;S.setAxisAngle(e,b,d);S.multiply(d,c,c)};a.hB=function(a,b){var c=a.d.quat;S.invert(c,c);var d=da,e=Z;e[0]=0;e[1]=0;e[2]=1;S.setAxisAngle(e,-b,d);S.multiply(d,c,c);S.invert(c,c)};a.Tl=function(a,b){var c=a.d.quat;S.invert(c,c);var d=da,e=Z;e[0]=1;e[1]=0;e[2]=0;S.setAxisAngle(e,-b,d);S.multiply(d,c,c);S.invert(c,c)};a.get_angles=d;a.oq=l;a.yx=function(b,c,d,e,f,g,h){switch(b.type){case a.Qg:b.left=c;b.right=d;b.bottom=e;b.top=f;b.Da=g;b.Ka=h;break;default:r.error("set_frustum_asymmetric(): Unsupported camera type: "+
b.type)}};a.get_move_style=function(a){return a.d.ca};a.kB=h;a.lB=k;a.rq=function(a,b,c){var d=Z;d[0]=0;d[1]=-1;d[2]=0;W.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=N;e[0]=0;e[1]=0;e[2]=-1;W.transformQuat(e,c,e);k(a,b,d,e)};a.jB=function(a,b,c){if("CAMERA"!=a.type)throw"Wrong camera object";a=a.d;a.e.set(b);a.quat.set(c)};a.Su=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];L.lookAt(a,b,c,ga);L.invert(ga,ga);L.rotateX(ga,Math.PI/2,ga);R.fromMat4(ga,D);S.fromMat3(D,e)};a.Xq=function(a){var b=
a.d.L;if(!b)throw"Wrong object";for(var c=a.d,d=0;d<b.length;d++){var e=b[d];h(e,a);G.lo(e.Cf,e.Wk);if(e.Me)if(e.dof_on){var f=W.dist(c.e,e.Me.location);e.dof_distance=f}else e.dof_distance=0}};a.Ay=function(b){var c=b.d;if(c.ca==a.MS_TARGET_CONTROLS)if(c.zb){if(J.kx(c.e,c.quat,c.Va,c.Fc,J.pr)){var d=W.subtract(c.e,c.Va,Z);W.scale(d,-c.Fc/W.length(d),d);W.add(c.Va,d,c.e)}}else J.jx(c.e,c.quat,c.Va);c.ca!=a.MS_TARGET_CONTROLS&&c.ca!=a.MS_EYE_CONTROLS||J.correct_up(b,G.AXIS_Y)};a.cw=f;a.Wy=p;a.um=v;
a.Ht=function(b){var c=b.d;if(c.ca===a.MS_TARGET_CONTROLS||c.ca===a.MS_EYE_CONTROLS){if(c.pb){var e=c.pb.left,f=c.pb.right,g=d(b,Q),g=g[0],g=c.ca==a.MS_TARGET_CONTROLS?g-Math.PI:-1*g;if(g=x(g,e,f))c.ca==a.MS_TARGET_CONTROLS?t(b,G.AXIS_Y,g):(g=S.setAxisAngle(G.AXIS_MY,g,da),S.multiply(g,b.d.quat,b.d.quat))}c.za&&(e=c.za.Ja,f=c.za.Pa,g=d(b,Q),g=g[1],c.ca==a.MS_TARGET_CONTROLS&&(g*=-1),g=0<G.quat_to_dir(c.quat,G.AXIS_Z,Z)[1]?G.sign(g)*Math.PI-g:g,g=x(g,e,f))&&(c.ca==a.MS_TARGET_CONTROLS?(e=G.quat_to_dir(b.d.quat,
G.AXIS_MX,N),t(b,e,g)):(e=g,g=b.d,f=G.quat_to_dir(g.quat,G.AXIS_X,Z),e=S.setAxisAngle(f,e,da),S.multiply(e,g.quat,g.quat)));c.ca===a.MS_TARGET_CONTROLS&&c.zb&&(g=b.d,e=W.subtract(g.e,g.Va,Z),f=W.length(e),f>g.Pf?(W.scale(e,g.Pf/f,e),W.add(g.Va,e,g.e)):f<g.Fc&&(f=G.quat_to_dir(g.quat,G.AXIS_MY,N),W.scale(f,100*g.Fc,f),W.add(e,f,e),W.scale(e,-g.Fc/W.length(e),e),W.add(g.Va,e,g.e)))}c.ca===a.MS_HOVER_CONTROLS&&(c=b.d,g=c.zb?c.Ud:c.e,c.pb&&(g[0]=G.clamp(g[0],c.pb.left,c.pb.right)),c.za&&(g[2]=G.clamp(g[2],
c.za.Ja,c.za.Pa)),c=b.d,c.zb&&(e=G.quat_to_dir(c.quat,G.AXIS_Z,Z),g=0,0<e[1]&&(g=Math.asin(e[1]/W.len(e))),e=W.negate(d(b,Q),Q),e[1]<c.Na.Ja?g+=e[1]-c.Na.Ja:e[1]>c.Na.Pa&&(g+=e[1]-c.Na.Pa),g&&(e=G.quat_to_dir(c.quat,G.AXIS_X,N),W.normalize(e,e),g=S.setAxisAngle(e,g,da),S.normalize(g,g),S.multiply(g,c.quat,c.quat)),g=Z,b=b.d,b.zb?(e=G.quat_to_dir(b.quat,G.AXIS_MY,Z),W.normalize(e,e),b.Na.Pa-b.Na.Ja?(f=(-Math.asin(e[1])-b.Na.Ja)/(b.Na.Pa-b.Na.Ja),f=Math.max(f,0)):f=0,b=W.scale(e,-(f*(b.Pf-b.Fc)+b.Fc),
g)):b=null,W.add(c.Ud,b,c.e)))};a.Co=m;a.OA=function(b){switch(b.type){case a.pc:case a.Hf:case a.tb:case a.Bb:return!0;default:return!1}};a.qv=function(b){b=b.d.L[0];switch(b.type){case a.pc:case a.we:case a.tb:case a.Bb:return Math.PI*b.md/180;default:return r.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.mg=z;a.st=e;a.tt=B;a.Pu=A;a.gt=function(a){a=a.d;var b=H.Xc();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.Db=b;var c=H.Ck(1,[0,0,0]);a.rc=c;a.jk=H.On(1,b);
a.lk=H.Qn(1,b);a.kk=H.Pn(1,b)};a.is_camera=u;a.ic=function(b){return u(b)&&b.d&&b.d.ca==a.MS_TARGET_CONTROLS?!0:!1};a.Qb=function(b){return u(b)&&b.d&&b.d.ca==a.MS_HOVER_CONTROLS?!0:!1};a.kl=function(b){return u(b)&&b.d&&b.d.ca==a.MS_EYE_CONTROLS?!0:!1};a.Nj=s;a.tu=q};b4w.module.__lights=function(a,n){function b(a){return{name:"",index:0,type:a,direction:new Float32Array(3),color:new Float32Array(3),Lf:new Float32Array(3),Eq:0,Dq:0,mv:!1,eo:!1,Gg:!0,Ig:!0,Uf:1,distance:25,Tu:"INVERSE_SQUARE"}}function c(a){a.Lf[0]=a.color[0]*a.Uf;a.Lf[1]=a.color[1]*a.Uf;a.Lf[2]=a.color[2]*a.Uf}var g=n("__util"),d=n("vec3");a.GA=b;a.rw=function(a){var h=a.data,k=b(h.type);k.name=a.name;k.Gg=h.use_diffuse;k.Ig=h.use_specular;var f=g.quat_to_dir(a.d.quat,g.AXIS_Y,[]);d.normalize(f,
f);k.direction[0]=f[0];k.direction[1]=f[1];k.direction[2]=f[2];k.color[0]=h.color[0];k.color[1]=h.color[1];k.color[2]=h.color[2];k.Uf=h.energy;c(k);k.distance=h.distance;if("POINT"===k.type||"SPOT"===k.type)k.Tu=h.falloff_type;"SPOT"===k.type&&(k.Eq=h.spot_size,k.Dq=h.spot_blend);k.mv=h.b4w_generate_shadows;k.eo=h.b4w_dynamic_intensity;a.Ga=k};a.Ax=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];c(a)};a.pq=function(a,b){a.Uf=b;c(a)};a.Fy=function(a){if("LAMP"!=a.type)throw"Wrong light object";
var b=a.Ga;b&&g.quat_to_dir(a.d.quat,g.AXIS_Y,b.direction)}};b4w.module.__scenes=function(a,n){function b(){if(!ya)throw"no active scene";return ya}function c(){return ya?!0:!1}function g(a,b,c,d){d|=0;for(var e=null,f=0;f<b.length;f++){var g=b[f];if((c?g.origin_name:g.name)==a&&g.d.gd==d){e=g;break}}return e}function d(a,b){b||(b="ALL");var c=[];l(a.objects,b,c);return c}function l(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&l(e.objects,b,c)}}function h(b){if("NONE"==X.ge||!b.b4w_render_shadows)return!1;
var c=!1,d=!1;if(0==H(b,"LAMP",a.DATA_ID_ALL).length)return!1;b=H(b,"MESH",a.DATA_ID_ALL);for(var e=0;e<b.length;e++){var f=b[e];f.b4w_shadow_cast&&(c=!0);f.b4w_shadow_receive&&(d=!0);if(c&&d)return!0}return!1}function k(a,b,c){c=I.yh(a,b);I.pe(a,c,function(a,c,d){if(d.wa){switch(d.F){case "COLOR":case "CUBEMAP":a=c.h.bb;break;case "DEPTH":a=c.h.gc;break;case "SCREEN":a=null;break;default:throw"Wrong slink";}switch(d.U){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:if(!a)throw"Connection of SCREEN is forbidden";
c=b.l;for(var e=0;e<c.length;e++){var f=c[e].k;aa.yn(f.Xb,d.U)&&P.ni(f,a,d.U)}}}});for(a=0;a<b.Y.length;a++){var d=b.Y[a],e=b.Rc[a];switch(d.U){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:for(var f=b.l,g=0;g<f.length;g++)c=f[g].k,aa.yn(c.Xb,d.U)&&P.ni(c,e,d.U)}}}function f(a,b,c,d,e){for(var f=b.d,g=b.O,h=0;h<g.length;h++){var l=g[h];if(!(l.Mb||l.Kb||"MAIN"!=l.type&&"NODES"!=l.type&&"PARTICLES"!=l.type||z(a,l))){if("OPAQUE"===d){if(l.qa)continue;var q=ea.La(c,
"SHADOW_CAST")&&l.rb?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE"}else if("BLEND"===d||"XRAY"===d){if(!l.qa)continue;if("XRAY"==d!=l.mc)continue;if(ea.La(c,"SHADOW_CAST")&&l.rb)switch(X.ge){case "DEPTH":q="SHADOW_SRC_DEPTH";break;default:throw"Wrong shadows type";}else q="SHADOW_SRC_NONE"}else throw"Wrong main subscene type";"NODES"==l.type&&l.Ms&&(b.d.yz.push(l.Ms),b.d.xz.push(l.zz));var r=l.Wa,w=e.d.wc;aa.I(r,"SHADOW_SRC",q);P.gk(l,w);aa.I(r,"NUM_LIGHTS",a.mf);"special_skydome.glslf"==aa.Bo(r)&&aa.I(r,"REFLECTION_PASS",
0);aa.I(r,"SSAO_ONLY",0);a.Aa&&a.xc?aa.I(r,"WATER_EFFECTS",1):aa.I(r,"WATER_EFFECTS",0);a.Aa&&a.Ge&&f.Ge?(aa.I(r,"CAUSTICS",1),aa.I(r,"CAUST_SCALE",a.un),aa.I(r,"CAUST_SPEED",aa.u(a.vn,2)),aa.I(r,"CAUST_BRIGHT",a.tn)):aa.I(r,"CAUSTICS",0);a.Aa&&(aa.I(r,"WAVES_HEIGHT",aa.u(a.te)),aa.I(r,"WAVES_LENGTH",aa.u(a.Df)),aa.I(r,"WATER_LEVEL",aa.u(a.se)));l.uc&&ea.La(c,"MAIN_REFLECT")&&-1===l.$b.indexOf("u_mirrormap")?aa.I(r,"REFLECTIVE",1):aa.I(r,"REFLECTIVE",0);if(w=ea.La(c,"SKY"))if(l.$p){var s=w.h.bb;P.ni(l,
s,"u_sky")}else X.Ih?(l.Ec=w.Ec,aa.I(r,"PROCEDURAL_FOG",1)):aa.I(r,"PROCEDURAL_FOG",0);else aa.I(r,"PROCEDURAL_FOG",0);if("SKY_TEXTURE"==e.world.light_settings.environment_color){s=null;if(e.d.Uh.procedural_skydome&&e.world.b4w_sky_settings.use_as_environment_lighting)s=w.h.bb;else for(h=0;h<a.qg.length;h++)if(a.qg[h].texture.b4w_use_as_environment_lighting){s=P.uv(a.qg[h],!1);break}s?(aa.I(r,"SKY_TEXTURE",1),P.ni(l,s,"u_sky_texture")):Y.warn("B4W Warning: environment lighting is set to 'Sky Texture', but there is no world texture with environment map")}l.xa&&
(w=ea.La(c,"GRASS_MAP"))&&t(l,w,f);ea.La(c,"REFRACT")&&l.Pl?aa.I(r,"REFRACTIVE",1):aa.I(r,"REFRACTIVE",0);l.re&&(l.zm&&ea.La(c,"DEPTH")?aa.I(r,"SHORE_SMOOTHING",1):aa.I(r,"SHORE_SMOOTHING",0),l.water_dynamic&&a.Aa&&a.te?aa.I(r,"DYNAMIC",1):aa.I(r,"DYNAMIC",0));"PARTICLES"==l.type&&(aa.I(r,"SIZE_RAMP_LENGTH",l.Pp),aa.I(r,"COLOR_RAMP_LENGTH",l.Gp));for(var w=l.R,n=0;n<w.length;n++){var s=w[n],U=s.jj;if(U){var fa=U.d.Ma,V=null,u=null;I.oe(fa,function(a,b,c){if("SCREEN"==c.F)return V=I.Ca(fa,a),u=c,!0});
if(!V||!u)throw"Failed to assign RTT";Ua.yj(s,Ua.s,Ua.s);u.na=s;var ia=V.h;ia.bb=s;ia.Td=E.fq(s,null);J(U,s.cm,s.cm,!0);s=ea.Sn(fa);for(ia=s.length-1;0<=ia;ia--){var na=s[ia],y=na.h;D.mg(y,1);"MAIN_OPAQUE"==a.type&&y.type==D.pc&&D.Nj(y,U.d.wc);e.d.uf.unshift(na)}}}if(l.cg){var w=0,M;for(M in l.cg)w++;aa.I(r,"NUM_LAMP_LIGHTS",w);l.ol=new Float32Array(3*w);l.ml=new Float32Array(3*w);l.ll=new Float32Array(3*w);l.nl=new Float32Array(4*w);for(n=0;n<e.$a.LAMP.length;n++)p(l,e.$a.LAMP[n])}x(c,a,q);P.sb(l);
q={P:!0,Ua:f,k:l};v(l);a.l.push(q);k(c,a,l);m(l)}}a.l.sort(function(a,b){var c;if(a.k&&b.k){c=a.k.qa;var d=b.k.qa;(c=c==d?0:c>d?1:-1)||(c=a.k.of,d=b.k.of,c=c==d?0:c>d?1:-1)}else c=0;return c})}function p(a,b){var c=b.uuid;if(c in a.cg){c=a.cg[c];a.ol.set(b.d.e,3*c);a.ml.set(b.Ga.direction,3*c);a.ll.set(b.Ga.Lf,3*c);var d=Xa;s(b.Ga,Ca,d);a.nl.set(d,4*c)}}function v(a){var b=a.Xb.attributes,c=a.ab.Ib,d;for(d in b)if(!c[d])throw'B4W Error: missing data for "'+d+'" attribute';if("MAIN"==a.type||"NODES"==
a.type)b=aa.Pv(a.Xb.wm),10<b&&("MAIN"==a.type&&Y.warn("B4W Warning: Varying limit exceeded for main shader - "+b+', materials: "'+a.tc.join(", ")+'"'),"NODES"==a.type&&(d=c=0,a.zf&&(c=la.Se(a.zf)),a.Qa&&(d=la.Se(a.Qa)),Y.warn("B4W Warning: Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.tc.join(", ")+'"')))}function m(a){8<a.R.length&&Y.warn("B4W Warning: too many textures used - "+a.R.length+' (max 8), materials "'+a.tc.join(", ")+'"')}function x(a,b,c){for(var d=
0,e=ea.Do(a,b),f=0;f<e.length;f++){var g=e[f];"SHADOW_SRC_DEPTH"!=c||"SHADOW_CAST"!=g.type&&"POSTPROCESSING"!=g.type||(g=ea.Wu(a,g,"SHADOW_CAST").h,b.cr=g.ea,b.gn=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.rf=b.rf||[],b.rf[d]=g.ia,d++)}}function t(a,b,c){a.Hb=b.Hb;var d=b.Hb[0],e=b.Hb[1],f=b.Hb[2];c=c.Db;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.Hb[2]=f;b=b.h;D.oq(b,f/2,-e,-d,f/2);D.mg(b);d=a.el||0;d=0==d?c:Math.max(d,c);a.el=d}function z(a,b){for(var c=
a.l,d=0;d<c.length;d++){var e=c[d].k;if(e&&e.id==b.id)return!0}return!1}function e(a){var b=G(a,"MAIN_OPAQUE"),c=!0;I.J(a.d.Ma,function(d,e){"SHADOW_CAST"===e.type&&(B(e,b,e.l,a,c),c=!1)})}function B(b,c,d,e,f){if(0!=d.length){var g=b.h;c=c.h;var h=H(e,"LAMP",a.DATA_ID_ALL),k;a:{for(k=0;k<h.length;k++){var E=h[k];if(E.data.b4w_generate_shadows){k=E;break a}}k=!1}h=(k||h[0]).d;D.rq(g,h.e,h.quat);M.copy(c.Sd,g.Sd);Da.copy(c.ea,g.uq);h=Za;ja.Xc(h);for(k=0;k<d.length;k++)E=d[k].Ua,0==k?ja.Nn(E.Ha,h):
ja.ho(h,E.Ha);d=ja.Ou(h,Ia);la.ce(d,g.ea,d);if(e.d.wc.b4w_enable_csm){e=M.copy(c.$g[b.Dk],va);h=Da.invert(c.ea,sa);la.ce(e,h,e);la.ce(e,g.ea,e);b=c.Ek[b.Dk];if(f)for(Kb=0,f=2;f<d.length;f+=3)Kb=Math.min(Kb,d[f]);f=Za;f.max_x=e[0]+b;f.max_y=e[1]+b;f.max_z=0;f.min_x=e[0]-b;f.min_y=e[1]-b;f.min_z=Kb}else{b=f=Za;c=Zb;c.set(d);e=hb/9;d=Da.identity(sa);Da.rotate(d,e,la.AXIS_MZ,d);k=h=-1;for(E=0;10>E;E++){var m=ja.kt(c,sb),l=(m.max_x-m.min_x)*(m.max_y-m.min_y);if(-1==h||l<h)h=l,k=E,ja.Nn(m,b);la.ce(c,d,
c)}b=k*e;0<b&&(c=Da.identity(sa),Da.rotate(c,b,la.AXIS_MZ,c),Da.multiply(c,g.ea,g.ea));b=f.max_x-f.min_x;c=f.max_y-f.min_y;b&&c&&(e=Math.abs(b-c)/2,2<b/c?(f.max_y+=e,f.min_y-=e):2<c/b&&(f.max_x+=e,f.min_x-=e));f.max_x+=.005;f.max_y+=.005;f.max_z+=.005;f.min_x-=.005;f.min_y-=.005;f.min_z-=.005}D.yx(g,f.min_x,f.max_x,f.min_y,f.max_y,-f.max_z,-f.min_z);D.mg(g);la.lo(g.Cf,g.Wk)}}function A(a,b){for(var c=b.d,d=b.O,e="COLOR_PICKING_XRAY"==a.type,f=0;f<d.length;f++){var g=d[f];if(g.mc==e&&"COLOR_ID"==g.type&&
!z(a,g)){P.T(g,"USE_GLOW",0);P.sb(g);var h={P:!0,Ua:c,k:g};v(g);a.l.push(h)}}}function u(a){var b=la.Yg(a);a.Wa=JSON.parse(JSON.stringify(a.Wa));return b}function s(a,b,c){b[0]=1;b[1]=0;b[2]=0;b[3]=a.Gg?1:0;c[0]=-1;c[1]=-1;c[2]=-1;c[3]=a.Ig?1:0;switch(a.type){case "HEMI":b[0]=.5;b[1]=.5;break;case "POINT":c[2]=a.distance;break;case "SPOT":c[2]=a.distance,b=c[0]=Math.cos(a.Eq/2),c[1]=a.Dq*(1-b)}}function q(a,b){for(var c=F(b,za),d=a.Ga,e=a.d,f=d.index,g=0;g<c.length;g++){var h=c[g];h.cf.set(e.e,3*
f);h.$e.set(d.direction,3*f);h.Ze.set(d.Lf,3*f);var k=Ca,E=Xa;s(d,k,E);switch(d.type){case "SUN":if(h.Oq.set(e.quat),h.Nq=d.Lf,"SKY"===h.type){var m=va;m[0]=m[1]=m[2]=1;var l=Math.acos(M.dot(h.Fj,m)),m=Math.acos(M.dot(d.direction,m));h.hj=Math.floor(l/.025)!=Math.floor(m/.025)?!0:!1;M.copy(d.direction,h.Fj);K(b,h)}else M.copy(d.direction,h.Fj);case "HEMI":case "POINT":case "SPOT":break;default:Y.error("B4W Warning: unknown light type: "+d.type)}h.af.set(k,4*f);h.bf.set(E,4*f);h.ta=!0;for(k=0;k<h.l.length;k++)E=
h.l[k].k,E.cg&&p(E,a)}}function K(a,b){E.Sf(b);if(b.hj)for(var c=F(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY"]),d=0;d<c.length;d++)for(var e=c[d].l,f=0;f<e.length;f++){var g=e[f];g.P&&(g=g.k,P.zt(g)&&E.xy(g))}}function H(b,c,d){if(!b.$a)throw"Access to uninitialized scene";b=b.$a[c];if(d==a.DATA_ID_ALL)return b;c=[];for(var e=0;e<b.length;e++){var f=b[e];f.d.gd==d&&c.push(f)}return c}function y(b){var c=[];b=H(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++)for(var e=b[d].data,f=0;f<e.materials.length;f++){var g=
e.materials[f];-1==c.indexOf(g)&&c.push(g)}return c}function J(a,b,c,d){for(var e=a.d,f=a.camera.d.L,g=0;g<f.length;g++){var h=f[g];D.mg(h,b/c);e.Rl&&D.Nj(h,e.wc)}e.Rl&&(e.ij=!0,G(a,"DEPTH").ta=!0,G(a,"MAIN_BLEND").ta=!0);D.Xq(a.camera);ea.uy(e.Ma,function(e,f,g){if(d||e.Eg){var h=e.ke*b,k=e.ke*c;if(f)for(f=0;f<g.Y.length;f++)g.Y[f]==e&&Ua.resize(e.na,h,k);else Ua.th(e.na)&&Ua.resize(e.na,h,k),e=g.h,e.width=h,e.height=k,"DOF"==g.type&&W(a,{dof_power:g.h.dof_power,dof_on:g.h.dof_on}),r(g,1/b,1/c)}})}
function r(a,b,c){a=a.l;for(var d=0;d<a.length;d++){var e=a[d].k;e&&P.Th(e,b,c)}}function F(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];I.J(a.d.Ma,function(a,b){b.type==e&&c.push(b)})}return c}function G(a,b){return ea.La(a.d.Ma,b)}function W(a,b){var c=G(a,"DOF");if(!c)return Y.error("DOF is not enabled on scene. Check camera settings"),0;var d=a.d.Ma;"boolean"==typeof b.dof_on&&(c.h.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.h.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&
(c.h.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.h.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.h.dof_power=b.dof_power;for(var e=ea.cb(d,c,"POSTPROCESSING"),d=ea.cb(d,e,"POSTPROCESSING"),e=[e,d],d=0;d<e.length;d++){var f=e[d].l[0].k;f&&(P.xf(f,c.h.dof_power),r(e[d],1/c.h.width,1/c.h.height))}}c.ta=!0}function T(a,b){var c=G(ya,"MAIN_OPAQUE");if(!c||!c.Aa)return Y.error("get_water_surface_level() - no water parameters on this scene"),0;var d=c.te,e=c.Df,f=c.se,g=c.Aa;if(!d||
!g.Tf)return g.se;var h=M.length(c.di),k=c.time;h&&(k*=h);var E=rb;E[0]=20/e*(a-.25*k);E[1]=20/e*(b-.25*k);h=la.wn(E);E[0]=17/e*(b+.1*k);E[1]=17/e*(a+.1*k);var E=la.wn(E),h=h+E-1,m=g.dst_noise_scale0,E=g.dst_noise_scale1,l=g.dst_noise_freq0,p=g.dst_noise_freq1,q=rb;q[0]=m*(a+l*k);q[1]=m*(b+l*k);m=la.bm(q);q[0]=E*(b-p*k);q[1]=E*(a-p*k);E=la.bm(q);E*=d*m;if(c.Tj)if(p=(a-c.he[0])/c.ie[0],q=(c.he[1]+b)/c.ie[1],p+=.5,q+=.5,1<p||0>p||1<q||0>q)d=E;else var p=la.yo(ya.d.Xl,c.og,p,q),m=g.dir_freq,r=g.dir_noise_scale,
ea=g.dir_noise_freq,l=g.dir_min_noise_fac,q=g.dst_min_fac,c=e/c.fg/Math.PI,r=[r/e*(a+ea*k),r/e*(b+ea*k)],e=Math.sqrt(p),d=d*Math.max(p,g.dir_min_shore_fac)*Math.sin(e/c+m*k)*Math.max(la.bm(r),l),g=Math.max(e,q),d=d*(1-g)+E*g,h=h*p;else d=E;return f+(d+.05*h)}function S(a,b){a.rh&&"POSTPROCESSING"==a.type&&b.P!=a.P&&(a.P=b.P);b.P||"GLOW"!=a.type||(a.Mk=0)}function R(a,b,c,d){var e=I.Ca(a,b);D.xj(e.h,c,d);e.hk=!0;I.qe(a,b,function(b,e,f){f.wa&&f.F==c&&ea.Gt(f)&&L(a,b,f.U,d)});I.pe(a,b,function(b,e,
f){f.wa&&f.F==c&&f.F==f.U&&R(a,b,c,d)})}function L(a,b,c,d){a=I.Ca(a,b).l;for(b=0;b<a.length;b++)P.hx(a[b].k,d,c)}function O(a){var b=G(a,"GRASS_MAP");if(b){var c=b.h,d=a.camera.d,e=d.e;a=va;a[0]=0;a[1]=-b.Hb[2]/2;a[2]=0;M.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=wa;b[0]=0;b[1]=0;b[2]=0;b[3]=1;D.rq(c,a,b)}}function Q(a,b){I.J(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.Y[0]||!d.Rc[0])throw"Wrong MOTION_BLUR subscene";var e=d.Y[0],f=d.Rc[0];d.Rc[0]=d.h.bb;I.qe(a,c,function(b,c,
d){d.wa&&L(a,b,d.U,f)});R(a,c,e.F,f);L(a,c,e.U,d.Rc[0]);d.up=Math.exp(-b/d.ej)}})}function Z(b,c){var d=0,e=b.Ds;0==e.nm&&(e.nm=c);var f=c-e.nm;if(e.eq&&f/e.Eh>=e.eq)a.clear_glow_anim(b);else{f%=e.Eh;if(f<e.Mo)switch(e=f/(e.Mo/5),f=Math.floor(e),f){case 0:d=(e-f)/2;break;case 1:d=(e-f)/2+.5;break;case 2:d=1;break;case 3:d=1-(e-f)/2;break;case 4:d=.5-(e-f)/2}for(e=0;e<b.O.length;e++)f=b.O[e],"COLOR_ID"==f.type&&(f.$f=d)}}function N(a){I.J(a.d.Ma,function(a,b){b.ta=!0})}function da(a){if("WIND"==a.field.type){a=
a.d;la.quat_to_dir(a.quat,la.AXIS_Y,xa);M.normalize(xa,xa);M.scale(xa,a.Uk,xa);a=Na;for(var b=0;b<a.length;b++)for(var c=F(a[b],$a),d=0;d<c.length;d++)c[d].di.set(xa)}}var P=n("__batch"),ja=n("__boundings"),D=n("__camera"),ga=n("__config"),V=n("__debug"),w=n("__geometry"),I=n("__graph"),ia=n("__hud"),oa=n("__objects");n("__particles");var fa=n("__prerender"),U=n("__primitives"),Y=n("__print"),E=n("__renderer"),ea=n("__scenegraph"),na=n("__sfx"),aa=n("__shaders"),Ua=n("__textures"),la=n("__util"),
M=n("vec3"),Da=n("mat4"),X=ga.n,gb="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),Pa=["ARMATURE","EMPTY","MESH","SPEAKER"],Ha="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GLOW_MASK WIREFRAME".split(" "),za="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED".split(" "),Yb=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],$a="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS GLOW_MASK WIREFRAME".split(" "),
ab=["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_REFLECT"],ya=null,Na=[],xb=[],Jb,Va,hb=Math.PI/2;a.Xj=0;a.Fm=1;a.Gm=2;a.DATA_ID_ALL=-1;var rb=new Float32Array(2),va=new Float32Array(3),Ca=new Float32Array(4),Xa=new Float32Array(4),wa=new Float32Array(4),sa=new Float32Array(16),Ia=new Float32Array(24),Zb=new Float32Array(24),Za=ja.Xc(),sb=ja.Xc(),xa=new Float32Array(3),Kb=null;a.set_active=function(a){ya=a;na.vx(a)};a.Tw=function(a){var b=a.d;if(!a.Om){for(var c=ea.Sn(b.Ma),d=0;d<c.length;d++)b.uf.push(c[d]);
J(a,Jb,Va,!1)}a=F(a,$a);for(c=0;c<a.length;c++)a[c].di.set(xa);for(d=0;d<b.uf.length;d++)"SHADOW_CAST"==b.uf[d].type&&E.Sf(b.uf[d])};a.get_active=b;a.V=c;a.Ki=function(){return Na};a.Mi=function(b,c,d,e){for(var f=Na,h=null,k="",E=0;E<f.length;E++){var m=H(f[E],"ALL",a.DATA_ID_ALL);switch(b){case a.Xj:k=c;h=g(c,m,!1,d);break;case a.Fm:k=d;h=null;(m=g(c,m,!1,e))&&m.dupli_group&&(h=g(d,m.dupli_group.objects,!0,e));break;case a.Gm:for(var k=c[c.length-1],h=null,l=0;l<c.length;l++)if((h=g(c[l],m,0!=l,
d))&&h.dupli_group)m=h.dupli_group.objects;else break}if(h)break}h||Y.warn("get object "+k+": not found");return h};a.Ys=function(a,b,c){for(var e in Pa){var f=Pa[e],g=d(a,f),h=b.d.Jg,k=!1;for(e=0;e<c.length;e++)if(k=!0,c[e].d&&c[e].d.Xi){for(var E=0;E<h.length;E++)h[E]==c[e]&&(k=!1);k&&h.push(c[e])}f in b.$a||(b.$a[f]=[]);for(E=0;E<g.length;E++)la.Xe(g[E])&&g[E].proxy||(b.$a.ALL.push(g[E]),b.$a[f].push(g[E]))}};a.Ss=function(b,c){b.$a={ALL:[]};for(var e in gb){var f=gb[e],g=d(b,f);b.$a[f]=[];for(var k=
0;k<g.length;k++)la.Xe(g[k])&&g[k].proxy||(b.$a.ALL.push(g[k]),b.$a[f].push(g[k]))}b.d=b.d||{};f=b.d;g=b.camera.d;e=b.world.b4w_shadow_settings;k=f.wc={};k.csm_resolution=e.csm_resolution;k.self_shadow_polygon_offset=e.self_shadow_polygon_offset;k.self_shadow_normal_offset=e.self_shadow_normal_offset;k.b4w_enable_csm=e.b4w_enable_csm;k.b4w_enable_csm?(k.csm_num=e.csm_num,k.csm_first_cascade_border=e.csm_first_cascade_border,k.first_cascade_blur_radius=e.first_cascade_blur_radius,k.csm_last_cascade_border=
e.csm_last_cascade_border,k.last_cascade_blur_radius=e.last_cascade_blur_radius,k.fade_last_cascade=e.fade_last_cascade,k.blend_between_cascades=e.blend_between_cascades):(k.csm_num=1,k.csm_first_cascade_border=e.csm_first_cascade_border,k.first_cascade_blur_radius=e.first_cascade_blur_radius,k.csm_last_cascade_border=e.csm_last_cascade_border,k.last_cascade_blur_radius=e.last_cascade_blur_radius,k.fade_last_cascade=!1,k.blend_between_cascades=!1);f.Jg=[];for(e=0;e<c.length;e++)c[e].d&&c[e].d.Xi&&
f.Jg.push(c[e]);e=b.world.b4w_fog_color;f.Eb=new Float32Array([e[0],e[1],e[2],b.world.b4w_fog_density]);a:{if(b.$a)for(e=b.$a.LAMP,k=0;k<e.length;k++)if("SUN"==e[k].Ga.type){e=!0;break a}e=!1}f.Bd=e;e=f.Bd;var k={},E=b.world.b4w_sky_settings;k.procedural_skydome=E.procedural_skydome&&e;k.use_as_environment_lighting=E.use_as_environment_lighting;k.pg=E.color;k.rayleigh_brightness=E.rayleigh_brightness;k.mie_brightness=E.mie_brightness;k.spot_brightness=E.spot_brightness;k.scatter_strength=E.scatter_strength;
k.rayleigh_strength=E.rayleigh_strength;k.mie_strength=E.mie_strength;k.rayleigh_collection_power=E.rayleigh_collection_power;k.mie_collection_power=E.mie_collection_power;k.mie_distribution=E.mie_distribution;!e&&E.procedural_skydome&&Y.warn("B4W Warning: There is no sun on the scene. Procedural sky won't be rendered");f.Uh=k;var m=b.world;e=[0,0,0];var k=[0,0,0],E=m.light_settings,l=m.texture_slots;if(E.use_environment_light)if("SKY_COLOR"==E.environment_color||"SKY_TEXTURE"==E.environment_color)e=
m.horizon_color.slice(0),k=m.zenith_color.slice(0);else if("PLAIN"==E.environment_color)e=[1,1,1],k=[1,1,1];else throw"Unsupported world environment color"+E.environment_color;m={};m.Rd=E.environment_energy;m.hc=e;m.nc=k;m.qg=l;f.mr=m;f.pl=H(b,"LAMP",a.DATA_ID_ALL).length;e=y(b);k=[];E=H(b,"MESH",a.DATA_ID_ALL);for(l=0;l<e.length;l++){var p=e[l];if(p.b4w_water){for(var m={},q=0;q<E.length;q++)for(var r=E[q],I=r.data.materials,t=0;t<I.length;t++)I[t]==p&&(m.se=r.location[1]);if(X.deferred_rendering)for(m.Eb=
p.b4w_water_fog_color.slice(0),m.Eb.push(p.b4w_water_fog_density),p.b4w_water_dynamic?(m.Tf=!0,m.waves_height=p.b4w_waves_height,m.waves_length=p.b4w_waves_length,m.dst_noise_scale0=p.b4w_water_dst_noise_scale0,m.dst_noise_scale1=p.b4w_water_dst_noise_scale1,m.dst_noise_freq0=p.b4w_water_dst_noise_freq0,m.dst_noise_freq1=p.b4w_water_dst_noise_freq1,m.dir_min_shore_fac=p.b4w_water_dir_min_shore_fac,m.dir_freq=p.b4w_water_dir_freq,m.dir_noise_scale=p.b4w_water_dir_noise_scale,m.dir_noise_freq=p.b4w_water_dir_noise_freq,
m.dir_min_noise_fac=p.b4w_water_dir_min_noise_fac,m.dst_min_fac=p.b4w_water_dst_min_fac,m.waves_hor_fac=p.b4w_water_waves_hor_fac):(m.Tf=!1,m.waves_height=0,m.waves_length=0),m.zi=null,m.sk=null,m.tk=new Float32Array(2),m.Aj=null,p=p.texture_slots,q=0;q<p.length;q++)r=p[q].texture,"VORONOI"==r.type&&(m.zi=r.noise_scale,m.tk.set(r.b4w_uv_velocity_trans),m.sk=r.noise_intensity),!0===r.b4w_shore_dist_map&&(m.Aj=r.image,m.og=r.image.size[0],m.Mx=r.b4w_shore_boundings,m.fg=r.b4w_max_shore_dist);else m.waves_height=
0,m.waves_length=0,m.zi=null,m.sk=null,m.tk=null,m.Eb=null,m.Tf=!1;k.push(m)}}if(0<k.length){m=k[0];if(!m.Tf)for(l=0;l<k.length;l++)k[l].Tf&&(m=k[l]);e=m}else e=null;f.Aa=e;a:{e=H(b,"MESH",a.DATA_ID_ALL);for(k=0;k<e.length;k++)if(e[k].d.Kc){e=!0;break a}e=!1}f.xk=e||X.force_selectable;a:{e=H(b,"MESH",a.DATA_ID_ALL);for(k=0;k<e.length;k++)for(E=e[k].data.materials,l=0;l<E.length;l++)if(m=E[l],q=m.game_settings.alpha_blend,m.b4w_render_above_all&&"OPAQUE"!=q&&"CLIP"!=q){e=!0;break a}e=!1}f.mc=e;f.zp=
0;if(X.deferred_rendering){e=b.Om;f.Rl=h(b);f.hA=b.world.b4w_fog_color;a:{if(X.shore_smoothing)for(k=y(b),E=0;E<k.length;E++)if(l=k[E],l.b4w_water&&l.b4w_water_shore_smoothing){k=!0;break a}k=!1}f.shore_smoothing=k;if(X.vj&&b.b4w_render_reflections)for(k=[],E=H(b,"MESH",a.DATA_ID_ALL),l=0;l<E.length;l++){if(m=E[l],m.b4w_reflective){b:{m=m.constraints;for(q=0;q<m.length;q++)if(p=m[q],"LOCKED_TRACK"==p.type&&"REFLECTION PLANE"==p.name){q=p.target;break b}q=null}q&&(m=q.location,q=q.d.quat,p=new Float32Array(4),
la.ty(m,q,la.AXIS_Y,p),k.push(p))}}else k=!1;f.ax=k;k={};E=b.world.b4w_bloom_settings;k.blur=E.blur;k.Iu=E.edge_lum;k.key=E.key;f.nt=k;k={};E=b.world.b4w_motion_blur_settings;k.dj=E.motion_blur_decay_threshold;k.ej=E.motion_blur_factor;f.Aw=k;k={};E=b.world.b4w_color_correction_settings;k.brightness=E.brightness;k.contrast=E.contrast;k.exposure=E.exposure;k.saturation=E.saturation;f.yt=k;k={};E=b.world.b4w_god_rays_settings;k.gw=E.intensity;k.eg=E.max_ray_length;k.wg=E.steps_per_pass;f.Wv=k;k={};
E=b.world;k.oh=E.b4w_glow_color;k.Oi=E.b4w_glow_factor;f.Tv=k;f.Rf=X.Rf&&(0<g.dof_distance||g.Me);a:{if(X.xa)for(E=k=!1,l=H(b,"MESH",a.DATA_ID_ALL),m=0;m<l.length;m++){p=l[m];r=p.data.materials;for(q=0;q<r.length;q++)r[q].b4w_terrain&&(k=!0);p=p.particle_systems;for(q=0;q<p.length;q++)r=p[q].settings,"HAIR"==r.type&&r.b4w_dynamic_grass&&(E=!0);if(k&&E){k=!0;break a}}k=!1}f.xa=k;f.gg=X.gg&&b.b4w_enable_motion_blur;f.Nf=X.Nf&&b.b4w_enable_color_correction;f.antialiasing=X.antialiasing&&b.b4w_enable_antialiasing;
f.If=X.If&&b.b4w_enable_bloom&&f.Bd;f.yf=X.yf&&b.b4w_enable_ssao;k={};E=b.world.b4w_ssao_settings;k.radius_increase=E.radius_increase;k.bw=E.hemisphere;k.ot=E.blur_depth;k.ln=E.blur_discard_value;k.influence=E.influence;k.dist_factor=E.dist_factor;k.lx=E.samples;f.cy=k;f.ag=X.ag&&b.b4w_enable_god_rays&&f.Bd;f.jg=X.jg&&b.b4w_render_refractions;f.glow=X.glow?f.xk:!1;f.Ma=ea.fu(e,f,g)}else f.Ma=ea.gu(g,f);f.uf=[];f.ij=!1;f.Cl=!1;Na.push(b)};a.yk=d;a.bl=function(a){return a.d.Ma};a.ev=function(a){I.J(a,
function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=P.Rn(c.Hh);break;case "SSAO":d=P.nu(c);break;case "SSAO_BLUR":d=P.ou(c);P.Th(d,1/c.h.width,1/c.h.height);break;case "DEPTH_PACK":d=P.Xt();break;case "REFRACT":case "SCREEN":d=P.Rn("NONE");break;case "GOD_RAYS":ea.cb(a,c,"WIREFRAME")||ea.cb(a,c,"MAIN_BLEND")||ea.cb(a,c,"GOD_RAYS");d=P.$t(c.Qp|0,(c.gb&&c.re)|0,c.wg);break;case "GOD_RAYS_COMBINE":ea.cb(a,c,"WIREFRAME")||ea.cb(a,c,"MAIN_BLEND");ea.cb(a,c,"GOD_RAYS");d=P.au();break;case "MOTION_BLUR":d=
P.eu(c.dj);break;case "DOF":d=P.Yt();P.xf(d,c.h.dof_power);for(var e=ea.cb(a,c,"POSTPROCESSING"),f=ea.cb(a,e,"POSTPROCESSING"),g=[e,f],h=0;h<g.length;h++){var E=g[h].l;(e=E[0].k)&&P.xf(e,c.h.dof_power)}break;case "GLOW":g=ea.cb(a,c,"POSTPROCESSING");h=ea.cb(a,g,"POSTPROCESSING");e=ea.cb(a,h,"POSTPROCESSING");f=ea.cb(a,e,"POSTPROCESSING");d=P.Zt();g=[h,g];for(h=0;h<g.length;h++)E=g[h].l,(E=E[0].k)&&P.xf(E,c.mn);g=[f,e];for(h=0;h<g.length;h++)E=g[h].l,(E=E[0].k)&&P.xf(E,c.ko*c.Oi);break;case "COMPOSITING":d=
P.Vt();break;case "ANTIALIASING":d=P.Rt();break;case "LANCZOS":d=P.bu(c.TA);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=P.lu(c.type);break;case "ANAGLYPH":d=P.Qt();break;case "SKY":d=P.ku();P.Th(d,1/c.h.width,1/c.h.height);break;case "LUMINANCE":d=P.cu();break;case "AVERAGE_LUMINANCE":d=P.St();break;case "LUMINANCE_TRUNCED":d=P.du();break;case "BLOOM_BLUR":d=P.Tt(c.Hh);P.Th(d,1/c.h.width,1/c.h.height);break;case "BLOOM":d=
ea.cb(a,c,"BLOOM_BLUR");g=[ea.cb(a,d,"BLOOM_BLUR"),d];for(h=0;h<g.length;h++)E=g[h].l,(E=E[0].k)&&P.xf(E,c.bloom_blur);d=P.Ut();break;case "VELOCITY":d=P.ru()}d&&(e={P:!0,Ua:oa.Di("NONE"),k:d},v(d),c.l.push(e),k(a,c,d),m(d))})};a.append_object=function(a,b){switch(b.type){case "MESH":var c=a.d.Ma,d=b.d;!ea.La(c,"SHADOW_CAST")&&d.rb&&(d.rb=!1);for(var d=F(a,Ha),e=0;e<d.length;e++){var g=d[e],h=b,E=c,l=a;switch(g.type){case "MAIN_OPAQUE":f(g,h,E,"OPAQUE",l);break;case "MAIN_BLEND":f(g,h,E,"BLEND",l);
break;case "MAIN_XRAY":f(g,h,E,"XRAY",l);break;case "MAIN_REFLECT":E=h.d;h=h.O;for(l=0;l<h.length;l++){var p=h[l],r=u(p);if(!("MAIN"!=r.type&&"NODES"!=r.type&&"PARTICLES"!=r.type||z(g,r)||r.qa)&&r.Vb){var I=r.Wa;aa.I(I,"DISABLE_FOG",0);aa.I(I,"WATER_EFFECTS",0);"special_skydome.glslf"==aa.Bo(I)&&aa.I(I,"REFLECTION_PASS",1);aa.I(I,"SHADOW_SRC","SHADOW_SRC_NONE");aa.I(I,"TEXTURE_NORM",0);P.sb(r);I={P:!0,Ua:E,k:r};v(r);g.l.push(I);"MAIN"==r.type&&(p.vb||(p.vb=[]),p.vb.push(r))}}break;case "DEPTH":p=
h.d;h=h.O;for(r=0;r<h.length;r++){var w=h[r];if("DEPTH"==w.type&&!z(g,w)&&!w.Mb){if(ea.aw(E,g,"SHADOW_CAST"))if(w.rb){switch(X.ge){case "DEPTH":var I="SHADOW_SRC_DEPTH",s="SHADOW_DST_MASK";break;default:throw"Wrong shadows type";}w=P.rm(w,I,s);P.gk(w,l.d.wc);ea.Do(E,g);x(E,g,I)}else w=P.rm(w,"SHADOW_SRC_NONE","SHADOW_DST_MASK");else w=P.rm(w,"SHADOW_SRC_NONE","SHADOW_DST_NONE");w.xa&&(I=ea.La(E,"GRASS_MAP"))&&t(w,I,p);P.sb(w);I={P:!0,Ua:p,k:w};v(w);g.l.push(I);k(E,g,w);m(w)}}break;case "SHADOW_CAST":p=
!1;r=h.d;h=h.O;for(I=0;I<h.length;I++)if(w=h[I],w.Lb||w.rb)if(p=!0,"DEPTH"==w.type&&!z(g,w)&&w.Lb){switch(X.ge){case "DEPTH":s="SHADOW_DST_DEPTH";break;default:throw"Wrong shadows type";}w=P.ju(w,s);w.xa&&(s=ea.La(E,"GRASS_MAP"))&&t(w,s,r);P.T(w,"SHADOW_TEX_RES",aa.u(l.d.wc.csm_resolution));P.sb(w);s={P:!0,Ua:r,k:w};v(w);g.l.push(s)}p&&B(g,ea.La(E,"MAIN_OPAQUE"),g.l,l,!0);break;case "COLOR_PICKING":A(g,h);break;case "COLOR_PICKING_XRAY":A(g,h);break;case "GRASS_MAP":E=h.d;h=h.O;for(l=0;l<h.length;l++)p=
h[l],"GRASS_MAP"!=p.type||z(g,p)||(P.sb(p),r={P:!0,Ua:E,k:p},v(p),g.l.push(r),p=g.h,s=E.Ha,r=g.Hb[0],I=g.Hb[1],w=g.Hb[2],0==r&&0==I?(r=s.min_y,I=s.max_y):(r=Math.min(r,s.min_y),I=Math.max(I,s.max_y)),s=1E-4*(I-r),g.Hb[0]=r-s,g.Hb[1]=I+s,D.oq(p,w/2,-I,-r,w/2),D.mg(p));break;case "GLOW_MASK":E=h.d;h=h.O;for(l=0;l<h.length;l++)p=h[l],"COLOR_ID"!=p.type||z(g,p)||(r=u(p),P.T(r,"USE_GLOW",1),P.sb(r),h.push(r),I={P:!0,Ua:E,k:r},v(r),g.l.push(I),p.vb||(p.vb=[]),p.vb.push(r));break;case "WIREFRAME":for(l=
h.d,h=h.O,p=0;p<h.length;p++)r=h[p],"WIREFRAME"!=r.type||z(g,r)||(r.xa&&(I=ea.La(E,"GRASS_MAP"))&&t(r,I,l),P.sb(r),I={P:!0,Ua:l,k:r},v(r),g.l.push(I),k(E,g,r),m(r))}}break;case "LAMP":b.Ga.index=a.d.zp++;c=F(a,za);for(d=0;d<c.length;d++)c[d].mf++;q(b,a)}};a.yA=z;a.Ul=function(a){a.d.ij=!0};a.Av=function(a,b){for(var c=a.d.wc,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=D.tu(c,b,e);return d};a.hide_object=function(a){a.d.ph=!0};a.show_object=function(a){a.d.ph=!1};a.ex=function(a,b){for(var c=
b.d,d=F(a,Ha),e=0;e<d.length;e++)for(var f=d[e].l,g=f.length-1;0<=g;g--){var h=f[g];h.Ua==c&&(h.k&&w.En(h.k.ab),f.splice(g,1))}};a.check_object=function(a,b){return b.$a[a.type]&&-1<b.$a[a.type].indexOf(a)?!0:!1};a.Sx=function(a){var b=a.$a.LAMP;if(b.length==a.d.zp){for(var c=[],d=0;d<b.length;d++)c[b[d].Ga.index]=d;for(d=0;d<c.length-1;d++)for(var e=d+1;e<c.length;e++){var f=b[c[d]].Ga,g=b[c[e]].Ga;if(g.Gg&&g.Ig&&(!f.Gg||!f.Ig)||!f.Gg&&(g.Gg||!f.Ig&&g.Ig))f=c[d],c[d]=c[e],c[e]=f}for(d=0;d<c.length;d++)b[c[d]].Ga.index=
d,q(b[c[d]],a)}};a.Oj=q;a.cleanup=function(){for(var a=0;a<Na.length;a++){var b=Na[a];I.J(b.d.Ma,function(a,b){if("SINK"!=b.type){var c=b.h;E.fx(c.Td,c.bb,c.gc,c.width,c.height);for(var c=b.l,d=0;d<c.length;d++){var e=c[d].k;e&&P.It(e)}}});b.d.Ma=[];b.d.uf=[]}ya=null;Na.length=0;xb.length=0;xa[0]=0;xa[1]=0;xa[2]=0};a.qp=function(a,b,c){a=D.Pu(a,a.Da,a.Ka,null,!0);var d=U.iv(a);a=oa.Di("DYNAMIC");a.Ha=a.Db={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.jb=a.rc=ja.mt();var e=
a.jb.ma;a.Fe=a.Ee=ja.Bk([e,0,0],[0,e,0],[0,0,e],a.jb.t);c=P.iu(d,c);b.l.push({P:!0,Ua:a,k:c})};a.la=H;a.Iv=function(a){return[a.frame_start,a.frame_end]};a.sq=function(a,b){Jb=a;Va=b;ya&&J(ya,a,b,!1)};a.Th=r;a.jy=F;a.ga=G;a.get_environment_colors=function(a){a=F(a,za)[0];var b=a.hc,c=a.nc,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.Rd,d,e]};a.set_environment_colors=function(a,b,c,d){a=F(a,za);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.Rd=b);c&&f.hc.set(c);
d&&f.nc.set(d);f.ta=!0}};a.get_sky_params=function(a){if(a=G(a,"SKY")){var b={};b.color=Array(3);M.copy(a.pg,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=
a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,c){for(var d=F(a,["SKY"]),e=0;e<d.length;e++){var f=d[e];"number"==typeof c.procedural_skydome&&(f.procedural_skydome=c.procedural_skydome);"number"==typeof c.use_as_environment_lighting&&(f.use_as_environment_lighting=c.use_as_environment_lighting);"object"==typeof c.color&&f.pg.set(c.color);"number"==typeof c.rayleigh_brightness&&(f.rayleigh_brightness=c.rayleigh_brightness);"number"==
typeof c.mie_brightness&&(f.mie_brightness=c.mie_brightness);"number"==typeof c.spot_brightness&&(f.spot_brightness=c.spot_brightness);"number"==typeof c.scatter_strength&&(f.scatter_strength=c.scatter_strength);"number"==typeof c.rayleigh_strength&&(f.rayleigh_strength=c.rayleigh_strength);"number"==typeof c.mie_strength&&(f.mie_strength=c.mie_strength);"number"==typeof c.rayleigh_collection_power&&(f.rayleigh_collection_power=c.rayleigh_collection_power);"number"==typeof c.mie_collection_power&&
(f.mie_collection_power=c.mie_collection_power);"number"==typeof c.mie_distribution&&(f.mie_distribution=c.mie_distribution);f.ta=!0;f.hj=!0;K(b(),f);E.Sf(f)}};a.get_fog_color_density=function(a,b){var c=b||[],d=F(a,Yb)[0].Eb;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=F(a,Yb),d=0;d<c.length;d++){var e=c[d];e.Eb.set(b);e.ta=!0}};a.get_ssao_params=function(a){var b=G(a,"SSAO");a=G(a,"SSAO_BLUR");if(!b)return null;var c=b.l[0].k,d={};d.ssao_quality=
P.eb(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.ln=a.ssao_blur_discard_value;d.radius_increase=b.tg;d.influence=b.sg;d.dist_factor=b.rg;d.ssao_only=b.ssao_only;d.ssao_white=P.eb(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=G(a,"SSAO"),d=G(a,"SSAO_BLUR");if(!c)return Y.error("SSAO is not enabled on scene"),0;if("string"==typeof b.ssao_quality){var e=c.l[0].k;P.T(e,"SSAO_QUALITY",b.ssao_quality);P.sb(e,!0)}"number"==typeof b.ssao_hemisphere&&
(e=c.l[0].k,P.T(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),P.sb(e,!0));"number"==typeof b.ssao_blur_depth&&(e=d.l[0].k,P.T(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),P.sb(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.tg&&(c.tg=b.tg);"number"==typeof b.sg&&(c.sg=b.sg);"number"==typeof b.rg&&(c.rg=b.rg);if("number"==typeof b.ssao_only){c=G(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var f=0;f<c.l.length;f++)e=c.l[f].k,P.T(e,"SSAO_ONLY",
b.ssao_only),P.sb(e,!0)}"number"==typeof b.ssao_white&&(e=c.l[0].k,P.T(e,"SSAO_WHITE",b.ssao_white),P.sb(e,!0));c.ta=!0;d.ta=!0};a.get_dof_params=function(a){a=G(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.h.dof_distance;b.dof_front=a.h.dof_front;b.dof_rear=a.h.dof_rear;b.dof_power=a.h.dof_power;return b};a.set_dof_params=W;a.get_god_rays_params=function(a){var b=F(a,["GOD_RAYS"]);a=G(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].eg;c.god_rays_intensity=
a.god_rays_intensity;c.god_rays_steps=P.eb(b[0].l[0].k,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=F(a,["GOD_RAYS"]),d=G(a,"GOD_RAYS_COMBINE");if(!c||!d)return Y.error("God Rays are not enabled on scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].eg=e,c[f].uj=e/c[f].wg/(f+1),c[f].ta=!0;if("number"==typeof b.god_rays_steps)for(var g=
aa.u(b.god_rays_steps,1),e=c[0].eg,f=0;f<c.length;f++){c[f].wg=g;c[f].uj=e/g/(f+1);c[f].ta=!0;var h=c[f].l[0].k;P.T(h,"STEPS_PER_PASS",g);P.sb(h,!0)}d.ta=!0};a.get_bloom_params=function(a){var b=G(a,["LUMINANCE_TRUNCED"]);a=G(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=function(a,b){var c=G(a,"LUMINANCE_TRUNCED"),d=G(a,"BLOOM");if(!c||!d)return Y.error("Bloom is not enabled on scene"),0;
"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.ta=!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.ta=!0);if("number"==typeof b.bloom_blur)for(var e=a.d.Ma,c=ea.cb(e,d,"BLOOM_BLUR"),e=ea.cb(e,c,"BLOOM_BLUR"),c=[c,e],e=0;e<c.length;e++){var f=c[e].l[0].k;f&&(P.xf(f,b.bloom_blur),r(c[e],1/d.h.width,1/d.h.height))}};a.get_wind_params=function(){var a=xa,b=M.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};
a.set_wind_params=function(b,c){for(var d=H(b,"ALL",a.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if("EMPTY"===f.type&&f.field&&"WIND"===f.field.type)var g=f}if(!g)return Y.error("There is no wind on the scene"),0;d=g.d;"number"==typeof c.wind_dir&&(va=[0,c.wind_dir/180*Math.PI,-Math.PI/2],la.euler_to_quat(va,wa),d.quat.set(wa),da(g));"number"==typeof c.wind_strength&&(d.Uk=c.wind_strength,da(g));N(b)};a.qx=function(a){a.d.Cl=!0};a.get_water_surface_level=T;a.get_water_mat_params=function(a,b){var c=
G(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.te,b.waves_length=c.Df,c.xc)){b.water_fog_density=c.xc[3];var d=b.water_fog_color=[];d[0]=c.xc[0];d[1]=c.xc[1];d[2]=c.xc[2]}};a.set_water_params=function(a,b){var c=G(a,"MAIN_OPAQUE");if(!c||!c.Aa)return Y.error("set_water_params() - no water parameters on this scene"),null;c=c.Aa;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&
(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&
(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.Tf=b.water_dynamic);for(var d=F(a,ab),e=0;e<d.length;e++){var f=d[e];"number"==typeof b.water_fog_density&&c.Eb&&(f.xc[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.Eb&&f.xc.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.te=b.waves_height);"number"==typeof b.waves_length&&(f.Df=b.waves_length);f.ta=!0}};a.get_shore_dist=function(a,b){var c=
G(ya,"MAIN_OPAQUE");if(!c.Tj)return 100;var d=c.fg,e=c.se,f=(a[0]-c.he[0])/c.ie[0],g=(c.he[1]+a[2])/c.ie[1],f=f+.5,g=g+.5;if(1<f||0>f||1<g||0>g)e=1;else return c=d*la.yo(ya.d.Xl,c.og,f,g),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,c){for(var d=b().camera.d,f=0;f<Na.length;f++){var g=Na[f],h=g.d.Ma;if(g.d.Aa)var k=d.e[1]-T(d.e[0],d.e[2]);for(var m=g.d.Jg,l=0;l<m.length;l++){var p=m[l].d.Ra,q=m[l].d.Vk+m[l].d.ob;if(p){var r=m[l].d,ea=Math.round(p.currentTime*r.ih),w=r.ob/r.ih;if(ea<r.ob-
(X.Ye?5:0)||m[l].d.Zh&&ea>q)p.currentTime=w;!m[l].d.Zh&&ea>q&&p.pause();2<=p.readyState&&Ua.My(r)}}I.J(h,function(b,c){-1<$a.indexOf(c.type)&&(c.time=a);-1<ab.indexOf(c.type)&&g.d.Aa&&(c.rk=k)})}if(X.deferred_rendering)for(f=0;f<xb.length;f++)Z(xb[f],a);for(f=0;f<Na.length;f++)if(g=Na[f],l=g.d,d=l.uf,l.ij&&(e(g),l.ij=!1),l.Cl&&(O(g),l.Cl=!1),d.length){g.b4w_enable_motion_blur&&Q(l.Ma,c);if(X.deferred_rendering&&l.glow){for(var h=G(g,"GLOW_MASK").l,t=0,l=0;l<h.length;l++)t+=h[l].k.$f;I.J(g.d.Ma,function(a,
b){"GLOW"===b.type&&(b.Mk=t)})}h=null;for(l=0;l<d.length;l++)"GLOW_MASK"==d[l].type&&(h=l);for(l=0;l<d.length;l++)m=d[l],fa.Nl(m),null!==h&&S(m,d[h]),E.Sf(m)}X.show_hud_debug_info&&ia.Nx(Na,c)};a.$k=function(a){var b=[];I.J(a.d.Ma,function(a,c){b.push(c)});return b};a.apply_glow_anim=function(a,b,c,d){a.Ds={nm:0,Mo:b,Eh:c,eq:d};-1==xb.indexOf(a)&&xb.push(a)};a.clear_glow_anim=function(a){if(a.O)for(var b=0;b<a.O.length;b++){var c=a.O[b];"COLOR_ID"==c.type&&(c.$f=0)}a=xb.indexOf(a);-1!=a&&xb.splice(a,
1)};a.Oz=function(){xb=[]};a.get_cam_water_depth=function(){var a=G(ya,"MAIN_BLEND"),b=ya;return a||b.d.Aa?a.rk:null};a.get_object_data_id=function(a){return a.d.gd};a.$q=N;a.Jx=function(a,b){switch(b){case "WM_NONE":a.P=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.l.length;c++)a.l[c].k.wireframe_mode=V.Lm[b];a.P=!0}a.qa="WM_TRANSPARENT_WIREFRAME"==b;a.ta=!0};a.Ix=function(a,b){for(var c=0;c<a.l.length;c++)a.l[c].k.wireframe_edge_color=
b,a.ta=!0};a.Um=function(a,b){for(var c=0;c<b.length;c++)a.$a.ALL.push(b[c]),a.$a.MESH.push(b[c])};a.Zq=da;a.pick_object=function(d,e){if(!c())return Y.error("No active scene"),null;var f=b(),g=G(f,"COLOR_PICKING");if(g){fa.Nl(g);E.Sf(g);var h=G(f,"COLOR_PICKING_XRAY");h?(fa.Nl(h),E.Sf(h),g=h.h):g=g.h;e=g.height-e;g=E.Zw(g.Td,d,e);f=H(f,"MESH",a.DATA_ID_ALL);for(h=0;h<f.length;h++){var k=f[h].Nm;if(k&&5>Math.abs(255*k[0]-g[0])&&5>Math.abs(255*k[1]-g[1])&&5>Math.abs(255*k[2]-g[2]))return f[h]}}else Y.error("Color picking is not available");
return null};a.Rv=function(){return xa};a.Jv=function(b){var c=[];b=H(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++){var e=b[d];e.d.Kc&&c.push(e)}return c}};b4w.module.__physics=function(a,n){function b(a,c){for(var d=a.Dd,e=0;e<d.length;e++)d[e].d.Qj&&c.push(d[e]),b(d[e],c)}function c(a,b){if(Q)switch(a){case y.yr:K.log(b);break;case y.vr:K.error(b);break;case y.wr:H.fbmsg.apply(this,b.slice(1));break;case y.Cr:var c=g(b.body_id);if(c){var d=b.trans,e=b.quat,f=b.linvel,h=b.angvel,c=c.j;c.Fk=b.time;F.Sh(d,1,e,c.Gk);T.copy(f,c.np);T.copy(h,c.Wm)}break;case y.Ar:(d=g(b.chassis_hull_body_id))&&F.Sh(b.trans,1,b.quat,d.f.Jh[b.prop_ind]);break;case y.xr:if(c=
g(b[1]))d=b[4],c=c.qc.ti[b[2]],r.set_translation(c,b[3]),r.set_rotation(c,d),r.v(c);break;case y.Dr:if(c=g(b[1]))c.f.speed=b[2];break;case y.tr:for(var d=b.body_id_a,c=b.body_id_b,e=b.result,f=b.coll_point,d=parseInt(d),h=Q.j.l,k=0;k<h.length;k++)for(var m=h[k].fb,l=0;l<m.Cc.length;l++){for(var p=m.Cc[l],q=p.nj,w=!1,t=0;t<q.length;t++){var v=q[t];if(v[0]===d&&v[1]===c){p.Tp[t]=e;w=!0;break}}if(w){q=p.Tp;for(t=w=0;t<q.length;t++)w=w||q[t];p.callback(w,f)}}break;case y.ur:if(c=g(b[1]))c=c.j,c.Bi&&c.Bi(b[2]);
break;case y.Br:if(c=g(b.body_id))for(c=c.j,e=b.from,f=b.to,h=b.local,k=b.body_id_b_hit,m=b.cur_result,l=0;l<c.de.length;l++)if(q=c.de[l],G.Ai(q.F,e)&&G.Ai(q.U,f)&&q.local==h){for(d in q.wd)q.wd[d]=1;-1!=k&&(q.wd[k]=m);for(var p=q.Ob,t=q.callback,q=q.wd,w=!1,v=1,s=0;s<Q.j.l.length;s++){var x=Q.j.l[s].fb;if(("ANY"==p||x.id==p)&&x.D in q&&1!==q[x.D]){w=!0;v=q[x.D];break}}t(w,v)}break;case y.zr:console.log("Physics message ping: ",performance.now()-b[1]);break;default:K.error("Wrong message: "+a)}}function g(a){return N[a]||
null}function d(){da.body++;return da.body}function l(a){return{D:a,wl:0,Vi:!1,je:!0,QA:!1,is_character:!1,kw:!1,Ci:null,id:"",Qz:{},Cc:[],Bi:null,de:[],Fk:0,Gk:new Float32Array([0,0,0,1,0,0,0,1]),np:new Float32Array(3),Wm:new Float32Array(3),xi:new Float32Array(3),wi:new Float32Array(4)}}function h(a,b){switch(a){case "BOX":var c=b.Db;break;case "CYLINDER":c=b.lk;break;case "CONE":c=b.kk;break;case "SPHERE":c=b.rc;break;case "CAPSULE":c=b.jk}return c}function k(a){if(!a)return null;var b={};"number"===
typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.t&&(b.center=a.t);"number"===typeof a.ma&&(b.radius=a.ma);"number"===typeof a.height&&(b.height=a.height);return b}function f(a,b,c,d){var e=a.d.e,f=b.d.G,g=new Float32Array(16);R.invert(f,g);f=new Float32Array(3);T.transformMat4(e,
g,f);switch(b.f.type){case 10:b=b.b4w_vehicle_settings;a=a.d.Db;y.m(y.Fr,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:y.m(y.Er,c,f,a.rB)}}function p(a){return a.j&&a.j.Ci?!0:!1}function v(a,b,c,d,e,f,g,h,k,m){var l;da.Mn++;l=da.Mn.toString(16);y.m(y.Mr,l,a,h,b.j.D,c,d,e.j.D,f,g,k,m);b.j.Ci=l}function m(a){var b=a.j;if(b&&(0===b.wl||!0===b.Vi||!1===b.je||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.e[0]!=a.j.xi[0]||a.d.e[1]!=a.j.xi[1]||a.d.e[2]!=a.j.xi[2]||
a.d.quat[0]!=a.j.wi[0]||a.d.quat[1]!=a.j.wi[1]||a.d.quat[2]!=a.j.wi[2])){a.j.xi.set(a.d.e);a.j.wi.set(a.d.quat);var b=a.j,c=y.Eo(y.Ef);c.msg_id=y.Ef;c.body_id=a.j.D;c.trans=a.d.e;"DYNAMIC"===b.type?(c.quat=ja,S.identity(ja)):c.quat=a.d.quat;y.m(y.Ef,c)}a=a.Dd;for(b=0;b<a.length;b++)m(a[b])}function x(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.quat;e[0]=b;e[1]=c;e[2]=d;T.transformQuat(e,a,e)}function t(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.j.l.length;e++){var f=
b.j.l[e];if("ANY"==a||f.fb.id==a)f=f.fb.D,c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function z(a,b){y.m(y.yc,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=G.Zm(e.F)+G.Zm(e.U)+String(e.local);c[f]=c[f]||{F:e.F,U:e.U,local:e.local,nn:[]};var g=c[f].nn,h;for(h in e.wd)-1==g.indexOf(h)&&g.push(h)}for(f in c)d=c[f].F,e=c[f].U,h=c[f].local,g=c[f].nn,y.m(y.Jm,a,d,e,h,g)}else y.m(y.Jm,a,null,null,!1,null)}function e(a,b){if(b.vg){var c=a.j.D,d=b.Vf*b.ro,e=b.Vg*b.pn,f=-b.ug*b.hm*2*Math.PI/
b.Hq;b.cp&&(f*=-1);switch(b.type){case 10:y.m(y.yc,c);y.m(y.ts,c,d,e,f);break;case 20:y.m(y.yc,c),y.m(y.ss,c,d,e,f)}}}function B(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function A(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function u(a){return a.b4w_character?!0:!1}function s(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}n("__camera");var q=n("__config");n("__constraints");var K=n("__print"),H=n("__debug"),y=n("__ipc");
n("__renderer");var J=n("__scenes"),r=n("__transform"),F=n("__tsr"),G=n("__util"),W=n("__version"),T=n("vec3"),S=n("quat"),R=n("mat4"),L=q.fb,O=q.n,Q=null,Z=[],N=[],da={lr:0,body:0,Mn:0,shape:0},P=new Float32Array(3),ja=new Float32Array(4),D=new Float32Array(4),ga=new Float32Array(16),V=new Float32Array(8),w=new Float32Array(8);a.ew=function(a){if(L.enabled){var b=L.Fg+W.timestamp();K.log("%cLOAD PHYSICS","color: #0a0",b,"Max FPS: "+L.$d);b=new Worker(b);y.init(b,c);y.m(y.bs,a,L.$d)}};a.an=function(a){var b;
da.lr++;b=da.lr;y.m(y.Rr,b);a.j={};a.j.dz=b;a.j.l=[]};a.cleanup=function(){if(L.enabled){y.m(y.Xr);Q=null;Z.length=0;N.length=0;for(var a in da)da[a]=0}};a.append_object=function(a,c){Q=c;y.m(y.gs,c.j.dz);var g=a.d;if(!g)throw"No object render: "+a.name;if(a.parent&&g.Qj)return null;var m=[];g.Qj&&b(a,m);for(var q=a.O||[],r=0;r<q.length;r++){var E=q[r],ea;if(ea="PHYSICS"==E.type){var w;a:{for(var t=c.j.l,x=0;x<t.length;x++){var n=t[x].k;if(n&&n.id==E.id){w=!0;break a}}w=!1}ea=!w}if(ea)if(E.Zb.C)if(E.re&&
c.d.Aa){var V=E;y.m(y.Qr);var z=Q,X=J.ga(z,"MAIN_OPAQUE");if(X.Aa&&V.Zy){var F={};F.dst_noise_scale0=V.dst_noise_scale0;F.dst_noise_scale1=V.dst_noise_scale1;F.dst_noise_freq0=V.dst_noise_freq0;F.dst_noise_freq1=V.dst_noise_freq1;F.dir_min_shore_fac=V.dir_min_shore_fac;F.dir_freq=V.dir_freq;F.dir_noise_scale=V.dir_noise_scale;F.dir_noise_freq=V.dir_noise_freq;F.dir_min_noise_fac=V.dir_min_noise_fac;F.dst_min_fac=V.dst_min_fac;F.waves_hor_fac=V.waves_hor_fac;var H=X.te,W=X.Df,L=X.se;X.Tj?y.m(y.Im,
F,X.ie[0],X.ie[1],X.he[0],X.he[1],X.fg,H,W,L,X.og,z.d.Xl):y.m(y.Im,F,0,0,0,0,0,H,W,L,0,null)}}else{var O;if(E.Py){var P=a,da=E,ya=d(),Na=da.Zb;y.m(y.Or,ya,Na.r[0].a_position,Na.X||null,P.d.e,da.Hn,da.In);var ja=l(ya);ja.Vi=!0;O=ja}else{var Jb=a,Va=E,hb=d(),rb=Va.Zb;y.m(y.Pr,hb,rb.r[0].a_position,rb.X||null,Jb.d.e,Va.lh,Va.fh,Va.Hn,Va.In);O=l(hb)}var va=O;va.id=E.Ob;var Ca={k:E,fb:va};c.j.l.push(Ca)}else K.error("Object "+a.name+" has collision material with no assigned vertices")}if(B(a)||A(a)||u(a)||
s(a)||a.b4w_collision){var Xa=a,wa=g.Vp,sa=Xa.d,Ia=Xa.game,Zb=d();if("CAMERA"==Xa.type)var Za=Ia.use_collision_bounds?Ia.collision_bounds_type:"BOX",sb=h(Za,sa),xa=sa.lh,Kb=sa.fh,xa=.5,Kb=0;else"EMPTY"==Xa.type?(Za="EMPTY",sb=null,Kb=xa=0):(Za=Ia.use_collision_bounds?Ia.collision_bounds_type:"BOX",sb=h(Za,sa),xa=sa.lh,Kb=sa.fh);var Lb=sa.e,bd=sa.quat,Sc=Ia.use_ghost,cd=Ia.use_sleep,Tc=Ia.mass,uc=Ia.velocity_min,lb=Ia.velocity_max,Ya=Ia.damping,yb=Ia.rotation_damping,dc=Ia.collision_group,Mb=Ia.collision_mask,
Ub=sa.rc.ma,Vb=k(sb),lc=Xa.b4w_correct_bounding_offset,ua;var Nb=Za;if(m.length){var bb=[],ra={};ra.quat=new Float32Array([0,0,0,1]);ra.trans=new Float32Array(3);ra.worker_bounding=Vb;ra.bounding_type=Nb;bb.push(ra);R.invert(sa.G,ga);S.invert(sa.quat,D);for(var zb=0;zb<m.length;zb++){var ca={},Sa=m[zb],cb=Sa.game.collision_bounds_type,ma=new Float32Array(4),Ja=new Float32Array(3);T.transformMat4(Sa.d.e,ga,Ja);S.multiply(D,Sa.d.quat,ma);ca.trans=Ja;ca.quat=ma;ca.bounding_type=cb;ca.worker_bounding=
k(h(cb,Sa.d));bb.push(ca)}ua=bb}else ua=[];y.m(y.Ir,Zb,Lb,bd,wa,Sc,cd,Tc,uc,lb,Ya,yb,dc,Mb,Za,Vb,Ub,xa,Kb,ua,lc);Z.push(Xa);N[Zb]=Xa;var db=l(Zb);db.type=wa;db.wl=Tc;db.Vi=Sc;va=db;a.j=va;Ca={k:null,fb:va};c.j.l.push(Ca)}if(B(a)||A(a)){var ta=a,Ta=ta.j.D;B(ta)?(ta.f.type=10,y.m(y.Jr,Ta,ta.f.my,ta.f.oy,ta.f.ny,ta.f.bz,ta.f.zw)):A(ta)&&(ta.f.type=20,y.m(y.Hr,Ta,ta.f.Rk,ta.f.xm,ta.f.ym));if(ta.f.tf){var pa=ta.f.tf;switch(ta.f.type){case 10:f(pa[1],ta,Ta,!0);f(pa[0],ta,Ta,!0);f(pa[3],ta,Ta,!1);f(pa[2],
ta,Ta,!1);break;case 20:for(var Ka=0;Ka<pa.length;Ka++)f(pa[Ka],ta,Ta,!1)}}ta.j.id=ta.b4w_vehicle_settings.name;e(a,a.f)}else if(u(a)){var Ab=a.d,ec=a.j,$b=Ab.Db.max_y-Ab.Db.min_y,ac=ec.D,tb=a.b4w_character_settings,Bb=tb.walk_speed,mc=tb.run_speed,Cb=tb.step_height,ub=tb.jump_strength,nc=tb.waterline,Ob=G.Eu(a);y.m(y.Kr,ac,Ob,$b,Bb,mc,Cb,ub,nc);ec.is_character=!0}else if(s(a)){var La=a,bc=La.j.D;y.m(y.Nr,bc,La.qc.Rk,La.qc.xm,La.qc.ym);if(La.qc.ti)for(var oc=La.qc.ti,Oa=0;Oa<oc.length;Oa++){var mb=
oc[Oa],Db=mb.d.e,pc=La.d.G,Ea=new Float32Array(16);R.invert(pc,Ea);var Ma=new Float32Array(3);T.transformMat4(Db,Ea,Ma);y.m(y.Gr,bc,Ma,mb.pt)}La.j.kw=!0}else a.b4w_collision&&(va.id=a.b4w_collision_id);for(r=0;r<Z.length;r++)if(a=Z[r],a.j){var C=a;if(!p(C))for(var ka=0;ka<C.constraints.length;ka++){var Ba=C.constraints[ka],qa=Ba.target,Wb=Ba.pivot_type;if("RIGID_BODY_JOINT"==Ba.type&&qa.j){var ba=new Float32Array([Ba.pivot_x,Ba.pivot_y,Ba.pivot_z]),ib,jb=new Float32Array([Ba.axis_x,Ba.axis_y,Ba.axis_z]);
ib=G.euler_to_quat(jb,new Float32Array(4));var Pb=R.fromRotationTranslation(ib,ba,new Float32Array(16)),nb=R.multiply(C.d.G,Pb,new Float32Array(16)),Qb=R.invert(qa.d.G,new Float32Array(16)),vb=R.multiply(Qb,nb,Qb),Eb=G.gf(vb),Rb=G.matrix_to_quat(vb),Aa=Ba,Fa={};Fa.use_limit_x=Aa.use_limit_x;Fa.use_limit_y=Aa.use_limit_y;Fa.use_limit_z=Aa.use_limit_z;Fa.use_angular_limit_x=Aa.use_angular_limit_x;Fa.use_angular_limit_y=Aa.use_angular_limit_y;Fa.use_angular_limit_z=Aa.use_angular_limit_z;Fa.limit_max_x=
Aa.limit_max_x;Fa.limit_min_x=Aa.limit_min_x;Fa.limit_max_y=Aa.limit_max_y;Fa.limit_min_y=Aa.limit_min_y;Fa.limit_max_z=Aa.limit_max_z;Fa.limit_min_z=Aa.limit_min_z;Fa.limit_angle_max_x=Aa.limit_angle_max_x;Fa.limit_angle_min_x=Aa.limit_angle_min_x;Fa.limit_angle_max_y=Aa.limit_angle_max_y;Fa.limit_angle_min_y=Aa.limit_angle_min_y;Fa.limit_angle_max_z=Aa.limit_angle_max_z;Fa.limit_angle_min_z=Aa.limit_angle_min_z;v(Wb,C,ba,ib,qa,Eb,Rb,Fa,null,null)}}}};a.Vu=g;a.update=function(){for(var a=0;a<Z.length;a++){var b=
Z[a],c=b.j;if(c.je&&c.Fk){var d=performance.now()/1E3-c.Fk,d=Math.min(d,10/60);O.Fw&&(d=0);var e=V;F.fw(c.Gk,d,c.np,c.Wm,V);r.set_translation(b,F.Ko(e));r.set_rotation(b,F.Fo(e));r.v(b);m(b);if(b.f)for(var c=b,d=c.f.tf,e=c.d.Tc,f=V,g=0;g<d.length;g++){var h=d[g];F.multiply(e,c.f.Jh[g],f);r.qq(h,f);r.v(h)}b.f&&b.f.vg&&(c=b.f,d=c.vg)&&(e=b.f.Iq,h=ga,f=b.d.e,g=b.d.quat,G.pm(b.f.Jq,g,f,h),G.gf(h,d.d.e),G.matrix_to_quat(h,d.d.quat),h=ja,G.qm(e,g,f,h),e=D,S.setAxisAngle(h,-c.ug*c.hm*2*Math.PI,e),S.multiply(e,
d.d.quat,d.d.quat),r.v(d));b.f&&b.f.em&&(c=b.f,d=c.em)&&(f=b.f.Bq,e=ga,g=b.d.e,h=b.d.quat,G.pm(b.f.Cq,h,g,e),G.gf(e,d.d.e),G.matrix_to_quat(e,d.d.quat),e=ja,G.qm(f,h,g,e),f=D,g=Math.abs(c.speed)*c.Aq,g>c.yl&&(g=c.yl),S.setAxisAngle(e,-g,f),S.multiply(f,d.d.quat,d.d.quat),r.v(d));b.f&&b.f.km&&(c=b.f,d=c.km)&&(e=b.f.Pq,h=ga,f=b.d.e,g=b.d.quat,G.pm(b.f.Qq,g,f,h),G.gf(h,d.d.e),G.matrix_to_quat(h,d.d.quat),b=ja,G.qm(e,g,f,b),e=D,S.setAxisAngle(b,-Math.abs(c.Vf)*c.$n,e),S.multiply(e,d.d.quat,d.d.quat),
r.v(d))}}if(a=Q)a=J.ga(a,"MAIN_OPAQUE"),a.Aa&&0<a.Aa.waves_height&&(b=T.length(a.di),y.m(y.rs,a.time*b))};a.ov=function(){return Q};a.pause=function(){L.enabled&&y.m(y.cs)};a.resume=function(){L.enabled&&y.m(y.fs)};a.enable_simulation=function(a){a=a.j;if(!a)throw"No object physics";if(!a.je){var b=a.D;a.je=!0;y.m(y.as,b)}};a.disable_simulation=function(a){a=a.j;if(!a)throw"No object physics";if(a.je){var b=a.D;a.je=!1;y.m(y.$r,b)}};a.has_physics=function(a){return a.j?!0:!1};a.has_dynamic_physics=
function(a){return(a=a.j)&&a.je&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.wl&&0==a.Vi?!0:!1};a.has_simulated_physics=function(a){return(a=a.j)&&a.je?!0:!1};a.set_gravity=function(a,b){y.m(y.qs,a.j.D,b)};a.Zv=p;a.apply_constraint=v;a.clear_constraint=function(a){a=a.j;y.m(y.es,a.Ci);a.Ci=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,g){c=F.Of(c,1,d,V);f=F.Of(f,1,g,w);F.invert(c,c);F.multiply(f,c,c);r.Ov(e,f);F.multiply(f,c,c);r.qq(b,c);r.v(b);a.set_transform(b,b.d.e,b.d.quat)};a.set_transform=
function(a,b,c){F.Sh(a.d.e,1,a.d.quat,a.j.Gk);var d=y.Eo(y.Ef);d.msg_id=y.Ef;d.body_id=a.j.D;d.trans=b;d.quat=c;y.m(y.yc,a.j.D);y.m(y.Ef,d)};a.sync_transform=m;a.apply_velocity=function(a,b,c,d){x(a,b,c,d,P);a=a.j.D;y.m(y.yc,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(P[0]),f=Math.abs(P[1]),g=Math.abs(P[2]);P[0]=e?P[0]/e*Math.max(e,b):0;P[1]=f?P[1]/f*Math.max(f,c):0;P[2]=g?P[2]/g*Math.max(g,d):0;y.m(y.Km,a,P[0],P[1],P[2])};a.apply_velocity_world=function(a,b,c,d){a=a.j.D;y.m(y.yc,
a);y.m(y.Km,a,b,c,d)};a.apply_force=function(a,b,c,d){x(a,b,c,d,P);a=a.j.D;y.m(y.yc,a);y.m(y.Sr,a,P[0],P[1],P[2])};a.apply_torque=function(a,b,c,d){x(a,b,c,d,P);a=a.j.D;y.m(y.yc,a);y.m(y.Ur,a,P[0],P[1],P[2])};a.set_character_move_dir=function(a,b,c){a=a.j.D;y.m(y.yc,a);y.m(y.ks,a,b,c)};a.set_character_move_type=function(a,b){y.m(y.ls,a.j.D,b)};a.set_character_walk_velocity=function(a,b){y.m(y.ps,a.j.D,b)};a.set_character_run_velocity=function(a,b){y.m(y.ns,a.j.D,b)};a.set_character_fly_velocity=function(a,
b){y.m(y.hs,a.j.D,b)};a.character_jump=function(a){y.m(y.Vr,a.j.D)};a.character_rotation_inc=function(a,b,c){y.m(y.Wr,a.j.D,b,c)};a.set_character_rotation=function(a,b,c){y.m(y.ms,a.j.D,b,c)};a.set_character_rotation_h=function(a,b){y.m(y.js,a.j.D,b)};a.set_character_rotation_v=function(a,b){y.m(y.os,a.j.D,b)};a.Mz=function(){return!1};a.Lz=function(){return!1};a.check_collision=function(){K.error("check_collision() deprecated");return!1};a.Kz=function(){K.error("check_collision_any() deprecated");
return!1};a.check_ray_hit=function(){K.error("check_ray_hit() deprecated");return!1};a.wB=function(){K.error("update_object_coords() deprecated")};a.append_collision_test=function(a,b,c,d){var e=a.j,f=e.D;b=b||"ANY";for(var g=0;g<e.Cc.length;g++){var h=e.Cc[g];if(h.Ob==b&&h.callback==c)return}g=[];a=a.j.D;h=[];t(b,Q,h,null);for(var k=0;k<h.length;k++){var m=h[k];a<m?g.push([a,m]):a>m&&g.push([m,a])}h={Ob:b,callback:c,nj:g,Tp:new Uint8Array(g.length),Bl:d||!1};e.Cc.push(h);y.m(y.yc,f);y.m(y.Lr,g,d)};
a.remove_collision_test=function(a,b,c){a=a.j;b=b||"ANY";for(var d=0;d<a.Cc.length;d++){var e=a.Cc[d];if(e.Ob==b&&e.callback==c){a.Cc.splice(d,1);d--;for(var e=e.nj,f=Q.j.l,g=0;g<f.length;g++)for(var h=f[g].fb,k=0;k<h.Cc.length;k++)for(var m=h.Cc[k],l=0;l<m.nj.length;l++)for(var p=m.nj[l],q=0;q<e.length;q++){var r=e[q];p[0]===r[0]&&p[1]===r[1]&&(e.splice(q,1),q--)}e.length&&y.m(y.ds,e)}}};a.apply_collision_impulse_test=function(a,b){var c=a.j;c?(y.m(y.Tr,c.D),c.Bi=b):K.error("Object "+a.name+" has no physics")};
a.clear_collision_impulse_test=function(a){var b=a.j;b?(y.m(y.Yr,b.D),b.Bi=null):K.error("Object "+a.name+" has no physics")};a.append_ray_test=function(a,b,c,d,e,f){var g=a.j;if(g){a=g.D;b=b||"ANY";c={F:new Float32Array(c),U:new Float32Array(d),local:e,callback:f,Ob:b,wd:{}};t(b,Q,null,c.wd);delete c.wd[a];for(var h in c.wd)c.wd[h]=1;g.de.push(c);z(a,g.de)}else K.error("Object "+a.name+" has no physics")};a.remove_ray_test=function(a,b,c,d,e){if(b=a.j){a=b.D;for(var f=0;f<b.de.length;f++){var g=
b.de[f];G.Ai(g.F,c)&&G.Ai(g.U,d)&&g.local==e&&(b.de.splice(f,1),f--)}z(a,b.de)}else K.error("Object "+a.name+" has no physics")};a.vehicle_throttle=function(a,b){var c=a.f;c.Vf=b;e(a,c)};a.vehicle_steer=function(a,b){var c=a.f;c.ug=b;e(a,c)};a.vehicle_brake=function(a,b){var c=a.f;c.Vg=b;e(a,c)};a.is_vehicle_chassis=B;a.is_vehicle_hull=A;a.iw=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==
a?!0:!1};a.hw=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.lw=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.hp=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.gp=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.ip=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.f.speed};a.cz=
function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=u;a.PA=s;a.tA=function(){return 0};a.yu=function(){y.m(y.Zr)};a.dx=function(a){var b=Z.indexOf(a);-1!=b?(Z.splice(b,1),a=N.indexOf(a),-1!=a&&N.splice(a,1)):K.error("Object ",a.name," doesn't have bounding physics")}};b4w.module.__data=function(a,n){function b(a,b){for(var c=P(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}Va[b.id]=null;hb[b.id]=null}function c(a,b,c){var d;a instanceof ArrayBuffer&&(a=oa.Lo(a));d=a.width;a=a.height;aa.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(rb)&&c&&aa.warn("B4W Warning: image",b,"is not from app root.")}function g(a,b,c,d,e,f){d=b.q;if(!d)throw"Nothing requested";Y.enqueue([[d,Y.AT_JSON,
d]],function(d,f,g,h){if(d){aa.log("%cLOAD METADATA","color: #616",h);f=d.b4w_format_version;if(Number(f)<ab.tp)throw"Incompatible file version: "+f+". Required: "+ab.tp;for(var k in d)a[k]=d[k];(d=a.binaries[0].binfile)?b.jn=d:(U.$l(b,"load_binaries"),U.$l(b,"prepare_bindata"));if(a.b4w_export_errors)for(d=0;d<a.b4w_export_errors.length;d++)aa.error("EXPORT ERROR:",a.b4w_export_errors[d]);if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)aa.warn("EXPORT WARNING:",a.b4w_export_warnings[d]);
e(b,c)}},null,function(a){f(b,c,a)})}function d(a,b,c,d,e,f){d=Z(b.q)+b.jn;if(!d)throw"Binary data is missing";Y.enqueue([[d,Y.AT_ARRAYBUFFER,d]],function(d,f,g,h){d&&(aa.log("%cLOAD BINARY","color: #616",h),a.bin_data=d,e(b,c))},null,function(a){f(b,c,a)})}function l(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],g=a.objects,k=a.meshes;a=a.actions;for(var E=za.Ct(),m=["indices"],l=["normal","tangent"],p=["color","group"],q=["position","texcoord","texcoord2"],r=0;r<k.length;r++)for(var ea=k[r].submeshes,
w=0;w<ea.length;w++)for(var t in ea[w]){var v=ea[w][t][1];if(-1!=m.indexOf(t)){var s=4*ea[w][t][0]+f["int"],x=ea[w],n=t,Y=d;if(E)var I=new Uint32Array(Y,s,v);else for(var I=new Uint32Array(v),Y=new DataView(Y),z=0;z<v;z++)I[z]=Y.getUint32(s+4*z,!0);x[n]=I}else if(-1!=q.indexOf(t))s=4*ea[w][t][0]+f["float"],ea[w][t]=h(d,s,v,E);else if(-1!=l.indexOf(t)){s=2*ea[w][t][0]+f["short"];x=ea[w];n=t;Y=d;I=new Float32Array(v);Y=new DataView(Y);for(z=0;z<v;z++)I[z]=Y.getInt16(s+2*z,!0)/32767;x[n]=I}else if(-1!=
p.indexOf(t)){s=2*ea[w][t][0]+f.ushort;x=ea[w];n=t;Y=d;I=new Float32Array(v);Y=new DataView(Y);for(z=0;z<v;z++)I[z]=Y.getUint16(s+2*z,!0)/65535;x[n]=I}}for(t=0;t<g.length;t++)for(k=g[t].particle_systems,m=0;m<k.length;m++)l=k[m],l.transforms=h(d,4*l.transforms[0]+f["float"],l.transforms[1],E);for(g=0;g<a.length;g++){t=a[g];var k=t.fcurves,l=t.frame_range,m=l[0],l=l[1],p=V.tv(m,l),q=null,ea=r=!1,U;for(U in k)r|=-1<U.indexOf("rotation_euler"),ea|=-1<U.indexOf("rotation_quaternion");for(U in k)if(r&&
ea&&-1<U.indexOf("rotation_euler"))delete k[U];else{var w=k[U],u;for(u in w)v=w[u],s=h(d,f["float"]+4*v.bin_data_pos[0],v.bin_data_pos[1],E),x=new Float32Array(p),null===q&&(q=new Int8Array(p)),V.dt(v,s,x,q,m,l),v.Nb=x;-1<U.indexOf("rotation_euler")&&V.Uu(k,U)}t.As=q}e(b,c)}function h(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function k(a,b,c,d,e){var f=a.cameras,g=a.groups,h=a.materials,k=a.meshes,
E=a.node_groups,m=a.objects,l=a.particles,p=a.scenes,q=a.speakers,r=a.textures,w=a.worlds;E||(aa.warn('B4W Warning: "node_groups" datablock undefined. reexport main scene.'),E=a.node_groups=[]);for(var v="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),s={},n=0;n<v.length;n++)for(var Y=a[v[n]],I=0;I<Y.length;I++){var z=Y[I];s[z.uuid]=z}for(var U=0;U<p.length;U++){for(var u=p[U],fa=u.objects,A=0;A<
fa.length;A++)t(fa,A,s);u.camera&&t(u,"camera",s);u.world&&t(u,"world",s)}for(U=0;U<g.length;U++)for(var B=g[U].objects,A=0;A<B.length;A++)t(B,A,s);for(U=0;U<m.length;U++){var F=m[U];F.dupli_group&&t(F,"dupli_group",s);F.parent&&t(F,"parent",s);if(F.animation_data){var X=F.animation_data;X.action&&t(X,"action",s);if(X.nla_tracks)for(A=0;A<X.nla_tracks.length;A++)for(var G=X.nla_tracks[A],la=0;la<G.strips.length;la++)G.strips[la].action&&t(G.strips[la],"action",s)}switch(F.type){case "MESH":if(!F.data)throw"mesh not found for object "+
F.name;t(F,"data",s);for(var D=F.modifiers,A=0;A<D.length;A++){var ia=D[A];"ARMATURE"==ia.type?t(ia,"object",s):"CURVE"==ia.type&&t(ia,"object",s)}var K=F.particle_systems;if(K)for(A=0;A<K.length;A++)t(K[A],"settings",s);break;case "ARMATURE":t(F,"data",s);for(var H=F.pose.bones,Da=F.data.bones,A=0;A<H.length;A++){var W=H[A];W.bone=Da[W.bone];for(var L=W.parent_recursive,la=0;la<L.length;la++)L[la]=H[L[la]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":t(F,"data",s)}var gb=F.constraints;
if(gb)for(A=0;A<gb.length;A++){var N=gb[A];N.target&&t(N,"target",s)}var T=F.lod_levels;if(T)for(A=0;A<T.length;A++){var oa=T[A];oa.object&&t(oa,"object",s)}}for(U=0;U<k.length;U++)for(var R=k[U].materials,A=0;A<R.length;A++)t(R,A,s);for(U=0;U<h.length;U++){for(var O=h[U],Ha=O.texture_slots,A=0;A<Ha.length;A++)t(Ha[A],"texture",s);var S=O.node_tree;S&&x(S,s)}for(U=0;U<E.length;U++)(S=E[U].node_tree)&&x(S,s);for(U=0;U<r.length;U++){var Q=r[U],Z=Q.type;"IMAGE"!=Z&&"ENVIRONMENT_MAP"!=Z||t(Q,"image",
s)}for(U=0;U<f.length;U++){var hb=f[U];hb.dof_object&&t(hb,"dof_object",s)}for(U=0;U<q.length;U++){var da=q[U];da.sound&&t(da,"sound",s);if(da.animation_data&&(X=da.animation_data,X.action&&t(X,"action",s),X.nla_tracks))for(A=0;A<X.nla_tracks.length;A++)for(G=X.nla_tracks[A],la=0;la<G.strips.length;la++)G.strips[la].action&&t(G.strips[la],"action",s)}for(U=0;U<l.length;U++){for(var C=l[U],Ha=C.texture_slots,A=0;A<Ha.length;A++)t(Ha[A],"texture",s);C.dupli_group&&t(C,"dupli_group",s);C.dupli_object&&
t(C,"dupli_object",s)}for(U=0;U<w.length;U++)if(Ha=w[U].texture_slots)for(A=0;A<Ha.length;A++)t(Ha[A],"texture",s);Ua.Bt(a);va=0===b.id;Ca||(Ca=a.scenes[0]);for(var Va=a.textures,ga=va?a.scenes[0].b4w_anisotropic_filtering:Ca.b4w_anisotropic_filtering,ya=0;ya<Va.length;ya++)va||"SCENE"!=Va[ya].b4w_source_type||(Va[ya].b4w_source_id=""),Pa.pu(Va[ya],ga,a.scenes);for(var Na={},ba=a.objects,Jb=0;Jb<ba.length;Jb++){var jb=ba[Jb];if("MESH"===jb.type&&!jb.particle_systems.length)for(var Pb=jb.data,nb=Pb.name,
Qb=Pb.submeshes,vb=Pb.materials,Eb=0;Eb<Qb.length;Eb++)0!==Qb[Eb].base_length||Na[nb]||(vb[Eb]?aa.warn('B4W Warning: material "'+vb[Eb].name+'" is not assigned to any face (object "'+jb.name+'").'):aa.warn('B4W Warning: Mesh "'+Pb.name+'" has no faces (object "'+jb.name+'").'),Na[nb]=!0)}for(var Rb=a.meshes,Aa=0;Aa<Rb.length;Aa++){var wa=Rb[Aa];wa.materials.length||wa.uv_textures.length&&aa.warn('B4W Warning: mesh "'+wa.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",
use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,
b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});
for(var rb=a.meshes,Xa=za.keysearch("name","DEFAULT",a.materials),sa=0;sa<rb.length;sa++){var Ia=rb[sa];0==Ia.materials.length&&Ia.materials.push(Xa)}for(var xa=a.actions,Za=b.id,sb=0;sb<xa.length;sb++){var ob=xa[sb];ob.Cs=Za;V.Ns(ob)}for(var Gb=a.scenes,pb=0;pb<Gb.length;pb++){for(var gc=Gb[pb],wc=M.yk(gc,"ALL"),xc=[],wb=0;wb<wc.length;wb++)for(var Hb=wc[wb].particle_systems,Ib=0;Ib<Hb.length;Ib++){var eb=Hb[Ib].settings;if("HAIR"==eb.type)if("OBJECT"==eb.render_type)ea.sm(eb.dupli_object,!0);else if("GROUP"==
eb.render_type){for(var Sb=eb.dupli_group,yc=M.yk(gc,"EMPTY"),fb=0;fb<yc.length;fb++)yc[fb].dupli_group==Sb&&xc.push(yc[fb]);for(fb=0;fb<Sb.objects.length;fb++)ea.sm(Sb.objects[fb],!0)}else aa.warn("B4W Warning: render type",eb.render_type,"not supported for particle systems ("+eb.name+").")}for(wb=0;wb<xc.length;wb++)J(xc[wb],[gc])}ja(a,b.id);for(var zc=a.scenes,Uc=0;Uc<zc.length;Uc++){for(var ld=zc[Uc],hc=[],qc=[],Gc=zc[Uc].objects,qb=0;qb<Gc.length;qb++){var Ac=Gc[qb];y(Gc,Ac,hc,qc);var Vc=Ac.dupli_group;
if(Vc)for(var rc=Vc.objects,Hc=0;Hc<rc.length;Hc++)y(rc,rc[Hc],hc,qc)}for(qb=0;qb<qc.length;qb++)J(qc[qb],[ld]);for(qb=0;qb<hc.length;qb++)za.at(hc[qb][0],hc[qb][1])}ja(a,b.id);for(var Qa=P(a,b.id),ya=0;ya<Qa.length;ya++){var sc=Qa[ya];!va&&sc.parent&&-1<Zb.indexOf(sc.parent.type)&&(sc.parent="");ea.sm(sc,!1);sc.d.gd=b.id}for(var Ic=0;Ic<Qa.length;Ic++){var tc=Qa[Ic];if("MESH"==tc.type){var Wc=V.get_first_armature_object(tc);if(Wc){var Bc=Wc.d;if(Bc.Fd){var Jc=tc.d.fc,Xc=[],Kc;for(Kc in Jc){var kd=
Jc[Kc];Xc.push(4*kd.eh,4*kd.on)}Bc.sp.push(Xc)}Bc.Bj.push(tc.d)}}}for(var Yc=-1,cc=0;cc<Qa.length;cc++){var jc=Qa[cc],Tb=jc.d;if(za.sc(jc)&&Tb.sh){var Lc=Tb.max_bones;Lc>Yc&&(Yc=Lc)}}for(cc=0;cc<Qa.length;cc++)if(jc=Qa[cc],Tb=jc.d,za.sc(jc)&&Tb.sh){Tb.max_bones=Yc;var Cc=jc,Zc=Tb.max_bones,ed=ab.max_bones,Mc=Cc.d;Zc>2*ed?za.da('B4W Error: too many bones for "'+Cc.name+'"'):Zc>ed?(aa.warn('B4W Warning: too many bones for "'+Cc.name+'" / '+Zc+" bones (max "+ed+"). Blending between frames will be disabled."),
Mc.kh=!1):Mc.kh=!0;Mc.kh=Mc.kh&&!xb.so}for(var $c=0;$c<Qa.length;$c++){var ic=Qa[$c];if(za.sc(ic)){var pd=ic.lod_levels.length;if(pd)for(var dd=ic,Dc=0;Dc<pd;Dc++){var Nc=ic.lod_levels[Dc].object;if(!Nc){dd.d.aj=!0;dd.d.Zd=ic.lod_levels[Dc].distance;break}Nc.d.ff=ic.d.ff;dd.d.Zd=ic.lod_levels[Dc].distance;Nc.d.wh=ic.lod_levels[Dc].distance;if(ic.lod_levels[Dc+1])Nc.d.Zd=ic.lod_levels[Dc+1].distance;else{Nc.d.aj=!0;Nc.d.Zd=1E4;break}dd.d.aj=!1;dd=Nc}}}for(var md=0;md<Qa.length;md++){var ha=Qa[md];
if(ha.b4w_vehicle){var Ra=ha.b4w_vehicle_settings;if("CHASSIS"==Ra.part){ha.f={};ha.f.ro=Ra.force_max;ha.f.pn=Ra.brake_max;ha.f.my=Ra.suspension_compression;ha.f.oy=Ra.suspension_stiffness;ha.f.ny=Ra.suspension_damping;ha.f.bz=Ra.wheel_friction;ha.f.gB=Ra.roll_influence;ha.f.zw=Ra.max_suspension_travel_cm;ha.f.Vf=0;ha.f.Vg=1;ha.f.ug=0;ha.f.speed=0;ha.f.tf=[];ha.f.Jh=[];ha.f.vg=null;for(var qd=ha.Cb?ha.Cb.dupli_group.objects:Qa,Oc=0;Oc<qd.length;Oc++){var Ga=qd[Oc];if(Ga.b4w_vehicle){var Wa=Ga.b4w_vehicle_settings;
if(na.iw(Ga)&&Ra.name==Wa.name){var rd=na.cz(Ga.b4w_vehicle_settings.part);ha.f.tf[rd]=Ga;ha.f.Jh[rd]=new Float32Array(8)}else if(na.hp(Ga)&&Ra.name==Wa.name){ha.f.vg=Ga;ha.f.hm=Wa.steering_max;ha.f.Hq=Wa.steering_ratio;ha.f.cp=Wa.inverse_control;var kb=$a.invert(ha.d.G,new Float32Array(16)),fd=$a.multiply(kb,Ga.d.G,kb);ha.f.Jq=fd;var Pc=new Float32Array([1,0,0,0]);Yb.transformMat4(Pc,fd,Pc);ha.f.Iq=Pc}else if(na.gp(Ga)&&Ra.name==Wa.name){ha.f.em=Ga;ha.f.Aq=Wa.speed_ratio;ha.f.yl=Wa.max_speed_angle;
var kb=$a.invert(ha.d.G,new Float32Array(16)),gd=$a.multiply(kb,Ga.d.G,kb);ha.f.Cq=gd;var Qc=new Float32Array([1,0,0,0]);Yb.transformMat4(Qc,gd,Qc);ha.f.Bq=Qc}else if(na.ip(Ga)&&Ra.name==Wa.name){ha.f.km=Ga;ha.f.$n=Wa.delta_tach_angle;var kb=$a.invert(ha.d.G,new Float32Array(16)),hd=$a.multiply(kb,Ga.d.G,kb);ha.f.Qq=hd;var Rc=new Float32Array([1,0,0,0]);Yb.transformMat4(Rc,hd,Rc);ha.f.Pq=Rc}}}if(4!=ha.f.tf.length)throw"Not enough wheels for chassis "+ha.name;}else if("HULL"==Ra.part){ha.f={};ha.f.tf=
[];ha.f.Jh=[];ha.f.ro=Ra.force_max;ha.f.pn=Ra.brake_max;ha.f.Rk=Ra.floating_factor;ha.f.xm=Ra.water_lin_damp;ha.f.ym=Ra.water_rot_damp;ha.f.Vf=0;ha.f.Vg=1;ha.f.ug=0;ha.f.speed=0;ha.f.vg=null;for(var sd=ha.Cb?ha.Cb.dupli_group.objects:Qa,Oc=0;Oc<sd.length;Oc++)Ga=sd[Oc],Ga.b4w_vehicle&&(Wa=Ga.b4w_vehicle_settings,na.hw(Ga)&&Ra.name==Wa.name?(ha.f.tf.push(Ga),ha.f.Jh.push(new Float32Array(8))):na.hp(Ga)&&Ra.name==Wa.name?(ha.f.vg=Ga,ha.f.hm=Wa.steering_max,ha.f.Hq=Wa.steering_ratio,ha.f.cp=Wa.inverse_control,
kb=$a.invert(ha.d.G,new Float32Array(16)),fd=$a.multiply(kb,Ga.d.G,kb),ha.f.Jq=fd,Pc=new Float32Array([1,0,0,0]),Yb.transformMat4(Pc,fd,Pc),ha.f.Iq=Pc):na.gp(Ga)&&Ra.name==Wa.name?(ha.f.em=Ga,ha.f.Aq=Wa.speed_ratio,ha.f.yl=Wa.max_speed_angle,kb=$a.invert(ha.d.G,new Float32Array(16)),gd=$a.multiply(kb,Ga.d.G,kb),ha.f.Cq=gd,Qc=new Float32Array([1,0,0,0]),Yb.transformMat4(Qc,gd,Qc),ha.f.Bq=Qc):na.ip(Ga)&&Ra.name==Wa.name&&(ha.f.km=Ga,ha.f.$n=Wa.delta_tach_angle,kb=$a.invert(ha.d.G,new Float32Array(16)),
hd=$a.multiply(kb,Ga.d.G,kb),ha.f.Qq=hd,Rc=new Float32Array([1,0,0,0]),Yb.transformMat4(Rc,hd,Rc),ha.f.Pq=Rc))}}}for(var nd=0;nd<Qa.length;nd++){var kc=Qa[nd];if(kc.b4w_floating){var id=kc.b4w_floating_settings;if("MAIN_BODY"==id.part){kc.qc={};kc.qc.Rk=id.floating_factor;kc.qc.xm=id.water_lin_damp;kc.qc.ym=id.water_rot_damp;kc.qc.ti=[];for(var td=kc.Cb?kc.Cb.dupli_group.objects:Qa,od=0;od<td.length;od++){var ad=td[od];if(ad.b4w_floating){var ud=ad.b4w_floating_settings;na.lw(ad)&&id.name==ud.name&&
(kc.qc.ti.push(ad),ad.pt=ad.b4w_floating_settings.synchronize_position)}}}}}e(b,c)}function f(a,b,c,d,e){!va&&1<a.scenes.length&&(a.scenes=[a.scenes[0]],aa.warn("B4W Warning: loading data contains multiple scenes.","Only the first one will be loaded."));-1==xb.ua&&va&&(xb.ua=a.scenes[0].fps);for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];if(va&&!f.camera)throw"Scene check failed: No camera";for(var g=M.yk(f,"MESH"),h=0;h<g.length;h++){var k=g[h],E=Ua.bt(k);E&&(a.meshes.push(E),k.data=E)}for(var h=
P(a,b.id),k=a.meshes,E=k.slice(0),m=0;m<h.length;m++){var l=h[m];"MESH"==l.type&&(l=E.indexOf(l.data),-1<l&&E.splice(l,1))}for(m=0;m<E.length;m++)k.splice(k.indexOf(E[m]),1);va?(M.Ss(f,a.textures),f.d.Jg.length&&(b.hl=!0),Na.enabled&&f.b4w_enable_physics&&na.an(f),f.b4w_enable_audio&&X.bn(f),h=M.bl(f),k=f.b4w_batch_grid_size):(M.Ys(f,Ca,a.textures),Na.enabled&&f.b4w_enable_physics&&!Ca.j&&na.an(Ca),f.b4w_enable_audio&&!Ca.g&&X.bn(Ca),h=M.bl(Ca),k=Ca.b4w_batch_grid_size);g=w.kv(h,k,g,f.world,Ca.d.pl);
va?(M.Um(f,g),M.ev(h)):M.Um(Ca,g)}d=a.materials;if(ya.Ik&&ab.ar)for(a=0;a<d.length;a++){f=d[a];k=f.texture_slots;for(g=0;g<k.length;g++)if(E=k[g],m=E.texture,"IMAGE"==m.type||"ENVIRONMENT_MAP"==m.type)h=m.image,h.dc||(-1<h.filepath.indexOf(".dds")?h.dc=!0:(h.dc=!m.b4w_disable_compression&&!E.use_map_normal&&"ENVIRONMENT_MAP"!=m.type&&!m.b4w_shore_dist_map&&"MOVIE"!=h.source,h.dc&&(h.filepath+=".dds")));if(g=f.node_tree)for(k=g.nodes,g=0;g<k.length;g++)h=k[g],"TEXTURE"==h.type&&((E=h.texture)?(h=E.image,
h.dc||(h.dc=E.d.li&&!E.b4w_disable_compression&&"MOVIE"!=h.source,h.dc&&(h.filepath+=".dds"))):aa.warn("B4W Warning: material ",f.name," has empty textures."))}else for(a=a.images,d=0;d<a.length;d++)f=a[d],f.dc=Boolean("FILE"==f.source&&-1<f.filepath.indexOf(".dds"));e(b,c)}function p(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},g={},h={},k={},E=0;E<d.length;E++){var m=d[E];f[m.uuid]=m;h[m.uuid]=m}for(E=0;E<a.length;E++)m=a[E],g[m.uuid]=m,k[m.uuid]=m;v(a,null,k,h);for(var l in h)l in f||d.push(h[l]);
for(l in k)l in g||a.push(k[l]);e(b,c)}function v(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=c[g.uuid];if(g=h.proxy){b&&-1==e.indexOf(g.uuid)&&e.push(g.uuid);for(var k=c[g.uuid],l=k.constraints,g=0;g<l.length;g++){var p=za.Ie(l[g]);p.name+="_CLONE";h.constraints.push(p)}"b4w_proxy_inherit_anim"in h&&!h.b4w_proxy_inherit_anim||(h.animation_data&&(k.animation_data=za.Ie(h.animation_data)),k.b4w_use_default_animation=h.b4w_use_default_animation,k.b4w_auto_skel_anim=h.b4w_auto_skel_anim,k.b4w_anim_behavior=
h.b4w_anim_behavior,k.b4w_cyclic_animation=h.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)h=za.cl(a,"uuid",e[f]),-1<h&&a.splice(h,1);e={};for(f=0;f<a.length;f++)g=a[f],h=c[g.uuid],b&&(l=za.Ie(h),h="origin_name"in h?h.origin_name:h.name,l.name=b+"*"+h,l.origin_name=h,m(l),c[l.uuid]=l,e[g.uuid]=l.uuid,g.uuid=l.uuid),h=c[g.uuid],h.dupli_group&&(g=h.dupli_group,l=d[g.uuid],k=za.Ie(l),k.name=za.Lj(l.name+"_CLONE"),k.uuid=E.Wo("Group"+k.name),d[k.uuid]=k,g.uuid=k.uuid,v(k.objects,h.name,c,d));if(b)for(f=
0;f<a.length;f++){g=a[f];h=c[g.uuid];h.parent&&h.parent.uuid in e?h.parent.uuid=e[h.parent.uuid]:h.parent&&(aa.warn("B4W Warning: Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),h.parent=null);l=h.constraints;for(g=0;g<l.length;g++)b=l[g],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=h.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(g=0;g<h.length;g++)b=h[g],b.object&&
b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var q in e)Xa[q]=e[q]}function m(a){a.uuid=E.Wo("Object"+a.name)}function x(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var f=c[d];"MATERIAL"!=f.type&&"MATERIAL_EXT"!=f.type||!f.material||t(f,"material",b);"TEXTURE"==f.type&&f.texture&&t(f,"texture",b);"LAMP"==f.type&&f.lamp&&(f.lamp.uuid in Xa&&(f.lamp.uuid=Xa[f.lamp.uuid]),b[f.lamp.uuid]||(f.lamp=null));"GROUP"==f.type&&f.node_group&&t(f,"node_group",b)}f=a.links;for(d=0;d<f.length;d++){var g=
f[d];z(g,"from_node",c);z(g,"to_node",c);e(g,"from_socket",g.from_node.outputs);e(g,"to_socket",g.to_node.inputs)}if(c=a.animation_data)if(c.action&&t(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(f=c.nla_tracks[d],g=0;g<f.strips.length;g++)f.strips[g].action&&t(f.strips[g],"action",b)}function t(a,b,c){(c=c[a[b].uuid])||aa.error("Dangling link found:",b,a);a[b]=c}function z(a,b,c){c=za.keysearch("name",a[b].name,c);a[b]=c}function e(a,b,c){c=za.keysearch("identifier",a[b].identifier,
c);a[b]=c}function B(a,b,d,e,f,g){if(!ab.do_not_load_resources){for(var h=Z(b.q),k=a.images,E={},m=[],l=0;l<k.length;l++){var p=k[l],q=p.uuid;if("FILE"===p.source||"MOVIE"===p.source){var r=A(p,a.textures);if(!r.length)aa.warn("B4W Warning: image ",p.name," has no users.");else if(!r[0].b4w_shore_dist_map){r=da(h+p.filepath);if("FILE"===p.source){var ea=p.dc?Y.AT_ARRAYBUFFER:Y.AT_IMAGE_ELEMENT;if(ya.zl&&ab.Rj){var w=Y.Dj(r);"dds"==w[1]?(r=Y.Dj(w[0]),r=r[0]+".min50."+r[1]+".dds"):r=w[0]+".min50."+
w[1]}}else"MOVIE"===p.source&&(w=Y.Dj(r),ea=X.detect_video_container(w[1]),""!=ea&&(r=w[0]+"."+ea),ea=Y.Wj);m.push([q,ea,r,p.name]);E[q]=p}}}m.length?(e.Xo=0,Y.enqueue(m,function(f,h,k,l){if(f){if(k==Y.Wj){k=f.videoWidth;var p=f.videoHeight;aa.log("%cLOAD VIDEO "+k+"x"+p,"color: #"+(2048<k||2048<p?"a00":1024<k||1024<p?"aa0":"0a0"),l);-1==l.indexOf(rb)&&aa.warn("B4W Warning: video",l,"is not from app root.")}else c(f,l,!0);h=E[h];l=A(h,a.textures);for(k=0;k<l.length;k++)p=l[k],Pa.Pj(p.d,f,h.dc,p.image.filepath)}f=
++e.Xo/m.length;g(b,d,f)},function(){aa.log("%cLOADED ALL IMAGES","color: #0a0");f(b,d)})):f(b,d)}}function A(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function u(a,b,c,d,e,f){if(!ab.do_not_load_resources){a=P(a,b.id);for(var g=Z(b.q),h=[],k={},E=0;E<a.length;E++){var m=a[E];if(s(m)){var l=m.data.sound,p=l.uuid;"BACKGROUND_MUSIC"==X.dl(m)?(p=za.dv(),b.gl=!0):"NONE"!=X.dl(m)&&ab.$o&&(b.jl=!0);if(!(p in k)){k[p]=[];l=da(g+l.filepath);switch(X.yq(m)){case X.Vj:var q=
Y.AT_AUDIOBUFFER;break;case X.Bm:q=Y.AT_AUDIO_ELEMENT}var l=Y.Dj(l),r=X.detect_audio_container(l[1]);if(r!=l[1]){if(I.dp()){U.$l(b,"load_speakers");return}l=l[0]+".lossconv."+r}else l=l[0]+"."+r;h.push([p,q,l])}k[p].push(m)}}h.length?Y.enqueue(h,function(a,e,g,E){if(a)for(aa.log("%cLOAD SOUND","color: #0aa",E),-1==E.indexOf(rb)&&aa.warn("B4W Warning: sound",E,"is not from app root."),e=k[e],g=0;g<e.length;g++)X.Ky(e[g],a);a=++d.Ux/h.length;f(b,c,a)},function(){aa.log("%cLOADED ALL SOUNDS","color: #0aa");
e(b,c)}):e(b,c)}}function s(a){return X.Yd(a)&&X.yq(a)!=X.Cm?!0:!1}function q(a,b){for(var c=M.la(a,"SPEAKER",M.DATA_ID_ALL),d=0;d<c.length;d++){var e=c[d];X.Yd(e)&&(X.is_cyclic(e)||b)&&X.play_def(e)}}function K(a){a=a.d.Jg;for(var b=0;b<a.length;b++)a[b].d.Ra&&a[b].use_auto_refresh&&a[b].d.Ra.play()}function H(a,b,c,d,e){Da.start();aa.log("%cSTART NLA","color: #0a0");e(b,c)}function y(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,f=0;f<e;f++){var g=b.lod_levels[f],h=
g.object;if(h){var k=za.Yg(h);k.name=b.name+"_LOD_"+String(f+1);m(k);k.lod_levels=[];c.push([a,k]);d.push(h);g.object=k}}}function J(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=f.objects,g=f.indexOf(a),-1<g&&f.splice(g,1))}var g=d.indexOf(a);-1<g&&d.splice(g,1)}}function r(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d],g=va?f.b4w_enable_physics:Ca.b4w_enable_physics||f.b4w_enable_physics;va||(f=Ca);for(var h=0;h<Za.length;h++)for(var k=
M.la(f,Za[h],M.DATA_ID_ALL),E=0;E<k.length;E++){var m=k[E];m.d.gd==b.id&&Na.enabled&&g&&(na.append_object(m,f),b.pp&&na.has_physics(m)&&na.disable_simulation(m))}}e(b,c)}function F(a,b,d,e,f){var g={};e=[];for(var h=a.scenes,k=0;k<a.scenes.length;k++){var E=h[k];if(E.d.Aa&&(E=E.d.Aa.Aj)&&"FILE"===E.source){var m=E.uuid,l=da(Z(b.q)+E.filepath);e.push([m,E.dc?Y.AT_ARRAYBUFFER:Y.AT_IMAGE_ELEMENT,l,E.name]);g[m]=E}}e.length?Y.enqueue(e,function(b,d,e,f){if(b){c(b,f,!0);d=g[d];f=A(d,a.textures);for(e=
0;e<f.length;e++){var k=f[e];Pa.Pj(k.d,b,d.dc,k.image.filepath)}for(e=0;e<h.length;e++)if(f=h[e],f.d.Aa.Aj===d){var E=b,m=d,l=document.createElement("canvas"),k=m.size[0],m=m.size[1];l.width=k;l.height=m;l=l.getContext("2d");l.drawImage(E,0,0);E=l.getImageData(0,0,k,m).data;l=new Float32Array(4);l[0]=1/16581375;l[1]=1/65025;l[2]=1/255;l[3]=1;for(var k=k*m,m=new Float32Array(k),p=0;p<k;p++)m[p]=l[1]*E[4*p+2]+l[2]*E[4*p+3];f.d.Xl=m}}},function(){f(b,d)}):f(b,d)}function G(a,b,d,e,f){if(ab.antialiasing&&
ab.smaa){e=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],h=0;h<g.length;h++){var k=M.ga(e,g[h]);k&&a.push(k)}if(a.length){e=[];h=Y.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",h,I.yb.smaa_search_texture_path,"smaa_search_texture"]);e.push(["AREA_TEXTURE",h,I.yb.smaa_area_texture_path,"smaa_area_texture"]);for(h=0;h<a.length;h++)if(g=a[h],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.Y;for(h=0;h<a.length;h++)if(g=a[h],
"u_search_tex"==g.U)var E=g.na;else if("u_area_tex"==g.U)var m=g.na;break}e.length?Y.enqueue(e,function(a,b,d,e){a&&(c(a,e,!1),b="SEARCH_TEXTURE"==b?E:m,b.source="IMAGE",b.fn=!0,Pa.Pj(b,a,-1!=e.indexOf(".dds")?1:0,e),Pa.yj(b,Pa.s,Pa.s))},function(){f(b,d)}):f(b,d)}else f(b,d)}else f(b,d)}function W(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];va||(e=Ca);for(var f=M.la(e,"ALL",M.DATA_ID_ALL),g=0;g<f.length;g++){var h=f[g];h.d.gd==b.id&&(b.pp&&M.hide_object(h),d.Vm.push({ox:e,obj:h}))}}}
function T(a,b,c,d,e,f){a=d.Vm;var g=d.Bp;a.length?(e=a[g].obj,g=a[g].ox,M.append_object(g,e),-1!=sb.indexOf(e.type)&&g.b4w_enable_audio&&X.append_object(e,g),d=++d.Bp/a.length):d=1;f(b,c,d)}function S(a,b,c,d,e){if(va){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];M.Sx(f);M.Tw(f);f.b4w_use_nla&&Da.Iy(f,f.b4w_nla_cyclic)}M.set_active(a.scenes[0])}else M.$q(Ca);a=P(a,b.id);ea.Hy(a);e(b,c)}function R(a,b,c,d,e){if(va)for(d=0;d<a.scenes.length;d++)a.scenes[d].b4w_use_nla||K(a.scenes[d]),q(a.scenes[d]);
else a.scenes[0].b4w_use_nla||K(Ca),q(Ca);e(b,c)}function L(a,b,c,d,e){ab.Ye&&(b.hl||b.gl||b.jl)?wa||O(a,e,b,c):e(b,c)}function O(a,b,c,d){var e=xa.canvas.parentElement;Ia=e.style.zIndex;e.style.zIndex="999";wa=document.createElement("div");wa.style.position="relative";wa.style.height="88px";wa.style.width="88px";var f=Math.round(xa.canvas.offsetWidth/2-44);wa.style.top=Math.round(xa.canvas.offsetHeight/2-44).toString()+"px";wa.style.left=f.toString()+"px";wa.style.backgroundImage="url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAYAAABxlTA0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAhOSURBVHic7Z1tjFxVGcd/z1AKsbzotoW0IQqFhpSXFlugxbbGRkNSLJEQLVJttH7VEl8+oCYYExLFDxilJib6AWshtlterN20hkBKsNitpFVapB9YIzGBWEq3+IKCLf374Tx3587szGxn5577Mt1fcnN37r1zznP+c/a55557znOMkiDJgLnAADDT9+ktOQYwChwHTvh+tGl7zcyUp/3tsCIzlzQdWAwsA24CLs4o6X8ALwDDwEEz+19G6XZN7gJLugi4mSDqh4HzUqffBN6gXkPT++RvaKzhM5v2lwCzUmm+C/yRIPYfzOyfMcrVjlwE9n//lcAngQVALXV6hFD435vZ3zLK74PARwg/4lWpU6eBI8Au4Lk83Eh0gSUtBDYA8/3QaeAlYB8wbGbHIuc/myD0LcB11H/cEeBhM3sxZv7RBJZ0OfBF4EY/9CawDdhrZv+Kle8ENl0IrADuou5GDhKE/muMPDMXWNIs4PPAxz39t4FBYGeRN5s0fnO9HVgLzAAE7AG2ZP0flZnAkmrAOuBOYDpwEhgCBouqsRPhNXotsAY4l2DzDoLQ72WRRyYCS7oAuJfQKohWG2Lhfno9sIqgySHg+6WoGJIuk/QzSUOSHpF0TdE2TRZJ13gZhiT93FsjhRq0RNI2N2iTpEsKNSgDJM2S9GMv06CkGyf+Vnsm7SIk3QF8idDs2Qc8aGbv9GJMWZB0HvBVQttdhFbGE5NJq2uBJU0DvgJ8wg9tBR4ty7N /lkhaS/DNBjwDbDKzU7Ez/bL/+zwh6aNRMysBkpZK2u5l/lrszNZ4Ro9LujpqZiVC0ryUyHfGyuQGSTsk7ZS0PEomJcZr8k7ferrxtUp8rqSt/guuyzTxCiFpbap1cUZNuNpEF0iaAXwHuAB4HvhVb2ZWFzMbBH4HvA+4z58EO9JRYH/8vRe4DPgL8MN+bC10yY8IWswBviXpnE4XT1SDP0d44/AWcL+ZvZuJiRXGNbifoMlCQjOueyTNlvSk+5zrMrSxL/DH6p2u0ex213WqwesJPUzPm9lLmVtYcczsZUKn1rl0qMUtBZZ0BaFn6RSwOYaBfcIWQhfnKtdsHO1q8AbC4+Fvzez1SMZVHu+OHSJotaHVNeMElrSIcGP7L6GfIRqSdklaEDOPHBgkvLVZ7No10CCwv/1NfonHzeytyMatBg5JekjSwIRXlxDvlB/0jxtcw9ZIWumthl9KOj+2cWrkuKSN3ltXKSRNl/QL125l+lyzi7jV91sL6NsdAB4i1OjVOefdE/4yd5t/vDV9bkxgfyS+HngPeC4368azANhVQf+8lzDm43rXEmiswUuAacCfzezfORvXikr5Z/fFLxM0vCk5nhb4Ft8P52jXREwDNgKvVMQ/J9olWgaB3fAlfmx/zkadCVXxz4nAS3xwy1gNXkjognvVzI4WYdkZUmr/bGZ/B14FzgdugLrAy3xfJvfQiTL750TDZQA1bxgvbTpZBcrqnxMXu1SS1QijDGcCo2Y2Upxdk6Zs/nmEMFj8YmBOjSAuQNU7dUrhn/2NT6LlzBqNE0v6gTL450TLvhQYivfPiZYD/SpwQlH++awROCFv/9wgcHKTO97m4n4iL/+caHnW1OA0efjnlje5s6EGp4npnxtq8BQRqZGqzkUaUgCjwD3AQjPbnXHaiZajaYHL1mkSi1PAJmC+mcUasT7mdqdxdtXg3cA3zOxI5HwSLU+kBe7nGnyEIGzWrqAdYzW4RuqOl1PmeRLTz3 ZirOnbrzX4FPBT4LtmVkT7vq8FzsvPdqKlwHMLMiYr8vaznUi0PF4DjhH88ICkq9p/p7QU5Wdb4hoOEOIGvV7zHvix90iFWdY9ebRnJ0PyAnm/mSl5VB5uOll2dhNq7D0F3cQ60fCGPhH4EPAf4IqSz5g/AtxmZrcVfBNriaRLgcuBd4A/gQvs/14H/LoyuolS+dkOJNodSMLnpHvT9vm+TG6irH62HYl2iZakO5sPEAp0raQZZvZ2npa1oAzt2TPGZ31eS9DwheT4WA12QQ8TRF+Rt4EpSu1nO7AcOAc4nK6czR3uT/n+7mR0YI5Uxc+Ow7X6rH98Kn2uWeC9hKE/s4BPxTcNqJ6fbcXtBM1GCBq2R9Ki1JT9i2JaVfQwpyyQdKHqgaE6T+MC8FiOBwnjhe+OaVwF/WwrkuiBB1vFwWz30vNhQrSl1ZLmRDSu0vgk8DV4ZKpW17QU2ANl7iG0KL4Qy8A+IJkwv6ddcNFOr+2Tic4rpsIZjEchwuEqgkZb2l3XVmCf6Pykf/ymQlTVKRhzDd8mTALf0SlG50QDTx4hhOd+PyFGTd5t49KhEBXwPoImhwkataWjwGZ2GngAeA24EogbmK3k+HyWrwPzgKPA9zJptytEWE3aenf1nGBFkbTONdgu6UNZJ75Y0m88Tk0ZuzSjImm56oHp4pRf0h3+Cz4maV6UTEqIpCu9zEOSPtPNd7saXWlmvwaeJsxk/IGkm7v5fhXxMj5AKPOzZra9m+/3Gt5WwGYze6zbdKqApE8THrSS8LY/MbOT3aSRVYDmPYTYuqVYZaBXvDm6kfAg0VOA5l4NSYcYf7CE84a7RtKAlyWTEONZGJQOkr9ZFY4rLOlqL0NmQfJjLfPwLGGZhzeySD82PlRhPfAxMl7mYWqhkiosVJJGU0vtNJDnYlHHgEcJi0UVshyEQiy4FYSwvUnE1GotFtWMxi93dhJ4kTDgcH/ssWXeslnq2yKCK4CqL3eWRu0X7BPwC mGg3HDGC/Yt820+9XL234J9zajzkpNHCcEsTlBfZvJE02eoLzf5Ad/Sn+cCl6bS7P8lJ9uhqUVT80N9uuzv/wFReZvk3/McjgAAAABJRU5ErkJggg==')";
sa=document.createElement("div");sa.style.position="relative";sa.style.height=xa.canvas.offsetHeight.toString()+"px";sa.style.width=xa.canvas.offsetWidth.toString()+"px";sa.style.background="rgba(0, 0, 0, 0.5)";sa.style.zIndex="999";e.appendChild(sa);sa.appendChild(wa);wa.addEventListener("click",function(){c.hl&&(Pa.play(),Pa.pause());if(c.gl){if(va)for(var e=0;e<a.scenes.length;e++)q(a.scenes[e],!0);else q(Ca,!0);X.pause()}c.jl&&X.Pw();Q();b(c,d)},!1)}function Q(){if(wa){var a=xa.canvas.parentElement;
a.style.zIndex=Ia;sa.removeChild(wa);a.removeChild(sa);wa=sa=null;Ia=0}}function Z(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function N(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function da(a){var b=a.split("://",2);
return 1<b.length?(b[1]=N(b[1]),b.join("://")):N(a)}function P(a,b){hb[b]||ja(a,b);return hb[b]}function ja(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)D(c[e].objects,0,d);hb[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var g=c[f],h=0;h<g.length;h++)hb[b].push(g[h])}function D(a,b,c){c[b]=c[b]||[];for(var d=c[b],e=0;e<a.length;e++){var f=a[e],g=ga(f);d[g]=d[g]||[];(va||-1==Zb.indexOf(f.type))&&-1==d[g].indexOf(f)&&d[g].push(f);(f=f.dupli_group)&&D(f.objects,b+1,c)}}function ga(a){return(a=
a.parent||V.get_first_armature_object(a))?1+ga(a):0}var V=n("__animation"),w=n("__batch"),I=n("__config"),ia=n("__controls"),oa=n("__dds"),fa=n("__extensions");n("__lights");var U=n("__loader"),Y=n("__assets"),E=n("__md5"),ea=n("__objects"),na=n("__physics"),aa=n("__print"),Ua=n("__reformer"),la=n("__renderer"),M=n("__scenes"),Da=n("__nla"),X=n("__sfx"),gb=n("__shaders"),Pa=n("__textures"),Ha=n("__nodemat"),za=n("__util"),Yb=n("vec4"),$a=n("mat4"),ab=I.n,ya=I.Id,Na=I.fb,xb=I.Hd,Jb=I.yd,Va=null,hb=
null,rb="",va=!1,Ca=null,Xa={},wa=null,sa=null,Ia=0,Zb=["LAMP","CAMERA"],Za=["MESH","CAMERA","EMPTY"],sb=["SPEAKER"],xa=null;a.is_primary_loaded=function(a){return U.is_primary_loaded(a)};a.update=function(){U.Jy(Va)};a.Wb=function(a){xa=a};a.Gy=function(a,b){if(wa){sa.style.height=b.toString()+"px";sa.style.width=a.toString()+"px";var c=Math.round(a/2-44);wa.style.top=Math.round(b/2-44).toString()+"px";wa.style.left=c.toString()+"px"}};a.load=function(a,c,e,h,E){var m={load_main:{Ea:U.ve,Sa:!1,B:[],
Ta:!1,hb:500,qb:!1,Ia:g},duplicate_objects:{Ea:U.zc,Sa:!1,B:["load_main"],Ta:!1,hb:50,qb:!1,Ia:p},load_binaries:{Ea:U.ve,Sa:!1,B:["load_main"],Ta:!1,hb:500,qb:!1,Ia:d},prepare_bindata:{Ea:U.zc,Sa:!1,B:["duplicate_objects","load_binaries"],Ta:!1,hb:0,qb:!1,Ia:l},prepare_root_datablocks:{Ea:U.zc,Sa:!1,B:["duplicate_objects","prepare_bindata"],Ta:!1,hb:150,qb:!1,Ia:k},prepare_root_scenes:{Ea:U.zc,Sa:!1,B:["prepare_root_datablocks"],Ta:!1,hb:350,qb:!1,Ia:f},load_smaa_textures:{Ea:U.ve,Sa:!0,B:["prepare_root_scenes"],
Ta:!1,hb:10,qb:!0,Ia:G},load_shoremap:{Ea:U.ve,Sa:!0,B:["prepare_root_scenes"],Ta:!1,hb:10,qb:!0,Ia:F},load_textures:{Ea:U.ve,Sa:!0,B:["prepare_root_scenes"],Ta:!0,hb:500,qb:!1,Ia:B,He:{Xo:0}},add_physics_objects:{Ea:U.zc,Sa:!1,B:["load_shoremap"],Ta:!1,hb:20,qb:!1,Ia:r},add_objects:{Ea:U.zc,Sa:!1,B:["add_physics_objects"],Ta:!1,hb:800,qb:!1,Ia:W,Kf:T,Xg:S,He:{Vm:[],Bp:0}},load_speakers:{Ea:U.ve,Sa:!0,B:["add_objects"],Ta:!0,hb:30,qb:!1,Ia:u,He:{Ux:0}},mobile_media_start:{Ea:U.zc,Sa:!ab.Ye,B:["load_textures",
"load_speakers"],Ta:!0,hb:5,qb:!1,Ia:L,Kf:L},synchronize_media:{Ea:U.zc,Sa:!0,B:["mobile_media_start"],Ta:!0,hb:70,qb:!1,Ia:R},start_nla:{Ea:U.zc,Sa:!0,B:["mobile_media_start"],Ta:!1,hb:5,qb:!1,Ia:H}},q=U.Io();q||(q=U.hu(),Va=[],hb=[],Xa={});Va[q.Sc.length]={};return U.qu(m,a,c,e,b,h||Jb.dn,ab.do_not_load_resources,E)};a.unload=function(a){var b=U.Io();if(!b||!b.Sc.length||a&&!U.qy(b.Sc[a]))aa.error("Unable to unload data!");else{if(0==a)aa.log("%cUNLOAD ALL","color: #00a"),V.cleanup(),X.cleanup(),
Da.cleanup(),M.cleanup(),U.cleanup(),na.cleanup(),ea.cleanup(),za.cleanup(),la.cleanup(),Ha.cleanup(),gb.cleanup(),ia.cleanup(),fa.cleanup(),Y.cleanup(),Pa.cleanup(),hb=null,Xa={},va=!1,Va=Ca=null;else{aa.log("%cUNLOAD DATA "+a,"color: #00a");V.cx(a);for(var b=M.Ki(),c=0;c<b.length;c++)for(var d=b[c],e=M.la(d,"ALL",M.DATA_ID_ALL),f=e.length-1;0<=f;f--){var g=e[f];if(g.d.gd==a){var h=d,k=g;V.is_animated(k)&&V.remove(k);M.clear_glow_anim(k);na.has_physics(k)&&(na.disable_simulation(k),na.dx(k));ia.check_sensor_manifold(k)&&
ia.remove_sensor_manifold(k);M.ex(h,k);X.Yd(k)&&X.Vx(k);e.splice(f,1);h=M.la(d,g.type,M.DATA_ID_ALL);g=h.indexOf(g);-1!=g&&h.splice(g,1)}}}Q()}};a.set_debug_resources_root=function(a){rb=a}};b4w.module.__batch=function(a,n){function b(a){a={type:a,id:0,Ql:0,nf:"",R:[],$b:[],tc:[],El:[],dd:[],zf:null,Qa:{},Xb:null,Wa:null,cn:[],Jc:null,ab:null,fc:null,vb:null,Xn:!1,num_vertices:0,num_triangles:0,Yi:0,Zi:0,$f:0,Pi:0,el:0,Hb:new Float32Array(3),Jn:new Float32Array(3),Ec:new Float32Array(16),qa:!1,Kn:!1,M:!1,mc:!1,ka:!1,Sj:!1,kd:!1,Lb:!1,Mb:!1,rb:!1,Vb:!1,Kb:!1,uc:!1,xa:!1,$p:!1,jd:O.Ng,Cd:O.Zc,Bg:0,mm:new Float32Array(2),p:new Float32Array(2),No:!1,Ro:0,Oo:0,So:0,To:0,Qo:new Float32Array(3),
Po:new Float32Array(3),Ue:!1,Bc:0,Qd:0,Le:1,Lh:0,zq:0,Cj:1,Dh:0,Ke:0,ye:1,yp:0,Al:0,of:0,dq:0,hd:Array(2),lf:Array(4),Ld:new Float32Array(2),lc:new Float32Array(3),Qc:new Float32Array(3),zd:new Float32Array(3),nb:new Float32Array(4),nd:new Float32Array(4),cg:null,ol:null,ml:null,ll:null,nl:null,re:!1,water_dynamic:!1,zm:!1,ir:!1,jr:0,kr:0,hr:0,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,qo:new Float32Array(2),po:new Float32Array(2),Sk:new Float32Array(2),shallow_water_col:new Float32Array(3),
shore_water_col:new Float32Array(3),kf:null,Pl:!1,Lp:0,Hp:0,Il:0,Kp:0,Np:0,Mp:0,Ip:0,Jp:0,Jl:0,Ep:0,Dp:0,Pp:0,Gp:0,mj:new Float32Array(3),Op:new Float32Array(8),Fp:new Float32Array(16)};a.nb[3]=1;a.Kn=!0;a.M=!0;a.Bg=1;return a}function c(a,b,c){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=g.d,k=l(g.data.b4w_bounding_box),m=g.data.b4w_bounding_cylinder_radius,p=g.data.b4w_bounding_sphere_radius,q=g.data.b4w_bounding_sphere_center,r=g.data.b4w_bounding_ellipsoid_axes,w=g.data.b4w_bounding_ellipsoid_center;
if(h.bd){var p=Math.max(Math.abs(k.max_x),Math.abs(k.min_x)),m=Math.max(Math.abs(k.max_y),Math.abs(k.min_y)),t=Math.max(Math.abs(k.max_z),Math.abs(k.min_z)),t=Math.sqrt(p*p+m*m+t*t),p=Math.sqrt(p*p+m*m);k.max_x=k.max_y=k.max_z=t;k.min_x=k.min_y=k.min_z=-t;m=p;p=t;q[0]=q[1]=q[2]=0;r[0]=r[1]=r[2]=t;w[0]=w[1]=w[2]=0}h.Db=k;t=T.nk(k,h.G);h.Ha=t;var t=h,s=m;t.lk=T.Qn(s,k);t.jk=T.On(m,k);t.kk=T.Pn(s,k);q=T.Ck(p,q);h.rc=q;q=T.pk(q,h.G);h.jb=q;r=T.Bk([r[0],0,0],[0,r[1],0],[0,0,r[2]],w);h.Ee=r;r=T.ok(r,h.Tc);
h.Fe=r;e=e.concat(d(g,h,b,c))}return e}function g(a,b,c,e){for(var f=[],g=[],h={},k=0;k<a.length;k++){var m=a[k],p=m.d,q=l(m.data.b4w_bounding_box),r=T.nk(q,p.G),w=T.Ck(m.data.b4w_bounding_sphere_radius,m.data.b4w_bounding_sphere_center),t=T.pk(w,p.G),s=m.data.b4w_bounding_ellipsoid_axes,s=T.Bk([s[0],0,0],[0,s[1],0],[0,0,s[2]],m.data.b4w_bounding_ellipsoid_center),v=T.ok(s,p.Tc);p.Db=q;p.Ha=r;p.rc=w;p.jb=t;p.Ee=s;p.Fe=v;q={};q.Lb=p.Lb;q.Mb=p.Mb;q.rb=p.rb;q.Kc=p.Kc;q.lj=p.lj;q.Ni=p.Ni;q.Vb=p.Vb;q.Kb=
p.Kb;q.uc=p.uc;q.Ge=p.Ge;q.Vc=p.Vc;q.sd=p.sd;q.xb=p.xb;q.bd=p.bd;q.Ug=p.Ug;q.xa=p.xa;q.Qf=p.Qf;q.Gi=p.Gi;q.kd=p.kd;r=p.jb.t;q.Xv=0==c?[0,0]:[Math.floor(r[0]/c),Math.floor(r[2]/c)];q.Zd=p.Zd;q.wh=p.wh;q.ff=p.ff;p=JSON.stringify(q);h[p]=h[p]||[];h[p].push(m)}for(var x in h){q=JSON.parse(x);c=h[x];var m=N.Di("STATIC"),n;for(n in q)m[n]=q[n];m.gd=a[0].d.gd;m.Wc=0;m.ue=0;m.Nd=0;m.Md=0;m.Jd=0;m.ph=!1;for(k=0;k<c.length;k++)p=c[k],0==k?(m.Ha=I.ra(p.d.Ha),m.jb=I.ra(p.d.jb),m.Ee=I.ra(p.d.Ee),m.Fe=I.ra(p.d.Fe)):
(T.ho(m.Ha,p.d.Ha),T.Mu(m.jb,p.d.jb));m.Db=I.ra(m.Ha);m.rc=I.ra(m.jb);g.push({Fb:m,td:c})}for(a=0;a<g.length;a++)for(h=g[a].Fb,k=g[a].td,x=0;x<k.length;x++){n=k[x];c=d(n,h,b,e);m=H(n.d)||H(h);p={};h.Vc&&(p.au_center_pos=[m[0],m[1],m[2]],p.au_wind_bending_amp=[n.d.Wc],p.au_wind_bending_freq=[n.b4w_wind_bending_freq],p.au_detail_bending_amp=[n.b4w_detail_bending_amp],p.au_detail_bending_freq=[n.b4w_detail_bending_freq],p.au_branch_bending_amp=[n.b4w_branch_bending_amp]);for(q=0;q<c.length;q++)t=c[q].Fb,
r=c[q].Zb,w=c[q].k,t.Wi?t.bd?O.gy(r,m):O.Lq(r,m):("COLOR_ID"==w.type?(t=c[q].Fb=n.d,t.type="DYNAMIC",w.nf=n.uuid,A(w,t),y(w,I.Wg(t,0))):r=O.Lq(r,m),O.fy(r,p));f=f.concat(c)}return f}function d(a,c,d,e){var f=[];if(a.b4w_do_not_render)return f;for(var g=h(d,c),m=I.Wg(c,0),l=a.data,p=l.materials,q=0;q<g.length;q++)for(var r=g[q],w=0;w<p.length;w++){var t=p[w];if(("LENS_FLARES"!=t.name||0!=e)&&!O.Uo(l,w)){var v=b(r);if(k(v,t,!0)){v.jd=l.jd||O.Ng;"COLOR_ID"===r&&v.Jn.set(a.Nm);A(v,c);for(var x=v,n=a.particle_systems,
Y=0;Y<n.length;Y++){var U=n[Y].settings.b4w_vcol_from_name,V=n[Y].settings.b4w_vcol_to_name;""!==U&&""!==V&&(x.Qa[U]={Re:!1,src:[{name:U,jc:7}]})}"DYNAMIC"==c.type&&(v.nf=a.uuid);y(v,m);x=O.no(l,w,v.dd,v.fc,v.Qa,v.zf);"LENS_FLARES"==t.name&&(x=da.Sw(x));f.push({k:v,Zb:x,Rb:[t.name],Fb:c,vc:[a]})}}}g=a.particle_systems;if(0<g.length&&f.length){e=!0;for(q=0;q<g.length;q++)if(g[q].settings.use_render_emitter){e=!1;break}q=f[0].k;g=f[0].Zb;l=[];p=a.particle_systems;r=a.data;for(w=0;w<p.length;w++)if(t=
p[w],v=t.settings,v.count)if("EMITTER"==v.type){if("DYNAMIC"==c.type){x=b("PARTICLES");n=r.materials;Y=t.settings.material-1;Y>=n.length&&(R.warn('B4W Warning: Wrong material used for rendering particle system "'+t.name+'"'),Y=0);n=n[Y];"HALO"===t.settings.render_type&&(x.Ue=!0);k(x,n);A(x,c);Y=x;switch(t.settings.b4w_billboard_align){case "VIEW":s(Y,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":s(Y,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":s(Y,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");
break;case "ZX":s(Y,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}s(Y,"BILLBOARD",0);x.kd=!0;x.nf=a.name+"_"+v.uuid;y(x,m);x.Jc=t;v=da.hv(x,r,t,a.d.Tc);da.xx(x,t,n);l.push({k:x,Zb:v,Rb:[n.name],Fb:c,vc:[a]})}}else if("HAIR"==v.type){x=I.Ti(t.seed);v.b4w_dynamic_grass&&(c.Qf=!0);if(t.transforms.length)var z=t.transforms;else for(var n=O.Zk(g,v.count,!1,x),z=new Float32Array(4*n.length),u=0;u<n.length;u++)Y=.75+.5*I.kc(x),z[4*u]=n[u][0],z[4*u+1]=n[u][1],z[4*
u+2]=n[u][2],z[4*u+3]=Y;n=D.La(d,"GRASS_MAP")?!0:!1;if("OBJECT"==v.render_type)Y=[h(d,v.dupli_object.d)],t=K(a,c,q,g,[v.dupli_object],Y,[z],v,t,n,x,!1),l=l.concat(t);else if("GROUP"==v.render_type){U=v.dupli_group.objects;V=!1;Y=[];for(u=0;u<U.length;u++){var fa=h(d,v.dupli_group.objects[u].d);Y.push(fa)}if(v.use_whole_group){V=z;z=U;u={};for(fa=0;fa<V.length;fa+=4)for(var B=0;B<z.length;B++){var F=ia.create();ia.scale(z[B].d.e,z[B].d.scale,F);var G=ia.clone([V[fa],V[fa+1],V[fa+2]]);ia.add(G,F,G);
u[B]||(u[B]=new Float32Array(V.length));u[B][fa]=G[0];u[B][fa+1]=G[1];u[B][fa+2]=G[2];u[B][fa+3]=V[fa+3]}z=u;V=!0}else if(v.use_group_count){for(var G=U,H=v.dupli_weights,u=x,fa={},B=[],F=0;F<G.length;F++)for(var J=G[F],J=J.origin_name||J.name,W=0;W<H.length;W++){var L=H[W];J==L.name.split(": ")[0]&&B.push(L)}H.length!=B.length&&R.error("B4W Error: dupli weights match failed");for(F=0;F<z.length;F+=4){var N,H=B;N=[0];for(G=0;G<H.length;G++)N[G+1]=N[G]+H[G].count;H=N[N.length-1]*I.kc(u);for(G=J=0;G<
N.length;G++)if(H>=N[G]&&H<N[G+1]){J=G;break}N=J;fa[N]=fa[N]||[];fa[N].push(z[F],z[F+1],z[F+2],z[F+3])}for(N in fa)fa[N]=new Float32Array(fa[N]);z=fa}else{u=x;fa=U.length;B={};for(F=0;F<z.length;F+=4){var T=Math.floor(fa*I.kc(u));B[T]=B[T]||[];B[T].push(z[F],z[F+1],z[F+2],z[F+3])}for(T in B)B[T]=new Float32Array(B[T]);z=B}t=K(a,c,q,g,U,Y,z,v,t,n,x,V);l=l.concat(t)}"INSTANCE"==v.b4w_wind_bend_inheritance&&(a.d.Wc=0)}else throw"Unknown particle settings type";a=l;f=e?a:f.concat(a)}return f}function l(a){return{max_x:a.max_x,
min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function h(a,b){var c=["MAIN","NODES"];b.Kc&&(D.La(a,"COLOR_PICKING")||D.La(a,"GLOW_MASK"))&&c.push("COLOR_ID");D.La(a,"WIREFRAME")&&c.push("WIREFRAME");c.push("PHYSICS");(D.La(a,"DEPTH")||D.La(a,"SHADOW_CAST"))&&c.push("DEPTH");D.La(a,"GRASS_MAP")&&c.push("GRASS_MAP");if(b.Mb||b.Kb){var d=null;b.Mb&&(d=["MAIN","NODES","COLOR_ID","PHYSICS","WIREFRAME"]);if(b.Kb)var e=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],d=null!==d?I.et(d,
e):e;for(e=0;e<d.length;e++){var f=c.indexOf(d[e]);-1!==f&&c.splice(f,1)}}return c}function k(a,b,c){var d,g;switch(a.type){case "MAIN":if(b.b4w_collision||b.use_nodes)a=!1;else{for(var h=0;4>h;h++)a.lf[h]=new Float32Array([0,0]);p(a,b);h=b.game_settings.alpha_blend;a.mc=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;a.of=b.offset_z;a.Qc.set([1,1,1]);var k=b.texture_slots;oa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.nb);switch(b.name){case "LENS_FLARES":r(a,"special_lens_flares.glslv",
"special_lens_flares.glslf");u(a,"a_position");u(a,"a_texcoord");var l=c?[1,1,1,0]:null,l=v(k[0],l);F(a,l);break;default:r(a,"main.glslv","main.glslf");var q=m("use_map_color_diffuse",k),w=m("use_map_color_spec",k),n=m("use_map_normal",k),Y=m("use_map_mirror",k),I=m("use_stencil",k),h=q[0],w=w[0],n=n[0],Y=Y[0],q=q[1],k=I[0]&&m("use_rgb_to_intensity",k)[0];if(h){switch(h.blend_type){case "MIX":s(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":s(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}l=
"IMAGE"==h.texture.d.source&&c?[a.nb[0],a.nb[1],a.nb[2],1]:"ENVIRONMENT_MAP"==h.texture.d.source&&c?[.8,.8,.8,1]:null;l=v(h,l);F(a,l,"u_colormap0");a.Ke=h.diffuse_color_factor;a.ye=h.use_map_alpha?h.alpha_factor:0;a.Ld.set(h.texture.b4w_uv_velocity_trans);a.Qc.set(h.scale)}I=h&&h==w;w&&(I||(l=c?[.5,.5,.5,1]:null,l=v(w,l),F(a,l,"u_specmap0")),a.zq=w.specular_color_factor);if(n){u(a,"a_normal");u(a,"a_tangent");l=c?[.5,.5,1,1]:null;l=v(n,l);F(a,l,"u_normalmap0");a.yp=n.normal_factor;var V=n.texture;
a.lf[0].set(V.b4w_uv_velocity_trans);if(V.b4w_use_map_parallax&&U.Ch){var l=ga.u(V.b4w_parallax_steps),fa=ga.u(V.b4w_parallax_lod_dist);s(a,"PARALLAX",1);s(a,"PARALLAX_STEPS",l);s(a,"PARALLAX_LOD_DIST",fa);a.Dh=V.b4w_parallax_scale}}Y&&(l=c?[0,0,.5,1]:null,l=v(Y,l),F(a,l,"u_mirrormap"),a.Al=Y.mirror_factor);if(V=h&&q&&k?1:0)l=c?[.8,.8,.8,1]:null,l=v(q,l),F(a,l,"u_colormap1"),l=c?[.5,.5,.5,1]:null,l=v(k,l),F(a,l,"u_stencil0");(c=h||w||n)&&a.Qc.set(c.scale);s(a,"TEXTURE_SPEC",void 0==w?0:1);s(a,"TEXTURE_MIRROR",
void 0==Y?0:1);s(a,"ALPHA_AS_SPEC",I?1:0);s(a,"TEXTURE_STENCIL_ALPHA_MASK",V);u(a,"a_position");u(a,"a_normal");(h||w||n)&&u(a,"a_texcoord");if(b.b4w_water){a.re=!0;a.zm=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;c=b.texture_slots;r(a,"special_water.glslv","special_water.glslf");u(a,"a_position");u(a,"a_texcoord");u(a,"a_normal");u(a,"a_tangent");U.Uj?(u(a,"a_polyindex"),a.M=!0,a.wireframe_edge_color=[0,0,0],s(a,"DEBUG_WIREFRAME",1)):s(a,"DEBUG_WIREFRAME",0);I=m("use_map_normal",
c);Y=m("use_map_mirror",c)[0];I.length&&(V=v(I[0]),F(a,V,"u_normalmap0"));s(a,"NUM_NORMALMAPS",I.length);a.kf=Array(I.length);for(V=0;V<I.length;V++)a.lf[V].set(I[V].texture.b4w_uv_velocity_trans),a.kf[V]=new Float32Array(2),a.kf[V].set([I[V].scale[0],I[V].scale[1]]);Y?(s(a,"TEXTURE_MIRROR",1),I=v(Y),F(a,I,"u_mirrormap"),a.Al=Y.mirror_factor):s(a,"TEXTURE_MIRROR",0);Y=null;for(V=0;V<c.length;V++)if(d=c[V],!0===d.texture.b4w_water_foam){Y=d;break}Y&&U.Wf?(s(a,"FOAM",1),I=v(Y),F(a,I,"u_foam"),a.foam_factor=
b.b4w_foam_factor,a.qo.set(Y.texture.b4w_foam_uv_freq),a.po.set(Y.texture.b4w_foam_uv_magnitude),a.Sk[0]=Y.scale[0],a.Sk[1]=Y.scale[1]):s(a,"FOAM",0);for(V=0;V<c.length;V++)if(d=c[V],!0===d.texture.b4w_shore_dist_map){g=d;break}g&&U.ck?(g=v(g),F(a,g,"u_shore_dist_map"),s(a,"SHORE_PARAMS",1),g=d.texture.b4w_shore_boundings,s(a,"MAX_SHORE_DIST",ga.u(d.texture.b4w_max_shore_dist)),s(a,"SHORE_MAP_SIZE_X",ga.u(g[0]-g[1])),s(a,"SHORE_MAP_SIZE_Y",ga.u(g[2]-g[3])),s(a,"SHORE_MAP_CENTER_X",ga.u((g[0]+g[1])/
2)),s(a,"SHORE_MAP_CENTER_Y",ga.u((g[2]+g[3])/2))):s(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&U.deferred_rendering?(s(a,"GENERATED_MESH",1),a.ir=!0,a.jr=b.b4w_water_num_cascads,a.kr=b.b4w_water_subdivs,a.hr=b.b4w_water_detailed_dist):s(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){d=ga.u(b.b4w_water_dst_noise_scale0);g=ga.u(b.b4w_water_dst_noise_scale1);c=ga.u(b.b4w_water_dst_noise_freq0);var Y=ga.u(b.b4w_water_dst_noise_freq1),I=ga.u(b.b4w_water_dir_min_shore_fac),V=ga.u(b.b4w_water_dir_freq),l=
ga.u(b.b4w_water_dir_noise_scale),fa=ga.u(b.b4w_water_dir_noise_freq),A=ga.u(b.b4w_water_dir_min_noise_fac),y=ga.u(b.b4w_water_dst_min_fac),B=ga.u(b.b4w_water_waves_hor_fac);s(a,"DST_NOISE_SCALE_0",d);s(a,"DST_NOISE_SCALE_1",g);s(a,"DST_NOISE_FREQ_0",c);s(a,"DST_NOISE_FREQ_1",Y);s(a,"DIR_MIN_SHR_FAC",I);s(a,"DIR_FREQ",V);s(a,"DIR_NOISE_SCALE",l);s(a,"DIR_NOISE_FREQ",fa);s(a,"DIR_MIN_NOISE_FAC",A);s(a,"DST_MIN_FAC",y);s(a,"WAVES_HOR_FAC",B)}t(a,b);z(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);
a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;s(a,"ABSORB",ga.u(b.b4w_water_absorb_factor));s(a,"SSS_STRENGTH",ga.u(b.b4w_water_sss_strength));s(a,"SSS_WIDTH",ga.u(b.b4w_water_sss_width));d=a.Wa;g=a.dd;a.Wa=d;a.dd=g}"HALO"===b.type&&(d=b.halo,r(a,"halo.glslv","halo.glslf"),s(a,"NUM_RINGS",d.ring_count),s(a,"NUM_LINES",d.line_count),s(a,"NUM_STARS",d.star_tip_count),s(a,"SKY_STARS",b.b4w_halo_sky_stars?
1:0),a.dd=["a_position"],a.Ro=d.size,a.Oo=d.hardness/20,a.Qo.set(d.b4w_halo_rings_color),a.Po.set(d.b4w_halo_lines_color),a.So=1/b.b4w_halo_stars_blend_height,a.To=b.b4w_halo_stars_min_height,a.No=!0);s(a,"TEXCOORD",0);s(a,"NORMAL_TEXCOORD",0);h&&f(a,h,"TEXTURE_COLOR0_CO");q&&f(a,q,"TEXTURE_COLOR1_CO");k&&f(a,k,"TEXTURE_STENCIL_ALPHA_MASK_CO");w&&f(a,w,"TEXTURE_SPEC_CO");n&&f(a,n,"TEXTURE_NORM_CO");s(a,"SHADELESS",b.use_shadeless?1:0);a.Sj=b.use_shadeless}h=b.game_settings.alpha_blend;s(a,"ALPHA",
"OPAQUE"===h?0:1);s(a,"ALPHA_CLIP","CLIP"===h?1:0);s(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(s(a,"VERTEX_COLOR",1),u(a,"a_color")):s(a,"VERTEX_COLOR",0);a.Bc=b.ambient;a.Le=b.diffuse_intensity;a.Qd=b.emit;a.zd.set(b.specular_color);a.Cj=b.specular_alpha;t(a,b);z(a,b);b.b4w_wettable?s(a,"WETTABLE",1):s(a,"WETTABLE",0);x(a,b);U.Te?s(a,"UNROLL_LOOPS",1):s(a,"UNROLL_LOOPS",0);a.Pl=b.b4w_refractive;a.dq=b.b4w_refr_bump;a=!0}break;case "NODES":a=e(a,b);break;
case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_collision||"HALO"===b.type)a=!1;else if(p(a,b),a.qa)a=!1;else{r(a,"depth.glslv","depth.glslf");u(a,"a_position");u(a,"a_normal");h=b.game_settings.alpha_blend;s(a,"ALPHA","OPAQUE"===h?0:1);a.Qc.set([1,1,1]);if((b=m("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===h){a.Qc.set(b.scale);s(a,"TEXTURE_COLOR",1);u(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)h=v(b),F(a,h,"u_colormap0"),a.Ld.set(b.texture.b4w_uv_velocity_trans);
"NONE"==b.texture.d.source&&(h=v(b),F(a,h,"u_colormap0"),a.Ld.set(b.texture.b4w_uv_velocity_trans))}else s(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.Py=b.b4w_use_ghost,a.Ob=b.b4w_collision_id,a.Hn=b.b4w_collision_group,a.In=b.b4w_collision_mask,a.lh=b.physics.friction,a.fh=b.physics.elasticity,a=!0):b.b4w_water?(a.re=!0,a.Zy=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,
a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||b.b4w_collision||"HALO"===b.type)a=!1;else{p(a,b);a.Cd=O.Zc;a.M=!0;a.qa=!1;h=b.game_settings.alpha_blend;
a.mc=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;r(a,"color_id.glslv","color_id.glslf");u(a,"a_position");h=b.game_settings.alpha_blend;s(a,"ALPHA","OPAQUE"===h?0:1);a.Qc.set([1,1,1]);if((b=m("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===h){a.Qc.set(b.scale);s(a,"TEXTURE_COLOR",1);u(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)h=v(b),F(a,h,"u_colormap0"),a.Ld.set(b.texture.b4w_uv_velocity_trans);"NONE"==b.texture.d.source&&(h=v(b),F(a,h,"u_colormap0"),
a.Ld.set(b.texture.b4w_uv_velocity_trans))}else s(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":b.b4w_terrain?(p(a,b),a.qa=!1,a.Cd=O.Zc,a.M=!0,r(a,"grass_map.glslv","grass_map.glslf"),u(a,"a_position"),h=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.Qa.a_grass_size={Re:!0,src:[]},h?(a.Qa.a_grass_size.src.push({name:h,jc:4}),s(a,"DYNAMIC_GRASS_SIZE",1)):s(a,"DYNAMIC_GRASS_SIZE",0),a.Qa.a_grass_color={Re:!0,src:[]},b?(a.Qa.a_grass_color.src.push({name:b,
jc:7}),s(a,"DYNAMIC_GRASS_COLOR",1)):s(a,"DYNAMIC_GRASS_COLOR",0),U.Te?s(a,"UNROLL_LOOPS",1):s(a,"UNROLL_LOOPS",0),a=!0):a=!1;break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_collision||"HALO"===b.type?a=!1:(r(a,"wireframe.glslv","wireframe.glslf"),u(a,"a_position"),u(a,"a_normal"),u(a,"a_polyindex"),a.M=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],U.Te?s(a,"UNROLL_LOOPS",1):s(a,"UNROLL_LOOPS",0),a=!0);break;case "PARTICLES":h=b.texture_slots;if(a.Ue)r(a,"particles_color.glslv",
"particles_color.glslf");else if(r(a,"particles_texture.glslv","particles_texture.glslf"),h=m("use_map_color_diffuse",h)[0]){s(a,"TEXTURE_COLOR",1);switch(h.blend_type){case "MIX":s(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":s(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.Ke=h.diffuse_color_factor;a.ye=h.use_map_alpha?h.alpha_factor:0;h=v(h);F(a,h)}oa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.nb);a.Bc=b.ambient;a.Le=b.diffuse_intensity;
a.Qd=b.emit;a.zd.set(b.specular_color);a.Cj=b.specular_alpha;u(a,"a_position");u(a,"a_normal");h=b.game_settings.alpha_blend;s(a,"ALPHA","OPAQUE"===h?0:1);s(a,"ALPHA_CLIP","CLIP"===h?1:0);s(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);t(a,b);z(a,b);p(a,b);h=b.game_settings.alpha_blend;a.mc=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;a.of=b.offset_z;U.Te?s(a,"UNROLL_LOOPS",1):s(a,"UNROLL_LOOPS",0);a=!0;break;default:throw"Wrong batch type: "+a.type;}return a}function f(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":s(a,
c,"TEXTURE_COORDS_UV_ORCO");s(a,"TEXCOORD",1);break;case "NORMAL":s(a,c,"TEXTURE_COORDS_NORMAL");s(a,"NORMAL_TEXCOORD",1);break;default:s(a,c,0)}}function p(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.qa=!0;a.Cd=O.Mm;a.M=!0;break;case "ALPHA":a.qa=!0;a.Cd=O.Zc;a.M=!0;break;case "CLIP":a.qa=!1;a.Cd=O.Zc;a.M=!0;break;case "ADD":a.qa=!0;a.Cd=O.Zc;a.M=!1;break;case "OPAQUE":a.qa=!1;a.Cd=O.Zc;a.M=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.ka=c.use_backface_culling}
function v(a,b){var c=a.texture,d=c.d,c=c.image;d&&b&&c&&V.Pj(d,b,c.dc,c.filepath);return d}function m(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];1==f[a]&&f.texture&&f.texture.d&&c.push(f)}return c}function x(a,b){var c=b.raytrace_transparency;a.nd[0]=c.fresnel;a.nd[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.Lh=c.reflect_factor;a.nd[2]=c.fresnel;a.nd[3]=1-c.fresnel_factor/5}function t(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":s(a,"SPECULAR_SHADER","SPECULAR_PHONG");
c=b.specular_hardness;break;case "WARDISO":s(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":s(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;d=b.specular_toon_smooth;break;default:R.error("B4W Error: unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.lc[0]=b.specular_intensity;a.lc[1]=c;a.lc[2]=d}function z(a,b){switch(b.diffuse_shader){case "LAMBERT":s(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.hd[0]=0;a.hd[1]=
0;break;case "OREN_NAYAR":s(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.hd[0]=b.roughness;a.hd[1]=0;break;case "FRESNEL":s(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.hd[0]=b.diffuse_fresnel;a.hd[1]=b.diffuse_fresnel_factor;break;default:R.error("B4W Error: unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.hd[0]=0,a.hd[1]=0}}function e(a,b){if(!b.use_nodes)return!1;var c=Z.Jt(b.node_tree,b.uuid,!1);if(!c)return R.error('Failed to create node graph for material "'+b.name+'", disable nodes'),
B(a,b),!0;r(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;s(a,"ALPHA","OPAQUE"===d?0:1);s(a,"ALPHA_CLIP","CLIP"===d?1:0);s(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);u(a,"a_position");p(a,b);a.of=b.offset_z;d=b.game_settings.alpha_blend;a.mc=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;oa.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.nb);a.Qd=b.emit;a.Bc=b.ambient;x(a,b);b.b4w_wettable?s(a,"WETTABLE",1):s(a,"WETTABLE",0);a.El=Z.Kt(c);var e=
!1;Q.J(c,function(c,d){switch(d.type){case "GEOMETRY_UV":var f=d.data.name,g=d.data.value;a.zf||(a.zf={});a.zf[g]=f;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":f=d.data.name;a.Qa[f]={Re:!0,src:[{name:d.data.value}]};g=0;if("GEOMETRY_VC"==d.type)g=7;else for(var h=0;h<d.Oa.length;h++){var k="RGB".indexOf(d.Oa[h].identifier);-1<k&&(g|=1<<2-k)}a.Qa[f].src[0].jc=g;break;case "GEOMETRY_NO":u(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":f=d.data.value;
u(a,"a_normal");s(a,"DIFFUSE_SHADER","DIFFUSE_"+f.diffuse_shader);s(a,"SPECULAR_SHADER","SPECULAR_"+f.specular_shader);s(a,"SHADELESS_MAT",f.use_shadeless?1:0);a.Sj=f.use_shadeless;a.Cj=f.specular_alpha;e=!0;break;case "TEXTURE_COLOR":case "TEXTURE_COLOR2":case "TEXTURE_COLOR3":case "TEXTURE_COLOR4":case "TEXTURE_ENVIRONMENT":f=d.data.name;g=d.data.value;!1!==g.d.li&&(g.d.li="TEXTURE_ENVIRONMENT"!=d.type?!0:!1);F(a,g.d,f);break;case "TEXTURE_NORMAL":case "TEXTURE_NORMAL2":case "TEXTURE_NORMAL3":case "TEXTURE_NORMAL4":case "PARALLAX":s(a,
"CALC_TBN_SPACE",1);u(a,"a_normal");u(a,"a_tangent");f=d.data.name;(g=d.data.value)?(g.d.li=!1,F(a,g.d,f)):R.error("Missing texture in node ",d.name,"for material ",b.name);break;case "LAMP":d.data&&(a.cg=d.data);break;case "REFRACTION":a.Pl=!0}});e||(a.Sj=!0);U.Te?s(a,"UNROLL_LOOPS",1):s(a,"UNROLL_LOOPS",0);return!0}function B(a,b){r(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;s(a,"ALPHA","OPAQUE"===c?0:1);s(a,"ALPHA_CLIP","CLIP"===c?1:0);s(a,"SHADELESS",1);u(a,"a_position");u(a,
"a_normal");oa.set(1,0,1,1,a.nb);s(a,"VERTEX_COLOR",0);a.of=b.offset_z;p(a,b)}function A(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.Wi?s(a,"AU_QUALIFIER","attribute"):s(a,"AU_QUALIFIER","uniform"),s(a,"STATIC_BATCH",0)):(s(a,"AU_QUALIFIER","attribute"),s(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(L.Lv()?s(a,"WIREFRAME_QUALITY",1):s(a,"WIREFRAME_QUALITY",0),a.Jk?(s(a,"DEBUG_SPHERE",1),a.Xn?s(a,"DEBUG_SPHERE_DYNAMIC",1):s(a,"DEBUG_SPHERE_DYNAMIC",0)):s(a,"DEBUG_SPHERE",0),s(a,"ALPHA",1));b.Vc?
(""!==b.sd?(a.Qa.a_bending_col_main={Re:!0,src:[{name:b.sd,jc:4}]},u(a,"a_bending_col_main"),""!==b.xb.mp&&""!==b.xb.lp&&""!==b.xb.Cp?(a.Qa.a_bending_col_detail={Re:!0,src:[{name:b.xb.mp,jc:4},{name:b.xb.lp,jc:2},{name:b.xb.Cp,jc:1}]},u(a,"a_bending_col_detail"),u(a,"a_normal"),s(a,"DETAIL_BEND",1)):s(a,"DETAIL_BEND",0),s(a,"MAIN_BEND_COL",1)):s(a,"MAIN_BEND_COL",0),s(a,"WIND_BEND",1)):s(a,"WIND_BEND",0);b.ri?s(a,"BEND_CENTER_ONLY",1):s(a,"BEND_CENTER_ONLY",0);b.bd?s(a,"BILLBOARD",1):s(a,"BILLBOARD",
0);b.bd&&b.Wi?s(a,"HAIR_BILLBOARD",1):s(a,"HAIR_BILLBOARD",0);b.mk?s(a,"BILLBOARD_SPHERICAL",1):s(a,"BILLBOARD_SPHERICAL",0);switch(b.Ug){case "RANDOM":s(a,"BILLBOARD_RANDOM",1);s(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":s(a,"BILLBOARD_RANDOM",0);s(a,"BILLBOARD_JITTERED",1);break;default:s(a,"BILLBOARD_RANDOM",0),s(a,"BILLBOARD_JITTERED",0)}b.xa&&U.ck?s(a,"DYNAMIC_GRASS",1):s(a,"DYNAMIC_GRASS",0);a.xa=b.xa;a.kd=b.kd;a.Lb=b.Lb;a.Mb=b.Mb;a.rb=b.rb&&!a.Sj&&!(a.qa&&U.ao);a.Vb=b.Vb;a.Kb=b.Kb;a.uc=
b.uc;b.sh?(u(a,"a_influence"),s(a,"SKINNED",1),b.kh?s(a,"FRAMES_BLENDING",1):s(a,"FRAMES_BLENDING",0),s(a,"MAX_BONES",b.max_bones)):(s(a,"SKINNED",0),s(a,"FRAMES_BLENDING",0));b.ai?(s(a,"VERTEX_ANIM",1),U.fr?s(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",.5):s(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):s(a,"VERTEX_ANIM",0);if(b.sh&&b.ai)throw"Skinning and vertex animation are mutually exlusive";b.Gi?s(a,"DISABLE_FOG",1):s(a,"DISABLE_FOG",0);b.fc&&(a.fc=b.fc);if(b.hf&&"NODES"==a.type){for(var c=
a.El,d=b.xh,e=0;e<c.length;e++){var f=c[e];switch(f.id){case "ANIM_VALUE":for(var g=f.oj[1],h=0;h<d.length;h+=2)if(d[h]==g){f.oj[0]=d[h+1];break}}}s(a,"NUM_ANIM_VALUES",b.hf.length)}}}function u(a,b){var c=a.dd;-1==c.indexOf(b)&&c.push(b)}function s(a,b,c){ga.I(a.Wa,b,c)}function q(a,b){if("PHYSICS"==a.type)a.Zb=b;else{var c=a.Cd,d=a.jd;a.No&&(b=O.Qu(b));a.ir&&(b=P.lv(a.jr,a.kr,a.hr));c=O.iy(b,c,d,a.Qa);a.kd||c.Si||(c.Vd=null,c.Uc=null);a.ab=c;c=b.r.length;a.num_vertices=b.C*c;a:switch(a.jd){case O.Ng:case O.gi:case O.Dm:d=
!0;break a;default:d=!1}d?O.mw(b)?a.num_triangles=b.X.length/3*c:a.num_triangles=b.C/3*c:a.num_triangles=0}}function K(a,c,d,e,f,g,h,m,l,p,q,r){var t=[],v=m.b4w_dynamic_grass;if(!p&&v)return t;for(var s="INSTANCE"==m.b4w_wind_bend_inheritance,x="INSTANCE"==m.b4w_shadow_inheritance,n="INSTANCE"==m.b4w_reflection_inheritance,Y=[],V=[],U=0;U<f.length;U++){var z=f[U],u=I.Yg(c);u.bd=m.b4w_hair_billboard;u.Ug=m.b4w_hair_billboard_type;u.mk="SPHERICAL"==m.b4w_hair_billboard_geometry;u.xa=v;u.Wi=!0;u.hf=
z.d.hf;u.xh=z.d.xh;s?(u.Vc=z.d.Vc,u.ei=z.d.ei,u.ue=z.d.ue,u.Nd=z.d.Nd,u.sd=z.d.sd,u.Md=z.d.Md,u.Jd=z.d.Jd,u.Wc=z.d.Wc,u.xb=z.d.xb,u.ri=!1):(u.Vc=a.d.Vc,u.ei=a.d.ei,u.ue=a.d.ue,u.Nd=a.d.Nd,u.sd=a.d.sd,u.Md=a.d.Md,u.Jd=a.d.Jd,u.Wc=a.d.Wc,u.xb=a.d.xb,u.ri=!0);x?(u.Lb=z.d.Lb,u.Mb=z.d.Mb,u.rb=z.d.rb):(u.Lb=a.d.Lb,u.Mb=a.d.Mb,u.rb=a.d.rb);n?(u.Vb=z.d.Vb,u.Kb=z.d.Kb,u.uc=z.d.uc):(u.Vb=a.d.Vb,u.Kb=a.d.Kb,u.uc=a.d.uc);Y.push(u);var B=h[U];B||(B=new Float32Array);r&&I.Ti(l.seed,q);for(var F=new Float32Array(3),
G=new Float32Array([0,0,0,1]),D=[],K=0;K<B.length;K+=4){F[0]=B[K];F[1]=B[K+1];F[2]=B[K+2];var H=B[K+3];if(m.b4w_initial_rand_rotation){switch(m.b4w_rotation_type){case "XYZ":var J=new Float32Array([I.kc(q),I.kc(q),I.kc(q)]);ia.normalize(J,J);break;case "Z":J=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+m.b4w_rotation_type;}fa.setAxisAngle(J,m.b4w_rand_rotation_strength*(2*Math.PI*I.kc(q)-Math.PI),G)}var W=w.Of(F,H,G);D.push(W)}V.push(D)}for(var L={},U=0;U<f.length;U++){var N=
g[U],u=Y[U],T=I.Wg(u,0),D=V[U];if(D.length)for(var P=f[U].data,S=P.materials,K=0;K<S.length;K++)if(!O.Uo(P,K))for(var Q=0;Q<N.length;Q++){var Z=N[Q];if("COLOR_ID"!==Z){var da=b(Z),ga=S[K];if(k(da,ga,!0)){da.jd=P.jd||O.Ng;A(da,u);da.nf=m.uuid;"JITTERED"==m.b4w_hair_billboard_type&&(da.Yi=m.b4w_hair_billboard_jitter_amp,da.Zi=m.b4w_hair_billboard_jitter_freq);v&&(da.Pi=m.b4w_dynamic_grass_scale_threshold);s||(delete da.Qa.a_bending_col_main,delete da.Qa.a_bending_col_detail);y(da,T);var ja=O.no(P,K,
da.dd,da.fc,da.Qa,da.zf),lb=[];if(u.Vc||u.xa||u.bd)lb.au_wind_bending_amp=[u.Wc],lb.au_wind_bending_freq=[u.ue],lb.au_detail_bending_freq=[u.Nd],lb.au_detail_bending_amp=[u.Md],lb.au_branch_bending_amp=[u.Jd];var Ya=O.vw(ja,lb,D),yb=Ya,dc=D;yb.A.au_center_pos=new Float32Array(3*yb.C);for(var Mb=dc.length,Ub=yb.C/Mb,Vb=0;Vb<Mb;Vb++)for(var lc=dc[Vb],ua=3*Ub*Vb,Nb=0;Nb<Ub;Nb++)yb.A.au_center_pos[ua+3*Nb]=lc[0],yb.A.au_center_pos[ua+3*Nb+1]=lc[1],yb.A.au_center_pos[ua+3*Nb+2]=lc[2];Ya=yb;if(u.ri){var bb=
Ya,ra=a.d.G;bb.A.a_emitter_center=new Float32Array(3*bb.C);var zb=oa.fromValues(0,0,0,1);oa.transformMat4(zb,ra,zb);for(var ca=0;ca<bb.C;ca++)bb.A.a_emitter_center[3*ca]=zb[0],bb.A.a_emitter_center[3*ca+1]=zb[1],bb.A.a_emitter_center[3*ca+2]=zb[2];Ya=bb}var Sa=m.b4w_vcol_from_name,cb=m.b4w_vcol_to_name,ma=da,Ja=d,db=!s,ta=P,Ta=[];if(""!==Sa&&""!==cb){var pa,Ka=cb,Ab=ma.Qa,ec=[],$b=void 0;for($b in Ab)for(var ac=Ab[$b].src,tb=0,Bb=0;Bb<ac.length;Bb++){var mc=ac[Bb].jc;Ka==ac[Bb].name&&ec.push($b,mc,
tb);tb+=I.vf(mc)}pa=ec;if(0<pa.length)for(var Cb=0;Cb<pa.length;Cb+=3)Ta.push({gh:Sa,Ji:7,pj:pa[Cb],qj:pa[Cb+1],Hi:pa[Cb+2]});else O.Yv(ma.dd,"a_color")&&cb==ta.active_vcol_name&&Ta.push({gh:Sa,Ji:7,pj:"a_color",qj:7,Hi:0})}db&&("a_bending_col_main"in Ja.Qa&&Ta.push({gh:"a_bending_col_main",Ji:4,pj:"a_bending_col_main",qj:4,Hi:0}),"a_bending_col_detail"in Ja.Qa&&Ta.push({gh:"a_bending_col_detail",Ji:7,pj:"a_bending_col_detail",qj:7,Hi:0}));for(var ub=Ya,nc=D,Ob=e,La=Ta,bc=da.Qa,oc=!1,Oa=0;Oa<La.length;Oa++){var mb=
La[Oa].gh,Db=Ob.A[mb];if(Db&&0<Db.length){oc=!0;break}}if(oc){var pc,Ea=a.d.Db,Ma=Ob.r[0].a_position,C=nc,ka=L,Ba=new Float32Array(3),qa=new Float32Array(3),Wb=new Uint32Array(C.length);if(!("verts_indices"in ka)){ka.cd=new Float32Array(3);ka.ad=new Float32Array(3);ka.vm=new Uint32Array(Ma.length/3);ka.zh=new Uint32Array(Ma.length/3);ka.cd[0]=(Ea.max_x-Ea.min_x)/20;ka.cd[1]=(Ea.max_y-Ea.min_y)/20;ka.cd[2]=(Ea.max_z-Ea.min_z)/20;ka.ad[0]=Ea.min_x;ka.ad[1]=Ea.min_y;ka.ad[2]=Ea.min_z;for(var ba=0;ba<
Ma.length/3;ba++){var ib=I.trunc((Ma[3*ba]-ka.ad[0])/ka.cd[0]),jb=I.trunc((Ma[3*ba+1]-ka.ad[1])/ka.cd[1]),Pb=I.trunc((Ma[3*ba+2]-ka.ad[2])/ka.cd[2]),ib=I.clamp(ib,0,19),jb=I.clamp(jb,0,19),Pb=I.clamp(Pb,0,19);ka.vm[ba]=ba;ka.zh[ba]=Pb*Math.pow(20,2)+20*jb+ib}O.Tx(ka.zh,ka.vm,!0);ka.Bf=new Uint32Array(Math.pow(20,3));for(ba=0;ba<ka.zh.length;ba++)ka.Bf[ka.zh[ba]]++;delete ka.zh;for(ba=1;ba<ka.Bf.length;ba++)ka.Bf[ba]+=ka.Bf[ba-1]}for(var nb=0;nb<C.length;nb++){Ba[0]=C[nb][0];Ba[1]=C[nb][1];Ba[2]=C[nb][2];
for(var Qb=1E10,vb=-1,Eb=I.trunc((Ba[0]-ka.ad[0])/ka.cd[0]),Rb=I.trunc((Ba[1]-ka.ad[1])/ka.cd[1]),Aa=I.trunc((Ba[2]-ka.ad[2])/ka.cd[2]),Eb=I.clamp(Eb,0,19),Rb=I.clamp(Rb,0,19),Aa=I.clamp(Aa,0,19),Fa=Aa*Math.pow(20,2)+20*Rb+Eb,Ec=ka.Bf[Fa],Fb=0==Fa?0:ka.Bf[Fa-1];Fb<Ec;Fb++){var vc=ka.vm[Fb];qa[0]=Ma[3*vc];qa[1]=Ma[3*vc+1];qa[2]=Ma[3*vc+2];ia.sub(qa,Ba,qa);var Fc=ia.sqrLen(qa);Fc<=Qb&&(Qb=Fc,vb=vc)}if(-1==vb)for(Fb=0;Fb<Ma.length/3;Fb++)qa[0]=Ma[3*Fb],qa[1]=Ma[3*Fb+1],qa[2]=Ma[3*Fb+2],ia.sub(qa,Ba,
qa),Fc=ia.sqrLen(qa),Fc<=Qb&&(Qb=Fc,vb=Fb);Wb[nb]=vb}pc=Wb;for(var jd=ub.C/nc.length,Oa=0;Oa<La.length;Oa++){var Xb=La[Oa].pj,fc=La[Oa].qj,mb=La[Oa].gh,ob=La[Oa].Ji,Db=Ob.A[mb];switch(Xb){case "a_bending_col_main":var Gb=1;break;case "a_bending_col_detail":Gb=3;break;case "a_color":Gb=3;break;default:for(var pb=Gb=0;pb<bc[Xb].src.length;pb++)Gb+=I.vf(bc[Xb].src[pb].jc)}if(Db&&0<Db.length){var gc=I.vf(ob),wc=I.vf(fc),xc=ob&fc,wb=I.iq(xc);xc!=fc&&R.error("Wrong color extraction from "+mb+" to "+Xb+
".");if("a_bending_col_main"==Xb||"a_bending_col_detail"==Xb)ub.A[Xb]=new Float32Array(ub.C*wc);for(pb=0;pb<nc.length;pb++){var Hb=pc[pb],Ib=Hb*gc,eb=pb*jd*Gb;if(-1!=Hb)for(var Sb=0;Sb<jd;Sb++)for(var yc=Sb*Gb,fb=0;fb<wb.length;fb++)wb[fb]&&(ub.A[Xb][eb+yc+(La[Oa].Hi+I.Ph(fc,fb))]=Db[Ib+I.Ph(ob,fb)])}}else ub.A[Xb]=new Float32Array(0)}}Ya=ub;t.push({k:da,Zb:Ya,Rb:[ga.name],Fb:u,vc:[a]})}}}}return t}function H(a){return w.Of(a.e,a.scale,a.quat)}function y(a,b){for(var c=null,d=null,e=null,f=0;f<a.R.length;f++){var g=
a.R[f].jj;g&&(c||(c={}),c[f]=g,a.R[f].jj=null);if(g=a.R[f].Jf)d||(d={}),d[f]=g,a.R[f].Jf=null;if(g=a.R[f].Ra)e||(e={}),e[f]=g,a.R[f].Ra=null}a.id=0;a.Ql=b;a.id=I.Wg(a,b);if(c)for(f in c)a.R[f].jj=c[f];if(d)for(var h in d)a.R[h].Jf=d[h];if(e)for(h in e)a.R[h].Ra=e[h]}function J(a,c,d,e,f){var g=b("WIREFRAME");r(g,"wireframe.glslv","wireframe.glslf");g.wireframe_mode=0;g.Jk=!0;g.M=!0;g.nf=d;f&&(g.Xn=!0);A(g,c);y(g,I.Wg(c,0));e?(c=P.xo(1,a.t),O.nx(c,[a.Be[0],a.Ce[1],a.De[2]],a.t)):c=P.xo(a.ma,a.t);O.jm(c,
1,!0);c.A.a_polyindex=O.mo(c);q(g,c);return g}function r(a,b,c){a.Wa={$h:b,jh:c,Od:[]};ga.wx(a.Wa)}function F(a,b,c){1==a.R.length&&0==a.$b.length&&a.$b.push("default0");c=c||"default"+String(a.R.length);-1==a.$b.indexOf(c)&&(a.R.push(b),a.$b.push(c))}function G(a){if(!a.Wa)throw"No shaders info for batch "+a.name;a.Xb=ga.xv(a.Wa,a.El);ja.ht(a.Xb);ja.$m(a)}function W(a,b,c){var d=a.Wa;ga.I(d,"SHADOW_SRC",b);ga.I(d,"SHADOW_DST",c);return a}var T=n("__boundings"),S=n("__config"),R=n("__print"),L=n("__extensions"),
O=n("__geometry"),Q=n("__graph"),Z=n("__nodemat"),N=n("__objects"),da=n("__particles"),P=n("__primitives");n("__reformer");var ja=n("__renderer"),D=n("__scenegraph");n("__scenes");var ga=n("__shaders"),V=n("__textures"),w=n("__tsr"),I=n("__util"),ia=n("vec3"),oa=n("vec4"),fa=n("quat"),U=S.n,Y=["MAIN","NODES"];a.FA=b;a.kv=function(a,d,e,f,h){for(var k=[],m=[],l=0;l<e.length;l++){var p=e[l];switch(p.d.type){case "DYNAMIC":k.push(p);break;case "STATIC":m.push(p)}}e=[];e=e.concat(c(k,a,h));a=e=e.concat(g(m,
a,d,h));l=[];p=[];d={};for(e=0;e<a.length;e++){k=a[e].k;m=a[e].Fb;h=null;if(k.id in d){var w=d[k.id],t=p[w].Fb;I.Kq(k,p[w].k)&&I.Kq(m,t)&&(h=p[w]);if(!h){do k.id++;while(d[k.id])}}h||(h={k:k,Fb:a[e].Fb,vc:[],Mq:[],Rb:[]},d[k.id]=p.length,p.push(h));h.vc=h.vc.concat(a[e].vc);a[e].Zb&&a[e].Zb.C&&h.Mq.push(a[e].Zb);if(h.Rb.length)for(k=0;k<a[e].Rb.length;k++)m=a[e].Rb[k],-1==h.Rb.indexOf(m)&&h.Rb.push(m);else h.Rb=a[e].Rb}for(e=0;e<p.length;e++){a=p[e].Mq;if(0==a.length)a=I.lb(I.Lj("%empty"));else if(1==
a.length)a=a[0];else{d=[];for(k=0;k<a.length;k++)O.nw(a[k])||d.push(k);if(d.length<a.length)for(k=0;k<d.length;k++)O.jm(a[d[k]]);a=O.hy(a)}l.push({k:p[e].k,Fb:p[e].Fb,Zb:a,Rb:p[e].Rb,vc:p[e].vc})}e=l;for(l=0;l<e.length;l++)q(e[l].k,e[l].Zb),e[l].k.tc=e[l].Rb;a=[];for(l=0;l<e.length;l++)if(d=e[l].k,"STATIC"==e[l].Fb.type)p=I.Zo(I.Lj("%meta")),p.d=e[l].Fb,p.O=[d],a.push(p);else for(h=[],k=0;k<e[l].vc.length;k++)if(p=e[l].vc[k],-1==h.indexOf(p.name)){for(m=0;m<p.O.length;m++)if(p.O[m]==d)throw"Batch already exist in object";
p.O.push(d);h.push(p.name)}if(U.wireframe_debug){for(l=0;l<e.length;l++)d=e[l].Fb,"DYNAMIC"==d.type&&(p=e[l].vc[0],-1<Y.indexOf(e[l].k.type)&&(d=J(d.Ee,d,p.name,!0,!0),p.O.push(d)));for(l=0;l<a.length;l++)p=a[l],d=p.d,-1<Y.indexOf(p.O[0].type)&&(d=J(d.rc,d,p.name,!1),p.O.push(d))}p=null;if(f.texture_slots)for(l=0;l<f.texture_slots.length;l++)if(f.texture_slots[l].texture.b4w_use_as_skydome){p=v(f.texture_slots[l],null);break}if(f.b4w_sky_settings.procedural_skydome||p)d=b("MAIN"),r(d,"special_skydome.glslv",
"special_skydome.glslf"),f.b4w_sky_settings.procedural_skydome?d.$p=!0:F(d,p,"u_sky"),f.b4w_sky_settings.reflexible&&(d.Vb=!0,f.b4w_sky_settings.reflexible_only&&(d.Kb=!0)),u(d,"a_position"),d.of=99999,f=P.jv(),q(d,f),p=I.Zo(I.Lj("%meta")),p.d=N.Di("DYNAMIC"),p.d.Qf=!0,p.d.Db=T.Xc(),p.d.rc=T.fi(),p.d.Ha=T.Xc(),p.d.jb=T.fi(),p.O=[d],a.push(p);return a};a.$y=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+
1)+2)/2-1)/b};a.jt=l;a.uv=v;a.gk=function(a,b){s(a,"CSM_SECTION0",0);s(a,"CSM_SECTION1",0);s(a,"CSM_SECTION2",0);s(a,"CSM_SECTION3",0);for(var c=0;c<b.csm_num;c++)s(a,"CSM_SECTION"+String(c),1);s(a,"SHADOW_TEX_RES",ga.u(b.csm_resolution));s(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);s(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)};a.T=s;a.eb=function(a,b){return ga.Dv(a.Wa,b)};a.ni=F;a.hx=function(a,b,c){c=a.$b.indexOf(c);-1<c&&(a.R[c]=b)};a.iu=function(a,c){var d=b("MAIN");
d.qa=!0;oa.set(c[0],c[1],c[2],.5,d.nb);d.jd=O.gi;q(d,a);r(d,"main.glslv","main.glslf");s(d,"SHADELESS",1);G(d);return d};a.sb=G;a.zt=function(a){return a.Xb.Fh.length?a.Xb.Ll.u_cube_fog?!0:!1:!1};a.ju=function(a,c){var d=b("DEPTH");d.ka=a.ka;d.Qc.set(a.Qc);d.xa=a.xa;d.ab=a.ab;d.id=a.id;d.Ql=a.Ql;a.R.length&&(d.R[0]=a.R[0],d.$b[0]=a.$b[0]);d.Ld.set(a.Ld);d.dd=a.dd;d.Yi=a.Yi;d.Zi=a.Zi;d.Pi=a.Pi;d.num_triangles=a.num_triangles;d.num_vertices=a.num_vertices;d.nf=a.nf;for(var e=0;e<a.tc.length;e++)d.tc.push(a.tc[e]);
d.Jc=a.Jc;a.vb||(a.vb=[]);a.vb.push(d);r(d,"depth.glslv","depth.glslf");ga.dw(d.Wa,a.Wa);return d=W(d,"SHADOW_SRC_NONE",c)};a.rm=W;a.Xt=function(){var a=b("DEPTH_PACK");a.ka=!0;a.M=!1;var c=P.Ba();q(a,c);r(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");G(a);return a};a.Rn=function(a){var c=b("POSTPROCESSING");r(c,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":s(c,"POST_EFFECT","POST_EFFECT_NONE");c.p[0]=1;c.p[1]=1;break;
case "GRAYSCALE":s(c,"POST_EFFECT","POST_EFFECT_GRAYSCALE");c.p[0]=1;c.p[1]=1;break;case "X_BLUR":s(c,"POST_EFFECT","POST_EFFECT_X_BLUR");c.p[0]=1;c.p[1]=0;break;case "Y_BLUR":s(c,"POST_EFFECT","POST_EFFECT_Y_BLUR");c.p[0]=0;c.p[1]=1;break;case "X_EXTEND":s(c,"POST_EFFECT","POST_EFFECT_X_EXTEND");c.p[0]=1;c.p[1]=0;break;case "Y_EXTEND":s(c,"POST_EFFECT","POST_EFFECT_Y_EXTEND");c.p[0]=0;c.p[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}c.ka=!0;c.M=!1;a=P.Ba();q(c,a);G(c);return c};a.Sz=
function(){var a=b("EDGE");a.M=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var c=P.Ba();q(a,c);r(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");G(a);return a};a.nu=function(a){var c=b("SSAO");c.M=!1;c.ka=!0;c.p[0]=1;c.p[1]=1;var d=P.Ba();q(c,d);r(c,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");s(c,"SSAO_QUALITY","SSAO_QUALITY_"+a.Fq);s(c,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:V.nv(a)};d={width:4,height:4,data:new Uint8Array([150,123,254,0,127,3,97,0,164,246,
99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=v(a,d);F(c,a,"u_ssao_special_tex");G(c);return c};a.ou=function(a){var c=b("SSAO_BLUR");c.M=!1;c.ka=!0;c.p[0]=1;c.p[1]=1;var d=P.Ba();q(c,d);r(c,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");s(c,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);G(c);return c};a.Yt=function(){var a=b("DOF");a.M=!1;a.ka=!0;a.p[0]=
1;a.p[1]=1;var c=P.Ba();q(a,c);r(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");s(a,"DEPTH_RGBA",1);G(a);return a};a.Zt=function(){var a=b("GLOW");a.M=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var c=P.Ba();q(a,c);r(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");G(a);return a};a.$t=function(a,c,d){var e=b("GOD_RAYS");e.M=!1;e.ka=!0;e.p[0]=1;e.p[1]=1;var f=P.Ba();q(e,f);r(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");s(e,"DEPTH_RGBA",a);s(e,"WATER_EFFECTS",
c);s(e,"STEPS_PER_PASS",ga.u(d,1));G(e);return e};a.au=function(){var a=b("GOD_RAYS_COM");a.M=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var c=P.Ba();q(a,c);r(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");G(a);return a};a.ku=function(){var a=b("SKY");a.M=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var c=P.fv();q(a,c);r(a,"procedural_skydome.glslv","procedural_skydome.glslf");s(a,"NUM_LIGHTS",1);s(a,"WATER_EFFECTS",1);G(a);return a};a.Rt=function(){var a=b("ANTIALIASING");a.M=!1;a.ka=!0;a.p[0]=
1;a.p[1]=1;a.Bg=1/U.resolution_factor;var c=P.Ba();q(a,c);r(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");s(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");G(a);return a};a.lu=function(a){var c=b("SMAA"),d=P.Ba();q(c,d);r(c,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");s(c,"AA_METHOD","AA_METHOD_SMAA_HIGH");s(c,"SMAA_PASS",a);s(c,"SMAA_PREDICATION",0);s(c,"SMAA_REPROJECTION",0);G(c);c.M=!1;c.ka=!0;c.p[0]=1;c.p[1]=1;c.Bg=1/U.resolution_factor;return c};a.bu=function(a){var c=
b("LANCZOS");c.M=!1;c.ka=!0;c.Bg=1/U.resolution_factor;"LANCZOS_X"==a?(c.p[0]=1,c.p[1]=0):"LANCZOS_Y"==a&&(c.p[0]=0,c.p[1]=1);a=P.Ba();q(c,a);r(c,"postprocessing/postprocessing.glslv","postprocessing/lanczos.glslf");G(c);return c};a.Vt=function(){var a=b("COMPOSITING");a.M=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var c=P.Ba();q(a,c);r(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");G(a);return a};a.eu=function(a){var c=b("MOTION_BLUR");c.ka=!0;c.M=!1;var d=P.Ba();q(c,d);r(c,"postprocessing/postprocessing.glslv",
"postprocessing/motion_blur.glslf");s(c,"BLUR_DECAY_THRESHOLD",ga.u(a));G(c);return c};a.Qt=function(){var a=b("ANAGLYPH");a.ka=!0;a.M=!1;var c=P.Ba();q(a,c);r(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");G(a);return a};a.cu=function(){var a=b("LUMINANCE");a.M=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var c=P.Ba();q(a,c);r(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");G(a);return a};a.St=function(){var a=b("LUMINANCE");a.M=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var c=
P.Ba();q(a,c);r(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");G(a);return a};a.du=function(){var a=b("LUMINANCE_X_BLUR");a.M=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var c=P.Ba();q(a,c);r(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");G(a);return a};a.Tt=function(a){var c=b("POSTPROCESSING");switch(a){case "X_BLUR":c.p[0]=1;c.p[1]=0;break;case "Y_BLUR":c.p[0]=0;c.p[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}c.ka=
!0;c.M=!1;a=P.Ba();q(c,a);r(c,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");G(c);return c};a.Ut=function(){var a=b("BLOOM");a.M=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var c=P.Ba();q(a,c);r(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");G(a);return a};a.ru=function(){var a=b("VELOCITY");a.M=!1;a.ka=!0;a.p[0]=1;a.p[1]=1;var c=P.Ba();q(a,c);r(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");G(a);return a};a.Th=function(a,b,c){var d=
a.Bg;a.mm[0]=b*a.p[0]*d;a.mm[1]=c*a.p[1]*d};a.xf=function(a,b){a.Bg=b};a.S=function(a,b,c){a=a.O;for(var d=null,e=0;e<a.length;e++){var f=a[e];if(-1<f.tc.indexOf(b)&&(c&&f.type==c||!c)){if(f.vb)return f;d=null===d?f:d}}return d};a.It=function(a){for(var b=a.R,c=0;c<b.length;c++)V.Du(b[c].Fa);O.En(a.ab)}};b4w.module.__nodemat=function(a,n){function b(a,b,d){if(b in I)return I[b];for(var f=N.create(),m=a.nodes,q=a.links,r=a.animation_data,w=0;w<m.length;w++)if(!e(f,m[w],0,r))return I[b]=null;if(d&&-1==t(a,f,"GROUP_OUTPUT","group"))return null;w=W(f);if(!T(f,q,w))return null;if(d)return f;for(w=0;w<q.length;w++){d=q[w];for(var m=h(d.from_node,f),r=h(d.to_node,f),s=0;s<m.length;s++)for(var n=0;n<r.length;n++){for(var V=m[s],z=r[n],u=N.Ca(f,V),fa=N.Ca(f,z),A=f,y=fa,fa=[],B=d.from_socket.identifier,F=d.to_socket.identifier,
G=u.Oa,u=0;u<G.length;u++)if(G[u].identifier==B){fa.push(u);break}y=y.B;for(u=0;u<y.length;u++)if(y[u].identifier==F){fa.push(u);break}2==fa.length&&N.Ae(A,V,z,fa)}}l(f);a=t(a,f,"OUTPUT","material");if(-1==a)return I[b]=null;k(f);f=N.ey(f,a,N.or);g(f);p(f);v(f);x(f);return c(f)?I[b]=f:(Z.error("Material has normalmap node but no material node"),I[b]=null)}function c(a){var b=!1,c=!1;N.J(a,function(a,d){if("MATERIAL"==d.type||"MATERIAL_EXT"==d.type)c=!0;"TEXTURE_NORMAL"==d.type&&(b=!0)});return b&&
!c?!1:!0}function g(a){N.J(a,function(b,c){for(var e=c.B,f=c.Oa,g=0;g<e.length;g++)d(a,e[g],b,g,1);for(g=0;g<f.length;g++)d(a,f[g],b,g,0)})}function d(a,b,c,d,e){if(b.rd){var f=!0;N.oe(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&g[1]==d)f=!1});f&&(b.rd=!1)}}function l(a){var b=[];N.J(a,function(c,d){switch(d.type){case "TRANSLUCENCY":N.oe(a,function(a,e,f){a==c&&"Translucency"==d.Oa[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)N.Ae(a,b[c],b[c+1],b[c+2])}function h(a,
b){var c=[];N.J(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function k(a){var b=[];N.J(a,function(a,c){"PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("PARALLAX"==e.type){var g=f(a,d);if(-1!=g){var h=N.Li(a,g,0);N.kg(a,g,d,-1);-1!=h&&N.kg(a,h,g,-1);d=N.Ca(a,g);e.data=d.data;e.va[0]=d.va[0];N.lg(a,g)}e.B.splice(1,1)}else if("REROUTE"==e.type){for(var e=N.Li(a,d,0),k=N.ig(a,d),g=[],h=[],m=[],l=0;l<k;l++){var p=
N.Zf(a,d,l),q=h.indexOf(p);-1!=q?m[q]+=1:(h.push(p),m.push(1),g.push(d,p))}if(-1!=e)for(k=N.Yf(a,e,d,0)[0],l=0;l<h.length;l++)for(p=0;p<m[l];p++)q=N.Yf(a,d,h[l],p)[1],N.Ae(a,e,h[l],[k,q]);for(l=0;l<g.length;l+=2)N.kg(a,g[l],g[l+1],-1)}}}function f(a,b){for(var c=a.sa,d=0;d<c.length;d+=3)if(c[d+1]==b&&1==c[d+2][1])return c[d];return-1}function p(a){var b=[];N.J(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=
c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var k=c[h];if(m(f,k.pa)){g=[];h=N.ig(a,e);for(q=0;q<h;q++){var l=N.Zf(a,e,q),p=N.Yf(a,e,l,0);g.push(e,l,p);N.Ae(a,k.id,l,p)}for(var q=0;q<g.length;q+=3)N.kg(a,g[q],g[q+1],0);N.lg(a,e);g=!1;break}}g&&(k={id:e,pa:f},c.push(k))}}function v(a){var b=[];N.J(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,
h=0;h<c.length;h++){var k=c[h];if(!(3<=k.fj.length)&&m(f,k.pa)){for(var h=[],l=N.Yo(a,e),g={},p=0;p<l;p++){var q=N.Li(a,e,p);q in g||(g[q]=0);var r=N.Yf(a,q,e,g[q]++);h.push(q,e,r)}for(var l=[],g=N.ig(a,e),w={},p=0;p<g;p++)q=N.Zf(a,e,p),q in w||(w[q]=0),r=N.Yf(a,e,q,w[q]++),l.push(e,q,r);for(var g=h.concat(l),p=0;p<g.length;p+=3)N.kg(a,g[p],g[p+1],0);N.lg(a,e);p={pa:f,Ju:h,Ku:l};k.fj.push(p);g=!1;break}}g&&(k={id:e,pa:f,fj:[]},c.push(k))}for(d=0;d<c.length;d++){k=c[d];e=k.fj.length;l=k.pa.B.length;
g=k.pa.Oa.length;for(h=0;h<e;h++){r=k.fj[h];p=r.pa;f=r.Ju;w=r.Ku;k.pa.B=k.pa.B.concat(p.B);k.pa.Oa=k.pa.Oa.concat(p.Oa);for(p=0;p<k.pa.B.length;p++)k.pa.B[p].identifier+=P.trunc(p/l)+1;for(p=0;p<k.pa.Oa.length;p++)k.pa.Oa[p].identifier+=P.trunc(p/g)+1;for(p=0;p<f.length;p+=3)q=f[p],r=f[p+2],r[1]+=(h+1)*l,N.Ae(a,q,k.id,r);for(p=0;p<w.length;p+=3)q=w[p+1],r=w[p+2],r[0]+=(h+1)*g,N.Ae(a,k.id,q,r)}switch(e){case 1:k.pa.type+="2";break;case 2:k.pa.type+="3";break;case 3:k.pa.type+="4"}N.lg(a,k.id);N.fk(a,
k.id,k.pa)}}function m(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function x(a){var b=[];N.J(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],h=[],k=[[],[],[]],m=N.ig(a,d),l=0;l<
m;l++){var p=N.Zf(a,d,l);if("SEPRGB"!=N.Ca(a,p).type){f=!1;break}g.push(d,p);for(var q={},r=N.ig(a,p),f=0;f<r;f++){var w=N.Zf(a,p,f);w in q||(q[w]=0);var t=N.Yf(a,p,w,q[w]++);g.push(p,w);k[t[0]].push(d,w,t)}h.push(p);f=!0}if(f){for(l=d=m=0;l<k.length;l++)k[l].length&&(m++,d|=1<<2-l);if(m){e.type+=m;e.Oa=[];for(l=0;l<k.length;l++)if(k[l].length)for(e.Oa.push({mb:0,identifier:"RGB"[l],rd:!0,name:"RGB"[l]}),f=0;f<k[l].length;f+=3)k[l][f+2][0]=P.Ph(d,l);for(l=0;l<g.length;l+=2)N.kg(a,g[l],g[l+1],0);for(l=
0;l<h.length;l++)N.lg(a,h[l]);for(l=0;l<k.length;l++)for(f=0;f<k[l].length;f+=3)N.Ae(a,k[l][f],k[l][f+1],k[l][f+2])}}}}function t(a,b,c,d){a=a.nodes;for(var e=null,f=0;f<a.length;f++){var g=a[f];g.type==c&&(e=g)}return e?h(e,b)[0]:(Z.error('No "'+c+'" node in node '+d),-1)}function z(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function e(a,c,d,f){var g=c.name,h=c.type,k=[],m=[],l=[],p=[],w=null;switch(h){case "CAMERA":m=[];l=J(c);break;case "COMBRGB":case "COMBHSV":m=y(c);l=J(c);break;case "GEOMETRY":a:{for(var h=
c.outputs,t=0;t<h.length;t++)if(h[t].is_linked){h=!0;break a}h=!1}if(!h)return!0;h=u(c,d);if(!h)return Z.error("Geometry output is not supported"),!1;switch(h){case "GEOMETRY_UV":if(!c.uv_layer)return Z.error('Missing uv layer in node "',c.name,'"'),!1;w=A("param_GEOMETRY_UV_a");t=A("param_GEOMETRY_UV_v");k.push(r(w));k.push(r(t));l.push(q(c,"UV"));p.push(r(t));w={name:w,value:c.uv_layer};break;case "GEOMETRY_VC":if(!c.color_layer)return Z.error("Missing vertex color layer in node ",c.name),!1;w=
A("param_GEOMETRY_VC_a");t=A("param_GEOMETRY_VC_v");k.push(r(w));k.push(r(t));l.push(q(c,"Vertex Color"));p.push(r(t));w={name:w,value:c.color_layer};break;case "GEOMETRY_NO":l.push(q(c,"Normal"));break;case "GEOMETRY_FB":l.push(q(c,"Front/Back"));break;case "GEOMETRY_VW":l.push(q(c,"View"));break;case "GEOMETRY_GL":l.push(q(c,"Global"))}break;case "GROUP":t=c.node_tree_name.replace(/\.[0-9]{3,}$/g,"");switch(t){case "LINEAR_TO_SRGB":h="LINEAR_TO_SRGB";break;case "NORMAL_VIEW":case "VECTOR_VIEW":h=
"VECTOR_VIEW";break;case "SRGB_TO_LINEAR":h="SRGB_TO_LINEAR";break;case "REFLECT":h="REFLECT";break;case "REFRACTION":h="REFRACTION";break;case "PARALLAX":h="PARALLAX";if(!c.inputs[1].is_linked)return Z.error('Missing texture in node "',c.name,'"'),!1;var v=A("temp_texture");p.push(r(v));break;case "CLAMP":h="CLAMP";break;case "TRANSLUCENCY":h="TRANSLUCENCY";break;case "TIME":h="TIME";break;case "SMOOTHSTEP":h="SMOOTHSTEP";break;default:l=c.node_group.node_tree;m={};for(v in l)if("links"==v||"nodes"==
v)for(m[v]=[],w=0;w<l[v].length;w++){m[v][w]={};for(var x in l[v][w])if("links"==v){m[v][w][x]={};for(var n in l[v][w][x])m[v][w][x][n]=B(l[v][w][x][n])}else m[v][w][x]=B(l[v][w][x])}else m[v]=B(l[v]);if("REPLACE"==t||"LEVELS_OF_QUALITY"==t)l=z("Group input","GROUP_INPUT",[],c.inputs),w=z("Group output","GROUP_OUTPUT",c.outputs,[]),v=null,v="REPLACE"==t||"LEVELS_OF_QUALITY"==t&&(fa.quality==ja.P_LOW||fa.Tk)?{from_node:l,from_socket:l.outputs[1],to_node:w,to_socket:w.inputs[0]}:{from_node:l,from_socket:l.outputs[0],
to_node:w,to_socket:w.inputs[0]},m.nodes=[l,w],m.links=[v];l=c.name;w=m.nodes;v=m.links;for(x=0;x<w.length;x++)w[x].name=G(w[x].type,l,w[x].name);for(x=0;x<v.length;x++)v[x].from_node.name=G(v[x].from_node.type,l,v[x].from_node.name),v[x].to_node.name=G(v[x].to_node.type,l,v[x].to_node.name);w={Gw:b(m,c.node_group.uuid,!0),Hw:m.links}}m=y(c);l=J(c);"TRANSLUCENCY"==t&&(t=H("TranslucencyParams","TranslucencyParams",[0,0,0,0]),t.rd=l[0].rd,l.push(t));break;case "LAMP":w=c.lamp;if(!w)return Z.error("There is no lamp in node: "+
c.name),!1;l.push(q(c,"Color"));l.push(q(c,"Light Vector"));l.push(q(c,"Distance"));l.push(q(c,"Visibility Factor"));w.uuid in ia?p.push(r(A("param_LAMP_lamp_index"),ia[w.uuid],1)):(ia[w.uuid]=oa,p.push(r(A("param_LAMP_lamp_index"),oa++,1)));w=ia;break;case "NORMAL":m=y(c);l=J(c);t=q(c,"Normal");p.push(r(A("param_NORMAL_Normal"),t.mb,3));break;case "MAPPING":m.push(s(c,"Vector"));l.push(q(c,"Vector"));if(0!=D.length(c.translation)||0!=D.length(c.rotation)||c.use_max||c.use_min){var h="MAPPING_HEAVY",
I=c.rotation,t=ga.create(),v=Math.cos(I[0]);x=Math.cos(I[1]);n=Math.cos(I[2]);var F=Math.sin(I[0]),K=Math.sin(I[1]),I=Math.sin(I[2]),W=v*n,L=v*I,T=F*n,R=F*I;t[0]=x*n;t[1]=x*I;t[2]=-K;t[3]=K*T-L;t[4]=K*R+W;t[5]=x*F;t[6]=K*W+R;t[7]=K*L-T;t[8]=x*v;v=c.scale;x=new Float32Array([v[0],0,0,0,v[1],0,0,0,v[2]]);v=ga.create();ga.multiply(t,x,v);t=c.translation;v=P.xw(v,V.create());v[12]=t[0];v[13]=t[1];v[14]=t[2];p.push(r(A("param_MAPPING_HEAVY_trs_matrix"),v,16));p.push(r(A("param_MAPPING_HEAVY_use_min"),
~~c.use_min,1));p.push(r(A("param_MAPPING_HEAVY_use_max"),~~c.use_max,1));p.push(r(A("param_MAPPING_LIGHT_min_clip"),c.min,3));p.push(r(A("param_MAPPING_LIGHT_max_clip"),c.max,3))}else h="MAPPING_LIGHT",p.push(r(A("param_MAPPING_LIGHT_scale"),c.scale,3));break;case "MATERIAL":case "MATERIAL_EXT":w=c.material;if(!w)return Z.error("Emtpy material slot in node: "+c.name),!1;v=s(c,"Color");v.mb.splice(3);m.push(v);(v=s(c,"Alpha"))?m.push(v):m.push(H("Alpha","Alpha",1));v=s(c,"Spec");v.mb.splice(3);m.push(v);
t=s(c,"Normal");t.mb.splice(3);m.push(t);l.push(q(c,"Color"));l.push(q(c,"Alpha"));l.push(q(c,"Normal"));"MATERIAL_EXT"==h&&((v=s(c,"Emit"))?m.push(v):m.push(H("Emit","Emit",0)),v=s(c,"Translucency"),v.mb=0,v.name="Translucency",v.identifier="Translucency",v?m.push(v):m.push(H(v.name,v.identifier,v.mb)),v=s(c,"Translucency"),v.mb=[0,0,0,0],v.name="TranslucencyParams",v.identifier="TranslucencyParams",v?m.push(v):m.push(H(v.name,v.identifier,v.mb)),(v=s(c,"Ray Mirror"))?m.push(v):m.push(H("Ray Mirror",
"Ray Mirror",0)),(v=s(c,"SpecTra"))?m.push(v):m.push(H("SpecTra","SpecTra",0)),l.push(q(c,"Diffuse")),l.push(q(c,"Spec")));x=0;switch(w.specular_shader){case "COOKTORR":case "PHONG":v=w.specular_hardness;break;case "WARDISO":v=w.specular_slope;break;case "TOON":v=w.specular_toon_size;x=w.specular_toon_smooth;break;default:Z.error("B4W Error: unsupported specular shader: "+w.specular_shader+' (material "'+w.name+'")'),v=w.specular_hardness}switch(w.diffuse_shader){case "LAMBERT":F=n=0;break;case "OREN_NAYAR":n=
w.roughness;F=0;break;case "FRESNEL":n=w.diffuse_fresnel;F=w.diffuse_fresnel_factor;break;default:Z.error("B4W Error: unsupported diffuse shader: "+w.diffuse_shader+' (material "'+w.name+'")'),F=n=0}p.push(r(A("param_MATERIAL_diffuse"),[c.use_diffuse?1:0,n,F],3));p.push(r(A("param_MATERIAL_spec"),[c.use_specular?1:0,w.specular_intensity,v,x],4));p.push(r(A("param_MATERIAL_norm"),t.rd?1:0,1));w={name:c.name,value:w};break;case "MATH":switch(c.operation){case "ADD":h="MATH_ADD";break;case "SUBTRACT":h=
"MATH_SUBTRACT";break;case "MULTIPLY":h="MATH_MULTIPLY";break;case "DIVIDE":h="MATH_DIVIDE";break;case "SINE":h="MATH_SINE";break;case "COSINE":h="MATH_COSINE";break;case "TANGENT":h="MATH_TANGENT";break;case "ARCSINE":h="MATH_ARCSINE";break;case "ARCCOSINE":h="MATH_ARCCOSINE";break;case "ARCTANGENT":h="MATH_ARCTANGENT";break;case "POWER":h="MATH_POWER";break;case "LOGARITHM":h="MATH_LOGARITHM";break;case "MINIMUM":h="MATH_MINIMUM";break;case "MAXIMUM":h="MATH_MAXIMUM";break;case "ROUND":h="MATH_ROUND";
break;case "LESS_THAN":h="MATH_LESS_THAN";break;case "GREATER_THAN":h="MATH_GREATER_THAN";break;case "MODULO":h="MATH_MODULO";break;case "ABSOLUTE":h="MATH_ABSOLUTE";break;default:return Z.error("Unsupported MATH operation: "+c.operation),!1}m=y(c);l=J(c);break;case "MIX_RGB":switch(c.blend_type){case "MIX":h="MIX_RGB_MIX";break;case "ADD":h="MIX_RGB_ADD";break;case "MULTIPLY":h="MIX_RGB_MULTIPLY";break;case "SUBTRACT":h="MIX_RGB_SUBTRACT";break;case "SCREEN":h="MIX_RGB_SCREEN";break;case "DIVIDE":h=
"MIX_RGB_DIVIDE";break;case "DIFFERENCE":h="MIX_RGB_DIFFERENCE";break;case "DARKEN":h="MIX_RGB_DARKEN";break;case "LIGHTEN":h="MIX_RGB_LIGHTEN";break;case "OVERLAY":h="MIX_RGB_OVERLAY";break;case "DODGE":h="MIX_RGB_DODGE";break;case "BURN":h="MIX_RGB_BURN";break;case "HUE":h="MIX_RGB_HUE";break;case "SATURATION":h="MIX_RGB_SATURATION";break;case "VALUE":h="MIX_RGB_VALUE";break;case "COLOR":h="MIX_RGB_COLOR";break;case "SOFT_LIGHT":h="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":h="MIX_RGB_LINEAR_LIGHT";
break;default:return Z.error("Unsupported MIX_RGB blend type: "+c.blend_type),!1}m=y(c);l=J(c);break;case "OUTPUT":m=y(c);l=[];break;case "RGB":t=q(c,"Color");l.push(t);p.push(r(A("param_RGB_Color"),t.mb,3));break;case "SEPRGB":case "SEPHSV":m=y(c);l=J(c);break;case "TEXTURE":if(!c.texture)return Z.error("No texture attached to node: "+c.name),!1;a:{h=c.outputs;w=!1;for(t=0;t<h.length;t++)if(v=h[t],v.is_linked)switch(v.identifier){case "Color":h="ENVIRONMENT_MAP"==c.texture.type?"TEXTURE_ENVIRONMENT":
"TEXTURE_COLOR";break a;case "Normal":h="TEXTURE_NORMAL";break a;case "Value":w=!0;break;default:throw"Unknown texture output";}h=w?"ENVIRONMENT_MAP"==c.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR":void 0}m.push(s(c,"Vector"));if("TEXTURE_COLOR"==h||"TEXTURE_ENVIRONMENT"==h)l.push(q(c,"Color")),l.push(q(c,"Value"));"TEXTURE_NORMAL"==h&&(l.push(q(c,"Normal")),l.push(q(c,"Value")));v=A("param_TEXTURE_texture");p.push(r(v));w={name:v,value:c.texture};break;case "VALUE":a:if(f){if(h=f.action)for(t in K=
h.d.va,K)if(K=t.match(/"(.*?)"/)[1],K==c.name){v=h.name+"_"+t;break a}v=f.nla_tracks;for(x=0;x<v.length;x++)for(n=v[x].strips,F=0;F<v[x].strips.length;F++)for(t in h=n[F].action,K=h.d.va,K)if(K=t.match(/"(.*?)"/)[1],K==c.name){v=h.name+"_"+t;break a}v=void 0}else v=null;t=q(c,"Value");v?(h="ANIM_VALUE",x={name:A("param_ANIM_VALUE_Value"),value:"0"},p.push(x),x={name:"-1",value:v},p.push(x)):(h="VALUE",p.push(r(A("param_value_value"),t.mb,1)));l.push(t);break;case "VECT_MATH":switch(c.operation){case "ADD":h=
"VECT_MATH_ADD";break;case "SUBTRACT":h="VECT_MATH_SUBTRACT";break;case "AVERAGE":h="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":h="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":h="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":h="VECT_MATH_NORMALIZE";break;default:return Z.error("Unsupported VECT_MATH operation: "+c.operation),!1}m=y(c);l=J(c);break;default:m=y(c),l=J(c)}g={name:g,type:h,ci:k,B:m,Oa:l,va:p,data:w};N.fk(a,N.wo(a),g);if(g="GEOMETRY"==c.type)a:{g=c.outputs;for(p=k=0;p<g.length;p++)if(g[p].is_linked&&
k++>d){g=!0;break a}g=!1}return g&&!e(a,c,++d,f)?!1:!0}function B(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?P.Yg(a):a}function A(a){w[a]||(w[a]=0);var b=a+w[a],b=b.replace(/ /g,"_").replace(/\//g,"_");w[a]++;return b}function u(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";
case "Global":return"GEOMETRY_GL";default:return null}}}function s(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return K(e)}return null}function q(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return K(e)}return null}function K(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=P.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,rd:d,mb:a}}function H(a,b,c){return{name:a,identifier:b,rd:!1,mb:c}}function y(a){for(var b=[],
c=0;c<a.inputs.length;c++){var d=K(a.inputs[c]);d.mb.length&&d.mb.splice(3);b.push(d)}return b}function J(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=K(a.outputs[c]);b.push(d)}return b}function r(a,b,c){b=null===b||void 0===b?null:da.u(b,c);if(fa.Wl&&b){c=["param_MAPPING_HEAVY_trs_matrix","param_MAPPING_LIGHT_min_clip","param_MAPPING_LIGHT_max_clip","param_MAPPING_HEAVY_use_min","param_MAPPING_HEAVY_use_max"];for(var d=!1,e=0;e<c.length;e++)if(0<=a.indexOf(c[e])){d=!0;break}d&&(b=F(b))}return{name:a,
value:b}}function F(a){a=a.replace(/(,)/g,"$1 ");a=a.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3");a=a.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3");return a=a.replace(/\s+/g,"")}function G(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"*"+c}function W(a){var b=[];N.J(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function T(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.Gw,f=c[d].data.Hw;if(!e)return!1;N.J(e,function(b,
c){N.fk(a,N.wo(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);Q(c[d],b,a)}return!0}function S(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function R(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var f=c[e],g=null,h=0;h<b.length;h++)if(f.from_socket.identifier==b[h].to_socket.identifier){g=b[h];break}g?(f.from_node=g.from_node,f.from_socket=g.from_socket):d.push(f)}for(e=
0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function L(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function O(a,b,c,d){for(var e=0;e<d.length;e++){for(var f=d[e],g,k=0;k<c.B.length;k++)if(f.from_socket.identifier==c.B[k].identifier){g=c.B[k].mb;break}for(var k=f,m=b,l=g,p=h(k.to_node,m),q=0;q<p.length;q++)for(var r=N.Ca(m,p[q]),w=0;w<r.B.length;w++)if(r.B[w].identifier==k.to_socket.identifier){r.B[w].mb=l;break}f=a.indexOf(f);-1!=
f&&a.splice(f,1)}}function Q(a,b,c){for(var d=a.name,e=[],f=[],g=[],h=[],k=0;k<b.length;k++){var m=b[k];S(m.from_node,d,m,e,g,h);S(m.to_node,d,m,f,g,h)}f=R(b,f,g);e=R(b,h,e);L(b,f);O(b,c,a,f);if(e.length){var l;N.J(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(l=b)});O(b,c,l,e)}}var Z=n("__print"),N=n("__graph"),da=n("__shaders"),P=n("__util"),ja=n("__config"),D=n("vec3"),ga=n("mat3"),V=n("mat4"),w={},I={},ia={},oa=0,fa=ja.n;a.Jt=b;a.Kt=function(a){var b=[],c={};w={};var d=N.Sq(a);
N.J(d,function(a,d){var e;e=[];for(var f=[],g=[],h=[],k=[],m=[],l=0;l<d.B.length;l++){var p=d.B[l];if(p.rd)e.push(null),f.push(null);else{e.push(A("in_"+d.type+"_"+p.identifier));var q=da.u(p.mb,0);fa.Wl&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==p.identifier||"Color2"==p.identifier||"Fac"==p.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==p.identifier||"Value_001"==p.identifier))&&(q=F(q));f.push(q)}}for(l=0;l<d.Oa.length;l++)p=d.Oa[l],p.rd?g.push(null):g.push(A("out_"+d.type+"_"+p.identifier));
for(l=0;l<d.va.length;l++)p=d.va[l],h.push(p.name),k.push(p.value);for(l=0;l<d.ci.length;l++)m.push(d.ci[l].name);e={id:d.type,B:e,ap:f,Oa:g,va:h,oj:k,ci:m};b.push(e);c[a]=e});N.oe(d,function(a,b,e){var f=N.Ca(d,a);N.Ca(d,b);var g=f.Oa[e[0]];a=c[a].Oa;b=c[b].B;f=a[e[0]]||A("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.cleanup=function(){for(var a in I)delete I[a];for(var b in ia)delete ia[b];oa=0}};b4w.module.__animation=function(a,n){function b(a,b){var c=a.w[b];c&&c.Qk&&c.hh&&(c.hh=!1,c.Qk(a))}function c(a,b,c){c=a.w[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.Pb=d;c.$c=b.name;for(e=d=0;e<a.data.b4w_vertex_anim.length;e++){var f=a.data.b4w_vertex_anim[e];if(f==b)break;else d+=f.frame_end-f.frame_start+1}c.er=d}function g(a,b,c){a=a.w[c];a.type=50;a.$c=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);
a.Jc=b}function d(a){return a.replace(/_B4W_BAKED$/,"")}function l(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:N.da("Wrong animation behavior")}}function h(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++){var d=a[c].node_tree;d&&d.animation_data&&(d=d.animation_data,d.action&&b.push(d.action))}return b}function k(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}function f(a,
b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function p(a,c,d){B(a,c,d);b(a,d);a.d.Fd&&(s(a,c),u(a,c))}function v(a,b,c){var d=b.frame_range,f=b.d,g=a.w[c];g.$c=b.name;g.Rm=d;g.Ls=f.Ow;g.Js=f.lt;g.start=d[0];g.length=d[1]-d[0];g.Pb=d[0];d=N.Se(f.ui);if(N.Xe(a)&&d){g.type=10;var h=m(a,b);h||(h=q(a,b,z(a)),a.Rg.push(b,h));g.e=h.e;g.ja=h.ja;var g=a.d,h=g.Bj,k=a.w[c],f=k.Yl,l;a:{l=g.vq;for(var p=0;p<l.length;p+=2)if(b==l[p]){l=l[p+1];break a}l=null}if(l)k.Yl=l;else{for(k=0;k<h.length;k++)l=
q(a,b,h[k].fc),f.push(l);g.vq.push(b,f)}g.Fd&&(b=g.Kj,c>b[1]?(g=b[1],b[1]=c,b[0]=g):c>b[0]&&c<b[1]&&(b[0]=c),x(a))}else if(O.Yd(a)&&(f.va.volume||f.va.pitch))g.volume=f.va.volume||null,g.pitch=f.va.pitch||null,g.type=40;else if("MESH"==a.type&&e(b)){g.type=70;f=m(a,b);if(!f){f=[];k=[];l=b.d;p=a.d.xh;for(h in l.va)for(var r=b.name+"_"+h,w=0;w<p.length;w+=2)if(r==p[w]){f.push(p[w+1]);k.push(l.va[h]);break}f={Ry:f,Sy:k};a.Rg.push(b,f)}g.wp=f.Ry;g.xp=f.Sy}else if(h=f.va.tsr){g.type=20;f=m(a,b);if(!f){f=
b.d.Ap;k=[];l=[];for(p=0;p<f;p++)k.push(h.subarray(8*p,8*p+4)),l.push(h.subarray(8*p+4,8*p+8));f={e:k,ja:l};a.Rg.push(b,f)}g.e=f.e;g.ja=f.ja;T.bg(a)&&T.Ly(a,g.e,g.ja)}else R.warn('B4W Warning: Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),g.type=60;N.Xe(a)&&!d&&t(a,c)}function m(a,b){for(var c=a.Rg,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function x(a){var b=a.d.Kj;if(-1!=b[0]&&-1!=b[1]){var c=a.w;a=c[b[1]].Pb;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.Pb;
d=Math.floor(a);b.Pb=d+e}}function t(a,b){var c=a.d.Kj,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.w;0<=d;d--){var f=e[d];if(f&&10==f.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function z(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var e=b[d].name;c[e]={on:d,eh:d,Ml:N.cl(a,"name",e),gr:-1}}return c}function e(a){a=a.d;for(var b in a.va)if(-1!=b.indexOf("nodes"))return!0;return!1}function B(a,b,c){if((c=a.w[c])&&(c.play||0==b)){var d=a.d,e=c.Pb,f=c.start,g=c.length,
e=e+c.speed*b*P.ua,h=c.type,k=c.speed;if(0<=k&&e>=f+g||0>k&&e<f)switch(c.hh=!0,c.behavior){case 10:e=0<=k?(e-f)%g+f:f+g-1E-6;break;case 20:e=0<=k?f:f+g-1E-6;c.play=!1;break;case 30:e=0<=k?f+g-1E-6:f,c.play=!1}c.Pb=e;switch(h){case 10:if(!d.Fd){e=A(c,e,ja);b=e[0];f=e[1];e=e[2];d.Ub=c.ja[b];d.Tb=c.ja[f];d.cc=c.e[b];d.bc=c.e[f];d.Pe=e;d=d.Bj;c=c.Yl;for(g=0;g<d.length;g++)h=d[g],k=c[g],h.Ub=k.ja[b],h.Tb=k.ja[f],h.cc=k.e[b],h.bc=k.e[f],h.Pe=e;Q.v(a)}break;case 20:h=e=A(c,e,ja);(d=D)||(d=new Float32Array(4));
var f=h[0],g=h[1],h=h[2],k=c.e,m=k[f][1],l=k[f][2],p=k[g][1],q=k[g][2];d[0]=(1-h)*k[f][0]+h*k[g][0];d[1]=(1-h)*m+h*p;d[2]=(1-h)*l+h*q;f=e;(g=V)||(g=new Float32Array(4));h=c.ja;da.slerp(h[f[0]].subarray(0,4),h[f[1]].subarray(0,4),f[2],g);f=g;g=e[2];h=c.e;e=(1-g)*h[e[0]][3]+g*h[e[1]][3];c.om&&(g=ga,Q.get_translation(a,g),N.smooth_v(d,g,b,c.om,d));c.Ol&&(g=w,Q.get_rotation(a,g),N.xq(f,g,b,c.Ol,f));Q.set_translation(a,d);Q.set_rotation(a,f);Q.set_scale(a,e);Q.v(a);S.sync_transform(a);break;case 30:(a=
ja)||(a=Array(3));f=e-c.start;0>f&&(f=0);f>=c.length&&(f=c.length);b=Math.floor(f);e=b+1;f-=b;10!=c.behavior&&e==c.length&&(e=b-=1,f=1);c=c.er;a[0]=b+c;a[1]=e+c;a[2]=f;e=ja;d.tm=e[0];d.dr=e[2];break;case 40:e=A(c,e,ja);b=e[0];d=e[1];e=e[2];c.volume&&O.set_volume(a,(1-e)*c.volume[b]+e*c.volume[d]);c.pitch&&O.playrate(a,(1-e)*c.pitch[b]+e*c.pitch[d]);break;case 50:T.Ex(c.Jc,e/P.ua);break;case 70:e=A(c,e,ja);b=e[0];d=e[1];e=e[2];f=c.xp;c=c.wp;for(g=0;g<c.length;g++)h=f[g],a.d.hf[c[g]]=(1-e)*h[b]+e*h[d];
break;case 60:break;default:throw"Unknown animation type:"+h;}}}function A(a,b,c){c||(c=Array(3));var d=a.Rm[0],e=a.Rm[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.Ls;e=Math.floor(b);a=a.Js[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function u(a,b){var c=a.d,d=c.Ed,e=c.Kj,f=e[0],e=e[1];if(-1!=e){if(-1!=f){var g=a.w[f];if(g.play||0==b)var h=A(g,g.Pb,ja),k=h[0],m=h[1],h=h[2],l=g.ja[k],p=g.ja[m],k=g.e[k],m=g.e[m];else d=1}else d=1;e=a.w[e];if(e.play||0==b)var h=A(e,e.Pb,ja),q=h[0],r=h[1],h=h[2];else if(-1!=f&&
g.play)d=0;else return;f=e.ja[q];g=e.ja[r];q=e.e[q];e=e.e[r];if(1==d)c.Ub.set(f),c.Tb.set(g),c.cc.set(q),c.bc.set(e);else if(0==d)c.Ub.set(l),c.Tb.set(p),c.cc.set(k),c.bc.set(m);else{for(r=0;r<l.length;r+=4){for(var v=V,t=w,x=0;4>x;x++)v[x]=l[r+x],t[x]=f[r+x];da.slerp(v,t,d,v);for(x=0;4>x;x++)c.Ub[r+x]=v[x];for(x=0;4>x;x++)v[x]=p[r+x],t[x]=g[r+x];da.slerp(v,t,d,v);for(x=0;4>x;x++)c.Tb[r+x]=v[x]}N.kn(k,q,d,c.cc);N.kn(m,e,d,c.bc)}d=c.Bj;l=c.sp;for(r=0;r<d.length;r++){p=d[r];k=l[r];for(m=0;m<k.length;m+=
2)for(q=k[m],f=k[m+1],g=0;4>g;g++)p.Ub[q+g]=c.Ub[f+g],p.Tb[q+g]=c.Tb[f+g],p.cc[q+g]=c.cc[f+g],p.bc[q+g]=c.bc[f+g];p.Pe=h}}}function s(a,b){var c=a.d,d=c.Ed,e=c.ek;if(0!=e){var d=c.dk-d,f=e*b;N.sign(d)==N.sign(e)&&Math.abs(f)<Math.abs(d)?c.Ed+=f:(c.Ed=c.dk,c.ek=0)}}function q(a,b,c){for(var d=a.pose.bones,e=[],f=[],g=b.d.Ap,h=0;h<g;h++){for(var k=0;k<d.length;k++){var m=d[k],l=Z.create(),p=b.d.ui[m.name];p&&Z.copy(p.subarray(8*h,8*h+8),l);m.Pm=l;m.ki=!1}k=K(a,c);e.push(k.e);f.push(k.ja)}return{e:e,
ja:f}}function K(a,b){var c=[],d=[],e=a.pose.bones,f=new Float32Array(4),g=new Float32Array(4),h;for(h in b){var k=b[h],m=k.eh,l=e[k.Ml],k=f,p=g,q=l.Bs,r=q[q.length-1],w=r.ak;r.ki||Z.identity(w);for(r=q.length-1;0<=r;r--){var l=q[r],v=l.ak;if(l.ki)w=v;else{var t=l.Qm,x=l.Pm;Z.invert(t,I);Z.multiply(x,I,I);Z.multiply(t,I,I);Z.multiply(w,I,v);w=v;l.ki=!0}}l=l.ak;k[0]=l[0];k[1]=l[1];k[2]=l[2];k[3]=l[3];p[0]=l[4];p[1]=l[5];p[2]=l[6];p[3]=l[7];da.normalize(p,p);for(k=0;4>k;k++)p=4*m+k,c[p]=f[k],d[p]=g[k]}c=
new Float32Array(c);d=new Float32Array(d);return{e:c,ja:d}}function H(a,b,c,d,e,f,g){var h=a+(b-a)/2,k=y(h,d,e,f,g)-c;return.02>Math.abs(k)?h:0<k?H(a,h,c,d,e,f,g):H(h,b,c,d,e,f,g)}function y(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function J(a,b){a.w||(a.w=[null,null,null,null,null,null,null,null]);a.w[b]={type:null,$c:null,ja:null,e:null,Yl:[],play:!1,behavior:20,Pb:0,start:0,length:0,om:0,Ol:0,hh:!1,er:null,speed:1,volume:null,pitch:null,xp:[],wp:[]};a.Rg=a.Rg||[];-1==ia.indexOf(a)&&
ia.push(a)}function r(a,b){Q.v(a);S.sync_transform(a);p(a,0,b)}function F(a,b,d){d=d||0;if(N.sc(a)){var e=N.keysearch("name",b,a.data.b4w_vertex_anim);if(e)return J(a,d),c(a,e,d),r(a,d),1;if((e=N.keysearch("name",b,a.particle_systems))&&"EMITTER"==e.settings.type)return J(a,d),g(a,e,d),r(a,d),1}if(e=N.keysearch("name",b,oa)||N.keysearch("name",b+"_B4W_BAKED",oa)){if(!N.Se(e.fcurves))return R.error('No fcurves in action "'+e.name+'"'),0;J(a,d);v(a,e,d);r(a,d);return 1}R.error('Unsupported object: "',
a.name,'" or animation name: "',b,'"');return 0}function G(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&d.animation_data)return!0}return!1}var W=n("__config"),T=n("__particles"),S=n("__physics"),R=n("__print"),L=n("__scenes"),O=n("__sfx"),Q=n("__transform"),Z=n("__tsr"),N=n("__util");n("mat4");var da=n("quat");n("vec4");var P=W.Hd;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=
30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_STATIC=60;a.OBJ_ANIM_TYPE_MATERIAL=70;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var ja=Array(3),D=new Float32Array(3),ga=new Float32Array(3),V=new Float32Array(4),w=new Float32Array(4),I=new Float32Array(8);new Float32Array(16);var ia=[],oa=[];a.frame_to_sec=function(a){return a/P.ua};a.update=function(a){for(var c=
0;c<ia.length;c++){for(var d=ia[c],e=0;8>e;e++)B(d,a,e);d.d.Fd&&(s(d,a),u(d,a))}for(c=0;c<ia.length;c++)for(d=ia[c],e=0;8>e&&d.w;e++)b(d,e)};a.pv=function(){return oa};a.Bv=function(a,b){var c=a.w[b];return c&&c.$c?d(c.$c):null};a.get_anim_names=function(a){var b=[];if(N.sc(a)&&a.d.ai)for(var c=0;c<a.data.b4w_vertex_anim.length;c++)b.push(a.data.b4w_vertex_anim[c].name);var f,c=[];for(f=0;f<oa.length;f++){var g=oa[f],k=g.d;N.Se(g.d.ui)?"ARMATURE"==a.type&&c.push(g):k.va.volume||k.va.pitch?O.Yd(a)&&
c.push(g):e(g)||c.push(g)}"MESH"==a.type&&(c=c.concat(h(a)));f=c;for(c=0;c<f.length;c++)b.push(d(f[c].name));if(T.bg(a)&&T.Ri(a))for(c=0;c<a.particle_systems.length;c++)b.push(a.particle_systems[c].name);return b};a.dy=d;a.get_anim_type=function(a,b){var c=a.w[b];return c?c.type:null};a.apply_def=function(a){var b=0,d;d=[];var e=a.animation_data;if(e&&e.action){var f=N.Se(e.action.d.ui);"ARMATURE"!=a.type&&f||d.push(e.action)}O.Yd(a)&&a.data.animation_data&&a.data.animation_data.action&&d.push(a.data.animation_data.action);
"MESH"==a.type&&(d=d.concat(h(a)));for(e=0;e<d.length;e++)f=d[e],N.Se(f.fcurves)?(J(a,b),v(a,f,b),r(a,b),a.w[b].behavior=l(a.b4w_anim_behavior),b++):R.error('No fcurves in action "'+f.name+'"');f=a.particle_systems;for(e=0;e<f.length;e++){var k=f[e],m=k.settings;"EMITTER"==m.type&&(J(a,b),g(a,k,b),r(a,b),a.w[b].behavior=l(a.b4w_anim_behavior),m.b4w_cyclic&&(a.w[b].behavior=10),b++)}N.sc(a)&&a.d.ai?(J(a,b),c(a,a.data.b4w_vertex_anim[0],b),r(a,b),a.w[b].behavior=l(a.b4w_anim_behavior)):d.length||T.Ri(a)||
(J(a,0),d=a.w[0],d.type=60,d.$c=a.name+"_STATIC",e=L.Iv(L.get_active()),d.start=e[0],d.length=e[1]-e[0]+1,r(a,b))};a.get_first_armature_object=k;a.play=function(a,b,c){f(a.w,c,function(a){a.play=!0;a.Qk=b?b:null;a.hh=!1});a.d.Fd&&x(a)};a.stop=function(a,b){f(a.w,b,function(a){a.play=!1;a.Qk=null;a.hh=!1})};a.is_play=function(a,b){var c=a.w[b];return c?c.play:!1};a.set_current_frame_float=function(a,b,c){var d=a.w;if(-1==c)for(c=0;8>c;c++){var e=d[c];e&&(e.Pb=b,p(a,0,c))}else if(e=d[c])e.Pb=b,p(a,
0,c)};a.get_current_frame_float=function(a,b){var c=a.w[b];return c&&c.Pb?c.Pb:0};a.is_cyclic=function(a,b){var c=a.w[b];return c&&10==c.behavior};a.set_behavior=function(a,b,c){f(a.w,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.w[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){f(a.w,d,function(a){a.om=b||0;a.Ol=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.w[c]=null;else a.w[b]=null;a.d.Fd&&t(a,b)};a.update_object_animation=p;a.Ui=
function(a){if("ARMATURE"==a.type||k(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||T.bg(a)&&T.Ri(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length||G(a)?!0:!1};a.is_animated=function(a){return a.w?!0:!1};a.rt=z;a.rn=K;a.Ns=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);da.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=
4,e=0==b?3:b-1):(d=-1<a.indexOf("scale")?3:0,e=0);return d+e}function d(a,b,c,e){if(-1<c.search(f)){a=b;c=c.split('"')[1];var h=g}else-1<c.indexOf("location")?(c="tsr",h=g):-1<c.indexOf("rotation_quaternion")?(c="tsr",h=g):-1<c.indexOf("scale")?(c="tsr",h=g):h=0;if(!a[c]){b=a;var k=c;if("object"==typeof h&&h.length)for(var m=h.length,l=new Float32Array(e*m),p=0;p<e;p++)for(var q=0;q<m;q++)l[p*m+q]=h[q];else if("number"==typeof h)for(l=new Float32Array(e),p=0;p<e;p++)l[p]=h;else throw"Wrong storage default value";
b[k]=l}return a[c]}a.d={};var e=a.d;e.Ow=1/P.Qe;var f=new RegExp(/pose.bones\[\".+\"\]/g),g=Z.create(),h=a.fcurves,k={},m={},l=0,p;for(p in h){var q=h[p],r;for(r in q){var w=q[r].Nb;l||(l=w.length);for(var v=d(k,m,p,l),t=v.length/l,x=c(p,r|0),s=0;s<l;s++)v[s*t+x]=w[s]}}for(var n in k)"tsr"==n&&b(k[n],l);for(var I in m)b(m[I],l);e.va=k;e.ui=m;e.lt=a.As;e.Ap=l;oa.push(a)};a.tv=function(a,b){return(b-a)*P.Qe+1};a.dt=function(a,b,c,d,e,f){var g,h,k=new Float32Array(2),m=new Float32Array(2),l=new Float32Array(2),
p=new Float32Array(2),q=b[1],r=b[2],w=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var v=0,t=0,x=null;e<=f;e++)if(e<q)for(var s=0;s<P.Qe;s++)c[v++]=r;else if(e>w)for(s=0;s<P.Qe;s++)c[v++]=a;else{var n=b[t],I=3;0===n&&(I+=2);0===x&&(I+=2);var V=2===n?0:1;if(b[t+1]==b[t+I+1])x=n,t+=I;else{s=0;e==b[t+1]&&(V&&(d[v]=1),c[v]=b[t+2],v++,s++);if(e==w)for(;s<P.Qe;s++)c[v++]=a;else for(k[0]=b[t+1],k[1]=b[t+2],0!==n?(m[0]=0,m[1]=0):0===x?(m[0]=b[t+5],m[1]=b[t+6]):(m[0]=b[t+3],m[1]=b[t+4]),0!==n?(l[0]=
0,l[1]=0):(l[0]=b[t+I+3],l[1]=b[t+I+4]),p[0]=b[t+I+1],p[1]=b[t+I+2];s<P.Qe;s++){var u=e+s/P.Qe;switch(n){case 0:g=k;h=m;var z=l,A=p,B=[],F=[],G=void 0,D=void 0,K=void 0,G=void 0;B[0]=g[0]-h[0];B[1]=g[1]-h[1];F[0]=A[0]-z[0];F[1]=A[1]-z[1];K=A[0]-g[0];G=Math.abs(B[0]);D=Math.abs(F[0]);0!=G+D&&G+D>K&&(G=K/(G+D),h[0]=g[0]-G*B[0],h[1]=g[1]-G*B[1],z[0]=A[0]-G*F[0],z[1]=A[1]-G*F[1]);V&&(d[v]=1);c[v]=y(H(0,1,u,k[0],m[0],l[0],p[0]),k[1],m[1],l[1],p[1]);v++;break;case 1:h=k[0];z=k[1];g=A=(p[1]-z)/(p[0]-h);
h=z-A*h;V&&(d[v]=1);c[v]=g*u+h;v++;break;case 2:V&&(d[v]=1);c[v]=b[t+2];v++;break;default:throw"Unknown keyframe intepolation mode: "+n;}}e+1==b[t+I+1]&&(x=n,t+=I)}}};a.fA=function(a){for(var b=0;b<a.length;b++)if(a[b].wz)return a[b];return!1};a.apply=F;a.get_slot_num_by_anim=function(a,b){for(var c=a.w,e=0;e<c.length;e++){var f=c[e];if(f&&d(f.$c)==d(b))return e}return-1};a.rv=function(a,b){var c=a.w[b];return c&&c.$c?d(c.$c):null};a.remove=function(a){a.w=null;a=ia.indexOf(a);-1!=a&&ia.splice(a,
1)};a.cx=function(a){for(var b=oa.length-1;0<=b;b--)oa[b].Cs==a&&oa.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.w)return F(a,b,0)?0:-1;for(var c=0;c<a.w.length;c++)if(!a.w[c])return F(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.d.ek=(b-a.d.Ed)/c;a.d.dk=b};a.set_speed=function(a,b,c){f(a.w,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.w[b].speed};a.get_anim_start_frame=function(a,b){return a.w[b].start};a.get_anim_length=function(a,b){return a.w[b].length};
a.fl=G;a.cleanup=function(){ia.length=0;oa.length=0};a.Uu=function(a,b){var c=a[b],d=(c[0]||c[1]||c[2]).Nb.length,e=V,f=D,g=Boolean(c[0]);g||(c[0]={Nb:new Float32Array(d)});var h=Boolean(c[1]);h||(c[1]={Nb:new Float32Array(d)});var k=Boolean(c[2]);k||(c[2]={Nb:new Float32Array(d)});c[3]={Nb:new Float32Array(d)};for(var m=0;m<d;m++)f[0]=g?c[0].Nb[m]:0,f[1]=h?c[1].Nb[m]:0,f[2]=k?c[2].Nb[m]:0,N.euler_to_quat(f,e),c[0].Nb[m]=e[3],c[1].Nb[m]=e[0],c[2].Nb[m]=e[1],c[3].Nb[m]=e[2];d=b.replace("euler","quaternion");
a[d]=c;delete a[b]}};b4w.module.__transform=function(a,n){function b(a){var e=a.d;d.Cy(a,u);g.Ay(a);"CAMERA"==a.type&&g.Ht(a);var m=e.e,t=e.scale,x=e.quat;p.Sh(m,t,x,e.Tc);var n=e.G;z.identity(n);z.fromQuat(x,n);"CAMERA"!=a.type&&v.mx(n,t,n);n[12]=m[0];n[13]=m[1];n[14]=m[2];z.invert(n,e.bp);a.w&&h.Ri(a)&&h.Dy(a);e.Db&&e.Ha&&(c.nk(e.Db,n,e.Ha),c.pk(e.rc,n,e.jb),c.ok(e.Ee,e.Tc,e.Fe),e.Lb&&k.Ul(k.get_active()));switch(a.type){case "SPEAKER":f.Wx(a,u);break;case "CAMERA":g.Xq(a);k.V()&&f.sw(k.get_active(),m,x,u);break;case "LAMP":l.Fy(a);
k.V()&&k.Oj(a,k.get_active());break;case "EMPTY":a.field&&k.Zq(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!k.V()||(e=k.get_active(),k.Ul(e),k.qx(e));a=a.Dd;for(e=0;e<a.length;e++)b(a[e])}var c=n("__boundings"),g=n("__camera"),d=n("__constraints"),l=n("__lights"),h=n("__particles"),k=n("__scenes"),f=n("__sfx"),p=n("__tsr"),v=n("__util"),m=n("vec3"),x=n("quat"),t=n("mat3"),z=n("mat4"),e=new Float32Array(3),B=new Float32Array(4),A=new Float32Array(9),u=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){u=
a};a.set_translation=function(a,b){d.pd(a)==d.Yc?p.Fx(b,d.od(a)):a.d.e.set(b)};a.get_translation=function(a,b){d.pd(a)==d.Yc?m.copy(p.Ko(d.od(a)),b):m.copy(a.d.e,b)};a.set_rotation=function(a,b){d.pd(a)==d.Yc?p.Vl(b,d.od(a)):a.d.quat.set(b)};a.get_rotation=function(a,b){d.pd(a)==d.Yc?x.copy(p.Fo(d.od(a)),b):x.copy(a.d.quat,b)};a.set_rotation_euler=function(a,b){if(d.pd(a)==d.Yc){var c=v.euler_to_quat(b,B);p.Vl(c,d.od(a))}else v.euler_to_quat(b,a.d.quat)};a.set_scale=function(a,b){d.pd(a)==d.Yc?p.set_scale(b,
d.od(a)):a.d.scale=b};a.get_scale=function(a){return d.pd(a)==d.Yc?p.get_scale(d.od(a)):a.d.scale};a.Ov=function(a,b){if(d.pd(a)==d.Yc)p.copy(d.od(a),b);else{var c=a.d;p.Sh(c.e,c.scale,c.quat,b)}};a.qq=function(a,b){if(d.pd(a)==d.Yc)p.copy(b,d.od(a));else{var c=a.d;c.e[0]=b[0];c.e[1]=b[1];c.e[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}};a.get_object_size=function(a){var b=a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),
b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(b=a.d,m.copy(b.jb.t,c)):(b=a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,m.transformMat4(c,b.G,c));return c};a.move_local=function(a,b,c,d){a=a.d;e[0]=b;e[1]=c;e[2]=d;b=t.fromMat4(a.G,A);m.transformMat3(e,b,e);m.add(a.e,e,a.e)};a.v=b;a.distance=function(a,b){return m.dist(a.d.e,b.d.e)};a.Lw=function(a,b){return m.dist(a.d.e,
b)};a.get_object_bounding_box=function(a){return{max_x:a.d.Ha.max_x,min_x:a.d.Ha.min_x,max_y:a.d.Ha.max_y,min_y:a.d.Ha.min_y,max_z:a.d.Ha.max_z,min_z:a.d.Ha.min_z}}};b4w.module.__tsr=function(a,n){function b(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function c(a,b,c){var d=b[0],g=b[1],h=b[2],k=b[3],e=b[4],l=b[5],n=b[6];b=b[7];var u=a[0]*k,s=a[1]*k,q=a[2]*k;a=b*u+l*q-n*s;var k=b*s+n*u-e*q,K=b*q+e*s-l*u,u=-e*u-l*s-n*q;c[0]=a*b+u*-e+k*-n-K*-l;c[1]=k*b+u*-l+K*-e-a*-n;c[2]=K*b+u*-n+a*-l-k*-e;c[0]+=d;c[1]+=g;c[2]+=h;return c}var g=n("__util"),d=n("vec3"),l=n("quat");n("mat4");var h=new Float32Array(3),k=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.Of=function(a,c,d,g){g||(g=new Float32Array(8));b(a,c,d,g);return g};a.Sh=b;a.Fx=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.Gx=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.Vl=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.Ko=function(a){return a.subarray(0,
3)};a.get_scale=function(a){return a[3]};a.Fo=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],g=a[1],h=a[2];k[0]=a[4];k[1]=a[5];k[2]=a[6];k[3]=a[7];l.invert(k,k);var n=k[0],e=k[1],B=k[2],A=k[3],d=d*c,g=g*c,u=h*c,h=A*d+e*u-B*g,s=A*g+B*d-n*u,q=A*u+n*g-e*d,d=-n*d-e*g-B*u;b[0]=-(h*A+d*-n+s*-B-q*-e);b[1]=-(s*A+d*-e+q*-n-h*-B);b[2]=-(q*A+d*-B+h*-e-s*-n);b[3]=c;b[4]=n;b[5]=e;b[6]=B;b[7]=A;return b};a.uo=function(a,c){var d=g.gf(a,h),m=g.cj(a),l=g.matrix_to_quat(a,
k);b(d,m,l,c);return c};a.multiply=function(a,b,d){c(b,a,d);d[3]=a[3]*b[3];var g=a[4],h=a[5],k=a[6];a=a[7];var l=b[4],e=b[5],n=b[6];b=b[7];d[4]=g*b+a*l+h*n-k*e;d[5]=h*b+a*e+k*l-g*n;d[6]=k*b+a*n+g*e-h*l;d[7]=a*b-g*l-h*e-k*n;return d};a.Wh=c;a.Dg=function(a,b,c,d){d||(d=0);var g=a.length,h=b[0],k=b[1],e=b[2],l=b[3],n=b[4],u=b[5],s=b[6];b=b[7];for(var q=0;q<g;q+=3){var K=a[q]*l,H=a[q+1]*l,y=a[q+2]*l,J=b*K+u*y-s*H,r=b*H+s*K-n*y,F=b*y+n*H-u*K,K=-n*K-u*H-s*y;c[d+q]=J*b+K*-n+r*-s-F*-u;c[d+q+1]=r*b+K*-u+
F*-n-J*-s;c[d+q+2]=F*b+K*-s+J*-u-r*-n;c[d+q]+=h;c[d+q+1]+=k;c[d+q+2]+=e}};a.Jj=function(a,b,c,d){d||(d=0);var g=a.length,h=b[3],k=b[4],e=b[5],l=b[6];b=b[7];for(var n=0;n<g;n+=3){var u=a[n]*h,s=a[n+1]*h,q=a[n+2]*h,K=b*u+e*q-l*s,H=b*s+l*u-k*q,y=b*q+k*s-e*u,u=-k*u-e*s-l*q;c[d+n]=K*b+u*-k+H*-l-y*-e;c[d+n+1]=H*b+u*-e+y*-k-K*-l;c[d+n+2]=y*b+u*-l+K*-e-H*-k}};a.Ij=function(a,b,c){var d=b[3],g=b[4],h=b[5],k=b[6];b=b[7];var e=a[0]*d,l=a[1]*d,n=a[2]*d;a=b*e+h*n-k*l;var d=b*l+k*e-g*n,u=b*n+g*l-h*e,e=-g*e-h*l-
k*n;c[0]=a*b+e*-g+d*-k-u*-h;c[1]=d*b+e*-h+u*-g-a*-k;c[2]=u*b+e*-k+a*-h-d*-g};a.Tq=function(a,b,c,d){d||(d=0);var g=a.length,h=b[3],k=b[4],e=b[5],l=b[6];b=b[7];for(var n=0;n<g;n+=4){var u=a[n]*h,s=a[n+1]*h,q=a[n+2]*h,K=b*u+e*q-l*s,H=b*s+l*u-k*q,y=b*q+k*s-e*u,u=-k*u-e*s-l*q;c[d+n]=K*b+u*-k+H*-l-y*-e;c[d+n+1]=H*b+u*-e+y*-k-K*-l;c[d+n+2]=y*b+u*-l+K*-e-H*-k;c[d+n+3]=a[n+3]}};a.translate=function(a,b,c){var d=a[3],g=a[4],h=a[5],k=a[6],e=a[7],l=b[0]*d,n=b[1]*d,u=b[2]*d;b=e*l+h*u-k*n;var d=e*n+k*l-g*u,s=
e*u+g*n-h*l,l=-g*l-h*n-k*u;c[0]=a[0]+b*e+l*-g+d*-k-s*-h;c[1]=a[1]+d*e+l*-h+s*-g-b*-k;c[2]=a[2]+s*e+l*-k+b*-h-d*-g;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.IA=function(a,b,c,g){g||(g=new Float32Array(8));d.lerp(a.subarray(0,3),b.subarray(0,3),c,g.subarray(0,3));var h=a[3];g[3]=h+c*(b[3]-h);l.slerp(a.subarray(4),b.subarray(4),c,g.subarray(4));return g};a.dA=function(a,b,c,d){d||(d=new Float32Array(8));var g=a.subarray(0,3),h=b.subarray(0,3),k=d.subarray(0,3);k[0]=h[0]*(c+1)-g[0]*
c;k[1]=h[1]*(c+1)-g[1]*c;k[2]=h[2]*(c+1)-g[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);g=d.subarray(4);g[0]=b[0]*(c+1)-a[0]*c;g[1]=b[1]*(c+1)-a[1]*c;g[2]=b[2]*(c+1)-a[2]*c;g[3]=b[3]*(c+1)-a[3]*c;l.normalize(g,g);return d};a.fw=function(a,b,c,d,g){var h=a.subarray(0,3),k=g.subarray(0,3);k[0]=h[0]+b*c[0];k[1]=h[1]+b*c[1];k[2]=h[2]+b*c[2];g[3]=a[3];a=a.subarray(4);g=g.subarray(4);c=d[0];h=d[1];d=d[2];var k=a[0],e=a[1],n=a[2],A=a[3];g[0]=.5*(c*A+h*n-d*e);g[1]=.5*(h*A+d*k-c*n);g[2]=.5*
(d*A+c*e-h*k);g[3]=.5*(-c*k-h*e-d*n);g[0]=a[0]+g[0]*b;g[1]=a[1]+g[1]*b;g[2]=a[2]+g[2]*b;g[3]=a[3]+g[3]*b;l.normalize(g,g)}};b4w.module.__util=function(a,n){function b(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function c(a,b){var d=a instanceof Array?[]:{},e;for(e in a)d[e]=!a[e]||"object"!=typeof a[e]||-1!=b.indexOf(a[e])||a[e]instanceof Float32Array?a[e]:c(a[e],b);return d}function g(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function d(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function l(a,b){var c=b;switch(typeof a){case "number":return h(a,
c);case "string":return k(a,c);case "boolean":return h(a|0,c);case "function":case "undefined":return h(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=h(a[d],c);else if(d)for(d=0;d<a.length;d++)c=l(a[d],c);else for(var e in a)c=l(a[e],c)}else c=h(0,c)}return c}function h(a,b){var c=b;T[0]=a;c=(c<<5)-c+S[0];c&=c;c=(c<<5)-c+S[1];return c&c}function k(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),
c&=c;return c}function f(a){return(34*a+1)*a%289}function p(a){return a-Math.floor(a)}function v(a){return m((34*a+5)*a)}function m(a){return a-289*Math.floor(a/289)}function x(a){return a-7*Math.floor(a/7)}function t(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!z(a[c],b[c]))return!1}else if(d){if(a.length!=
b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!z(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function z(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return t(a,b);default:return!0}}var e=n("__print"),B=n("vec3"),A=n("vec4"),u=n("quat"),s=n("mat3"),q=n("mat4"),K=0,H={},y=new Float32Array(3),J=new Float32Array(3),r=new Float32Array(4),F=new Float32Array(4),
G=new Float32Array(9),W=new Float32Array(16),T=new Float64Array(1),S=new Uint32Array(T.buffer),R=new Float32Array([0,0,0]),L=new Float32Array([0,0,0,1]),O=new Float32Array([0,0,0,1,0,0,0,1]),Q=new Float32Array([1,0,0]),Z=new Float32Array([0,1,0]),N=new Float32Array([0,0,1]),da=new Float32Array([-1,0,0]),P=new Float32Array([0,-1,0]),ja=new Float32Array([0,0,-1]),D=Math.floor(44488.07041494893);a.zs=R;a.us=L;a.tz=O;a.AXIS_X=Q;a.AXIS_Y=Z;a.AXIS_Z=N;a.AXIS_MX=da;a.AXIS_MY=P;a.AXIS_MZ=ja;a.keyfind=b;a.Xu=
function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.vy=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Ct=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.et=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.sign=function(a){return 0<a?1:0>a?-1:0};a.SA=function(a,b,c){for(var d=c.length,
e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.RA=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.cl=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.at=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.Nz=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;
return!0};a.eB=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.cB=function(a,c){var d=b("name",c,a);1<d.length&&e.error("obj_by_name(): name resolution ambiguity");return d};a.dB=function(a,c){var d=b("name",c,a),f=d.length;1<f&&e.error("obj_by_name(): name resolution ambiguity");if(0>=f)return[];for(var g=[],h=0;h<f;h++){var k=d[h];if("EMPTY"==k.type&&k.dupli_group)for(var k=k.dupli_group.objects,l=0;l<k.length;l++)g.push(k[l])}return d=d.concat(g)};a.sy=
function(a,b,c,d){d||(d=new Float32Array(16));q.identity(d);d[12]=a;d[13]=b;d[14]=c};var ga=1;a.Yw=function(){ga=(69069*ga+5)%Math.pow(2,32);return Math.round(ga/65536)%32768/32767};a.by=function(a){ga=a};a.kc=function(a){var b=a[0]%D*48271-3399*Math.floor(a[0]/D);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.Ti=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),g=Math.sin(a[2]/
2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=e*e,h=c*d+e*f;.499999<h?(b[0]=0,b[1]=2*Math.atan2(c,f),b[2]=Math.PI/2):-.499999>h?(b[0]=0,b[1]=-2*Math.atan2(c,f),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*f-2*d*e,1-2*c*c-2*g),b[1]=Math.atan2(2*d*f-2*c*e,1-2*d*d-2*g),b[2]=Math.asin(2*c*d+2*e*f));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));B.transformQuat(b,a,c);return c};
a.$z=function(a,b,c){c||(c=new Float32Array(4));a=B.normalize(a,y);var d=B.dot(b,a);a=B.cross(b,a,J);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.ty=function(a,b,c,d){d||(d=new Float32Array(4));B.transformQuat(c,b,d);d[3]=-B.dot(a,d)};a.Eu=function(a){var b=a.d.quat;switch(a.type){case "CAMERA":y[0]=0;y[1]=-1;y[2]=0;B.transformQuat(y,b,y);J[0]=0;J[1]=0;J[2]=-1;break;case "MESH":y[0]=0;y[1]=0;y[2]=1;B.transformQuat(y,b,y);J[0]=
0;J[1]=0;J[2]=1;break;case "EMPTY":y[0]=0,y[1]=1,y[2]=0,B.transformQuat(y,b,y),J[0]=0,J[1]=1,J[2]=0}y[1]=0;B.normalize(y,y);a=B.dot(y,J);return Math.acos(a)*(0<-y[0]*J[2]?-1:1)};a.kn=function(a,b,c,d){if(0!=c){d=d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e]}};a.vB=function(){K++;return K.toString(16)};a.Lj=function(a){H[a]||(H[a]=0);var b=a+H[a];H[a]++;return b};a.fd=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.lb=function(a){var b=
{a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,C:0,X:null,r:[],A:b}};a.Zo=function(a){return{name:a,type:"MESH",modifiers:[],particle_systems:[],data:null}};a.Ie=function(a){return JSON.parse(JSON.stringify(a))};a.Pz=function(a,b){var d=[],e;for(e in b){var f=b[e];if(f)for(var g=0;g<f.length;g++)d.push(f[g])}return c(a,d)};a.ra=function(b){var c=b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof Float32Array?
new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.ra(b[d]):b[d];return c};a.Yg=function(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?new Float32Array(a[c]):a[c]instanceof Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof Array?a[c].slice(0):a[c]:a[c];return b};a.sc=function(a){return"MESH"===a.type?!0:!1};a.ep=function(a){return"MESH"===
a.type&&a.d&&"DYNAMIC"===a.d.type?!0:!1};a.jw=function(a){return"EMPTY"===a.type?!0:!1};a.Xe=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));s.fromMat4(a,G);var c=G[0],d=G[3],e=G[6],f=G[1],g=G[4],h=G[7],k=G[2],l=G[5],m=G[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+g*g+h*h)||1,k=Math.sqrt(k*k+l*l+m*m)||1;G[0]/=c;G[3]/=c;G[6]/=c;G[1]/=f;G[4]/=f;G[7]/=f;G[2]/=k;G[5]/=k;G[8]/=k;u.fromMat3(G,b);return b};a.gf=function(a,b){b||(b=new Float32Array(3));
b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.cj=function(a){r[0]=.577350269189626;r[1]=.577350269189626;r[2]=.577350269189626;r[3]=0;A.transformMat4(r,a,r);return A.length(r)};a.lo=function(a,b){var c=b.left,d=b.right,e=b.top,f=b.bottom,h=b.Da,k=b.Ka;c[0]=a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-a[8];d[3]=a[15]-a[12];e[0]=a[3]-a[1];e[1]=a[7]-a[5];e[2]=a[11]-a[9];e[3]=a[15]-a[13];f[0]=a[3]+a[1];f[1]=a[7]+a[5];f[2]=a[11]+a[9];f[3]=a[15]+a[13];
h[0]=a[3]+a[2];h[1]=a[7]+a[6];h[2]=a[11]+a[10];h[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];g(c);g(d);g(e);g(f);g(h);g(k)};a.Xx=function(a,b,c){return c<-d(a,b.left)||c<-d(a,b.right)||c<-d(a,b.top)||c<-d(a,b.bottom)||c<-d(a,b.Da)||c<-d(a,b.Ka)?!0:!1};a.Lu=function(a,b,c,e,f){g=B.dot(c,b.Ka);h=B.dot(e,b.Ka);k=B.dot(f,b.Ka);g=Math.sqrt(g*g+h*h+k*k);if(g<-d(a,b.Da)||g<-d(a,b.Ka))return!0;var g=B.dot(c,b.left),h=B.dot(e,b.left),k=B.dot(f,b.left);if(Math.sqrt(g*g+h*
h+k*k)<-d(a,b.left))return!0;g=B.dot(c,b.right);h=B.dot(e,b.right);k=B.dot(f,b.right);if(Math.sqrt(g*g+h*h+k*k)<-d(a,b.right))return!0;g=B.dot(c,b.top);h=B.dot(e,b.top);k=B.dot(f,b.top);if(Math.sqrt(g*g+h*h+k*k)<-d(a,b.top))return!0;g=B.dot(c,b.bottom);h=B.dot(e,b.bottom);k=B.dot(f,b.bottom);return Math.sqrt(g*g+h*h+k*k)<-d(a,b.bottom)?!0:!1};a.ce=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*
k+b[13];c[d+f+2]=b[2]*g+b[6]*h+b[10]*k+b[14]}};a.Vy=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k}};a.py=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],k=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*k;c[d+f+1]=b[1]*g+b[5]*h+b[9]*k;c[d+f+2]=b[2]*g+b[6]*h+b[10]*k;c[d+f+3]=a[f+3]}};a.Ty=function(a,b,c){c||(c=new Float32Array(3));r[0]=a[0];r[1]=a[1];r[2]=a[2];
r[3]=0;A.transformMat4(r,b,r);c[0]=r[0];c[1]=r[1];c[2]=r[2]};a.gA=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.Uy=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.si=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.si(b,
c,d,f-1):b[f]<c?a.si(b,c,f+1,e):f};a.Kd=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.Ai=function(a,b){for(var c=0;c<a.length;c++)if(1E-7<Math.abs(a[c]-b[c]))return!1;return!0};a.mx=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.pm=function(a,b,c,d){d||(d=new Float32Array(16));b=q.fromRotationTranslation(b,c,W);q.multiply(b,a,d)};a.Wh=function(a,b,c,d,e){e||(e=new Float32Array(3));b=q.fromRotationTranslation(c,
d,W);B.transformMat4(a,b,e);return e};a.qm=function(a,b,c,d){d||(d=new Float32Array(4));b=q.fromRotationTranslation(b,c,W);A.transformMat4(a,b,d)};a.JA=function(a,b,c,d,e){e||(e=new Float32Array(3));b=q.fromRotationTranslation(c,d,W);q.invert(b,b);B.transformMat4(a,b,e);return e};a.sB=function(a,b,c){c||(c=new Float32Array(16));q.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.aB=function(b,c,d){a.gf(b,c);c[3]=a.cj(b);a.matrix_to_quat(b,d)};a.Zm=function(a){for(var b=[],
c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.kq=function(a,b,c,d){d||(d=new Float32Array(3));B.subtract(b,a,y);B.transformQuat(y,c,y);B.subtract(b,y,d)};a.gv=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16),g=new Float32Array(16);q.lookAt(a,[-1,0,0],[0,-1,0],b);q.scale(b,[-1,1,1],b);q.scale(b,[-1,1,-1],c);q.lookAt(a,[0,0,-1],[0,-1,0],d);q.scale(d,[-1,1,1],d);q.scale(d,[-1,1,
-1],e);q.lookAt(a,[0,-1,0],[0,0,-1],g);q.scale(g,[1,1,-1],g);q.scale(g,[-1,-1,-1],f);return[f,g,b,c,d,e]};a.Wg=function(a,b){return l(a,b)};a.hash_code=l;a.CA=k;a.$A=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,k,l,m,p,q,r,t,v,n;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];h=a[2];k=a[3];l=a[4];m=a[5];p=a[6];q=a[7];r=a[8];t=a[9];v=a[10];n=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=
k;c[4]=l;c[5]=m;c[6]=p;c[7]=q;c[8]=r;c[9]=t;c[10]=v;c[11]=n;c[12]=f*d+l*e+r*b+a[12];c[13]=g*d+m*e+t*b+a[13];c[14]=h*d+p*e+v*b+a[14];c[15]=k*d+q*e+n*b+a[15];return c};a.xw=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):
(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.Xw=function(a){return a*Math.PI/180};a.Xz=function(a){return 180*a/Math.PI};a.bm=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var g=b>a?1:0,h=1-g,e=b+.211324865405187-g,k=a+.211324865405187-h,l=b+-.577350269189626,m=a+-.577350269189626,c=c%289,d=d%289,q=f(f(d)+c),h=f(f(d+
h)+c+g),r=f(f(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+k*k),0),g=Math.max(.5-(l*l+m*m),0),t=2*p(.024390243902439*q)-1,v=2*p(.024390243902439*h)-1,n=2*p(.024390243902439*r)-1,q=Math.abs(t)-.5,h=Math.abs(v)-.5,r=Math.abs(n)-.5,t=t-Math.floor(t+.5),v=v-Math.floor(v+.5),n=n-Math.floor(n+.5),c=c*c*c*c*(1.79284291400159-.85373472095314*(t*t+q*q)),d=d*d*d*d*(1.79284291400159-.85373472095314*(v*v+h*h)),g=g*g*g*g*(1.79284291400159-.85373472095314*(n*n+r*r));return 130*(c*(t*b+q*a)+d*(v*e+h*
k)+g*(n*l+r*m))};a.wn=function(a){var b=1/7,c=b/2,d=m(Math.floor(a[0])),e=m(Math.floor(a[1])),f=p(a[0]);a=p(a[1]);var g=f-.5,h=f-1.5,f=a-.5;a-=1.5;var k=v(d),l=v(d+1),q=k,d=l,k=v(k+e),l=v(l+e),q=v(q+e+1),d=v(d+e+1),e=g+.7*(x(k)*b+c),r=h+.7*(x(l)*b+c),g=g+.7*(x(q)*b+c),h=h+.7*(x(d)*b+c),k=f+.7*(x(Math.floor(k*b))*b+c),f=f+.7*(x(Math.floor(l*b))*b+c),q=a+.7*(x(Math.floor(q*b))*b+c),b=a+.7*(x(Math.floor(d*b))*b+c);return Math.min(e*e+k*k,r*r+f*f,g*g+q*q,h*h+b*b)};a.quat_project=function(a,b,c,d,e){e||
(e=new Float32Array(4));a=B.transformQuat(b,a,y);b=c[0];var f=c[1];c=c[2];G[0]=f*f+c*c;G[1]=-f*b;G[2]=-c*b;G[3]=-b*f;G[4]=b*b+c*c;G[5]=-c*f;G[6]=-b*c;G[7]=-f*c;G[8]=b*b+f*f;B.transformMat3(a,G,a);B.normalize(a,a);u.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=r,d=F,c=u.setAxisAngle([0,1,0],Math.PI,u.create()),d=u.setAxisAngle([1,0,0],Math.PI/2,u.create());u.multiply(c,d,c);u.multiply(a,c,b);return b};a.cleanup=function(){K=0;H={}};a.clamp=function(a,
b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.xq=function(a,b,c,d,e){e||(e=new Float32Array(a.length));u.slerp(a,b,Math.exp(-c/d),e)};a.KA=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof
ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=s.fromQuat(a,G);J[0]=0;J[1]=1;J[2]=0;y[0]=c[3];y[1]=c[4];y[2]=c[5];var d=B.cross(J,y,y);B.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);J[0]=c[0];J[1]=c[1];J[2]=c[2];B.normalize(J,J);u.rotationTo(J,d,F);u.multiply(F,a,a)};a.yo=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],k=a[e*b+Math.min(c+1,g)],l=a[Math.min(e+
1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+k*d)*(1-f)+(l*(1-d)+a*d)*f};a.vf=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.iq=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.Ph=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.dv=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.Se=function(a){var b=0,c;
for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];B.normalize(c,c)};a.tB=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var k=g*a-h*e,l=h*d-f*a,m=f*e-g*d,p=g*m-h*l,h=h*k-f*m,f=f*l-g*k;c[0]=d+2*k*b+2*p;c[1]=e+2*l*b+2*h;c[2]=a+2*m*b+2*f;return c};a.da=function(a){a&&e.error.apply(e,
arguments);throw"panic: see above for possible error messages";};a.ze=function(a){return a-2*Math.floor(a/(2*Math.PI))*Math.PI};a.al=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.Kq=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=t(e,f)}if(!d)return!1}return!0};a.Ww=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.cv=function(a){a+=1;132651<a&&e.error("Color ID pool depleted");
var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return[b/51,c/51,a%51/51]};a.line_plane_intersect=function(a,b,c,d,e){r.set(a);r[3]=b;F.set(d);F[3]=0;a=A.dot(r,F);if(0==a)return null;F.set(c);F[3]=1;a=-A.dot(r,F)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.Rz=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.mq=function(a,b,c){var d=B.dot(a,b);-.9999999>d?(B.cross(Q,a,y),1E-6>B.length(y)&&B.cross(Z,a,y),B.normalize(y,y),u.setAxisAngle(y,Math.PI,c)):(B.cross(a,
b,y),c.set(y),c[3]=1+d,u.normalize(c,c));return c}};b4w.module.__sfx=function(a,n){function b(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;m.warn("B4W warning: deprecated WebAudio implementation");return null}m.warn("B4W warning: WebAudio is not supported");return null}function c(a,b,c){var f=a.g;if("NONE"!=f.behavior){c||(c=0);var g=f.loop,k=f.pitch;if(f.src&&(g||0<=c)){f.ik=Math.floor(5E4*Math.random());b=q.currentTime+b;f.Yb=b;f.state=20;var m=a.g;if(!m.Jb){var t=a.d.e,v=a.d.quat;if(z.gj){var n=q.createBiquadFilter();
n.type="peaking"}else n=null;var s=q.createGain();switch(m.behavior){case "POSITIONAL":var u=q.createPanner();u.panningModel=u.EQUALPOWER;u.distanceModel=u.INVERSE_DISTANCE;u.setPosition(t[0],t[1],t[2]);m.ql.set(t);var y=e;x.quat_to_dir(v,x.AXIS_MY,y);u.setOrientation(y[0],y[1],y[2]);m.direction.set(y);u.refDistance=m.dist_ref;u.maxDistance=m.dist_max;u.rolloffFactor=m.attenuation;u.coneInnerAngle=m.Mt;u.coneOuterAngle=m.Nt;u.coneOuterGain=m.Ot;y=q.createGain();y.gain.value=p(m);n?(u.connect(n),n.connect(y)):
u.connect(y);y.connect(s);m.Jb=u;if(m.Lg){var A=q.createGain();s.connect(A);A.connect(q?K.g.Jb:null)}else A=null,s.connect(q?K.g.Jb:null);break;case "BACKGROUND_SOUND":u=null;y=q.createGain();y.gain.value=p(m);n?(m.Jb=n,n.connect(y)):m.Jb=y;y.connect(s);m.Lg?(A=q.createGain(),s.connect(A),A.connect(q?K.g.Jb:null)):(A=null,s.connect(q?K.g.Jb:null));break;case "BACKGROUND_MUSIC":A=u=null,y=q.createGain(),y.gain.value=p(m),n?(m.Jb=n,n.connect(y)):m.Jb=y,y.connect(s),s.connect(q?K.g.Jb:null)}m.Bh=u;m.Hc=
n;m.Xf=y;m.Oe=s;m.bq=A}if("POSITIONAL"==f.behavior||"BACKGROUND_SOUND"==f.behavior)a=q.createBufferSource(),a.buffer=f.src,a.playbackRate.value=k,g?(f.Xa&&f.Xa.disconnect(),a.loop=!0,a.start(b),f.duration=0):(g=a.buffer?a.buffer.duration:0,c>g?(g=b+c+f.ld,a.loop=!0,a.start(b),a.stop(g),f.duration=c):(a.loop=!1,a.start(b),f.duration=g)),a.connect(f.Jb),f.Xa=a,d(f),l(f);else if("BACKGROUND_MUSIC"==f.behavior){window.clearTimeout(f.hn);c=a.g;if(g=c.src)g.volume=1,g.loop=c.cyclic,c.Xa=c.Xa||q.createMediaElementSource(g),
c.Xa.connect(c.Jb),20==c.state&&g.play();f.duration=1E6}h(f,b)}}}function g(a){var b=a.g,d=b.duration,b=b.delay+b.Cu*Math.random();c(a,b,d)}function d(a){a.Lg&&a.bq.gain.cancelScheduledValues(a.Yb);a.Gh&&a.Xa.playbackRate.cancelScheduledValues(a.Yb);a.bi=a.Yb}function l(a){if(a.Lg||a.Gh){var b=a.bq,c=a.Xa,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Yb;y[0]=a.ik;for(var f=0;5>f;){var g=a.pitch+a.Gh*x.kc(y);if(e>=a.bi){if(a.Lg){var h=1-x.clamp(a.Lg,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.Gh&&
c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.bi=e-.001}}}function h(a,b){if(a.Pk||a.ld){var c=a.Oe;c.gain.cancelScheduledValues(b);a.Pk?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.Pk)):c.gain.setValueAtTime(1,b);a.ld&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.ld))}}function k(a){if("SPEAKER"!=a.type)throw"Wrong object type";a=a.g;if(20==a.state||40==a.state){var b=a.Oe,c=q.currentTime;a.ld&&(b.gain.setValueAtTime(b.gain.value,
c),b.gain.linearRampToValueAtTime(0,c+a.ld));if("BACKGROUND_MUSIC"==a.behavior){var d=a.src;d&&(a.hn=window.setTimeout(function(){d.currentTime&&(d.currentTime=0);d.pause()},1E3*a.ld))}else b=a.Xa,a.duration<b.buffer.duration?a.ld&&20==a.state?b.stop(c+a.ld):20==a.state&&(b.stop(0),b.disconnect()):b.disconnect(),a.Yb=0,a.Kl=0,a.qk=0;a.state=30}}function f(a){return!a.g||20!=a.g.state&&40!=a.g.state&&30!=a.g.state?!1:!0}function p(a){return a.muted?0:a.volume}var v=n("__config"),m=n("__print"),x=n("__util"),
t=n("vec3"),z=v.yd;a.Cm=10;a.Vj=20;a.Bm=30;var e=new Float32Array(3),B=new Float32Array(3),A=new Float32Array(3),u=[],s=[],q=null,K=null,H=[],y=[1],J=null;a.init=function(){var a=document.createElement("audio"),c=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(u.push("ogg"),u.push("ogv")),""!=a.canPlayType("audio/mpeg")&&u.push("mp3"),""!=a.canPlayType("audio/mp4")&&(u.push("mp4"),u.push("m4v")),""!=a.canPlayType("audio/webm")&&u.push("webm"));c.canPlayType&&(""!=
c.canPlayType("video/ogg")&&s.push("ogv"),""!=c.canPlayType("video/mp4")&&s.push("m4v"),""!=c.canPlayType("video/webm")&&s.push("webm"));(q=z.az?b():null)&&m.log("%cINIT WEBAUDIO: "+q.sampleRate+"Hz","color: #00a")};a.bn=function(a){var b={df:new Float32Array(3),op:new Float32Array(3),dg:new Float32Array(3)};a.g=b;if(q){var c=q.createGain(),d=q.createGain();b.Xf=c;b.Oe=d;c.connect(d);d.connect(q.destination);if(a.b4w_enable_dynamic_compressor){var d=q.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;
d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.Zg=d;b.Jb=d}else b.Zg=null,b.Jb=c;c=q.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=!1;b.volume=1;b.Ne=0}};a.vx=function(a){K=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<u.indexOf(a)?a:"ogg"==a&&-1<u.indexOf("mp4")?"mp4":"mp3"==a&&-1<u.indexOf("ogg")?"ogg":"mp4"==a&&-1<u.indexOf("ogg")?"ogg":"ogv"==
a&&-1<u.indexOf("m4v")?"m4v":"webm"==a&&-1<u.indexOf("m4v")?"m4v":"m4v"==a&&-1<u.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<s.indexOf(a)?a:"ogv"==a&&-1<s.indexOf("m4v")?"m4v":"webm"==a&&-1<s.indexOf("m4v")?"m4v":"m4v"==a&&-1<s.indexOf("webm")?"webm":""};a.append_object=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.g={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.g.behavior=q?b.b4w_behavior:"NONE";break;
case "BACKGROUND_MUSIC":var c=a.g,d;q?(window.MediaElementAudioSourceNode?d=!0:(m.warn("B4W warning: MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.g.behavior="NONE");a.g.Fu=b.b4w_disable_doppler;a.g.muted=b.muted;a.g.volume=b.volume;a.g.pitch=b.pitch;a.g.attenuation=b.attenuation;a.g.dist_ref=b.distance_reference;a.g.dist_max=b.distance_max||1E4;a.g.Mt=b.cone_angle_inner;a.g.Nt=
b.cone_angle_outer;a.g.Ot=b.cone_volume_outer;a.g.cyclic=b.b4w_cyclic_play;a.g.loop=b.b4w_loop;a.g.delay=b.b4w_delay;a.g.Cu=b.b4w_delay_random;a.g.Lg=b.b4w_volume_random;a.g.Gh=b.b4w_pitch_random;a.g.Pk=b.b4w_fade_in;a.g.ld=b.b4w_fade_out;a.g.Yb=0;a.g.Kl=0;a.g.qk=0;a.g.duration=0;a.g.bi=0;a.g.ik=1;a.g.src=null;a.g.state=10;a.g.ql=new Float32Array(3);a.g.direction=new Float32Array(3);a.g.dm=new Float32Array(3);a.g.hn=null;a.g.Ne=0;H.push(a)};a.yq=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";
switch(b.g.behavior){case "POSITIONAL":return a.Vj;case "BACKGROUND_SOUND":return a.Vj;case "BACKGROUND_MUSIC":return a.Bm;case "NONE":return a.Cm;default:throw"Wrong speaker behavior";}};a.Ky=function(a,b){var c=a.g;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.Pw=function(){var a=q.createBufferSource();a.buffer=q.createBuffer(1,22050,22050);a.connect(q.destination);a.start(0)};a.zu=
function(a,b,c){q?q.decodeAudioData(a,b,c):c()};a.Vx=function(a){k(a);delete a.g;H.splice(H.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<H.length;a++){var b=H[a].g;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.Xa&&b.Xa.disconnect()}K&&K.g&&(a=K.g,a.df[0]=0,a.df[1]=0,a.df[2]=0,a.dg[0]=0,a.dg[1]=0,a.dg[2]=0);K=null;H.splice(0);J=null};a.update=function(a){if(q&&0!=H.length){for(var b=0;b<H.length;b++){var c=H[b],d=c.g,e=q.currentTime;!d.loop&&d.cyclic&&20==d.state&&d.duration&&q&&d.Yb+
d.duration<e&&g(c);20==d.state&&3>d.bi-e&&l(d)}J&&(-1==J.wa||a>J.Tm+J.co[J.wa])&&(b=J,-1<b.wa&&k(b.le[b.wa]),-1==b.wa&&b.random?c=Math.round(Math.random()*(b.le.length-1)):b.random?(c=1+Math.round(Math.random()*(b.le.length-2)),c=(b.wa+c)%b.le.length):c=(b.wa+1)%b.le.length,g(b.le[c]),b.wa=c,b.Tm=a)}};a.play=c;a.play_def=g;a.stop=k;a.is_play=function(a){return 20==a.g.state};a.playrate=function(a,b){var c=a.g;c.pitch=b;!f(a)||"POSITIONAL"!=c.behavior&&"BACKGROUND_SOUND"!=c.behavior||(c.Xa.playbackRate.value=
b,d(c),l(c))};a.wA=function(a){return a.g.pitch};a.cyclic=function(a,b){a.g.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.g.cyclic};a.sw=function(a,b,c,d){if(q&&a.g){var f=e;f[0]=0;f[1]=-1;f[2]=0;t.transformQuat(f,c,f);B[0]=0;B[1]=0;B[2]=-1;t.transformQuat(B,c,B);c=q.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(f[0],f[1],f[2],B[0],B[1],B[2]);a.g.op.set(f);d&&(A[0]=(b[0]-a.g.df[0])/d,A[1]=(b[1]-a.g.df[1])/d,A[2]=(b[2]-a.g.df[2])/d,x.smooth_v(A,a.g.dg,d,.3,A),c.setVelocity(A[0],A[1],
A[2]),a.g.dg.set(A));a.g.df.set(b)}};a.listener_reset_speed=function(a,b){if(q&&K.g){var c=e;b?c.set(b):c.set(K.g.op);t.scale(c,a,c);q.listener.setVelocity(c[0],c[1],c[2]);K.g.dg.set(c)}};a.Wx=function(a,b){var c=a.g;if(f(a)&&"POSITIONAL"==c.behavior){var d=a.d.e,g=c.Bh;g.setPosition(d[0],d[1],d[2]);var h=e;x.quat_to_dir(a.d.quat,x.AXIS_MY,h);g.setOrientation(h[0],h[1],h[2]);h=c.ql;!c.Fu&&b&&(B[0]=(d[0]-h[0])/b,B[1]=(d[1]-h[1])/b,B[2]=(d[2]-h[2])/b,x.smooth_v(B,c.dm,b,.3,B),g.setVelocity(B[0],B[1],
B[2]),c.dm.set(B));h.set(d)}};a.speaker_reset_speed=function(a,b,c){var d=a.g;if(f(a)&&"POSITIONAL"==d.behavior){var g=e;c?g.set(c):g.set(d.direction);t.scale(g,b,g);d.Bh.setVelocity(g[0],g[1],g[2]);d.dm.set(g);d.ql.set(a.d.e)}};a.Yd=function(a){return a.g?!0:!1};a.dl=function(a){return a.g.behavior};a.check_active_speakers=function(){for(var a=0;a<H.length;a++)if(f(H[a]))return!0;return!1};a.Bx=function(a){var b=K.g;b&&(b.volume=a,q&&(b.Xf.gain.value=p(b)))};a.Gv=function(){var a=K.g;return a?a.volume:
0};a.set_volume=function(a,b){var c=a.g;c.volume=b;f(a)&&(c.Xf.gain.value=p(c))};a.get_volume=function(a){return a.g.volume};a.mute=function(a,b){a.g.muted=Boolean(b);f(a)&&(a.g.Xf.gain.value=p(a.g))};a.is_muted=function(a){return a.g.muted};a.Ew=function(a){var b=K.g;b&&(b.muted=Boolean(a),q&&(b.Xf.gain.value=p(b)))};a.ow=function(){var a=K.g;return a?a.muted:!1};a.get_speaker_objects=function(){return H};a.pause=function(){for(var a=0;a<H.length;a++){var b=H[a].g;if(20==b.state){if("BACKGROUND_MUSIC"==
b.behavior){var c=b.src;c&&c.pause()}else{var e=q.currentTime;b.Kl=e;if(e>b.Yb){c=b;y[0]=c.ik;for(var f=c.Xa.buffer.duration,g=c.Yb,h=void 0;g<e;)h=c.pitch+c.Gh*x.kc(y),g+=f/h;c=(f/h-(g-e))*h}else c=0;b.qk=c;b.Xa.stop(0);b.Xa.disconnect();d(b)}b.state=40}}};a.resume=function(){for(var a=0;a<H.length;a++){var b=H[a],c=b.g;if(40==c.state){if("BACKGROUND_MUSIC"==c.behavior)c.src.play();else{var b=b.g,d=q.createBufferSource();d.loop=b.Xa.loop;d.buffer=b.Xa.buffer;d.playbackRate.value=b.Xa.playbackRate.value;
b.Bh?d.connect(b.Bh):d.connect(b.Xf);b.Xa=d;b=q.currentTime;c.Yb+=b-c.Kl;c.bi=b;c.Xa.start(c.Yb,c.qk);l(c);h(c,c.Yb)}c.state=20}}};a.set_compressor_params=function(a,b){if(a.g&&a.g.Zg){var c=a.g.Zg;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.g||!a.g.Zg)return null;a=a.g.Zg;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};
a.duck=function(a,b,c){if(f(a)){a=a.g;var d=a.Oe,e=q.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.Ne=c}};a.unduck=function(a){if(f(a)){a=a.g;var b=a.Oe,c=q.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Ne);a.Ne=0}};a.Hu=function(a,b){if(q){var c=K.g,d=c.Oe,e=q.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.Ne=b}};a.wy=function(){if(q){var a=K.g,b=a.Oe,c=q.currentTime;b.gain.setValueAtTime(b.gain.value,
c);b.gain.linearRampToValueAtTime(1,c+a.Ne);a.Ne=0}};a.apply_playlist=function(a,b,c){J={wa:-1,Tm:0,random:c,le:[],co:[]};for(c=0;c<a.length;c++){var d=a[c];k(d);J.le.push(d);d=d.g;d=(d=d.src)?d.duration:0;J.co.push(d+b)}};a.clear_playlist=function(){if(J)for(var a=J.le,b=0;b<a.length;b++)k(a[b]);J=null};a.get_positional_params=function(a){return(a=a.g)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.g;
if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.Bh;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=function(a,b){var c=a.g;c&&c.Hc&&(c.Hc.frequency.value=b.freq,c.Hc.Q.value=b.Q,c.Hc.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.g)&&a.Hc?{freq:a.Hc.frequency.value,Q:a.Hc.Q.value,gain:a.Hc.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.g;if(!a||
!a.Hc)return null;a.Hc.getFrequencyResponse(b,c,d)}};b4w.module.vec3=function(a){var n="undefined"!==typeof Float32Array?Float32Array:Array,b=Math.random;a.create=function(){var a=new n(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var b=new n(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.fromValues=function(a,b,d){var l=new n(3);l[0]=a;l[1]=b;l[2]=d;return l};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set=function(a,b,d,l){l[0]=a;l[1]=b;l[2]=d;return l};a.add=function(a,b,d){d[0]=a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];return d};
a.subtract=function(a,b,d){d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];return d};a.sub=a.subtract;a.multiply=function(a,b,d){d[0]=a[0]*b[0];d[1]=a[1]*b[1];d[2]=a[2]*b[2];return d};a.mul=a.multiply;a.divide=function(a,b,d){d[0]=a[0]/b[0];d[1]=a[1]/b[1];d[2]=a[2]/b[2];return d};a.div=a.divide;a.min=function(a,b,d){d[0]=Math.min(a[0],b[0]);d[1]=Math.min(a[1],b[1]);d[2]=Math.min(a[2],b[2]);return d};a.max=function(a,b,d){d[0]=Math.max(a[0],b[0]);d[1]=Math.max(a[1],b[1]);d[2]=Math.max(a[2],b[2]);return d};
a.scale=function(a,b,d){d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;return d};a.scaleAndAdd=function(a,b,d,l){l[0]=a[0]+b[0]*d;l[1]=a[1]+b[1]*d;l[2]=a[2]+b[2]*d;return l};a.distance=function(a,b){var d=b[0]-a[0],l=b[1]-a[1],h=b[2]-a[2];return Math.sqrt(d*d+l*l+h*h)};a.dist=a.distance;a.squaredDistance=function(a,b){var d=b[0]-a[0],l=b[1]-a[1],h=b[2]-a[2];return d*d+l*l+h*h};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],d=a[1];a=a[2];return Math.sqrt(b*b+d*d+a*a)};a.len=a.length;a.squaredLength=
function(a){var b=a[0],d=a[1];a=a[2];return b*b+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];return b};a.normalize=function(a,b){var d=a[0],l=a[1],h=a[2],d=d*d+l*l+h*h;0<d&&(d=1/Math.sqrt(d),b[0]=a[0]*d,b[1]=a[1]*d,b[2]=a[2]*d);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};a.cross=function(a,b,d){var l=a[0],h=a[1];a=a[2];var k=b[0],f=b[1];b=b[2];d[0]=h*b-a*f;d[1]=
a*k-l*b;d[2]=l*f-h*k;return d};a.lerp=function(a,b,d,l){var h=a[0],k=a[1];a=a[2];l[0]=h+d*(b[0]-h);l[1]=k+d*(b[1]-k);l[2]=a+d*(b[2]-a);return l};a.random=function(a,g){a=a||1;var d=2*b()*Math.PI,l=2*b()-1,h=Math.sqrt(1-l*l)*a;g[0]=Math.cos(d)*h;g[1]=Math.sin(d)*h;g[2]=l*a;return g};a.transformMat4=function(a,b,d){var l=a[0],h=a[1];a=a[2];var k=b[3]*l+b[7]*h+b[11]*a+b[15],k=k||1;d[0]=(b[0]*l+b[4]*h+b[8]*a+b[12])/k;d[1]=(b[1]*l+b[5]*h+b[9]*a+b[13])/k;d[2]=(b[2]*l+b[6]*h+b[10]*a+b[14])/k;return d};a.transformMat3=
function(a,b,d){var l=a[0],h=a[1];a=a[2];d[0]=l*b[0]+h*b[3]+a*b[6];d[1]=l*b[1]+h*b[4]+a*b[7];d[2]=l*b[2]+h*b[5]+a*b[8];return d};a.transformQuat=function(a,b,d){var l=a[0],h=a[1],k=a[2];a=b[0];var f=b[1],p=b[2];b=b[3];var v=b*l+f*k-p*h,m=b*h+p*l-a*k,n=b*k+a*h-f*l,l=-a*l-f*h-p*k;d[0]=v*b+l*-a+m*-p-n*-f;d[1]=m*b+l*-f+n*-a-v*-p;d[2]=n*b+l*-p+v*-f-m*-a;return d};a.rotateX=function(a,b,d,l){var h=[],k=[];h[0]=a[0]-b[0];h[1]=a[1]-b[1];h[2]=a[2]-b[2];k[0]=h[0];k[1]=h[1]*Math.cos(d)-h[2]*Math.sin(d);k[2]=
h[1]*Math.sin(d)+h[2]*Math.cos(d);l[0]=k[0]+b[0];l[1]=k[1]+b[1];l[2]=k[2]+b[2];return l};a.rotateY=function(a,b,d,l){var h=[],k=[];h[0]=a[0]-b[0];h[1]=a[1]-b[1];h[2]=a[2]-b[2];k[0]=h[2]*Math.sin(d)+h[0]*Math.cos(d);k[1]=h[1];k[2]=h[2]*Math.cos(d)-h[0]*Math.sin(d);l[0]=k[0]+b[0];l[1]=k[1]+b[1];l[2]=k[2]+b[2];return l};a.rotateZ=function(a,b,d,l){var h=[],k=[];h[0]=a[0]-b[0];h[1]=a[1]-b[1];h[2]=a[2]-b[2];k[0]=h[0]*Math.cos(d)-h[1]*Math.sin(d);k[1]=h[0]*Math.sin(d)+h[1]*Math.cos(d);k[2]=h[2];l[0]=k[0]+
b[0];l[1]=k[1]+b[1];l[2]=k[2]+b[2];return l};a.forEach=function(){var b=a.create();return function(a,d,l,h,k,f){d||(d=3);l||(l=0);for(h=h?Math.min(h*d+l,a.length):a.length;l<h;l+=d)b[0]=a[l],b[1]=a[l+1],b[2]=a[l+2],k(b,f,b),a[l]=b[0],a[l+1]=b[1],a[l+2]=b[2];return a}}();a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};
b4w.module.vec4=function(a){var n="undefined"!==typeof Float32Array?Float32Array:Array,b=Math.random;a.create=function(){var a=new n(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var b=new n(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=function(a,b,d,l){var h=new n(4);h[0]=a;h[1]=b;h[2]=d;h[3]=l;return h};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set=function(a,b,d,l,h){h[0]=a;h[1]=b;h[2]=d;h[3]=l;return h};a.add=function(a,b,d){d[0]=
a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];d[3]=a[3]+b[3];return d};a.subtract=function(a,b,d){d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];d[3]=a[3]-b[3];return d};a.sub=a.subtract;a.multiply=function(a,b,d){d[0]=a[0]*b[0];d[1]=a[1]*b[1];d[2]=a[2]*b[2];d[3]=a[3]*b[3];return d};a.mul=a.multiply;a.divide=function(a,b,d){d[0]=a[0]/b[0];d[1]=a[1]/b[1];d[2]=a[2]/b[2];d[3]=a[3]/b[3];return d};a.div=a.divide;a.min=function(a,b,d){d[0]=Math.min(a[0],b[0]);d[1]=Math.min(a[1],b[1]);d[2]=Math.min(a[2],b[2]);d[3]=
Math.min(a[3],b[3]);return d};a.max=function(a,b,d){d[0]=Math.max(a[0],b[0]);d[1]=Math.max(a[1],b[1]);d[2]=Math.max(a[2],b[2]);d[3]=Math.max(a[3],b[3]);return d};a.scale=function(a,b,d){d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;d[3]=a[3]*b;return d};a.scaleAndAdd=function(a,b,d,l){l[0]=a[0]+b[0]*d;l[1]=a[1]+b[1]*d;l[2]=a[2]+b[2]*d;l[3]=a[3]+b[3]*d;return l};a.distance=function(a,b){var d=b[0]-a[0],l=b[1]-a[1],h=b[2]-a[2],k=b[3]-a[3];return Math.sqrt(d*d+l*l+h*h+k*k)};a.dist=a.distance;a.squaredDistance=
function(a,b){var d=b[0]-a[0],l=b[1]-a[1],h=b[2]-a[2],k=b[3]-a[3];return d*d+l*l+h*h+k*k};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],d=a[1],l=a[2];a=a[3];return Math.sqrt(b*b+d*d+l*l+a*a)};a.len=a.length;a.squaredLength=function(a){var b=a[0],d=a[1],l=a[2];a=a[3];return b*b+d*d+l*l+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];b[3]=1/a[3];return b};a.normalize=
function(a,b){var d=a[0],l=a[1],h=a[2],k=a[3],d=d*d+l*l+h*h+k*k;0<d&&(d=1/Math.sqrt(d),b[0]=a[0]*d,b[1]=a[1]*d,b[2]=a[2]*d,b[3]=a[3]*d);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};a.lerp=function(a,b,d,l){var h=a[0],k=a[1],f=a[2];a=a[3];l[0]=h+d*(b[0]-h);l[1]=k+d*(b[1]-k);l[2]=f+d*(b[2]-f);l[3]=a+d*(b[3]-a);return l};a.random=function(c,g){c=c||1;g[0]=b();g[1]=b();g[2]=b();g[3]=b();a.normalize(g,g);a.scale(g,c,g);return g};a.transformMat4=function(a,b,d){var l=a[0],
h=a[1],k=a[2];a=a[3];d[0]=b[0]*l+b[4]*h+b[8]*k+b[12]*a;d[1]=b[1]*l+b[5]*h+b[9]*k+b[13]*a;d[2]=b[2]*l+b[6]*h+b[10]*k+b[14]*a;d[3]=b[3]*l+b[7]*h+b[11]*k+b[15]*a;return d};a.transformQuat=function(a,b,d){var l=a[0],h=a[1],k=a[2];a=b[0];var f=b[1],p=b[2];b=b[3];var v=b*l+f*k-p*h,m=b*h+p*l-a*k,n=b*k+a*h-f*l,l=-a*l-f*h-p*k;d[0]=v*b+l*-a+m*-p-n*-f;d[1]=m*b+l*-f+n*-a-v*-p;d[2]=n*b+l*-p+v*-f-m*-a;return d};a.forEach=function(){var b=a.create();return function(a,d,l,h,k,f){d||(d=4);l||(l=0);for(h=h?Math.min(h*
d+l,a.length):a.length;l<h;l+=d)b[0]=a[l],b[1]=a[l+1],b[2]=a[l+2],b[3]=a[l+3],k(b,f,b),a[l]=b[0],a[l+1]=b[1],a[l+2]=b[2],a[l+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};
b4w.module.quat=function(a,n){var b=n("vec3"),c=n("vec4"),g=n("mat3"),d="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new d(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var c=b.create(),d=b.fromValues(1,0,0),g=b.fromValues(0,1,0);return function(f,p,v){var m=b.dot(f,p);if(-.9999999>m)return b.cross(d,f,c),1E-6>b.length(c)&&b.cross(g,f,c),b.normalize(c,c),a.setAxisAngle(c,Math.PI,v),v;if(.9999999<m)return v[0]=0,v[1]=0,v[2]=0,v[3]=1,v;b.cross(f,
p,c);v[0]=c[0];v[1]=c[1];v[2]=c[2];v[3]=1+m;return a.normalize(v,v)}}();a.setAxes=function(){var b=g.create();return function(c,d,f,g){b[0]=d[0];b[3]=d[1];b[6]=d[2];b[1]=f[0];b[4]=f[1];b[7]=f[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,g),g)}}();a.clone=c.clone;a.fromValues=c.fromValues;a.copy=c.copy;a.set=c.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=c.add;a.multiply=function(a,b,c){var d=a[0],g=a[1],v=a[2];a=a[3];var m=b[0],n=b[1],t=b[2];b=b[3];c[0]=d*b+a*m+g*t-v*n;c[1]=g*b+a*n+v*m-d*t;c[2]=v*b+a*t+d*n-g*m;c[3]=a*b-d*m-g*n-v*t;return c};a.mul=a.multiply;a.scale=c.scale;a.rotateX=function(a,b,c){b*=.5;var d=a[0],g=a[1],v=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*m;c[1]=g*b+v*m;c[2]=v*b-g*m;c[3]=a*b-d*m;return c};a.rotateY=function(a,b,c){b*=.5;var d=a[0],g=a[1],v=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=d*
b-v*m;c[1]=g*b+a*m;c[2]=v*b+d*m;c[3]=a*b-g*m;return c};a.rotateZ=function(a,b,c){b*=.5;var d=a[0],g=a[1],v=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=d*b+g*m;c[1]=g*b-d*m;c[2]=v*b+a*m;c[3]=a*b-v*m;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],g=a[2];b[0]=c;b[1]=d;b[2]=g;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-g*g));return b};a.dot=c.dot;a.lerp=c.lerp;a.slerp=function(a,b,c,d){var g=a[0],v=a[1],m=a[2];a=a[3];var n=b[0],t=b[1],z=b[2];b=b[3];var e,B,A;B=g*n+v*t+m*z+a*b;0>B&&(B=-B,n=-n,t=-t,
z=-z,b=-b);1E-6<1-B?(e=Math.acos(B),A=Math.sin(e),B=Math.sin((1-c)*e)/A,c=Math.sin(c*e)/A):B=1-c;d[0]=B*g+c*n;d[1]=B*v+c*t;d[2]=B*m+c*z;d[3]=B*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],g=a[2],v=a[3],m=c*c+d*d+g*g+v*v,m=m?1/m:0;b[0]=-c*m;b[1]=-d*m;b[2]=-g*m;b[3]=v*m;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=c.length;a.len=a.length;a.squaredLength=c.squaredLength;a.sqrLen=a.squaredLength;a.normalize=c.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var g=(d+1)%3,v=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*g+g]-a[3*v+v]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*g+v]-a[3*v+g])*c;b[g]=(a[3*g+d]+a[3*d+g])*c;b[v]=(a[3*v+d]+a[3*d+v])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};
b4w.module.mat3=function(a){var n="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new n(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[4];c[4]=a[5];c[5]=a[6];c[6]=a[8];c[7]=a[9];c[8]=a[10];return c};a.clone=function(a){var c=new n(9);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=
a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,c){if(c===a){var g=a[1],d=a[2],l=a[5];c[1]=a[3];c[2]=a[6];c[3]=g;c[5]=a[7];c[6]=d;c[7]=l}else c[0]=a[0],c[1]=a[3],c[2]=a[6],c[3]=a[1],c[4]=a[4],c[5]=a[7],c[6]=a[2],c[7]=a[5],c[8]=a[8];return c};a.invert=function(a,c){var g=a[0],d=a[1],l=a[2],h=a[3],k=a[4],f=a[5],p=a[6],v=a[7],m=a[8],n=m*k-f*v,t=-m*h+f*p,z=
v*h-k*p,e=g*n+d*t+l*z;if(!e)return null;e=1/e;c[0]=n*e;c[1]=(-m*d+l*v)*e;c[2]=(f*d-l*k)*e;c[3]=t*e;c[4]=(m*g-l*p)*e;c[5]=(-f*g+l*h)*e;c[6]=z*e;c[7]=(-v*g+d*p)*e;c[8]=(k*g-d*h)*e;return c};a.adjoint=function(a,c){var g=a[0],d=a[1],l=a[2],h=a[3],k=a[4],f=a[5],p=a[6],v=a[7],m=a[8];c[0]=k*m-f*v;c[1]=l*v-d*m;c[2]=d*f-l*k;c[3]=f*p-h*m;c[4]=g*m-l*p;c[5]=l*h-g*f;c[6]=h*v-k*p;c[7]=d*p-g*v;c[8]=g*k-d*h;return c};a.determinant=function(a){var c=a[3],g=a[4],d=a[5],l=a[6],h=a[7],k=a[8];return a[0]*(k*g-d*h)+a[1]*
(-k*c+d*l)+a[2]*(h*c-g*l)};a.multiply=function(a,c,g){var d=a[0],l=a[1],h=a[2],k=a[3],f=a[4],p=a[5],v=a[6],m=a[7];a=a[8];var n=c[0],t=c[1],z=c[2],e=c[3],B=c[4],A=c[5],u=c[6],s=c[7];c=c[8];g[0]=n*d+t*k+z*v;g[1]=n*l+t*f+z*m;g[2]=n*h+t*p+z*a;g[3]=e*d+B*k+A*v;g[4]=e*l+B*f+A*m;g[5]=e*h+B*p+A*a;g[6]=u*d+s*k+c*v;g[7]=u*l+s*f+c*m;g[8]=u*h+s*p+c*a;return g};a.mul=a.multiply;a.translate=function(a,c,g){var d=a[0],l=a[1],h=a[2],k=a[3],f=a[4],p=a[5],v=a[6],m=a[7];a=a[8];var n=c[0];c=c[1];g[0]=d;g[1]=l;g[2]=h;
g[3]=k;g[4]=f;g[5]=p;g[6]=n*d+c*k+v;g[7]=n*l+c*f+m;g[8]=n*h+c*p+a;return g};a.rotate=function(a,c,g){var d=a[0],l=a[1],h=a[2],k=a[3],f=a[4],p=a[5],n=a[6],m=a[7];a=a[8];var x=Math.sin(c);c=Math.cos(c);g[0]=c*d+x*k;g[1]=c*l+x*f;g[2]=c*h+x*p;g[3]=c*k-x*d;g[4]=c*f-x*l;g[5]=c*p-x*h;g[6]=n;g[7]=m;g[8]=a;return g};a.scale=function(a,c,g){var d=c[0];c=c[1];g[0]=d*a[0];g[1]=d*a[1];g[2]=d*a[2];g[3]=c*a[3];g[4]=c*a[4];g[5]=c*a[5];g[6]=a[6];g[7]=a[7];g[8]=a[8];return g};a.fromMat2d=function(a,c){c[0]=a[0];c[1]=
a[1];c[2]=0;c[3]=a[2];c[4]=a[3];c[5]=0;c[6]=a[4];c[7]=a[5];c[8]=1;return c};a.fromQuat=function(a,c){var g=a[0],d=a[1],l=a[2],h=a[3],k=g+g,f=d+d,p=l+l,g=g*k,n=d*k,d=d*f,m=l*k,x=l*f,l=l*p,k=h*k,f=h*f,h=h*p;c[0]=1-d-l;c[3]=n-h;c[6]=m+f;c[1]=n+h;c[4]=1-g-l;c[7]=x-k;c[2]=m-f;c[5]=x+k;c[8]=1-g-d;return c};a.normalFromMat4=function(a,c){var g=a[0],d=a[1],l=a[2],h=a[3],k=a[4],f=a[5],p=a[6],n=a[7],m=a[8],x=a[9],t=a[10],z=a[11],e=a[12],B=a[13],A=a[14],u=a[15],s=g*f-d*k,q=g*p-l*k,K=g*n-h*k,H=d*p-l*f,y=d*n-
h*f,J=l*n-h*p,r=m*B-x*e,F=m*A-t*e,m=m*u-z*e,G=x*A-t*B,x=x*u-z*B,t=t*u-z*A,z=s*t-q*x+K*G+H*m-y*F+J*r;if(!z)return null;z=1/z;c[0]=(f*t-p*x+n*G)*z;c[1]=(p*m-k*t-n*F)*z;c[2]=(k*x-f*m+n*r)*z;c[3]=(l*x-d*t-h*G)*z;c[4]=(g*t-l*m+h*F)*z;c[5]=(d*m-g*x-h*r)*z;c[6]=(B*J-A*y+u*H)*z;c[7]=(A*K-e*J-u*q)*z;c[8]=(e*y-B*K+u*s)*z;return c};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.av=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],
2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.mat3=a)};
b4w.module.mat4=function(a){var n="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new n(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var c=new n(16);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.copy=function(a,c){c[0]=a[0];c[1]=
a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,c){if(c===a){var g=a[1],d=a[2],l=a[3],h=a[6],k=a[7],f=a[11];c[1]=a[4];c[2]=a[8];c[3]=a[12];c[4]=g;c[6]=a[9];c[7]=a[13];c[8]=d;c[9]=h;c[11]=a[14];c[12]=l;c[13]=k;
c[14]=f}else c[0]=a[0],c[1]=a[4],c[2]=a[8],c[3]=a[12],c[4]=a[1],c[5]=a[5],c[6]=a[9],c[7]=a[13],c[8]=a[2],c[9]=a[6],c[10]=a[10],c[11]=a[14],c[12]=a[3],c[13]=a[7],c[14]=a[11],c[15]=a[15];return c};a.invert=function(a,c){var g=a[0],d=a[1],l=a[2],h=a[3],k=a[4],f=a[5],p=a[6],n=a[7],m=a[8],x=a[9],t=a[10],z=a[11],e=a[12],B=a[13],A=a[14],u=a[15],s=g*f-d*k,q=g*p-l*k,K=g*n-h*k,H=d*p-l*f,y=d*n-h*f,J=l*n-h*p,r=m*B-x*e,F=m*A-t*e,G=m*u-z*e,W=x*A-t*B,T=x*u-z*B,S=t*u-z*A,R=s*S-q*T+K*W+H*G-y*F+J*r;if(!R)return null;
R=1/R;c[0]=(f*S-p*T+n*W)*R;c[1]=(l*T-d*S-h*W)*R;c[2]=(B*J-A*y+u*H)*R;c[3]=(t*y-x*J-z*H)*R;c[4]=(p*G-k*S-n*F)*R;c[5]=(g*S-l*G+h*F)*R;c[6]=(A*K-e*J-u*q)*R;c[7]=(m*J-t*K+z*q)*R;c[8]=(k*T-f*G+n*r)*R;c[9]=(d*G-g*T-h*r)*R;c[10]=(e*y-B*K+u*s)*R;c[11]=(x*K-m*y-z*s)*R;c[12]=(f*F-k*W-p*r)*R;c[13]=(g*W-d*F+l*r)*R;c[14]=(B*q-e*H-A*s)*R;c[15]=(m*H-x*q+t*s)*R;return c};a.adjoint=function(a,c){var g=a[0],d=a[1],l=a[2],h=a[3],k=a[4],f=a[5],p=a[6],n=a[7],m=a[8],x=a[9],t=a[10],z=a[11],e=a[12],B=a[13],A=a[14],u=a[15];
c[0]=f*(t*u-z*A)-x*(p*u-n*A)+B*(p*z-n*t);c[1]=-(d*(t*u-z*A)-x*(l*u-h*A)+B*(l*z-h*t));c[2]=d*(p*u-n*A)-f*(l*u-h*A)+B*(l*n-h*p);c[3]=-(d*(p*z-n*t)-f*(l*z-h*t)+x*(l*n-h*p));c[4]=-(k*(t*u-z*A)-m*(p*u-n*A)+e*(p*z-n*t));c[5]=g*(t*u-z*A)-m*(l*u-h*A)+e*(l*z-h*t);c[6]=-(g*(p*u-n*A)-k*(l*u-h*A)+e*(l*n-h*p));c[7]=g*(p*z-n*t)-k*(l*z-h*t)+m*(l*n-h*p);c[8]=k*(x*u-z*B)-m*(f*u-n*B)+e*(f*z-n*x);c[9]=-(g*(x*u-z*B)-m*(d*u-h*B)+e*(d*z-h*x));c[10]=g*(f*u-n*B)-k*(d*u-h*B)+e*(d*n-h*f);c[11]=-(g*(f*z-n*x)-k*(d*z-h*x)+m*
(d*n-h*f));c[12]=-(k*(x*A-t*B)-m*(f*A-p*B)+e*(f*t-p*x));c[13]=g*(x*A-t*B)-m*(d*A-l*B)+e*(d*t-l*x);c[14]=-(g*(f*A-p*B)-k*(d*A-l*B)+e*(d*p-l*f));c[15]=g*(f*t-p*x)-k*(d*t-l*x)+m*(d*p-l*f);return c};a.determinant=function(a){var c=a[0],g=a[1],d=a[2],l=a[3],h=a[4],k=a[5],f=a[6],p=a[7],n=a[8],m=a[9],x=a[10],t=a[11],z=a[12],e=a[13],B=a[14];a=a[15];return(c*k-g*h)*(x*a-t*B)-(c*f-d*h)*(m*a-t*e)+(c*p-l*h)*(m*B-x*e)+(g*f-d*k)*(n*a-t*z)-(g*p-l*k)*(n*B-x*z)+(d*p-l*f)*(n*e-m*z)};a.multiply=function(a,c,g){var d=
a[0],l=a[1],h=a[2],k=a[3],f=a[4],p=a[5],n=a[6],m=a[7],x=a[8],t=a[9],z=a[10],e=a[11],B=a[12],A=a[13],u=a[14];a=a[15];var s=c[0],q=c[1],K=c[2],H=c[3];g[0]=s*d+q*f+K*x+H*B;g[1]=s*l+q*p+K*t+H*A;g[2]=s*h+q*n+K*z+H*u;g[3]=s*k+q*m+K*e+H*a;s=c[4];q=c[5];K=c[6];H=c[7];g[4]=s*d+q*f+K*x+H*B;g[5]=s*l+q*p+K*t+H*A;g[6]=s*h+q*n+K*z+H*u;g[7]=s*k+q*m+K*e+H*a;s=c[8];q=c[9];K=c[10];H=c[11];g[8]=s*d+q*f+K*x+H*B;g[9]=s*l+q*p+K*t+H*A;g[10]=s*h+q*n+K*z+H*u;g[11]=s*k+q*m+K*e+H*a;s=c[12];q=c[13];K=c[14];H=c[15];g[12]=s*d+
q*f+K*x+H*B;g[13]=s*l+q*p+K*t+H*A;g[14]=s*h+q*n+K*z+H*u;g[15]=s*k+q*m+K*e+H*a;return g};a.mul=a.multiply;a.translate=function(a,c,g){var d=c[0],l=c[1];c=c[2];var h,k,f,p,n,m,x,t,z,e,B,A;a===g?(g[12]=a[0]*d+a[4]*l+a[8]*c+a[12],g[13]=a[1]*d+a[5]*l+a[9]*c+a[13],g[14]=a[2]*d+a[6]*l+a[10]*c+a[14],g[15]=a[3]*d+a[7]*l+a[11]*c+a[15]):(h=a[0],k=a[1],f=a[2],p=a[3],n=a[4],m=a[5],x=a[6],t=a[7],z=a[8],e=a[9],B=a[10],A=a[11],g[0]=h,g[1]=k,g[2]=f,g[3]=p,g[4]=n,g[5]=m,g[6]=x,g[7]=t,g[8]=z,g[9]=e,g[10]=B,g[11]=A,
g[12]=h*d+n*l+z*c+a[12],g[13]=k*d+m*l+e*c+a[13],g[14]=f*d+x*l+B*c+a[14],g[15]=p*d+t*l+A*c+a[15]);return g};a.scale=function(a,c,g){var d=c[0],l=c[1];c=c[2];g[0]=a[0]*d;g[1]=a[1]*d;g[2]=a[2]*d;g[3]=a[3]*d;g[4]=a[4]*l;g[5]=a[5]*l;g[6]=a[6]*l;g[7]=a[7]*l;g[8]=a[8]*c;g[9]=a[9]*c;g[10]=a[10]*c;g[11]=a[11]*c;g[12]=a[12];g[13]=a[13];g[14]=a[14];g[15]=a[15];return g};a.rotate=function(a,c,g,d){var l=g[0],h=g[1];g=g[2];var k=Math.sqrt(l*l+h*h+g*g),f,p,n,m,x,t,z,e,B,A,u,s,q,K,H,y,J,r,F,G;if(1E-7>Math.abs(k))return null;
k=1/k;l*=k;h*=k;g*=k;f=Math.sin(c);p=Math.cos(c);n=1-p;c=a[0];k=a[1];m=a[2];x=a[3];t=a[4];z=a[5];e=a[6];B=a[7];A=a[8];u=a[9];s=a[10];q=a[11];K=l*l*n+p;H=h*l*n+g*f;y=g*l*n-h*f;J=l*h*n-g*f;r=h*h*n+p;F=g*h*n+l*f;G=l*g*n+h*f;l=h*g*n-l*f;h=g*g*n+p;d[0]=c*K+t*H+A*y;d[1]=k*K+z*H+u*y;d[2]=m*K+e*H+s*y;d[3]=x*K+B*H+q*y;d[4]=c*J+t*r+A*F;d[5]=k*J+z*r+u*F;d[6]=m*J+e*r+s*F;d[7]=x*J+B*r+q*F;d[8]=c*G+t*l+A*h;d[9]=k*G+z*l+u*h;d[10]=m*G+e*l+s*h;d[11]=x*G+B*l+q*h;a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);
return d};a.rotateX=function(a,c,g){var d=Math.sin(c);c=Math.cos(c);var l=a[4],h=a[5],k=a[6],f=a[7],p=a[8],n=a[9],m=a[10],x=a[11];a!==g&&(g[0]=a[0],g[1]=a[1],g[2]=a[2],g[3]=a[3],g[12]=a[12],g[13]=a[13],g[14]=a[14],g[15]=a[15]);g[4]=l*c+p*d;g[5]=h*c+n*d;g[6]=k*c+m*d;g[7]=f*c+x*d;g[8]=p*c-l*d;g[9]=n*c-h*d;g[10]=m*c-k*d;g[11]=x*c-f*d;return g};a.rotateY=function(a,c,g){var d=Math.sin(c);c=Math.cos(c);var l=a[0],h=a[1],k=a[2],f=a[3],p=a[8],n=a[9],m=a[10],x=a[11];a!==g&&(g[4]=a[4],g[5]=a[5],g[6]=a[6],
g[7]=a[7],g[12]=a[12],g[13]=a[13],g[14]=a[14],g[15]=a[15]);g[0]=l*c-p*d;g[1]=h*c-n*d;g[2]=k*c-m*d;g[3]=f*c-x*d;g[8]=l*d+p*c;g[9]=h*d+n*c;g[10]=k*d+m*c;g[11]=f*d+x*c;return g};a.rotateZ=function(a,c,g){var d=Math.sin(c);c=Math.cos(c);var l=a[0],h=a[1],k=a[2],f=a[3],p=a[4],n=a[5],m=a[6],x=a[7];a!==g&&(g[8]=a[8],g[9]=a[9],g[10]=a[10],g[11]=a[11],g[12]=a[12],g[13]=a[13],g[14]=a[14],g[15]=a[15]);g[0]=l*c+p*d;g[1]=h*c+n*d;g[2]=k*c+m*d;g[3]=f*c+x*d;g[4]=p*c-l*d;g[5]=n*c-h*d;g[6]=m*c-k*d;g[7]=x*c-f*d;return g};
a.fromRotationTranslation=function(a,c,g){var d=a[0],l=a[1],h=a[2],k=a[3],f=d+d,p=l+l,n=h+h;a=d*f;var m=d*p,d=d*n,x=l*p,l=l*n,h=h*n,f=k*f,p=k*p,k=k*n;g[0]=1-(x+h);g[1]=m+k;g[2]=d-p;g[3]=0;g[4]=m-k;g[5]=1-(a+h);g[6]=l+f;g[7]=0;g[8]=d+p;g[9]=l-f;g[10]=1-(a+x);g[11]=0;g[12]=c[0];g[13]=c[1];g[14]=c[2];g[15]=1;return g};a.fromQuat=function(a,c){var g=a[0],d=a[1],l=a[2],h=a[3],k=g+g,f=d+d,p=l+l,g=g*k,n=d*k,d=d*f,m=l*k,x=l*f,l=l*p,k=h*k,f=h*f,h=h*p;c[0]=1-d-l;c[1]=n+h;c[2]=m-f;c[3]=0;c[4]=n-h;c[5]=1-g-l;
c[6]=x+k;c[7]=0;c[8]=m+f;c[9]=x-k;c[10]=1-g-d;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.frustum=function(a,c,g,d,l,h,k){var f=1/(c-a),p=1/(d-g),n=1/(l-h);k[0]=2*l*f;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=2*l*p;k[6]=0;k[7]=0;k[8]=(c+a)*f;k[9]=(d+g)*p;k[10]=(h+l)*n;k[11]=-1;k[12]=0;k[13]=0;k[14]=h*l*2*n;k[15]=0;return k};a.perspective=function(a,c,g,d,l){a=1/Math.tan(a/2);var h=1/(g-d);l[0]=a/c;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=a;l[6]=0;l[7]=0;l[8]=0;l[9]=0;l[10]=(d+g)*h;l[11]=-1;l[12]=0;l[13]=0;
l[14]=2*d*g*h;l[15]=0;return l};a.ortho=function(a,c,g,d,l,h,k){var f=1/(a-c),p=1/(g-d),n=1/(l-h);k[0]=-2*f;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=-2*p;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=2*n;k[11]=0;k[12]=(a+c)*f;k[13]=(d+g)*p;k[14]=(h+l)*n;k[15]=1;return k};a.lookAt=function(b,c,g,d){var l,h,k,f,p,n,m,x,t=b[0],z=b[1];b=b[2];k=g[0];f=g[1];h=g[2];m=c[0];g=c[1];l=c[2];if(1E-7>Math.abs(t-m)&&1E-7>Math.abs(z-g)&&1E-7>Math.abs(b-l))return a.identity(d);c=t-m;g=z-g;m=b-l;x=1/Math.sqrt(c*c+g*g+m*m);c*=x;g*=x;m*=
x;l=f*m-h*g;h=h*c-k*m;k=k*g-f*c;(x=Math.sqrt(l*l+h*h+k*k))?(x=1/x,l*=x,h*=x,k*=x):k=h=l=0;f=g*k-m*h;p=m*l-c*k;n=c*h-g*l;(x=Math.sqrt(f*f+p*p+n*n))?(x=1/x,f*=x,p*=x,n*=x):n=p=f=0;d[0]=l;d[1]=f;d[2]=c;d[3]=0;d[4]=h;d[5]=p;d[6]=g;d[7]=0;d[8]=k;d[9]=n;d[10]=m;d[11]=0;d[12]=-(l*t+h*z+k*b);d[13]=-(f*t+p*z+n*b);d[14]=-(c*t+g*z+m*b);d[15]=1;return d};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+
", "+a[13]+", "+a[14]+", "+a[15]+")"};a.av=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.__gpp_eval=function(a){a.Up=function(){function a(b,c,g,d,l,h){this.message=b;this.offset=d;this.vh=l;this.Mf=h;this.name="SyntaxError"}(function(a,c){function g(){this.constructor=a}g.prototype=c.prototype;a.prototype=new g})(a,Error);return{SyntaxError:a,parse:function(b){function c(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function g(a){if(ka!==a){ka>a&&(ka=0,Ba={vh:1,Mf:1,Rh:!1});var c=Ba,d,e;for(d=
ka;d<a;d++)e=b.charAt(d),"\n"===e?(c.Rh||c.vh++,c.Mf=1,c.Rh=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(c.vh++,c.Mf=1,c.Rh=!0):(c.Mf++,c.Rh=!1);ka=a}return Ba}function d(a){C<qa||(C>qa&&(qa=C,Wb=[]),Wb.push(a))}function l(){var a,c,e;a=C;c=N();c!==D?(c=h(),c!==D?(e=N(),e!==D?(ba++,10===b.charCodeAt(C)?(e=oc,C++):(e=D,0===ba&&d(Oa)),e===D&&(b.substr(C,2)===mb?(e=mb,C+=2):(e=D,0===ba&&d(Db)),e===D&&(13===b.charCodeAt(C)?(e=pc,C++):(e=D,0===ba&&d(Ea)))),ba--,e===D&&0===ba&&d(bc),e===D&&(e=I),e!==D?a=c:
(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w);return a}function h(){var a,c,e,f,g,h,m,l;a=C;c=k();if(c!==D){e=[];f=C;g=N();g!==D?(44===b.charCodeAt(C)?(h=ia,C++):(h=D,0===ba&&d(oa)),h!==D?(m=N(),m!==D?(l=k(),l!==D?f=g=[g,h,m,l]:(C=f,f=w)):(C=f,f=w)):(C=f,f=w)):(C=f,f=w);for(;f!==D;)e.push(f),f=C,g=N(),g!==D?(44===b.charCodeAt(C)?(h=ia,C++):(h=D,0===ba&&d(oa)),h!==D?(m=N(),m!==D?(l=k(),l!==D?f=g=[g,h,m,l]:(C=f,f=w)):(C=f,f=w)):(C=f,f=w)):(C=f,f=w);e!==D?a=c=0==e.length?c:e[e.length-1]:(C=a,a=w)}else C=
a,a=w;return a}function k(){var a,c,e,g;a=C;c=f();c!==D?(e=N(),e!==D?(63===b.charCodeAt(C)?(e=fa,C++):(e=D,0===ba&&d(U)),e!==D?(e=N(),e!==D?(e=h(),e!==D?(g=N(),g!==D?(58===b.charCodeAt(C)?(g=Y,C++):(g=D,0===ba&&d(E)),g!==D?(g=N(),g!==D?(g=h(),g!==D?a=c?e:g:(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w);a===D&&(a=f());return a}function f(){var a,b,c,d,e,f,g,h;a=C;b=p();if(b!==D){c=[];d=C;e=N();e!==D?(f=Z(),f!==D?(g=N(),g!==D?(h=p(),h!==D?d=e=[e,f,
g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==D;)c.push(d),d=C,e=N(),e!==D?(f=Z(),f!==D?(g=N(),g!==D?(h=p(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else C=a,a=w}else C=a,a=w;return a}function p(){var a,b,c,d,e,f,g,h;a=C;b=v();if(b!==D){c=[];d=C;e=N();e!==D?(f=Q(),f!==D?(g=N(),g!==D?(h=v(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==D;)c.push(d),d=C,e=N(),e!==D?(f=Q(),f!==D?(g=N(),g!==D?(h=
v(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else C=a,a=w}else C=a,a=w;return a}function v(){var a,b,c,d,e,f,g,h;a=C;b=m();if(b!==D){c=[];d=C;e=N();e!==D?(f=O(),f!==D?(g=N(),g!==D?(h=m(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==D;)c.push(d),d=C,e=N(),e!==D?(f=O(),f!==D?(g=N(),g!==D?(h=m(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)a|=c[b][3];
else C=a,a=w}else C=a,a=w;return a}function m(){var a,b,c,d,e,f,g,h;a=C;b=x();if(b!==D){c=[];d=C;e=N();e!==D?(f=L(),f!==D?(g=N(),g!==D?(h=x(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==D;)c.push(d),d=C,e=N(),e!==D?(f=L(),f!==D?(g=N(),g!==D?(h=x(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else C=a,a=w}else C=a,a=w;return a}function x(){var a,b,c,d,e,f,g,h;a=C;b=t();if(b!==D){c=[];d=C;e=N();e!==D?(f=R(),
f!==D?(g=N(),g!==D?(h=t(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==D;)c.push(d),d=C,e=N(),e!==D?(f=R(),f!==D?(g=N(),g!==D?(h=t(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else C=a,a=w}else C=a,a=w;return a}function t(){var a,b,c,d,e,f,g,h;a=C;b=z();if(b!==D){c=[];d=C;e=N();e!==D?(f=S(),f!==D?(g=N(),g!==D?(h=z(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==D;)c.push(d),d=C,
e=N(),e!==D?(f=S(),f!==D?(g=N(),g!==D?(h=z(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else C=a,a=w}else C=a,a=w;return a}function z(){var a,b,c,d,f,g,h,k;a=C;b=e();if(b!==D){c=[];d=C;f=N();f!==D?(g=T(),g!==D?(h=N(),h!==D?(k=e(),k!==D?d=f=[f,g,h,k]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==D;)c.push(d),d=C,f=N(),f!==D?(g=T(),g!==D?(h=N(),h!==D?(k=e(),k!==D?d=f=[f,
g,h,k]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else C=a,a=w}else C=a,a=w;return a}function e(){var a,b,c,d,e,f,g,h;a=C;b=B();if(b!==D){c=[];d=C;e=N();e!==D?(f=W(),f!==D?(g=N(),g!==D?(h=B(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==D;)c.push(d),d=C,e=N(),e!==D?(f=W(),f!==D?(g=N(),g!==D?(h=B(),h!==D?d=e=[e,f,g,
h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else C=a,a=w}else C=a,a=w;return a}function B(){var a,b,c,d,e,f,g,h;a=C;b=A();if(b!==D){c=[];d=C;e=N();e!==D?(f=G(),f!==D?(g=N(),g!==D?(h=A(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==D;)c.push(d),d=C,e=N(),e!==D?(f=G(),f!==D?(g=N(),g!==D?(h=A(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==D)for(a=
b,b=0;b<c.length;b++)switch(c[b][1]){case "+":a+=c[b][3];break;case "-":a-=c[b][3]}else C=a,a=w}else C=a,a=w;return a}function A(){var a,b,c,d,e,f,g,h;a=C;b=u();if(b!==D){c=[];d=C;e=N();e!==D?(f=F(),f!==D?(g=N(),g!==D?(h=u(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);for(;d!==D;)c.push(d),d=C,e=N(),e!==D?(f=F(),f!==D?(g=N(),g!==D?(h=u(),h!==D?d=e=[e,f,g,h]:(C=d,d=w)):(C=d,d=w)):(C=d,d=w)):(C=d,d=w);if(c!==D)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=
Math.floor(a/c[b][3]);break;case "%":a%=c[b][3]}else C=a,a=w}else C=a,a=w;return a}function u(){var a,e,f;a=C;b.substr(C,7)===ea?(e=ea,C+=7):(e=D,0===ba&&d(na));e!==D?(f=N(),f!==D?(f=q(),f!==D?a=f:(C=a,a=w)):(C=a,a=w)):(C=a,a=w);if(a===D){a=C;e=s();if(e!==D)if(f=N(),f!==D)if(b.substr(C,2)===wa?(f=wa,C+=2):(f=D,0===ba&&d(sa)),f===D&&(b.substr(C,2)===Ia?(f=Ia,C+=2):(f=D,0===ba&&d(Zb))),f!==D){a:{a=e;switch(f){case "++":e=++a;break a;case "--":e=--a;break a}e=void 0}a=e}else C=a,a=w;else C=a,a=w;else C=
a,a=w;a===D&&(a=s());a===D&&(a=C,b.substr(C,2)===wa?(e=wa,C+=2):(e=D,0===ba&&d(sa)),e===D&&(b.substr(C,2)===Ia?(e=Ia,C+=2):(e=D,0===ba&&d(Zb)),e===D&&(43===b.charCodeAt(C)?(e=Za,C++):(e=D,0===ba&&d(sb)),e===D&&(45===b.charCodeAt(C)?(e=xa,C++):(e=D,0===ba&&d(Kb)),e===D&&(126===b.charCodeAt(C)?(e=Lb,C++):(e=D,0===ba&&d(bd)),e===D&&(33===b.charCodeAt(C)?(e=Sc,C++):(e=D,0===ba&&d(cd))))))),e!==D?(f=N(),f!==D?(f=u(),f!==D?a=e=c(e,f):(C=a,a=w)):(C=a,a=w)):(C=a,a=w))}return a}function s(){var a,c,e;ba++;
var f;a=C;48===b.charCodeAt(C)?(c=gb,C++):(c=D,0===ba&&d(Pa));if(c!==D)if(ab.test(b.charAt(C))?(c=b.charAt(C),C++):(c=D,0===ba&&d(ya)),c!==D){c=C;e=[];f=H();if(f!==D)for(;f!==D;)e.push(f),f=H();else e=w;e!==D&&(e=b.substring(c,C));c=e;c!==D?a=c=parseInt("0x"+c):(C=a,a=w)}else C=a,a=w;else C=a,a=w;if(a===D){a=C;48===b.charCodeAt(C)?(c=gb,C++):(c=D,0===ba&&d(Pa));if(c===D)if(c=C,Yb.test(b.charAt(C))?(e=b.charAt(C),C++):(e=D,0===ba&&d($a)),e!==D){var g;f=[];g=K();if(g!==D)for(;g!==D;)f.push(g),g=K();
else f=w;f===D&&(f=I);f!==D?c=e=[e,f]:(C=c,c=w)}else C=c,c=w;c!==D&&(c=b.substring(a,C));a=c;a!==D&&(a=parseInt(a))}ba--;a===D&&0===ba&&d(X);a===D&&(c=y(),c!==D&&(c=0),a=c,a===D&&(a=C,40===b.charCodeAt(C)?(c=aa,C++):(c=D,0===ba&&d(Ua)),c!==D?(c=N(),c!==D?(c=h(),c!==D?(e=N(),e!==D?(41===b.charCodeAt(C)?(e=la,C++):(e=D,0===ba&&d(M)),e!==D?a=c:(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)));return a}function q(){var a,c,e,f,g;c=y();c!==D&&(c=0);a=c;if(a===D){c=[];f=e=C;ba++;40===b.charCodeAt(C)?
(g=aa,C++):(g=D,0===ba&&d(Ua));g===D&&(41===b.charCodeAt(C)?(g=la,C++):(g=D,0===ba&&d(M)));ba--;g===D?f=Da:(C=f,f=w);f!==D?(g=P(),g!==D?e=f=[f,g]:(C=e,e=w)):(C=e,e=w);if(e!==D)for(;e!==D;)c.push(e),f=e=C,ba++,40===b.charCodeAt(C)?(g=aa,C++):(g=D,0===ba&&d(Ua)),g===D&&(41===b.charCodeAt(C)?(g=la,C++):(g=D,0===ba&&d(M))),ba--,g===D?f=Da:(C=f,f=w),f!==D?(g=P(),g!==D?e=f=[f,g]:(C=e,e=w)):(C=e,e=w);else c=w;c!==D&&(c=1);a=c;a===D&&(a=C,40===b.charCodeAt(C)?(c=aa,C++):(c=D,0===ba&&d(Ua)),c!==D?(e=N(),e!==
D?(f=q(),f!==D?(g=N(),g!==D?(41===b.charCodeAt(C)?(c=la,C++):(c=D,0===ba&&d(M)),c!==D?a=f:(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w)):(C=a,a=w))}return a}function K(){var a;Ha.test(b.charAt(C))?(a=b.charAt(C),C++):(a=D,0===ba&&d(za));return a}function H(){var a;Na.test(b.charAt(C))?(a=b.charAt(C),C++):(a=D,0===ba&&d(xb));return a}function y(){var a,c;ba++;c=a=C;ba++;var e,f,g,h;e=C;b.substr(C,7)===ea?(f=ea,C+=7):(f=D,0===ba&&d(na));f!==D?(g=C,ba++,h=r(),ba--,h===D?g=Da:(C=g,g=w),g!==D?e=f=[f,g]:(C=
e,e=w)):(C=e,e=w);ba--;e===D?c=Da:(C=c,c=w);if(c!==D){ba++;c=C;e=J();if(e!==D){f=[];for(g=r();g!==D;)f.push(g),g=r();f!==D?c=e+=f.join(""):(C=c,c=w)}else C=c,c=w;ba--;c===D&&0===ba&&d(Jb);c!==D?a=c:(C=a,a=w)}else C=a,a=w;ba--;a===D&&0===ba&&d(Jb);return a}function J(){var a;Ca.test(b.charAt(C))?(a=b.charAt(C),C++):(a=D,0===ba&&d(Xa));a===D&&(36===b.charCodeAt(C)?(a=Va,C++):(a=D,0===ba&&d(hb)),a===D&&(95===b.charCodeAt(C)?(a=rb,C++):(a=D,0===ba&&d(va))));return a}function r(){var a;a=J();a===D&&(a=
K());return a}function F(){var a,c,e,f;a=C;42===b.charCodeAt(C)?(c=Tc,C++):(c=D,0===ba&&d(uc));c===D&&(47===b.charCodeAt(C)?(c=lb,C++):(c=D,0===ba&&d(Ya)),c===D&&(37===b.charCodeAt(C)?(c=yb,C++):(c=D,0===ba&&d(dc))));c!==D?(e=C,ba++,61===b.charCodeAt(C)?(f=Mb,C++):(f=D,0===ba&&d(Ub)),ba--,f===D?e=Da:(C=e,e=w),e!==D?a=c:(C=a,a=w)):(C=a,a=w);return a}function G(){var a,c,e;a=C;43===b.charCodeAt(C)?(c=Za,C++):(c=D,0===ba&&d(sb));c!==D?(c=C,ba++,43===b.charCodeAt(C)?(e=Za,C++):(e=D,0===ba&&d(sb)),e===
D&&(61===b.charCodeAt(C)?(e=Mb,C++):(e=D,0===ba&&d(Ub))),ba--,e===D?c=Da:(C=c,c=w),c!==D?a="+":(C=a,a=w)):(C=a,a=w);a===D&&(a=C,45===b.charCodeAt(C)?(c=xa,C++):(c=D,0===ba&&d(Kb)),c!==D?(c=C,ba++,45===b.charCodeAt(C)?(e=xa,C++):(e=D,0===ba&&d(Kb)),e===D&&(61===b.charCodeAt(C)?(e=Mb,C++):(e=D,0===ba&&d(Ub))),ba--,e===D?c=Da:(C=c,c=w),c!==D?a="-":(C=a,a=w)):(C=a,a=w));return a}function W(){var a;b.substr(C,2)===Vb?(a=Vb,C+=2):(a=D,0===ba&&d(lc));a===D&&(b.substr(C,2)===ua?(a=ua,C+=2):(a=D,0===ba&&d(Nb)));
return a}function T(){var a;b.substr(C,2)===bb?(a=bb,C+=2):(a=D,0===ba&&d(ra));a===D&&(b.substr(C,2)===zb?(a=zb,C+=2):(a=D,0===ba&&d(ca)),a===D&&(60===b.charCodeAt(C)?(a=Sa,C++):(a=D,0===ba&&d(cb)),a===D&&(62===b.charCodeAt(C)?(a=ma,C++):(a=D,0===ba&&d(Ja)))));return a}function S(){var a;b.substr(C,2)===db?(a=db,C+=2):(a=D,0===ba&&d(ta));a===D&&(b.substr(C,2)===Ta?(a=Ta,C+=2):(a=D,0===ba&&d(pa)));return a}function R(){var a,c,e;a=C;38===b.charCodeAt(C)?(c=Ka,C++):(c=D,0===ba&&d(Ab));c!==D?(c=C,ba++,
38===b.charCodeAt(C)?(e=Ka,C++):(e=D,0===ba&&d(Ab)),ba--,e===D?c=Da:(C=c,c=w),c!==D?a="&":(C=a,a=w)):(C=a,a=w);return a}function L(){var a,c,e;a=C;94===b.charCodeAt(C)?(c=ec,C++):(c=D,0===ba&&d($b));c!==D?(c=C,ba++,94===b.charCodeAt(C)?(e=ec,C++):(e=D,0===ba&&d($b)),ba--,e===D?c=Da:(C=c,c=w),c!==D?a="^":(C=a,a=w)):(C=a,a=w);return a}function O(){var a,c,e;a=C;124===b.charCodeAt(C)?(c=ac,C++):(c=D,0===ba&&d(tb));c!==D?(c=C,ba++,124===b.charCodeAt(C)?(e=ac,C++):(e=D,0===ba&&d(tb)),ba--,e===D?c=Da:(C=
c,c=w),c!==D?a="|":(C=a,a=w)):(C=a,a=w);return a}function Q(){var a;b.substr(C,2)===Bb?(a=Bb,C+=2):(a=D,0===ba&&d(mc));a!==D&&(a="&&");return a}function Z(){var a;b.substr(C,2)===Cb?(a=Cb,C+=2):(a=D,0===ba&&d(ub));a!==D&&(a="||");return a}function N(){var a,b;a=[];for(b=da();b!==D;)a.push(b),b=da();return a}function da(){var a;ba++;Ob.test(b.charAt(C))?(a=b.charAt(C),C++):(a=D,0===ba&&d(La));ba--;a===D&&0===ba&&d(nc);return a}function P(){var a;b.length>C?(a=b.charAt(C),C++):(a=D,0===ba&&d(Ma));return a}
var ja=1<arguments.length?arguments[1]:{},D={},ga={start:l},V=l,w=D,I=null,ia=",",oa={type:"literal",value:",",description:'","'},fa="?",U={type:"literal",value:"?",description:'"?"'},Y=":",E={type:"literal",value:":",description:'":"'},ea="defined",na={type:"literal",value:"defined",description:'"defined"'},aa="(",Ua={type:"literal",value:"(",description:'"("'},la=")",M={type:"literal",value:")",description:'")"'},Da=void 0,X={type:"other",description:"number"},gb="0",Pa={type:"literal",value:"0",
description:'"0"'},Ha=/^[0-9]/,za={type:"class",value:"[0-9]",description:"[0-9]"},Yb=/^[1-9]/,$a={type:"class",value:"[1-9]",description:"[1-9]"},ab=/^[xX]/,ya={type:"class",value:"[xX]",description:"[xX]"},Na=/^[0-9a-fA-F]/,xb={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},Jb={type:"other",description:"identifier"},Va="$",hb={type:"literal",value:"$",description:'"$"'},rb="_",va={type:"literal",value:"_",description:'"_"'},Ca=/^[a-zA-Z]/,Xa={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},
wa="++",sa={type:"literal",value:"++",description:'"++"'},Ia="--",Zb={type:"literal",value:"--",description:'"--"'},Za="+",sb={type:"literal",value:"+",description:'"+"'},xa="-",Kb={type:"literal",value:"-",description:'"-"'},Lb="~",bd={type:"literal",value:"~",description:'"~"'},Sc="!",cd={type:"literal",value:"!",description:'"!"'},Tc="*",uc={type:"literal",value:"*",description:'"*"'},lb="/",Ya={type:"literal",value:"/",description:'"/"'},yb="%",dc={type:"literal",value:"%",description:'"%"'},
Mb="=",Ub={type:"literal",value:"=",description:'"="'},Vb="<<",lc={type:"literal",value:"<<",description:'"<<"'},ua=">>",Nb={type:"literal",value:">>",description:'">>"'},bb="<=",ra={type:"literal",value:"<=",description:'"<="'},zb=">=",ca={type:"literal",value:">=",description:'">="'},Sa="<",cb={type:"literal",value:"<",description:'"<"'},ma=">",Ja={type:"literal",value:">",description:'">"'},db="==",ta={type:"literal",value:"==",description:'"=="'},Ta="!=",pa={type:"literal",value:"!=",description:'"!="'},
Ka="&",Ab={type:"literal",value:"&",description:'"&"'},ec="^",$b={type:"literal",value:"^",description:'"^"'},ac="|",tb={type:"literal",value:"|",description:'"|"'},Bb="&&",mc={type:"literal",value:"&&",description:'"&&"'},Cb="||",ub={type:"literal",value:"||",description:'"||"'},nc={type:"other",description:"whitespace"},Ob=/^[\t\x0B\f ]/,La={type:"class",value:"[\\t\\x0B\\f ]",description:"[\\t\\x0B\\f ]"},bc={type:"other",description:"end of line"},oc="\n",Oa={type:"literal",value:"\n",description:'"\\n"'},
mb="\r\n",Db={type:"literal",value:"\r\n",description:'"\\r\\n"'},pc="\r",Ea={type:"literal",value:"\r",description:'"\\r"'},Ma={type:"any",description:"any character"},C=0,ka=0,Ba={vh:1,Mf:1,Rh:!1},qa=0,Wb=[],ba=0,ib;if("startRule"in ja){if(!(ja.Gq in ga))throw Error("Can't start parsing from rule \""+ja.Gq+'".');V=ga[ja.Gq]}ib=V();if(ib!==D&&C===b.length)return ib;ib!==D&&C<b.length&&d({type:"end",description:"end of input"});throw function(c,d,e){function f(a){var b=1;for(a.sort(function(a,b){return a.description<
b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,
function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var k=g(e),m=e<b.length?b.charAt(e):null;null!==d&&f(d);return new a(null!==c?c:h(d,m),0,0,e,k.vh,k.Mf)}(null,Wb,qa);}}}()};b4w.module.__md5=function(a){function n(a,k){var f=a[0],l=a[1],n=a[2],m=a[3],f=c(f,l,n,m,k[0],7,-680876936),m=c(m,f,l,n,k[1],12,-389564586),n=c(n,m,f,l,k[2],17,606105819),l=c(l,n,m,f,k[3],22,-1044525330),f=c(f,l,n,m,k[4],7,-176418897),m=c(m,f,l,n,k[5],12,1200080426),n=c(n,m,f,l,k[6],17,-1473231341),l=c(l,n,m,f,k[7],22,-45705983),f=c(f,l,n,m,k[8],7,1770035416),m=c(m,f,l,n,k[9],12,-1958414417),n=c(n,m,f,l,k[10],17,-42063),l=c(l,n,m,f,k[11],22,-1990404162),f=c(f,l,n,m,k[12],7,1804603682),m=c(m,f,l,n,
k[13],12,-40341101),n=c(n,m,f,l,k[14],17,-1502002290),l=c(l,n,m,f,k[15],22,1236535329),f=g(f,l,n,m,k[1],5,-165796510),m=g(m,f,l,n,k[6],9,-1069501632),n=g(n,m,f,l,k[11],14,643717713),l=g(l,n,m,f,k[0],20,-373897302),f=g(f,l,n,m,k[5],5,-701558691),m=g(m,f,l,n,k[10],9,38016083),n=g(n,m,f,l,k[15],14,-660478335),l=g(l,n,m,f,k[4],20,-405537848),f=g(f,l,n,m,k[9],5,568446438),m=g(m,f,l,n,k[14],9,-1019803690),n=g(n,m,f,l,k[3],14,-187363961),l=g(l,n,m,f,k[8],20,1163531501),f=g(f,l,n,m,k[13],5,-1444681467),m=
g(m,f,l,n,k[2],9,-51403784),n=g(n,m,f,l,k[7],14,1735328473),l=g(l,n,m,f,k[12],20,-1926607734),f=b(l^n^m,f,l,k[5],4,-378558),m=b(f^l^n,m,f,k[8],11,-2022574463),n=b(m^f^l,n,m,k[11],16,1839030562),l=b(n^m^f,l,n,k[14],23,-35309556),f=b(l^n^m,f,l,k[1],4,-1530992060),m=b(f^l^n,m,f,k[4],11,1272893353),n=b(m^f^l,n,m,k[7],16,-155497632),l=b(n^m^f,l,n,k[10],23,-1094730640),f=b(l^n^m,f,l,k[13],4,681279174),m=b(f^l^n,m,f,k[0],11,-358537222),n=b(m^f^l,n,m,k[3],16,-722521979),l=b(n^m^f,l,n,k[6],23,76029189),f=
b(l^n^m,f,l,k[9],4,-640364487),m=b(f^l^n,m,f,k[12],11,-421815835),n=b(m^f^l,n,m,k[15],16,530742520),l=b(n^m^f,l,n,k[2],23,-995338651),f=d(f,l,n,m,k[0],6,-198630844),m=d(m,f,l,n,k[7],10,1126891415),n=d(n,m,f,l,k[14],15,-1416354905),l=d(l,n,m,f,k[5],21,-57434055),f=d(f,l,n,m,k[12],6,1700485571),m=d(m,f,l,n,k[3],10,-1894986606),n=d(n,m,f,l,k[10],15,-1051523),l=d(l,n,m,f,k[1],21,-2054922799),f=d(f,l,n,m,k[8],6,1873313359),m=d(m,f,l,n,k[15],10,-30611744),n=d(n,m,f,l,k[6],15,-1560198380),l=d(l,n,m,f,k[13],
21,1309151649),f=d(f,l,n,m,k[4],6,-145523070),m=d(m,f,l,n,k[11],10,-1120210379),n=d(n,m,f,l,k[2],15,718787259),l=d(l,n,m,f,k[9],21,-343485551);a[0]=f+a[0]&4294967295;a[1]=l+a[1]&4294967295;a[2]=n+a[2]&4294967295;a[3]=m+a[3]&4294967295}function b(a,b,c,d,g,l){b=(b+a&4294967295)+(d+l&4294967295)&4294967295;return(b<<g|b>>>32-g)+c&4294967295}function c(a,c,d,g,l,m,n){return b(c&d|~c&g,a,c,l,m,n)}function g(a,c,d,g,l,m,n){return b(c&g|d&~g,a,c,l,m,n)}function d(a,c,d,g,l,m,n){return b(d^(c|~g),a,c,l,
m,n)}var l="0123456789abcdef".split("");a.Wo=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var g=b.substring(d-64,d),m=[],x=void 0,x=0;64>x;x+=4)m[x>>2]=g.charCodeAt(x)+(g.charCodeAt(x+1)<<8)+(g.charCodeAt(x+2)<<16)+(g.charCodeAt(x+3)<<24);n(a,m)}b=b.substring(d-64);g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)g[d>>2]|=b.charCodeAt(d)<<(d%4<<3);g[d>>2]|=128<<(d%4<<3);if(55<d)for(n(a,g),d=0;16>d;d++)g[d]=0;g[14]=8*
c;n(a,g);for(b=0;b<a.length;b++){c=a[b];d="";for(g=0;4>g;g++)d+=l[c>>8*g+4&15]+l[c>>8*g&15];a[b]=d}return a.join("")}};b4w.module.shader_texts=function(a){a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_glow_intensity",";"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",
b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_glow_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},
{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",
a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 ce = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"ce = mix ( ce , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 cf = vec3 ( 0.0 ) ; vec3 cg = vec3 ( 0.0 ) ; vec3 ch = vec3 ( 0.0 ) ; bm ( ce , cf , cg , ch ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","ci","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ci = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 cj = ( u_model_matrix * vec4 ( ci , 1.0 ) ) . xyz ; mat4 ck = _ ( u_camera_eye , cj , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND",
"&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 cl = ( u_model_matrix * vec4 ( ci , 1.0 ) ) . xyz ; ck = ck * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , cl ) ;".split(" ")}]}}]},{type:"textline",b:"c cm = ag ( ce - ci , ci , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ck ) ; cm . b = cj ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c cm = ag ( ce , ci , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","cn","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cn = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cd ( cm . a , cm . b , cn ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = aj ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( cm . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC",
"!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ;".split(" ")}]}}]},{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cy",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4",
"cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"shadow.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float fj = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"float fj = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( fj < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cl ( cy ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( fd ( cE . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"SHADOW_TEX_RES",
b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:"WIND_BEND && MAIN_BEND_COL && DETAIL_BEND || SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:"BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",
b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",
";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","float","cy",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",
b:"void main ( ) { vec3 gm = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"gm = mix ( gm , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 gn = vec3 ( 0.0 ) ; vec3 go = vec3 ( 0.0 ) ; vec3 gp = vec3 ( 0.0 ) ; bm ( gm , gn , go , gp ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||",
"BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","gq","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gq = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c gr = fY ( gm , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gq , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gs = ( u_model_matrix * vec4 ( gq , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",a:[{type:"if",c:"! HAIR_BILLBOARD && SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:["mat4","gt","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["mat4","gt","=","u_view_matrix",
";"]}]}}]},{type:"textline",b:"mat4 gu = _ ( u_camera_eye , gs , gt ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 gv = ( u_model_matrix * vec4 ( gq , 1.0 ) ) . xyz ; gu = gu * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , gv ) ;".split(" ")}]}}]},{type:"textline",b:"c gr = ag ( gm - gq , gq , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , gu ) ; gr . b = gs ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"c gr = ag ( gm , gq , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","gw","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 gw = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cd ( gr . a , gr . b , gw ) ;".split(" ")}]}}]},
{type:"textline",b:"vec4 gx = u_view_matrix * vec4 ( gr . a , 1.0 ) ; vec4 gy = u_proj_matrix * gx ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"gy . xy += u_subpixel_jitter * gy . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = aj ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",
a:[{type:"textline",b:"gh ( gr . a ) ; cE = gx ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"cy = - gx . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC == SHADOW_SRC_NONE && SHADOW_DST == SHADOW_DST_DEPTH".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 gz = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; float gA = SHADOW_TEX_RES / 2.0 ; gz = floor ( gz * gA + 0.5 ) / gA - gz ; gy . xy += gz ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","gy",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gm",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gm",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gm",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","gm",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( gm , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , gm ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4",
"u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gm",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","gm",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","gm",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")",
"{"]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 gn = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 go = _ ( u_camera_eye , gn , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"go = go * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"c gp = ag ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , go ) ; gp . b = gn ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"c gp = ag ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gq = u_proj_matrix * u_view_matrix * vec4 ( gp . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gm = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["gm","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gm","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","gq",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",
b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 gu ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float gv ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int gw = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int gw = NUM_LINES ;".split(" ")}]}}]},{type:"textline",
b:"float gy ( float gx ) { return gx - floor ( gx * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void gH ( inout float gz , in float gA [ gw ] , in float gB ) { for ( int gC = 0 ; gC < NUM_RINGS ; gC ++ ) { float gD = 40.0 * gA [ gC ] ; float gE = 300.0 * ( gy ( gD ) - 0.005 ) ; float gF = gD ; float gG = abs ( gF * ( u_halo_size * gE - gB ) ) ; gz += 1.0 - min ( gG , 1.0 ) ; } }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void gQ ( inout float gI , in float gJ [ gw ] , in float gK ) { for ( int gL = 0 ; gL < NUM_LINES ; gL ++ ) { float gM = gJ [ gL ] ; float gN = gM ; float gO = 1000.0 * ( gy ( gM ) - 0.005 ) ; float gP = 20.0 * abs ( gN * a . x + gO * a . y ) ; gI += 1.0 - min ( gP , 1.0 ) ; } gI *= gK ; }".split(" ")}]}}]},{type:"textline",b:"void gX ( inout float gR , in vec2 gS ) { float gT , gU ; gU = atan ( gS . y , gS . x ) ; gU *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float gV = cos ( gU ) ; float gW = sin ( gU ) ; gU = ( gV * gS . x + gW * gS . y ) * ( gV * gS . y - gW * gS . x ) ; gT = abs ( gU ) ; if ( gT < 1.0 ) { gT = ( 0.01 * u_halo_size ) / ( gT ) ; gR *= sqrt ( min ( gT , 1.0 ) ) ; } } void main ( ) { float gY = ( a . x * a . x + a . y * a . y ) ; float gZ = sqrt ( gY ) ; gY = max ( 1.0 - gY , 0.0 ) ; gY = pow ( gY , u_halo_hardness ) ; float g_ = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float ha [ gw ] ; for ( int hb = 0 ; hb < gw ; hb ++ ) { ha [ hb ] = fract ( gv / ( float ( hb ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"float hc = 0.0 ; gH ( hc , ha , gZ ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float hd = 0.0 ; gQ ( hd , ha , gY ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"gX ( gY , a ) ;".split(" ")}]}}]},{type:"textline",b:"gY *= g_ ; vec3 he = u_diffuse_color . rgb * gY ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"hc *= gY ; he += u_halo_rings_color * hc ; gY += hc ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"hd *= g_ ; he += u_halo_lines_color * hd ; gY += hd ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"gY *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float hf = u_halo_stars_blend * ( gu . y - u_halo_stars_height ) ; gY *= clamp ( hf , 0.0 , 1.0 ) ; gY *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"gq ( he ) ; gt ( he , gY ) ; gl_FragColor = vec4 ( he , gY ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float gv ;".split(" ")},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","gu",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 gw = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; a = a_halo_bb_vertex * 2.0 ; gv = fract ( gw . x + gw . y + gw . z ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",
a:[{type:"textline",b:"mat4 gx = y ( gw , u_view_matrix ) ; mat4 gy = u_view_matrix ; gy [ 3 ] [ 0 ] = 0.0 ; gy [ 3 ] [ 1 ] = 0.0 ; gy [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 gx = y ( gw , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 gz = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 gA = gx * gz ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"vec4 gB = u_proj_matrix * gy * gA ; gB . z = 0.99999 * gB . w ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["gu","=","gA",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 gB = u_proj_matrix * u_view_matrix * gA ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","gB",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};
a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 gw = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( gw , 1.0 ) ; }".split(" ")}]};a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",
name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"textline",b:["uniform","float","u_environment_energy",";"]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D",
"u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_factor ; uniform vec2 u_normalmap0_uv_velocity ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ; uniform vec2 u_colormap0_uv_velocity ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",
b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform float u_specular_alpha ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_reflect_factor ; uniform vec4 u_refl_plane ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 kp ; varying vec3 kq ; varying vec3 kr ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",
b:["varying","vec4","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ks",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kt",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","ku",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:["void",
"main","(",")","{"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float lf = kq . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["vec2","lg","=","a",";"]}]}}]},{type:"textline",b:["vec3","lh","=","kr",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) lh = lh ; else lh = - lh ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vec3 li = cross ( lh , ks . xyz ) * ks . w ; mat3 lj = mat3 ( ks . xyz , li , lh ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float lk = length ( cE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",
b:"vec2 ll = normalize ( u_view_matrix_frag * vec4 ( kr , 0.0 ) ) . st ; ll = ll * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( lk < PARALLAX_LOD_DIST ) { float lm = clamp ( 0.5 * ( PARALLAX_LOD_DIST - lk ) , 0.0 , 1.0 ) ; float ln = u_parallax_scale * lm ; vec3 lo = normalize ( kp * lj ) ; float lp = 1.0 / PARALLAX_STEPS ; vec2 lq = lo . xy * ln / ( PARALLAX_STEPS * lo . z ) ; float lr = 1.0 ; float ls ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:["vec2","lt","=","ll",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","lt","=","lg",";"]}]}}]},{type:"textline",b:"ls = texture2D ( u_normalmap0 , lt + u_time * u_normalmap0_uv_velocity ) . a ; for ( float lu = 1.0 ; lu <= PARALLAX_STEPS ; lu ++ ) { if ( ls < lr ) { lr -= lp ; lt -= lq ; ls = texture2D ( u_normalmap0 , lt ) . a ; } } vec2 lv = lt + lq ; float lw = texture2D ( u_normalmap0 , lv ) . a - ( lr + lp ) ; float lx = ls - lr ; float ly = lx / ( lx - lw ) ; lt = ly * lv + ( 1.0 - ly ) * lt ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"lg += lt - ll ;".split(" ")}]}}]},{type:"textline",b:["ll","=","lt",";"]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"ll += lt - lg ;".split(" ")}]}}]},{type:"textline",b:["lg","=","lt",";"]}]}}]},{type:"textline",
b:["}"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["vec4","lz",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lz = texture2D ( u_normalmap0 , ll ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lz = texture2D ( u_normalmap0 , lg + u_time * u_normalmap0_uv_velocity ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lA = lz . rgb - 0.5 ; lA = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , lA , u_normal_factor ) ; vec3 lB = lj * lA ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","lB","=","lh",";"]}]}}]},{type:"textline",b:"lB = normalize ( lB ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORMAL_TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"ll = normalize ( u_view_matrix_frag * vec4 ( lB , 0.0 ) ) . st ; ll = ll * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lC = normalize ( kp ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],
group:{type:"group",a:[{type:"textline",b:"vec3 lD = kt ; go ( lD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec4 lE = vec4 ( lD , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","lE","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["float","lF","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:"vec4 lG = texture2D ( u_colormap0 , ll ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COLOR0_CO","==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec4 lG = texture2D ( u_colormap0 , lg + u_time * u_colormap0_uv_velocity ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR0_CO"],group:{type:"group",a:[{type:"textline",b:"go ( lG . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",
a:[{type:"textline",b:["vec4","lH",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR1_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"lH = texture2D ( u_colormap1 , ll ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lH = texture2D ( u_colormap1 , lg ) ;".split(" ")}]}}]},{type:"textline",b:"go ( lH . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",
a:[{type:"textline",b:"vec4 lI = texture2D ( u_stencil0 , ll ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 lI = texture2D ( u_stencil0 , lg ) ;".split(" ")}]}}]},{type:"textline",b:"lG = mix ( lG , lH , lI . r ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lE . rgb = mix ( lE . rgb , lG . rgb , u_diffuse_color_factor ) ; float lJ = u_alpha_factor * lG . a ; lJ += ( 1.0 - step ( 0.0 , lJ ) ) ; lE . a = mix ( lJ , 1.0 , u_diffuse_color . a ) ; lF = lG . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lE . rgb *= mix ( vec3 ( 1.0 ) , lG . rgb , u_diffuse_color_factor ) ; lE . a = lG . a ; lF = lG . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 lK = u_diffuse_intensity * lE . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["vec3","lL","=","lK",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lM = 0.5 * lB . y + 0.5 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 lN = u_environment_energy * textureCube ( u_sky_texture , lB ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lN = u_environment_energy * mix ( u_horizon_color , u_zenith_color , lM ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lO = u_ambient * lN ; float lP = fi ( lK ) ; vec3 lQ = u_emit * lE . rgb ; vec3 lR = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"vec3 lS = vec3 ( lF ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_SPEC_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 lS = texture2D ( u_specmap0 , ll ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lS = texture2D ( u_specmap0 , lg ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"go ( lS . rgb ) ; lR = mix ( lR , lS , u_specular_color_factor ) ;".split(" ")}]}}]},
{type:"textline",b:"float lT = u_specular_params [ 0 ] ; vec2 lU = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 lV = lT * lR ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS","==","0"],group:{type:"group",a:[{type:"textline",b:"hm lW = jO ( lQ , lO , lK ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hm lW = jJ ( lQ , lO , lK , lV , kq , lB , lC , lU , u_diffuse_params , lP , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 lL = lW . a . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["float","lX","=","u_reflect_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","lX","=","0.0",";"]}]}}]},{type:"textline",b:"kR ( lL , lC , lB , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , lX ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"lL += lW . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"lL = max ( lL - sqrt ( 0.01 * - min ( lf , 0.0 ) ) , 0.5 * lL ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"ko ( lL , lf , u_time , lP , lB , u_sun_direction , u_sun_intensity , u_sun_quaternion , kq , lk ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"float lY = lE . a ; if ( lY <= 0.5 ) discard ; lY = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float lY = lE . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"lY += lW . a . a * lV . r * u_specular_alpha ;".split(" ")}]}}]}]}}]}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["float","lY","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lL = mix ( le ( cD , lB . xz * u_refr_bump ) , lL , lY ) ; lY = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float lZ = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 l_ = gI ( u_cube_fog , lC ) ; vec4 ma = vec4 ( l_ , u_fog_color_density . a ) ; go ( ma . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 ma = u_fog_color_density ; ma . rgb *= lZ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"ha ( lL , lk , lC , u_cam_water_depth , u_underwater_fog_color_density , ma , lf , lZ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gB ( lL , lk , ma ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),group:{type:"group",a:[{type:"textline",b:"lL = vec3 ( dK . a ) ;".split(" ")}]}}]},{type:"textline",b:["gq","(","lL",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"gt ( lL , lY ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lL , lY ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 kp ; varying vec3 kq ; varying vec3 kr ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cE",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ks",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kt",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","ku",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 lf = a_position ; vec3 lg = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO",
"==","TEXTURE_COORDS_UV_ORCO"],group:{type:"group",a:[{type:"textline",b:"vec3 lh = vec3 ( a_tangent ) ; vec3 li = a_tangent [ 3 ] * cross ( lg , lh ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_NORM_CO","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec3 lj = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 lk = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vec3 ll = lj - u_camera_eye ; vec3 li = cross ( ll , lk ) ; vec3 lh = cross ( lk , li ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lh = vec3 ( 0.0 ) ; vec3 li = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"lf = mix ( lf , a_position_next , u_va_frame_factor ) ; lg = mix ( lg , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"vec3 lm = vec3 ( a_tangent ) ; vec3 ln = a_tangent_next [ 3 ] * cross ( a_normal_next , lm ) ; lh = mix ( lh , lm , u_va_frame_factor ) ; li = mix ( li , ln , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bm ( lf , lh , li , lg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","lo","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lo = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c lp = fY ( lf , lh , li , lg , lo , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 lq = ( u_model_matrix * vec4 ( lo , 1.0 ) ) . xyz ; mat4 lr = _ ( u_camera_eye , lq , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 ls = ( u_model_matrix * vec4 ( lo , 1.0 ) ) . xyz ; lr = lr * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , ls ) ;".split(" ")}]}}]},
{type:"textline",b:"c lp = ag ( lf - lo , lo , lh , li , lg , lr ) ; lp . b = lq ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c lp = ag ( lf , lo , lh , li , lg , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM_CO"],group:{type:"group",a:[{type:"textline",b:"float lt = ( dot ( cross ( lp . e , lp . c ) , lp . d ) < 0.0 ) ? - 1.0 : 1.0 ; ks = vec4 ( lp . c , lt ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"textline",b:"cd ( lp . a , lp . b , lg ) ;".split(" ")}]}}]},{type:"textline",b:"kq = lp . a ; kr = lp . e ; kp = u_camera_eye - lp . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"a = aj ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"kt = lp . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",
a:[{type:"textline",b:["kt","=","a_color",";"]}]}}]},{type:"textline",b:"vec4 lu = u_view_matrix * vec4 ( lp . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM_CO && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["cE","=","lu",";"]}]}}]},{type:"textline",b:"vec4 lv = u_proj_matrix * lu ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"lv . xy += u_subpixel_jitter * lv . w ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gh","(","lv",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gh ( lp . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:"float lw = lv . x ; float lx = lv . y ; float ly = lv . w ; cD . x = ( lw + ly ) / 2.0 ; cD . y = ( lx + ly ) / 2.0 ; cD . z = ly ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"ku = - lu . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","lv",";","}"]}]};a["nodes.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"var",name:"NUM_ANIM_VALUES",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_VECTOR_VIEW","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_reflectmap ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["USE_NODE_ANIM_VALUE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_anim_values [ NUM_ANIM_VALUES ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 kq ; varying vec4 cE ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kr",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","ks",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","ku",";"]}]}}]},{type:"textline",b:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; vec3 lf = vec3 ( UNITY_VALUE_NODES ) ; vec3 lg = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")},
{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"},{type:"textline",b:"vec3 lk ( in vec3 lh , in float li ) { vec3 lj = lg ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lj = le ( cD , lh . xz * li ) ;".split(" ")}]}}]},{type:"textline",b:["return","lj",";","}"]}]}}]},{type:"textline",b:"vec3 ln ( float ll , vec3 lm ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"return textureCube ( u_sky_texture , lm ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return mix ( u_horizon_color , u_zenith_color , ll ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec3 lu ( vec3 lo ) { vec4 lp = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; vec4 lq = mix ( vec4 ( lo . bg , lp . wz ) , vec4 ( lo . gb , lp . xy ) , step ( lo . b , lo . g ) ) ; vec4 lr = mix ( vec4 ( lq . xyw , lo . r ) , vec4 ( lo . r , lq . yzx ) , step ( lq . x , lo . r ) ) ; float ls = lr . x - min ( lr . w , lr . y ) ; float lt = 1.0e-10 ; return vec3 ( abs ( lr . z + ( lr . w - lr . y ) / ( 6.0 * ls + lt ) ) , ls / ( lr . x + lt ) , lr . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 ly ( vec3 lv ) { vec4 lw = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; vec3 lx = abs ( fract ( vec3 ( lv . r , lv . r , lv . r ) + lw . xyz ) * 6.0 - lw . www ) ; return lv . b * mix ( lw . xxx , clamp ( lx - lw . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , lv . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 lA ( vec2 lz ) { return vec3 ( lz * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_TEXTURE_COLOR || USE_NODE_TEXTURE_NORMAL || USE_NODE_TEXTURE_COLOR2 || USE_NODE_TEXTURE_NORMAL2 || USE_NODE_TEXTURE_COLOR3 || USE_NODE_TEXTURE_NORMAL3 || USE_NODE_TEXTURE_NORMAL4 || USE_NODE_TEXTURE_COLOR4 || USE_NODE_PARALLAX".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lC ( vec3 lB ) { return vec2 ( lB . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},{type:"textline",b:"void lH ( inout vec3 lD , vec3 lE , vec3 lF , float lG ) {".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"kR ( lD , lE , lF , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , lG ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kR ( lD , lE , lF , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , lG ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"} hm lV ( vec3 lI , vec3 lJ , vec3 lK , vec3 lL , vec3 lM , vec3 lN , vec3 lO , vec2 lP , vec2 lQ , float lR , float lS , vec4 lT ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS_MAT"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"return jJ ( lI , lJ , lK , lL , lM , lN , lO , lP , lQ , lR , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , lS , lT ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"return jO ( lI , lJ , lK ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hm lU ; lU . a = vec4 ( lK , ZERO_VALUE_NODES ) ; lU . b = lg ; return lU ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"node",name:"CAMERA",group:{type:"group",a:[{type:"node_out",name:"mL",qualifier:["vec3"]},{type:"node_out",name:"mM",qualifier:["float"]},{type:"node_out",name:"mN",qualifier:["float"]},{type:"textline",b:"mL = normalize ( mB . xyz ) ; mM = abs ( mB . z ) ; mN = length ( mB . xyz ) ;".split(" ")}]}},
{type:"node",name:"COMBRGB",group:{type:"group",a:[{type:"node_in",name:"mO",qualifier:["float"]},{type:"node_in",name:"mP",qualifier:["float"]},{type:"node_in",name:"mQ",qualifier:["float"]},{type:"node_out",name:"mR",qualifier:["vec3"]},{type:"textline",b:"mR = vec3 ( mO , mP , mQ ) ;".split(" ")}]}},{type:"node",name:"COMBHSV",group:{type:"group",a:[{type:"node_in",name:"mS",qualifier:["float"]},{type:"node_in",name:"mT",qualifier:["float"]},{type:"node_in",name:"mU",qualifier:["float"]},{type:"node_out",
name:"mV",qualifier:["vec3"]},{type:"textline",b:"mV = ly ( vec3 ( mS , mT , mU ) ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"lW",qualifier:["varying","vec2"]},{type:"node_out",name:"mW",qualifier:["vec3"]},{type:"textline",b:"mW = lA ( lW ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VC",group:{type:"group",a:[{type:"node_param",name:"lX",qualifier:["varying","vec3"]},{type:"node_out",name:"mX",qualifier:["vec3"]},{type:"textline",b:["mX",
"=","lX",";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"lY",qualifier:["varying","float"]},{type:"node_out",name:"mY",qualifier:["float"]},{type:"textline",b:["mY","=","lY",";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"lZ",qualifier:["varying","vec2"]},{type:"node_out",name:"mZ",qualifier:["float"]},{type:"node_out",name:"m_",qualifier:["float"]},{type:"textline",b:"mZ = lZ [ 0 ] ; m_ = lZ [ 1 ] ;".split(" ")}]}},
{type:"node",name:"GEOMETRY_VC3",group:{type:"group",a:[{type:"node_param",name:"l_",qualifier:["varying","vec3"]},{type:"node_out",name:"na",qualifier:["float"]},{type:"node_out",name:"nb",qualifier:["float"]},{type:"node_out",name:"nc",qualifier:["float"]},{type:"textline",b:"na = l_ [ 0 ] ; nb = l_ [ 1 ] ; nc = l_ [ 2 ] ;".split(" ")}]}},{type:"node",name:"GEOMETRY_NO",group:{type:"group",a:[{type:"node_out",name:"nd",qualifier:["vec3"]},{type:"textline",b:["nd","=","mx",";"]}]}},{type:"node",
name:"GEOMETRY_FB",group:{type:"group",a:[{type:"node_out",name:"ne",qualifier:["float"]},{type:"textline",b:"ne = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VW",group:{type:"group",a:[{type:"node_out",name:"nf",qualifier:["vec3"]},{type:"textline",b:["nf","=","mz",";"]}]}},{type:"node",name:"GEOMETRY_GL",group:{type:"group",a:[{type:"node_out",name:"ng",qualifier:["vec3"]},{type:"textline",b:"ng = vec3 ( mA . r , - mA . b , mA . g ) ;".split(" ")}]}},
{type:"node",name:"HUE_SAT",group:{type:"group",a:[{type:"node_in",name:"nh",qualifier:["float"]},{type:"node_in",name:"ni",qualifier:["float"]},{type:"node_in",name:"nj",qualifier:["float"]},{type:"node_in",name:"nk",qualifier:["float"]},{type:"node_in",name:"nl",qualifier:["vec3"]},{type:"node_out",name:"nm",qualifier:["vec3"]},{type:"textline",b:"{ vec3 nn = lu ( nl ) ; nn [ 0 ] += ( nh - 0.5 ) ; if ( nn [ 0 ] > UNITY_VALUE_NODES ) nn [ 0 ] -= UNITY_VALUE_NODES ; else if ( nn [ 0 ] < ZERO_VALUE_NODES ) nn [ 0 ] += UNITY_VALUE_NODES ; nn *= vec3 ( UNITY_VALUE_NODES , ni , nj ) ; nn = mix ( lf , mix ( lg , nn , step ( lg , nn ) ) , step ( nn , lf ) ) ; nm = mix ( nl , ly ( nn ) , nk ) ; }".split(" ")}]}},
{type:"node",name:"INVERT",group:{type:"group",a:[{type:"node_in",name:"no",qualifier:["float"]},{type:"node_in",name:"np",qualifier:["vec3"]},{type:"node_out",name:"nq",qualifier:["vec3"]},{type:"textline",b:"nq = mix ( np , lf - np , no ) ;".split(" ")}]}},{type:"node",name:"LAMP",group:{type:"group",a:[{type:"node_param",name:"ma",qualifier:["const","float"]},{type:"node_out",name:"nr",qualifier:["vec3"]},{type:"node_out",name:"ns",qualifier:["vec3"]},{type:"node_out",name:"nt",qualifier:["float"]},
{type:"node_out",name:"nu",qualifier:["float"]},{type:"textline",b:"{ const int nv = int ( ma ) ; vec4 nw = u_lamp_light_factors [ nv ] ; vec3 nx = u_lamp_light_directions [ nv ] ; vec3 ny = u_lamp_light_positions [ nv ] ; float nz = nw . z ; nr = u_lamp_light_color_intensities [ nv ] ; if ( nz != - UNITY_VALUE_NODES ) { ns = ny - kq ; nt = length ( ns ) ; ns = normalize ( ns ) ; nu = nz / ( nz + nt * nt ) ; float nA = nw . x ; float nB = nw . y ; if ( nA > - UNITY_VALUE_NODES ) { float nC = dot ( ns , nx ) ; nC *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( nC - nA ) / nB ) ; nu *= nC ; } } else { ns = nx ; nt = length ( ny - kq ) ; nu = UNITY_VALUE_NODES ; } }".split(" ")}]}},
{type:"node",name:"NORMAL",group:{type:"group",a:[{type:"node_param",name:"mb",qualifier:["vec3"]},{type:"node_in",name:"nD",qualifier:["vec3"]},{type:"node_out",name:"nE",qualifier:["vec3"]},{type:"node_out",name:"nF",qualifier:["float"]},{type:"textline",b:"nE = mb ; nF = - dot ( nD , mb ) ;".split(" ")}]}},{type:"node",name:"VECTOR_VIEW",group:{type:"group",a:[{type:"node_in",name:"nG",qualifier:["vec3"]},{type:"node_out",name:"nH",qualifier:["vec3"]},{type:"textline",b:"nH = - ( u_view_matrix_frag * vec4 ( nG , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]}},
{type:"node",name:"MAPPING_LIGHT",group:{type:"group",a:[{type:"node_param",name:"mc",qualifier:["vec3"]},{type:"node_in",name:"nI",qualifier:["vec3"]},{type:"node_out",name:"nJ",qualifier:["vec3"]},{type:"textline",b:"nJ = nI * mc ;".split(" ")}]}},{type:"node",name:"MAPPING_HEAVY",group:{type:"group",a:[{type:"node_param",name:"md",qualifier:["mat4"]},{type:"node_param",name:"me",qualifier:["float"]},{type:"node_param",name:"mf",qualifier:["float"]},{type:"node_param",name:"mg",qualifier:["vec3"]},
{type:"node_param",name:"mh",qualifier:["vec3"]},{type:"node_in",name:"nK",qualifier:["vec3"]},{type:"node_out",name:"nL",qualifier:["vec3"]},{type:"textline",b:"nL = ( md * vec4 ( nK , UNITY_VALUE_NODES ) ) . xyz ; if ( me == UNITY_VALUE_NODES ) nL = max ( nL , mg ) ; if ( mf == UNITY_VALUE_NODES ) nL = min ( nL , mh ) ;".split(" ")}]}},{type:"node",name:"MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"nM",qualifier:["float"]},{type:"node_in",name:"nN",qualifier:["float"]},{type:"node_out",
name:"nO",qualifier:["float"]},{type:"textline",b:"nO = nM + nN ;".split(" ")}]}},{type:"node",name:"MATH_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"nP",qualifier:["float"]},{type:"node_in",name:"nQ",qualifier:["float"]},{type:"node_out",name:"nR",qualifier:["float"]},{type:"textline",b:"nR = nP - nQ ;".split(" ")}]}},{type:"node",name:"MATH_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"nS",qualifier:["float"]},{type:"node_in",name:"nT",qualifier:["float"]},{type:"node_out",name:"nU",
qualifier:["float"]},{type:"textline",b:"nU = nS * nT ;".split(" ")}]}},{type:"node",name:"MATH_DIVIDE",group:{type:"group",a:[{type:"node_in",name:"nV",qualifier:["float"]},{type:"node_in",name:"nW",qualifier:["float"]},{type:"node_out",name:"nX",qualifier:["float"]},{type:"textline",b:"nX = ( nW != ZERO_VALUE_NODES ) ? nV / nW : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_SINE",group:{type:"group",a:[{type:"node_in",name:"nY",qualifier:["float"]},{type:"node_in",name:"nZ",qualifier:["float"]},
{type:"node_out",name:"n_",qualifier:["float"]},{type:"textline",b:"n_ = sin ( nY ) ; nZ ;".split(" ")}]}},{type:"node",name:"MATH_COSINE",group:{type:"group",a:[{type:"node_in",name:"oa",qualifier:["float"]},{type:"node_in",name:"ob",qualifier:["float"]},{type:"node_out",name:"oc",qualifier:["float"]},{type:"textline",b:"oc = cos ( oa ) ; ob ;".split(" ")}]}},{type:"node",name:"MATH_TANGENT",group:{type:"group",a:[{type:"node_in",name:"od",qualifier:["float"]},{type:"node_in",name:"oe",qualifier:["float"]},
{type:"node_out",name:"of",qualifier:["float"]},{type:"textline",b:"of = tan ( od ) ; oe ;".split(" ")}]}},{type:"node",name:"MATH_ARCSINE",group:{type:"group",a:[{type:"node_in",name:"og",qualifier:["float"]},{type:"node_in",name:"oh",qualifier:["float"]},{type:"node_out",name:"oi",qualifier:["float"]},{type:"textline",b:"oi = ( og <= UNITY_VALUE_NODES && og >= - UNITY_VALUE_NODES ) ? asin ( og ) : ZERO_VALUE_NODES ; oh ;".split(" ")}]}},{type:"node",name:"MATH_ARCCOSINE",group:{type:"group",a:[{type:"node_in",
name:"oj",qualifier:["float"]},{type:"node_in",name:"ok",qualifier:["float"]},{type:"node_out",name:"ol",qualifier:["float"]},{type:"textline",b:"ol = ( oj <= UNITY_VALUE_NODES && oj >= - UNITY_VALUE_NODES ) ? acos ( oj ) : ZERO_VALUE_NODES ; ok ;".split(" ")}]}},{type:"node",name:"MATH_ARCTANGENT",group:{type:"group",a:[{type:"node_in",name:"om",qualifier:["float"]},{type:"node_in",name:"on",qualifier:["float"]},{type:"node_out",name:"oo",qualifier:["float"]},{type:"textline",b:"oo = atan ( om ) ; on ;".split(" ")}]}},
{type:"node",name:"MATH_POWER",group:{type:"group",a:[{type:"node_in",name:"op",qualifier:["float"]},{type:"node_in",name:"oq",qualifier:["float"]},{type:"node_out",name:"or",qualifier:["float"]},{type:"textline",b:"if ( op < ZERO_VALUE_NODES || op == ZERO_VALUE_NODES && oq == ZERO_VALUE_NODES ) or = ZERO_VALUE_NODES ; else or = pow ( op , oq ) ;".split(" ")}]}},{type:"node",name:"MATH_LOGARITHM",group:{type:"group",a:[{type:"node_in",name:"os",qualifier:["float"]},{type:"node_in",name:"ot",qualifier:["float"]},
{type:"node_out",name:"ou",qualifier:["float"]},{type:"textline",b:"ou = ( os > ZERO_VALUE_NODES && ot > ZERO_VALUE_NODES ) ? log2 ( os ) / log2 ( ot ) : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_MINIMUM",group:{type:"group",a:[{type:"node_in",name:"ov",qualifier:["float"]},{type:"node_in",name:"ow",qualifier:["float"]},{type:"node_out",name:"ox",qualifier:["float"]},{type:"textline",b:"ox = min ( ov , ow ) ;".split(" ")}]}},{type:"node",name:"MATH_MAXIMUM",group:{type:"group",a:[{type:"node_in",
name:"oy",qualifier:["float"]},{type:"node_in",name:"oz",qualifier:["float"]},{type:"node_out",name:"oA",qualifier:["float"]},{type:"textline",b:"oA = max ( oy , oz ) ;".split(" ")}]}},{type:"node",name:"MATH_ROUND",group:{type:"group",a:[{type:"node_in",name:"oB",qualifier:["float"]},{type:"node_in",name:"oC",qualifier:["float"]},{type:"node_out",name:"oD",qualifier:["float"]},{type:"textline",b:"oD = floor ( oB + 0.5 ) ; oC ;".split(" ")}]}},{type:"node",name:"MATH_LESS_THAN",group:{type:"group",
a:[{type:"node_in",name:"oE",qualifier:["float"]},{type:"node_in",name:"oF",qualifier:["float"]},{type:"node_out",name:"oG",qualifier:["float"]},{type:"textline",b:"oG = ( oE < oF ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_GREATER_THAN",group:{type:"group",a:[{type:"node_in",name:"oH",qualifier:["float"]},{type:"node_in",name:"oI",qualifier:["float"]},{type:"node_out",name:"oJ",qualifier:["float"]},{type:"textline",b:"oJ = ( oH > oI ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]}},
{type:"node",name:"MATH_MODULO",group:{type:"group",a:[{type:"node_in",name:"oK",qualifier:["float"]},{type:"node_in",name:"oL",qualifier:["float"]},{type:"node_out",name:"oM",qualifier:["float"]},{type:"textline",b:"oM = abs ( oL ) > 0.000001 ? mod ( oK , oL ) : ZERO_VALUE_NODES ;".split(" ")}]}},{type:"node",name:"MATH_ABSOLUTE",group:{type:"group",a:[{type:"node_in",name:"oN",qualifier:["float"]},{type:"node_in",name:"oO",qualifier:["float"]},{type:"node_out",name:"oP",qualifier:["float"]},{type:"textline",
b:"oP = abs ( oN ) ; oO ;".split(" ")}]}},{type:"node",name:"MIX_RGB_MIX",group:{type:"group",a:[{type:"node_in",name:"oQ",qualifier:["float"]},{type:"node_in",name:"oR",qualifier:["vec3"]},{type:"node_in",name:"oS",qualifier:["vec3"]},{type:"node_out",name:"oT",qualifier:["vec3"]},{type:"textline",b:"{ float oU = clamp ( oQ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oT = mix ( oR , oS , oU ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_ADD",group:{type:"group",a:[{type:"node_in",name:"oV",qualifier:["float"]},
{type:"node_in",name:"oW",qualifier:["vec3"]},{type:"node_in",name:"oX",qualifier:["vec3"]},{type:"node_out",name:"oY",qualifier:["vec3"]},{type:"textline",b:"{ float oZ = clamp ( oV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oY = mix ( oW , oW + oX , oZ ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"o_",qualifier:["float"]},{type:"node_in",name:"pa",qualifier:["vec3"]},{type:"node_in",name:"pb",qualifier:["vec3"]},{type:"node_out",name:"pc",
qualifier:["vec3"]},{type:"textline",b:"{ float pd = clamp ( o_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pc = mix ( pa , pa * pb , pd ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"pe",qualifier:["float"]},{type:"node_in",name:"pf",qualifier:["vec3"]},{type:"node_in",name:"pg",qualifier:["vec3"]},{type:"node_out",name:"ph",qualifier:["vec3"]},{type:"textline",b:"{ float pi = clamp ( pe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; ph = mix ( pf , pf - pg , pi ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_SCREEN",group:{type:"group",a:[{type:"node_in",name:"pj",qualifier:["float"]},{type:"node_in",name:"pk",qualifier:["vec3"]},{type:"node_in",name:"pl",qualifier:["vec3"]},{type:"node_out",name:"pm",qualifier:["vec3"]},{type:"textline",b:"{ float pn = clamp ( pj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float po = UNITY_VALUE_NODES - pn ; pm = lf - ( vec3 ( po ) + pn * ( lf - pl ) ) * ( lf - pk ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DIVIDE",group:{type:"group",
a:[{type:"node_in",name:"pp",qualifier:["float"]},{type:"node_in",name:"pq",qualifier:["vec3"]},{type:"node_in",name:"pr",qualifier:["vec3"]},{type:"node_out",name:"ps",qualifier:["vec3"]},{type:"textline",b:"{ float pt = clamp ( pp , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pu = UNITY_VALUE_NODES - pt ; pr += step ( pr , lg ) ; ps = pu * pq + pt * pq / pr ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DIFFERENCE",group:{type:"group",a:[{type:"node_in",name:"pv",qualifier:["float"]},{type:"node_in",
name:"pw",qualifier:["vec3"]},{type:"node_in",name:"px",qualifier:["vec3"]},{type:"node_out",name:"py",qualifier:["vec3"]},{type:"textline",b:"{ float pz = clamp ( pv , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; py = mix ( pw , abs ( pw - px ) , pz ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DARKEN",group:{type:"group",a:[{type:"node_in",name:"pA",qualifier:["float"]},{type:"node_in",name:"pB",qualifier:["vec3"]},{type:"node_in",name:"pC",qualifier:["vec3"]},{type:"node_out",name:"pD",qualifier:["vec3"]},
{type:"textline",b:"{ float pE = clamp ( pA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pD = min ( pB . rgb , pC . rgb * pE ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LIGHTEN",group:{type:"group",a:[{type:"node_in",name:"pF",qualifier:["float"]},{type:"node_in",name:"pG",qualifier:["vec3"]},{type:"node_in",name:"pH",qualifier:["vec3"]},{type:"node_out",name:"pI",qualifier:["vec3"]},{type:"textline",b:"{ float pJ = clamp ( pF , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; pI = max ( pG . rgb , pH . rgb * pJ ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_OVERLAY",group:{type:"group",a:[{type:"node_in",name:"pK",qualifier:["float"]},{type:"node_in",name:"pL",qualifier:["vec3"]},{type:"node_in",name:"pM",qualifier:["vec3"]},{type:"node_out",name:"pN",qualifier:["vec3"]},{type:"textline",b:"{ float pO = clamp ( pK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float pP = UNITY_VALUE_NODES - pO ; vec3 pQ = vec3 ( pP ) ; pN = mix ( pL * ( pQ + 2.0 * pO * pM ) , lf - ( pQ + 2.0 * pO * ( lf - pM ) ) * ( lf - pL ) , step ( 0.5 , pL ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_DODGE",group:{type:"group",a:[{type:"node_in",name:"pR",qualifier:["float"]},{type:"node_in",name:"pS",qualifier:["vec3"]},{type:"node_in",name:"pT",qualifier:["vec3"]},{type:"node_out",name:"pU",qualifier:["vec3"]},{type:"textline",b:"{ float pV = clamp ( pR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 pW = lf - pV * pT ; vec3 pX = pS / ( pW + step ( pW , lg ) ) ; pU = ( lf - step ( pS , lg ) ) * mix ( mix ( lf , pX , step ( pX , lf ) ) , lf , step ( pW , lg ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_BURN",group:{type:"group",a:[{type:"node_in",name:"pY",qualifier:["float"]},{type:"node_in",name:"pZ",qualifier:["vec3"]},{type:"node_in",name:"p_",qualifier:["vec3"]},{type:"node_out",name:"qa",qualifier:["vec3"]},{type:"textline",b:"{ float qb = clamp ( pY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qc = lf - qb * ( lf - p_ ) ; vec3 qd = lf - ( lf - pZ ) / ( qc + step ( qc , lg ) ) ; qa = mix ( mix ( lg , mix ( lf , qd , step ( qd , lf ) ) , step ( ZERO_VALUE_NODES , qd ) ) , lg , step ( qc , lg ) ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_HUE",group:{type:"group",a:[{type:"node_in",name:"qe",qualifier:["float"]},{type:"node_in",name:"qf",qualifier:["vec3"]},{type:"node_in",name:"qg",qualifier:["vec3"]},{type:"node_out",name:"qh",qualifier:["vec3"]},{type:"textline",b:"{ float qi = clamp ( qe , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qj , qk , ql ; qh = qf ; qk = lu ( qg ) ; if ( qk . y != ZERO_VALUE_NODES ) { qj = lu ( qh ) ; qj . x = qk . x ; ql = ly ( qj ) ; qh = mix ( qh , ql , qi ) ; } }".split(" ")}]}},
{type:"node",name:"MIX_RGB_SATURATION",group:{type:"group",a:[{type:"node_in",name:"qm",qualifier:["float"]},{type:"node_in",name:"qn",qualifier:["vec3"]},{type:"node_in",name:"qo",qualifier:["vec3"]},{type:"node_out",name:"qp",qualifier:["vec3"]},{type:"textline",b:"{ float qq = clamp ( qm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qr = UNITY_VALUE_NODES - qq ; qp = qn ; vec3 qs , qt ; qs = lu ( qp ) ; if ( qs . y != ZERO_VALUE_NODES ) { qt = lu ( qo ) ; qs . y = qr * qs . y + qq * qt . y ; qp = ly ( qs ) ; } }".split(" ")}]}},
{type:"node",name:"MIX_RGB_VALUE",group:{type:"group",a:[{type:"node_in",name:"qu",qualifier:["float"]},{type:"node_in",name:"qv",qualifier:["vec3"]},{type:"node_in",name:"qw",qualifier:["vec3"]},{type:"node_out",name:"qx",qualifier:["vec3"]},{type:"textline",b:"{ float qy = clamp ( qu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qz = UNITY_VALUE_NODES - qy ; vec3 qA , qB ; qA = lu ( qv ) ; qB = lu ( qw ) ; qA . z = qz * qA . z + qy * qB . z ; qx = ly ( qA ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_COLOR",
group:{type:"group",a:[{type:"node_in",name:"qC",qualifier:["float"]},{type:"node_in",name:"qD",qualifier:["vec3"]},{type:"node_in",name:"qE",qualifier:["vec3"]},{type:"node_out",name:"qF",qualifier:["vec3"]},{type:"textline",b:"{ float qG = clamp ( qC , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 qH , qI , qJ ; qF = qD ; qI = lu ( qE ) ; if ( qI . y != ZERO_VALUE_NODES ) { qH = lu ( qF ) ; qH . x = qI . x ; qH . y = qI . y ; qJ = ly ( qH ) ; qF = mix ( qF , qJ , qG ) ; } }".split(" ")}]}},{type:"node",
name:"MIX_RGB_SOFT_LIGHT",group:{type:"group",a:[{type:"node_in",name:"qK",qualifier:["float"]},{type:"node_in",name:"qL",qualifier:["vec3"]},{type:"node_in",name:"qM",qualifier:["vec3"]},{type:"node_out",name:"qN",qualifier:["vec3"]},{type:"textline",b:"{ float qO = clamp ( qK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float qP = UNITY_VALUE_NODES - qO ; vec3 qQ = qM + qL - qM * qL ; qN = qL * ( vec3 ( qP ) + vec3 ( qO ) * ( ( lf - qL ) * qM + qQ ) ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",
group:{type:"group",a:[{type:"node_in",name:"qR",qualifier:["float"]},{type:"node_in",name:"qS",qualifier:["vec3"]},{type:"node_in",name:"qT",qualifier:["vec3"]},{type:"node_out",name:"qU",qualifier:["vec3"]},{type:"textline",b:"{ float qV = clamp ( qR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qU = clamp ( qS + qV * ( 2.0 * qT - lf ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; }".split(" ")}]}},{type:"node",name:"OUTPUT",group:{type:"group",a:[{type:"node_in",name:"qW",qualifier:["vec3"]},{type:"node_in",
name:"qX",qualifier:["float"]},{type:"textline",b:"mF = qW ; mK = qX ;".split(" ")}]}},{type:"node",name:"MATERIAL",group:{type:"group",a:[{type:"node_param",name:"mi",qualifier:["const","vec3"]},{type:"node_param",name:"mj",qualifier:["const","vec4"]},{type:"node_param",name:"mk",qualifier:["const","float"]},{type:"node_in",name:"qY",qualifier:["vec3"]},{type:"node_in",name:"qZ",qualifier:["float"]},{type:"node_in",name:"q_",qualifier:["vec3"]},{type:"node_in",name:"ra",qualifier:["vec3"]},{type:"node_out",
name:"rb",qualifier:["vec3"]},{type:"node_out",name:"rc",qualifier:["float"]},{type:"node_out",name:"rd",qualifier:["vec3"]},{type:"textline",b:"{ qY = clamp ( qY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; qZ = clamp ( qZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; q_ = clamp ( q_ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 re = qY ; float rf = mi [ 0 ] ; vec2 rg = vec2 ( mi [ 1 ] , mi [ 2 ] ) ; vec3 rh = mC * qY ; vec3 ri = mj [ 1 ] * q_ ; float rj = mj [ 0 ] ; vec2 rk = vec2 ( mj [ 2 ] , mj [ 3 ] ) ; float rl = fi ( re ) ; vec3 rm ; if ( mk == UNITY_VALUE_NODES ) rm = normalize ( ra ) ; else rm = mx ; float rn = 0.5 * rm . y + 0.5 ; vec3 ro = mE * u_environment_energy * ln ( rn , rm ) ; hm rp = lV ( rh , ro , re , ri , mA , rm , mz , rk , rg , rl , ZERO_VALUE_NODES , vec4 ( ZERO_VALUE_NODES ) ) ; rb = ( rf == UNITY_VALUE_NODES ) ? rp . a . rgb : lg ; rc = qZ ; rd = rm ; if ( rj == UNITY_VALUE_NODES ) { rc += rp . a . a * ri . r * mD ; rc = clamp ( rc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rb += rp . b ; mG = rp . b ; } else { mG = lg ; } mH = rm ; mJ = rl ; }".split(" ")}]}},
{type:"node",name:"MATERIAL_EXT",group:{type:"group",a:[{type:"node_param",name:"ml",qualifier:["const","vec3"]},{type:"node_param",name:"mm",qualifier:["const","vec4"]},{type:"node_param",name:"mn",qualifier:["const","float"]},{type:"node_in",name:"rq",qualifier:["vec3"]},{type:"node_in",name:"rr",qualifier:["float"]},{type:"node_in",name:"rs",qualifier:["vec3"]},{type:"node_in",name:"rt",qualifier:["vec3"]},{type:"node_in",name:"ru",qualifier:["float"]},{type:"node_in",name:"rv",qualifier:["float"]},
{type:"node_in",name:"rw",qualifier:["vec4"]},{type:"node_in",name:"rx",qualifier:["float"]},{type:"node_in",name:"ry",qualifier:["float"]},{type:"node_out",name:"rz",qualifier:["vec3"]},{type:"node_out",name:"rA",qualifier:["float"]},{type:"node_out",name:"rB",qualifier:["vec3"]},{type:"node_out",name:"rC",qualifier:["vec3"]},{type:"node_out",name:"rD",qualifier:["vec3"]},{type:"textline",b:"{ rq = clamp ( rq , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rr = clamp ( rr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; rs = clamp ( rs , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 rE = rq ; float rF = ml [ 0 ] ; vec2 rG = vec2 ( ml [ 1 ] , ml [ 2 ] ) ; vec3 rH = ru * rq ; vec3 rI = mm [ 1 ] * rs ; float rJ = mm [ 0 ] ; vec2 rK = vec2 ( mm [ 2 ] , mm [ 3 ] ) ; float rL = fi ( rE ) ; vec3 rM ; if ( mn == UNITY_VALUE_NODES ) rM = normalize ( rt ) ; else rM = mx ; float rN = 0.5 * rM . y + 0.5 ; vec3 rO = mE * u_environment_energy * ln ( rN , rM ) ; hm rP = lV ( rH , rO , rE , rI , mA , rM , mz , rK , rG , rL , rv , rw ) ; rz = ( rF == UNITY_VALUE_NODES ) ? rP . a . rgb : lg ; rA = rr ; rB = rM ; rC = rP . a . rgb ; rD = rP . b ; lH ( rz , mz , rB , rx ) ; if ( rJ == UNITY_VALUE_NODES ) { rz += rP . b ; rA += rP . a . a * rI . r * ry ; rA = clamp ( rA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mG = rP . b ; } else { mG = lg ; } mH = rM ; mJ = rL ; }".split(" ")}]}},
{type:"node",name:"RGB",group:{type:"group",a:[{type:"node_param",name:"mo",qualifier:["vec3"]},{type:"node_out",name:"rQ",qualifier:["vec3"]},{type:"textline",b:["rQ","=","mo",";"]}]}},{type:"node",name:"RGBTOBW",group:{type:"group",a:[{type:"node_in",name:"rR",qualifier:["vec3"]},{type:"node_out",name:"rS",qualifier:["float"]},{type:"textline",b:"rS = rR . r * 0.35 + rR . g * 0.45 + rR . b * 0.2 ;".split(" ")}]}},{type:"node",name:"SEPRGB",group:{type:"group",a:[{type:"node_in",name:"rT",qualifier:["vec3"]},
{type:"node_out",name:"rU",qualifier:["float"]},{type:"node_out",name:"rV",qualifier:["float"]},{type:"node_out",name:"rW",qualifier:["float"]},{type:"textline",b:"rU = rT . r ; rV = rT . g ; rW = rT . b ;".split(" ")}]}},{type:"node",name:"SEPHSV",group:{type:"group",a:[{type:"node_in",name:"rX",qualifier:["vec3"]},{type:"node_out",name:"rY",qualifier:["float"]},{type:"node_out",name:"rZ",qualifier:["float"]},{type:"node_out",name:"r_",qualifier:["float"]},{type:"textline",b:"{ vec3 sa = lu ( rX ) ; rY = sa . r ; rZ = sa . g ; r_ = sa . b ; }".split(" ")}]}},
{type:"node",name:"SQUEEZE",group:{type:"group",a:[{type:"node_in",name:"sb",qualifier:["float"]},{type:"node_in",name:"sc",qualifier:["float"]},{type:"node_in",name:"sd",qualifier:["float"]},{type:"node_out",name:"se",qualifier:["float"]},{type:"textline",b:"se = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( sb - sd ) * sc ) ) ) ;".split(" ")}]}},{type:"node",name:"SRGB_TO_LINEAR",group:{type:"group",a:[{type:"node_in",name:"sf",qualifier:["vec3"]},{type:"node_out",name:"sg",
qualifier:["vec3"]},{type:"textline",b:"sg = max ( lg , sf ) ; sg = pow ( sg , vec3 ( 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"LINEAR_TO_SRGB",group:{type:"group",a:[{type:"node_in",name:"sh",qualifier:["vec3"]},{type:"node_out",name:"si",qualifier:["vec3"]},{type:"textline",b:"si = max ( lg , sh ) ; si = pow ( si , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform",
"sampler2D"]},{type:"node_in",name:"sj",qualifier:["vec3"]},{type:"node_out",name:"sk",qualifier:["vec3"]},{type:"node_out",name:"sl",qualifier:["float"]},{type:"textline",b:"{ vec4 sm = texture2D ( node_TEXTURE_COLOR_var_texture , lC ( sj ) ) ; sk = sm . xyz ; go ( sk ) ; sl = sm . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sn",qualifier:["vec3"]},
{type:"node_out",name:"so",qualifier:["vec3"]},{type:"node_out",name:"sp",qualifier:["float"]},{type:"textline",b:"{ vec4 sq = texture2D ( node_TEXTURE_NORMAL_var_texture , lC ( sn ) ) ; mI = sq . xyz - 0.5 ; so = normalize ( mw * mI ) ; sp = sq . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_ENVIRONMENT",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]},{type:"node_in",name:"sr",qualifier:["vec3"]},{type:"node_out",name:"ss",
qualifier:["vec3"]},{type:"node_out",name:"st",qualifier:["float"]},{type:"textline",b:"{ vec4 su = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , sr ) ; ss = su . xyz ; go ( ss ) ; st = su . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR2",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR2_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sv",qualifier:["vec3"]},{type:"node_in",name:"sw",qualifier:["vec3"]},{type:"node_out",name:"sx",qualifier:["vec3"]},
{type:"node_out",name:"sy",qualifier:["float"]},{type:"node_out",name:"sz",qualifier:["vec3"]},{type:"node_out",name:"sA",qualifier:["float"]},{type:"textline",b:"{ vec4 sB = texture2D ( node_TEXTURE_COLOR2_var_texture , lC ( sv ) ) ; sx = sB . xyz ; go ( sx ) ; sy = sB . w ; sB = texture2D ( node_TEXTURE_COLOR2_var_texture , lC ( sw ) ) ; sz = sB . xyz ; go ( sz ) ; sA = sB . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL2",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL2_var_texture",
qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sC",qualifier:["vec3"]},{type:"node_in",name:"sD",qualifier:["vec3"]},{type:"node_out",name:"sE",qualifier:["vec3"]},{type:"node_out",name:"sF",qualifier:["float"]},{type:"node_out",name:"sG",qualifier:["vec3"]},{type:"node_out",name:"sH",qualifier:["float"]},{type:"textline",b:"{ vec4 sI = texture2D ( node_TEXTURE_NORMAL2_var_texture , lC ( sC ) ) ; mI = sI . xyz - 0.5 ; sE = normalize ( mw * mI ) ; sF = sI . w ; sI = texture2D ( node_TEXTURE_NORMAL2_var_texture , lC ( sD ) ) ; mI = sI . xyz - 0.5 ; sG = normalize ( mw * mI ) ; sH = sI . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_COLOR3",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sJ",qualifier:["vec3"]},{type:"node_in",name:"sK",qualifier:["vec3"]},{type:"node_in",name:"sL",qualifier:["vec3"]},{type:"node_out",name:"sM",qualifier:["vec3"]},{type:"node_out",name:"sN",qualifier:["float"]},{type:"node_out",name:"sO",qualifier:["vec3"]},{type:"node_out",name:"sP",qualifier:["float"]},{type:"node_out",name:"sQ",
qualifier:["vec3"]},{type:"node_out",name:"sR",qualifier:["float"]},{type:"textline",b:"{ vec4 sS = texture2D ( node_TEXTURE_COLOR3_var_texture , lC ( sJ ) ) ; sM = sS . xyz ; go ( sM ) ; sN = sS . w ; sS = texture2D ( node_TEXTURE_COLOR3_var_texture , lC ( sK ) ) ; sO = sS . xyz ; go ( sO ) ; sP = sS . w ; sS = texture2D ( node_TEXTURE_COLOR3_var_texture , lC ( sL ) ) ; sQ = sS . xyz ; go ( sQ ) ; sR = sS . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR4",group:{type:"group",a:[{type:"node_param",
name:"node_TEXTURE_COLOR4_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"sT",qualifier:["vec3"]},{type:"node_in",name:"sU",qualifier:["vec3"]},{type:"node_in",name:"sV",qualifier:["vec3"]},{type:"node_in",name:"sW",qualifier:["vec3"]},{type:"node_out",name:"sX",qualifier:["vec3"]},{type:"node_out",name:"sY",qualifier:["float"]},{type:"node_out",name:"sZ",qualifier:["vec3"]},{type:"node_out",name:"s_",qualifier:["float"]},{type:"node_out",name:"ta",qualifier:["vec3"]},{type:"node_out",
name:"tb",qualifier:["float"]},{type:"node_out",name:"tc",qualifier:["vec3"]},{type:"node_out",name:"td",qualifier:["float"]},{type:"textline",b:"{ vec4 te = texture2D ( node_TEXTURE_COLOR4_var_texture , lC ( sT ) ) ; sX = te . xyz ; go ( sX ) ; sY = te . w ; te = texture2D ( node_TEXTURE_COLOR4_var_texture , lC ( sU ) ) ; sZ = te . xyz ; go ( sZ ) ; s_ = te . w ; te = texture2D ( node_TEXTURE_COLOR4_var_texture , lC ( sV ) ) ; ta = te . xyz ; go ( ta ) ; tb = te . w ; te = texture2D ( node_TEXTURE_COLOR4_var_texture , lC ( sW ) ) ; tc = te . xyz ; go ( tc ) ; td = te . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_NORMAL3",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"tf",qualifier:["vec3"]},{type:"node_in",name:"tg",qualifier:["vec3"]},{type:"node_in",name:"th",qualifier:["vec3"]},{type:"node_out",name:"ti",qualifier:["vec3"]},{type:"node_out",name:"tj",qualifier:["float"]},{type:"node_out",name:"tk",qualifier:["vec3"]},{type:"node_out",name:"tl",qualifier:["float"]},{type:"node_out",name:"tm",
qualifier:["vec3"]},{type:"node_out",name:"tn",qualifier:["float"]},{type:"textline",b:"{ vec4 to = texture2D ( node_TEXTURE_NORMAL3_var_texture , lC ( tf ) ) ; mI = to . xyz - 0.5 ; ti = normalize ( mw * mI ) ; tj = to . w ; to = texture2D ( node_TEXTURE_NORMAL3_var_texture , lC ( tg ) ) ; mI = to . xyz - 0.5 ; tk = normalize ( mw * mI ) ; tl = to . w ; to = texture2D ( node_TEXTURE_NORMAL3_var_texture , lC ( th ) ) ; mI = to . xyz - 0.5 ; tm = normalize ( mw * mI ) ; tn = to . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_NORMAL4",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL4_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"tp",qualifier:["vec3"]},{type:"node_in",name:"tq",qualifier:["vec3"]},{type:"node_in",name:"tr",qualifier:["vec3"]},{type:"node_in",name:"ts",qualifier:["vec3"]},{type:"node_out",name:"tt",qualifier:["vec3"]},{type:"node_out",name:"tu",qualifier:["float"]},{type:"node_out",name:"tv",qualifier:["vec3"]},{type:"node_out",name:"tw",
qualifier:["float"]},{type:"node_out",name:"tx",qualifier:["vec3"]},{type:"node_out",name:"ty",qualifier:["float"]},{type:"node_out",name:"tz",qualifier:["vec3"]},{type:"node_out",name:"tA",qualifier:["float"]},{type:"textline",b:"{ vec4 tB = texture2D ( node_TEXTURE_NORMAL4_var_texture , lC ( tp ) ) ; mI = tB . xyz - 0.5 ; tt = normalize ( mw * mI ) ; tu = tB . w ; tB = texture2D ( node_TEXTURE_NORMAL4_var_texture , lC ( tq ) ) ; mI = tB . xyz - 0.5 ; tv = normalize ( mw * mI ) ; tw = tB . w ; tB = texture2D ( node_TEXTURE_NORMAL4_var_texture , lC ( tr ) ) ; mI = tB . xyz - 0.5 ; tx = normalize ( mw * mI ) ; ty = tB . w ; tB = texture2D ( node_TEXTURE_NORMAL4_var_texture , lC ( ts ) ) ; mI = tB . xyz - 0.5 ; tz = normalize ( mw * mI ) ; tA = tB . w ; }".split(" ")}]}},
{type:"node",name:"VALUE",group:{type:"group",a:[{type:"node_param",name:"mp",qualifier:["const","float"]},{type:"node_out",name:"tC",qualifier:["float"]},{type:"textline",b:["tC","=","mp",";"]}]}},{type:"node",name:"ANIM_VALUE",group:{type:"group",a:[{type:"node_param",name:"mq",qualifier:["const","int"]},{type:"node_out",name:"tD",qualifier:["float"]},{type:"textline",b:"tD = u_anim_values [ mq ] ;".split(" ")}]}},{type:"node",name:"VECT_MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"tE",
qualifier:["vec3"]},{type:"node_in",name:"tF",qualifier:["vec3"]},{type:"node_out",name:"tG",qualifier:["vec3"]},{type:"node_out",name:"tH",qualifier:["float"]},{type:"textline",b:"tG = tE + tF ; tH = ( abs ( tG [ 0 ] ) + abs ( tG [ 1 ] ) + abs ( tG [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"tI",qualifier:["vec3"]},{type:"node_in",name:"tJ",qualifier:["vec3"]},{type:"node_out",name:"tK",qualifier:["vec3"]},{type:"node_out",
name:"tL",qualifier:["float"]},{type:"textline",b:"tK = tI - tJ ; tL = ( abs ( tK [ 0 ] ) + abs ( tK [ 1 ] ) + abs ( tK [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_AVERAGE",group:{type:"group",a:[{type:"node_in",name:"tM",qualifier:["vec3"]},{type:"node_in",name:"tN",qualifier:["vec3"]},{type:"node_out",name:"tO",qualifier:["vec3"]},{type:"node_out",name:"tP",qualifier:["float"]},{type:"textline",b:"tO = tM + tN ; tP = length ( tO ) ; tO = normalize ( tO ) ;".split(" ")}]}},{type:"node",
name:"VECT_MATH_DOT_PRODUCT",group:{type:"group",a:[{type:"node_in",name:"tQ",qualifier:["vec3"]},{type:"node_in",name:"tR",qualifier:["vec3"]},{type:"node_out",name:"tS",qualifier:["vec3"]},{type:"node_out",name:"tT",qualifier:["float"]},{type:"textline",b:"tS = lg ; tT = dot ( tQ , tR ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",group:{type:"group",a:[{type:"node_in",name:"tU",qualifier:["vec3"]},{type:"node_in",name:"tV",qualifier:["vec3"]},{type:"node_out",name:"tW",qualifier:["vec3"]},
{type:"node_out",name:"tX",qualifier:["float"]},{type:"textline",b:"tW = cross ( tU , tV ) ; tX = length ( tW ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_NORMALIZE",group:{type:"group",a:[{type:"node_in",name:"tY",qualifier:["vec3"]},{type:"node_in",name:"tZ",qualifier:["vec3"]},{type:"node_out",name:"t_",qualifier:["vec3"]},{type:"node_out",name:"ua",qualifier:["float"]},{type:"textline",b:"t_ = normalize ( tY ) ; ua = length ( tY ) ; tZ ;".split(" ")}]}},{type:"node",name:"REFLECT",group:{type:"group",
a:[{type:"node_in",name:"ub",qualifier:["vec3"]},{type:"node_in",name:"uc",qualifier:["vec3"]},{type:"node_out",name:"ud",qualifier:["vec3"]},{type:"textline",b:"ud = reflect ( - ub , uc ) ;".split(" ")}]}},{type:"node",name:"PARALLAX",group:{type:"group",a:[{type:"node_param",name:"node_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"ue",qualifier:["vec3"]},{type:"node_in",name:"uf",qualifier:["float"]},{type:"node_in",name:"ug",qualifier:["const","float"]},{type:"node_in",
name:"uh",qualifier:["const","float"]},{type:"node_out",name:"ui",qualifier:["vec3"]},{type:"textline",b:"{ float uj = length ( mB ) ; if ( uj < uh ) { vec2 uk = lC ( ue ) ; float ul = clamp ( 0.5 * ( uh - uj ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float um = uf * ul ; vec3 un = normalize ( mz * mw ) ; float uo = UNITY_VALUE_NODES / ug ; vec2 up = un . xy * um / ( ug * un . z ) ; float uq = UNITY_VALUE_NODES ; float ur = texture2D ( node_PARALLAX_var_texture , uk ) . a ; for ( float us = 1.0 ; us <= ug ; us ++ ) { if ( ur < uq ) { uq -= uo ; uk -= up ; ur = texture2D ( node_PARALLAX_var_texture , uk ) . a ; } } vec2 ut = uk + up ; float uu = texture2D ( node_PARALLAX_var_texture , ut ) . a - ( uq + uo ) ; float uv = ur - uq ; float uw = uv / ( uv - uu ) ; uk = uw * ut + ( UNITY_VALUE_NODES - uw ) * uk ; ui = lA ( uk ) ; } else ui = ue ; }".split(" ")}]}},
{type:"node",name:"CLAMP",group:{type:"group",a:[{type:"node_in",name:"ux",qualifier:["vec3"]},{type:"node_out",name:"uy",qualifier:["vec3"]},{type:"textline",b:"uy = clamp ( ux , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}},{type:"node",name:"REFRACTION",group:{type:"group",a:[{type:"node_in",name:"uz",qualifier:["vec3"]},{type:"node_in",name:"uA",qualifier:["float"]},{type:"node_out",name:"uB",qualifier:["vec3"]},{type:"textline",b:"uB = lk ( uz , uA ) ;".split(" ")}]}},{type:"node",
name:"TRANSLUCENCY",group:{type:"group",a:[{type:"node_in",name:"uC",qualifier:["float"]},{type:"node_in",name:"uD",qualifier:["float"]},{type:"node_in",name:"uE",qualifier:["float"]},{type:"node_in",name:"uF",qualifier:["float"]},{type:"node_in",name:"uG",qualifier:["float"]},{type:"node_out",name:"uH",qualifier:["float"]},{type:"node_out",name:"uI",qualifier:["vec4"]},{type:"textline",b:"uH = uC ; uI = vec4 ( uD , uE , uF , uG ) ;".split(" ")}]}},{type:"node",name:"TIME",group:{type:"group",a:[{type:"node_out",
name:"uJ",qualifier:["float"]},{type:"textline",b:["uJ","=","u_time",";"]}]}},{type:"node",name:"SMOOTHSTEP",group:{type:"group",a:[{type:"node_in",name:"uK",qualifier:["float"]},{type:"node_in",name:"uL",qualifier:["float"]},{type:"node_in",name:"uM",qualifier:["float"]},{type:"node_out",name:"uN",qualifier:["float"]},{type:"textline",b:"uN = smoothstep ( uL , uM , uK ) ;".split(" ")}]}},{type:"nodes_global"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS || ! DISABLE_FOG || ( CAUSTICS && WATER_EFFECTS )".split(" "),
group:{type:"group",a:[{type:"textline",b:["vec3","mr","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float ms = kq . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3","mt","=","kr",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",
a:[{type:"textline",b:"if ( gl_FrontFacing ) mt = mt ; else mt = - mt ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mu = cross ( mt , ks . xyz ) * ks . w ; mat3 mv = mat3 ( ks . xyz , mu , mt ) ; mat3 mw = mv ;".split(" ")}]}}]},{type:"textline",b:"vec3 mx = normalize ( mt ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 my = u_camera_eye_frag - kq ; vec3 mz = normalize ( my ) ; vec3 mA = kq ; vec4 mB = cE ; float mC = u_emit ; float mD = u_specular_alpha ; float mE = u_ambient ; vec3 mF ; vec3 mG ; vec3 mH ; vec3 mI ; float mJ ; float mK ;".split(" ")},
{type:"nodes_main"},{type:"textline",b:"vec3 uO = mF ; float uP = mK ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"uO = max ( uO - sqrt ( 0.01 * - min ( ms , ZERO_VALUE_NODES ) ) , 0.5 * uO ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"ko ( uO , ms , u_time , mJ , mH , u_sun_direction , mr , u_sun_quaternion , kq , length ( cE ) ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"! DISABLE_FOG && ( ! PROCEDURAL_FOG || WATER_EFFECTS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float uQ = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 uR = gI ( u_cube_fog , mz ) ; vec4 uS = vec4 ( uR , u_fog_color_density . a ) ; go ( uS . rgb ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 uS = u_fog_color_density ; uS . rgb *= uQ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"ha ( uO , length ( cE ) , mz , u_cam_water_depth , u_underwater_fog_color_density , uS , ms , uQ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gB ( uO , length ( cE ) , uS ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],
group:{type:"group",a:[{type:"textline",b:"if ( uP < 0.5 ) discard ; uP = UNITY_VALUE_NODES ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 uT = texture2DProj ( u_shadow_mask , cD ) . rg ; float uU = uT . g ; uO = vec3 ( uU ) ;".split(" ")}]}}]},{type:"textline",b:["gq","(","uO",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",
b:"gt ( uO , uP ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( uO , uP ) ; }".split(" ")}]};a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",b:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",
";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",
b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",
";"]}]}}]},{type:"textline",b:"varying vec3 kq ; varying vec4 cE ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","kr",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ks",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cz",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cC",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","ku",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",
name:"lW",qualifier:["varying","vec2"]},{type:"textline",b:["lW","=","node_GEOMETRY_UV_var_a_uv",";"]}]}},{type:"node",name:"GEOMETRY_VC",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"ma",qualifier:["varying","vec3"]},{type:"textline",b:["ma","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",
qualifier:["attribute","float"]},{type:"node_param",name:"mb",qualifier:["varying","float"]},{type:"textline",b:["mb","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"mc",qualifier:["varying","vec2"]},{type:"textline",b:["mc","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC3",group:{type:"group",
a:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"md",qualifier:["varying","vec3"]},{type:"textline",b:["md","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]}},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec3 me = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:["vec3",
"mf","=","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mg = vec3 ( a_tangent ) ; vec3 mh = a_tangent [ 3 ] * cross ( mf , mg ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mg = vec3 ( 0.0 ) ; vec3 mh = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mf = vec3 ( 0.0 ) ; vec3 mg = vec3 ( 0.0 ) ; vec3 mh = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"me = mix ( me , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:"mf = mix ( mf , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 mi = vec3 ( a_tangent ) ; vec3 mj = a_tangent_next [ 3 ] * cross ( a_normal_next , mi ) ; mg = mix ( mg , mi , u_va_frame_factor ) ; mh = mix ( mh , mj , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bm ( me , mg , mh , mf ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","mk","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mk = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ml = ( u_model_matrix * vec4 ( mk , 1.0 ) ) . xyz ; mat4 mm = _ ( u_camera_eye , ml , u_view_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 mn = ( u_model_matrix * vec4 ( mk , 1.0 ) ) . xyz ; mm = mm * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , mn ) ;".split(" ")}]}}]},{type:"textline",b:"c mo = ag ( me - mk , mk , mg , mh , mf , mm ) ; mo . b = ml ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c mo = ag ( me , mk , mg , mh , mf , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cd ( mo . a , mo . b , mf ) ;".split(" ")}]}}]},{type:"textline",b:"kq = mo . a ;".split(" ")},{type:"condition",a:[{type:"if",c:"USE_NODE_MATERIAL || USE_NODE_MATERIAL_EXT || USE_NODE_GEOMETRY_NO || CAUSTICS".split(" "),group:{type:"group",a:[{type:"textline",b:"kr = mo . e ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"float mp = ( dot ( cross ( mo . e , mo . c ) , mo . d ) < 0.0 ) ? - 1.0 : 1.0 ; ks = vec4 ( mo . c , mp ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"cE = u_view_matrix * vec4 ( mo . a , 1.0 ) ; vec4 mq = u_proj_matrix * cE ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"mq . xy += u_subpixel_jitter * mq . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["gh","(","mq",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"gh ( mo . a ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || ( USE_NODE_REFRACTION && REFRACTIVE )".split(" "),group:{type:"group",a:[{type:"textline",b:"float mr = mq . x ; float ms = mq . y ; float mt = mq . w ; cD . x = ( mr + mt ) / 2.0 ; cD . y = ( ms + mt ) / 2.0 ; cD . z = mt ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"ku = - cE . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},
{type:"textline",b:["gl_Position","=","mq",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float me ; varying vec3 kt ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cE",";"]}]}}]},{type:"textline",b:"void main ( ) { float mf = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; float mg = smoothstep ( u_p_alpha_start , u_p_alpha_end , mf ) ; float mh = u_diffuse_color . a * me * ( 1.0 - clamp ( mg , 0.0 , 1.0 ) ) ; vec3 mi = kt * u_diffuse_color . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],
group:{type:"group",a:[{type:"textline",b:"gB ( mi , length ( cE ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["gq","(","mi",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gt ( mi , mh ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( mi , mh ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},
{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ; varying float me ; varying vec3 kt ; varying vec3 cE ;".split(" ")},{type:"include",file:"particles.glslv"},
{type:"textline",b:"void main ( ) { mf mX ; mX = mW ( ) ; vec4 mY = u_view_matrix * vec4 ( mX . b , 1.0 ) ; gl_Position = u_proj_matrix * mY ; me = mX . c ; kt = mX . d ; cE = mY . xyz ; float mZ = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = mX . a * mZ ; }".split(" ")}]};a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},
{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float me ; varying vec3 kt ; varying vec2 a ; varying vec3 kp ; varying vec3 kq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 lf = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"vec4 lg = texture2D ( u_sampler , a ) ; go ( lg . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"lf . rgb = mix ( lf . rgb , lg . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"lf . rgb *= mix ( vec3 ( 1.0 ) , lg . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"lf . a = lg . a ;".split(" ")}]}}]},{type:"textline",b:"lf . rgb *= kt ; vec3 lh = u_diffuse_intensity * lf . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"vec3 li = u_emit * lf . rgb ; vec3 lj = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 lk = u_environment_energy * textureCube ( u_sky_texture , lj ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ll = 0.5 ; vec3 lk = u_environment_energy * mix ( u_horizon_color , u_zenith_color , ll ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lm = u_ambient * lk ; float ln = u_specular_params [ 0 ] ; vec2 lo = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 lp = ln * u_specular_color ; vec3 lq = normalize ( kp ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hm lr = jJ ( li , lm , lh , lp , kq , lj , lq , lo , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hm lr = jO ( li , lm , lh ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 ls = lr . a . rgb ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:["vec3","ls","=","lh",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"gB ( ls , length ( cE ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"float lt = lf . a * me ; gq ( ls ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"gt ( ls , lt ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( ls , lt ) ; }".split(" ")}]};
a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ; varying float me ; varying vec3 kt ; varying vec2 a ; varying vec3 kp ; varying vec3 kq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cE",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float lh ( vec2 lf , vec2 lg ) { return ( atan ( lg . y , lg . x ) - atan ( lf . y , lf . x ) ) ; } void main ( ) { mf li ; li = mW ( ) ; float lj ; mat4 lk ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { lj = li . e ; lk = y ( li . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { lj = li . e ; lk = j ( ) ; lk [ 3 ] = vec4 ( li . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { lj = li . e ; lk = n ( radians ( 90.0 ) ) ; lk [ 3 ] = vec4 ( li . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { lj = lh ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + li . e ; lk = l ( radians ( - 90.0 ) ) ; lk [ 3 ] = vec4 ( li . b , 1.0 ) ; } vec4 ll = vec4 ( a_p_bb_vertex * 2.0 * li . a * u_p_size , 0.0 , 1.0 ) ; vec4 lm = lk * p ( lj ) * ll ; vec4 ln = u_view_matrix * lm ; vec4 lo = u_proj_matrix * ln ; gl_Position = lo ; me = li . c ; kt = li . d ; a = a_p_bb_vertex + 0.5 ; kq = lm . xyz ; kp = u_camera_eye - lm . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cE","=","ln",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 mX ; const float mY = 0.99 ; const float mZ = 1.8 ; const int m_ = 8 ; float nj ( vec3 na , vec3 nb ) { float nc = dot ( nb , nb ) ; float nd = 2.0 * dot ( nb , na ) ; float ne = dot ( na , na ) - 1.0 ; float nf = nd * nd - 4.0 * nc * ne ; float ng = sqrt ( nf ) ; float nh = ( - nd - ng ) / 2.0 ; float ni = ne / nh ; return ni ; } float nq ( float nk , float nl ) { float nm = 3.0 * ( 1.0 - nl * nl ) ; float nn = 2.0 * ( 2.0 + nl * nl ) ; float no = 1.0 + nk * nk ; float np = pow ( 1.0 + nl * nl - 2.0 * nl * nk , 1.5 ) ; np = max ( np , 0.00001 ) ; return ( nm / nn ) * ( no / np ) ; } float ny ( vec3 nr , vec3 ns , float nt ) { float nu = dot ( ns , - nr ) ; if ( nu < 0.0 ) { return 1.0 ; } vec3 nv = nr + nu * ns ; if ( length ( nv ) < nt ) { return 0.0 ; } else if ( length ( nv ) >= nt ) { vec3 nw = normalize ( nv ) * nt - nr ; float nx = acos ( dot ( normalize ( nw ) , ns ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( nx * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 nC ( float nz , vec3 nA , float nB ) { return nA - nA * pow ( u_sky_color , vec3 ( nB / nz ) ) ; } void main ( ) { vec3 nD = normalize ( mX ) ; vec3 nE = u_sun_direction ; float nF = dot ( nD , nE ) ; float nG = nq ( nF , - 0.01 ) * u_rayleigh_brightness * nE . y ; float nH = nq ( nF - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - nE . y ) ; float nI = smoothstep ( 0.0 , 100.0 , nq ( nF , 0.9995 ) ) * u_spot_brightness ; vec3 nJ = vec3 ( 0.0 , mY , 0.0 ) ; float nK = nj ( nJ , nD ) ; float nL = nK / float ( m_ ) ; float nM = ny ( nJ , nD , mY - 0.3 ) ; vec3 nN = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 nO = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int nP = 0 ; nP < m_ ; nP ++ ) { float nQ = nL * float ( nP ) ; vec3 nR = nJ + nD * nQ ; float nS = ny ( nR , nE , mY - 0.2 ) ; float nT = nj ( nR , nE ) ; vec3 nU = nC ( nT , vec3 ( mZ ) , u_scatter_strength ) * nS ; nN += nC ( sqrt ( nQ ) , u_sky_color * nU , u_rayleigh_strength ) ; nO += nC ( nQ , nU , u_mie_strength ) ; } nN = nN * nM * pow ( nK , u_rayleigh_collection_power ) / float ( m_ ) ; nO = ( nO * nM * pow ( nK , u_mie_collection_power ) ) / float ( m_ ) ; vec3 nV = vec3 ( nI * nO + nH * nO + nG * nN ) ; gq ( nV ) ; gl_FragColor = vec4 ( nV , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 mX ; void main ( ) { vec4 lf = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 lg = u_cube_view_matrix * lf ; mX = lg . xyz ; gl_Position = lf ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_sampler , a ) ; gq ( lf . rgb ) ; gt ( lf . rgb , lf . a ) ; gl_FragColor = lf ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { a = a_texcoord ; vec3 lf = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 lg = u_proj_matrix * u_view_matrix * vec4 ( lf , 0.0 ) ; lg . x /= lg . w ; lg . y /= lg . w ; lg += 99999.0 * step ( lg . z , 0.0 ) ; lg += 100.0 * ( step ( 1.0 , abs ( lg . x ) ) + step ( 1.0 , abs ( lg . y ) ) ) ; lg . x = - a_lf_dist * lg . x ; lg . y = - a_lf_dist * lg . y ; float lh = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 li = vec2 ( a_lf_bb_vertex . x / lh , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float lj = 1.9 ; li *= ( 1.0 + lj * length ( lg . xy ) ) ; } gl_Position = vec4 ( lg . xy + li , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:["uniform","samplerCube","u_sky",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 mX ; void main ( ) { vec3 lf = textureCube ( u_sky , mX ) . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"go ( lf . rgb ) ; float lg = u_camera_eye_frag . y - WATER_LEVEL ; lg = min ( - lg * 0.03 , 0.8 ) ; float lh = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; vec3 li = normalize ( mX ) ; vec3 lj = vec3 ( 0.0 ) ; vec4 lk = u_underwater_fog_color_density ; lk . rgb = mix ( lk . rgb , lj , min ( - li . y + lg , 1.0 ) ) * lh ; float ll = clamp ( sign ( li . y - 0.05 * lg ) , 0.0 , 1.0 ) ; lf = mix ( lk . rgb , lf , ll ) ; gq ( lf . rgb ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( lf , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 mX ; void main ( ) { vec4 lf = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 lg = u_sky_vp_inverse * lf ; mX = lg . xyz ; gl_Position = lf ; }".split(" ")}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",
name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0005"]},{type:"textline",b:"uniform float u_time ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap0_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap1_uv_velocity ; uniform vec2 u_normalmap1_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap2_uv_velocity ; uniform vec2 u_normalmap2_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap3_uv_velocity ; uniform vec2 u_normalmap3_scale ;".split(" ")}]}}]}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",
b:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],
group:{type:"group",a:[{type:"textline",b:"const float lf = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 kp ; varying vec3 kq ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","kr",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],
group:{type:"group",a:[{type:"textline",b:"varying vec3 ks ; varying vec3 mY ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mZ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","m_",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","ku",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","na",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","&&","SHORE_SMOOTHING"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 np ( in vec2 nb , in vec3 nc , in vec3 nd , in vec3 ne , out float nf ) { vec3 ng = reflect ( - nd , nc ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nh = nb . xy + nc . xz * REFL_BUMP / ku ; nf = u_reflect_factor ; vec3 ni ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"ni = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ni = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",
b:"float nj = dot ( nd , nc ) ; nf *= max ( 1.0 - 1.0 / nj , 1.0 ) ; } else { ni = texture2D ( u_reflectmap , nh ) . rgb ; go ( ni ) ; }".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"nf = u_mirror_factor ; vec3 ni = ne * textureCube ( u_mirrormap , ng ) . rgb ; go ( ni ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nf = u_reflect_factor ; vec3 ni = ne * vec3 ( 0.3 , 0.5 , 1.0 ) ; go ( ni ) ;".split(" ")}]}}]},{type:"textline",
b:"vec3 nk = normalize ( ng + nd ) ; float nl = 1.0 - dot ( nd , nk ) ; float nm = u_fresnel_params [ 3 ] ; float nn = u_fresnel_params [ 2 ] ; float no = nm + ( 1.0 - nm ) * pow ( nl , nn ) ; nf = min ( nf * no , 1.0 ) ; return ni ; } void main ( ) {".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 nq = mat3 ( ks , mY , kr ) ;".split(" ")}]}}]},{type:"textline",
b:"vec3 nr = normalize ( kr ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 nq = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nr = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","FOAM"],group:{type:"group",a:[{type:"textline",b:"float ns = kq . y - WATER_LEVEL ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec2 nt = vec2 ( mZ . x , - mZ . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec2 nt = vec2 ( kq . x , - kq . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","nt","=","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",
a:[{type:"textline",b:"vec3 nu = vec3 ( 0.0 ) ; vec3 nv = texture2D ( u_normalmap0 , nt * u_normalmap0_scale + u_normalmap0_uv_velocity * u_time ) . xyz - 0.5 ; nu += nv ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nw = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["nw","+=","nv",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",
a:[{type:"textline",b:"nv = texture2D ( u_normalmap0 , nt * u_normalmap1_scale + u_normalmap1_uv_velocity * u_time ) . xyz - 0.5 ; nu += nv ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["nw","+=","nv",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"nv = texture2D ( u_normalmap0 , nt * u_normalmap2_scale + u_normalmap2_uv_velocity * u_time ) . xyz - 0.5 ; nu += nv ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["nw","+=","nv",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"nv = texture2D ( u_normalmap0 , nt * u_normalmap3_scale + u_normalmap3_uv_velocity * u_time ) . xyz - 0.5 ; nu += nv ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["nw","+=","nv",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 nx = nq * nw ; if ( ! f ( nx , vec3 ( 0.0 ) ) ) nx = normalize ( nx ) ; vec3 ny = mix ( nr , nx , 0.2 ) ; ny = normalize ( ny ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",
b:"nr = mix ( nr , normalize ( nq * nu ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nr = mix ( nr , normalize ( nq * nu ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"nr = normalize ( nr ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nz = normalize ( kp ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nA = cD . xy / cD . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float nB = ku * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nC = u_diffuse_color . a ; vec4 nD = texture2DProj ( u_scene_depth , cD ) ; float nE = cp ( nD ) ; float nF = max ( nE - ku , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 nG = nA + nr . xz * u_refr_bump / ku ; float nH = kX ( nE , nG , nA ) ; float nI = max ( nH - ku , 0.0 ) ; float nJ = u_view_max_depth / ABSORB * nI ; float nK ; if ( u_cam_water_depth < 0.0 ) nK = 0.0 ; else nK = min ( nC * nJ , 1.0 ) ; float nL = u_view_max_depth / ABSORB * nF ; nC = min ( 15.0 * nC * u_view_max_depth * nF , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float nL = u_view_max_depth / ABSORB * nF ; if ( u_cam_water_depth > 0.0 ) nC = min ( nC * nL , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"nC *= min ( 5.0 * nB , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nC = u_diffuse_color . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float nK = 1.0 - nC ; vec2 nG = nA + nr . xz * REFR_BUMP / ku ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 nM = texture2D ( u_refractmap , nG ) . rgb ; go ( nM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float nN = pow ( min ( m_ . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 nO = mix ( u_shallow_water_col , u_diffuse_color . rgb , nN ) ; nN = pow ( min ( m_ . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; nO = mix ( u_shore_water_col , nO , nN ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 nO = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float nP = max ( 1.0 - u_view_max_depth * nF , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float nP = 1.0 - nC ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:"float nQ = max ( ns / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 nR = normalize ( vec3 ( m_ . r , 0.0 , m_ . g ) ) ; vec3 nS = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , nR , 0.8 ) ) ; float nT = max ( 2.5 * dot ( ny , nS ) - 0.7 , 0.0 ) ; nP += nT * ( 1.0 - m_ . b ) ; nQ *= ( 1.0 - 0.95 * pow ( m_ . b , 0.1 ) ) ;".split(" ")}]}}]},{type:"textline",b:"nP += nQ ; nP = min ( u_foam_factor * nP , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"vec4 nU = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + nt * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"float nV = u_specular_params [ 0 ] ; vec2 nW = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 nX = nV * u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 nY = u_environment_energy * textureCube ( u_sky_texture , nr ) . rgb ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"vec3 nY = u_environment_energy * u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"vec3 nZ = u_ambient * nY ; vec3 n_ = nZ + u_sun_intensity ; float oa ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 ob = np ( nA , nr , nz , n_ , oa ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ob = np ( vec2 ( 0.0 ) , nr , nz , n_ , oa ) ;".split(" ")}]}}]},{type:"textline",
b:"vec3 oc = u_diffuse_intensity * nO ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hm od = jJ ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , oc , nX , kq , nr , nz , nW , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hm od = jO ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , oc ) ;".split(" ")}]}}]},
{type:"textline",b:"oc = od . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float oe = max ( dot ( u_sun_direction , - kr ) + SSS_WIDTH , 0.0 ) * max ( dot ( - nz , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; oe = clamp ( SSS_STRENGTH * oe , 0.0 , 1.0 ) ; oc = mix ( oc , u_shallow_water_col , oe ) ; oc = mix ( oc , u_shore_water_col , oe ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:"oc = mix ( nM , oc , nK ) ;".split(" ")}]}}]},{type:"textline",b:"oc = mix ( oc , ob , oa ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"float of = mix ( nU . g , nU . r , max ( 4.0 * ( nP - 0.75 ) , 0.0 ) ) ; of = mix ( nU . b , of , max ( 2.0 * nP - 1.0 , 0.0 ) ) ; of = mix ( 0.0 , of , nP ) ; oc = mix ( oc , n_ , of ) ;".split(" ")}]}}]},{type:"textline",b:"oc += od . b ;".split(" ")},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 og = gI ( u_cube_fog , nz ) ; vec4 oh = vec4 ( og , u_fog_color_density . a ) ; go ( oh . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","oh","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { hj ( oc , nB , u_cam_water_depth , u_underwater_fog_color_density , clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ) ; } else { gB ( oc , nB , oh ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gB ( oc , nB , oh ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["gq","(","oc",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"nC = max ( nC , od . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["nC","+=","of",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gt ( oc , nC ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 oi = fwidth ( na ) ; vec3 oj = smoothstep ( vec3 ( 0.0 ) , oi * lf , na ) ; float ok = min ( min ( oj . x , oj . y ) , oj . z ) ; ok = clamp ( ok , 0.0 , 1.0 ) ; oc = mix ( u_wireframe_edge_color , oc , ok ) ; nC = mix ( 1.0 , nC , ok ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( oc , nC ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",
b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",
b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 kp ; varying vec3 kq ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","kr",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 ks ; varying vec3 mY ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","mZ",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","m_",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cD",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","ku",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","na",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"vec3 ll ( in vec2 lf ) { vec2 lg = 0.5 + vec2 ( ( lf . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( lf . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; vec4 lh = texture2D ( u_shore_dist_map , lg ) ; const vec2 li = vec2 ( 1.0 / 255.0 , 1.0 ) ; float lj = dot ( lh . ba , li ) ; vec2 lk = normalize ( lh . rg * 2.0 - 1.0 ) ; return vec3 ( lk , lj ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},
{type:"define",name:"SMALL_WAVES_FAC",b:["0.3"]},{type:"textline",b:"void lC ( inout vec3 lm , in float ln , in vec3 lo ) { float lp = dD ( DST_NOISE_SCALE_0 * ( lm . xz + DST_NOISE_FREQ_0 * ln ) ) * dD ( DST_NOISE_SCALE_1 * ( lm . zx - DST_NOISE_FREQ_1 * ln ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float lq = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float lr = lo . b ; float ls = sqrt ( lr ) ; float lt = max ( lr , DIR_MIN_SHR_FAC ) * sin ( ls / lq + DIR_FREQ * ln ) ; float lu = max ( dD ( DIR_NOISE_SCALE * ( lm . xz + DIR_NOISE_FREQ * ln ) ) , DIR_MIN_NOISE_FAC ) ; lt *= lu ; float lv = WAVES_HEIGHT * mix ( lt , lp , max ( ls , DST_MIN_FAC ) ) ; vec2 lw = lo . rg ; float lx = WAVES_HOR_FAC * lt * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - lr ) , 0.0 ) ; vec2 ly = lx * lw ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float lv = WAVES_HEIGHT * lp ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"vec2 lz = 2.0 * ( lm . xz - 0.1 * ln ) ; vec2 lA = 1.3 * ( lm . zx + 0.03 * ln ) ; float lB = cY ( 0.5 * lz ) . x + cY ( 0.5 * lA ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lm . xz += ly ; lB *= lr ;".split(" ")}]}}]},{type:"textline",
b:"lv += SMALL_WAVES_FAC * lB ;".split(" ")}]}}]},{type:"textline",b:"lm . y += lv ; }".split(" ")}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DEBUG_WIREFRAME"],group:{type:"group",a:[{type:"textline",b:"if ( a_polyindex == 0.0 ) na = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) na = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) na = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["vec3","lD","=","a_position",
";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float lE = abs ( lD . y ) ; vec2 lF = u_camera_eye . xz - mod ( u_camera_eye . xz , lE ) ; lD . y = WATER_LEVEL ; lD . xz += lF ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},{type:"textline",b:"c lG = ag ( lD , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC",
"&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"mZ = lG . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"m_ = ll ( lG . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float lH = length ( u_wind ) ; float lI = u_time ; lI *= lH ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["float",
"lJ","=","lE",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","lJ","=","0.1",";"]}]}}]},{type:"textline",b:"vec3 lK = lG . a + vec3 ( lJ , 0.0 , 0.0 ) ; vec3 lL = lG . a + vec3 ( 0.0 , 0.0 , lJ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 lM = ll ( lK . xz ) ; vec3 lN = ll ( lL . xz ) ; lC ( lK , lI , lM ) ; lC ( lL , lI , lN ) ; lC ( lG . a , lI , m_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"lC ( lK , lI , vec3 ( 0.0 ) ) ; lC ( lL , lI , vec3 ( 0.0 ) ) ; lC ( lG . a , lI , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_position . y < 0.0 ) { lG . a . y = WATER_LEVEL - 1.0 ; lK . y = lG . a . y ; lL . y = lG . a . y ; }".split(" ")}]}}]},{type:"textline",b:"vec3 lO = normalize ( lK - lG . a ) ; vec3 lP = normalize ( lL - lG . a ) ; kr = normalize ( cross ( lP , lO ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"ks = lP ; mY = cross ( kr , ks ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float lQ = dot ( kr , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lR = clamp ( 0.8 - lQ , 0.0 , 1.0 ) ; kr = mix ( kr , vec3 ( 0.0 , 1.0 , 0.0 ) , lR ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"kq = lG . a ; kp = u_camera_eye - lG . a ; vec4 lS = u_view_matrix * vec4 ( lG . a , 1.0 ) ; vec4 lT = u_proj_matrix * lS ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float lU = lT . x ; float lV = lT . y ; float nb = lT . w ; cD . x = ( lU + nb ) / 2.0 ; cD . y = ( lV + nb ) / 2.0 ; cD . z = nb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"ku = - lS . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["gl_Position","=","lT",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 na ; const float lf = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 lg = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lg = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lh = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 li = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 lj = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec3 lk = vec3 ( 0.0 ) ; float ll = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"vec3 lm = sign ( na - vec3 ( 0.02 * lf ) ) ; if ( lm . x < 0.0 || lm . y < 0.0 || lm . z < 0.0 ) { lk = lg ; ll = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lm = sign ( na - vec3 ( 0.02 * lf ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( lm . x < 0.0 || lm . y < 0.0 || lm . z < 0.0 ) lk = u_wireframe_edge_color ; else lk = lj ; ll = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( lm . x < 0.0 || lm . y < 0.0 || lm . z < 0.0 ) ll = 1.0 ; else ll = 0.0 ; lk = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( lm . x < 0.0 || lm . y < 0.0 || lm . z < 0.0 ) lk = u_wireframe_edge_color ; else if ( gl_FrontFacing ) lk = lh ; else lk = li ; ll = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 ln = fwidth ( na ) ; vec3 lo = smoothstep ( vec3 ( 0.0 ) , ln * lf , na ) ; float lp = min ( min ( lo . x , lo . y ) , lo . z ) ; lp = clamp ( lp , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { lk = vec3 ( mix ( u_wireframe_edge_color , lj , lp ) ) ; ll = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { lk = u_wireframe_edge_color ; ll = mix ( 1.0 , 0.0 , lp ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) lk = mix ( u_wireframe_edge_color , lh , lp ) ; else lk = mix ( u_wireframe_edge_color , li , lp ) ; ll = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["gq","(","lk",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"gt ( lk , ll ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lk , ll ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["BILLBOARD","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",b:["varying","vec3","na",";"]},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { if ( a_polyindex == 0.0 ) na = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) na = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) na = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 lf = a_position ; vec3 lg = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"c lh = ag ( lf , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"lf = mix ( lf , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 li = vec3 ( 0.0 ) ; vec3 lj = vec3 ( 0.0 ) ; bm ( lf , li , lj , lg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["vec3","lk","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 lk = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c lh = fY ( lf , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lk , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ll = ( u_model_matrix * vec4 ( lk , 1.0 ) ) . xyz ; mat4 lm = _ ( u_camera_eye , ll , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 ln = ( u_model_matrix * vec4 ( lk , 1.0 ) ) . xyz ; lm = lm * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , ln ) ;".split(" ")}]}}]},{type:"textline",b:"c lh = ag ( lf - lk , lk , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , lm ) ; lh . b = ll ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"c lh = ag ( lf , lk , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cd ( lh . a , lh . b , lg ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 lo = u_view_matrix * vec4 ( lh . a , 1.0 ) ; gl_Position = u_proj_matrix * lo ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_sampler_left , a ) ; vec4 lg = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( lf [ 0 ] , lg [ 1 ] , lg [ 2 ] , lf [ 3 ] + lg [ 3 ] ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",
b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 li ( float lf , float lg ) { vec2 lh = a + vec2 ( lf , lg ) * u_texel_size ; return texture2D ( u_color , lh ) ; } float lm ( vec4 lj ) { vec3 lk = vec3 ( 0.299 , 0.587 , 0.114 ) ; float ll = dot ( lj . rgb , lk ) ; return ll ; } vec4 lF ( ) { vec4 ln = li ( - 1.0 , - 1.0 ) ; vec4 lo = li ( 1.0 , - 1.0 ) ; vec4 lp = li ( - 1.0 , 1.0 ) ; vec4 lq = li ( 1.0 , 1.0 ) ; vec4 lr = li ( 0.0 , 0.0 ) ; float ls = lm ( ln ) ; float lt = lm ( lo ) ; float lu = lm ( lp ) ; float lv = lm ( lq ) ; float lw = lm ( lr ) ; float lx = min ( lw , min ( min ( ls , lt ) , min ( lu , lv ) ) ) ; float ly = max ( lw , max ( max ( ls , lt ) , max ( lu , lv ) ) ) ; vec2 lz ; lz . x = - ( ( ls + lt ) - ( lu + lv ) ) ; lz . y = ( ( ls + lu ) - ( lt + lv ) ) ; float lA = max ( ( ls + lt + lu + lv ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float lB = 1.0 / ( min ( abs ( lz . x ) , abs ( lz . y ) ) + lA ) ; lz = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , lz * lB ) ) * u_texel_size ; vec4 lC = 0.5 * ( texture2D ( u_color , a + lz * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + lz * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 lD = lC * 0.5 + 0.25 * ( texture2D ( u_color , a + lz * - 0.5 ) + texture2D ( u_color , a + lz * 0.5 ) ) ; float lE = lm ( lD ) ; if ( ( lE < lx ) || ( lE > ly ) ) return lC ; else return lD ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 ow ( ) { vec2 lG ; lG . x = a . x ; lG . y = a . y ; vec4 lH = texture2D ( u_color , lG ) ; vec4 lI = li ( 0.0 , 1.0 ) ; vec4 lJ = li ( 1.0 , 0.0 ) ; vec4 lK = li ( 0.0 , - 1.0 ) ; vec4 lL = li ( - 1.0 , 0.0 ) ; float lM = lm ( lI ) ; float lN = lm ( lJ ) ; float lO = lm ( lK ) ; float lP = lm ( lL ) ; float lQ = lm ( lH ) ; float lR = max ( lM , lQ ) ; float lS = min ( lM , lQ ) ; float lT = max ( lN , lR ) ; float lU = min ( lN , lS ) ; float lV = max ( lO , lP ) ; float nb = min ( lO , lP ) ; float nc = max ( lV , lT ) ; float nd = min ( nb , lU ) ; float ne = nc * FXAA_QUALITY_EDGE_THRESHOLD ; float nf = nc - nd ; float ng = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , ne ) ; bool nh = nf < ng ; if ( nh ) return lH ; vec4 ni = li ( - 1.0 , - 1.0 ) ; vec4 nj = li ( 1.0 , 1.0 ) ; vec4 nk = li ( 1.0 , - 1.0 ) ; vec4 nl = li ( - 1.0 , 1.0 ) ; float nm = lm ( ni ) ; float nn = lm ( nj ) ; float no = lm ( nk ) ; float np = lm ( nl ) ; float nq = lO + lM ; float nr = lP + lN ; float ns = 1.0 / nf ; float nt = nq + nr ; float nu = ( - 2.0 * lQ ) + nq ; float nv = ( - 2.0 * lQ ) + nr ; float nw = no + nn ; float nx = nm + no ; float ny = ( - 2.0 * lN ) + nw ; float nz = ( - 2.0 * lO ) + nx ; float nA = nm + np ; float nB = np + nn ; float nC = ( abs ( nu ) * 2.0 ) + abs ( ny ) ; float nD = ( abs ( nv ) * 2.0 ) + abs ( nz ) ; float nE = ( - 2.0 * lP ) + nA ; float nF = ( - 2.0 * lM ) + nB ; float nG = abs ( nE ) + nC ; float nH = abs ( nF ) + nD ; float nI = nA + nw ; float nJ = u_texel_size . x ; bool nK = nG >= nH ; float nL = nt * 2.0 + nI ; if ( ! nK ) lO = lP ; if ( ! nK ) lM = lN ; if ( nK ) nJ = u_texel_size . y ; float nM = ( nL * ( 1.0 / 12.0 ) ) - lQ ; float nN = lO - lQ ; float nO = lM - lQ ; float nP = lO + lQ ; float nQ = lM + lQ ; bool nR = abs ( nN ) >= abs ( nO ) ; float nS = max ( abs ( nN ) , abs ( nO ) ) ; if ( nR ) nJ = - nJ ; float nT = clamp ( abs ( nM ) * ns , 0.0 , 1.0 ) ; vec2 nU ; nU . x = lG . x ; nU . y = lG . y ; vec2 nV ; nV . x = ( ! nK ) ? 0.0 : u_texel_size . x ; nV . y = ( nK ) ? 0.0 : u_texel_size . y ; if ( ! nK ) nU . x += nJ * 0.5 ; if ( nK ) nU . y += nJ * 0.5 ; vec2 nW ; nW . x = nU . x - nV . x ; nW . y = nU . y - nV . y ; vec2 nX ; nX . x = nU . x + nV . x ; nX . y = nU . y + nV . y ; float nY = ( ( - 2.0 ) * nT ) + 3.0 ; float nZ = lm ( texture2D ( u_color , nW ) ) ; float n_ = nT * nT ; float oa = lm ( texture2D ( u_color , nX ) ) ; if ( ! nR ) nP = nQ ; float ob = nS * 1.0 / 4.0 ; float oc = lQ - nP * 0.5 ; float od = nY * n_ ; bool oe = oc < 0.0 ; nZ -= nP * 0.5 ; oa -= nP * 0.5 ; bool of = abs ( nZ ) >= ob ; bool og = abs ( oa ) >= ob ; if ( ! of ) nW . x -= nV . x * 1.5 ; if ( ! of ) nW . y -= nV . y * 1.5 ; bool oh = ( ! of ) || ( ! og ) ; if ( ! og ) nX . x += nV . x * 1.5 ; if ( ! og ) nX . y += nV . y * 1.5 ; if ( oh ) { if ( ! of ) nZ = lm ( texture2D ( u_color , nW . xy ) ) ; if ( ! og ) oa = lm ( texture2D ( u_color , nX . xy ) ) ; if ( ! of ) nZ = nZ - nP * 0.5 ; if ( ! og ) oa = oa - nP * 0.5 ; of = abs ( nZ ) >= ob ; og = abs ( oa ) >= ob ; if ( ! of ) nW . x -= nV . x * 2.0 ; if ( ! of ) nW . y -= nV . y * 2.0 ; oh = ( ! of ) || ( ! og ) ; if ( ! og ) nX . x += nV . x * 2.0 ; if ( ! og ) nX . y += nV . y * 2.0 ; if ( oh ) { if ( ! of ) nZ = lm ( texture2D ( u_color , nW . xy ) ) ; if ( ! og ) oa = lm ( texture2D ( u_color , nX . xy ) ) ; if ( ! of ) nZ = nZ - nP * 0.5 ; if ( ! og ) oa = oa - nP * 0.5 ; of = abs ( nZ ) >= ob ; og = abs ( oa ) >= ob ; if ( ! of ) nW . x -= nV . x * 2.0 ; if ( ! of ) nW . y -= nV . y * 2.0 ; oh = ( ! of ) || ( ! og ) ; if ( ! og ) nX . x += nV . x * 2.0 ; if ( ! og ) nX . y += nV . y * 2.0 ; if ( oh ) { if ( ! of ) nZ = lm ( texture2D ( u_color , nW . xy ) ) ; if ( ! og ) oa = lm ( texture2D ( u_color , nX . xy ) ) ; if ( ! of ) nZ = nZ - nP * 0.5 ; if ( ! og ) oa = oa - nP * 0.5 ; of = abs ( nZ ) >= ob ; og = abs ( oa ) >= ob ; if ( ! of ) nW . x -= nV . x * 4.0 ; if ( ! of ) nW . y -= nV . y * 4.0 ; oh = ( ! of ) || ( ! og ) ; if ( ! og ) nX . x += nV . x * 4.0 ; if ( ! og ) nX . y += nV . y * 4.0 ; if ( oh ) { if ( ! of ) nZ = lm ( texture2D ( u_color , nW . xy ) ) ; if ( ! og ) oa = lm ( texture2D ( u_color , nX . xy ) ) ; if ( ! of ) nZ = nZ - nP * 0.5 ; if ( ! og ) oa = oa - nP * 0.5 ; of = abs ( nZ ) >= ob ; og = abs ( oa ) >= ob ; if ( ! of ) nW . x -= nV . x * 2.0 ; if ( ! of ) nW . y -= nV . y * 2.0 ; if ( ! og ) nX . x += nV . x * 2.0 ; if ( ! og ) nX . y += nV . y * 2.0 ; } } } } float oi = lG . x - nW . x ; float oj = nX . x - lG . x ; if ( ! nK ) oi = lG . y - nW . y ; if ( ! nK ) oj = nX . y - lG . y ; bool ok = ( nZ < 0.0 ) != oe ; float ol = ( oj + oi ) ; bool om = ( oa < 0.0 ) != oe ; float on = 1.0 / ol ; bool oo = oi < oj ; float op = min ( oi , oj ) ; bool oq = oo ? ok : om ; float or = od * od ; float os = ( op * ( - on ) ) + 0.5 ; float ot = or * FXAA_QUALITY_SUBPIX ; float ou = oq ? os : 0.0 ; float ov = max ( ou , ot ) ; if ( ! nK ) lG . x += ov * nJ ; if ( nK ) lG . y += ov * nJ ; return texture2D ( u_color , lG ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = lF ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = ow ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 lf = vec2 ( 0.0 , 0.0 ) ; vec2 lg = u_texel_size ; vec4 lh = texture2D ( u_color , a ) ; gl_FragColor = lh * 0.0875447373698 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0858112354248 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0808139781061 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0731235112908 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0635705267419 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0530985673112 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0426125984122 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0328565115809 ; lf += lg ; gl_FragColor += texture2D ( u_color , a + lf ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - lf ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * lh , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_main , a ) ; vec4 lg = texture2D ( u_bloom , a ) ; vec4 lh = lf ; lh += lg ; gl_FragColor = vec4 ( lh . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",
b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_color , a ) ; vec3 lg = lf . rgb ; if ( u_brightness < 0.0 ) lg = lg * ( 1.0 + u_brightness ) ; else lg = lg + ( ( 1.0 - lg ) * u_brightness ) ; lg = ( lg - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; lg *= u_exposure ; vec3 lh = vec3 ( 0.299 , 0.587 , 0.114 ) ; float li = dot ( lg , lh ) ; lg = mix ( vec3 ( li ) , lg , u_saturation ) ; gl_FragColor = vec4 ( lg , lf . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cl ( clamp ( ni ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { vec4 nj = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { float nk = ni ( u_depth , a , u_camera_range ) ; nk *= u_view_max_depth ; float nl ; if ( nk < u_dof_dist ) nl = ( u_dof_dist - nk ) / u_dof_front ; else nl = ( nk - u_dof_dist ) / u_dof_rear ; nl = clamp ( nl , 0.0 , 1.0 ) ; vec4 nm = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( nj , nm , nl ) ; } else gl_FragColor = nj ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float lk ( float lf , float lg , float lh ) { vec2 li = a + vec2 ( lf , lg ) * u_texel_size ; vec4 lj = texture2D ( u_sampler , li ) * lh ; return cp ( lj ) ; } void main ( ) { float ll = ( lk ( - 1.0 , - 1.0 , - 1.0 ) + lk ( 0.0 , - 1.0 , - 1.0 ) + lk ( 1.0 , - 1.0 , - 1.0 ) + lk ( - 1.0 , 0.0 , - 1.0 ) + lk ( 0.0 , 0.0 , 8.0 ) + lk ( 1.0 , 0.0 , - 1.0 ) + lk ( - 1.0 , 1.0 , - 1.0 ) + lk ( 0.0 , 1.0 , - 1.0 ) + lk ( 1.0 , 1.0 , - 1.0 ) ) ; ll *= 1000.0 ; gl_FragColor = vec4 ( ll , ll , ll , 1.0 ) ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_glow_src ; uniform sampler2D u_glow_mask ; uniform sampler2D u_glow_mask_blurred ; uniform vec3 u_glow_color ; uniform float u_draw_glow ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_glow_src , a ) ; gl_FragColor = lf ; if ( u_draw_glow != 0.0 ) { vec4 lg = texture2D ( u_glow_mask , a ) ; vec4 lh = texture2D ( u_glow_mask_blurred , a ) ; float li = lh . a - lg . a ; if ( li != 0.0 ) { float lj = smoothstep ( 0.0 , 1.0 , lh . a ) ; if ( lg . a == 0.0 ) { vec3 lk = u_glow_color ; gq ( lk ) ; vec4 ll = vec4 ( clamp ( lk , 0.0 , 1.0 ) , lj ) ; gl_FragColor = mix ( lf , ll , lj ) ; } } } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float nj ; varying vec2 nk ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 nl ; void main ( ) { vec2 nm = ( nl . xy - a ) ; float nn = length ( nm ) ; vec2 no = u_radial_blur_step * nm / nn ; float np = nn / u_radial_blur_step ; no *= min ( np , STEPS_PER_PASS ) / STEPS_PER_PASS ; np = max ( np , STEPS_PER_PASS ) ; vec2 nq = a ; float nr = 0.0 ; for ( float ns = 0.0 ; ns < STEPS_PER_PASS ; ns += 1.0 ) { if ( ns <= np ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"float nt = ni ( u_input , nq , u_camera_range ) ; nr += max ( ( 1.0 - pow ( nn , 0.3 ) ) * step ( 0.9 , nt ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 nu = texture2D ( u_input , nq ) ; nr += cp ( nu ) ;".split(" ")}]}}]},{type:"textline",b:"} nq += no ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"vec2 nv = a + nk ; float nw = cY ( vec2 ( 2.5 * ( nv . x ) , 2.5 * ( nv . y ) + 1.0 * u_time ) ) . x + 0.75 * cY ( vec2 ( 5.0 * ( nv . x ) - 0.66 * u_time , 5.0 * ( nv . y ) + 0.66 * u_time ) ) . x + 0.5 * dD ( vec2 ( 7.5 * ( nv . x ) + 0.33 * u_time , 7.5 * ( nv . y ) - 0.33 * u_time ) ) ; nw *= clamp ( 1.2 - sqrt ( 0.2 * nn ) , 0.0 , 1.0 ) * nj ; nr = max ( nw , nr ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = cl ( nr / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]=
{type:"group",a:[{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform vec4 u_refl_plane ; varying float nj ; varying vec2 nk ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"varying vec2 a ; varying vec4 nl ; void lm ( in vec4 lf , in vec3 lg , out vec3 lh ) { float li = lf . w * lg . x + lf . y * lg . z - lf . z * lg . y ; float lj = lf . w * lg . y + lf . z * lg . x - lf . x * lg . z ; float lk = lf . w * lg . z + lf . x * lg . y - lf . y * lg . x ; float ll = - lf . x * lg . x - lf . y * lg . y - lf . z * lg . z ; lh . x = li * lf . w - ll * lf . x - lj * lf . z + lk * lf . y ; lh . y = lj * lf . w - ll * lf . y - lk * lf . x + li * lf . z ; lh . z = lk * lf . w - ll * lf . z - li * lf . y + lj * lf . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 ln = normalize ( u_sun_direction ) ; nl = u_proj_matrix * u_view_matrix * vec4 ( ln , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_camera_eye . y + a_bb_vertex . t < - u_refl_plane . w ) { nj = 1.0 ; vec3 lo = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 lp ; lm ( u_camera_quat , lo , lp ) ; lp = normalize ( lp ) ; float lq = dot ( lp , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lr = atan ( lp . x , lp . z ) ; nk = vec2 ( - lr , acos ( lq ) ) ; } else { nj = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"nl . x /= nl . w ; nl . y /= nl . w ; nl . x = 0.5 * ( nl . x + 1.0 ) ; nl . y = 0.5 * ( nl . y + 1.0 ) ; nl += 99999.0 * step ( nl . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_main , a ) ; vec3 lg = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; go ( lf . rgb ) ; float lh = cp ( texture2D ( u_god_rays , a ) ) ; vec3 li = lf . rgb + u_god_rays_intensity * vec3 ( lh ) * lg ; gq ( li ) ; gl_FragColor . rgb = li ; gl_FragColor . a = lf . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_color , a ) * 0.38026 ; lf += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; lf += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; lf += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; lf += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; lf += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; lf += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; lf += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; lf += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = lf ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_input , a ) ; float lg = dot ( lf . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( lg ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float lf ; float lg = 0.0 ; for ( float lh = 0.025 ; lh < 1.0 ; lh += 0.05 ) for ( float li = 0.025 ; li < 1.0 ; li += 0.05 ) { lf = max ( texture2D ( u_input , vec2 ( lh , li ) ) . r , 0.01 ) ; lg += log ( lf ) ; } float lj = exp ( lg / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( lj ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float nm ; void main ( ) { float nn = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float no = texture2D ( u_luminance , a ) . r ; vec4 np = texture2D ( u_main , a ) ; float nq = no / nn ; float nr = u_bloom_edge_lum ; gl_FragColor = np * max ( nq - nr , 0.0 ) * nm ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float nm ; const vec3 lf = vec3 ( 0.0 , 1.0 , 0.0 ) ; void ln ( in vec4 lg , in vec3 lh , out vec3 li ) { float lj = lg . w * lh . x + lg . y * lh . z - lg . z * lh . y ; float lk = lg . w * lh . y + lg . z * lh . x - lg . x * lh . z ; float ll = lg . w * lh . z + lg . x * lh . y - lg . y * lh . x ; float lm = - lg . x * lh . x - lg . y * lh . y - lg . z * lh . z ; li . x = lj * lg . w - lm * lg . x - lk * lg . z + ll * lg . y ; li . y = lk * lg . w - lm * lg . y - ll * lg . x + lj * lg . z ; li . z = ll * lg . w - lm * lg . z - lj * lg . y + lk * lg . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 lo ; ln ( u_camera_quat , lf , lo ) ; nm = dot ( - lo , u_sun_direction ) * u_bloom_key ; nm *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 lf = texture2D ( u_mb_tex_curr , a ) ; vec4 lg = texture2D ( u_mb_tex_accum , a ) ; if ( length ( lf - lg ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * lf + u_motion_blur_exp * lg ; } else { gl_FragColor = lf ; } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"vec4 lf = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( lf . r + lf . g + lf . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 lg = vec2 ( 0.0 , 0.0 ) ; vec2 lh = u_texel_size ; vec4 li ; li = texture2D ( u_color , a ) ; gl_FragColor = li * 0.2270270270 ; lg += lh ; li = texture2D ( u_color , a + lg ) ; gl_FragColor += li * 0.1945945946 ; li = texture2D ( u_color , a - lg ) ; gl_FragColor += li * 0.1945945946 ; lg += lh ; li = texture2D ( u_color , a + lg ) ; gl_FragColor += li * 0.1216216216 ; li = texture2D ( u_color , a - lg ) ; gl_FragColor += li * 0.1216216216 ; lg += lh ; li = texture2D ( u_color , a + lg ) ; gl_FragColor += li * 0.0540540541 ; li = texture2D ( u_color , a - lg ) ; gl_FragColor += li * 0.0540540541 ; lg += lh ; li = texture2D ( u_color , a + lg ) ; gl_FragColor += li * 0.0162162162 ; li = texture2D ( u_color , a - lg ) ; gl_FragColor += li * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 lh = u_texel_size ; vec4 li = texture2D ( u_color , a ) ; gl_FragColor = li ; if ( li . a == 0.0 ) { li = texture2D ( u_color , a + lh ) ; if ( li . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , li . a ) ; else { li = texture2D ( u_color , a - lh ) ; if ( li . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , li . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; varying vec2 a ; void main ( ) { a = a_bb_vertex + 0.5 ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","nn",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 no ; varying vec4 np ; varying vec4 nq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 nx ( vec2 ns , sampler2D nt ) { float nu = texture2D ( nt , ns ) . r ; float nv = texture2D ( nt , no . xy ) . r ; float nw = texture2D ( nt , no . zw ) . r ; return vec3 ( nu , nv , nw ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nD ( vec2 ny , sampler2D nz ) { vec3 nA = nx ( ny , nz ) ; vec2 nB = abs ( nA . xx - nA . yz ) ; vec2 nC = step ( SMAA_PREDICATION_THRESHOLD , nB ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * nC ) ; }".split(" ")}]}}]},{type:"textline",b:"void nH ( bvec2 nE , inout vec2 nF , vec2 nG ) { if ( nE . x ) nF . x = nG . x ; if ( nE . y ) nF . y = nG . y ; } void nH ( bvec4 nI , inout vec4 nJ , vec4 nK ) { nH ( nI . xy , nJ . xy , nK . xy ) ; nH ( nI . zw , nJ . zw , nK . zw ) ; } vec2 nM ( vec2 nL ) { return sign ( nL ) * floor ( abs ( nL ) + .5 ) ; } vec4 nM ( vec4 nN ) { return sign ( nN ) * floor ( abs ( nN ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 od ( vec2 nO , sampler2D nP".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","nQ"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 nR = nD ( nO , nQ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 nR = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 nS = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float nT = dot ( texture2D ( nP , nO ) . rgb , nS ) ; float nU = dot ( texture2D ( nP , no . xy ) . rgb , nS ) ; float nV = dot ( texture2D ( nP , no . zw ) . rgb , nS ) ; vec4 nW ; nW . xy = abs ( nT - vec2 ( nU , nV ) ) ; vec2 nX = step ( nR , nW . xy ) ; if ( dot ( nX , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float nY = dot ( texture2D ( nP , np . xy ) . rgb , nS ) ; float nZ = dot ( texture2D ( nP , np . zw ) . rgb , nS ) ; nW . zw = abs ( nT - vec2 ( nY , nZ ) ) ; vec2 n_ = max ( nW . xy , nW . zw ) ; float oa = dot ( texture2D ( nP , nq . xy ) . rgb , nS ) ; float ob = dot ( texture2D ( nP , nq . zw ) . rgb , nS ) ; nW . zw = abs ( vec2 ( nU , nV ) - vec2 ( oa , ob ) ) ; n_ = max ( n_ . xy , nW . zw ) ; float oc = max ( n_ . x , n_ . y ) ; nX . xy *= step ( oc , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * nW . xy ) ; return nX ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 of ( vec2 oe ) { oe . r = oe . r * abs ( 5.0 * oe . r - 5.0 * 0.75 ) ; return nM ( oe ) ; } vec4 of ( vec4 og ) { og . rb = og . rb * abs ( 5.0 * og . rb - 5.0 * 0.75 ) ; return nM ( og ) ; } vec2 oo ( sampler2D oh , vec2 oi , vec2 oj , out vec2 ok ) { vec4 ol = vec4 ( oi , - 1.0 , 1.0 ) ; vec3 om = vec3 ( u_texel_size , 1.0 ) ; for ( int on = 0 ; on < SMAA_MAX_SEARCH_STEPS_DIAG ; on ++ ) { if ( ol . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && ol . w > 0.9 ) { ol . xyz += om * vec3 ( oj , 1.0 ) ; ok = texture2D ( oh , ol . xy , 0.0 ) . rg ; ol . w = dot ( ok , vec2 ( 0.5 , 0.5 ) ) ; } } return ol . zw ; } vec2 ow ( sampler2D op , vec2 oq , vec2 or , out vec2 os ) { vec4 ot = vec4 ( oq , - 1.0 , 1.0 ) ; ot . x += 0.25 * u_texel_size . x ; vec3 ou = vec3 ( u_texel_size , 1.0 ) ; for ( int ov = 0 ; ov < SMAA_MAX_SEARCH_STEPS_DIAG ; ov ++ ) { if ( ot . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && ot . w > 0.9 ) { ot . xyz = ou * vec3 ( or , 1.0 ) + ot . xyz ; os = texture2D ( op , ot . xy , 0.0 ) . rg ; os = of ( os ) ; ot . w = dot ( os , vec2 ( 0.5 , 0.5 ) ) ; } } return ot . zw ; } vec2 oC ( sampler2D ox , vec2 oy , vec2 oz , float oA ) { vec2 oB = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * oz + oy ; oB = SMAA_AREATEX_PIXEL_SIZE * oB + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; oB . x += 0.5 ; oB . y += SMAA_AREATEX_SUBTEX_SIZE * oA ; return texture2D ( ox , oB , 0.0 ) . rg ; } vec2 oR ( sampler2D oD , sampler2D oE , vec2 oF , vec2 oG , vec4 oH ) { vec2 oI = vec2 ( 0.0 , 0.0 ) ; vec4 oJ ; vec2 oK ; if ( oG . r > 0.0 ) { oJ . xz = oo ( oD , oF , vec2 ( - 1.0 , 1.0 ) , oK ) ; oJ . x += float ( oK . y > 0.9 ) ; } else oJ . xz = vec2 ( 0.0 , 0.0 ) ; oJ . yw = oo ( oD , oF , vec2 ( 1.0 , - 1.0 ) , oK ) ; if ( oJ . x + oJ . y > 2.0 ) { vec4 oL = vec4 ( - oJ . x + 0.25 , oJ . x , oJ . y , - oJ . y - 0.25 ) * u_texel_size . xyxy + oF . xyxy ; vec4 oM ; oM . xy = texture2D ( oD , oL . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; oM . zw = texture2D ( oD , oL . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; oM . yxwz = of ( oM . xyzw ) ; vec2 oN = vec2 ( 2.0 , 2.0 ) * oM . xz + oM . yw ; nH ( bvec2 ( step ( 0.9 , oJ . zw ) ) , oN , vec2 ( 0.0 , 0.0 ) ) ; oI += oC ( oE , oJ . xy , oN , oH . z ) ; } oJ . xz = ow ( oD , oF , vec2 ( - 1 , - 1 ) , oK ) ; if ( texture2D ( oD , oF + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { oJ . yw = ow ( oD , oF , vec2 ( 1 , 1 ) , oK ) ; oJ . y += float ( oK . y > 0.9 ) ; } else oJ . yw = vec2 ( 0.0 , 0.0 ) ; if ( oJ . x + oJ . y > 2.0 ) { vec4 oO = vec4 ( - oJ . x , - oJ . x , oJ . y , oJ . y ) * u_texel_size . xyxy + oF . xyxy ; vec4 oP ; oP . x = texture2D ( oD , oO . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; oP . y = texture2D ( oD , oO . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; oP . zw = texture2D ( oD , oO . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 oQ = vec2 ( 2.0 , 2.0 ) * oP . xz + oP . yw ; nH ( bvec2 ( step ( 0.9 , oJ . zw ) ) , oQ , vec2 ( 0 , 0 ) ) ; oI += oC ( oE , oJ . xy , oQ , oH . w ) . gr ; } return oI ; }".split(" ")}]}}]},
{type:"textline",b:"float oX ( sampler2D oS , vec2 oT , float oU ) { vec2 oV = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 oW = SMAA_SEARCHTEX_SIZE * vec2 ( oU , 1.0 ) ; oV += vec2 ( - 1.0 , 1.0 ) ; oW += vec2 ( 0.5 , - 0.5 ) ; oV *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; oW *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( oS , oV * oT + oW , 0.0 ) . r ; } float pe ( sampler2D oY , sampler2D oZ , vec2 o_ , float pa ) { vec2 pb = vec2 ( 0.0 , 1.0 ) ; for ( int pc = 0 ; pc < SMAA_MAX_SEARCH_STEPS ; pc ++ ) { if ( o_ . x > pa && pb . g > 0.8281 && pb . r == 0.0 ) { pb = texture2D ( oY , o_ , 0.0 ) . rg ; o_ = - vec2 ( 2.0 , 0.0 ) * u_texel_size + o_ ; } } float pd = - ( 255.0 / 127.0 ) * oX ( oZ , pb , 0.0 ) + 3.25 ; return u_texel_size . x * pd + o_ . x ; } float pm ( sampler2D pf , sampler2D pg , vec2 ph , float pi ) { vec2 pj = vec2 ( 0.0 , 1.0 ) ; for ( int pk = 0 ; pk < SMAA_MAX_SEARCH_STEPS ; pk ++ ) { if ( ph . x < pi && pj . g > 0.8281 && pj . r == 0.0 ) { pj = texture2D ( pf , ph , 0.0 ) . rg ; ph = vec2 ( 2.0 , 0.0 ) * u_texel_size + ph ; } } float pl = - ( 255.0 / 127.0 ) * oX ( pg , pj , 0.5 ) + 3.25 ; return - u_texel_size . x * pl + ph . x ; } float pu ( sampler2D pn , sampler2D po , vec2 pp , float pq ) { vec2 pr = vec2 ( 1.0 , 0.0 ) ; for ( int ps = 0 ; ps < SMAA_MAX_SEARCH_STEPS ; ps ++ ) { if ( pp . y > pq && pr . r > 0.8281 && pr . g == 0.0 ) { pr = texture2D ( pn , pp , 0.0 ) . rg ; pp = - vec2 ( 0.0 , 2.0 ) * u_texel_size + pp ; } } float pt = - ( 255.0 / 127.0 ) * oX ( po , pr . gr , 0.0 ) + 3.25 ; return u_texel_size . y * pt + pp . y ; } float pC ( sampler2D pv , sampler2D pw , vec2 px , float py ) { vec2 pz = vec2 ( 1.0 , 0.0 ) ; for ( int pA = 0 ; pA < SMAA_MAX_SEARCH_STEPS ; pA ++ ) { if ( px . y < py && pz . r > 0.8281 && pz . g == 0.0 ) { pz = texture2D ( pv , px , 0.0 ) . rg ; px = vec2 ( 0.0 , 2.0 ) * u_texel_size + px ; } } float pB = - ( 255.0 / 127.0 ) * oX ( pw , pz . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * pB + px . y ; } vec2 pJ ( sampler2D pD , vec2 pE , float pF , float pG , float pH ) { vec2 pI = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * nM ( 4.0 * vec2 ( pF , pG ) ) + pE ; pI = SMAA_AREATEX_PIXEL_SIZE * pI + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; pI . y = SMAA_AREATEX_SUBTEX_SIZE * pH + pI . y ; return texture2D ( pD , pI , 0.0 ) . rg ; } void pR ( sampler2D pK , inout vec2 pL , vec4 pM , vec2 pN ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pO = step ( pN . xy , pN . yx ) ; vec2 pP = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pO ; pP /= pO . x + pO . y ; vec2 pQ = vec2 ( 1.0 , 1.0 ) ; pQ . x -= pP . x * texture2D ( pK , pM . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; pQ . x -= pP . y * texture2D ( pK , pM . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; pQ . y -= pP . x * texture2D ( pK , pM . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; pQ . y -= pP . y * texture2D ( pK , pM . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; pL *= clamp ( pQ , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void pZ ( sampler2D pS , inout vec2 pT , vec4 pU , vec2 pV ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 pW = step ( pV . xy , pV . yx ) ; vec2 pX = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * pW ; pX /= pW . x + pW . y ; vec2 pY = vec2 ( 1.0 , 1.0 ) ; pY . x -= pX . x * texture2D ( pS , pU . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; pY . x -= pX . y * texture2D ( pS , pU . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; pY . y -= pX . x * texture2D ( pS , pU . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; pY . y -= pX . y * texture2D ( pS , pU . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; pT *= clamp ( pY , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qr ( vec2 p_ , vec2 qa , sampler2D qb , sampler2D qc , sampler2D qd , vec4 qe ) { vec4 qf = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 qg = texture2D ( qb , p_ ) . rg ; if ( qg . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"qf . rg = oR ( qb , qc , p_ , qg , qe ) ; if ( qf . r == - qf . g ) {".split(" ")}]}}]},
{type:"textline",b:"vec2 qh ; vec3 qi ; qi . x = pe ( qb , qd , no . xy , nq . x ) ; qi . y = np . y ; qh . x = qi . x ; float qj = texture2D ( qb , qi . xy , 0.0 ) . r ; qi . z = pm ( qb , qd , no . zw , nq . y ) ; qh . y = qi . z ; qh = abs ( nM ( qh / u_texel_size . xx - qa . xx ) ) ; vec2 qk = sqrt ( qh ) ; float ql = texture2D ( qb , qi . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; qf . rg = pJ ( qc , qk , qj , ql , qe . y ) ; qi . y = p_ . y ; pR ( qb , qf . rg , qi . xyzy , qh ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else qg . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( qg . r > 0.0 ) { vec2 qm ; vec3 qn ; qn . y = pu ( qb , qd , np . xy , nq . z ) ; qn . x = no . x ; qm . x = qn . y ; float qo = texture2D ( qb , qn . xy , 0.0 ) . g ; qn . z = pC ( qb , qd , np . zw , nq . w ) ; qm . y = qn . z ; qm = abs ( nM ( qm / u_texel_size . yy - qa . yy ) ) ; vec2 qp = sqrt ( qm ) ; float qq = texture2D ( qb , qn . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; qf . ba = pJ ( qc , qp , qo , qq , qe . x ) ; qn . x = p_ . x ; pZ ( qb , qf . ba , qn . xyxz , qm ) ; } return qf ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qI ( vec2 qs , sampler2D qt , sampler2D qu".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qv"]}]}}]},{type:"textline",b:") { vec4 qw ; qw . x = texture2D ( qu , nn . xy ) . a ; qw . y = texture2D ( qu , nn . zw ) . g ; qw . wz = texture2D ( qu , qs ) . xz ; if ( dot ( qw , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 qx = texture2D ( qt , qs , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qy = texture2D ( qv , a ) ; vec2 qz = 2.0 * cx ( qy ) - 1.0 ; qx . a = sqrt ( 2.0 * length ( qz ) ) ;".split(" ")}]}}]},{type:"textline",b:"return qx ; } else { bool qA = max ( qw . x , qw . z ) > max ( qw . y , qw . w ) ; vec4 qB = vec4 ( 0.0 , qw . y , 0.0 , qw . w ) ; vec2 qC = qw . yw ; nH ( bvec4 ( qA , qA , qA , qA ) , qB , vec4 ( qw . x , 0.0 , qw . z , 0.0 ) ) ; nH ( bvec2 ( qA , qA ) , qC , qw . xz ) ; qC /= dot ( qC , vec2 ( 1.0 , 1.0 ) ) ; vec4 qD = qB * vec4 ( u_texel_size , - u_texel_size ) + qs . xyxy ; vec4 qE = qC . x * texture2D ( qt , qD . xy , 0.0 ) ; qE += qC . y * texture2D ( qt , qD . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qF = texture2D ( qv , qD . xy ) ; vec2 qG = 2.0 * cx ( qF ) - 1.0 ; vec2 qH = qC . x * qG ; qF = texture2D ( qv , qD . zw ) ; qG = 2.0 * cx ( qF ) - 1.0 ; qH += qC . y * qG ; qE . a = sqrt ( 2.0 * length ( qH ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","qE",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qU ( vec2 qJ , sampler2D qK , sampler2D qL".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","qM"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qN = texture2D ( qM , a ) ; vec2 qO ; qO = 2.0 * cx ( qN ) - 1.0 ; vec4 qP = texture2D ( qK , qJ ) ; vec4 qQ = texture2D ( qL , qJ - qO ) ; float qR = abs ( qP . a * qP . a - qQ . a * qQ . a ) / 2.0 ; float qS = 0.5 * clamp ( 1.0 - sqrt ( qR ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 qT = mix ( qP , qQ , qS ) ; qT . a = 1.0 ; return qT ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qP = texture2D ( qK , qJ ) ; vec4 qQ = texture2D ( qL , qJ ) ; return mix ( qP , qQ , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 qV = vec4 ( od ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 qV = qr ( a , nr , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 qV = qI ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 qV = vec4 ( qU ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qV = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","qV",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","nn",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 no ; varying vec4 np ; varying vec4 nq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","nr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void lg ( vec2 lf ) { no = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + lf . xyxy ; np = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + lf . xyxy ; nq = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + lf . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void lj ( vec2 lh , out vec2 li ) { li = lh / u_texel_size ; no = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + lh . xyxy ; np = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + lh . xyxy ; nq = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( no . xz , np . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void ll ( vec2 lk ) { nn = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + lk . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = a_bb_vertex + 0.5 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["lg","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"lj ( a , nr ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["ll","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",b:["1"]},{type:"define",
name:"SSAO_QUALITY_16",b:["2"]},{type:"define",name:"SSAO_QUALITY_24",b:["3"]},{type:"define",name:"SSAO_QUALITY_32",b:["4"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float nt ( in vec2 ns ) { return ni ( u_depth , ns , u_camera_range ) ; } void main ( ) { float nu = texture2D ( u_color , a ) . r ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( nu , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",b:"vec3 nv = normalize ( 2.0 * texture2D ( u_ssao_special_tex , a * 0.25 / u_texel_size ) . rgb - 1.0 ) ; float nw = nt ( a ) ; float nx = nw * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_8"],group:{type:"group",a:[{type:"textline",b:"const float ny = 8.0 ; const int nz = 1 ;".split(" ")}]}},
{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"const float ny = 16.0 ; const int nz = 2 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_24"],group:{type:"group",a:[{type:"textline",b:"const float ny = 24.0 ; const int nz = 3 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"const float ny = 32.0 ; const int nz = 4 ;".split(" ")}]}}]},{type:"textline",b:"float nA = u_ssao_radius_increase * 0.001 ; const float nB = 1.0 + 2.4 / ny ; float nC = 0.0 ; for ( int nD = 0 ; nD < nz ; nD ++ ) for ( int nE = - 1 ; nE <= 1 ; nE += 2 ) for ( int nF = - 1 ; nF <= 1 ; nF += 2 ) for ( int nG = - 1 ; nG <= 1 ; nG += 2 ) { vec3 nH = reflect ( normalize ( vec3 ( nE , nF , nG ) ) , nv ) * ( nA *= nB ) ; vec3 nI = vec3 ( a , nx ) ; nI += vec3 ( nH . xy , nH . z * nx * 2.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nI . z -= 1.4 * ( nI . z - nx ) * step ( nx , nI . z ) ;".split(" ")}]}}]},{type:"textline",b:"float nJ = nt ( nI . xy ) * ( u_camera_range . y - u_camera_range . x ) ; float nK = clamp ( ( nx - nJ ) / nJ , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nC += mix ( 1.0 , nK , step ( nJ , nI . z ) ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"nC += mix ( step ( nI . z , nJ ) , 0.5 , nK ) ;".split(" ")}]}}]},{type:"textline",b:"} nC = nC / ny ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_HEMISPHERE"],group:{type:"group",a:[{type:"textline",b:"nC = clamp ( nC * nC + 0.6 * nC , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"nC = clamp ( nC * nC + nC , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"float nL = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * nw ) ; nC = mix ( 1.0 , nC , nL ) ; gl_FragColor = vec4 ( nu , nC , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"include",file:"depth_fetch.glslf"}]}}]},{type:"textline",b:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float nt ( in vec2 ns ) { return ni ( u_depth , ns , u_camera_range ) ; }".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { float nu = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nv = nt ( a ) ; float nw = 0.0 ; float nx = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",b:"vec2 ny = vec2 ( - 2.0 ) ; for ( int nz = 0 ; nz < 4 ; ++ nz ) { for ( int nA = 0 ; nA < 4 ; ++ nA ) { vec2 nB = ( ny + vec2 ( float ( nz ) , float ( nA ) ) ) * u_texel_size ; float nC = texture2D ( u_ssao_mask , a + nB ) . g ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float nD = nt ( a + nB ) ; float nE = 1.0 - clamp ( abs ( nD - nv ) * nx , 0.0 , 1.0 ) ; nu += nC * nE ; nw += nE ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["nu","+=","nC",";"]}]}}]},{type:"textline",b:["}","}"]},{type:"condition",a:[{type:"if",c:["SSAO_BLUR_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nu / nw , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , a ) . r , nu / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { float lf = texture2D ( u_depth , a ) . x ; vec4 lg = vec4 ( a * 2.0 - 1.0 , 2.0 * lf - 1.0 , 1.0 ) ; vec4 lh = u_view_proj_inverse * lg ; vec4 li = lh / lh . w ; vec4 lj = u_view_proj_prev * li ; lj /= lj . w ; vec2 lk = ( lg . xy - lj . xy ) / 4.0 + 0.5 ; lk = clamp ( lk , 0.0 , 1.0 ) ; gl_FragColor = cl ( lk ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; struct c { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool f ( vec3 d , vec3 e ) { return any ( lessThan ( abs ( d - e ) , vec3 ( EPSILON ) ) ) ; } vec3 i ( in vec4 g , in vec3 h ) { return h + 2.0 * cross ( g . xyz , cross ( g . xyz , h ) + g . w * h ) ; } mat4 j ( ) { return mat4 ( 1.0 , b , b , b , b , 1.0 , b , b , b , b , 1.0 , b , b , b , b , 1.0 ) ; } mat4 l ( float k ) { return mat4 ( 1.0 , b , b , b , b , cos ( k ) , sin ( k ) , b , b , - sin ( k ) , cos ( k ) , b , b , b , b , 1.0 ) ; } mat4 n ( float m ) { return mat4 ( cos ( m ) , b , - sin ( m ) , b , b , 1.0 , b , b , sin ( m ) , b , cos ( m ) , b , b , b , b , 1.0 ) ; } mat4 p ( float o ) { return mat4 ( cos ( o ) , sin ( o ) , b , b , - sin ( o ) , cos ( o ) , b , b , b , b , 1.0 , b , b , b , b , 1.0 ) ; } c r ( in c q ) { return c ( q . a , q . b , normalize ( q . c ) , normalize ( q . d ) , normalize ( q . e ) , q . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 s = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 y ( vec3 t , mat4 u ) { vec3 v = vec3 ( u [ 0 ] [ 0 ] , u [ 1 ] [ 0 ] , u [ 2 ] [ 0 ] ) ; vec3 w = vec3 ( u [ 0 ] [ 1 ] , u [ 1 ] [ 1 ] , u [ 2 ] [ 1 ] ) ; vec3 x = vec3 ( u [ 0 ] [ 2 ] , u [ 1 ] [ 2 ] , u [ 2 ] [ 2 ] ) ; w = cross ( x , v ) ; return mat4 ( vec4 ( v , 0.0 ) , vec4 ( w , 0.0 ) , vec4 ( x , 0.0 ) , vec4 ( t , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 E ( vec3 z , vec3 A ) { vec3 B = z - A ; B . y = 0.0 ; B = normalize ( B ) ; vec3 C = normalize ( cross ( s , B ) ) ; vec3 D = normalize ( cross ( B , C ) ) ; return mat4 ( vec4 ( C , 0.0 ) , vec4 ( D , 0.0 ) , vec4 ( B , 0.0 ) , vec4 ( A , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 P ( in vec3 F , float G , float H , float I , vec3 J ) { float L = fract ( length ( J ) / 0.17 ) ; float M = I + L / 10.0 ; float N = L ; if ( I != 0.0 ) N /= I ; F *= 1.0 + 0.5 * sin ( G ) ; float O = length ( F ) * H * sin ( 2.0 * 3.14 * G * M + N ) ; return p ( O ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 _ ( in vec3 Q , in vec3 R , in mat4 S ) {".split(" ")},{type:"condition",a:[{type:"if",c:"BILLBOARD_SPHERICAL || ! BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 T = y ( R , S ) ;".split(" ")}]}},{type:"elif",c:["BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"float U = fract ( ( R . x * 1.43 + R . y * 0.123 + R . z * 6.1 ) ) ; float V = 2.0 * M_PI * U ; vec3 W = normalize ( vec3 ( S [ 0 ] [ 2 ] , 0.0 , S [ 2 ] [ 2 ] ) ) ; float X = acos ( W [ 2 ] ) ; if ( W [ 0 ] < 0.0 ) X = 2.0 * M_PI - X ; float Y = X - V ; if ( Y < 0.0 ) Y = 2.0 * M_PI + Y ; float Z = V ; if ( Y <= MAX_BILLBOARD_ANGLE ) Z += Y ; else if ( Y <= M_PI - MAX_BILLBOARD_ANGLE ) Z += MAX_BILLBOARD_ANGLE * ( 2.0 * Y - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( Y <= M_PI + MAX_BILLBOARD_ANGLE ) Z += Y - M_PI ; else if ( Y <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) Z += MAX_BILLBOARD_ANGLE * ( 2.0 * Y - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else Z += Y - 2.0 * M_PI ; mat4 T = n ( Z ) ; T [ 3 ] = vec4 ( R , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 T = E ( Q , R ) ;".split(" ")}]}}]},{type:"textline",b:"return T ; } c ag ( in vec3 aa , in vec3 ab , in vec3 ac , in vec3 ad , in vec3 ae , in mat4 af ) { aa = ( af * vec4 ( aa , 1.0 ) ) . xyz ; ab = ( af * vec4 ( ab , 1.0 ) ) . xyz ; ac = ( af * vec4 ( ac , 0.0 ) ) . xyz ; ad = ( af * vec4 ( ad , 0.0 ) ) . xyz ; ae = ( af * vec4 ( ae , 0.0 ) ) . xyz ; return r ( c ( aa , ab , ac , ad , ae , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]=
{type:"group",a:[{type:"textline",b:"vec2 aj ( vec2 ah , vec3 ai ) { return ( ah + 0.5 ) * ai . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 as ( in vec4 ak , in vec4 al , in float am ) { float an = ak [ 0 ] * al [ 0 ] + ak [ 1 ] * al [ 1 ] + ak [ 2 ] * al [ 2 ] + ak [ 3 ] * al [ 3 ] ; if ( an < 0.0 ) { al *= - 1.0 ; an = - an ; } if ( abs ( an ) >= 1.0 ) return ak ; float ao = acos ( an ) ; float ap = sqrt ( 1.0 - an * an ) ; if ( abs ( ap ) < 0.001 ) return vec4 ( ak * 0.5 + al * 0.5 ) ; float aq = sin ( ( 1.0 - am ) * ao ) / ap ; float ar = sin ( am * ao ) / ap ; return ak * aq + al * ar ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aH ( in vec3 at , in vec4 au , in vec4 av , in vec4 aw , in vec4 ax , in float ay ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 az = as ( au , av , ay ) ; vec4 aA = mix ( aw , ax , ay ) ; vec3 aB = i ( az , at ) ; vec3 aC = aB * aA . w + aA . xyz ; return aC ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aD = i ( au , at ) ; vec3 aE = i ( av , at ) ; vec3 aF = aD * aw . w + aw . xyz ; vec3 aG = aE * ax . w + ax . xyz ; return mix ( aF , aG , ay ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aQ ( in vec3 aI , in vec4 aJ , in vec4 aK , in float aL ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aM = as ( aJ , aK , aL ) ; vec3 aN = i ( aM , aI ) ; return aN ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aO = i ( aJ , aI ) ; vec3 aP = i ( aK , aI ) ; return mix ( aO , aP , aL ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 aH ( in vec3 aR , in vec4 aS , in vec4 aT ) { vec3 aU = i ( aS , aR ) ; vec3 aV = aU * aT . w + aT . xyz ; return aV ; } vec3 aQ ( in vec3 aW , in vec4 aX ) { vec3 aY = i ( aX , aW ) ; return aY ; }".split(" ")}]}}]},{type:"textline",b:"void bm ( inout vec3 aZ , inout vec3 a_ , inout vec3 ba , inout vec3 bb ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["float","bc","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { vec3 bd = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 be = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bf = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bg = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec4 bh = a_influence ; for ( int bi = 0 ; bi < 4 ; bi ++ ) { int bj = int ( bh [ bi ] ) ; float bk = fract ( bh [ bi ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bd += bk * aH ( aZ , u_quatsb [ bj ] , u_quatsa [ bj ] , u_transb [ bj ] , u_transa [ bj ] , bc ) ; be += bk * aQ ( a_ , u_quatsb [ bj ] , u_quatsa [ bj ] , bc ) ; bf += bk * aQ ( ba , u_quatsb [ bj ] , u_quatsa [ bj ] , bc ) ; bg += bk * aQ ( bb , u_quatsb [ bj ] , u_quatsa [ bj ] , bc ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bd += bk * aH ( aZ , u_quatsb [ bj ] , u_transb [ bj ] ) ; be += bk * aQ ( a_ , u_quatsb [ bj ] ) ; bf += bk * aQ ( ba , u_quatsb [ bj ] ) ; bg += bk * aQ ( bb , u_quatsb [ bj ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} aZ = bd ; a_ = be ; ba = bf ; bb = bg ; } if ( ! ( a_influence . y > 0.0 ) ) { int bl = int ( a_influence [ 0 ] - 1.0 ) ; if ( bl > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"aZ = aH ( aZ , u_quatsb [ bl ] , u_quatsa [ bl ] , u_transb [ bl ] , u_transa [ bl ] , bc ) ; a_ = aQ ( a_ , u_quatsb [ bl ] , u_quatsa [ bl ] , bc ) ; ba = aQ ( ba , u_quatsb [ bl ] , u_quatsa [ bl ] , bc ) ; bb = aQ ( bb , u_quatsb [ bl ] , u_quatsa [ bl ] , bc ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"aZ = aH ( aZ , u_quatsb [ bl ] , u_transb [ bl ] ) ; a_ = aQ ( a_ , u_quatsb [ bl ] ) ; ba = aQ ( ba , u_quatsb [ bl ] ) ; bb = aQ ( bb , u_quatsb [ bl ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bA ( inout vec3 bn , in vec3 bo , in float bp , in float bq , in float br , in vec3 bs , in float bt ) { float bu = length ( bo ) ; float bv = bq * ( 1.0 + 0.1 * fract ( bu ) ) ; float bw = bp * bt * ( 1.0 + sin ( 2.0 * 3.14 * br * bv + bu ) ) ; float bx = ( bn . y - bo . y ) * abs ( bw ) ; bx += 1.0 ; bx *= bx ; bx = bx * bx - bx ; vec3 by = bn ; by . xz += bs . xz * bx * sign ( bw ) ; float bz = length ( bn - bo ) ; bn = bo + normalize ( by - bo ) * bz ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bC ( vec4 bB ) { return bB * bB * ( 3.0 - 2.0 * bB ) ; } vec4 bE ( vec4 bD ) { return abs ( fract ( bD + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bG ( vec4 bF ) { return bC ( bE ( bF ) ) ; } void bX ( inout vec3 bH , in float bI , in vec3 bJ , in vec3 bK , in vec3 bL , in float bM , in float bN , in float bO , in vec3 bP ) { float bQ ; float bR ; float bS ; vec2 bT ; vec4 bU ; vec2 bV ; vec3 bW ; bQ = dot ( bL , vec3 ( 1.0 ) ) ; bR = bQ + bP . g ; bS = dot ( bH , vec3 ( bP . g ) ) ; bT = ( bI + vec2 ( bS , bR ) ) ; bU = ( ( fract ( ( bT . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bK ) * bM ; bU = bG ( bU ) ; bV = bU . xz + bU . yw ; bV . y = 0.5 - bV . y ; bW = bV . xyx * bP . rbr * vec3 ( bN * bJ . x , bO , bN * bJ . z ) ; bH += bW ; }".split(" ")}]}}]},
{type:"textline",b:"void cd ( inout vec3 bY , inout vec3 bZ , in vec3 b_ ) { vec3 ca = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vec3 cb = bZ ; vec3 cc = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cb = bY ; vec3 cc = bZ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"bX ( cb , u_time , b_ , ca , cc , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bA ( cb , cc , au_wind_bending_amp , au_wind_bending_freq , u_time , ca , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bA ( cb , cc , au_wind_bending_amp , au_wind_bending_freq , u_time , ca , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"bY += cb - bZ ; bZ = cb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bY = cb ; bZ = cc ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",
b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["2"]},{type:"define",name:"SHADOW_SRC_MASK",b:["3"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["2"]},{type:"define",name:"SHADOW_DST_MASK",b:["3"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",
b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"float ce = 255.0 ; float cf = 0.0 ; float cg = 1.0 ; vec4 cl ( const in float ch ) { vec4 ci = vec4 ( ce * ce * ce , ce * ce , ce , cg ) ; vec4 cj = vec4 ( cf , cg / ce , cg / ce , cg / ce ) ; vec4 ck = fract ( ch * ci ) ; ck -= ck . xxyz * cj ; return ck ; } float cp ( const in vec4 cm ) { float cn ; vec4 co = vec4 ( cg / ( ce * ce * ce ) , cg / ( ce * ce ) , cg / ce , cg ) ; cn = dot ( cm , co ) ; return cn ; } vec4 cl ( const in vec2 cq ) { vec2 cr = vec2 ( ce , cg ) ; vec2 cs = vec2 ( cf , cg / ce ) ; vec4 ct = fract ( cq . xxyy * cr . xyxy ) ; ct -= ct . xxzz * cs . xyxy ; if ( cq . r == cg ) ct . rg = vec2 ( cf , cg ) ; if ( cq . g == cg ) ct . ba = vec2 ( cf , cg ) ; return ct ; } vec2 cx ( const in vec4 cu ) { vec2 cv ; vec2 cw = vec2 ( cg / ce , cg ) ; cv . r = dot ( cu . rg , cw ) ; cv . g = dot ( cu . ba , cw ) ; return cv ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"vec4 cG ( vec4 cF ) { return cF - floor ( cF * ( 1.0 / 289.0 ) ) * 289.0 ; } vec3 cG ( vec3 cH ) { return cH - floor ( cH * ( 1.0 / 289.0 ) ) * 289.0 ; } vec2 cG ( vec2 cI ) { return cI - floor ( cI * ( 1.0 / 289.0 ) ) * 289.0 ; } vec4 cK ( vec4 cJ ) { return cJ - floor ( cJ * ( 1.0 / 7.0 ) ) * 7.0 ; } vec4 cM ( vec4 cL ) { return cG ( ( 34.0 * cL + 5.0 ) * cL ) ; }".split(" ")},{type:"define",name:"K",b:["0.142857142857"]},{type:"define",
name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 cY ( vec2 cN ) { vec2 cO = cG ( floor ( cN ) ) ; vec2 cP = fract ( cN ) ; vec4 cQ = cP . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 cR = cP . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 cS = cM ( cO . x + vec4 ( 0.0 , 1.0 , 0.0 , 1.0 ) ) ; cS = cM ( cS + cO . y + vec4 ( 0.0 , 0.0 , 1.0 , 1.0 ) ) ; vec4 cT = cK ( cS ) * K + K2 ; vec4 cU = cK ( floor ( cS * K ) ) * K + K2 ; vec4 cV = cQ + JITTER * cT ; vec4 cW = cR + JITTER * cU ; vec4 cX = cV * cV + cW * cW ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"cX . xy = min ( cX . xy , cX . zw ) ; cX . x = min ( cX . x , cX . y ) ; return cX . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cX . xy = ( cX . x < cX . y ) ? cX . xy : cX . yx ; cX . xz = ( cX . x < cX . z ) ? cX . xz : cX . zx ; cX . xw = ( cX . x < cX . w ) ? cX . xw : cX . wx ; cX . y = min ( cX . y , cX . z ) ; cX . y = min ( cX . y , cX . w ) ; return sqrt ( cX . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 dm ( vec2 cZ , float c_ ) { vec2 da = cG ( floor ( cZ ) ) ; vec2 db = fract ( cZ ) ; vec4 dc = db . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 dd = db . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 de = cM ( da . x + vec4 ( 0.0 , 1.0 , 0.0 , 1.0 ) ) ; de = cM ( de + da . y + vec4 ( 0.0 , 0.0 , 1.0 , 1.0 ) ) ; vec4 df = cK ( de ) * K + K2 ; vec4 dg = cK ( floor ( de * K ) ) * K + K2 ; vec4 dh = dc + JITTER * df ; vec4 di = dd + JITTER * dg ; vec4 dj = dh * dh + di * di ; dh += c_ ; di += c_ ; vec4 dk = dh * dh + di * di ; dh += c_ ; di += c_ ; vec4 dl = dh * dh + di * di ; dj . xy = min ( dj . xy , dj . zw ) ; dj . x = min ( dj . x , dj . y ) ; dk . xy = min ( dk . xy , dk . zw ) ; dk . x = min ( dk . x , dk . y ) ; dl . xy = min ( dl . xy , dl . zw ) ; dl . x = min ( dl . x , dl . y ) ; return mat3 ( dj . xx , 0.0 , dk . xx , 0.0 , dl . xx , 0.0 ) ; } vec3 dp ( vec3 dn ) { return cG ( ( ( dn * 34.0 ) + 1.0 ) * dn ) ; } float dD ( vec2 dq ) { const vec4 dr = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 ds = floor ( dq + dot ( dq , dr . yy ) ) ; vec2 dt = dq - ds + dot ( ds , dr . xx ) ; vec2 du ; du = ( dt . x > dt . y ) ? vec2 ( 1.0 , 0.0 ) : vec2 ( 0.0 , 1.0 ) ; vec4 dv = dt . xyxy + dr . xxzz ; dv . xy -= du ; ds = cG ( ds ) ; vec3 dw = dp ( dp ( ds . y + vec3 ( 0.0 , du . y , 1.0 ) ) + ds . x + vec3 ( 0.0 , du . x , 1.0 ) ) ; vec3 dx = max ( 0.5 - vec3 ( dot ( dt , dt ) , dot ( dv . xy , dv . xy ) , dot ( dv . zw , dv . zw ) ) , 0.0 ) ; dx = dx * dx ; dx = dx * dx ; vec3 dy = 2.0 * fract ( dw * dr . www ) - 1.0 ; vec3 dz = abs ( dy ) - 0.5 ; vec3 dA = floor ( dy + 0.5 ) ; vec3 dB = dy - dA ; dx *= 1.79284291400159 - 0.85373472095314 * ( dB * dB + dz * dz ) ; vec3 dC ; dC . x = dB . x * dt . x + dz . x * dt . y ; dC . yz = dB . yz * dv . xz + dz . yz * dv . yw ; return 130.0 * dot ( dx , dC ) ; } vec2 dJ ( vec2 dE ) { float dF = dot ( dE , vec2 ( 12.9898 , 78.233 ) ) ; float dG = dot ( dE , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float dH = fract ( sin ( dF ) * 43758.5453 ) * 2.0 - 1.0 ; float dI = fract ( sin ( dG ) * 43758.5453 ) * 2.0 - 1.0 ; return vec2 ( dH , dI ) ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",b:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",b:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","dK",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"const float dL = 0.1 ; const float dM = 0.1 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"const float dN = 0.05 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"mat4 dO = mat4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 , 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 , - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 , - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; mat4 dP = mat4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 , - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 , - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 , - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ;".split(" ")}]}}]},
{type:"textline",b:"float eb ( vec3 dQ , sampler2D dR , float dS ) { float dT ; dQ . z = clamp ( dQ . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"dT = 0.0 ; float dU = dJ ( dQ . xy ) . x * M_PI ; float dV = cos ( dU ) ; float dW = sin ( dU ) ; mat2 dX = mat2 ( dV , dW , - dW , dV ) ; vec2 dY , dZ ; for ( int d_ = 0 ; d_ < 4 ; d_ ++ ) for ( int ea = 0 ; ea < 4 ; ea ++ ) { dZ . x = dO [ d_ ] [ ea ] ; dZ . y = dP [ d_ ] [ ea ] ; dZ = dX * dZ ; dY = dQ . xy + dZ * dS / SHADOW_TEX_RES ; dT += step ( dQ . z , texture2D ( dR , dY ) . r ) ; } dT /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["dT","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( dT , 0.0 , 1.0 ) ; } float et ( vec3 ec , sampler2D ed , vec3 ee , sampler2D ef , float eg , float eh , float ei ) { float ej , ek ; ec . z = clamp ( ec . z , 0.0 , 1.0 ) ; ee . z = clamp ( ee . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"ej = 0.0 ; ek = 0.0 ; float el = dJ ( ec . xy ) . x * M_PI ; float em = cos ( el ) ; float en = sin ( el ) ; mat2 eo = mat2 ( em , en , - en , em ) ; vec2 ep , eq ; for ( int er = 0 ; er < 4 ; er ++ ) for ( int es = 0 ; es < 4 ; es ++ ) { eq . x = dO [ er ] [ es ] ; eq . y = dP [ er ] [ es ] ; eq = eo * eq ; ep = ec . xy + eq * eg / SHADOW_TEX_RES ; ej += step ( ec . z , texture2D ( ed , ep ) . r ) ; ep = ee . xy + eq * eh / SHADOW_TEX_RES ; ek += step ( ee . z , texture2D ( ef , ep ) . r ) ; } ej = mix ( ej , ek , ei ) ; ej /= 16.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["ej","=","1.0",";"]}]}}]},{type:"textline",b:"return clamp ( ej , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"bool ew ( vec2 eu , float ev ) { return all ( lessThanEqual ( eu , vec2 ( 1.0 + ev ) ) ) && all ( greaterThanEqual ( eu , vec2 ( 0.0 - ev ) ) ) ; } float eA ( vec2 ex ) { float ey = min ( ex . x , ex . y ) ; float ez = min ( 1.0 - ex . x , 1.0 - ex . y ) ; return min ( ey , ez ) ; } float eD ( float eB , float eC ) { if ( eC >= 0.0 && eC <= dM ) eB = ( eB - 1.0 ) / dM * eC + 1.0 ; return eB ; } float eP ( vec3 eE , vec3 eF , sampler2D eG , sampler2D eH , float eI , float eJ , float eK , float eL ) { float eM ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",a:[{type:"textline",b:"float eN = eA ( eE . xy ) ; if ( - eL > eK && eN >= 0.0 && eN <= dL && ew ( eF . xy , 0.0 ) ) { float eO = 1.0 - eN / dL ; eM = et ( eE , eG , eF , eH , eI , eJ , eO ) ; } else".split(" ")}]}}]},{type:"textline",b:"eM = eb ( eE , eG , eI ) ; return eM ; } float eX ( vec3 eQ , sampler2D eR , float eS , float eT , float eU ) { float eV = eb ( eQ , eR , eS ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["CSM_FADE_LAST_CASCADE"],group:{type:"group",a:[{type:"textline",b:"if ( - eU > eT ) { float eW = eA ( eQ . xy ) ; eV = eD ( eV , eW ) ; }".split(" ")}]}}]},{type:"textline",b:"return eV ; } float fd ( float eY ) { float eZ = 1.0 ; vec3 e_ = cz . xyz / cz . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"vec3 fa = cA . xyz / cA . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",
b:"vec3 fb = cB . xyz / cB . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"vec3 fc = cC . xyz / cC . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"if ( ew ( e_ . xy , 0.0 ) ) { eZ = eP ( e_ , fa , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , eY ) ; }".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"if ( ew ( e_ . xy , dN ) ) { eZ = eX ( e_ , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , eY ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else { if ( ew ( fa . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"eZ = eP ( fa , fb , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , eY ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eZ = eX ( fa , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , eY ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else { if ( ew ( fb . xy , 0.0 ) ) {".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"eZ = eP ( fb , fc , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , eY ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eZ = eX ( fb , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , eY ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else { if ( ew ( fc . xy , 0.0 ) ) eZ = eX ( fc , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , eY ) ; }".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",
b:["return","eZ",";","}"]}]}}]}]}}]},{type:"textline",b:"float fi ( inout vec3 fe ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 ff = texture2DProj ( u_shadow_mask , cD ) . rg ; vec3 fg = vec3 ( ff . r ) ; float fh = ff . g ; dK = vec4 ( fg , fh ) ; fe *= dK . a ; return dK . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return fd ( cE . z ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 fn ( vec3 fj , float fk , vec2 fl ) { vec2 fm = vec2 ( ( fj . x - fl . x ) / fk , - ( fj . z - fl . y ) / fk ) ; return fract ( fm ) ; } vec2 fr ( vec2 fo , float fp , vec2 fq ) { return vec2 ( fo . x * fp , - fo . y * fp ) + fq ; } c fs ( ) { return c ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } c fY ( vec3 ft , vec3 fu , vec3 fv , vec3 fw , vec3 fx , sampler2D fy , sampler2D fz , vec3 fA , float fB , vec3 fC , vec4 fD , mat4 fE ) { vec3 fF = i ( fD , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float fG = - fF . x ; float fH = - fF . z ; vec2 fI = vec2 ( fC . x + fB * ( - 1.0 - fG ) / 2.0 , fC . z + fB * ( 1.0 - fH ) / 2.0 ) ; vec2 fJ = fn ( fx , fB , fI ) ; float fK = fB / 2.0 ; vec2 fL = abs ( fr ( fJ - vec2 ( 0.5 ) , fB , vec2 ( 0.0 ) ) ) ; float fM = fK * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( fL ) > fM ) return fs ( ) ; float fN = fB / fA . z ; vec2 fO = ( fJ - vec2 ( 0.5 ) ) * fN + vec2 ( 0.5 ) ; vec3 fP = fF * ( fB / fA . z - 1.0 ) / 2.0 ; fO . x += fP . x ; fO . y -= fP . z ; vec4 fQ = texture2D ( fz , fO ) ; float fR = fQ . r ; if ( fR < u_scale_threshold ) return fs ( ) ; float fS = fA . y - fA . x ; float fT = fA . y - texture2D ( fy , fO ) . r * fS ; vec2 fU = ft . xz - fx . xz ; fx . xz = fr ( fJ , fB , fI ) ; fx . y = fT ; ft . xz = fx . xz + fU ; ft . y *= fR ; ft . y += fT ; vec3 fV = fQ . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"ft -= fx ; mat4 fW = _ ( fC , fx , fE ) ; c fX = ag ( ft , fx , fu , fv , fw , fW ) ; fX . b = fx ; fX . f = fV ; return r ( fX ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return r ( c ( ft , fx , fu , fv , fw , fV ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"var",name:"SHADOW_TEX_RES",b:["0.0"]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"vec4 gd ( mat4 fZ , vec4 f_ ) { vec2 ga = ( fZ * u_v_light_matrix [ 3 ] ) . xy ; float gb = SHADOW_TEX_RES / 2.0 ; ga = floor ( ga * gb + 0.5 ) / gb - ga ; vec4 gc = fZ * f_ ; gc . xy += ga ; gc = u_b_light_matrix * gc ; return gc ; } void gh ( vec3 ge ) { vec3 gf = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ; vec4 gg = u_v_light_matrix * vec4 ( ge + u_normal_offset * gf , 1.0 ) ; cz = gd ( u_p_light_matrix0 , gg ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cA = gd ( u_p_light_matrix1 , gg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cB = gd ( u_p_light_matrix2 , gg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cC = gd ( u_p_light_matrix3 , gg ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void gh ( vec4 gi ) { float gj = gi . x ; float gk = gi . y ; float gl = gi . w ; cD . x = ( gj + gl ) / 2.0 ; cD . y = ( gk + gl ) / 2.0 ; cD . z = gl ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]={type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void go ( inout vec3 gn ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",
b:"gn = max ( vec3 ( 0.0 ) , gn ) ; gn = pow ( gn , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gq ( inout vec3 gp ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"gp = max ( vec3 ( 0.0 ) , gp ) ; gp = pow ( gp , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void gt ( inout vec3 gr , in float gs ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"gr = gr * gs ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void gB ( inout vec3 gw , in float gx , in vec4 gy ) { float gz = gy . w * gx ; float gA = exp ( - gz * gz ) ; gA = clamp ( gA , 0.0 , 1.0 ) ; gw = mix ( gy . rgb , gw , gA ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 gI ( in mat4 gC , in vec3 gD ) { vec3 gE = mix ( gC [ 0 ] . rgb , gC [ 1 ] . rgb , max ( sign ( gD . x ) , 0.0 ) ) ; vec3 gF = mix ( gC [ 2 ] . rgb , gC [ 3 ] . rgb , max ( sign ( gD . z ) , 0.0 ) ) ; vec3 gG = vec3 ( gC [ 0 ] . a , gC [ 1 ] . a , gC [ 2 ] . a ) ; vec3 gH = mix ( gE , gF , abs ( gD . z ) ) ; gH = mix ( gH , gG , abs ( gD . y ) ) ; return gH ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void gK ( inout float gJ ) { gJ -= 0.5 ; gJ = 4.0 * ( gJ * gJ * gJ ) + 0.5 ; } void ha ( inout vec3 gL , in float gM , in vec3 gN , in float gO , in vec4 gP , in vec4 gQ , in float gR , in float gS ) { float gT = gQ . w * gM ; float gU = exp ( - gT * gT ) ; gU = clamp ( gU , 0.0 , 1.0 ) ; float gV = max ( gN . y , 0.0 ) ; gM = max ( gM - max ( gO / gV , 0.0 ) , 0.0 ) ; float gW = gP . w * gM ; float gX = 1.0 - gW ; gX = max ( gX , 0.0 ) ; gK ( gX ) ; gX += max ( gR - 0.5 , 0.0 ) ; if ( gX < gU ) { vec3 gY = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 gZ = gP . rgb ; gO = clamp ( - gO * 0.03 , 0.0 , 0.8 ) ; vec3 g_ = mix ( gZ , gY , min ( gV , 1.0 ) ) ; g_ = mix ( g_ , vec3 ( 0.0 ) , gO ) * gS ; gL = mix ( g_ , gL , gX ) ; } if ( gX >= gU ) { gL = mix ( gQ . rgb , gL , gU ) ; } } void hj ( inout vec3 hb , in float hc , in float hd , in vec4 he , in float hf ) { float hg = he . w * hc ; float hh = 1.0 - hg ; hh = clamp ( hh , 0.0 , 1.0 ) ; gK ( hh ) ; hd = clamp ( - hd * 0.03 , 0.0 , 0.8 ) ; vec3 hi = mix ( he . rgb , vec3 ( 0.0 ) , hd ) * hf ; hb = mix ( hi , hb , hh ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"float hk = 0.0 ; float hl = 1.0 ; struct hm { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float hu ( vec3 hn , vec3 ho , vec3 hp , vec4 hq , float hr ) { vec3 hs = normalize ( hn + ho ) ; float ht = hq [ 0 ] * max ( dot ( hp , hs ) , hk ) + hq [ 1 ] ; return pow ( ht , hr ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hF ( vec3 hv , vec3 hw , vec3 hx , float hy ) { vec3 hz = normalize ( hv + hw ) ; float hA = max ( dot ( hx , hz ) , 0.001 ) ; float hB = max ( dot ( hx , hw ) , 0.01 ) ; float hC = max ( dot ( hx , hv ) , 0.01 ) ; float hD = tan ( acos ( hA ) ) ; float hE = max ( hy , 0.001 ) ; return hC * ( hl / ( 4.0 * M_PI * hE * hE ) ) * ( exp ( - ( hD * hD ) / ( hE * hE ) ) / ( sqrt ( hB * hC ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hN ( vec3 hG , vec3 hH , vec3 hI , float hJ , float hK ) { vec3 hL = normalize ( hG + hH ) ; float hM = acos ( dot ( hL , hI ) ) ; if ( hM < hJ ) return hl ; else if ( hM >= hJ + hK || hK == hk ) return hk ; else return hl - ( hM - hJ ) / hK ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void ih ( float hO , vec3 hP , vec3 hQ , vec3 hR , float hS , inout float hT ) { if ( hS > hk ) { float hU = max ( dot ( hP , hR ) , hk ) ; float hV = hS * hS ; float hW = hl - 0.5 * ( hV / ( hV + 0.33 ) ) ; vec3 hX = hQ - hO * hP ; vec3 hY = hR - hU * hP ; if ( length ( hX ) == hk || length ( hY ) == hk || abs ( hO ) > hl || abs ( hU ) > hl ) hT = hT * hW ; else { float hZ = acos ( hO ) ; float h_ = acos ( hU ) ; vec3 ia = normalize ( hX ) ; vec3 ib = normalize ( hY ) ; float ic , id ; ic = max ( hZ , h_ ) ; id = min ( hZ , h_ ) ; id *= 0.95 ; float ie = max ( dot ( ia , ib ) , hk ) ; float ig = 0.45 * ( hV / ( hV + 0.09 ) ) ; hT = hT * ( hW + ( ig * ie * sin ( ic ) * tan ( id ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void ip ( vec3 ii , vec3 ij , float ik , float il , out float im ) { float io ; if ( ik == hk ) { im = hl ; } else { io = hl + abs ( dot ( ij , ii ) ) ; io = il + ( hl - il ) * pow ( io , ik ) ; im = clamp ( io , hk , hl ) ; } }".split(" ")}]}}]},{type:"textline",b:"void iX ( inout hm iq , vec3 ir , vec3 is , vec3 it , vec3 iu , vec3 iv , vec2 iw , vec2 ix , float iy , vec3 iz , vec3 iA , vec3 iB , vec4 iC , vec4 iD , float iE , vec4 iF ) { if ( iC . w + iD . w == hk ) return ; vec3 iG = vec3 ( hk ) ; vec3 iH = iB * iy ; float iI = iD . z ; if ( iI != - hl ) { iG = iz - it ; float iJ = length ( iG ) ; iH *= iI / ( iI + iJ * iJ ) ; iG = normalize ( iG ) ; float iK = iD . x ; float iL = iD . y ; if ( iK > - hl ) { float iM = dot ( iG , iA ) ; iM *= smoothstep ( hk , hl , ( iM - iK ) / iL ) ; iH *= iM ; } } else iG = iA ; float iN = hk ; if ( iC . w != hk ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"ip ( iu , iG , ix [ 0 ] , ix [ 1 ] , iN ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float iO = max ( dot ( iu , iG ) , hk ) ; iN = iC [ 0 ] * iO + iC [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"ih ( iO , iu , iG , iv , ix [ 0 ] , iN ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float iP = hk ; if ( iD . w != hk ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"iP = hu ( iG , iv , iu , iC , iw [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"iP = hF ( iG , iv , iu , iw [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"iP = hN ( iG , iv , iu , iw [ 0 ] , iw [ 1 ] ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["iP","=","hk",";"]}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( iG , iu ) * dot ( iv , iu ) < hk ) { float iQ = iF . x ; float iR = iF . y ; float iS = iF . z ; float iT = iF . w ; float iU = clamp ( abs ( dot ( iG , iu ) ) , hk , hl ) ; float iV = clamp ( dot ( iv , - iG ) , hk , hl ) ; float iW = pow ( iV , iR ) ; iq . a += iE * vec4 ( iH * iU * pow ( ir , vec3 ( iQ ) ) , hl ) ; iq . a += iS * mix ( vec4 ( ir , hl ) , vec4 ( hl ) , iT ) * iE * vec4 ( iH * iU * vec3 ( iW ) , hl ) ; } else { iq . b += iH * is * iP ; iq . a += vec4 ( iH * ir * iN , iP ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"iq . b += iH * is * iP ; iq . a += vec4 ( iH * ir * iN , iP ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"hm jJ ( vec3 iY , vec3 iZ , vec3 i_ , vec3 ja , vec3 jb , vec3 jc , vec3 jd , vec2 je , vec2 jf , float jg , vec3 jh [ NUM_LIGHTS ] , vec3 ji [ NUM_LIGHTS ] , vec3 jj [ NUM_LIGHTS ] , vec4 jk [ NUM_LIGHTS ] , vec4 jl [ NUM_LIGHTS ] , float jm , vec4 jn ) { hm jo ; jo . a = vec4 ( iY + i_ * iZ , hk ) ; jo . b = vec3 ( hk ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"textline",b:"iX ( jo , i_ , ja , jb , jc , jd , je , jf , jg , jh [ 0 ] , ji [ 0 ] , jj [ 0 ] , jk [ 0 ] , jl [ 0 ] , jm , jn ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","1"],group:{type:"group",a:[{type:"textline",b:"iX ( jo , i_ , ja , jb , jc , jd , je , jf , jg , jh [ 1 ] , ji [ 1 ] , jj [ 1 ] , jk [ 1 ] , jl [ 1 ] , jm , jn ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",
">","2"],group:{type:"group",a:[{type:"textline",b:"iX ( jo , i_ , ja , jb , jc , jd , je , jf , jg , jh [ 2 ] , ji [ 2 ] , jj [ 2 ] , jk [ 2 ] , jl [ 2 ] , jm , jn ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","3"],group:{type:"group",a:[{type:"textline",b:"iX ( jo , i_ , ja , jb , jc , jd , je , jf , jg , jh [ 3 ] , ji [ 3 ] , jj [ 3 ] , jk [ 3 ] , jl [ 3 ] , jm , jn ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int jp = 0 ; jp < NUM_LIGHTS ; jp ++ ) { vec4 jq = jk [ jp ] ; vec4 jr = jl [ jp ] ; if ( jq . w + jr . w != hk ) { vec3 js = vec3 ( hk ) ; vec3 jt = jj [ jp ] ; jt *= jg ; float ju = jr . z ; if ( ju != - hl ) { js = jh [ jp ] - jb ; float jv = length ( js ) ; jt *= ju / ( ju + jv * jv ) ; js = normalize ( js ) ; float jw = jr . x ; float jx = jr . y ; if ( jw > - hl ) { float jy = dot ( js , ji [ jp ] ) ; jy *= smoothstep ( hk , hl , ( jy - jw ) / jx ) ; jt *= jy ; } } else js = ji [ jp ] ; float jz = hk ; if ( jq . w != hk ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"ip ( jc , js , jf [ 0 ] , jf [ 1 ] , jz ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float jA = max ( dot ( jc , js ) , hk ) ; jz = jq [ 0 ] * jA + jq [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"ih ( jA , jc , js , jd , jf [ 0 ] , jz ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"} float jB = hk ; if ( jr . w != hk ) {".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"jB = hu ( js , jd , jc , jq , je [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"jB = hF ( js , jd , jc , je [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],
group:{type:"group",a:[{type:"textline",b:"jB = hN ( js , jd , jc , je [ 0 ] , je [ 1 ] ) ;".split(" ")}]}}]},{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["USE_NODE_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( js , jc ) * dot ( jd , jc ) < hk ) { float jC = jn . x ; float jD = jn . y ; float jE = jn . z ; float jF = jn . w ; float jG = clamp ( abs ( dot ( js , jc ) ) , hk , hl ) ; float jH = clamp ( dot ( jd , - js ) , hk , hl ) ; float jI = pow ( jH , jD ) ; jo . a += jm * vec4 ( jt * jG * pow ( i_ , vec3 ( jC ) ) , hl ) ; jo . a += jE * mix ( vec4 ( i_ , hl ) , vec4 ( hl ) , jF ) * jm * vec4 ( jt * jG * vec3 ( jI ) , hl ) ; } else { jo . b += jt * ja * jB ; jo . a += vec4 ( jt * i_ * jz , jB ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"jo . b += jt * ja * jB ; jo . a += vec4 ( jt * i_ * jz , jB ) ;".split(" ")}]}}]},{type:"textline",b:["}","}"]}]}}]},{type:"textline",b:["return","jo",";","}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hm jO ( vec3 jK , vec3 jL , vec3 jM ) { hm jN ; jN . a = vec4 ( jK + jM * jL , hk ) ; jN . b = vec3 ( hk ) ; return jN ; }".split(" ")}]}}]}]};a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2",
"(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void ko ( inout vec3 jP , float jQ , float jR , float jS , vec3 jT , vec3 jU , vec3 jV , vec4 jW , vec3 jX , float jY ) { if ( jY > CAUSTICS_VIEW_DISTANCE ) return ; vec4 jZ = jW ; vec3 j_ = jX + jT ; j_ . xz = 10.0 * sin ( 0.1 * j_ . xz ) ; vec3 ka = j_ + 2.0 * cross ( - jZ . xyz , cross ( - jZ . xyz , j_ ) + jZ . w * j_ ) ; vec2 kb = ka . xz ; vec3 kc = jU ; float kd = max ( dot ( jT , kc ) , 0.0 ) ; float ke = 0.025 ; kb . s += 0.5 * sin ( dot ( jX + jR , vec3 ( 1.0 ) ) ) ; kb . t += 0.7 * ( - sin ( dot ( jX - jR , vec3 ( - 0.7 ) ) ) ) ; kb . st += 0.23 * cos ( 4.0 * jQ - CAUST_SPEED . x * jR ) ; kb . st += 3.0 * sin ( jQ - 0.3 * CAUST_SPEED . y * jR ) ; float kf = CAUST_SCALE * ( 1.0 + max ( 0.1 * jQ , 0.0 ) ) ; mat3 kg = dm ( ( kb / kf ) , ke ) ; float kh = ( kg * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; float ki = ( kg * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; float kj = ( kg * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; vec3 kk = CAUST_BRIGHT * vec3 ( kh , ki , kj ) ; float kl = jS * kd ; float km = max ( sign ( jQ ) , 0.0 ) ; kl = min ( kl + 0.5 * sign ( - jT . y ) * km , 1.0 ) ; kl *= 1.0 - km * ( 0.1 * jQ ) ; kk *= kl ; kk *= kk ; float kn = min ( - jQ + 10.0 , 1.0 ) ; jP += max ( ( 2.0 * jV * kk ) * kn , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float kC ( in vec3 kv , in vec3 kw , in float kx , in float ky ) { vec3 kz = normalize ( kw + kv ) ; float kA = 1.0 - dot ( kv , kz ) ; float kB = ky + ( 1.0 - ky ) * pow ( kA , kx ) ; return kB ; } void kR ( inout vec3 kD , in vec3 kE , in vec3 kF , in float kG , in float kH , in float kI ) { vec3 kJ = reflect ( - kE , kF ) ; float kK = 1.0 ; if ( kG != 0.0 ) kK = kC ( kE , kJ , kG , kH ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 kL = u_refl_plane . xyz * dot ( kF , u_refl_plane . xyz ) ; vec3 kM = kF - kL ; vec2 kN = ( u_view_matrix_frag * vec4 ( kM , 0.0 ) ) . xy ; vec2 kO = cD . xy / cD . z ; kO += kN * REFL_BUMP ; vec3 kP = texture2D ( u_reflectmap , kO ) . rgb ; go ( kP . rgb ) ; kD = mix ( kD , kP , kI * kK ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"vec3 kQ = textureCube ( u_mirrormap , kJ ) . xyz ; go ( kQ . rgb ) ; kD = mix ( kD , kQ , u_mirror_factor * kK ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float kX ( in float kS , inout vec2 kT , in vec2 kU ) { vec4 kV = texture2D ( u_scene_depth , kT ) ; float kW = cp ( kV ) ; if ( kW < ku ) { kT = kU ; return kS ; } else { return kW ; } return kS ; } vec3 le ( in vec3 kY , in vec2 kZ ) { vec2 k_ = kY . xy / kY . z ; vec2 la = k_ + kZ ; vec4 lb = texture2DProj ( u_scene_depth , kY ) ; float lc = cp ( lb ) ; kX ( lc , la , k_ ) ; vec3 ld = texture2D ( u_refractmap , la ) . rgb ; go ( ld ) ; return ld ; }".split(" ")}]}}]}]};
a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct mf { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mm ( inout float mg , float mh , vec2 mi , vec2 mj ) { float mk = mj . x - mi . x ; float ml = ( mh - mi . x ) / mk ; mg = mix ( mg , mj . y , clamp ( ml , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void mt ( inout vec3 mn , float mo , vec4 mp , vec4 mq ) { float mr = mq . x - mp . x ; float ms = ( mo - mp . x ) / mr ; mn = mix ( mn , mq . yzw , clamp ( ms , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float mA ( float mu , float mv , vec2 mw [ SIZE_RAMP_LENGTH ] ) { float mx = mu / mv ; float my = mw [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mm ( my , mx , mw [ 0 ] , mw [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mm ( my , mx , mw [ 1 ] , mw [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mm ( my , mx , mw [ 2 ] , mw [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mz = 1 ; mz < SIZE_RAMP_LENGTH ; mz ++ ) mm ( my , mx , mw [ mz - 1 ] , mw [ mz ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","my",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 mH ( float mB , float mC , vec4 mD [ COLOR_RAMP_LENGTH ] ) { float mE = mB / mC ; vec3 mF = mD [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"mt ( mF , mE , mD [ 0 ] , mD [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"mt ( mF , mE , mD [ 1 ] , mD [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"mt ( mF , mE , mD [ 2 ] , mD [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int mG = 1 ; mG < COLOR_RAMP_LENGTH ; mG ++ ) mt ( mF , mE , mD [ mG - 1 ] , mD [ mG ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","mF",";","}"]}]}}]},{type:"textline",b:"float mQ ( float mI , float mJ , float mK , float mL ) { float mM = max ( 0.01 , min ( mJ , mK ) ) ; float mN = max ( 0.01 , min ( mJ , mL ) ) ; float mO = mJ - mN ; float mP = clamp ( mI / mM , 0.0 , 1.0 ) - step ( mO , mI ) * ( mI - mO ) / mN ; return mP ; } mf mW ( ) { mf mR ; float mS ; if ( u_p_cyclic == 1 ) { mS = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( mS < 0.0 ) mS += u_p_length ; } if ( u_p_cyclic != 1 ) { mS = u_p_time - a_p_delay ; } if ( mS < 0.0 || mS >= a_p_lifetime ) { mR . a = 0.0001 ; mR . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( mS < 0.0 || mS >= a_p_lifetime ) ) { vec3 mT = a_position ; vec3 mU = a_normal ; mT += u_p_nfactor * mS * mU ; mT += a_p_vels . xyz * mS ; mT . y -= u_p_gravity * mS * mS / 2.0 ; float mV = max ( u_p_mass , EPSILON ) ; mT += ( u_p_wind / mV ) * mS * mS / 2.0 ; mR . b = mT ; mR . e = a_p_vels . w * mS ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mR . a = mA ( mS , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mR . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"mR . d = mH ( mS , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mR . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"mR . c = mQ ( mS , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return mR ; }".split(" ")}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float ni ( in sampler2D nb , in vec2 nc , in vec2 nd ) { float ne = texture2D ( nb , nc ) . r ; float nf = nd . x ; float ng = nd . y ; float nh = 2.0 * nf / ( nf + ng - ( 2.0 * ne - 1.0 ) * ( ng - nf ) ) ; return nh ; }".split(" ")}]}};b4w.module.animation=function(a,n){var b=n("__animation"),c=n("__constraints");n("__physics");var g=n("__print"),d=n("__util");a.SLOT_0=b.SLOT_0;a.SLOT_1=b.SLOT_1;a.SLOT_2=b.SLOT_2;a.SLOT_3=b.SLOT_3;a.SLOT_4=b.SLOT_4;a.SLOT_5=b.SLOT_5;a.SLOT_6=b.SLOT_6;a.SLOT_7=b.SLOT_7;a.SLOT_ALL=b.SLOT_ALL;a.OBJ_ANIM_TYPE_ARMATURE=b.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=b.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=b.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=b.OBJ_ANIM_TYPE_SOUND;a.OBJ_ANIM_TYPE_PARTICLES=
b.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=b.OBJ_ANIM_TYPE_MATERIAL;a.OBJ_ANIM_TYPE_STATIC=b.OBJ_ANIM_TYPE_STATIC;a.AB_CYCLIC=b.AB_CYCLIC;a.AB_FINISH_RESET=b.AB_FINISH_RESET;a.AB_FINISH_STOP=b.AB_FINISH_STOP;var l=new Float32Array(4);a.is_animated=function(a){return b.is_animated(a)};a.get_actions=function(){for(var a=[],c=b.pv(),d=0;d<c.length;d++)a.push(b.dy(c[d].name));return a};a.get_current_action=function(b,c){return a.get_current_anim_name(b,c)};a.get_anim_names=function(a){return b.Ui(a)?
b.get_anim_names(a):[]};a.get_current_anim_name=function(a,c){if(!b.is_animated(a))return null;c=c||b.SLOT_0;return b.Bv(a,c)};a.apply=function(a,c,d){if(d>b.SLOT_7)g.error("Can't apply animation to slot "+d+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{d=d||b.SLOT_0;if(b.is_animated(a)){var l=b.get_slot_num_by_anim(a,c);if(-1!=l&&l!=d){g.error('Animation "'+c+'" is already applied to object "'+a.name+'" (slot "'+l+'").');return}}b.apply(a,c,d)}};a.remove=function(a){b.remove(a)};
a.remove_slot_animation=function(a,c){b.is_animated(a)&&(c=c||b.SLOT_0,b.remove_slot_animation(a,c))};a.apply_def=function(a){b.apply_def(a)};a.play=function(a,c,d){b.is_animated(a)?(d=d||b.SLOT_0,b.play(a,c,d),b.update_object_animation(a,0,d)):g.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,c){b.is_animated(a)&&(c=c||b.SLOT_0,b.stop(a,c))};a.is_play=function(a,c){if(!b.is_animated(a))return!1;c=c||b.SLOT_0;return b.is_play(a,c)};a.set_current_frame_float=function(b,c,d){a.set_frame(b,
c,d)};a.get_current_frame_float=function(b,c){return a.get_frame(b,c)};a.set_frame=function(a,c,d){b.is_animated(a)&&(d=d||b.SLOT_0,b.set_current_frame_float(a,c,d),b.update_object_animation(a,0,d))};a.get_frame=function(a,c){if(!b.is_animated(a))return 0;c=c||b.SLOT_0;return b.get_current_frame_float(a,c)};a.set_speed=function(a,c,d){b.is_animated(a)&&(d=d||b.SLOT_0,b.set_speed(a,c||1,d))};a.get_speed=function(a,c){if(!b.is_animated(a))return 0;c=c||b.SLOT_0;return b.get_speed(a,c)};a.get_frame_range=
function(a,c){if(b.is_animated(a)){c=c||b.SLOT_0;var d=a.w[c];if(d)return[d.start,d.start+d.length]}return null};a.get_anim_start_frame=function(a,c){return b.is_animated(a)?(c=c||b.SLOT_0,b.get_anim_start_frame(a,c)):-1};a.get_anim_length=function(a,c){return b.is_animated(a)?(c=c||b.SLOT_0,b.get_anim_length(a,c)):-1};a.cyclic=function(c,d,f){a.set_behavior(c,d?b.AB_CYCLIC:b.AB_FINISH_RESET,f)};a.is_cyclic=function(a,c){if(!b.is_animated(a))return!1;c=c||b.SLOT_0;return b.is_cyclic(a,c)};a.set_behavior=
function(a,c,d){b.is_animated(a)&&(d=d||b.SLOT_0,b.set_behavior(a,c,d))};a.get_behavior=function(a,c){if(!b.is_animated(a))return null;c=c||b.SLOT_0;return b.get_behavior(a,c)};a.apply_smoothing=function(a,c,d,g){g=g||b.SLOT_0;b.is_animated(a)&&b.apply_smoothing(a,c,d,g)};a.update_object_animation=function(a,c,d){b.is_animated(a)&&(d=d||b.SLOT_0,b.update_object_animation(a,c||0,d))};a.frame_to_sec=function(a){return b.frame_to_sec(a)};a.get_bone_translation=function(a,b,f){if(!d.Xe(a))return null;
f||(f=new Float32Array(3));c.vv(a,b,!1,l,null);f[0]=l[0];f[1]=l[1];f[2]=l[2];return f};a.get_first_armature_object=function(a){return d.sc(a)?b.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,c){return b.is_animated(a)&&c?b.get_slot_num_by_anim(a,c):null};a.get_anim_name=function(a,c){if(!b.is_animated(a))return null;c=c||b.SLOT_0;return b.rv(a,c)};a.get_anim_type=function(a,c){return b.is_animated(a)?b.get_anim_type(a,c):null};a.apply_to_first_empty_slot=function(a,c){return b.apply_to_first_empty_slot(a,
c)};a.get_skel_mix_factor=function(a){return a.d.Ed};a.set_skel_mix_factor=function(a,c,f){d.Xe(a)?(c=Math.min(Math.max(c,0),1),a.d.Ed!=c&&b.set_skel_mix_factor(a,c,f||0)):g.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.assets=function(a,n){var b=n("__assets");a.AT_ARRAYBUFFER=b.AT_ARRAYBUFFER;a.AT_JSON=b.AT_JSON;a.AT_TEXT=b.AT_TEXT;a.AT_AUDIOBUFFER=b.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=b.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=b.AT_AUDIO_ELEMENT;a.enqueue=function(a,g,d){b.enqueue(a,g,d)}};b4w.module.camera=function(a,n){function b(a,b){c.ic(a)?(p.copy(b,a.d.Va),k.v(a),d.sync_transform(a)):l.error("set_pivot(): Wrong object or camera move style")}var c=n("__camera"),g=n("__config"),d=n("__physics"),l=n("__print"),h=n("__constraints"),k=n("__transform"),f=n("__util"),p=n("vec3"),v=n("vec4"),m=n("quat"),x=n("mat3"),t=n("mat4"),z=g.controls,e=new Float32Array(3),B=new Float32Array(3),A=new Float32Array(4),u=new Float32Array(4),s=new Float32Array(9);a.MS_STATIC=c.MS_STATIC;a.MS_ANIMATION=
c.MS_ANIMATION;a.MS_CONTROLS=c.MS_TARGET_CONTROLS;a.MS_TARGET_CONTROLS=c.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=c.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=c.MS_HOVER_CONTROLS;a.is_camera=function(a){return c.is_camera(a)};a.set_move_style=function(a,b){a.d.ca=b};a.get_move_style=function(a){return c.is_camera(a)?c.get_move_style(a):(l.error("Wrong object"),null)};a.change_eye_target_dist=function(){l.error("change_eye_target_dist() deprecated")};a.change_trans_speed=function(a,b){var c=a.d,d=c.Hj[0],d=d*
(1+b*z.wt);c.Hj=[d,d,d]};a.get_trans_speed=function(a){return c.is_camera(a)?a.d.Hj[0]:(l.error("Wrong object"),0)};a.set_look_at=function(a,b,e,f){var g=a.d;c.Su(b,e,f,g.e,g.quat);k.v(a);d.sync_transform(a)};a.get_eye=function(a){return a.d.e};a.set_pivot=b;a.get_pivot=function(a,b){if(c.ic(a))return b||(b=new Float32Array(3)),p.copy(a.d.Va,b),b;l.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(a,b,g){if(c.ic(a)){var h=a.d;e[0]=0;e[1]=1;e[2]=0;m.setAxisAngle(e,b,
A);f.kq(h.e,h.Va,A,h.e);e[0]=1;e[1]=0;e[2]=0;p.transformQuat(e,h.quat,e);m.setAxisAngle(e,g,A);f.kq(h.e,h.Va,A,h.e);k.v(a);d.sync_transform(a)}else l.error("rotate_pivot(): wrong object")};a.move_pivot=function(a,b,f){if(c.ic(a)){var g=a.d;if(g.br){var h=x.fromMat4(g.G,s),m=p.subtract(g.e,g.Va,B);e[0]=b;e[1]=0;e[2]=f;p.scale(e,p.len(m),e);p.transformMat3(e,h,e);p.add(g.Va,e,g.Va);p.add(g.e,e,g.e);k.v(a);d.sync_transform(a)}}else l.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(a,
b){if(c.Qb(a)){var e=a.d;if(e.zb&&e.fo&&b){var g=m.setAxisAngle(f.AXIS_Y,b,A);m.normalize(g,g);m.multiply(g,e.quat,e.quat);k.v(a);d.sync_transform(a)}}else l.error("rotate_hover_cam(): wrong object")};a.get_hover_cam_angle=function(a){return c.Qb(a)?c.Co(a):(l.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,b){if(c.Qb(a)){var g=a.d;if(g.zb){var h=f.quat_to_dir(g.quat,f.AXIS_X,e),p=c.Co(a)-b,h=m.setAxisAngle(h,p,A),g=m.multiply(h,g.quat,A);
k.set_rotation(a,g);k.v(a);d.sync_transform(a)}else l.warn("set_hover_cam_angle(): undefined without distance limits")}else l.error("set_hover_cam_angle(): wrong object or camera move style")};a.get_hover_angle_limits=function(a,b){if(c.Qb(a))return a.d.Na?(b||(b=new Float32Array(2)),b[0]=a.d.Na.Pa,b[1]=a.d.Na.Ja):l.warn("get_hover_angle_limits(): camera hasn't angle limits"),b;l.error("get_hover_angle_limits(): wrong object")};a.get_cam_dist_limits=function(a,b){if(c.Qb(a)||c.ic(a))return a.d.zb?
(b||(b=new Float32Array(2)),b[0]=a.d.Pf,b[1]=a.d.Fc):l.warn("get_cam_dist_limits(): camera hasn't distance limits"),b;l.error("get_cam_dist_limits(): wrong object")};a.translate_hover_cam_v=function(a,b){if(c.Qb(a)){var e=a.d;e.zb?p.copy(b,e.Ud):k.set_translation(a,b);k.v(a);d.sync_transform(a)}else l.error("translate_hover_cam_v(): wrong object")};a.get_hover_cam_pivot=function(a,b){if(!c.Qb(a))return l.error("get_hover_cam_pivot(): wrong object"),null;b||(b=new Float32Array(3));p.copy(a.d.Ud,b);
return b};a.is_use_distance_limits=function(a){return c.ic(a)||c.Qb(a)?a.d.zb:(l.error("is_use_distance_limits(): wrong object"),null)};a.apply_vertical_limits=function(a,b,e,f){if(c.ic(a)||c.kl(a)){var g=a.d;g.za={Ja:b,Pa:e};f==k.SPACE_LOCAL&&c.Wy(a);c.um(a)}else if(c.Qb(a)){if(b>e){l.error("apply_vertical_limits(): wrong horizontal limits");return}g=a.d;g.za={Ja:-e,Pa:-b}}else{l.error("apply_vertical_limits(): wrong object");return}k.v(a);d.sync_transform(a)};a.clear_vertical_limits=function(a){a.d.za=
null;(c.ic(a)||c.kl(a))&&c.um(a)};a.apply_horizontal_limits=function(a,b,e,f){if(c.ic(a)||c.kl(a)){var g=a.d;g.pb={left:b,right:e};f==k.SPACE_LOCAL&&c.cw(a);c.um(a)}else if(c.Qb(a)){if(b>e){l.error("apply_horizontal_limits(): wrong horizontal limits");return}g=a.d;g.pb={left:b,right:e}}else{l.error("apply_horizontal_limits(): wrong object");return}k.v(a);d.sync_transform(a)};a.clear_horizontal_limits=function(a){a.d.pb=null};a.apply_hover_angle_limits=function(a,b,e){c.Qb(a)?b>e?l.error("apply_horizontal_limits(): wrong horizontal limits"):
(a.d.Na={Ja:b,Pa:e},k.v(a),d.sync_transform(a)):l.error("apply_horizontal_limits(): wrong object")};a.clear_hover_angle_limits=function(a){a.d.Na=null};a.apply_distance_limits=function(a,b,e){if(c.ic(a)||c.Qb(a))if(b>e)l.error("apply_distance_limits(): wrong distance limits");else{var f=a.d;f.zb=!0;f.Fc=b;f.Pf=e;k.v(a);d.sync_transform(a)}else l.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){c.ic(a)||c.Qb(a)?a.d.zb=!1:l.error("clear_distance_limits(): wrong object")};
a.set_eye_params=function(a,b,e){m.identity(a.d.quat);c.Tl(a,Math.PI/2);c.jq(a,b);c.Tl(a,-e);k.v(a);d.sync_transform(a)};a.is_look_up=function(a){f.quat_to_dir(a.d.quat,f.AXIS_MY,e);return 0<=e[1]?!0:!1};a.rotate=function(a,b,e){c.jq(a,b);c.Tl(a,-e);k.v(a);d.sync_transform(a)};a.get_angles=function(a,b){b||(b=new Float32Array(2));c.get_angles(a,b);return b};a.set_stereo_distance=function(a,b){for(var d=a.d.L,e=0;e<d.length;e++){var f=d[e];f.type!=c.tb&&f.type!=c.Bb||c.Dx(f,b,f.Pc)}};a.get_stereo_distance=
function(a){a=a.d.L;for(var b=0;b<a.length;b++){var d=a[b];if(d.type==c.tb||d.type==c.Bb)return d.Vh}return 0};a.is_underwater=function(a){return a.d.Wq};a.translate_view=function(a,b,d,f){a=a.d.L;for(var g=0;g<a.length;g++){var h=a[g];h.gb||c.mg(h,h.ib);var k=e;k[0]=-b;k[1]=-d;k[2]=0;t.translate(h.ia,k,h.ia);t.rotateZ(h.ia,f,h.ia);t.multiply(h.ia,h.ea,h.Cf);c.tt(h);c.st(h)}};a.correct_up=function(a,b){b||(b=f.AXIS_Y);h.correct_up(a,b)};a.zoom_object=function(a,f){if(c.ic(a)){k.get_object_center(f,
!1,e);b(a,e);k.v(a);var g=k.get_object_size(f),h=c.qv(a)/2,g=g/Math.sin(h),h=k.Lw(a,e);k.move_local(a,0,g-h,0);k.v(a);d.sync_transform(a)}else l.error("zoom_object(): wrong object")};a.calc_ray=function(a,b,d,e){e||(e=new Float32Array(3));var f=a.d.L[0];switch(f.type){case c.pc:case c.we:case c.tb:case c.Bb:var g=Math.tan(f.md*Math.PI/360);u[0]=(2*b/f.width-1)*g*f.ib;u[1]=-1;u[2]=(2*d/f.height-1)*g;u[3]=0;v.transformMat4(u,a.d.G,u);e[0]=u[0];e[1]=u[1];e[2]=u[2];p.normalize(e,e);return e;default:return l.error("Non-compatible camera"),
e}};a.project_point=function(a,b,d){d||(d=new Float32Array(2));var f=a.d.L[0];switch(f.type){case c.pc:case c.we:case c.tb:case c.Bb:return k.get_translation(a,e),p.subtract(b,e,e),u.set(e),u[3]=0,v.transformMat4(u,f.Cf,u),a=-u[1]/u[3],d[0]=(u[0]/u[3]+1)/2*f.width|0,d[1]=(a+1)/2*f.height|0,d;default:return l.error("Non-compatible camera"),d}}};b4w.module.config=function(a,n){var b=n("__config");a.P_LOW=b.P_LOW;a.P_HIGH=b.P_HIGH;a.P_ULTRA=b.P_ULTRA;a.P_CUSTOM=b.P_CUSTOM;a.set=b.set;a.get=b.get;a.reset=b.reset};b4w.module.controls=function(a,n){var b=n("__controls");n("__print");a.CT_CONTINUOUS=b.CT_CONTINUOUS;a.CT_TRIGGER=b.CT_TRIGGER;a.CT_SHOT=b.CT_SHOT;a.CT_LEVEL=b.CT_LEVEL;a.KEY_SHIFT=16;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=
74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=
221;a.KEY_SINGLE_QUOTE=222;a.create_custom_sensor=b.create_custom_sensor;a.create_keyboard_sensor=b.create_keyboard_sensor;a.create_collision_sensor=b.create_collision_sensor;a.create_collision_impulse_sensor=b.create_collision_impulse_sensor;a.create_ray_sensor=b.create_ray_sensor;a.create_mouse_click_sensor=b.create_mouse_click_sensor;a.create_mouse_wheel_sensor=b.create_mouse_wheel_sensor;a.create_mouse_move_sensor=b.create_mouse_move_sensor;a.create_touch_move_sensor=b.create_touch_move_sensor;
a.create_touch_zoom_sensor=b.create_touch_zoom_sensor;a.create_motion_sensor=b.create_motion_sensor;a.create_vertical_velocity_sensor=b.create_vertical_velocity_sensor;a.create_timer_sensor=b.create_timer_sensor;a.reset_timer_sensor=b.reset_timer_sensor;a.create_elapsed_sensor=b.create_elapsed_sensor;a.create_timeline_sensor=b.create_timeline_sensor;a.create_selection_sensor=function(a,g){return b.create_selection_sensor(a,g||!1)};a.set_custom_sensor=function(a,g){b.tx(a,g)};a.get_custom_sensor=function(a){return a.value};
a.get_sensor_value=b.get_sensor_value;a.get_sensor_payload=b.get_sensor_payload;a.sensor_make_positive=function(){throw"Deprecated method execution";};a.sensor_make_negative=function(){throw"Deprecated method execution";};a.create_sensor_lock=function(a,g,d){a.ul=g.slice(0);a.tl=Array(g.length);a.bj=d||b.Kk};a.remove_sensor_lock=function(a){a.ul=null;a.tl=null;a.bj=null};a.create_sensor_manifold=function(a,g,d,l,h,k,f){h=h||b.Kk;b.create_sensor_manifold(a,g,d,l,h,k,void 0===f?null:f)};a.create_kb_sensor_manifold=
function(a,g,d,l,h,k){l=b.create_keyboard_sensor(l);b.create_sensor_manifold(a,g,d,[l],b.Kk,h,void 0===k?null:k)};a.check_sensor_manifolds=function(a){return b.check_sensor_manifold(a,null)};a.check_sensor_manifold=b.check_sensor_manifold;a.remove_sensor_manifolds=function(a){b.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=b.remove_sensor_manifold;a.reset=b.reset;a.register_keyboard_events=b.register_keyboard_events;a.register_mouse_events=b.register_mouse_events;a.register_wheel_events=
b.register_wheel_events;a.register_touch_events=b.register_touch_events;a.unregister_keyboard_events=b.unregister_keyboard_events;a.unregister_mouse_events=b.unregister_mouse_events;a.unregister_wheel_events=b.unregister_wheel_events;a.unregister_touch_events=b.unregister_touch_events};b4w.module.constraints=function(a,n){var b=n("__constraints"),c=n("__physics"),g=n("__transform");a.append_stiff=function(a,l,h,k){l instanceof Array&&2==l.length?b.Xm(a,l[0],l[1],h,k):b.Ym(a,l,h,k);g.v(a);c.sync_transform(a)};a.append_semi_stiff=function(a,l,h,k){b.Vs(a,l,h,k);g.v(a);c.sync_transform(a)};a.append_semi_stiff_cam=function(a,l,h,k,f,p,n,m){b.Us(a,l,h,k,f,p,n,m);g.v(a);c.sync_transform(a)};a.append_semi_soft_cam=function(a,l,h,k){if(!k||0>k)k=.25;b.Ts(a,l,h,k);g.v(a);c.sync_transform(a)};
a.append_stiff_trans=function(a,l,h){b.Ws(a,l,h);g.v(a);c.sync_transform(a)};a.append_copy_trans=function(a,l,h){b.Ps(a,l,h);g.v(a);c.sync_transform(a)};a.append_stiff_trans_rot=function(a,l,h,k){b.Xs(a,l,h,k);g.v(a);c.sync_transform(a)};a.append_track=function(a,l){3==l.length?b.$s(a,l):b.Zs(a,l);g.v(a);c.sync_transform(a)};a.append_follow=function(a,l,h,k){3==l.length?b.Rs(a,l,h,k):b.Qs(a,l,h,k);g.v(a);c.sync_transform(a)};a.remove=function(a){a.Za&&b.remove(a)}};b4w.module.data=function(a,n){var b=n("__data");n("__print");var c=n("__util");a.load=b.load;a.unload=function(a){b.unload(a|0)};a.set_debug_resources_root=b.set_debug_resources_root;a.is_primary_loaded=b.is_primary_loaded;a.load_and_add_new=b.load;a.get_bpy_world=function(){c.da("get_bpy_world() deprecated");return null};a.cleanup=a.unload};b4w.module.debug=function(a,n){n("__batch");var b=n("__print"),c=n("__controls"),g=n("__debug"),d=n("__physics"),l=n("__scenegraph"),h=n("__scenes"),k=n("__sfx"),f=n("__textures"),p=n("__util"),v=n("vec3");a.physics_worker=function(){d.yu()};a.physics_id=function(a){b.log("O",d.Vu(a));for(var c=d.ov().j.l,f=0;f<c.length;f++){var g=c[f];g.fb.D==a&&b.log("B",g)}};a.visible_objects=function(){for(var a=h.get_active(),c=h.la(a,"MESH",h.DATA_ID_ALL),a=h.ga(a,"MAIN_OPAQUE").l,d=0;d<c.length;d++){var f=
c[d],e=f.d;if("DYNAMIC"==e.type)for(var g=0;g<a.length;g++){var k=a[g];if(k.P&&k.Ua==e){b.log(f.name,f);break}}}};a.object_info=function(a){for(var c=h.get_active(),d=h.la(c,"MESH",h.DATA_ID_ALL),f=0;f<d.length;f++){var e=d[f];if(e.name==a){b.log("Object",e);for(var g=h.$k(c),k=0;k<g.length;k++){for(var l=g[k],p=l.l,n=[],v=0;v<p.length;v++)p[v].Ua==e.d&&n.push(p[v]);b.log("Subscene "+l.type,n)}}}};a.objects_stat=function(){var a=h.get_active();console.log("Armatures: "+h.la(a,"ARMATURE",h.DATA_ID_ALL).length);
console.log("Cameras: "+h.la(a,"CAMERA",h.DATA_ID_ALL).length);console.log("Curves: "+h.la(a,"CURVE",h.DATA_ID_ALL).length);console.log("Empties: "+h.la(a,"EMPTY",h.DATA_ID_ALL).length);console.log("Lamps: "+h.la(a,"LAMP",h.DATA_ID_ALL).length);console.log("Meshes: "+h.la(a,"MESH",h.DATA_ID_ALL).length);console.log("Speakers: "+h.la(a,"SPEAKER",h.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=h.get_active(),b=[h.ga(b,"MAIN_OPAQUE"),h.ga(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];
if(d)for(var d=d.l,e=0;e<d.length;e++){var f=d[e].k;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=h.get_active(),b=[h.ga(b,"MAIN_OPAQUE"),h.ga(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.l,e=0;e<d.length;e++){var f=d[e].k;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){var a=h.get_active(),a=[h.ga(a,"MAIN_OPAQUE"),h.ga(a,"MAIN_BLEND")];return a[0].l.length+a[1].l.length};a.geometry_stats=function(){for(var a=h.get_active(),b=h.$k(a),
a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.l,f=0;f<e.length;f++){var g=e[f].k,k=e[f].Ua;g&&("COLOR_PICKING"!=d.type&&"GLOW_MASK"!=d.type||k.lj)&&(a[g.id]=g)}}var e=d=c=b=0,l;for(l in a)g=a[l],g=g.ab,g.Fi&&(d++,e+=g.Fi/1048576),b++,c+=g.Yn/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=h.get_active(),c=[h.ga(c,"MAIN_OPAQUE"),h.ga(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=
e.l,f=0;f<e.length;f++){var g=e[f].k;if(g)for(var g=g.R,k=0;k<g.length;k++){var l=g[k];if("IMAGE"===l.source||"ENVIRONMENT_MAP"===l.source){var p=l.Fa;-1===a.indexOf(p)&&(a.push(p),l=l.width*l.height*4/1048576/l.zk,l*=1.3333,b+=l)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=h.get_active(),c=h.$k(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var g=e.h,k=[g.bb,g.gc];k.push.apply(k,e.Rc);for(e=0;e<k.length;e++){var l=k[e];f.th(l)&&-1==a.indexOf(l)&&
(a.push(l),b+=g.width*g.height*f.Nv(l))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=h.get_active();(a=h.ga(a,"MAIN_OPAQUE"))&&h.qp(a.h,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=h.get_active(),b=h.ga(a,"MAIN_OPAQUE"),a=h.jy(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}h.qp(d.h,b,e)}};a.scenegraph_to_dot=function(){var a=h.get_active();
b.log(l.vu(h.bl(a)))};a.controls_info=c.debug;a.object_distance=function(a,b){return v.dist(a.d.e,b.d.e)};a.msg=g.msg;a.fbmsg=g.fbmsg;a.print_telemetry=g.print_telemetry;a.plot_telemetry=g.plot_telemetry;a.fbres=function(a,b){function c(){g.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),f=new Float32Array([-1,0,0]),g=new Float32Array([0,
-1,0]),h=new Float32Array([0,0,-1]);if(!p.Kd(a,p.zs))throw"Wrong VEC3_IDENT";if(!p.Kd(b,p.us))throw"Wrong QUAT4_IDENT";if(!p.Kd(c,p.AXIS_X))throw"Wrong AXIS_X";if(!p.Kd(d,p.AXIS_Y))throw"Wrong AXIS_Y";if(!p.Kd(e,p.AXIS_Z))throw"Wrong AXIS_Z";if(!p.Kd(f,p.AXIS_MX))throw"Wrong AXIS_MX";if(!p.Kd(g,p.AXIS_MY))throw"Wrong AXIS_MY";if(!p.Kd(h,p.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=k.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==k.dl(c)&&k.mute(c,!0)}};
a.check_finite=function(a){g.check_finite(a)};a.set_debug_params=function(a){var b=h.get_active();if(b=h.ga(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&h.Jx(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&h.Ix(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return b.Ev()};a.get_warning_quantity=function(){return b.Qv()};a.clear_errors_warnings=function(){return b.clear_errors_warnings()}};b4w.module.geometry=function(a,n){function b(a){return a&&a.d&&a.d.kd?!0:!1}var c=n("__batch"),g=n("__geometry"),d=n("__print"),l=n("__renderer");a.extract_vertex_array=function(a,k,f){if(!b(a))return d.error("Wrong object:",a.name),null;if(a=c.S(a,k,"MAIN")||c.S(a,k,"NODES")){if((k=a.ab)&&k.Ib&&k.Ib[f])return g.Nu(k,f);d.error("Attribute not found:"+f);return null}d.error("Wrong material:",k);return null};a.extract_index_array=function(a,g){if(!b(a))return d.error("Wrong object:",a.name),null;var f=
c.S(a,g,"MAIN")||c.S(a,g,"NODES");if(f){if((f=f.ab)&&f.Ib)return f.Vd;d.error("Buffer data not found");return null}d.error("Wrong material:",g);return null};a.update_vertex_array=function(a,k,f,l){var n=["MAIN","NODES","DEPTH","COLOR_ID"];if(b(a))for(var m=0;m<n.length;m++){var x=c.S(a,k,n[m]);x&&(x=x.ab)&&x.Ib&&x.Ib[f]&&g.Mj(x,f,0,l)}else d.error("Wrong object:",a.name)};a.override_geometry=function(a,k,f,p,n){var m=["MAIN","NODES","DEPTH","COLOR_ID"];if(b(a))if(f instanceof Uint16Array||f instanceof
Uint32Array)if(p instanceof Float32Array)for(var x=0;x<m.length;x++){var t=c.S(a,k,m[x]);if(t){var z=t.ab;if(z){g.zy(z,t.jd,f);var e=0,B;for(B in z.Ib)var A=z.Ib[B],e=e+p.length/3*A.Ic;z.Uc=new Float32Array(e);var e=z.Uc,u=0;for(B in z.Ib)switch(A=z.Ib[B],B){case "a_position":e.set(p,u);A.offset=u;A.length=p.length;u+=A.length;break;case "a_normal":var s;n&&(s=g.sn(f,p,p));var q=g.qn(f,p,s);e.set(q,u);A.offset=u;A.length=p.length;u+=A.length;break;case "a_tangent":A.offset=u;A.length=p.length/3*A.Ic;
for(var K=new Float32Array(A.length),q=0;q<K.length;q+=4)K[q]=1,K[q+3]=1;e.set(K,u);u+=A.length;break;default:A.offset=u,A.length=p.length/3*A.Ic,q=new Float32Array(A.length),e.set(q,u),u+=A.length}g.Ey(z);l.$m(t);if(t.vb)for(q=0;q<t.vb.length;q++)(A=t.vb[q])&&A.ab&&(A.ab=z)}}}else d.error("Wrong positions_array type");else d.error("Wrong ibo_array type");else d.error("Wrong object:",a.name)}};b4w.module.hud=function(a,n){var b=n("__hud");n("__print");a.draw_mixer_strip=b.draw_mixer_strip;a.plot_array=b.plot_array};b4w.module.lights=function(a,n){function b(a){for(var b=d.get_active(),p=d.la(b,"LAMP",d.DATA_ID_ALL),n=0;n<p.length;n++){var e=p[n];if("SUN"==e.Ga.type){var v=e;break}}if(!v)return c.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(p=(90-a.vert_position)/180*Math.PI,n=v.d,l.set_rotation_euler(v,[p,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),h.quat_to_dir(n.quat,h.AXIS_Y,a),n=k.length(n.e),k.copy(a,f),k.scale(f,n,f),l.set_translation(v,
f),l.v(v),a=v.Ga,a.eo&&(e=v.data.energy,n=b.world.light_settings.environment_energy,p=Math.cos(Math.abs(p)),e*=Math.max(Math.min(3*p,1),0),p=Math.max(p,.1)*n,g.pq(a,e),d.set_environment_colors(b,p,null,null)),d.Oj(v,b))}var c=n("__print"),g=n("__lights"),d=n("__scenes"),l=n("__transform"),h=n("__util"),k=n("vec3"),f=new Float32Array(3),p,v=60;a.get_lamps=function(a){var b=d.get_active(),b=d.la(b,"LAMP",d.DATA_ID_ALL);if(!a)return b;for(var c=[],f=0;f<b.length;f++){var e=b[f];e.Ga.type===a&&c.push(e)}return c};
a.get_sun_params=function(){for(var a=d.get_active(),a=d.la(a,"LAMP",d.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var f=a[c];if("SUN"==f.Ga.type){b=f;break}}return b?(b=b.Ga.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=b;a.set_day_time=function(a){for(var f=d.get_active(),f=d.la(f,"LAMP",d.DATA_ID_ALL),g=0;g<f.length;g++){var h=f[g];if("SUN"==h.Ga.type){var e=
h;break}}if(!e)return c.error("There is no sun on the scene"),null;e=-Math.cos(a/12*Math.PI)*v;f={};f.hor_position=12>a?15*a:15*(a-24);f.vert_position=e;b(f)};a.set_date=function(a){(p=a.getDate())?1582==p&&10==a.YA&&4<a.uu&&15>a.uu&&c.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):c.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){v=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){var b=d.get_active();if(!b)return c.error("No active scene"),
!1;for(var b=d.la(b,"LAMP",d.DATA_ID_ALL),f=0;f<b.length;f++){var g=b[f];if(g.name===a){var e=g.Ga;break}}return e?{light_color:e.color,light_energy:e.Uf}:!1};a.set_light_params=function(a,b){var f=d.get_active();if(!f)return c.error("No active scene"),!1;for(var h=d.la(f,"LAMP",d.DATA_ID_ALL),e=0;e<h.length;e++){var k=h[e];if(k.name===a){var l=k.Ga;break}}if(!l)return c.error('B4W Warning: light "'+a+'" not found'),!1;"number"==typeof b.light_energy&&(g.pq(l,b.light_energy),d.Oj(k,f));"object"==
typeof b.light_color&&(g.Ax(l,b.light_color),d.Oj(k,f))};a.get_lights_names=function(){var a=d.get_active();if(!a)return c.error("No active scene"),!1;for(var b=[],a=d.la(a,"LAMP",d.DATA_ID_ALL),f=0;f<a.length;f++)b.push(a[f].Ga.name);return b}};b4w.module.material=function(a,n){function b(a,b){for(var c=a.O,d=0;d<c.length;d++){var e=c[d];if(-1<e.tc.indexOf(b))return"MAIN"==e.type}return!1}function c(a,b){var c=d.S(a,b,"MAIN");return Boolean(c&&c.lc[0])}function g(a,b){var c=d.S(a,b,"MAIN");return Boolean(c&&c.lc[1])}var d=n("__batch"),l=n("__config"),h=n("__print"),k=n("__shaders"),f=n("__util");n("vec4");var p=l.n,v="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.max_bones=function(){h.error("max_bones() deprecated, return default value");
return p.max_bones};a.set_max_bones=function(){h.error("set_max_bones() deprecated")};a.set_batch_param=function(){h.error("set_batch_param() deprecated")};a.inherit_material=function(a,b,c,g){if(f.ep(c)&&f.ep(a)){for(var e=["MAIN","DEPTH","COLOR_ID"],k=!1,l=0;l<e.length;l++){var p=e[l],n=d.S(a,b,p),q=d.S(c,g,p);if(n&&q)for(k=!0,"MAIN"==p&&(q.nb.set(n.nb),q.Le=n.Le,q.zd.set(n.zd),q.lc.set(n.lc),q.Qd=n.Qd,q.Bc=n.Bc,q.Bc=n.Bc,q.Ke=n.Ke,q.ye=n.ye),p=0;p<q.$b.length;p++){var K=q.$b[p];if(-1!==v.indexOf(K)){var H=
n.$b.indexOf(K);if(-1!==H&&(q.R[p]=n.R[H],q.vb))for(p=0;p<q.vb.length;p++){var y=q.vb[p],J=y.$b.indexOf(K);-1!==J&&(y.R[J]=n.R[H])}}}}k||h.error("Wrong objects for inheriting material!")}else h.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++)b.push(a[c].name);return b};a.set_diffuse_color=function(a,b,c){(a=d.S(a,b,"MAIN"))?a.nb.set(c):h.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=
d.S(a,b,"MAIN");if(c){var f=Array(4);f[0]=c.nb[0];f[1]=c.nb[1];f[2]=c.nb[2];f[3]=c.nb[3];return f}h.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){(a=d.S(a,b,"MAIN"))?a.Le=c:h.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var c=d.S(a,b,"MAIN");if(c)return c.Le;h.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){(a=d.S(a,b,"MAIN"))?a.zd.set(c):h.error('Couldn\'t set property "specular_color"!')};
a.get_specular_color=function(a,b){var c=d.S(a,b,"MAIN");if(c){var f=Array(3);f[0]=c.zd[0];f[1]=c.zd[1];f[2]=c.zd[2];return f}h.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,b,f){c(a,b)||h.error('Property "specular_intensity" is missing!');d.S(a,b,"MAIN").lc[0]=f};a.get_specular_intensity=function(a,b){c(a,b)||h.error('Property "specular_intensity" is missing!');return d.S(a,b,"MAIN").lc[0]};a.check_specular_intensity=c;a.set_specular_hardness=function(a,b,
c){g(a,b)||h.error('Property "specular_hardness" is missing!');d.S(a,b,"MAIN").lc[1]=c};a.get_specular_hardness=function(a,b){g(a,b)||h.error('Property "specular_hardness" is missing!');return d.S(a,b,"MAIN").lc[1]};a.check_specular_hardness=g;a.set_emit_factor=function(a,b,c){(a=d.S(a,b,"MAIN"))?a.Qd=c:h.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var c=d.S(a,b,"MAIN");if(c)return c.Qd;h.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,
b,c){(a=d.S(a,b,"MAIN"))?a.Bc=c:h.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=d.S(a,b,"MAIN");if(c)return c.Bc;h.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,c){(a=d.S(a,b,"MAIN"))?a.Ke=c:h.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=d.S(a,b,"MAIN");if(c)return c.Ke;h.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,
b){var c=d.S(a,b,"MAIN");c?c.ye=alpha_factor:h.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=d.S(a,b,"MAIN");if(c)return c.ye;h.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,c){if(!a||!c)return h.error("B4W Error: missing arguments in get_material_params"),null;if(!b(a,c))return null;var f=d.S(a,c,"MAIN");if(!f)return null;var g={};"MAIN"==f.type&&(g.Lh=f.Lh,g.jA=f.nd[2],g.kA=5*(1-f.nd[3]),g.Dh=f.Dh,g.fB=d.eb(f,
"PARALLAX_STEPS")[1]);return g};a.get_water_material_params=function(a,c){if(!a||!c)return h.error("B4W Error: missing arguments in get_water_material_params"),null;if(!b(a,c))return null;var f=d.S(a,c,"MAIN");if(!f||!f.re)return null;if(!f)return h.warn("B4W Warning: material not found"),null;var g={};if("MAIN"==f.type){if(p.ng){var e=g.shallow_water_col=Array(3);e[0]=f.shallow_water_col[0];e[1]=f.shallow_water_col[1];e[2]=f.shallow_water_col[2];e=g.shore_water_col=Array(3);e[0]=f.shore_water_col[0];
e[1]=f.shore_water_col[1];e[2]=f.shore_water_col[2];g.shallow_water_col_fac=f.shallow_water_col_fac;g.shore_water_col_fac=f.shore_water_col_fac}g.foam_factor=f.foam_factor;g.absorb_factor=d.eb(f,"ABSORB")[1];g.sss_strength=d.eb(f,"SSS_STRENGTH")[1];g.sss_width=d.eb(f,"SSS_WIDTH")[1];g.dst_noise_scale0=d.eb(f,"DST_NOISE_SCALE_0")[1];g.dst_noise_scale1=d.eb(f,"DST_NOISE_SCALE_1")[1];g.dst_noise_freq0=d.eb(f,"DST_NOISE_FREQ_0")[1];g.dst_noise_freq1=d.eb(f,"DST_NOISE_FREQ_1")[1];g.dir_min_shore_fac=d.eb(f,
"DIR_MIN_SHR_FAC")[1];g.dir_freq=d.eb(f,"DIR_FREQ")[1];g.dir_noise_scale=d.eb(f,"DIR_NOISE_SCALE")[1];g.dir_noise_freq=d.eb(f,"DIR_NOISE_FREQ")[1];g.dir_min_noise_fac=d.eb(f,"DIR_MIN_NOISE_FAC")[1];g.dst_min_fac=d.eb(f,"DST_MIN_FAC")[1];g.waves_hor_fac=d.eb(f,"WAVES_HOR_FAC")[1]}return g};a.set_material_extended_params=function(a,c,f){if(a&&c&&f){if(!b(a,c))return h.warn("B4W Warning: setting material params is not possible"),null;a=d.S(a,c,"MAIN");a?"MAIN"==a.type&&("number"==typeof f.material_reflectivity&&
(a.Lh=f.material_reflectivity),"number"==typeof f.material_fresnel&&(a.nd[2]=f.material_fresnel),"number"==typeof f.material_fresnel_factor&&(a.nd[3]=1-f.material_fresnel_factor/5),"number"==typeof f.material_parallax_scale&&(a.Dh=f.material_parallax_scale),"number"==typeof f.material_parallax_steps&&(f=k.u(parseFloat(f.material_parallax_steps)),d.T(a,"PARALLAX_STEPS",f),d.sb(a,!0))):h.warn("B4W Warning: material not found")}else h.error("B4W Error: missing arguments in set_material_params")};a.set_water_material_params=
function(a,c,f){if(!a||!c||!f)return h.error("B4W Error: missing arguments in set_water_material_params"),null;if(!b(a,c))return h.warn("B4W Warning: setting water material params is not possible"),null;a=d.S(a,c,"MAIN");if(!a)return h.warn("B4W Warning: material not found"),null;"MAIN"==a.type&&(p.ng&&("object"==typeof f.shallow_water_col&&a.shallow_water_col.set(f.shallow_water_col),"number"==typeof f.shallow_water_col_fac&&(a.shallow_water_col_fac=f.shallow_water_col_fac),"object"==typeof f.shore_water_col&&
a.shore_water_col.set(f.shore_water_col),"number"==typeof f.shore_water_col_fac&&(a.shore_water_col_fac=f.shore_water_col_fac)),p.shore_smoothing&&a.zm&&("boolean"==typeof f.shore_smoothing&&(f.shore_smoothing?d.T(a,"SHORE_SMOOTHING",1):d.T(a,"SHORE_SMOOTHING",0)),"number"==typeof f.absorb_factor&&(c=k.u(parseFloat(f.absorb_factor)),d.T(a,"ABSORB",c))),"number"==typeof f.foam_factor&&p.Wf&&(a.foam_factor=f.foam_factor),p.water_dynamic&&a.water_dynamic&&("boolean"==typeof f.water_dynamic&&(f.water_dynamic?
d.T(a,"DYNAMIC",1):d.T(a,"DYNAMIC",0)),"number"==typeof f.waves_height&&(c=k.u(parseFloat(f.waves_height)),d.T(a,"WAVES_HEIGHT",c)),"number"==typeof f.waves_length&&(c=k.u(parseFloat(f.waves_length)),d.T(a,"WAVES_LENGTH",c)),"number"==typeof f.sss_strength&&(c=k.u(parseFloat(f.sss_strength)),d.T(a,"SSS_STRENGTH",c)),"number"==typeof f.sss_width&&(c=k.u(parseFloat(f.sss_width)),d.T(a,"SSS_WIDTH",c)),"number"==typeof f.dst_noise_scale0&&(c=k.u(parseFloat(f.dst_noise_scale0)),d.T(a,"DST_NOISE_SCALE_0",
c)),"number"==typeof f.dst_noise_scale1&&(c=k.u(parseFloat(f.dst_noise_scale1)),d.T(a,"DST_NOISE_SCALE_1",c)),"number"==typeof f.dst_noise_freq0&&(c=k.u(parseFloat(f.dst_noise_freq0)),d.T(a,"DST_NOISE_FREQ_0",c)),"number"==typeof f.dst_noise_freq1&&(c=k.u(parseFloat(f.dst_noise_freq1)),d.T(a,"DST_NOISE_FREQ_1",c)),"number"==typeof f.dir_min_shore_fac&&(c=k.u(parseFloat(f.dir_min_shore_fac)),d.T(a,"DIR_MIN_SHR_FAC",c)),"number"==typeof f.dir_freq&&(c=k.u(parseFloat(f.dir_freq)),d.T(a,"DIR_FREQ",c)),
"number"==typeof f.dir_noise_scale&&(c=k.u(parseFloat(f.dir_noise_scale)),d.T(a,"DIR_NOISE_SCALE",c)),"number"==typeof f.dir_noise_freq&&(c=k.u(parseFloat(f.dir_noise_freq)),d.T(a,"DIR_NOISE_FREQ",c)),"number"==typeof f.dir_min_noise_fac&&(c=k.u(parseFloat(f.dir_min_noise_fac)),d.T(a,"DIR_MIN_NOISE_FAC",c)),"number"==typeof f.dst_min_fac&&(c=k.u(parseFloat(f.dst_min_fac)),d.T(a,"DST_MIN_FAC",c)),"number"==typeof f.waves_hor_fac&&(f=k.u(parseFloat(f.waves_hor_fac)),d.T(a,"WAVES_HOR_FAC",f))),d.sb(a,
!0));return!0}};b4w.module.particles=function(a,n){var b=n("__particles"),c=n("__print");a.set_size=function(a,d,l){b.bg(a)?b.set_size(a,d,l):c.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,d,l){b.bg(a)?b.set_normal_factor(a,d,l):c.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,d,l){b.bg(a)?(l=Math.min(l,1),l=Math.max(l,0),b.set_factor(a,d,l)):c.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,n){var b=n("__print"),c=n("__physics"),g=n("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){c.has_physics(a)?c.enable_simulation(a):b.error("No physics for object "+a.name)};a.disable_simulation=function(a){c.has_physics(a)?c.disable_simulation(a):b.error("No physics for object "+a.name)};a.has_physics=function(a){return c.has_physics(a)};a.has_simulated_physics=function(a){return c.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return c.has_dynamic_physics(a)};a.set_gravity=function(a,g){c.has_physics(a)?c.set_gravity(a,g):b.error("No physics for object "+a.name)};a.set_damping=function(a,g,h){c.has_physics(a)?c.m("set_damping",a.j.D,g,h):b.error("No physics for object "+a.name)};a.reset_damping=function(a){if(c.has_physics(a)){var g=a.game;c.m("set_damping",a.j.D,g.damping,g.rotation_damping)}else b.error("No physics for object "+a.name)};a.set_transform=function(a,g,h){c.has_physics(a)?c.set_transform.apply(this,
arguments):b.error("No physics for object "+a.name)};a.sync_transform=function(a){c.has_physics(a)?c.sync_transform(a):b.error("No physics for object "+a.name)};a.apply_velocity=function(a){c.has_physics(a)?c.apply_velocity.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){c.has_physics(a)?c.apply_velocity_world.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_force=function(a,g,h,k){c.has_physics(a)?c.apply_force.apply(this,
arguments):b.error("No physics for object "+a.name)};a.apply_torque=function(a,g,h,k){c.has_physics(a)?c.apply_torque.apply(this,arguments):b.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_throttle(a,g.clamp(l,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,l,h){if(c.has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");
l=g.clamp(l,0,1);var k=a.f.Vf;-1==h||1==h?k=Math.max(-1,Math.min(k+h*l,1)):0==h&&0<=k?(k-=l,k=Math.max(0,k)):0==h&&0>k?(k+=l,k=Math.min(0,k)):b.error("Wrong steering direction");c.vehicle_throttle(a,g.clamp(k,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_steer=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_steer(a,g.clamp(l,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,l,h){if(c.has_physics(a)){c.is_vehicle_chassis(a)||
c.is_vehicle_hull(a)||b.error("Wrong object");l=g.clamp(l,0,1);var k=a.f.ug;-1==h||1==h?k=Math.max(-1,Math.min(k+h*l,1)):0==h&&0<=k?(k-=l,k=Math.max(0,k)):0==h&&0>k?(k+=l,k=Math.min(0,k)):b.error("Wrong steering direction");c.vehicle_steer(a,g.clamp(k,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_brake=function(a,l){c.has_physics(a)?(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object"),c.vehicle_brake(a,g.clamp(l,0,1))):b.error("No physics for object "+a.name)};
a.vehicle_brake_inc=function(a,l){if(c.has_physics(a)){c.is_vehicle_chassis(a)||c.is_vehicle_hull(a)||b.error("Wrong object");l=g.clamp(l,-1,1);var h=a.f.Vg;c.vehicle_brake(a,g.clamp(h+h*l,0,1))}else b.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return c.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return c.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!c.has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;
b.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!c.has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.f.Vf;b.error("Wrong object")};a.get_vehicle_steering=function(a){if(!c.has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.f.ug;b.error("Wrong object")};a.get_vehicle_brake=function(a){if(!c.has_physics(a))return b.error("No physics for object "+
a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return a.f.Vg;b.error("Wrong object")};a.get_vehicle_speed=function(a){if(!c.has_physics(a))return b.error("No physics for object "+a.name),null;if(c.is_vehicle_chassis(a)||c.is_vehicle_hull(a))return c.get_vehicle_speed(a);b.error("Wrong object")};a.is_character=function(a){return c.is_character(a)};a.set_character_move_dir=function(a,g,h){c.has_physics(a)?c.set_character_move_dir(a,g,h):b.error("No physics for object "+a.name)};a.set_character_move_type=
function(a,g){c.has_physics(a)?c.set_character_move_type(a,g):b.error("No physics for object "+a.name)};a.set_character_dist_to_water=function(){b.warn("Function set_character_dist_to_water() is deprecated")};a.set_character_walk_velocity=function(a,g){c.has_physics(a)?c.set_character_walk_velocity(a,g):b.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,g){c.has_physics(a)?c.set_character_run_velocity(a,g):b.error("No physics for object "+a.name)};a.set_character_fly_velocity=
function(a,g){c.has_physics(a)?c.set_character_fly_velocity(a,g):b.error("No physics for object "+a.name)};a.character_jump=function(a){c.has_physics(a)?c.character_jump(a):b.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,g,h){c.has_physics(a)?c.character_rotation_inc(a,g,h):b.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,g){c.has_physics(a)?c.set_character_rotation_quat(a,g):b.error("No physics for object "+a.name)};a.set_character_rotation=
function(a,g,h){c.has_physics(a)?c.set_character_rotation(a,g,h):b.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,g){c.has_physics(a)?c.set_character_rotation_v(a,g):b.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,g){c.has_physics(a)?c.set_character_rotation_h(a,g):b.error("No physics for object "+a.name)};a.append_collision_test=function(a,g,h,k){c.has_physics(a)?c.append_collision_test(a,g,h,k):b.error("No physics for object "+a.name)};
a.remove_collision_test=function(a,g){c.has_physics(a)?c.remove_collision_test(a,g):b.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,g){c.has_physics(a)?c.apply_collision_impulse_test(a,g):b.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){c.has_physics(a)?c.clear_collision_impulse_test(a):b.error("No physics for object "+a.name)};a.append_ray_test=function(a,g,h,k,f,p){c.has_physics(a)?c.append_ray_test(a,g,h,k,f,p):b.error("No physics for object "+
a.name)};a.remove_ray_test=function(a,g,h,k,f){c.has_physics(a)?c.remove_ray_test(a,g,h,k,f):b.error("No physics for object "+a.name)};a.apply_constraint=function(a,g,h,k,f,p,n,m,x,t){c.has_physics(g)&&c.has_physics(f)?c.apply_constraint(a,g,h,k,f,p,n,m,x,t):b.error("Wrong objects")};a.clear_constraint=function(a){c.has_physics(a)&&c.Zv(a)?c.clear_constraint(a):b.error("Wrong object")};a.pull_to_constraint_pivot=function(a,g,h,k,f,p){c.has_physics(a)&&c.has_physics(k)?c.pull_to_constraint_pivot(a,
g,h,k,f,p):b.error("Wrong objects")}};b4w.module.scenes=function(a,n){var b=n("__batch"),c=n("__camera"),g=n("__graph"),d=n("__print"),l=n("__physics"),h=n("__scenes"),k=n("__util");a.DATA_ID_ALL=h.DATA_ID_ALL;a.set_active=function(a){var b=h.Ki();h.set_active(k.keysearch("name",a,b))};a.get_active=function(){return h.V()?h.get_active().name:""};a.get_scenes=function(){for(var a=h.Ki(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=function(){if(h.V())return h.get_active().camera;d.error("No active scene");return!1};
a.get_object_by_name=function(a,b){return h.Mi(h.Xj,a,b)};a.get_object_by_dupli_name=function(a,b,c){return h.Mi(h.Fm,a,b,c)};a.get_object_by_dupli_name_list=function(a,b){return h.Mi(h.Gm,a,b)};a.get_object_by_empty_name=function(b,c,g){d.warn("get_object_by_empty_name() deprecated, use get_object_by_dupli_name() instead");return a.get_object_by_dupli_name(b,c,g)};a.get_object_data_id=function(a){return h.get_object_data_id(a)};a.pick_object=h.pick_object;a.set_glow_intensity=function(a,b){for(var c=
0;c<a.O.length;c++){var d=a.O[c];"COLOR_ID"==d.type&&(d.$f=b)}};a.apply_glow_anim=function(a,b,c,d){a.d&&a.d.Kc&&h.apply_glow_anim(a,b,c,d)};a.apply_glow_anim_def=function(a){if(a.d&&a.d.Kc){var b=a.d.Ni;h.apply_glow_anim(a,b.Sv,b.Uv,b.Vv)}};a.clear_glow_anim=function(a){a.d&&a.d.Kc&&h.clear_glow_anim(a)};a.set_glow_color=function(a){var b=h.get_active();if(b=h.ga(b,"GLOW"))b.oh.set(a),b.ta=!0};a.get_shadow_params=function(){if(!h.V())return d.error("No active scene"),!1;var a=h.get_active(),b=h.ga(a,
"SHADOW_CAST");if(!b)return null;var c=a.d.wc,g=h.ga(a,"MAIN_OPAQUE"),k=h.ga(a,"DEPTH"),l={};l.csm_resolution=c.csm_resolution;l.self_shadow_polygon_offset=b.self_shadow_polygon_offset;k&&(l.self_shadow_normal_offset=k.self_shadow_normal_offset);l.b4w_enable_csm=c.b4w_enable_csm;l.csm_num=c.csm_num;l.csm_first_cascade_border=c.csm_first_cascade_border;l.first_cascade_blur_radius=c.first_cascade_blur_radius;l.csm_last_cascade_border=c.csm_last_cascade_border;l.last_cascade_blur_radius=c.last_cascade_blur_radius;
l.fade_last_cascade=c.fade_last_cascade;l.blend_between_cascades=c.blend_between_cascades;c.b4w_enable_csm?(l.csm_borders=h.Av(a,g.h),l.blur_radii=new Float32Array(c.csm_num),l.blur_radii.set(g.h.rj.subarray(0,c.csm_num))):(l.csm_borders=null,l.blur_radii=null);return l};a.set_shadow_params=function(a){if(!h.V())return d.error("No active scene"),!1;var k=h.get_active();"number"==typeof a.self_shadow_polygon_offset&&g.J(k.d.Ma,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});
var l=h.ga(k,"DEPTH");l&&("number"==typeof a.self_shadow_normal_offset&&(l.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(l.pcf_blur_radius=a.pcf_blur_radius));var m=h.ga(k,"MAIN_BLEND");m&&("number"==typeof a.self_shadow_normal_offset&&(m.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(m.pcf_blur_radius=a.pcf_blur_radius),m.ta=!0);m=k.d.wc;"number"==typeof a.csm_first_cascade_border&&(m.csm_first_cascade_border=
a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(m.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(m.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&(m.last_cascade_blur_radius=a.last_cascade_blur_radius);if(l){for(var n=l.l,t=0;t<n.length;t++){var z=n[t];z.Ua.rb&&(z=z.k,b.gk(z,m),b.sb(z))}l.ta=!0}l=k.camera.d.L;for(t=0;t<l.length;t++)c.Nj(l[t],m);h.Ul(k)};a.get_environment_colors=
function(){if(!h.V())return d.error("No active scene"),!1;var a=h.get_active();return h.get_environment_colors(a)};a.set_environment_colors=function(a,b,c){if(!h.V())return d.error("No active scene"),!1;var g=h.get_active();h.set_environment_colors(g,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!h.V())return d.error("No active scene"),!1;var b=h.get_active();return h.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!h.V())return d.error("No active scene"),!1;var b=
h.get_active();h.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!h.V())return d.error("No active scene"),!1;var a=h.get_active();return h.get_ssao_params(a)};a.set_ssao_params=function(a){if(!h.V())return d.error("No active scene"),!1;var b=h.get_active();h.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!h.V())return d.error("No active scene"),null;var a=h.get_active(),a=h.ga(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;
b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!h.V())return d.error("No active scene"),null;var b=h.get_active(),b=h.ga(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.ta=!0};a.get_sky_params=function(){if(!h.V())return d.error("No active scene"),
!1;var a=h.get_active();return h.get_sky_params(a)};a.set_sky_params=function(a){if(!h.V())return d.error("No active scene"),!1;var b=h.get_active();h.set_sky_params(b,a)};a.get_dof_params=function(){if(!h.V())return d.error("No active scene"),!1;var a=h.get_active();return h.ga(a,"DOF")?h.get_dof_params(a):null};a.set_dof_params=function(a){if(!h.V())return d.error("No active scene"),!1;var b=h.get_active();h.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!h.V())return d.error("No active scene"),
!1;var a=h.get_active();return h.ga(a,"GOD_RAYS")?h.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!h.V())return d.error("No active scene"),!1;var b=h.get_active();h.set_god_rays_params(b,a)};a.get_bloom_params=function(){if(!h.V())return d.error("No active scene"),!1;var a=h.get_active();return h.ga(a,"BLOOM")?h.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!h.V())return d.error("No active scene"),!1;var b=h.get_active();h.set_bloom_params(b,a)};a.get_wind_params=
function(){return h.get_wind_params()};a.set_wind_params=function(a){if(!h.V())return d.error("No active scene"),!1;var b=h.get_active();h.set_wind_params(b,a)};a.get_water_surface_level=h.get_water_surface_level;a.set_water_params=function(a){if(!h.V())return d.error("No active scene"),!1;var b=h.get_active();h.set_water_params(b,a)};a.get_water_mat_params=function(a){if(!h.V())return d.error("No active scene"),!1;var b=h.get_active();h.get_water_mat_params(b,a)};a.update_scene_materials_params=
function(){if(!h.V())return d.error("No active scene"),!1;var a=h.get_active();h.$q(a)};a.hide_object=function(a){h.hide_object(a)};a.show_object=function(a){h.show_object(a)};a.is_visible=function(a){return a.d.is_visible};a.check_object=function(a){return h.V()?h.check_object(a,h.get_active()):(d.error("No active scene"),!1)};a.get_all_objects=function(a,b){var c=h.get_active();a||(a="ALL");b||0===b||(b=h.DATA_ID_ALL);return h.la(c,a,b)};a.get_appended_objs=function(b,c){d.warn("get_appended_objs() deprecated, use get_all_objects() instead");
return a.get_all_objects(b,c)};a.get_object_name=function(a){return a?a.name:(d.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(d.error("Wrong object ID"),"UNDEFINED")};a.get_object_dg_parent=function(a){return a.Cb};a.get_object_children=function(a){return a.Dd.slice(0)};a.get_first_character=function(){for(var a=h.la(h.get_active(),"MESH",h.DATA_ID_ALL),b=0;b<a.length;b++){var c=a[b];if(l.is_character(c))return c}return null};a.get_shore_dist=function(a,b){b||
0===b||(b=1);return h.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return h.get_cam_water_depth()};a.get_type_mesh_object=function(a){return"MESH"==a.type?a.d.type:null};a.append_object=function(){k.da('Method "append_object" is deprecated')};a.add_object=function(){k.da('Method "add_object" is deprecated')};a.remove_object=function(){k.da('Method "remove_object" is deprecated')};a.get_screen_scenes=function(){k.da("get_screen_scenes() deprecated")};a.set_light_pos=function(){k.da("set_light_pos() deprecated, use lights module instead")};
a.set_light_direction=function(){k.da("set_light_direction() deprecated, use lights module instead")};a.set_dir_light_color=function(){k.da("set_dir_light_color() deprecated, use lights module instead")};a.get_lights_names=function(){k.da("get_lights_names() deprecated, use lights module instead")};a.remove_all=function(){k.da("remove_all() deprecated, use lights module instead")};a.check_collision=function(){k.da("check_collision() deprecated, use lights module instead")};a.check_ray_hit=function(){k.da("check_ray_hit() deprecated, use lights module instead")}};b4w.module.sfx=function(a,n){var b=n("__scenes"),c=n("__sfx");a.play=function(a,b,l){c.play(a,b,l)};a.play_def=function(a){c.play_def(a)};a.is_play=function(a){return c.is_play(a)};a.speaker_play=function(a,b,l,h){c.cyclic(a,b);h&&c.playrate(a,h);c.play(a,0,l)};a.speaker_stop=function(a){c.stop(a)};a.stop=function(a){c.stop(a)};a.speaker_playback_rate=function(a,b){c.playrate(a,b)};a.playrate=function(a,b){c.playrate(a,b)};a.cyclic=function(a,b){c.cyclic(a,b)};a.is_cyclic=function(a){return c.is_cyclic(a)};
a.listener_reset_speed=function(a,b){c.listener_reset_speed(a,b)};a.speaker_reset_speed=function(a,b,l){c.speaker_reset_speed(a,b,l)};a.get_volume=function(a){return a&&"object"===typeof a?c.get_volume(a):c.Gv()};a.set_volume=function(a,b){a&&"object"===typeof a?c.set_volume(a,b):c.Bx(b)};a.mute=function(a,b){a&&"object"===typeof a?c.mute(a,b):c.Ew(b)};a.is_muted=function(a){return a&&"object"===typeof a?c.is_muted(a):c.ow()};a.get_speaker_objects=function(){return c.get_speaker_objects().slice(0)};
a.get_speakers=function(){return a.get_speaker_objects()};a.check_active_speakers=c.check_active_speakers;a.set_compressor_params=function(a){c.set_compressor_params(b.get_active(),a)};a.get_compressor_params=function(){return c.get_compressor_params(b.get_active())};a.duck=function(a,b,l){a&&"object"===typeof a?c.duck(a,b,l):c.Hu(b,l)};a.unduck=function(a){a&&"object"===typeof a?c.unduck(a):c.wy()};a.apply_playlist=c.apply_playlist;a.clear_playlist=c.clear_playlist;a.detect_audio_container=c.detect_audio_container;
a.detect_video_container=c.detect_video_container;a.set_positional_params=c.set_positional_params;a.get_positional_params=c.get_positional_params;a.set_filter_params=c.set_filter_params;a.get_filter_params=c.get_filter_params;a.get_filter_freq_response=c.get_filter_freq_response};b4w.module.shaders=function(a,n){function b(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var f=d.split(" ")[0];f in b||(b[f]=0);b[f]++}}c=a=0;for(f in b)switch(f){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[f];break;default:a+=b[f]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function c(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);
c.send(b);if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function g(a){for(var b=k.Ki(),c=0;c<b.length;c++)for(var d=k.la(b[c],"MESH",k.DATA_ID_ALL),f=0;f<d.length;f++){var g=d[f];if(g.O)for(var e=0;e<g.O.length;e++){var h=g.O[e];if(h.Xb==a&&h.tc.length)return h.tc}}return null}function d(a){a.sort(function(a,b){return b.Xk.ALU_OPS-a.Xk.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.Xk,f=c.Yy,h=g(c.su),h=h?"\t\t("+h.join(", ")+")":"\t\t(NA)";l.groupCollapsed("FRAG --\x3e",
"ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",f.ALU_OPS,"TEX",f.TEX_OPS,h);l.groupCollapsed("directives");for(var h=c.Wa.Od,e=0;e<h.length;e++){var k=h[e];l.log(k[0],k[1])}l.groupEnd();l.groupCollapsed("vert src");l.log(c.Xy);l.groupEnd();l.groupCollapsed("vert stats");for(var n in f)"ALU_OPS"!=n&&"TEX_OPS"!=n&&l.log(n,f[n]);l.groupEnd();l.groupCollapsed("frag src");l.log(c.bv);l.groupEnd();l.groupCollapsed("frag stats");for(n in d)"ALU_OPS"!=n&&"TEX_OPS"!=n&&l.log(n,d[n]);l.groupEnd();
l.groupEnd()}}n("__config");var l=n("__print"),h=n("__extensions"),k=n("__scenes"),f=n("__shaders");n("__util");a.report_repeatful_compilation=function(){var a=f.wu(),b=0,c;for(c in a){var d=a[c],g=d.count;1<g&&l.log(g-1,d.mB,d.DA);b+=g-1}l.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var g=f.yv(),k=0,n;for(n in g)a&&-1===n.indexOf(a)||k++;var k="of "+k+" analyzing...",t={};for(n in g)if(!a||-1!==n.indexOf(a)){var z=g[n],e;var B=z.wm;e=z.vo;var A=h.zo();if(A){B=A.getTranslatedShaderSource(B);
e=A.getTranslatedShaderSource(e);var A=c("/nvidia_vert",B),u=b(A),s=c("/nvidia_frag",e),q=b(s);e={Xy:B,xB:A,Yy:u,bv:e,iA:s,Xk:q}}else l.error("B4W Error: WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),e=void 0;A=z.Wa;B=A.$h+" + "+A.jh;e.su=z;e.Wa=A;z=t[B]=t[B]||[];z.push(e);l.log(k)}for(B in t)l.group("%c"+B,"color: #800"),z=t[B],d(z),l.groupEnd()}};b4w.module.textures=function(a,n){var b=n("__textures"),c=n("__print");a.get_canvas_texture_context=function(a){var d=b.wv(a);if(d)return d;c.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a){b.By(a)||c.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a){b.play_video(a)||c.error('Texture with name "'+a+'" not found!')};a.stop_video=function(a){b.stop_video(a)||c.error('Texture with name "'+a+'" not found!')}};b4w.module.transform=function(a,n){var b=n("__print"),c=n("__physics"),g=n("__transform"),d=n("__util"),l=new Float32Array(3),h=new Float32Array(4);a.SPACE_LOCAL=g.SPACE_LOCAL;a.SPACE_WORLD=g.SPACE_WORLD;a.set_translation=function(a,b,d,h){l[0]=b;l[1]=d;l[2]=h;g.set_translation(a,l);g.v(a);c.sync_transform(a)};a.set_translation_v=function(a,b){g.set_translation(a,b);g.v(a);c.sync_transform(a)};a.set_translation_rel=function(a,b,h,n,m){l[0]=b;l[1]=h;l[2]=n;d.Wh(l,1,m.d.quat,m.d.e,l);g.set_translation(a,
l);g.v(a);c.sync_transform(a)};a.get_translation=function(a,b){b||(b=new Float32Array(3));g.get_translation(a,b);return b};a.set_rotation=function(a,b,d,l,m){h[0]=b;h[1]=d;h[2]=l;h[3]=m;g.set_rotation(a,h);g.v(a);c.sync_transform(a)};a.set_rotation_quat=a.set_rotation;a.set_rotation_v=function(a,b){g.set_rotation(a,b);g.v(a);c.sync_transform(a)};a.set_rotation_quat_v=a.set_rotation_v;a.get_rotation=function(a,b){b||(b=new Float32Array(4));g.get_rotation(a,b);return b};a.get_rotation_quat=a.get_rotation;
a.set_rotation_euler=function(a,b,d,h){l[0]=b;l[1]=d;l[2]=h;g.set_rotation_euler(a,l);g.v(a);c.sync_transform(a)};a.set_rotation_euler_v=function(a,b){g.set_rotation_euler(a,b);g.v(a);c.sync_transform(a)};a.set_scale=function(a,b){g.set_scale(a,b);g.v(a)};a.get_scale=function(a){return g.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return b.error("Wrong object: "+a.name),!1;g.set_translation(a,[0,0,0]);g.set_rotation(a,[0,0,0,1]);g.set_scale(a,1);g.v(a);c.sync_transform(a)};
a.get_object_size=function(a){return d.sc(a)?g.get_object_size(a):(b.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,c,h){return d.sc(a)?g.get_object_center(a,c,h):(b.error("Wrong object: "+a.name),null)};a.move_local=function(a,b,d,h){g.move_local(a,b,d,h);g.v(a);c.sync_transform(a)};a.get_object_bounding_box=function(a){return g.get_object_bounding_box(a)}};b4w.module.util=function(a,n){var b=n("__print"),c=n("__util"),g=n("vec3");n("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=c.keyfind;a.keysearch=c.keysearch;a.matrix_to_quat=function(a){return c.matrix_to_quat(a)};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));return c.euler_to_quat(a,b)};a.quat_to_euler=
function(a,b){b||(b=new Float32Array(3));return c.quat_to_euler(a,b)};a.sign=c.sign;a.clamp=c.clamp;a.quat_to_dir=c.quat_to_dir;a.ground_project_quat=function(a,b){return c.quat_project(a,c.AXIS_MY,c.AXIS_Y,c.AXIS_MZ,b)};a.cam_quat_to_mesh_quat=function(a,b){return c.cam_quat_to_mesh_quat(a,b)};a.quat_project=function(a,l,h,k,f){return 0!=g.dot(h,k)?(b.error("Wrong in-plane direction"),null):c.quat_project(a,l,h,k,f)};a.hash_code=c.hash_code;a.smooth=c.smooth;a.smooth_v=c.smooth_v;a.is_vector=c.is_vector;
a.correct_cam_quat_up=c.correct_cam_quat_up;a.quat_to_angle_axis=c.quat_to_angle_axis;a.random_from_array=c.random_from_array;a.xz_direction=c.xz_direction;a.line_plane_intersect=c.line_plane_intersect};"object"==typeof module&&module.Ok&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,n){var b=n("__version");a.version=b.version;a.type=b.type;a.date=b.date};"object"==typeof module&&module.Ok&&b4w.module.version(exports);b4w.module.main=function(a,n){function b(){}function c(){}function g(){}function d(){da=0;window.performance||(e.log("Apply performance workaround"),window.performance={});var a=Date.now();if(window.performance.now)return a-performance.now();e.log("Apply performance.now() workaround");window.performance.now=function(){return Date.now()-a};return a}function l(a,b){a.addEventListener("webglcontextlost",function(a){a.preventDefault();e.error("B4W Error: WebGL context lost");k()},!1);s.Wb(b);var d=s.Go();
d&&e.log("%cRENDERER INFO:","color: #00a",b.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+b.getParameter(d.UNMASKED_RENDERER_WEBGL));r.Wb(b);q.Wb(b);T.Wb(b);W.Wb(b);u.Wb(b);A.Wb(b);F.sq(a.width,a.height);G.init();c=m();p()}function h(){b=function(){}}function k(){f()||(ja=performance.now()/1E3,G.pause(),J.pause(),T.pause())}function f(){return D<ja}function p(){w(p);var a=performance.now()/1E3;P||(P=a);var b=a-P;b<1/Q.$d||(f()||(D>P&&(b-=D-Math.max(ja,P)),da+=b,u.update(),y.update(),A.update(),v(da,
b),c(b)),P=a)}function v(a,c){A.is_primary_loaded()&&(K.reset(),S.update(c),H.update(a,c),G.update(a,c),x.update(c),A.is_primary_loaded()&&(J.update(a,c),A.is_primary_loaded()&&(b(c,a),A.is_primary_loaded()&&(B.update(a,c),A.is_primary_loaded()&&(F.update(a,c),ga&&(ga(Z.toDataURL()),ga=null))))))}function m(){var a=60,b=0,c=0,d=Q.Zu,e=Q.Yu;return function(f){a=R.smooth(1/f,a,f,d);b=R.smooth(0,b,f,d);c=(c+1)%e;0==c&&g(Math.round(a),Math.round(b))}}var x=n("__animation"),t=n("__compat"),z=n("__config"),
e=n("__print"),B=n("__controls"),A=n("__data"),u=n("__debug"),s=n("__extensions"),q=n("__geometry"),K=n("__hud"),H=n("__nla"),y=n("__assets"),J=n("__physics"),r=n("__renderer"),F=n("__scenes"),G=n("__sfx"),W=n("__shaders"),T=n("__textures"),S=n("__transform"),R=n("__util"),L=n("__version"),O=z.context,Q=z.n,Z=null,N=null,da=0,P=0,ja=0,D=0,ga=null,V=["webgl","experimental-webgl"],w=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/Q.$d)}}();a.init=function(a,b){z.Cx();e.Hx(Q.console_verbose);var c=L.version()+" "+L.type()+" ("+L.date()+")";e.log("%cINIT B4W ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;c=d();Z=a;var f;f=null;for(var g=0;g<V.length;g++){var h=V[g];try{f=a.getContext(h,O)}catch(k){}if(f)break}if(!f)return null;l(Z,f);z.ct();t.zx(f);e.log("%cSET PRECISION:","color: #00a",Q.precision);
b?(K.init(b),N=b):(z.n.show_hud_debug_info=!1,z.yd.gj=!1);J.ew(c);return f};a.set_check_gl_errors=function(a){u.set_check_gl_errors(a)};a.resize=function(a,b){Z.style.width=a+"px";Z.style.height=b+"px";N&&(N.style.width=a+"px",N.style.height=b+"px");Z.width=a*Q.yi;Z.height=b*Q.yi;N&&(N.width=a,N.height=b);K.Eg();F.sq(a*Q.yi,b*Q.yi);r.clear();v(da,0);A.Gy(Z.width,Z.height)};a.set_fps_callback=function(a){g=a};a.clear_fps_callback=function(){g=function(){}};a.set_on_before_render_callback=function(a){b=
a};a.set_render_callback=function(a){b=a};a.clear_on_before_render_callback=function(){h()};a.clear_render_callback=function(){h()};a.global_timeline=function(){return da};a.redraw=function(){v(da,0)};a.pause=k;a.resume=function(){f()&&(D=performance.now()/1E3,G.resume(),J.resume(),T.play())};a.is_paused=f;a.reset=function(){A.unload();N=Z=null;D=ja=P=da=0;g=function(){};c=function(){};b=function(){}};a.canvas_data_url=function(a){ga=a};a.get_canvas_elem=function(){return Z};a.set_texture_quality=
function(){R.da("set_texture_quality() deprecated")};a.set_shaders_dir=function(){R.da("set_shaders_dir() deprecated")}};
