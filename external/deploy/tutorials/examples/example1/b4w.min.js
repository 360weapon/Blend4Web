function $a(){return function(){}}function Tc(a){return function(){return a}}b4w={module:{},register:function(a,q){var c=b4w.module;if(c[a])throw Error('Module "'+a+'" already registered');c[a]=q},require:function(a){var q=b4w.require,c=b4w.module[a];if(!c)throw Error('Module "'+a+'" not found');c.lk||(c.lk={},c(c.lk,q));return c.lk},module_check:function(a){return b4w.module[a]?!0:!1}};"object"==typeof module&&module.Sk&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a){function q(){if("DEBUG"==c){var a=new Date,d=a.getDate(),d=10>d?"0"+String(d):String(d),h=a.getMonth()+1,h=10>h?"0"+String(h):String(h),p=String(a.getFullYear()),n=a.getHours(),n=10>n?"0"+String(n):String(n),k=a.getMinutes(),k=10>k?"0"+String(k):String(k),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return d+"."+h+"."+p+" "+n+":"+k+":"+a}return b}var c="RELEASE",b="22.05.2014 11:19:21";a.version=Tc("v14.05.22");a.type=function(){return c};a.jo=q;a.timestamp=function(){var a=
q(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.Sk&&b4w.module.__version(exports);b4w.module.__config=function(a,q){var c=q("__print"),b=q("__util");a.bn=1;a.jk=2;a.cn=3;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.gu=b.Fa(a.context);a.s={qk:!0,rk:0.1,Ep:3,Dp:1E4,Hk:!1,Me:!1,sg:!1,Wv:1.5,Vv:10,Jg:[0,0,0,0],ok:!1,xc:!0,aD:50,Mb:1,qg:3,Nj:!1,iC:!0,Ad:"DEPTH",ri:!1,If:!0,bg:!0,ag:0.5,me:!0,se:!0,be:!0,Qd:!0,he:!0,Ud:!0,uc:!0,Yb:!1,ki:!1,Lc:!0,td:!0,ra:!0,ud:!0,rc:!0,Cc:!0,Sc:!0,Jb:53,Cm:!0,precision:"highp",Jc:!0,Ml:a.jk};a.Ok=b.Fa(a.s);a.Hg={Xa:24};a.controls={Bt:[5,
5,5,5],Ct:0.1,jy:1/120};a.Md={$x:15,Zp:!0,Dl:!1,Lk:!1};a.dt=b.Fa(a.Md);a.Kb={Wz:"../../shaders/",Xz:"include/",wq:"shader_texts",Ai:"built_in_data",cm:"../common/smaa_search_texture.png",bm:"../common/smaa_area_texture.png"};a.qb={enabled:!0,Am:"../common/uranium.js"};a.Dy=b.Fa(a.qb);a.fg={Ze:1024,zd:2048,Of:1024};a.lq=b.Fa(a.fg);a.hg={jB:!0,sj:!1};a.Uz=b.Fa(a.hg);a.Ys=function(){var b=a.s,c=a.Ok,h=a.fg,p=a.lq;switch(b.Ml){case a.cn:b.Ad=c.Ad;b.Cc=c.Cc;b.xc=c.xc;b.se=c.se;b.If=c.If;b.be=c.be;b.Qd=
c.Qd;b.bg=c.bg;b.ag=1;b.me=c.me;b.Lc=c.Lc;b.td=c.td;b.ra=c.ra;b.ud=c.ud;b.Mb=2;h.Ze=2048;h.zd=4096;h.Of=2048;b.qg=c.qg;b.sg=c.sg;b.Jb=c.Jb;b.precision=c.precision;b.rc=c.rc;b.Sc=c.Sc;b.uc=c.uc;b.Yb=!0;b.Ud=c.Ud;b.he=c.he;break;case a.jk:b.Ad=c.Ad;b.Cc=c.Cc;b.xc=c.xc;b.se=c.se;b.If=c.If;b.be=c.be;b.Qd=c.Qd;b.bg=c.bg;b.ag=c.ag;b.me=c.me;b.Lc=c.Lc;b.td=c.td;b.ra=c.ra;b.ud=c.ud;b.Mb=c.Mb;h.Ze=p.Ze;h.zd=p.zd;h.Of=p.Of;b.qg=c.qg;b.sg=c.sg;b.Jb=c.Jb;b.precision=c.precision;b.rc=c.rc;b.Sc=c.Sc;b.uc=c.uc;
b.Yb=c.Yb;b.Ud=c.Ud;b.he=c.he;break;case a.bn:b.Ad="NONE",b.Cc=!1,b.xc=!1,b.se=!1,b.If=!1,b.be=!1,b.Qd=!1,b.bg=!1,b.ag=0.5,b.me=!1,b.Lc=!1,b.td=!1,b.ra=!1,b.ud=!1,b.Mb=c.Mb,h.Ze=p.Ze/2,h.zd=p.zd/2,h.Of=p.Of/2,b.qg=2,b.sg=!0,b.Jb=c.Jb,b.precision="mediump",b.rc=!1,b.Sc=!1,b.uc=!1,b.Yb=!1,b.Ud=!1,b.he=!1}};a.set=function(b,d){switch(b){case "all_objs_selectable":a.s.ok=d;break;case "alpha":a.context.alpha=d;break;case "context_antialias":a.context.antialias=d;break;case "alpha_sort":a.s.qk=d;break;
case "alpha_sort_threshold":a.s.rk=d;break;case "anaglyph_use":a.s.ri=d;break;case "animation_framerate":a.Hg.Xa=d;break;case "antialiasing":a.s.uc=d;break;case "assets_dds_available":a.Md.Lk=d;break;case "assets_min50_available":a.Md.Dl=d;break;case "background_color":a.s.Jg=d;break;case "built_in_module_name":a.Kb.Ai=d;break;case "console_verbose":a.s.Hk=d;break;case "quality":a.s.Ml=d;break;case "do_not_load_resources":a.s.Me=d;break;case "deferred_rendering":a.s.Jc=d;break;case "glow":a.s.xc=
d;break;case "show_hud_debug_info":a.s.Nj=d;break;case "sfx_mix_mode":a.hg.sj=d;break;case "physics_enabled":a.qb.enabled=d;break;case "physics_uranium_path":a.qb.Am=d;break;case "smaa_search_texture_path":a.Kb.cm=d;break;case "smaa_area_texture_path":a.Kb.bm=d;break;case "smaa":a.s.Yb=d;break;case "resolution_factor":a.s.Mb=d;break;case "precision":a.s.precision=d;break;case "wireframe_debug":a.s.ki=d;break;default:c.error("B4W config set - property unknown: "+b)}};a.get=function(b){switch(b){case "all_objs_selectable":return a.s.ok;
case "alpha":return a.context.alpha;case "context_antialias":return a.context.antialias;case "alpha_sort":return a.s.qk;case "alpha_sort_threshold":return a.s.rk;case "anaglyph_use":return a.s.ri;case "animation_framerate":return a.Hg.Xa;case "antialiasing":return a.s.uc;case "assets_dds_available":return a.Md.Lk;case "assets_min50_available":return a.Md.Dl;case "background_color":return a.s.Jg;case "built_in_module_name":return a.Kb.Ai;case "console_verbose":return a.s.Hk;case "quality":return a.s.Ml;
case "do_not_load_resources":return a.s.Me;case "deferred_rendering":return a.s.Jc;case "glow":return a.s.xc;case "show_hud_debug_info":return a.s.Nj;case "sfx_mix_mode":return a.hg.sj;case "physics_enabled":return a.qb.enabled;case "physics_uranium_path":return a.qb.Am;case "smaa":return a.s.Yb;case "smaa_search_texture_path":return a.Kb.cm;case "smaa_area_texture_path":return a.Kb.bm;case "resolution_factor":return a.s.Mb;case "precision":return a.s.precision;case "wireframe_debug":return a.s.ki;
default:c.error("B4W config get - property unknown: "+b)}};a.reset=function(){a.context=b.Fa(a.gu);a.s=b.Fa(a.Ok);a.Md=b.Fa(a.dt);a.qb=b.Fa(a.Dy);a.fg=b.Fa(a.lq);a.hg=b.Fa(a.Uz)}};b4w.module.__boundings=function(a,q){function c(a,b){for(var c=a[0],l=a[1],d=a[2],f=a[0],h=a[1],e=a[2],D=3;D<a.length;D+=3)var y=a[D],u=a[D+1],g=a[D+2],c=Math.max(c,y),l=Math.max(l,u),d=Math.max(d,g),f=Math.min(f,y),h=Math.min(h,u),e=Math.min(e,g);b.V=c;b.G=l;b.ja=d;b.R=f;b.B=h;b.pa=e;return b}var b=q("__util"),e=q("__tsr"),d=q("vec3"),h=new Float32Array(24);a.hu=function(a,b){b.R=a.R;b.V=a.V;b.B=a.B;b.G=a.G;b.pa=a.pa;b.ja=a.ja};a.KB=function(){return{V:1E12,R:-1E12,G:1E12,B:-1E12,ja:1E12,pa:-1E12}};
a.Id=function(a){a||(a={});a.V=0;a.R=0;a.G=0;a.B=0;a.ja=0;a.pa=0;return a};a.po=function(a,b){var c=a.G,l=a.ja,d=a.R,f=a.B,h=a.pa;a.V=Math.max(b.V,a.V);a.G=Math.max(b.G,c);a.ja=Math.max(b.ja,l);a.R=Math.min(b.R,d);a.B=Math.min(b.B,f);a.pa=Math.min(b.pa,h)};a.jt=c;a.zi=function(d,n,k){k||(k=a.Id());var l;(l=h)||(l=new Float32Array(24));var e=d.V,f=d.G,t=d.ja,A=d.R,D=d.B;d=d.pa;l[0]=A;l[1]=D;l[2]=d;l[3]=e;l[4]=D;l[5]=d;l[6]=e;l[7]=f;l[8]=d;l[9]=A;l[10]=f;l[11]=d;l[12]=A;l[13]=D;l[14]=t;l[15]=e;l[16]=
D;l[17]=t;l[18]=e;l[19]=f;l[20]=t;l[21]=A;l[22]=f;l[23]=t;b.ff(l,n,l);return c(l,k)};a.aA=function(b,c,k){k||(k=a.Id());var l=c.R,d=c.V,f=c.B,h=c.G,e=c.pa;c=c.ja;l>=b.V||d<=b.R||f>=b.G||h<=b.B||e>=b.ja||c<=b.pa?(k.R=-0.1,k.V=0.1,k.B=-0.1,k.G=0.1,k.pa=-0.2,k.ja=-0.1):(k.R=Math.max(b.R,l),k.V=Math.min(b.V,d),k.B=Math.max(b.B,f),k.G=Math.min(b.G,h),k.pa=Math.max(b.pa,e),k.ja=Math.min(b.ja,c))};a.yD=function(b,c,k){k||(k=a.Id());var l=b.V-b.R,d=b.G-b.B,f=b.ja-b.pa;k.R=b.R-0.5*(c-1)*l;k.V=b.V+0.5*(c-1)*
l;k.B=b.B-0.5*(c-1)*d;k.G=b.G+0.5*(c-1)*d;k.pa=b.pa-0.5*(c-1)*f;k.ja=b.ja+0.5*(c-1)*f;return k};a.Dk=function(a,c,k){k||(k={J:[0,0,0],ua:0});d.transformMat4(a.J,c,k.J);k.ua=a.ua*b.pj(c);return k};a.Ck=function(b,c,k){k||(k=a.oB());e.Sj(c,b.J,k.J);d.copy(b.Nd,k.Nd);d.copy(b.Od,k.Od);d.copy(b.Pd,k.Pd);e.um(k.Nd,c,k.Nd);e.um(k.Od,c,k.Od);e.um(k.Pd,c,k.Pd);return k};a.JD=function(){return{J:[0,0,0],ua:0}};a.oB=function(){return{Nd:new Float32Array(3),Od:new Float32Array(3),Pd:new Float32Array(3),J:[0,
0,0]}};a.LB=function(){return{J:[0,0,0],ua:1E12}};a.Iv=function(a,b){var c=d.subtract(b.J,a.J,d.create());0==d.length(c)&&d.set(1,0,0,c);var l=d.normalize(c,d.create()),c=d.scale(l,a.ua,d.create());d.add(c,a.J,c);var h=d.scale(l,-a.ua,d.create());d.add(h,a.J,h);var f=d.scale(l,b.ua,d.create());d.add(f,b.J,f);var e=d.scale(l,-b.ua,d.create());d.add(e,b.J,e);c=[c,h,f,e];l=d.normalize(l,d.create());h=c[0];f=c[0];for(e=1;e<c.length;e++){var A=d.dot(c[e],l);A<d.dot(h,l)&&(h=c[e]);A>d.dot(f,l)&&(f=c[e])}l=
[h,f];c=l[0];l=l[1];a.J=d.scale(d.add(c,l,d.create()),0.5,d.create());a.ua=d.length(d.subtract(l,c,d.create()))/2};a.qu=function(a,b){var c=b.G,l=b.B,d=Math.max(0,c-l-2*a);return{ua:a,height:d,J:[0,(c+l)/2,0]}};a.su=function(a,b){var c=b.G,l=b.B,d=Math.max(0,c-l);return{ua:a,height:d,J:[0,(c+l)/2,0]}};a.ru=function(a,b){var c=b.G,l=b.B,d=Math.max(0,c-l);return{ua:a,height:d,J:[0,(c+l)/2,0]}};a.It=function(a,b){return a.R>b.V||a.V<b.R?!1:a.B>b.G||a.G<b.B?!1:a.pa>b.ja||a.ja<b.pa?!1:!0};a.Yy=function(a){for(var b=
0,c=0,l=0,d=0,f=0,h=0,e=0,D=0,y=0;y<a.submeshes.length;y++){var u=a.submeshes[y];if(u.position.length){b=d=u.position[0];c=f=u.position[1];l=h=u.position[2];break}}for(y=0;y<a.submeshes.length;y++)for(var u=a.submeshes[y],u=u.position,g=0;g<u.length/3;g++)var E=u[3*g],I=u[3*g+1],w=u[3*g+2],b=Math.max(E,b),c=Math.max(I,c),l=Math.max(w,l),d=Math.min(E,d),f=Math.min(I,f),h=Math.min(w,h),e=Math.max(Math.sqrt(E*E+I*I+w*w),e),D=Math.max(Math.sqrt(E*E+w*w),D);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=
d;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=f;a.b4w_bounding_box.max_z=l;a.b4w_bounding_box.min_z=h;a.b4w_bounding_sphere_radius=e;a.b4w_bounding_cylinder_radius=D}};b4w.module.__compat=function(a,q){var c=q("__config"),b=q("__extensions"),e=q("__print"),d=q("__util");a.Gz=function(a){var p=c.Ok,n=c.s,k=Boolean(b.Dw());-1<navigator.userAgent.indexOf("Firefox/28.0")&&(-1<navigator.userAgent.indexOf("Linux")||-1<navigator.userAgent.indexOf("Macintosh"))&&(e.warn("Firefox 28 detected, applying depth hack"),k=!1);n.Jc=p.Jc=p.Jc&&k;n.Lc=p.Lc=p.Lc&&k;n.td=p.td=p.td&&k;n.ra=p.ra=p.ra&&k;n.ud=p.ud=p.ud&&k;n.rc=p.rc=p.rc&&k;n.Cc=p.Cc=p.Cc&&k;n.Sc=p.Sc=p.Sc&&k;n.Cm=p.Cm=
Boolean(b.Qo());k=d.$a(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),251,Infinity);n.Jb=p.Jb=d.Dc((k-50)/4);n.Zx=p.Zx=d.Dc((k-50)/2);0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision&&(n.precision=p.precision="mediump")}};b4w.module.__constraints=function(a,q){function c(a){var m={};m.type=a;return m}function b(a,m){a.xa&&a.xa.M&&e(a.xa.M,a);if(m.M){var r=m.M;if(-1==r.Kd.indexOf(a))r.Kd.push(a);else throw"Descendant object override is forbidden";}a.xa=m}function e(a,m){var r=a.Kd.indexOf(m);if(-1!=r)a.Kd.splice(r,1);else throw"No descendant object";}function d(a,m,b){switch(m.type){case D:var c=a.d.e,d=a.d.h,e=m.M.d.I,L=m.M.d.e;b=m.M.d.h;m.ne?(t.copy(m.ne,d),t.multiply(b,d,d)):t.copy(b,d);f.transformMat4(m.offset,
e,a.d.e);a.d.scale=m.jq*m.M.d.scale;break;case F:c=a.d.e;d=a.d.h;e=m.M.d.I;b=m.M.d.h;t.multiply(t.invert(m.df,m.df),d,d);t.multiply(b,d,d);f.transformMat4(m.offset,e,c);t.copy(b,m.df);break;case x:c=a.d.e;d=a.d.h;e=m.M.d.I;b=m.M.d.h;t.multiply(t.invert(m.df,m.df),d,d);t.multiply(b,d,d);f.transformMat4(m.offset,e,c);t.copy(b,m.df);var d=a.d.h,c=m.M.d.h,L=f.transformQuat(s.ib,d,P),e=t.invert(c,B),q=f.transformQuat(L,e,M),ga=H;ga[0]=q[0];ga[1]=0;ga[2]=q[2];var v=f.length(ga),e=-ga[2]/v,e=Math.acos(e)*
s.nf(ga[0]),v=v/f.length(q),v=Math.acos(v)*s.nf(q[1]),q=!1;e<-m.Rn&&(e=-m.Rn,q=!0);e>m.Sn&&(e=m.Sn,q=!0);v<-m.Tn&&(v=-m.Tn,q=!0);v>m.Qn&&(v=m.Qn,q=!0);q&&(m=Math.sin(v),v=Math.cos(v),q=Math.sin(e),e=Math.cos(e),ga=M,ga[0]=v*q,ga[1]=m,ga[2]=-v*e,f.transformQuat(ga,c,ga),m=t.rotationTo(L,ga,B),t.multiply(m,d,d),t.normalize(d,d));"CAMERA"==a.d.type&&(m=f.transformQuat(s.ib,b,M),n(a,m));break;case S:c=a.d.e;d=a.d.h;e=m.M.d.I;L=m.M.d.e;v=P;a=B;f.transformMat4(m.offset,e,v);s.Yh(v,c,b,0.3,c);m=P;f.sub(L,
c,m);f.normalize(m,m);q=d;c=R;L=c.subarray(0,3);e=c.subarray(3,6);v=c.subarray(6,9);f.copy(m,e);f.negate(e,e);f.normalize(e,e);Boolean(0.999999<Math.abs(f.dot(m,s.ib)))?(m=A.fromQuat(t.normalize(q,a),U),f.copy(m.subarray(0,3),L)):f.cross(s.ib,e,L);f.normalize(L,L);f.cross(L,e,v);f.normalize(v,v);t.fromMat3(c,a);t.normalize(a,a);s.yq(a,d,b,0.1,d);break;case y:d=a.d.h;L=K;b=B;k(m.M,m.rt,!0,L,b);m.ne?(t.copy(m.ne,d),t.multiply(b,d,d)):t.copy(b,d);s.Sj(m.offset,1,b,L,a.d.e);break;case u:c=a.d.e;d=a.d.h;
b=m.M.d.e;h(c,d,b);"CAMERA"==a.d.type&&n(a,s.ib);break;case g:c=a.d.e;d=a.d.h;b=m.target;h(c,d,b);"CAMERA"==a.d.type&&n(a,s.ib);break;case E:c=a.d.e;d=a.d.h;b=m.M.d.e;d=p(c,d,b,X);L=f.dist(c,b);if(m=d?L>m.Gh?L-m.Gh:L<m.$e?L-m.$e:0:L+m.$e)f.sub(b,c,P),f.normalize(P,P),f.scale(P,m,P),f.add(c,P,c);"CAMERA"==a.d.type&&n(a,s.ib);break;case I:c=a.d.e;d=a.d.h;b=m.target;d=p(c,d,b,X);L=f.dist(c,b);if(m=d?L>m.Gh?L-m.Gh:L<m.$e?L-m.$e:0:L+m.$e)f.sub(b,c,P),f.normalize(P,P),f.scale(P,m,P),f.add(c,P,c);"CAMERA"==
a.d.type&&n(a,s.ib);break;case w:e=m.M.d.I;f.transformMat4(m.offset,e,a.d.e);break;case G:L=m.M.d.e;c=a.d.e;f.add(L,m.offset,c);break;case Q:d=a.d.h;e=m.M.d.I;b=m.M.d.h;m.ne?(t.copy(m.ne,d),t.multiply(b,d,d)):t.copy(b,d);f.transformMat4(m.offset,e,a.d.e);break;case O:b=m.M.d,b=l.He(b.e,b.scale,b.h,r),l.multiply(b,m.Tq,b),c=a.d.e,c[0]=b[0],c[1]=b[1],c[2]=b[2],a.d.scale=b[3],d=a.d.h,d[0]=b[4],d[1]=b[5],d[2]=b[6],d[3]=b[7]}}function h(a,m,r){var b=P;s.Xb(m,s.Jd,b);f.normalize(b,b);var c=M;f.subtract(r,
a,c);f.normalize(c,c);a=K;t.rotationTo(b,c,a);t.multiply(a,m,m)}function p(a,m,r,b){var c=P;s.Xb(m,s.Jd,c);f.normalize(c,c);var R=M;f.subtract(r,a,R);f.normalize(R,R);if(f.dot(c,R)<Math.cos(b))return!1;a=K;t.rotationTo(c,R,a);t.multiply(a,m,m);return!0}function n(a,m){var r=a.d.h,b=A.fromQuat(r,R),c=P;c[0]=b[3];c[1]=b[4];c[2]=b[5];if(!(0.999<Math.abs(f.dot(m,c)))){c=f.cross(m,c,c);f.normalize(c,c);0<b[7]&&(c[0]*=-1,c[1]*=-1,c[2]*=-1);var g=M;g[0]=b[0];g[1]=b[1];g[2]=b[2];f.normalize(g,g);b=B;t.rotationTo(g,
c,b);t.multiply(b,r,r)}}function k(a,b,c,R,g){var f=a.d,d=f.ej,k=f.Rd[b];b=k.Mi;a=a.pose.bones[k.Ll];var k=a.ln,E=K,v=f.Rj,h=f.Qj,e=f.Hj,U=f.Gj,n=v[4*b+1],p=v[4*b+2],u=v[4*b+3],s=h[4*b+1],A=h[4*b+2],I=h[4*b+3];E[0]=(1-d)*v[4*b]+d*h[4*b];E[1]=(1-d)*n+d*s;E[2]=(1-d)*p+d*A;E[3]=(1-d)*u+d*I;v=B;h=L;v[0]=e[4*b];v[1]=e[4*b+1];v[2]=e[4*b+2];v[3]=e[4*b+3];h[0]=U[4*b];h[1]=U[4*b+1];h[2]=U[4*b+2];h[3]=U[4*b+3];t.slerp(v,h,d,v);d=r;l.Oz(E,d);l.Vl(v,d);c?(c=m,l.translate(k,a.Es,c),l.multiply(d,c,d)):l.multiply(d,
k,d);l.multiply(f.rg,d,d);R[0]=d[0];R[1]=d[1];R[2]=d[2];R[3]=d[3];g&&(g[0]=d[4],g[1]=d[5],g[2]=d[6],g[3]=d[7])}var l=q("__tsr"),s=q("__util"),f=q("vec3"),t=q("quat"),A=q("mat3");q("mat4");var D=1,y=2,u=3,g=4,E=5,I=6,w=7,G=8,F=9,x=10,O=11,S=12,Q=13;a.wB=D;a.vB=y;a.zB=u;a.AB=g;a.qB=E;a.rB=I;a.xB=w;a.pB=G;a.uB=F;a.tB=x;a.Yc=O;a.sB=S;a.yB=Q;var P=new Float32Array(3),M=new Float32Array(3),H=new Float32Array(3),K=new Float32Array(4),B=new Float32Array(4),L=new Float32Array(4),r=new Float32Array(16),m=new Float32Array(16),
R=new Float32Array(9),U=new Float32Array(9),r=new Float32Array(8),X=9*Math.PI/10;a.un=function(a,m,r,R,B){var g=c(D);g.M=m;g.offset=new Float32Array(r);g.jq=B||1;g.ne=R?new Float32Array(R):null;b(a,g);d(a,g,0)};a.tn=function(a,m,r,R,B){var g=c(y);g.M=m;g.rt=r;g.offset=new Float32Array(R);g.ne=B?new Float32Array(B):null;b(a,g);d(a,g,0)};a.Ps=function(a,m,r,R){var B=c(F),g=a.d.h,f=m.d.h;B.M=m;B.offset=new Float32Array(r);B.df=new Float32Array(f);R&&(t.copy(R,g),t.multiply(f,g,g));b(a,B);d(a,B,0)};a.Os=
function(a,m,r,R,B,g,f,l){var K=c(x),v=a.d.h,k=m.d.h;K.M=m;K.offset=new Float32Array(r);K.df=new Float32Array(k);K.Rn=B;K.Sn=g;K.Tn=f;K.Qn=l;R&&(t.copy(R,v),t.multiply(k,v,v));b(a,K);d(a,K,0)};a.Ns=function(a,m,r){var R=c(S);R.M=m;R.offset=new Float32Array(r);b(a,R);d(a,R,0)};a.Rs=function(a,m,r,R){var B=c(Q);B.M=m;B.offset=new Float32Array(r);B.jq=1;B.ne=R?new Float32Array(R):null;b(a,B);d(a,B,0)};a.Ss=function(a,m){var r=c(u);r.M=m;b(a,r);d(a,r,0)};a.vn=function(a,m){var r=c(g);r.target=new Float32Array(m);
b(a,r);d(a,r,0)};a.Ls=function(a,m,r,R){var B=c(E);B.M=m;B.$e=r;B.Gh=R;b(a,B);d(a,B,0)};a.qn=function(a,m,r,R){var B=c(I);B.target=new Float32Array(m);B.$e=r;B.Gh=R;b(a,B);d(a,B,0)};a.Qs=function(a,m,r){var R=c(w);R.M=m;R.offset=new Float32Array(r);b(a,R);d(a,R,0)};a.Ks=function(a,m,r){var R=c(G);R.M=m;R.offset=new Float32Array(r);b(a,R);d(a,R,0)};a.Js=function(a,m,r){var R=c(O);R.M=m;R.Tq=new Float32Array(r);b(a,R);d(a,R,0)};a.MA=function(a,m){a.xa&&d(a,a.xa,m)};a.ju=n;a.remove=function(a){a.xa.M&&
e(a.xa.M,a);a.xa=null};a.rd=function(a){return a.xa?a.xa.type:null};a.EC=function(a){return a.xa&&a.xa.M?a.xa.M:null};a.pd=function(a){return a.xa&&a.xa.type==O?a.xa.Tq:null};a.xw=k};b4w.module.__controls=function(a,q){function c(a){var m={};m.type=a;m.value=0;m.jc=null;m.xl=null;m.wl=null;m.oj=null;return m}function b(a,m){var b;if(a.oj){b=a.xl;for(var c=a.wl,B=0;B<b.length;B++)c[B]=b[B].value;b=a.oj(c)}else b=!1;b||(a.value=Number(m))}function e(a){a=u.indexOf(a);-1<a?u.splice(a,1):l.error("Wrong object")}function d(a,m){for(var b=0,c=0;c<m.length;c++){var B=m[c],g=B.sb,d;for(d in g)for(var g=B.sb[d].xd,f=0;f<g.length;f++)g[f]===a&&b++}return b}function h(a,m){switch(a.type){case K:s.cq(a.Yt,
a.vc,a.Xn);break;case B:s.Un(a.Wn);break;case L:s.dq(a.Zh,a.pA,a.Hv,a.Tx)}var b=m.indexOf(a);-1<b&&m.splice(b,1)}function p(a){for(var m=0;m<a.length;m++)if(!a[m])return a[m];return a[a.length-1]}function n(a){var m=a[0],b=a[1];a=m.pageX;var m=m.pageY,c=b.pageX,b=b.pageY;return Math.sqrt((a-c)*(a-c)+(m-b)*(m-b))}var k=q("__config"),l=q("__print"),s=q("__physics"),f=q("__scenes"),t=q("__util"),A=q("vec3"),D=q("quat"),y=k.controls,u=[],g=[],E=0,I=0,w=0,G=0,F=0,x=0,O=0,S=0,Q=0,P=0,M=0,H=0,K=80,B=90,
L=100;a.Qm=10;a.Tm=20;a.Sm=30;a.Rm=40;a.update=function(r,m){H=r;f.o();for(var c=0;c<g.length;c++){var B=g[c],d=r,l=m;if(l)switch(f.o(),B.type){case 110:var K=B.Zh,k=K.d.e,K=K.d.h,h=A.dist(B.ei,k),e=B.Py;D.invert(B.Nl,e);D.multiply(K,e,e);D.normalize(e,e);e=Math.abs(2*Math.acos(e[3]));h/=l;B.vk=t.jg(h,B.vk,l,0.3);B.jc[0]=h;h=e/l;B.uk=t.jg(h,B.uk,l,0.3);B.jc[1]=h;B.vk>=B.threshold||B.uk>=B.ez?b(B,1):b(B,0);A.copy(k,B.ei);D.copy(K,B.Nl);B.pc=d;break;case 120:K=B.Zh;k=K.d.e;K=Math.abs(k[1]-B.ei[1])/
l;B.wk=t.jg(K,B.wk,l,0.3);B.jc=K;B.wk>=B.threshold?b(B,1):b(B,0);A.copy(k,B.ei);B.pc=d;break;case 130:d-B.pc>=B.Cj&&(b(B,1),B.pc=d);break;case 140:B.pc||(B.pc=d);b(B,d-B.pc);B.pc=d;break;case 150:b(B,d)}}for(c=0;c<u.length;c++){var B=u[c],L;for(L in B.sb){l=d=B.sb[L];k=l.xd;K=l.kz;for(h=0;h<k.length;h++)K[h]=k[h].value;l=l.Vx(K);k=d.wp;h=K=void 0;switch(d.type){case a.Qm:l?h=K=1:1==k?h=K=-1:K=0;break;case a.Tm:l&&-1==k?h=K=1:l||1!=k?K=0:h=K=-1;break;case a.Sm:l&&-1==k?h=K=1:l||1!=k?K=0:(K=0,h=-1);
break;case a.Rm:K=d.up!=l?1:0;break;default:throw"Wrong sensor manifold type: "+d.type;}h&&(d.wp=h);if(k=K)d.Ee(B,L,k,d.zt),d.up=l}}for(c=0;c<u.length;c++)for(L in B=u[c],B.sb)for(d=B.sb[L],d=d.xd,l=0;l<d.length;l++)switch(k=d[l],k.type){case 30:b(k,0);break;case 40:b(k,0);break;case 60:b(k,0);break;case 70:b(k,0);break;case 130:b(k,0)}E=0;G=I;F=w;S=x;Q=O;M=P};a.xu=function(a){var m=c(10);b(a);return m};a.ao=function(a){var m=c(20);m.key=a;return m};a.uu=function(a,m,B){if(!a||!a.l)return l.error("Wrong collision object"),
null;var d=c(K);d.Yt=a;d.vc=m||null;d.Xn=function(a,m){b(d,a);a&&m&&B&&(d.jc=d.jc||new Float32Array(3),d.jc[0]=m[0],d.jc[1]=m[1],d.jc[2]=m[2])};s.pn(a,d.vc,d.Xn,B);return d};a.tu=function(a){if(!a||!a.l)return l.error("Wrong collision impulse object"),null;var m=c(B);m.Wn=a;m.Xt=function(a){b(m,a)};s.wn(m.Wn,m.Xt);return m};a.Nu=function(a,m,B,d,g){if(!a)return l.error("Wrong collision object"),null;var f=c(L);f.Zh=a;f.pA=m;f.Hv=B;f.Tx=d;f.vc=g;f.Wy=function(a,m){b(f,a);a&&(f.jc=m)};s.sn(a,f.vc,m,
B,d,f.Wy);return f};a.Ku=function(){return c(50)};a.Mu=function(){return c(30)};a.Lu=function(a){var m=c(40);m.axis=a||"XY";return m};a.$u=function(a){var m=c(60);m.axis=a||"XY";return m};a.av=function(){return c(70)};a.Ju=function(a,m,b){if(!a)return l.error("Wrong collision object"),null;var B=c(110);B.Zh=a;var d=a.d.e;a=a.d.h;B.Py=new Float32Array(4);B.ei=new Float32Array(d);B.Nl=new Float32Array(a);B.vk=0;B.uk=0;B.threshold=m;B.ez=b;B.pc=0;B.jc=new Float32Array([0,0]);return B};a.cv=function(a,
m){if(!a)return l.error("Wrong collision object"),null;var b=c(120);b.Zh=a;var B=a.d.h;b.ei=new Float32Array(a.d.e);b.Nl=new Float32Array(B);b.wk=0;b.threshold=m;b.pc=0;b.jc=0;return b};a.Zu=function(a){var m=c(130);m.Cj=a;m.pc=H;return m};a.dz=function(a,m,b,c){c=c||0;a=a.sb;if(!a||!a[m])return l.error("reset_timer_sensor(): wrong object"),null;m=a[m].xd[b];if(!m)return l.error("reset_timer_sensor(): sensor not found"),null;m.pc=H+c};a.Au=function(){var a=c(140);a.pc=0;return a};a.Yu=function(){return c(150)};
a.jz=b;a.ga=function(){u=[];g=[];H=0};a.On=function(a,m){if(m)for(var b in a.sb){if(b===m)return!0}else for(b in a.sb)return!0;return!1};a.eq=function(a,m){var b=a.sb;if(m){for(var c=b[m],c=c.xd,B=0;B<c.length;B++)1===d(c[B],u)&&h(c[B],g);delete b[m];Object.getOwnPropertyNames(b).length||e(a)}else{for(var f in b){c=b[f];c=c.xd;for(B=0;B<c.length;B++)1===d(c[B],u)&&h(c[B],g);delete b[f]}e(a)}};a.eo=function(a,m,b,c,B,d,f){a.sb=a.sb||{};var l={};l.name=name;l.type=b;l.xd=c.slice(0);l.Vx=B||p;l.kz=Array(c.length);
l.Ee=d;l.zt=f||null;l.wp=-1;l.up=0;a.sb[m]=l;-1==u.indexOf(a)&&u.push(a);a=l.xd;for(m=0;m<a.length;m++)b=a[m],-1==g.indexOf(b)&&g.push(b)};a.lv=p;a.reset=function(){for(var a=0;a<u.length;a++){var m=u[a].sb,b;for(b in m)delete m[b]}for(a=0;a<g.length;a++)h(g[a],g),a--;u.splice(0,u.length)};a.debug=function(){f.o();l.log(String(u.length)+" objects with manifolds",u);l.log(String(g.length)+" sensors",g);for(var a=[],m=[],b=0;b<g.length;b++){var c=g[b];c.type==K&&a.push(c);c.type==L&&m.push(c)}l.log(String(a.length)+
" collision sensors",a);l.log(String(m.length)+" ray sensors",m)};a.Mx=function(a){for(var m=0;m<g.length;m++){var c=g[m];20==c.type&&a.keyCode==c.key&&b(c,1)}};a.Nx=function(a){for(var m=0;m<g.length;m++){var c=g[m];20==c.type&&0==a.keyCode&&16==c.key&&b(c,0);20==c.type&&a.keyCode==c.key&&b(c,0)}};a.fy=function(){for(var a=0;a<g.length;a++){var m=g[a];50==m.type&&b(m,1)}};a.hy=function(){for(var a=0;a<g.length;a++){var m=g[a];50==m.type&&b(m,0)}};a.iy=function(a){a=a.wheelDelta||-40*a.detail;a*=
y.jy;E+=a;for(a=0;a<g.length;a++){var m=g[a];30===m.type&&b(m,E)}};a.gy=function(a){var m=a.clientX;a=a.clientY;I=m;w=a;m-=G;a-=F;for(var c=Math.sqrt(m*m+a*a),B=0;B<g.length;B++){var d=g[B];if(40===d.type)switch(d.axis){case "X":b(d,m);break;case "Y":b(d,a);break;case "XY":b(d,c)}}};a.BA=function(a){a=a.targetTouches;if(1==a.length){a=a[0];var m=a.pageY;x=S=a.pageX;O=Q=m}else 1<a.length&&(P=M=n(a))};a.AA=function(a){var m=a.targetTouches;if(0!==m.length)if(a.preventDefault(),1===m.length){m=m[0];
a=m.pageX;m=m.pageY;x=a;O=m;a-=S;for(var c=m-Q,B=Math.sqrt(a*a+c*c),m=0;m<g.length;m++){var d=g[m];if(60===d.type)switch(d.axis){case "X":b(d,a);break;case "Y":b(d,c);break;case "XY":b(d,B)}}}else if(1<m.length)for(P=n(m),a=P-M,m=0;m<g.length;m++)d=g[m],70===d.type&&b(d,a)}};b4w.module.__curve=function(a,q){function c(a,b,c,d,l){var e=d.length;l||(l=new Float32Array(e));for(var f=e+a,t=new Float32Array(f),A=1;A<=f-1;A++)t[A-1]=b>=c[A-1]&&b<c[A+1-1]?1:0;for(var D=2;D<=a;D++)for(A=1;A<=f-D;A++)t[A-1]=(0!=t[A-1]?(b-c[A-1])*t[A-1]/(c[A+D-1-1]-c[A-1]):0)+(0!=t[A+1-1]?(c[A+D-1]-b)*t[A+1-1]/(c[A+D-1]-c[A+1-1]):0);b==c[f-1]&&(t[e-1]=1);a=0;for(A=1;A<=e;A++)a+=t[A-1]*d[A-1];for(A=1;A<=e;A++)l[A-1]=0!=a?t[A-1]*d[A-1]/a:0;return l}function b(a){a=a.nj;return a[a.length-1]}function e(a){a=
a.ho;return a[a.length-1]}var d=q("__util");a.Uu=function(a){var b={},d=a.data;a=d.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var k=a.order_u;b.ke=k;a=a.points;var l=a.length/5,e=[],f=l+k,l=l+2;e[0]=0;for(var t=2;t<=f;t++)e[t-1]=t>k&&t<l?e[t-2]+1:e[t-2];b.nj=e;if("2D"==d.dimensions)b.ee=!1;else if("3D"==d.dimensions)b.ee=!0;else throw"Wrong curve dimensions";k=[];e=[];for(d=0;d<a.length;d+=5)k.push(a[d]),k.push(a[d+1]),k.push(a[d+2]),b.ee&&k.push(a[d+3]),e.push(a[d+4]);b.Ik=
k;b.Jm=e;a=[];for(var d=b.Ik,k=b.ee?4:3,e=b.Jm,f=b.nj,l=b.ke,t=d.length/k,A=t+l,D=0,y=f[A-1]/999,u=0;1E3>u;u++){5E-6>f[A-1]-D&&(D=f[A-1]);for(var g=c(l,D,f,e),E=0;E<k;E++)for(var I=a[k*u+E]=0;I<t;I++)a[k*u+E]+=g[I]*d[k*I+E];D+=y}k=b.ee?4:3;e=new Float32Array(1E3);e[0]=0;for(d=1;1E3>d;d+=1)f=a[(d-1)*k],l=a[(d-1)*k+1],t=a[(d-1)*k+2],A=a[d*k],D=a[d*k+1],y=a[d*k+2],e[d]=e[d-1]+Math.sqrt((A-f)*(A-f)+(D-l)*(D-l)+(y-t)*(y-t));b.ho=e;return b};a.kA=function(a,d,e){e||(e=[]);var k=d,l=Math.max(k,0);d=l=Math.min(k,
b(a));var k=a.Ik,l=a.ee?4:3,s=a.Jm,f=a.nj,t=a.ke;a=k.length/l;var A=a+t;5E-6>f[A-1]-d&&(d=f[A-1]);A=new Float32Array(a);c(t,d,f,s,A);for(d=0;d<l;d++)for(s=e[d]=0;s<a;s++)e[d]+=A[s]*k[l*s+d]};a.hA=function(a,b,c){c||(c=[]);var d=a.Ik,l=a.ee?4:3,e=a.Jm,f=a.nj,t=a.ke;a=d.length/l;var A=a+t;5E-6>f[A-1]-b&&(b=f[A-1]);var A=new Float32Array(a),D=b;b=A;var y=e.length;b||(b=new Float32Array(y));var u=new Float32Array(y),g=new Float32Array(y),E=u,I=g;E||(E=new Float32Array(y));I||(I=new Float32Array(y));for(var w=
y+t,G=new Float32Array(w),F=new Float32Array(w),x=1;x<=w-1;x++)G[x-1]=D>=f[x-1]&&D<f[x+1-1]?1:0;D==f[w-1]&&(G[y-1]=1);for(var O=2;O<=t;O++)for(x=1;x<=w-O;x++){var q=0!=G[x-1]?G[x-1]/(f[x+O-1-1]-f[x-1]):0,Q=0!=G[x+1-1]?-G[x+1-1]/(f[x+O-1]-f[x+1-1]):0,P=0!=F[x-1]?(D-f[x-1])*F[x-1]/(f[x+O-1-1]-f[x-1]):0,M=0!=F[x+1-1]?(f[x+O-1]-D)*F[x+1-1]/(f[x+O-1]-f[x+1-1]):0;G[x-1]=(0!=G[x-1]?(D-f[x-1])*G[x-1]/(f[x+O-1-1]-f[x-1]):0)+(0!=G[x+1-1]?(f[x+O-1]-D)*G[x+1-1]/(f[x+O-1]-f[x+1-1]):0);F[x-1]=q+Q+P+M}for(x=1;x<=
y;x++)E[x-1]=G[x-1],I[x-1]=F[x-1];f=0;for(t=1;t<=y;t++)f+=u[t-1]*e[t-1];D=0;for(t=1;t<=y;t++)D+=g[t-1]*e[t-1];for(t=1;t<=y;t++)b[t-1]=0!=f?g[t-1]*e[t-1]/f+u[t-1]*e[t-1]*D/(f*f):0;for(e=0;e<l;e++)for(f=c[e]=0;f<a;f++)c[e]+=A[f]*d[l*f+e]};a.wD=b;a.jA=e;a.iA=function(a,c){if(0>=c)return 0;var n=b(a);if(c>=e(a))return n;var k=a.ho,l=d.xi(k,c,0,k.length-1);return n*(l+(c-k[l])/(k[l+1]-k[l]))/1E3}};b4w.module.__dds=function(a,q){function c(a,b,c,d){var g=new Uint16Array(4),f=new Uint16Array(c*d),l=0,k=0,K=0,B=k=l=0,e=0,r=0,m=0,R=c/4;d/=4;for(var E=0;E<d;E++)for(var h=0;h<R;h++)K=b+4*(E*R+h),g[0]=a[K],g[1]=a[K+1],l=g[0]&31,k=g[0]&2016,B=g[0]&63488,e=g[1]&31,r=g[1]&2016,m=g[1]&63488,g[2]=5*l+3*e>>3|5*k+3*r>>3&2016|5*B+3*m>>3&63488,g[3]=5*e+3*l>>3|5*r+3*k>>3&2016|5*m+3*B>>3&63488,l=a[K+2],k=4*E*c+4*h,f[k]=g[l&3],f[k+1]=g[l>>2&3],f[k+2]=g[l>>4&3],f[k+3]=g[l>>6&3],k+=c,f[k]=g[l>>8&3],f[k+1]=g[l>>
10&3],f[k+2]=g[l>>12&3],f[k+3]=g[l>>14],l=a[K+3],k+=c,f[k]=g[l&3],f[k+1]=g[l>>2&3],f[k+2]=g[l>>4&3],f[k+3]=g[l>>6&3],k+=c,f[k]=g[l>>8&3],f[k+1]=g[l>>10&3],f[k+2]=g[l>>12&3],f[k+3]=g[l>>14];return f}function b(a,b,d,e){var q=new Int32Array(d,0,A),P,M,H,K,B,L;if(q[D]!=n)return p.error("Invalid magic number in DDS header"),0;if(!q[w]&l)return p.error("Unsupported format, must contain a FourCC code"),0;P=q[G];switch(P){case s:M=8;H=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case f:M=16;H=b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:
null;break;case t:M=16;H=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return p.error("Unsupported FourCC code:",h(P)),null}L=1;q[u]&k&&!1!==e&&(L=Math.max(1,q[I]));K=q[E];B=q[g];q=q[y]+4;if(b)for(P=0;P<L;++P)e=Math.max(4,K)/4*Math.max(4,B)/4*M,b=new Uint8Array(d,q,e),a.compressedTexImage2D(a.TEXTURE_2D,P,H,K,B,0,b),q+=e,K=Math.max(0.5*K,1),B=Math.max(0.5*B,1);else if(P==s)Math.max(4,K),Math.max(4,B),b=new Uint16Array(d),d=c(b,q/2,K,B),a.texImage2D(a.TEXTURE_2D,0,a.RGB,K,B,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,
d),e&&a.generateMipmap(a.TEXTURE_2D);else return p.error("No manual decoder for",h(P),"and no native support"),0;return L}function e(a,c,d,g,f,l){var k=new XMLHttpRequest;k.open("GET",d,!0);k.responseType="arraybuffer";k.onload=function(){if(200==k.status){a.bindTexture(a.TEXTURE_2D,g);var d=b(a,c,k.response,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}l&&l(g)};k.send(null);return g}function d(a){return a.charCodeAt(0)+
(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function h(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var p=q("__print"),n=542327876,k=131072,l=4,s=d("DXT1"),f=d("DXT3"),t=d("DXT5"),A=31,D=0,y=1,u=2,g=3,E=4,I=7,w=20,G=21;a.kC=c;a.UA=b;a.Xo=function(a){a=new Int32Array(a,0,A);return{width:a[E],height:a[g]}};a.Aw=function(a){var b=1;a=(new Int32Array(a,0,A))[G];switch(a){case s:b=6;break;case f:case t:b=4;break;default:p.error("Unsupported FourCC code:",h(a))}return b};
a.$C=e;a.ZC=function(a,b,c,d){var g=a.createTexture();e(a,b,c,g,!0,d);return g}};b4w.module.__debug=function(a,q){function c(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}var b=q("__print"),e=q("__extensions"),d=q("__textures"),h=q("__util"),p=null,n={},k=!1,l={},s=[],f=-1;a.dn={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.Bc=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in
a&&(n[a[d]]=d)}p=a};a.Mt=function(a){if(k){var b=p.getError();if(b!=p.NO_ERROR){if(b in n)throw"B4W Error: "+b+", gl."+n[b]+" ("+a+")";throw"Unknown GL error: "+b+" ("+a+")";}}};a.Jt=function(){if(k)switch(p.checkFramebufferStatus(p.FRAMEBUFFER)){case p.FRAMEBUFFER_COMPLETE:break;case p.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:b.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case p.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:b.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
break;case p.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:b.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case p.FRAMEBUFFER_UNSUPPORTED:b.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:b.error("B4W Error: FRAMEBUFFER CHECK FAILED")}};a.Nn=function(){if(-1!=f)return f;p.bindFramebuffer(p.FRAMEBUFFER,p.createFramebuffer());var a=d.Ki("DEBUG",d.Dg);d.dg(a,1,1);p.framebufferTexture2D(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,a.Db,a.Wa,0);p.checkFramebufferStatus(p.FRAMEBUFFER)!=
p.FRAMEBUFFER_COMPLETE?(f=!0,b.warn("B4W warning: depth-only issue was found")):f=!1;p.bindFramebuffer(p.FRAMEBUFFER,null);return f};a.Ot=function(a,d,f){if(k&&!p.getShaderParameter(a,p.COMPILE_STATUS))throw f=c(f),b.error("B4W Error: shader compilation failed:\n"+f+"\n"+p.getShaderInfoLog(a)+" ("+d+")"),"Engine failed: see above for error messages";};a.Pt=function(a,d,f,l,g,E){if(k&&!p.getProgramParameter(a,p.LINK_STATUS)){var h=e.Go();h&&(g=h.getTranslatedShaderSource(f),E=h.getTranslatedShaderSource(l));
g=c(g);E=c(E);b.error("B4W Error: shader linking failed:\n"+g+"\n\n\n"+E+"\n"+p.getProgramInfoLog(a)+" ("+d+")");throw"Engine failed: see above for error messages";}};a.wz=function(a){k=a};a.lC=function(a){l[a]=a in l?l[a]+1:1};a.update=function(){for(var a in l)b.log(a,l[a]),l[a]=0};a.Uk=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(h.nh(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}s.push(a)};a.El=function(){for(var a=1,b=0;b<s.length;b++){var c=
s[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],h.nh(a))for(var d=0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);s.push(c)};var t=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.My=function(a){a||(a=1);for(var c=0,d={},f=Math.max(0,performance.now()-1E3*a),g=0;g<s.length;g++){var l=s[g];a=l[0];if(!(a<f)){var k=String(l[1]);d[k]||(d[k]=t[c++%t.length]);a=["%c"+(a/1E3).toFixed(6),d[k],k];for(k=2;k<l.length;k++)a.push(l[k]);
b.log.apply(this,a)}}s.splice(0)};a.Hy=function(a){a||(a=1);for(var c={},d=Math.max(0,performance.now()-1E3*a),f=0;f<s.length;f++){var g=s[f];a=g[0];if(!(a<d))for(var l=2;l<g.length;l++){var k=String(g[1]);3<g.length&&(k+="_"+String(l-2));c[k]||(c[k]=k+"\n");c[k]+=String(a)+" "+g[l]+"\n"}}a="";for(k in c)a+=c[k]+"\n\n";b.log(a);s.splice(0)};a.PB=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&
b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&b("gecko")&&b("firefox");case "msie":return b("mozilla")&&b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.SB=function(a){if(h.nh(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1}};b4w.module.__extensions=function(a,q){function c(a){if(a in d)return d[a];var c=e.getExtension(a)||null;d[a]=c;b.log("%cGET EXTENSION","color: #"+(c?"0a0":"a00"),a);return c}var b=q("__print"),e=null,d={};a.Bc=function(a){e=a};a.Qo=function(){return c("WEBGL_compressed_texture_s3tc")||c("WEBKIT_WEBGL_compressed_texture_s3tc")||c("MOZ_WEBGL_compressed_texture_s3tc")};a.Dw=function(){return c("WEBGL_depth_texture")||c("WEBKIT_WEBGL_depth_texture")||c("MOZ_WEBGL_depth_texture")};a.uw=function(){return c("EXT_texture_filter_anisotropic")||
c("WEBKIT_EXT_texture_filter_anisotropic")||c("MOZ_EXT_texture_filter_anisotropic")};a.Go=function(){return c("WEBGL_debug_shaders")};a.Pw=function(){return c("WEBGL_debug_renderer_info")};a.Io=function(){return c("OES_element_index_uint")};a.Vw=function(){return c("OES_standard_derivatives")};a.ga=function(){d={}}};b4w.module.__graph=function(a){function q(a,b,d){d||(d=null);if(c(a,b))throw"Graph already has node with given ID";a.Ia.push(b,d)}function c(a,b){for(var c=a.Ia,r=0;r<c.length;r+=2)if(c[r]==b)return!0;return!1}function b(a,b,d,r){r||(r=null);if(c(a,b)&&c(a,d))a.Ba.push(b,d,r);else throw"Wrong node IDs";}function e(a,b){if(!c(a,b))throw"Node not found";for(var d=a.Ia,r=0;r<d.length;r+=2)d[r]==b&&(d.splice(r,2),r-=2)}function d(a){a=a.Ia;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}
function h(a,b){for(var c=a.Ia,r=0;r<c.length;r+=2)if(c[r+1]==b)return c[r];return O}function p(a){var b=[],c={};n(a,c);for(var r=a.Ia,m=0;m<r.length;m+=2)0==g(a,r[m])&&k(a,r[m],c,b);return{Ia:b,Ba:a.Ba.slice(0)}}function n(a,b){for(var c=a.Ia,r=0;r<c.length;r+=2)b[c[r]]=!1}function k(a,b,c,r){if(!c[b]){c[b]=!0;for(var m=0;m<u(a,b);m++)k(a,E(a,b,m),c,r);r.unshift(b,y(a,b))}}function l(a,b,c,r){if(!c[b]){c[b]=!0;if(r==Q||r==M)for(var m=0;m<u(a,b);m++){var d=E(a,b,m);l(a,d,c,r)}if(r==P||r==M)for(m=
0;m<g(a,b);m++)d=I(a,b,m),l(a,d,c,r)}}function s(a){var b=a.Ia;a=a.Ba;for(var c=[],r=[],m=[],d=0;d<b.length;d++)m[b[2*d]]=d,c.push(d,b[2*d+1]);for(d=0;d<a.length;d+=3)r.push(m[a[d]],m[a[d+1]],a[d+2]);return{Ia:c,Ba:r}}function f(a,b,c){if(c.Hc==c.ie){for(var r=0,m=0;r<c.ie;r++)c.hd[r]!=O&&(a[m]=r,b[m]=c.hd[r],m++);return!0}if(c.ie>c.Wf||c.ue>c.ve||c.ng>c.pg||c.mg>c.og)return!1;for(var m=r=O,d=!1;!d&&t(c,H,r,m);)if(r=H[0],m=H[1],A(c,r,m)){var l;l=c;d={};d.eh=l.eh;d.fh=l.fh;d.Hl=l.Hl;d.bj=l.bj;d.ie=
l.ie;d.Wf=l.Wf;d.ke=l.ke;d.Hc=d.xj=l.Hc;d.mg=l.mg;d.ng=l.ng;d.ue=l.ue;d.og=l.og;d.pg=l.pg;d.ve=l.ve;d.Gg=O;d.hd=l.hd;d.Ge=l.Ge;d.Ue=l.Ue;d.Ve=l.Ve;d.af=l.af;d.bf=l.bf;d.Mj=l.Mj;l.Mj[0]+=1;var d=l=d,k=r,e=m,h=d.eh,n=d.fh,p=d.ie,s=d.Wf,w=d.hd,y=d.Ge,F=d.Ue,G=d.Ve,v=d.af,T=d.bf;D(k<p);D(e<s);D(d.Hc<p);D(d.Hc<s);p=++d.Hc;d.Gg=k;F[k]||(F[k]=p,d.mg++,v[k]&&d.ue++);v[k]||(v[k]=p,d.ng++,F[k]&&d.ue++);G[e]||(G[e]=p,d.og++,T[e]&&d.ve++);T[e]||(T[e]=p,d.pg++,G[e]&&d.ve++);w[k]=e;y[e]=k;for(w=0;w<g(h,k);w++)y=
I(h,k,w),F[y]||(F[y]=p,d.mg++,v[y]&&d.ue++);for(w=0;w<u(h,k);w++)y=E(h,k,w),v[y]||(v[y]=p,d.ng++,F[y]&&d.ue++);for(w=0;w<g(n,e);w++)y=I(n,e,w),G[y]||(G[y]=p,d.og++,T[y]&&d.ve++);for(w=0;w<u(n,e);w++)y=E(n,e,w),T[y]||(T[y]=p,d.pg++,G[y]&&d.ve++);d=f(a,b,l);D(1>=l.Hc-l.xj);D(l.Gg!=O);y=l.eh;k=l.fh;e=l.Hc;h=l.Gg;n=l.hd;F=l.Ge;p=l.Ue;G=l.Ve;s=l.af;v=l.bf;if(l.xj<e){p[h]==e&&(p[h]=0);for(T=0;T<g(y,h);T++)w=I(y,h,T),p[w]==e&&(p[w]=0);s[h]==e&&(s[h]=0);for(T=0;T<u(y,h);T++)w=E(y,h,T),s[w]==e&&(s[w]=0);y=
n[h];G[y]==e&&(G[y]=0);for(T=0;T<g(k,y);T++)w=I(k,y,T),G[w]==e&&(G[w]=0);v[y]==e&&(v[y]=0);for(T=0;T<u(k,y);T++)w=E(k,y,T),v[w]==e&&(v[w]=0);n[h]=O;F[y]=O;l.Hc=l.xj;l.Gg=O}}return d}function t(a,b,c,r){c==O&&(c=0);r==O?r=0:r++;var m=a.ue,d=a.ve,l=a.ng,g=a.pg,f=a.mg,k=a.og,e=a.Hc,E=a.ie,h=a.Wf,n=a.hd,p=a.Ge,u=a.Ue,s=a.Ve,v=a.af,T=a.bf;if(m>e&&d>e)for(;c<E&&(n[c]!=O||0==v[c]||0==u[c]);)c++,r=0;else if(l>e&&g>e)for(;c<E&&(n[c]!=O||0==v[c]);)c++,r=0;else if(f>e&&k>e)for(;c<E&&(n[c]!=O||0==u[c]);)c++,
r=0;else if(0==c&&a.ke!=S){for(u=0;u<E&&n[c=a.ke[u]]!=O;)u++;u==E&&(c=E)}else for(;c<E&&n[c]!=O;)c++,r=0;if(m>e&&d>e)for(;r<h&&(p[r]!=O||0==T[r]||0==s[r]);)r++;else if(l>e&&g>e)for(;r<h&&(p[r]!=O||0==T[r]);)r++;else if(f>e&&k>e)for(;r<h&&(p[r]!=O||0==s[r]);)r++;else for(;r<h&&p[r]!=O;)r++;return c<E&&r<h?(b[0]=c,b[1]=r,!0):!1}function A(a,b,c){var r=a.eh,m=a.fh,d=a.Wf,l=a.hd,f=a.Ge,k=a.Ue,e=a.Ve,h=a.af,n=a.bf;D(b<a.ie);D(c<d);D(l[b]==O);D(f[c]==O);if(!(0,a.Hl)(y(r,b),y(m,c)))return!1;for(var p=d=
0,s=0,A=0,t=0,H=0,v=0;v<u(r,b);v++){var T=E(r,b,v);if(l[T]!=O){var F=l[T];if(!w(m,c,F)||!G(a.bj,r,b,T,m,c,F))return!1}else k[T]&&s++,h[T]&&d++,k[T]||h[T]||t++}for(v=0;v<g(r,b);v++)if(T=I(r,b,v),l[T]!=O){if(F=l[T],!w(m,F,c)||!G(a.bj,r,T,b,m,F,c))return!1}else k[T]&&s++,h[T]&&d++,k[T]||h[T]||t++;for(v=0;v<u(m,c);v++)if(F=E(m,c,v),f[F]!=O){if(T=f[F],!w(r,b,T))return!1}else e[F]&&A++,n[F]&&p++,e[F]||n[F]||H++;for(v=0;v<g(m,c);v++)if(F=I(m,c,v),f[F]!=O){if(T=f[F],!w(r,T,b))return!1}else e[F]&&A++,n[F]&&
p++,e[F]||n[F]||H++;return s<=A&&d<=p&&t<=H}function D(a){if(!a)throw"Assertion failed";}function y(a,b){for(var c=a.Ia,r=0;r<c.length;r+=2)if(c[r]==b)return c[r+1];return null}function u(a,b){for(var c=a.Ba,r=0,m=0;m<c.length;m+=3)c[m]==b&&r++;return r}function g(a,b){for(var c=a.Ba,r=0,m=0;m<c.length;m+=3)c[m+1]==b&&r++;return r}function E(a,b,c){a=a.Ba;for(var r=0,m=0;m<a.length;m+=3)if(a[m]==b){if(r==c)return a[m+1];r++}return O}function I(a,b,c){a=a.Ba;for(var r=0,m=0;m<a.length;m+=3)if(a[m+
1]==b){if(r==c)return a[m];r++}return O}function w(a,b,c){a=a.Ba;for(var r=0;r<a.length;r+=3)if(a[r]==b&&a[r+1]==c)return!0;return!1}function G(a,b,c,r,m,d,l){for(var g=F(b,c,r),f=F(m,d,l),k=0;k<g;k++){for(var e=!1,E=0;E<f;E++)if(a(x(b,c,r,k),x(m,d,l,E))){e=!0;break}if(!e)return!1}return!0}function F(a,b,c){var r=0;a=a.Ba;for(var m=0;m<a.length;m+=3)a[m]==b&&a[m+1]==c&&r++;return r}function x(a,b,c,r){a=a.Ba;for(var m=0,d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c){if(m==r)return a[d+2];m++}return null}
var O=-1,S=0,Q=10,P=20,M=30,H=[O,O];a.Ym=O;a.CB=Q;a.jr=P;a.HB=M;a.create=function(){for(var a=arguments,b=[],c=[],r=0;r<a.length;r++){var m=a[r];switch(m.length){case 2:b.push(m[0],m[1]);break;case 3:c.push(m[0],m[1],m[2]);break;default:throw"Wrong graph constructor params";}}return{Ia:b,Ba:c}};a.dC=function(a,b){for(var c=[],r=[],m=0;m<a.length;m++)c.push(a[m][0],a[m][1]);for(m=0;m<b.length;m++)r.push(b[m][0],b[m][1],b[m][2]);return{Ia:c,Ba:r}};a.rn=q;a.NC=c;a.Ld=b;a.cg=e;a.vd=function(a,b,c,r){if(!w(a,
b,c))throw"Edge not found";a=a.Ba;for(var m=0,d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c){if(-1==r)a.splice(d,3);else{if(r==m){a.splice(d,3);break}m++}d-=3}};a.q=function(a,b){if(h(a,b)==O)q(a,d(a),b);else throw"Non-unique attribute";};a.bz=function(a,b,c,r,m){a=a.Ba;for(var d=0;d<a.length;d+=3)a[d]==b&&a[d+1]==c&&a[d+2]==r&&(a[d+2]=m)};a.dw=d;a.uj=h;a.k=function(a,c,d,r){c=h(a,c);d=h(a,d);if(c!=O&&d!=O)b(a,c,d,r);else throw"Attributes not found";};a.S=function(a,b){for(var c=a.Ia,r=0;r<c.length&&
!b(c[r],c[r+1]);r+=2);};a.sf=function(a,b){for(var c=a.Ba,r=0;r<c.length&&!b(c[r],c[r+1],c[r+2]);r+=3);};a.Ed=function(a,b,c){for(var r=a.Ba,m=0;m<r.length;m+=3)if(r[m+1]==b){var d=r[m];if(c(d,y(a,d),r[m+2]))break}};a.we=function(a,b,c){for(var r=a.Ba,m=0;m<r.length;m+=3)if(r[m]==b){var d=r[m+1];if(c(d,y(a,d),r[m+2]))break}};a.Pq=p;a.zA=function(a){a=p(a).Ia;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.QC=$a();a.qA=function(a,b,d){if(!c(a,b))throw"No such node";var r={};n(a,r);l(a,
b,r,d);b=[];for(var m in r)r[m]&&(m=Number(m),b.push(m,y(a,m)));a={Ia:b,Ba:a.Ba.slice(0)};r=a.Ba;for(m=0;m<r.length;m+=3)b=r[m+1],c(a,r[m])&&c(a,b)||(r.splice(m,3),m-=3);return a};a.Tw=function(a){for(var b=[],c=a.Ia,r=0;r<c.length;r+=2){var m=c[r];g(a,m)||b.push(m)}return b};a.Ro=function(a){for(var b=[],c=a.Ia,r=0;r<c.length;r+=2){var m=c[r];u(a,m)||b.push(m)}return b};a.match=function(a,b,c,r){var m={};m.eh=s(a);m.fh=s(b);m.Hl=c||function(a,b){return a==b};m.bj=r||function(a,b){return a==b};r=
a.Ia.length/2;var d=b.Ia.length/2;m.ie=r;m.Wf=d;m.ke=S;m.Hc=m.xj=0;m.ue=m.mg=m.ng=0;m.ve=m.og=m.pg=0;m.Gg=O;m.hd=Array(r);m.Ge=Array(d);m.Ue=Array(r);m.Ve=Array(d);m.af=Array(r);m.bf=Array(d);m.Mj=[1];for(c=0;c<r;c++)m.hd[c]=O,m.Ue[c]=0,m.af[c]=0;for(c=0;c<d;c++)m.Ge[c]=O,m.Ve[c]=0,m.bf[c]=0;d=Array(r);r=Array(r);if(f(d,r,m)){for(c=0;c<d.length;c++)d[c]=a.Ia[2*d[c]],r[c]=b.Ia[2*r[c]];return[d,r]}return null};a.Sa=y;a.cf=u;a.gp=g;a.Te=E;a.Se=I;a.AC=F;a.qd=x;a.replace=function(a,b,c){for(var r=a.Ba,
m=d(a),l=0;l<b.length;l++){var g=b[l];e(a,g);for(var f=0;f<r.length;f+=3)r[f]==g&&(r[f]=m),r[f+1]==g&&(r[f+1]=m),r[f]==r[f+1]&&(r.splice(f,3),f-=3)}q(a,m,c)};a.eC=function(a,b){var c=a.Ia,r=a.Ba,m;m="digraph debug {\n    node [shape=box];\n";for(var d=0;d<c.length;d+=2){var l=c[d],f=c[d+1],f=b?b(l,f):String(l);m+="    ";m+=String(l)+' [label="'+f.replace(/\"/g,'\\"')+'"];\n'}for(d=0;d<r.length;d+=3)c=r[d],l=r[d+1],m+="    ",m+=String(c)+" -> "+String(l)+";\n";return m+="}"}};b4w.module.__ipc=function(a){a.mr=1;a.nr=2;a.or=3;a.pr=4;a.qr=5;a.rr=6;a.sr=7;a.ur=8;a.vr=9;a.wr=10;a.xr=11;a.tr=12;a.Zc=1001;a.Er=1002;a.Fr=1003;a.Gr=1004;a.Ir=1006;a.Hr=1007;a.Jr=1008;a.Kr=1009;a.Lr=1010;a.Mr=1011;a.Nr=1012;a.Or=1013;a.Pr=1014;a.Qr=1015;a.Rr=1016;a.Sr=1017;a.Tr=1018;a.Ur=1019;a.Vr=1020;a.Wr=1021;a.Xr=1022;a.Yr=1023;a.$r=1024;a.as=1025;a.bs=1026;a.cs=1027;a.$m=1028;a.ds=1029;a.es=1030;a.fs=1031;a.gs=1032;a.hs=1033;a.is=1034;a.js=1035;a.ks=1036;a.ls=1037;a.ms=1038;a.ns=1039;a.os=
1040;a.ps=1041;a.an=1042;a.Ae=1043;a.qs=1044;a.Zm=1045;a.rs=1047;a.ss=1048;a.EB=1049;a.Zr=1050;var q=a.Ae,c=null,b={},e={};e[10]={msg_id:null,body_id:null,time:null,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3)};e[8]={msg_id:null,chassis_hull_body_id:null,prop_ind:null,trans:new Float32Array(3),quat:new Float32Array(4)};e[9]={msg_id:null,body_id:null,from:new Float32Array(3),to:new Float32Array(3),local:null,body_id_b_hit:null,cur_result:null};
e[1]={msg_id:null,body_id_a:null,body_id_b:null,result:null,coll_point:new Float32Array(3)};e[q]={msg_id:null,body_id:null,trans:new Float32Array(3),quat:new Float32Array(4)};var d={10:["msg_id",1,"body_id",1,"time",1,"trans",3,"quat",4,"linvel",3,"angvel",3],8:["msg_id",1,"chassis_hull_body_id",1,"prop_ind",1,"trans",3,"quat",4],9:["msg_id",1,"body_id",1,"from",3,"to",3,"local",1,"body_id_b_hit",1,"cur_result",1],1:["msg_id",1,"body_id_a",1,"body_id_b",1,"result",1,"coll_point",3]};d[q]=["msg_id",
1,"body_id",1,"trans",3,"quat",4];var h={};a.jh=function(a,b){a.addEventListener("message",function(a){var c=a.data[0];if(c in d){a=a.data;for(var h=a[0],f=e[h],h=d[h],p=0,A=0;A<h.length;A+=2){var D=h[A],y=h[A+1],u=p+y;if(1==y)f[D]=a[p];else for(var g=0;g<y;g++)f[D][g]=a[p+g];p=u}a=f}else a=a.data;b(c,a)},!1);c=a};a.ga=function(){c=null;b={}};a.p=function(){var a=arguments[0];if(a in d){var n=e[a],k=d[a],l=0;if(!(a in h)){for(var s=0,f=1;f<k.length;f+=2)s+=k[f];h[a]=new Float32Array(s)}s=h[a];for(f=
0;f<k.length;f+=2){var t=n[k[f]],A=k[f+1];1==A?s[l]=t:s.set(t,l);l+=A}a in b||(b[a]=s);a=b[a]}else for(n=arguments.length,(a in b)||(b[a]=Array(n),b[a][0]=a),a=b[a],k=1;k<n;k++)a[k]=arguments[k];c.postMessage(a)};a.Lo=function(a){return e[a]}};b4w.module.__hud=function(a,q){function c(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function b(a){e(' SCENE "'+a.name+'"');if(a.d){var b=0,c=0;n.S(a.d.Ta,function(a,d){if("SINK"==d.type)e(" (F)",d.type);else{var l=d.type,f=Math.round(d.i.width)+"x"+Math.round(d.i.height),k=d.n.length,h=d.Li,n=d.Px.length,p=d.K&&d.T;p?e(" (A)",l,n,f,h,"of",k):e(" (P)",l,n,f,h,"of",k);d.Li=0;p&&(b+=k,c+=h)}});return[b,c]}e("No INFO")}function e(){for(var a=k,b=l+t[0]*s,
c=[5,18,2,10,4,3,5],d=arguments[0],g=1;g<arguments.length;g++){for(var e="",h=0;h<c[g]-String(arguments[g]).length;h++)e+=" ";d+=e+arguments[g]}t[0]++;f.fillText(d,a,b)}function d(a,b,c){b*=a.wa;c.x=a.x+b;c.y=a.y;c.wa=a.wa-2*b;c.sa=a.sa}function h(a){return a.x+a.wa/2}function p(a){var b=f,c={x:0,y:0,wa:0,sa:0},l=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.wa=l;c.sa=b;d(c,0.01,c);l=0.02*c.sa;c.x=c.x;c.y+=l;c.wa=c.wa;c.sa-=2*l;l=c.wa/8;c.x+=l*a;c.y=c.y;c.wa=l;c.sa=c.sa;d(c,0.02,c);return c}var n=
q("__graph"),k=30,l=80,s=20,f=null,t=[0,0];a.jh=function(a){a=a.getContext("2d");c(a);return f=a};a.gi=function(){f&&c(f)};a.reset=function(){var a=f;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),t[0]=0,t[1]=0)};a.Zz=function(a,c){var d=f;if(d){d.textAlign="left";d.fillStyle="rgba(0,255,0,255)";e(" FPS",(1/c).toFixed(2));t[0]++;for(var l=d=0,g=0;g<a.length;g++){var k=b(a[g]),d=d+k[0],l=l+k[1];t[0]++}e(" ---------------------------------------------");
e("    ","TOTAL ACTIVE","","",l,"of",d)}};a.print=function(){var a=f;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",e.apply(Math,arguments))};a.Gy=function(a,b,c,d,l,k,e){var n=f;if(n){b=p(b);var s=b.sa/5;b.x=b.x;b.y+=4*s;b.wa=b.wa;b.sa=s;n.textAlign="center";n.fillStyle="#00FF00";f.fillText(a,h(b),b.y-10);n.strokeStyle="#00FF00";n.lineWidth=0.5;n.beginPath();n.moveTo(b.x,b.y);n.lineTo(b.x+b.wa,b.y);n.lineTo(b.x+b.wa,b.y+b.sa);n.lineTo(b.x,b.y+b.sa);n.closePath();n.stroke();if(!k&&!e)for(k=
1E6,e=-1E6,a=0;a<c.length;a++)k=Math.min(k,c[a]),e=Math.max(e,c[a]);n.textAlign="right";f.fillText(String(k),b.x-10,b.y+b.sa);f.fillText(String(e),b.x-10,b.y);n.textAlign="center";f.fillText(String(d),b.x,b.y+b.sa+15);f.fillText(String(l),b.x+b.wa,b.y+b.sa+15);n.strokeStyle="#FF0000";n.lineWidth=1.5;n.beginPath();d=b.wa/(c.length-1);e=b.sa/(e-k);for(a=0;a<c.length;a++)l=b.x+d*a,s=b.y+b.sa-(c[a]-k)*e,0==a?n.moveTo(l,s):n.lineTo(l,s);n.stroke()}};a.zv=function(a,b,c,d,l,k,e){var n=f;if(n)for(n.textAlign=
"center",n.fillStyle="#00FF00",n.font="bold 12px Courier",c=p(c),f.fillText(b?"["+a+"]":a,h(c),c.y),0<=k&&f.fillText(k?"[M]":"[ ]",h(c)-15,c.y+30),0<=e&&f.fillText(e?"[S]":"[ ]",h(c)+15,c.y+30),a={x:0,y:0,wa:0,sa:0},b=0;b<d.length;b++){k=d[b];var s="VOLUME"==k[0];if(s){e=c.y+350;var t=c.wa,x=a;x.x=c.x;x.y=e;x.wa=t;x.sa=250}else{e=c.y+10+50*b;var t=c.wa,x=c.sa,q=a;q.x=c.x;q.y=e;q.wa=t;q.sa=x}e=n;var t=a,q=b==l,S=k[0],x=k[1],Q=k[2],P=k[3],M=(P-Q)/k[4],M=1>M?Math.floor(1/M-1E-5).toFixed(0).length:0;
k=k[5]?Math.log(x/Q)/Math.log(P/Q):(x-Q)/(P-Q);e.textAlign="center";q?e.fillText("["+S+"]",h(t),t.y):e.fillText(S,h(t),t.y);e.strokeStyle="#00FF00";e.lineWidth=s?3:1;s?(e.textAlign="right",e.fillText(P.toFixed(M),h(t)-10,t.y+15),e.textAlign="right",e.fillText(Q.toFixed(M),h(t)-10,t.y+t.sa-15)):(e.textAlign="right",e.fillText(Q.toFixed(M),t.x+28,t.y+15),e.textAlign="left",e.fillText(P.toFixed(M),t.x+t.wa-28,t.y+15));e.beginPath();if(s){var H=t.y+15+(t.sa-30)*(1-k);e.moveTo(h(t),t.y+15);e.lineTo(h(t),
t.y+t.sa-15);e.moveTo(h(t)-5,t.y+15);e.lineTo(h(t)+5,t.y+15);e.moveTo(h(t)-5,t.y+t.sa-15);e.lineTo(h(t)+5,t.y+t.sa-15);e.moveTo(h(t)-5,H);e.lineTo(h(t)+5,H)}else{var K=t.x+30+(t.wa-60)*k;e.moveTo(t.x+30,t.y+15);e.lineTo(t.x+t.wa-30,t.y+15);e.moveTo(t.x+30,t.y+15-5);e.lineTo(t.x+30,t.y+15+5);e.moveTo(t.x+t.wa-30,t.y+15-5);e.lineTo(t.x+t.wa-30,t.y+15+5);e.moveTo(K,t.y+15-5);e.lineTo(K,t.y+15+5)}e.stroke();"EQ_Q"==S?(k=Math.log(1+1/(2*x*x)+Math.sqrt((2+1/(x*x))*(2+1/(x*x))/4-1))/Math.log(2),s?(e.textAlign=
"left",e.fillText(x.toFixed(M),h(t)+10,H),e.textAlign="left",e.fillText("("+k.toFixed(M+1)+")",h(t)+10,H+10)):(e.textAlign="right",e.fillText(x.toFixed(M),K,t.y+30),e.textAlign="left",e.fillText("("+k.toFixed(M+1)+")",K,t.y+30))):s?(e.textAlign="left",e.fillText(x.toFixed(M),h(t)+10,H)):(e.textAlign="center",e.fillText(x.toFixed(M),K,t.y+30))}}};b4w.module.__renderer=function(a,q){function c(a){if(a){var b=(a.da?l.COLOR_BUFFER_BIT:0)|(a.ha?l.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=s;break;case "DEPTH":a=f;break;case "SHORE_SMOOTHING":a=s;break;case "COLOR_PICKING":a=t;break;case "GLOW_MASK":a=A;break;default:a=k.Jg}}else b=l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT,a=k.Jg;l.colorMask(!0,!0,!0,!0);l.depthMask(!0);l.clearColor(a[0],a[1],a[2],a[3]);l.clear(b)}function b(a,b,c){var d=b.attributes;b=b.zn;l.bindBuffer(l.ARRAY_BUFFER,
a.vg);for(var f=a.kc,k=b.length;k--;){var g=b[k],e=d[g],g=f[g];l.enableVertexAttribArray(e);l.vertexAttribPointer(e,g.Ch,l.FLOAT,!1,0,c&&1<g.frames?(g.offset+c*g.length)*D:g.offset*D)}a.ce?(l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,a.ce),l.drawElements(a.mode,a.count,a.ep,0)):l.drawArrays(a.mode,0,a.count);for(k=b.length;k--;)g=b[k],l.disableVertexAttribArray(d[g])}function e(a){switch(a){case 0:return l.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 1:return l.TEXTURE_CUBE_MAP_POSITIVE_Y;case 2:return l.TEXTURE_CUBE_MAP_POSITIVE_X;
case 3:return l.TEXTURE_CUBE_MAP_NEGATIVE_X;case 4:return l.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return l.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function d(a){var b=a.Fd,c=[],d={},l=[],f={},k;for(k in b){var g=!1;switch(k){case "u_proj_matrix":var e=function(a,b,c,d,r,m){a.uniformMatrix4fv(b,!1,m.ta)},g=!0;break;case "u_view_matrix":case "u_view_matrix_frag":e=function(a,b,c,d,r,m){a.uniformMatrix4fv(b,!1,m.Aa)};g=!0;break;case "u_view_proj_prev":e=function(a,b,c,d,r,m){a.uniformMatrix4fv(b,!1,m.Yp)};g=!0;break;
case "u_view_proj_inverse":e=function(a,b,c,d,r,m){a.uniformMatrix4fv(b,!1,m.wg)};g=!0;break;case "u_sky_vp_inverse":e=function(a,b,c,d,r,m){a.uniformMatrix4fv(b,!1,m.Uc)};g=!0;break;case "u_camera_eye":case "u_camera_eye_frag":e=function(a,b,c,d,r,m){a.uniform3fv(b,m.Zd)};g=!0;break;case "u_camera_eye_last":e=function(a,b,c,d,r,m){a.uniform3fv(b,m.uo)};g=!0;break;case "u_camera_quat":e=function(a,b,c,d,r,m){a.uniform4fv(b,m.h)};g=!0;break;case "u_view_max_depth":e=function(a,b,c,d,r,m){a.uniform1f(b,
m.bb)};g=!0;break;case "u_camera_range":e=function(a,b,c,d,r,m){a.uniform2f(b,m.pb,m.bb)};break;case "u_cam_water_depth":e=function(a,b,c){a.uniform1f(b,c.In)};g=!0;break;case "u_waves_height":e=function(a,b,c){a.uniform1f(b,c.yf)};break;case "u_waves_length":e=function(a,b,c){a.uniform1f(b,c.zg)};break;case "u_caust_scale":e=function(a,b,c){a.uniform1f(b,c.Kn)};break;case "u_caust_bright":e=function(a,b,c){a.uniform1f(b,c.Jn)};break;case "u_caust_speed":e=function(a,b,c){a.uniform2fv(b,c.Ln)};break;
case "u_fog_color_density":e=function(a,b,c){a.uniform4fv(b,c.Hb)};break;case "u_underwater_fog_color_density":e=function(a,b,c){a.uniform4fv(b,c.Eb)};break;case "u_shadow_visibility_falloff":e=function(a,b,c){a.uniform1f(b,c.Lj)};break;case "u_bloom_key":e=function(a,b,c){a.uniform1f(b,c.Bk)};break;case "u_bloom_edge_lum":e=function(a,b,c){a.uniform1f(b,c.Ak)};break;case "u_time":e=function(a,b,c){a.uniform1f(b,c.time)};g=!0;break;case "u_wind":e=function(a,b,c){a.uniform3fv(b,c.ac)};break;case "u_horizon_color":e=
function(a,b,c){a.uniform3fv(b,c.Mc)};break;case "u_zenith_color":e=function(a,b,c){a.uniform3fv(b,c.Wc)};break;case "u_environment_energy":e=function(a,b,c){a.uniform1f(b,c.Yd)};break;case "u_sky_color":e=function(a,b,c){a.uniform3fv(b,c.Xh)};break;case "u_rayleigh_brightness":e=function(a,b,c){a.uniform1f(b,c.Mh)};break;case "u_mie_brightness":e=function(a,b,c){a.uniform1f(b,c.yh)};break;case "u_spot_brightness":e=function(a,b,c){a.uniform1f(b,c.$h)};break;case "u_scatter_strength":e=function(a,
b,c){a.uniform1f(b,c.Sh)};break;case "u_rayleigh_strength":e=function(a,b,c){a.uniform1f(b,c.Oh)};break;case "u_mie_strength":e=function(a,b,c){a.uniform1f(b,c.Bh)};break;case "u_rayleigh_collection_power":e=function(a,b,c){a.uniform1f(b,c.Nh)};break;case "u_mie_collection_power":e=function(a,b,c){a.uniform1f(b,c.zh)};break;case "u_mie_distribution":e=function(a,b,c){a.uniform1f(b,c.Ah)};break;case "u_light_positions":e=function(a,b,c){a.uniform3fv(b,c.th)};break;case "u_light_directions":e=function(a,
b,c){a.uniform3fv(b,c.qh)};break;case "u_light_color_intensities":e=function(a,b,c){a.uniform3fv(b,c.ph)};break;case "u_light_factors1":e=function(a,b,c){a.uniform4fv(b,c.rh)};break;case "u_light_factors2":e=function(a,b,c){a.uniform4fv(b,c.sh)};break;case "u_sun_quaternion":e=function(a,b,c){a.uniform4fv(b,c.ci)};break;case "u_sun_intensity":e=function(a,b,c){a.uniform3fv(b,c.bi)};break;case "u_sun_direction":e=function(a,b,c){a.uniform3fv(b,c.rf)};break;case "u_height":e=function(a,b,c,d,r,m){a.uniform1f(b,
m.height)};g=!0;break;case "u_model_matrix":e=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.I)};g=!0;break;case "u_transb":e=function(a,b,c,d){a.uniform4fv(b,d.Rj)};g=!0;break;case "u_transa":e=function(a,b,c,d){a.uniform4fv(b,d.Qj)};g=!0;break;case "u_quat":e=function(a,b,c,d){a.uniform4fv(b,d.h)};g=!0;break;case "u_quatsb":e=function(a,b,c,d){a.uniform4fv(b,d.Hj)};g=!0;break;case "u_quatsa":e=function(a,b,c,d){a.uniform4fv(b,d.Gj)};g=!0;break;case "u_frame_factor":e=function(a,b,c,d){a.uniform1f(b,
d.ej)};g=!0;break;case "au_center_pos":e=$a();g=!0;break;case "au_wind_bending_amp":e=function(a,b,c,d){a.uniform1f(b,d.Hd)};g=!0;break;case "au_wind_bending_freq":e=function(a,b,c,d){a.uniform1f(b,d.zf)};g=!0;break;case "au_detail_bending_freq":e=function(a,b,c,d){a.uniform1f(b,d.Ke)};g=!0;break;case "au_detail_bending_amp":e=function(a,b,c,d){a.uniform1f(b,d.Je)};g=!0;break;case "au_branch_bending_amp":e=function(a,b,c,d){a.uniform1f(b,d.De)};g=!0;break;case "u_diffuse_color":e=function(a,b,c,d,
r){a.uniform4fv(b,r.ya)};g=!0;break;case "u_diffuse_intensity":e=function(a,b,c,d,r){a.uniform1f(b,r.Hf)};g=!0;break;case "u_diffuse_params":e=function(a,b,c,d,r){a.uniform2fv(b,r.Le)};g=!0;break;case "u_emit":e=function(a,b,c,d,r){a.uniform1f(b,r.Pe)};g=!0;break;case "u_ambient":e=function(a,b,c,d,r){a.uniform1f(b,r.ad)};g=!0;break;case "u_specular_color":e=function(a,b,c,d,r){a.uniform3fv(b,r.Nb)};g=!0;break;case "u_specular_params":e=function(a,b,c,d,r){a.uniform2fv(b,r.Ob)};g=!0;break;case "u_reflect_factor":e=
function(a,b,c,d,r){a.uniform1f(b,r.Ql)};g=!0;break;case "u_mirror_factor":e=function(a,b,c,d,r){a.uniform1f(b,r.rj)};g=!0;break;case "u_grass_map_dim":e=function(a,b,c,d,r){a.uniform3fv(b,r.Ub)};g=!0;break;case "u_grass_size":e=function(a,b,c,d,r){a.uniform1f(b,r.Zo)};g=!0;break;case "u_scale_threshold":e=function(a,b,c,d,r){a.uniform1f(b,r.ll)};g=!0;break;case "u_cube_fog":e=function(a,b,c,d,r){a.uniformMatrix4fv(b,!1,r.jd)};break;case "u_jitter_amp":e=function(a,b,c,d,r){a.uniform1f(b,r.ql)};g=
!0;break;case "u_jitter_freq":e=function(a,b,c,d,r){a.uniform1f(b,r.rl)};g=!0;break;case "u_wireframe_mode":e=function(a,b,c,d,r){a.uniform1i(b,r.bk)};break;case "u_wireframe_edge_color":e=function(a,b,c,d,r){a.uniform3fv(b,r.dr)};break;case "u_subpixel_jitter":e=function(a,b,c){a.uniform2fv(b,c.sl)};g=!0;break;case "u_subsample_indices":e=function(a,b,c){a.uniform4fv(b,c.sp)};g=!0;break;case "u_halo_size":e=function(a,b,c,d,r){a.uniform1f(b,r.mx)};g=!0;break;case "u_halo_hardness":e=function(a,b,
c,d,r){a.uniform1f(b,r.jx)};g=!0;break;case "u_halo_rings_color":e=function(a,b,c,d,r){a.uniform3fv(b,r.lx)};g=!0;break;case "u_halo_lines_color":e=function(a,b,c,d,r){a.uniform3fv(b,r.kx)};g=!0;break;case "u_halo_stars_blend":e=function(a,b,c,d,r){a.uniform1f(b,r.nx)};g=!0;break;case "u_halo_stars_height":e=function(a,b,c,d,r){a.uniform1f(b,r.ox)};g=!0;break;case "u_fresnel_params":e=function(a,b,c,d,r){a.uniform4fv(b,r.od)};g=!0;break;case "u_texture_scale":e=function(a,b,c,d,r){a.uniform3fv(b,
r.Vc)};g=!0;break;case "u_parallax_scale":e=function(a,b,c,d,r){a.uniform1f(b,r.Jl)};g=!0;break;case "u_color_id":e=function(a,b,c,d,r){a.uniform3fv(b,r.Zt)};g=!0;break;case "u_line_points":e=function(a,b,c,d,r){a.uniform3fv(b,r.Qx)};g=!0;break;case "u_diffuse_color_factor":e=function(a,b,c,d,r){a.uniform1f(b,r.kd)};g=!0;break;case "u_specular_color_factor":e=function(a,b,c,d,r){a.uniform1f(b,r.fA)};g=!0;break;case "u_normal_factor":e=function(a,b,c,d,r){a.uniform1f(b,r.my)};g=!0;break;case "u_colormap0_uv_velocity":e=
function(a,b,c,d,r){a.uniform2fv(b,r.wc)};g=!0;break;case "u_normalmap0_uv_velocity":e=function(a,b,c,d,r){a.uniform2fv(b,r.Ye[0])};g=!0;break;case "u_normalmap1_uv_velocity":e=function(a,b,c,d,r){a.uniform2fv(b,r.Ye[1])};g=!0;break;case "u_normalmap2_uv_velocity":e=function(a,b,c,d,r){a.uniform2fv(b,r.Ye[2])};g=!0;break;case "u_normalmap3_uv_velocity":e=function(a,b,c,d,r){a.uniform2fv(b,r.Ye[3])};g=!0;break;case "u_normalmap0_scale":e=function(a,b,c,d,r){a.uniform2fv(b,r.Xf[0])};g=!0;break;case "u_normalmap1_scale":e=
function(a,b,c,d,r){a.uniform2fv(b,r.Xf[1])};g=!0;break;case "u_normalmap2_scale":e=function(a,b,c,d,r){a.uniform2fv(b,r.Xf[2])};g=!0;break;case "u_normalmap3_scale":e=function(a,b,c,d,r){a.uniform2fv(b,r.Xf[3])};g=!0;break;case "u_foam_factor":e=function(a,b,c,d,r){a.uniform1f(b,r.Wk)};g=!0;break;case "u_foam_uv_freq":e=function(a,b,c,d,r){a.uniform2fv(b,r.Uv)};g=!0;break;case "u_foam_mag":e=function(a,b,c,d,r){a.uniform2fv(b,r.Sv)};g=!0;break;case "u_foam_scale":e=function(a,b,c,d,r){a.uniform2fv(b,
r.Tv)};g=!0;break;case "u_shallow_water_col":e=function(a,b,c,d,r){a.uniform3fv(b,r.lf)};g=!0;break;case "u_shore_water_col":e=function(a,b,c,d,r){a.uniform3fv(b,r.mf)};g=!0;break;case "u_water_shallow_col_fac":e=function(a,b,c,d,r){a.uniform1f(b,r.Xl)};g=!0;break;case "u_water_shore_col_fac":e=function(a,b,c,d,r){a.uniform1f(b,r.Zl)};g=!0;break;case "u_p_starttime":e=function(a,b,c,d,r){a.uniform1f(b,r.Pp)};g=!0;break;case "u_p_endtime":e=function(a,b,c,d,r){a.uniform1f(b,r.Op)};g=!0;break;case "u_p_cyclic":e=
function(a,b,c,d,r){a.uniform1i(b,r.Np)};g=!0;break;case "u_p_max_lifetime":e=function(a,b,c,d,r){a.uniform1f(b,r.wy)};g=!0;break;case "u_p_fade_in":e=function(a,b,c,d,r){a.uniform1f(b,r.sy)};g=!0;break;case "u_p_fade_out":e=function(a,b,c,d,r){a.uniform1f(b,r.ty)};g=!0;break;case "u_p_size":e=function(a,b,c,d,r){a.uniform1f(b,r.yy)};g=!0;break;case "u_p_alpha_start":e=function(a,b,c,d,r){a.uniform1f(b,r.qy)};g=!0;break;case "u_p_alpha_end":e=function(a,b,c,d,r){a.uniform1f(b,r.py)};g=!0;break;case "u_p_nfactor":e=
function(a,b,c,d,r){a.uniform1f(b,r.xy)};g=!0;break;case "u_p_gravity":e=function(a,b,c,d,r){a.uniform1f(b,r.uy)};g=!0;break;case "u_p_mass":e=function(a,b,c,d,r){a.uniform1f(b,r.vy)};g=!0;break;case "u_p_size_ramp":e=function(a,b,c,d,r){a.uniform2fv(b,r.zy)};g=!0;break;case "u_p_color_ramp":e=function(a,b,c,d,r){a.uniform4fv(b,r.ry)};g=!0;break;case "u_p_wind":e=function(a,b,c,d,r){a.uniform3fv(b,r.Ay)};g=!0;break;case "u_texel_size":e=function(a,b,c,d,r){a.uniform2fv(b,r.$)};g=!0;break;case "u_p_time":e=
function(a,c,d,e,r){a.uniform1f(b.u_p_time,1===r.Np?d.time%(r.Op-r.Pp):e.time)};g=!0;break;case "u_va_frame_factor":e=function(a,b,c,d){a.uniform1f(b,d.YA)};g=!0;break;case "u_v_light_matrix":e=function(a,b,c){a.uniformMatrix4fv(b,!1,c.XA)};g=!0;break;case "u_b_light_matrix":e=function(a,b,c){a.uniformMatrix4fv(b,!1,c.ht)};break;case "u_p_light_matrix0":e=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Zf[0])};g=!0;break;case "u_p_light_matrix1":e=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Zf[1])};g=!0;
break;case "u_p_light_matrix2":e=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Zf[2])};g=!0;break;case "u_p_light_matrix3":e=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Zf[3])};g=!0;break;case "u_motion_blur_exp":e=function(a,b,c){a.uniform1f(b,c.ey)};g=!0;break;case "u_refl_plane":e=function(a,b,c){a.uniform4fv(b,c.yb)};break;case "u_radial_blur_step":e=function(a,b,c){a.uniform1f(b,c.Pl)};break;case "u_god_rays_intensity":e=function(a,b,c){a.uniform1f(b,c.kl)};break;case "u_ssao_radius_increase":e=function(a,
b,c){a.uniform1f(b,c.mm)};break;case "u_ssao_dithering_amount":e=function(a,b,c){a.uniform1f(b,c.hm)};break;case "u_ssao_gauss_center":e=function(a,b,c){a.uniform1f(b,c.im)};break;case "u_ssao_gauss_width_square":e=function(a,b,c){a.uniform1f(b,c.km)};break;case "u_ssao_gauss_width_left_square":e=function(a,b,c){a.uniform1f(b,c.jm)};break;case "u_ssao_influence":e=function(a,b,c){a.uniform1f(b,c.lm)};break;case "u_ssao_dist_factor":e=function(a,b,c){a.uniform1f(b,c.gm)};break;case "u_dof_dist":e=
function(a,b,c,d,r,m){a.uniform1f(b,m.Wd)};g=!0;break;case "u_dof_front":e=function(a,b,c,d,r,m){a.uniform1f(b,m.Yg)};g=!0;break;case "u_dof_rear":e=function(a,b,c,d,r,m){a.uniform1f(b,m.$g)};g=!0;break;case "u_glow_intensity":e=function(a,b,c,d,r){a.uniform1f(b,r.ae)};g=!0;break;case "u_glow_color":e=function(a,b,c){a.uniform3fv(b,c.fj)};break;case "u_draw_glow":e=function(a,b,c){a.uniform1f(b,c.yv)};g=!0;break;case "u_blur_depth_edge_size":e=function(a,b,c){a.uniform1f(b,c.Lg)};break;case "u_blur_depth_diff_threshold":e=
function(a,b,c){a.uniform1f(b,c.Kg)};break;case "u_brightness":e=function(a,b,c){a.uniform1f(b,c.Og)};break;case "u_contrast":e=function(a,b,c){a.uniform1f(b,c.Ug)};break;case "u_exposure":e=function(a,b,c){a.uniform1f(b,c.dh)};break;case "u_saturation":e=function(a,b,c){a.uniform1f(b,c.eg)};break;case "u_saturation":e=function(a,b,c){a.uniform1f(b,c.eg)};break;default:e=null}e&&(g?(c.push(k),d[k]=e):(l.push(k),f[k]=e))}a.xm=d;a.Sq=c;a.Ih=f;a.Vp=l}var h=q("__config"),p=q("__debug"),n=q("__textures"),
k=h.s,l=null,s=[1,1,1,1],f=[1,1,1,1],t=[0,0,0,1],A=[0,0,0,0],D=4,y=!1,u=new Uint8Array(4),g=0,E=[new Float32Array([0.25,-0.25]),new Float32Array([-0.25,0.25])],I=[new Float32Array([1,1,1,0]),new Float32Array([2,2,2,0])];a.Bc=function(a){var b=k.Jg;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);l=a};a.Vi=function(a){if(a.T){var f=a.i;
l.bindFramebuffer(l.FRAMEBUFFER,f.$d);if(a.tk){var h=f.ab;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,h.Db,h.Wa,0)}l.viewport(0,0,f.width,f.height);c(a);a.P?l.enable(l.BLEND):l.disable(l.BLEND);a.mb?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST);if(a.Ma){for(var f=a.i,h=a.n,n=0;n<h.length;n++){var s=h[n],t=s.m,A=t.mc;l.useProgram(A.Fj);var s=s.Ya,y=A.Fd;A.Ih||d(A);for(var D=A.Ih,A=A.Vp,q=A.length;q--;){var K=A[q];D[K](l,y[K],a,s,t,f)}}a.Ma=!1}switch(a.type){case "SHADOW_CAST":l.enable(l.POLYGON_OFFSET_FILL);
l.polygonOffset(1,1);l.cullFace(l.BACK);break;case "MAIN_REFLECT":l.disable(l.POLYGON_OFFSET_FILL);l.cullFace(l.FRONT);break;case "SMAA_BLENDING_WEIGHT_CALCULATION":a.sp=I[g];l.disable(l.POLYGON_OFFSET_FILL);l.cullFace(l.BACK);break;default:l.disable(l.POLYGON_OFFSET_FILL),l.cullFace(l.BACK)}k.Yb&&(f=E[g],h=a.i,a.sl[0]=2*f[0]/h.width,a.sl[1]=2*f[1]/h.height);f=a.i;h=a.n;for(n=0;n<h.length;n++)if(y=h[n],y.T){t=a;K=f;s=y.Ya;q=y.m;y=q.mc;y.xm||d(y);l.useProgram(y.Fj);for(var D=q.Sb,A=y.Fd,B=y.xm,L=y.Sq,
r=L.length;r--;){var m=L[r];B[m](l,A[m],t,s,q,K)}K=q.$t;l.colorMask(K,K,K,K);l.depthMask(q.O);q.la?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE);K=q.Pa;q=q.$b;B=K.length|0;if(0!==B)if(1===B)l.activeTexture(l.TEXTURE0),l.bindTexture(K[0].Db,K[0].Wa);else for(L=0;L<B;L++)r=K[L],m=q[L],l.activeTexture(l.TEXTURE0+L),l.bindTexture(r.Db,r.Wa),l.uniform1i(A[m],L);if("SKY"==t.type){A=t;q=A.i;K=y.Fd;B=A.ev;for(L=0;6>L;L++)if(l.uniformMatrix4fv(K.u_cube_view_matrix,!1,B[L]),l.framebufferTexture2D(l.FRAMEBUFFER,
l.COLOR_ATTACHMENT0,e(L),q.ab.Wa,0),b(D,y,s.Yj),A.tj&&0!=L){var r=A,m=L,R=u;l.readPixels(191,191,1,1,l.RGBA,l.UNSIGNED_BYTE,R);255!=R[0]&&255!=R[1]&&255!=R[2]||l.readPixels(191,220,1,1,l.RGBA,l.UNSIGNED_BYTE,R);var U=R[0],X=R[1],R=R[2],U=U/255,X=X/255,R=R/255;1===m?(r.jd[3]=U,r.jd[7]=X,r.jd[11]=R):(r.jd[4*(m-2)]=U,r.jd[4*(m-2)+1]=X,r.jd[4*(m-2)+2]=R)}A.Li++}else b(D,y,s.Yj);t.Li++}p.Mt("draw subscene: "+a.type);l.bindFramebuffer(l.FRAMEBUFFER,null)}};a.clear=c;a.Xy=function(a,b,c){var d,e,g;d||(d=
1);e||(e=1);g||(g=new Uint8Array(4*d*e));if(g.length!=4*d*e)throw"Wrong storage";l.bindFramebuffer(l.FRAMEBUFFER,a);l.readPixels(b,c,d,e,l.RGBA,l.UNSIGNED_BYTE,g);l.bindFramebuffer(l.FRAMEBUFFER,null);return g};a.KA=function(a){var b=a.mc;l.useProgram(b.Fj);var c=b.Fd,e=b.Ih;e||d(b);e.u_cube_fog(l,c.u_cube_fog,null,null,a,null)};a.fq=function(a,b){var c=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,c);if(a){var d=a,e=d.Wa,d=d.Db==l.TEXTURE_CUBE_MAP?l.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.Db;l.framebufferTexture2D(l.FRAMEBUFFER,
l.COLOR_ATTACHMENT0,d,e,0)}n.np(b)?l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,b.ji):n.mh(b)&&(d=b,e=d.Wa,d=d.Db,l.framebufferTexture2D(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,d,e,0));p.Jt();l.bindFramebuffer(l.FRAMEBUFFER,null);return c};a.az=function(a,b,c,d,e){null==a?(l.bindFramebuffer(l.FRAMEBUFFER,a),l.viewport(0,0,d,e),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT)):(n.mh(b)&&l.deleteTexture(b.Wa),n.np(c)?l.deleteRenderbuffer(c.ji):n.mh(c)&&l.deleteTexture(c.Wa),l.deleteFramebuffer(a))};
a.Ux=function(){y=!0};a.JA=function(){y=!1};a.Ix=function(){return y};a.vx=function(){g=(g+1)%2};a.ga=function(){y=!1}};b4w.module.__shaders=function(a,q){function c(a,c,d){var e=a.Y;"string"==typeof d&&(a=b(a,d))&&(d=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==c){e[a][1]=d;return}e.push([c,d])}function b(a,b){for(var c=a.Y,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function e(a,b){var c=a+b;if(w[c])return w[c];if(y){var d=y[b];if(!d)return null}else{d=A.Ww(a+b);if(!d)return null;d=u.Up.parse(d)}return w[c]=d}function d(a,b,c,d){function l(b){b=b.a;for(var c=0;c<b.length;c++){var B=b[c];switch(B.type){case "condition":a:for(var B=
B.a,p=0;p<B.length;p++){var u=B[p];switch(u.type){case "if":case "elif":var A=u.c;try{var z,I=h(A,k,n,!0);z=t.Up.parse(I)}catch(y){throw"Failed to process #"+u.type+" expression: "+A.join(" ");}if(z){l(u.group);break a}break;case "else":l(u.group);break;case "ifdef":u.name in k&&l(u.group);break;case "ifndef":u.name in k||l(u.group)}}break;case "include":B=e(g,E+B.file);l(B);break;case "var":case "export":case "import":break;case "define":p=B.name;k[p]=B.b;B.wb&&(n[p]=B.wb);break;case "error":throw"Shader error: #error "+
B.b.join(" ");case "line":break;case "pragma":f.push("#pragma "+B.name+" "+B.b.join(" "));break;case "undef":B=B.name;delete k[B];delete n[B];break;case "warning":s.warn("Shader warning: #warning "+B.b.join(" "));break;case "extension":f.push("#extension "+h(B.b,k,n,!1));break;case "#":break;case "node":r[B.name]=B.group.a;break;case "nodes_global":B=d;for(p=0;p<B.length;p++)if(u=B[p],A=r[u.id])for(var w=0,D=0;D<A.length;D++){var G=A[D];"node_param"==G.type&&(G=G.qualifier.join(" ")+" ","vert"==a?
G+=u.ii[w]:"frag"==a&&(G+=u.wb[w],null!==u.Tp[w]&&(G+=" = "+u.Tp[w])),G+=";",f.push(G),w++)}break;case "nodes_main":B=d;for(p=0;p<B.length;p++)if(u=B[p],A=r[u.id]){var F=G=0,v=0;u.Qh={};for(w=0;w<A.length;w++)switch(D=A[w],D.type){case "node_in":var T=u.U[G];if(null!==u.hp[G]){var x=D.qualifier.join(" ")+" ",x=x+T,x=x+(" = "+u.hp[G]),x=x+";";f.push(x)}u.Qh[D.name]=T;G++;break;case "node_out":T=u.Ua[F];x=D.qualifier.join(" ")+" ";x+=T;x+=";";f.push(x);u.Qh[D.name]=T;F++;break;case "node_param":"vert"==
a?T=u.ii[v]:"frag"==a&&(T=u.wb[v]),u.Qh[D.name]=T,v++}}for(p=0;p<B.length;p++)if(u=B[p],A=r[u.id])for(w=0;w<A.length;w++)if(D=A[w],"textline"==D.type){G=[];for(F=0;F<D.b.length;F++)v=D.b[F],v in u.Qh?G.push(u.Qh[v]):G.push(v);f.push(h(G,k,n,!1))}break;case "textline":f.push(h(B.b,k,n,!1));break;default:throw"Unknown element type: "+B.type;}}}for(var f=[],k={},B=0;B<c.length;B++)k[c[B][0]]=[c[B][1]];if(d)for(B=0;B<d.length;B++)k["USE_NODE_"+d[B].id]=[1];var n={},r={};l(b);return f.join("\n")}function h(a,
b,c,d){var e=[];p(a,b,c,d,e);return e.join(" ")}function p(a,b,c,d,e){for(var g=0;g<a.length;g++){var l=a[g];l in b?(l=b[l],0==l.length&&d?e.push(0):p(l,b,c,d,e)):e.push(l)}}function n(a,b,c,d,e){if(G){e=d==x.VERTEX_SHADER?e.fa:e.ea;var g=D.cp(c),l=F[g];l?l.count++:(l={count:1,Vz:e,tx:g},F[g]=l)}d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);f.Ot(d,b,c);return d}function k(a){return a%1?String(a):String(a)+".0"}var l=q("__config"),s=q("__print"),f=q("__debug"),t=q("__gpp_eval"),A=q("__assets"),
D=q("__util");if(b4w.module_check(l.Kb.wq))var y=q(l.Kb.wq),u=null;else y=null,u=q("__gpp_parser");var g=l.Kb.Wz,E=l.Kb.Xz,I={},w={},G=!1,F=[],x=null;a.Bc=function(a){x=a};a.C=c;a.Ew=b;a.RC=function(a,b){for(var c=a.Y,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.zz=function(a){a.Y=[];for(var b="ALPHA ALPHA_CLIP ALPHA_MAP BEND_CENTER_ONLY CAUSTICS CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING HAIR_BILLBOARD_JITTERED HAIR_BILLBOARD_SPHERICAL MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE SHORE_SMOOTHING SKINNED SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS MAX_STEPS CSM_SECTION_DIST0 CSM_SECTION_DIST1 CSM_SECTION_DIST2 CSM_SECTION_DIST3 BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER HAIR_BILLBOARD HAIR_BILLBOARD_RANDOM PRECISION EPSILON WIREFRAME_QUALITY".split(" "),
d=0;d<b.length;d++){var e=b[d],g;switch(e){case "ALPHA":case "ALPHA_CLIP":case "ALPHA_MAP":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "HAIR_BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "SHORE_SMOOTHING":case "SKINNED":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "HAIR_BILLBOARD":case "HAIR_BILLBOARD_RANDOM":case "WIREFRAME_QUALITY":g=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "DEPTH_RGBA":case "HAIR_BILLBOARD_SPHERICAL":case "NUM_LIGHTS":case "MAX_STEPS":g=1;break;case "CSM_SECTION_DIST0":g=2.0001;break;case "CSM_SECTION_DIST1":g=4.0001;break;case "CSM_SECTION_DIST2":g=7.0001;break;case "CSM_SECTION_DIST3":g=9.0001;break;case "AA_METHOD":g="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":g="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":g="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":g="POST_EFFECT_NONE";break;
case "SHADOW_SRC":g="SHADOW_SRC_NONE";break;case "SHADOW_DST":g="SHADOW_DST_NONE";break;case "SSAO_QUALITY":g="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":g="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":g="TEXTURE_COORDS_UV";break;case "PRECISION":g=l.s.precision;break;case "EPSILON":g="highp"==l.s.precision?1E-6:1E-4;break;default:s.error("Unknown directive ("+a.fa+", "+a.ea+"): "+e)}c(a,e,g)}};a.HC=function(a){return a.fa};a.Jo=function(a){return a.ea};a.xx=function(a,d){for(var e=d.Y,
g=0;g<e.length;g++){var l=e[g][0],f=e[g][1];b(a,l)&&c(a,l,f)}};a.el=function(a,b){var c=JSON.stringify(a)+JSON.stringify(b),l=I[c];if(l)return l;var k=a.ea,l=e(g,a.fa),k=e(g,k);if(!l||!k)return null;var h=a.Y||[],E=d("vert",l,h,b),h=d("frag",k,h,b),l=x,B=n(l,c,E,l.VERTEX_SHADER,a),p=n(l,c,h,l.FRAGMENT_SHADER,a),k=l.createProgram();l.attachShader(k,B);l.attachShader(k,p);l.linkProgram(k);l.validateProgram(k);l.getProgramParameter(k,l.VALIDATE_STATUS)==l.BB&&s.error("B4W Error - shader program is not valid",
c);f.Pt(k,c,B,p,E,h);E={ar:B,Ao:p,Fj:k,attributes:{},Fd:{},zn:[],Vp:[],Sq:[],Ih:null,xm:null,za:a};B=l.getProgramParameter(k,l.ACTIVE_ATTRIBUTES);for(h=0;h<B;h++)p=l.getActiveAttrib(k,h).name,E.attributes[p]=l.getAttribLocation(k,p),E.zn.push(p);B=l.getProgramParameter(k,l.ACTIVE_UNIFORMS);for(h=0;h<B;h++)p=l.getActiveUniform(k,h).name.split("[0]").join(""),E.Fd[p]=l.getUniformLocation(k,p);return I[c]=l=E};a.hv=function(){return F};a.zw=function(){return I};a.ga=function(){for(var a in I){var b=
I[a];x.deleteProgram(b.Fj);x.deleteShader(b.ar);x.deleteShader(b.Ao);delete I[a]}for(var c in w)delete w[c];for(var d in F)delete F[d]};a.fC=function(a){var b=a.Y;s.log("Shader: "+a.fa+" "+a.ea+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)s.log("  "+b[a][0],b[a][1])};a.u=function(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return k(a);case 2:return"vec2("+k(a[0])+","+k(a[1])+")";case 3:return"vec3("+k(a[0])+","+k(a[1])+","+k(a[2])+")";case 4:return"vec4("+k(a[0])+","+k(a[1])+
","+k(a[2])+","+k(a[3])+")";case 9:return"mat3("+k(a[0])+","+k(a[1])+","+k(a[2])+","+k(a[3])+","+k(a[4])+","+k(a[5])+","+k(a[6])+","+k(a[7])+","+k(a[8])+")";case 16:return"mat4("+k(a[0])+","+k(a[1])+","+k(a[2])+","+k(a[3])+","+k(a[4])+","+k(a[5])+","+k(a[6])+","+k(a[7])+","+k(a[8])+","+k(a[9])+","+k(a[10])+","+k(a[11])+","+k(a[12])+","+k(a[13])+","+k(a[14])+","+k(a[15])+")";default:throw"Wrong glsl value dimension";}};a.Pn=function(a,b){return b in a.Fd?!0:!1}};b4w.module.shader_texts=function(a){a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_glow_intensity",";"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",
b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_glow_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},
{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",
a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 cf = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"cf = mix ( cf , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 cg = vec3 ( 0.0 ) ; vec3 ch = vec3 ( 0.0 ) ; vec3 ci = vec3 ( 0.0 ) ; bn ( cf , cg , ch , ci ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","cj","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cj = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ck = ( u_model_matrix * vec4 ( cj , 1.0 ) ) . xyz ; mat4 cl = ab ( u_camera_eye , ck , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 cm = ( u_model_matrix * vec4 ( cj , 1.0 ) ) . xyz ; cl = cl * R ( u_wind , u_time , u_jitter_amp , u_jitter_freq , cm ) ;".split(" ")}]}}]},{type:"textline",b:"b cn = ai ( cf - cj , cj , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , cl ) ; cn . b = ck ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"b cn = ai ( cf , cj , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","co","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 co = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ce ( cn . a , cn . b , co ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = al ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( cn . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:["uniform","float",
"u_shadow_visibility_falloff",";"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_DST == SHADOW_DST_NONE || SHADOW_DST == SHADOW_DST_RGBA || SHADOW_DST == SHADOW_DST_VSM".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","float","co",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cp",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cq",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cr",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cs",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ct",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cu",";"]}]}}]},{type:"include",file:"shadow.glslf"},{type:"textline",b:["void","main",
"(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float dd = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float dd = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( dd < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cj ( co ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_RGBA"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cj ( co ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_VSM"],
group:{type:"group",a:[{type:"textline",b:"float de = co ; float df = de * de ; gl_FragColor = vec4 ( de , df , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( cX ( cu . z , u_shadow_visibility_falloff ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],
group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_DST == SHADOW_DST_NONE || SHADOW_DST == SHADOW_DST_RGBA || SHADOW_DST == SHADOW_DST_VSM".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_DST == SHADOW_DST_NONE || SHADOW_DST == SHADOW_DST_RGBA || SHADOW_DST == SHADOW_DST_VSM".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","co",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cp",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cq",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cs",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ct",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cu",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 d_ = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"d_ = mix ( d_ , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",
a:[{type:"textline",b:"vec3 ea = vec3 ( 0.0 ) ; vec3 eb = vec3 ( 0.0 ) ; vec3 ec = vec3 ( 0.0 ) ; bn ( d_ , ea , eb , ec ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","ed","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ed = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",
b:"b ee = dT ( d_ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ed , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ef = ( u_model_matrix * vec4 ( ed , 1.0 ) ) . xyz ; mat4 eg = ab ( u_camera_eye , ef , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND",
"&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 eh = ( u_model_matrix * vec4 ( ed , 1.0 ) ) . xyz ; eg = eg * R ( u_wind , u_time , u_jitter_amp , u_jitter_freq , eh ) ;".split(" ")}]}}]},{type:"textline",b:"b ee = ai ( d_ - ed , ed , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , eg ) ; ee . b = ef ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"b ee = ai ( d_ , ed , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","ei","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ei = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ce ( ee . a , ee . b , ei ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 ej = u_view_matrix * vec4 ( ee . a , 1.0 ) ; vec4 ek = u_proj_matrix * ej ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"ek . xy += u_subpixel_jitter * ek . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = al ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"dV ( ee . a ) ; cu = ej ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_DST == SHADOW_DST_NONE || SHADOW_DST == SHADOW_DST_RGBA || SHADOW_DST == SHADOW_DST_VSM".split(" "),
group:{type:"group",a:[{type:"textline",b:"co = - ej . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","ek",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","d_",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["varying","float","d_",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","d_",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","d_",";"]}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"gl_FragColor = vec4 ( d_ , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , d_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",
file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","d_",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","d_",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","d_",";"]}]}}]}]}}]},{type:"textline",b:["void",
"main","(",")","{"]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ea = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 eb = ab ( u_camera_eye , ea , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"eb = eb * R ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"b ec = ai ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , eb ) ; ec . b = ea ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"b ec = ai ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 ed = u_proj_matrix * u_view_matrix * vec4 ( ec . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"d_ = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["d_","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["d_","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","ed",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",
b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS",
"&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 eh ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float ei ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int ej = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int ej = NUM_LINES ;".split(" ")}]}}]},
{type:"textline",b:"float el ( float ek ) { return ek - floor ( ek * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void eu ( inout float em , in float en [ ej ] , in float eo ) { for ( int ep = NUM_RINGS ; ep > 0 ; ep -- ) { float eq = 40.0 * en [ ep ] ; float er = 300.0 * ( el ( eq ) - 0.005 ) ; float es = eq ; float et = abs ( es * ( u_halo_size * er - eo ) ) ; em += 1.0 - min ( et , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void eD ( inout float ev , in float ew [ ej ] , in float ex ) { for ( int ey = NUM_LINES ; ey > 0 ; ey -- ) { float ez = ew [ ey ] ; float eA = ez ; float eB = 1000.0 * ( el ( ez ) - 0.005 ) ; float eC = 20.0 * abs ( eA * a . x + eB * a . y ) ; ev += 1.0 - min ( eC , 1.0 ) ; } ev *= ex ; }".split(" ")}]}}]},{type:"textline",b:"void eK ( inout float eE , in vec2 eF ) { float eG , eH ; eH = atan ( eF . y , eF . x ) ; eH *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float eI = cos ( eH ) ; float eJ = sin ( eH ) ; eH = ( eI * eF . x + eJ * eF . y ) * ( eI * eF . y - eJ * eF . x ) ; eG = abs ( eH ) ; if ( eG < 1.0 ) { eG = ( 0.01 * u_halo_size ) / ( eG ) ; eE *= sqrt ( min ( eG , 1.0 ) ) ; } } void main ( ) { float eL = ( a . x * a . x + a . y * a . y ) ; float eM = sqrt ( eL ) ; eL = max ( 1.0 - eL , 0.0 ) ; eL = pow ( eL , u_halo_hardness ) ; float eN = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float eO [ ej ] ; for ( int eP = 0 ; eP < ej ; eP ++ ) { eO [ eP ] = fract ( ei / float ( eP ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"float eQ = 0.0 ; eu ( eQ , eO , eM ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float eR = 0.0 ; eD ( eR , eO , eL ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"eK ( eL , a ) ;".split(" ")}]}}]},{type:"textline",b:"eL *= eN ; vec3 eS = u_diffuse_color . rgb * eL ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"eQ *= eL ; eS += u_halo_rings_color * eQ ; eL += eQ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"eR *= eN ; eS += u_halo_lines_color * eR ; eL += eR ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"eL *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float eT = u_halo_stars_blend * ( eh . y - u_halo_stars_height ) ; eL *= clamp ( eT , 0.0 , 1.0 ) ; eL *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"ed ( eS ) ; eg ( eS , eL ) ; gl_FragColor = vec4 ( eS , eL ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float ei ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec4","eh",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 ej = a_position ; a = a_halo_bb_vertex * 2.0 ; ei = fract ( ej . x + ej . y + ej . z ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"mat4 ek = A ( ej , u_view_matrix ) ; mat4 el = u_view_matrix ; el [ 3 ] [ 0 ] = 0.0 ; el [ 3 ] [ 1 ] = 0.0 ; el [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 ek = A ( ej , u_view_matrix ) ;".split(" ")}]}}]},
{type:"textline",b:"vec4 em = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 en = ek * em ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"vec4 eo = u_proj_matrix * el * en ; eo . z = 0.99999 * eo . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["eh","=","en",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 eo = u_proj_matrix * u_view_matrix * en ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","eo",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 ej = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( ej , 1.0 ) ; }".split(" ")}]};
a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"caustics.glslf"}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"TEXCOORD",b:"( TEXTURE_COLOR && TEXTURE_COORDS == TEXTURE_COORDS_UV || TEXTURE_STENCIL_ALPHA_MASK || TEXTURE_SPEC || TEXTURE_NORM )".split(" ")},{type:"textline",b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ; uniform float u_shadow_visibility_falloff ; uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",
c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform float u_normal_factor ; uniform vec2 u_normalmap0_uv_velocity ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform vec2 u_colormap0_uv_velocity ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec2 u_specular_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM","&&","PARALLAX"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"textline",b:"varying vec3 hZ ; varying vec3 h_ ; varying vec3 ia ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cu",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ib",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ic",";"]}]}}]},{type:"condition",a:[{type:"if",
c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cp",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cq",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec4","cs",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ct",";"]}]}}]},{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float iz = h_ . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],
group:{type:"group",a:[{type:"textline",b:["vec2","iA","=","a",";"]}]}}]},{type:"textline",b:["vec3","iB","=","ia",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) iB = iB ; else iB = - iB ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"vec3 iC = cross ( iB , ib . xyz ) * ib . w ; mat3 iD = mat3 ( ib . xyz , iC , iB ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float iE = length ( cu ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( iE < 10.0 ) { float iF = clamp ( 5.0 - 0.5 * iE , 0.0 , 1.0 ) ; float iG = u_parallax_scale * iF ; vec3 iH = normalize ( hZ * iD ) ; float iI = 1.0 / PARALLAX_STEPS ; vec2 iJ = iH . xy * iG / ( PARALLAX_STEPS * iH . z ) ; float iK = 1.0 ; float iL = texture2D ( u_normalmap0 , iA ) . a ; for ( float iM = 1.0 ; iM <= PARALLAX_STEPS ; iM ++ ) { if ( iL < iK ) { iK -= iI ; iA -= iJ ; iL = texture2D ( u_normalmap0 , iA ) . a ; } } vec2 iN = iA + iJ ; float iO = texture2D ( u_normalmap0 , iN ) . a - ( iK + iI ) ; float iP = iL - iK ; float iQ = iP / ( iP - iO ) ; iA = iQ * iN + ( 1.0 - iQ ) * iA ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"vec4 iR = texture2D ( u_normalmap0 , iA + u_time * u_normalmap0_uv_velocity ) ; vec3 iS = iR . rgb - 0.5 ; iS = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , iS , u_normal_factor ) ; vec3 iT = iD * iS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","iT","=","iB",";"]}]}}]},{type:"textline",b:"iT = normalize ( iT ) ; vec3 iU = normalize ( hZ ) ; float iV = 0.5 * iT . y + 0.5 ; vec3 iW = u_environment_energy * mix ( u_horizon_color , u_zenith_color , iV ) ; vec3 iX = u_ambient * iW ;".split(" ")},
{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec3 iY = ic ; eb ( iY ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec4 iZ = vec4 ( iY , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","iZ","=","u_diffuse_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec2 i_ = normalize ( u_view_matrix_frag * vec4 ( iT , 0.0 ) ) . st ; i_ = i_ * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:"vec4 ja = texture2D ( u_colormap0 , iA ) ; eb ( ja . rgb ) ; vec4 jb ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_NORMAL"],
group:{type:"group",a:[{type:"textline",b:"jb = texture2D ( u_colormap1 , i_ ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_UV"],group:{type:"group",a:[{type:"textline",b:"jb = texture2D ( u_colormap1 , iA ) ;".split(" ")}]}}]},{type:"textline",b:"eb ( jb . rgb ) ; vec4 jc = texture2D ( u_stencil0 , iA ) ; vec4 jd = mix ( ja , jb , jc . r ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_NORMAL"],
group:{type:"group",a:[{type:"textline",b:"vec4 jd = texture2D ( u_colormap0 , i_ ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_UV"],group:{type:"group",a:[{type:"textline",b:"vec4 jd = texture2D ( u_colormap0 , iA + u_time * u_colormap0_uv_velocity ) ;".split(" ")}]}}]},{type:"textline",b:"eb ( jd . rgb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"iZ . rgb = mix ( iZ . rgb , jd . rgb , u_diffuse_color_factor ) ; iZ . a = jd . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"iZ . rgb *= mix ( vec3 ( 1.0 ) , jd . rgb , u_diffuse_color_factor ) ; iZ . a = jd . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 je = u_diffuse_intensity * iZ . rgb ; float jf = dc ( u_shadow_visibility_falloff , je ) ; vec3 jg = u_emit * iZ . rgb ; vec3 jh = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"vec3 ji = vec3 ( iZ . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ji = texture2D ( u_specmap , iA ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"eb ( ji . rgb ) ; jh = mix ( jh , ji , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"float jj = u_specular_params [ 0 ] ; float jk = u_specular_params [ 1 ] ; vec3 jl = jj * jh ; eW jm = gz ( jg , iX , je , jl , h_ , iT , iU , jk , u_diffuse_params , jf , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ; vec3 jn = jm . a . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"iy ( jn , iU , iT , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , iS . st ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"iy ( jn , iU , iT , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , vec2 ( 0.0 ) ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"jn += jm . b ;".split(" ")},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"jn = max ( jn - sqrt ( 0.01 * - min ( iz , 0.0 ) ) , 0.5 * jn ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"hY ( jn , iz , u_time , jf , iT , u_sun_direction , u_sun_intensity , u_sun_quaternion , h_ , iE ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"float jo = iZ . a ; if ( jo < 0.5 ) discard ; jo = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float jo = iZ . a + jm . a . a * jl . r ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","jo","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],
group:{type:"group",a:[{type:"textline",b:"vec3 jp = ev ( u_cube_fog , iU ) ; vec4 jq = vec4 ( jp , u_fog_color_density . a ) ; eb ( jq . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 jq = u_fog_color_density ; jq . rgb *= u_sun_intensity ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"eM ( jn , iE , iU . y , u_cam_water_depth , u_underwater_fog_color_density , jq , iz , length ( u_sun_intensity ) + u_environment_energy ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"eo ( jn , iE , jq ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"jn = vec3 ( cv . a ) ;".split(" ")}]}}]},{type:"textline",b:["ed","(","jn",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"eg ( jn , jo ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( jn , jo ) ; }".split(" ")}]};
a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"define",name:"TEXCOORD",b:"( TEXTURE_COLOR && TEXTURE_COORDS == TEXTURE_COORDS_UV || TEXTURE_STENCIL_ALPHA_MASK || TEXTURE_SPEC || TEXTURE_NORM )".split(" ")},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",
a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",
b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",
a:[{type:"textline",b:"uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",
b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"textline",b:"varying vec3 hZ ; varying vec3 h_ ; varying vec3 ia ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cu",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ib",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ic",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cp",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","cq",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cs",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ct",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},
{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 iz = a_position ; vec3 iA = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"vec3 iB = vec3 ( a_tangent ) ; vec3 iC = a_tangent [ 3 ] * cross ( iA , iB ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 iB = vec3 ( 0.0 ) ; vec3 iC = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"iz = mix ( iz , a_position_next , u_va_frame_factor ) ; iA = mix ( iA , a_normal_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"vec3 iD = vec3 ( a_tangent ) ; vec3 iE = a_tangent_next [ 3 ] * cross ( a_normal_next , iD ) ; iB = mix ( iB , iD , u_va_frame_factor ) ; iC = mix ( iC , iE , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bn ( iz , iB , iC , iA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","iF","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 iF = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"b iG = dT ( iz , iB , iC , iA , iF , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 iH = ( u_model_matrix * vec4 ( iF , 1.0 ) ) . xyz ; mat4 iI = ab ( u_camera_eye , iH , u_view_matrix ) ;".split(" ")},{type:"condition",
a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 iJ = ( u_model_matrix * vec4 ( iF , 1.0 ) ) . xyz ; iI = iI * R ( u_wind , u_time , u_jitter_amp , u_jitter_freq , iJ ) ;".split(" ")}]}}]},{type:"textline",b:"b iG = ai ( iz - iF , iF , iB , iC , iA , iI ) ; iG . b = iH ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"b iG = ai ( iz , iF , iB , iC , iA , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"float iK = ( dot ( cross ( iG . e , iG . c ) , iG . d ) < 0.0 ) ? - 1.0 : 1.0 ; ib = vec4 ( iG . c , iK ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"b iG = dT ( iz , vec3 ( 0.0 ) , vec3 ( 0.0 ) , iA , iF , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 iH = ( u_model_matrix * vec4 ( iF , 1.0 ) ) . xyz ; mat4 iI = ab ( u_camera_eye , iH , u_view_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 iJ = ( u_model_matrix * vec4 ( iF , 1.0 ) ) . xyz ; iI = iI * R ( u_wind , u_time , u_jitter_amp , u_jitter_freq , iJ ) ;".split(" ")}]}}]},{type:"textline",b:"b iG = ai ( iz - iF , iF , vec3 ( 0.0 ) , vec3 ( 0.0 ) , iA , iI ) ; iG . b = iH ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"b iG = ai ( iz , iF , vec3 ( 0.0 ) , vec3 ( 0.0 ) , iA , u_model_matrix ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ce ( iG . a , iG . b , iA ) ;".split(" ")}]}}]},{type:"textline",b:"h_ = iG . a ; ia = iG . e ; hZ = u_camera_eye - iG . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"a = al ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"ic = iG . f ;".split(" ")}]}},
{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["ic","=","a_color",";"]}]}}]},{type:"textline",b:"vec4 iL = u_view_matrix * vec4 ( iG . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["cu","=","iL",";"]}]}}]},{type:"textline",b:"vec4 iM = u_proj_matrix * iL ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",
a:[{type:"textline",b:"iM . xy += u_subpixel_jitter * iM . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["dV","(","iM",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"dV ( iG . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"float iN = iM . x ; float iO = iM . y ; float iP = iM . w ; ct . x = ( iN + iP ) / 2.0 ; ct . y = ( iO + iP ) / 2.0 ; ct . z = iP ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","iM",";","}"]}]};a["nodes.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"caustics.glslf"}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ; uniform float u_shadow_visibility_falloff ; uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADED"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",
a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADED","&&","WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG",
"&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float",
"u_mirror_factor",";"]}]}}]},{type:"textline",b:"varying vec3 h_ ; varying vec4 cu ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADED","||","USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ia",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ib",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cp",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cq",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cs",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ct",";"]}]}}]},{type:"textline",b:"float iz = 0.0 ; float iA = 1.0 ;".split(" ")},{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 iJ ( vec3 iB ) { float iC , iD , iE , iF , iG , iH ; vec3 iI ; iC = max ( iB [ 0 ] , max ( iB [ 1 ] , iB [ 2 ] ) ) ; iD = min ( iB [ 0 ] , min ( iB [ 1 ] , iB [ 2 ] ) ) ; iH = iC - iD ; iG = iC ; if ( iC != iz ) iF = iH / iC ; else { iF = iz ; iE = iz ; } if ( e ( iF , iz ) ) { iE = iz ; } else { iI = ( vec3 ( iC , iC , iC ) - iB . xyz ) / iH ; if ( e ( iB . x , iC ) ) iE = iI [ 2 ] - iI [ 1 ] ; else if ( e ( iB . y , iC ) ) iE = 2.0 + iI [ 0 ] - iI [ 2 ] ; else iE = 4.0 + iI [ 1 ] - iI [ 0 ] ; iE /= 6.0 ; if ( iE < iz ) iE += iA ; } return vec3 ( iE , iF , iG ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 iU ( vec3 iK ) { float iL , iM , iN , iO , iP , iQ , iR , iS ; vec3 iT ; iQ = iK [ 0 ] ; iR = iK [ 1 ] ; iS = iK [ 2 ] ; if ( e ( iR , iz ) ) { iT = vec3 ( iS , iS , iS ) ; } else { if ( e ( iQ , iz ) ) iQ = iz ; iQ *= 6.0 ; iL = floor ( iQ ) ; iM = iQ - iL ; iT = vec3 ( iM , iM , iM ) ; iN = iS * ( iA - iR ) ; iO = iS * ( iA - ( iR * iM ) ) ; iP = iS * ( iA - ( iR * ( iA - iM ) ) ) ; if ( e ( iL , iz ) ) iT = vec3 ( iS , iP , iN ) ; else if ( e ( iL , iA ) ) iT = vec3 ( iO , iS , iN ) ; else if ( e ( iL , 2.0 ) ) iT = vec3 ( iN , iS , iP ) ; else if ( e ( iL , 3.0 ) ) iT = vec3 ( iN , iO , iS ) ; else if ( e ( iL , 4.0 ) ) iT = vec3 ( iP , iN , iS ) ; else iT = vec3 ( iS , iN , iO ) ; } return iT ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 iW ( vec2 iV ) { return vec3 ( iV * 2.0 - vec2 ( iA , iA ) , iz ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_TEXTURE_COLOR || USE_NODE_TEXTURE_NORMAL || USE_NODE_TEXTURE_COLOR2 || USE_NODE_TEXTURE_NORMAL2 || USE_NODE_TEXTURE_COLOR3 || USE_NODE_TEXTURE_NORMAL3 || USE_NODE_PARALLAX".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 iY ( vec3 iX ) { return vec2 ( iX . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",group:{type:"group",a:[{type:"node_out",name:"jN",qualifier:["vec3"]},{type:"node_out",name:"jO",qualifier:["float"]},{type:"node_out",name:"jP",qualifier:["float"]},{type:"textline",b:"jN = normalize ( jC . xyz ) ; jO = abs ( jC . z ) ; jP = length ( jC . xyz ) ;".split(" ")}]}},{type:"node",name:"COMBRGB",group:{type:"group",a:[{type:"node_in",name:"jQ",qualifier:["float"]},{type:"node_in",name:"jR",qualifier:["float"]},{type:"node_in",name:"jS",qualifier:["float"]},{type:"node_out",
name:"jT",qualifier:["vec3"]},{type:"textline",b:"jT = vec3 ( jQ , jR , jS ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"iZ",qualifier:["varying","vec2"]},{type:"node_out",name:"jU",qualifier:["vec3"]},{type:"textline",b:"jU = iW ( iZ ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VC",group:{type:"group",a:[{type:"node_param",name:"i_",qualifier:["varying","vec3"]},{type:"node_out",name:"jV",qualifier:["vec3"]},{type:"textline",b:["jV","=","i_",
";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"ja",qualifier:["varying","float"]},{type:"node_out",name:"jW",qualifier:["float"]},{type:"textline",b:["jW","=","ja",";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"jb",qualifier:["varying","vec2"]},{type:"node_out",name:"jX",qualifier:["float"]},{type:"node_out",name:"jY",qualifier:["float"]},{type:"textline",b:"jX = jb [ 0 ] ; jY = jb [ 1 ] ;".split(" ")}]}},{type:"node",
name:"GEOMETRY_VC3",group:{type:"group",a:[{type:"node_param",name:"jc",qualifier:["varying","vec3"]},{type:"node_out",name:"jZ",qualifier:["float"]},{type:"node_out",name:"j_",qualifier:["float"]},{type:"node_out",name:"ka",qualifier:["float"]},{type:"textline",b:"jZ = jc [ 0 ] ; j_ = jc [ 1 ] ; ka = jc [ 2 ] ;".split(" ")}]}},{type:"node",name:"GEOMETRY_NO",group:{type:"group",a:[{type:"node_out",name:"kb",qualifier:["vec3"]},{type:"textline",b:["kb","=","jw",";"]}]}},{type:"node",name:"GEOMETRY_FB",
group:{type:"group",a:[{type:"node_out",name:"kc",qualifier:["float"]},{type:"textline",b:"kc = ( gl_FrontFacing ) ? iA : iz ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VW",group:{type:"group",a:[{type:"node_out",name:"kd",qualifier:["vec3"]},{type:"textline",b:["kd","=","jA",";"]}]}},{type:"node",name:"GEOMETRY_GL",group:{type:"group",a:[{type:"node_out",name:"ke",qualifier:["vec3"]},{type:"textline",b:"ke = vec3 ( jB . r , - jB . b , jB . g ) ;".split(" ")}]}},{type:"node",name:"HUE_SAT",group:{type:"group",
a:[{type:"node_in",name:"kf",qualifier:["float"]},{type:"node_in",name:"kg",qualifier:["float"]},{type:"node_in",name:"kh",qualifier:["float"]},{type:"node_in",name:"ki",qualifier:["float"]},{type:"node_in",name:"kj",qualifier:["vec3"]},{type:"node_out",name:"kk",qualifier:["vec3"]},{type:"textline",b:"{ vec3 kl = iJ ( kj ) ; kl [ 0 ] += ( kf - 0.5 ) ; if ( kl [ 0 ] > iA ) kl [ 0 ] -= iA ; else if ( kl [ 0 ] < iz ) kl [ 0 ] += iA ; kl [ 1 ] *= kg ; if ( kl [ 1 ] > iA ) kl [ 1 ] = iA ; else if ( kl [ 1 ] < iz ) kl [ 1 ] = iz ; kl [ 2 ] *= kh ; if ( kl [ 2 ] > iA ) kl [ 2 ] = iA ; else if ( kl [ 2 ] < iz ) kl [ 2 ] = iz ; kk = mix ( kj , iU ( kl ) , ki ) ; }".split(" ")}]}},
{type:"node",name:"INVERT",group:{type:"group",a:[{type:"node_in",name:"km",qualifier:["float"]},{type:"node_in",name:"kn",qualifier:["vec3"]},{type:"node_out",name:"ko",qualifier:["vec3"]},{type:"textline",b:"ko = mix ( kn , vec3 ( iA ) - kn , km ) ;".split(" ")}]}},{type:"node",name:"NORMAL",group:{type:"group",a:[{type:"node_param",name:"jd",qualifier:["vec3"]},{type:"node_in",name:"kp",qualifier:["vec3"]},{type:"node_out",name:"kq",qualifier:["vec3"]},{type:"node_out",name:"kr",qualifier:["float"]},
{type:"textline",b:"kq = jd ; kr = - dot ( kp , jd ) ;".split(" ")}]}},{type:"node",name:"NORMAL_VIEW",group:{type:"group",a:[{type:"node_in",name:"ks",qualifier:["vec3"]},{type:"node_out",name:"kt",qualifier:["vec3"]},{type:"textline",b:"kt = - ( u_view_matrix_frag * vec4 ( ks , iz ) ) . xyz ;".split(" ")}]}},{type:"node",name:"MAPPING_LIGHT",group:{type:"group",a:[{type:"node_param",name:"je",qualifier:["vec3"]},{type:"node_in",name:"ku",qualifier:["vec3"]},{type:"node_out",name:"kv",qualifier:["vec3"]},
{type:"textline",b:"kv = ku * je ;".split(" ")}]}},{type:"node",name:"MAPPING_HEAVY",group:{type:"group",a:[{type:"node_param",name:"jf",qualifier:["mat4"]},{type:"node_param",name:"jg",qualifier:["const","float"]},{type:"node_param",name:"jh",qualifier:["const","float"]},{type:"node_param",name:"ji",qualifier:["vec3"]},{type:"node_param",name:"jj",qualifier:["vec3"]},{type:"node_in",name:"kw",qualifier:["vec3"]},{type:"node_out",name:"kx",qualifier:["vec3"]},{type:"textline",b:"kx = ( jf * vec4 ( kw , iA ) ) . xyz ; if ( jg == iA ) kx = max ( kx , ji ) ; if ( jh == iA ) kx = min ( kx , jj ) ;".split(" ")}]}},
{type:"node",name:"MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"ky",qualifier:["float"]},{type:"node_in",name:"kz",qualifier:["float"]},{type:"node_out",name:"kA",qualifier:["float"]},{type:"textline",b:"kA = ky + kz ;".split(" ")}]}},{type:"node",name:"MATH_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"kB",qualifier:["float"]},{type:"node_in",name:"kC",qualifier:["float"]},{type:"node_out",name:"kD",qualifier:["float"]},{type:"textline",b:"kD = kB - kC ;".split(" ")}]}},{type:"node",
name:"MATH_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"kE",qualifier:["float"]},{type:"node_in",name:"kF",qualifier:["float"]},{type:"node_out",name:"kG",qualifier:["float"]},{type:"textline",b:"kG = kE * kF ;".split(" ")}]}},{type:"node",name:"MATH_DIVIDE",group:{type:"group",a:[{type:"node_in",name:"kH",qualifier:["float"]},{type:"node_in",name:"kI",qualifier:["float"]},{type:"node_out",name:"kJ",qualifier:["float"]},{type:"textline",b:"kJ = ( kI != iz ) ? kH / kI : iz ;".split(" ")}]}},
{type:"node",name:"MATH_SINE",group:{type:"group",a:[{type:"node_in",name:"kK",qualifier:["float"]},{type:"node_in",name:"kL",qualifier:["float"]},{type:"node_out",name:"kM",qualifier:["float"]},{type:"textline",b:"kM = sin ( kK ) ; kL ;".split(" ")}]}},{type:"node",name:"MATH_COSINE",group:{type:"group",a:[{type:"node_in",name:"kN",qualifier:["float"]},{type:"node_in",name:"kO",qualifier:["float"]},{type:"node_out",name:"kP",qualifier:["float"]},{type:"textline",b:"kP = cos ( kN ) ; kO ;".split(" ")}]}},
{type:"node",name:"MATH_TANGENT",group:{type:"group",a:[{type:"node_in",name:"kQ",qualifier:["float"]},{type:"node_in",name:"kR",qualifier:["float"]},{type:"node_out",name:"kS",qualifier:["float"]},{type:"textline",b:"kS = tan ( kQ ) ; kR ;".split(" ")}]}},{type:"node",name:"MATH_ARCSINE",group:{type:"group",a:[{type:"node_in",name:"kT",qualifier:["float"]},{type:"node_in",name:"kU",qualifier:["float"]},{type:"node_out",name:"kV",qualifier:["float"]},{type:"textline",b:"kV = ( kT <= iA && kT >= - iA ) ? asin ( kT ) : iz ; kU ;".split(" ")}]}},
{type:"node",name:"MATH_ARCCOSINE",group:{type:"group",a:[{type:"node_in",name:"kW",qualifier:["float"]},{type:"node_in",name:"kX",qualifier:["float"]},{type:"node_out",name:"kY",qualifier:["float"]},{type:"textline",b:"kY = ( kW <= iA && kW >= - iA ) ? acos ( kW ) : iz ; kX ;".split(" ")}]}},{type:"node",name:"MATH_ARCTANGENT",group:{type:"group",a:[{type:"node_in",name:"kZ",qualifier:["float"]},{type:"node_in",name:"k_",qualifier:["float"]},{type:"node_out",name:"la",qualifier:["float"]},{type:"textline",
b:"la = atan ( kZ ) ; k_ ;".split(" ")}]}},{type:"node",name:"MATH_POWER",group:{type:"group",a:[{type:"node_in",name:"lb",qualifier:["float"]},{type:"node_in",name:"lc",qualifier:["float"]},{type:"node_out",name:"ld",qualifier:["float"]},{type:"textline",b:"ld = pow ( lb , lc ) ;".split(" ")}]}},{type:"node",name:"MATH_LOGARITHM",group:{type:"group",a:[{type:"node_in",name:"le",qualifier:["float"]},{type:"node_in",name:"lf",qualifier:["float"]},{type:"node_out",name:"lg",qualifier:["float"]},{type:"textline",
b:"lg = ( le > iz && lf > iz ) ? log2 ( le ) / log2 ( lf ) : iz ;".split(" ")}]}},{type:"node",name:"MATH_MINIMUM",group:{type:"group",a:[{type:"node_in",name:"lh",qualifier:["float"]},{type:"node_in",name:"li",qualifier:["float"]},{type:"node_out",name:"lj",qualifier:["float"]},{type:"textline",b:"lj = min ( lh , li ) ;".split(" ")}]}},{type:"node",name:"MATH_MAXIMUM",group:{type:"group",a:[{type:"node_in",name:"lk",qualifier:["float"]},{type:"node_in",name:"ll",qualifier:["float"]},{type:"node_out",
name:"lm",qualifier:["float"]},{type:"textline",b:"lm = max ( lk , ll ) ;".split(" ")}]}},{type:"node",name:"MATH_ROUND",group:{type:"group",a:[{type:"node_in",name:"ln",qualifier:["float"]},{type:"node_in",name:"lo",qualifier:["float"]},{type:"node_out",name:"lp",qualifier:["float"]},{type:"textline",b:"lp = floor ( ln + 0.5 ) ; lo ;".split(" ")}]}},{type:"node",name:"MATH_LESS_THAN",group:{type:"group",a:[{type:"node_in",name:"lq",qualifier:["float"]},{type:"node_in",name:"lr",qualifier:["float"]},
{type:"node_out",name:"ls",qualifier:["float"]},{type:"textline",b:"ls = ( lq < lr ) ? iA : iz ;".split(" ")}]}},{type:"node",name:"MATH_GREATER_THAN",group:{type:"group",a:[{type:"node_in",name:"lt",qualifier:["float"]},{type:"node_in",name:"lu",qualifier:["float"]},{type:"node_out",name:"lv",qualifier:["float"]},{type:"textline",b:"lv = lt + lu ; lv = ( lt > lu ) ? iA : iz ;".split(" ")}]}},{type:"node",name:"MATH_MODULO",group:{type:"group",a:[{type:"node_in",name:"lw",qualifier:["float"]},{type:"node_in",
name:"lx",qualifier:["float"]},{type:"node_out",name:"ly",qualifier:["float"]},{type:"textline",b:"ly = abs ( lx ) > 0.000001 ? mod ( lw , lx ) : iz ;".split(" ")}]}},{type:"node",name:"MIX_RGB_MIX",group:{type:"group",a:[{type:"node_in",name:"lz",qualifier:["float"]},{type:"node_in",name:"lA",qualifier:["vec3"]},{type:"node_in",name:"lB",qualifier:["vec3"]},{type:"node_out",name:"lC",qualifier:["vec3"]},{type:"textline",b:"{ float lD = clamp ( lz , iz , iA ) ; lC = mix ( lA , lB , lD ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_ADD",group:{type:"group",a:[{type:"node_in",name:"lE",qualifier:["float"]},{type:"node_in",name:"lF",qualifier:["vec3"]},{type:"node_in",name:"lG",qualifier:["vec3"]},{type:"node_out",name:"lH",qualifier:["vec3"]},{type:"textline",b:"{ float lI = clamp ( lE , iz , iA ) ; lH = mix ( lF , lF + lG , lI ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"lJ",qualifier:["float"]},{type:"node_in",name:"lK",qualifier:["vec3"]},
{type:"node_in",name:"lL",qualifier:["vec3"]},{type:"node_out",name:"lM",qualifier:["vec3"]},{type:"textline",b:"{ float lN = clamp ( lJ , iz , iA ) ; lM = mix ( lK , lK * lL , lN ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"lO",qualifier:["float"]},{type:"node_in",name:"lP",qualifier:["vec3"]},{type:"node_in",name:"lQ",qualifier:["vec3"]},{type:"node_out",name:"lR",qualifier:["vec3"]},{type:"textline",b:"{ float lS = clamp ( lO , iz , iA ) ; lR = mix ( lP , lP - lQ , lS ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_SCREEN",group:{type:"group",a:[{type:"node_in",name:"lT",qualifier:["float"]},{type:"node_in",name:"lU",qualifier:["vec3"]},{type:"node_in",name:"lV",qualifier:["vec3"]},{type:"node_out",name:"lW",qualifier:["vec3"]},{type:"textline",b:"{ float lX = clamp ( lT , iz , iA ) ; float lY = iA - lX ; lW = vec3 ( iA ) - ( vec3 ( lY ) + lX * ( vec3 ( iA ) - lV ) ) * ( vec3 ( iA ) - lU ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DIVIDE",group:{type:"group",a:[{type:"node_in",
name:"lZ",qualifier:["float"]},{type:"node_in",name:"l_",qualifier:["vec3"]},{type:"node_in",name:"ma",qualifier:["vec3"]},{type:"node_out",name:"mb",qualifier:["vec3"]},{type:"textline",b:"{ float mc = clamp ( lZ , iz , iA ) ; float md = iA - mc ; mb = l_ ; if ( ma . r != iz ) mb . r = md * mb . r + mc * mb . r / ma . r ; if ( ma . g != iz ) mb . g = md * mb . g + mc * mb . g / ma . g ; if ( ma . b != iz ) mb . b = md * mb . b + mc * mb . b / ma . b ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DIFFERENCE",
group:{type:"group",a:[{type:"node_in",name:"me",qualifier:["float"]},{type:"node_in",name:"mf",qualifier:["vec3"]},{type:"node_in",name:"mg",qualifier:["vec3"]},{type:"node_out",name:"mh",qualifier:["vec3"]},{type:"textline",b:"{ float mi = clamp ( me , iz , iA ) ; mh = mix ( mf , abs ( mf - mg ) , mi ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DARKEN",group:{type:"group",a:[{type:"node_in",name:"mj",qualifier:["float"]},{type:"node_in",name:"mk",qualifier:["vec3"]},{type:"node_in",name:"ml",
qualifier:["vec3"]},{type:"node_out",name:"mm",qualifier:["vec3"]},{type:"textline",b:"{ float mn = clamp ( mj , iz , iA ) ; mm = min ( mk . rgb , ml . rgb * mn ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LIGHTEN",group:{type:"group",a:[{type:"node_in",name:"mo",qualifier:["float"]},{type:"node_in",name:"mp",qualifier:["vec3"]},{type:"node_in",name:"mq",qualifier:["vec3"]},{type:"node_out",name:"mr",qualifier:["vec3"]},{type:"textline",b:"{ float ms = clamp ( mo , iz , iA ) ; mr = max ( mp . rgb , mq . rgb * ms ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_OVERLAY",group:{type:"group",a:[{type:"node_in",name:"mt",qualifier:["float"]},{type:"node_in",name:"mu",qualifier:["vec3"]},{type:"node_in",name:"mv",qualifier:["vec3"]},{type:"node_out",name:"mw",qualifier:["vec3"]},{type:"textline",b:"{ float mx = clamp ( mt , iz , iA ) ; float my = iA - mx ; mw = mu ; if ( mw . r < 0.5 ) mw . r *= my + 2.0 * mx * mv . r ; else mw . r = iA - ( my + 2.0 * mx * ( iA - mv . r ) ) * ( iA - mw . r ) ; if ( mw . g < 0.5 ) mw . g *= my + 2.0 * mx * mv . g ; else mw . g = iA - ( my + 2.0 * mx * ( iA - mv . g ) ) * ( iA - mw . g ) ; if ( mw . b < 0.5 ) mw . b *= my + 2.0 * mx * mv . b ; else mw . b = iA - ( my + 2.0 * mx * ( iA - mv . b ) ) * ( iA - mw . b ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_DODGE",group:{type:"group",a:[{type:"node_in",name:"mz",qualifier:["float"]},{type:"node_in",name:"mA",qualifier:["vec3"]},{type:"node_in",name:"mB",qualifier:["vec3"]},{type:"node_out",name:"mC",qualifier:["vec3"]},{type:"textline",b:"{ float mD = clamp ( mz , iz , iA ) ; mC = mA ; if ( mC . r != iz ) { float mE = iA - mD * mB . r ; if ( mE <= iz ) mC . r = iA ; else if ( ( mE = mC . r / mE ) > iA ) mC . r = iA ; else mC . r = mE ; } if ( mC . g != iz ) { float mF = iA - mD * mB . g ; if ( mF <= iz ) mC . g = iA ; else if ( ( mF = mC . g / mF ) > iA ) mC . g = iA ; else mC . g = mF ; } if ( mC . b != iz ) { float mG = iA - mD * mB . b ; if ( mG <= iz ) mC . b = iA ; else if ( ( mG = mC . b / mG ) > iA ) mC . b = iA ; else mC . b = mG ; } }".split(" ")}]}},
{type:"node",name:"MIX_RGB_BURN",group:{type:"group",a:[{type:"node_in",name:"mH",qualifier:["float"]},{type:"node_in",name:"mI",qualifier:["vec3"]},{type:"node_in",name:"mJ",qualifier:["vec3"]},{type:"node_out",name:"mK",qualifier:["vec3"]},{type:"textline",b:"{ float mL = clamp ( mH , iz , iA ) ; float mM = iA - mL ; float mN ; mK = mI ; mN = mM + mL * mJ . r ; if ( mN <= iz ) mK . r = iz ; else if ( ( mN = ( iA - ( iA - mK . r ) / mN ) ) < iz ) mK . r = iz ; else if ( mN > iA ) mK . r = iA ; else mK . r = mN ; mN = mM + mL * mJ . g ; if ( mN <= iz ) mK . g = iz ; else if ( ( mN = ( iA - ( iA - mK . g ) / mN ) ) < iz ) mK . g = iz ; else if ( mN > iA ) mK . g = iA ; else mK . g = mN ; mN = mM + mL * mJ . b ; if ( mN <= iz ) mK . b = iz ; else if ( ( mN = ( iA - ( iA - mK . b ) / mN ) ) < iz ) mK . b = iz ; else if ( mN > iA ) mK . b = iA ; else mK . b = mN ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_HUE",group:{type:"group",a:[{type:"node_in",name:"mO",qualifier:["float"]},{type:"node_in",name:"mP",qualifier:["vec3"]},{type:"node_in",name:"mQ",qualifier:["vec3"]},{type:"node_out",name:"mR",qualifier:["vec3"]},{type:"textline",b:"{ float mS = clamp ( mO , iz , iA ) ; vec3 mT , mU , mV ; mR = mP ; mU = iJ ( mQ ) ; if ( mU . y != iz ) { mT = iJ ( mR ) ; mT . x = mU . x ; mV = iU ( mT ) ; mR = mix ( mR , mV , mS ) ; } }".split(" ")}]}},{type:"node",name:"MIX_RGB_SATURATION",
group:{type:"group",a:[{type:"node_in",name:"mW",qualifier:["float"]},{type:"node_in",name:"mX",qualifier:["vec3"]},{type:"node_in",name:"mY",qualifier:["vec3"]},{type:"node_out",name:"mZ",qualifier:["vec3"]},{type:"textline",b:"{ float m_ = clamp ( mW , iz , iA ) ; float na = iA - m_ ; mZ = mX ; vec3 nb , nc ; nb = iJ ( mZ ) ; if ( nb . y != iz ) { nc = iJ ( mY ) ; nb . y = na * nb . y + m_ * nc . y ; mZ = iU ( nb ) ; } }".split(" ")}]}},{type:"node",name:"MIX_RGB_VALUE",group:{type:"group",a:[{type:"node_in",
name:"nd",qualifier:["float"]},{type:"node_in",name:"ne",qualifier:["vec3"]},{type:"node_in",name:"nf",qualifier:["vec3"]},{type:"node_out",name:"ng",qualifier:["vec3"]},{type:"textline",b:"{ float nh = clamp ( nd , iz , iA ) ; float ni = iA - nh ; vec3 nj , nk ; nj = iJ ( ne ) ; nk = iJ ( nf ) ; nj . z = ni * nj . z + nh * nk . z ; ng = iU ( nj ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_COLOR",group:{type:"group",a:[{type:"node_in",name:"nl",qualifier:["float"]},{type:"node_in",name:"nm",qualifier:["vec3"]},
{type:"node_in",name:"nn",qualifier:["vec3"]},{type:"node_out",name:"no",qualifier:["vec3"]},{type:"textline",b:"{ float np = clamp ( nl , iz , iA ) ; vec3 nq , nr , ns ; no = nm ; nr = iJ ( nn ) ; if ( nr . y != iz ) { nq = iJ ( no ) ; nq . x = nr . x ; nq . y = nr . y ; ns = iU ( nq ) ; no = mix ( no , ns , np ) ; } }".split(" ")}]}},{type:"node",name:"MIX_RGB_SOFT_LIGHT",group:{type:"group",a:[{type:"node_in",name:"nt",qualifier:["float"]},{type:"node_in",name:"nu",qualifier:["vec3"]},{type:"node_in",
name:"nv",qualifier:["vec3"]},{type:"node_out",name:"nw",qualifier:["vec3"]},{type:"textline",b:"{ float nx = clamp ( nt , iz , iA ) ; float ny = iA - nx ; vec3 nz = vec3 ( iA ) ; vec3 nA = nz - ( nz - nv ) * ( nz - nu ) ; nw = ny * nu + nx * ( ( nz - nu ) * nv * nu + nu * nA ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",group:{type:"group",a:[{type:"node_in",name:"nB",qualifier:["float"]},{type:"node_in",name:"nC",qualifier:["vec3"]},{type:"node_in",name:"nD",qualifier:["vec3"]},
{type:"node_out",name:"nE",qualifier:["vec3"]},{type:"textline",b:"{ float nF = clamp ( nB , iz , iA ) ; nE = nC ; if ( nD . r > 0.5 ) nE . r = nC . r + nF * ( 2.0 * ( nD . r - 0.5 ) ) ; else nE . r = nC . r + nF * ( 2.0 * ( nD . r ) - iA ) ; if ( nD . g > 0.5 ) nE . g = nC . g + nF * ( 2.0 * ( nD . g - 0.5 ) ) ; else nE . g = nC . g + nF * ( 2.0 * ( nD . g ) - iA ) ; if ( nD . b > 0.5 ) nE . b = nC . b + nF * ( 2.0 * ( nD . b - 0.5 ) ) ; else nE . b = nC . b + nF * ( 2.0 * ( nD . b ) - iA ) ; nE = clamp ( nE , iz , iA ) ; }".split(" ")}]}},
{type:"node",name:"OUTPUT",group:{type:"group",a:[{type:"node_in",name:"nG",qualifier:["vec3"]},{type:"node_in",name:"nH",qualifier:["float"]},{type:"textline",b:"jH = nG ; jM = nH ;".split(" ")}]}},{type:"node",name:"MATERIAL",group:{type:"group",a:[{type:"node_param",name:"jk",qualifier:["const","vec3"]},{type:"node_param",name:"jl",qualifier:["const","vec3"]},{type:"node_param",name:"jm",qualifier:["const","float"]},{type:"node_in",name:"nI",qualifier:["vec3"]},{type:"node_in",name:"nJ",qualifier:["float"]},
{type:"node_in",name:"nK",qualifier:["vec3"]},{type:"node_in",name:"nL",qualifier:["vec3"]},{type:"node_out",name:"nM",qualifier:["vec3"]},{type:"node_out",name:"nN",qualifier:["float"]},{type:"node_out",name:"nO",qualifier:["vec3"]},{type:"textline",b:"nI = clamp ( nI , iz , iA ) ; nJ = clamp ( nJ , iz , iA ) ; nK = clamp ( nK , iz , iA ) ; vec3 nP = nI ; float nQ = jk [ 0 ] ; vec2 nR = vec2 ( jk [ 1 ] , jk [ 2 ] ) ; vec3 nS = jD * nI ; vec3 nT = jE * jy ; vec3 nU = jl [ 1 ] * nK ; float nV = jl [ 0 ] ; float nW = jl [ 2 ] ; float nX = dc ( jF , nP ) ; vec3 nY ; if ( jm == iA ) nY = normalize ( nL ) ; else nY = jw ; eW nZ = gz ( nS , nT , nP , nU , jB , nY , jA , nW , nR , nX , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , iz , vec4 ( iz ) ) ; nM = ( nQ == iA ) ? nZ . a . rgb : vec3 ( iz ) ; nN = nJ + nZ . a . a * nU . r ; nO = nY ; if ( nV == iA ) { nM += nZ . b ; jI = nZ . b ; } else { jI = vec3 ( iz ) ; } jJ = nY ; jL = nX ;".split(" ")}]}},
{type:"node",name:"MATERIAL_EXT",group:{type:"group",a:[{type:"node_param",name:"jn",qualifier:["const","vec3"]},{type:"node_param",name:"jo",qualifier:["const","vec3"]},{type:"node_param",name:"jp",qualifier:["const","float"]},{type:"node_in",name:"n_",qualifier:["vec3"]},{type:"node_in",name:"oa",qualifier:["float"]},{type:"node_in",name:"ob",qualifier:["vec3"]},{type:"node_in",name:"oc",qualifier:["vec3"]},{type:"node_in",name:"od",qualifier:["float"]},{type:"node_in",name:"oe",qualifier:["float"]},
{type:"node_in",name:"of",qualifier:["vec4"]},{type:"node_out",name:"og",qualifier:["vec3"]},{type:"node_out",name:"oh",qualifier:["float"]},{type:"node_out",name:"oi",qualifier:["vec3"]},{type:"node_out",name:"oj",qualifier:["vec3"]},{type:"node_out",name:"ok",qualifier:["vec3"]},{type:"textline",b:"n_ = clamp ( n_ , iz , iA ) ; oa = clamp ( oa , iz , iA ) ; ob = clamp ( ob , iz , iA ) ; vec3 nP = n_ ; float nQ = jn [ 0 ] ; vec2 nR = vec2 ( jn [ 1 ] , jn [ 2 ] ) ; vec3 nS = od * n_ ; vec3 nT = jE * jy ; vec3 nU = jo [ 1 ] * ob ; float nV = jo [ 0 ] ; float nW = jo [ 2 ] ; float nX = dc ( jF , nP ) ; vec3 nY ; if ( jp == iA ) nY = normalize ( oc ) ; else nY = jw ; eW nZ = gz ( nS , nT , nP , nU , jB , nY , jA , nW , nR , nX , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , oe , of ) ; og = ( nQ == iA ) ? nZ . a . rgb : vec3 ( iz ) ; oh = oa + nZ . a . a * nU . r ; oi = nY ; oj = nZ . a . rgb ; ok = nZ . b ; if ( nV == iA ) { og += nZ . b ; jI = nZ . b ; } else { jI = vec3 ( iz ) ; } jJ = nY ; jL = nX ;".split(" ")}]}},
{type:"node",name:"RGB",group:{type:"group",a:[{type:"node_param",name:"jq",qualifier:["vec3"]},{type:"node_out",name:"ol",qualifier:["vec3"]},{type:"textline",b:["ol","=","jq",";"]}]}},{type:"node",name:"RGBTOBW",group:{type:"group",a:[{type:"node_in",name:"om",qualifier:["vec3"]},{type:"node_out",name:"on",qualifier:["float"]},{type:"textline",b:"on = om . r * 0.35 + om . g * 0.45 + om . b * 0.2 ;".split(" ")}]}},{type:"node",name:"SEPRGB",group:{type:"group",a:[{type:"node_in",name:"oo",qualifier:["vec3"]},
{type:"node_out",name:"op",qualifier:["float"]},{type:"node_out",name:"oq",qualifier:["float"]},{type:"node_out",name:"or",qualifier:["float"]},{type:"textline",b:"op = oo . r ; oq = oo . g ; or = oo . b ;".split(" ")}]}},{type:"node",name:"SQUEEZE",group:{type:"group",a:[{type:"node_in",name:"os",qualifier:["float"]},{type:"node_in",name:"ot",qualifier:["float"]},{type:"node_in",name:"ou",qualifier:["float"]},{type:"node_out",name:"ov",qualifier:["float"]},{type:"textline",b:"ov = iA / ( iA + pow ( 2.71828183 , - ( ( os - ou ) * ot ) ) ) ;".split(" ")}]}},
{type:"node",name:"SRGB_TO_LINEAR",group:{type:"group",a:[{type:"node_in",name:"ow",qualifier:["vec3"]},{type:"node_out",name:"ox",qualifier:["vec3"]},{type:"textline",b:"ox = pow ( ow , vec3 ( 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"LINEAR_TO_SRGB",group:{type:"group",a:[{type:"node_in",name:"oy",qualifier:["vec3"]},{type:"node_out",name:"oz",qualifier:["vec3"]},{type:"textline",b:"oz = pow ( oy , vec3 ( iA / 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR",group:{type:"group",a:[{type:"node_param",
name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"oA",qualifier:["vec3"]},{type:"node_out",name:"oB",qualifier:["vec3"]},{type:"node_out",name:"oC",qualifier:["float"]},{type:"textline",b:"{ vec4 oD = texture2D ( node_TEXTURE_COLOR_var_texture , iY ( oA ) ) ; oB = oD . xyz ; eb ( oB ) ; oC = oD . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform",
"sampler2D"]},{type:"node_in",name:"oE",qualifier:["vec3"]},{type:"node_out",name:"oF",qualifier:["vec3"]},{type:"node_out",name:"oG",qualifier:["float"]},{type:"textline",b:"{ vec4 oH = texture2D ( node_TEXTURE_NORMAL_var_texture , iY ( oE ) ) ; jK = oH . xyz - 0.5 ; oF = normalize ( jG * jK ) ; oG = oH . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_ENVIRONMENT",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]},{type:"node_in",
name:"oI",qualifier:["vec3"]},{type:"node_out",name:"oJ",qualifier:["vec3"]},{type:"node_out",name:"oK",qualifier:["float"]},{type:"textline",b:"{ vec4 oL = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , oI ) ; oJ = oL . xyz ; eb ( oJ ) ; oK = oL . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR2",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR2_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"oM",qualifier:["vec3"]},{type:"node_in",name:"oN",qualifier:["vec3"]},
{type:"node_out",name:"oO",qualifier:["vec3"]},{type:"node_out",name:"oP",qualifier:["float"]},{type:"node_out",name:"oQ",qualifier:["vec3"]},{type:"node_out",name:"oR",qualifier:["float"]},{type:"textline",b:"{ vec4 oS = texture2D ( node_TEXTURE_COLOR2_var_texture , iY ( oM ) ) ; oO = oS . xyz ; eb ( oO ) ; oP = oS . w ; oS = texture2D ( node_TEXTURE_COLOR2_var_texture , iY ( oN ) ) ; oQ = oS . xyz ; eb ( oQ ) ; oR = oS . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL2",group:{type:"group",
a:[{type:"node_param",name:"node_TEXTURE_NORMAL2_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"oT",qualifier:["vec3"]},{type:"node_in",name:"oU",qualifier:["vec3"]},{type:"node_out",name:"oV",qualifier:["vec3"]},{type:"node_out",name:"oW",qualifier:["float"]},{type:"node_out",name:"oX",qualifier:["vec3"]},{type:"node_out",name:"oY",qualifier:["float"]},{type:"textline",b:"{ vec4 oZ = texture2D ( node_TEXTURE_NORMAL2_var_texture , iY ( oT ) ) ; jK = oZ . xyz - 0.5 ; oV = normalize ( jG * jK ) ; oW = oZ . w ; oZ = texture2D ( node_TEXTURE_NORMAL2_var_texture , iY ( oU ) ) ; jK = oZ . xyz - 0.5 ; oX = normalize ( jG * jK ) ; oY = oZ . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_COLOR3",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"o_",qualifier:["vec3"]},{type:"node_in",name:"pa",qualifier:["vec3"]},{type:"node_in",name:"pb",qualifier:["vec3"]},{type:"node_out",name:"pc",qualifier:["vec3"]},{type:"node_out",name:"pd",qualifier:["float"]},{type:"node_out",name:"pe",qualifier:["vec3"]},{type:"node_out",name:"pf",qualifier:["float"]},{type:"node_out",name:"pg",
qualifier:["vec3"]},{type:"node_out",name:"ph",qualifier:["float"]},{type:"textline",b:"{ vec4 pi = texture2D ( node_TEXTURE_COLOR3_var_texture , iY ( o_ ) ) ; pc = pi . xyz ; eb ( pc ) ; pd = pi . w ; pi = texture2D ( node_TEXTURE_COLOR3_var_texture , iY ( pa ) ) ; pe = pi . xyz ; eb ( pe ) ; pf = pi . w ; pi = texture2D ( node_TEXTURE_COLOR3_var_texture , iY ( pb ) ) ; pg = pi . xyz ; eb ( pg ) ; ph = pi . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL3",group:{type:"group",a:[{type:"node_param",
name:"node_TEXTURE_NORMAL3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"pj",qualifier:["vec3"]},{type:"node_in",name:"pk",qualifier:["vec3"]},{type:"node_in",name:"pl",qualifier:["vec3"]},{type:"node_out",name:"pm",qualifier:["vec3"]},{type:"node_out",name:"pn",qualifier:["float"]},{type:"node_out",name:"po",qualifier:["vec3"]},{type:"node_out",name:"pp",qualifier:["float"]},{type:"node_out",name:"pq",qualifier:["vec3"]},{type:"node_out",name:"pr",qualifier:["float"]},{type:"textline",
b:"{ vec4 ps = texture2D ( node_TEXTURE_NORMAL3_var_texture , iY ( pj ) ) ; jK = ps . xyz - 0.5 ; pm = normalize ( jG * jK ) ; pn = ps . w ; ps = texture2D ( node_TEXTURE_NORMAL3_var_texture , iY ( pk ) ) ; jK = ps . xyz - 0.5 ; po = normalize ( jG * jK ) ; pp = ps . w ; ps = texture2D ( node_TEXTURE_NORMAL3_var_texture , iY ( pl ) ) ; jK = ps . xyz - 0.5 ; pq = normalize ( jG * jK ) ; pr = ps . w ; }".split(" ")}]}},{type:"node",name:"VALUE",group:{type:"group",a:[{type:"node_param",name:"jr",qualifier:["float"]},
{type:"node_out",name:"pt",qualifier:["float"]},{type:"textline",b:["pt","=","jr",";"]}]}},{type:"node",name:"VECT_MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"pu",qualifier:["vec3"]},{type:"node_in",name:"pv",qualifier:["vec3"]},{type:"node_out",name:"pw",qualifier:["vec3"]},{type:"node_out",name:"px",qualifier:["float"]},{type:"textline",b:"pw = pu + pv ; px = ( abs ( pw [ 0 ] ) + abs ( pw [ 1 ] ) + abs ( pw [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_SUBTRACT",group:{type:"group",
a:[{type:"node_in",name:"py",qualifier:["vec3"]},{type:"node_in",name:"pz",qualifier:["vec3"]},{type:"node_out",name:"pA",qualifier:["vec3"]},{type:"node_out",name:"pB",qualifier:["float"]},{type:"textline",b:"pA = py - pz ; pB = ( abs ( pA [ 0 ] ) + abs ( pA [ 1 ] ) + abs ( pA [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_AVERAGE",group:{type:"group",a:[{type:"node_in",name:"pC",qualifier:["vec3"]},{type:"node_in",name:"pD",qualifier:["vec3"]},{type:"node_out",name:"pE",qualifier:["vec3"]},
{type:"node_out",name:"pF",qualifier:["float"]},{type:"textline",b:"pE = pC + pD ; pF = length ( pE ) ; pE = normalize ( pE ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_DOT_PRODUCT",group:{type:"group",a:[{type:"node_in",name:"pG",qualifier:["vec3"]},{type:"node_in",name:"pH",qualifier:["vec3"]},{type:"node_out",name:"pI",qualifier:["vec3"]},{type:"node_out",name:"pJ",qualifier:["float"]},{type:"textline",b:"pI = vec3 ( iz ) ; pJ = dot ( pG , pH ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",
group:{type:"group",a:[{type:"node_in",name:"pK",qualifier:["vec3"]},{type:"node_in",name:"pL",qualifier:["vec3"]},{type:"node_out",name:"pM",qualifier:["vec3"]},{type:"node_out",name:"pN",qualifier:["float"]},{type:"textline",b:"pM = cross ( pK , pL ) ; pN = length ( pM ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_NORMALIZE",group:{type:"group",a:[{type:"node_in",name:"pO",qualifier:["vec3"]},{type:"node_in",name:"pP",qualifier:["vec3"]},{type:"node_out",name:"pQ",qualifier:["vec3"]},{type:"node_out",
name:"pR",qualifier:["float"]},{type:"textline",b:"pQ = normalize ( pO ) ; pR = length ( pO ) ; pP ;".split(" ")}]}},{type:"node",name:"REFLECT",group:{type:"group",a:[{type:"node_in",name:"pS",qualifier:["vec3"]},{type:"node_in",name:"pT",qualifier:["vec3"]},{type:"node_out",name:"pU",qualifier:["vec3"]},{type:"textline",b:"pU = reflect ( - pS , pT ) ;".split(" ")}]}},{type:"node",name:"PARALLAX",group:{type:"group",a:[{type:"node_param",name:"node_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]},
{type:"node_in",name:"pV",qualifier:["vec3"]},{type:"node_in",name:"pW",qualifier:["float"]},{type:"node_in",name:"pX",qualifier:["const","float"]},{type:"node_out",name:"pY",qualifier:["vec3"]},{type:"textline",b:"float pZ = length ( jC ) ; if ( pZ < 10.0 ) { float p_ = clamp ( 5.0 - 0.5 * pZ , iz , iA ) ; float qa = pW * p_ ; vec3 qb = normalize ( jA * jG ) ; float qc = iA / pX ; vec2 qd = qb . xy * qa / ( pX * qb . z ) ; float qe = iA ; vec2 qf = iY ( pV ) ; float qg = texture2D ( node_PARALLAX_var_texture , qf ) . a ; for ( float qh = 1.0 ; qh <= pX ; qh ++ ) { if ( qg < qe ) { qe -= qc ; qf -= qd ; qg = texture2D ( node_PARALLAX_var_texture , qf ) . a ; } } vec2 qi = qf + qd ; float qj = texture2D ( node_PARALLAX_var_texture , qi ) . a - ( qe + qc ) ; float qk = qg - qe ; float ql = qk / ( qk - qj ) ; qf = ql * qi + ( iA - ql ) * qf ; pY = iW ( qf ) ; } else pY = pV ;".split(" ")}]}},
{type:"node",name:"CLAMP",group:{type:"group",a:[{type:"node_in",name:"qm",qualifier:["vec3"]},{type:"node_out",name:"qn",qualifier:["vec3"]},{type:"textline",b:"qn = clamp ( qm , iz , iA ) ;".split(" ")}]}},{type:"node",name:"TRANSLUCENCY",group:{type:"group",a:[{type:"node_in",name:"qo",qualifier:["float"]},{type:"node_in",name:"qp",qualifier:["float"]},{type:"node_in",name:"qq",qualifier:["float"]},{type:"node_in",name:"qr",qualifier:["float"]},{type:"node_in",name:"qs",qualifier:["float"]},{type:"node_out",
name:"qt",qualifier:["float"]},{type:"node_out",name:"qu",qualifier:["vec4"]},{type:"textline",b:"qt = qo ; qu = vec4 ( qp , qq , qr , qs ) ;".split(" ")}]}},{type:"node",name:"TIME",group:{type:"group",a:[{type:"node_out",name:"qv",qualifier:["float"]},{type:"textline",b:["qv","=","u_time",";"]}]}},{type:"nodes_global"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SHADED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",
a:[{type:"textline",b:"float js = h_ . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"textline",b:["vec3","jt","=","ia",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) jt = jt ; else jt = - jt ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 ju = cross ( jt , ib . xyz ) * ib . w ; mat3 jv = mat3 ( ib . xyz , ju , jt ) ;".split(" ")}]}}]},{type:"textline",
b:"vec3 jw = normalize ( jt ) ; float jx = 0.5 * jw . y + 0.5 ; vec3 jy = u_environment_energy * mix ( u_horizon_color , u_zenith_color , jx ) ; vec3 jz = u_camera_eye_frag - h_ ; vec3 jA = normalize ( jz ) ; vec3 jB = h_ ; vec4 jC = cu ; float jD = u_emit ; float jE = u_ambient ; float jF = u_shadow_visibility_falloff ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["mat3","jG","=","jv",";"]}]}}]},{type:"textline",b:"vec3 jH ; vec3 jI ; vec3 jJ ; vec3 jK ; float jL ; float jM ;".split(" ")},
{type:"nodes_main"},{type:"textline",b:"vec3 qw = jH ; float qx = jM ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"iy ( qw , jA , jJ , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , jK . st ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"iy ( qw , jA , jJ , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , vec2 ( iz ) ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["vec3","qy","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"qw = max ( qw - sqrt ( 0.01 * - min ( js , iz ) ) , 0.5 * qw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"hY ( qw , js , u_time , jL , jt , u_sun_direction , qy , u_sun_quaternion , h_ , length ( cu ) ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 qz = ev ( u_cube_fog , jA ) ; vec4 qA = vec4 ( qz , u_fog_color_density . a ) ; eb ( qA . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qA = u_fog_color_density ; qA . rgb *= qy ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"eM ( qw , length ( cu ) , jA . y , u_cam_water_depth , u_underwater_fog_color_density , qA , js , length ( qy ) + u_environment_energy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"eo ( qw , length ( cu ) , qA ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 qB = texture2DProj ( u_shadow_mask , ct ) . rg ; float qC = qB . g ; qw = vec3 ( qC ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 jB = h_ ; vec4 jC = cu ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["vec3","jt","=","ia",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) jt = jt ; else jt = - jt ;".split(" ")}]}}]},{type:"textline",b:"vec3 jw = normalize ( jt ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 jH ; float jM ;".split(" ")},
{type:"nodes_main"},{type:"textline",b:"vec3 qw = jH ; float qx = jM ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( qx < 0.5 ) discard ; qx = iA ;".split(" ")}]}}]},{type:"textline",b:["ed","(","qw",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"eg ( qw , qx ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( qw , qx ) ; }".split(" ")}]};
a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SHADED","||","USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]},{type:"condition",
a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",
";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["SHADED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"textline",b:"varying vec3 h_ ; varying vec4 cu ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADED","||","USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ia",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ib",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cp",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cq",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cs",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ct",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"iZ",
qualifier:["varying","vec2"]},{type:"textline",b:["iZ","=","node_GEOMETRY_UV_var_a_uv",";"]}]}},{type:"node",name:"GEOMETRY_VC",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"jd",qualifier:["varying","vec3"]},{type:"textline",b:["jd","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute",
"float"]},{type:"node_param",name:"je",qualifier:["varying","float"]},{type:"textline",b:["je","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"jf",qualifier:["varying","vec2"]},{type:"textline",b:["jf","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC3",group:{type:"group",a:[{type:"node_param",
name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"jg",qualifier:["varying","vec3"]},{type:"textline",b:["jg","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]}},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec3 jh = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADED"],group:{type:"group",a:[{type:"textline",b:["vec3","ji","=","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",
b:"vec3 jj = vec3 ( a_tangent ) ; vec3 jk = a_tangent [ 3 ] * cross ( ji , jj ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 jj = vec3 ( 0.0 ) ; vec3 jk = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["vec3","ji","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ji = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:"jh = mix ( jh , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADED"],group:{type:"group",a:[{type:"textline",b:"ji = mix ( ji , a_normal_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 jl = vec3 ( a_tangent ) ; vec3 jm = a_tangent_next [ 3 ] * cross ( a_normal_next , jl ) ; jj = mix ( jj , jl , u_va_frame_factor ) ; jk = mix ( jk , jm , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bn ( jh , jj , jk , ji ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","jn","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 jn = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:"vec3 jo = ( u_model_matrix * vec4 ( jn , 1.0 ) ) . xyz ; mat4 jp = ab ( u_camera_eye , jo , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 jq = ( u_model_matrix * vec4 ( jn , 1.0 ) ) . xyz ; jp = jp * R ( u_wind , u_time , u_jitter_amp , u_jitter_freq , jq ) ;".split(" ")}]}}]},{type:"textline",b:"b jr = ai ( jh - jn , jn , jj , jk , ji , jp ) ; jr . b = jo ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"b jr = ai ( jh , jn , jj , jk , ji , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"float js = ( dot ( cross ( jr . e , jr . c ) , jr . d ) < 0.0 ) ? - 1.0 : 1.0 ; ib = vec4 ( jr . c , js ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 jo = ( u_model_matrix * vec4 ( jn , 1.0 ) ) . xyz ; mat4 jp = ab ( u_camera_eye , jo , u_view_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 jq = ( u_model_matrix * vec4 ( jn , 1.0 ) ) . xyz ; jp = jp * R ( u_wind , u_time , u_jitter_amp , u_jitter_freq , jq ) ;".split(" ")}]}}]},{type:"textline",b:"b jr = ai ( jh - jn , jn , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ji , jp ) ; jr . b = jo ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"b jr = ai ( jh , jn , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ji , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ce ( jr . a , jr . b , ji ) ;".split(" ")}]}}]},{type:"textline",b:"h_ = jr . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADED","||","USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:"ia = jr . e ;".split(" ")}]}}]},{type:"textline",b:"cu = u_view_matrix * vec4 ( jr . a , 1.0 ) ; vec4 jt = u_proj_matrix * cu ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",
a:[{type:"textline",b:"jt . xy += u_subpixel_jitter * jt . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["dV","(","jt",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"dV ( jr . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"float ju = jt . x ; float jv = jt . y ; float jw = jt . w ; ct . x = ( ju + jw ) / 2.0 ; ct . y = ( jv + jw ) / 2.0 ; ct . z = jw ;".split(" ")}]}}]},
{type:"nodes_main"},{type:"textline",b:["gl_Position","=","jt",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float jh ; varying vec3 ic ; varying vec3 cu ; void main ( ) { float ji = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; float jj = smoothstep ( u_p_alpha_start , u_p_alpha_end , ji ) ; float jk = u_diffuse_color . a * jh * ( 1.0 - clamp ( jj , 0.0 , 1.0 ) ) ; vec3 jl = ic * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"eo ( jl , length ( cu ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["ed","(","jl",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"eg ( jl , jk ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( jl , jk ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"include",file:"particles.glslv"},
{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; uniform vec2 u_p_size_ramp [ RAMPSIZE ] ; uniform vec4 u_p_color_ramp [ RAMPSIZE ] ; uniform float u_p_time ; uniform float u_p_starttime ; uniform float u_p_endtime ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ; varying float jh ; varying vec3 ic ; varying vec3 cu ; struct jP { float iz ; vec3 iA ; float iB ; vec3 iC ; float iD ; } ; jP jW ( ) { float jQ = u_p_time - u_p_starttime ; jP jR ; if ( jQ < 0.0 ) { jR . iz = 0.0001 ; jR . iA = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( jQ < 0.0 ) ) { float jS ; if ( u_p_cyclic == 1 ) { float jT = u_p_endtime - u_p_starttime ; jS = mod ( jQ , jT ) - a_p_delay ; if ( jS < 0.0 ) jS += jT ; } if ( u_p_cyclic != 1 ) { jS = jQ - a_p_delay ; } if ( jS < 0.0 || jS >= a_p_lifetime ) { jR . iz = 0.0001 ; jR . iA = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( jS < 0.0 || jS >= a_p_lifetime ) ) { vec3 jU = a_position ; vec3 jV = a_normal ; jU += u_p_nfactor * jS * jV ; jU += a_p_vels . xyz * jS ; jU . y -= u_p_gravity * jS * jS / 2.0 ; jU += ( u_p_wind / u_p_mass ) * jS * jS / 2.0 ; jR . iA = jU ; jR . iD = a_p_vels . w * jS ; jR . iz = jt ( jS , u_p_max_lifetime , u_p_size_ramp ) ; jR . iB = jO ( jS , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; jR . iC = jF ( jS , u_p_max_lifetime , u_p_color_ramp ) ; } } return jR ; } void main ( ) { jP jX ; jX = jW ( ) ; vec4 jY = u_view_matrix * vec4 ( jX . iA , 1.0 ) ; gl_Position = u_proj_matrix * jY ; jh = jX . iB ; ic = jX . iC ; cu = jY . xyz ; float jZ = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = jX . iz * jZ ; }".split(" ")}]};
a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying float jh ; varying vec3 ic ; varying vec2 a ; void main ( ) { vec4 iz = texture2D ( u_sampler , a ) ; vec3 iA = iz . rgb ; eb ( iA ) ; iA *= ic ; float iB = iz . a * jh ; ed ( iA ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"eg ( iA , iB ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( iA , iB ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"include",file:"particles.glslv"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ; uniform vec2 u_p_size_ramp [ RAMPSIZE ] ; uniform vec4 u_p_color_ramp [ RAMPSIZE ] ; uniform float u_p_time ; uniform float u_p_starttime ; uniform float u_p_endtime ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform float u_p_size ; varying float jh ; varying vec3 ic ; varying vec2 a ; varying vec4 cu ; struct jP { float iz ; vec3 iA ; float iB ; vec3 iC ; float iD ; } ; jP jW ( ) { float jQ = u_p_time - u_p_starttime ; jP jR ; if ( jQ < 0.0 ) { jR . iz = 0.0001 ; jR . iA = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( jQ < 0.0 ) ) { float jS ; if ( u_p_cyclic == 1 ) { float jT = u_p_endtime - u_p_starttime ; jS = mod ( jQ , jT ) - a_p_delay ; if ( jS < 0.0 ) jS += jT ; } if ( u_p_cyclic != 1 ) { jS = jQ - a_p_delay ; } if ( jS < 0.0 || jS >= a_p_lifetime ) { jR . iz = 0.0001 ; jR . iA = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( jS < 0.0 || jS >= a_p_lifetime ) ) { vec3 jU = a_position ; vec3 jV = a_normal ; jU += u_p_nfactor * jS * jV ; jU += a_p_vels . xyz * jS ; jU . y -= u_p_gravity * jS * jS / 2.0 ; jU += ( u_p_wind / u_p_mass ) * jS * jS / 2.0 ; jR . iA = jU ; jR . iD = a_p_vels . w * jS ; jR . iz = jt ( jS , u_p_max_lifetime , u_p_size_ramp ) ; jR . iB = jO ( jS , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; jR . iC = jF ( jS , u_p_max_lifetime , u_p_color_ramp ) ; } } return jR ; } float jZ ( vec2 jX , vec2 jY ) { return ( atan ( jY . y , jY . x ) - atan ( jX . y , jX . x ) ) ; } void main ( ) { jP j_ ; j_ = jW ( ) ; float ka ; mat4 kb ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { ka = j_ . iD ; kb = A ( j_ . iA , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { ka = j_ . iD ; kb = l ( ) ; kb [ 3 ] = vec4 ( j_ . iA , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { ka = j_ . iD ; kb = p ( radians ( 90.0 ) ) ; kb [ 3 ] = vec4 ( j_ . iA , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { ka = jZ ( vec2 ( 0.0 , - 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + j_ . iD ; kb = n ( radians ( - 90.0 ) ) ; kb [ 3 ] = vec4 ( j_ . iA , 1.0 ) ; } vec4 kc = vec4 ( a_p_bb_vertex * 2.0 * j_ . iz * u_p_size , 0.0 , 1.0 ) ; vec4 kd = kb * r ( ka ) * kc ; cu = u_view_matrix * kd ; vec4 ke = u_proj_matrix * cu ; gl_Position = ke ; jh = j_ . iB ; ic = j_ . iC ; a = a_p_bb_vertex + 0.5 ; }".split(" ")}]};
a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 jP ; const float jQ = 0.99 ; const float jR = 1.8 ; const int jS = 8 ; float kb ( vec3 jT , vec3 jU ) { float jV = dot ( jU , jU ) ; float jW = 2.0 * dot ( jU , jT ) ; float jX = dot ( jT , jT ) - 1.0 ; float jY = jW * jW - 4.0 * jV * jX ; float jZ = sqrt ( jY ) ; float j_ = ( - jW - jZ ) / 2.0 ; float ka = jX / j_ ; return ka ; } float ki ( float kc , float kd ) { float ke = 3.0 * ( 1.0 - kd * kd ) ; float kf = 2.0 * ( 2.0 + kd * kd ) ; float kg = 1.0 + kc * kc ; float kh = pow ( 1.0 + kd * kd - 2.0 * kd * kc , 1.5 ) ; return ( ke / kf ) * ( kg / kh ) ; } float kq ( vec3 kj , vec3 kk , float kl ) { float km = dot ( kk , - kj ) ; if ( km < 0.0 ) { return 1.0 ; } vec3 kn = kj + km * kk ; if ( length ( kn ) < kl ) { return 0.0 ; } else if ( length ( kn ) >= kl ) { vec3 ko = normalize ( kn ) * kl - kj ; float kp = acos ( dot ( normalize ( ko ) , kk ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( kp * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 ku ( float kr , vec3 ks , float kt ) { return ks - ks * pow ( u_sky_color , vec3 ( kt / kr ) ) ; } void main ( ) { vec3 kv = normalize ( jP ) ; vec3 kw = u_sun_direction ; float kx = dot ( kv , kw ) ; float ky = ki ( kx , - 0.01 ) * u_rayleigh_brightness * kw . y ; float kz = ki ( kx - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - kw . y ) ; float kA = smoothstep ( 0.0 , 100.0 , ki ( kx , 0.9995 ) ) * u_spot_brightness ; vec3 kB = vec3 ( 0.0 , jQ , 0.0 ) ; float kC = kb ( kB , kv ) ; float kD = kC / float ( jS ) ; float kE = kq ( kB , kv , jQ - 0.3 ) ; vec3 kF = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 kG = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int kH = 0 ; kH < jS ; kH ++ ) { float kI = kD * float ( kH ) ; vec3 kJ = kB + kv * kI ; float kK = kq ( kJ , kw , jQ - 0.2 ) ; float kL = kb ( kJ , kw ) ; vec3 kM = ku ( kL , vec3 ( jR ) , u_scatter_strength ) * kK ; kF += ku ( sqrt ( kI ) , u_sky_color * kM , u_rayleigh_strength ) ; kG += ku ( kI , kM , u_mie_strength ) ; } kF = kF * kE * pow ( kC , u_rayleigh_collection_power ) / float ( jS ) ; kG = ( kG * kE * pow ( kC , u_mie_collection_power ) ) / float ( jS ) ; vec3 kN = vec3 ( kA * kG + kz * kG + ky * kF ) ; ed ( kN ) ; gl_FragColor = vec4 ( kN , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 jP ; void main ( ) { vec4 iz = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 iA = u_cube_view_matrix * iz ; jP = iA . xyz ; gl_Position = iz ; }".split(" ")}]};a["shadeless.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},
{type:"textline",b:"uniform float u_time ; uniform vec4 u_fog_color_density ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_colormap0 ; uniform float u_diffuse_color_factor ; uniform vec2 u_colormap0_uv_velocity ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ; varying vec2 a ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ic",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]}]}}]},{type:"textline",b:"varying vec4 cu ; void main ( ) {".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["vec2","iz","=","a",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:"vec3 iA = ic ; eb ( iA ) ; vec4 iB = vec4 ( iA , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","iB","=","u_diffuse_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:"vec4 iC = texture2D ( u_colormap0 , iz ) ; eb ( iC . rgb ) ; vec4 iD = texture2D ( u_colormap1 , iz ) ; eb ( iD . rgb ) ; vec4 iE = texture2D ( u_stencil0 , iz ) ; vec4 iF = mix ( iC , iD , iE . r ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 iF = texture2D ( u_colormap0 , iz + u_time * u_colormap0_uv_velocity ) ; eb ( iF . rgb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"iB . rgb = mix ( iB . rgb , iF . rgb , u_diffuse_color_factor ) ; iB . a = iF . a ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",
b:"iB . rgb *= mix ( vec3 ( 1.0 ) , iF . rgb , u_diffuse_color_factor ) ; iB . a = iF . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 iG = iB . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"float iH = iB . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( iH < 0.5 ) discard ; iH = 1.0 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float",
"iH","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"eo ( iG , length ( cu ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["ed","(","iG",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"eg ( iG , iH ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( iG , iH ) ; }".split(" ")}]};a["shadeless.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",
b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",
";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4",
"u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["varying","vec4","cu",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ic",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},
{type:"textline",b:"void main ( ) { vec3 iz = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"iz = mix ( iz , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 iA = vec3 ( 0.0 ) ; vec3 iB = vec3 ( 0.0 ) ; vec3 iC = vec3 ( 0.0 ) ; bn ( iz , iA , iB , iC ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS",
"||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","iD","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 iD = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 iE = ( u_model_matrix * vec4 ( iD , 1.0 ) ) . xyz ; mat4 iF = ab ( u_camera_eye , iE , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],
group:{type:"group",a:[{type:"textline",b:"vec3 iG = ( u_model_matrix * vec4 ( iD , 1.0 ) ) . xyz ; iF = iF * R ( u_wind , u_time , u_jitter_amp , u_jitter_freq , iG ) ;".split(" ")}]}}]},{type:"textline",b:"b iH = ai ( iz - iD , iD , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , iF ) ; iH . b = iE ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"b iH = ai ( iz , iD , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","iI","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 iI = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ce ( iH . a , iH . b , iI ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = al ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["ic","=","a_color",";"]}]}}]},{type:"textline",b:"cu = u_view_matrix * vec4 ( iH . a , 1.0 ) ; gl_Position = u_proj_matrix * cu ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"gl_Position . xy += u_subpixel_jitter * gl_Position . w ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 iz = texture2D ( u_sampler , a ) ; ed ( iz . rgb ) ; eg ( iz . rgb , iz . a ) ; gl_FragColor = iz ; }".split(" ")}]};a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { a = a_texcoord ; vec3 iz = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 iA = u_proj_matrix * u_view_matrix * vec4 ( iz , 0.0 ) ; iA . x /= iA . w ; iA . y /= iA . w ; iA += 99999.0 * step ( iA . z , 0.0 ) ; iA += 100.0 * ( step ( 1.0 , abs ( iA . x ) ) + step ( 1.0 , abs ( iA . y ) ) ) ; iA . x = - a_lf_dist * iA . x ; iA . y = - a_lf_dist * iA . y ; float iB = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 iC = vec2 ( a_lf_bb_vertex . x / iB , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float iD = 1.9 ; iC *= ( 1.0 + iD * length ( iA . xy ) ) ; } gl_Position = vec4 ( iA . xy + iC , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:["uniform","samplerCube","u_sky",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 jP ; void main ( ) { vec3 iz = textureCube ( u_sky , jP ) . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"eb ( iz . rgb ) ; float iA = u_camera_eye_frag . y - WATER_LEVEL ; iA = min ( - iA * 0.03 , 0.8 ) ; float iB = length ( u_sun_intensity ) + u_environment_energy ; vec3 iC = normalize ( jP ) ; vec3 iD = vec3 ( 0.0 ) ; vec4 iE = u_underwater_fog_color_density ; iE . rgb = mix ( iE . rgb , iD , min ( - iC . y + iA , 1.0 ) ) * iB ; float iF = clamp ( sign ( iC . y - 0.05 * iA ) , 0.0 , 1.0 ) ; iz = mix ( iE . rgb , iz , iF ) ; ed ( iz . rgb ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( iz , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 jP ; void main ( ) { vec4 iz = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 iA = u_sky_vp_inverse * iz ; jP = iA . xyz ; gl_Position = iz ; }".split(" ")}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",
name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0001"]},{type:"textline",b:"uniform float u_time ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ; uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ; uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_depth",";"]}]}},{type:"elif",c:["ALPHA_MAP"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_alphamap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec2 u_specular_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap0_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap1_uv_velocity ; uniform vec2 u_normalmap1_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap2_uv_velocity ; uniform vec2 u_normalmap2_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap3_uv_velocity ; uniform vec2 u_normalmap3_scale ;".split(" ")}]}}]}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ; uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 hZ ; varying vec3 h_ ;".split(" ")},{type:"condition",a:[{type:"if",
c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ia",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 ib ; varying vec3 jQ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jR",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jS",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ct",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","jT",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["REFRACTIVE","&&","SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float jZ ( in float jU , inout vec2 jV , in vec2 jW ) { vec4 jX = texture2D ( u_shore_depth , jV ) ; float jY = cn ( jX ) ; if ( jY < jT ) { jV = jW ; return jU ; } else { return jY ; } }".split(" ")}]}}]},{type:"textline",b:"vec3 kn ( in vec2 j_ , in vec3 ka , in vec3 kb , in vec3 kc , out float kd ) { vec3 ke = reflect ( - kb , ka ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",
a:[{type:"textline",b:"vec2 kf = j_ . xy + ka . xz * REFL_BUMP / jT ; kd = u_reflect_factor ; vec3 kg ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"kg = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kg = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"float kh = dot ( kb , ka ) ; kd *= max ( 1.0 - 1.0 / kh , 1.0 ) ; } else { kg = texture2D ( u_reflectmap , kf ) . rgb ; eb ( kg ) ; }".split(" ")}]}},
{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"kd = u_mirror_factor ; vec3 kg = kc * textureCube ( u_mirrormap , ke ) . rgb ; eb ( kg ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kd = 1.0 ; vec3 kg = kc * vec3 ( 0.3 , 0.5 , 1.0 ) ; eb ( kg ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 ki = normalize ( ke + kb ) ; float kj = 1.0 - dot ( kb , ki ) ; float kk = u_fresnel_params [ 3 ] ; float kl = u_fresnel_params [ 2 ] ; float km = kk + ( 1.0 - kk ) * pow ( kj , kl ) ; kd = min ( kd * km , 1.0 ) ; return kg ; } void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 ko = mat3 ( ib , jQ , ia ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 kp = normalize ( ia ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 ko = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 kp = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"DYNAMIC && ( REFLECTIVE || FOAM || ( WATER_EFFECTS && ! DISABLE_FOG ) ) || GENERATED_MESH".split(" "),group:{type:"group",a:[{type:"textline",b:"float kq = h_ . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec2 kr = vec2 ( jR . x , - jR . z ) + 0.5 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec2 kr = vec2 ( h_ . x , - h_ . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","kr","=","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 ks = vec3 ( 0.0 ) ; vec3 kt = texture2D ( u_normalmap0 , kr * u_normalmap0_scale + u_normalmap0_uv_velocity * u_time ) . xyz - 0.5 ; ks += kt ;".split(" ")},{type:"condition",a:[{type:"if",
c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 ku = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["ku","+=","kt",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"kt = texture2D ( u_normalmap0 , kr * u_normalmap1_scale + u_normalmap1_uv_velocity * u_time ) . xyz - 0.5 ; ks += kt ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["ku","+=","kt",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"kt = texture2D ( u_normalmap0 , kr * u_normalmap2_scale + u_normalmap2_uv_velocity * u_time ) . xyz - 0.5 ; ks += kt ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",
a:[{type:"textline",b:["ku","+=","kt",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"kt = texture2D ( u_normalmap0 , kr * u_normalmap3_scale + u_normalmap3_uv_velocity * u_time ) . xyz - 0.5 ; ks += kt ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["ku","+=","kt",";"]}]}}]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 kv = ko * ku ; if ( ! h ( kv , vec3 ( 0.0 ) ) ) kv = normalize ( kv ) ; vec3 kw = mix ( kp , kv , 0.2 ) ; kw = normalize ( kw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"kp = mix ( kp , normalize ( ko * ks ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"kp = mix ( kp , normalize ( ko * ks ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"kp = normalize ( kp ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 kx = normalize ( hZ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 ky = ct . xy / ct . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float kz = jT * u_view_max_depth ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float kA = u_diffuse_color . a ; vec4 kB = texture2DProj ( u_shore_depth , ct ) ; float kC = cn ( kB ) ; float kD = max ( kC - jT , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 kE = ky + kp . xz * REFR_BUMP / jT ; float kF = jZ ( kC , kE , ky ) ; float kG = max ( kF - jT , 0.0 ) ; float kH = u_view_max_depth / ABSORB * kG ; float kI ; if ( u_cam_water_depth < 0.0 ) kI = 0.0 ; else kI = min ( kA * kH , 1.0 ) ; float kJ = u_view_max_depth / ABSORB * kD ; kA = min ( 15.0 * kA * u_view_max_depth * kD , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float kJ = u_view_max_depth / ABSORB * kD ; if ( u_cam_water_depth > 0.0 ) kA = min ( kA * kJ , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"kA *= min ( 5.0 * kz , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_MAP"],group:{type:"group",a:[{type:"textline",b:"vec4 kK = texture2D ( u_alphamap , kr ) ; float kA = kK . r ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"float kA = u_diffuse_color . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float kI = 1.0 - kA ; vec2 kE = ky + kp . xz * REFR_BUMP / jT ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 kL = texture2D ( u_refractmap , kE ) . rgb ; eb ( kL ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float kM = pow ( min ( jS . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 kN = mix ( u_shallow_water_col , u_diffuse_color . rgb , kM ) ; kM = pow ( min ( jS . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; kN = mix ( u_shore_water_col , kN , kM ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 kN = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float kO = max ( 1.0 - u_view_max_depth * kD , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float kO = 1.0 - kA ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:"float kP = max ( 3.0 * kq , 0.0 ) ; kP *= kP ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 kQ = normalize ( vec3 ( jS . r , 0.0 , jS . g ) ) ; vec3 kR = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , kQ , 0.8 ) ) ; float kS = max ( 2.5 * dot ( kw , kR ) - 0.7 , 0.0 ) ; kO += kS * ( 1.0 - jS . b ) ; kP *= ( 1.0 - 0.95 * pow ( jS . b , 0.1 ) ) ;".split(" ")}]}}]},{type:"textline",b:"kO += kP ; kO = min ( u_foam_factor * kO , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"vec4 kT = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + kr * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"float kU = u_specular_params [ 0 ] ; float kV = u_specular_params [ 1 ] ; vec3 kW = kU * u_specular_color ; vec3 kX = u_environment_energy * u_zenith_color ; vec3 kY = u_ambient * kX ; vec3 kZ = kY + u_sun_intensity ; float k_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 la = kn ( ky , kp , kx , kZ , k_ ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 la = kn ( vec2 ( 0.0 ) , kp , kx , kZ , k_ ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lb = u_diffuse_intensity * kN ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS","&&","DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float lc = max ( dot ( u_sun_direction , - ia ) + SSS_WIDTH , 0.0 ) * max ( dot ( - kx , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; lc = clamp ( SSS_STRENGTH * lc , 0.0 , 1.0 ) ; lb = mix ( lb , u_shallow_water_col , lc ) ; lb = mix ( lb , u_shore_water_col , lc ) ;".split(" ")}]}}]},
{type:"textline",b:"eW ld = gz ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , lb , kW , h_ , kp , kx , kV , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ; lb = ld . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lb = mix ( kL , lb , kI ) ;".split(" ")}]}}]},{type:"textline",b:"lb = mix ( lb , la , k_ ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"float le = mix ( kT . g , kT . r , clamp ( 4.0 * ( kO - 0.75 ) , 0.0 , 1.0 ) ) ; le = mix ( kT . b , le , clamp ( 2.0 * kO - 1.0 , 0.0 , 1.0 ) ) ; le = mix ( 0.0 , le , kO ) ; lb = mix ( lb , kZ , le ) ;".split(" ")}]}}]},{type:"textline",b:"lb += ld . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 lf = ev ( u_cube_fog , kx ) ; vec4 lg = vec4 ( lf , u_fog_color_density . a ) ; eb ( lg . rgb ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","lg","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { eV ( lb , kz , u_cam_water_depth , u_underwater_fog_color_density , length ( u_sun_intensity ) + u_environment_energy ) ; } else { eo ( lb , kz , lg ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"eo ( lb , kz , lg ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["ed","(","lb",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kA = max ( kA , ld . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["kA","+=","le",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"eg ( lb , kA ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lb , kA ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",
b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Z",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Z",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_cascad_step",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",
a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 hZ ; varying vec3 h_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",
b:["varying","vec3","ia",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 ib ; varying vec3 jQ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jR",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jS",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING",
"||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ct",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","jT",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 iF ( in vec2 iz ) { vec2 iA = vec2 ( ( iz . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( SHORE_MAP_CENTER_Z + iz . y ) / SHORE_MAP_SIZE_Z ) + 0.5 ; iA = clamp ( iA , 0.0 , 1.0 ) ; vec4 iB = texture2D ( u_shore_dist_map , iA ) ; const vec2 iC = vec2 ( 1.0 / 255.0 , 1.0 ) ; float iD = dot ( iB . ba , iC ) ; vec2 iE = normalize ( iB . rg * 2.0 - 1.0 ) ; return vec3 ( iE , iD ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"void iT ( inout vec3 iG , in float iH , in vec3 iI ) { float iJ = hx ( DST_NOISE_SCALE_0 * ( iG . xz + DST_NOISE_FREQ_0 * iH ) ) * hx ( DST_NOISE_SCALE_1 * ( iG . zx - DST_NOISE_FREQ_1 * iH ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float iK = iI . b ; float iL = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float iM = sqrt ( iK ) ; float iN = max ( iK , DIR_MIN_SHR_FAC ) * ( sin ( ( iM / iL + DIR_FREQ * iH ) ) ) * max ( hx ( DIR_NOISE_SCALE * ( iG . xz + DIR_NOISE_FREQ * iH ) ) , DIR_MIN_NOISE_FAC ) ; float iO = WAVES_HEIGHT * mix ( iN , iJ , max ( iM , DST_MIN_FAC ) ) ; vec2 iP = iI . rg ; float iQ = WAVES_HOR_FAC * iN * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - iK ) , 0.0 ) ; vec2 iR = iQ * iP ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float iO = WAVES_HEIGHT * iJ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float iS = gT ( 20.0 / WAVES_LENGTH * ( iG . xz - 0.25 * iH ) ) . x + gT ( 17.0 / WAVES_LENGTH * ( iG . zx + 0.1 * iH ) ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"iG . xz += iR ; iS *= iK ;".split(" ")}]}}]},{type:"textline",
b:"iO += 0.05 * iS ;".split(" ")}]}}]},{type:"textline",b:"iG . y += iO ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec3 iU = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float iV = abs ( a_cascad_step ) ; vec2 iW = u_camera_eye . xz - mod ( u_camera_eye . xz , iV ) ; iU . y += WATER_LEVEL ; iU . xz += iW ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},
{type:"textline",b:"b iX = ai ( iU , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"jR = iX . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"jS = iF ( iX . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float iY = length ( u_wind ) ; float jU = u_time ; jU *= iY ;".split(" ")},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["float","jV","=","iV",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","jV","=","0.1",";"]}]}}]},{type:"textline",b:"vec3 jW = iX . a + vec3 ( jV , 0.0 , 0.0 ) ; vec3 jX = iX . a + vec3 ( 0.0 , 0.0 , jV ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 jY = iF ( jW . xz ) ; vec3 jZ = iF ( jX . xz ) ; iT ( jW , jU , jY ) ; iT ( jX , jU , jZ ) ; iT ( iX . a , jU , jS ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"iT ( jW , jU , vec3 ( 0.0 ) ) ; iT ( jX , jU , vec3 ( 0.0 ) ) ; iT ( iX . a , jU , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_cascad_step < 0.0 ) { jW . y = iX . a . y ; jX . y = iX . a . y ; }".split(" ")}]}}]},{type:"textline",b:"vec3 j_ = normalize ( jW - iX . a ) ; vec3 ka = normalize ( jX - iX . a ) ; ia = normalize ( cross ( ka , j_ ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"ib = ka ; jQ = cross ( ia , ib ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float kb = dot ( ia , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float kc = clamp ( 0.8 - kb , 0.0 , 1.0 ) ; ia = mix ( ia , vec3 ( 0.0 , 1.0 , 0.0 ) , kc ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"h_ = iX . a ; hZ = u_camera_eye - iX . a ; vec4 kd = u_view_matrix * vec4 ( iX . a , 1.0 ) ; vec4 ke = u_proj_matrix * kd ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float kf = ke . x ; float kg = ke . y ; float kh = ke . w ; ct . x = ( kf + kh ) / 2.0 ; ct . y = ( kg + kh ) / 2.0 ; ct . z = kh ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"jT = - kd . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["gl_Position","=","ke",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 jU ; const float jV = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 jW = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 jW = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 jX = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 jY = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 jZ = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec3 j_ = vec3 ( 0.0 ) ; float ka = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"vec3 kb = sign ( jU - vec3 ( 0.02 * jV ) ) ; if ( kb . x < 0.0 || kb . y < 0.0 || kb . z < 0.0 ) { j_ = jW ; ka = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"vec3 kb = sign ( jU - vec3 ( 0.02 * jV ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( kb . x < 0.0 || kb . y < 0.0 || kb . z < 0.0 ) j_ = u_wireframe_edge_color ; else j_ = jZ ; ka = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( kb . x < 0.0 || kb . y < 0.0 || kb . z < 0.0 ) ka = 1.0 ; else ka = 0.0 ; j_ = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( kb . x < 0.0 || kb . y < 0.0 || kb . z < 0.0 ) j_ = u_wireframe_edge_color ; else if ( gl_FrontFacing ) j_ = jX ; else j_ = jY ; ka = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 kc = fwidth ( jU ) ; vec3 kd = smoothstep ( vec3 ( 0.0 ) , kc * jV , jU ) ; float ke = min ( min ( kd . x , kd . y ) , kd . z ) ; ke = clamp ( ke , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { j_ = vec3 ( mix ( u_wireframe_edge_color , jZ , ke ) ) ; ka = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { j_ = u_wireframe_edge_color ; ka = mix ( 1.0 , 0.0 , ke ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) j_ = mix ( u_wireframe_edge_color , jX , ke ) ; else j_ = mix ( u_wireframe_edge_color , jY , ke ) ; ka = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["ed","(","j_",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"eg ( j_ , ka ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( j_ , ka ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||",
"HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",
b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",b:["varying","vec3","jU",";"]},{type:"condition",
a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { if ( a_polyindex == 0.0 ) jU = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) jU = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) jU = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 iz = a_position ; vec3 iA = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],
group:{type:"group",a:[{type:"textline",b:"b iB = ai ( iz , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"iz = mix ( iz , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 iC = vec3 ( 0.0 ) ; vec3 iD = vec3 ( 0.0 ) ; bn ( iz , iC , iD , iA ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","iE","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 iE = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"b iB = dT ( iz , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , iE , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 iF = ( u_model_matrix * vec4 ( iE , 1.0 ) ) . xyz ; mat4 iG = ab ( u_camera_eye , iF , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 iH = ( u_model_matrix * vec4 ( iE , 1.0 ) ) . xyz ; iG = iG * R ( u_wind , u_time , u_jitter_amp , u_jitter_freq , iH ) ;".split(" ")}]}}]},
{type:"textline",b:"b iB = ai ( iz - iE , iE , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , iG ) ; iB . b = iF ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"b iB = ai ( iz , iE , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ce ( iB . a , iB . b , iA ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 iI = u_view_matrix * vec4 ( iB . a , 1.0 ) ; gl_Position = u_proj_matrix * iI ; }".split(" ")}]};
a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 iz = texture2D ( u_sampler_left , a ) ; vec4 iA = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( iz [ 0 ] , iA [ 1 ] , iA [ 2 ] , iz [ 3 ] + iA [ 3 ] ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 iC ( float iz , float iA ) { vec2 iB = a + vec2 ( iz , iA ) * u_texel_size ; return texture2D ( u_color , iB ) ; } float iG ( vec4 iD ) { vec3 iE = vec3 ( 0.299 , 0.587 , 0.114 ) ; float iF = dot ( iD . rgb , iE ) ; return iF ; } vec4 jV ( ) { vec4 iH = iC ( - 1.0 , - 1.0 ) ; vec4 iI = iC ( 1.0 , - 1.0 ) ; vec4 iJ = iC ( - 1.0 , 1.0 ) ; vec4 iK = iC ( 1.0 , 1.0 ) ; vec4 iL = iC ( 0.0 , 0.0 ) ; float iM = iG ( iH ) ; float iN = iG ( iI ) ; float iO = iG ( iJ ) ; float iP = iG ( iK ) ; float iQ = iG ( iL ) ; float iR = min ( iQ , min ( min ( iM , iN ) , min ( iO , iP ) ) ) ; float iS = max ( iQ , max ( max ( iM , iN ) , max ( iO , iP ) ) ) ; vec2 iT ; iT . x = - ( ( iM + iN ) - ( iO + iP ) ) ; iT . y = ( ( iM + iO ) - ( iN + iP ) ) ; float iU = max ( ( iM + iN + iO + iP ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float iV = 1.0 / ( min ( abs ( iT . x ) , abs ( iT . y ) ) + iU ) ; iT = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , iT * iV ) ) * u_texel_size ; vec4 iW = 0.5 * ( texture2D ( u_color , a + iT * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + iT * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 iX = iW * 0.5 + 0.25 * ( texture2D ( u_color , a + iT * - 0.5 ) + texture2D ( u_color , a + iT * 0.5 ) ) ; float iY = iG ( iX ) ; if ( ( iY < iR ) || ( iY > iS ) ) return iW ; else return iX ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 lG ( ) { vec2 jW ; jW . x = a . x ; jW . y = a . y ; vec4 jX = texture2D ( u_color , jW ) ; vec4 jY = iC ( 0.0 , 1.0 ) ; vec4 jZ = iC ( 1.0 , 0.0 ) ; vec4 j_ = iC ( 0.0 , - 1.0 ) ; vec4 ka = iC ( - 1.0 , 0.0 ) ; float kb = iG ( jY ) ; float kc = iG ( jZ ) ; float kd = iG ( j_ ) ; float ke = iG ( ka ) ; float kf = iG ( jX ) ; float kg = max ( kb , kf ) ; float kh = min ( kb , kf ) ; float ki = max ( kc , kg ) ; float kj = min ( kc , kh ) ; float kk = max ( kd , ke ) ; float kl = min ( kd , ke ) ; float km = max ( kk , ki ) ; float kn = min ( kl , kj ) ; float ko = km * FXAA_QUALITY_EDGE_THRESHOLD ; float kp = km - kn ; float kq = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , ko ) ; bool kr = kp < kq ; if ( kr ) return jX ; vec4 ks = iC ( - 1.0 , - 1.0 ) ; vec4 kt = iC ( 1.0 , 1.0 ) ; vec4 ku = iC ( 1.0 , - 1.0 ) ; vec4 kv = iC ( - 1.0 , 1.0 ) ; float kw = iG ( ks ) ; float kx = iG ( kt ) ; float ky = iG ( ku ) ; float kz = iG ( kv ) ; float kA = kd + kb ; float kB = ke + kc ; float kC = 1.0 / kp ; float kD = kA + kB ; float kE = ( - 2.0 * kf ) + kA ; float kF = ( - 2.0 * kf ) + kB ; float kG = ky + kx ; float kH = kw + ky ; float kI = ( - 2.0 * kc ) + kG ; float kJ = ( - 2.0 * kd ) + kH ; float kK = kw + kz ; float kL = kz + kx ; float kM = ( abs ( kE ) * 2.0 ) + abs ( kI ) ; float kN = ( abs ( kF ) * 2.0 ) + abs ( kJ ) ; float kO = ( - 2.0 * ke ) + kK ; float kP = ( - 2.0 * kb ) + kL ; float kQ = abs ( kO ) + kM ; float kR = abs ( kP ) + kN ; float kS = kK + kG ; float kT = u_texel_size . x ; bool kU = kQ >= kR ; float kV = kD * 2.0 + kS ; if ( ! kU ) kd = ke ; if ( ! kU ) kb = kc ; if ( kU ) kT = u_texel_size . y ; float kW = ( kV * ( 1.0 / 12.0 ) ) - kf ; float kX = kd - kf ; float kY = kb - kf ; float kZ = kd + kf ; float k_ = kb + kf ; bool la = abs ( kX ) >= abs ( kY ) ; float lb = max ( abs ( kX ) , abs ( kY ) ) ; if ( la ) kT = - kT ; float lc = clamp ( abs ( kW ) * kC , 0.0 , 1.0 ) ; vec2 ld ; ld . x = jW . x ; ld . y = jW . y ; vec2 le ; le . x = ( ! kU ) ? 0.0 : u_texel_size . x ; le . y = ( kU ) ? 0.0 : u_texel_size . y ; if ( ! kU ) ld . x += kT * 0.5 ; if ( kU ) ld . y += kT * 0.5 ; vec2 lf ; lf . x = ld . x - le . x ; lf . y = ld . y - le . y ; vec2 lg ; lg . x = ld . x + le . x ; lg . y = ld . y + le . y ; float lh = ( ( - 2.0 ) * lc ) + 3.0 ; float li = iG ( texture2D ( u_color , lf ) ) ; float lj = lc * lc ; float lk = iG ( texture2D ( u_color , lg ) ) ; if ( ! la ) kZ = k_ ; float ll = lb * 1.0 / 4.0 ; float lm = kf - kZ * 0.5 ; float ln = lh * lj ; bool lo = lm < 0.0 ; li -= kZ * 0.5 ; lk -= kZ * 0.5 ; bool lp = abs ( li ) >= ll ; bool lq = abs ( lk ) >= ll ; if ( ! lp ) lf . x -= le . x * 1.5 ; if ( ! lp ) lf . y -= le . y * 1.5 ; bool lr = ( ! lp ) || ( ! lq ) ; if ( ! lq ) lg . x += le . x * 1.5 ; if ( ! lq ) lg . y += le . y * 1.5 ; if ( lr ) { if ( ! lp ) li = iG ( texture2D ( u_color , lf . xy ) ) ; if ( ! lq ) lk = iG ( texture2D ( u_color , lg . xy ) ) ; if ( ! lp ) li = li - kZ * 0.5 ; if ( ! lq ) lk = lk - kZ * 0.5 ; lp = abs ( li ) >= ll ; lq = abs ( lk ) >= ll ; if ( ! lp ) lf . x -= le . x * 2.0 ; if ( ! lp ) lf . y -= le . y * 2.0 ; lr = ( ! lp ) || ( ! lq ) ; if ( ! lq ) lg . x += le . x * 2.0 ; if ( ! lq ) lg . y += le . y * 2.0 ; if ( lr ) { if ( ! lp ) li = iG ( texture2D ( u_color , lf . xy ) ) ; if ( ! lq ) lk = iG ( texture2D ( u_color , lg . xy ) ) ; if ( ! lp ) li = li - kZ * 0.5 ; if ( ! lq ) lk = lk - kZ * 0.5 ; lp = abs ( li ) >= ll ; lq = abs ( lk ) >= ll ; if ( ! lp ) lf . x -= le . x * 2.0 ; if ( ! lp ) lf . y -= le . y * 2.0 ; lr = ( ! lp ) || ( ! lq ) ; if ( ! lq ) lg . x += le . x * 2.0 ; if ( ! lq ) lg . y += le . y * 2.0 ; if ( lr ) { if ( ! lp ) li = iG ( texture2D ( u_color , lf . xy ) ) ; if ( ! lq ) lk = iG ( texture2D ( u_color , lg . xy ) ) ; if ( ! lp ) li = li - kZ * 0.5 ; if ( ! lq ) lk = lk - kZ * 0.5 ; lp = abs ( li ) >= ll ; lq = abs ( lk ) >= ll ; if ( ! lp ) lf . x -= le . x * 4.0 ; if ( ! lp ) lf . y -= le . y * 4.0 ; lr = ( ! lp ) || ( ! lq ) ; if ( ! lq ) lg . x += le . x * 4.0 ; if ( ! lq ) lg . y += le . y * 4.0 ; if ( lr ) { if ( ! lp ) li = iG ( texture2D ( u_color , lf . xy ) ) ; if ( ! lq ) lk = iG ( texture2D ( u_color , lg . xy ) ) ; if ( ! lp ) li = li - kZ * 0.5 ; if ( ! lq ) lk = lk - kZ * 0.5 ; lp = abs ( li ) >= ll ; lq = abs ( lk ) >= ll ; if ( ! lp ) lf . x -= le . x * 2.0 ; if ( ! lp ) lf . y -= le . y * 2.0 ; if ( ! lq ) lg . x += le . x * 2.0 ; if ( ! lq ) lg . y += le . y * 2.0 ; } } } } float ls = jW . x - lf . x ; float lt = lg . x - jW . x ; if ( ! kU ) ls = jW . y - lf . y ; if ( ! kU ) lt = lg . y - jW . y ; bool lu = ( li < 0.0 ) != lo ; float lv = ( lt + ls ) ; bool lw = ( lk < 0.0 ) != lo ; float lx = 1.0 / lv ; bool ly = ls < lt ; float lz = min ( ls , lt ) ; bool lA = ly ? lu : lw ; float lB = ln * ln ; float lC = ( lz * ( - lx ) ) + 0.5 ; float lD = lB * FXAA_QUALITY_SUBPIX ; float lE = lA ? lC : 0.0 ; float lF = max ( lE , lD ) ; if ( ! kU ) jW . x += lF * kT ; if ( kU ) jW . y += lF * kT ; return texture2D ( u_color , jW ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = jV ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = lG ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 iz = vec2 ( 0.0 , 0.0 ) ; vec2 iA = u_texel_size ; vec4 iB = texture2D ( u_color , a ) ; gl_FragColor = iB * 0.0875447373698 ; iz += iA ; gl_FragColor += texture2D ( u_color , a + iz ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - iz ) * 0.0858112354248 ; iz += iA ; gl_FragColor += texture2D ( u_color , a + iz ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - iz ) * 0.0808139781061 ; iz += iA ; gl_FragColor += texture2D ( u_color , a + iz ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - iz ) * 0.0731235112908 ; iz += iA ; gl_FragColor += texture2D ( u_color , a + iz ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - iz ) * 0.0635705267419 ; iz += iA ; gl_FragColor += texture2D ( u_color , a + iz ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - iz ) * 0.0530985673112 ; iz += iA ; gl_FragColor += texture2D ( u_color , a + iz ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - iz ) * 0.0426125984122 ; iz += iA ; gl_FragColor += texture2D ( u_color , a + iz ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - iz ) * 0.0328565115809 ; iz += iA ; gl_FragColor += texture2D ( u_color , a + iz ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - iz ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * iB , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 iz = texture2D ( u_main , a ) ; vec4 iA = texture2D ( u_bloom , a ) ; vec4 iB = iz ; iB += iA ; gl_FragColor = vec4 ( iB . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/blur_depth.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},
{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform vec2 u_texel_size ; uniform vec2 u_camera_range ; uniform float u_blur_depth_edge_size ; uniform float u_blur_depth_diff_threshold ; varying vec2 a ; float kd ( in vec2 kc ) { return kb ( u_depth , kc , u_camera_range ) ; } void main ( ) { vec2 ke = u_texel_size ; vec4 kf = texture2D ( u_color , a ) ; float kg = kd ( a ) ; float kh = kd ( a + u_blur_depth_edge_size * ke ) ; float ki = kd ( a - u_blur_depth_edge_size * ke ) ; float kj = abs ( kg - kh ) ; float kk = abs ( kg - ki ) ; float kl = max ( kj , kk ) ; if ( kl > u_blur_depth_diff_threshold ) { gl_FragColor = kf ; return ; } vec2 km = vec2 ( 0.0 , 0.0 ) ; gl_FragColor = kf * 0.2270270270 ; km += ke ; gl_FragColor += texture2D ( u_color , a + km ) * 0.1945945946 , gl_FragColor += texture2D ( u_color , a - km ) * 0.1945945946 , km += ke ; gl_FragColor += texture2D ( u_color , a + km ) * 0.1216216216 , gl_FragColor += texture2D ( u_color , a - km ) * 0.1216216216 , km += ke ; gl_FragColor += texture2D ( u_color , a + km ) * 0.0540540541 , gl_FragColor += texture2D ( u_color , a - km ) * 0.0540540541 , km += ke ; gl_FragColor += texture2D ( u_color , a + km ) * 0.0162162162 ; gl_FragColor += texture2D ( u_color , a - km ) * 0.0162162162 ; }".split(" ")}]};
a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { vec4 iz = texture2D ( u_color , a ) ; vec3 iA = iz . rgb ; if ( u_brightness < 0.0 ) iA = iA * ( 1.0 + u_brightness ) ; else iA = iA + ( ( 1.0 - iA ) * u_brightness ) ; iA = ( iA - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; iA *= u_exposure ; vec3 iB = vec3 ( 0.299 , 0.587 , 0.114 ) ; float iC = dot ( iA , iB ) ; iA = mix ( vec3 ( iC ) , iA , u_saturation ) ; gl_FragColor = vec4 ( iA , iz . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cj ( clamp ( kb ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { vec4 kc = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { float kd = kb ( u_depth , a , u_camera_range ) ; kd *= u_view_max_depth ; float ke ; if ( kd < u_dof_dist ) ke = ( u_dof_dist - kd ) / u_dof_front ; else ke = ( kd - u_dof_dist ) / u_dof_rear ; ke = clamp ( ke , 0.0 , 1.0 ) ; vec4 kf = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( kc , kf , ke ) ; } else gl_FragColor = kc ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float iE ( float iz , float iA , float iB ) { vec2 iC = a + vec2 ( iz , iA ) * u_texel_size ; vec4 iD = texture2D ( u_sampler , iC ) * iB ; return cn ( iD ) ; } void main ( ) { float iF = ( iE ( - 1.0 , - 1.0 , - 1.0 ) + iE ( 0.0 , - 1.0 , - 1.0 ) + iE ( 1.0 , - 1.0 , - 1.0 ) + iE ( - 1.0 , 0.0 , - 1.0 ) + iE ( 0.0 , 0.0 , 8.0 ) + iE ( 1.0 , 0.0 , - 1.0 ) + iE ( - 1.0 , 1.0 , - 1.0 ) + iE ( 0.0 , 1.0 , - 1.0 ) + iE ( 1.0 , 1.0 , - 1.0 ) ) ; iF *= 1000.0 ; gl_FragColor = vec4 ( iF , iF , iF , 1.0 ) ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_glow_src ; uniform sampler2D u_glow_mask ; uniform sampler2D u_glow_mask_blurred ; uniform vec3 u_glow_color ; uniform float u_draw_glow ; varying vec2 a ; void main ( ) { vec4 iz = texture2D ( u_glow_src , a ) ; gl_FragColor = iz ; if ( u_draw_glow != 0.0 ) { vec4 iA = texture2D ( u_glow_mask , a ) ; vec4 iB = texture2D ( u_glow_mask_blurred , a ) ; float iC = iB . a - iA . a ; if ( iC != 0.0 ) { float iD = smoothstep ( 0.0 , 1.0 , iB . a ) ; if ( iA . a == 0.0 ) { vec3 iE = u_glow_color ; ed ( iE ) ; vec4 iF = vec4 ( clamp ( iE , 0.0 , 1.0 ) , iD ) ; gl_FragColor = mix ( iz , iF , iD ) ; } } } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform vec3 u_sun_intensity ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float kc ; varying vec2 kd ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 ke ; void main ( ) { vec3 kf = u_sun_intensity ; vec2 kg = ( ke . xy - a ) ; float kh = length ( kg ) ; vec2 ki = u_radial_blur_step * kg / kh ; float kj = kh / u_radial_blur_step ; ki *= min ( kj , STEPS_PER_PASS ) / STEPS_PER_PASS ; kj = max ( kj , STEPS_PER_PASS ) ; vec2 kk = a ; float kl = 0.0 ; for ( float km = 0.0 ; km < STEPS_PER_PASS ; km += 1.0 ) { if ( km <= kj ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"float kn = kb ( u_input , kk , u_camera_range ) ; kl += ( 1.0 - pow ( kh , 0.3 ) ) * step ( 0.9 , kn ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kl += texture2D ( u_input , kk ) . r ;".split(" ")}]}}]},{type:"textline",b:"} kk += ki ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"vec2 ko = a + kd ; float kp = gT ( vec2 ( 2.5 * ( ko . x ) , 2.5 * ( ko . y ) + 1.0 * u_time ) ) . x + 0.75 * gT ( vec2 ( 5.0 * ( ko . x ) - 0.66 * u_time , 5.0 * ( ko . y ) + 0.66 * u_time ) ) . x + 0.5 * hx ( vec2 ( 7.5 * ( ko . x ) + 0.33 * u_time , 7.5 * ( ko . y ) - 0.33 * u_time ) ) ; kp *= clamp ( 1.2 - sqrt ( 0.2 * kh ) , 0.0 , 1.0 ) * kc ; kl = max ( kp , kl ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( kl / STEPS_PER_PASS * clamp ( kf , 0.4 , 0.8 ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]={type:"group",a:[{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform vec4 u_refl_plane ; varying float kc ; varying vec2 kd ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 ke ; void iG ( in vec4 iz , in vec3 iA , out vec3 iB ) { float iC = iz . w * iA . x + iz . y * iA . z - iz . z * iA . y ; float iD = iz . w * iA . y + iz . z * iA . x - iz . x * iA . z ; float iE = iz . w * iA . z + iz . x * iA . y - iz . y * iA . x ; float iF = - iz . x * iA . x - iz . y * iA . y - iz . z * iA . z ; iB . x = iC * iz . w - iF * iz . x - iD * iz . z + iE * iz . y ; iB . y = iD * iz . w - iF * iz . y - iE * iz . x + iC * iz . z ; iB . z = iE * iz . w - iF * iz . z - iC * iz . y + iD * iz . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 iH = normalize ( u_sun_direction ) ; ke = u_proj_matrix * u_view_matrix * vec4 ( iH , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_camera_eye . y + a_bb_vertex . t < - u_refl_plane . w ) { kc = 1.0 ; vec3 iI = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 iJ ; iG ( u_camera_quat , iI , iJ ) ; iJ = normalize ( iJ ) ; float iK = dot ( iJ , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float iL = atan ( iJ . x , iJ . z ) ; kd = vec2 ( - iL , acos ( iK ) ) ; } else { kc = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"ke . x /= ke . w ; ke . y /= ke . w ; ke . x = 0.5 * ( ke . x + 1.0 ) ; ke . y = 0.5 * ( ke . y + 1.0 ) ; ke += 99999.0 * step ( ke . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; varying vec2 a ; void main ( ) { vec4 iz = texture2D ( u_main , a ) ; eb ( iz . rgb ) ; vec3 iA = iz . rgb + u_god_rays_intensity * ( texture2D ( u_god_rays , a ) ) . rgb ; ed ( iA ) ; gl_FragColor . rgb = iA ; gl_FragColor . a = iz . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 iz = texture2D ( u_color , a ) * 0.38026 ; iz += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; iz += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; iz += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; iz += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; iz += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; iz += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; iz += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; iz += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = iz ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { vec4 iz = texture2D ( u_input , a ) ; float iA = dot ( iz . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( iA ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float iz ; float iA = 0.0 ; for ( float iB = 0.025 ; iB < 1.0 ; iB += 0.05 ) for ( float iC = 0.025 ; iC < 1.0 ; iC += 0.05 ) { iz = max ( texture2D ( u_input , vec2 ( iB , iC ) ) . r , 0.01 ) ; iA += log ( iz ) ; } float iD = exp ( iA / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( iD ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float kf ; void main ( ) { float kg = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float kh = texture2D ( u_luminance , a ) . r ; vec4 ki = texture2D ( u_main , a ) ; float kj = kh / kg ; float kk = u_bloom_edge_lum ; gl_FragColor = ki * max ( kj - kk , 0.0 ) * kf ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float kf ; const vec3 iz = vec3 ( 0.0 , 1.0 , 0.0 ) ; void iH ( in vec4 iA , in vec3 iB , out vec3 iC ) { float iD = iA . w * iB . x + iA . y * iB . z - iA . z * iB . y ; float iE = iA . w * iB . y + iA . z * iB . x - iA . x * iB . z ; float iF = iA . w * iB . z + iA . x * iB . y - iA . y * iB . x ; float iG = - iA . x * iB . x - iA . y * iB . y - iA . z * iB . z ; iC . x = iD * iA . w - iG * iA . x - iE * iA . z + iF * iA . y ; iC . y = iE * iA . w - iG * iA . y - iF * iA . x + iD * iA . z ; iC . z = iF * iA . w - iG * iA . z - iD * iA . y + iE * iA . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 iI ; iH ( u_camera_quat , iz , iI ) ; kf = dot ( - iI , u_sun_direction ) * u_bloom_key ; kf *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 iz = texture2D ( u_mb_tex_curr , a ) ; vec4 iA = texture2D ( u_mb_tex_accum , a ) ; if ( length ( iz - iA ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * iz + u_motion_blur_exp * iA ; } else { gl_FragColor = iz ; } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"vec4 iz = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( iz . r + iz . g + iz . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 iA = vec2 ( 0.0 , 0.0 ) ; vec2 iB = u_texel_size ; vec4 iC ; iC = texture2D ( u_color , a ) ; gl_FragColor = iC * 0.2270270270 ; iA += iB ; iC = texture2D ( u_color , a + iA ) ; gl_FragColor += iC * 0.1945945946 ; iC = texture2D ( u_color , a - iA ) ; gl_FragColor += iC * 0.1945945946 ; iA += iB ; iC = texture2D ( u_color , a + iA ) ; gl_FragColor += iC * 0.1216216216 ; iC = texture2D ( u_color , a - iA ) ; gl_FragColor += iC * 0.1216216216 ; iA += iB ; iC = texture2D ( u_color , a + iA ) ; gl_FragColor += iC * 0.0540540541 ; iC = texture2D ( u_color , a - iA ) ; gl_FragColor += iC * 0.0540540541 ; iA += iB ; iC = texture2D ( u_color , a + iA ) ; gl_FragColor += iC * 0.0162162162 ; iC = texture2D ( u_color , a - iA ) ; gl_FragColor += iC * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 iB = u_texel_size ; vec4 iC = texture2D ( u_color , a ) ; gl_FragColor = iC ; if ( iC . a == 0.0 ) { iC = texture2D ( u_color , a + iB ) ; if ( iC . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , iC . a ) ; else { iC = texture2D ( u_color , a - iB ) ; if ( iC . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , iC . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; varying vec2 a ; void main ( ) { a = a_bb_vertex + 0.5 ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",
b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kg",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 kg [ 3 ] ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","kh",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD",
"==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",
name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",
b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",
group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",
b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",
b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"textline",b:"vec3 ko ( vec2 ki , vec4 kj [ 3 ] , sampler2D kk ) { float kl = texture2D ( kk , ki ) . r ; float km = texture2D ( kk , kj [ 0 ] . xy ) . r ; float kn = texture2D ( kk , kj [ 0 ] . zw ) . r ; return vec3 ( kl , km , kn ) ; } vec2 kv ( vec2 kp , vec4 kq [ 3 ] , sampler2D kr ) { vec3 ks = ko ( kp , kq , kr ) ; vec2 kt = abs ( ks . xx - ks . yz ) ; vec2 ku = step ( SMAA_PREDICATION_THRESHOLD , kt ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * ku ) ; } void kz ( bvec2 kw , inout vec2 kx , vec2 ky ) { if ( kw . x ) kx . x = ky . x ; if ( kw . y ) kx . y = ky . y ; } void kz ( bvec4 kA , inout vec4 kB , vec4 kC ) { kz ( kA . xy , kB . xy , kC . xy ) ; kz ( kA . zw , kB . zw , kC . zw ) ; } vec2 kE ( vec2 kD ) { return sign ( kD ) * floor ( abs ( kD ) + .5 ) ; } vec4 kE ( vec4 kF ) { return sign ( kF ) * floor ( abs ( kF ) + .5 ) ; } vec2 kX ( vec2 kG , vec4 kH [ 3 ] , sampler2D kI".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","kJ"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 kK = kv ( kG , kH , kJ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec2 kK = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 kL = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float kM = dot ( texture2D ( kI , kG ) . rgb , kL ) ; float kN = dot ( texture2D ( kI , kH [ 0 ] . xy ) . rgb , kL ) ; float kO = dot ( texture2D ( kI , kH [ 0 ] . zw ) . rgb , kL ) ; vec4 kP ; kP . xy = abs ( kM - vec2 ( kN , kO ) ) ; vec2 kQ = step ( kK , kP . xy ) ; if ( dot ( kQ , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float kR = dot ( texture2D ( kI , kH [ 1 ] . xy ) . rgb , kL ) ; float kS = dot ( texture2D ( kI , kH [ 1 ] . zw ) . rgb , kL ) ; kP . zw = abs ( kM - vec2 ( kR , kS ) ) ; vec2 kT = max ( kP . xy , kP . zw ) ; float kU = dot ( texture2D ( kI , kH [ 2 ] . xy ) . rgb , kL ) ; float kV = dot ( texture2D ( kI , kH [ 2 ] . zw ) . rgb , kL ) ; kP . zw = abs ( vec2 ( kN , kO ) - vec2 ( kU , kV ) ) ; kT = max ( kT . xy , kP . zw ) ; float kW = max ( kT . x , kT . y ) ; kQ . xy *= step ( kW , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * kP . xy ) ; return kQ ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 kZ ( vec2 kY ) { kY . r = kY . r * abs ( 5.0 * kY . r - 5.0 * 0.75 ) ; return kE ( kY ) ; } vec4 kZ ( vec4 k_ ) { k_ . rb = k_ . rb * abs ( 5.0 * k_ . rb - 5.0 * 0.75 ) ; return kE ( k_ ) ; } vec2 lh ( sampler2D la , vec2 lb , vec2 lc , out vec2 ld ) { vec4 le = vec4 ( lb , - 1.0 , 1.0 ) ; vec3 lf = vec3 ( u_texel_size , 1.0 ) ; for ( int lg = 0 ; lg < SMAA_MAX_SEARCH_STEPS_DIAG ; lg ++ ) { if ( le . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && le . w > 0.9 ) { le . xyz += lf * vec3 ( lc , 1.0 ) ; ld = texture2D ( la , le . xy , 0.0 ) . rg ; le . w = dot ( ld , vec2 ( 0.5 , 0.5 ) ) ; } } return le . zw ; } vec2 lp ( sampler2D li , vec2 lj , vec2 lk , out vec2 ll ) { vec4 lm = vec4 ( lj , - 1.0 , 1.0 ) ; lm . x += 0.25 * u_texel_size . x ; vec3 ln = vec3 ( u_texel_size , 1.0 ) ; for ( int lo = 0 ; lo < SMAA_MAX_SEARCH_STEPS_DIAG ; lo ++ ) { if ( lm . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && lm . w > 0.9 ) { lm . xyz = ln * vec3 ( lk , 1.0 ) + lm . xyz ; ll = texture2D ( li , lm . xy , 0.0 ) . rg ; ll = kZ ( ll ) ; lm . w = dot ( ll , vec2 ( 0.5 , 0.5 ) ) ; } } return lm . zw ; } vec2 lv ( sampler2D lq , vec2 lr , vec2 ls , float lt ) { vec2 lu = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * ls + lr ; lu = SMAA_AREATEX_PIXEL_SIZE * lu + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; lu . x += 0.5 ; lu . y += SMAA_AREATEX_SUBTEX_SIZE * lt ; return texture2D ( lq , lu , 0.0 ) . rg ; } vec2 lK ( sampler2D lw , sampler2D lx , vec2 ly , vec2 lz , vec4 lA ) { vec2 lB = vec2 ( 0.0 , 0.0 ) ; vec4 lC ; vec2 lD ; if ( lz . r > 0.0 ) { lC . xz = lh ( lw , ly , vec2 ( - 1.0 , 1.0 ) , lD ) ; lC . x += float ( lD . y > 0.9 ) ; } else lC . xz = vec2 ( 0.0 , 0.0 ) ; lC . yw = lh ( lw , ly , vec2 ( 1.0 , - 1.0 ) , lD ) ; if ( lC . x + lC . y > 2.0 ) { vec4 lE = vec4 ( - lC . x + 0.25 , lC . x , lC . y , - lC . y - 0.25 ) * u_texel_size . xyxy + ly . xyxy ; vec4 lF ; lF . xy = texture2D ( lw , lE . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; lF . zw = texture2D ( lw , lE . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; lF . yxwz = kZ ( lF . xyzw ) ; vec2 lG = vec2 ( 2.0 , 2.0 ) * lF . xz + lF . yw ; kz ( bvec2 ( step ( 0.9 , lC . zw ) ) , lG , vec2 ( 0.0 , 0.0 ) ) ; lB += lv ( lx , lC . xy , lG , lA . z ) ; } lC . xz = lp ( lw , ly , vec2 ( - 1 , - 1 ) , lD ) ; if ( texture2D ( lw , ly + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { lC . yw = lp ( lw , ly , vec2 ( 1 , 1 ) , lD ) ; lC . y += float ( lD . y > 0.9 ) ; } else lC . yw = vec2 ( 0.0 , 0.0 ) ; if ( lC . x + lC . y > 2.0 ) { vec4 lH = vec4 ( - lC . x , - lC . x , lC . y , lC . y ) * u_texel_size . xyxy + ly . xyxy ; vec4 lI ; lI . x = texture2D ( lw , lH . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; lI . y = texture2D ( lw , lH . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; lI . zw = texture2D ( lw , lH . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 lJ = vec2 ( 2.0 , 2.0 ) * lI . xz + lI . yw ; kz ( bvec2 ( step ( 0.9 , lC . zw ) ) , lJ , vec2 ( 0 , 0 ) ) ; lB += lv ( lx , lC . xy , lJ , lA . w ) . gr ; } return lB ; }".split(" ")}]}}]},
{type:"textline",b:"float lQ ( sampler2D lL , vec2 lM , float lN ) { vec2 lO = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 lP = SMAA_SEARCHTEX_SIZE * vec2 ( lN , 1.0 ) ; lO += vec2 ( - 1.0 , 1.0 ) ; lP += vec2 ( 0.5 , - 0.5 ) ; lO *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; lP *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( lL , lO * lM + lP , 0.0 ) . r ; } float lY ( sampler2D lR , sampler2D lS , vec2 lT , float lU ) { vec2 lV = vec2 ( 0.0 , 1.0 ) ; for ( int lW = 0 ; lW < SMAA_MAX_SEARCH_STEPS ; lW ++ ) { if ( lT . x > lU && lV . g > 0.8281 && lV . r == 0.0 ) { lV = texture2D ( lR , lT , 0.0 ) . rg ; lT = - vec2 ( 2.0 , 0.0 ) * u_texel_size + lT ; } } float lX = - ( 255.0 / 127.0 ) * lQ ( lS , lV , 0.0 ) + 3.25 ; return u_texel_size . x * lX + lT . x ; } float mf ( sampler2D lZ , sampler2D l_ , vec2 ma , float mb ) { vec2 mc = vec2 ( 0.0 , 1.0 ) ; for ( int md = 0 ; md < SMAA_MAX_SEARCH_STEPS ; md ++ ) { if ( ma . x < mb && mc . g > 0.8281 && mc . r == 0.0 ) { mc = texture2D ( lZ , ma , 0.0 ) . rg ; ma = vec2 ( 2.0 , 0.0 ) * u_texel_size + ma ; } } float me = - ( 255.0 / 127.0 ) * lQ ( l_ , mc , 0.5 ) + 3.25 ; return - u_texel_size . x * me + ma . x ; } float mn ( sampler2D mg , sampler2D mh , vec2 mi , float mj ) { vec2 mk = vec2 ( 1.0 , 0.0 ) ; for ( int ml = 0 ; ml < SMAA_MAX_SEARCH_STEPS ; ml ++ ) { if ( mi . y > mj && mk . r > 0.8281 && mk . g == 0.0 ) { mk = texture2D ( mg , mi , 0.0 ) . rg ; mi = - vec2 ( 0.0 , 2.0 ) * u_texel_size + mi ; } } float mm = - ( 255.0 / 127.0 ) * lQ ( mh , mk . gr , 0.0 ) + 3.25 ; return u_texel_size . y * mm + mi . y ; } float mv ( sampler2D mo , sampler2D mp , vec2 mq , float mr ) { vec2 ms = vec2 ( 1.0 , 0.0 ) ; for ( int mt = 0 ; mt < SMAA_MAX_SEARCH_STEPS ; mt ++ ) { if ( mq . y < mr && ms . r > 0.8281 && ms . g == 0.0 ) { ms = texture2D ( mo , mq , 0.0 ) . rg ; mq = vec2 ( 0.0 , 2.0 ) * u_texel_size + mq ; } } float mu = - ( 255.0 / 127.0 ) * lQ ( mp , ms . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * mu + mq . y ; } vec2 mC ( sampler2D mw , vec2 mx , float my , float mz , float mA ) { vec2 mB = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * kE ( 4.0 * vec2 ( my , mz ) ) + mx ; mB = SMAA_AREATEX_PIXEL_SIZE * mB + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; mB . y = SMAA_AREATEX_SUBTEX_SIZE * mA + mB . y ; return texture2D ( mw , mB , 0.0 ) . rg ; } void mK ( sampler2D mD , inout vec2 mE , vec4 mF , vec2 mG ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 mH = step ( mG . xy , mG . yx ) ; vec2 mI = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * mH ; mI /= mH . x + mH . y ; vec2 mJ = vec2 ( 1.0 , 1.0 ) ; mJ . x -= mI . x * texture2D ( mD , mF . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; mJ . x -= mI . y * texture2D ( mD , mF . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; mJ . y -= mI . x * texture2D ( mD , mF . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; mJ . y -= mI . y * texture2D ( mD , mF . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; mE *= clamp ( mJ , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void mS ( sampler2D mL , inout vec2 mM , vec4 mN , vec2 mO ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 mP = step ( mO . xy , mO . yx ) ; vec2 mQ = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * mP ; mQ /= mP . x + mP . y ; vec2 mR = vec2 ( 1.0 , 1.0 ) ; mR . x -= mQ . x * texture2D ( mL , mN . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; mR . x -= mQ . y * texture2D ( mL , mN . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; mR . y -= mQ . x * texture2D ( mL , mN . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; mR . y -= mQ . y * texture2D ( mL , mN . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; mM *= clamp ( mR , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec4 nl ( vec2 mT , vec2 mU , vec4 mV [ 3 ] , sampler2D mW , sampler2D mX , sampler2D mY , vec4 mZ ) { vec4 m_ = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 na = texture2D ( mW , mT ) . rg ; if ( na . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"m_ . rg = lK ( mW , mX , mT , na , mZ ) ; if ( m_ . r == - m_ . g ) {".split(" ")}]}}]},{type:"textline",b:"vec2 nb ; vec3 nc ; nc . x = lY ( mW , mY , mV [ 0 ] . xy , mV [ 2 ] . x ) ; nc . y = mV [ 1 ] . y ; nb . x = nc . x ; float nd = texture2D ( mW , nc . xy , 0.0 ) . r ; nc . z = mf ( mW , mY , mV [ 0 ] . zw , mV [ 2 ] . y ) ; nb . y = nc . z ; nb = abs ( kE ( nb / u_texel_size . xx - mU . xx ) ) ; vec2 ne = sqrt ( nb ) ; float nf = texture2D ( mW , nc . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; m_ . rg = mC ( mX , ne , nd , nf , mZ . y ) ; nc . y = mT . y ; mK ( mW , m_ . rg , nc . xyzy , nb ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else na . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( na . r > 0.0 ) { vec2 ng ; vec3 nh ; nh . y = mn ( mW , mY , mV [ 1 ] . xy , mV [ 2 ] . z ) ; nh . x = mV [ 0 ] . x ; ng . x = nh . y ; float ni = texture2D ( mW , nh . xy , 0.0 ) . g ; nh . z = mv ( mW , mY , mV [ 1 ] . zw , mV [ 2 ] . w ) ; ng . y = nh . z ; ng = abs ( kE ( ng / u_texel_size . yy - mU . yy ) ) ; vec2 nj = sqrt ( ng ) ; float nk = texture2D ( mW , nh . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; m_ . ba = mC ( mX , nj , ni , nk , mZ . x ) ; nh . x = mT . x ; mS ( mW , m_ . ba , nh . xyxz , ng ) ; } return m_ ; } vec4 nA ( vec2 nm , vec4 nn , sampler2D no , sampler2D np".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","nq"]}]}}]},{type:"textline",b:") { vec4 nr ; nr . x = texture2D ( np , nn . xy ) . a ; nr . y = texture2D ( np , nn . zw ) . g ; nr . wz = texture2D ( np , nm ) . xz ; if ( dot ( nr , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 ns = texture2D ( no , nm , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nt = 2.0 * texture2D ( nq , nm ) . rg - 1.0 ; if ( ns . a != 0.0 ) ns . a = sqrt ( 5.0 * length ( nt ) ) ;".split(" ")}]}}]},
{type:"textline",b:"return ns ; } else { bool nu = max ( nr . x , nr . z ) > max ( nr . y , nr . w ) ; vec4 nv = vec4 ( 0.0 , nr . y , 0.0 , nr . w ) ; vec2 nw = nr . yw ; kz ( bvec4 ( nu , nu , nu , nu ) , nv , vec4 ( nr . x , 0.0 , nr . z , 0.0 ) ) ; kz ( bvec2 ( nu , nu ) , nw , nr . xz ) ; nw /= dot ( nw , vec2 ( 1.0 , 1.0 ) ) ; vec4 nx = nv * vec4 ( u_texel_size , - u_texel_size ) + nm . xyxy ; vec4 ny = nw . x * texture2D ( no , nx . xy , 0.0 ) ; ny += nw . y * texture2D ( no , nx . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nz = nw . x * ( 2.0 * texture2D ( nq , nx . xy , 0.0 ) . rg - 1.0 ) ; nz += nw . y * ( 2.0 * texture2D ( nq , nx . zw , 0.0 ) . rg - 1.0 ) ; if ( ny . a != 0.0 ) ny . a = sqrt ( 5.0 * length ( nz ) ) ;".split(" ")}]}}]},{type:"textline",b:"return ny ; } } vec4 nK ( vec2 nB , sampler2D nC , sampler2D nD".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",
b:[",","sampler2D","nE"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 nF = texture2D ( nC , nB ) ; vec4 nG = texture2D ( nD , nB ) ; float nH = abs ( nF . a * nF . a - nG . a * nG . a ) / 5.0 ; float nI = 0.5 * clamp ( 1.0 - sqrt ( nH ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 nJ = mix ( nF , nG , nI ) ; nJ . a = 1.0 ; return nJ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec4 nF = texture2D ( nC , nB ) ; vec4 nG = texture2D ( nD , nB ) ; return mix ( nF , nG , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"} void main ( ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 nL = vec4 ( kX ( a , kg , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 nL = nl ( a , kh , kg , u_color , u_area_tex , u_search_tex , vec4 ( 0.0 ) ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 nL = nA ( a , kg , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",
b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 nL = vec4 ( nK ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 nL = texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["gl_FragColor","=","nL",";","}"]}]};
a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kg",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 kg [ 3 ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","kh",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",
a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",a:[{type:"ifndef",
name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"textline",b:"void iB ( vec2 iz , out vec4 iA [ 3 ] ) { iA [ 0 ] = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + iz . xyxy ; iA [ 1 ] = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + iz . xyxy ; iA [ 2 ] = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + iz . xyxy ; } void iF ( vec2 iC , out vec2 iD , out vec4 iE [ 3 ] ) { iD = iC / u_texel_size ; iE [ 0 ] = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + iC . xyxy ; iE [ 1 ] = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + iC . xyxy ; iE [ 2 ] = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( iE [ 0 ] . xz , iE [ 1 ] . yw ) ; } void iI ( vec2 iG , out vec4 iH ) { iH = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + iG . xyxy ; } void main ( ) { a = a_bb_vertex + 0.5 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"iB ( a , kg ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"iF ( a , kh , kg ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"iI ( a , kg ) ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"define",name:"SSAO_QUALITY_16",b:["1"]},{type:"define",name:"SSAO_QUALITY_32",b:["2"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform vec2 u_texel_size ; uniform float u_view_max_depth ; uniform vec2 u_camera_range ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_dithering_amount ; uniform float u_ssao_gauss_center ; uniform float u_ssao_gauss_width_square ; uniform float u_ssao_gauss_width_left_square ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; vec2 kn ( vec2 ki ) { float kj = dot ( ki , vec2 ( 12.9898 , 78.233 ) ) ; float kk = dot ( ki , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float kl = fract ( sin ( kj ) * 43758.5453 ) * 2.0 - 1.0 ; float km = fract ( sin ( kk ) * 43758.5453 ) * 2.0 - 1.0 ; return vec2 ( kl , km ) ; } float kp ( in vec2 ko ) { return kb ( u_depth , ko , u_camera_range ) ; } float kx ( in float kq , in float kr , inout int ks ) { float kt = u_ssao_gauss_width_square ; float ku = ( kq - kr ) * 100.0 ; if ( ku < u_ssao_gauss_center ) kt = u_ssao_gauss_width_left_square ; else ks = 1 ; float kv = ku - u_ssao_gauss_center ; float kw = exp ( - 2.0 * kv * kv / kt ) ; return kw ; } float kG ( float ky , vec2 kz ) { float kA = 0.0 ; float kB = 0.0 ; float kC = max ( 1.0 , u_view_max_depth / 100.0 ) ; ky *= kC ; kz /= ky ; vec2 kD = a + kz ; vec2 kE = a - kz ; int kF = 0 ; kA = kx ( ky , kC * kp ( kD ) , kF ) ; if ( kF > 0 || kD . y < 0.0 || kD . y > 1.0 || kD . x < 0.0 || kD . x > 1.0 ) { kB = kx ( kC * kp ( kE ) , ky , kF ) ; kA += ( 1.0 - kA ) * kB ; } return kA ; } void main ( ) { vec2 kH = kn ( a ) * u_ssao_dithering_amount ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:["kH","*=","1.5",";"]}]}}]},{type:"textline",b:"float kI = kp ( a ) ; float kJ = 0.0 ; vec2 kK = u_texel_size * 0.5 ; for ( int kL = 0 ; kL < 4 ; kL ++ ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"if ( kL == 0 || kL == 2 ) {".split(" ")}]}}]},{type:"textline",b:"kJ += kG ( kI , kK ) ; kJ += kG ( kI , vec2 ( kK . x , - kK . y ) ) ; kJ += kG ( kI , vec2 ( - kK . x , kK . y ) ) ; kJ += kG ( kI , vec2 ( - kK . x , - kK . y ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"} else if ( kL == 1 || kL == 3 ) {".split(" ")}]}}]},{type:"textline",b:"kJ += kG ( kI , vec2 ( kK . x * 1.2 , 0.0 ) ) ; kJ += kG ( kI , vec2 ( - kK . x * 1.2 , 0.0 ) ) ; kJ += kG ( kI , vec2 ( 0.0 , kK . y * 1.2 ) ) ; kJ += kG ( kI , vec2 ( 0.0 , - kK . y * 1.2 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",
b:["}"]}]}}]},{type:"textline",b:"kK += kH ; kK *= u_ssao_radius_increase ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"kJ = 1.0 - kJ / 16.0 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"kJ = 1.0 - kJ / 32.0 ;".split(" ")}]}}]},{type:"textline",b:"float kM = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * kI ) ; kJ = ( 1.0 - kM ) + kJ * kM ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:["kJ","=","1.0",";"]}]}}]},{type:"textline",b:"float kN = texture2D ( u_color , a ) . r ; gl_FragColor = vec4 ( kN , kJ , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { float iz = texture2D ( u_depth , a ) . x ; vec4 iA = vec4 ( a * 2.0 - 1.0 , 2.0 * iz - 1.0 , 1.0 ) ; vec4 iB = u_view_proj_inverse * iA ; vec4 iC = iB / iB . w ; vec4 iD = iA ; vec4 iE = u_view_proj_prev * iC ; iE /= iE . w ; vec2 iF = ( iD . xy - iE . xy ) / 2.0 ; gl_FragColor = vec4 ( iF / 2.0 + 0.5 , 0.0 , 1.0 ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct b { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool e ( float c , float d ) { return abs ( c - d ) < EPSILON ; } bool h ( vec3 f , vec3 g ) { return any ( lessThan ( abs ( f - g ) , vec3 ( EPSILON ) ) ) ; } vec3 k ( in vec4 i , in vec3 j ) { return j + 2.0 * cross ( i . xyz , cross ( i . xyz , j ) + i . w * j ) ; } mat4 l ( ) { return mat4 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 ) ; } mat4 n ( float m ) { return mat4 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , cos ( m ) , sin ( m ) , 0.0 , 0.0 , - sin ( m ) , cos ( m ) , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 ) ; } mat4 p ( float o ) { return mat4 ( cos ( o ) , 0.0 , - sin ( o ) , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , sin ( o ) , 0.0 , cos ( o ) , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 ) ; } mat4 r ( float q ) { return mat4 ( cos ( q ) , sin ( q ) , 0.0 , 0.0 , - sin ( q ) , cos ( q ) , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 ) ; } b t ( in b s ) { return b ( s . a , s . b , normalize ( s . c ) , normalize ( s . d ) , normalize ( s . e ) , s . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 u = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_SPHERICAL"],group:{type:"group",a:[{type:"textline",b:"mat4 A ( vec3 v , mat4 w ) { vec3 x = vec3 ( w [ 0 ] [ 0 ] , w [ 1 ] [ 0 ] , w [ 2 ] [ 0 ] ) ; vec3 y = vec3 ( w [ 0 ] [ 1 ] , w [ 1 ] [ 1 ] , w [ 2 ] [ 1 ] ) ; vec3 z = vec3 ( w [ 0 ] [ 2 ] , w [ 1 ] [ 2 ] , w [ 2 ] [ 2 ] ) ; y = cross ( z , x ) ; return mat4 ( vec4 ( x , 0.0 ) , vec4 ( y , 0.0 ) , vec4 ( z , 0.0 ) , vec4 ( v , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 G ( vec3 B , vec3 C ) { vec3 D = B - C ; D . y = 0.0 ; D = normalize ( D ) ; vec3 E = normalize ( cross ( u , D ) ) ; vec3 F = normalize ( cross ( D , E ) ) ; return mat4 ( vec4 ( E , 0.0 ) , vec4 ( F , 0.0 ) , vec4 ( D , 0.0 ) , vec4 ( C , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 R ( in vec3 H , float I , float J , float L , vec3 M ) { float N = fract ( length ( M ) / 0.17 ) ; float O = L + N / 10.0 ; float P = N / L ; H *= 1.0 + 0.5 * sin ( I ) ; float Q = length ( H ) * J * sin ( 2.0 * 3.14 * I * O + P ) ; return r ( Q ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 ab ( in vec3 S , in vec3 T , in mat4 U ) {".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_SPHERICAL"],group:{type:"group",a:[{type:"textline",b:"mat4 V = A ( T , U ) ;".split(" ")}]}},{type:"elif",c:["HAIR_BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"float W = fract ( ( T . x * 1.43 + T . y * 0.123 + T . z * 6.1 ) ) ; float X = 2.0 * M_PI * W ; vec3 Y = normalize ( vec3 ( U [ 0 ] [ 2 ] , 0.0 , U [ 2 ] [ 2 ] ) ) ; float Z = acos ( Y [ 2 ] ) ; if ( Y [ 0 ] < 0.0 ) Z = 2.0 * M_PI - Z ; float _ = Z - X ; if ( _ < 0.0 ) _ = 2.0 * M_PI + _ ; float aa = X ; if ( _ <= MAX_BILLBOARD_ANGLE ) aa += _ ; else if ( _ <= M_PI - MAX_BILLBOARD_ANGLE ) aa += MAX_BILLBOARD_ANGLE * ( 2.0 * _ - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( _ <= M_PI + MAX_BILLBOARD_ANGLE ) aa += _ - M_PI ; else if ( _ <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) aa += MAX_BILLBOARD_ANGLE * ( 2.0 * _ - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else aa += _ - 2.0 * M_PI ; mat4 V = p ( aa ) ; V [ 3 ] = vec4 ( T , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 V = G ( S , T ) ;".split(" ")}]}}]},{type:"textline",b:"return V ; } b ai ( in vec3 ac , in vec3 ad , in vec3 ae , in vec3 af , in vec3 ag , in mat4 ah ) { ac = ( ah * vec4 ( ac , 1.0 ) ) . xyz ; ad = ( ah * vec4 ( ad , 1.0 ) ) . xyz ; ae = ( ah * vec4 ( ae , 0.0 ) ) . xyz ; af = ( ah * vec4 ( af , 0.0 ) ) . xyz ; ag = ( ah * vec4 ( ag , 0.0 ) ) . xyz ; return t ( b ( ac , ad , ae , af , ag , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]=
{type:"group",a:[{type:"textline",b:"vec2 al ( vec2 aj , vec3 ak ) { return ( aj + 0.5 ) * ak . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 au ( in vec4 am , in vec4 an , in float ao ) { float ap = am [ 0 ] * an [ 0 ] + am [ 1 ] * an [ 1 ] + am [ 2 ] * an [ 2 ] + am [ 3 ] * an [ 3 ] ; if ( ap < 0.0 ) { an *= - 1.0 ; ap = - ap ; } if ( abs ( ap ) >= 1.0 ) return am ; float aq = acos ( ap ) ; float ar = sqrt ( 1.0 - ap * ap ) ; if ( abs ( ar ) < 0.001 ) return vec4 ( am * 0.5 + an * 0.5 ) ; float as = sin ( ( 1.0 - ao ) * aq ) / ar ; float at = sin ( ao * aq ) / ar ; return am * as + an * at ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aJ ( in vec3 av , in vec4 aw , in vec4 ax , in vec4 ay , in vec4 az , in float aA ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aB = au ( aw , ax , aA ) ; vec4 aC = mix ( ay , az , aA ) ; vec3 aD = k ( aB , av ) ; vec3 aE = aD * aC . w + aC . xyz ; return aE ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aF = k ( aw , av ) ; vec3 aG = k ( ax , av ) ; vec3 aH = aF * ay . w + ay . xyz ; vec3 aI = aG * az . w + az . xyz ; return mix ( aH , aI , aA ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aS ( in vec3 aK , in vec4 aL , in vec4 aM , in float aN ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aO = au ( aL , aM , aN ) ; vec3 aP = k ( aO , aK ) ; return aP ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aQ = k ( aL , aK ) ; vec3 aR = k ( aM , aK ) ; return mix ( aQ , aR , aN ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 aJ ( in vec3 aT , in vec4 aU , in vec4 aV ) { vec3 aW = k ( aU , aT ) ; vec3 aX = aW * aV . w + aV . xyz ; return aX ; } vec3 aS ( in vec3 aY , in vec4 aZ ) { vec3 a_ = k ( aZ , aY ) ; return a_ ; }".split(" ")}]}}]},{type:"textline",b:"void bn ( inout vec3 ba , inout vec3 bb , inout vec3 bc , inout vec3 bd ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["float","be","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { vec3 bf = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bg = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bh = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bi = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int bj = 0 ; bj < 4 ; bj ++ ) { int bk = int ( a_influence [ bj ] ) ; float bl = fract ( a_influence [ bj ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bf += bl * aJ ( ba , u_quatsb [ bk ] , u_quatsa [ bk ] , u_transb [ bk ] , u_transa [ bk ] , be ) ; bg += bl * aS ( bb , u_quatsb [ bk ] , u_quatsa [ bk ] , be ) ; bh += bl * aS ( bc , u_quatsb [ bk ] , u_quatsa [ bk ] , be ) ; bi += bl * aS ( bd , u_quatsb [ bk ] , u_quatsa [ bk ] , be ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bf += bl * aJ ( ba , u_quatsb [ bk ] , u_transb [ bk ] ) ; bg += bl * aS ( bb , u_quatsb [ bk ] ) ; bh += bl * aS ( bc , u_quatsb [ bk ] ) ; bi += bl * aS ( bd , u_quatsb [ bk ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} ba = bf ; bb = bg ; bc = bh ; bd = bi ; } if ( ! ( a_influence . y > 0.0 ) ) { int bm = int ( a_influence [ 0 ] - 1.0 ) ; if ( bm > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"ba = aJ ( ba , u_quatsb [ bm ] , u_quatsa [ bm ] , u_transb [ bm ] , u_transa [ bm ] , be ) ; bb = aS ( bb , u_quatsb [ bm ] , u_quatsa [ bm ] , be ) ; bc = aS ( bc , u_quatsb [ bm ] , u_quatsa [ bm ] , be ) ; bd = aS ( bd , u_quatsb [ bm ] , u_quatsa [ bm ] , be ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ba = aJ ( ba , u_quatsb [ bm ] , u_transb [ bm ] ) ; bb = aS ( bb , u_quatsb [ bm ] ) ; bc = aS ( bc , u_quatsb [ bm ] ) ; bd = aS ( bd , u_quatsb [ bm ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bB ( inout vec3 bo , in vec3 bp , in float bq , in float br , in float bs , in vec3 bt , in float bu ) { float bv = length ( bp ) ; float bw = br * ( 1.0 + 0.1 * fract ( bv ) ) ; float bx = bq * bu * ( 1.0 + sin ( 2.0 * 3.14 * bs * bw + bv ) ) ; float by = ( bo . y - bp . y ) * abs ( bx ) ; by += 1.0 ; by *= by ; by = by * by - by ; vec3 bz = bo ; bz . xz += bt . xz * by * sign ( bx ) ; float bA = length ( bo - bp ) ; bo = bp + normalize ( bz - bp ) * bA ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bD ( vec4 bC ) { return bC * bC * ( 3.0 - 2.0 * bC ) ; } vec4 bF ( vec4 bE ) { return abs ( fract ( bE + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bH ( vec4 bG ) { return bD ( bF ( bG ) ) ; } void bY ( inout vec3 bI , in float bJ , in vec3 bK , in vec3 bL , in vec3 bM , in float bN , in float bO , in float bP , in vec3 bQ ) { float bR ; float bS ; float bT ; vec2 bU ; vec4 bV ; vec2 bW ; vec3 bX ; bR = dot ( bM , vec3 ( 1.0 ) ) ; bS = bR + bQ . g ; bT = dot ( bI , vec3 ( bQ . g ) ) ; bU = ( bJ + vec2 ( bT , bS ) ) ; bV = ( ( fract ( ( bU . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bL ) * bN ; bV = bH ( bV ) ; bW = bV . xz + bV . yw ; bW . y = 0.5 - bW . y ; bX = bW . xyx * bQ . rbr * vec3 ( bO * bK . x , bP , bO * bK . z ) ; bI += bX ; }".split(" ")}]}}]},
{type:"textline",b:"void ce ( inout vec3 bZ , inout vec3 b_ , in vec3 ca ) { vec3 cb = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vec3 cc = b_ ; vec3 cd = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cc = bZ ; vec3 cd = b_ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"bY ( cc , u_time , ca , cb , cd , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bB ( cc , cd , au_wind_bending_amp , au_wind_bending_freq , u_time , cb , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bB ( cc , cd , au_wind_bending_amp , au_wind_bending_freq , u_time , cb , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"bZ += cc - b_ ; b_ = cc ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bZ = cc ; b_ = cd ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",b:["2"]},
{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_RGBA",b:["2"]},{type:"define",name:"SHADOW_SRC_RGBA_PCF",b:["3"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["4"]},{type:"define",name:"SHADOW_SRC_VSM",b:["5"]},{type:"define",name:"SHADOW_SRC_MASK",b:["6"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_RGBA",b:["2"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["3"]},{type:"define",name:"SHADOW_DST_VSM",b:["4"]},{type:"define",name:"SHADOW_DST_MASK",
b:["5"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"vec4 cj ( const in float cf ) { const vec4 cg = vec4 ( 255.0 * 255.0 * 255.0 , 255.0 * 255.0 , 255.0 , 1.0 ) ; const vec4 ch = vec4 ( 0.0 , 1.0 / 255.0 , 1.0 / 255.0 , 1.0 / 255.0 ) ; vec4 ci = fract ( cf * cg ) ; ci -= ci . xxyz * ch ; return ci ; } float cn ( const in vec4 ck ) { float cl ; const vec4 cm = vec4 ( 1.0 / ( 255.0 * 255.0 * 255.0 ) , 1.0 / ( 255.0 * 255.0 ) , 1.0 / 255.0 , 1.0 ) ; cl = dot ( ck , cm ) ; return cl ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_SECTION_DIST0",b:["0.0"]},{type:"var",name:"CSM_SECTION_DIST1",b:["0.0"]},{type:"var",name:"CSM_SECTION_DIST2",b:["0.0"]},{type:"var",name:"CSM_SECTION_DIST3",b:["0.0"]},{type:"var",name:"PCF_TEXEL_SIZE",b:["0.0"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","cv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_RGBA_PCF"],group:{type:"group",a:[{type:"textline",b:"float cC ( sampler2D cw , vec3 cx , float cy , float cz ) { vec2 cA = cx . xy + vec2 ( cy , cz ) * PCF_TEXEL_SIZE ; vec4 cB = texture2D ( cw , cA ) ; return cn ( cB ) ; }".split(" ")}]}}]},{type:"textline",b:"float cR ( vec3 cD , sampler2D cE , float cF ) { float cG ; cD . z = clamp ( cD . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_RGBA"],
group:{type:"group",a:[{type:"textline",b:"vec4 cH = texture2D ( cE , cD . xy ) ; float cI = cn ( cH ) ; if ( all ( lessThan ( cD . xy , vec2 ( 1.0 ) ) ) && all ( greaterThan ( cD . xy , vec2 ( 0.0 ) ) ) && cI < cD . z ) { float cJ = cD . z - cI ; cG = exp ( - cJ * cF ) ; } else cG = 1.0 ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","==","SHADOW_SRC_RGBA_PCF"],group:{type:"group",a:[{type:"textline",b:"vec4 cI ; cI . r = cC ( cE , cD , 0.5 , 0.5 ) ; cI . g = cC ( cE , cD , 0.5 , - 0.5 ) ; cI . b = cC ( cE , cD , - 0.5 , - 0.5 ) ; cI . a = cC ( cE , cD , - 0.5 , 0.5 ) ; vec4 cK = vec4 ( cD . z , cD . z , cD . z , cD . z ) ; if ( all ( lessThan ( cD . xy , vec2 ( 1.0 ) ) ) && all ( greaterThan ( cD . xy , vec2 ( 0.0 ) ) ) ) cG = dot ( vec4 ( greaterThanEqual ( cI , cK ) ) , vec4 ( 0.25 , 0.25 , 0.25 , 0.25 ) ) ; else cG = 1.0 ;".split(" ")}]}},
{type:"elif",c:["SHADOW_SRC","==","SHADOW_SRC_VSM"],group:{type:"group",a:[{type:"textline",b:"vec4 cL = texture2D ( cE , cD . xy ) ; float cM = cL . r ; float cN = cL . g ; if ( all ( lessThan ( cD . xy , vec2 ( 1.0 ) ) ) && all ( greaterThan ( cD . xy , vec2 ( 0.0 ) ) ) && cM < cD . z ) { float cO = cN - cM * cM ; float cP = cD . z - cM ; cG = cO / ( cO + cP * cP ) ; } else cG = 1.0 ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float cI = texture2D ( cE , cD . xy ) . r ; if ( all ( lessThan ( cD . xy , vec2 ( 1.0 ) ) ) && all ( greaterThan ( cD . xy , vec2 ( 0.0 ) ) ) && cI < cD . z ) { cG = 0.0 ; float cQ = cD . z - cI ; cG = exp ( - cQ * cF ) ; } else cG = 1.0 ;".split(" ")}]}}]},
{type:"textline",b:"return clamp ( cG , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"float cX ( float cS , float cT ) { vec3 cU ; float cV = 1.0 ; float cW = - cS ; if ( cW < CSM_SECTION_DIST0 ) { cU = cp . xyz / cp . w ; cV = cR ( cU , u_shadow_map0 , cT ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else if ( cW < CSM_SECTION_DIST1 ) { cU = cq . xyz / cq . w ; cV = cR ( cU , u_shadow_map1 , cT ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else if ( cW < CSM_SECTION_DIST2 ) { cU = cr . xyz / cr . w ; cV = cR ( cU , u_shadow_map2 , cT ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else if ( cW < CSM_SECTION_DIST3 ) { cU = cs . xyz / cs . w ; cV = cR ( cU , u_shadow_map3 , cT ) ; }".split(" ")}]}}]},{type:"textline",b:["return","cV",";","}"]}]}}]}]}}]},{type:"textline",b:"float dc ( in float cY , inout vec3 cZ ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 c_ = texture2DProj ( u_shadow_mask , ct ) . rg ; vec3 da = vec3 ( c_ . r ) ; float db = c_ . g ; cv = vec4 ( da , db ) ; cZ *= cv . a ; return cv . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return cX ( cu . z , cY ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},
{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 dh ( vec3 dd , float de , vec2 df ) { vec2 dg = vec2 ( ( dd . x - df . x ) / de , - ( dd . z - df . y ) / de ) ; return fract ( dg ) ; } vec2 dl ( vec2 di , float dj , vec2 dk ) { return vec2 ( di . x * dj , - di . y * dj ) + dk ; } b dm ( ) { return b ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } b dT ( vec3 dn , vec3 dp , vec3 dq , vec3 dr , vec3 ds , sampler2D dt , sampler2D du , vec3 dv , float dw , vec3 dx , vec4 dy , mat4 dz ) { vec3 dA = k ( dy , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float dB = - dA . x ; float dC = - dA . z ; vec2 dD = vec2 ( dx . x + dw * ( - 1.0 - dB ) / 2.0 , dx . z + dw * ( 1.0 - dC ) / 2.0 ) ; vec2 dE = dh ( ds , dw , dD ) ; float dF = dw / 2.0 ; vec2 dG = abs ( dl ( dE - vec2 ( 0.5 ) , dw , vec2 ( 0.0 ) ) ) ; float dH = dF * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( dG ) > dH ) return dm ( ) ; float dI = dw / dv . z ; vec2 dJ = ( dE - vec2 ( 0.5 ) ) * dI + vec2 ( 0.5 ) ; vec3 dK = dA * ( dw / dv . z - 1.0 ) / 2.0 ; dJ . x += dK . x ; dJ . y -= dK . z ; vec4 dL = texture2D ( du , dJ ) ; float dM = dL . r ; if ( dM < u_scale_threshold ) return dm ( ) ; float dN = dv . y - dv . x ; float dO = dv . y - texture2D ( dt , dJ ) . r * dN ; vec2 dP = dn . xz - ds . xz ; ds . xz = dl ( dE , dw , dD ) ; ds . y = dO ; dn . xz = ds . xz + dP ; dn . y *= dM ; dn . y += dO ; vec3 dQ = dL . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"dn -= ds ; mat4 dR = ab ( dx , ds , dz ) ; b dS = ai ( dn , ds , dp , dq , dr , dR ) ; dS . b = ds ; dS . f = dQ ; return t ( dS ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return t ( b ( dn , ds , dp , dq , dr , dQ ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"void dV ( vec3 dU ) { cp = u_b_light_matrix * u_p_light_matrix0 * u_v_light_matrix * vec4 ( dU , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cq = u_b_light_matrix * u_p_light_matrix1 * u_v_light_matrix * vec4 ( dU , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cr = u_b_light_matrix * u_p_light_matrix2 * u_v_light_matrix * vec4 ( dU , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cs = u_b_light_matrix * u_p_light_matrix3 * u_v_light_matrix * vec4 ( dU , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void dV ( vec4 dW ) { float dX = dW . x ; float dY = dW . y ; float dZ = dW . w ; ct . x = ( dX + dZ ) / 2.0 ; ct . y = ( dY + dZ ) / 2.0 ; ct . z = dZ ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]=
{type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void eb ( inout vec3 ea ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"ea = pow ( ea , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void ed ( inout vec3 ec ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"ec = pow ( ec , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"} void eg ( inout vec3 ee , in float ef ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"ee = ee * ef ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"float eo ( inout vec3 ej , in float ek , in vec4 el ) { float em = el . w * ek ; float en = exp ( - em * em ) ; en = clamp ( en , 0.0 , 1.0 ) ; ej = mix ( el . rgb , ej , en ) ; return en ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 ev ( in mat4 ep , in vec3 eq ) { vec3 er = mix ( ep [ 0 ] . rgb , ep [ 1 ] . rgb , max ( sign ( eq . x ) , 0.0 ) ) ; vec3 es = mix ( ep [ 2 ] . rgb , ep [ 3 ] . rgb , max ( sign ( eq . z ) , 0.0 ) ) ; vec3 et = vec3 ( ep [ 0 ] . a , ep [ 1 ] . a , ep [ 2 ] . a ) ; vec3 eu = mix ( er , es , abs ( eq . z ) ) ; eu = mix ( eu , et , abs ( eq . y ) ) ; return eu ; }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void ex ( inout float ew ) { ew -= 0.5 ; ew = 4.0 * ( ew * ew * ew ) + 0.5 ; } float eM ( inout vec3 ey , in float ez , in float eA , in float eB , in vec4 eC , in vec4 eD , in float eE , in float eF ) { eA = clamp ( eA , 0.0 , 1.0 ) ; float eG = eD . w * ez ; float eH = exp ( - eG * eG ) ; eH = clamp ( eH , 0.0 , 1.0 ) ; ez = max ( ez - max ( eB / eA , 0.0 ) , 0.0 ) ; eG = eC . w * ez ; float eI = 1.0 - eG ; eI += max ( eE - WAVES_HEIGHT - 0.05 , 0.0 ) ; + max ( eE / WAVES_HEIGHT , 0.0 ) ; eI = clamp ( eI , 0.0 , 1.0 ) ; ex ( eI ) ; if ( eI < eH ) { vec3 eJ = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 eK = eC . rgb ; eB = clamp ( - eB * 0.03 , 0.0 , 0.8 ) ; vec3 eL = mix ( eK , eJ , min ( eA , 1.0 ) ) ; eL = mix ( eL , vec3 ( 0.0 ) , eB ) * eF ; ey = mix ( eL , ey , eI ) ; return eI ; } if ( eI >= eH ) { ey = mix ( eD . rgb , ey , eH ) ; return eH ; } } float eV ( inout vec3 eN , in float eO , in float eP , in vec4 eQ , in float eR ) { float eS = eQ . w * eO ; float eT = 1.0 - eS ; eT = clamp ( eT , 0.0 , 1.0 ) ; ex ( eT ) ; eP = clamp ( - eP * 0.03 , 0.0 , 0.8 ) ; vec3 eU = mix ( eQ . rgb , vec3 ( 0.0 ) , eP ) * eR ; eN = mix ( eU , eN , eT ) ; return eT ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"struct eW { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float fd ( vec3 eX , vec3 eY , vec3 eZ , vec4 e_ , float fa ) { vec3 fb = normalize ( eX + eY ) ; float fc = e_ [ 0 ] * max ( dot ( eZ , fb ) , 0.0 ) + e_ [ 1 ] ; return pow ( fc , fa ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float fo ( vec3 fe , vec3 ff , vec3 fg , float fh ) { vec3 fi = normalize ( fe + ff ) ; float fj = max ( dot ( fg , fi ) , 0.001 ) ; float fk = max ( dot ( fg , ff ) , 0.001 ) ; float fl = max ( dot ( fg , fe ) , 0.001 ) ; float fm = tan ( acos ( fj ) ) ; float fn = max ( fh , 0.001 ) ; return fl * ( 1.0 / ( 4.0 * M_PI * fn * fn ) ) * ( exp ( - ( fm * fm ) / ( fn * fn ) ) / ( sqrt ( fk * fl ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"void fG ( float fp , vec3 fq , vec3 fr , vec3 fs , float ft , inout float fu ) { if ( ft > 0.0 ) { float fv = max ( dot ( fq , fs ) , 0.0 ) ; float fw = acos ( fp ) ; float fx = acos ( fv ) ; vec3 fy = normalize ( fr - fp * fq ) ; vec3 fz = normalize ( fs - fv * fq ) ; float fA = max ( dot ( fy , fz ) , 0.0 ) ; float fB , fC ; fB = max ( fw , fx ) ; fC = min ( fw , fx ) ; float fD = ft * ft ; float fE = 1.0 - 0.5 * ( fD / ( fD + 0.33 ) ) ; float fF = 0.45 * ( fD / ( fD + 0.09 ) ) ; fC *= 0.95 ; fu = fu * ( fE + ( fF * fA * sin ( fB ) * tan ( fC ) ) ) ; } else { fu = fu ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void fN ( vec3 fH , vec3 fI , float fJ , float fK , out float fL ) { float fM ; if ( fJ == 0.0 ) { fL = 1.0 ; } else { fM = 1.0 + abs ( dot ( fI , fH ) ) ; fM = fK + ( 1.0 - fK ) * pow ( fM , fJ ) ; fL = clamp ( fM , 0.0 , 1.0 ) ; } }".split(" ")}]}}]},{type:"textline",b:"eW gz ( vec3 fO , vec3 fP , vec3 fQ , vec3 fR , vec3 fS , vec3 fT , vec3 fU , float fV , vec2 fW , float fX , vec3 fY [ NUM_LIGHTS ] , vec3 fZ [ NUM_LIGHTS ] , vec3 f_ [ NUM_LIGHTS ] , vec4 ga [ NUM_LIGHTS ] , vec4 gb [ NUM_LIGHTS ] , float gc , vec4 gd ) { eW ge ; ge . a = vec4 ( fO + fQ * fP , 0.0 ) ; ge . b = vec3 ( 0.0 ) ; for ( int gf = 0 ; gf < NUM_LIGHTS ; gf ++ ) { vec4 gg = ga [ gf ] ; vec4 gh = gb [ gf ] ; vec3 gi = vec3 ( 0.0 ) ; vec3 gj = f_ [ gf ] ; gj *= fX ; float gk = gh . z ; if ( gk != - 1.0 ) { gi = fY [ gf ] - fS ; float gl = length ( gi ) ; gj *= gk / ( gk + gl * gl ) ; gi = normalize ( gi ) ; float gm = gh . x ; float gn = gh . y ; if ( gm > - 1.0 ) { float go = dot ( gi , fZ [ gf ] ) ; go *= smoothstep ( 0.0 , 1.0 , ( go - gm ) / gn ) ; gj *= go ; } } else gi = fZ [ gf ] ; float gp ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"fN ( fT , gi , fW [ 0 ] , fW [ 1 ] , gp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float gq = max ( dot ( fT , gi ) , 0.0 ) ; gp = gg [ 0 ] * gq + gg [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"fG ( gq , fT , gi , fU , fW [ 0 ] , gp ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float gr = fd ( gi , fU , fT , gg , fV ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float gr = fo ( gi , fU , fT , fV ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","gr","=","0.0",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_NODE_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( gi , fT ) * dot ( fU , fT ) < 0.0 ) { float gs = gd . x ; float gt = gd . y ; float gu = gd . z ; float gv = gd . w ; float gw = clamp ( abs ( dot ( gi , fT ) ) , 0.0 , 1.0 ) ; float gx = clamp ( dot ( fU , - gi ) , 0.0 , 1.0 ) ; float gy = pow ( gx , gt ) ; ge . a += gc * vec4 ( gj * gw * pow ( fQ , vec3 ( gs ) ) , 1.0 ) ; ge . a += gu * mix ( vec4 ( fQ , 1.0 ) , vec4 ( 1.0 ) , gv ) * gc * vec4 ( gj * gw * vec3 ( gy ) , 1.0 ) ; } else { ge . b += gj * fR * gr ; ge . a += vec4 ( gj * fQ * gp , gr ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"ge . b += gj * fR * gr ; ge . a += vec4 ( gj * fQ * gp , gr ) ;".split(" ")}]}}]},{type:"textline",b:["}","return","ge",";","}"]}]};a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"vec4 gB ( vec4 gA ) { return gA - floor ( gA * ( 1.0 / 289.0 ) ) * 289.0 ; } vec3 gB ( vec3 gC ) { return gC - floor ( gC * ( 1.0 / 289.0 ) ) * 289.0 ; } vec2 gB ( vec2 gD ) { return gD - floor ( gD * ( 1.0 / 289.0 ) ) * 289.0 ; } vec4 gF ( vec4 gE ) { return gE - floor ( gE * ( 1.0 / 7.0 ) ) * 7.0 ; } vec4 gH ( vec4 gG ) { return gB ( ( 34.0 * gG + 5.0 ) * gG ) ; }".split(" ")},
{type:"define",name:"K",b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 gT ( vec2 gI ) { vec2 gJ = gB ( floor ( gI ) ) ; vec2 gK = fract ( gI ) ; vec4 gL = gK . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 gM = gK . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 gN = gH ( gJ . x + vec4 ( 0.0 , 1.0 , 0.0 , 1.0 ) ) ; gN = gH ( gN + gJ . y + vec4 ( 0.0 , 0.0 , 1.0 , 1.0 ) ) ; vec4 gO = gF ( gN ) * K + K2 ; vec4 gP = gF ( floor ( gN * K ) ) * K + K2 ; vec4 gQ = gL + JITTER * gO ; vec4 gR = gM + JITTER * gP ; vec4 gS = gQ * gQ + gR * gR ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"gS . xy = min ( gS . xy , gS . zw ) ; gS . x = min ( gS . x , gS . y ) ; return gS . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gS . xy = ( gS . x < gS . y ) ? gS . xy : gS . yx ; gS . xz = ( gS . x < gS . z ) ? gS . xz : gS . zx ; gS . xw = ( gS . x < gS . w ) ? gS . xw : gS . wx ; gS . y = min ( gS . y , gS . z ) ; gS . y = min ( gS . y , gS . w ) ; return sqrt ( gS . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 hh ( vec2 gU , float gV ) { vec2 gW = gB ( floor ( gU ) ) ; vec2 gX = fract ( gU ) ; vec4 gY = gX . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 gZ = gX . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 g_ = gH ( gW . x + vec4 ( 0.0 , 1.0 , 0.0 , 1.0 ) ) ; g_ = gH ( g_ + gW . y + vec4 ( 0.0 , 0.0 , 1.0 , 1.0 ) ) ; vec4 ha = gF ( g_ ) * K + K2 ; vec4 hb = gF ( floor ( g_ * K ) ) * K + K2 ; vec4 hc = gY + JITTER * ha ; vec4 hd = gZ + JITTER * hb ; vec4 he = hc * hc + hd * hd ; hc += gV ; hd += gV ; vec4 hf = hc * hc + hd * hd ; hc += gV ; hd += gV ; vec4 hg = hc * hc + hd * hd ; he . xy = min ( he . xy , he . zw ) ; he . x = min ( he . x , he . y ) ; hf . xy = min ( hf . xy , hf . zw ) ; hf . x = min ( hf . x , hf . y ) ; hg . xy = min ( hg . xy , hg . zw ) ; hg . x = min ( hg . x , hg . y ) ; return mat3 ( he . xx , 0.0 , hf . xx , 0.0 , hg . xx , 0.0 ) ; } vec3 hj ( vec3 hi ) { return gB ( ( ( hi * 34.0 ) + 1.0 ) * hi ) ; } float hx ( vec2 hk ) { const vec4 hl = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 hm = floor ( hk + dot ( hk , hl . yy ) ) ; vec2 hn = hk - hm + dot ( hm , hl . xx ) ; vec2 ho ; ho = ( hn . x > hn . y ) ? vec2 ( 1.0 , 0.0 ) : vec2 ( 0.0 , 1.0 ) ; vec4 hp = hn . xyxy + hl . xxzz ; hp . xy -= ho ; hm = gB ( hm ) ; vec3 hq = hj ( hj ( hm . y + vec3 ( 0.0 , ho . y , 1.0 ) ) + hm . x + vec3 ( 0.0 , ho . x , 1.0 ) ) ; vec3 hr = max ( 0.5 - vec3 ( dot ( hn , hn ) , dot ( hp . xy , hp . xy ) , dot ( hp . zw , hp . zw ) ) , 0.0 ) ; hr = hr * hr ; hr = hr * hr ; vec3 hs = 2.0 * fract ( hq * hl . www ) - 1.0 ; vec3 ht = abs ( hs ) - 0.5 ; vec3 hu = floor ( hs + 0.5 ) ; vec3 hv = hs - hu ; hr *= 1.79284291400159 - 0.85373472095314 * ( hv * hv + ht * ht ) ; vec3 hw ; hw . x = hv . x * hn . x + ht . x * hn . y ; hw . yz = hv . yz * hp . xz + ht . yz * hp . yw ; return 130.0 * dot ( hr , hw ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"textline",b:"void hY ( inout vec3 hy , float hz , float hA , float hB , vec3 hC , vec3 hD , vec3 hE , vec4 hF , vec3 hG , float hH ) { if ( hH > 100.0 ) return ; vec4 hI = hF ; vec3 hJ = hG + hC ; hJ . xz = 10.0 * sin ( 0.1 * hJ . xz ) ; vec3 hK = hJ + 2.0 * cross ( - hI . xyz , cross ( - hI . xyz , hJ ) + hI . w * hJ ) ; vec2 hL = hK . xz ; vec3 hM = hD ; float hN = max ( dot ( hC , hM ) , 0.0 ) ; float hO = 0.025 ; hL . s += 0.5 * sin ( dot ( hG + hA , vec3 ( 1.0 ) ) ) ; hL . t += 0.7 * ( - sin ( dot ( hG - hA , vec3 ( - 0.7 ) ) ) ) ; hL . st += 0.23 * cos ( 4.0 * hz - CAUST_SPEED . x * hA ) ; hL . st += 3.0 * sin ( hz - 0.3 * CAUST_SPEED . y * hA ) ; float hP = CAUST_SCALE * ( 1.0 + max ( 0.1 * hz , 0.0 ) ) ; mat3 hQ = hh ( ( hL / hP ) , hO ) ; float hR = ( hQ * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; float hS = ( hQ * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; float hT = ( hQ * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; vec3 hU = CAUST_BRIGHT * vec3 ( hR , hS , hT ) ; float hV = hB * hN ; float hW = max ( sign ( hz ) , 0.0 ) ; hV = min ( hV + 0.5 * sign ( - hC . y ) * hW , 1.0 ) ; hV *= 1.0 - hW * ( 0.1 * hz ) ; hU *= hV ; hU *= hU ; float hX = min ( - hz + 10.0 , 1.0 ) ; hy += max ( ( 2.0 * hE * hU ) * hX , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"define",name:"BUMP",b:["0.1"]},{type:"textline",b:"float il ( in vec3 id , in vec3 ie , in float ig , in float ih ) { vec3 ii = normalize ( ie + id ) ; float ij = 1.0 - dot ( id , ii ) ; float ik = ih + ( 1.0 - ih ) * pow ( ij , ig ) ; return ik ; } void iy ( inout vec3 im , in vec3 io , in vec3 ip , in float iq , in float ir , in vec2 is ) { vec3 it = reflect ( - io , ip ) ; float iu = il ( io , it , iq , ir ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 iv = ct . xy / ct . z ; iv += is * BUMP ; vec3 iw = texture2D ( u_reflectmap , iv ) . rgb ; eb ( iw . rgb ) ; im = mix ( im , iw , u_reflect_factor * iu ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"vec3 ix = textureCube ( u_mirrormap , it ) . xyz ; eb ( ix . rgb ) ; im = mix ( im , ix , u_mirror_factor * iu ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};
a["include/particles.glslv"]={type:"group",a:[{type:"define",name:"RAMPSIZE",b:["4"]},{type:"textline",b:"float jt ( float ji , float jj , vec2 jk [ RAMPSIZE ] ) { if ( jk [ 0 ] [ 0 ] < 0.0 ) return 1.0 ; float jl = ji / jj ; bool jm = false ; float jn = 0.0 ; float jo = jk [ 0 ] [ 1 ] ; float jp = 1.0 ; float jq = 1.0 ; for ( int jr = 0 ; jr < RAMPSIZE ; jr ++ ) { if ( ! jm ) { if ( jk [ jr ] [ 0 ] >= 0.0 ) { if ( jl >= jn && jl < jk [ jr ] [ 0 ] ) { jp = jk [ jr ] [ 0 ] ; jq = jk [ jr ] [ 1 ] ; jm = true ; } else if ( jl < jn || jl >= jk [ jr ] [ 0 ] ) { jn = jk [ jr ] [ 0 ] ; jo = jk [ jr ] [ 1 ] ; } } else if ( jk [ jr ] [ 0 ] < 0.0 ) { jq = jo ; jm = true ; } } } if ( ! jm ) jq = jo ; float js = ( jq - jo ) / ( jp - jn ) ; return jo + js * ( jl - jn ) ; } vec3 jF ( float ju , float jv , vec4 jw [ RAMPSIZE ] ) { if ( jw [ 0 ] [ 0 ] < 0.0 ) return vec3 ( 1.0 , 1.0 , 1.0 ) ; float jx = ju / jv ; bool jy = false ; float jz = 0.0 ; vec3 jA = jw [ 0 ] . yzw ; float jB = 1.0 ; vec3 jC = vec3 ( 1.0 , 1.0 , 1.0 ) ; for ( int jD = 0 ; jD < RAMPSIZE ; jD ++ ) { if ( ! jy ) { if ( jw [ jD ] [ 0 ] >= 0.0 ) { if ( jx >= jz && jx < jw [ jD ] [ 0 ] ) { jB = jw [ jD ] [ 0 ] ; jC = jw [ jD ] . yzw ; jy = true ; } else if ( jx < jz || jx >= jw [ jD ] [ 0 ] ) { jz = jw [ jD ] [ 0 ] ; jA = jw [ jD ] . yzw ; } } else if ( jw [ jD ] [ 0 ] < 0.0 ) { jC = jA ; jy = true ; } } } if ( ! jy ) jC = jA ; vec3 jE = ( jC - jA ) / ( jB - jz ) ; return jA + jE * ( jx - jz ) ; } float jO ( float jG , float jH , float jI , float jJ ) { float jK = max ( 0.01 , min ( jH , jI ) ) ; float jL = max ( 0.01 , min ( jH , jJ ) ) ; float jM = jH - jL ; float jN = clamp ( jG / jK , 0.0 , 1.0 ) - step ( jM , jG ) * ( jG - jM ) / jL ; return jN ; }".split(" ")}]};
a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float kb ( in sampler2D jV , in vec2 jW , in vec2 jX ) { float jY = texture2D ( jV , jW ) . r ; float jZ = jX . x ; float j_ = jX . y ; float ka = 2.0 * jZ / ( jZ + j_ - ( 2.0 * jY - 1.0 ) * ( j_ - jZ ) ) ; return ka ; }".split(" ")}]}};b4w.module.__geometry=function(a,q){function c(a){return a.D>F?w.Io()?!1:!0:!1}function b(a){return 0<a.ia.length?!0:!1}function e(a,b,c){c||g.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.D*(b||1)+", will use drawArrays","color: #aa0");b=a.ia;c=a.D;var r=a.v,m=a.r,e;for(e in r){var l=r[e],f=t(l,c);r[e]=d(b,l,f)}for(r=0;r<m.length;r++){var k=m[r];for(e in k)l=k[e],f=t(l,c),k[e]=d(b,l,f)}a.D=b.length;a.ia=new Uint16Array(0);return a}function d(a,b,c){if(0==b.length)return new Float32Array(0);
for(var d=new Float32Array(a.length*c),m=0;m<a.length;m++)for(var e=a[m],g=0;g<c;g++)d[c*m+g]=b[c*e+g];return d}function h(a,b){var c=a.xe,d=a.kc[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function p(b,c){var d,r;switch(c){case a.Cg:case a.li:d=H.TRIANGLES;r=H.STATIC_DRAW;break;case a.Wm:d=H.POINTS;r=H.STATIC_DRAW;break;case a.Um:d=H.TRIANGLES;r=H.DYNAMIC_DRAW;break;case a.kr:d=H.POINTS;r=H.DYNAMIC_DRAW;break;case a.Vm:d=H.LINES;r=H.STATIC_DRAW;
break;default:throw"Wrong draw_mode";}b.mode=d;b.Xj=r}function n(a){a.de?(a.ce||(a.ce=H.createBuffer()),H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,a.ce),H.bufferData(H.ELEMENT_ARRAY_BUFFER,a.de,a.Xj),a.Mk=a.de.byteLength):a.Mk=0;a.vg||(a.vg=H.createBuffer());H.bindBuffer(H.ARRAY_BUFFER,a.vg);H.bufferData(H.ARRAY_BUFFER,a.xe,a.Xj);a.iv=a.xe.byteLength}function k(a){for(var b=I.lb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].ia.length;b.ia=new Uint32Array(c);for(d=c=0;d<a.length;d++)c+=a[d].D;
b.D=c;var m=a[0],e;for(e in m.v){for(d=c=0;d<a.length;d++)c+=a[d].v[e].length;b.v[e]=new Float32Array(c)}for(e in m.r[0]){for(d=c=0;d<a.length;d++)c+=a[d].r[0][e].length;for(d=0;d<m.r.length;d++)b.r[d]=b.r[d]||{},b.r[d][e]=new Float32Array(c)}for(m=d=c=0;m<a.length;m++){e=a[m];for(var g=e.ia,l=e.D,f=e.v,k=0;k<g.length;k++)b.ia[c+k]=g[k]+d;var c=c+g.length,h;for(h in f){var g=f[h],E=d*t(g,l);b.v[h].set(g,E)}for(k=0;k<e.r.length;k++){var f=e.r[k],n=b.r[k];for(h in f)g=f[h],E=d*t(g,l),n[h].set(g,E)}d+=
l}return b}function l(a,b,c,d,m,l){var k=I.lb("SUBMESH_"+a.name+"_"+b);b=a.submeshes[b];var h=b.base_length;k.D=h;var E=s(c,"a_texcoord")?new Float32Array(b.texcoord):new Float32Array(0),n,p=b.group;if(s(c,"a_influence")&&d){n=new Float32Array(h*M);for(var t=p.length/h,A=new Float32Array(t),y=0;y<t;y++){A[y]=-1;for(var w in d){var D=d[w];if(D.Zq===y){A[y]=D.Mi;break}}}var G=3<t?t:4;d=new Float32Array(G);w=new Uint32Array(G);for(var y=new Float32Array(M),D=new Float32Array(G),G=new Uint32Array(G),
v=new Float32Array(M),T=0;T<h;T++)d.set(D),w.set(G),y.set(v),n.set(f(p,t,T,h,A,d,w,y),T*M)}else n=new Float32Array(0);p=m?I.Fa(m):{};p.a_color={Re:!0};p.a_color.src=s(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,ic:7}]:[];m={a_texcoord:E,a_influence:n};E=b.vertex_colors;n=b.color;t=[];for(A=0;A<E.length;A++)t.push(E[A].name);for(var F in p)if(A=p[F].src,A.length){for(w=d=0;w<A.length;w++)d+=I.hf(A[w].ic);m[F]=new Float32Array(d*h);for(w=y=0;w<A.length;w++){var x=A[w].name,D=A[w].ic,
G=I.gq(D),q=t.indexOf(x);if(-1==q)throw'B4W Error: vertex color "'+x+'" not found';v=E[q].mask;T=I.hf(v);(D&v)!==D&&g.error("B4W Error: Wrong color extraction from "+x+" to "+F+".");for(var aa=x=0;aa<q;aa++)x+=I.hf(E[aa].mask);q=x*h;for(x=0;x<h;x++)for(aa=0;aa<P;aa++)G[aa]&&(m[F][x*d+(y+I.Rh(D,aa))]=n[q+x*T+I.Rh(v,aa)]);y+=T}}else m[F]=new Float32Array(0);F=a.uv_textures;p=b.texcoord;E=b.texcoord2;a=a.name;if(l)for(var H in l){n=F.indexOf(H);if(-1==n)throw'B4W Error: uv map "'+H+'" for mesh "'+a+
'" not found';if(0==n)var V=new Float32Array(p);else 1==n&&(V=new Float32Array(E));m[l[H]]=V}k.v=m;k.ia=new Uint32Array(b.indices);H=b.position.length/h/O;a=(V=s(c,"a_normal")&&b.normal.length?!0:!1)&&s(c,"a_tangent")&&b.tangent.length?!0:!1;for(F=0;F<H;F++)l={},m=new Float32Array(h*O),p=new Float32Array(V?h*S:0),E=new Float32Array(a?h*Q:0),n=F*h*O,t=n+h*O,m.set(b.position.subarray(n,t),0),V&&(n=F*h*S,t=n+h*S,p.set(b.normal.subarray(n,t),0)),a&&(n=F*h*Q,t=n+h*Q,E.set(b.tangent.subarray(n,t),0)),l.a_position=
m,l.a_normal=p,l.a_tangent=E,k.r.push(l);if(1<H){b=k.r[0];l={};for(var Ea in b)l[Ea]=new Float32Array(b[Ea]);k.r.push(l)}s(c,"a_polyindex")&&(e(k,1,!0),k.v.a_polyindex=u(k));return k}function s(a,b){return-1<a.indexOf(b)?!0:!1}function f(a,b,c,d,m,e,g,l){for(var k=!0,f=0;f<b;f++){var h=a[f*d+c];if(-1!==h){var E=m[f];-1!==E&&(e[f]=h,g[f]=E,k=!1)}}if(k)return l;A(e,g);for(f=a=0;f<M;f++)a+=e[f];if(0.01>a)return l;for(f=0;f<M;f++)e[f]/=a;if(0.01>Math.abs(e[0]-1))l[0]=g[0]+1;else for(f=0;f<M;f++)l[f]=
g[f]+e[f];return l}function t(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function A(a,b,c){var d=a.length,m=d,e=!1;for(c=1==c?-1:1;1<m||e;){1<m&&(m=Math.floor(m/x));for(var e=!1,g=0;m+g<d;g++)0>c*(a[g]-a[g+m])&&(e=a[g],a[g]=a[g+m],a[g+m]=e,e=b[g],b[g]=b[g+m],b[g+m]=e,e=!0)}}function D(a,b,c){var d=[],m=[];G.subtract(b,a,d);G.subtract(c,a,m);G.normalize(d,d);G.normalize(m,m);return Math.acos(G.dot(d,
m))}function y(a,c,d){c||(c=[]);d=d?a.r[0].a_normal:a.r[0].a_position;if(b(a)){a=a.ia;for(var e=a.length/3,m=0;m<e;m++){var g=new Float32Array(9),l=a[3*m];g[0]=d[3*l];g[1]=d[3*l+1];g[2]=d[3*l+2];l=a[3*m+1];g[3]=d[3*l];g[4]=d[3*l+1];g[5]=d[3*l+2];l=a[3*m+2];g[6]=d[3*l];g[7]=d[3*l+1];g[8]=d[3*l+2];c[m]=g}}else for(m=0;m<d.length;m++)g=new Float32Array(9),g[0]=d[9*m],g[1]=d[9*m+1],g[2]=d[9*m+2],g[3]=d[9*m+3],g[4]=d[9*m+4],g[5]=d[9*m+5],g[6]=d[9*m+6],g[7]=d[9*m+7],g[8]=d[9*m+8],c[m]=g;return c}function u(a){for(var b=
new Float32Array(a.D),c=0;c<a.D;c++)b[c]=c%3;return b}var g=q("__print"),E=q("__tsr"),I=q("__util"),w=q("__extensions"),G=q("vec3"),F=65536,x=1.247330950103979,O=3,S=3,Q=4,P=3,M=4;a.Ec=10;a.en=20;a.IB=30;a.li=10;a.Wm=20;a.Um=30;a.kr=40;a.Vm=50;a.Cg=a.li;var H=null;a.Bc=function(a){H=a};a.hC=function(a){var b=_buffers[a];H.deleteBuffer(b.ce);H.deleteBuffer(b.vg);delete _buffers[a]};a.uA=function(d,g,l,r){c(d)&&b(d)&&e(d);var m=d.ia,f=d.D,k=d.r,h={},E;for(E in d.v)E in r&&!r[E].Re||(h[E]=d.v[E]);if(m.length)if(r=
m.length,f<=F){E=new Uint16Array(m);var u=H.UNSIGNED_SHORT}else E=new Uint32Array(m),u=H.UNSIGNED_INT;else r=f,E=null;var s=0,A=k.length,y;for(y in k[0])var I=k[0][y],s=s+I.length*A;for(y in h)I=h[y],s+=I.length;y=new Float32Array(s);var s=0,A={},w;for(w in h){var D=h[w];if(I=D.length)y.set(D,s),A[w]={JB:w,Ch:t(D,f),offset:s,frames:1,length:I},s+=I}h=k.length;for(w in k[0])if(D=k[0][w],I=D.length,D=t(D,f),I){A[w]={Ch:D,offset:s,frames:h,length:I};1<h&&(A[w+"_next"]={Ch:D,offset:s+I,frames:h,length:I});
for(var G=0;G<h;G++)D=k[G][w],y.set(D,s),s+=I}f={count:r,de:E,xe:y,ep:u,kc:A};p(f,l);n(f);g!=a.Ec&&b(d)&&(f.ol={cy:new Float32Array(m.length),dy:new Float32Array(m.length),tv:new Float32Array(m.length/3),type:g});return f};a.Jx=c;a.Hx=b;a.Lq=e;a.$B=function(a,b,c){var d={xe:[],kc:{}};p(d,a);d.mode==H.TRIANGLES?(d.count=b.length,d.de=b,d.ep=d.count<=F?H.UNSIGNED_SHORT:H.UNSIGNED_INT):d.mode==H.POINTS&&(d.count=c,d.de=null);return d};a.tf=function(a,b,c,d){var m=a.xe,e=a.kc,g=e[b];if(g){if(c&&g.Ch!=
c)throw'Error: invalid num_comp for "'+b+'"';m.set(d,g.offset)}else m=m.length,g=new Float32Array(m+d.length),g.set(a.xe),g.set(d,m),a.xe=g,e[b]={Ch:c,offset:m};n(a)};a.Kv=h;a.dD=function(a){a.Xj=H.STATIC_DRAW};a.Ap=function(a){a.Xj=H.DYNAMIC_DRAW};a.St=function(a){a.ce&&H.deleteBuffer(a.ce);a.vg&&H.deleteBuffer(a.vg)};a.ap=function(a,b){return a.submeshes[b].base_length?!1:!0};a.Kq=function(a,b){for(var c=0;c<a.r.length;c++){var d=a.r[c].a_position;E.Tj(d,b,d,0);d=a.r[c].a_normal;0<d.length&&E.Qq(d,
b,d,0);d=a.r[c].a_tangent;0<d.length&&E.Rq(d,b,d,0)}(c=a.v.au_center_pos)&&c.length&&E.Tj(c,b,c,0);return a};a.sA=function(a,b){var c=a.v.au_center_pos;if(c&&c.length){var d=new Float32Array(c);E.Tj(d,b,d,0);for(var m=0;m<a.r.length;m++)for(var e=0;e<d.length;e++)a.r[m].a_position[e]+=d[e]-c[e];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.rA=function(a,b){var c=a.D,d;for(d in b){var m=b[d].length;a.v[d]=new Float32Array(m*c);for(var e=0;e<c;e++)for(var g=0;g<m;g++)a.v[d][e*
m+g]=b[d][g]}};a.tA=k;a.Xx=function(a,b,c){if(!a.D)return I.lb("EMPTY");var d=c.length;a.D*d>F&&!w.Io()&&e(a,d);var m=a.ia,g=a.D,l=a.v;a=a.r;for(var f in b){var k=b[f].length,h=k*g;l[f]=new Float32Array(h);for(var n=0;n<g;n++)for(h=0;h<k;h++)l[f][n*k+h]=b[f][h]}b=I.lb("CLONE_"+d+"_SUBMESHES");b.D=g*d;b.ia=new Uint32Array(m.length*d);for(n=0;n<d;n++)for(k=m.length*n,f=g*n,h=0;h<m.length;h++)b.ia[k+h]=m[h]+f;for(var p in l)for(m=l[p],h=m.length*d,k=t(m,g),b.v[p]=new Float32Array(h),n=0;n<d;n++)f=g*
k*n,b.v[p].set(m,f);for(p in a[0])for(n=0;n<a.length;n++)for(m=a[n][p],h=m.length*d,k=t(m,g),b.r[n]=b.r[n]||{},b.r[n][p]=new Float32Array(h),h=0;h<d;h++)switch(l=c[h],f=g*k*h,p){case "a_position":E.Tj(m,l,b.r[n][p],f);break;case "a_normal":E.Qq(m,l,b.r[n][p],f);break;case "a_tangent":E.Rq(m,l,b.r[n][p],f);break;default:throw"Wrong attribute name: "+p;}return b};a.so=l;a.Lv=function(a){var b=a.D,c=a.r[0].a_position,d=new Float32Array(12*b),m=new Float32Array(8*b);a=new Uint16Array(4*a.ia.length);for(var e=
0;e<b;e++)d[12*e]=c[3*e],d[12*e+1]=c[3*e+1],d[12*e+2]=c[3*e+2],d[12*e+3]=c[3*e],d[12*e+4]=c[3*e+1],d[12*e+5]=c[3*e+2],d[12*e+6]=c[3*e],d[12*e+7]=c[3*e+1],d[12*e+8]=c[3*e+2],d[12*e+9]=c[3*e],d[12*e+10]=c[3*e+1],d[12*e+11]=c[3*e+2],m[8*e]=-0.5,m[8*e+1]=-0.5,m[8*e+2]=-0.5,m[8*e+3]=0.5,m[8*e+4]=0.5,m[8*e+5]=0.5,m[8*e+6]=0.5,m[8*e+7]=-0.5,a[6*e]=4*e+2,a[6*e+1]=4*e+1,a[6*e+2]=4*e,a[6*e+3]=4*e+2,a[6*e+4]=4*e,a[6*e+5]=4*e+3;c=I.lb("HALO");c.r=[];c.r[0]={};c.D=4*b;c.r[0].a_position=d;c.v.a_halo_bb_vertex=
m;c.ia=a;return c};a.px=s;a.Nv=function(a){for(var b=["a_position","a_normal"],c=[],d=0;d<a.submeshes.length;d++){var m=l(a,d,b,null,null,null);m.D&&c.push(m)}return 0==c.length?I.lb("EMPTY"):1==c.length?c[0]:k(c)};a.LA=function(a,b,c){for(var d=a.de,m=h(a,"a_position"),e=a.ol,g=e.cy,l=e.dy,e=e.tv,f=d,k=f.length/3,E=0;E<k;E++){var n=f[3*E],p=f[3*E+1],u=f[3*E+2],s=m[3*n+1],t=m[3*n+2],A=m[3*p+1],v=m[3*p+2],T=m[3*u+1],y=m[3*u+2];g[3*E]=(m[3*n]+m[3*p]+m[3*u])/3;g[3*E+1]=(s+A+T)/3;g[3*E+2]=(t+v+y)/3}I.ff(g,
b,l);b=g.length/3;for(m=0;m<b;m++)l=g[3*m]-c[0],f=g[3*m+1]-c[1],k=g[3*m+2]-c[2],e[m]=l*l+f*f+k*k;c=d;d=e.length;if(!(2>d))for(g=d,m=!1;1<g||m;)for(1<g&&(g=Math.floor(g/x)),m=!1,b=0;g+b<d;b++)0>e[b]-e[b+g]&&(m=e[b],e[b]=e[b+g],e[b+g]=m,m=c,l=b,f=b+g,k=m[3*l],E=m[3*l+1],n=m[3*l+2],m[3*l]=m[3*f],m[3*l+1]=m[3*f+1],m[3*l+2]=m[3*f+2],m[3*f]=k,m[3*f+1]=E,m[3*f+2]=n,m=!0);d=c;H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,a.ce);H.bufferData(H.ELEMENT_ARRAY_BUFFER,d,H.DYNAMIC_DRAW)};a.bA=A;a.ut=function(a,b,c){for(var d=
b.length/O,m=a.length/3,e=[],g=Array(3),l=Array(3),f=Array(3),k=0;k<m;k++){for(var h=a[3*k],E=a[3*k+1],n=a[3*k+2],p=0;p<O;p++)g[p]=b[O*h+p],l[p]=b[O*E+p],f[p]=b[O*n+p];if(c)var p=D(g,l,f),u=D(l,f,g),s=Math.PI-p-u;else s=u=p=1;var t=e,v;v=g;var T=f,A=[],y=[],I=[];G.subtract(l,v,A);G.subtract(T,v,y);G.cross(A,y,I);G.normalize(I,I);v=I;for(T=0;T<S;T++)A=S*E+T,y=S*n+T,t[S*h+T]=p*v[T],t[A]=u*v[T],t[y]=s*v[T]}if(c)for(var w in c)for(k=c[w],a=0;a<S;a++){b=S*k[0]+a;for(m=1;m<k.length;m++)g=S*k[m]+a,e[b]+=
e[g];for(m=1;m<k.length;m++)g=S*k[m]+a,e[g]=e[b]}for(k=0;k<d;k++){c=k;w=e;a=new Float32Array(S);for(b=0;b<S;b++)m=S*c+b,a[b]=w[m];G.normalize(a,a);for(b=0;b<S;b++)m=S*c+b,w[m]=a[b]}return e};a.vt=function(a,b,c){for(var d={},m=b.length/3,e=0;e<m;e++){var g=String(b[3*e])+String(b[3*e+1])+String(b[3*e+2]);d[g]=[]}m=a.length;for(e=0;e<m;e++)b=a[e],g=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),g in d&&d[g].push(b);return d};a.al=function(a,b,c,d){var m=y(a,null,!1);if(c)var e=y(a,null,!0);var g=
m.length,l=new Float32Array(g);for(a=0;a<g;a++){var f=m[a],k=l,h=a,E=f,n=new Float32Array([E[0],E[1],E[2]]),f=new Float32Array([E[3],E[4],E[5]]),p=new Float32Array([E[6],E[7],E[8]]),E=G.dist(n,f),n=G.dist(n,p),f=G.dist(f,p),p=(E+n+f)/2;k[h]=Math.sqrt(p*(p-E)*(p-n)*(p-f))}k=new Float32Array(g);k[0]=l[0];for(a=1;a<g;a++)k[a]=k[a-1]+l[a];g=k[l.length-1];l=[];for(a=0;a<b;a++){var h=g*I.lc(d),h=I.xi(k,h,0,k.length-1),f=c?e[h]:m[h],h=l,E=a,u=f,s=d,f=void 0,f=new Float32Array(3),n=u[0],t=u[1],v=u[2],p=u[3],
T=u[4],A=u[5],w=u[6],D=u[7],F=u[8],u=I.lc(s),s=I.lc(s);1<u+s&&(u=1-u,s=1-s);var x=1-u-s,t=x*t+u*T+s*D,v=x*v+u*A+s*F;f[0]=x*n+u*p+s*w;f[1]=t;f[2]=v;h[E]=f}return l};a.mC=y;a.Mv=u;a.hz=function(a,b,c){a=a.r[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]}};b4w.module.__particles=function(a,q){function c(){throw"_rand() undefined";}function b(a){a?(h.nA(a),c=function(){return h.Uy()}):c=function(){return Math.random()}}var e=q("__config"),d=q("__geometry"),h=q("__util"),p=q("vec3"),n=e.Hg,k=[0,0,0];a.Pf=function(a){return 0<a.particle_systems.length?!0:!1};a.ih=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;return!1};a.LC=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==
a.particle_systems[b].settings.type)return!0;return!1};a.rx=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.iw=function(e,k,f,t,A){f.Qb=f.Qb||{};var D=d.Nv(k),y=f.settings.count,u=f.settings.frame_start/n.Xa,g=f.settings.frame_end/n.Xa,E=f.settings.lifetime/n.Xa,I=f.settings.lifetime_random,w=f.settings.emit_from,G=f.settings.factor_random,F=f.settings.angular_velocity_mode,x=f.settings.angular_velocity_factor,
q=f.settings.b4w_randomize_emission;b(f.seed);if(k=t.halo?!1:!0){var S;S=[];for(var Q=0;Q<y;Q++)S.push(-0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,-0.5);S=new Float32Array(S);for(var Q=[],P=0;P<y;P++)Q.push(4*P,4*P+2,4*P+1,4*P,4*P+3,4*P+2);Q=new Uint16Array(Q)}switch(w){case "VERT":for(var P=D.r[0].a_position,D=D.r[0].a_normal,M=P.length/3,w=[],H=0;H<y;H++){var K=Math.round((M-1)*c());w.push(K);k&&(w.push(K),w.push(K),w.push(K))}M=[];for(H=0;H<w.length;H++)M.push(P[3*w[H]]),M.push(P[3*w[H]+1]),M.push(P[3*w[H]+
2]);P=new Float32Array(M);M=[];for(H=0;H<w.length;H++)M.push(D[3*w[H]]),M.push(D[3*w[H]+1]),M.push(D[3*w[H]+2]);w=new Float32Array(M);break;case "FACE":P=[];w=[];H=[];h.hj(0,H);M=d.al(D,y,!1,H);h.hj(0,H);D=d.al(D,y,!0,H);for(H=0;H<M.length;H++)P.push(M[H][0],M[H][1],M[H][2]),k&&(P.push(M[H][0],M[H][1],M[H][2]),P.push(M[H][0],M[H][1],M[H][2]),P.push(M[H][0],M[H][1],M[H][2])),w.push(D[H][0],D[H][1],D[H][2]),k&&(w.push(D[H][0],D[H][1],D[H][2]),w.push(D[H][0],D[H][1],D[H][2]),w.push(D[H][0],D[H][1],D[H][2]));
P=new Float32Array(P);w=new Float32Array(w);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}w=[P,w];D=w[0];w=w[1];f.Qb.Xp=new Float32Array(D);f.Qb.Hp=new Float32Array(w);f.Qb.Iy=new Float32Array(D.length);f.Qb.ny=new Float32Array(w.length);h.ff(D,A,D,0);h.Dm(w,A,w);A=[];u=(g-u)/y;for(g=0;g<y;g++)P=q?u*g+10*u*(0.5-c()):u*g,A.push(P),k&&(A.push(P),A.push(P),A.push(P));q=new Float32Array(A);f.Qb.nv=new Float32Array(q);A=[];I*=E;for(u=0;u<
y;u++)g=I*c(),A.push(E-g),k&&(A.push(E-g),A.push(E-g),A.push(E-g));E=new Float32Array(A);I=[];for(A=0;A<y;A++){u=[c()-0.5,c()-0.5,c()-0.5];p.normalize(u,u);I.push(G*u[0]);I.push(G*u[1]);I.push(G*u[2]);switch(F){case "NONE":I.push(0);break;case "SPIN":case "VELOCITY":I.push(x);break;case "RAND":I.push(2*x*(c()-0.5));break;default:throw"Undefined velocity factor";}if(k)for(u=I.slice(-4),g=0;12>g;g++)I.push(u[g%4])}G=new Float32Array(I);y=h.lb("EMITTER_PARTICLES");F=h.Vd();F.a_position=D;F.a_normal=
w;y.r[0]=F;k?y.ia=Q:(e.ld=d.Wm,y.ia=new Uint16Array(0));y.D=D.length/3;y.v.a_p_delay=q;y.v.a_p_lifetime=E;y.v.a_p_vels=G;k&&(y.v.a_p_bb_vertex=S);k=f.settings.lifetime/n.Xa;Q=f.settings.frame_end/n.Xa;E=f.settings.normal_factor;I=9.81*f.settings.effector_weights.gravity;S=f.settings.effector_weights.wind;G=f.settings.mass;F=f.settings.b4w_fade_in/n.Xa;x=f.settings.b4w_fade_out/n.Xa;q=f.settings.b4w_cyclic;e.Pp=f.settings.frame_start/n.Xa;e.Op=Q;e.Np=q?1:0;e.xy=E;e.uy=I;Q=a.ac();e.Ay=new Float32Array([Q[0]*
S,Q[1]*S,Q[2]*S]);e.wy=k;e.vy=G;e.sy=F;e.ty=x;t.halo?(k=t.halo.size,S=t.halo.hardness,30>S?(S=0.5,G=0.9):40>S?(S=0.1,G=1):50>S?(S=0,G=0.8):(S=0,G=0.5)):(k=f.settings.particle_size,G=S=1);e.yy=k;e.qy=S;e.py=G;k=f.settings.texture_slots;f=[-1,0,-1,0,-1,0,-1,0];if(k[0]&&k[0].use_map_size&&k[0].texture&&"BLEND"==k[0].texture.type&&k[0].texture.use_color_ramp)for(k=k[0].texture.color_ramp.elements,S=Math.min(2*k.length,f.length),G=0;G<S;G+=2)F=k[G/2],f[G]=F.position,f[G+1]=(F.color[0]+F.color[1]+F.color[2])/
3;e.zy=new Float32Array(f);k=t.texture_slots;f=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(k[0]&&"STRAND"==k[0].texture_coords&&k[0].texture&&"BLEND"==k[0].texture.type&&k[0].texture.use_color_ramp){k=k[0].texture.color_ramp.elements;S=Math.min(4*k.length,f.length);for(G=0;G<S;G+=4)F=k[G/4],f[G]=F.position,f[G+1]=F.color[0],f[G+2]=F.color[1],f[G+3]=F.color[2];t.texture_slots=[]}e.ry=new Float32Array(f);return y};a.OA=function(a){for(var b=a.aa,c=0;c<b.length;c++){var e=b[c],k=b[c].Bj;if(k){var e=e.Sb,
n=k.Qb.Iy,p=k.Qb.ny,u=k.Qb.Hp,g=a.d.I,E=p;h.ff(k.Qb.Xp,g,n,0);h.Dm(u,g,E);d.Ap(e);d.tf(e,"a_position",3,n);d.tf(e,"a_normal",3,p)}}};a.NA=function(a){for(var b=a.aa,c=0;c<b.length;c++){var e=b[c],k=b[c].Bj;if(k){var e=e.Sb,D=k.Qb.Xp,y=k.Qb.Hp,u=k.Qb.nv,g=k.settings.frame_start/n.Xa,E=a.f.e,I=a.f.xb;if(E&&I){for(var k=D,w=y,G=u,F=0;F<k.length;F+=3){var x=[k[F],k[F+1],k[F+2]],q=[w[F],w[F+1],w[F+2]],S=(G[F/3]+g)*n.Xa,Q=Math.floor(S),P=Q+1,M=S-Q;0<E.length&&0<=Q&&Q<E.length-1?(S=h.Dn(E[Q],E[P],M),Q=h.Dn(I[Q],
I[P],M)):(S=[0,0,0],Q=[0,0,0,1]);P=[];M=[];p.transformQuat(x,Q,P);p.transformQuat(q,Q,M);k[F]=P[0]+S[0];k[F+1]=P[1]+S[1];k[F+2]=P[2]+S[2];w[F]=M[0];w[F+1]=M[1];w[F+2]=M[2]}d.Ap(e);d.tf(e,"a_position",3,D);d.tf(e,"a_normal",3,y);d.tf(e,"a_p_delay",1,u)}}}};a.Jy=function(a){for(var b=a.D,c=a.r[0].a_position,d=a.v.a_texcoord,e=[],k=[],h=0;h<b;h++)k.push(c[3*h]),k.push(c[3*h+1]),e.push(c[3*h+2]);e=new Float32Array(e);k=new Float32Array(k);a.v.a_lf_dist=e;a.v.a_lf_bb_vertex=k;a.v.a_texcoord=d;return a};
a.Uj=function(a){"WIND"==a.field.type&&(a=a.d,h.Xb(a.h,h.ib,k),k=p.normalize(k,k),p.scale(k,a.xo,k))};a.ac=function(){return k};a.ga=function(){k[0]=0;k[1]=0;k[2]=0}};b4w.module.__primitives=function(a,q){function c(a,b,c,d){for(var e=[],h=[],A=[],D=[],y=2*c/(a-1),u=2*d/(b-1),g=0;g<a;g++)for(var E=-c+g*y,I=0;I<b;I++)if(h.push(E,0,-d+I*u),A.push(0,1,0),D.push(g/(a-1),I/(b-1)),g&&I){var w=g*b+I,G=w-1,F=(g-1)*b+I,x=F-1;e.push(w,G,F);e.push(G,x,F)}a=p.Vd();a.a_position=new Float32Array(h);a.a_normal=new Float32Array(A);A=p.lb("GRID_PLANE");A.r[0]=a;A.v.a_texcoord=new Float32Array(D);A.ia=new Uint32Array(e);A.D=h.length/3;return A}function b(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],e=[],f=0;f<b;f+=4){var h=a[f+1],A=a[f+2],D=a[f+3];d(a[f],e);d(h,e);d(A,e);d(D,e);c.push(f,f+1,f+2);c.push(f,f+2,f+3)}a=p.Vd();a.a_position=new Float32Array(e);b=p.lb("FROM_QUADS");b.r[0]=a;b.ia=new Uint32Array(c);b.D=e.length/3;return b}function e(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function d(a,b){b.push(a[0],a[1],a[2])}var h=q("__geometry"),p=q("__util");a.kw=function(){for(var a=p.lb("LINE"),b=[],c=0;2>c;c++)b.push(c);c=p.Vd();c.a_point=new Float32Array(b);
a.r[0]=c;a.ia=new Uint32Array(b);a.D=2;return a};a.xC=function(a,b){var d=c(2,2,a,b);d.name="PLANE";return d};a.wC=c;a.mw=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==D-1)||1==b%2&&(0==a||a==A-1)?!0:!1}var e=c/Math.pow(2,a-1),h=c=e,A=b+1,D=b+1;b=[];for(var e=[],y=[],u=0,g=0,E=-1,I=[],w=0;w<a;w++){for(var G=2*c/(A-1),F=2*h/(D-1),x=[],q=[],S=0,Q=0;Q<A;Q++){for(var P=-c+Q*G,M=[],H=0;H<D;H++){var K=-h+H*F;if(P>-u&&P<u&&K>-g&&K<g)M.push(-1),S++;else{for(var B=null,L=0;L<I.length;L+=3)if(P==
I[L]&&K==I[L+1]){B=I[L+2];break}L=null!==B?B:E+1;d(Q,H)?(M.push(-2),S++):(null==B&&(0!=H&&H!=D-1&&0!=Q&&Q!=A-1||w==a-1?y.push(G):(y.push(2*G),x.push(P,K,L)),e.push(P,0,K),E++),M.push(L));if(Q&&H)if(1==Q)if(d(Q-1,H)){if(1<H){var K=L-1,B=q[Q-1][H+1],r=B-1;b.push(L,K,r)}else B=q[Q-1][H+1],r=B-1;b.push(L,r,B)}else d(Q,H)||(K=L-1,B=q[Q-1][H],b.push(L,K,B));else if(Q==A-1){if(!d(Q,H))if(H==D-1)K=L-1,B=q[Q-1][H-1],r=q[Q-2][H],b.push(L,K,B),b.push(L,B,r);else{var K=L-1,B=q[Q-1][H],r=B-1,m=B+1;b.push(L,K,
r);b.push(L,r,B);b.push(L,B,m);2==H&&(m=q[Q-2][H-2],b.push(K,m,r))}}else 1==H?d(Q,H-1)?(K=q[Q-1][H],B=q[Q-1][H-1],b.push(L,B,K)):(K=M[H-1],B=q[Q-1][H],r=q[Q-2][H-1],b.push(L,K,B),b.push(K,r,B)):H==D-1?d(Q,H)||(K=M[H-1],B=q[Q-1][H-1],r=q[Q-2][H],b.push(L,K,B),b.push(L,B,r)):-1!=q[Q-1][H]&&-1!=q[Q-1][H-1]&&-1!=M[H-1]?(K=M[H-1],B=q[Q-1][H],r=q[Q-1][H-1],b.push(L,K,B),b.push(K,r,B),H==D-2&&d(Q,H+1)&&(m=q[Q-1][H+1],b.push(L,B,m))):H==D-2&&d(Q,H+1)&&(B=q[Q-1][H],m=q[Q-1][H+1],b.push(L,B,m))}}q.push(M)}I=
x;u=c;g=h;c*=2;h*=2}if(2E4>u)for(P=-2E4,e.push(-2E4,-1,-2E4),e.push(-2E4,-1,2E4),e.push(-u,-1,-g),e.push(-u,-1,g),e.push(2E4,-1,-2E4),e.push(2E4,-1,2E4),e.push(u,-1,-g),e.push(u,-1,g),L=E+1,b.push(L+3,L+2,L+1,L+2,L+0,L+1,L+6,L+4,L+2,L+4,L+0,L+2,L+5,L+7,L+1,L+7,L+3,L+1,L+5,L+4,L+7,L+7,L+4,L+6),G=2*u/(A-1),Q=0;8>Q;Q++)y.push(-G);a=p.Vd();a.a_position=new Float32Array(e);a.a_cascad_step=new Float32Array(y);c=p.lb("multigrid_plane");c.r[0]=a;c.ia=new Uint32Array(b);c.D=e.length/3;return c};a.vC=function(a){var b=
a.length;if(b%3)throw"Wrong array";for(var c=[],e=[],f=0;f<b;f+=3){var h=a[f+1],A=a[f+2];d(a[f],e);d(h,e);d(A,e);c.push(f,f+1,f+2)}a=p.Vd();a.a_position=new Float32Array(e);b=p.lb("FROM_TRIANGLES");b.r[0]=a;b.ia=new Uint32Array(c);b.D=e.length/3;return b};a.uC=b;a.jw=function(a){a=p.bB(a);var c=[];c.push(a[0],a[1],a[2],a[3]);c.push(a[0],a[3],a[5],a[4]);c.push(a[3],a[2],a[6],a[5]);c.push(a[1],a[7],a[6],a[2]);c.push(a[0],a[4],a[7],a[1]);c.push(a[4],a[5],a[6],a[7]);a=b(c);a.name="FRUSTUM";return a};
a.Ha=function(){var a=p.lb("BILLBOARD"),b=p.Vd();b.a_bb_vertex=new Float32Array([-0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,-0.5]);a.r[0]=b;a.ia=new Uint32Array([0,2,1,0,3,2]);a.D=4;return a};a.gw=function(){var a=p.lb("CUBEMAP_BOARD"),b=p.Vd();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.r[0]=b;a.ia=new Uint32Array([0,2,1,0,3,2]);a.D=4;return a};a.Bo=function(a,b){var c=p.lb("UV_SPHERE"),s,f,t=[],A=[],D=[];for(f=0;8>=f;f++)for(s=0;16>=s;s++){var y=s/16,u=f/8;A.push(-a*Math.cos(2*y*Math.PI)*Math.sin(u*
Math.PI)+b[0],a*Math.cos(u*Math.PI)+b[1],a*Math.sin(2*y*Math.PI)*Math.sin(u*Math.PI)+b[2])}for(f=y=0;8>f;f++)for(s=0;16>s;s++){var u=e(A,17*f+s+1),g=e(A,17*f+s),E=e(A,17*(f+1)+s),I=e(A,17*(f+1)+s+1);Math.abs(u[1])==a+b[1]?(d(u,t),d(E,t),d(I,t),D.push(y,y+1,y+2),y+=3):Math.abs(E[1])==a+b[1]?(d(u,t),d(g,t),d(E,t),D.push(y,y+1,y+2),y+=3):(d(u,t),d(g,t),d(E,t),d(I,t),D.push(y,y+1,y+2),D.push(y,y+2,y+3),y+=4)}s={};s.a_position=t;A=h.vt(D,A,t);s.a_normal=h.ut(D,t,A);s.a_tangent=[];c.v.a_influence=[];c.v.a_color=
[];c.v.a_texcoord=[];c.r[0]=s;c.ia=D;c.D=t.length/3;return c}};b4w.module.__prerender=function(a,q){var c=q("__config"),b=q("__debug"),e=q("__geometry"),d=q("vec3"),h=q("__util"),p=c.s,n="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH GLOW_MASK WIREFRAME".split(" ");a.Ly=function(a){if(-1<n.indexOf(a.type)){for(var c=!1,s=a.n,f=0;f<s.length;f++){var t=s[f],A=t,D=a,y=A.Ya,u=D.i;A.T=!0;y.rp=!1;if(y)if(y.gj)A.T=!1;else{var g=u.Zd,E=y.ed.J,I=y.Uf,g=Math.sqrt((E[0]-g[0])*(E[0]-g[0])+(E[1]-g[1])*(E[1]-g[1])+(E[2]-g[2])*(E[2]-g[2]));g>=Math.max(0,y.vh-0)&&g<
I?(y.rp=!0,"GLOW_MASK"!=D.type||Boolean(A.m.ae)?(u=u.Zk,y.Ui?y=!1:"STATIC"===y.type?(I=y.ed,y=I.J,y=h.gA(y,u,I.ua)):(I=y.wi,y=I.J,y=h.Gv(y,u,I.Nd,I.Od,I.Pd)),y?A.T=!1:"WIREFRAME"==D.type&&(A.T=A.m.bk==b.dn.WM_DEBUG_SPHERES?A.m.Nk:!A.m.Nk)):A.T=!1):A.T=!1}else A.T=!1;t.T&&(c=!0)}switch(a.type){case "WIREFRAME":break;default:a.T="MAIN_OPAQUE"===a.type||"DEPTH"===a.type||c?!0:!1}}if("MAIN_BLEND"==a.type&&(c=a.i.Zd,d.dist(c,a.ck)>p.rk&&p.qk&&a.n)){for(s=0;s<a.n.length;s++)t=a.n[s],A=t.m,f=t.Ya.I,A&&A.P&&
A.Xc!=e.Ec&&(A=A.Sb)&&t.T&&(t=A.ol)&&t.type==e.en&&e.LA(A,f,c);a.ck[0]=c[0];a.ck[1]=c[1];a.ck[2]=c[2]}}};b4w.module.__print=function(a){var q=!1,c=0,b=0;a.Pz=function(a){q=a};a.log=function(){q&&console.log.apply(console,arguments)};a.error=function(){c++;console.error.apply(console,arguments)};a.warn=function(){q&&(b++,console.warn.apply(console,arguments))};a.time=function(){q&&console.time.apply(console,arguments)};a.timeEnd=function(){q&&console.timeEnd.apply(console,arguments)};a.group=function(){q&&console.group.apply(console,arguments)};a.groupCollapsed=function(){q&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){q&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.ax=function(){return b};a.Hw=function(){return c};a.Vt=function(){c=b=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,q){function c(a,b,c){D?k.warn("WARNING "+String(c)+" for "+String(a)+' "'+b.name+'" undefined, reexport '+(b.library?"library "+d(b):"main scene")):y=!0}function b(a,b,c){D?k.warn('B4W Warning: "'+String(c)+'" for '+String(a)+' "'+b.name+'" is deprecated, reexport '+(b.library?'library "'+d(b)+'"':"main scene.")):y=!0}function e(a){D?k.warn(a):y=!0}function d(a){return a.library.split("/").slice(-1)[0]}function h(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;
a.materials=null;a.submeshes=null;var e=l.Sd(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var f=l.Di(d[c]);e.submeshes.push(f)}return e}var p=q("__boundings"),n=q("__curve"),k=q("__print"),l=q("__util"),s=q("vec3"),f=q("vec4"),t=q("quat"),A=q("mat4"),D=!0,y=!1;a.Kt=function(a){var g=a.worlds;if(0==g.length){D?k.warn("WARNING Datablock world is missing, reexport scene"):y=!0;var f={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,
0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},b4w_fog_color:[0.5,0.5,0.5],b4w_fog_density:0};g.push(f)}for(var g=a.worlds,h=0;h<g.length;h++){var f=g[h],p=f.b4w_ssao_settings;"dist_factor"in p||(c("world",f,"b4w_ssao_settings.dist_factor"),p.dist_factor=0,p.samples=16);"b4w_glow_color"in f||(f.b4w_glow_color=new Float32Array(3),f.b4w_glow_color=[1,1,1],c("object",f,"b4w_glow_color"));"b4w_glow_factor"in f||(f.b4w_glow_factor=1,c("object",f,"b4w_glow_factor"));
"b4w_fog_density"in f||(c("world",f,"b4w_fog_density"),f.b4w_fog_density=0);"b4w_sky_settings"in f&&"rayleigh_brightness"in f.b4w_sky_settings||(c("world",f,"rayleigh_brightness"),f.b4w_sky_settings={color:[0.24,0.43,0.75],rayleigh_brightness:3.3,mie_brightness:0.1,spot_brightness:10,scatter_strength:0.2,rayleigh_strength:0.2,mie_strength:0.006,rayleigh_collection_power:0.5,mie_collection_power:0.5,mie_distribution:0.4});"b4w_bloom_settings"in f?("blur"in f.b4w_bloom_settings||(c("world",f,"b4w_bloom_settings.blur"),
f.b4w_bloom_settings.blur=4),"edge_lum"in f.b4w_bloom_settings||(c("world",f,"b4w_bloom_settings.edge_lum"),f.b4w_bloom_settings.edge_lum=1)):(c("world",f,"b4w_bloom_settings"),f.b4w_bloom_settings={key:0.2,blur:4});"b4w_motion_blur_settings"in f?("motion_blur_factor"in f.b4w_motion_blur_settings||(c("world",f,"b4w_motion_blur_settings.motion_blur_factor"),f.b4w_motion_blur_settings.motion_blur_factor=0.01),"motion_blur_decay_threshold"in f.b4w_motion_blur_settings||(c("world",f,"b4w_motion_blur_settings.motion_blur_decay_threshold"),
f.b4w_motion_blur_settings.motion_blur_decay_threshold=0.01)):(c("world",f,"b4w_motion_blur_settings"),f.b4w_motion_blur_settings={motion_blur_factor:0.01,motion_blur_decay_threshold:0.01});"b4w_color_correction_settings"in f||(c("world",f,"b4w_color_correction_settings"),f.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in f.b4w_god_rays_settings||(c("world",f,"b4w_god_rays_settings.steps_per_pass"),f.b4w_god_rays_settings.steps_per_pass=10)}g=a.scenes;
for(h=0;h<g.length;h++)f=g[h],"b4w_use_nla"in f||(f.b4w_use_nla=!1,c("scene",f,"b4w_use_nla")),"b4w_nla_cyclic"in f||(f.b4w_nla_cyclic=!1,c("scene",f,"b4w_nla_cyclic")),"b4w_detect_collisions"in f&&(b("scene",f,"b4w_detect_collisions"),delete f.b4w_detect_collisions),"audio_doppler_speed"in f||(f.audio_doppler_speed=343.3),"audio_doppler_factor"in f||(f.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in f||(f.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:0.003,release:0.25},
c("scene",f,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in f||(f.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in f||(f.b4w_enable_bloom=!1,c("scene",f,"b4w_enable_bloom")),"b4w_enable_motion_blur"in f||(f.b4w_enable_motion_blur=!1,c("scene",f,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in f||(f.b4w_enable_color_correction=!1,c("scene",f,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in f||(f.b4w_enable_antialiasing=!0,c("scene",f,"b4w_enable_antialiasing"));
g=a.meshes;for(h=0;h<g.length;h++)f=g[h],f.b4w_bounding_box||(c("mesh",f,"b4w_bounding_box"),f.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0}),f.uv_textures||(c("mesh",f,"uv_textures"),f.uv_textures=[]),f.b4w_bounding_sphere_center||(f.b4w_bounding_sphere_center=[0,0,0]),f.b4w_bounding_cylinder_center||(f.b4w_bounding_cylinder_center=[0,0,0]),f.b4w_bounding_ellipsoid_center||(f.b4w_bounding_ellipsoid_center=[0,0,0]),f.b4w_bounding_ellipsoid_axes||(p=f.b4w_bounding_box,f.b4w_bounding_ellipsoid_axes=
[(p.max_x-p.min_x)/2,(p.max_y-p.min_y)/2,(p.max_z-p.min_z)/2]);g=a.cameras;for(h=0;h<g.length;h++)f=g[h],f.type||(f.type="PERSP",c("camera",f,"type")),"b4w_eye_target_dist"in f&&(delete f.b4w_eye_target_dist,b("camera",f,"b4w_eye_target_dist")),"b4w_use_distance_limits"in f||(f.b4w_use_distance_limits=!1,c("camera",f,"b4w_use_distance_limits")),"b4w_distance_min"in f||(f.b4w_distance_min=1,c("camera",f,"b4w_distance_min")),"b4w_distance_max"in f||(f.b4w_distance_max=100,c("camera",f,"b4w_distance_max")),
"b4w_use_vertical_clamping"in f||(f.b4w_use_vertical_clamping=!1,c("camera",f,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in f||(f.b4w_rotation_down_limit=Math.PI/2,c("camera",f,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in f||(f.b4w_rotation_up_limit=Math.PI/2,c("camera",f,"b4w_rotation_up_limit"));g=a.lamps;for(h=0;h<g.length;h++)f=g[h],"b4w_generate_shadows"in f||(f.b4w_generate_shadows=!1,c("lamp",f,"b4w_generate_shadows")),"b4w_dynamic_intensity"in f||(f.b4w_dynamic_intensity=
!1,c("lamp",f,"b4w_dynamic_intensity"));g=a.speakers;for(h=0;h<g.length;h++)f=g[h],"b4w_behavior"in f||(f.b4w_behavior=f.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in f||(f.b4w_disable_doppler=!1),"b4w_delay"in f||(f.b4w_delay=0),"b4w_delay_random"in f||(f.b4w_delay_random=0),"b4w_volume_random"in f||(f.b4w_volume_random=0),"b4w_pitch_random"in f||(f.b4w_pitch_random=0),"b4w_fade_in"in f||(f.b4w_fade_in=0),"b4w_fade_out"in f||(f.b4w_fade_out=0),"b4w_loop"in f||(f.b4w_loop=
!1),"b4w_loop_count"in f||(f.b4w_loop_count=0),"b4w_loop_count_random"in f||(f.b4w_loop_count_random=0),"b4w_playlist_id"in f||(f.b4w_playlist_id="");g=a.textures;for(h=0;h<g.length;h++)f=g[h],"b4w_anisotropic_filtering"in f||(f.b4w_anisotropic_filtering="OFF",c("texture",f,"b4w_anisotropic_filtering")),"b4w_water_foam"in f||(f.b4w_water_foam=!1,c("texture",f,"b4w_water_foam")),"b4w_foam_uv_freq"in f||(f.b4w_foam_uv_freq=0,c("texture",f,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in f||(f.b4w_foam_uv_magnitude=
0,c("texture",f,"b4w_foam_uv_magnitude")),"b4w_foam_uv_magnitude"in f||(f.b4w_foam_uv_magnitude=0,c("texture",f,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in f||(f.b4w_parallax_steps=5,c("material",f,"b4w_parallax_steps")),"b4w_shore_dist_map"in f||(f.b4w_shore_dist_map=!1,c("texture",f,"b4w_shore_dist_map")),"b4w_shore_boundings"in f||(f.b4w_shore_boundings=new Float32Array(4),f.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],c("texture",f,"b4w_shore_boundings")),"b4w_max_shore_dist"in f||(f.b4w_max_shore_dist=
100,c("texture",f,"b4w_max_shore_dist")),"b4w_disable_compression"in f||(f.b4w_disable_compression=!1,c("texture",f,"b4w_disable_compression"));g=a.materials;for(h=0;h<g.length;h++)for(f=g[h],("b4w_node_mat_type"in f)&&b("material",f,"b4w_node_mat_type"),f.b4w_water&&("b4w_water_shore_smoothing"in f||(f.b4w_water_shore_smoothing=!1,c("material",f,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in f||(f.b4w_water_dynamic=!1,c("material",f,"b4w_water_dynamic")),"b4w_waves_height"in f||(f.b4w_waves_height=
1,c("material",f,"b4w_waves_height")),"b4w_waves_length"in f||(f.b4w_waves_length=1,c("material",f,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in f||(f.b4w_water_dst_noise_scale0=0.05,c("material",f,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in f||(f.b4w_water_dst_noise_scale1=0.03,c("material",f,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in f||(f.b4w_water_dst_noise_freq0=1.3,c("material",f,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in f||(f.b4w_water_dst_noise_freq1=
1,c("material",f,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in f||(f.b4w_water_dir_min_shore_fac=0.4,c("material",f,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in f||(f.b4w_water_dir_freq=0.5,c("material",f,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in f||(f.b4w_water_dir_noise_scale=0.05,c("material",f,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in f||(f.b4w_water_dir_noise_freq=0.07,c("material",f,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in
f||(f.b4w_water_dir_min_noise_fac=0.5,c("material",f,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in f||(f.b4w_water_dst_min_fac=0.2,c("material",f,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in f||(f.b4w_water_waves_hor_fac=5,c("material",f,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in f||(f.b4w_water_absorb_factor=6,c("material",f,"b4w_water_absorb_factor")),"b4w_water_fog_color"in f||(f.b4w_water_fog_color=new Float32Array(3),f.b4w_water_fog_color=[0.5,0.7,0.7],c("material",
f,"b4w_water_fog_color")),"b4w_foam_factor"in f||(f.b4w_foam_factor=5,c("material",f,"b4w_foam_factor")),"b4w_generated_mesh"in f||(f.b4w_generated_mesh=!1,c("material",f,"b4w_generated_mesh")),"b4w_water_num_cascads"in f||(f.b4w_water_num_cascads=5,c("material",f,"b4w_water_num_cascads")),"b4w_water_subdivs"in f||(f.b4w_water_subdivs=64,c("material",f,"b4w_water_subdivs")),"b4w_water_detailed_dist"in f||(f.b4w_water_detailed_dist=1E3,c("material",f,"b4w_water_detailed_dist"))),("b4w_dynamic_grass_size"in
f)||(f.b4w_dynamic_grass_size=""),("b4w_dynamic_grass_color"in f)||(f.b4w_dynamic_grass_color=""),("diffuse_intensity"in f)||(f.diffuse_intensity=1,c("material",f,"diffuse_intensity")),("b4w_procedural_skydome"in f)||(f.b4w_procedural_skydome=!1,c("material",f,"b4w_procedural_skydome")),("b4w_use_ghost"in f)||(f.b4w_use_ghost=!1),("b4w_collision_group"in f)||(f.b4w_collision_group=128,c("material",f,"b4w_collision_group")),("b4w_collision_mask"in f)||(f.b4w_collision_mask=127,c("material",f,"b4w_collision_mask")),
"HALO"!=f.type||("b4w_halo_sky_stars"in f)||(f.b4w_halo_sky_stars=!1,c("material",f,"b4w_halo_sky_stars")),"HALO"!=f.type||("b4w_halo_stars_blend_height"in f)||(f.b4w_halo_stars_blend_height=10,c("material",f,"b4w_halo_stars_blend_height")),"HALO"!=f.type||("b4w_halo_stars_min_height"in f)||(f.b4w_halo_stars_min_height=0,c("material",f,"b4w_halo_stars_min_height")),("specular_shader"in f)||(f.specular_shader="COOKTORR",c("material",f,"specular_shader")),("diffuse_shader"in f)||(f.diffuse_shader="LAMBERT",
c("material",f,"diffuse_shader")),("roughness"in f)||(f.roughness=0.5,c("material",f,"roughness")),("diffuse_fresnel"in f)||(f.diffuse_fresnel=0.1,c("material",f,"diffuse_fresnel")),("diffuse_fresnel_factor"in f)||(f.diffuse_fresnel_factor=0.5,c("material",f,"diffuse_fresnel_factor")),("specular_slope"in f)||(f.specular_slope=0.2,c("material",f,"specular_slope")),("b4w_wettable"in f)||(f.b4w_wettable=!1,c("material",f,"b4w_wettable")),("b4w_shallow_water_col"in f)||(f.b4w_shallow_water_col=[0,0.8,
0.3],c("material",f,"b4w_shallow_water_col")),("b4w_shore_water_col"in f)||(f.b4w_shore_water_col=[0,0.9,0.2],c("material",f,"b4w_shore_water_col")),("b4w_shallow_water_col_fac"in f)||(f.b4w_shallow_water_col_fac=1,c("material",f,"b4w_shallow_water_col_fac")),("b4w_shore_water_col_fac"in f)||(f.b4w_shore_water_col_fac=0.5,c("material",f,"b4w_shore_water_col_fac")),("b4w_water_sss_strength"in f)||(f.b4w_water_sss_strength=5.9,c("material",f,"b4w_water_sss_strength")),("b4w_water_sss_width"in f)||(f.b4w_water_sss_width=
0.45,c("material",f,"b4w_water_sss_width")),p=f.texture_slots,f=0;f<p.length;f++){var n=p[f];"blend_type"in n||(n.blend_type="MIX",c("texture_slot",n,"blend_type"))}a=a.objects;for(h=0;h<a.length;h++){g=a[h];switch(g.type){case "MESH":"b4w_dynamic_geometry"in g||(g.b4w_dynamic_geometry=!1);"b4w_reflexible"in g||(g.b4w_reflexible=!1);"b4w_reflexible_only"in g||(g.b4w_reflexible_only=!1);"b4w_reflective"in g||(g.b4w_reflective=!1);"b4w_wind_bending"in g||(g.b4w_wind_bending=!1,c("object",g,"b4w_wind_bending"));
"b4w_wind_bending_angle"in g||(g.b4w_wind_bending_angle=10,g.b4w_wind_bending_freq=0.25,c("object",g,"wind bending params"));"b4w_detail_bending_amp"in g||(g.b4w_detail_bending_amp=0.1,g.b4w_branch_bending_amp=0.3,c("object",g,"detail bending params"));"b4w_detail_bending_freq"in g||(g.b4w_detail_bending_freq=1,c("object",g,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in g||(g.b4w_main_bend_stiffness_col="",c("object",g,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in g||(g.b4w_detail_bend_colors=
{leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},c("object",g,"b4w_detail_bend_colors"));"b4w_caustics"in g||(g.b4w_caustics=!1);"vertex_groups"in g&&g.vertex_groups.length&&g.data&&0==g.data.vertex_groups.length&&(g.data.vertex_groups=g.vertex_groups,delete g.vertex_groups,c("object",g,"vertex_groups"));"b4w_vertex_anim"in g&&g.b4w_vertex_anim.length&&g.data&&0==g.data.b4w_vertex_anim.length&&(g.data.b4w_vertex_anim=g.b4w_vertex_anim,delete g.b4w_vertex_anim,c("object",g,"b4w_vertex_anim"));
"b4w_do_not_render"in g||(g.b4w_do_not_render=!1);"use_ghost"in g.game||(g.game.use_ghost=!1);"use_sleep"in g.game||(g.game.use_sleep=!1);"velocity_min"in g.game||(g.game.velocity_min=0);"velocity_max"in g.game||(g.game.velocity_max=0);"collision_group"in g.game||(g.game.collision_group=1);"collision_mask"in g.game||(g.game.collision_mask=255);"b4w_vehicle_settings"in g?g.b4w_vehicle_settings&&("steering_ratio"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.steering_ratio=10),"steering_max"in g.b4w_vehicle_settings||
(g.b4w_vehicle_settings.steering_max=1),"inverse_control"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.inverse_control=!1),"force_max"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.force_max=1500),"brake_max"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.brake_max=100),"speed_ratio"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.speed_ratio=0.027),"max_speed_angle"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.max_speed_angle=Math.PI),"delta_tach_angle"in g.b4w_vehicle_settings||
(g.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.roll_influence=
0.1),"max_suspension_travel_cm"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.floating_factor=3),"floating_factor"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.water_lin_damp=0.9),"water_rot_damp"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.water_rot_damp=0.9)):(g.b4w_vehicle_settings=null,c("object",g,
"b4w_vehicle_settings"));"b4w_floating_settings"in g?g.b4w_floating_settings&&("floating_factor"in g.b4w_floating_settings||(g.b4w_floating_settings.floating_factor=3),"water_lin_damp"in g.b4w_floating_settings||(g.b4w_floating_settings.water_lin_damp=0.8),"water_rot_damp"in g.b4w_floating_settings||(g.b4w_floating_settings.water_rot_damp=0.8)):(g.b4w_floating_settings=null,c("object",g,"b4w_floating_settings"));"b4w_character_settings"in g?g.b4w_character_settings&&("walk_speed"in g.b4w_character_settings||
(g.b4w_character_settings.walk_speed=4),"run_speed"in g.b4w_character_settings||(g.b4w_character_settings.run_speed=8),"step_height"in g.b4w_character_settings||(g.b4w_character_settings.step_height=0.25),"jump_strength"in g.b4w_character_settings||(g.b4w_character_settings.jump_strength=5),"waterline"in g.b4w_character_settings||(g.b4w_character_settings.waterline=0)):(g.b4w_character_settings=null,c("object",g,"b4w_character_settings"));"b4w_selectable"in g||(g.b4w_selectable=!1,c("object",g,"b4w_selectable"));
"b4w_glow_settings"in g||(g.b4w_glow_settings={},g.b4w_glow_settings.glow_duration=1,g.b4w_glow_settings.glow_period=1,g.b4w_glow_settings.glow_relapses=0,c("object",g,"b4w_glow_settings"));"b4w_lods_num"in g||(g.b4w_lods_num=0,c("object",g,"b4w_lods_num"));break;case "EMPTY":"b4w_group_relative"in g||(g.b4w_group_relative=!1,c("object",g,"b4w_group_relative"))}if(!("rotation_quaternion"in g)){f=[0,0,0,1];l.Mf(g.rotation_euler,f);var p=f,n=f[0],t=f[1],s=f[2];p[0]=f[3];p[1]=n;p[2]=t;p[3]=s;g.rotation_quaternion=
f;c("object",g,"rotation_quaternion")}"webgl_do_not_batch"in g&&(g.b4w_do_not_batch=g.webgl_do_not_batch)&&b("object",g,"webgl_do_not_batch");"b4w_shadow_cast_only"in g||(g.b4w_shadow_cast_only=!1,c("object",g,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in g||(g.b4w_correct_bounding_offset="AUTO",c("object",g,"b4w_correct_bounding_offset"));p=g.particle_systems;for(f=0;f<p.length;f++)n=p[f],t=n.settings,"use_whole_group"in t||(t.use_whole_group=!1,c("object",t,"use_whole_group")),n.transforms||
(n.transforms=new Float32Array,c("particle_system",n,"transforms")),"b4w_billboard_align"in t||(t.b4w_billboard_align="VIEW",c("particle_settings",t,"b4w_billboard_align")),"b4w_dynamic_grass"in t||(t.b4w_dynamic_grass=!1,c("object",t,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in t||(t.b4w_dynamic_grass_scale_threshold=0.01,c("object",t,"b4w_dynamic_grass_scale_threshold")),"b4w_initial_rand_rotation"in t||(t.b4w_initial_rand_rotation=!1,c("particle_settings",t,"b4w_initial_rand_rotation")),
"b4w_rotation_type"in t||(t.b4w_rotation_type="Z",c("particle_settings",t,"b4w_rotation_type")),"b4w_rand_rotation_strength"in t||(t.b4w_rand_rotation_strength=1,c("particle_settings",t,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in t||(t.b4w_hair_billboard=!1,c("particle_settings",t,"b4w_hair_billboard")),"b4w_hair_billboard_type"in t||(t.b4w_hair_billboard_type="BASIC",c("particle_settings",t,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in t||(t.b4w_hair_billboard_jitter_amp=
0,c("particle_settings",t,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in t||(t.b4w_hair_billboard_jitter_freq=0,c("particle_settings",t,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in t||(t.b4w_hair_billboard_geometry="SPHERICAL",c("particle_settings",t,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in t||(t.b4w_wind_bend_inheritance="PARENT",c("particle_settings",t,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in t||(t.b4w_shadow_inheritance=
"PARENT",c("particle_settings",t,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in t||(t.b4w_reflection_inheritance="PARENT",c("particle_settings",t,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in t||(t.b4w_vcol_from_name="",c("particle_settings",t,"b4w_vcol_from_name")),"b4w_vcol_to_name"in t||(t.b4w_vcol_to_name="",c("particle_settings",t,"b4w_vcol_to_name"));"constraints"in g||(g.constraints=[],c("object",g,"constraints"));p=g.modifiers;for(f=0;f<p.length;f++){a:{n=p[f];switch(n.type){case "ARRAY":if(!("fit_type"in
n)){D?k.error("WARNING Incomplete modifier "+String(n.type)+' for "'+g.name+'", reexport '+(g.library?"library"+d(g):"main scene")):y=!0;n=!1;break a}}n=!0}n||(p.splice(f,1),f--)}"animation_data"in g||(g.animation_data={action:null,nla_tracks:[]},c("object",g,"animation_data"));if(g.animation_data)for(("action"in g.animation_data)||(g.animation_data.action=null,e("B4W Warning: no action in animation data "+g.name)),("nla_tracks"in g.animation_data)||(g.animation_data.nla_tracks=[],e("B4W Warning: no NLA in animation data "+
g.name)),p=g.animation_data.nla_tracks,f=0;f<p.length;f++)for(n=p[f],t=0;t<n.strips.length;t++)"action"in n.strips[t]||(n.strips[t].action=null,e("B4W Warning: no action in NLA strip "+g.name));"b4w_collision_id"in g||(g.b4w_collision_id="",c("material",g,"b4w_collision_id"));f=g.scale;p=Math.abs((f[1]-f[2])/f[1]);0.001>Math.abs((f[0]-f[1])/f[0])&&0.001>p||e("B4W Warning: non-uniform scale for object "+g.name)}y&&k.error("Compatibility issues detected")};a.Ws=function(a){var b;a:{b=a.modifiers;for(var c=
0;c<b.length;c++){var d=b[c].type;if("ARRAY"==d||"CURVE"==d){b=!0;break a}}b=!1}if(!b)return null;b=h(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var e=a[c];switch(e.type){case "ARRAY":for(var d=b,k=e,y=0,D=0,q=0,S=new Float32Array(16),e=[],Q=1;Q<k.count;Q++){k.use_constant_offset&&(y+=k.constant_offset_displace[0],D+=k.constant_offset_displace[1],q+=k.constant_offset_displace[2]);if(k.use_relative_offset)var P=d.b4w_bounding_box,y=y+(P.max_x-P.min_x)*k.relative_offset_displace[0],
D=D+(P.max_y-P.min_y)*k.relative_offset_displace[1],q=q+(P.max_z-P.min_z)*k.relative_offset_displace[2];l.CA(y,D,q,S);for(var M=P=h(d),H=S,K=0;K<M.submeshes.length;K++){var B=M.submeshes[K];l.ff(B.position,H,B.position,0);l.Dm(B.normal,H,B.normal);l.yA(B.tangent,H,B.tangent)}e.push(P)}for(Q=0;Q<e.length;Q++)for(k=d,y=e[Q],D=0;D<k.submeshes.length;D++){q=k.submeshes[D];S=y.submeshes[D];P=q.base_length;M=q.indices.length;q.base_length+=S.base_length;for(var L in q)if("base_length"!=L)if("indices"==
L)for(q[L]=l.FA(q[L],S[L]),H=M;H<q.indices.length;H++)q.indices[H]+=P;else q[L]=l.Rv(q[L],S[L])}break;case "CURVE":for(var d=b,Q=e.object.Ds,k=new Float32Array(16),D=Q.ee?4:3,y=new Float32Array(D),D=new Float32Array(D),q=new Float32Array(3),S=new Float32Array(4),P=new Float32Array(4),M=new Float32Array(3),H=new Float32Array(3),K=new Float32Array(3),B=new Float32Array(4),r=new Float32Array(4),m=0;m<d.submeshes.length;m++){var R=d.submeshes[m],U=R.position,X=R.normal,R=R.tangent,Z;a:switch(Z=e.deform_axis,
Z){case "POS_X":case "NEG_X":Z=0;break a;case "POS_Y":case "NEG_Y":Z=1;break a;case "POS_Z":case "NEG_Z":Z=2;break a;default:throw"Wrong deform axis value "+Z;}M[0]=0;M[1]=0;M[2]=0;M[Z]=1;for(var ha=n.jA(Q),z=0;z<U.length/3;z++){K[0]=U[3*z];K[1]=U[3*z+1];K[2]=U[3*z+2];var ea=K[Z],ka=n.iA(Q,ea);n.kA(Q,ka,y);q[0]=y[0];q[1]=y[1];q[2]=y[2];n.hA(Q,ka,D);H[0]=D[0];H[1]=0;H[2]=D[2];s.normalize(H,H);t.rotationTo(M,H,S);0>ea?(y[0]=H[0],y[1]=H[1],y[2]=H[2],s.scale(y,ea,y),s.add(q,y,q)):ea>ha&&(y[0]=H[0],y[1]=
H[1],y[2]=H[2],s.scale(y,ea-ha,y),s.add(q,y,q));A.fromRotationTranslation(S,q,k);Q.ee&&(t.setAxisAngle(M,y[3],P),s.transformQuat(K,P,K));K[Z]=0;s.transformMat4(K,k,K);U[3*z]=K[0];U[3*z+1]=K[1];U[3*z+2]=K[2];X.length&&(B[0]=X[3*z],B[1]=X[3*z+1],B[2]=X[3*z+2],B[3]=0,f.transformMat4(B,k,B),X[3*z]=B[0],X[3*z+1]=B[1],X[3*z+2]=B[2]);R.length&&(r[0]=R[3*z],r[1]=R[3*z+1],r[2]=R[3*z+2],r[3]=0,f.transformMat4(r,k,r),R[3*z]=r[0],R[3*z+1]=r[1],R[3*z+2]=r[2])}}}p.Yy(b)}return b};a.cC=function(){return{name:"DEFAULT",
use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[0.8,0.8,0.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:0.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:0.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[0.5,0.5,
0.5],b4w_water_fog_density:0.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_terrain_tex_type:"B4W_TERRAIN_NONE",b4w_skydome:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:0.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},node_tree:null,texture_slots:[]}}};b4w.module.__scenegraph=function(a,q){function c(a){a=la.Fa(a);a.$d=null;a.ab=null;a.ec=null;return a}function b(a,b){var c=[];N.sf(a,function(b,d,m){-1<c.indexOf(m)?N.bz(a,b,d,m,h(m)):c.push(m)});N.S(a,function(b,d){for(var m=0;m<d.Z.length;m++){var f=d.Z[m];-1<c.indexOf(f)?d.Z[m]=h(f):c.push(f)}"ANTIALIASING"==d.type&&N.Ed(a,b,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.Z.length;c++){var d=b.Z[c];d.oa=ba.t;d.na=ba.t}})});N.S(a,function(c){var m={};e(a,c,m);for(var f in m){c=m[f];if(b)for(var g=
0;g<c.length;g++){var v=c[g];if("DEPTH"==v.A){if(d(v))throw"Failed to use renderbuffer as input texture: "+v.A+"->"+v.W;v.tg=!0}}v=c[0];for(g=0;g<c.length;g++)if(c[g].oa==ba.t){v=c[g];break}for(var k=c[0],g=0;g<c.length;g++)if(c[g].na==ba.t){k=c[g];break}for(var r=c[0],g=0;g<c.length;g++)if(!c[g].tg){r=c[g];break}for(g=0;g<c.length;g++)c[g].oa=v.oa,c[g].na=k.na,c[g].tg=r.tg}})}function e(a,b,c){N.Ed(a,b,function(b,d,m){m.Da&&m.A==m.W&&(c[m.A]=c[m.A]||[],-1==c[m.A].indexOf(m)&&c[m.A].push(m),e(a,b,
c))});N.we(a,b,function(a,b,d){d.Da&&(c[d.A]=c[d.A]||[],-1==c[d.A].indexOf(d)&&c[d.A].push(d))});b=N.Sa(a,b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.Z.length;d++){var m=b.Z[d];c[m.A].push(m)}}function d(a){switch(a.W){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "NONE":return!1;default:return!0}}function h(a){if(a.va)throw"Failed to clone slink with attached texture";return la.Sd(a)}function p(a){var b=N.Pq(a),c=[];N.S(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var m=
[];break;default:m=c}for(var e=0;e<d.Z.length;e++){var g=d.Z[e],v=f(m,g,k(g));g.va=v;d.Pb[e]=v}for(e=0;e<d.Pb.length;e++)v=d.Pb[e],s(m,v);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":m=[]}N.we(b,a,function(c,d,e){if((c=l(b,a,e.A))&&e.Da&&!e.va){if(e.A!=e.W){d=m;for(var g=c,v=0;v<d.length;v++){var r=d[v];r.qm===g&&r.Ph++}}}else c=f(m,e,k(e));e.va=c});N.Ed(b,a,function(a,b,c){c.A!=c.W&&s(m,c.va)});N.we(b,a,function(a,b,c){c.va&&"NONE"==
c.W&&s(m,c.va)})})}function n(a){A(a,function(b,c,d){b.gi&&(v(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||v(a,d,"ANTIALIASING"))&&(b.of*=Ba.Mb)})}function k(a){a=la.Sd(a);delete a.W;delete a.Da;return JSON.stringify(a)}function l(a,b,c){var d=null;N.Ed(a,b,function(a,b,m){if(m.Da&&m.A==m.W&&m.A==c&&m.va)return d=m.va,!0});N.we(a,b,function(a,b,m){if(m.Da&&m.A==c&&m.va)return d=m.va,!0});return d}function s(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.qm===b&&d.Ph&&d.Ph--}}
function f(a,b,c){for(var d=null,m=0;m<a.length;m++){var f=a[m];if(f.id==c&&0===f.Ph){d=f;break}}if(d&&!xa)return d.Ph++,d.qm;b=t(b);a.push({id:c,Ph:1,qm:b});return b}function t(a){var b=a.of*a.size;switch(a.A){case "COLOR":var c=ba.Ki("COLOR",ba.Ce);ba.dg(c,b,b);ba.Kj(c,a.oa,a.na);return c;case "DEPTH":return a.tg?(c=ba.Ki("DEPTH_RBUF",ba.Af),ba.dg(c,b,b)):(c=ba.Ki("DEPTH_TEX",ba.Dg),ba.dg(c,b,b),ba.Kj(c,a.oa,a.na)),c;case "CUBEMAP":return c=ba.wu(b);case "SCREEN":return null;default:throw"Wrong slink param: "+
a.A;}}function A(a,b){var c=!1;N.sf(a,function(d,m,f){if(f&&(d=N.Sa(a,d),m=N.Sa(a,m),b(f,!1,d,m)))return c=!0});c||N.S(a,function(a,c){for(var d=0;d<c.Z.length;d++)if(b(c.Z[d],!0,c,null))return!0})}function D(a){N.S(a,function(b,c){if("SINK"!=c.type){var d=c.i;N.we(a,b,function(a,b,c){c.Da&&c.va&&(V.Ij(d,c.A,c.va),c.A==c.W&&b.i&&V.Ij(b.i,c.A,c.va))});for(var m=0;m<c.Z.length;m++){var f=c.Z[m];f.Da&&f.A==f.W&&V.Ij(d,f.A,c.Pb[m])}!d.ab&&!d.ec||d.$d||(d.$d=ia.fq(d.ab,d.ec))}})}function y(a){var b=u("SHADOW_CAST");
b.K=!0;b.fo=a;b.ac=new Float32Array(3);a=V.hb(V.Fg);b.i=a;return b}function u(a){var b={};b.type=a;b.n=[];b.T=!0;b.K=!0;b.da=!0;b.ha=!0;b.mb=!0;b.P=!1;b.tk=!1;b.Px=[];b.Ma=!0;b.Z=[];b.Pb=[];b.Li=0;b.sl=new Float32Array(2);return b}function g(a,b,c,d,m){return{A:a,W:b,size:c,of:d,gi:m,Da:!0,va:null,tg:!1,oa:ba.bc,na:ba.bc}}function E(){var a=u("GRASS_MAP");a.K=!0;var b=V.hb(V.Eg);a.i=b;a.Ub=new Float32Array(3);return a}function I(a){var b=u("POSTPROCESSING");b.K=!0;b.da=!1;b.ha=!1;b.mb=!1;var c=V.hb(V.Za);
b.i=c;b.Ej=a;return b}function w(a){var b=u("BLOOM_BLUR");b.K=!0;b.da=!1;b.ha=!1;b.mb=!1;var c=V.hb(V.Za);b.i=c;b.Ej=a;return b}function G(a,b,c,d,m,f,e,g){var v=u("MAIN_"+a);v.K=!0;if("OPAQUE"===a&&c)v.da=!0,v.ha=!1,v.P=!1;else if("OPAQUE"===a)v.da=!0,v.ha=!0,v.P=!1;else if("BLEND"===a&&c)v.da=!1,v.ha=!1,v.P=!0;else if("BLEND"===a)v.da=!0,v.ha=!0,v.P=!0;else if("REFLECT"===a)v.da=!0,v.ha=!0,v.P=!1;else throw"wrong main subscene type";"BLEND"==a&&(v.ck=new Float32Array([0,0,0]),v.Lj=g?g.$q:0);v.i=
b;v.Mc=new Float32Array(e.Mc);v.Wc=new Float32Array(e.Wc);v.Yd=e.Yd;v.Hb=f;v.ac=new Float32Array(3);d?(v.Ca=d,d.Hb?(v.Eb=new Float32Array(4),yb.copy(d.Hb,v.Eb)):v.Eb=null,v.yf=d.$j,v.zg=d.Im,v.xf=d.xf,d.Ci?(v.Ff=1,v.Kn=d.Ci,v.Ln=d.Gk,v.Jn=d.Fk):v.Ff=0,d.Cd?(v.Bd=new Float32Array(2),v.Tc=new Float32Array(2),a=d.Yz,v.Bd[0]=(a[0]+a[1])/2,v.Bd[1]=(a[2]+a[3])/2,v.Tc[0]=a[0]-a[1],v.Tc[1]=a[2]-a[3],v.ig=d.ig,v.Cd=d.Cd,v.xh=d.xh):(v.Bd=null,v.Tc=null,v.ig=null,v.Cd=null)):v.Ca=null;v.Dh=0;v.qh=new Float32Array(3*
m);v.th=new Float32Array(3*m);v.ph=new Float32Array(3*m);v.rh=new Float32Array(4*m);v.sh=new Float32Array(4*m);v.ci=new Float32Array(4);v.bi=new Float32Array(3);v.rf=new Float32Array(3);return v}function F(a){var b=u("COLOR_PICKING");b.K=!1;b.i=a;b.ac=new Float32Array(3);return b}function x(a){var b=u("WIREFRAME");b.T=!1;b.da=!1;b.ha=!1;b.i=a;return b}function O(a,b){var c=u("DEPTH");c.K=!0;c.i=a;c.Lj=b;c.ac=new Float32Array(3);return c}function S(a,b,c,d,m){var f=u("BLUR_DEPTH");f.K=!0;f.da=!1;f.ha=
!1;f.mb=!1;f.i=a;f.orientation=b;f.Mg=c;f.Lg=d;f.Kg=m;return f}function Q(a){var b=u("DEPTH_PACK");b.K=!0;b.da=!1;b.ha=!1;b.i=a;return b}function P(a,b,c){var d=u("SSAO");d.K=!0;d.da=!1;d.ha=!1;d.mb=!1;d.i=a;d.Hb=b;d.Eb=new Float32Array(4);yb.copy(b,d.Eb);d.mm=c.Ty;d.hm=c.xv/1E3;d.im=c.aw;d.km=c.cw;d.jm=c.bw;d.lm=c.wx;d.gm=c.uv;d.oA=c.fz;d.Dq=0;return d}function M(){var a=u("ANTIALIASING");a.K=!0;a.da=!1;a.ha=!1;a.mb=!1;var b=V.hb(V.Za);a.i=b;return a}function H(a){var b=u(a);b.K=!0;b.da="SMAA_BLENDING_WEIGHT_CALCULATION"==
a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.ha=!1;b.mb=!1;var c=V.hb(V.Za);b.i=c;"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.sp=new Float32Array(4));return b}function K(a,b,c,d){var m=u("COMPOSITING");m.K=!0;m.da=!1;m.ha=!1;m.mb=!1;var f=V.hb(V.Za);m.i=f;m.Og=a;m.Ug=b;m.dh=c;m.eg=d;return m}function B(a,b){var c=u("MOTION_BLUR");c.K=!0;c.da=!1;c.ha=!1;c.mb=!1;var d=V.hb(V.Za);c.i=d;c.tk=!0;c.Bl=a;c.Cl=b;return c}function L(a){var b=u("DOF");b.K=!0;b.da=!1;b.ha=!1;b.mb=!1;b.i=a;return b}function r(a){var b=
u("GLOW_MASK");b.i=a;b.ac=new Float32Array(3);b.mb=!1;return b}function m(a){var b=u("GLOW");b.fj=a.fj;b.jl=a.jl;b.Jv=5;b.ot=3;b.mb=!1;a=V.hb(V.Za);b.i=a;return b}function R(){var a=u("REFRACT");a.K=!0;a.da=!1;a.ha=!1;a.mb=!1;var b=V.hb(V.Za);a.i=b;return a}function U(a,b,c,d,m,f,e){var v=u("GOD_RAYS");v.K=!0;v.da=!1;v.ha=!1;v.mb=!1;v.Mc=new Float32Array([1,1,1]);v.Wc=new Float32Array([1,1,1]);v.Yd=1;v.By=d;v.yg=b;v.Pl=m;v.wh=c;v.ai=e;v.i=a;v.Dh=f;v.qh=new Float32Array(3*f);v.th=new Float32Array(3*
f);v.ph=new Float32Array(3*f);v.rh=new Float32Array(4*f);v.sh=new Float32Array(4*f);v.ci=new Float32Array(4);v.bi=new Float32Array(3);v.rf=new Float32Array(3);v.ac=new Float32Array(3);return v}function X(a){var b=u("GOD_RAYS_COMBINE");b.K=!0;b.da=!1;b.ha=!1;b.mb=!1;var c=V.hb(V.Za);b.i=c;b.kl=a;return b}function Z(a,b){var c=u("SKY");c.K=!1;c.da=!1;c.ha=!1;c.mb=!1;var d=V.hb(V.Za);d.width=zb;d.height=zb;c.i=d;c.ev=la.hw();c.Dh=a;c.qh=new Float32Array(3*a);c.th=new Float32Array(3*a);c.ph=new Float32Array(3*
a);c.rh=new Float32Array(4*a);c.sh=new Float32Array(4*a);c.ci=new Float32Array(4);c.bi=new Float32Array(3);c.rf=new Float32Array(3);c.Mc=new Float32Array([1,1,1]);c.Wc=new Float32Array([1,1,1]);c.Yd=1;c.Xh=new Float32Array(b.Xh);c.Mh=b.Mh;c.yh=b.yh;c.$h=b.$h;c.Sh=b.Sh;c.Oh=b.Oh;c.Bh=b.Bh;c.Nh=b.Nh;c.zh=b.zh;c.Ah=b.Ah;c.tj=!1;c.jd=new Float32Array(16);return c}function ha(){var a=u("SCREEN");a.K=!0;a.da=!1;a.ha=!1;var b=V.hb(V.Za);a.i=b;return a}function z(){var a=u("ANAGLYPH");a.K=!0;a.da=!1;a.ha=
!1;var b=V.hb(V.Za);a.i=b;return a}function ea(){var a=u("LUMINANCE");a.K=!0;a.da=!1;a.ha=!1;var b=V.hb(V.Za);a.i=b;return a}function ka(){var a=u("AVERAGE_LUMINANCE");a.K=!0;a.da=!1;a.ha=!1;var b=V.hb(V.Za);a.i=b;return a}function J(a,b,c,d){var m=u("LUMINANCE_TRUNCED");m.K=!0;m.da=!1;m.ha=!1;m.Bk=a;m.Ak=b;m.i=d;m.Dh=0;m.qh=new Float32Array(3*c);m.th=new Float32Array(3*c);m.ph=new Float32Array(3*c);m.rh=new Float32Array(4*c);m.sh=new Float32Array(4*c);m.ci=new Float32Array(4);m.bi=new Float32Array(3);
m.rf=new Float32Array(3);m.Mc=new Float32Array(3);m.Wc=new Float32Array(3);m.Yd=0;return m}function fa(a){var b=u("BLOOM");b.K=!0;b.da=!1;b.ha=!1;var c=V.hb(V.Za);b.i=c;b.En=a;return b}function da(a){var b=u("VELOCITY");b.K=!0;b.da=!1;b.ha=!1;b.i=a;return b}function ga(){var a=u("SINK");a.K=!1;return a}function v(a,b,c){if(b.type===c)return!0;b=Ka(a,b);for(var d=0;d<b.length;d++)if(v(a,b[d],c))return!0;return!1}function T(a,b,c){if(b.type===c)return!0;b=va(a,b);for(var d=0;d<b.length;d++)if(T(a,b[d],
c))return!0;return!1}function ua(a,b,c){if(b.type===c)return b;b=va(a,b);for(var d=0;d<b.length;d++){var m=ua(a,b[d],c);if(m)return m}return null}function va(a,b){var c=N.uj(a,b);if(c==N.Ym)throw"Subscene not in graph";for(var d=[],m=N.gp(a,c),f=0;f<m;f++){var e=N.Se(a,c,f);e!=c&&d.push(N.Sa(a,e))}return d}function Ka(a,b){var c=N.uj(a,b);if(c==N.Ym)throw"Subscene not in graph";for(var d=[],m=N.cf(a,c),f=0;f<m;f++){var e=N.Te(a,c,f);e!=c&&d.push(N.Sa(a,e))}return d}function aa(a){var b=[],c=[];A(a,
function(a){a.va&&-1==b.indexOf(a.va)&&(b.push(a.va),c.push(a.va,b.length-1))});return c}function Ya(a,b){var c;c=""+(a.A+"\\n");c+="NONE"!=a.W?a.W+"\\n":"";c+="(";if(a.gi){var d=a.of;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.A){c+=" ";if(a.tg)c+="RR";else{var d=a.oa,m=a.na,f="";d==ba.t?f+="L":d==ba.bc&&(f+="N");m==ba.t?f+="L":m==ba.bc&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.va&&(c+=" "+b[d+1])}return c+")\\n"}var V=q("__camera"),
Ea=q("__config"),qa=q("__debug"),N=q("__graph"),ia=q("__renderer"),ba=q("__textures"),la=q("__util"),yb=q("vec4"),Ba=Ea.s,Na=Ea.fg,xa=!1,zb=384;a.Pu=function(a,d){var m=N.create(),f=a.ca[0],e=d.tl,v=d.Km,k=d.Hb,r=G("OPAQUE",f,!1,d.Ca,e,k,v);N.q(m,r);k=G("BLEND",f,!0,null,e,k,v,null);N.q(m,k);N.k(m,r,k,g("SCREEN","NONE",1,1,!0));v=ga();N.q(m,v);Ba.ki?(f=x(f),N.q(m,f),N.k(m,k,f,g("SCREEN","NONE",1,1,!0)),N.k(m,f,v,g("SCREEN","NONE",1,1,!0))):N.k(m,k,v,g("SCREEN","NONE",1,1,!0));d.Gi&&(f=c(r.i),a.ca.push(f),
r=F(f),N.q(m,r),N.k(m,r,v,g("COLOR","NONE",1,1,!0)),N.k(m,r,v,g("DEPTH","NONE",1,1,!0)));d.$f&&(e=Z(e,d.am),N.q(m,e),N.k(m,e,v,g("CUBEMAP","u_sky",zb,1,!1)));b(m,!0);1<Ba.Mb&&n(m);p(m);D(m);return m};a.Qt=d;a.EA=A;a.Ou=function(a,d,f){var e=N.create(),v=[],k=[],l=[],h=[],u=[],t=[],T=[],s=[],A=[],q=[],va=[],aa=d.tl,Ib=d.Ca,Ab=d.$y,ya=d.se,ac=d.be,sc=d.me,Ra=d.Zy,Ka=d.Qd,Jb=d.he,Cc=d.Ud,ia=d.uc,Ya=d.Km,Pb=d.Hb,ob=d.Wh,yb=d.by,xa=d.nt,pb=d.Et,nc=d.hx,Wb=d.ex;if(Ab){var Qb=ob.Xg;if(!Qb)throw"Zero CSM sections is forbidden";
for(var Y=0;Y<Qb;Y++){var ab=y(Y);N.q(e,ab);q.push(ab);var Va=Na.zd,ra=ab.i;ra.width=Va;ra.height=Va;ab.da=!1;va.push(g("DEPTH","u_shadow_map"+Y,Va,1,!1));qa.Nn()&&ab.Z.push(g("COLOR","COLOR",Va,1,!1))}}var uc=Ba.If&&(0<f.Wd||f.Zg)?!0:!1,sa=[];if(Ba.ri&&!a){var qb=f.ca[0],rb=c(qb);V.Cp(qb,V.rb);V.Cp(rb,V.Fb);sa.push(qb,rb);f.ca.push(rb)}else ra=f.ca[0],sa.push(ra);if(0<Ra.length&&!a)for(Y=0;Y<sa.length;Y++){ra=c(sa[Y]);f.ca.push(ra);var oa=G("REFLECT",ra,!1,Ib,aa,Pb,Ya);oa.yb=Ra[0];oa.i.yb=Ra[0];
N.q(e,oa);t.push(oa);T.push(g("COLOR","u_reflectmap",1,Ba.ag,!0));oa.Z.push(g("DEPTH","DEPTH",1,Ba.ag,!0))}v=[];k=[];if(d.ra){var Ga=E();N.q(e,Ga);Va=Na.Of;Ga.i.width=Va;Ga.i.height=Va;var kb=g("DEPTH","u_grass_map_depth",Va,1,!1);kb.oa=ba.t;kb.na=ba.t;var ma=g("COLOR","u_grass_map_color",Va,1,!1);ma.oa=ba.t;ma.na=ba.t}else ma=kb=Ga=null;for(Y=0;Y<sa.length;Y++){var ra=sa[Y],Wa=c(ra),sb=ob.$q;f.ca.push(Wa);if(Ab){var pa=O(Wa,sb);N.q(e,pa);for(var Oa=0;Oa<q.length;Oa++){var ab=q[Oa],tb=va[Oa];N.k(e,
ab,pa,tb)}var Kb=g("COLOR","u_color",1,1,!0),cc=g("DEPTH","u_depth",1,1,!0);if(ya){var Bb=c(ra);f.ca.push(Bb);var lb=P(Bb,Pb,d.Eq);N.q(e,lb);var Dc=g("COLOR","u_color",1,1,!0);N.k(e,pa,lb,Kb);N.k(e,pa,lb,cc)}var vc=c(ra);f.ca.push(vc);var bb=c(ra);f.ca.push(bb);var dc=ob.Mg,Rb=ob.Lg,ub=ob.Kg,Sa=S(vc,"X",dc,Rb,ub);N.q(e,Sa);var Xa=g("COLOR","u_color",1,1,!0);ya?N.k(e,lb,Sa,Dc):N.k(e,pa,Sa,Kb);N.k(e,pa,Sa,cc);var mb=S(bb,"Y",dc,Rb,ub);N.q(e,mb);N.k(e,Sa,mb,Xa);N.k(e,pa,mb,cc);var ja=g("COLOR","u_shadow_mask",
1,1,!0),cb=c(Wa);f.ca.push(cb);var C=Q(cb);N.q(e,C);N.k(e,pa,C,g("DEPTH","u_depth",1,1,!0));l.push(C);var Cb=g("DEPTH","DEPTH",1,1,!0);u.push(Cb)}else pa=O(Wa,sb),N.q(e,pa),Cb=g("DEPTH","DEPTH",1,1,!0),u.push(Cb),qa.Nn()&&pa.Z.push(g("COLOR","COLOR",1,1,!0)),cb=c(Wa),f.ca.push(cb),C=Q(cb),N.q(e,C),N.k(e,pa,C,g("DEPTH","u_depth",1,1,!0)),l.push(C);Ga&&(N.k(e,Ga,pa,kb),N.k(e,Ga,pa,ma));oa=G("OPAQUE",ra,!0,Ib,aa,Pb,Ya);N.q(e,oa);k.push(oa);N.k(e,pa,oa,u[Y]);mb&&N.k(e,mb,oa,ja);var za=g("COLOR","u_color",
1,1,!0);h.push(g("COLOR","COLOR",1,1,!0));Ga&&(N.k(e,Ga,oa,kb),N.k(e,Ga,oa,ma));t.length&&(N.k(e,t[Y],oa,T[Y]),oa.yb=Ra[0])}v=k;k=[];if(!a&&d.Gi){ra=c(v[0].i);f.ca.push(ra);var Za=F(ra);N.q(e,Za)}else Za=null;if(sc&&!a)for(Y=0;Y<sa.length;Y++){var Db=R();N.q(e,Db);N.k(e,v[Y],Db,za);s.push(Db);A.push(g("COLOR","u_refractmap",1,1,!0))}for(var W=[],Y=0;Y<sa.length;Y++){pa=l[Y];ra=c(sa[Y]);f.ca.push(ra);oa=G("BLEND",ra,!0,Ib,aa,Pb,Ya,ob);k.push(oa);N.q(e,oa);N.k(e,v[Y],oa,h[Y]);N.k(e,v[Y],oa,u[Y]);Ga&&
(N.k(e,Ga,oa,kb),N.k(e,Ga,oa,ma));for(Oa=0;Oa<q.length;Oa++)ab=q[Oa],tb=va[Oa],N.k(e,ab,oa,tb);if("DEPTH_PACK"==pa.type){var Pa=g("COLOR","u_shore_depth",1,1,!0);Pa.oa=ba.bc;Pa.na=ba.bc}else Pa=g("DEPTH","u_shore_depth",1,1,!0),Pa.oa=ba.t,Pa.na=ba.t;N.k(e,pa,oa,Pa);t.length&&(N.k(e,t[Y],oa,T[Y]),oa.yb=Ra[0]);s.length&&N.k(e,s[Y],oa,A[Y]);W.push(oa)}v=k;k=[];if(Ba.ki){for(Y=0;Y<sa.length;Y++){ra=la.Fa(sa[Y]);f.ca.push(ra);var db=x(ra);k.push(db);N.q(e,db);N.k(e,v[Y],db,h[Y]);N.k(e,v[Y],db,u[Y]);Ga&&
(N.k(e,Ga,db,kb),N.k(e,Ga,db,ma))}v=k;k=[]}if(ac&&!a){for(Y=0;Y<sa.length;Y++){var eb=nc.wh,Xb=nc.Bx,Eb=nc.ai,Ca=v[Y],Lb=Ib?1:0,ec=g("DEPTH","u_input",1,1,!0);ec.oa=ba.t;ec.na=ba.t;var Qa=g("COLOR","u_input",1,0.25,!0);Qa.oa=ba.t;Qa.na=ba.bc;var Yb=eb/Eb,oc=c(sa[Y]);f.ca.push(oc);var wa=U(oc,Lb,eb,!0,Yb,aa,Eb);N.q(e,wa);N.k(e,Ca,wa,ec);var Yb=0.5*(eb/Eb),na=c(sa[Y]);f.ca.push(na);var wc=U(na,Lb,eb,!1,Yb,aa,Eb);N.q(e,wc);N.k(e,wa,wc,Qa);var Yb=0.25*(eb/Eb),Vc=c(sa[Y]);f.ca.push(Vc);var Fb=U(Vc,Lb,
eb,!1,Yb,aa,Eb);N.q(e,Fb);N.k(e,wc,Fb,Qa);t.length&&(wa.yb=Ra[0],wc.yb=Ra[0],Fb.yb=Ra[0]);var nb=X(Xb);k.push(nb);N.q(e,nb);N.k(e,Ca,nb,g("COLOR","u_main",1,1,!0));N.k(e,Fb,nb,g("COLOR","u_god_rays",1,1,!0))}v=k;k=[]}if(Ka&&!a){for(Y=0;Y<sa.length;Y++){var Ca=v[Y],Mb=ea();N.q(e,Mb);N.k(e,Ca,Mb,g("COLOR","u_input",1,1,!0));var fc=ka();N.q(e,fc);fc.i.width=Va;fc.i.height=Va;var pc=g("COLOR","u_input",1,0.25,!0);pc.oa=ba.t;pc.na=ba.t;var Gb=g("COLOR","u_luminance",1,0.25,!0);Gb.oa=ba.t;Gb.na=ba.t;N.k(e,
Mb,fc,pc);var Ec=xa.key,Fc=xa.Dv,Wc=c(sa[Y]);f.ca.push(Wc);var Hb=J(Ec,Fc,aa,Wc);N.q(e,Hb);N.k(e,Ca,Hb,g("COLOR","u_main",1,1,!0));N.k(e,Mb,Hb,Gb);N.k(e,fc,Hb,g("COLOR","u_average_lum",1,1,!1));var vb=g("COLOR","u_color",1,0.25,!0);vb.oa=ba.t;vb.na=ba.t;var Sb=w("X_BLUR");N.q(e,Sb);N.k(e,Hb,Sb,vb);var wb=w("Y_BLUR");N.q(e,wb);N.k(e,Sb,wb,vb);var Mc=fa(xa.blur);N.q(e,Mc);N.k(e,wb,Mc,g("COLOR","u_bloom",1,0.25,!0));N.k(e,Ca,Mc,g("COLOR","u_main",1,1,!0));k.push(Mc)}v=k;k=[]}if(Jb&&!a){for(Y=0;Y<v.length;Y++){var bd=
v[Y],Gc=B(yb.Bl,yb.Cl);k.push(Gc);N.q(e,Gc);N.k(e,bd,Gc,g("COLOR","u_mb_tex_curr",1,1,!0));Gc.Z.push(g("COLOR","u_mb_tex_accum",1,1,!0))}v=k;k=[]}if(uc&&!a){for(Y=0;Y<v.length;Y++){var Ca=v[Y],Zb=c(sa[Y]);f.ca.push(Zb);vb=g("COLOR","u_color",1,1,!0);vb.oa=ba.t;vb.na=ba.t;var Ja=I("X_BLUR");N.q(e,Ja);N.k(e,Ca,Ja,vb);var $b=I("Y_BLUR");N.q(e,$b);N.k(e,Ja,$b,vb);var pa=W[Y],Tb=L(Zb);Zb.Wd=f.Wd;Zb.Zg=f.Zg;Zb.Yg=f.Yg;Zb.$g=f.$g;Zb.Xd=f.Xd;Zb.Qk=1;k.push(Tb);N.q(e,Tb);N.k(e,Ca,Tb,g("COLOR","u_sharp",1,
1,!0));N.k(e,$b,Tb,g("COLOR","u_blurred",1,1,!0));N.k(e,pa,Tb,g("DEPTH","u_depth",1,1,!0))}v=k;k=[]}if(!a&&d.xc){for(Y=0;Y<sa.length;Y++){var Ca=v[Y],Hc=c(sa[Y]);f.ca.push(Hc);var xc=r(Hc);N.q(e,xc);var Nc=I("X_EXTEND"),Zc=g("COLOR","u_color",1,1,!0),yc=g("COLOR","u_glow_mask",1,1,!0);Nc.kj=!0;N.q(e,Nc);N.k(e,xc,Nc,Zc);var Oc=g("COLOR","u_color",1,0.5,!0);Oc.oa=ba.t;Oc.na=ba.t;var Pc=I("Y_EXTEND");Pc.kj=!0;N.q(e,Pc);N.k(e,Nc,Pc,Oc);Ja=I("X_BLUR");Ja.kj=!0;N.q(e,Ja);N.k(e,Pc,Ja,Oc);var Xc=g("COLOR",
"u_color",1,0.25,!0);Xc.oa=ba.t;Xc.na=ba.t;var Ic=g("COLOR","u_glow_mask_blurred",1,0.25,!0);Ic.oa=ba.t;Ic.na=ba.t;$b=I("Y_BLUR");$b.kj=!0;N.q(e,$b);N.k(e,Ja,$b,Xc);var Jc=m(Wb);N.q(e,Jc);N.k(e,Ca,Jc,g("COLOR","u_glow_src",1,1,!0));N.k(e,xc,Jc,yc);N.k(e,$b,Jc,Ic);k.push(Jc)}v=k;k=[]}if(Cc&&!a){for(Y=0;Y<v.length;Y++){var Ca=v[Y],Qc=K(pb.Og,pb.Ug,pb.dh,pb.eg);N.q(e,Qc);N.k(e,Ca,Qc,g("COLOR","u_color",1,1,!0));k.push(Qc)}v=k;k=[]}if(ia&&!a){for(Y=0;Y<v.length;Y++)if(Ca=v[Y],Ba.Yb&&!Ea.context.alpha){var ca=
ua(e,Ca,"DEPTH"),Da=c(sa[Y]);f.ca.push(Da);var Rc=da(Da),gc=g("DEPTH","u_depth",1,1,!0);gc.oa=ba.bc;gc.na=ba.bc;N.q(e,Rc);N.k(e,ca,Rc,gc);var ta=g("COLOR","u_velocity_tex",1,1,!0),Ha=H("SMAA_EDGE_DETECTION");N.q(e,Ha);var zc=g("COLOR","u_color",1,1,!0);zc.oa=ba.t;zc.na=ba.t;N.k(e,Ca,Ha,zc);var Ma=H("SMAA_BLENDING_WEIGHT_CALCULATION");N.q(e,Ma);N.k(e,Ha,Ma,zc);var Ac=g("COLOR","u_search_tex",1,1,!1),hc=g("COLOR","u_area_tex",1,1,!1);Ac.oa=ba.t;Ac.na=ba.t;hc.oa=ba.t;hc.na=ba.t;Ma.Z.push(Ac);Ma.Z.push(hc);
var ic=H("SMAA_NEIGHBORHOOD_BLENDING");N.q(e,ic);N.k(e,Ca,ic,zc);var jc=g("COLOR","u_blend",1,1,!0);jc.oa=ba.t;jc.na=ba.t;N.k(e,Ma,ic,jc);N.k(e,Rc,ic,ta);var kc=H("SMAA_RESOLVE");N.q(e,kc);N.k(e,ic,kc,zc);N.k(e,Rc,kc,ta);var lc=g("COLOR","u_color_prev",1,1,!0);lc.oa=ba.t;lc.na=ba.t;kc.Z.push(lc);k.push(kc)}else{var Sc=M();N.q(e,Sc);var Kc=g("COLOR","u_color",1,1,!0);Kc.oa=ba.t;Kc.na=ba.t;N.k(e,Ca,Sc,Kc);if(1<Ba.Mb){var Nb=I("NONE");N.q(e,Nb);N.k(e,Sc,Nb,Kc);k.push(Nb)}else k.push(Sc)}v=k;k=[]}if(Ba.ri&&
!a){var qc=z();N.q(e,qc);N.k(e,v[0],qc,g("COLOR","u_sampler_left",1,1,!0));N.k(e,v[1],qc,g("COLOR","u_sampler_right",1,1,!0));k.push(qc)}else k.push(v[0]);var cd=N.uj(e,v[0]),Yc=!1;N.Ed(e,cd,function(a,b,c){if(c.A==c.W)return Yc=!0});if(Yc||a){var rc=ha();N.q(e,rc);N.k(e,v[0],rc,g("COLOR","u_color",1,1,!0));v=k;k=[];k.push(rc)}Za&&k.push(Za);if(!a&&d.$f){var $c=Z(aa,d.am);N.q(e,$c);k.push($c)}var ad=ga();N.q(e,ad);for(Y=0;Y<k.length;Y++)switch(k[Y].type){case "COLOR_PICKING":N.k(e,k[Y],ad,g("COLOR",
"NONE",1,1,!0));N.k(e,k[Y],ad,g("DEPTH","NONE",1,1,!0));break;case "SKY":N.k(e,$c,ad,g("CUBEMAP","u_sky",zb,1,!1));break;default:N.k(e,k[Y],ad,g("SCREEN","NONE",1,1,!0))}for(var ed=N.Ro(e),Y=0;Y<ed.length;Y++)for(var fd=ed[Y],Oa=0;Oa<l.length;Oa++)pa=l[Oa],N.Sa(e,fd)==pa&&N.cg(e,fd);b(e,!1);1<Ba.Mb&&n(e);p(e);D(e);return e};a.pC=function(a){var b=null;N.S(a,function(a,c){return c.i&&null===c.i.$d?(b=c,!0):!1});return b};a.cb=function(a,b,c){a=va(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];
return null};a.MC=v;a.sx=T;a.Qv=ua;a.Ko=va;a.DC=Ka;a.Ra=function(a,b){var c=null;N.S(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.gv=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=aa(a);N.S(a,function(a,d){var m=b+="    ",e="",e=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type?e+=" ("+d.Ej.replace(/_/g," ")+")":"BLUR_DEPTH"==d.type&&(e+=" ("+d.orientation+")");
if(d.i){for(var e=e+"\\n",f=0;f<c.length;f+=2)c[f]==d.i.ab&&(e+="C"+c[f+1]+" ");for(f=0;f<c.length;f+=2)c[f]==d.i.ec&&(e+="D"+c[f+1])}d.Z.length&&(e+="\\n-----\\n");for(f=0;f<d.Z.length;f++)e+=Ya(d.Z[f],c);f="SINK"==d.type?"dotted":d.K?"solid":"dashed";b=m+(String(a)+' [label="'+e+'" color="black" style="'+(f+",bold")+'"];\n')});N.sf(a,function(a,d,m){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+Ya(m,c)+'" style="'+(m.Da?"solid":"dotted")+'"];\n'});return b+="}"};a.co=function(a){a=N.zA(a);
for(var b=[],c=0;c<a.length;c++){var d=a[c];d.K&&b.push(d)}return b}};b4w.module.__textures=function(a,q){function c(a){f.texParameteri(a,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(a,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.texParameteri(a,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(a,f.TEXTURE_MIN_FILTER,f.LINEAR)}function b(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function e(b){switch(b.type){case a.Ce:b=f.RGBA;break;case a.kk:b=f.RGB;break;case a.mi:b=f.RGBA;break;case a.ni:b=f.RGB;break;case a.Dg:b=
f.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function d(b){switch(b.type){case a.Ce:b=f.UNSIGNED_BYTE;break;case a.kk:b=f.UNSIGNED_BYTE;break;case a.mi:b=f.FLOAT;break;case a.ni:b=f.FLOAT;break;case a.Dg:b=f.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}var h=q("__config"),p=q("__print"),n=q("__dds"),k=q("__extensions"),l=q("__util"),s=h.s;a.bc=0;a.t=0;a.ys=0;a.ws=0;a.xs=0;a.vs=0;a.Ce=10;a.kk=20;a.mi=30;a.ni=40;a.Dg=50;a.Af=60;var f=null,t;a.Bc=function(b){t=
[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.bc=b.NEAREST;a.t=b.LINEAR;a.ys=b.NEAREST_MIPMAP_NEAREST;a.ws=b.LINEAR_MIPMAP_NEAREST;a.xs=b.NEAREST_MIPMAP_LINEAR;a.vs=b.LINEAR_MIPMAP_LINEAR;f=b};a.Ki=function(b,c){var d={};d.name=b;d.type=c;d.source="NONE";d.width=0;d.height=0;d.Sg=1;if(c==a.Af)d.ji=f.createRenderbuffer();else{var e=f.TEXTURE_2D,g=f.createTexture();f.bindTexture(e,g);f.texParameteri(e,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(e,
f.TEXTURE_MIN_FILTER,f.LINEAR);f.texParameteri(e,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(e,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.bindTexture(e,null);d.Db=e;d.Wa=g}return d};a.wu=function(b){var c=f.createTexture(),d=f.TEXTURE_CUBE_MAP;f.bindTexture(d,c);f.texParameteri(d,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(d,f.TEXTURE_MIN_FILTER,f.LINEAR);f.texParameteri(d,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(d,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);for(var e="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),
g=0;6>g;g++)f.texImage2D(f[e[g]],0,f.RGBA,b,b,0,f.RGBA,f.UNSIGNED_BYTE,null);f.bindTexture(d,null);d={name:"CUBEMAP"};d.type=a.Ce;d.source="NONE";d.width=3*b;d.height=2*b;d.Sg=1;d.Wa=c;d.Db=f.TEXTURE_CUBE_MAP;return d};a.Kj=function(b,c,d){if(b.type!=a.Af){var e=b.Db;f.bindTexture(e,b.Wa);c&&f.texParameteri(e,f.TEXTURE_MIN_FILTER,c);d&&f.texParameteri(e,f.TEXTURE_MAG_FILTER,d);f.bindTexture(e,null)}};a.BC=function(b){if(b.type==a.Af)return{min:a.bc,Wx:a.bc};var c=b.Db;f.bindTexture(c,b.Wa);b=f.getTexParameter(c,
f.TEXTURE_MIN_FILTER);var d=f.getTexParameter(c,f.TEXTURE_MAG_FILTER);f.bindTexture(c,null);return{min:b,Wx:d}};a.dg=function(b,c,k){c=Math.max(c,1);k=Math.max(k,1);if(b.width!=c||b.height!=k){if(b.type==a.Af)f.bindRenderbuffer(f.RENDERBUFFER,b.ji),f.renderbufferStorage(f.RENDERBUFFER,f.DEPTH_COMPONENT16,c,k),f.bindRenderbuffer(f.RENDERBUFFER,null);else{var l=b.Db;f.bindTexture(l,b.Wa);var g=e(b),h=d(b);f.texImage2D(l,0,g,c,k,0,g,h,null);f.bindTexture(l,null)}b.width=c;b.height=k}};a.Wu=function(b,
c,d){var e=b.type,g=new Uint8Array([204,204,204,255]),h={};switch(e){case "IMAGE":d=f.createTexture();var n=f.TEXTURE_2D;f.bindTexture(n,d);f.texImage2D(n,0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,g);break;case "NONE":if(b.b4w_render_scene)if(d=l.Nc("name",b.b4w_render_scene,d))h.Lp=d,d.jn=!0,d=f.createTexture(),n=f.TEXTURE_2D,f.bindTexture(n,d),f.texImage2D(n,0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,g);else return;else return;break;case "ENVIRONMENT_MAP":d=f.createTexture();n=f.TEXTURE_CUBE_MAP;f.bindTexture(n,
d);for(var w="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" "),q=0;6>q;q++)f.texImage2D(f["TEXTURE_CUBE_MAP_"+w[q]],0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,g);break;case "VORONOI":case "BLEND":return;default:p.error('B4W warning: texture "'+b.name+'" has unsupported type "'+e+'"');return}"NONE"==e?f.texParameteri(n,f.TEXTURE_MIN_FILTER,f.LINEAR):f.texParameteri(n,f.TEXTURE_MIN_FILTER,t[s.qg]);f.texParameteri(n,f.TEXTURE_MAG_FILTER,f.LINEAR);g=n;w=b.b4w_anisotropic_filtering;
"DEFAULT"===w&&(w=c);"OFF"!==w&&(c=k.uw())&&(w=parseFloat(w.split("x")[0]),f.texParameterf(g,c.TEXTURE_MAX_ANISOTROPY_EXT,w));"REPEAT"==b.extension&&"NONE"!=e?(f.texParameteri(n,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(n,f.TEXTURE_WRAP_T,f.REPEAT)):(f.texParameteri(n,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(n,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE));f.generateMipmap(n);f.bindTexture(n,null);h.name=b.name;h.type=a.Ce;h.source=e;h.width=1;h.height=1;h.Sg=1;h.Wa=d;h.Db=n;b.d=h};a.Xu=function(){var b=
f.createTexture(),c=f.TEXTURE_2D;f.bindTexture(c,b);f.texParameteri(c,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(c,f.TEXTURE_MIN_FILTER,f.LINEAR);f.texParameteri(c,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(c,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.bindTexture(c,null);var d=document.createElement("canvas");d.width=1;d.height=1;var e=d.getContext("2d"),g={name:"HUD"};g.type=a.Ce;g.source="CANVAS";g.width=1;g.height=1;g.Sg=1;g.Wa=b;g.Db=c;g.canvas=d;g.NB=e;return g};a.mD=function(a,b,c){if("CANVAS"!=
a.source)throw"Wrong texture";b=Math.max(b,1);c=Math.max(c,1);var k=a.canvas;k.width=b;k.height=c;if("CANVAS"!=a.source)throw"Wrong texture";b=a.Db;f.bindTexture(b,a.Wa);c=e(a);var k=d(a),g=a.canvas;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!0);f.texImage2D(b,0,c,c,k,g);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1);f.bindTexture(b,null);a.width=width;a.height=height};a.Wj=function(a,d,e,l){var g=a.source,h=a.Db;f.bindTexture(h,a.Wa);if(4==d.length){var t=!0;d=new Uint8Array([255*d[0],255*d[1],255*d[2],255*d[3]])}if("IMAGE"==
g)t?(f.texImage2D(h,0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,d),a.width=1,a.height=1):e?(n.UA(f,k.Qo(),d,!0),e=n.Xo(d),b(e.width,e.height)&&(a.An||p.warn("B4W warning: using NPOT-texture",l),c(h)),a.width=e.width,a.height=e.height,a.Sg=n.Aw(d)):(f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!0),f.texImage2D(h,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,d),a.width=d.width,a.height=d.height,b(d.width,d.height)?(a.An||p.warn("B4W warning: using NPOT-texture",l),c(h)):f.generateMipmap(h));else if("ENVIRONMENT_MAP"==g)if(e=[["POSITIVE_X",
2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],t){for(l=0;6>l;l++)t=e[l],f.texImage2D(f["TEXTURE_CUBE_MAP_"+t[0]],0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,d);a.width=3;a.height=2}else{if(b(d.width/3,d.height/2))throw"Warning: Wrong environment map dimensions "+l;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1);g=d.width/3;for(l=0;6>l;l++){var t=e[l],s=document.createElement("canvas");s.width=g;s.height=g;var q=s.getContext("2d");"POSITIVE_Y"==t[0]||"NEGATIVE_Y"==
t[0]?(q.translate(0,g),q.scale(1,-1)):(q.translate(g,0),q.scale(-1,1));q.drawImage(d,t[1]*g,t[2]*g,g,g,0,0,g,g);f.texImage2D(f["TEXTURE_CUBE_MAP_"+t[0]],0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,s)}a.width=3*g;a.height=2*g;f.generateMipmap(h)}f.bindTexture(h,null)};a.pv=function(a){f.deleteTexture(a)};a.mh=function(a){return a&&a.name&&(a.Wa||a.ji)?!0:!1};a.np=function(a){return a&&a.name&&a.ji?!0:!1};a.SC=function(b){return b.type==a.mi||b.type==a.ni?!0:!1};a.Xw=function(b){var c=0;switch(b.type){case a.Ce:case a.kk:c=
4;break;case a.mi:case a.ni:c=16;break;case a.Dg:c=3;break;case a.Af:c=2}return c};a.xt=function(a){var b={},c;for(c in a)b[c]=a[c];delete b.Lp;return JSON.stringify(b)}};b4w.module.__assets=function(a,q){function c(){return b4w.module_check(l.Kb.Ai)?q(l.Kb.Ai).data:null}function b(){var a={pi:null,Cs:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:$a(),addEventListener:$a(),open:function(b,c){a.pi=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var b=c();b&&a.pi in b&&(a.status=200,b[a.pi]&&(a.response=a.Cs(b[a.pi])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function e(b){for(var c=0,e=0;e<b.length;e++){var f=b[e];f.state===y&&c++;if(c>=A.$x)break;if(f.state===D)switch(f.state=y,c++,f.type){case a.Ag:d(f,"arraybuffer");break;case a.gk:d(f,"json");break;case a.Nm:d(f,"text");break;case a.ek:h(f);break;case a.Bg:p(f);break;case a.fk:n(f);break;default:throw"Wrong asset type: "+
f.type;}}}function d(a,d){var e=c(),f=e&&a.w in e?new b:new XMLHttpRequest;f.open("GET",a.w,!0);"text"==d?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==d?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=d;f.onreadystatechange=function(){if(4==f.readyState)if(200==f.status||0==f.status){var b=f.response;if(b){if("json"==d&&"string"==typeof b)try{b=JSON.parse(b)}catch(c){a.Fc(null,a.uri,a.type,a.w);s.error(c+" (parsing JSON "+a.w+")");return}a.Fc(b,a.uri,
a.type,a.w);a.state=u}else a.Fc(null,a.uri,a.type,a.w),s.error("B4W Error: empty responce when trying to get "+a.w)}else a.Fc(null,a.uri,a.type,a.w),s.error("B4W Error: "+f.status+" when trying to get "+a.w)};f.addEventListener("progress",function(b){b.lengthComputable&&a.Ny(b.loaded/b.total)},!1);f.send(null)}function h(a){var d=c(),e=d&&a.w in d?new b:new XMLHttpRequest;e.open("GET",a.w,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status||0==e.status){var b=
e.response;b?f.kv(b,function(b){a.Fc(b,a.uri,a.type,a.w);a.state=u},function(){a.Fc(null,a.uri,a.type,a.w);s.error("B4W Error: failed to decode "+a.w)}):(a.Fc(null,a.uri,a.type,a.w),s.error("B4W Error: empty responce when trying to get "+a.w))}else a.Fc(null,a.uri,a.type,a.w),s.error("B4W Error: "+e.status+" when trying to get "+a.w)};e.send(null)}function p(a){var b=document.createElement("img");b.onload=function(){a.Fc(b,a.uri,a.type,a.w);a.state=u};b.addEventListener("error",function(){s.error("B4W Error: could not load image: "+
a.w)},!1);var d=c();d&&a.w in d?d[a.w]?b.src="data:image;base64,"+d[a.w]:(d=new CustomEvent("error"),b.dispatchEvent(d)):b.src=a.w}function n(a){var b=document.createElement("audio");b.addEventListener("loadeddata",function(){a.Fc(b,a.uri,a.type,a.w);a.state=u},!1);b.addEventListener("error",function(){s.error("B4W Error: could not load sound: "+a.w)},!1);var d=c();if(d&&a.w in d)if(d[a.w]){var e=k(a.w);b.src="data:"+e+";base64,"+d[a.w]}else d=new CustomEvent("error"),b.dispatchEvent(d);else b.src=
a.w;setTimeout(function(){b.uD=1},5E3)}function k(a){var b="audio";switch(/(?:\.([^.]+))?$/.exec(a)[1]){case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "mp4":b+="/mp4"}return b}var l=q("__config"),s=q("__print"),f=q("__sfx"),t=q("__version"),A=l.Md;a.Ag=10;a.gk=20;a.Nm=30;a.ek=40;a.Bg=50;a.fk=60;var D=10,y=20,u=30,g=[],E=0,I={};a.fm=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.Ww=function(a){if(I[a])return I[a];var b=A.Zp?
a+t.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return I[a]=b;throw"Error XHR: responce is empty, GET "+a;}throw"Error XHR: "+c.status+", GET "+a;};a.ga=function(){g=[];E=0;I={}};a.K=function(a,b,d,f){for(var k=0;k<a.length;k++){var l=a[k],l={uri:l[0],type:l[1],w:l[2],name:l[3],state:D,Fc:b||$a(),Qp:d||$a(),Ny:f||$a(),Rp:E};if(A.Zp){var h=c();h&&l.w in h||(l.w+=t.timestamp())}g.push(l)}e(g);
E++};a.update=function(){e(g);for(var a=g,b=0,c=!0,d=0;d<a.length;d++){var f=a[d];f.Rp===a[b].Rp?f.state!==u&&(c=!1):(c&&(a[d-1].Qp(),c=d-b,a.splice(b,c),d-=c),b=d,c=a[d].state===u?!0:!1);d===a.length-1&&c&&(a[d].Qp(),a.splice(b))}}};b4w.module.__loader=function(a,q){function c(c,d,e,g){var k=t.create(),l;for(l in c){var h=b(c[l]);e&&h.nb&&f(h);t.q(k,h)}for(l in c)for(h=c[l],h.name=l,e=0;e<h.U.length;e++)t.k(k,c[h.U[e]],h,null);c=b({name:"out",fb:a.lr,gb:function(a,b,c,d,e){b.yc=!0;g(a);e(b,c);A.log("%cLOADED CALLBACK",w)}});var p=[];if(d)for(d=t.Ro(k),e=0;e<d.length;e++)p.push(t.Sa(k,d[e]));else t.S(k,function(a,b){b.kb||p.push(b)});t.q(k,c);for(e=0;e<p.length;e++)c.U.push(p[e].name),t.k(k,p[e],c,null);return k}function b(a){a.kb=
a.kb||!1;a.fb||0===a.fb||(a.fb=a.Be);a.U=a.U||[];a.lh=a.lh||!1;a.$l=a.$l||!1;a.zb=a.zb||0;a.nb=a.nb||!1;a.status=y;a.bD=0;a.vl=0;a.Fe=a.Fe||null;return a}function e(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];t.Sa(a.te,f).lh&&(t.we(a.te,f,function(d){var e=!0;t.Ed(a.te,d,function(a,b){if(!b.lh)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-1;0<=e;e--)b.splice(d[e],1);return c}function d(a){function b(c,d){var e=t.Sa(a.te,c),f=t.Sa(a.te,d),g=
f.fb-e.fb;0==g&&(g=e.kb-f.kb);return g}var c=[],d=a.qf,f=!1;do{var g=e(a,d);c.push.apply(c,d);0<g.length&&(f=!0);d=g}while(0<g.length);f&&c.sort(b);a.qf=c;return a.qf.length}function h(a,b,c){if(b.$l)return b.lh=!0,I&&A.log("%cSKIP STAGE: "+b.name,w),!1;if(I&&b.status==y){var d=p(a);A.log("%c"+d+"% "+("LOADING START: "+b.name)+" "+Math.round(performance.now()-a.di)+"ms ",w)}if(!b.gb&&!b.Qg&&!b.Pg)return n(a,b),!1;if(b.status==y&&(b.status++,b.gb))return b.gb(c,a,b,b.Fe,n,k),!0;if(b.status==u){if(b.Qg)return b.Qg(c,
a,b,b.Fe,n,k),!0;b.status++}return b.status==g&&(b.status++,b.Pg)?(b.Pg(c,a,b,b.Fe,n,k),!0):!1}function p(a){if(0==a.Oj)return 100;var b=0;t.S(a.te,function(c,d){a.Me&&d.nb||(b+=d.vl*d.zb)});return D.Dc(100*b/a.Oj)}function n(a,b){b.lh=!0;b.status=E;l(a,b,1);if(I){var c=p(a);A.log("%c"+c+"% "+("LOADING END: "+b.name)+" "+Math.round(performance.now()-a.di)+"ms ",w)}}function k(a,b,c){1>c?l(a,b,c):b.status++}function l(a,b,c){if(b.gb||b.Qg||b.Pg)if(b.vl=c,b=p(a),a.io!=b||1==c)a.Fq(b,performance.now()-
a.di),a.io=b,a.yl=!0}function s(a,b){var c=null;t.S(a.te,function(a,d){if(d.name==b)return c=d,1});return c}function f(a){a.$l=!0;a.vl=1}var t=q("__graph"),A=q("__print"),D=q("__util"),y=0,u=1,g=2,E=3,I=!1,w="color: #f0f;";a.Be=0;a.ye=1;a.lr=2;a.Qu=function(a,b,d,e,f,g,k){var l={w:b,MB:null,Fq:e||$a(),au:f||$a(),status:0,Rl:!1,di:0,io:0,Oj:0,ID:g,yc:!1,yl:!1};a=c(a,g,k,d||$a());l.te=a;b=[];d=t.Tw(a);for(e=0;e<d.length;e++)b.push(d[e]);l.qf=b;t.S(a,function(a,b){!(b.gb||b.Qg||b.Pg)||l.Me&&b.nb||(l.Oj+=
b.zb)});return l};a.SA=function(b,c){if(b)if(b.yl)b.yl=!1;else{var e=performance.now();do{if(2==b.status)break;0==b.status&&(b.status=1,b.di=performance.now(),b.Fq(0,0),I&&A.log("%c0% LOADING START 0ms",w));if(d(b)){var f=b,g=c,k=f.qf.length;do{var l=t.Sa(f.te,f.qf[0]),p=h(f,l,g);l.fb==a.ye&&(f.Rl=!0);l=f.qf.shift();f.qf.push(l);k--}while(!p&&0!=k)}else{b.au(c,b);b.status=2;I&&A.log("%c100% LOADING END "+Math.round(performance.now()-b.di)+"ms",w);break}if(b.Rl){b.Rl=!1;break}}while(16>performance.now()-
e)}};a.xD=k;a.GC=s;a.xq=function(a,b){var c=s(a,b);null!==c&&f(c)};a.yc=function(a){return a?a.yc:!1}};b4w.module.__nla=function(a,q){function c(a){p.Pf(a)&&p.ih(a)?e.stop(a):(s.We(a)||s.Vb(a)||d.Qf(a))&&e.stop(a)}function b(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].strips;if(d)for(var e=0;e<d.length;e++){var f=d[e];b.push({Ib:f.frame_start,fc:f.frame_end,Xk:0,jf:!1,action:f.action?f.action.name:null})}}return b}var e=q("__animation"),d=q("__camera"),h=q("__config");q("__loader");var p=q("__particles"),n=q("__print"),k=q("__scenes"),l=q("__sfx"),s=q("__util"),f=h.Hg,t=[],A=-1;a.QA=function(a,
c){for(var f={Ib:a.frame_start,fc:a.frame_end,oh:-1,Tb:c,Wb:[]},g=k.dl(a,"ALL"),h=0;h<g.length;h++){var A=g[h],q=A.animation_data;if(q&&q.nla_tracks.length){q=q.nla_tracks;if(s.We(A)||d.Qf(A)||s.Vb(A)){var G=b(q);A.Df=G;f.Wb.push(A)}l.Sf(A)&&(G=b(q),A.Df=G,f.Wb.push(A))}}for(h=0;h<g.length;h++){A=g[h];for(q=0;q<f.Wb.length;q++)e.gh(A)==f.Wb[q]&&(A.Df=s.Sd(f.Wb[q].Df),f.Wb.push(A));p.Pf(A)&&p.ih(A)&&(A.Df=[{Ib:f.Ib,fc:f.fc+1,Xk:0,jf:!1,action:null}],f.Wb.push(A))}g=f.Ib;h=f.fc;for(A=0;A<f.Wb.length;A++)for(var q=
f.Wb[A],G=q.Df,F=0;F<G.length;F++){var x=G[F],O=q.name+" ["+x.Ib+":"+x.fc+"]";x.Xk=Math.max(0,g-x.Ib);x.Ib=Math.max(g,x.Ib);x.fc=Math.min(h+1,x.fc);x.Ib>x.fc&&(n.warn("NLA: out of scene range: "+O),G.splice(F,1),F--)}t.push(f)};a.update=function(a,b){-1==A&&(A=a);for(var k=0;k<t.length;k++){var g=t[k],h=(a-A)*f.Xa-g.Ib;g.Tb&&(h%=g.fc-g.Ib+1);for(var h=h+g.Ib,n=0;n<g.Wb.length;n++){for(var q=g.Wb[n],G=q.Df,F=0;F<G.length;F++){var x=G[F];h<g.oh&&x.jf&&(c(q),x.jf=!1)}for(F=0;F<G.length;F++){x=G[F];if((h<
g.oh||g.oh<x.Ib)&&x.Ib<=h&&!x.jf){var O=q,S=x,Q=h,P=S.Xk-b*f.Xa;p.Pf(O)&&p.ih(O)?(e.ti(O),e.Jj(O,P),e.play(O)):s.We(O)||s.Vb(O)||d.Qf(O)?(e.apply(O,S.action),e.Jj(O,P),e.play(O)):l.Sf(O)&&l.play(O,0,(S.fc-Q)/f.Xa);x.jf=!0}g.oh<x.fc&&x.fc<=h&&x.jf&&(c(q),x.jf=!1)}}g.oh=h}};a.ga=function(){t.length=0;A=-1}};b4w.module.__camera=function(a,q){function c(b){var c={of:1};c.type=b;c.$d=null;c.ab=null;c.ec=null;if(b==a.Za)return c;c.Zd=new Float32Array(3);c.uo=new Float32Array(3);c.h=new Float32Array(4);c.Aa=new Float32Array(16);c.ta=new Float32Array(16);c.wg=new Float32Array(16);c.Yp=new Float32Array(16);c.Uc=new Float32Array(16);c.wf=new Float32Array(16);c.Zk={left:[0,0,0,0],right:[0,0,0,0],top:[0,0,0,0],bottom:[0,0,0,0],pb:[0,0,0,0],bb:[0,0,0,0]};switch(b){case a.$c:d(c,x,O,S);break;case a.Bf:d(c,F,O,S);
break;case a.Cf:break;case a.Eg:break;case a.Fg:break;case a.rb:case a.Fb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function b(b,c,d){if(b.type!=a.rb&&b.type!=a.Fb)throw"set_stereo_params(): wrong camera type";b.Pj=c;b.Dd=d;n(b,b.jb)}function e(a,b){var c=a.d,d=y.Xb(c.h,y.Jd,P),e=Math.asin(d[1]/u.length(d));if(0==d[0]&&0==d[2])c=0;else if(Math.abs(e)>Math.PI/4){var f=y.Xb(c.h,y.hk,M),c=Math.atan(Math.abs(f[0]/f[2]));0>=d[1]?(0>f[2]&&
(c=Math.PI-c),0>f[0]&&(c=2*Math.PI-c)):(0<f[2]&&(c=Math.PI-c),0<f[0]&&(c=2*Math.PI-c))}else c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c);b[0]=c;b[1]=e;return b}function d(b,c,d,e,f){switch(b.type){case a.$c:case a.rb:case a.Fb:b.nd=c;b.jb=1;break;case a.Bf:b.top=c;b.jb=1;break;case a.Cf:delete b.nd;b.nd=c;b.jb=f/c;break;case a.Eg:b.top=c;b.jb=f/c;break;default:D.error("set_frustum(): Unsupported camera type: "+b.type)}b.pb=d;b.bb=e}function h(b,c){var d=c.d.e,e=c.d.h,
f=r;w.rotateX(c.d.I,-Math.PI/2,f);w.invert(f,b.Aa);if(b.yb){var f=b.yb[0],h=b.yb[1],p=b.yb[2],t=b.yb[3],s=r;s[0]=1-2*f*f;s[1]=-2*f*h;s[2]=-2*f*p;s[3]=0;s[4]=-2*f*h;s[5]=1-2*h*h;s[6]=-2*h*p;s[7]=0;s[8]=-2*f*p;s[9]=-2*h*p;s[10]=1-2*p*p;s[11]=0;s[12]=-2*f*t;s[13]=-2*h*t;s[14]=-2*p*t;s[15]=1;w.multiply(b.Aa,s,b.Aa);n(b,b.jb,!0);f=K;h=r;w.invert(b.Aa,h);w.transpose(h,h);g.transformMat4(b.yb,h,f);h=B;h[0]=(y.nf(f[0])+b.ta[8])/b.ta[0];h[1]=(y.nf(f[1])+b.ta[9])/b.ta[5];h[2]=-1;h[3]=(1+b.ta[10])/b.ta[14];
g.scale(f,2/(f[0]*h[0]+f[1]*h[1]+f[2]*h[2]+f[3]*h[3]),f);b.ta[2]=f[0];b.ta[6]=f[1];b.ta[10]=f[2]+1;b.ta[14]=f[3]}b.type==a.rb?b.Aa[12]+=b.Dd/2:b.type==a.Fb&&(b.Aa[12]-=b.Dd/2);w.copy(b.wf,b.Yp);w.multiply(b.ta,b.Aa,b.wf);l(b);k(b);u.copy(b.Zd,b.uo);u.copy(d,b.Zd);E.copy(e,b.h)}function p(b,c,d,e){w.lookAt(c,d,e,b.Aa);b.type==a.rb?b.Aa[12]+=b.Dd/2:b.type==a.Fb&&(b.Aa[12]-=b.Dd/2);w.multiply(b.ta,b.Aa,b.wf);l(b);k(b);u.copy(c,b.Zd)}function n(b,c,d){switch(b.type){case a.$c:if(!c)throw"No aspect ratio";
b.jb=c;case a.Cf:w.perspective(y.Sy(b.nd),b.jb,b.pb,b.bb,b.ta);break;case a.Bf:if(!c)throw"No aspect ratio";b.jb=c;case a.Eg:c=b.top*b.jb;w.ortho(-c,c,-b.top,b.top,b.pb,b.bb,b.ta);break;case a.Fg:w.ortho(b.left,b.right,b.bottom,b.top,b.pb,b.bb,b.ta);break;case a.rb:case a.Fb:if(!c)throw"No aspect ratio";b.jb=c;var e=Math.tan(b.nd*Math.PI/360);c=b.pb*e;var f=b.jb*b.Pj*e;b.type==a.rb?(e=f-b.Dd/2,f+=b.Dd/2):(e=f+b.Dd/2,f-=b.Dd/2);e=-(b.pb/b.Pj*e);f*=b.pb/b.Pj;w.frustum(e,f,-c,c,b.pb,b.bb,b.ta);b.left=
e;b.right=f;break;case a.Za:return;default:throw"Wrong camera type: "+b.type;}d||(w.multiply(b.ta,b.Aa,b.wf),l(b),k(b))}function k(a){w.copy(a.Aa,a.Uc);a.Uc[12]=0;a.Uc[13]=0;a.Uc[14]=0;a.Uc[15]=1;w.multiply(a.ta,a.Uc,a.Uc);w.invert(a.Uc,a.Uc)}function l(a){w.copy(a.Aa,a.wg);w.multiply(a.ta,a.wg,a.wg);w.invert(a.wg,a.wg)}function s(a){return"CAMERA"===a.type?!0:!1}var f=q("__boundings"),t=q("__config"),A=q("__constraints"),D=q("__print"),y=q("__util"),u=q("vec3"),g=q("vec4"),E=q("quat"),I=q("mat3"),
w=q("mat4"),G=t.controls;a.Za=10;a.$c=20;a.Bf=30;a.Cf=40;a.Eg=50;a.Fg=60;a.rb=70;a.Fb=80;a.Xm=0;a.yr=1;a.ze=2;a.ik=3;var F=2.5,x=40,O=0.1,S=1E3,Q=new Float32Array(2),P=new Float32Array(3),M=new Float32Array(3),H=new Float32Array(4),K=new Float32Array(4),B=new Float32Array(4),L=new Float32Array(16),r=new Float32Array(16);a.Dt=function(b){var e=b.d,f=b.data;switch(f.type){case "PERSP":var g=c(a.$c);if(f.angle_y)var k=180*(f.angle_y/Math.PI);d(g,k,f.clip_start,f.clip_end);break;case "ORTHO":g=c(a.Bf),
d(g,f.ortho_scale/2,f.clip_start,f.clip_end)}g.name=b.name;e.tm=G.Bt.slice();e.GA=!1;a:switch(f.b4w_move_style){case "STATIC":k=a.Xm;break a;case "TARGET":k=a.ze;break a;case "EYE":k=a.ik;break a;default:throw"Unknown move style";}e.Vf=k;e.Wd=b.data.dof_distance;e.Zg=b.data.dof_object;e.Yg=b.data.b4w_dof_front;e.$g=b.data.b4w_dof_rear;e.Xd=b.data.b4w_dof_power;e.ca=[g];e.VA=f.b4w_use_distance_limits;e.wv=f.b4w_distance_min;e.vv=f.b4w_distance_max;e.Vf==a.ze?(e.ef=new Float32Array(3),g=new Float32Array(f.b4w_target),
a.qq(b,g)):e.ef=null;e.qc=null;e.Vf!=a.ze&&e.Vf!=a.ik||!f.b4w_use_vertical_clamping||(e.qc={ah:f.b4w_rotation_down_limit,fi:f.b4w_rotation_up_limit})};a.qq=function(a,b){var c=a.d;u.copy(b,c.ef);c.VA?A.qn(a,c.ef,c.wv,c.vv):A.vn(a,c.ef)};a.hb=c;a.OB=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.ab);case "DEPTH":return Boolean(a.ec);case "SCREEN":return!Boolean(a.ab)&&!Boolean(a.ec);default:throw"Wrong attachment type: "+b;}};a.Ij=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.ab=
c;break;case "DEPTH":a.ec=c;break;case "SCREEN":a.ab=null;a.ec=null;break;default:throw"Wrong attachment type: "+b;}};a.zC=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.ab;case "DEPTH":return a.ec;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.Cp=function(c,d){if(c.type!=a.$c||d!=a.rb&&d!=a.Fb)throw"make_stereo(): wrong camera type";c.type=d;b(c,6,0.065)};a.Mz=b;a.hq=function(a,b){var c=a.d.h,d=P;d[0]=0;d[1]=1;d[2]=0;E.setAxisAngle(d,b,H);E.multiply(H,c,c)};
a.pD=function(a,b){var c=a.d.h,d=P;d[0]=1;d[1]=0;d[2]=0;E.setAxisAngle(d,b,H);E.multiply(H,c,c)};a.oD=function(a,b){var c=a.d.h;E.invert(c,c);var d=P;d[0]=0;d[1]=0;d[2]=1;E.setAxisAngle(d,-b,H);E.multiply(H,c,c);E.invert(c,c)};a.Tl=function(a,b){var c=a.d.h;E.invert(c,c);var d=P;d[0]=1;d[1]=0;d[2]=0;E.setAxisAngle(d,-b,H);E.multiply(H,c,c);E.invert(c,c)};a.qw=e;a.oq=d;a.Dz=function(b,c,d,e,f,g,k){switch(b.type){case a.Fg:b.left=c;b.right=d;b.bottom=e;b.top=f;b.pb=g;b.bb=k;break;default:D.error("set_frustum_asymmetric(): Unsupported camera type: "+
b.type)}};a.Nw=function(a){return a.d.Vf};a.sD=h;a.tD=p;a.tq=function(a,b,c){var d=P;d[0]=0;d[1]=-1;d[2]=0;u.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=M;e[0]=0;e[1]=0;e[2]=-1;u.transformQuat(e,c,e);p(a,b,d,e)};a.qD=function(a,b,c){if("CAMERA"!=a.type)throw"Wrong camera object";a=a.d;a.e[0]=b[0];a.e[1]=b[1];a.e[2]=b[2];a.h[0]=c[0];a.h[1]=c[1];a.h[2]=c[2];a.h[3]=c[3]};a.Ov=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];w.lookAt(a,b,c,r);w.invert(r,r);w.rotateX(r,Math.PI/2,r);I.fromMat4(r,
L);E.fromMat3(L,e)};a.Vq=function(a){var b=a.d.ca;if(!b)throw"Wrong object";for(var c=a.d,d=0;d<b.length;d++){var e=b[d];h(e,a);y.ro(e.wf,e.Zk);if(e.Zg)if(e.Qk){var f=u.dist(c.e,e.Zg.location);e.Wd=f}else e.Wd=0}};a.Rt=function(b){var c=b.d;if(null!==c.qc){var d=e(b,Q),f=d[0],d=d[1],g=y.Xb(c.h,y.hk,P),g=y.nf(g[1]);Math.abs(d)>Math.PI/4&&1==g&&(f+=Math.PI);var k=d;1==g&&(k=y.nf(d)*Math.PI-d);var l=!1;if(k<-c.qc.ah){var r=-c.qc.ah;r<-Math.PI/2&&(r=-Math.PI-r);var h=-g*(r-d);1==g&&c.qc.ah<Math.PI/2&&
(f+=Math.PI,h+=Math.PI-2*c.qc.ah);l=!0}k>c.qc.fi&&(r=c.qc.fi,r>Math.PI/2&&(r=Math.PI-r),h=-g*(r-d),1==g&&c.qc.fi<Math.PI/2&&(f+=Math.PI,h-=Math.PI-2*c.qc.fi),l=!0);l&&(c.Vf==a.ze&&(d=Math.sin(f),f=Math.cos(f),g=Math.sin(r),r=Math.cos(r),c.e[0]-=b.xa.target[0],c.e[1]-=b.xa.target[1],c.e[2]-=b.xa.target[2],k=u.length(c.e),c.e[0]=r*d,c.e[1]=-g,c.e[2]=r*f,u.scale(c.e,k/u.length(c.e),c.e),c.e[0]+=b.xa.target[0],c.e[1]+=b.xa.target[1],c.e[2]+=b.xa.target[2]),b=u.transformQuat(y.Pm,c.h,P),u.normalize(b,
b),h=E.setAxisAngle(b,h,H),E.multiply(h,c.h,c.h))}};a.TC=function(b){switch(b.type){case a.$c:case a.Bf:case a.rb:case a.Fb:return!0;default:return!1}};a.rw=function(b){b=b.d.ca[0];switch(b.type){case a.$c:case a.Cf:case a.rb:case a.Fb:return Math.PI*b.nd/180;default:return D.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.gg=n;a.wt=k;a.yt=l;a.qo=function(b,c,d,e){e||(e=new Float32Array(24));c||(c=b.pb);d||(d=b.bb);var f,g,k,l,h,p,n,t;switch(b.type){case a.Za:throw"Extraction from NONE camera is not possible";
case a.$c:case a.Cf:f=c*Math.tan(b.nd*Math.PI/360);g=f*b.jb;l=-f;k=-g;h=d*Math.tan(b.nd*Math.PI/360);p=h*b.jb;t=-h;n=-p;break;case a.Bf:case a.Eg:k=b.top*b.jb;f=h=b.top;g=p=k;l=t=-b.top;k=n=-k;break;case a.Fg:f=h=b.top;g=p=b.right;l=t=b.bottom;k=n=b.left;break;case a.rb:case a.Fb:f=c*Math.tan(b.nd*Math.PI/360);g=b.right;l=-f;k=b.left;n=d/c;h=f*n;p=g*n;t=l*n;n*=k;break;default:throw"Wrong camera type: "+b.type;}e[0]=k;e[1]=l;e[2]=-c;e[3]=g;e[4]=l;e[5]=-c;e[6]=g;e[7]=f;e[8]=-c;e[9]=k;e[10]=f;e[11]=
-c;e[12]=n;e[13]=t;e[14]=-d;e[15]=n;e[16]=h;e[17]=-d;e[18]=p;e[19]=h;e[20]=-d;e[21]=p;e[22]=t;e[23]=-d;c=r;w.invert(b.Aa,c);y.ff(e,c,e,0);return e};a.et=function(a){a=a.d;var b=f.Id();b.R=-0.5;b.V=0.5;b.B=-0.5;b.G=0.5;b.pa=0;b.ja=1.8;a.Rb=b;a.dd={J:[0,0,0],ua:0,ua:2};a.yk={ua:0.35,height:1.05,J:[0,0,0.725]}};a.Qf=s;a.mj=function(b){return s(b)&&b.d&&b.d.Vf==a.ze?!0:!1}};b4w.module.__lights=function(a,q){function c(a){a.Rg[0]=a.color[0]*a.Kf;a.Rg[1]=a.color[1]*a.Kf;a.Rg[2]=a.color[2]*a.Kf}var b=q("__util"),e=q("vec3"),d=0;a.Ox=function(a){var p={};p.direction=new Float32Array(3);e.normalize(p.direction,p.direction);p.color=new Float32Array(3);p.Kf=1;p.Rg=new Float32Array(3);c(p);p.distance=25;p.nw=!1;p.index=d++;p.name=a.name;var n=a.data;p.type=n.type;var k=b.Xb(a.d.h,b.ib,[]);e.normalize(k,k);p.direction[0]=k[0];p.direction[1]=k[1];p.direction[2]=k[2];p.color[0]=
n.color[0];p.color[1]=n.color[1];p.color[2]=n.color[2];p.Kf=n.energy;c(p);p.distance=n.distance;if("POINT"===p.type||"SPOT"===p.type)p.oC=n.falloff_type;"SPOT"===p.type&&(p.mA=n.spot_size,p.lA=n.spot_blend);p.nw=n.b4w_generate_shadows;p.Cv=n.b4w_dynamic_intensity;a.tc=p};a.Hz=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];c(a)};a.pq=function(a,b){a.Kf=b;c(a)};a.PA=function(a){if("LAMP"!=a.type)throw"Wrong light object";var c=a.tc;c&&b.Xb(a.d.h,b.ib,c.direction)};a.ga=function(){d=0}};b4w.module.__scenes=function(a,q){function c(){if(!Fa)throw"no active scene";return Fa}function b(a,b){b||(b="ALL");var c=[];e(a.objects,b,c);return c}function e(a,b,c){for(var d=0;d<a.length;d++){var f=a[d];"ALL"!=b&&b!=f.type||c.push(f);(f=f.dupli_group)&&e(f.objects,b,c)}}function d(a){var b=Q(a),c=[];a=O(a,"MESH");for(var d=0;d<b.length;d++){var e=b[d];if(e.b4w_water){for(var f={},m=0;m<a.length;m++)for(var v=a[m],g=v.data.materials,k=0;k<g.length;k++)g[k]==e&&(f.xf=v.location[1]);if(ia.Jc)for(f.Hb=
e.b4w_water_fog_color.slice(0),f.Hb.push(e.b4w_water_fog_density),e.b4w_water_dynamic?(f.Jf=!0,f.$j=e.b4w_waves_height,f.Im=e.b4w_waves_length,f.$i=e.b4w_water_dst_noise_scale0,f.aj=e.b4w_water_dst_noise_scale1,f.Yi=e.b4w_water_dst_noise_freq0,f.Zi=e.b4w_water_dst_noise_freq1,f.Pi=e.b4w_water_dir_min_shore_fac,f.Ni=e.b4w_water_dir_freq,f.Ri=e.b4w_water_dir_noise_scale,f.Qi=e.b4w_water_dir_noise_freq,f.Oi=e.b4w_water_dir_min_noise_fac,f.Xi=e.b4w_water_dst_min_fac,f.Hm=e.b4w_water_waves_hor_fac):(f.Jf=
!1,f.$j=0,f.Im=0),f.Ci=null,f.Fk=null,f.Gk=new Float32Array(2),f.Cd=null,e=e.texture_slots,m=0;m<e.length;m++)v=e[m].texture,"VORONOI"==v.type&&(f.Ci=v.noise_scale,f.Gk=v.b4w_uv_velocity_trans,f.Fk=v.noise_intensity),!0===v.b4w_shore_dist_map&&(f.Cd=v.image,f.ig=v.image.size[0],f.Yz=v.b4w_shore_boundings,f.xh=v.b4w_max_shore_dist);else f.$j=0,f.Im=0,f.Ci=null,f.Fk=null,f.Gk=null,f.Hb=null,f.Jf=!1;c.push(f)}}if(0<c.length){f=c[0];if(!f.Jf)for(d=0;d<c.length;d++)c[d].Jf&&(f=c[d]);return f}return null}
function h(a){a=O(a,"MESH");for(var b=0;b<a.length;b++)for(var c=a[b].data.materials,d=0;d<c.length;d++){var e=c[d];if(e.b4w_skydome&&e.b4w_procedural_skydome)return!0}return!1}function p(a){var b={};a=a.world.b4w_sky_settings;b.Xh=a.color;b.Mh=a.rayleigh_brightness;b.yh=a.mie_brightness;b.$h=a.spot_brightness;b.Sh=a.scatter_strength;b.Oh=a.rayleigh_strength;b.Bh=a.mie_strength;b.Nh=a.rayleigh_collection_power;b.zh=a.mie_collection_power;b.Ah=a.mie_distribution;return b}function n(a){var b={};a=a.world.b4w_ssao_settings;
b.Ty=a.radius_increase;b.xv=a.dithering_amount;b.aw=a.gauss_center;b.cw=a.gauss_width*a.gauss_width;b.bw=a.gauss_width_left*a.gauss_width_left;b.wx=a.influence;b.uv=a.dist_factor;b.fz=a.samples;return b}function k(a){var b=a.world,c=[0,0,0],d=[0,0,0],e=a.world.light_settings;if(e.use_environment_light)if("SKY_COLOR"==e.environment_color)c=a.world.horizon_color.slice(0),d=b.zenith_color.slice(0);else if("PLAIN"==e.environment_color)c=[1,1,1],d=[1,1,1];else throw"Unsupported world environment color"+
e.environment_color;a={};a.Yd=e.environment_energy;a.Mc=c;a.Wc=d;return a}function l(a){a=O(a,"MESH");for(var b=0;b<a.length;b++)if(a[b].d.oe)return!0;return!1}function s(a,b,c){c=da.uj(a,b);da.Ed(a,c,function(a,c,d){if(d.Da){switch(d.A){case "COLOR":case "CUBEMAP":a=c.i.ab;break;case "DEPTH":a=c.i.ec;break;case "SCREEN":a=null;break;default:throw"Wrong slink";}switch(d.W){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:if(!a)throw"Connection of SCREEN is forbidden";
c=b.n;for(var e=0;e<c.length;e++){var f=c[e].m;V.Pn(f.mc,d.W)&&z.si(f,a,d.W)}}}});for(a=0;a<b.Z.length;a++){var d=b.Z[a],e=b.Pb[a];switch(d.W){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:for(var f=b.n,m=0;m<f.length;m++)c=f[m].m,V.Pn(c.mc,d.W)&&z.si(c,e,d.W)}}}function f(a,b,c,d,e){var f=b.d;b=b.aa;for(var m=0;m<b.length;m++){var v=b[m];if(!(v.oc||v.zc||"SHADELESS"!=v.type&&"MAIN"!=v.type&&"NODES"!=v.type||g(a,v))){if("OPAQUE"===d){if(v.P)continue;var k=aa.Ra(c,
"SHADOW_CAST")&&v.Ab?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE"}else if("BLEND"===d){if(!v.P)continue;if(aa.Ra(c,"SHADOW_CAST")&&v.Ab)switch(ia.Ad){case "RGBA":k="SHADOW_SRC_RGBA";break;case "RGBA_PCF":k="SHADOW_SRC_RGBA_PCF";break;case "DEPTH":k="SHADOW_SRC_DEPTH";break;case "VSM":k="SHADOW_SRC_VSM";break;default:throw"Wrong shadows type";}else k="SHADOW_SRC_NONE"}else throw"Wrong main subscene type";var l=v.za;V.C(l,"SHADOW_SRC",k);z.sk(v,w(e));V.C(l,"NUM_LIGHTS",a.Dh);"special_skydome.glslf"==V.Jo(l)&&
V.C(l,"REFLECTION_PASS",0);V.C(l,"SSAO_ONLY",0);a.Ca&&a.Eb?V.C(l,"WATER_EFFECTS",1):V.C(l,"WATER_EFFECTS",0);a.Ca&&a.Ff&&f.Ff?(V.C(l,"CAUSTICS",1),V.C(l,"CAUST_SCALE",a.Kn),V.C(l,"CAUST_SPEED",V.u(a.Ln,2)),V.C(l,"CAUST_BRIGHT",a.Jn)):V.C(l,"CAUSTICS",0);a.Ca&&(V.C(l,"WAVES_HEIGHT",V.u(a.yf)),V.C(l,"WAVES_LENGTH",V.u(a.zg)),V.C(l,"WATER_LEVEL",V.u(a.xf)));v.Oc&&aa.Ra(c,"MAIN_REFLECT")&&-1===v.$b.indexOf("u_mirrormap")?V.C(l,"REFLECTIVE",1):V.C(l,"REFLECTIVE",0);var r=aa.Ra(c,"SKY");if(r)if(v.$f){var h=
r.i.ab;z.si(v,h,"u_sky")}else!ia.ud||"MAIN_OPAQUE"!==a.type&&"MAIN_BLEND"!==a.type?V.C(l,"PROCEDURAL_FOG",0):(v.jd=r.jd,V.C(l,"PROCEDURAL_FOG",1));else V.C(l,"PROCEDURAL_FOG",0);v.ra&&(r=aa.Ra(c,"GRASS_MAP"))&&u(v,r,f);v.yg&&(aa.Ra(c,"REFRACT")?V.C(l,"REFRACTIVE",1):V.C(l,"REFRACTIVE",0),v.cr&&aa.Ra(c,"DEPTH")?V.C(l,"SHORE_SMOOTHING",1):V.C(l,"SHORE_SMOOTHING",0),v.rc&&a.Ca&&a.yf?V.C(l,"DYNAMIC",1):V.C(l,"DYNAMIC",0));ia.Yb&&!J.context.alpha?V.C(l,"SMAA_JITTER",1):V.C(l,"SMAA_JITTER",0);if("OPAQUE"===
d||"BLEND"===d)for(l=v.Pa,r=0;r<l.length;r++){var h=l[r],p=h.Lp;if(p){var n=p.d.Ta,T=null,B=null;da.sf(n,function(a,b,c){if("SCREEN"==c.A)return T=da.Sa(n,a),B=c,!0});if(!T||!B)throw"Failed to assign RTT";Ea.Kj(h,Ea.t,Ea.t);B.va=h;var E=T.i;E.ab=h;E.$d=Ka.fq(h,null);P(p,ba.Ze,ba.Ze,!0);h=aa.co(n);for(p=h.length-1;0<=p;p--)E=h[p],ka.gg(E.i,1),e.d.Lh.unshift(E)}}y(c,a,k);z.Cb(v);k={T:!0,Ya:f,m:v};t(v);a.n.push(k);s(c,a,v);A(v)}}a.n.sort(function(a,b){return a.m&&b.m?(a.m.P==b.m.P?0:a.m.P>b.m.P?1:-1)||
(a.m.je==b.m.je?0:a.m.je>b.m.je?1:-1):0})}function t(a){var b=a.mc.attributes,c=a.Sb.kc,d;for(d in b)if(!c[d])throw'B4W Error: missing data for "'+d+'" attribute';"MAIN"==a.type&&(b=4+D(a.mc.attributes,["a_color","a_tangent","a_texcoord"]),b+=D(a.mc.Fd,["u_shadow_map0","u_shadow_map1","u_shadow_map2","u_shadow_map3","u_shadow_mask"]),b>Ia&&va.warn("B4W Warning: Varying limit exceeded for main shader - "+b+', materials "'+a.ob.join(", ")+'"'));"NODES"==a.type&&(b=2,d=c=0,a.uf&&(c+=qa.Ho(a.uf),b+=c),
a.Ka&&(d+=qa.Ho(a.Ka),b+=d),b+=D(a.mc.attributes,["a_color","a_normal","a_tangent"]),b+=D(a.mc.Fd,["u_shadow_map0","u_shadow_map1","u_shadow_map2","u_shadow_map3","u_shadow_mask"]),b>Ia&&va.warn("B4W Warning: Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials "'+a.ob.join(", ")+'"'))}function A(a){a.Pa.length>Ob&&va.warn("B4W Warning: too many textures used - "+a.Pa.length+" (max "+Ob+'), materials "'+a.ob.join(", ")+'"')}function D(a,b){for(var c=0,d=0;d<b.length;d++)b[d]in
a&&c++;return c}function y(a,b,c){for(var d=0,e=aa.Ko(a,b),f=0;f<e.length;f++){var v=e[f];"SHADOW_SRC_RGBA"!=c&&"SHADOW_SRC_RGBA_PCF"!=c&&"SHADOW_SRC_DEPTH"!=c&&"SHADOW_SRC_VSM"!=c||"SHADOW_CAST"!=v.type&&"POSTPROCESSING"!=v.type||(v=aa.Qv(a,v,"SHADOW_CAST").i,b.XA=v.Aa,b.ht=new Float32Array([0.5,0,0,0,0,0.5,0,0,0,0,0.5,0,0.5,0.5,0.5,1]),b.Zf=b.Zf||[],b.Zf[d]=v.ta,d++)}}function u(a,b,c){a.Ub=b.Ub;var d=b.Ub[0],e=b.Ub[1],f=b.Ub[2];c=c.Rb;c=Math.max(c.V-c.R,c.ja-c.pa);f=0==f?c:Math.max(f,c);b.Ub[2]=
f;b=b.i;ka.oq(b,f/2,-e,-d,f/2);ka.gg(b);d=a.Zo||0;d=0==d?c:Math.max(d,c);a.Zo=d}function g(a,b){for(var c=a.n,d=0;d<c.length;d++){var e=c[d].m;if(e&&e.id==b.id)return!0}return!1}function E(a){var b=K(a,"MAIN_OPAQUE");da.S(a.d.Ta,function(c,d){"SHADOW_CAST"===d.type&&I(d,b,d.n,a)})}function I(a,b,c,d){if(0!=c.length){var e=a.i;b=b.i;var f=S(d,"LAMP"),v;a:{for(v=0;v<f.length;v++){var m=f[v];if(m.data.b4w_generate_shadows){v=m;break a}}v=!1}f=(v||f[0]).d;ka.tq(e,f.e,f.h);N.copy(b.Zd,e.Zd);d=d.d.Wh;a=
d.Wg*d.Ie*Math.pow(d.Vg/d.Ie,(a.fo+1)/d.Xg)+(1-d.Wg)*(d.Ie+(a.fo+1)/d.Xg*(d.Vg-d.Ie));a=a>b.bb?b.bb:a;d=xb;f=Ua;ka.qo(b,b.pb,a,f);qa.ff(f,e.Aa,f,0);ea.jt(f,d);b=jb;ea.Id(b);f=e.Aa;v=!1;for(m=0;m<c.length;m++){var g=ea.zi(c[m].Ya.cd,f,Bc);ea.It(g,d)&&(v?ea.po(b,g):(ea.hu(g,b),v=!0))}c=b.ja;ea.aA(b,d,b);b.ja=c;c=b.V-b.R;d=b.G-b.B;v=64/Math.ceil(64/(c/(2*a)));f=64/Math.ceil(64/(d/(2*a)));v=2*v*a;a*=2*f;b.R-=0.5*(v-c);b.V+=0.5*(v-c);b.B-=0.5*(a-d);b.G+=0.5*(a-d);c=(b.V-b.R)/ba.zd;a=(b.G-b.B)/ba.zd;b.R=
Math.floor(b.R/c)*c;b.V=Math.floor(b.V/c)*c;b.B=Math.floor(b.B/a)*a;b.G=Math.floor(b.G/a)*a;ka.Dz(e,b.R,b.V,b.B,b.G,-b.ja,-b.pa);ka.gg(e);qa.ro(e.wf,e.Zk)}}function w(a){var b=a.d.Wh;a=b.Ie;for(var c=b.Vg,d=b.Xg,b=b.Wg,e=[],f=1;f<=d;f++){var v=b*a*Math.pow(c/a,f/d)+(1-b)*(a+f/d*(c-a));v===Math.round(v)&&(v+=1E-4);e.push(v)}return e}function G(a){var b=qa.Di(a);a.za=JSON.parse(JSON.stringify(a.za));return b}function F(a,b){for(var c=H(b,Ba),d=a.tc,e=a.d,f=d.index,v=0;v<c.length;v++){var m=c[v];m.th.set(e.e,
3*f);m.qh.set(d.direction,3*f);m.ph.set(d.Rg,3*f);var g=hb;g[0]=1;g[1]=0;g[2]=0;g[3]=0;var k=ib;k[0]=-1;k[1]=-1;k[2]=-1;k[3]=0;switch(d.type){case "SUN":m.ci.set(e.h,0);m.bi=d.Rg;if("SKY"===m.type){var l=gb;l[0]=l[1]=l[2]=1;var r=Math.acos(N.dot(m.rf,l)),l=Math.acos(N.dot(d.direction,l));m.tj=Math.floor(r/0.025)!=Math.floor(l/0.025)?!0:!1;N.copy(d.direction,m.rf);x(b,m)}else N.copy(d.direction,m.rf);break;case "HEMI":g[0]=0.5;g[1]=0.5;break;case "POINT":k[2]=d.distance;break;case "SPOT":k[2]=d.distance;
r=k[0]=Math.cos(d.mA/2);k[1]=d.lA*(1-r);break;default:va.error("B4W Warning: unknown light type: "+d.type)}m.rh.set(g,4*f);m.sh.set(k,4*f);m.Ma=!0}}function x(a,b){Ka.Vi(b);if(b.tj)for(var c=H(a,["MAIN_OPAQUE","MAIN_BLEND"]),d=0;d<c.length;d++)for(var e=c[d].n,f=0;f<e.length;f++){var v=e[f];v.T&&(v=v.m,z.Ht(v)&&Ka.KA(v))}}function O(a,b){if(!a.Ef)throw"Access to uninitialized scene";b||(b="ALL");return a.Ef[b]}function S(a,b){b||(b="ALL");return a.Gb[b]}function Q(a){var b=[];a=O(a,"MESH");for(var c=
0;c<a.length;c++)for(var d=a[c].data,e=0;e<d.materials.length;e++){var f=d.materials[e];-1==b.indexOf(f)&&b.push(f)}return b}function P(a,b,c,d){for(var e=a.camera.d.ca,f=0;f<e.length;f++)ka.gg(e[f],b/c);ka.Vq(a.camera);aa.EA(a.d.Ta,function(e,f,v){if(d||e.gi){var m=e.of*b,g=e.of*c;if(f)for(f=0;f<v.Z.length;f++)v.Z[f]==e&&Ea.dg(e.va,m,g);else Ea.mh(e.va)&&Ea.dg(e.va,m,g),e=v.i,e.width=m,e.height=g,"DOF"==v.type&&B(a,{dof_power:v.i.Xd,dof_on:v.i.Qk}),M(v,1/b,1/c)}})}function M(a,b,c){a=a.n;for(var d=
0;d<a.length;d++){var e=a[d].m;e&&e.$&&z.Vh(e,b,c)}}function H(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];da.S(a.d.Ta,function(a,b){b.type==e&&c.push(b)})}return c}function K(a,b){return aa.Ra(a.d.Ta,b)}function B(a,b){var c=K(a,"DOF");if(!c)return va.error("DOF is not enabled on scene. Check camera settings"),0;var d=a.d.Ta;"dof_on"in b&&(c.i.Qk=parseFloat(b.dof_on));"dof_distance"in b&&(c.i.Wd=b.dof_distance);"dof_front"in b&&(c.i.Yg=b.dof_front);"dof_rear"in b&&(c.i.$g=b.dof_rear);if("dof_power"in
b){c.i.Xd=b.dof_power;for(var e=aa.cb(d,c,"POSTPROCESSING"),d=aa.cb(d,e,"POSTPROCESSING"),e=[e,d],d=0;d<e.length;d++){var f=e[d].n[0].m;f&&f.$&&(z.yd(f,c.i.Xd),M(e[d],1/c.i.width,1/c.i.height))}}c.Ma=!0}function L(a,b){b.T!=a.T&&"POSTPROCESSING"==a.type&&a.kj&&(a.T=b.T)}function r(a,b,c,d){var e=da.Sa(a,b);ka.Ij(e.i,c,d);e.tk=!0;da.we(a,b,function(b,e,f){f.Da&&f.A==c&&aa.Qt(f)&&m(a,b,f.W,d)});da.Ed(a,b,function(b,e,f){f.Da&&f.A==c&&f.A==f.W&&r(a,b,c,d)})}function m(a,b,c,d){a=da.Sa(a,b).n;for(b=0;b<
a.length;b++)z.cz(a[b].m,d,c)}function R(a){var b=K(a,"GRASS_MAP");if(b){var c=b.i,d=a.camera.d,e=d.e;a=gb;a[0]=0;a[1]=-b.Ub[2]/2;a[2]=0;N.transformQuat(a,d.h,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=La;b[0]=0;b[1]=0;b[2]=0;b[3]=1;ka.tq(c,a,b)}}function U(a,b){da.S(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.Z[0]||!d.Pb[0])throw"Wrong MOTION_BLUR subscene";var e=d.Z[0],f=d.Pb[0];d.Pb[0]=d.i.ab;da.we(a,c,function(b,c,d){d.Da&&m(a,b,d.W,f)});r(a,c,e.A,f);m(a,c,e.W,d.Pb[0]);d.ey=Math.exp(-b/d.Cl)}})}function X(a){da.S(a,
function(b,c){if("SMAA_RESOLVE"==c.type){if(!c.Z[0]||!c.Pb[0])throw"Wrong SMAA RESOLVE subscene";var d=c.Pb[0];da.Ed(a,b,function(b,e,f){"VELOCITY"!=e.type&&(c.Pb[0]=e.i.ab,r(a,b,f.A,d))});m(a,b,"u_color",d);m(a,b,"u_color_prev",c.Pb[0])}})}function Z(b,c){var d=0,e=b.Bs;0==e.rm&&(e.rm=c);var f=c-e.rm;if(e.bq&&f/e.Cj>=e.bq)a.Vn(b);else{f%=e.Cj;if(f<e.Yo)switch(e=f/(e.Yo/5),f=Math.floor(e),f){case 0:d=(e-f)/2;break;case 1:d=(e-f)/2+0.5;break;case 2:d=1;break;case 3:d=1-(e-f)/2;break;case 4:d=0.5-(e-
f)/2}for(e=0;e<b.aa.length;e++)f=b.aa[e],"COLOR_ID"==f.type&&"undefined"!==typeof f.ae&&(f.ae=d)}}function ha(a){da.S(a.d.Ta,function(a,b){b.Ma=!0})}var z=q("__batch"),ea=q("__boundings"),ka=q("__camera"),J=q("__config"),fa=q("__debug");q("__geometry");var da=q("__graph"),ga=q("__hud"),v=q("__particles"),T=q("__prerender"),ua=q("__primitives"),va=q("__print"),Ka=q("__renderer"),aa=q("__scenegraph"),Ya=q("__sfx"),V=q("__shaders"),Ea=q("__textures"),qa=q("__util"),N=q("vec3"),ia=J.s,ba=J.fg,la="ARMATURE CAMERA CURVE EMPTY LAMP MESH SPEAKER".split(" "),
yb="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT COLOR_PICKING DEPTH GLOW_MASK WIREFRAME".split(" "),Ba="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT GOD_RAYS SKY LUMINANCE_TRUNCED".split(" "),Na=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_REFLECT"],xa="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT COLOR_PICKING DEPTH GOD_RAYS GLOW_MASK WIREFRAME".split(" "),zb=["MAIN_OPAQUE","MAIN_BLEND","MAIN_REFLECT"],Ob=8,Fa=null,Ta=[],fb=[],Ub,Vb,Ia=10,Aa=new Float32Array(2),gb=new Float32Array(3),hb=new Float32Array(4),
ib=new Float32Array(4),La=new Float32Array(4),Ua=new Float32Array(24),xb=ea.Id(),jb=ea.Id(),Bc=ea.Id();a.mq=function(a){Fa=a;Ya.lz(a)};a.Ky=function(a){if(!a.jn){for(var b=a.d,c=aa.co(b.Ta),d=0;d<c.length;d++)b.Lh.push(c[d]);P(a,Ub,Vb,!1)}b=v.ac();a=H(a,xa);for(d=0;d<a.length;d++)a[d].ac=b};a.o=c;a.X=function(){return Fa?!0:!1};a.bl=function(){return Ta};a.Ms=function(a){a.Ef={ALL:[]};a.Gb={ALL:[]};for(var c in la){var e=la[c],f=b(a,e);a.Ef[e]=f;for(var v=0;v<f.length;v++)a.Ef.ALL.push(f[v]);a.Gb[e]=
[]}a.d=a.d||{};c=a.d;e=a.camera.d;f=a.world.b4w_shadow_settings;v=c.Wh={};v.Ie=f.csm_near;v.Vg=f.csm_far;v.Xg=f.csm_num;v.Wg=f.csm_lambda;v.Mg=f.blur_depth_size_mult;v.Lg=f.blur_depth_edge_size;v.Kg=f.blur_depth_diff_threshold/1E3;v.$q=f.visibility_falloff;f=a.world.b4w_fog_color;c.Hb=new Float32Array([f[0],f[1],f[2],a.world.b4w_fog_density]);if(ia.Jc){f=a.jn;a:{if("NONE"!=ia.Ad&&a.b4w_render_shadows)for(var m=v=!1,g=O(a,"MESH"),r=0;r<g.length;r++){var t=g[r];t.b4w_shadow_cast&&(v=!0);t.b4w_shadow_receive&&
(m=!0);if(v&&m){v=!0;break a}}v=!1}c.$y=v;c.sC=a.world.b4w_fog_color;a:{if(ia.Cc)for(v=Q(a),m=0;m<v.length;m++)if(g=v[m],g.b4w_water&&g.b4w_water_shore_smoothing){v=!0;break a}v=!1}c.Cc=v;if(ia.bg&&a.b4w_render_reflections)for(v=[],m=O(a,"MESH"),g=0;g<m.length;g++){if(t=m[g],t.b4w_reflective){b:{for(var r=t.constraints,t=t.b4w_lods_num,T=0,s=0;s<r.length;s++){var B=r[s];if("LOCKED_TRACK"==B.type){if(T==t){t=B.target;break b}T++}}t=null}t&&(r=t.location,t=t.d.h,T=new Float32Array(4),qa.DA(r,t,qa.ib,
T),v.push(T))}}else v=!1;c.Zy=v;c.Ca=d(a);c.$f=h(a);c.am=p(a);c.Eq=n(a);v={};m=a.world.b4w_bloom_settings;v.blur=m.blur;v.Dv=m.edge_lum;v.key=m.key;c.nt=v;v={};m=a.world.b4w_motion_blur_settings;v.Bl=m.motion_blur_decay_threshold;v.Cl=m.motion_blur_factor;c.by=v;v={};m=a.world.b4w_color_correction_settings;v.Og=m.brightness;v.Ug=m.contrast;v.dh=m.exposure;v.eg=m.saturation;c.Et=v;v={};m=a.world.b4w_god_rays_settings;v.Bx=m.intensity;v.wh=m.max_ray_length;v.ai=m.steps_per_pass;c.hx=v;v={};m=a.world;
v.fj=m.b4w_glow_color;v.jl=m.b4w_glow_factor;c.ex=v;c.Km=k(a);a:{if(ia.ra)for(m=v=!1,g=O(a,"MESH"),r=0;r<g.length;r++){T=g[r];s=T.data.materials;for(t=0;t<s.length;t++)s[t].b4w_terrain&&(v=!0);T=T.particle_systems;for(t=0;t<T.length;t++)s=T[t].settings,"HAIR"==s.type&&s.b4w_dynamic_grass&&(m=!0);if(v&&m){v=!0;break a}}v=!1}c.ra=v;c.he=ia.he&&a.b4w_enable_motion_blur;c.Ud=ia.Ud&&a.b4w_enable_color_correction;c.uc=ia.uc&&a.b4w_enable_antialiasing;c.tl=O(a,"LAMP").length;c.Qd=ia.Qd&&a.b4w_enable_bloom;
c.se=ia.se&&a.b4w_enable_ssao;c.be=ia.be&&a.b4w_enable_god_rays;c.me=ia.me&&a.b4w_render_refractions;c.Gi=l(a);c.xc=ia.xc?c.Gi:!1;c.Ta=aa.Ou(f,c,e)}else c.am=p(a),c.Km=k(a),c.Eq=n(a),c.tl=O(a,"LAMP").length,c.$f=h(a),c.Ca=d(a),c.ra=!1,c.Gi=l(a),c.Ta=aa.Pu(e,c);c.Lh=[];c.Gl=!1;c.Fl=!1;Ta.push(a)};a.Hi=b;a.fl=function(a){return a.d.Ta};a.fw=function(a){da.S(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=z.bo(c.Ej);break;case "SSAO":d=z.Vu(c.oA);break;case "DEPTH_PACK":d=z.yu();break;
case "BLUR_DEPTH":d=z.pu(c.orientation);z.yd(d,c.Mg);break;case "REFRACT":case "SCREEN":d=z.bo("NONE");break;case "GOD_RAYS":aa.cb(a,c,"WIREFRAME")||aa.cb(a,c,"MAIN_BLEND")||aa.cb(a,c,"GOD_RAYS");d=z.Cu(c.By?1:0,c.yb&&c.yg?1:0,c.ai);break;case "GOD_RAYS_COMBINE":aa.cb(a,c,"WIREFRAME")||aa.cb(a,c,"MAIN_BLEND");aa.cb(a,c,"GOD_RAYS");d=z.Du();break;case "MOTION_BLUR":d=z.Iu(c.Bl);break;case "DOF":d=z.zu();z.yd(d,c.i.Xd);for(var e=aa.cb(a,c,"POSTPROCESSING"),f=aa.cb(a,e,"POSTPROCESSING"),v=[e,f],m=0;m<
v.length;m++){var g=v[m].n;(e=g[0].m)&&e.$&&z.yd(e,c.i.Xd)}break;case "GLOW":v=aa.cb(a,c,"POSTPROCESSING");m=aa.cb(a,v,"POSTPROCESSING");e=aa.cb(a,m,"POSTPROCESSING");f=aa.cb(a,e,"POSTPROCESSING");d=z.Bu();v=[m,v];for(m=0;m<v.length;m++)g=v[m].n,(g=g[0].m)&&g.$&&z.yd(g,c.ot);v=[f,e];for(m=0;m<v.length;m++)g=v[m].n,(g=g[0].m)&&g.$&&z.yd(g,c.Jv*c.jl);break;case "COMPOSITING":d=z.vu();break;case "ANTIALIASING":d=z.lu();break;case "LANCZOS":d=z.Fu(c.YC);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=
z.Tu(c.type);break;case "ANAGLYPH":d=z.ku();break;case "HUD":d=z.Eu();e=Ea.Xu();z.si(d,e);break;case "SKY":d=z.Su();z.Vh(d,1/c.i.width,1/c.i.height);break;case "LUMINANCE":d=z.Gu();break;case "AVERAGE_LUMINANCE":d=z.mu();break;case "LUMINANCE_TRUNCED":d=z.Hu();break;case "BLOOM_BLUR":d=z.nu(c.Ej);z.Vh(d,1/c.i.width,1/c.i.height);break;case "BLOOM":d=aa.cb(a,c,"BLOOM_BLUR");v=[aa.cb(a,d,"BLOOM_BLUR"),d];for(m=0;m<v.length;m++)g=v[m].n,(g=g[0].m)&&g.$&&z.yd(g,c.En);d=z.ou();break;case "VELOCITY":d=
z.bv()}d&&(e={T:!0,Ya:qa.Ji("NONE"),m:d},t(d),c.n.push(e),s(a,c,d),A(d))})};a.Ig=function(a,b){var c=b.type,d=a.Gb[c];if(d)if(-1!=d.indexOf(b))va.error("B4W Error - add object(): already added");else switch(a.Gb[c].push(b),a.Gb.ALL.push(b),c){case "MESH":c=a.d.Ta;d=b.d;!aa.Ra(c,"SHADOW_CAST")&&d.Ab&&(d.Ab=!1);for(var d=H(a,yb),e=0;e<d.length;e++){var v=d[e],m=b,k=c,l=a;switch(v.type){case "MAIN_OPAQUE":f(v,m,k,"OPAQUE",l);break;case "MAIN_BLEND":f(v,m,k,"BLEND",l);break;case "MAIN_REFLECT":k=m.d;
m=m.aa;for(l=0;l<m.length;l++){var r=m[l],h=G(r);if(!("SHADELESS"!=h.type&&"MAIN"!=h.type&&"NODES"!=h.type||g(v,h)||h.P)&&h.Pc){var p=h.za;V.C(p,"DISABLE_FOG",0);V.C(p,"WATER_EFFECTS",0);"special_skydome.glslf"==V.Jo(p)&&V.C(p,"REFLECTION_PASS",1);V.C(p,"SHADOW_SRC","SHADOW_SRC_NONE");V.C(p,"TEXTURE_NORM",0);z.Cb(h);var n={T:!0,Ya:k,m:h};t(h);v.n.push(n);ia.Yb&&!J.context.alpha?V.C(p,"SMAA_JITTER",1):V.C(p,"SMAA_JITTER",0);"MAIN"==h.type&&(r.tb||(r.tb=[]),r.tb.push(h))}}break;case "DEPTH":r=m.d;m=
m.aa;for(h=0;h<m.length;h++)if(p=m[h],"DEPTH"==p.type&&!g(v,p)&&!p.oc){if(aa.sx(k,v,"SHADOW_CAST"))if(p.Ab){switch(ia.Ad){case "RGBA":var n="SHADOW_SRC_RGBA",T="SHADOW_DST_MASK";break;case "RGBA_PCF":n="SHADOW_SRC_RGBA_PCF";T="SHADOW_DST_MASK";break;case "DEPTH":n="SHADOW_SRC_DEPTH";T="SHADOW_DST_MASK";break;case "VSM":n="SHADOW_SRC_VSM";T="SHADOW_DST_MASK";break;default:throw"Wrong shadows type";}p=z.dj(p,n,T);z.sk(p,w(l));aa.Ko(k,v);y(k,v,n)}else p=z.dj(p,"SHADOW_SRC_NONE","SHADOW_DST_MASK");else p=
z.dj(p,"SHADOW_SRC_NONE","SHADOW_DST_NONE");p.ra&&(n=aa.Ra(k,"GRASS_MAP"))&&u(p,n,r);n=p.za;ia.Yb&&!J.context.alpha?V.C(n,"SMAA_JITTER",1):V.C(n,"SMAA_JITTER",0);z.Cb(p);n={T:!0,Ya:r,m:p};t(p);v.n.push(n);s(k,v,p);A(p)}break;case "SHADOW_CAST":r=!1;h=m.d;m=m.aa;for(p=0;p<m.length;p++)if(n=m[p],n.nc||n.Ab)if(r=!0,"DEPTH"==n.type&&!g(v,n)&&n.nc){switch(ia.Ad){case "RGBA":case "RGBA_PCF":T="SHADOW_DST_RGBA";break;case "DEPTH":T="SHADOW_DST_DEPTH";break;case "VSM":T="SHADOW_DST_VSM";break;default:throw"Wrong shadows type";
}n=z.dj(n,"SHADOW_SRC_NONE",T);n.ra&&(T=aa.Ra(k,"GRASS_MAP"))&&u(n,T,h);V.C(n.za,"SMAA_JITTER",0);z.Cb(n);T={T:!0,Ya:h,m:n};t(n);v.n.push(T)}r&&I(v,aa.Ra(k,"MAIN_OPAQUE"),v.n,l);break;case "COLOR_PICKING":k=m.d;m=m.aa;for(l=0;l<m.length;l++)r=m[l],"COLOR_ID"!=r.type||g(v,r)||(z.qa(r,"USE_GLOW",0),z.Cb(r),h={T:!0,Ya:k,m:r},t(r),v.n.push(h));break;case "GRASS_MAP":k=m.d;m=m.aa;for(l=0;l<m.length;l++)r=m[l],"GRASS_MAP"!=r.type||g(v,r)||(z.Cb(r),h={T:!0,Ya:k,m:r},t(r),v.n.push(h),r=v.i,T=k.cd,h=v.Ub[0],
p=v.Ub[1],n=v.Ub[2],0==h&&0==p?(h=T.B,p=T.G):(h=Math.min(h,T.B),p=Math.max(p,T.G)),T=1E-4*(p-h),v.Ub[0]=h-T,v.Ub[1]=p+T,ka.oq(r,n/2,-p,-h,n/2),ka.gg(r));break;case "GLOW_MASK":k=m.d;m=m.aa;for(l=0;l<m.length;l++)r=m[l],"COLOR_ID"!=r.type||g(v,r)||(h=G(r),h.ae=0,z.qa(h,"USE_GLOW",1),z.Cb(h),m.push(h),p={T:!0,Ya:k,m:h},t(h),v.n.push(p),r.tb||(r.tb=[]),r.tb.push(h));break;case "WIREFRAME":for(l=m.d,m=m.aa,r=0;r<m.length;r++)h=m[r],"WIREFRAME"!=h.type||g(v,h)||(h.ra&&(p=aa.Ra(k,"GRASS_MAP"))&&u(h,p,l),
z.Cb(h),p={T:!0,Ya:l,m:h},t(h),v.n.push(p),s(k,v,h),A(h))}}break;case "LAMP":c=H(a,Ba);for(d=0;d<c.length;d++)c[d].Dh++;F(b,a)}else va.error("B4W Error - add object(): unsupported object type",c)};a.JC=g;a.Ul=function(a){a.d.Gl=!0};a.Do=w;a.ux=function(a){a.d.gj=!0};a.$z=function(a){a.d.gj=!1};a.lD=function(a,b){var c=b.d;if("DYNAMIC"!=c.type)return!1;for(var d=H(a,yb),e=0;e<d.length;e++)for(var f=d[e].n,v=0;v<f.length;v++)f[v].Ya==c&&(f.splice(v,1),v--);c=a.Gb.MESH.indexOf(b);-1!=c&&a.Gb.MESH.splice(c,
1);c=a.Gb.ALL.indexOf(b);-1!=c&&a.Gb.ALL.splice(c,1)};a.Nt=function(a,b){return b.Gb[a.type]&&-1<b.Gb[a.type].indexOf(a)?!0:!1};a.Vj=F;a.ga=function(){for(var a=0;a<Ta.length;a++){var b=Ta[a];da.S(b.d.Ta,function(a,b){if("SINK"!=b.type){var c=b.i;Ka.az(c.$d,c.ab,c.ec,c.width,c.height);for(var c=b.n,d=0;d<c.length;d++){var e=c[d].m;e&&z.Tt(e)}}});b.d.Ta=[];b.d.Lh=[]}Fa=null;Ta.length=0;fb.length=0};a.Bp=function(a,b,c){a=ka.qo(a,a.pb,a.bb,null);var d=ua.jw(a);a=qa.Ji("DYNAMIC");a.cd=a.Rb={V:1E12,R:-1E12,
G:1E12,B:-1E12,ja:1E12,pa:-1E12};a.ed=a.dd={J:[0,0,0],ua:1E12};c=z.Ru(d,c);b.n.push({T:!0,Ya:a,m:c})};a.La=O;a.dl=S;a.Qw=function(a){return[a.frame_start,a.frame_end]};a.vq=function(a,b){Ub=a;Vb=b;Fa&&P(Fa,a,b,!1)};a.Vh=M;a.om=H;a.ma=K;a.Gw=function(a){a=H(a,Ba)[0];var b=a.Mc,c=a.Wc,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.Yd,d,e]};a.nq=function(a,b,c,d){a=H(a,Ba);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.Yd=b);c&&(f.Mc[0]=c[0],f.Mc[1]=c[1],f.Mc[2]=
c[2]);d&&(f.Wc[0]=d[0],f.Wc[1]=d[1],f.Wc[2]=d[2]);f.Ma=!0}};a.Sw=function(a){if(a=K(a,"SKY")){var b={};b.color=a.Xh;b.rayleigh_brightness=a.Mh;b.mie_brightness=a.yh;b.spot_brightness=a.$h;b.scatter_strength=a.Sh;b.rayleigh_strength=a.Oh;b.mie_strength=a.Bh;b.rayleigh_collection_power=a.Nh;b.mie_collection_power=a.zh;b.mie_distribution=a.Ah;return b}return null};a.Kz=function(a,b){for(var d=H(a,["SKY"]),e=0;e<d.length;e++){var f=d[e];"color"in b&&(f.Xh=b.color);"rayleigh_brightness"in b&&(f.Mh=b.rayleigh_brightness);
"mie_brightness"in b&&(f.yh=b.mie_brightness);"spot_brightness"in b&&(f.$h=b.spot_brightness);"scatter_strength"in b&&(f.Sh=b.scatter_strength);"rayleigh_strength"in b&&(f.Oh=b.rayleigh_strength);"mie_strength"in b&&(f.Bh=b.mie_strength);"rayleigh_collection_power"in b&&(f.Nh=b.rayleigh_collection_power);"mie_collection_power"in b&&(f.zh=b.mie_collection_power);"mie_distribution"in b&&(f.Ah=b.mie_distribution);f.Ma=!0;f.tj=!0;x(c(),f);Ka.Vi(f)}};a.Kw=function(a,b){var c=b||[],d=H(a,Na)[0].Hb;c[0]=
d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.Cz=function(a,b){for(var c=H(a,Na),d=0;d<c.length;d++){var e=c[d],f=e.Hb;f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[3];e.Ma=!0}};a.Uw=function(a){a=K(a,"SSAO");if(!a)return null;var b=a.n[0].m,c={};c.ssao_quality=z.eb(b,"SSAO_QUALITY")[1];c.radius_increase=a.mm;c.dithering_amount=a.hm;c.gauss_center=a.im;c.gauss_width_square=a.km;c.gauss_width_left_square=a.jm;c.influence=a.lm;c.dist_factor=a.gm;c.ssao_only=a.Dq;c.ssao_white=z.eb(b,"SSAO_WHITE")[1];return c};
a.Lz=function(a,b){var c=K(a,"SSAO");if(c){if("ssao_quality"in b){var d=c.n[0].m;z.qa(d,"SSAO_QUALITY",b.ssao_quality);z.Cb(d,!0)}"ssao_radius_increase"in b&&(c.mm=b.ssao_radius_increase);"ssao_dithering_amount"in b&&(c.hm=b.ssao_dithering_amount);"ssao_gauss_center"in b&&(c.im=b.ssao_gauss_center);"ssao_gauss_width_square"in b&&(c.km=b.ssao_gauss_width_square);"ssao_gauss_width_left_square"in b&&(c.jm=b.ssao_gauss_width_left_square);"ssao_influence"in b&&(c.lm=b.ssao_influence);"ssao_dist_factor"in
b&&(c.gm=b.ssao_dist_factor);if("ssao_only"in b){c=K(a,"MAIN_OPAQUE");c.Dq=b.ssao_only;for(var e=0;e<c.n.length;e++)d=c.n[e].m,z.qa(d,"SSAO_ONLY",b.ssao_only),z.Cb(d,!0)}"ssao_white"in b&&(d=c.n[0].m,z.qa(d,"SSAO_WHITE",b.ssao_white),z.Cb(d,!0));c.Ma=!0}else va.error("SSAO is not enabled on scene")};a.Fw=function(a){a=K(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.i.Wd;b.dof_front=a.i.Yg;b.dof_rear=a.i.$g;b.dof_power=a.i.Xd;return b};a.Az=B;a.Lw=function(a){var b=H(a,["GOD_RAYS"]);a=K(a,"GOD_RAYS_COMBINE");
if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].wh;c.god_rays_intensity=a.kl;c.god_rays_steps=z.eb(b[0].n[0].m,"STEPS_PER_PASS")[1];return c};a.Ez=function(a,b){var c=H(a,["GOD_RAYS"]),d=K(a,"GOD_RAYS_COMBINE");if(c&&d){"god_rays_intensity"in b&&(d.kl=b.god_rays_intensity);if("god_rays_max_ray_length"in b)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].wh=e,c[f].Pl=e/c[f].ai/(f+1),c[f].Ma=!0;if("god_rays_steps"in b)for(var v=V.u(b.god_rays_steps,1),e=c[0].wh,f=0;f<c.length;f++){c[f].ai=
v;c[f].Pl=e/v/(f+1);c[f].Ma=!0;var m=c[f].n[0].m;z.qa(m,"STEPS_PER_PASS",v);z.Cb(m,!0)}d.Ma=!0}else va.error("God Rays are not enabled on scene")};a.ww=function(a){var b=K(a,["LUMINANCE_TRUNCED"]);a=K(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.Bk;c.bloom_edge_lum=b.Ak;c.bloom_blur=a.En;return c};a.nz=function(a,b){var c=K(a,"LUMINANCE_TRUNCED"),d=K(a,"BLOOM");if(c&&d){if("bloom_key"in b&&(c.Bk=b.bloom_key,c.Ma=!0),"bloom_edge_lum"in b&&(c.Ak=b.bloom_edge_lum,c.Ma=!0),"bloom_blur"in b)for(var e=
a.d.Ta,c=aa.cb(e,d,"BLOOM_BLUR"),e=aa.cb(e,c,"BLOOM_BLUR"),c=[c,e],e=0;e<c.length;e++){var f=c[e].n[0].m;f&&f.$&&(z.yd(f,b.bloom_blur),M(c[e],1/d.i.width,1/d.i.height))}}else va.error("Bloom is not enabled on scene")};a.cx=function(){var a=v.ac(),b=N.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.Rz=function(a,b){for(var c=O(a),d=0;d<c.length;d++){var e=c[d];if("EMPTY"===e.type&&e.field&&"WIND"===e.field.type)var f=e}f?(c=f.d,"wind_dir"in
b&&(gb=[0,b.wind_dir/180*Math.PI,-Math.PI/2],qa.Mf(gb,La),c.h[0]=La[0],c.h[1]=La[1],c.h[2]=La[2],c.h[3]=La[3],v.Uj(f)),"wind_strength"in b&&(c.xo=b.wind_strength,v.Uj(f)),ha(a)):va.error("There is no wind on the scene")};a.iz=function(a){a.d.Fl=!0};a.Wo=function(a,b){var c=K(Fa,"MAIN_OPAQUE");if(!c||!c.Ca)return va.error("get_water_surface_level() - no water parameters on this scene"),0;var d=c.yf,e=c.zg,f=c.xf,v=c.Ca;if(!d||!v.Jf)return v.xf;var m=N.length(c.ac),g=c.time;g||(g=0);m&&(g*=m);Aa[0]=
20/e*(a-0.25*g);Aa[1]=20/e*(b-0.25*g);m=qa.Mn(Aa);Aa[0]=17/e*(b+0.1*g);Aa[1]=17/e*(a+0.1*g);var k=qa.Mn(Aa),m=m+k-1,l=v.$i,k=v.aj,r=v.Yi,h=v.Zi;Aa[0]=l*(a+r*g);Aa[1]=l*(b+r*g);l=qa.dm(Aa);Aa[0]=k*(b-h*g);Aa[1]=k*(a-h*g);k=qa.dm(Aa);k*=d*l;if(c.Cd)if(h=(a-c.Bd[0])/c.Tc[0],l=(c.Bd[1]+b)/c.Tc[1],h+=0.5,l+=0.5,1<h||0>h||1<l||0>l)d=k;else var h=qa.Co(Fa.d.Yl,c.ig,h,l),r=v.Ni,p=v.Ri,n=v.Qi,t=v.Oi,l=v.Xi,c=e/c.xh/Math.PI,p=[p/e*(a+n*g),p/e*(b+n*g)],e=Math.sqrt(h),d=d*Math.max(h,v.Pi)*Math.sin(e/c+r*g)*Math.max(qa.dm(p),
t),v=Math.max(e,l),d=d*(1-v)+k*v,m=m*h;else d=k;return f+(d+0.05*m)};a.bx=function(a,b){var c=K(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.yf,b.waves_length=c.zg,c.Eb)){b.water_fog_density=c.Eb[3];var d=b.water_fog_color=[];d[0]=c.Eb[0];d[1]=c.Eb[1];d[2]=c.Eb[2]}};a.Qz=function(a,b){var c=K(a,"MAIN_OPAQUE");if(c&&c.Ca){c=c.Ca;"dst_noise_scale0"in b&&(c.$i=b.dst_noise_scale0);"dst_noise_scale1"in b&&(c.aj=b.dst_noise_scale1);"dst_noise_freq0"in b&&(c.Yi=b.dst_noise_freq0);"dst_noise_freq1"in b&&(c.Zi=
b.dst_noise_freq1);"dir_min_shore_fac"in b&&(c.Pi=b.dir_min_shore_fac);"dir_freq"in b&&(c.Ni=b.dir_freq);"dir_noise_scale"in b&&(c.Ri=b.dir_noise_scale);"dir_noise_freq"in b&&(c.Qi=b.dir_noise_freq);"dir_min_noise_fac"in b&&(c.Oi=b.dir_min_noise_fac);"dst_min_fac"in b&&(c.Xi=b.dst_min_fac);"waves_hor_fac"in b&&(c.Hm=b.waves_hor_fac);"water_dynamic"in b&&(c.Jf=b.water_dynamic);for(var d=H(a,zb),e=0;e<d.length;e++){var f=d[e];"water_fog_density"in b&&c.Hb&&(f.Eb[3]=b.water_fog_density);"water_fog_color"in
b&&c.Hb&&(f.Eb[0]=b.water_fog_color[0],f.Eb[1]=b.water_fog_color[1],f.Eb[2]=b.water_fog_color[2]);"waves_height"in b&&(f.yf=b.waves_height);"waves_length"in b&&(f.zg=b.waves_length);f.Ma=!0}}else va.error("set_water_params() - no water parameters on this scene")};a.Rw=function(a,b){var c=K(Fa,"MAIN_OPAQUE");if(!c.Cd)return 100;var d=c.xh,e=c.xf,f=(a[0]-c.Bd[0])/c.Tc[0],v=(c.Bd[1]+a[2])/c.Tc[1],f=f+0.5,v=v+0.5;if(1<f||0>f||1<v||0>v)e=1;else return c=d*qa.Co(Fa.d.Yl,c.ig,f,v),e=(e-a[1])*b,e=Math.sqrt(c*
c+e*e)};a.update=function(b,d){for(var e=0;e<Ta.length;e++){var f=Ta[e],v=f.d.Ta;if(f.d.Ca)var m=c().camera.d,g=m.e[1]-a.Wo(m.e[0],m.e[2]);da.S(v,function(a,c){-1<xa.indexOf(c.type)&&(c.time=b);-1<zb.indexOf(c.type)&&f.d.Ca&&(c.In=g)})}if(ia.Jc)for(e=0;e<fb.length;e++)Z(fb[e],b);for(e=0;e<Ta.length;e++)if(f=Ta[e],m=f.d,m.Gl&&(E(f),m.Gl=!1),m.Fl&&(R(f),m.Fl=!1),m.Lh.length){f.b4w_enable_motion_blur&&U(m.Ta,d);ia.Yb&&!J.context.alpha&&X(m.Ta);if(ia.Jc&&m.xc){for(var e=K(f,"GLOW_MASK").n,k=0,v=0;v<e.length;v++)k+=
e[v].m.ae;da.S(f.d.Ta,function(a,b){"GLOW"===b.type&&(b.yv=k)})}for(var m=m.Lh,l=null,e=0;e<m.length;e++)if("GLOW_MASK"==m[e].type){l=e;break}for(v=0;v<m.length;v++){var r=m[v];null!==l&&L(r,m[l])}for(v=0;v<m.length;v++)r=m[v],T.Ly(r),Ka.Vi(r)}Ka.vx();ia.Nj&&ga.Zz(Ta,d)};a.cl=function(a){var b=[];da.S(a.d.Ta,function(a,c){b.push(c)});return b};a.xn=function(a,b,c,d){a.Bs={rm:0,Yo:b,Cj:c,bq:d};fb.push(a)};a.Vn=function(a){for(var b=0;b<a.aa.length;b++){var c=a.aa[b];"COLOR_ID"==c.type&&"undefined"!==
typeof c.ae&&(c.ae=0)}a=fb.indexOf(a);-1!=a&&fb.splice(a,1)};a.XB=function(){fb=[]};a.yw=function(){var a=K(Fa,"MAIN_BLEND"),b=Fa;return a||b.d.Ca?a.In:null};a.RA=ha;a.Tz=function(a,b){switch(b){case "WM_NONE":a.T=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.n.length;c++)a.n[c].m.bk=fa.dn[b];a.T=!0}a.P="WM_TRANSPARENT_WIREFRAME"==b;a.Ma=!0};a.Sz=function(a,b){for(var c=0;c<a.n.length;c++)a.n[c].m.dr=b,a.Ma=!0};
a.Hs=function(a,b){for(var c=0;c<b.length;c++)a.Ef.ALL.push(b[c]),a.Ef.MESH.push(b[c])}};b4w.module.__physics=function(a,q){function c(a,b){for(var d=a.Kd,e=0;e<d.length;e++)d[e].d.Bm&&b.push(d[e]),c(d[e],b)}function b(a,b){if(R)switch(a){case x.rr:O.JA();break;case x.sr:G.log(b);break;case x.or:G.error(b);break;case x.pr:F.Uk.apply(this,b.slice(1));break;case x.wr:var c=e(b.body_id);if(c){var d=b.trans,f=b.quat,g=b.linvel,k=b.angvel,c=c.l;c.Jk=b.time;P.Uh(d,1,f,c.Kk);K.copy(g,c.zp);K.copy(k,c.on)}break;case x.ur:(d=e(b.chassis_hull_body_id))&&P.Uh(b.trans,1,b.quat,d.g.Kh[b.prop_ind]);
break;case x.qr:if(c=e(b[1]))d=b[4],c=c.sc.yi[b[2]],Q.Rc(c,b[3]),Q.pe(c,d),Q.H(c);break;case x.xr:c=e(b[1]);c.g.speed=b[2];break;case x.mr:for(var d=b.body_id_a,c=b.body_id_b,f=b.result,g=b.coll_point,d=parseInt(d),k=R.l.n,l=0;l<k.length;l++)for(var r=k[l].qb,h=0;h<r.Gc.length;h++){for(var p=r.Gc[h],n=p.yj,t=!1,s=0;s<n.length;s++){var B=n[s];if(B[0]===d&&B[1]===c){p.Sp[s]=f;t=!0;break}}if(t||p.ly){n=p.Sp;for(s=t=0;s<n.length;s++)t=t||n[s];p.Ee(t,g)}}break;case x.nr:c=e(b[1]);c=c.l;c.Fi&&c.Fi(b[2]);
break;case x.vr:if(c=e(b.body_id))for(c=c.l,f=b.from,g=b.to,k=b.local,l=b.body_id_b_hit,r=b.cur_result,h=0;h<c.le.length;h++)if(n=c.le[h],M.Ei(n.A,f,m)&&M.Ei(n.W,g,m)&&n.Tf==k){for(d in n.wd)n.wd[d]=1;-1!=l&&(n.wd[l]=r);for(var p=n.vc,s=n.Ee,n=n.wd,t=!1,B=1,u=0;u<R.l.n.length;u++){var E=R.l.n[u].qb;if(("ANY"==p||E.id==p)&&E.F in n&&1!==n[E.F]){t=!0;B=n[E.F];break}}s(t,B)}break;case x.tr:console.log("Physics message ping: ",performance.now()-b[1]);break;default:G.error("Wrong message: "+a)}}function e(a){a=
parseInt(a);for(var b=0;b<U.length;b++){var c=U[b];if(c.l.F===a)return c}return null}function d(){X.body++;return X.body}function h(a){return{F:a,zl:0,lj:!1,qe:!0,VC:!1,jj:!1,Fx:!1,Ii:null,id:"",ZB:{},Gc:[],Fi:null,le:[],Jk:0,Kk:new Float32Array([0,0,0,1,0,0,0,1]),zp:new Float32Array(3),on:new Float32Array(3),Bi:new Float32Array(3)}}function p(a,b){switch(a){case "BOX":var c=b.Rb;break;case "CYLINDER":c=b.lt;break;case "CONE":c=b.kt;break;case "SPHERE":c=b.dd;break;case "CAPSULE":c=b.yk}return c}
function n(a){if(!a)return null;var b={};"number"===typeof a.R&&(b.min_x=a.R);"number"===typeof a.B&&(b.min_y=a.B);"number"===typeof a.pa&&(b.min_z=a.pa);"number"===typeof a.V&&(b.max_x=a.V);"number"===typeof a.G&&(b.max_y=a.G);"number"===typeof a.ja&&(b.max_z=a.ja);"object"===typeof a.J&&(b.center=a.J);"number"===typeof a.ua&&(b.radius=a.ua);"number"===typeof a.height&&(b.height=a.height);return b}function k(a,b,c,d){var e=a.d.e,f=b.d.I,m=new Float32Array(16);L.invert(f,m);f=new Float32Array(3);
K.transformMat4(e,m,f);switch(b.g.type){case fa:b=b.b4w_vehicle_settings;a=a.d.Rb;x.p(x.Fr,c,f,b.suspension_rest_length,b.roll_influence,(a.G-a.B)/2,d);break;case da:x.p(x.Er,c,f,a.zD)}}function l(a){return a.l&&a.l.Ii?!0:!1}function s(a,b,c,d,e,f,m,g,k,l){var r;X.$n++;r=X.$n.toString(16);x.p(x.Mr,r,a,g,b.l.F,c,d,e.l.F,f,m,k,l);b.l.Ii=r}function f(a){var b=a.l;if(b&&(0===b.zl||!0===b.lj||!1===b.qe||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.e[0]!=a.l.Bi[0]||a.d.e[1]!=a.l.Bi[1]||a.d.e[2]!=a.l.Bi[2])){K.copy(a.d.e,
a.l.Bi);var b=a.l,c=x.Lo(x.Ae);c.msg_id=x.Ae;c.body_id=a.l.F;c.trans=a.d.e;"DYNAMIC"===b.type?(c.quat=ha,B.identity(ha)):c.quat=a.d.h;x.p(x.Ae,c)}a=a.Kd;for(b=0;b<a.length;b++)f(a[b])}function t(a,b,c,d,e,f,m){m=m||new Float32Array(3);var g=a.d.h;if(e)m[0]=b,m[1]=c,m[2]=d,a=K.transformQuat(m,g,m);else if("CAMERA"==a.type)m[0]=b,m[1]=c,m[2]=0,a=K.transformQuat(m,g,m),a[1]=-d;else if("MESH"==a.type)m[0]=b,m[1]=0,m[2]=d,a=K.transformQuat(m,g,m),a[1]=c;else throw"Wrong object type";f&&0<a[1]&&(a[1]=0)}
function A(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.l.n.length;e++){var f=b.l.n[e];if("ANY"==a||f.qb.id==a)f=f.qb.F,c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function D(a,b){x.p(x.Zc,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=M.yn(e.A)+M.yn(e.W)+String(e.Tf);c[f]=c[f]||{A:e.A,W:e.W,Tf:e.Tf,Fn:[]};var m=c[f].Fn,g;for(g in e.wd)-1==m.indexOf(g)&&m.push(g)}for(f in c)d=c[f].A,e=c[f].W,g=c[f].Tf,m=c[f].Fn,x.p(x.$m,a,d,e,g,m)}else x.p(x.$m,a,null,
null,!1,null)}function y(a,b){if(b.lg){var c=a.l.F,d=b.Lf*b.wo,e=b.Ng*b.Gn,f=2*-b.kg*b.nm*Math.PI/b.Hq;b.jp&&(f*=-1);switch(b.type){case fa:x.p(x.Zc,c);x.p(x.ss,c,d,e,f);break;case da:x.p(x.Zc,c),x.p(x.rs,c,d,e,f)}}}function u(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function g(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function E(a){return a.b4w_character?!0:!1}function I(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}
var w=q("__config"),G=q("__print"),F=q("__debug"),x=q("__ipc"),O=q("__renderer"),S=q("__scenes"),Q=q("__transform"),P=q("__tsr"),M=q("__util"),H=q("__version"),K=q("vec3"),B=q("quat"),L=q("mat4"),r=w.qb,m=1E-7,R=null,U=[],X={er:0,body:0,$n:0,shape:0},Z=new Float32Array(3),ha=new Float32Array(4),z=new Float32Array(4),ea=new Float32Array(16),ka=new Float32Array(8),J=new Float32Array(8),fa=10,da=20;a.yx=function(){if(r.enabled){var a=r.Am+H.timestamp();G.log("%cLOAD PHYSICS","color: #0a0",a);a=new Worker(a);
x.jh(a,b)}};a.ft=function(a){var b;X.er++;b=X.er;x.p(x.Rr,b);a.l={};a.l.mB=b;a.l.n=[]};a.ga=function(){if(r.enabled){x.p(x.Xr);R=null;U.length=0;for(var a in X)X[a]=0}};a.Ig=function(a,b){R=b;x.p(x.gs,b.l.mB);var e=a.d;if(!e)throw"No object render: "+a.name;if(a.parent&&e.Bm)return null;var f=[];e.Bm&&c(a,f);for(var m=a.aa||[],r=0;r<m.length;r++){var t=m[r],A;if(A="PHYSICS"==t.type){var q;a:{for(var D=b.l.n,w=0;w<D.length;w++){var X=D[w].m;if(X&&X.id==t.id){q=!0;break a}}q=!1}A=!q}if(A)if(t.Bb.D)if(t.yg&&
b.d.Ca){var F=t;x.p(x.Qr);var J=R,Z=S.ma(J,"MAIN_OPAQUE");if(Z.Ca&&F.fB){var H={};H.dst_noise_scale0=F.$i;H.dst_noise_scale1=F.aj;H.dst_noise_freq0=F.Yi;H.dst_noise_freq1=F.Zi;H.dir_min_shore_fac=F.Pi;H.dir_freq=F.Ni;H.dir_noise_scale=F.Ri;H.dir_noise_freq=F.Qi;H.dir_min_noise_fac=F.Oi;H.dst_min_fac=F.Xi;H.waves_hor_fac=F.Hm;var Q=Z.yf,O=Z.zg,ha=Z.xf;Z.Tc?x.p(x.Zm,H,Z.Tc[0],Z.Tc[1],Z.Bd[0],Z.Bd[1],Z.xh,Q,O,ha,Z.ig,J.d.Yl):x.p(x.Zm,H,0,0,0,0,0,Q,O,ha,0,null)}}else{var P;if(t.WA){var ka=a,Fa=t,Ta=d(),
fb=Fa.Bb;x.p(x.Or,Ta,fb.r[0].a_position,fb.ia||null,ka.d.e,Fa.Yn,Fa.Zn);var Ub=h(Ta);Ub.lj=!0;P=Ub}else{var Vb=a,Ia=t,Aa=d(),gb=Ia.Bb;x.p(x.Pr,Aa,gb.r[0].a_position,gb.ia||null,Vb.d.e,Ia.Yk,Ia.Rk,Ia.Yn,Ia.Zn);P=h(Aa)}var hb=P;hb.id=t.vc;var ib={m:t,qb:hb};b.l.n.push(ib)}else G.error("Object "+a.name+" has collision material with no assigned vertices")}if(u(a)||g(a)||E(a)||I(a)||a.b4w_collision){var La=a,Ua=e.Ey,xb=La.d,jb=La.game,Bc=d();if("CAMERA"==La.type)var Ib="CAPSULE",Ab=xb.yk,ya={J:[Ab.J[0],
-Ab.J[2],Ab.J[1]],ua:Ab.ua,height:Ab.height},ac=null,sc=0.5,Ra=0;else"EMPTY"==La.type?(Ib="EMPTY",ya=null,ac=xb.h,Ra=sc=0):(Ib=jb.use_collision_bounds?jb.collision_bounds_type:"BOX",ac=xb.h,ya=p(Ib,xb),sc=xb.Yk,Ra=xb.Rk);var bc=xb.e,Jb=jb.use_ghost,Cc=jb.use_sleep,Lc=jb.mass,Uc=jb.velocity_min,Pb=jb.velocity_max,ob=jb.damping,tc=jb.rotation_damping,mc=jb.collision_group,pb=jb.collision_mask,nc=xb.dd.ua,Wb=n(ya),Qb=La.b4w_correct_bounding_offset,Y;var ab=Ib;if(f.length){var Va=[],ra={};ra.quat=new Float32Array([0,
0,0,1]);ra.trans=new Float32Array(3);ra.worker_bounding=Wb;ra.bounding_type=ab;Va.push(ra);L.invert(xb.I,ea);B.invert(xb.h,z);for(var uc=0;uc<f.length;uc++){var sa={},qb=f[uc],rb=qb.game.collision_bounds_type,oa=new Float32Array(4),Ga=new Float32Array(3);K.transformMat4(qb.d.e,ea,Ga);B.multiply(z,qb.d.h,oa);sa.trans=Ga;sa.quat=oa;sa.bounding_type=rb;sa.worker_bounding=n(p(rb,qb.d));Va.push(sa)}Y=Va}else Y=[];x.p(x.Ir,Bc,bc,ac,Ua,Jb,Cc,Lc,Uc,Pb,ob,tc,mc,pb,Ib,Wb,nc,sc,Ra,Y,Qb);U.push(La);var kb=h(Bc);
kb.type=Ua;kb.zl=Lc;kb.lj=Jb;hb=kb;a.l=hb;ib={m:null,qb:hb};b.l.n.push(ib)}if(u(a)||g(a)){var ma=a,Wa=ma.l.F;u(ma)?(ma.g.type=fa,x.p(x.Jr,Wa,ma.g.vA,ma.g.xA,ma.g.wA,ma.g.kB,ma.g.ay)):g(ma)&&(ma.g.type=da,x.p(x.Hr,Wa,ma.g.Vk,ma.g.Fm,ma.g.Gm));if(ma.g.gf){var sb=ma.g.gf;switch(ma.g.type){case fa:k(sb[1],ma,Wa,!0);k(sb[0],ma,Wa,!0);k(sb[3],ma,Wa,!1);k(sb[2],ma,Wa,!1);break;case da:for(var pa=0;pa<sb.length;pa++)k(sb[pa],ma,Wa,!1)}}ma.l.id=ma.b4w_vehicle_settings.name;y(a,a.g)}else if(E(a)){var Oa=a.d,
tb=a.l,Kb=Oa.Rb.G-Oa.Rb.B,cc=tb.F,Bb=a.b4w_character_settings,lb=Bb.walk_speed,Dc=Bb.run_speed,vc=Bb.step_height,bb=Bb.jump_strength,dc=Bb.waterline,Rb=M.rv(a);x.p(x.Kr,cc,Rb,Kb,lb,Dc,vc,bb,dc);tb.jj=!0}else if(I(a)){var ub=a,Sa=ub.l.F;x.p(x.Nr,Sa,ub.sc.Vk,ub.sc.Fm,ub.sc.Gm);if(ub.sc.yi)for(var Xa=ub.sc.yi,mb=0;mb<Xa.length;mb++){var ja=Xa[mb],cb=ja.d.e,C=ub.d.I,Cb=new Float32Array(16);L.invert(C,Cb);var za=new Float32Array(3);K.transformMat4(cb,Cb,za);x.p(x.Gr,Sa,za,ja.pt)}ub.l.Fx=!0}else a.b4w_collision&&
(hb.id=a.b4w_collision_id);for(r=0;r<U.length;r++)if(a=U[r],a.l){var Za=a;if(!l(Za))for(var Db=0;Db<Za.constraints.length;Db++){var W=Za.constraints[Db],Pa=W.target,db=W.pivot_type;if("RIGID_BODY_JOINT"==W.type&&Pa.l){var eb=new Float32Array([W.pivot_x,W.pivot_y,W.pivot_z]),Xb,Eb=new Float32Array([W.axis_x,W.axis_y,W.axis_z]);Xb=M.Mf(Eb,new Float32Array(4));var Ca=L.fromRotationTranslation(Xb,eb,new Float32Array(16)),Lb=L.multiply(Za.d.I,Ca,new Float32Array(16)),ec=L.invert(Pa.d.I,new Float32Array(16)),
Qa=L.multiply(ec,Lb,ec),Yb=M.Xe(Qa),oc=M.ge(Qa),wa=W,na={};na.use_limit_x=wa.use_limit_x;na.use_limit_y=wa.use_limit_y;na.use_limit_z=wa.use_limit_z;na.use_angular_limit_x=wa.use_angular_limit_x;na.use_angular_limit_y=wa.use_angular_limit_y;na.use_angular_limit_z=wa.use_angular_limit_z;na.limit_max_x=wa.limit_max_x;na.limit_min_x=wa.limit_min_x;na.limit_max_y=wa.limit_max_y;na.limit_min_y=wa.limit_min_y;na.limit_max_z=wa.limit_max_z;na.limit_min_z=wa.limit_min_z;na.limit_angle_max_x=wa.limit_angle_max_x;
na.limit_angle_min_x=wa.limit_angle_min_x;na.limit_angle_max_y=wa.limit_angle_max_y;na.limit_angle_min_y=wa.limit_angle_min_y;na.limit_angle_max_z=wa.limit_angle_max_z;na.limit_angle_min_z=wa.limit_angle_min_z;s(db,Za,eb,Xb,Pa,Yb,oc,na,null,null)}}}};a.Pv=e;a.update=function(a,b){R&&(x.p(x.bs,a,b),O.Ux());for(var c=0;c<U.length;c++){var d=U[c],e=d.l;if(e.qe&&e.Jk){var m=a-e.Jk,m=Math.min(m,10/60),g=ka;P.Ax(e.Kk,m,e.zp,e.on,ka);Q.Rc(d,P.Uo(g));"CAMERA"!=d.type&&Q.pe(d,P.Oo(g));Q.H(d);f(d);if(d.g)for(var e=
d,m=e.g.gf,g=e.d.rg,k=ka,l=0;l<m.length;l++){var r=m[l];P.multiply(g,e.g.Kh[l],k);Q.sq(r,k);Q.H(r)}d.g&&d.g.lg&&(e=d.g,m=e.lg)&&(g=d.g.Iq,r=ea,k=d.d.e,l=d.d.h,M.vm(d.g.Jq,l,k,r),M.Xe(r,m.d.e),M.ge(r,m.d.h),r=ha,M.wm(g,l,k,r),g=z,B.setAxisAngle(r,2*-e.kg*e.nm*Math.PI,g),B.multiply(g,m.d.h,m.d.h),Q.H(m));d.g&&d.g.em&&(e=d.g,m=e.em)&&(k=d.g.Bq,g=ea,l=d.d.e,r=d.d.h,M.vm(d.g.Cq,r,l,g),M.Xe(g,m.d.e),M.ge(g,m.d.h),g=ha,M.wm(k,r,l,g),k=z,l=Math.abs(e.speed)*e.Aq,l>e.Al&&(l=e.Al),B.setAxisAngle(g,-l,k),B.multiply(k,
m.d.h,m.d.h),Q.H(m));d.g&&d.g.pm&&(e=d.g,m=e.pm)&&(g=d.g.Nq,r=ea,k=d.d.e,l=d.d.h,M.vm(d.g.Oq,l,k,r),M.Xe(r,m.d.e),M.ge(r,m.d.h),d=ha,M.wm(g,l,k,d),g=z,B.setAxisAngle(d,-Math.abs(e.Lf)*e.lo,g),B.multiply(g,m.d.h,m.d.h),Q.H(m))}}if(c=R)c=S.ma(c,"MAIN_OPAQUE"),c.Ca&&0<c.Ca.$j&&(d=K.length(c.ac),x.p(x.qs,c.time*d))};a.ow=function(){return R};a.pause=function(){r.enabled&&x.p(x.cs)};a.Sl=function(){r.enabled&&x.p(x.fs)};a.oo=function(a){a=a.l;if(!a)throw"No object physics";if(!a.qe){var b=a.F;a.qe=!0;
x.p(x.as,b)}};a.mo=function(a){a=a.l;if(!a)throw"No object physics";if(a.qe){var b=a.F;a.qe=!1;x.p(x.$r,b)}};a.nl=function(a){return a.l?!0:!1};a.KC=function(a){return(a=a.l)&&a.qe&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.zl&&!1==a.lj?!0:!1};a.bp=function(a){return(a=a.l)&&a.qe?!0:!1};a.Fz=function(a,b){x.p(x.ps,a.l.F,b)};a.qx=l;a.Us=s;a.Ut=function(a){a=a.l;x.p(x.es,a.Ii);a.Ii=null};a.Oy=function(b,c,d,e,f,m){c=P.He(c,1,d,ka);f=P.He(f,1,m,J);P.invert(c,c);P.multiply(f,c,c);Q.Yw(e,f);P.multiply(f,
c,c);Q.sq(b,c);Q.H(b);a.rq(b,b.d.e,b.d.h)};a.rq=function(a,b,c){P.Uh(a.d.e,1,a.d.h,a.l.Kk);var d=x.Lo(x.Ae);d.msg_id=x.Ae;d.body_id=a.l.F;d.trans=b;d.quat=c;x.p(x.Ae,d)};a.Na=f;a.at=function(a,b,c,d,e,f){t(a,b,c,d,e,f,Z);a=a.l.F;x.p(x.Zc,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);e=Math.abs(Z[0]);f=Math.abs(Z[1]);var m=Math.abs(Z[2]);Z[0]=e?Z[0]/e*Math.max(e,b):0;Z[1]=f?Z[1]/f*Math.max(f,c):0;Z[2]=m?Z[2]/m*Math.max(m,d):0;x.p(x.an,a,Z[0],Z[1],Z[2])};a.bt=function(a,b,c,d){a=a.l.F;x.p(x.Zc,a);x.p(x.an,
a,b,c,d)};a.Vs=function(a,b,c,d,e,f){t(a,b,c,d,e,f,Z);a=a.l.F;x.p(x.Zc,a);x.p(x.Sr,a,Z[0],Z[1],Z[2])};a.$s=function(a,b,c,d){t(a,b,c,d,!0,!1,Z);a=a.l.F;x.p(x.Zc,a);x.p(x.Ur,a,Z[0],Z[1],Z[2])};a.pz=function(a,b,c){a=a.l.F;x.p(x.Zc,a);x.p(x.js,a,b,c)};a.qz=function(a,b){x.p(x.ks,a.l.F,b)};a.vz=function(a,b){x.p(x.os,a.l.F,b)};a.uz=function(a,b){x.p(x.ms,a.l.F,b)};a.oz=function(a,b){x.p(x.hs,a.l.F,b)};a.Ft=function(a){x.p(x.Vr,a.l.F)};a.Gt=function(a,b,c){x.p(x.Wr,a.l.F,b,c)};a.rz=function(a,b,c){x.p(x.ls,
a.l.F,b,c)};a.sz=function(a,b){x.p(x.is,a.l.F,b)};a.tz=function(a,b){x.p(x.ns,a.l.F,b)};a.VB=Tc(!1);a.TB=Tc(!1);a.QB=function(){G.error("check_collision() deprecated");return!1};a.RB=function(){G.error("check_collision_any() deprecated");return!1};a.UB=function(){G.error("check_ray_hit() deprecated");return!1};a.ED=function(){G.error("update_object_coords() deprecated")};a.pn=function(a,b,c,d){var e=a.l,f=e.F;b=b||"ANY";for(var m=0;m<e.Gc.length;m++){var g=e.Gc[m];if(g.vc==b&&g.Ee==c)return}m=[];
a=a.l.F;g=[];A(b,R,g,null);for(var k=0;k<g.length;k++){var l=g[k];a<l?m.push([a,l]):a>l&&m.push([l,a])}g={vc:b,Ee:c,yj:m,Sp:new Uint8Array(m.length),ly:d||!1};e.Gc.push(g);x.p(x.Zc,f);x.p(x.Lr,m,d)};a.cq=function(a,b,c){a=a.l;b=b||"ANY";for(var d=0;d<a.Gc.length;d++){var e=a.Gc[d];if(e.vc==b&&e.Ee==c){a.Gc.splice(d,1);d--;for(var e=e.yj,f=R.l.n,m=0;m<f.length;m++)for(var g=f[m].qb,k=0;k<g.Gc.length;k++)for(var l=g.Gc[k],r=0;r<l.yj.length;r++)for(var h=l.yj[r],p=0;p<e.length;p++){var n=e[p];h[0]===
n[0]&&h[1]===n[1]&&(e.splice(p,1),p--)}e.length&&x.p(x.ds,e)}}};a.wn=function(a,b){var c=a.l;c?(x.p(x.Tr,c.F),c.Fi=b):G.error("Object "+a.name+" has no physics")};a.Un=function(a){var b=a.l;b?(x.p(x.Yr,b.F),b.Fi=null):G.error("Object "+a.name+" has no physics")};a.sn=function(a,b,c,d,e,f){var m=a.l;if(m){a=m.F;b=b||"ANY";c={A:new Float32Array(c),W:new Float32Array(d),Tf:e,Ee:f,vc:b,wd:{}};A(b,R,null,c.wd);delete c.wd[a];for(var g in c.wd)c.wd[g]=1;m.le.push(c);D(a,m.le)}else G.error("Object "+a.name+
" has no physics")};a.dq=function(a,b,c,d){var e=a.l;if(e){a=e.F;for(var f=0;f<e.le.length;f++){var g=e.le[f];M.Ei(g.A,b,m)&&M.Ei(g.W,c,m)&&g.Tf==d&&(e.le.splice(f,1),f--)}D(a,e.le)}else G.error("Object "+a.name+" has no physics")};a.Yq=function(a,b){var c=a.g;c.Lf=b;y(a,c)};a.Xq=function(a,b){var c=a.g;c.kg=b;y(a,c)};a.Wq=function(a,b){var c=a.g;c.Ng=b;y(a,c)};a.gc=u;a.hc=g;a.Ex=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==
a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.Dx=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.Gx=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.pp=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.op=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.qp=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.Zw=function(a){return a.g.speed};
a.lB=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.jj=E;a.UC=I;a.CC=Tc(0);a.jv=function(){x.p(x.Zr)}};b4w.module.__data=function(a,q){function c(a){a=H(a);for(var b=0;b<a.length;b++){var c=a[b];"MESH"==c.type&&delete c.data.submeshes}Vb={}}function b(a,b,c){var d;a instanceof ArrayBuffer&&(a=ea.Xo(a));d=a.width;a=a.height;ua.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(hb)&&c&&ua.warn("B4W Warning: image",b,"is not from app root")}function e(a,b,c,d,e,f){d=b.w;if(!d)throw"Nothing requested";da.K([[d,da.gk,d]],function(d,f,m,g){if(d){ua.log("%cLOAD METADATA",
"color: #616",g);f=d.b4w_format_version;if(Number(f)<xa.Ep)throw"Incompatible file version: "+f+". Required: "+xa.Ep;for(var v in d)a[v]=d[v];b.Cn=a.binaries[0].binfile;b.Cn||(fa.xq(b,"load_binaries"),fa.xq(b,"prepare_bindata"));if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)ua.error("EXPORT WARNING:",a.b4w_export_warnings[d]);e(b,c)}},null,function(a){f(b,c,a)})}function d(a,b,c,d,e,f){d=P(b.w)+b.Cn;if(!d)throw"Binary data is missing";da.K([[d,da.Ag,d]],function(d,f,m,g){d&&
(ua.log("%cLOAD BINARY","color: #616",g),a.bin_data=d,e(b,c))},null,function(a){f(b,c,a)})}function h(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],m=a.objects,g=a.meshes;a=la.Lt();for(var v=["indices"],k="position normal tangent texcoord texcoord2 color group".split(" "),l=0;l<g.length;l++)for(var r=g[l].submeshes,h=0;h<r.length;h++)for(var n in r[h])if(-1!=v.indexOf(n)){var t=4*r[h][n][0]+f["int"],s=r[h][n][1],B=r[h],u=n,T=d;if(a)var E=new Uint32Array(T,t,s);else for(var E=new Uint32Array(s),T=new DataView(T),
z=0;z<s;z++)E=T.getUint32(t+4*z,!0);B[u]=E}else-1!=k.indexOf(n)&&(t=4*r[h][n][0]+f["float"],s=r[h][n][1],r[h][n]=p(d,t,s,a));for(n=0;n<m.length;n++)for(g=m[n].particle_systems,v=0;v<g.length;v++)k=g[v],k.transforms=p(d,4*k.transforms[0]+f["float"],k.transforms[1],a);e(b,c)}function p(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d=a.getFloat32(b+4*e,!0)}return d}function n(a,b,c,d,e){for(var m=a.cameras,v=a.groups,k=a.materials,l=a.meshes,
h=a.objects,p=a.particles,n=a.scenes,s=a.speakers,B=a.textures,z="actions armatures cameras curves groups images lamps materials meshes objects particles scenes sounds speakers textures worlds".split(" "),A={},y=0;y<z.length;y++)for(var R=a[z[y]],q=0;q<R.length;q++){var D=R[q];A[D.uuid]=D}for(var w=0;w<n.length;w++){for(var L=n[w],U=L.objects,x=0;x<U.length;x++)f(U,x,A);L.camera&&f(L,"camera",A);L.world&&f(L,"world",A)}for(w=0;w<v.length;w++)for(var X=v[w].objects,x=0;x<X.length;x++)f(X,x,A);for(w=
0;w<h.length;w++){var G=h[w];G.dupli_group&&f(G,"dupli_group",A);G.parent&&f(G,"parent",A);if(G.animation_data){var F=G.animation_data;F.action&&f(F,"action",A);if(F.nla_tracks)for(x=0;x<F.nla_tracks.length;x++)for(var J=F.nla_tracks[x],Z=0;Z<J.strips.length;Z++)J.strips[Z].action&&f(J.strips[Z],"action",A)}switch(G.type){case "MESH":if(!G.data)throw"mesh not found for object "+G.name;f(G,"data",A);for(var N=G.modifiers,x=0;x<N.length;x++){var V=N[x];"ARMATURE"==V.type?f(V,"object",A):"CURVE"==V.type&&
f(V,"object",A)}var Q=G.particle_systems;if(Q)for(x=0;x<Q.length;x++)f(Q[x],"settings",A);break;case "ARMATURE":f(G,"data",A);for(var Ka=G.pose.bones,M=G.data.bones,x=0;x<Ka.length;x++){var O=Ka[x];O.bone=M[O.bone];for(var Ea=O.parent_recursive,Z=0;Z<Ea.length;Z++)Ea[Z]=Ka[Ea[Z]]}break;case "LAMP":f(G,"data",A);break;case "CAMERA":f(G,"data",A);break;case "SPEAKER":f(G,"data",A);break;case "CURVE":f(G,"data",A)}var ha=G.constraints;if(ha)for(x=0;x<ha.length;x++){var P=ha[x];P.target&&f(P,"target",
A)}}for(w=0;w<l.length;w++)for(var S=l[w].materials,x=0;x<S.length;x++)f(S,x,A);for(w=0;w<k.length;w++){for(var ea=k[w],ia=ea.texture_slots,x=0;x<ia.length;x++)f(ia[x],"texture",A);var fa=ea.node_tree;if(fa){for(var ka=fa.nodes,x=0;x<ka.length;x++){var ba=ka[x];"MATERIAL"!=ba.type&&"MATERIAL_EXT"!=ba.type||!ba.material||f(ba,"material",A);"TEXTURE"==ba.type&&ba.texture&&f(ba,"texture",A)}for(var Ya=fa.links,x=0;x<Ya.length;x++){var da=Ya[x];da.from_node=la.Nc("name",da.from_node.name,ka);da.to_node=
la.Nc("name",da.to_node.name,ka);t(da,"from_socket",da.from_node.outputs);t(da,"to_socket",da.to_node.inputs)}}}for(w=0;w<B.length;w++){var yb=B[w],Ta=yb.type;"IMAGE"!=Ta&&"ENVIRONMENT_MAP"!=Ta||f(yb,"image",A)}for(w=0;w<m.length;w++){var ga=m[w];ga.dof_object&&f(ga,"dof_object",A)}for(w=0;w<s.length;w++){var xa=s[w];xa.sound&&f(xa,"sound",A);xa.animation_data&&xa.animation_data.action&&f(xa.animation_data,"action",A)}for(w=0;w<p.length;w++){for(var Ob=p[w],ia=Ob.texture_slots,x=0;x<ia.length;x++)f(ia[x],
"texture",A);Ob.dupli_group&&f(Ob,"dupli_group",A);Ob.dupli_object&&f(Ob,"dupli_object",A)}va.Kt(a);for(var Ub=a.textures,fb=a.scenes[0].b4w_anisotropic_filtering,Ia=0;Ia<Ub.length;Ia++)qa.Wu(Ub[Ia],fb,a.scenes);a.materials.push({name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[0.8,0.8,0.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:0.5,
specular_shader:"COOKTORR",specular_hardness:50,specular_slope:0.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[0.5,0.5,0.5],b4w_water_fog_density:0.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_terrain_tex_type:"B4W_TERRAIN_NONE",b4w_skydome:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:0.5,
elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},node_tree:null,texture_slots:[]});for(var C=la.Nc("name","DEFAULT",a.materials),zb=a.meshes,Fa=0;Fa<zb.length;Fa++){var Vb=zb[Fa];0==Vb.materials.length&&Vb.materials.push(C)}for(var Aa={},W=a.objects,La=0;La<W.length;La++){var db=W[La];if("MESH"===db.type&&!db.particle_systems.length)for(var eb=db.data,Xb=eb.name,Eb=eb.submeshes,Ca=eb.materials,Lb=0;Lb<Eb.length;Lb++)0!==
Eb[Lb].base_length||Aa[Xb]||(ua.warn('B4W Warning: material "'+Ca[Lb].name+'" is not assigned to any faces (object "'+db.name+'")'),Aa[Xb]=!0)}for(var ec=a.actions,Qa=0;Qa<ec.length;Qa++)r.Is(ec[Qa]);for(var hb=a.scenes,gb=0;gb<hb.length;gb++){for(var wa=hb[gb],na=aa.Hi(wa,"ALL"),ib=[],Ua=0;Ua<na.length;Ua++)for(var Fb=na[Ua].particle_systems,nb=0;nb<Fb.length;nb++){var Mb=Fb[nb].settings;if("HAIR"==Mb.type)if("OBJECT"==Mb.render_type)I(Mb.dupli_object);else if("GROUP"==Mb.render_type){for(var fc=
Mb.dupli_group,pc=aa.Hi(wa,"EMPTY"),Gb=0;Gb<pc.length;Gb++)pc[Gb].dupli_group==fc&&ib.push(pc[Gb]);for(Gb=0;Gb<fc.objects.length;Gb++)I(fc.objects[Gb])}else ua.warn("B4W Warning: render type",Mb.render_type,"not supported for particle systems ("+Mb.name+")")}for(Ua=0;Ua<ib.length;Ua++)E(ib[Ua],[wa])}K(a);for(var Ec=a.scenes,Fc=0;Fc<Ec.length;Fc++){for(var Wc=Ec[Fc],Hb=[],vb=[],Sb=Ec[Fc].objects,wb=0;wb<Sb.length;wb++){var Mc=Sb[wb];u(Sb,Mc,Hb,vb);var bd=Mc.dupli_group;if(bd)for(var Gc=bd.objects,
Zb=0;Zb<Gc.length;Zb++)u(Gc,Gc[Zb],Hb,vb)}for(wb=0;wb<vb.length;wb++)E(vb[wb],[Wc]);for(wb=0;wb<Hb.length;wb++)la.Ts(Hb[wb][0],Hb[wb][1])}K(a);for(var Ja=H(a),Ia=0;Ia<Ja.length;Ia++)I(Ja[Ia]);for(var $b=-1,Tb=0;Tb<Ja.length;Tb++){var Hc=Ja[Tb],xc=Hc.d;if(la.Vb(Hc)&&xc.Rf){var Nc=xc.Jb;Nc>$b&&($b=Nc)}}for(Tb=0;Tb<Ja.length;Tb++)Hc=Ja[Tb],xc=Hc.d,la.Vb(Hc)&&xc.Rf&&(xc.Jb=$b);for(var Zc=0;Zc<Ja.length;Zc++){var yc=Ja[Zc];if(la.Vb(yc)){var Oc=yc.b4w_lods_num;if(Oc){yc.d.ul=!1;for(var Pc=yc.d.Uf,Xc=0,
Ic=0;Ic<Oc;Ic++){var Jc=g(yc,Ic);Jc.d.vh=Pc;yc.d.ul=!1;Pc=Jc.d.Uf;Xc=Ic}g(yc,Xc).d.ul=!0}}}for(var Qc=0;Qc<Ja.length;Qc++){var ca=Ja[Qc];if(ca.b4w_vehicle){var Da=ca.b4w_vehicle_settings;if("CHASSIS"==Da.part){ca.g={};ca.g.wo=Da.force_max;ca.g.Gn=Da.brake_max;ca.g.vA=Da.suspension_compression;ca.g.xA=Da.suspension_stiffness;ca.g.wA=Da.suspension_damping;ca.g.kB=Da.wheel_friction;ca.g.nD=Da.roll_influence;ca.g.ay=Da.max_suspension_travel_cm;ca.g.Lf=0;ca.g.Ng=1;ca.g.kg=0;ca.g.speed=0;ca.g.gf=[];ca.g.Kh=
[];ca.g.lg=null;for(var Rc=ca.cc?ca.cc.dupli_group.objects:Ja,gc=0;gc<Rc.length;gc++){var ta=Rc[gc];if(ta.b4w_vehicle){var Ha=ta.b4w_vehicle_settings;if(T.Ex(ta)&&Da.name==Ha.name){var zc=T.lB(ta.b4w_vehicle_settings.part);ca.g.gf[zc]=ta;ca.g.Kh[zc]=new Float32Array(8)}else if(T.pp(ta)&&Da.name==Ha.name){ca.g.lg=ta;ca.g.nm=Ha.steering_max;ca.g.Hq=Ha.steering_ratio;ca.g.jp=Ha.inverse_control;var Ma=Na.invert(ca.d.I,new Float32Array(16)),Ac=Na.multiply(Ma,ta.d.I,Ma);ca.g.Jq=Ac;var hc=new Float32Array([1,
0,0,0]);Ba.transformMat4(hc,Ac,hc);ca.g.Iq=hc}else if(T.op(ta)&&Da.name==Ha.name){ca.g.em=ta;ca.g.Aq=Ha.speed_ratio;ca.g.Al=Ha.max_speed_angle;var Ma=Na.invert(ca.d.I,new Float32Array(16)),ic=Na.multiply(Ma,ta.d.I,Ma);ca.g.Cq=ic;var jc=new Float32Array([1,0,0,0]);Ba.transformMat4(jc,ic,jc);ca.g.Bq=jc}else if(T.qp(ta)&&Da.name==Ha.name){ca.g.pm=ta;ca.g.lo=Ha.delta_tach_angle;var Ma=Na.invert(ca.d.I,new Float32Array(16)),kc=Na.multiply(Ma,ta.d.I,Ma);ca.g.Oq=kc;var lc=new Float32Array([1,0,0,0]);Ba.transformMat4(lc,
kc,lc);ca.g.Nq=lc}}}if(4!=ca.g.gf.length)throw"Not enough wheels for chassis "+ca.name;}else if("HULL"==Da.part){ca.g={};ca.g.gf=[];ca.g.Kh=[];ca.g.wo=Da.force_max;ca.g.Gn=Da.brake_max;ca.g.Vk=Da.floating_factor;ca.g.Fm=Da.water_lin_damp;ca.g.Gm=Da.water_rot_damp;ca.g.Lf=0;ca.g.Ng=1;ca.g.kg=0;ca.g.speed=0;ca.g.lg=null;for(var Sc=ca.cc?ca.cc.dupli_group.objects:Ja,gc=0;gc<Sc.length;gc++)ta=Sc[gc],ta.b4w_vehicle&&(Ha=ta.b4w_vehicle_settings,T.Dx(ta)&&Da.name==Ha.name?(ca.g.gf.push(ta),ca.g.Kh.push(new Float32Array(8))):
T.pp(ta)&&Da.name==Ha.name?(ca.g.lg=ta,ca.g.nm=Ha.steering_max,ca.g.Hq=Ha.steering_ratio,ca.g.jp=Ha.inverse_control,Ma=Na.invert(ca.d.I,new Float32Array(16)),Ac=Na.multiply(Ma,ta.d.I,Ma),ca.g.Jq=Ac,hc=new Float32Array([1,0,0,0]),Ba.transformMat4(hc,Ac,hc),ca.g.Iq=hc):T.op(ta)&&Da.name==Ha.name?(ca.g.em=ta,ca.g.Aq=Ha.speed_ratio,ca.g.Al=Ha.max_speed_angle,Ma=Na.invert(ca.d.I,new Float32Array(16)),ic=Na.multiply(Ma,ta.d.I,Ma),ca.g.Cq=ic,jc=new Float32Array([1,0,0,0]),Ba.transformMat4(jc,ic,jc),ca.g.Bq=
jc):T.qp(ta)&&Da.name==Ha.name&&(ca.g.pm=ta,ca.g.lo=Ha.delta_tach_angle,Ma=Na.invert(ca.d.I,new Float32Array(16)),kc=Na.multiply(Ma,ta.d.I,Ma),ca.g.Oq=kc,lc=new Float32Array([1,0,0,0]),Ba.transformMat4(lc,kc,lc),ca.g.Nq=lc))}}}for(var Kc=0;Kc<Ja.length;Kc++){var Nb=Ja[Kc];if(Nb.b4w_floating){var qc=Nb.b4w_floating_settings;if("MAIN_BODY"==qc.part){Nb.sc={};Nb.sc.Vk=qc.floating_factor;Nb.sc.Fm=qc.water_lin_damp;Nb.sc.Gm=qc.water_rot_damp;Nb.sc.yi=[];for(var cd=Nb.cc?Nb.cc.dupli_group.objects:Ja,Yc=
0;Yc<cd.length;Yc++){var rc=cd[Yc];if(rc.b4w_floating){var $c=rc.b4w_floating_settings;T.Gx(rc)&&qc.name==$c.name&&(Nb.sc.yi.push(rc),rc.pt=rc.b4w_floating_settings.synchronize_position)}}}}}e(b,c)}function k(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];if(!f.camera)throw"Scene check failed: No camera";if(!aa.Hi(f,"LAMP").length)throw"Scene check failed: No lamp";for(var g=aa.Hi(f,"MESH"),v=0;v<g.length;v++){var k=g[v],l=va.Ws(k);l&&(a.meshes.push(l),k.data=l)}for(var v=H(a),k=a.meshes,
l=k.slice(0),r=0;r<v.length;r++){var h=v[r];"MESH"==h.type&&(h=l.indexOf(h.data),-1<h&&l.splice(h,1))}for(r=0;r<l.length;r++)k.splice(k.indexOf(l[r]),1);aa.Ms(f);Ob.enabled&&f.b4w_enable_physics&&T.ft(f);f.b4w_enable_audio&&V.gt(f);g=m.lw(aa.fl(f),f.b4w_batch_grid_size,g);aa.Hs(f,g);aa.fw(aa.fl(f))}d=a.materials;if(zb.Lk&&xa.Cm)for(f=0;f<d.length;f++){g=d[f];l=g.texture_slots;for(v=0;v<l.length;v++)if(r=l[v],h=r.texture,"IMAGE"==h.type||"ENVIRONMENT_MAP"==h.type)k=h.image,k.dc||(-1<k.filepath.indexOf(".dds")?
k.dc=!0:(k.dc=!h.b4w_disable_compression&&!r.use_map_normal&&"ENVIRONMENT_MAP"!=h.type&&!h.b4w_shore_dist_map,k.dc&&(k.filepath+=".dds")));if(v=g.node_tree)for(l=v.nodes,v=0;v<l.length;v++)k=l[v],"TEXTURE"==k.type&&((r=k.texture)?(k=r.image,k.dc||(k.dc=r.d.pk&&!r.b4w_disable_compression,k.dc&&(k.filepath+=".dds"))):ua.warn("B4W Warning: material ",g.name," has empty textures"))}else for(d=a.images,f=0;f<d.length;f++)g=d[f],g.dc=Boolean("FILE"==g.source&&-1<g.filepath.indexOf(".dds"));Ta&&ua.log("%cDEBUG BPYDATA:",
"color: #a0a",a);e(b,c)}function l(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},m={},g={},v={},k=0;k<d.length;k++){var l=d[k];f[l.uuid]=l;g[l.uuid]=l}for(k=0;k<a.length;k++)l=a[k],m[l.uuid]=l,v[l.uuid]=l;s(a,null,v,g);for(var r in g)r in f||d.push(g[r]);for(r in v)r in m||a.push(v[r]);e(b,c)}function s(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var m=a[f],g=c[m.uuid];if(m=g.proxy){b&&-1==e.indexOf(m.uuid)&&e.push(m.uuid);for(var v=c[m.uuid],k=v.constraints,m=0;m<k.length;m++){var l=la.Sd(k[m]);l.name+=
"_CLONE";g.constraints.push(l)}"b4w_proxy_inherit_anim"in g&&!g.b4w_proxy_inherit_anim||(g.animation_data&&(v.animation_data=la.Sd(g.animation_data)),v.b4w_use_default_animation=g.b4w_use_default_animation,v.b4w_auto_skel_anim=g.b4w_auto_skel_anim,v.b4w_cyclic_animation=g.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)g=la.gl(a,"uuid",e[f]),-1<g&&a.splice(g,1);e={};for(f=0;f<a.length;f++)m=a[f],g=c[m.uuid],b&&(k=la.Sd(g),k.name=b+"*"+g.name,k.origin_name=g.name,k.uuid=ga.dp("Object"+k.name),c[k.uuid]=
k,e[m.uuid]=k.uuid,m.uuid=k.uuid),g=c[m.uuid],g.dupli_group&&(m=g.dupli_group,k=d[m.uuid],v=la.Sd(k),v.name=la.ym(k.name+"_CLONE"),v.uuid=ga.dp("Group"+v.name),d[v.uuid]=v,m.uuid=v.uuid,s(v.objects,g.name,c,d));if(b)for(f=0;f<a.length;f++){m=a[f];g=c[m.uuid];g.parent&&g.parent.uuid in e&&(g.parent.uuid=e[g.parent.uuid]);k=g.constraints;for(m=0;m<k.length;m++)b=k[m],b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=g.modifiers;for(m=0;m<b.length;m++)d=b[m],d.object&&d.object.uuid in e&&(d.object.uuid=
e[d.object.uuid])}}function f(a,b,c){(c=c[a[b].uuid])||ua.error("Dangling link found:",b,a);a[b]=c}function t(a,b,c){a[b]=la.Nc("identifier",a[b].identifier,c)}function A(a,c,d,e,f,m){if(!xa.Me){for(var g=P(c.w),v=a.images,k={},l=[],r=0;r<v.length;r++){var h=v[r],p=h.uuid;if("FILE"===h.source){var n=D(h,a.textures);if(!n.length)ua.warn("B4W Warning: image ",h.name," has no users");else if(!n[0].b4w_shore_dist_map){var t=M(g+h.filepath),n=h.dc?da.Ag:da.Bg;zb.Dl&&xa.sg&&(t=da.fm(t),"dds"==t[1]?(t=da.fm(t[0]),
t=t[0]+".min50."+t[1]+".dds"):t=t[0]+".min50."+t[1]);l.push([p,n,t,h.name]);k[p]=h}}}l.length?(e.fp=0,da.K(l,function(f,g,v,r){if(f){b(f,r,!0);g=k[g];v=D(g,a.textures);for(r=0;r<v.length;r++){var h=v[r];qa.Wj(h.d,f,g.dc,h.image.filepath)}f=++e.fp/l.length;m(c,d,f)}},function(){ua.log("%cLOADED ALL IMAGES","color: #0a0");f(c,d)})):f(c,d)}}function D(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function y(a,b,c,d,e,f){if(!xa.Me){a=H(a);for(var m=P(b.w),g=[],v={},
k=0;k<a.length;k++){var l=a[k];if(V.Sf(l)&&V.zq(l)!=V.Mm){var r=l.data.sound,h=r.uuid;"BACKGROUND_MUSIC"==V.To(l)&&(h=la.ew());if(!(h in v)){v[h]=[];r=M(m+r.filepath);switch(V.zq(l)){case V.dk:var p=da.ek;break;case V.Lm:p=da.fk}var r=da.fm(r),n=V.qv(r[1]),r=n!=r[1]?r[0]+".lossconv."+n:r[0]+"."+n;g.push([h,p,r])}v[h].push(l)}}g.length?da.K(g,function(a,e,m,k){if(a){ua.log("%cLOAD SOUND","color: #0aa",k);-1==k.indexOf(hb)&&ua.warn("B4W Warning: sound",k,"is not from app root");e=v[e];for(m=0;m<e.length;m++)V.TA(e[m],
a);a=++d.cA/g.length;f(b,c,a)}},function(){ua.log("%cLOADED ALL SOUNDS","color: #0aa");for(var a=aa.o(),a=aa.dl(a,"SPEAKER"),d=0;d<a.length;d++){var f=a[d];V.Sf(f)&&V.kh(f)&&V.Wp(f)}e(b,c)}):e(b,c)}}function u(a,b,c,d){for(var e=b.b4w_lods_num,f=0,m=b.constraints,g=0;f<e;g++){var v=m[g];if("LOCKED_TRACK"==v.type&&v.target){var k=v.target,l=la.Di(k);l.name=b.name+"_LOD_"+String(f+1);c.push([a,l]);d.push(k);v.target=l;f++}}}function g(a,b){for(var c=a.constraints,d=0,e=0;e<c.length;e++){var f=c[e];
if("LOCKED_TRACK"==f.type){if(b===d)return f.target;d++}}return null}function E(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=f.objects,m=f.indexOf(a),-1<m&&f.splice(m,1))}var m=d.indexOf(a);-1<m&&d.splice(m,1)}}function I(a){a.d=la.Ji("MESH"===a.type?w(a):a.type);a.xa=null;a.Kd=[];var b=a.d,c=a.location,d=a.scale[0],e=Ub,f=a.rotation_quaternion,g=f[0],k=f[2],l=f[3];e[0]=f[1];e[1]=k;e[2]=l;e[3]=g;ia.Rc(a,c);ia.pe(a,e);ia.kf(a,d);switch(a.type){case "ARMATURE":c=
a.pose.bones;for(d=0;d<c.length;d++){e=c[d];f=e.bone;g=new Float32Array(f.matrix_local);k=new Float32Array(16);Na.invert(g,k);var l=new Float32Array(e.matrix_basis),h=new Float32Array(3);yb.subtract(f.tail_local,f.head_local,h);la.aB(h,k,h);e.Es=h;e.As=[e].concat(e.parent_recursive);e.ln=N.zo(g,N.create());e.kn=N.zo(l,N.create());e.mk=N.create();e.qi=!1}d=r.tt(a);b.Rd=d;d=r.Hn(a,d);b.Hj=d.xb;b.Gj=d.xb;b.Rj=d.e;b.Qj=d.e;b.ej=0;break;case "MESH":b.oe=xa.ok||a.b4w_selectable;b.Il=a.b4w_selectable;b.il=
{dx:a.b4w_glow_settings.glow_duration,fx:a.b4w_glow_settings.glow_period,gx:a.b4w_glow_settings.glow_relapses};b.oe&&(d=gb,d+=1,132651<d&&ua.error("Color ID pool depleted"),c=Math.floor(d/2601),d%=2601,e=Math.floor(d/51),a.fn=[c/51,e/51,d%51/51],gb++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;d=a.d;if(c=r.gh(a))if(e=a.data,e.vertex_groups.length){d.Rf=!0;f=e.vertex_groups;g=c.data.bones;k=c.pose.bones;l=0;e={};for(h=0;h<g.length;h++){var p=g[h].name,n=la.Nc("name",p,f);if(n){var t=la.gl(k,
"name",p);e[p]={qt:h,Mi:l++,Ll:t,Zq:n.index}}}f=l;g=xa.Jb;f>2*g?la.Cy('B4W Error: too many bones for "'+a.name):f>g?(ua.warn('B4W Warning: too many bones for "'+a.name+" / "+c.name+'": '+f+" bones (max "+g+"). Blending between frames will be disabled"),d.yo=!1):d.yo=!0;d.Rd=e;d.Jb=f}else d.Rf=!1;else d.Rf=!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.Zj=a.data.b4w_vertex_anim.length?!0:!1;if(c=r.gh(a))d=a.d.Rd,d=r.Hn(c,d),b.Hj=d.xb,b.Gj=d.xb,b.Rj=d.e,b.Qj=d.e,b.ej=0;a.aa=[];b.nc=a.b4w_shadow_cast;
b.Ab=a.b4w_shadow_receive;b.oc=a.b4w_shadow_cast_only&&b.nc;b.Pc=a.b4w_reflexible;b.zc=a.b4w_reflexible_only&&b.Pc;b.Oc=a.b4w_reflective;b.Ff=a.b4w_caustics;b.Gd=a.b4w_wind_bending;b.ak=a.b4w_wind_bending_angle;d=m.iB(a.b4w_wind_bending_angle,m.it(a.data.b4w_bounding_box),a.scale[0]);b.Hd=d;b.zf=a.b4w_wind_bending_freq;b.Ke=a.b4w_detail_bending_freq;b.Je=a.b4w_detail_bending_amp;b.De=a.b4w_branch_bending_amp;b.gj=!1;b.fe=a.b4w_main_bend_stiffness_col;d=a.b4w_detail_bend_colors;b.vb={};b.vb.yp=d.leaves_stiffness_col;
b.vb.xp=d.leaves_phase_col;b.vb.Mp=d.overall_stiffness_col;b.ra=!1;b.Ui=a.b4w_do_not_cull;b.Pk=a.b4w_disable_fogging;b.Oe=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";d=a.data.materials[0];b.Yk=d.physics.friction;b.Rk=d.physics.elasticity;b.vh=0;b.Uf=a.b4w_lod_distance;fb&&1E4===a.b4w_lod_distance&&ua.warn('B4W Warning: object "'+a.name+'" has default LOD distance');b.ul=!0;break;case "CAMERA":U.Dt(a);U.et(a);break;case "LAMP":J.Ox(a);break;case "CURVE":if(d=z.Uu(a))a.Ds=d;break;
case "EMPTY":b.Rb=R.Id(),b.dd={J:[0,0,0],ua:0}}a.parent&&"OBJECT"==a.parent_type&&"ARMATURE"!=a.parent.type?(c=b.e,e=b.h,d=b.scale,Z.un(a,a.parent,c,e,d)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(c=b.e,e=b.h,Z.tn(a,a.parent,a.parent_bone,c,e)):a.cc&&a.cc.b4w_group_relative?(d=N.He(b.e,b.scale,b.h),Z.Js(a,a.cc,d)):a.cc&&!a.cc.b4w_group_relative&&(ia.H(a),e=b.I,Na.multiply(a.cc.d.I,e,e),c=la.Xe(e),d=la.pj(e),e=la.ge(e),ia.Rc(a,c),ia.pe(a,e),ia.kf(a,d));a.field&&(b.xo=a.field.strength,
v.Uj(a));if(d=a.dupli_group)for(c=d.objects,d=0;d<c.length;d++)c[d].cc=a;b.Bm=a.game.use_collision_compound;b.Ey=a.game.physics_type;ia.H(a)}function w(a){var b=r.ij(a),c=a.b4w_do_not_batch,d=a.b4w_dynamic_geometry,e=v.ih(a),f=a.b4w_collision,m=a.b4w_vehicle,g=a.b4w_floating,k=v.rx(a),l;if(!(l=Fa)){if(!b){if(!c){if(!d){if(!e){if(!f){if(!m){if(!g){a:{g=a.data;for(m=0;m<g.materials.length;m++)if(g.materials[m].b4w_skydome){g=!0;break a}g=!1}if(!g){a:{a=a.data;for(g=0;g<a.materials.length;g++)if("LENS_FLARES"===
a.materials[g].name){a=!0;break a}a=!1}g=a||k}}m=g}f=m}e=f}d=e}c=d}b=c}l=b}return l?"DYNAMIC":"STATIC"}function G(a,b,c,d,e){for(d=0;d<a.scenes.length;d++)for(var f=a.scenes[d],m=0;m<La.length;m++)for(var g=aa.La(f,La[m]),v=0;v<g.length;v++){var k=g[v];Ob.enabled&&f.b4w_enable_physics&&T.Ig(k,f)}e(b,c)}function F(a,c,d,e,f){var m={};e=[];for(var g=a.scenes,v=0;v<a.scenes.length;v++){var k=g[v];if(k.d.Ca&&(k=k.d.Ca.Cd)&&"FILE"===k.source){var l=k.uuid,r=P(c.w),r=M(r+k.filepath);e.push([l,k.dc?da.Ag:
da.Bg,r,k.name]);m[l]=k}}e.length?da.K(e,function(c,d,e,f){if(c){b(c,f,!0);d=m[d];f=D(d,a.textures);for(e=0;e<f.length;e++){var v=f[e];qa.Wj(v.d,c,d.dc,v.image.filepath)}for(e=0;e<g.length;e++)if(f=g[e],f.d.Ca.Cd===d){var k=c,l=d,r=document.createElement("canvas"),v=l.size[0],l=l.size[1];r.width=v;r.height=l;r=r.getContext("2d");r.drawImage(k,0,0);k=r.getImageData(0,0,v,l).data;r=new Float32Array(4);r[0]=1/16581375;r[1]=1/65025;r[2]=1/255;r[3]=1;for(var v=v*l,l=new Float32Array(v),h=0;h<v;h++)l[h]=
r[1]*k[4*h+2]+r[2]*k[4*h+3];f.d.Yl=l}}},function(){f(c,d)}):f(c,d)}function x(a,c,d,e,f){if(xa.uc&&xa.Yb){e=a.scenes[0];a=[];for(var m=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"],g=0;g<m.length;g++){var v=aa.ma(e,m[g]);v&&a.push(v)}if(a.length){e=[];P(c.w);g=da.Bg;e.push(["SEARCH_TEXTURE",g,X.Kb.cm,"smaa_search_texture"]);e.push(["AREA_TEXTURE",g,X.Kb.bm,"smaa_area_texture"]);for(g=0;g<a.length;g++)if(m=a[g],"SMAA_BLENDING_WEIGHT_CALCULATION"==
m.type){a=m.Z;for(g=0;g<a.length;g++)if(m=a[g],"u_search_tex"==m.W)var k=m.va;else if("u_area_tex"==m.W)var l=m.va;break}e.length?da.K(e,function(a,c,d,e){a&&(b(a,e,!1),c="SEARCH_TEXTURE"==c?k:l,c.source="IMAGE",c.An=!0,qa.Wj(c,a,-1!=e.indexOf(".dds")?1:0,e),qa.Kj(c,qa.t,qa.t))},function(){f(c,d)}):f(c,d)}else f(c,d)}else f(c,d)}function O(a,b,c,d){for(b=0;b<a.scenes.length;b++)if(c=a.scenes[b],!c.b4w_load_empty){for(var e=0;e<ib.length;e++)for(var f=ib[e],f=aa.La(c,f),m=0;m<f.length;m++){var g=f[m];
la.We(g)&&g.proxy||d.nk.push({kq:c,Jp:g,type:"obj"})}for(e=0;e<Ua.length;e++)for(f=Ua[e],f=aa.La(c,f),m=0;m<f.length;m++)g=f[m],c.b4w_enable_audio&&d.nk.push({kq:c,Jp:g,type:"sfx_obj"})}}function S(a,b,c,d,e,f){a=d.nk;e=d.Kp;if(a){var m=a[e].Jp,g=a[e].kq;switch(a[e].type){case "obj":aa.Ig(g,m);break;case "sfx_obj":V.Ig(m,g)}d=++d.Kp/a.length}else d=1;f(b,c,d)}function Q(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];aa.Ky(f);f.b4w_use_nla&&Ya.QA(f,f.b4w_nla_cyclic)}aa.mq(a.scenes[0]);
a=H(a);d=[];for(f=0;f<a.length;f++){var m=a[f];!m.d||"DYNAMIC"!=m.d.type&&"CAMERA"!=m.d.type||ia.H(m);m.b4w_use_default_animation&&r.ij(m)&&(r.ti(m),m.b4w_cyclic_animation&&r.Tb(m,!0),la.We(m)&&d.push(m),r.play(m))}if(d.length)for(f=0;f<a.length;f++)if(m=a[f],la.Vb(m)&&!m.b4w_use_default_animation&&r.ij(m))for(var g=0;g<d.length;g++){var v=d[g];r.gh(m)==v&&(r.ti(m),r.Tb(m,r.kh(v)),r.play(m))}e(b,c)}function P(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function M(a){if(""==a)return".";
var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function H(a){Aa||K(a);return Aa}function K(a){var b=a.scenes;a=[];for(var c=0;c<b.length;c++)B(b[c].objects,0,a);Aa=[];for(c=0;c<a.length;c++)for(var b=a[c],d=0;d<b.length;d++)for(var e=b[d],f=0;f<e.length;f++)Aa.push(e[f])}
function B(a,b,c){c[b]=c[b]||[];for(var d=c[b],e=0;e<a.length;e++){var f=a[e],m=L(f);d[m]=d[m]||[];-1==d[m].indexOf(f)&&d[m].push(f);(f=f.dupli_group)&&B(f.objects,b+1,c)}}function L(a){return(a=a.parent)?1+L(a):0}var r=q("__animation"),m=q("__batch"),R=q("__boundings"),U=q("__camera"),X=q("__config"),Z=q("__constraints"),ha=q("__controls"),z=q("__curve"),ea=q("__dds");q("__debug");var ka=q("__extensions"),J=q("__lights"),fa=q("__loader"),da=q("__assets"),ga=q("__md5"),v=q("__particles");q("__prerender");
var T=q("__physics"),ua=q("__print"),va=q("__reformer"),Ka=q("__renderer"),aa=q("__scenes"),Ya=q("__nla"),V=q("__sfx"),Ea=q("__shaders"),qa=q("__textures"),N=q("__tsr"),ia=q("__transform"),ba=q("__nodemat"),la=q("__util"),yb=q("vec3"),Ba=q("vec4"),Na=q("mat4"),xa=X.s,zb=X.Md,Ob=X.qb,Fa=!1,Ta=!1,fb=!1,Ub=new Float32Array(4),Vb={},Ia=null,Aa=null,gb=0,hb="",ib="LAMP EMPTY CAMERA SPEAKER MESH ARMATURE".split(" "),La=["MESH","CAMERA","EMPTY"],Ua=["SPEAKER"];a.yc=function(){return fa.yc(Ia)};a.update=
function(){fa.SA(Ia,Vb)};a.load=function(a,b,f,m){Ia=fa.Qu({load_main:{fb:fa.ye,kb:!1,U:[],nb:!1,zb:500,gb:e},duplicate_objects:{fb:fa.Be,kb:!1,U:["load_main"],nb:!1,zb:50,gb:l},load_binaries:{fb:fa.ye,kb:!1,U:["load_main"],nb:!1,zb:500,gb:d},prepare_bindata:{fb:fa.Be,kb:!1,U:["duplicate_objects","load_binaries"],nb:!1,zb:0,gb:h},prepare_root_datablocks:{fb:fa.Be,kb:!1,U:["duplicate_objects","prepare_bindata"],nb:!1,zb:150,gb:n},prepare_root_scenes:{fb:fa.Be,kb:!1,U:["prepare_root_datablocks"],nb:!1,
zb:350,gb:k},load_smaa_textures:{fb:fa.ye,kb:!0,U:["prepare_root_scenes"],nb:!1,zb:10,gb:x},load_shoremap:{fb:fa.ye,kb:!0,U:["prepare_root_scenes"],nb:!1,zb:10,gb:F},load_textures:{fb:fa.ye,kb:!0,U:["prepare_root_scenes"],nb:!0,zb:500,gb:A,Fe:{fp:0}},add_physics_objects:{fb:fa.Be,kb:!1,U:["load_shoremap"],nb:!1,zb:20,gb:G},add_objects:{fb:fa.Be,kb:!1,U:["add_physics_objects"],nb:!1,zb:800,gb:O,Qg:S,Pg:Q,Fe:{nk:[],Kp:0}},load_speakers:{fb:fa.ye,kb:!0,U:["add_objects"],nb:!0,zb:30,gb:y,Fe:{cA:0}}},
a,b,f,c,m,xa.Me)};a.Uq=function(){ua.log("%cUNLOAD","color: #00a");var a=Ia;a&&a.w&&(r.ga(),V.ga(),Ya.ga(),aa.ga(),J.ga(),T.ga(),la.ga(),Ka.ga(),ba.ga(),Ea.ga(),ha.ga(),ka.ga(),da.ga(),v.ga(),Ia=Aa=null,gb=0)};a.yz=function(a){hb=a}};b4w.module.__batch=function(a,q){function c(a){return{type:a,Pa:[],$b:[],gd:[],uf:{},ob:[],za:null,vj:null,wj:0,Yf:0,$t:!0,O:!0,la:!1,ld:M.Cg,P:!1,ya:new Float32Array([0,0,0,1]),Xc:M.Ec,Ka:{}}}function b(a,b,d){var e=[];if(a.b4w_do_not_render)return e;for(var f=p(d,b),m=JSON.stringify(b),g=a.data,k=g.materials,l=0;l<f.length;l++)for(var h=f[l],t=0;t<k.length;t++)if(!M.ap(g,t)){var s=c(h),A=k[t];if(n(s,A,!0)){s.ld=g.ld||M.Cg;"COLOR_ID"===h&&(s.Zt=new Float32Array(a.fn));D(s,b);for(var z=s,y=a.particle_systems,
R=0;R<y.length;R++){var q=y[R].settings.b4w_vcol_from_name,w=y[R].settings.b4w_vcol_to_name;""!==q&&""!==w&&(z.Ka[q]={Re:!1,src:[{name:q,ic:7}]})}"DYNAMIC"==b.type&&(s.Fh=a.uuid);I(s,m);z=M.so(g,t,s.gd,s.Rd,s.Ka,s.uf);"LENS_FLARES"==A.name&&(z=B.Jy(z));-1==s.ob.indexOf(A.name)&&s.ob.push(A.name);e.push({m:s,Bb:z,Ac:b,Qc:[a]})}}g=a.particle_systems;if(0<g.length&&e.length){f=!0;for(l=0;l<g.length;l++)if(g[l].settings.use_render_emitter){f=!1;break}l=e[0].m;g=e[0].Bb;k=[];h=a.particle_systems;t=a.data;
s=t.materials;for(A=0;A<h.length;A++)if(y=h[A],z=y.settings,"EMITTER"==z.type){if("DYNAMIC"==b.type){R=c("MAIN");q=t.materials[y.settings.material-1];w={name:"PARTICLES"};"HALO"===q.type?(w.halo=q.halo,w.texture_slots=[]):w.texture_slots=q.texture_slots;w.offset_z=q.offset_z;w.diffuse_color=q.diffuse_color;w.diffuse_shader=q.diffuse_shader;w.specular_color=q.specular_color;w.specular_shader=q.specular_shader;w.diffuse_intensity=q.diffuse_intensity;w.alpha=q.alpha;w.game_settings=q.game_settings;w.raytrace_transparency=
q.raytrace_transparency;w.raytrace_mirror=q.raytrace_mirror;q=w;n(R,q,!0);q.texture_slots=s[y.settings.material-1].texture_slots;w=R;switch(y.settings.b4w_billboard_align){case "VIEW":u(w,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":u(w,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":u(w,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":u(w,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}D(R,b);R.Oe=!0;R.Fh=z.uuid;I(R,m);R.Bj=y;
z=B.iw(R,t,y,q,a.d.I);-1==R.ob.indexOf(q.name)&&R.ob.push(q.name);k.push({m:R,Bb:z,Ac:b,Qc:[a]})}}else if("HAIR"==z.type){R=X.hj(y.seed);z.b4w_dynamic_grass&&(b.Ui=!0);if(y.transforms.length)var x=y.transforms;else for(var q=M.al(g,z.count,!1,R),x=new Float32Array(4*q.length),L=0;L<q.length;L++)w=0.75+0.5*X.lc(R),x[4*L]=q[L][0],x[4*L+1]=q[L][1],x[4*L+2]=q[L][2],x[4*L+3]=w;q=r.Ra(d,"GRASS_MAP")?!0:!1;if("OBJECT"==z.render_type)w=[p(d,z.dupli_object.d)],y=E(a,b,l,g,[z.dupli_object],w,[x],z,y,q,R,!1),
k.push.apply(k,y);else if("GROUP"==z.render_type){for(var U=z.dupli_group.objects,G=!1,w=[],L=0;L<U.length;L++){var F=p(d,z.dupli_group.objects[L].d);w.push(F)}if(z.use_whole_group){G=x;x=U;L={};for(F=0;F<G.length;F+=4)for(var J=0;J<x.length;J++){var K=Z.create();Z.scale(x[J].d.e,x[J].d.scale,K);var H=Z.clone([G[F],G[F+1],G[F+2]]);Z.add(H,K,H);L[J]||(L[J]=new Float32Array(G.length));L[J][F]=H[0];L[J][F+1]=H[1];L[J][F+2]=H[2];L[J][F+3]=G[F+3]}x=L;G=!0}else if(z.use_group_count){for(var H=U,O=z.dupli_weights,
L=R,F={},J=[],K=0;K<H.length;K++)for(var ha=H[K],ha=ha.origin_name||ha.name,P=0;P<O.length;P++){var S=O[P];ha==S.name.split(": ")[0]&&J.push(S)}O.length!=J.length&&Q.error("B4W Error: dupli weights match failed");for(K=0;K<x.length;K+=4){var ea,O=J;ea=[0];for(H=0;H<O.length;H++)ea[H+1]=ea[H]+O[H].count;O=ea[ea.length-1]*X.lc(L);for(H=ha=0;H<ea.length;H++)if(O>=ea[H]&&O<ea[H+1]){ha=H;break}ea=ha;F[ea]=F[ea]||[];F[ea].push(x[K],x[K+1],x[K+2],x[K+3])}for(ea in F)F[ea]=new Float32Array(F[ea]);x=F}else{L=
R;F=U.length;J={};for(K=0;K<x.length;K+=4){var fa=Math.floor(F*X.lc(L));J[fa]=J[fa]||[];J[fa].push(x[K],x[K+1],x[K+2],x[K+3])}for(fa in J)J[fa]=new Float32Array(J[fa]);x=J}y=E(a,b,l,g,U,w,x,z,y,q,R,G);k.push.apply(k,y)}"INSTANCE"==z.b4w_wind_bend_inheritance&&(a.d.Hd=0)}else throw"Unknown particle settings type";f?e=k:e.push.apply(e,k)}return e}function e(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d].m;c[e.id]||(c[e.id]={m:e,Ac:a[d].Ac,Qc:[],Mq:[]});var f=c[e.id].Qc;f.push.apply(f,a[d].Qc);
a[d].Bb&&a[d].Bb.D&&c[e.id].Mq.push(a[d].Bb)}for(var m in c){a=c[m].Mq;if(0==a.length)d=X.lb(X.ym("%empty"));else if(1==a.length)d=a[0];else{e=[];for(d=0;d<a.length;d++)M.Jx(a[d])||e.push(d);if(e.length<a.length)for(d=0;d<e.length;d++)M.Lq(a[e[d]]);d=M.tA(a)}b.push({m:c[m].m,Ac:c[m].Ac,Bb:d,Qc:c[m].Qc})}return b}function d(a,b){for(var c=0;c<a.length;c++){var d=a[c].m;if(!b||-1<b.indexOf(d.type))for(var e=[],f=0;f<a[c].Qc.length;f++){var m=a[c].Qc[f];if(-1==e.indexOf(m.name)){for(var g=0;g<m.aa.length;g++)if(m.aa[g]==
d)throw"Batch already exist in object";m.aa.push(d);e.push(m.name)}}}}function h(a){return{V:a.max_x,R:a.min_x,G:a.max_y,B:a.min_y,ja:a.max_z,pa:a.min_z}}function p(a,b){var c=["SHADELESS","MAIN","NODES"];b.oe&&(r.Ra(a,"COLOR_PICKING")||r.Ra(a,"GLOW_MASK"))&&c.push("COLOR_ID");r.Ra(a,"WIREFRAME")&&c.push("WIREFRAME");c.push("PHYSICS");(r.Ra(a,"DEPTH")||r.Ra(a,"SHADOW_CAST"))&&c.push("DEPTH");r.Ra(a,"GRASS_MAP")&&c.push("GRASS_MAP");if(b.oc||b.zc){var d=null;b.oc&&(d="SHADELESS MAIN NODES COLOR_ID PHYSICS WIREFRAME".split(" "));
if(b.zc)var e=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],d=null!==d?X.ct(d,e):e;for(e=0;e<d.length;e++){var f=c.indexOf(d[e]);-1!==f&&c.splice(f,1)}}return c}function n(a,b,c){var d,e;switch(a.type){case "SHADELESS":if(b.b4w_collision||!b.use_shadeless||b.use_nodes)a=!1;else{G(a,"shadeless.glslv","shadeless.glslf");var g=b.game_settings.alpha_blend;u(a,"ALPHA","OPAQUE"===g?0:1);u(a,"ALPHA_CLIP","CLIP"===g?1:0);y(a,"a_position");var r=b.texture_slots,g=s("use_map_color_diffuse",r)[0],h=s("use_map_color_diffuse",
r)[1],r=s("use_rgb_to_intensity",r)[0]&&s("use_stencil",r)[0],p=new Float32Array([b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha]);a.ya=p;if(g){u(a,"TEXTURE_COLOR",1);switch(g.blend_type){case "MIX":u(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":u(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}y(a,"a_texcoord");p="IMAGE"==g.texture.d.source&&c?[p[0],p[1],p[2],1]:"ENVIRONMENT_MAP"==g.texture.d.source&&c?[0.8,0.8,0.8,1]:null;p=l(g,p);F(a,p,"u_colormap0");
a.kd=g.diffuse_color_factor;a.wc=new Float32Array(g.texture.b4w_uv_velocity_trans);a.Vc=new Float32Array(g.scale)}g&&h&&r&&(u(a,"TEXTURE_STENCIL_ALPHA_MASK",1),p=c?[0.8,0.8,0.8,1]:null,p=l(h,p),F(a,p,"u_colormap1"),p=c?[0.5,0.5,0.5,1]:null,p=l(r,p),F(a,p,"u_stencil0"));b.use_vertex_color_paint?(u(a,"VERTEX_COLOR",1),y(a,"a_color")):u(a,"VERTEX_COLOR",0);a.je=b.offset_z;k(a,b);a=!0}break;case "MAIN":if(b.b4w_collision||b.use_shadeless||b.use_nodes)a=!1;else{a.wc=new Float32Array([0,0]);a.Ye=Array(4);
for(g=0;4>g;g++)a.Ye[g]=new Float32Array([0,0]);k(a,b);a.je=b.offset_z;a.Vc=new Float32Array([1,1,1]);var n=b.texture_slots,g=new Float32Array([b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha]);switch(b.name){case "LENS_FLARES":G(a,"special_lens_flares.glslv","special_lens_flares.glslf");y(a,"a_position");y(a,"a_texcoord");var B=c?[1,1,1,0]:null,B=l(n[0],B);F(a,B);break;case "PARTICLES":0==n.length?G(a,"particles_color.glslv","particles_color.glslf"):(G(a,"particles_texture.glslv",
"particles_texture.glslf"),(B=l(n[0]))&&F(a,B));break;default:G(a,"main.glslv","main.glslf");var h=s("use_map_color_diffuse",n)[0],z=s("use_map_color_spec",n)[0],A=s("use_map_normal",n)[0],E=s("use_map_mirror",n)[0],r=s("use_map_color_diffuse",n)[1],R=s("use_rgb_to_intensity",n)[0]&&s("use_stencil",n)[0];if(h){switch(h.blend_type){case "MIX":u(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":u(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}B="IMAGE"==h.texture.d.source&&
c?[g[0],g[1],g[2],1]:"ENVIRONMENT_MAP"==h.texture.d.source&&c?[0.8,0.8,0.8,1]:null;B=l(h,B);F(a,B,"u_colormap0");a.kd=h.diffuse_color_factor;a.wc=new Float32Array(h.texture.b4w_uv_velocity_trans);a.Vc=new Float32Array(h.scale)}var q=h&&h==z;z&&(q||(B=c?[0.5,0.5,0.5,1]:null,B=l(z,B),F(a,B,"u_specmap")),a.fA=z.specular_color_factor);A&&(B=c?[0.5,0.5,1,1]:null,B=l(A,B),F(a,B,"u_normalmap0"),a.my=A.normal_factor,a.Ye[0].set(A.texture.b4w_uv_velocity_trans));E?(B=c?[0,0,0.5,1]:null,B=l(E,B),F(a,B,"u_mirrormap"),
a.rj=E.mirror_factor):a.rj=0;if(p=h&&r&&R?1:0)B=c?[0.8,0.8,0.8,1]:null,B=l(r,B),F(a,B,"u_colormap1"),B=c?[0.5,0.5,0.5,1]:null,B=l(R,B),F(a,B,"u_stencil0");(R=h||z||A)&&a.Vc.set(R.scale);u(a,"TEXTURE_COLOR",void 0==h?0:1);u(a,"TEXTURE_SPEC",void 0==z?0:1);u(a,"TEXTURE_NORM",void 0==A?0:1);u(a,"TEXTURE_MIRROR",void 0==E?0:1);u(a,"ALPHA_AS_SPEC",q?1:0);u(a,"TEXTURE_STENCIL_ALPHA_MASK",p);y(a,"a_position");y(a,"a_normal");A&&(y(a,"a_normal"),y(a,"a_tangent"),E=A.texture,E.b4w_use_map_parallax&&ea.td&&
(q=m.u(E.b4w_parallax_steps),u(a,"PARALLAX",1),u(a,"PARALLAX_STEPS",q),a.Jl=E.b4w_parallax_scale));(h||z||A)&&y(a,"a_texcoord");if(b.b4w_water){a.yg=!0;a.cr=b.b4w_water_shore_smoothing;a.rc=b.b4w_water_dynamic;z=b.texture_slots;G(a,"special_water.glslv","special_water.glslf");y(a,"a_position");y(a,"a_texcoord");y(a,"a_normal");y(a,"a_tangent");q=s("use_map_normal",z);A=s("use_map_mirror",z)[0];E=s("use_map_alpha",z)[0];q.length&&(R=l(q[0]),F(a,R,"u_normalmap0"));u(a,"NUM_NORMALMAPS",q.length);a.Xf=
Array(q.length);for(R=0;R<q.length;R++)a.Ye[R].set(q[R].texture.b4w_uv_velocity_trans),a.Xf[R]=new Float32Array(2),a.Xf[R].set([q[R].scale[0],q[R].scale[1]]);A?(u(a,"TEXTURE_MIRROR",1),q=l(A),F(a,q,"u_mirrormap"),a.rj=A.mirror_factor):(u(a,"TEXTURE_MIRROR",0),a.rj=0);E?(u(a,"ALPHA_MAP",1),A=l(E),F(a,A,"u_alphamap")):u(a,"ALPHA_MAP",0);A=null;for(R=0;R<z.length;R++)if(e=z[R],!0===e.texture.b4w_water_foam){A=e;break}A&&ea.Lc?(u(a,"FOAM",1),E=l(A),F(a,E,"u_foam"),a.Wk=b.b4w_foam_factor,a.Uv=A.texture.b4w_foam_uv_freq,
a.Sv=A.texture.b4w_foam_uv_magnitude,a.Tv=new Float32Array([A.scale[0],A.scale[1]])):u(a,"FOAM",0);for(R=0;R<z.length;R++)if(e=z[R],!0===e.texture.b4w_shore_dist_map){var I=e;break}I?(I=l(I),F(a,I,"u_shore_dist_map"),u(a,"SHORE_PARAMS",1),I=e.texture.b4w_shore_boundings,u(a,"MAX_SHORE_DIST",m.u(e.texture.b4w_max_shore_dist)),u(a,"SHORE_MAP_SIZE_X",m.u(I[0]-I[1])),u(a,"SHORE_MAP_SIZE_Z",m.u(I[2]-I[3])),u(a,"SHORE_MAP_CENTER_X",m.u((I[0]+I[1])/2)),u(a,"SHORE_MAP_CENTER_Z",m.u((I[2]+I[3])/2))):u(a,"SHORE_PARAMS",
0);b.b4w_generated_mesh&&ea.Jc?(u(a,"GENERATED_MESH",1),a.br=!0,a.gB=b.b4w_water_num_cascads,a.hB=b.b4w_water_subdivs,a.eB=b.b4w_water_detailed_dist):(u(a,"GENERATED_MESH",0),a.br=!1);if(b.b4w_water_dynamic){e=m.u(b.b4w_water_dst_noise_scale0);var I=m.u(b.b4w_water_dst_noise_scale1),z=m.u(b.b4w_water_dst_noise_freq0),A=m.u(b.b4w_water_dst_noise_freq1),E=m.u(b.b4w_water_dir_min_shore_fac),q=m.u(b.b4w_water_dir_freq),R=m.u(b.b4w_water_dir_noise_scale),B=m.u(b.b4w_water_dir_noise_freq),w=m.u(b.b4w_water_dir_min_noise_fac),
D=m.u(b.b4w_water_dst_min_fac),x=m.u(b.b4w_water_waves_hor_fac);u(a,"DST_NOISE_SCALE_0",e);u(a,"DST_NOISE_SCALE_1",I);u(a,"DST_NOISE_FREQ_0",z);u(a,"DST_NOISE_FREQ_1",A);u(a,"DIR_MIN_SHR_FAC",E);u(a,"DIR_FREQ",q);u(a,"DIR_NOISE_SCALE",R);u(a,"DIR_NOISE_FREQ",B);u(a,"DIR_MIN_NOISE_FAC",w);u(a,"DST_MIN_FAC",D);u(a,"WAVES_HOR_FAC",x)}switch(b.specular_shader){case "PHONG":case "COOKTORR":u(a,"SPECULAR_SHADER","SPECULAR_PHONG");d=b.specular_hardness;break;case "WARDISO":u(a,"SPECULAR_SHADER","SPECULAR_WARDISO"),
d=b.specular_slope}a.Ob=new Float32Array([b.specular_intensity,d]);switch(b.diffuse_shader){case "LAMBERT":u(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.Le=[0,0];break;case "OREN_NAYAR":u(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.Le=[b.roughness,0];break;case "FRESNEL":u(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL"),a.Le=[b.diffuse_fresnel,b.diffuse_fresnel_factor]}a.lf=b.b4w_shallow_water_col;a.mf=b.b4w_shore_water_col;a.Xl=b.b4w_shallow_water_col_fac;a.Zl=b.b4w_shore_water_col_fac;u(a,"ABSORB",m.u(b.b4w_water_absorb_factor));
u(a,"SSS_STRENGTH",m.u(b.b4w_water_sss_strength));u(a,"SSS_WIDTH",m.u(b.b4w_water_sss_width));d=a.za;e=a.gd;a.za=d;a.gd=e}b.b4w_skydome&&(G(a,"special_skydome.glslv","special_skydome.glslf"),b.b4w_procedural_skydome?a.$f=!0:(B=c?[0.07,0.13,0.58,1]:null,B=l(n[0],B),F(a,B,"u_sky"),a.$f=!1),y(a,"a_position"),a.je=99999);"HALO"===b.type?(c=b.halo,G(a,"halo.glslv","halo.glslf"),u(a,"NUM_RINGS",c.ring_count),u(a,"NUM_LINES",c.line_count),u(a,"NUM_STARS",c.star_tip_count),u(a,"SKY_STARS",b.b4w_halo_sky_stars?
1:0),a.gd=["a_position"],a.mx=c.size,a.jx=c.hardness/20,a.lx=c.b4w_halo_rings_color,a.kx=c.b4w_halo_lines_color,a.nx=1/b.b4w_halo_stars_blend_height,a.ox=b.b4w_halo_stars_min_height,a.$o=!0):a.$o=!1;h&&"NORMAL"==h.texture_coords||p&&"NORMAL"==r.texture_coords?u(a,"TEXTURE_COORDS","TEXTURE_COORDS_NORMAL"):h&&"UV"==h.texture_coords?u(a,"TEXTURE_COORDS","TEXTURE_COORDS_UV"):u(a,"TEXTURE_COORDS",0)}a.ya=g;c=b.game_settings.alpha_blend;u(a,"ALPHA","OPAQUE"===c?0:1);u(a,"ALPHA_CLIP","CLIP"===c?1:0);u(a,
"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(u(a,"VERTEX_COLOR",1),y(a,"a_color")):u(a,"VERTEX_COLOR",0);a.ad=b.ambient;a.Hf=b.diffuse_intensity;a.Pe=b.emit;a.Nb=new Float32Array(b.specular_color);switch(b.specular_shader){case "PHONG":case "COOKTORR":u(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":u(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;default:Q.error("B4W Error: unsupported specular shader: "+b.specular_shader+
' (material "'+b.name+'")'),c=b.specular_hardness}a.Ob=new Float32Array([b.specular_intensity,c]);switch(b.diffuse_shader){case "LAMBERT":u(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.Le=[0,0];break;case "OREN_NAYAR":u(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.Le=[b.roughness,0];break;case "FRESNEL":u(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.Le=[b.diffuse_fresnel,b.diffuse_fresnel_factor];break;default:Q.error("B4W Error: unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.Le=
[0,0]}b.b4w_wettable?u(a,"WETTABLE",1):u(a,"WETTABLE",0);f(a,b);a=!0}break;case "NODES":a=t(a,b);break;case "DEPTH":if("LENS_FLARES"===b.name||"PARTICLES"===b.name||b.b4w_water||b.b4w_skydome||b.b4w_collision||"HALO"===b.type)a=!1;else if(k(a,b),a.P)a=!1;else{G(a,"depth.glslv","depth.glslf");y(a,"a_position");c=b.game_settings.alpha_blend;u(a,"ALPHA","OPAQUE"===c?0:1);a.Vc=new Float32Array([1,1,1]);if((b=s("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===c){a.Vc.set(b.scale);u(a,"TEXTURE_COLOR",
1);y(a,"a_texcoord");a.wc=new Float32Array([0,0]);if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)c=l(b),F(a,c,"u_colormap0"),a.wc.set(b.texture.b4w_uv_velocity_trans);"NONE"==b.texture.d.source&&(c=l(b),F(a,c,"u_colormap0"),a.wc.set(b.texture.b4w_uv_velocity_trans))}else u(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.WA=b.b4w_use_ghost,a.vc=b.b4w_collision_id,a.Yn=b.b4w_collision_group,a.Zn=b.b4w_collision_mask,a.Yk=b.physics.friction,a.Rk=b.physics.elasticity,
a=!0):b.b4w_water?(a.yg=!0,a.fB=b.b4w_water_dynamic,a.$i=b.b4w_water_dst_noise_scale0,a.aj=b.b4w_water_dst_noise_scale1,a.Yi=b.b4w_water_dst_noise_freq0,a.Zi=b.b4w_water_dst_noise_freq1,a.Pi=b.b4w_water_dir_min_shore_fac,a.Ni=b.b4w_water_dir_freq,a.Ri=b.b4w_water_dir_noise_scale,a.Qi=b.b4w_water_dir_noise_freq,a.Oi=b.b4w_water_dir_min_noise_fac,a.Xi=b.b4w_water_dst_min_fac,a.Hm=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||"PARTICLES"===b.name||b.b4w_skydome||
b.b4w_collision||"HALO"===b.type)a=!1;else{k(a,b);a.P=!1;G(a,"color_id.glslv","color_id.glslf");y(a,"a_position");c=b.game_settings.alpha_blend;u(a,"ALPHA","OPAQUE"===c?0:1);a.Vc=new Float32Array([1,1,1]);if((b=s("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===c){a.Vc.set(b.scale);u(a,"TEXTURE_COLOR",1);y(a,"a_texcoord");a.wc=new Float32Array([0,0]);if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)c=l(b),F(a,c,"u_colormap0"),a.wc.set(b.texture.b4w_uv_velocity_trans);"NONE"==
b.texture.d.source&&(c=l(b),F(a,c,"u_colormap0"),a.wc.set(b.texture.b4w_uv_velocity_trans))}else u(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":b.b4w_terrain?(k(a,b),a.P=!1,a.Xc=M.Ec,a.O=!0,G(a,"grass_map.glslv","grass_map.glslf"),y(a,"a_position"),c=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.Ka.a_grass_size={Re:!0,src:[]},c?(a.Ka.a_grass_size.src.push({name:c,ic:4}),u(a,"DYNAMIC_GRASS_SIZE",1)):u(a,"DYNAMIC_GRASS_SIZE",
0),a.Ka.a_grass_color={Re:!0,src:[]},b?(a.Ka.a_grass_color.src.push({name:b,ic:7}),u(a,"DYNAMIC_GRASS_COLOR",1)):u(a,"DYNAMIC_GRASS_COLOR",0),a=!0):a=!1;break;case "WIREFRAME":"LENS_FLARES"===b.name||"PARTICLES"===b.name||b.b4w_water||b.b4w_skydome||b.b4w_collision||"HALO"===b.type?a=!1:(G(a,"wireframe.glslv","wireframe.glslf"),y(a,"a_position"),y(a,"a_normal"),y(a,"a_polyindex"),a.O=!0,a.bk=0,a.dr=[0,0,0],a=!0);break;default:throw"Wrong batch type: "+a.type;}return a}function k(a,b){var c=b.game_settings;
switch(c.alpha_blend){case "ALPHA_SORT":a.P=!0;a.Xc=M.en;a.O=!0;break;case "ALPHA":a.P=!0;a.Xc=M.Ec;a.O=!0;break;case "CLIP":a.P=!1;a.Xc=M.Ec;a.O=!0;break;case "ADD":a.P=!0;a.Xc=M.Ec;a.O=!1;break;case "OPAQUE":a.P=!1;a.Xc=M.Ec;a.O=!0;break;default:throw Error("Unknown alpha blend mode: "+alpha_blend);}a.la=c.use_backface_culling}function l(a,b){var c=a.texture,d=c.d,c=c.image;d&&b&&c&&R.Wj(d,b,c.dc,c.filepath);return d}function s(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];!0==f[a]&&f.texture&&
f.texture.d&&c.push(f)}return c}function f(a,b){a.od=new Float32Array(4);var c=b.raytrace_transparency;a.od[0]=c.fresnel;a.od[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.Ql=c.reflect_factor;a.od[2]=c.fresnel;a.od[3]=1-c.fresnel_factor/5}function t(a,b){if(!b.use_nodes)return!1;var c=K.bu(b.node_tree,b.uuid);if(!c)return Q.error("Failed to create node graph for material "+b.name+", disable nodes"),A(a,b),!0;G(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;u(a,"ALPHA","OPAQUE"===
d?0:1);u(a,"ALPHA_CLIP","CLIP"===d?1:0);u(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);y(a,"a_position");k(a,b);a.je=b.offset_z;a.ya=new Float32Array([b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha]);a.Pe=b.emit;a.ad=b.ambient;f(a,b);b.b4w_wettable?u(a,"WETTABLE",1):u(a,"WETTABLE",0);a.vj=K.cu(c);H.S(c,function(c,d){switch(d.type){case "GEOMETRY_UV":var e=d.data.name,f=d.data.value;f?a.uf[f]=e:Q.error("Missing UV layer in node ",d.name,"for material ",b.name);break;
case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":e=d.data.name;if(f=d.data.value){a.Ka[e]={Re:!0,src:[{name:f}]};f=0;if("GEOMETRY_VC"==d.type)f=7;else for(var m=0;m<d.Ua.length;m++){var g="RGB".indexOf(d.Ua[m].identifier);-1<g&&(f|=1<<2-g)}a.Ka[e].src[0].ic=f}else Q.error("Missing vertex color layer in node ",d.name,"for material ",b.name);break;case "GEOMETRY_NO":y(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":e=d.data.value;u(a,"SHADED",1);y(a,"a_normal");
u(a,"DIFFUSE_SHADER","DIFFUSE_"+e.diffuse_shader);u(a,"SPECULAR_SHADER","SPECULAR_"+e.specular_shader);break;case "TEXTURE_COLOR":case "TEXTURE_COLOR2":case "TEXTURE_COLOR3":case "TEXTURE_ENVIRONMENT":case "PARALLAX":e=d.data.name;(f=d.data.value)?(!1!==f.d.pk&&(f.d.pk="TEXTURE_ENVIRONMENT"!=d.type?!0:!1),F(a,f.d,e)):Q.error("Missing texture in node ",d.name,"for material ",b.name);break;case "TEXTURE_NORMAL":case "TEXTURE_NORMAL2":case "TEXTURE_NORMAL3":u(a,"CALC_TBN_SPACE",1),y(a,"a_normal"),y(a,
"a_tangent"),e=d.data.name,(f=d.data.value)?(f.d.pk=!1,F(a,f.d,e)):Q.error("Missing texture in node ",d.name,"for material ",b.name)}});return!0}function A(a,b){G(a,"shadeless.glslv","shadeless.glslf");var c=b.game_settings.alpha_blend;u(a,"ALPHA","OPAQUE"===c?0:1);u(a,"ALPHA_CLIP","CLIP"===c?1:0);y(a,"a_position");a.ya=new Float32Array([1,0,1,1]);u(a,"VERTEX_COLOR",0);a.je=b.offset_z;k(a,b)}function D(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.mp?u(a,"AU_QUALIFIER","attribute"):u(a,"AU_QUALIFIER",
"uniform"),u(a,"STATIC_BATCH",0)):(u(a,"AU_QUALIFIER","attribute"),u(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(P.Vw()?u(a,"WIREFRAME_QUALITY",1):u(a,"WIREFRAME_QUALITY",0),a.Nk?(u(a,"DEBUG_SPHERE",1),a.ko?u(a,"DEBUG_SPHERE_DYNAMIC",1):u(a,"DEBUG_SPHERE_DYNAMIC",0)):u(a,"DEBUG_SPHERE",0),u(a,"ALPHA",1));b.Gd?(""!==b.fe?(a.Ka.a_bending_col_main={Re:!0,src:[{name:b.fe,ic:4}]},y(a,"a_bending_col_main"),""!==b.vb.yp&&""!==b.vb.xp&&""!==b.vb.Mp?(a.Ka.a_bending_col_detail={Re:!0,src:[{name:b.vb.yp,ic:4},
{name:b.vb.xp,ic:2},{name:b.vb.Mp,ic:1}]},y(a,"a_bending_col_detail"),y(a,"a_normal"),u(a,"DETAIL_BEND",1)):u(a,"DETAIL_BEND",0),u(a,"MAIN_BEND_COL",1)):u(a,"MAIN_BEND_COL",0),u(a,"WIND_BEND",1)):u(a,"WIND_BEND",0);b.zk?u(a,"BEND_CENTER_ONLY",1):u(a,"BEND_CENTER_ONLY",0);b.hh?u(a,"HAIR_BILLBOARD",1):u(a,"HAIR_BILLBOARD",0);!1===b.ix?u(a,"HAIR_BILLBOARD_SPHERICAL",0):u(a,"HAIR_BILLBOARD_SPHERICAL",1);switch(b.ml){case "RANDOM":u(a,"HAIR_BILLBOARD_RANDOM",1);u(a,"HAIR_BILLBOARD_JITTERED",0);break;case "JITTERED":u(a,
"HAIR_BILLBOARD_RANDOM",0);u(a,"HAIR_BILLBOARD_JITTERED",1);break;default:u(a,"HAIR_BILLBOARD_RANDOM",0),u(a,"HAIR_BILLBOARD_JITTERED",0)}b.ra?u(a,"DYNAMIC_GRASS",1):u(a,"DYNAMIC_GRASS",0);a.ra=b.ra;a.Oe=b.Oe;a.nc=b.nc;a.oc=b.oc;a.Ab=b.Ab;a.Pc=b.Pc;a.zc=b.zc;a.Oc=b.Oc;b.Rf?(y(a,"a_influence"),u(a,"SKINNED",1),b.yo?u(a,"FRAMES_BLENDING",1):u(a,"FRAMES_BLENDING",0),u(a,"MAX_BONES",b.Jb)):(u(a,"SKINNED",0),u(a,"FRAMES_BLENDING",0));b.Zj?u(a,"VERTEX_ANIM",1):u(a,"VERTEX_ANIM",0);if(b.Rf&&b.Zj)throw"Skinning and vertex animation are mutually exlusive";
b.Pk?u(a,"DISABLE_FOG",1):u(a,"DISABLE_FOG",0);b.Rd&&(a.Rd=b.Rd)}}function y(a,b){var c=a.gd;-1==c.indexOf(b)&&c.push(b)}function u(a,b,c){m.C(a.za,b,c)}function g(a,b){if("PHYSICS"==a.type)a.Bb=b;else{var c=a.Xc,d=a.ld;a.$o&&(b=M.Lv(b));a.br&&(b=L.mw(a.gB,a.hB,a.eB));c=M.uA(b,c,d,a.Ka);fa||a.Oe||c.ol||(delete c.de,delete c.xe);a.Sb=c;c=b.r.length;a.wj=b.D*c;a:switch(a.ld){case M.Cg:case M.li:case M.Um:d=!0;break a;default:d=!1}d?M.Hx(b)?a.Yf=b.ia.length/3*c:a.Yf=b.D/3*c:a.Yf=0;J&&(a.Bb=b)}}function E(a,
b,d,e,f,m,g,k,l,r,h,p){var t=[],s=k.b4w_dynamic_grass;if(!r&&s)return t;for(var B="INSTANCE"==k.b4w_wind_bend_inheritance,u="INSTANCE"==k.b4w_shadow_inheritance,A="INSTANCE"==k.b4w_reflection_inheritance,E=[],R=[],q=0;q<f.length;q++){var y=f[q],w=X.Di(b);w.hh=k.b4w_hair_billboard;w.ml=k.b4w_hair_billboard_type;w.ra=s;w.ix="SPHERICAL"==k.b4w_hair_billboard_geometry;w.mp=!0;B?(w.Gd=y.d.Gd,w.ak=y.d.ak,w.zf=y.d.zf,w.Ke=y.d.Ke,w.fe=y.d.fe,w.Je=y.d.Je,w.De=y.d.De,w.Hd=y.d.Hd,w.vb=y.d.vb,w.zk=!1):(w.Gd=
a.d.Gd,w.ak=a.d.ak,w.zf=a.d.zf,w.Ke=a.d.Ke,w.fe=a.d.fe,w.Je=a.d.Je,w.De=a.d.De,w.Hd=a.d.Hd,w.vb=a.d.vb,w.zk=!0);u?(w.nc=y.d.nc,w.oc=y.d.oc,w.Ab=y.d.Ab):(w.nc=a.d.nc,w.oc=a.d.oc,w.Ab=a.d.Ab);A?(w.Pc=y.d.Pc,w.zc=y.d.zc,w.Oc=y.d.Oc):(w.Pc=a.d.Pc,w.zc=a.d.zc,w.Oc=a.d.Oc);E.push(w);var x=g[q];x||(x=new Float32Array);p&&X.hj(l.seed,h);for(var L=new Float32Array(3),G=new Float32Array([0,0,0,1]),F=[],J=0;J<x.length;J+=4){L[0]=x[J];L[1]=x[J+1];L[2]=x[J+2];var K=x[J+3];if(k.b4w_initial_rand_rotation){switch(k.b4w_rotation_type){case "XYZ":var H=
new Float32Array([X.lc(h),X.lc(h),X.lc(h)]);Z.normalize(H,H);break;case "Z":H=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+k.b4w_rotation_type;}z.setAxisAngle(H,k.b4w_rand_rotation_strength*(2*Math.PI*X.lc(h)-Math.PI),G)}var O=U.He(L,K,G);F.push(O)}R.push(F)}for(var P={},q=0;q<f.length;q++){var ea=m[q],w=E[q],S=JSON.stringify(w),F=R[q];if(F.length)for(var fa=f[q].data,ka=fa.materials,J=0;J<ka.length;J++)if(!M.ap(fa,J))for(var da=0;da<ea.length;da++){var Ab=ea[da];
if("COLOR_ID"!==Ab){var ya=c(Ab),ac=ka[J];if(n(ya,ac,!0)){ya.ld=fa.ld||M.Cg;D(ya,w);ya.Fh=k.uuid;I(ya,S);"JITTERED"==k.b4w_hair_billboard_type&&(ya.ql=k.b4w_hair_billboard_jitter_amp,ya.rl=k.b4w_hair_billboard_jitter_freq);ya.ll=k.b4w_dynamic_grass_scale_threshold;B||(delete ya.Ka.a_bending_col_main,delete ya.Ka.a_bending_col_detail);var sc=M.so(fa,J,ya.gd,null,ya.Ka,ya.uf),Ra=[];if(w.Gd||w.ra||w.hh)Ra.au_wind_bending_amp=[w.Hd],Ra.au_wind_bending_freq=[w.zf],Ra.au_detail_bending_freq=[w.Ke],Ra.au_detail_bending_amp=
[w.Je],Ra.au_branch_bending_amp=[w.De];var bc=M.Xx(sc,Ra,F),Jb=bc,Cc=F;Jb.v.au_center_pos=new Float32Array(3*Jb.D);for(var Lc=Cc.length,Uc=Jb.D/Lc,Pb=0;Pb<Lc;Pb++)for(var ob=Cc[Pb],tc=3*Uc*Pb,mc=0;mc<Uc;mc++)Jb.v.au_center_pos[tc+3*mc]=ob[0],Jb.v.au_center_pos[tc+3*mc+1]=ob[1],Jb.v.au_center_pos[tc+3*mc+2]=ob[2];bc=Jb;if(w.zk){var pb=bc,nc=a.d.I;pb.v.a_emitter_center=new Float32Array(3*pb.D);var Wb=ha.fromValues(0,0,0,1);ha.transformMat4(Wb,nc,Wb);for(var Qb=0;Qb<pb.D;Qb++)pb.v.a_emitter_center[3*
Qb]=Wb[0],pb.v.a_emitter_center[3*Qb+1]=Wb[1],pb.v.a_emitter_center[3*Qb+2]=Wb[2];bc=pb}var Y=k.b4w_vcol_from_name,ab=k.b4w_vcol_to_name,Va=ya,ra=d,uc=!B,sa=fa,qb=[];if(""!==Y&&""!==ab){var rb,oa=ab,Ga=Va.Ka,kb=[],ma=void 0;for(ma in Ga)for(var Wa=Ga[ma].src,sb=0,pa=0;pa<Wa.length;pa++){var Oa=Wa[pa].ic;oa==Wa[pa].name&&kb.push(ma,Oa,sb);sb+=X.hf(Oa)}rb=kb;if(0<rb.length)for(var tb=0;tb<rb.length;tb+=3)qb.push({bh:Y,cj:7,zj:rb[tb],Aj:rb[tb+1],Wi:rb[tb+2]});else M.px(Va.gd,"a_color")&&ab==sa.active_vcol_name&&
qb.push({bh:Y,cj:7,zj:"a_color",Aj:7,Wi:0})}uc&&("a_bending_col_main"in ra.Ka&&qb.push({bh:"a_bending_col_main",cj:4,zj:"a_bending_col_main",Aj:4,Wi:0}),"a_bending_col_detail"in ra.Ka&&qb.push({bh:"a_bending_col_detail",cj:7,zj:"a_bending_col_detail",Aj:7,Wi:0}));for(var Kb=bc,cc=F,Bb=e,lb=qb,Dc=ya.Ka,vc=!1,bb=0;bb<lb.length;bb++){var dc=lb[bb].bh,Rb=Bb.v[dc];if(Rb&&0<Rb.length){vc=!0;break}}if(vc){var ub,Sa=a.d.Rb,Xa=Bb.r[0].a_position,mb=cc,ja=P,cb=new Float32Array(3),C=new Float32Array(3),Cb=new Uint32Array(mb.length);
if(!("verts_indices"in ja)){ja.fd=new Float32Array(3);ja.bd=new Float32Array(3);ja.Em=new Uint32Array(Xa.length/3);ja.Eh=new Uint32Array(Xa.length/3);ja.fd[0]=(Sa.V-Sa.R)/ga;ja.fd[1]=(Sa.G-Sa.B)/ga;ja.fd[2]=(Sa.ja-Sa.pa)/ga;ja.bd[0]=Sa.R;ja.bd[1]=Sa.B;ja.bd[2]=Sa.pa;for(var za=0;za<Xa.length/3;za++){var Za=X.Dc((Xa[3*za]-ja.bd[0])/ja.fd[0]),Db=X.Dc((Xa[3*za+1]-ja.bd[1])/ja.fd[1]),W=X.Dc((Xa[3*za+2]-ja.bd[2])/ja.fd[2]),Za=X.$a(Za,0,ga-1),Db=X.$a(Db,0,ga-1),W=X.$a(W,0,ga-1);ja.Em[za]=za;ja.Eh[za]=W*
Math.pow(ga,2)+Db*ga+Za}M.bA(ja.Eh,ja.Em,1);ja.vf=new Uint32Array(Math.pow(ga,3));for(za=0;za<ja.Eh.length;za++)ja.vf[ja.Eh[za]]++;delete ja.Eh;for(za=1;za<ja.vf.length;za++)ja.vf[za]+=ja.vf[za-1]}for(var Pa=0;Pa<mb.length;Pa++){cb[0]=mb[Pa][0];cb[1]=mb[Pa][1];cb[2]=mb[Pa][2];for(var db=1E10,eb=-1,Xb=X.Dc((cb[0]-ja.bd[0])/ja.fd[0]),Eb=X.Dc((cb[1]-ja.bd[1])/ja.fd[1]),Ca=X.Dc((cb[2]-ja.bd[2])/ja.fd[2]),Xb=X.$a(Xb,0,ga-1),Eb=X.$a(Eb,0,ga-1),Ca=X.$a(Ca,0,ga-1),Lb=Ca*Math.pow(ga,2)+Eb*ga+Xb,ec=ja.vf[Lb],
Qa=0==Lb?0:ja.vf[Lb-1];Qa<ec;Qa++){var Yb=ja.Em[Qa];C[0]=Xa[3*Yb];C[1]=Xa[3*Yb+1];C[2]=Xa[3*Yb+2];Z.sub(C,cb,C);var oc=Z.sqrLen(C);oc<=db&&(db=oc,eb=Yb)}if(-1==eb)for(Qa=0;Qa<Xa.length/3;Qa++)C[0]=Xa[3*Qa],C[1]=Xa[3*Qa+1],C[2]=Xa[3*Qa+2],Z.sub(C,cb,C),oc=Z.sqrLen(C),oc<=db&&(db=oc,eb=Qa);Cb[Pa]=eb}ub=Cb;for(var wa=Kb.D/cc.length,bb=0;bb<lb.length;bb++){var na=lb[bb].zj,wc=lb[bb].Aj,dc=lb[bb].bh,Vc=lb[bb].cj,Rb=Bb.v[dc];switch(na){case "a_bending_col_main":var Fb=1;break;case "a_bending_col_detail":Fb=
3;break;case "a_color":Fb=3;break;default:for(var nb=Fb=0;nb<Dc[na].src.length;nb++)Fb+=X.hf(Dc[na].src[nb].ic)}if(Rb&&0<Rb.length){var Mb=X.hf(Vc),fc=X.hf(wc),pc=Vc&wc,Gb=X.gq(pc);pc!=wc&&Q.error("Wrong color extraction from "+dc+" to "+na+".");if("a_bending_col_main"==na||"a_bending_col_detail"==na)Kb.v[na]=new Float32Array(Kb.D*fc);for(nb=0;nb<cc.length;nb++){var Ec=ub[nb],Fc=Ec*Mb,Wc=nb*wa*Fb;if(-1!=Ec)for(var Hb=0;Hb<wa;Hb++)for(var vb=Hb*Fb,Sb=0;Sb<Gb.length;Sb++)Gb[Sb]&&(Kb.v[na][Wc+vb+(lb[bb].Wi+
X.Rh(wc,Sb))]=Rb[Fc+X.Rh(Vc,Sb)])}}else Kb.v[na]=new Float32Array(0)}}bc=Kb;-1==ya.ob.indexOf(ac.name)&&ya.ob.push(ac.name);t.push({m:ya,Bb:bc,Ac:w,Qc:[a]})}}}}return t}function I(a,b){delete a.id;var c={},d;for(d in a)c[d]=a[d]&&"object"==typeof a[d]?X.Cx(a[d])?a[d]:a[d]instanceof Array&&a[d][0]&&"object"==typeof a[d][0]?["NA"]:a[d]instanceof Array?a[d]:{N:"A"}:a[d];c.za=a.za;c.vj=a.vj;c.Ka=a.Ka;c.uf=a.uf;c.Pa=[];for(d=0;d<a.Pa.length;d++)c.Pa.push(R.xt(a.Pa[d]));a.id=JSON.stringify(c)+b}function w(a,
b,d,e){var f=c("WIREFRAME");G(f,"wireframe.glslv","wireframe.glslf");f.bk=0;f.Nk=!0;f.O=!0;f.Fh=d;e?(d=L.Bo(1,a.J),M.hz(d,[a.Nd[0],a.Od[1],a.Pd[2]],a.J)):d=L.Bo(a.ua,a.J);M.Lq(d,1,!0);d.v.a_polyindex=M.Mv(d);g(f,d);I(f,JSON.stringify(b));return f}function G(a,b,c){a.za={fa:b,ea:c,Y:[]};m.zz(a.za)}function F(a,b,c){1==a.Pa.length&&0==a.$b.length&&a.$b.push("default0");c=c||"default"+String(a.Pa.length);-1==a.$b.indexOf(c)&&(a.Pa.push(b),a.$b.push(c))}function x(a){if(!a.za)throw"No shaders info for batch "+
a.name;a.mc=m.el(a.za,a.vj)}var O=q("__boundings"),S=q("__config"),Q=q("__print"),P=q("__extensions"),M=q("__geometry"),H=q("__graph"),K=q("__nodemat"),B=q("__particles"),L=q("__primitives"),r=q("__scenegraph"),m=q("__shaders"),R=q("__textures"),U=q("__tsr"),X=q("__util"),Z=q("vec3"),ha=q("vec4"),z=q("quat"),ea=S.s,ka=S.fg,J=!1,fa=!1,da=["MAIN","NODES","SHADELESS"],ga=20;a.lw=function(a,c,f){for(var m=[],k=[],l=0;l<f.length;l++){var r=f[l];switch(r.d.type){case "DYNAMIC":m.push(r);break;case "STATIC":k.push(r)}}f=
[];for(l=0;l<m.length;l++){var r=m[l],p=r.d,n=h(r.data.b4w_bounding_box);p.Rb=n;var t=r.data.b4w_bounding_cylinder_radius,s=p,B=t,u=n;s.lt=O.su(B,u);s.yk=O.qu(t,u);s.kt=O.ru(B,u);n=O.zi(n,p.I);p.cd=n;n={ua:r.data.b4w_bounding_sphere_radius,J:r.data.b4w_bounding_sphere_center};p.dd=n;n=O.Dk(n,p.I);p.ed=n;n=r.data.b4w_bounding_ellipsoid_axes;n={Nd:new Float32Array([n[0],0,0]),Od:new Float32Array([0,n[1],0]),Pd:new Float32Array([0,0,n[2]]),J:r.data.b4w_bounding_ellipsoid_center};p.vi=n;n=O.Ck(n,p.rg);
p.wi=n;r=b(r,p,a);r=e(r);f.push.apply(f,r)}for(var A,m=[],l=[],r={},p=0;p<k.length;p++)s=k[p],B=s.d,n={},n.nc=B.nc,n.oc=B.oc,n.Ab=B.Ab,n.oe=B.oe,n.Il=B.Il,n.il=B.il,n.Pc=B.Pc,n.zc=B.zc,n.Oc=B.Oc,n.Ff=B.Ff,n.Gd=B.Gd,n.fe=B.fe,n.vb=B.vb,n.hh=B.hh,n.ml=B.ml,n.ra=B.ra,n.Ui=B.Ui,n.Pk=B.Pk,n.Oe=B.Oe,n.IC=0==c?[0,0]:[Math.floor(B.e[0]/c),Math.floor(B.e[2]/c)],n.Uf=B.Uf,n.vh=B.vh,n=JSON.stringify(n),r[n]=r[n]||[],r[n].push(s);for(A in r){n=JSON.parse(A);c=r[A];var k=X.Ji("STATIC"),z;for(z in n)k[z]=n[z];
k.Hd=0;k.zf=0;k.Ke=0;k.Je=0;k.De=0;k.gj=!1;for(p=0;p<c.length;p++){var n=c[p],s=h(n.data.b4w_bounding_box),B=O.zi(s,n.d.I),t={ua:n.data.b4w_bounding_sphere_radius,J:n.data.b4w_bounding_sphere_center},u=O.Dk(t,n.d.I),E=n.data.b4w_bounding_ellipsoid_axes,E={Nd:new Float32Array([E[0],0,0]),Od:new Float32Array([0,E[1],0]),Pd:new Float32Array([0,0,E[2]]),J:n.data.b4w_bounding_ellipsoid_center},R=O.Ck(E,k.rg);n.d.Rb=s;n.d.cd=B;n.d.dd=t;n.d.ed=u;n.d.vi=E;n.d.wi=R;0==p?(k.cd=X.Fa(B),k.ed=X.Fa(u),k.vi=X.Fa(E),
k.wi=X.Fa(R)):(O.po(k.cd,B),O.Iv(k.ed,u))}k.Rb=X.Fa(k.cd);k.dd=X.Fa(k.ed);l.push({Ac:k,Wb:c})}for(A=0;A<l.length;A++){z=l[A].Ac;c=l[A].Wb;for(k=0;k<c.length;k++){s=c[k];r=b(s,z,a);p=U.He(s.d.e,s.d.scale,s.d.h)||U.He(z.e,z.scale,z.h);n={};z.Gd&&(n.au_center_pos=[p[0],p[1],p[2]],n.au_wind_bending_amp=[s.d.Hd],n.au_wind_bending_freq=[s.b4w_wind_bending_freq],n.au_detail_bending_amp=[s.b4w_detail_bending_amp],n.au_detail_bending_freq=[s.b4w_detail_bending_freq],n.au_branch_bending_amp=[s.b4w_branch_bending_amp]);
for(s=0;s<r.length;s++)B=r[s].Ac,t=r[s].Bb,B.mp?B.hh?M.sA(t,p):M.Kq(t,p):(t=M.Kq(t,p),M.rA(t,n));m.push.apply(m,r)}for(k=0;k<c.length;k++)s=c[k],s.gn=s.d,s.d=z}A=e(m);for(l=0;l<f.length;l++)g(f[l].m,f[l].Bb);for(l=0;l<A.length;l++)g(A[l].m,A[l].Bb);a=[];for(l=0;l<A.length;l++)z=A[l].m,"COLOR_ID"!==z.type&&(m=X.zx(X.ym("%meta")),m.d=A[l].Ac,m.aa=[z],a.push(m));d(A,["COLOR_ID"]);d(f);if(ea.ki){for(l=0;l<f.length;l++)r=f[l].Qc[0],A=f[l].Ac,-1<da.indexOf(f[l].m.type)&&(z=w(A.vi,A,r.name,!0),z.ko=!0,D(z,
A),r.aa.push(z));for(l=0;l<a.length;l++)r=a[l],A=r.d,-1<da.indexOf(r.aa[0].type)&&(z=w(A.dd,A,r.name,!1),z.ko=!1,D(z,A),r.aa.push(z))}return a};a.iB=function(a,b,c){if(b)b=c*(b.G-b.B);else throw"No bounding box for mesh";return 0==b?0:0.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.it=h;a.DD=n;a.sk=function(a,b){u(a,"CSM_SECTION0",0);u(a,"CSM_SECTION1",0);u(a,"CSM_SECTION2",0);u(a,"CSM_SECTION3",0);for(var c=0;c<b.length;c++)u(a,"CSM_SECTION"+String(c),1),u(a,"CSM_SECTION_DIST"+
String(c),b[c]);u(a,"PCF_TEXEL_SIZE",1/ka.zd)};a.qa=u;a.eb=function(a,b){return m.Ew(a.za,b)};a.si=F;a.cz=function(a,b,c){c=a.$b.indexOf(c);-1<c&&(a.Pa[c]=b)};a.Ru=function(a,b){var d=c("SHADELESS");G(d,"shadeless.glslv","shadeless.glslf");x(d);d.P=!0;d.ya=new Float32Array([b[0],b[1],b[2],0.5]);d.O=!1;d.Xc=M.Ec;d.O=!0;d.ld=M.li;g(d,a);return d};a.Cb=x;a.Ht=function(a){return(a=a.mc.Ih)?a.u_cube_fog?!0:!1:!1};a.dj=function(a,b,d){var e=c("DEPTH");e.P=!1;G(e,"depth.glslv","depth.glslf");var f=e.za;
m.xx(f,a.za);m.C(f,"SHADOW_SRC",b);m.C(f,"SHADOW_DST",d);e.la=a.la;e.Vc=a.Vc;e.ra=a.ra;e.Sb=a.Sb;e.id=a.id;a.Pa.length&&(e.Pa[0]=a.Pa[0],e.$b[0]=a.$b[0]);e.wc=a.wc;e.gd=a.gd;e.ql=a.ql;e.rl=a.rl;e.ll=a.ll;e.Yf=a.Yf;e.wj=a.wj;e.Fh=a.Fh;for(b=0;b<a.ob.length;b++)e.ob.push(a.ob[b]);e.Bj=a.Bj;a.tb||(a.tb=[]);a.tb.push(e);return e};a.yu=function(){var a=c("DEPTH_PACK");G(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");x(a);a.la=!0;a.P=!1;a.O=!1;var b=L.Ha();g(a,b);return a};a.Eu=
function(){var a=c("HUD");G(a,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");x(a);a.la=!0;a.P=!0;a.Xc=M.Ec;a.O=!1;a.$=new Float32Array([0,0]);a.ka=new Float32Array([1,1]);a.Oa=1;var b=L.Ha();g(a,b);return a};a.bo=function(a){var b=c("POSTPROCESSING");G(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":u(b,"POST_EFFECT","POST_EFFECT_NONE");b.ka=new Float32Array([1,1]);break;case "GRAYSCALE":u(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");
b.ka=new Float32Array([1,1]);break;case "X_BLUR":u(b,"POST_EFFECT","POST_EFFECT_X_BLUR");b.ka=new Float32Array([1,0]);break;case "Y_BLUR":u(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");b.ka=new Float32Array([0,1]);break;case "X_EXTEND":u(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");b.ka=new Float32Array([1,0]);break;case "Y_EXTEND":u(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");b.ka=new Float32Array([0,1]);break;default:throw"Wrong postprocessing effect: "+a;}x(b);b.$=new Float32Array([0,0]);b.Oa=1;b.la=!0;b.P=!1;
b.O=!1;a=L.Ha();g(b,a);return b};a.aC=function(){var a=c("EDGE");G(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");x(a);a.O=!1;a.la=!0;a.$=new Float32Array([0,0]);a.ka=new Float32Array([1,1]);a.Oa=1;var b=L.Ha();g(a,b);return a};a.Vu=function(a){var b=c("SSAO");G(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");u(b,"SSAO_QUALITY","SSAO_QUALITY_"+a);x(b);b.O=!1;b.la=!0;b.$=new Float32Array([0,0]);b.ka=new Float32Array([1,1]);b.Oa=1;a=L.Ha();g(b,a);return b};
a.zu=function(){var a=c("DOF");G(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");u(a,"DEPTH_RGBA",1);x(a);a.O=!1;a.la=!0;a.$=new Float32Array([0,0]);a.ka=new Float32Array([1,1]);a.Oa=1;var b=L.Ha();g(a,b);return a};a.Bu=function(){var a=c("GLOW");G(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");x(a);a.O=!1;a.la=!0;a.$=new Float32Array([0,0]);a.ka=new Float32Array([1,1]);a.Oa=1;var b=L.Ha();g(a,b);return a};a.Cu=function(a,b,d){var e=c("GOD_RAYS");G(e,"postprocessing/god_rays.glslv",
"postprocessing/god_rays.glslf");u(e,"DEPTH_RGBA",a);u(e,"WATER_EFFECTS",b);u(e,"STEPS_PER_PASS",m.u(d,1));x(e);e.O=!1;e.la=!0;e.$=new Float32Array([0,0]);e.ka=new Float32Array([1,1]);e.Oa=1;a=L.Ha();g(e,a);return e};a.Du=function(){var a=c("GOD_RAYS_COM");G(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");x(a);a.O=!1;a.la=!0;a.$=new Float32Array([0,0]);a.ka=new Float32Array([1,1]);a.Oa=1;var b=L.Ha();g(a,b);return a};a.Su=function(){var a=c("SKY");G(a,"procedural_skydome.glslv",
"procedural_skydome.glslf");u(a,"NUM_LIGHTS",1);u(a,"WATER_EFFECTS",1);x(a);a.O=!1;a.la=!0;a.$=new Float32Array([0,0]);a.ka=new Float32Array([1,1]);a.Oa=1;var b=L.gw();g(a,b);return a};a.pu=function(a){var b=c("BLUR_DEPTH");G(b,"postprocessing/postprocessing.glslv","postprocessing/blur_depth.glslf");x(b);b.O=!1;b.la=!0;b.$=new Float32Array([0,0]);b.ka=new Float32Array("X"===a?[1,0]:[0,1]);b.Oa=1;a=L.Ha();g(b,a);return b};a.lu=function(){var a=c("ANTIALIASING");G(a,"postprocessing/postprocessing.glslv",
"postprocessing/antialiasing.glslf");u(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");x(a);a.O=!1;a.la=!0;a.$=new Float32Array([0,0]);a.ka=new Float32Array([1,1]);a.Oa=1/ea.Mb;var b=L.Ha();g(a,b);return a};a.Tu=function(a){var b=c("SMAA");G(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");u(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");u(b,"SMAA_PASS",a);u(b,"SMAA_REPROJECTION",1);u(b,"SMAA_PREDICATION",0);x(b);b.O=!1;b.la=!0;b.$=new Float32Array([0,0]);b.ka=new Float32Array([1,1]);b.Oa=1/ea.Mb;a=L.Ha();
g(b,a);return b};a.Fu=function(a){var b=c("LANCZOS");G(b,"postprocessing/postprocessing.glslv","postprocessing/lanczos.glslf");x(b);b.O=!1;b.la=!0;b.$=new Float32Array([0,0]);b.Oa=1/ea.Mb;"LANCZOS_X"==a?b.ka=new Float32Array([1,0]):"LANCZOS_Y"==a&&(b.ka=new Float32Array([0,1]));a=L.Ha();g(b,a);return b};a.vu=function(){var a=c("COMPOSITING");G(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");x(a);a.O=!1;a.la=!0;a.$=new Float32Array([0,0]);a.ka=new Float32Array([1,1]);a.Oa=
1;var b=L.Ha();g(a,b);return a};a.Iu=function(a){var b=c("MOTION_BLUR");G(b,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");u(b,"BLUR_DECAY_THRESHOLD",m.u(a));x(b);b.la=!0;b.P=!1;b.O=!1;a=L.Ha();g(b,a);return b};a.ku=function(){var a=c("ANAGLYPH");G(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");x(a);a.la=!0;a.P=!1;a.O=!1;var b=L.Ha();g(a,b);return a};a.bC=function(){var a=c("MAIN");G(a,"line.glslv","line.glslf");u(a,"NUM_POINTS",2);x(a);a.la=!1;
a.P=!1;a.O=!1;a.ya=new Float32Array([0,1,0,1]);a.ld=M.Vm;a.Qx=new Float32Array([0,0,0,1,1,1]);var b=L.kw();g(a,b);return a};a.Gu=function(){var a=c("LUMINANCE");G(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");x(a);a.O=!1;a.la=!0;a.$=new Float32Array([0,0]);a.ka=new Float32Array([1,1]);a.Oa=1;var b=L.Ha();g(a,b);return a};a.mu=function(){var a=c("LUMINANCE");G(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");x(a);a.O=!1;a.la=!0;a.$=new Float32Array([0,
0]);a.ka=new Float32Array([1,1]);a.Oa=1;var b=L.Ha();g(a,b);return a};a.Hu=function(){var a=c("LUMINANCE_X_BLUR");G(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");x(a);a.O=!1;a.la=!0;a.$=new Float32Array([0,0]);a.ka=new Float32Array([1,1]);a.Oa=1;var b=L.Ha();g(a,b);return a};a.nu=function(a){var b=c("POSTPROCESSING");G(b,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");switch(a){case "X_BLUR":b.ka=new Float32Array([1,0]);break;case "Y_BLUR":b.ka=
new Float32Array([0,1]);break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}x(b);b.$=new Float32Array([0,0]);b.Oa=1;b.la=!0;b.P=!1;b.O=!1;a=L.Ha();g(b,a);return b};a.ou=function(){var a=c("BLOOM");G(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");x(a);a.O=!1;a.la=!0;a.$=new Float32Array([0,0]);a.ka=new Float32Array([1,1]);a.Oa=1;var b=L.Ha();g(a,b);return a};a.bv=function(){var a=c("VELOCITY");G(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");
x(a);a.O=!1;a.la=!0;a.$=new Float32Array([0,0]);a.ka=new Float32Array([1,1]);a.Oa=1;var b=L.Ha();g(a,b);return a};a.Vh=function(a,b,c){var d=a.Oa;a.$[0]=b*a.ka[0]*d;a.$[1]=c*a.ka[1]*d};a.yd=function(a,b){a.Oa=b};a.L=function(a,b,c){a=a.aa;for(var d=null,e=0;e<a.length;e++){var f=a[e];if(-1<f.ob.indexOf(b)&&(c&&f.type==c||!c)){if(f.tb)return f;d=null===d?f:d}}return d};a.Tt=function(a){for(var b=a.Pa,c=0;c<b.length;c++)R.pv(b[c].Wa);M.St(a.Sb)}};b4w.module.__nodemat=function(a,q){function c(a){var b=!1,c=!1;F.S(a,function(a,d){if("MATERIAL"==d.type||"MATERIAL_EXT"==d.type)c=!0;"TEXTURE_NORMAL"==d.type&&(b=!0)});return b&&!c?!1:!0}function b(a){F.S(a,function(b,c){for(var d=c.U,f=c.Ua,g=0;g<d.length;g++)e(a,d[g],b,g,1);for(g=0;g<f.length;g++)e(a,f[g],b,g,0)})}function e(a,b,c,d,e){if(b.sd){var f=!0;F.sf(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&g[1]==d)f=!1});f&&(b.sd=!1)}}function d(a){var b=[];F.S(a,function(c,d){switch(d.type){case "TRANSLUCENCY":F.sf(a,
function(a,e,f){a==c&&"Translucency"==d.Ua[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)F.Ld(a,b[c],b[c+1],b[c+2])}function h(a,b){var c=[];F.S(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function p(a){var b=[];F.S(a,function(a,c){"REPLACE"==c.type&&b.push(a,c);"PARALLAX"==c.type&&b.push(a,c);"REROUTE"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("REPLACE"==e.type){var f=F.Se(a,d,0),g=F.Se(a,d,1),
e=F.qd(a,f,d,0),k=F.qd(a,g,d,0);F.vd(a,f,d,-1);F.vd(a,g,d,-1);if(1==e[1])var g=f,l=e[0];else l=k[0];e=[];for(k=0;k<F.cf(a,d);k++){var h=F.Te(a,d,k),p=F.qd(a,d,h,0)[1];F.Ld(a,g,h,[l,p]);e.push(d,h)}for(k=0;k<e.length;k+=2)F.vd(a,e[k],e[k+1],-1)}else if("PARALLAX"==e.type)g=F.Se(a,d,1),-1!=g&&(k=F.Se(a,g,0),F.vd(a,g,d,-1),-1!=k&&F.vd(a,k,g,-1),d=F.Sa(a,g),e.data=d.data,e.wb[0]=d.wb[0],F.cg(a,g)),e.U.splice(1,1);else if("REROUTE"==e.type){for(var g=F.Se(a,d,0),l=F.cf(a,d),e=[],f=[],n=[],k=0;k<l;k++)h=
F.Te(a,d,k),p=f.indexOf(h),-1!=p?n[p]+=1:(f.push(h),n.push(1),e.push(d,h));if(-1!=g)for(l=F.qd(a,g,d,0)[0],k=0;k<f.length;k++)for(h=0;h<n[k];h++)p=F.qd(a,d,f[k],h)[1],F.Ld(a,g,f[k],[l,p]);for(k=0;k<e.length;k+=2)F.vd(a,e[k],e[k+1],-1)}}}function n(a){var b=[];F.S(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,k=0;k<
c.length;k++){var h=c[k];if(l(f,h.Ea)){g=[];k=F.cf(a,e);for(t=0;t<k;t++){var p=F.Te(a,e,t),n=F.qd(a,e,p,0);g.push(e,p,n);F.Ld(a,h.id,p,n)}for(var t=0;t<g.length;t+=3)F.vd(a,g[t],g[t+1],0);F.cg(a,e);g=!1;break}}g&&(h={id:e,Ea:f},c.push(h))}}function k(a){var b=[];F.S(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,k=0;k<c.length;k++){var h=c[k];if(!(2<=h.qj.length)&&l(f,h.Ea)){for(var k=[],p=F.gp(a,e),g=
{},n=0;n<p;n++){var t=F.Se(a,e,n);t in g||(g[t]=0);var s=F.qd(a,t,e,g[t]++);k.push(t,e,s)}for(var p=[],g=F.cf(a,e),u={},n=0;n<g;n++)t=F.Te(a,e,n),t in u||(u[t]=0),s=F.qd(a,e,t,u[t]++),p.push(e,t,s);for(var g=k.concat(p),n=0;n<g.length;n+=3)F.vd(a,g[n],g[n+1],0);F.cg(a,e);n={Ea:f,Ev:k,Fv:p};h.qj.push(n);g=!1;break}}g&&(h={id:e,Ea:f,qj:[]},c.push(h))}for(d=0;d<c.length;d++){h=c[d];e=h.qj.length;p=h.Ea.U.length;g=h.Ea.Ua.length;for(k=0;k<e;k++){s=h.qj[k];n=s.Ea;f=s.Ev;u=s.Fv;h.Ea.U=h.Ea.U.concat(n.U);
h.Ea.Ua=h.Ea.Ua.concat(n.Ua);for(n=0;n<h.Ea.U.length;n++)h.Ea.U[n].identifier+=O.Dc(n/p)+1;for(n=0;n<h.Ea.Ua.length;n++)h.Ea.Ua[n].identifier+=O.Dc(n/g)+1;for(n=0;n<f.length;n+=3)t=f[n],s=f[n+2],s[1]+=(k+1)*p,F.Ld(a,t,h.id,s);for(n=0;n<u.length;n+=3)t=u[n+1],s=u[n+2],s[0]+=(k+1)*g,F.Ld(a,h.id,t,s)}switch(e){case 1:h.Ea.type+="2";break;case 2:h.Ea.type+="3"}F.cg(a,h.id);F.rn(a,h.id,h.Ea)}}function l(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==
b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function s(a){var b=[];F.S(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],k=[],l=[[],[],[]],h=F.cf(a,d),n=0;n<h;n++){var p=F.Te(a,d,n);if("SEPRGB"!=F.Sa(a,p).type){f=!1;break}g.push(d,p);for(var t={},s=F.cf(a,p),f=0;f<s;f++){var u=F.Te(a,p,
f);u in t||(t[u]=0);var A=F.qd(a,p,u,t[u]++);g.push(p,u);l[A[0]].push(d,u,A)}k.push(p);f=!0}if(f){for(n=d=h=0;n<l.length;n++)l[n].length&&(h++,d|=1<<2-n);if(h){e.type+=h;e.Ua=[];for(n=0;n<l.length;n++)if(l[n].length)for(e.Ua.push({ub:0,identifier:"RGB"[n],sd:!0,name:"RGB"[n]}),f=0;f<l[n].length;f+=3)l[n][f+2][0]=O.Rh(d,n);for(n=0;n<g.length;n+=2)F.vd(a,g[n],g[n+1],0);for(n=0;n<k.length;n++)F.cg(a,k[n]);for(n=0;n<l.length;n++)for(f=0;f<l[n].length;f+=3)F.Ld(a,l[n][f],l[n][f+1],l[n][f+2])}}}}function f(a,
b,c){var d=b.name,e=b.type,k=[],l=[],h=[],n=[],p=null;switch(e){case "CAMERA":l=[];h=I(b);break;case "COMBRGB":l=E(b);h=I(b);break;case "GEOMETRY":a:{for(var e=b.outputs,s=0;s<e.length;s++)if(e[s].is_linked){e=!0;break a}e=!1}if(!e)return!0;e=A(b,c);if(!e)return G.error("Geometry output is not supported"),!1;switch(e){case "GEOMETRY_UV":p=t("param_GEOMETRY_UV_a");s=t("param_GEOMETRY_UV_v");k.push(w(p));k.push(w(s));h.push(y(b,"UV"));n.push(w(s));p={name:p,value:b.uv_layer};break;case "GEOMETRY_VC":p=
t("param_GEOMETRY_VC_a");s=t("param_GEOMETRY_VC_v");k.push(w(p));k.push(w(s));h.push(y(b,"Vertex Color"));n.push(w(s));p={name:p,value:b.color_layer};break;case "GEOMETRY_NO":h.push(y(b,"Normal"));break;case "GEOMETRY_FB":h.push(y(b,"Front/Back"));break;case "GEOMETRY_VW":h.push(y(b,"View"));break;case "GEOMETRY_GL":h.push(y(b,"Global"))}break;case "GROUP":s=b.node_tree_name.replace(/\.[0-9]{3,}$/g,"");switch(s){case "LINEAR_TO_SRGB":e="LINEAR_TO_SRGB";break;case "NORMAL_VIEW":e="NORMAL_VIEW";break;
case "REPLACE":e="REPLACE";break;case "SRGB_TO_LINEAR":e="SRGB_TO_LINEAR";break;case "REFLECT":e="REFLECT";break;case "PARALLAX":var e="PARALLAX",u=t("temp_texture");n.push(w(u));break;case "CLAMP":e="CLAMP";break;case "TRANSLUCENCY":e="TRANSLUCENCY";break;case "TIME":e="TIME";break;default:return G.error("Wrong group node: "+b.node_tree_name),!1}l=E(b);h=I(b);"TRANSLUCENCY"==s&&(s=g("TranslucencyParams","TranslucencyParams",[0,0,0,0]),s.sd=h[0].sd,h.push(s));break;case "NORMAL":l=E(b);h=I(b);s=y(b,
"Normal");n.push(w(t("param_NORMAL_Normal"),s.ub,3));break;case "MAPPING":l.push(D(b,"Vector"));h.push(y(b,"Vector"));if(0!=S.length(b.translation)||0!=S.length(b.rotation)||b.use_max||b.use_min){var e="MAPPING_HEAVY",q=b.rotation,s=Q.create(),u=Math.cos(q[0]),x=Math.cos(q[1]),H=Math.cos(q[2]),M=Math.sin(q[0]),ga=Math.sin(q[1]),q=Math.sin(q[2]),v=u*H,T=u*q,ua=M*H,va=M*q;s[0]=x*H;s[1]=x*q;s[2]=-ga;s[3]=ga*ua-T;s[4]=ga*va+v;s[5]=x*M;s[6]=ga*v+va;s[7]=ga*T-ua;s[8]=x*u;u=b.scale;x=new Float32Array([u[0],
0,0,0,u[1],0,0,0,u[2]]);u=Q.create();Q.multiply(s,x,u);s=b.translation;u=O.Yx(u,P.create());u[12]=s[0];u[13]=s[1];u[14]=s[2];n.push(w(t("param_MAPPING_HEAVY_trs_matrix"),u,16));n.push(w(t("param_MAPPING_HEAVY_use_min"),~~b.use_min,1));n.push(w(t("param_MAPPING_HEAVY_use_max"),~~b.use_max,1));n.push(w(t("param_MAPPING_LIGHT_min_clip"),b.min,3));n.push(w(t("param_MAPPING_LIGHT_max_clip"),b.max,3))}else e="MAPPING_LIGHT",n.push(w(t("param_MAPPING_LIGHT_scale"),b.scale,3));break;case "MATERIAL":case "MATERIAL_EXT":p=
b.material;if(!p)return G.error("Emtpy material slot in node: "+b.name),!1;H=D(b,"Color");H.ub.splice(3);l.push(H);(H=D(b,"Alpha"))?l.push(H):l.push(g("Alpha","Alpha",1));H=D(b,"Spec");H.ub.splice(3);l.push(H);M=D(b,"Normal");M.ub.splice(3);l.push(M);h.push(y(b,"Color"));h.push(y(b,"Alpha"));h.push(y(b,"Normal"));"MATERIAL_EXT"==e&&((H=D(b,"Emit"))?l.push(H):l.push(g("Emit","Emit",0)),H=D(b,"Translucency"),H.ub=0,H.name="Translucency",H.identifier="Translucency",H?l.push(H):l.push(g(H.name,H.identifier,
H.ub)),H=D(b,"Translucency"),H.ub=[0,0,0,0],H.name="TranslucencyParams",H.identifier="TranslucencyParams",H?l.push(H):l.push(g(H.name,H.identifier,H.ub)),h.push(y(b,"Diffuse")),h.push(y(b,"Spec")));switch(p.specular_shader){case "COOKTORR":case "PHONG":s=p.specular_hardness;break;case "WARDISO":s=p.specular_slope}switch(p.diffuse_shader){case "LAMBERT":x=u=0;break;case "OREN_NAYAR":u=p.roughness;x=0;break;case "FRESNEL":u=p.diffuse_fresnel,x=p.diffuse_fresnel_factor}n.push(w(t("param_MATERIAL_diffuse"),
[b.use_diffuse?1:0,u,x],3));n.push(w(t("param_MATERIAL_spec"),[b.use_specular?1:0,p.specular_intensity,s],3));n.push(w(t("param_MATERIAL_norm"),M.sd?1:0,1));p={name:b.name,value:p};break;case "MATH":switch(b.operation){case "ADD":e="MATH_ADD";break;case "SUBTRACT":e="MATH_SUBTRACT";break;case "MULTIPLY":e="MATH_MULTIPLY";break;case "DIVIDE":e="MATH_DIVIDE";break;case "SINE":e="MATH_SINE";break;case "COSINE":e="MATH_COSINE";break;case "TANGENT":e="MATH_TANGENT";break;case "ARCSINE":e="MATH_ARCSINE";
break;case "ARCCOSINE":e="MATH_ARCCOSINE";break;case "ARCTANGENT":e="MATH_ARCTANGENT";break;case "POWER":e="MATH_POWER";break;case "LOGARITHM":e="MATH_LOGARITHM";break;case "MINIMUM":e="MATH_MINIMUM";break;case "MAXIMUM":e="MATH_MAXIMUM";break;case "ROUND":e="MATH_ROUND";break;case "LESS_THAN":e="MATH_LESS_THAN";break;case "GREATER_THAN":e="MATH_GREATER_THAN";break;case "MODULO":e="MATH_MODULO";break;default:return G.error("Unsupported MATH operation: "+b.operation),!1}l=E(b);h=I(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":e=
"MIX_RGB_MIX";break;case "ADD":e="MIX_RGB_ADD";break;case "MULTIPLY":e="MIX_RGB_MULTIPLY";break;case "SUBTRACT":e="MIX_RGB_SUBTRACT";break;case "SCREEN":e="MIX_RGB_SCREEN";break;case "DIVIDE":e="MIX_RGB_DIVIDE";break;case "DIFFERENCE":e="MIX_RGB_DIFFERENCE";break;case "DARKEN":e="MIX_RGB_DARKEN";break;case "LIGHTEN":e="MIX_RGB_LIGHTEN";break;case "OVERLAY":e="MIX_RGB_OVERLAY";break;case "DODGE":e="MIX_RGB_DODGE";break;case "BURN":e="MIX_RGB_BURN";break;case "HUE":e="MIX_RGB_HUE";break;case "SATURATION":e=
"MIX_RGB_SATURATION";break;case "VALUE":e="MIX_RGB_VALUE";break;case "COLOR":e="MIX_RGB_COLOR";break;case "SOFT_LIGHT":e="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":e="MIX_RGB_LINEAR_LIGHT";break;default:return G.error("Unsupported MIX_RGB blend type: "+b.blend_type),!1}l=E(b);h=I(b);break;case "OUTPUT":l=E(b);h=[];break;case "RGB":s=y(b,"Color");h.push(s);n.push(w(t("param_RGB_Color"),s.ub,3));break;case "SEPRGB":l=E(b);h=I(b);break;case "TEXTURE":if(!b.texture)return G.error("No texture attached to node: "+
b.name),!1;a:{e=b.outputs;p=!1;for(s=0;s<e.length;s++)if(u=e[s],u.is_linked)switch(u.identifier){case "Color":e="ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";break a;case "Normal":e="TEXTURE_NORMAL";break a;case "Value":p=!0;break;default:throw"Unknown texture output";}e=p?"ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR":void 0}l.push(D(b,"Vector"));if("TEXTURE_COLOR"==e||"TEXTURE_ENVIRONMENT"==e)h.push(y(b,"Color")),h.push(y(b,"Value"));"TEXTURE_NORMAL"==
e&&(h.push(y(b,"Normal")),h.push(y(b,"Value")));u=t("param_TEXTURE_texture");n.push(w(u));p={name:u,value:b.texture};break;case "VALUE":s=y(b,"Value");h.push(s);n.push(w(t("param_VALUE_Value"),s.ub,1));break;case "VECT_MATH":switch(b.operation){case "ADD":e="VECT_MATH_ADD";break;case "SUBTRACT":e="VECT_MATH_SUBTRACT";break;case "AVERAGE":e="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":e="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":e="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":e="VECT_MATH_NORMALIZE";
break;default:return G.error("Unsupported VECT_MATH operation: "+b.operation),!1}l=E(b);h=I(b);break;default:l=E(b),h=I(b)}d={name:d,type:e,ii:k,U:l,Ua:h,wb:n,data:p};F.rn(a,F.dw(a),d);if(d="GEOMETRY"==b.type)a:{d=b.outputs;for(l=k=0;l<d.length;l++)if(d[l].is_linked&&k++>c){d=!0;break a}d=!1}return d&&!f(a,b,++c)?!1:!0}function t(a){M[a]||(M[a]=0);var b=a+M[a],b=b.replace(/ /g,"_").replace(/\//g,"_");M[a]++;return b}function A(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&
!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";default:return null}}}function D(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return u(e)}return null}function y(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return u(e)}return null}function u(a){return{name:a.name,
identifier:a.identifier,sd:a.is_linked,ub:O.nh(a.default_value)?a.default_value.slice(0):a.default_value}}function g(a,b,c){return{name:a,identifier:b,sd:!1,ub:c}}function E(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=u(a.inputs[c]);d.ub.length&&d.ub.splice(3);b.push(d)}return b}function I(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=u(a.outputs[c]);b.push(d)}return b}function w(a,b,c){b=null===b||void 0===b?null:x.u(b,c);return{name:a,value:b}}var G=q("__print"),F=q("__graph"),x=q("__shaders"),
O=q("__util"),S=q("vec3"),Q=q("mat3"),P=q("mat4"),M={},H={};a.bu=function(a,e){if(e in H)return H[e];for(var g=F.create(),l=a.nodes,m=0;m<l.length;m++)if(!f(g,l[m],0))return H[e]=null;l=a.links;for(m=0;m<l.length;m++)for(var t=l[m],u=h(t.from_node,g),A=h(t.to_node,g),E=0;E<u.length;E++)for(var q=0;q<A.length;q++){for(var y=u[E],w=A[q],I=F.Sa(g,y),D=F.Sa(g,w),x=g,O=D,D=[],Q=t.from_socket.identifier,v=t.to_socket.identifier,T=I.Ua,I=0;I<T.length;I++)if(T[I].identifier==Q){D.push(I);break}O=O.U;for(I=
0;I<O.length;I++)if(O[I].identifier==v){D.push(I);break}2==D.length&&F.Ld(x,y,w,D)}d(g);m=a.nodes;l=null;for(t=0;t<m.length;t++)u=m[t],"OUTPUT"==u.type&&(l=u);l?m=h(l,g)[0]:(G.error("No output in node material"),m=-1);if(-1==m)return H[e]=null;p(g);g=F.qA(g,m,F.jr);b(g);n(g);k(g);s(g);return c(g)?H[e]=g:(G.error("Material has normalmap node but no material node"),H[e]=null)};a.cu=function(a){var b=[],c={};M={};var d=F.Pq(a);F.S(d,function(a,d){var e;e=[];for(var f=[],g=[],k=[],l=[],h=[],r=0;r<d.U.length;r++){var n=
d.U[r];n.sd?(e.push(null),f.push(null)):(e.push(t("in_"+d.type+"_"+n.identifier)),f.push(x.u(n.ub,0)))}for(r=0;r<d.Ua.length;r++)n=d.Ua[r],n.sd?g.push(null):g.push(t("out_"+d.type+"_"+n.identifier));for(r=0;r<d.wb.length;r++)n=d.wb[r],k.push(n.name),l.push(n.value);for(r=0;r<d.ii.length;r++)h.push(d.ii[r].name);e={id:d.type,U:e,hp:f,Ua:g,wb:k,Tp:l,ii:h};b.push(e);c[a]=e});F.sf(d,function(a,b,e){var f=F.Sa(d,a);F.Sa(d,b);var g=f.Ua[e[0]];a=c[a].Ua;b=c[b].U;f=a[e[0]]||t("out_"+f.type+"_"+g.identifier);
a[e[0]]=f;b[e[1]]=f});return b};a.ga=function(){for(var a in H)delete H[a]}};b4w.module.__animation=function(a,q){function c(a,b){a.f.type=K;var c=b.frame_start,d=b.frame_end-c+1;a.f.start=c;a.f.Ic=c;a.f.length=d;a.f.$A=b.name;for(d=c=0;d<a.data.b4w_vertex_anim.length;d++){var e=a.data.b4w_vertex_anim[d];if(e==b)break;else c+=e.frame_end-e.frame_start+1}a.f.ZA=c}function b(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}function e(a){a.f&&(a.f.play=!1,delete a.f.vo)}function d(a,c){if(!c.fcurves.length)throw Error('No fcurves in action "'+
c.name+'"');var d=c.frame_range,e=c.d;a.f.action=c.name;a.f.mn=d;a.f.Gs=e.Fy;a.f.Fs=e.mt;a.f.start=d[0];a.f.Ic=d[0];a.f.length=d[1]-d[0];var d=e.Ip,f=b(a);if(O.We(a))a.f.type=P,d=h(a,c),d||(d=p(a),d=l(a,c,d),a.oi.push(c,d)),a.f.e=d.e,a.f.xb=d.xb;else if(f)a.f.type=M,d=h(a,c),d||(d=a.d.Rd,d=l(f,c,d),a.oi.push(c,d)),a.f.e=d.e,a.f.xb=d.xb;else if(G.Sf(a)&&(e.wb.volume||e.wb.pitch))a.f.volume=e.wb.volume||null,a.f.pitch=e.wb.pitch||null,a.f.type=B;else if(f=e.wb.tsr){a.f.e=[];a.f.xb=[];for(e=0;e<d;e++)a.f.e.push(f.subarray(8*
e,8*e+4)),a.f.xb.push(f.subarray(8*e+4,8*e+8));a.f.type=H}else I.warn('B4W Warning: Incompatible action "'+c.name+'" has been applied to object "'+a.name+'"'),a.f.type=L}function h(a,b){for(var c=a.oi,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function p(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var e=b[d].name;c[e]={qt:d,Mi:d,Ll:O.gl(a,"name",e),Zq:-1}}return c}function n(a,b){if(a.f&&(a.f.play||0==b)){var c=a.d,d=a.f.Ic,f=a.f.start,g=a.f.length,m,d=d+b*
Q.Xa;if(d>=f+g)switch(m=a.f.vo,a.f.ba){case U:d=(d-f)%g+f;break;case X:d=f;e(a);break;case Z:d=f+g-1E-6,e(a)}a.f.Ic=d;a.d.time=(d-f)/Q.Xa;var l=a.f.type;switch(l){case P:case M:var f=k(a.f,d,ha),d=f[0],h=f[1],f=f[2],g=a.f.e,r=a.f.xb;c.Hj=r[d];c.Gj=r[h];c.Rj=g[d];c.Qj=g[h];c.ej=f;l===P&&F.H(a);break;case H:d=f=k(a.f,d,ha);(c=z)||(c=new Float32Array(4));var g=d[0],l=d[1],d=d[2],h=a.f.e,r=h[g][1],n=h[g][2],p=h[l][1],t=h[l][2];c[0]=(1-d)*h[g][0]+d*h[l][0];c[1]=(1-d)*r+d*p;c[2]=(1-d)*n+d*t;g=c;c=f;(l=
ka)||(l=new Float32Array(4));d=a.f.xb;S.slerp(d[c[0]].subarray(0,4),d[c[1]].subarray(0,4),c[2],l);c=l;l=f[2];d=a.f.e;f=(1-l)*d[f[0]][3]+l*d[f[1]][3];a.f.sm&&(l=ea,F.Vo(a,l),O.Yh(g,l,b,a.f.sm,g));a.f.Ol&&(l=J,F.Po(a,l),O.yq(c,l,b,a.f.Ol,c));F.Rc(a,g);F.pe(a,c);F.kf(a,f);F.H(a);E.Na(a);break;case K:g=a.f;(f=ha)||(f=Array(3));h=d-g.start;0>h&&(h=0);h>=g.length&&(h=g.length);l=Math.floor(h);d=l+1;h-=l;g.ba!=U&&d==g.length&&(d=l-=1,h=1);g=g.ZA;f[0]=l+g;f[1]=d+g;f[2]=h;f=ha;c.Yj=f[0];c.YA=f[2];break;case B:f=
k(a.f,d,ha);c=f[0];g=f[1];f=f[2];a.f.volume&&G.uq(a,(1-f)*a.f.volume[c]+f*a.f.volume[g]);a.f.pitch&&G.Dj(a,(1-f)*a.f.pitch[c]+f*a.f.pitch[g]);break;case L:break;default:throw"Unknown animation type:"+l;}m&&m(a)}}function k(a,b,c){c||(c=Array(3));var d=a.mn[0],e=a.mn[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.Gs;e=Math.floor(b);a=a.Fs[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function l(a,b,c){for(var d=a.pose.bones,e=[],f=[],g=b.d.Ip,m=0;m<g;m++){for(var k=0;k<d.length;k++){var l=d[k],h=x.create(),r=b.d.st[l.name];
r&&x.copy(r.subarray(8*m,8*m+8),h);l.kn=h;l.qi=!1}k=s(a,c);e.push(k.e);f.push(k.xb)}new Float32Array(4);new Float32Array(4);for(m=0;m<f.length-1;m++)for(a=f[m],b=f[m+1],k=0;k<a.length;k+=4)0>a[k]*b[k]+a[k+1]*b[k+1]+a[k+2]*b[k+2]+a[k+3]*b[k+3]&&(b[k]*=-1,b[k+1]*=-1,b[k+2]*=-1,b[k+3]*=-1);return{e:e,xb:f}}function s(a,b){var c=[],d=[],e=a.pose.bones,f=new Float32Array(4),g=new Float32Array(4),m;for(m in b){var k=b[m],l=k.Mi,h=e[k.Ll],k=f,r=g,n=h.As,p=n[n.length-1],t=p.mk;p.qi||x.identity(t);for(p=n.length-
1;0<=p;p--){var h=n[p],s=h.mk;if(h.qi)t=s;else{var u=h.ln,A=h.kn;x.invert(u,fa);x.multiply(A,fa,fa);x.multiply(u,fa,fa);x.multiply(t,fa,s);t=s;h.qi=!0}}h=h.mk;k[0]=h[0];k[1]=h[1];k[2]=h[2];k[3]=h[3];r[0]=h[4];r[1]=h[5];r[2]=h[6];r[3]=h[7];S.normalize(r,r);for(k=0;4>k;k++)r=4*l+k,c[r]=f[k],d[r]=g[k]}c=new Float32Array(c);d=new Float32Array(d);return{e:c,xb:d}}function f(a,b,c){for(var d,e,f=[],g=0;g<a.length;g++){e=a[g];var k=e[0],l=k===R?0:1,h=e[1],n=e[2];if(0==g&&b<h)for(var p=0;p<h-b;p+=1)f.push(0,
n);f.push(l,n);var s=a[g+1];if(s){d=[h,n];var u=[e[5],e[6]],B=[s[3],s[4]];e=[s[1],s[2]];s=e[0];switch(k){case r:var p=d,k=u,E=B,q=e,y=[],w=[],I=void 0,z=void 0,D=void 0,I=void 0;y[0]=p[0]-k[0];y[1]=p[1]-k[1];w[0]=q[0]-E[0];w[1]=q[1]-E[1];D=q[0]-p[0];I=Math.abs(y[0]);z=Math.abs(w[0]);0!=I+z&&I+z>D&&(I=D/(I+z),k[0]=p[0]-I*y[0],k[1]=p[1]-I*y[1],E[0]=q[0]-I*w[0],E[1]=q[1]-I*w[1]);for(p=h+1;p<s;p+=1)f.push(l,A(t(0,1,p,d[0],u[0],B[0],e[0]),d[1],u[1],B[1],e[1]));break;case m:u=d[0];B=d[1];d=e=(e[1]-B)/(e[0]-
u);e=B-e*u;for(p=h+1;p<s;p+=1)f.push(l,d*p+e);break;case R:for(p=h+1;p<s;p+=1)f.push(l,n);break;default:throw"Unknown keyframe intepolation mode: "+k;}}if(g==a.length-1&&h<c)for(p=0;p<c-h;p+=1)f.push(0,n)}return f}function t(a,b,c,d,e,f,g){var m=a+(b-a)/2,k=A(m,d,e,f,g)-c;return 0.02>Math.abs(k)?m:0<k?t(a,m,c,d,e,f,g):t(m,b,c,d,e,f,g)}function A(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function D(a){a.f={};a.f.play=!1;a.f.ba=X;a.f.Ic=0;a.f.start=0;a.f.length=0;a.f.sm=0;a.f.Ol=
0;a.oi=a.oi||[];-1==da.indexOf(a)&&da.push(a)}function y(a){F.H(a);E.Na(a);g.Pf(a)&&g.NA(a)}var u=q("__config");q("__debug");var g=q("__particles"),E=q("__physics"),I=q("__print"),w=q("__scenes"),G=q("__sfx"),F=q("__transform"),x=q("__tsr"),O=q("__util");q("mat4");var S=q("quat"),Q=u.Hg,P=10,M=20,H=30,K=40,B=50,L=60;a.zr=P;a.Br=M;a.Ar=H;a.Dr=K;a.Cr=B;a.DB=L;var r=0,m=1,R=2,U=10,X=20,Z=30;a.fr=U;a.gr=X;a.hr=Z;var ha=Array(3),z=new Float32Array(3),ea=new Float32Array(3),ka=new Float32Array(4),J=new Float32Array(4),
fa=new Float32Array(8);new Float32Array(16);var da=[],ga=[];a.Xv=function(a){return a/Q.Xa};a.update=function(a){for(var b=0;b<da.length;b++)n(da[b],a)};a.pw=function(){return ga};a.Eo=function(a){return a.f?a.f.action:null};a.sw=function(a){var b=[];if(O.Vb(a)&&a.d.Zj)for(var c=0;c<a.data.b4w_vertex_anim.length;c++)b.push(a.data.b4w_vertex_anim[c].name);else for(c=0;c<ga.length;c++)b.push(ga[c].name);return b};a.Cw=function(a){return a.f?a.f.$A:null};a.tw=function(a){return a.f.type};a.ti=function(a){var e;
a:{if((e=b(a))&&(e=e.animation_data)&&e.action){e=e.action;break a}e=(e=a.animation_data)&&e.action?e.action:G.Sf(a)&&a.data.animation_data&&a.data.animation_data.action?a.data.animation_data.action:null}e?(D(a),d(a,e)):O.Vb(a)&&a.d.Zj?(D(a),c(a,a.data.b4w_vertex_anim[0])):(D(a),a.f.type=L,e=w.Qw(w.o()),a.f.start=e[0],a.f.Ic=e[0],a.f.length=e[1]-e[0]+1);y(a)};a.gh=b;a.play=function(a,b,c){a.f&&(a.f.play&&e(a),c&&(a.f.Ic+=Q.Xa*c),a.f.play=!0,a.f.vo=b?b:null)};a.stop=e;a.pl=function(a){if(a.f)return a.f.play};
a.Jj=function(a,b){a.f&&(a.f.Ic=b)};a.Fo=function(a){return a.f&&a.f.Ic?a.f.Ic:0};a.Tb=function(a,b){a.f&&(a.f.ba=b?U:X)};a.kh=function(a){if(a.f)return a.f.ba==U?!0:!1};a.mz=function(a,b){a.f&&(a.f.ba=b)};a.vw=function(a){if(a.f)return a.f.ba};a.Zs=function(a,b,c){a.f&&(a.f.sm=b||0,a.f.Ol=c||0)};a.zm=function(a,b){b||(b=0);n(a,b)};a.ij=function(a){if("ARMATURE"==a.type||b(a))return!0;var c=a.animation_data;return c&&c.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||
g.Pf(a)&&g.ih(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length?!0:!1};a.kp=function(a){return a.f?!0:!1};a.tt=p;a.Hn=s;a.Is=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a[8*d+3];a[8*d+3]=0==e?1:e/3;e=a.subarray(8*d+4,8*d+8);S.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):(d=-1<a.indexOf("scale")?3:0,e=0);return d+e}function d(a,b,c,e){if(-1<c.search(l)){a=b;c=c.split('"')[1];var f=h}else-1<c.indexOf("location")?
(c="tsr",f=h):-1<c.indexOf("rotation_quaternion")?(c="tsr",f=h):-1<c.indexOf("scale")?(c="tsr",f=h):f=0;if(!a[c]){b=a;var g=c;if("object"==typeof f&&f.length)for(var m=f.length,k=new Float32Array(e*m),r=0;r<e;r++)for(var n=0;n<m;n++)k[r*m+n]=f[n];else if("number"==typeof f)for(k=new Float32Array(e),r=0;r<e;r++)k[r]=f;else throw"Wrong storage default value";b[g]=k}return a[c]}a.d={};var e=a.d,g=a.frame_range,m=g[0],k=g[1];e.Fy=1;for(var l=RegExp(/pose.bones\[\".+\"\]/g),h=new Float32Array([0,0,0,0,
0,0,0,1]),g=a.fcurves,r=0;r<g.length;r++){var n=g[r];n.hn=f(n[2],m,k)}m=g.length?g[0].hn.length/2:0;e.Ip=m;for(var k={},p={},t=new Float32Array(m),r=0;r<g.length;r++)for(var n=g[r],s=n[0],u=n[1],n=n.hn,A=d(k,p,s,m),B=A.length/m,s=c(s,u),u=0;u<m;u++){n[2*u]&&(t[u]=1);var E=n[2*u+1];A[u*B+s]=3==s?A[u*B+s]+E:E}for(var q in k)"tsr"==q&&b(k[q],m);for(var y in p)b(p[y],m);e.wb=k;e.st=p;e.mt=t;ga.push(a)};a.qC=function(a){for(var b=0;b<a.length;b++)if(a[b].f)return a[b];return!1};a.apply=function(a,b){if(O.Vb(a)){var e=
O.Nc("name",b,a.data.b4w_vertex_anim);if(e){D(a);c(a,e);y(a);return}}(e=O.Nc("name",b,ga))?(D(a),d(a,e),y(a)):I.error("Unsupported object or animation name: ",b)};a.remove=function(a){a.f=null;var b=da.indexOf(a);b?da.splice(b,1):I.error("Object ",a.name," doesn't have animation")};a.ga=function(){da.length=0;ga.length=0}};b4w.module.__transform=function(a,q){function c(a){var f=a.d;d.MA(a,u);"CAMERA"==a.type&&e.Rt(a);var t=f.e,q=f.scale,y=f.h;l.Uh(t,q,y,f.rg);var D=f.I;A.identity(D);A.fromQuat(y,D);s.gz(D,q,D);D[12]=t[0];D[13]=t[1];D[14]=t[2];A.invert(D,f.ip);a.f&&!a.f.e&&p.Pf(a)&&p.OA(a);f.Rb&&f.cd&&(b.zi(f.Rb,D,f.cd),b.Dk(f.dd,D,f.ed),b.Ck(f.vi,f.rg,f.wi),f.nc&&n.Ul(n.o()));switch(a.type){case "SPEAKER":k.eA(a,u);break;case "CAMERA":e.Vq(a);n.X()&&k.Sx(n.o(),t,y,u);break;case "LAMP":h.PA(a);n.X()&&n.Vj(a,n.o());
break;case "EMPTY":a.field&&p.Uj(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!n.X()||(f=n.o(),n.Ul(f),n.iz(f));a=a.Kd;for(f=0;f<a.length;f++)c(a[f])}var b=q("__boundings"),e=q("__camera"),d=q("__constraints"),h=q("__lights"),p=q("__particles"),n=q("__scenes"),k=q("__sfx"),l=q("__tsr"),s=q("__util"),f=q("vec3"),t=q("quat"),A=q("mat4"),D=new Float32Array(3),y=new Float32Array(4),u=0;a.update=function(a){u=a};a.Rc=function(a,b){if(d.rd(a)==d.Yc)l.Nz(b,d.pd(a));else{var c=a.d;c.e[0]=b[0];c.e[1]=b[1];c.e[2]=
b[2]}};a.Vo=function(a,b){d.rd(a)==d.Yc?f.copy(l.Uo(d.pd(a)),b):f.copy(a.d.e,b)};a.pe=function(a,b){if(d.rd(a)==d.Yc)l.Vl(b,d.pd(a));else{var c=a.d;c.h[0]=b[0];c.h[1]=b[1];c.h[2]=b[2];c.h[3]=b[3]}};a.Po=function(a,b){d.rd(a)==d.Yc?t.copy(l.Oo(d.pd(a)),b):t.copy(a.d.h,b)};a.Wl=function(a,b){if(d.rd(a)==d.Yc){var c=s.Mf(b,y);l.Vl(c,d.pd(a))}else s.Mf(b,a.d.h)};a.kf=function(a,b){d.rd(a)==d.Yc?l.kf(b,d.pd(a)):a.d.scale=b};a.hl=function(a){return d.rd(a)==d.Yc?l.hl(d.pd(a)):a.d.scale};a.Yw=function(a,
b){if(d.rd(a)==d.Yc)l.copy(d.pd(a),b);else{var c=a.d;l.Uh(c.e,c.scale,c.h,b)}};a.sq=function(a,b){if(d.rd(a)==d.Yc)l.copy(b,d.pd(a));else{var c=a.d;c.e[0]=b[0];c.e[1]=b[1];c.e[2]=b[2];c.scale=b[3];c.h[0]=b[4];c.h[1]=b[5];c.h[2]=b[6];c.h[3]=b[7]}};a.No=function(a){var b="STATIC"==a.d.type?a.gn:a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return 0.5*Math.sqrt(a*a+d*d+b*b)};a.Mo=function(a,b,c){c||(c=new Float32Array(3));b?(b=a.d,
f.copy(b.ed.J,c)):(b="STATIC"==a.d.type?a.gn:a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,f.transformMat4(c,b.I,c));return c};a.Fp=function(a,b,c,d){a=a.d;var e=a.I;f.transformMat4(a.e,a.ip,D);D[0]+=b;D[1]+=c;D[2]+=d;f.transformMat4(D,e,a.e)};a.H=c;a.distance=function(a,b){return f.dist(a.d.e,b.d.e)};a.oy=function(a,b){return f.dist(a.d.e,b)}};b4w.module.__tsr=function(a,q){function c(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function b(a,b,c){var d=a[0],e=a[1],h=a[2],n=a[3],p=a[4],u=a[5],g=a[6];a=a[7];var q=b[0]*n,I=b[1]*n,w=b[2]*n;b=a*q+u*w-g*I;var n=a*I+g*q-p*w,G=a*w+p*I-u*q,q=-p*q-u*I-g*w;c[0]=b*a+q*-p+n*-g-G*-u;c[1]=n*a+q*-u+G*-p-b*-g;c[2]=G*a+q*-g+b*-u-n*-p;c[0]+=d;c[1]+=e;c[2]+=h;return c}var e=q("__util"),d=q("vec3"),h=q("quat");q("mat4");var p=new Float32Array(3),n=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.He=function(a,b,d,e){e||(e=new Float32Array(8));c(a,b,d,e);return e};a.Uh=c;a.Nz=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.kf=function(a,b){b[3]=a};a.Oz=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.Vl=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.Uo=function(a){return a.subarray(0,
3)};a.hl=function(a){return a[3]};a.Oo=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],e=a[1],p=a[2];n[0]=a[4];n[1]=a[5];n[2]=a[6];n[3]=a[7];h.invert(n,n);var q=n[0],y=n[1],u=n[2],g=n[3],d=d*c,e=e*c,E=p*c,p=g*d+y*E-u*e,I=g*e+u*d-q*E,w=g*E+q*e-y*d,d=-q*d-y*e-u*E;b[0]=-(p*g+d*-q+I*-u-w*-y);b[1]=-(I*g+d*-y+w*-q-p*-u);b[2]=-(w*g+d*-u+p*-y-I*-q);b[3]=c;b[4]=q;b[5]=y;b[6]=u;b[7]=g;return b};a.zo=function(a,b){var d=e.Xe(a,p),f=e.pj(a),h=e.ge(a,n);c(d,f,
h,b);return b};a.multiply=function(a,c,d){b(a,c,d);d[3]=a[3]*c[3];var e=a[4],h=a[5],n=a[6];a=a[7];var p=c[4],q=c[5],u=c[6];c=c[7];d[4]=e*c+a*p+h*u-n*q;d[5]=h*c+a*q+n*p-e*u;d[6]=n*c+a*u+e*q-h*p;d[7]=a*c-e*p-h*q-n*u;return d};a.Sj=b;a.Tj=function(a,b,c,d){d||(d=0);var e=a.length,h=b[0],n=b[1],p=b[2],u=b[3],g=b[4],q=b[5],I=b[6];b=b[7];for(var w=0;w<e;w+=3){var G=a[w]*u,F=a[w+1]*u,x=a[w+2]*u,O=b*G+q*x-I*F,S=b*F+I*G-g*x,Q=b*x+g*F-q*G,G=-g*G-q*F-I*x;c[d+w]=O*b+G*-g+S*-I-Q*-q;c[d+w+1]=S*b+G*-q+Q*-g-O*-I;
c[d+w+2]=Q*b+G*-I+O*-q-S*-g;c[d+w]+=h;c[d+w+1]+=n;c[d+w+2]+=p}};a.Qq=function(a,b,c,d){d||(d=0);var e=a.length,h=b[3],n=b[4],p=b[5],u=b[6];b=b[7];for(var g=0;g<e;g+=3){var q=a[g]*h,I=a[g+1]*h,w=a[g+2]*h,G=b*q+p*w-u*I,F=b*I+u*q-n*w,x=b*w+n*I-p*q,q=-n*q-p*I-u*w;c[d+g]=G*b+q*-n+F*-u-x*-p;c[d+g+1]=F*b+q*-p+x*-n-G*-u;c[d+g+2]=x*b+q*-u+G*-p-F*-n}};a.um=function(a,b,c){var d=b[3],e=b[4],h=b[5],n=b[6];b=b[7];var p=a[0]*d,u=a[1]*d,g=a[2]*d;a=b*p+h*g-n*u;var d=b*u+n*p-e*g,q=b*g+e*u-h*p,p=-e*p-h*u-n*g;c[0]=
a*b+p*-e+d*-n-q*-h;c[1]=d*b+p*-h+q*-e-a*-n;c[2]=q*b+p*-n+a*-h-d*-e};a.Rq=function(a,b,c,d){d||(d=0);var e=a.length,h=b[3],n=b[4],p=b[5],u=b[6];b=b[7];for(var g=0;g<e;g+=4){var q=a[g]*h,I=a[g+1]*h,w=a[g+2]*h,G=b*q+p*w-u*I,F=b*I+u*q-n*w,x=b*w+n*I-p*q,q=-n*q-p*I-u*w;c[d+g]=G*b+q*-n+F*-u-x*-p;c[d+g+1]=F*b+q*-p+x*-n-G*-u;c[d+g+2]=x*b+q*-u+G*-p-F*-n;c[d+g+3]=a[g+3]}};a.translate=function(a,b,c){var d=a[3],e=a[4],h=a[5],n=a[6],p=a[7],u=b[0]*d,g=b[1]*d,q=b[2]*d;b=p*u+h*q-n*g;var d=p*g+n*u-e*q,I=p*q+e*g-h*
u,u=-e*u-h*g-n*q;c[0]=a[0]+b*p+u*-e+d*-n-I*-h;c[1]=a[1]+d*p+u*-h+I*-e-b*-n;c[2]=a[2]+I*p+u*-n+b*-h-d*-e;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.OC=function(a,b,c,e){e||(e=new Float32Array(8));d.lerp(a.subarray(0,3),b.subarray(0,3),c,e.subarray(0,3));var n=a[3];e[3]=n+c*(b[3]-n);h.slerp(a.subarray(4),b.subarray(4),c,e.subarray(4));return e};a.nC=function(a,b,c,d){d||(d=new Float32Array(8));var e=a.subarray(0,3),n=b.subarray(0,3),p=d.subarray(0,3);p[0]=n[0]*(c+1)-e[0]*c;p[1]=n[1]*
(c+1)-e[1]*c;p[2]=n[2]*(c+1)-e[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);e=d.subarray(4);e[0]=b[0]*(c+1)-a[0]*c;e[1]=b[1]*(c+1)-a[1]*c;e[2]=b[2]*(c+1)-a[2]*c;e[3]=b[3]*(c+1)-a[3]*c;h.normalize(e,e);return d};a.Ax=function(a,b,c,d,e){var n=a.subarray(0,3),p=e.subarray(0,3);p[0]=n[0]+b*c[0];p[1]=n[1]+b*c[1];p[2]=n[2]+b*c[2];e[3]=a[3];a=a.subarray(4);e=e.subarray(4);c=d[0];n=d[1];d=d[2];var p=a[0],q=a[1],u=a[2],g=a[3];e[0]=0.5*(c*g+n*u-d*q);e[1]=0.5*(n*g+d*p-c*u);e[2]=0.5*(d*g+c*q-
n*p);e[3]=0.5*(-c*p-n*q-d*u);e[0]=a[0]+e[0]*b;e[1]=a[1]+e[1]*b;e[2]=a[2]+e[2]*b;e[3]=a[3]+e[3]*b;h.normalize(e,e)}};b4w.module.__util=function(a,q){function c(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function b(a,c){var d=a instanceof Array?[]:{},e;for(e in a)d[e]=!a[e]||"object"!=typeof a[e]||-1!=c.indexOf(a[e])||a[e]instanceof Float32Array?a[e]:b(a[e],c);return d}function e(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function d(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function h(a){return(34*a+1)*a%289}function p(a){return(34*
a+5)*a-289*Math.floor((34*a+5)*a/289)}function n(a){return a-7*Math.floor(a/7)}var k=q("__print"),l=q("vec3"),s=q("vec4"),f=q("quat"),t=q("mat3"),A=q("mat4"),D=0,y={},u=new Float32Array(3),g=new Float32Array(3),E=new Float32Array(4),I=new Float32Array(4),w=new Float32Array(9),G=new Float32Array(16),F=new Float32Array([0,0,0]),x=new Float32Array([0,0,0,1]),O=new Float32Array([0,0,0,1,0,0,0,1]),S=new Float32Array([1,0,0]),Q=new Float32Array([0,1,0]),P=new Float32Array([0,0,1]),M=new Float32Array([-1,
0,0]),H=new Float32Array([0,-1,0]),K=new Float32Array([0,0,-1]),B=Math.floor(44488.07041494893);a.zs=F;a.us=x;a.GB=O;a.Pm=S;a.ib=Q;a.hk=P;a.ir=M;a.Jd=H;a.Om=K;a.tp=c;a.Rv=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.FA=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Lt=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.ct=function(a,b){var c=[],d={},e=b.length,f,g;
for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.nf=function(a){return 0<a?1:0>a?-1:0};a.XC=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.Nc=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.WC=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.gl=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.Ts=function(a,
b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.WB=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.kD=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.iD=function(a,b){var d=c("name",b,a);1<d.length&&k.error("obj_by_name(): name resolution ambiguity");return d};a.jD=function(a,b){var d=c("name",b,a),e=d.length;1<e&&k.error("obj_by_name(): name resolution ambiguity");if(0>=e)return[];
for(var f=[],g=0;g<e;g++){var h=d[g];if("EMPTY"==h.type&&h.dupli_group)for(var h=h.dupli_group.objects,l=0;l<h.length;l++)f.push(h[l])}return d=d.concat(f)};a.CA=function(a,b,c,d){d||(d=new Float32Array(16));A.identity(d);d[12]=a;d[13]=b;d[14]=c};var L=1;a.Uy=function(){L=(69069*L+5)%Math.pow(2,32);return Math.round(L/65536)%32768/32767};a.nA=function(a){L=a};a.lc=function(a){var b=48271*(a[0]%B)-3399*Math.floor(a[0]/B);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.hj=function(a,b){b||(b=[]);
b[0]=5E4+Math.floor(a);return b};a.Mf=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),g=Math.sin(a[2]/2),k=Math.sin(a[0]/2);b[0]=f*g*e+c*d*k;b[1]=f*d*e+c*g*k;b[2]=c*g*e-f*d*k;b[3]=c*d*e-f*g*k;return b};a.Ry=function(a){var b=[],c=a[0],d=a[1],e=a[2];a=a[3];var f=e*e,g=c*d+e*a;0.499999<g?(b[0]=0,b[1]=2*Math.atan2(c,a),b[2]=Math.PI/2):-0.499999>g?(b[0]=0,b[1]=-2*Math.atan2(c,a),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*a-2*d*e,1-2*
c*c-2*f),b[1]=Math.atan2(2*d*a-2*c*e,1-2*d*d-2*f),b[2]=Math.asin(2*c*d+2*e*a));return b};a.Xb=function(a,b,c){c||(c=new Float32Array(3));l.transformQuat(b,a,c);return c};a.jC=function(a,b,c){c||(c=new Float32Array(4));a=l.normalize(a,u);var d=l.dot(b,a);a=l.cross(b,a,g);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.DA=function(a,b,c,d){d||(d=new Float32Array(4));l.transformQuat(c,b,d);d[3]=-l.dot(a,d)};a.rv=function(a){var b=
a.d.h;switch(a.type){case "CAMERA":u[0]=0;u[1]=-1;u[2]=0;l.transformQuat(u,b,u);g[0]=0;g[1]=0;g[2]=-1;break;case "MESH":u[0]=0;u[1]=0;u[2]=1;l.transformQuat(u,b,u);g[0]=0;g[1]=0;g[2]=1;break;case "EMPTY":u[0]=0,u[1]=1,u[2]=0,l.transformQuat(u,b,u),g[0]=0,g[1]=1,g[2]=0}u[1]=0;l.normalize(u,u);a=l.dot(u,g);return Math.acos(a)*(0<-u[0]*g[2]?-1:1)};a.Dn=function(a,b,c){if(0==c)return a;for(var d=[],e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e];return d};a.CD=function(){D++;return D.toString(16)};a.ym=function(a){y[a]||
(y[a]=0);var b=a+y[a];y[a]++;return b};a.Vd=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.lb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,D:0,ia:null,r:[],v:b}};a.Ji=function(a){var b={};b.type=a;switch(a){case "DYNAMIC":case "STATIC":case "CAMERA":case "EMPTY":case "LAMP":case "ARMATURE":case "SPEAKER":case "CURVE":case "FONT":b.e=new Float32Array([0,0,
0]);b.scale=1;b.h=new Float32Array([0,0,0,1]);b.rg=new Float32Array([0,0,0,1,0,0,0,1]);a=new Float32Array(16);A.identity(a);b.I=a;a=new Float32Array(16);A.identity(a);b.ip=a;b.Uf=1E4;b.vh=0;b.Yj=0;break;case "NONE":b.Yj=0}return b};a.zx=function(a){return{name:a,type:"MESH",modifiers:[],particle_systems:[]}};a.Sd=function(a){return JSON.parse(JSON.stringify(a))};a.YB=function(a,c){var d=[],e;for(e in c){var f=c[e];if(f)for(var g=0;g<f.length;g++)d.push(f[g])}return b(a,d)};a.Fa=function(b){var c=
b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof Float32Array?new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.Fa(b[d]):b[d];return c};a.Di=function(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?new Float32Array(a[c]):a[c]instanceof Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof
Array?a[c].slice(0):a[c]:a[c];return b};a.Vb=function(a){return"MESH"===a.type?!0:!1};a.lp=function(a){return"MESH"===a.type&&a.d&&"DYNAMIC"===a.d.type?!0:!1};a.We=function(a){return"ARMATURE"===a.type?!0:!1};a.ge=function(a,b){b||(b=new Float32Array(4));t.fromMat4(a,w);var c=w[0],d=w[3],e=w[6],g=w[1],k=w[4],h=w[7],l=w[2],n=w[5],p=w[8],c=Math.sqrt(c*c+d*d+e*e)||1,g=Math.sqrt(g*g+k*k+h*h)||1,l=Math.sqrt(l*l+n*n+p*p)||1;w[0]/=c;w[3]/=c;w[6]/=c;w[1]/=g;w[4]/=g;w[7]/=g;w[2]/=l;w[5]/=l;w[8]/=l;f.fromMat3(w,
b);return b};a.Xe=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.pj=function(a){E[0]=0.577350269189626;E[1]=0.577350269189626;E[2]=0.577350269189626;E[3]=0;s.transformMat4(E,a,E);return s.length(E)};a.ro=function(a,b){var c=b.left,d=b.right,f=b.top,g=b.bottom,k=b.pb,h=b.bb;c[0]=a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-a[8];d[3]=a[15]-a[12];f[0]=a[3]-a[1];f[1]=a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];
g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];k[0]=a[3]+a[2];k[1]=a[7]+a[6];k[2]=a[11]+a[10];k[3]=a[15]+a[14];h[0]=a[3]-a[2];h[1]=a[7]-a[6];h[2]=a[11]-a[10];h[3]=a[15]-a[14];e(c);e(d);e(f);e(g);e(k);e(h)};a.gA=function(a,b,c){return c<-d(a,b.left)||c<-d(a,b.right)||c<-d(a,b.top)||c<-d(a,b.bottom)||c<-d(a,b.pb)||c<-d(a,b.bb)?!0:!1};a.Gv=function(a,b,c,e,f){g=l.dot(c,b.bb);k=l.dot(e,b.bb);h=l.dot(f,b.bb);g=Math.sqrt(g*g+k*k+h*h);if(g<-d(a,b.pb)||g<-d(a,b.bb))return!0;var g=l.dot(c,
b.left),k=l.dot(e,b.left),h=l.dot(f,b.left);if(Math.sqrt(g*g+k*k+h*h)<-d(a,b.left))return!0;g=l.dot(c,b.right);k=l.dot(e,b.right);h=l.dot(f,b.right);if(Math.sqrt(g*g+k*k+h*h)<-d(a,b.right))return!0;g=l.dot(c,b.top);k=l.dot(e,b.top);h=l.dot(f,b.top);if(Math.sqrt(g*g+k*k+h*h)<-d(a,b.top))return!0;g=l.dot(c,b.bottom);k=l.dot(e,b.bottom);h=l.dot(f,b.bottom);return Math.sqrt(g*g+k*k+h*h)<-d(a,b.bottom)?!0:!1};a.ff=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],k=a[f+1],h=a[f+2];
c[d+f]=b[0]*g+b[4]*k+b[8]*h+b[12];c[d+f+1]=b[1]*g+b[5]*k+b[9]*h+b[13];c[d+f+2]=b[2]*g+b[6]*k+b[10]*h+b[14]}};a.Dm=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],k=a[f+1],h=a[f+2];c[d+f]=b[0]*g+b[4]*k+b[8]*h;c[d+f+1]=b[1]*g+b[5]*k+b[9]*h;c[d+f+2]=b[2]*g+b[6]*k+b[10]*h}};a.yA=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=4){var g=a[f],k=a[f+1],h=a[f+2];c[d+f]=b[0]*g+b[4]*k+b[8]*h;c[d+f+1]=b[1]*g+b[5]*k+b[9]*h;c[d+f+2]=b[2]*g+b[6]*k+b[10]*h;c[d+f+3]=a[f+3]}};a.aB=function(a,
b,c){c||(c=new Float32Array(3));E[0]=a[0];E[1]=a[1];E[2]=a[2];E[3]=0;s.transformMat4(E,b,E);c[0]=E[0];c[1]=E[1];c[2]=E[2]};a.rC=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.bB=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.xi=function(b,c,d,e){if(e<
d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.xi(b,c,d,f-1):b[f]<c?a.xi(b,c,f+1,e):f};a.Td=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.Ei=function(a,b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.gz=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.vm=function(a,b,c,d){d||(d=new Float32Array(16));b=A.fromRotationTranslation(b,c,G);A.multiply(b,a,d)};
a.Sj=function(a,b,c,d,e){e||(e=new Float32Array(3));b=A.fromRotationTranslation(c,d,G);l.transformMat4(a,b,e);return e};a.wm=function(a,b,c,d){d||(d=new Float32Array(4));b=A.fromRotationTranslation(b,c,G);s.transformMat4(a,b,d)};a.PC=function(a,b,c,d,e){e||(e=new Float32Array(3));b=A.fromRotationTranslation(c,d,G);A.invert(b,b);l.transformMat4(a,b,e);return e};a.AD=function(a,b,c){c||(c=new Float32Array(16));A.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.hD=function(b,
c,d){a.Xe(b,c);c[3]=a.pj(b);a.ge(b,d)};a.yn=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.iq=function(a,b,c,d){d||(d=new Float32Array(3));l.subtract(b,a,u);l.transformQuat(u,c,u);l.subtract(b,u,d)};a.hw=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16),g=new Float32Array(16);A.lookAt(a,[-1,0,0],[0,-1,0],b);A.scale(b,[-1,1,1],b);A.scale(b,[-1,1,-1],c);A.lookAt(a,
[0,0,-1],[0,-1,0],d);A.scale(d,[-1,1,1],d);A.scale(d,[-1,1,-1],e);A.lookAt(a,[0,-1,0],[0,0,-1],g);A.scale(g,[1,1,-1],g);A.scale(g,[-1,-1,-1],f);return[f,g,b,c,d,e]};a.cp=function(a){for(var b=0,c=0;c<a.length;c++)b=(b<<5)-b+a.charCodeAt(c),b&=b;return b};a.gD=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,k,h,l,n,p,t,s,u,q,B;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];k=
a[2];h=a[3];l=a[4];n=a[5];p=a[6];t=a[7];s=a[8];u=a[9];q=a[10];B=a[11];c[0]=f;c[1]=g;c[2]=k;c[3]=h;c[4]=l;c[5]=n;c[6]=p;c[7]=t;c[8]=s;c[9]=u;c[10]=q;c[11]=B;c[12]=f*d+l*e+s*b+a[12];c[13]=g*d+n*e+u*b+a[13];c[14]=k*d+p*e+q*b+a[14];c[15]=h*d+t*e+B*b+a[15];return c};a.Yx=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.Qy=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<
c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.Dc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.Sy=function(a){return a*Math.PI/180};a.gC=function(a){return 180*a/Math.PI};a.dm=function(a){var b=0.366025403784439*a[0]+0.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=0.211324865405187*c+0.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>a?1:0,g=1-f,e=b+0.211324865405187-f,k=a+0.211324865405187-
g,l=b+-0.577350269189626,n=a+-0.577350269189626,c=c%289,d=d%289,p=h(h(d)+c),g=h(h(d+g)+c+f),t=h(h(d+1)+c+1),c=Math.max(0.5-(b*b+a*a),0),d=Math.max(0.5-(e*e+k*k),0),f=Math.max(0.5-(l*l+n*n),0),s=2*(0.024390243902439*p-Math.floor(0.024390243902439*p))-1,u=2*(0.024390243902439*g-Math.floor(0.024390243902439*g))-1,q=2*(0.024390243902439*t-Math.floor(0.024390243902439*t))-1,p=Math.abs(s)-0.5,g=Math.abs(u)-0.5,t=Math.abs(q)-0.5,s=s-Math.floor(s+0.5),u=u-Math.floor(u+0.5),q=q-Math.floor(q+0.5),c=c*c*c*c*
(1.79284291400159-0.85373472095314*(s*s+p*p)),d=d*d*d*d*(1.79284291400159-0.85373472095314*(u*u+g*g)),f=f*f*f*f*(1.79284291400159-0.85373472095314*(q*q+t*t));return 130*(c*(s*b+p*a)+d*(u*e+g*k)+f*(q*l+t*n))};a.Mn=function(a){var b=1/7,c=b/2,d=Math.floor(a[0])-289*Math.floor(Math.floor(a[0])/289),e=Math.floor(a[1])-289*Math.floor(Math.floor(a[1])/289),f=a[0]-Math.floor(a[0]);a=a[1]-Math.floor(a[1]);var g=f-0.5,k=f-1.5,f=a-0.5;a-=1.5;var h=p(d),l=p(d+1),t=h,d=l,h=p(h+e),l=p(l+e),t=p(t+e+1),d=p(d+e+
1),e=g+0.7*(n(h)*b+c),s=k+0.7*(n(l)*b+c),g=g+0.7*(n(t)*b+c),k=k+0.7*(n(d)*b+c),h=f+0.7*(n(Math.floor(h*b))*b+c),f=f+0.7*(n(Math.floor(l*b))*b+c),t=a+0.7*(n(Math.floor(t*b))*b+c),b=a+0.7*(n(Math.floor(d*b))*b+c);return Math.min(e*e+h*h,s*s+f*f,g*g+t*t,k*k+b*b)};a.$p=function(a,b,c,d,e){e||(e=new Float32Array(4));a=l.transformQuat(b,a,u);b=c[0];var g=c[1];c=c[2];w[0]=g*g+c*c;w[1]=-g*b;w[2]=-c*b;w[3]=-b*g;w[4]=b*b+c*c;w[5]=-c*g;w[6]=-b*c;w[7]=-g*c;w[8]=b*b+g*g;l.transformMat3(a,w,a);l.normalize(a,a);
f.rotationTo(d,a,e);return e};a.At=function(a,b){b||(b=new Float32Array(4));var c=E,d=I,c=f.setAxisAngle([0,1,0],Math.PI,f.create()),d=f.setAxisAngle([1,0,0],Math.PI/2,f.create());f.multiply(c,d,c);f.multiply(a,c,b);return b};a.ga=function(){D=0;y={}};a.$a=function(a,b,c){return Math.min(Math.max(a,b),c)};a.jg=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.Yh=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.yq=
function(a,b,c,d,e){e||(e=new Float32Array(a.length));f.slerp(a,b,Math.exp(-c/d),e)};a.Cx=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.nh=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.iu=function(a,b){var c=t.fromQuat(a,w);g[0]=0;g[1]=1;g[2]=0;u[0]=c[3];u[1]=c[4];u[2]=c[5];var d=l.cross(g,u,u);l.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);g[0]=c[0];g[1]=c[1];
g[2]=c[2];l.normalize(g,g);f.rotationTo(g,d,I);f.multiply(I,a,a)};a.Co=function(a,b,c,d){c=c*b-0.5;var e=d*b-0.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,k=a[e*b+c],h=a[e*b+Math.min(c+1,g)],l=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(k*(1-d)+h*d)*(1-f)+(l*(1-d)+a*d)*f};a.hf=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.gq=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.Rh=function(a,
b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.ew=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.Ho=function(a){var b=0;for(dd in a)a.hasOwnProperty(dd)&&b++;return b};a.Vy=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.nB=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];l.normalize(c,c)};a.BD=function(a,
b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],k=b[2];b=b[3];var h=g*a-k*e,l=k*d-f*a,n=f*e-g*d,p=g*n-k*l,k=k*h-f*n,f=f*l-g*h;c[0]=d+2*h*b+2*p;c[1]=e+2*l*b+2*k;c[2]=a+2*n*b+2*f;return c};a.Cy=function(a){a&&k.error(a);throw"panic: see above for possible error messages";}};b4w.module.__sfx=function(a,q){function c(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;f.warn("B4W warning: deprecated WebAudio implementation");return null}f.warn("B4W warning: WebAudio is not supported");return null}function b(a,b,c){var e=a.j;if("NONE"!=e.ba){c||(c=0);var f=e.loop,g=e.pitch;if(e.src&&(f||0<=c)){e.xk=Math.floor(5E4*Math.random());b=x.currentTime+b;e.Zb=b;e.state=y;var k=a.j;if(!k.Lb){var n=a.d.e,s=a.d.h;if(D.sj){var u=x.createBiquadFilter();
u.type="peaking"}else u=null;var q=x.createGain();switch(k.ba){case "POSITIONAL":var A=x.createPanner();A.panningModel=A.EQUALPOWER;A.distanceModel=A.INVERSE_DISTANCE;A.setPosition(n[0],n[1],n[2]);var w=I;t.Xb(s,t.Jd,w);A.setOrientation(w[0],w[1],w[2]);A.refDistance=k.Ti;A.maxDistance=k.Si;A.rolloffFactor=k.ui;A.coneInnerAngle=k.du;A.coneOuterAngle=k.eu;A.coneOuterGain=k.fu;w=x.createGain();w.gain.value=l(k);u?(A.connect(u),u.connect(w)):A.connect(w);w.connect(q);k.Lb=A;if(k.xg){var E=x.createGain();
q.connect(E);E.connect(x?O.j.Lb:null)}else E=null,q.connect(x?O.j.Lb:null);break;case "BACKGROUND_SOUND":A=null;w=x.createGain();w.gain.value=l(k);u?(k.Lb=u,u.connect(w)):k.Lb=w;w.connect(q);k.xg?(E=x.createGain(),q.connect(E),E.connect(x?O.j.Lb:null)):(E=null,q.connect(x?O.j.Lb:null));break;case "BACKGROUND_MUSIC":E=A=null,w=x.createGain(),w.gain.value=l(k),u?(k.Lb=u,u.connect(w)):k.Lb=w,w.connect(q),q.connect(x?O.j.Lb:null)}k.Hh=A;k.Kc=u;k.Nf=w;k.Qe=q;k.aq=E}if("POSITIONAL"==e.ba||"BACKGROUND_SOUND"==
e.ba)a=x.createBufferSource(),a.buffer=e.src,a.playbackRate.value=g,f?(e.Va&&e.Va.disconnect(),a.loop=!0,a.start(b),e.duration=0):(f=a.buffer?a.buffer.duration:0,c>f?(f=b+c+e.md,a.loop=!0,a.start(b),a.stop(f),e.duration=c):(a.loop=!1,a.start(b),e.duration=f)),a.connect(e.Lb),e.Va=a,d(e),h(e);else if("BACKGROUND_MUSIC"==e.ba){window.clearTimeout(e.Bn);c=a.j;if(f=c.src)f.volume=1,f.loop=c.Tb,c.Va=c.Va||x.createMediaElementSource(f),c.Va.connect(c.Lb),c.state==y&&f.play();e.duration=1E6}p(e,b)}}}function e(a){var c=
a.j,d=c.duration,c=c.mv+c.ov*Math.random();b(a,c,d)}function d(a){a.xg&&a.aq.gain.cancelScheduledValues(a.Zb);a.Jh&&a.Va.playbackRate.cancelScheduledValues(a.Zb);a.hi=a.Zb}function h(a){if(a.xg||a.Jh){var b=a.aq,c=a.Va,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Zb;H[0]=a.xk;for(var f=0;f<E;){var g=a.pitch+a.Jh*t.lc(H);if(e>=a.hi){if(a.xg){var k=1-t.$a(a.xg,0,1)*Math.random();b.gain.setValueAtTime(k,e)}a.Jh&&c.playbackRate.setValueAtTime(g,e);f++}e+=d/g}a.hi=e-0.001}}}function p(a,b){if(a.Tk||a.md){var c=
a.Qe;c.gain.cancelScheduledValues(b);a.Tk?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.Tk)):c.gain.setValueAtTime(1,b);a.md&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.md))}}function n(a){if("SPEAKER"!=a.type)throw"Wrong object type";a=a.j;if(a.state==y||a.state==g){var b=a.Qe,c=x.currentTime;a.md&&(b.gain.setValueAtTime(b.gain.value,c),b.gain.linearRampToValueAtTime(0,c+a.md));if("BACKGROUND_MUSIC"==a.ba){var d=a.src;d&&(a.Bn=
window.setTimeout(function(){d.currentTime&&(d.currentTime=0);d.pause()},1E3*a.md))}else b=a.Va,a.duration<b.buffer.duration?a.md&&a.state==y?b.stop(c+a.md):a.state==y&&(b.stop(0),b.disconnect()):b.disconnect(),a.Zb=0,a.Kl=0,a.Ek=0;a.state=u}}function k(a){return!a.j||a.j.state!=y&&a.j.state!=g&&a.j.state!=u?!1:!0}function l(a){return a.muted?0:a.volume}var s=q("__config");q("__debug");var f=q("__print"),t=q("__util"),A=q("vec3"),D=s.hg,y=20,u=30,g=40,E=5;a.Mm=10;a.dk=20;a.Lm=30;var I=new Float32Array(3),
w=new Float32Array(3),G=new Float32Array(3),F=[],x=null,O=null,S=[],Q=new Float32Array(3),P=new Float32Array(3),M=10,H=[1],K=null;a.jh=function(){var a=document.createElement("audio");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&F.push("ogg"),""!=a.canPlayType("audio/mpeg")&&F.push("mp3"),""!=a.canPlayType("audio/mp4")&&F.push("mp4"));(x=D.jB?c():null)&&f.log("%cINIT WEBAUDIO: "+x.sampleRate+"Hz","color: #00a")};a.gt=function(a){var b={};a.j=b;if(x){var c=x.createGain(),d=x.createGain();b.Nf=c;
b.Qe=d;c.connect(d);d.connect(x.destination);if(a.b4w_enable_dynamic_compressor){var d=x.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.Tg=d;b.Lb=d}else b.Tg=null,b.Lb=c;c=x.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=!1;b.volume=1;b.Ne=0}};a.lz=function(a){O=a};a.qv=function(a){a||(a="ogg");new Audio;
return-1<F.indexOf(a)?a:"ogg"==a&&-1<F.indexOf("mp4")?"mp4":"mp3"==a&&-1<F.indexOf("ogg")?"ogg":"mp4"==a&&-1<F.indexOf("ogg")?"ogg":""};a.Ig=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.j={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.j.ba=x?b.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var c=a.j,d;x?(window.MediaElementAudioSourceNode?d=!0:(f.warn("B4W warning: MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):
d="NONE";c.ba=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.j.ba="NONE");a.j.sv=b.b4w_disable_doppler;a.j.muted=b.muted;a.j.volume=b.volume;a.j.pitch=b.pitch;a.j.ui=b.attenuation;a.j.Ti=b.distance_reference;a.j.Si=b.distance_max||1E4;a.j.du=b.cone_angle_inner;a.j.eu=b.cone_angle_outer;a.j.fu=b.cone_volume_outer;a.j.Tb=b.b4w_cyclic_play;a.j.loop=b.b4w_loop;a.j.mv=b.b4w_delay;a.j.ov=b.b4w_delay_random;a.j.xg=b.b4w_volume_random;a.j.Jh=b.b4w_pitch_random;a.j.Tk=b.b4w_fade_in;a.j.md=b.b4w_fade_out;
a.j.Zb=0;a.j.Kl=0;a.j.Ek=0;a.j.duration=0;a.j.hi=0;a.j.xk=1;a.j.src=null;a.j.state=10;a.j.vp=new Float32Array(a.d.e);a.j.pf=new Float32Array(a.d.e);a.j.Bn=null;a.j.Ne=0;S.push(a)};a.zq=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.j.ba){case "POSITIONAL":return a.dk;case "BACKGROUND_SOUND":return a.dk;case "BACKGROUND_MUSIC":return a.Lm;case "NONE":return a.Mm;default:throw"Wrong speaker behavior";}};a.TA=function(a,b){if("SPEAKER"!=a.type)throw"Wrong object type";var c=a.j;switch(c.ba){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=
b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.kv=function(a,b,c){x?x.decodeAudioData(a,b,c):c()};a.vD=function(a){n(a);delete a.j;S.splice(S.indexOf(a),1)};a.ga=function(){for(var a=0;a<S.length;a++){var b=S[a].j;"BACKGROUND_MUSIC"==b.ba?(b=b.src)&&b.pause():b.Va&&b.Va.disconnect()}O=null;S.splice(0);Q[0]=0;Q[0]=0;Q[0]=0;P[0]=0;P[1]=0;P[2]=0;M=10;K=null};a.update=function(a){if(x&&0!=S.length){for(var b=0;b<S.length;b++){var c=S[b],d=c.j,f=x.currentTime;!d.loop&&d.Tb&&d.state==
y&&d.duration&&x&&d.Zb+d.duration<f&&e(c);d.state==y&&3>d.hi-f&&h(d)}K&&(-1==K.Da||a>K.nn+K.no[K.Da])&&(b=K,-1<b.Da&&n(b.re[b.Da]),-1==b.Da&&b.random?c=Math.round(Math.random()*(b.re.length-1)):b.random?(c=1+Math.round(Math.random()*(b.re.length-2)),c=(b.Da+c)%b.re.length):c=(b.Da+1)%b.re.length,e(b.re[c]),b.Da=c,b.nn=a)}};a.play=b;a.Wp=e;a.stop=n;a.pl=function(a){return a.j.state==y};a.Dj=function(a,b){var c=a.j;c.pitch=b;!k(a)||"POSITIONAL"!=c.ba&&"BACKGROUND_SOUND"!=c.ba||(c.Va.playbackRate.value=
b,d(c),h(c))};a.FC=function(a){return a.j.pitch};a.Tb=function(a,b){a.j.Tb=Boolean(b)};a.kh=function(a){return a.j.Tb};a.Sx=function(a,b,c,d){x&&(a=I,a[0]=0,a[1]=-1,a[2]=0,A.transformQuat(a,c,a),w[0]=0,w[1]=0,w[2]=-1,A.transformQuat(w,c,w),c=x.listener,c.setPosition(b[0],b[1],b[2]),c.setOrientation(a[0],a[1],a[2],w[0],w[1],w[2]),d&&(G[0]=(b[0]-Q[0])/d,G[1]=(b[1]-Q[1])/d,G[2]=(b[2]-Q[2])/d,t.Yh(G,P,d,0.3,G),M?M--:c.setVelocity(G[0],G[1],G[2]),P[0]=G[0],P[1]=G[1],P[2]=G[2],Q[0]=b[0],Q[1]=b[1],Q[2]=
b[2]))};a.Rx=function(){x&&(x.listener.setVelocity(0,0,0),P[0]=0,P[1]=0,P[2]=0)};a.eA=function(a,b){var c=a.j;if(k(a)&&"POSITIONAL"==c.ba){var d=a.d.e,e=c.Hh;e.setPosition(d[0],d[1],d[2]);var f=I;t.Xb(a.d.h,t.Jd,f);e.setOrientation(f[0],f[1],f[2]);!c.sv&&b&&(f=c.vp,w[0]=(d[0]-f[0])/b,w[1]=(d[1]-f[1])/b,w[2]=(d[2]-f[2])/b,t.Yh(w,c.pf,b,0.3,w),e.setVelocity(w[0],w[1],w[2]),c.pf[0]=w[0],c.pf[1]=w[1],c.pf[2]=w[2],f[0]=d[0],f[1]=d[1],f[2]=d[2])}};a.dA=function(a){var b=a.j;k(a)&&"POSITIONAL"==b.ba&&(b.Hh.setVelocity(0,
0,0),b.pf[0]=0,b.pf[1]=0,b.pf[2]=0,a=a.d.e,b=b.vp,b[0]=a[0],b[1]=a[1],b[2]=a[2])};a.Sf=function(a){return a.j?!0:!1};a.To=function(a){return a.j.ba};a.Iz=function(a){var b=O.j;b&&(b.volume=a,x&&(b.Nf.gain.value=l(b)))};a.Mw=function(){var a=O.j;return a?a.volume:0};a.uq=function(a,b){var c=a.j;c.volume=b;k(a)&&(c.Nf.gain.value=l(c))};a.$w=function(a){return a.j.volume};a.Gp=function(a,b){a.j.muted=Boolean(b);k(a)&&(a.j.Nf.gain.value=l(a.j))};a.Lx=function(a){return a.j.muted};a.ky=function(a){var b=
O.j;b&&(b.muted=Boolean(a),x&&(b.Nf.gain.value=l(b)))};a.Kx=function(){var a=O.j;return a?a.muted:!1};a.So=function(){return S};a.pause=function(){for(var a=0;a<S.length;a++){var b=S[a].j;if(b.state==y){if("BACKGROUND_MUSIC"==b.ba){var c=b.src;c&&c.pause()}else{var e=x.currentTime;b.Kl=e;var c=b,f;if(e>b.Zb){f=b;H[0]=f.xk;for(var k=f.Va.buffer.duration,h=f.Zb,l=void 0;h<e;)l=f.pitch+f.Jh*t.lc(H),h+=k/l;f=(k/l-(h-e))*l}else f=0;c.Ek=f;b.Va.stop(0);b.Va.disconnect();d(b)}b.state=g}}};a.Sl=function(){for(var a=
0;a<S.length;a++){var b=S[a],c=b.j;if(c.state==g){if("BACKGROUND_MUSIC"==c.ba)c.src.play();else{var b=b.j,d=x.createBufferSource();d.loop=b.Va.loop;d.buffer=b.Va.buffer;d.playbackRate.value=b.Va.playbackRate.value;b.Hh?d.connect(b.Hh):d.connect(b.Nf);b.Va=d;b=x.currentTime;c.Zb+=b-c.Kl;c.hi=b;c.Va.start(c.Zb,c.Ek);h(c);p(c,c.Zb)}c.state=y}}};a.xz=function(a,b){if(a.j&&a.j.Tg){var c=a.j.Tg;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=
b.release}};a.Bw=function(a){if(!a.j||!a.j.Tg)return null;a=a.j.Tg;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.Av=function(a,b,c){if(k(a)){a=a.j;var d=a.Qe,e=x.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.Ne=c}};a.HA=function(a){if(k(a)){a=a.j;var b=a.Qe,c=x.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Ne);a.Ne=0}};a.Bv=function(a,b){if(x){var c=
O.j,d=c.Qe,e=x.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.Ne=b}};a.IA=function(){if(x){var a=O.j,b=a.Qe,c=x.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.Ne);a.Ne=0}};a.Xs=function(a,b,c){K={Da:-1,nn:0,random:c,re:[],no:[]};for(c=0;c<a.length;c++){var d=a[c];n(d);K.re.push(d);d=d.j;d="POSITIONAL"==d.ba||"BACKGROUND_SOUND"==d.ba?(d=d.Va)&&d.buffer?d.buffer.duration:0:(d=d.src)?d.duration:0;K.no.push(d+b)}};a.Wt=
function(){if(K)for(var a=K.re,b=0;b<a.length;b++)n(a[b]);K=null};a.Ow=function(a){return(a=a.j)&&"POSITIONAL"==a.ba?{dist_ref:a.Ti,dist_max:a.Si,attenuation:a.ui}:null};a.Jz=function(a,b){var c=a.j;if(c&&"POSITIONAL"==c.ba){c.Ti=b.dist_ref;c.Si=b.dist_max;c.ui=b.attenuation;var d=c.Hh;d&&(d.refDistance=c.Ti,d.maxDistance=c.Si,d.rolloffFactor=c.ui)}};a.Bz=function(a,b){var c=a.j;c&&c.Kc&&(c.Kc.Yv.value=b.freq,c.Kc.ts.value=b.Q,c.Kc.gain.value=b.gain)};a.Jw=function(a){return(a=a.j)&&a.Kc?{freq:a.Kc.Yv.value,
Q:a.Kc.ts.value,gain:a.Kc.gain.value}:null};a.Iw=function(a,b,c,d){a=a.j;if(!a||!a.Kc)return null;a.Kc.yC(b,c,d)}};b4w.module.vec3=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new q(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var c=new q(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.fromValues=function(a,c,d){var h=new q(3);h[0]=a;h[1]=c;h[2]=d;return h};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.set=function(a,c,d,h){h[0]=a;h[1]=c;h[2]=d;return h};a.add=function(a,c,d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];return d};
a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);return d};
a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;return d};a.scaleAndAdd=function(a,c,d,h){h[0]=a[0]+c[0]*d;h[1]=a[1]+c[1]*d;h[2]=a[2]+c[2]*d;return h};a.distance=function(a,c){var d=c[0]-a[0],h=c[1]-a[1],p=c[2]-a[2];return Math.sqrt(d*d+h*h+p*p)};a.dist=a.distance;a.squaredDistance=function(a,c){var d=c[0]-a[0],h=c[1]-a[1],p=c[2]-a[2];return d*d+h*h+p*p};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1];a=a[2];return Math.sqrt(c*c+d*d+a*a)};a.len=a.length;a.squaredLength=
function(a){var c=a[0],d=a[1];a=a[2];return c*c+d*d+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];return c};a.normalize=function(a,c){var d=a[0],h=a[1],p=a[2],d=d*d+h*h+p*p;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};a.cross=function(a,c,d){var h=a[0],p=a[1];a=a[2];var n=c[0],k=c[1];c=c[2];d[0]=p*c-a*k;d[1]=
a*n-h*c;d[2]=h*k-p*n;return d};a.lerp=function(a,c,d,h){var p=a[0],n=a[1];a=a[2];h[0]=p+d*(c[0]-p);h[1]=n+d*(c[1]-n);h[2]=a+d*(c[2]-a);return h};a.random=function(a,e){a=a||1;var d=2*c()*Math.PI,h=2*c()-1,p=Math.sqrt(1-h*h)*a;e[0]=Math.cos(d)*p;e[1]=Math.sin(d)*p;e[2]=h*a;return e};a.transformMat4=function(a,c,d){var h=a[0],p=a[1];a=a[2];d[0]=c[0]*h+c[4]*p+c[8]*a+c[12];d[1]=c[1]*h+c[5]*p+c[9]*a+c[13];d[2]=c[2]*h+c[6]*p+c[10]*a+c[14];return d};a.transformMat3=function(a,c,d){var h=a[0],p=a[1];a=a[2];
d[0]=h*c[0]+p*c[3]+a*c[6];d[1]=h*c[1]+p*c[4]+a*c[7];d[2]=h*c[2]+p*c[5]+a*c[8];return d};a.transformQuat=function(a,c,d){var h=a[0],p=a[1],n=a[2];a=c[0];var k=c[1],l=c[2];c=c[3];var s=c*h+k*n-l*p,f=c*p+l*h-a*n,t=c*n+a*p-k*h,h=-a*h-k*p-l*n;d[0]=s*c+h*-a+f*-l-t*-k;d[1]=f*c+h*-k+t*-a-s*-l;d[2]=t*c+h*-l+s*-k-f*-a;return d};a.rotateX=function(a,c,d,h){var p=[],n=[];p[0]=a[0]-c[0];p[1]=a[1]-c[1];p[2]=a[2]-c[2];n[0]=p[0];n[1]=p[1]*Math.cos(d)-p[2]*Math.sin(d);n[2]=p[1]*Math.sin(d)+p[2]*Math.cos(d);h[0]=n[0]+
c[0];h[1]=n[1]+c[1];h[2]=n[2]+c[2];return h};a.rotateY=function(a,c,d,h){var p=[],n=[];p[0]=a[0]-c[0];p[1]=a[1]-c[1];p[2]=a[2]-c[2];n[0]=p[2]*Math.sin(d)+p[0]*Math.cos(d);n[1]=p[1];n[2]=p[2]*Math.cos(d)-p[0]*Math.sin(d);h[0]=n[0]+c[0];h[1]=n[1]+c[1];h[2]=n[2]+c[2];return h};a.rotateZ=function(a,c,d,h){var p=[],n=[];p[0]=a[0]-c[0];p[1]=a[1]-c[1];p[2]=a[2]-c[2];n[0]=p[0]*Math.cos(d)-p[1]*Math.sin(d);n[1]=p[0]*Math.sin(d)+p[1]*Math.cos(d);n[2]=p[2];h[0]=n[0]+c[0];h[1]=n[1]+c[1];h[2]=n[2]+c[2];return h};
a.forEach=function(){var b=a.create();return function(a,c,h,p,n,k){c||(c=3);h||(h=0);for(p=p?Math.min(p*c+h,a.length):a.length;h<p;h+=c)b[0]=a[h],b[1]=a[h+1],b[2]=a[h+2],n(b,k,b),a[h]=b[0],a[h+1]=b[1],a[h+2]=b[2];return a}}();a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==typeof a&&(a.FD=a)};
b4w.module.vec4=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array,c=Math.random;a.create=function(){var a=new q(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var c=new q(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.fromValues=function(a,c,d,h){var p=new q(4);p[0]=a;p[1]=c;p[2]=d;p[3]=h;return p};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c};a.set=function(a,c,d,h,p){p[0]=a;p[1]=c;p[2]=d;p[3]=h;return p};a.add=function(a,c,d){d[0]=
a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3]+c[3];return d};a.subtract=function(a,c,d){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];d[3]=a[3]-c[3];return d};a.sub=a.subtract;a.multiply=function(a,c,d){d[0]=a[0]*c[0];d[1]=a[1]*c[1];d[2]=a[2]*c[2];d[3]=a[3]*c[3];return d};a.mul=a.multiply;a.divide=function(a,c,d){d[0]=a[0]/c[0];d[1]=a[1]/c[1];d[2]=a[2]/c[2];d[3]=a[3]/c[3];return d};a.div=a.divide;a.min=function(a,c,d){d[0]=Math.min(a[0],c[0]);d[1]=Math.min(a[1],c[1]);d[2]=Math.min(a[2],c[2]);d[3]=
Math.min(a[3],c[3]);return d};a.max=function(a,c,d){d[0]=Math.max(a[0],c[0]);d[1]=Math.max(a[1],c[1]);d[2]=Math.max(a[2],c[2]);d[3]=Math.max(a[3],c[3]);return d};a.scale=function(a,c,d){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;return d};a.scaleAndAdd=function(a,c,d,h){h[0]=a[0]+c[0]*d;h[1]=a[1]+c[1]*d;h[2]=a[2]+c[2]*d;h[3]=a[3]+c[3]*d;return h};a.distance=function(a,c){var d=c[0]-a[0],h=c[1]-a[1],p=c[2]-a[2],n=c[3]-a[3];return Math.sqrt(d*d+h*h+p*p+n*n)};a.dist=a.distance;a.squaredDistance=
function(a,c){var d=c[0]-a[0],h=c[1]-a[1],p=c[2]-a[2],n=c[3]-a[3];return d*d+h*h+p*p+n*n};a.sqrDist=a.squaredDistance;a.length=function(a){var c=a[0],d=a[1],h=a[2];a=a[3];return Math.sqrt(c*c+d*d+h*h+a*a)};a.len=a.length;a.squaredLength=function(a){var c=a[0],d=a[1],h=a[2];a=a[3];return c*c+d*d+h*h+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};a.inverse=function(a,c){c[0]=1/a[0];c[1]=1/a[1];c[2]=1/a[2];c[3]=1/a[3];return c};a.normalize=
function(a,c){var d=a[0],h=a[1],p=a[2],n=a[3],d=d*d+h*h+p*p+n*n;0<d&&(d=1/Math.sqrt(d),c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d);return c};a.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};a.lerp=function(a,c,d,h){var p=a[0],n=a[1],k=a[2];a=a[3];h[0]=p+d*(c[0]-p);h[1]=n+d*(c[1]-n);h[2]=k+d*(c[2]-k);h[3]=a+d*(c[3]-a);return h};a.random=function(b,e){b=b||1;e[0]=c();e[1]=c();e[2]=c();e[3]=c();a.normalize(e,e);a.scale(e,b,e);return e};a.transformMat4=function(a,c,d){var h=a[0],
p=a[1],n=a[2];a=a[3];d[0]=c[0]*h+c[4]*p+c[8]*n+c[12]*a;d[1]=c[1]*h+c[5]*p+c[9]*n+c[13]*a;d[2]=c[2]*h+c[6]*p+c[10]*n+c[14]*a;d[3]=c[3]*h+c[7]*p+c[11]*n+c[15]*a;return d};a.transformQuat=function(a,c,d){var h=a[0],p=a[1],n=a[2];a=c[0];var k=c[1],l=c[2];c=c[3];var s=c*h+k*n-l*p,f=c*p+l*h-a*n,t=c*n+a*p-k*h,h=-a*h-k*p-l*n;d[0]=s*c+h*-a+f*-l-t*-k;d[1]=f*c+h*-k+t*-a-s*-l;d[2]=t*c+h*-l+s*-k-f*-a;return d};a.forEach=function(){var b=a.create();return function(a,c,h,p,n,k){c||(c=4);h||(h=0);for(p=p?Math.min(p*
c+h,a.length):a.length;h<p;h+=c)b[0]=a[h],b[1]=a[h+1],b[2]=a[h+2],b[3]=a[h+3],n(b,k,b),a[h]=b[0],a[h+1]=b[1],a[h+2]=b[2],a[h+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.GD=a)};
b4w.module.quat=function(a,q){var c=q("vec3"),b=q("vec4"),e=q("mat3"),d="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new d(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=c.create(),d=c.fromValues(1,0,0),e=c.fromValues(0,1,0);return function(k,l,s){var f=c.dot(k,l);if(-0.9999999>f)return c.cross(d,k,b),1E-6>c.length(b)&&c.cross(e,k,b),c.normalize(b,b),a.setAxisAngle(b,Math.PI,s),s;if(0.9999999<f)return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s;c.cross(k,
l,b);s[0]=b[0];s[1]=b[1];s[2]=b[2];s[3]=1+f;return a.normalize(s,s)}}();a.setAxes=function(){var b=e.create();return function(c,d,e,l){b[0]=d[0];b[3]=d[1];b[6]=d[2];b[1]=e[0];b[4]=e[1];b[7]=e[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,l),l)}}();a.clone=b.clone;a.fromValues=b.fromValues;a.copy=b.copy;a.set=b.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=0.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=b.add;a.multiply=function(a,b,c){var d=a[0],e=a[1],s=a[2];a=a[3];var f=b[0],t=b[1],q=b[2];b=b[3];c[0]=d*b+a*f+e*q-s*t;c[1]=e*b+a*t+s*f-d*q;c[2]=s*b+a*q+d*t-e*f;c[3]=a*b-d*f-e*t-s*q;return c};a.mul=a.multiply;a.scale=b.scale;a.rotateX=function(a,b,c){b*=0.5;var d=a[0],e=a[1],s=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*f;c[1]=e*b+s*f;c[2]=s*b-e*f;c[3]=a*b-d*f;return c};a.rotateY=function(a,b,c){b*=0.5;var d=a[0],e=a[1],s=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=
d*b-s*f;c[1]=e*b+a*f;c[2]=s*b+d*f;c[3]=a*b-e*f;return c};a.rotateZ=function(a,b,c){b*=0.5;var d=a[0],e=a[1],s=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=d*b+e*f;c[1]=e*b-d*f;c[2]=s*b+a*f;c[3]=a*b-s*f;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];b[0]=c;b[1]=d;b[2]=e;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};a.dot=b.dot;a.lerp=b.lerp;a.slerp=function(a,b,c,d){var e=a[0],s=a[1],f=a[2];a=a[3];var t=b[0],q=b[1],D=b[2];b=b[3];var y,u,g;u=e*t+s*q+f*D+a*b;0>u&&(u=-u,t=-t,q=
-q,D=-D,b=-b);1E-6<1-u?(y=Math.acos(u),g=Math.sin(y),u=Math.sin((1-c)*y)/g,c=Math.sin(c*y)/g):u=1-c;d[0]=u*e+c*t;d[1]=u*s+c*q;d[2]=u*f+c*D;d[3]=u*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],e=a[2],s=a[3],f=c*c+d*d+e*e+s*s,f=f?1/f:0;b[0]=-c*f;b[1]=-d*f;b[2]=-e*f;b[3]=s*f;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=b.length;a.len=a.length;a.squaredLength=b.squaredLength;a.sqrLen=a.squaredLength;a.normalize=b.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=0.5*c,c=0.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var e=(d+1)%3,s=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*e+e]-a[3*s+s]+1);b[d]=0.5*c;c=0.5/c;b[3]=(a[3*e+s]-a[3*s+e])*c;b[e]=(a[3*e+d]+a[3*d+e])*c;b[s]=(a[3*s+d]+a[3*d+s])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.h=a)};
b4w.module.mat3=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new q(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new q(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=
a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var e=a[1],d=a[2],h=a[5];b[1]=a[3];b[2]=a[6];b[3]=e;b[5]=a[7];b[6]=d;b[7]=h}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var e=a[0],d=a[1],h=a[2],p=a[3],n=a[4],k=a[5],l=a[6],s=a[7],f=a[8],t=f*n-k*s,q=-f*p+k*l,D=
s*p-n*l,y=e*t+d*q+h*D;if(!y)return null;y=1/y;b[0]=t*y;b[1]=(-f*d+h*s)*y;b[2]=(k*d-h*n)*y;b[3]=q*y;b[4]=(f*e-h*l)*y;b[5]=(-k*e+h*p)*y;b[6]=D*y;b[7]=(-s*e+d*l)*y;b[8]=(n*e-d*p)*y;return b};a.adjoint=function(a,b){var e=a[0],d=a[1],h=a[2],p=a[3],n=a[4],k=a[5],l=a[6],s=a[7],f=a[8];b[0]=n*f-k*s;b[1]=h*s-d*f;b[2]=d*k-h*n;b[3]=k*l-p*f;b[4]=e*f-h*l;b[5]=h*p-e*k;b[6]=p*s-n*l;b[7]=d*l-e*s;b[8]=e*n-d*p;return b};a.determinant=function(a){var b=a[3],e=a[4],d=a[5],h=a[6],p=a[7],n=a[8];return a[0]*(n*e-d*p)+a[1]*
(-n*b+d*h)+a[2]*(p*b-e*h)};a.multiply=function(a,b,e){var d=a[0],h=a[1],p=a[2],n=a[3],k=a[4],l=a[5],s=a[6],f=a[7];a=a[8];var t=b[0],q=b[1],D=b[2],y=b[3],u=b[4],g=b[5],E=b[6],I=b[7];b=b[8];e[0]=t*d+q*n+D*s;e[1]=t*h+q*k+D*f;e[2]=t*p+q*l+D*a;e[3]=y*d+u*n+g*s;e[4]=y*h+u*k+g*f;e[5]=y*p+u*l+g*a;e[6]=E*d+I*n+b*s;e[7]=E*h+I*k+b*f;e[8]=E*p+I*l+b*a;return e};a.mul=a.multiply;a.translate=function(a,b,e){var d=a[0],h=a[1],p=a[2],n=a[3],k=a[4],l=a[5],s=a[6],f=a[7];a=a[8];var t=b[0];b=b[1];e[0]=d;e[1]=h;e[2]=p;
e[3]=n;e[4]=k;e[5]=l;e[6]=t*d+b*n+s;e[7]=t*h+b*k+f;e[8]=t*p+b*l+a;return e};a.rotate=function(a,b,e){var d=a[0],h=a[1],p=a[2],n=a[3],k=a[4],l=a[5],s=a[6],f=a[7];a=a[8];var t=Math.sin(b);b=Math.cos(b);e[0]=b*d+t*n;e[1]=b*h+t*k;e[2]=b*p+t*l;e[3]=b*n-t*d;e[4]=b*k-t*h;e[5]=b*l-t*p;e[6]=s;e[7]=f;e[8]=a;return e};a.scale=function(a,b,e){var d=b[0];b=b[1];e[0]=d*a[0];e[1]=d*a[1];e[2]=d*a[2];e[3]=b*a[3];e[4]=b*a[4];e[5]=b*a[5];e[6]=a[6];e[7]=a[7];e[8]=a[8];return e};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=
a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var e=a[0],d=a[1],h=a[2],p=a[3],n=e+e,k=d+d,l=h+h,e=e*n,s=d*n,d=d*k,f=h*n,t=h*k,h=h*l,n=p*n,k=p*k,p=p*l;b[0]=1-d-h;b[3]=s-p;b[6]=f+k;b[1]=s+p;b[4]=1-e-h;b[7]=t-n;b[2]=f-k;b[5]=t+n;b[8]=1-e-d;return b};a.normalFromMat4=function(a,b){var e=a[0],d=a[1],h=a[2],p=a[3],n=a[4],k=a[5],l=a[6],s=a[7],f=a[8],t=a[9],q=a[10],D=a[11],y=a[12],u=a[13],g=a[14],E=a[15],I=e*k-d*n,w=e*l-h*n,G=e*s-p*n,F=d*l-h*k,x=d*s-
p*k,O=h*s-p*l,S=f*u-t*y,Q=f*g-q*y,f=f*E-D*y,P=t*g-q*u,t=t*E-D*u,q=q*E-D*g,D=I*q-w*t+G*P+F*f-x*Q+O*S;if(!D)return null;D=1/D;b[0]=(k*q-l*t+s*P)*D;b[1]=(l*f-n*q-s*Q)*D;b[2]=(n*t-k*f+s*S)*D;b[3]=(h*t-d*q-p*P)*D;b[4]=(e*q-h*f+p*Q)*D;b[5]=(d*f-e*t-p*S)*D;b[6]=(u*O-g*x+E*F)*D;b[7]=(g*G-y*O-E*w)*D;b[8]=(y*x-u*G+E*I)*D;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.Zv=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],
2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.eD=a)};
b4w.module.mat4=function(a){var q="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new q(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new q(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];b[1]=
a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var e=a[1],d=a[2],h=a[3],p=a[6],n=a[7],k=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=e;b[6]=a[9];b[7]=a[13];b[8]=d;b[9]=p;b[11]=a[14];b[12]=h;b[13]=n;
b[14]=k}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var e=a[0],d=a[1],h=a[2],p=a[3],n=a[4],k=a[5],l=a[6],s=a[7],f=a[8],t=a[9],q=a[10],D=a[11],y=a[12],u=a[13],g=a[14],E=a[15],I=e*k-d*n,w=e*l-h*n,G=e*s-p*n,F=d*l-h*k,x=d*s-p*k,O=h*s-p*l,S=f*u-t*y,Q=f*g-q*y,P=f*E-D*y,M=t*g-q*u,H=t*E-D*u,K=q*E-D*g,B=I*K-w*H+G*M+F*P-x*Q+O*S;if(!B)return null;
B=1/B;b[0]=(k*K-l*H+s*M)*B;b[1]=(h*H-d*K-p*M)*B;b[2]=(u*O-g*x+E*F)*B;b[3]=(q*x-t*O-D*F)*B;b[4]=(l*P-n*K-s*Q)*B;b[5]=(e*K-h*P+p*Q)*B;b[6]=(g*G-y*O-E*w)*B;b[7]=(f*O-q*G+D*w)*B;b[8]=(n*H-k*P+s*S)*B;b[9]=(d*P-e*H-p*S)*B;b[10]=(y*x-u*G+E*I)*B;b[11]=(t*G-f*x-D*I)*B;b[12]=(k*Q-n*M-l*S)*B;b[13]=(e*M-d*Q+h*S)*B;b[14]=(u*w-y*F-g*I)*B;b[15]=(f*F-t*w+q*I)*B;return b};a.adjoint=function(a,b){var e=a[0],d=a[1],h=a[2],p=a[3],n=a[4],k=a[5],l=a[6],s=a[7],f=a[8],t=a[9],q=a[10],D=a[11],y=a[12],u=a[13],g=a[14],E=a[15];
b[0]=k*(q*E-D*g)-t*(l*E-s*g)+u*(l*D-s*q);b[1]=-(d*(q*E-D*g)-t*(h*E-p*g)+u*(h*D-p*q));b[2]=d*(l*E-s*g)-k*(h*E-p*g)+u*(h*s-p*l);b[3]=-(d*(l*D-s*q)-k*(h*D-p*q)+t*(h*s-p*l));b[4]=-(n*(q*E-D*g)-f*(l*E-s*g)+y*(l*D-s*q));b[5]=e*(q*E-D*g)-f*(h*E-p*g)+y*(h*D-p*q);b[6]=-(e*(l*E-s*g)-n*(h*E-p*g)+y*(h*s-p*l));b[7]=e*(l*D-s*q)-n*(h*D-p*q)+f*(h*s-p*l);b[8]=n*(t*E-D*u)-f*(k*E-s*u)+y*(k*D-s*t);b[9]=-(e*(t*E-D*u)-f*(d*E-p*u)+y*(d*D-p*t));b[10]=e*(k*E-s*u)-n*(d*E-p*u)+y*(d*s-p*k);b[11]=-(e*(k*D-s*t)-n*(d*D-p*t)+f*
(d*s-p*k));b[12]=-(n*(t*g-q*u)-f*(k*g-l*u)+y*(k*q-l*t));b[13]=e*(t*g-q*u)-f*(d*g-h*u)+y*(d*q-h*t);b[14]=-(e*(k*g-l*u)-n*(d*g-h*u)+y*(d*l-h*k));b[15]=e*(k*q-l*t)-n*(d*q-h*t)+f*(d*l-h*k);return b};a.determinant=function(a){var b=a[0],e=a[1],d=a[2],h=a[3],p=a[4],n=a[5],k=a[6],l=a[7],s=a[8],f=a[9],t=a[10],q=a[11],D=a[12],y=a[13],u=a[14];a=a[15];return(b*n-e*p)*(t*a-q*u)-(b*k-d*p)*(f*a-q*y)+(b*l-h*p)*(f*u-t*y)+(e*k-d*n)*(s*a-q*D)-(e*l-h*n)*(s*u-t*D)+(d*l-h*k)*(s*y-f*D)};a.multiply=function(a,b,e){var d=
a[0],h=a[1],p=a[2],n=a[3],k=a[4],l=a[5],s=a[6],f=a[7],t=a[8],q=a[9],D=a[10],y=a[11],u=a[12],g=a[13],E=a[14];a=a[15];var I=b[0],w=b[1],G=b[2],F=b[3];e[0]=I*d+w*k+G*t+F*u;e[1]=I*h+w*l+G*q+F*g;e[2]=I*p+w*s+G*D+F*E;e[3]=I*n+w*f+G*y+F*a;I=b[4];w=b[5];G=b[6];F=b[7];e[4]=I*d+w*k+G*t+F*u;e[5]=I*h+w*l+G*q+F*g;e[6]=I*p+w*s+G*D+F*E;e[7]=I*n+w*f+G*y+F*a;I=b[8];w=b[9];G=b[10];F=b[11];e[8]=I*d+w*k+G*t+F*u;e[9]=I*h+w*l+G*q+F*g;e[10]=I*p+w*s+G*D+F*E;e[11]=I*n+w*f+G*y+F*a;I=b[12];w=b[13];G=b[14];F=b[15];e[12]=I*d+
w*k+G*t+F*u;e[13]=I*h+w*l+G*q+F*g;e[14]=I*p+w*s+G*D+F*E;e[15]=I*n+w*f+G*y+F*a;return e};a.mul=a.multiply;a.translate=function(a,b,e){var d=b[0],h=b[1];b=b[2];var p,n,k,l,s,f,t,q,D,y,u,g;a===e?(e[12]=a[0]*d+a[4]*h+a[8]*b+a[12],e[13]=a[1]*d+a[5]*h+a[9]*b+a[13],e[14]=a[2]*d+a[6]*h+a[10]*b+a[14],e[15]=a[3]*d+a[7]*h+a[11]*b+a[15]):(p=a[0],n=a[1],k=a[2],l=a[3],s=a[4],f=a[5],t=a[6],q=a[7],D=a[8],y=a[9],u=a[10],g=a[11],e[0]=p,e[1]=n,e[2]=k,e[3]=l,e[4]=s,e[5]=f,e[6]=t,e[7]=q,e[8]=D,e[9]=y,e[10]=u,e[11]=g,
e[12]=p*d+s*h+D*b+a[12],e[13]=n*d+f*h+y*b+a[13],e[14]=k*d+t*h+u*b+a[14],e[15]=l*d+q*h+g*b+a[15]);return e};a.scale=function(a,b,e){var d=b[0],h=b[1];b=b[2];e[0]=a[0]*d;e[1]=a[1]*d;e[2]=a[2]*d;e[3]=a[3]*d;e[4]=a[4]*h;e[5]=a[5]*h;e[6]=a[6]*h;e[7]=a[7]*h;e[8]=a[8]*b;e[9]=a[9]*b;e[10]=a[10]*b;e[11]=a[11]*b;e[12]=a[12];e[13]=a[13];e[14]=a[14];e[15]=a[15];return e};a.rotate=function(a,b,e,d){var h=e[0],p=e[1];e=e[2];var n=Math.sqrt(h*h+p*p+e*e),k,l,s,f,t,q,D,y,u,g,E,I,w,G,F,x,O,S,Q,P;if(1E-7>Math.abs(n))return null;
n=1/n;h*=n;p*=n;e*=n;k=Math.sin(b);l=Math.cos(b);s=1-l;b=a[0];n=a[1];f=a[2];t=a[3];q=a[4];D=a[5];y=a[6];u=a[7];g=a[8];E=a[9];I=a[10];w=a[11];G=h*h*s+l;F=p*h*s+e*k;x=e*h*s-p*k;O=h*p*s-e*k;S=p*p*s+l;Q=e*p*s+h*k;P=h*e*s+p*k;h=p*e*s-h*k;p=e*e*s+l;d[0]=b*G+q*F+g*x;d[1]=n*G+D*F+E*x;d[2]=f*G+y*F+I*x;d[3]=t*G+u*F+w*x;d[4]=b*O+q*S+g*Q;d[5]=n*O+D*S+E*Q;d[6]=f*O+y*S+I*Q;d[7]=t*O+u*S+w*Q;d[8]=b*P+q*h+g*p;d[9]=n*P+D*h+E*p;d[10]=f*P+y*h+I*p;d[11]=t*P+u*h+w*p;a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);
return d};a.rotateX=function(a,b,e){var d=Math.sin(b);b=Math.cos(b);var h=a[4],p=a[5],n=a[6],k=a[7],l=a[8],s=a[9],f=a[10],t=a[11];a!==e&&(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[4]=h*b+l*d;e[5]=p*b+s*d;e[6]=n*b+f*d;e[7]=k*b+t*d;e[8]=l*b-h*d;e[9]=s*b-p*d;e[10]=f*b-n*d;e[11]=t*b-k*d;return e};a.rotateY=function(a,b,e){var d=Math.sin(b);b=Math.cos(b);var h=a[0],p=a[1],n=a[2],k=a[3],l=a[8],s=a[9],f=a[10],t=a[11];a!==e&&(e[4]=a[4],e[5]=a[5],e[6]=a[6],
e[7]=a[7],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[0]=h*b-l*d;e[1]=p*b-s*d;e[2]=n*b-f*d;e[3]=k*b-t*d;e[8]=h*d+l*b;e[9]=p*d+s*b;e[10]=n*d+f*b;e[11]=k*d+t*b;return e};a.rotateZ=function(a,b,e){var d=Math.sin(b);b=Math.cos(b);var h=a[0],p=a[1],n=a[2],k=a[3],l=a[4],s=a[5],f=a[6],t=a[7];a!==e&&(e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[0]=h*b+l*d;e[1]=p*b+s*d;e[2]=n*b+f*d;e[3]=k*b+t*d;e[4]=l*b-h*d;e[5]=s*b-p*d;e[6]=f*b-n*d;e[7]=t*b-k*d;return e};
a.fromRotationTranslation=function(a,b,e){var d=a[0],h=a[1],p=a[2],n=a[3],k=d+d,l=h+h,s=p+p;a=d*k;var f=d*l,d=d*s,t=h*l,h=h*s,p=p*s,k=n*k,l=n*l,n=n*s;e[0]=1-(t+p);e[1]=f+n;e[2]=d-l;e[3]=0;e[4]=f-n;e[5]=1-(a+p);e[6]=h+k;e[7]=0;e[8]=d+l;e[9]=h-k;e[10]=1-(a+t);e[11]=0;e[12]=b[0];e[13]=b[1];e[14]=b[2];e[15]=1;return e};a.fromQuat=function(a,b){var e=a[0],d=a[1],h=a[2],p=a[3],n=e+e,k=d+d,l=h+h,e=e*n,s=d*n,d=d*k,f=h*n,t=h*k,h=h*l,n=p*n,k=p*k,p=p*l;b[0]=1-d-h;b[1]=s+p;b[2]=f-k;b[3]=0;b[4]=s-p;b[5]=1-e-h;
b[6]=t+n;b[7]=0;b[8]=f+k;b[9]=t-n;b[10]=1-e-d;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,e,d,h,p,n){var k=1/(b-a),l=1/(d-e),s=1/(h-p);n[0]=2*h*k;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=2*h*l;n[6]=0;n[7]=0;n[8]=(b+a)*k;n[9]=(d+e)*l;n[10]=(p+h)*s;n[11]=-1;n[12]=0;n[13]=0;n[14]=2*p*h*s;n[15]=0;return n};a.perspective=function(a,b,e,d,h){a=1/Math.tan(a/2);var p=1/(e-d);h[0]=a/b;h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=a;h[6]=0;h[7]=0;h[8]=0;h[9]=0;h[10]=(d+e)*p;h[11]=-1;h[12]=0;h[13]=0;
h[14]=2*d*e*p;h[15]=0;return h};a.ortho=function(a,b,e,d,h,p,n){var k=1/(a-b),l=1/(e-d),s=1/(h-p);n[0]=-2*k;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=-2*l;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=2*s;n[11]=0;n[12]=(a+b)*k;n[13]=(d+e)*l;n[14]=(p+h)*s;n[15]=1;return n};a.lookAt=function(c,b,e,d){var h,p,n,k,l,s,f,t,q=c[0],D=c[1];c=c[2];n=e[0];k=e[1];p=e[2];f=b[0];e=b[1];h=b[2];if(1E-7>Math.abs(q-f)&&1E-7>Math.abs(D-e)&&1E-7>Math.abs(c-h))return a.identity(d);b=q-f;e=D-e;f=c-h;t=1/Math.sqrt(b*b+e*e+f*f);b*=t;e*=t;f*=
t;h=k*f-p*e;p=p*b-n*f;n=n*e-k*b;(t=Math.sqrt(h*h+p*p+n*n))?(t=1/t,h*=t,p*=t,n*=t):n=p=h=0;k=e*n-f*p;l=f*h-b*n;s=b*p-e*h;(t=Math.sqrt(k*k+l*l+s*s))?(t=1/t,k*=t,l*=t,s*=t):s=l=k=0;d[0]=h;d[1]=k;d[2]=b;d[3]=0;d[4]=p;d[5]=l;d[6]=e;d[7]=0;d[8]=n;d[9]=s;d[10]=f;d[11]=0;d[12]=-(h*q+p*D+n*c);d[13]=-(k*q+l*D+s*c);d[14]=-(b*q+e*D+f*c);d[15]=1;return d};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+
", "+a[13]+", "+a[14]+", "+a[15]+")"};a.Zv=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.fD=a)};b4w.module.__gpp_eval=function(a){a.Up=function(){function a(c,b,e,d,h,p){this.message=c;this.offset=d;this.uh=h;this.Gf=p;this.name="SyntaxError"}(function(a,b){function e(){this.constructor=a}e.prototype=b.prototype;a.prototype=new e})(a,Error);return{FB:a,parse:function(c){function b(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function e(a){if(Cb!==a){Cb>a&&(Cb=0,za={uh:1,Gf:1,Th:!1});var b=za,d,e;for(d=Cb;d<a;d++)e=
c.charAt(d),"\n"===e?(b.Th||b.uh++,b.Gf=1,b.Th=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(b.uh++,b.Gf=1,b.Th=!0):(b.Gf++,b.Th=!1);Cb=a}return za}function d(a){C<Za||(C>Za&&(Za=C,Db=[]),Db.push(a))}function h(){var a,b,e;a=C;b=U();b!==z?(b=p(),b!==z?(e=U(),e!==z?(W++,10===c.charCodeAt(C)?(e=Rb,C++):(e=z,0===W&&d(ub)),e===z&&(c.substr(C,2)===Sa?(e=Sa,C+=2):(e=z,0===W&&d(Xa)),e===z&&(13===c.charCodeAt(C)?(e=mb,C++):(e=z,0===W&&d(ja)))),W--,e===z&&0===W&&d(dc),e===z&&(e=fa),e!==z?a=b:(C=a,a=J)):(C=a,a=
J)):(C=a,a=J)):(C=a,a=J);return a}function p(){var a,b,e,f,g,k,l,h;a=C;b=n();if(b!==z){e=[];f=C;g=U();g!==z?(44===c.charCodeAt(C)?(k=da,C++):(k=z,0===W&&d(ga)),k!==z?(l=U(),l!==z?(h=n(),h!==z?f=g=[g,k,l,h]:(C=f,f=J)):(C=f,f=J)):(C=f,f=J)):(C=f,f=J);for(;f!==z;)e.push(f),f=C,g=U(),g!==z?(44===c.charCodeAt(C)?(k=da,C++):(k=z,0===W&&d(ga)),k!==z?(l=U(),l!==z?(h=n(),h!==z?f=g=[g,k,l,h]:(C=f,f=J)):(C=f,f=J)):(C=f,f=J)):(C=f,f=J);e!==z?a=b=0==e.length?b:e[e.length-1]:(C=a,a=J)}else C=a,a=J;return a}function n(){var a,
b,e,f;a=C;b=k();b!==z?(e=U(),e!==z?(63===c.charCodeAt(C)?(e=v,C++):(e=z,0===W&&d(T)),e!==z?(e=U(),e!==z?(e=p(),e!==z?(f=U(),f!==z?(58===c.charCodeAt(C)?(f=ua,C++):(f=z,0===W&&d(va)),f!==z?(f=U(),f!==z?(f=p(),f!==z?a=b?e:f:(C=a,a=J)):(C=a,a=J)):(C=a,a=J)):(C=a,a=J)):(C=a,a=J)):(C=a,a=J)):(C=a,a=J)):(C=a,a=J)):(C=a,a=J);a===z&&(a=k());return a}function k(){var a,b,c,d,e,f,g,k;a=C;b=l();if(b!==z){c=[];d=C;e=U();e!==z?(f=R(),f!==z?(g=U(),g!==z?(k=l(),k!==z?d=e=[e,f,g,k]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):
(C=d,d=J);for(;d!==z;)c.push(d),d=C,e=U(),e!==z?(f=R(),f!==z?(g=U(),g!==z?(k=l(),k!==z?d=e=[e,f,g,k]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);if(c!==z)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else C=a,a=J}else C=a,a=J;return a}function l(){var a,b,c,d,e,f,g,k;a=C;b=s();if(b!==z){c=[];d=C;e=U();e!==z?(f=m(),f!==z?(g=U(),g!==z?(k=s(),k!==z?d=e=[e,f,g,k]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);for(;d!==z;)c.push(d),d=C,e=U(),e!==z?(f=m(),f!==z?(g=U(),g!==z?(k=s(),k!==z?d=e=[e,f,g,k]:(C=d,d=J)):(C=
d,d=J)):(C=d,d=J)):(C=d,d=J);if(c!==z)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else C=a,a=J}else C=a,a=J;return a}function s(){var a,b,c,d,e,g,k,l;a=C;b=f();if(b!==z){c=[];d=C;e=U();e!==z?(g=r(),g!==z?(k=U(),k!==z?(l=f(),l!==z?d=e=[e,g,k,l]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);for(;d!==z;)c.push(d),d=C,e=U(),e!==z?(g=r(),g!==z?(k=U(),k!==z?(l=f(),l!==z?d=e=[e,g,k,l]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);if(c!==z)for(a=b,b=0;b<c.length;b++)a|=c[b][3];else C=a,a=J}else C=a,a=J;return a}function f(){var a,
b,c,d,e,f,g,k;a=C;b=t();if(b!==z){c=[];d=C;e=U();e!==z?(f=L(),f!==z?(g=U(),g!==z?(k=t(),k!==z?d=e=[e,f,g,k]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);for(;d!==z;)c.push(d),d=C,e=U(),e!==z?(f=L(),f!==z?(g=U(),g!==z?(k=t(),k!==z?d=e=[e,f,g,k]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);if(c!==z)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else C=a,a=J}else C=a,a=J;return a}function t(){var a,b,c,d,e,f,g,k;a=C;b=A();if(b!==z){c=[];d=C;e=U();e!==z?(f=B(),f!==z?(g=U(),g!==z?(k=A(),k!==z?d=e=[e,f,g,k]:(C=d,d=
J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);for(;d!==z;)c.push(d),d=C,e=U(),e!==z?(f=B(),f!==z?(g=U(),g!==z?(k=A(),k!==z?d=e=[e,f,g,k]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);if(c!==z)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else C=a,a=J}else C=a,a=J;return a}function A(){var a,b,c,d,e,f,g,k;a=C;b=D();if(b!==z){c=[];d=C;e=U();e!==z?(f=K(),f!==z?(g=U(),g!==z?(k=D(),k!==z?d=e=[e,f,g,k]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);for(;d!==z;)c.push(d),d=C,e=U(),e!==z?(f=K(),f!==z?(g=U(),g!==z?(k=D(),k!==z?d=
e=[e,f,g,k]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);if(c!==z)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else C=a,a=J}else C=a,a=J;return a}function D(){var a,b,c,d,e,f,g,k;a=C;b=y();if(b!==z){c=[];d=C;e=U();e!==z?(f=H(),f!==z?(g=U(),g!==z?(k=y(),k!==z?d=e=[e,f,g,k]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);for(;d!==z;)c.push(d),d=C,e=U(),e!==z?(f=H(),f!==z?(g=U(),g!==z?(k=y(),k!==z?d=e=[e,f,g,k]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);if(c!==
z)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else C=a,a=J}else C=a,a=J;return a}function y(){var a,b,c,d,e,f,g,k;a=C;b=u();if(b!==z){c=[];d=C;e=U();e!==z?(f=M(),f!==z?(g=U(),g!==z?(k=u(),k!==z?d=e=[e,f,g,k]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);for(;d!==z;)c.push(d),d=C,e=U(),e!==z?(f=M(),f!==z?(g=U(),g!==z?(k=u(),k!==z?d=e=[e,f,g,k]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);if(c!==z)for(a=
b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else C=a,a=J}else C=a,a=J;return a}function u(){var a,b,c,d,e,f,k,l;a=C;b=g();if(b!==z){c=[];d=C;e=U();e!==z?(f=P(),f!==z?(k=U(),k!==z?(l=g(),l!==z?d=e=[e,f,k,l]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);for(;d!==z;)c.push(d),d=C,e=U(),e!==z?(f=P(),f!==z?(k=U(),k!==z?(l=g(),l!==z?d=e=[e,f,k,l]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);if(c!==z)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "+":a+=c[b][3];break;
case "-":a-=c[b][3]}else C=a,a=J}else C=a,a=J;return a}function g(){var a,b,c,d,e,f,g,k;a=C;b=E();if(b!==z){c=[];d=C;e=U();e!==z?(f=Q(),f!==z?(g=U(),g!==z?(k=E(),k!==z?d=e=[e,f,g,k]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);for(;d!==z;)c.push(d),d=C,e=U(),e!==z?(f=Q(),f!==z?(g=U(),g!==z?(k=E(),k!==z?d=e=[e,f,g,k]:(C=d,d=J)):(C=d,d=J)):(C=d,d=J)):(C=d,d=J);if(c!==z)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=Math.floor(a/c[b][3]);break;case "%":a%=c[b][3]}else C=
a,a=J}else C=a,a=J;return a}function E(){var a,e,f;a=C;c.substr(C,7)===Ka?(e=Ka,C+=7):(e=z,0===W&&d(aa));e!==z?(f=U(),f!==z?(f=w(),f!==z?a=f:(C=a,a=J)):(C=a,a=J)):(C=a,a=J);if(a===z){a=C;e=I();if(e!==z)if(f=U(),f!==z)if(c.substr(C,2)===ib?(f=ib,C+=2):(f=z,0===W&&d(La)),f===z&&(c.substr(C,2)===Ua?(f=Ua,C+=2):(f=z,0===W&&d(xb))),f!==z){a:{a=e;switch(f){case "++":e=++a;break a;case "--":e=--a;break a}e=void 0}a=e}else C=a,a=J;else C=a,a=J;else C=a,a=J;a===z&&(a=I());a===z&&(a=C,c.substr(C,2)===ib?(e=
ib,C+=2):(e=z,0===W&&d(La)),e===z&&(c.substr(C,2)===Ua?(e=Ua,C+=2):(e=z,0===W&&d(xb)),e===z&&(43===c.charCodeAt(C)?(e=jb,C++):(e=z,0===W&&d(Bc)),e===z&&(45===c.charCodeAt(C)?(e=Ib,C++):(e=z,0===W&&d(Ab)),e===z&&(126===c.charCodeAt(C)?(e=ya,C++):(e=z,0===W&&d(ac)),e===z&&(33===c.charCodeAt(C)?(e=sc,C++):(e=z,0===W&&d(Ra))))))),e!==z?(f=U(),f!==z?(f=E(),f!==z?a=e=b(e,f):(C=a,a=J)):(C=a,a=J)):(C=a,a=J))}return a}function I(){var a,b,e;W++;var f;a=C;48===c.charCodeAt(C)?(b=ba,C++):(b=z,0===W&&d(la));
if(b!==z)if(zb.test(c.charAt(C))?(b=c.charAt(C),C++):(b=z,0===W&&d(Ob)),b!==z){b=C;e=[];f=F();if(f!==z)for(;f!==z;)e.push(f),f=F();else e=J;e!==z&&(e=c.substring(b,C));b=e;b!==z?a=b=parseInt("0x"+b):(C=a,a=J)}else C=a,a=J;else C=a,a=J;if(a===z){a=C;48===c.charCodeAt(C)?(b=ba,C++):(b=z,0===W&&d(la));if(b===z)if(b=C,Na.test(c.charAt(C))?(e=c.charAt(C),C++):(e=z,0===W&&d(xa)),e!==z){var g;f=[];g=G();if(g!==z)for(;g!==z;)f.push(g),g=G();else f=J;f===z&&(f=fa);f!==z?b=e=[e,f]:(C=b,b=J)}else C=b,b=J;b!==
z&&(b=c.substring(a,C));a=b;a!==z&&(a=parseInt(a))}W--;a===z&&0===W&&d(ia);a===z&&(b=x(),b!==z&&(b=0),a=b,a===z&&(a=C,40===c.charCodeAt(C)?(b=Ya,C++):(b=z,0===W&&d(V)),b!==z?(b=U(),b!==z?(b=p(),b!==z?(e=U(),e!==z?(41===c.charCodeAt(C)?(e=Ea,C++):(e=z,0===W&&d(qa)),e!==z?a=b:(C=a,a=J)):(C=a,a=J)):(C=a,a=J)):(C=a,a=J)):(C=a,a=J)));return a}function w(){var a,b,e,f,g;b=x();b!==z&&(b=0);a=b;if(a===z){b=[];f=e=C;W++;40===c.charCodeAt(C)?(g=Ya,C++):(g=z,0===W&&d(V));g===z&&(41===c.charCodeAt(C)?(g=Ea,C++):
(g=z,0===W&&d(qa)));W--;g===z?f=N:(C=f,f=J);f!==z?(g=Z(),g!==z?e=f=[f,g]:(C=e,e=J)):(C=e,e=J);if(e!==z)for(;e!==z;)b.push(e),f=e=C,W++,40===c.charCodeAt(C)?(g=Ya,C++):(g=z,0===W&&d(V)),g===z&&(41===c.charCodeAt(C)?(g=Ea,C++):(g=z,0===W&&d(qa))),W--,g===z?f=N:(C=f,f=J),f!==z?(g=Z(),g!==z?e=f=[f,g]:(C=e,e=J)):(C=e,e=J);else b=J;b!==z&&(b=1);a=b;a===z&&(a=C,40===c.charCodeAt(C)?(b=Ya,C++):(b=z,0===W&&d(V)),b!==z?(e=U(),e!==z?(f=w(),f!==z?(g=U(),g!==z?(41===c.charCodeAt(C)?(b=Ea,C++):(b=z,0===W&&d(qa)),
b!==z?a=f:(C=a,a=J)):(C=a,a=J)):(C=a,a=J)):(C=a,a=J)):(C=a,a=J))}return a}function G(){var a;yb.test(c.charAt(C))?(a=c.charAt(C),C++):(a=z,0===W&&d(Ba));return a}function F(){var a;Fa.test(c.charAt(C))?(a=c.charAt(C),C++):(a=z,0===W&&d(Ta));return a}function x(){var a,b;W++;b=a=C;W++;var e,f,g,k;e=C;c.substr(C,7)===Ka?(f=Ka,C+=7):(f=z,0===W&&d(aa));f!==z?(g=C,W++,k=S(),W--,k===z?g=N:(C=g,g=J),g!==z?e=f=[f,g]:(C=e,e=J)):(C=e,e=J);W--;e===z?b=N:(C=b,b=J);if(b!==z){W++;b=C;e=O();if(e!==z){f=[];for(g=
S();g!==z;)f.push(g),g=S();f!==z?b=e+=f.join(""):(C=b,b=J)}else C=b,b=J;W--;b===z&&0===W&&d(fb);b!==z?a=b:(C=a,a=J)}else C=a,a=J;W--;a===z&&0===W&&d(fb);return a}function O(){var a;gb.test(c.charAt(C))?(a=c.charAt(C),C++):(a=z,0===W&&d(hb));a===z&&(36===c.charCodeAt(C)?(a=Ub,C++):(a=z,0===W&&d(Vb)),a===z&&(95===c.charCodeAt(C)?(a=Ia,C++):(a=z,0===W&&d(Aa))));return a}function S(){var a;a=O();a===z&&(a=G());return a}function Q(){var a,b,e,f;a=C;42===c.charCodeAt(C)?(b=bc,C++):(b=z,0===W&&d(Jb));b===
z&&(47===c.charCodeAt(C)?(b=Cc,C++):(b=z,0===W&&d(Lc)),b===z&&(37===c.charCodeAt(C)?(b=Uc,C++):(b=z,0===W&&d(Pb))));b!==z?(e=C,W++,61===c.charCodeAt(C)?(f=ob,C++):(f=z,0===W&&d(tc)),W--,f===z?e=N:(C=e,e=J),e!==z?a=b:(C=a,a=J)):(C=a,a=J);return a}function P(){var a,b,e;a=C;43===c.charCodeAt(C)?(b=jb,C++):(b=z,0===W&&d(Bc));b!==z?(b=C,W++,43===c.charCodeAt(C)?(e=jb,C++):(e=z,0===W&&d(Bc)),e===z&&(61===c.charCodeAt(C)?(e=ob,C++):(e=z,0===W&&d(tc))),W--,e===z?b=N:(C=b,b=J),b!==z?a="+":(C=a,a=J)):(C=a,
a=J);a===z&&(a=C,45===c.charCodeAt(C)?(b=Ib,C++):(b=z,0===W&&d(Ab)),b!==z?(b=C,W++,45===c.charCodeAt(C)?(e=Ib,C++):(e=z,0===W&&d(Ab)),e===z&&(61===c.charCodeAt(C)?(e=ob,C++):(e=z,0===W&&d(tc))),W--,e===z?b=N:(C=b,b=J),b!==z?a="-":(C=a,a=J)):(C=a,a=J));return a}function M(){var a;c.substr(C,2)===mc?(a=mc,C+=2):(a=z,0===W&&d(pb));a===z&&(c.substr(C,2)===nc?(a=nc,C+=2):(a=z,0===W&&d(Wb)));return a}function H(){var a;c.substr(C,2)===Qb?(a=Qb,C+=2):(a=z,0===W&&d(Y));a===z&&(c.substr(C,2)===ab?(a=ab,C+=
2):(a=z,0===W&&d(Va)),a===z&&(60===c.charCodeAt(C)?(a=ra,C++):(a=z,0===W&&d(uc)),a===z&&(62===c.charCodeAt(C)?(a=sa,C++):(a=z,0===W&&d(qb)))));return a}function K(){var a;c.substr(C,2)===rb?(a=rb,C+=2):(a=z,0===W&&d(oa));a===z&&(c.substr(C,2)===Ga?(a=Ga,C+=2):(a=z,0===W&&d(kb)));return a}function B(){var a,b,e;a=C;38===c.charCodeAt(C)?(b=ma,C++):(b=z,0===W&&d(Wa));b!==z?(b=C,W++,38===c.charCodeAt(C)?(e=ma,C++):(e=z,0===W&&d(Wa)),W--,e===z?b=N:(C=b,b=J),b!==z?a="&":(C=a,a=J)):(C=a,a=J);return a}function L(){var a,
b,e;a=C;94===c.charCodeAt(C)?(b=sb,C++):(b=z,0===W&&d(pa));b!==z?(b=C,W++,94===c.charCodeAt(C)?(e=sb,C++):(e=z,0===W&&d(pa)),W--,e===z?b=N:(C=b,b=J),b!==z?a="^":(C=a,a=J)):(C=a,a=J);return a}function r(){var a,b,e;a=C;124===c.charCodeAt(C)?(b=Oa,C++):(b=z,0===W&&d(tb));b!==z?(b=C,W++,124===c.charCodeAt(C)?(e=Oa,C++):(e=z,0===W&&d(tb)),W--,e===z?b=N:(C=b,b=J),b!==z?a="|":(C=a,a=J)):(C=a,a=J);return a}function m(){var a;c.substr(C,2)===Kb?(a=Kb,C+=2):(a=z,0===W&&d(cc));a!==z&&(a="&&");return a}function R(){var a;
c.substr(C,2)===Bb?(a=Bb,C+=2):(a=z,0===W&&d(lb));a!==z&&(a="||");return a}function U(){var a,b;a=[];for(b=X();b!==z;)a.push(b),b=X();return a}function X(){var a;W++;vc.test(c.charAt(C))?(a=c.charAt(C),C++):(a=z,0===W&&d(bb));W--;a===z&&0===W&&d(Dc);return a}function Z(){var a;c.length>C?(a=c.charAt(C),C++):(a=z,0===W&&d(cb));return a}var ha=1<arguments.length?arguments[1]:{},z={},ea={start:h},ka=h,J=z,fa=null,da=",",ga={type:"literal",value:",",description:'","'},v="?",T={type:"literal",value:"?",
description:'"?"'},ua=":",va={type:"literal",value:":",description:'":"'},Ka="defined",aa={type:"literal",value:"defined",description:'"defined"'},Ya="(",V={type:"literal",value:"(",description:'"("'},Ea=")",qa={type:"literal",value:")",description:'")"'},N=void 0,ia={type:"other",description:"number"},ba="0",la={type:"literal",value:"0",description:'"0"'},yb=/^[0-9]/,Ba={type:"class",value:"[0-9]",description:"[0-9]"},Na=/^[1-9]/,xa={type:"class",value:"[1-9]",description:"[1-9]"},zb=/^[xX]/,Ob=
{type:"class",value:"[xX]",description:"[xX]"},Fa=/^[0-9a-fA-F]/,Ta={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},fb={type:"other",description:"identifier"},Ub="$",Vb={type:"literal",value:"$",description:'"$"'},Ia="_",Aa={type:"literal",value:"_",description:'"_"'},gb=/^[a-zA-Z]/,hb={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},ib="++",La={type:"literal",value:"++",description:'"++"'},Ua="--",xb={type:"literal",value:"--",description:'"--"'},jb="+",Bc={type:"literal",value:"+",
description:'"+"'},Ib="-",Ab={type:"literal",value:"-",description:'"-"'},ya="~",ac={type:"literal",value:"~",description:'"~"'},sc="!",Ra={type:"literal",value:"!",description:'"!"'},bc="*",Jb={type:"literal",value:"*",description:'"*"'},Cc="/",Lc={type:"literal",value:"/",description:'"/"'},Uc="%",Pb={type:"literal",value:"%",description:'"%"'},ob="=",tc={type:"literal",value:"=",description:'"="'},mc="<<",pb={type:"literal",value:"<<",description:'"<<"'},nc=">>",Wb={type:"literal",value:">>",description:'">>"'},
Qb="<=",Y={type:"literal",value:"<=",description:'"<="'},ab=">=",Va={type:"literal",value:">=",description:'">="'},ra="<",uc={type:"literal",value:"<",description:'"<"'},sa=">",qb={type:"literal",value:">",description:'">"'},rb="==",oa={type:"literal",value:"==",description:'"=="'},Ga="!=",kb={type:"literal",value:"!=",description:'"!="'},ma="&",Wa={type:"literal",value:"&",description:'"&"'},sb="^",pa={type:"literal",value:"^",description:'"^"'},Oa="|",tb={type:"literal",value:"|",description:'"|"'},
Kb="&&",cc={type:"literal",value:"&&",description:'"&&"'},Bb="||",lb={type:"literal",value:"||",description:'"||"'},Dc={type:"other",description:"whitespace"},vc=/^[\t\x0B\f ]/,bb={type:"class",value:"[\\t\\x0B\\f ]",description:"[\\t\\x0B\\f ]"},dc={type:"other",description:"end of line"},Rb="\n",ub={type:"literal",value:"\n",description:'"\\n"'},Sa="\r\n",Xa={type:"literal",value:"\r\n",description:'"\\r\\n"'},mb="\r",ja={type:"literal",value:"\r",description:'"\\r"'},cb={type:"any",description:"any character"},
C=0,Cb=0,za={uh:1,Gf:1,Th:!1},Za=0,Db=[],W=0,Pa;if("startRule"in ha){if(!(ha.Gq in ea))throw Error("Can't start parsing from rule \""+ha.Gq+'".');ka=ea[ha.Gq]}Pa=ka();if(Pa!==z&&C===c.length)return Pa;Pa!==z&&C<c.length&&d({type:"end",description:"end of input"});throw function(b,d,f){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function k(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}
return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+
" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var l=e(f),h=f<c.length?c.charAt(f):null;null!==d&&g(d);return new a(null!==b?b:k(d,h),0,0,f,l.uh,l.Gf)}(null,Db,Za);}}}()};b4w.module.__md5=function(a){function q(a,h){var k=a[0],l=a[1],s=a[2],f=a[3],k=b(k,l,s,f,h[0],7,-680876936),f=b(f,k,l,s,h[1],12,-389564586),s=b(s,f,k,l,h[2],17,606105819),l=b(l,s,f,k,h[3],22,-1044525330),k=b(k,l,s,f,h[4],7,-176418897),f=b(f,k,l,s,h[5],12,1200080426),s=b(s,f,k,l,h[6],17,-1473231341),l=b(l,s,f,k,h[7],22,-45705983),k=b(k,l,s,f,h[8],7,1770035416),f=b(f,k,l,s,h[9],12,-1958414417),s=b(s,f,k,l,h[10],17,-42063),l=b(l,s,f,k,h[11],22,-1990404162),k=b(k,l,s,f,h[12],7,1804603682),f=b(f,k,l,s,
h[13],12,-40341101),s=b(s,f,k,l,h[14],17,-1502002290),l=b(l,s,f,k,h[15],22,1236535329),k=e(k,l,s,f,h[1],5,-165796510),f=e(f,k,l,s,h[6],9,-1069501632),s=e(s,f,k,l,h[11],14,643717713),l=e(l,s,f,k,h[0],20,-373897302),k=e(k,l,s,f,h[5],5,-701558691),f=e(f,k,l,s,h[10],9,38016083),s=e(s,f,k,l,h[15],14,-660478335),l=e(l,s,f,k,h[4],20,-405537848),k=e(k,l,s,f,h[9],5,568446438),f=e(f,k,l,s,h[14],9,-1019803690),s=e(s,f,k,l,h[3],14,-187363961),l=e(l,s,f,k,h[8],20,1163531501),k=e(k,l,s,f,h[13],5,-1444681467),f=
e(f,k,l,s,h[2],9,-51403784),s=e(s,f,k,l,h[7],14,1735328473),l=e(l,s,f,k,h[12],20,-1926607734),k=c(l^s^f,k,l,h[5],4,-378558),f=c(k^l^s,f,k,h[8],11,-2022574463),s=c(f^k^l,s,f,h[11],16,1839030562),l=c(s^f^k,l,s,h[14],23,-35309556),k=c(l^s^f,k,l,h[1],4,-1530992060),f=c(k^l^s,f,k,h[4],11,1272893353),s=c(f^k^l,s,f,h[7],16,-155497632),l=c(s^f^k,l,s,h[10],23,-1094730640),k=c(l^s^f,k,l,h[13],4,681279174),f=c(k^l^s,f,k,h[0],11,-358537222),s=c(f^k^l,s,f,h[3],16,-722521979),l=c(s^f^k,l,s,h[6],23,76029189),k=
c(l^s^f,k,l,h[9],4,-640364487),f=c(k^l^s,f,k,h[12],11,-421815835),s=c(f^k^l,s,f,h[15],16,530742520),l=c(s^f^k,l,s,h[2],23,-995338651),k=d(k,l,s,f,h[0],6,-198630844),f=d(f,k,l,s,h[7],10,1126891415),s=d(s,f,k,l,h[14],15,-1416354905),l=d(l,s,f,k,h[5],21,-57434055),k=d(k,l,s,f,h[12],6,1700485571),f=d(f,k,l,s,h[3],10,-1894986606),s=d(s,f,k,l,h[10],15,-1051523),l=d(l,s,f,k,h[1],21,-2054922799),k=d(k,l,s,f,h[8],6,1873313359),f=d(f,k,l,s,h[15],10,-30611744),s=d(s,f,k,l,h[6],15,-1560198380),l=d(l,s,f,k,h[13],
21,1309151649),k=d(k,l,s,f,h[4],6,-145523070),f=d(f,k,l,s,h[11],10,-1120210379),s=d(s,f,k,l,h[2],15,718787259),l=d(l,s,f,k,h[9],21,-343485551);a[0]=k+a[0]&4294967295;a[1]=l+a[1]&4294967295;a[2]=s+a[2]&4294967295;a[3]=f+a[3]&4294967295}function c(a,b,c,d,e,f){b=(b+a&4294967295)+(d+f&4294967295)&4294967295;return(b<<e|b>>>32-e)+c&4294967295}function b(a,b,d,e,h,f,t){return c(b&d|~b&e,a,b,h,f,t)}function e(a,b,d,e,h,f,t){return c(b&e|d&~e,a,b,h,f,t)}function d(a,b,d,e,h,f,t){return c(d^(b|~e),a,b,h,
f,t)}var h="0123456789abcdef".split("");a.dp=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var e=b.substring(d-64,d),f=[],t=void 0,t=0;64>t;t+=4)f[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);q(a,f)}b=b.substring(d-64);e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)e[d>>2]|=b.charCodeAt(d)<<(d%4<<3);e[d>>2]|=128<<(d%4<<3);if(55<d)for(q(a,e),d=0;16>d;d++)e[d]=0;e[14]=8*
c;q(a,e);for(b=0;b<a.length;b++){c=a[b];d="";for(e=0;4>e;e++)d+=h[c>>8*e+4&15]+h[c>>8*e&15];a[b]=d}return a.join("")}};b4w.module.animation=function(a,q){var c=q("__animation"),b=q("__constraints"),e=q("__physics"),d=q("__util");a.AB_CYCLIC=c.fr;a.AB_FINISH_RESET=c.gr;a.AB_FINISH_STOP=c.hr;var h=new Float32Array(4);a.is_animated=function(a){return c.kp(a)};a.get_actions=function(){for(var a=[],b=c.pw(),d=0;d<b.length;d++)a.push(b[d].name);return a};a.get_current_action=function(a){return c.Eo(a)};a.get_anim_names=function(a){return c.ij(a)?c.sw(a):[]};a.get_current_anim_name=function(a){if(!c.kp(a))return null;switch(c.tw(a)){case c.zr:case c.Br:case c.Ar:case c.Cr:return c.Eo(a);
case c.Dr:return c.Cw(a);default:return null}};a.apply=function(a,b){c.apply(a,b)};a.remove=function(a){c.remove(a)};a.apply_def=function(a){c.ti(a)};a.play=function(a,b,d){c.play(a,b,d);c.zm(a)};a.stop=function(a){c.stop(a)};a.is_play=function(a){return c.pl(a)};a.set_current_frame_float=function(a,b){c.Jj(a,b)};a.get_current_frame_float=function(a){return c.Fo(a)};a.set_frame=function(a,b){c.Jj(a,b);c.zm(a,0)};a.get_frame=function(a){return c.Fo(a)};a.get_frame_range=function(a){return a.f?[a.f.start,
a.f.start+a.f.length]:null};a.get_anim_start_frame=function(a){return a.f?a.f.start:-1};a.get_anim_length=function(a){return a.f?a.f.length:-1};a.cyclic=function(a,b){c.Tb(a,b)};a.is_cyclic=function(a){return c.kh(a)};a.set_behavior=function(a,b){c.mz(a,b)};a.get_behavior=function(a){return c.vw(a)};a.apply_smoothing=function(a,b,d){c.Zs(a,b,d)};a.update_object_animation=function(a,b){c.zm(a,b)};a.frame_to_sec=function(a){return c.Xv(a)};a.detect_collisions=function(a,b){b?e.oo(a):e.mo(a)};a.is_detect_collisions_used=
function(a){return e.bp(a)};a.get_bone_translation=function(a,c,e){if(!d.We(a))return null;e||(e=new Float32Array(3));b.xw(a,c,!1,h,null);e[0]=h[0];e[1]=h[1];e[2]=h[2];return e};a.get_first_armature_object=function(a){return d.Vb(a)?c.gh(a):null};a.update_object_transform=function(){throw"Deprecated method execution";};a.set_translation=function(){throw"Deprecated method execution";};a.set_translation_v=function(){throw"Deprecated method execution";};a.set_translation_rel=function(){throw"Deprecated method execution";
};a.get_translation=function(){throw"Deprecated method execution";};a.set_rotation_quat=function(){throw"Deprecated method execution";};a.set_rotation_quat_v=function(){throw"Deprecated method execution";};a.get_rotation_quat=function(){throw"Deprecated method execution";};a.set_rotation_euler=function(){throw"Deprecated method execution";};a.set_rotation_euler_v=function(){throw"Deprecated method execution";};a.set_scale=function(){throw"Deprecated method execution";};a.empty_reset_transform=function(){throw"Deprecated method execution";
}};b4w.module.assets=function(a,q){var c=q("__assets");a.AT_ARRAYBUFFER=c.Ag;a.AT_JSON=c.gk;a.AT_TEXT=c.Nm;a.AT_AUDIOBUFFER=c.ek;a.AT_IMAGE_ELEMENT=c.Bg;a.AT_AUDIO_ELEMENT=c.fk;a.enqueue=function(a,e,d){c.K(a,e,d)}};b4w.module.camera=function(a,q){function c(a,c){b.mj(a)?b.qq(a,c):d.error("set_pivot(): Wrong object or camera move style")}var b=q("__camera"),e=q("__config"),d=q("__print"),h=q("__constraints"),p=q("__transform"),n=q("__util"),k=q("vec3"),l=q("vec4"),s=q("quat"),f=q("mat4"),t=e.controls,A=new Float32Array(3);new Float32Array(3);var D=new Float32Array(4),y=new Float32Array(4);a.MS_STATIC=b.Xm;a.MS_ANIMATION=b.yr;a.MS_CONTROLS=b.ze;a.MS_TARGET_CONTROLS=b.ze;a.MS_EYE_CONTROLS=b.ik;a.is_camera=function(a){return b.Qf(a)};
a.set_move_style=$a();a.get_move_style=function(a){return b.Qf(a)?b.Nw(a):(d.error("Wrong object"),null)};a.change_eye_target_dist=function(){d.error("change_eye_target_dist() deprecated")};a.change_trans_speed=function(a,b){var c=a.d,d=c.tm[0],d=d*(1+b*t.Ct);c.tm=[d,d,d]};a.get_trans_speed=function(a){return b.Qf(a)?a.d.tm[0]:(d.error("Wrong object"),0)};a.set_look_at=function(a,c,d,e){var f=a.d;b.Ov(c,d,e,f.e,f.h);p.H(a)};a.get_eye=function(a){return a.d.e};a.set_pivot=c;a.get_pivot=function(a,
c){if(b.mj(a))return c||(c=new Float32Array(3)),k.copy(a.d.ef,c),c;d.error("set_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(a,c,e){if(b.mj(a)){var f=a.d;A[0]=0;A[1]=1;A[2]=0;s.setAxisAngle(A,c,D);n.iq(f.e,f.ef,D,f.e);A[0]=1;A[1]=0;A[2]=0;k.transformQuat(A,f.h,A);s.setAxisAngle(A,e,D);n.iq(f.e,f.ef,D,f.e);p.H(a)}else d.error("rotate_pivot(): wrong object")};a.apply_vertical_limits=function(a,b,c){a.d.qc={ah:b,fi:c}};a.clear_vertical_limits=function(a){a.d.qc=null};a.set_eye_params=
function(a,c,d){s.identity(a.d.h);b.Tl(a,Math.PI/2);b.hq(a,c);b.Tl(a,-d);p.H(a)};a.is_look_up=function(a){n.Xb(a.d.h,n.Jd,A);return 0<=A[1]?!0:!1};a.rotate=function(a,c,d){b.hq(a,c);b.Tl(a,-d);p.H(a)};a.get_angles=function(a,c){c||(c=new Float32Array(2));b.qw(a,c);return c};a.set_stereo_distance=function(a,c){for(var d=a.d.ca,e=0;e<d.length;e++){var f=d[e];f.type!=b.rb&&f.type!=b.Fb||b.Mz(f,c,f.Dd)}};a.get_stereo_distance=function(a){a=a.d.ca;for(var c=0;c<a.length;c++){var d=a[c];if(d.type==b.rb||
d.type==b.Fb)return d.Pj}return 0};a.is_underwater=function(a){return a.d.GA};a.translate_view=function(a,c,d,e){a=a.d.ca;for(var k=0;k<a.length;k++){var h=a[k];h.yb||b.gg(h,h.jb);var l=A;l[0]=-c;l[1]=-d;l[2]=0;f.translate(h.ta,l,h.ta);f.rotateZ(h.ta,e,h.ta);f.multiply(h.ta,h.Aa,h.wf);b.yt(h);b.wt(h)}};a.correct_up=function(a,b){b||(b=n.ib);h.ju(a,b)};a.zoom_object=function(a,e){if(b.mj(a)){p.Mo(e,!1,A);c(a,A);p.H(a);var f=p.No(e),k=b.rw(a)/2,f=f/Math.sin(k),k=p.oy(a,A);p.Fp(a,0,f-k,0);p.H(a)}else d.error("zoom_object(): wrong object")};
a.calc_ray=function(a,c,e,f){f||(f=new Float32Array(3));var h=a.d.ca[0];switch(h.type){case b.$c:case b.Cf:case b.rb:case b.Fb:var n=Math.tan(h.nd*Math.PI/360);y[0]=(2*c/h.width-1)*n*h.jb;y[1]=-1;y[2]=(2*e/h.height-1)*n;y[3]=0;l.transformMat4(y,a.d.I,y);f[0]=y[0];f[1]=y[1];f[2]=y[2];k.normalize(f,f);return f;default:return d.error("Non-compatible camera"),f}}};b4w.module.config=function(a,q){var c=q("__config");a.P_ULTRA=c.cn;a.P_HIGH=c.jk;a.P_LOW=c.bn;a.set=c.set;a.get=c.get;a.reset=c.reset};b4w.module.controls=function(a,q){var c=q("__print"),b=q("__controls");a.CT_CONTINUOUS=b.Qm;a.CT_TRIGGER=b.Tm;a.CT_SHOT=b.Sm;a.CT_LEVEL=b.Rm;a.KEY_SHIFT=16;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=
76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=
222;a.H_ROT=0;a.V_ROT=0;a.H_TRA=0;a.V_TRA=0;a.F_TRA=0;a.JUMP=0;a.X_TRA=0;a.Y_TRA=0;a.Z_TRA=0;a.set=function(){c.error("set() deprecated, use new sensor-based API")};a.get=function(){c.error("get() deprecated, use new sensor-based API");return null};a.get_type=function(){c.error("get_type() deprecated, use new sensor-based API");return null};a.release=function(){c.error("release() deprecated, use new sensor-based API")};a.create_custom_sensor=b.xu;a.create_keyboard_sensor=b.ao;a.create_collision_sensor=
b.uu;a.create_collision_impulse_sensor=b.tu;a.create_ray_sensor=b.Nu;a.create_mouse_click_sensor=b.Ku;a.create_mouse_wheel_sensor=b.Mu;a.create_mouse_move_sensor=b.Lu;a.create_touch_move_sensor=b.$u;a.create_touch_zoom_sensor=b.av;a.create_motion_sensor=b.Ju;a.create_vertical_velocity_sensor=b.cv;a.create_timer_sensor=b.Zu;a.reset_timer_sensor=b.dz;a.create_elapsed_sensor=b.Au;a.create_timeline_sensor=b.Yu;a.set_custom_sensor=function(a,c){b.jz(a,c)};a.get_custom_sensor=function(a){return a.value};
a.get_sensor_value=function(a,b,h){a=a.sb;if(!a||!a[b])return c.error("get_sensor_value(): wrong object"),null;b=a[b].xd[h];return b?b.value:(c.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,b,h){a=a.sb;if(!a||!a[b])return c.error("get_sensor_payload(): wrong object"),null;b=a[b].xd[h];return b?b.jc:(c.error("get_sensor_payload(): sensor not found"),null)};a.sensor_make_positive=function(){throw"Deprecated method execution";};a.sensor_make_negative=function(){throw"Deprecated method execution";
};a.create_sensor_lock=function(a,c,h){a.xl=c.slice(0);a.wl=Array(c.length);a.oj=h||b.lv};a.remove_sensor_lock=function(a){a.xl=null;a.wl=null;a.oj=null};a.create_sensor_manifold=b.eo;a.create_kb_sensor_manifold=function(a,c,h,p,n,k){p=b.ao(p);b.eo(a,c,h,[p],null,n,k)};a.check_sensor_manifolds=function(a){return b.On(a,null)};a.check_sensor_manifold=b.On;a.remove_sensor_manifolds=function(a){b.eq(a,null)};a.remove_sensor_manifold=b.eq;a.reset=b.reset;a.keydown_cb=b.Mx;a.keyup_cb=b.Nx;a.mouse_down_cb=
b.fy;a.mouse_up_cb=b.hy;a.mouse_wheel_cb=b.iy;a.mouse_move_cb=b.gy;a.touch_start_cb=b.BA;a.touch_move_cb=b.AA};b4w.module.constraints=function(a,q){var c=q("__constraints"),b=q("__physics"),e=q("__transform");a.append_stiff=function(a,h,p,n){h instanceof Array&&2==h.length?c.tn(a,h[0],h[1],p,n):c.un(a,h,p,n);e.H(a);b.Na(a)};a.append_semi_stiff=function(a,h,p,n){c.Ps(a,h,p,n);e.H(a);b.Na(a)};a.append_semi_stiff_cam=function(a,h,p,n,k,l,s,f){c.Os(a,h,p,n,k,l,s,f);e.H(a);b.Na(a)};a.append_semi_soft_cam=function(a,h,p){c.Ns(a,h,p);e.H(a);b.Na(a)};a.append_stiff_trans=function(a,h,p){c.Qs(a,h,p);e.H(a);b.Na(a)};
a.append_copy_trans=function(a,h,p){c.Ks(a,h,p);e.H(a);b.Na(a)};a.append_stiff_trans_rot=function(a,h,p,n){c.Rs(a,h,p,n);e.H(a);b.Na(a)};a.append_track=function(a,h){3==h.length?c.vn(a,h):c.Ss(a,h);e.H(a);b.Na(a)};a.append_follow=function(a,h,p,n){3==h.length?c.qn(a,h,p,n):c.Ls(a,h,p,n);e.H(a);b.Na(a)};a.remove=function(a){a.xa&&c.remove(a)}};b4w.module.data=function(a,q){var c=q("__print"),b=q("__data");a.load=b.load;a.load_and_add_new=b.load;a.unload=function(){b.Uq()};a.cleanup=a.unload;a.get_bpy_world=function(){c.error("get_bpy_world() deprecated");return null};a.set_debug_resources_root=b.yz;a.is_loaded=b.yc};b4w.module.debug=function(a,q){q("__batch");var c=q("__print"),b=q("__controls"),e=q("__debug"),d=q("__physics"),h=q("__scenegraph"),p=q("__scenes"),n=q("__sfx"),k=q("__textures"),l=q("__util"),s=q("vec3");a.physics_worker=function(){d.jv()};a.physics_id=function(a){c.log("O",d.Pv(a));for(var b=d.ow().l.n,e=0;e<b.length;e++){var k=b[e];k.qb.F==a&&c.log("B",k)}};a.visible_objects=function(){for(var a=p.o(),b=a.Gb.MESH,a=p.ma(a,"MAIN_OPAQUE").n,d=0;d<b.length;d++){var e=b[d],k=e.d;if("DYNAMIC"==k.type)for(var h=
0;h<a.length;h++){var g=a[h];if(g.T&&g.Ya==k){c.log(e.name,e);break}}}};a.object_info=function(a){for(var b=p.o(),d=b.Gb.MESH,e=0;e<d.length;e++){var k=d[e];if(k.name==a){c.log("Object",k);for(var h=p.cl(b),g=0;g<h.length;g++){for(var l=h[g],n=l.n,s=[],q=0;q<n.length;q++)n[q].Ya==k.d&&s.push(n[q]);c.log("Subscene "+l.type,s)}}}};a.objects_stat=function(){var a=p.o();console.log("Armatures: "+p.La(a,"ARMATURE").length);console.log("Cameras: "+p.La(a,"CAMERA").length);console.log("Curves: "+p.La(a,
"CURVE").length);console.log("Empties: "+p.La(a,"EMPTY").length);console.log("Lamps: "+p.La(a,"LAMP").length);console.log("Meshes: "+p.La(a,"MESH").length);console.log("Speakers: "+p.La(a,"SPEAKER").length)};a.num_vertices=function(){for(var a=0,b=p.o(),b=[p.ma(b,"MAIN_OPAQUE"),p.ma(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.n,e=0;e<d.length;e++){var k=d[e].m;k&&(a+=k.wj)}}return a};a.num_triangles=function(){for(var a=0,b=p.o(),b=[p.ma(b,"MAIN_OPAQUE"),p.ma(b,"MAIN_BLEND")],
c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.n,e=0;e<d.length;e++){var k=d[e].m;k&&(a+=k.Yf)}}return a};a.num_draw_calls=function(){var a=p.o(),a=[p.ma(a,"MAIN_OPAQUE"),p.ma(a,"MAIN_BLEND")];return a[0].n.length+a[1].n.length};a.geometry_stats=function(){for(var a=p.o(),b=p.cl(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.n,k=0;k<e.length;k++){var g=e[k].m,h=e[k].Ya;g&&("COLOR_PICKING"!=d.type&&"GLOW_MASK"!=d.type||h.Il)&&(a[g.id]=g)}}var e=d=c=b=0,l;
for(l in a)g=a[l],g=g.Sb,g.Mk&&(d++,e+=g.Mk/1048576),b++,c+=g.iv/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=p.o(),c=[p.ma(c,"MAIN_OPAQUE"),p.ma(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=e.n,k=0;k<e.length;k++){var g=e[k].m;if(g)for(var g=g.Pa,h=0;h<g.length;h++){var l=g[h];if("IMAGE"===l.source||"ENVIRONMENT_MAP"===l.source){var n=l.Wa;-1===a.indexOf(n)&&(a.push(n),l=4*l.width*l.height/1048576/l.Sg,l*=1.3333,
b+=l)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=p.o(),c=p.cl(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var h=e.i,g=[h.ab,h.ec];g.push.apply(g,e.Pb);for(e=0;e<g.length;e++){var l=g[e];k.mh(l)&&-1==a.indexOf(l)&&(a.push(l),b+=h.width*h.height*k.Xw(l))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=p.o();(a=p.ma(a,"MAIN_OPAQUE"))&&p.Bp(a.i,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=p.o(),b=
p.ma(a,"MAIN_OPAQUE"),a=p.om(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}p.Bp(d.i,b,e)}};a.scenegraph_to_dot=function(){var a=p.o();c.log(h.gv(p.fl(a)))};a.controls_info=b.debug;a.object_distance=function(a,b){return s.dist(a.d.e,b.d.e)};a.msg=e.El;a.fbmsg=e.Uk;a.print_telemetry=e.My;a.plot_telemetry=e.Hy;a.fbres=function(a,b){function c(){e.Uk("FBRES",a());setTimeout(c,b)}b||(b=16);
c()};a.check_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),k=new Float32Array([-1,0,0]),g=new Float32Array([0,-1,0]),h=new Float32Array([0,0,-1]);if(!l.Td(a,l.zs))throw"Wrong VEC3_IDENT";if(!l.Td(b,l.us))throw"Wrong QUAT4_IDENT";if(!l.Td(c,l.Pm))throw"Wrong AXIS_X";if(!l.Td(d,l.ib))throw"Wrong AXIS_Y";if(!l.Td(e,l.hk))throw"Wrong AXIS_Z";if(!l.Td(k,l.ir))throw"Wrong AXIS_MX";if(!l.Td(g,
l.Jd))throw"Wrong AXIS_MY";if(!l.Td(h,l.Om))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=n.So(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==n.To(c)&&n.Gp(c,!0)}};a.check_finite=$a();a.set_debug_params=function(a){var b=p.o();if(b=p.ma(b,"WIREFRAME"))"wireframe_mode"in a&&p.Tz(b,a.wireframe_mode),"wireframe_edge_color"in a&&p.Sz(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return c.Hw()};a.get_warning_quantity=function(){return c.ax()};
a.clear_errors_warnings=function(){return c.Vt()}};b4w.module.geometry=function(a,q){function c(a){return a&&a.d&&a.d.Oe?!0:!1}var b=q("__batch"),e=q("__geometry"),d=q("__print");a.extract_vertex_array=function(a,p,n){if(!c(a))return d.error("Wrong object:",a.name),null;if(a=b.L(a,p,"MAIN")||b.L(a,p,"NODES")||b.L(a,p,"SHADELESS")){if((p=a.Sb)&&p.kc&&p.kc[n])return e.Kv(p,n);d.error("Attribute not found:"+n);return null}d.error("Wrong material:",p);return null};a.extract_index_array=function(a,e){if(!c(a))return d.error("Wrong object:",a.name),null;
var n=b.L(a,e,"MAIN")||b.L(a,e,"NODES")||b.L(a,e,"SHADELESS");if(n){if((n=n.Sb)&&n.kc)return n.de;d.error("Buffer data not found");return null}d.error("Wrong material:",e);return null};a.update_vertex_array=function(a,p,n,k){var l=["MAIN","NODES","SHADELESS","DEPTH","COLOR_ID"];if(c(a))for(var s=0;s<l.length;s++){var f=b.L(a,p,l[s]);if(f){var t=f.Sb;if(t&&t.kc&&t.kc[n]&&(e.tf(t,n,0,k),f.tb))for(t=0;t<f.tb.length;t++){var q=f.tb[t].Sb;q&&q.kc&&q.kc[n]&&e.tf(q,n,0,k)}}}else d.error("Wrong object:",
a.name)}};b4w.module.hud=function(a,q){q("__print");var c=q("__hud");a.plot_array=c.Gy;a.draw_mixer_strip=c.zv};b4w.module.lights=function(a,q){function c(a){for(var c=d.o(),l=d.La(c,"LAMP"),s=0;s<l.length;s++){var q=l[s];if("SUN"==q.tc.type){var u=q;break}}if(!u)return b.error("There is no sun on the scene"),null;"hor_position"in a&&"vert_position"in a&&(l=(90-a.vert_position)/180*Math.PI,s=u.d,h.Wl(u,[l,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),p.Xb(s.h,p.ib,a),s=n.length(s.e),n.copy(a,k),n.scale(k,s,k),h.Rc(u,k),h.H(u),a=u.tc,a.Cv&&(q=u.data.energy,s=c.world.light_settings.environment_energy,
l=Math.cos(Math.abs(l)),q*=Math.max(Math.min(3*l,1),0),l=Math.max(l,0.1)*s,e.pq(a,q),d.nq(c,l,null,null)),d.Vj(u,c))}var b=q("__print"),e=q("__lights"),d=q("__scenes"),h=q("__transform"),p=q("__util"),n=q("vec3"),k=new Float32Array(3),l,s=60;a.get_lamps=function(a){var b=d.o(),b=d.La(b,"LAMP");if(!a)return b;for(var c=[],e=0;e<b.length;e++){var k=b[e];k.tc.type===a&&c.push(k)}return c};a.get_sun_params=function(){for(var a=d.o(),a=d.La(a,"LAMP"),b=null,c=0;c<a.length;c++){var e=a[c];if("SUN"==e.tc.type){b=
e;break}}return b?(b=b.tc.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=c;a.set_day_time=function(a){for(var e=d.o(),e=d.La(e,"LAMP"),k=0;k<e.length;k++){var h=e[k];if("SUN"==h.tc.type){var l=h;break}}if(!l)return b.error("There is no sun on the scene"),null;l=-Math.cos(a/12*Math.PI)*s;e={};e.hor_position=12>a?15*a:15*(a-24);e.vert_position=l;c(e)};a.set_date=
function(a){(l=a.getDate())?1582==l&&10==a.cD&&4<a.fv&&15>a.fv&&b.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):b.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){s=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){var c=d.o();if(!c)return b.error("No active scene"),!1;for(var c=d.La(c,"LAMP"),e=0;e<c.length;e++){var k=c[e];if(k.name===a){var h=k.tc;break}}return h?{light_color:h.color,light_energy:h.Kf}:(b.error('B4W Warning: light "'+
a+'" not found'),!1)};a.set_light_params=function(a,c){var k=d.o();if(!k)return b.error("No active scene"),!1;for(var h=d.La(k,"LAMP"),l=0;l<h.length;l++){var n=h[l];if(n.name===a){var g=n.tc;break}}if(!g)return b.error('B4W Warning: light "'+a+'" not found'),!1;"light_energy"in c&&(e.pq(g,c.light_energy),d.Vj(n,k));"light_color"in c&&(e.Hz(g,c.light_color),d.Vj(n,k))};a.get_lights_names=function(){var a=d.o();if(!a)return b.error("No active scene"),!1;for(var c=[],a=d.La(a,"LAMP"),e=0;e<a.length;e++)c.push(a[e].tc.name);
return c}};b4w.module.material=function(a,q){function c(a,b){for(var c=a.aa,d=0;d<c.length;d++){var e=c[d];if(-1<e.ob.indexOf(b)&&("MAIN"==e.type||"SHADELESS"==e.type))return!0}return!1}function b(a,b){var c=s.L(a,b,"MAIN");return Boolean(c&&c.ya)}function e(a,b){var c=s.L(a,b,"MAIN");return Boolean(c&&c.Hf)}function d(a,b){var c=s.L(a,b,"MAIN");return Boolean(c&&c.Nb)}function h(a,b){var c=s.L(a,b,"MAIN");return Boolean(c&&c.Ob&&c.Ob[0])}function p(a,b){var c=s.L(a,b,"MAIN");return Boolean(c&&c.Ob&&c.Ob[1])}
function n(a,b){var c=s.L(a,b,"MAIN");return Boolean(c&&c.Pe)}function k(a,b){var c=s.L(a,b,"MAIN");return Boolean(c&&c.ad)}function l(a,b){var c=s.L(a,b,"MAIN");return Boolean(c&&c.kd)}var s=q("__batch"),f=q("__config"),t=q("__print"),A=q("__shaders"),D=q("__util"),y=f.s,u="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.max_bones=function(){t.error("max_bones() deprecated, return default value");return y.Jb};a.set_max_bones=function(){t.error("set_max_bones() deprecated")};
a.set_batch_param=function(){t.error("set_batch_param() deprecated")};a.inherit_material=function(a,b,c,d){if(D.lp(c)&&D.lp(a)){for(var e=["MAIN","DEPTH","COLOR_ID"],f=!1,k=0;k<e.length;k++){var h=e[k],l=s.L(a,b,h),n=s.L(c,d,h);if(l&&n)for(f=!0,"MAIN"==h&&(n.ya[0]=l.ya[0],n.ya[1]=l.ya[1],n.ya[2]=l.ya[2],n.ya[3]=l.ya[3],n.Hf=l.Hf,n.Nb[0]=l.Nb[0],n.Nb[1]=l.Nb[1],n.Nb[2]=l.Nb[2],n.Ob[0]=l.Ob[0],n.Ob[1]=l.Ob[1],n.Pe=l.Pe,n.ad=l.ad,n.ad=l.ad,isNaN(n.kd)||isNaN(l.kd)||(n.kd=l.kd)),h=0;h<n.$b.length;h++){var p=
n.$b[h];if(-1!==u.indexOf(p)){var q=l.$b.indexOf(p);if(-1!==q&&(n.Pa[h]=l.Pa[q],n.tb))for(h=0;h<n.tb.length;h++){var y=n.tb[h],A=y.$b.indexOf(p);-1!==A&&(y.Pa[A]=l.Pa[q])}}}}f||t.error("Wrong objects for inheriting material!")}else t.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++)b.push(a[c].name);return b};a.set_diffuse_color=function(a,c,d){b(a,c)||t.error('Property "diffuse_color" is missing!');a=s.L(a,c,"MAIN");a.ya[0]=
d[0];a.ya[1]=d[1];a.ya[2]=d[2];a.ya[3]=d[3]};a.get_diffuse_color=function(a,c){b(a,c)||t.error('Property "diffuse_color" is missing!');var d=s.L(a,c,"MAIN"),e=Array(4);e[0]=d.ya[0];e[1]=d.ya[1];e[2]=d.ya[2];e[3]=d.ya[3];return e};a.check_diffuse_color=b;a.set_diffuse_intensity=function(a,b,c){e(a,b)||t.error('Property "diffuse_intensity" is missing!');s.L(a,b,"MAIN").Hf=c};a.get_diffuse_intensity=function(a,b){e(a,b)||t.error('Property "diffuse_intensity" is missing!');return s.L(a,b,"MAIN").Hf};
a.check_diffuse_intensity=e;a.set_specular_color=function(a,b,c){d(a,b)||t.error('Property "specular_color" is missing!');a=s.L(a,b,"MAIN");a.Nb[0]=c[0];a.Nb[1]=c[1];a.Nb[2]=c[2]};a.get_specular_color=function(a,b){d(a,b)||t.error('Property "specular_color" is missing!');var c=s.L(a,b,"MAIN"),e=Array(3);e[0]=c.Nb[0];e[1]=c.Nb[1];e[2]=c.Nb[2];return e};a.check_specular_color=d;a.set_specular_intensity=function(a,b,c){h(a,b)||t.error('Property "specular_intensity" is missing!');s.L(a,b,"MAIN").Ob[0]=
c};a.get_specular_intensity=function(a,b){h(a,b)||t.error('Property "specular_intensity" is missing!');return s.L(a,b,"MAIN").Ob[0]};a.check_specular_intensity=h;a.set_specular_hardness=function(a,b,c){p(a,b)||t.error('Property "specular_hardness" is missing!');s.L(a,b,"MAIN").Ob[1]=c};a.get_specular_hardness=function(a,b){p(a,b)||t.error('Property "specular_hardness" is missing!');return s.L(a,b,"MAIN").Ob[1]};a.check_specular_hardness=p;a.set_emit_factor=function(a,b,c){n(a,b)||t.error('Property "emit" is missing!');
s.L(a,b,"MAIN").Pe=c};a.get_emit_factor=function(a,b){n(a,b)||t.error('Property "emit" is missing!');return s.L(a,b,"MAIN").Pe};a.check_emit_factor=n;a.set_ambient_factor=function(a,b,c){k(a,b)||t.error('Property "ambient" is missing!');s.L(a,b,"MAIN").ad=c};a.get_ambient_factor=function(a,b){k(a,b)||t.error('Property "ambient" is missing!');return s.L(a,b,"MAIN").ad};a.check_ambient_factor=k;a.set_diffuse_color_factor=function(a,b,c){l(a,b)||t.error('Property "diffuse_color_factor" is missing!');
s.L(a,b,"MAIN").kd=c};a.get_diffuse_color_factor=function(a,b){l(a,b)||t.error('Property "diffuse_color_factor" is missing!');return s.L(a,b,"MAIN").kd};a.check_diffuse_color_factor=l;a.get_material_extended_params=function(a,b){if(!a||!b)return t.error("B4W Error: missing arguments in get_material_params"),null;if(!c(a,b))return null;var d=s.L(a,b,"MAIN");if(!d)return null;var e={};"MAIN"==d.type&&(e.reflect_factor=d.Ql,e.fresnel=d.od[2],e.fresnel_factor=5*(1-d.od[3]),e.parallax_scale=d.Jl,e.parallax_steps=
s.eb(d,"PARALLAX_STEPS")[1]);return e};a.get_water_material_params=function(a,b){if(!a||!b)return t.error("B4W Error: missing arguments in get_water_material_params"),null;if(!c(a,b))return null;var d=s.L(a,b,"MAIN");if(!d||!d.yg)return null;if(!d)return t.warn("B4W Warning: material not found"),null;var e={};if("MAIN"==d.type){if(y.Sc){var f=e.shallow_water_col=Array(3);f[0]=d.lf[0];f[1]=d.lf[1];f[2]=d.lf[2];f=e.shore_water_col=Array(3);f[0]=d.mf[0];f[1]=d.mf[1];f[2]=d.mf[2];e.shallow_water_col_fac=
d.Xl;e.shore_water_col_fac=d.Zl}e.foam_factor=d.Wk;e.absorb_factor=s.eb(d,"ABSORB")[1];e.sss_strength=s.eb(d,"SSS_STRENGTH")[1];e.sss_width=s.eb(d,"SSS_WIDTH")[1];e.dst_noise_scale0=s.eb(d,"DST_NOISE_SCALE_0")[1];e.dst_noise_scale1=s.eb(d,"DST_NOISE_SCALE_1")[1];e.dst_noise_freq0=s.eb(d,"DST_NOISE_FREQ_0")[1];e.dst_noise_freq1=s.eb(d,"DST_NOISE_FREQ_1")[1];e.dir_min_shore_fac=s.eb(d,"DIR_MIN_SHR_FAC")[1];e.dir_freq=s.eb(d,"DIR_FREQ")[1];e.dir_noise_scale=s.eb(d,"DIR_NOISE_SCALE")[1];e.dir_noise_freq=
s.eb(d,"DIR_NOISE_FREQ")[1];e.dir_min_noise_fac=s.eb(d,"DIR_MIN_NOISE_FAC")[1];e.dst_min_fac=s.eb(d,"DST_MIN_FAC")[1];e.waves_hor_fac=s.eb(d,"WAVES_HOR_FAC")[1]}return e};a.set_material_extended_params=function(a,b,d){if(a&&b&&d){if(!c(a,b))return t.warn("B4W Warning: setting material params is not possible"),null;b=s.L(a,b,"MAIN");b?"MAIN"==b.type&&("material_reflectivity"in d&&a.d.Oc&&(b.Ql=d.material_reflectivity),"material_fresnel"in d&&(b.od[2]=d.material_fresnel),"material_fresnel_factor"in
d&&(b.od[3]=1-d.material_fresnel_factor/5),"material_parallax_scale"in d&&(b.Jl=d.material_parallax_scale),"material_parallax_steps"in d&&(a=A.u(parseFloat(d.material_parallax_steps)),s.qa(b,"PARALLAX_STEPS",a),s.Cb(b,!0))):t.warn("B4W Warning: material not found")}else t.error("B4W Error: missing arguments in set_material_params")};a.set_water_material_params=function(a,b,d){if(!a||!b||!d)return t.error("B4W Error: missing arguments in set_water_material_params"),null;if(!c(a,b))return t.warn("B4W Warning: setting water material params is not possible"),
null;a=s.L(a,b,"MAIN");if(!a)return t.warn("B4W Warning: material not found"),null;"MAIN"==a.type&&(y.Sc&&("shallow_water_col"in d&&(b=d.shallow_water_col,a.lf[0]=b[0],a.lf[1]=b[1],a.lf[2]=b[2]),"shallow_water_col_fac"in d&&(a.Xl=d.shallow_water_col_fac),"shore_water_col"in d&&(b=d.shore_water_col,a.mf[0]=b[0],a.mf[1]=b[1],a.mf[2]=b[2]),"shore_water_col_fac"in d&&(a.Zl=d.shore_water_col_fac)),y.Cc&&a.cr&&("shore_smoothing"in d&&(d.shore_smoothing?s.qa(a,"SHORE_SMOOTHING",1):s.qa(a,"SHORE_SMOOTHING",
0)),"absorb_factor"in d&&(b=A.u(parseFloat(d.absorb_factor)),s.qa(a,"ABSORB",b))),"foam_factor"in d&&y.Lc&&(a.Wk=d.foam_factor),y.rc&&a.rc&&("water_dynamic"in d&&(d.water_dynamic?s.qa(a,"DYNAMIC",1):s.qa(a,"DYNAMIC",0)),"waves_height"in d&&(b=A.u(parseFloat(d.waves_height)),s.qa(a,"WAVES_HEIGHT",b)),"waves_length"in d&&(b=A.u(parseFloat(d.waves_length)),s.qa(a,"WAVES_LENGTH",b)),"sss_strength"in d&&(b=A.u(parseFloat(d.sss_strength)),s.qa(a,"SSS_STRENGTH",b)),"sss_width"in d&&(b=A.u(parseFloat(d.sss_width)),
s.qa(a,"SSS_WIDTH",b)),"dst_noise_scale0"in d&&(b=A.u(parseFloat(d.dst_noise_scale0)),s.qa(a,"DST_NOISE_SCALE_0",b)),"dst_noise_scale1"in d&&(b=A.u(parseFloat(d.dst_noise_scale1)),s.qa(a,"DST_NOISE_SCALE_1",b)),"dst_noise_freq0"in d&&(b=A.u(parseFloat(d.dst_noise_freq0)),s.qa(a,"DST_NOISE_FREQ_0",b)),"dst_noise_freq1"in d&&(b=A.u(parseFloat(d.dst_noise_freq1)),s.qa(a,"DST_NOISE_FREQ_1",b)),"dir_min_shore_fac"in d&&(b=A.u(parseFloat(d.dir_min_shore_fac)),s.qa(a,"DIR_MIN_SHR_FAC",b)),"dir_freq"in d&&
(b=A.u(parseFloat(d.dir_freq)),s.qa(a,"DIR_FREQ",b)),"dir_noise_scale"in d&&(b=A.u(parseFloat(d.dir_noise_scale)),s.qa(a,"DIR_NOISE_SCALE",b)),"dir_noise_freq"in d&&(b=A.u(parseFloat(d.dir_noise_freq)),s.qa(a,"DIR_NOISE_FREQ",b)),"dir_min_noise_fac"in d&&(b=A.u(parseFloat(d.dir_min_noise_fac)),s.qa(a,"DIR_MIN_NOISE_FAC",b)),"dst_min_fac"in d&&(b=A.u(parseFloat(d.dst_min_fac)),s.qa(a,"DST_MIN_FAC",b)),"waves_hor_fac"in d&&(d=A.u(parseFloat(d.waves_hor_fac)),s.qa(a,"WAVES_HOR_FAC",d))),s.Cb(a,!0));
return!0}};b4w.module.physics=function(a,q){var c=q("__print"),b=q("__physics"),e=q("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){b.oo(a)};a.disable_simulation=function(a){b.mo(a)};a.has_simulated_physics=function(a){return b.bp(a)};a.set_gravity=function(a,e){a.l?b.Fz(a,e):c.error("No physics for object "+a.name)};a.set_damping=function(a,e,p){a.l?b.p("set_damping",a.l.F,e,p):c.error("No physics for object "+a.name)};a.reset_damping=function(a){if(a.l){var e=a.game;
b.p("set_damping",a.l.F,e.damping,e.rotation_damping)}else c.error("No physics for object "+a.name)};a.set_transform=function(a,c,e){b.rq.apply(this,arguments)};a.sync_transform=function(a){b.Na(a)};a.apply_velocity=function(a){b.at.apply(this,arguments)};a.apply_velocity_world=function(a){b.bt.apply(this,arguments)};a.apply_force=function(a,c,e,n,k,l){k=k||!1;l=l||!1;b.Vs.apply(this,arguments)};a.apply_torque=function(a,c,e,n){b.$s.apply(this,arguments)};a.vehicle_throttle=function(a,h){b.gc(a)||
b.hc(a)||c.error("Wrong object");b.Yq(a,e.$a(h,-1,1))};a.vehicle_throttle_inc=function(a,h,p){b.gc(a)||b.hc(a)||c.error("Wrong object");h=e.$a(h,0,1);var n=a.g.Lf;-1==p||1==p?n=Math.max(-1,Math.min(n+p*h,1)):0==p&&0<=n?(n-=h,n=Math.max(0,n)):0==p&&0>n?(n+=h,n=Math.min(0,n)):c.error("Wrong steering direction");b.Yq(a,e.$a(n,-1,1))};a.vehicle_steer=function(a,h){b.gc(a)||b.hc(a)||c.error("Wrong object");b.Xq(a,e.$a(h,-1,1))};a.vehicle_steer_inc=function(a,h,p){b.gc(a)||b.hc(a)||c.error("Wrong object");
h=e.$a(h,0,1);var n=a.g.kg;-1==p||1==p?n=Math.max(-1,Math.min(n+p*h,1)):0==p&&0<=n?(n-=h,n=Math.max(0,n)):0==p&&0>n?(n+=h,n=Math.min(0,n)):c.error("Wrong steering direction");b.Xq(a,e.$a(n,-1,1))};a.vehicle_brake=function(a,h){b.gc(a)||b.hc(a)||c.error("Wrong object");b.Wq(a,e.$a(h,0,1))};a.vehicle_brake_inc=function(a,h){b.gc(a)||b.hc(a)||c.error("Wrong object");h=e.$a(h,-1,1);var p=a.g.Ng;b.Wq(a,e.$a(p+p*h,0,1))};a.is_vehicle_chassis=function(a){return b.gc(a)};a.is_vehicle_hull=function(a){return b.hc(a)};
a.get_vehicle_name=function(a){if(b.gc(a)||b.hc(a))return a.b4w_vehicle_settings.name;c.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(b.gc(a)||b.hc(a))return a.g.Lf;c.error("Wrong object")};a.get_vehicle_steering=function(a){if(b.gc(a)||b.hc(a))return a.g.kg;c.error("Wrong object")};a.get_vehicle_brake=function(a){if(b.gc(a)||b.hc(a))return a.g.Ng;c.error("Wrong object")};a.get_vehicle_speed=function(a){if(b.gc(a)||b.hc(a))return b.Zw(a);c.error("Wrong object")};a.is_character=
function(a){return b.jj(a)};a.set_character_move_dir=function(a,c,e){b.pz(a,c,e)};a.set_character_move_type=function(a,c){b.qz(a,c)};a.set_character_dist_to_water=function(){c.warn("Function set_character_dist_to_water() is deprecated")};a.set_character_walk_velocity=function(a,c){b.vz(a,c)};a.set_character_run_velocity=function(a,c){b.uz(a,c)};a.set_character_fly_velocity=function(a,c){b.oz(a,c)};a.character_jump=function(a){b.Ft(a)};a.character_rotation_inc=function(a,c,e){b.Gt(a,c,e)};a.set_character_rotation_quat=
function(a,c){b.rD(a,c)};a.set_character_rotation=function(a,c,e){b.rz(a,c,e)};a.set_character_rotation_v=function(a,c){b.tz(a,c)};a.set_character_rotation_h=function(a,c){b.sz(a,c)};a.append_collision_test=function(a,c,e){b.pn(a,c,e)};a.remove_collision_test=function(a,c){b.cq(a,c)};a.apply_collision_impulse_test=function(a,c){b.wn(a,c)};a.clear_collision_impulse_test=function(a){b.Un(a)};a.append_ray_test=function(a,c,e,n,k,l){b.sn(a,c,e,n,k,l)};a.remove_ray_test=function(a,c,e,n,k){b.dq(a,e,n,
k)};a.apply_constraint=function(a,e,p,n,k,l,s,f,q,A){b.nl(e)&&b.nl(k)?b.Us(a,e,p,n,k,l,s,f,q,A):c.error("Wrong objects")};a.clear_constraint=function(a){b.nl(a)&&b.qx(a)?b.Ut(a):c.error("Wrong object")};a.pull_to_constraint_pivot=function(a,c,e,n,k,l){b.Oy(a,c,e,n,k,l)}};b4w.module.scenes=function(a,q){var c=q("__batch");q("__config");var b=q("__print"),e=q("__physics"),d=q("__renderer"),h=q("__scenes"),p=q("__util");q("__camera");var n=["MAIN_OPAQUE","MAIN_BLEND","MAIN_REFLECT","GOD_RAYS","SKY"];a.set_active=function(a){h.mq(p.Nc("name",a,h.bl()))};a.get_active=function(){return h.X()?h.o().name:""};a.get_scenes=function(){for(var a=h.bl(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_screen_scenes=function(){b.log("get_screen_scenes() deprecated");return""};
a.get_active_camera=function(){if(h.X())return h.o().camera;b.error("No active scene");return!1};a.get_object_by_name=function(a){if(!h.X())return b.error("No active scene"),null;var c=h.La(h.o()),c=p.tp("name",a,c);if(0==c.length)return b.warn("get_object_by_name("+a+"): not found"),null;if(1==c.length)return c[0];b.error("get_object_by_name("+a+"): name ambiguity");return null};a.get_object_by_empty_name=function(a,c){if(!h.X())return b.error("No active scene"),!1;for(var d=h.La(h.o()),e=0;e<d.length;e++){var n=
d[e];if(n.dupli_group&&n.name==a)for(var n=n.dupli_group.objects,p=0;p<n.length;p++){var q=n[p];if(q.origin_name==c)return q}}b.warn("get_object_by_empty_name("+a+", "+c+"): not found");return null};a.pick_object=function(a,c){if(!h.X())return b.error("No active scene"),"";var e=h.o(),f=h.ma(e,"COLOR_PICKING");if(f){d.Vi(f);f=f.i;c=f.height-c;for(var f=d.Xy(f.$d,a,c),e=e.Gb.MESH,n=0;n<e.length;n++){var p=e[n].fn;if(p&&5>Math.abs(255*p[0]-f[0])&&5>Math.abs(255*p[1]-f[1])&&5>Math.abs(255*p[2]-f[2]))return e[n].name}}else b.error("Color picking is not available");
return""};a.set_glow_intensity=function(a,b){for(var c=0;c<a.aa.length;c++){var d=a.aa[c];"COLOR_ID"==d.type&&(d.ae=b)}};a.apply_glow_anim=function(a,b,c,d){a.d&&a.d.oe&&h.xn(a,b,c,d)};a.apply_glow_anim_def=function(a){if(a.d&&a.d.oe){var b=a.d.il;h.xn(a,b.dx,b.fx,b.gx)}};a.clear_glow_anim=function(a){a.d&&a.d.oe&&h.Vn(a)};a.set_glow_color=function(a){var b=h.o();if(b=h.ma(b,"GLOW"))b.fj=a,b.Ma=!0};a.set_light_pos=function(){b.error("set_light_pos() deprecated, use lights module instead")};a.set_light_direction=
function(){b.error("set_light_direction() deprecated, use lights module instead")};a.set_dir_light_color=function(){b.error("set_dir_light_color() deprecated, use lights module instead")};a.get_lights_names=function(){b.error("set_dir_light_color() deprecated, use lights module instead")};a.get_shadow_params=function(){if(!h.X())return b.error("No active scene"),!1;var a=h.o();if(!h.ma(a,"SHADOW_CAST"))return null;var c={},d=h.ma(a,"BLUR_DEPTH");d&&(c.blur_depth_size_mult=d.Mg,c.blur_depth_edge_size=
d.Lg,c.blur_depth_diff_threshold=1E3*d.Kg);if(d=h.ma(a,"DEPTH"))c.shadow_visibility_falloff=d.Lj;d=a.d.Wh;c.csm_near=d.Ie;c.csm_far=d.Vg;c.csm_num=d.Xg;c.csm_lambda=d.Wg;c.csm_borders=h.Do(a);return c};a.set_shadow_params=function(a){if(!h.X())return b.error("No active scene"),!1;var d=h.o(),e=h.om(d,n),f=h.ma(d,"DEPTH");f&&"shadow_visibility_falloff"in a&&(f.Lj=a.shadow_visibility_falloff);for(var e=h.om(d,["BLUR_DEPTH"]),p=0;p<e.length;p++){f=e[p];if("blur_depth_size_mult"in a){f.Mg=a.blur_depth_size_mult;
var q=f.n,D=q[0].m;D&&D.$&&(c.yd(D,a.blur_depth_size_mult),h.Vh(f,1/f.i.width,1/f.i.width))}"blur_depth_edge_size"in a&&(f.Lg=a.blur_depth_edge_size);"blur_depth_diff_threshold"in a&&(f.Kg=a.blur_depth_diff_threshold/1E3);f.Ma=!0}f=d.d.Wh;"csm_near"in a&&(f.Ie=a.csm_near);"csm_far"in a&&(f.Vg=a.csm_far);"csm_lambda"in a&&(f.Wg=a.csm_lambda);if(f=h.ma(d,"DEPTH")){q=f.n;for(p=0;p<q.length;p++)a=q[p],a.Ya.Ab&&(D=a.m,c.sk(D,h.Do(d)),c.Cb(D));f.Ma=!0}h.Ul(d)};a.get_environment_colors=function(){if(!h.X())return b.error("No active scene"),
!1;var a=h.o();return h.Gw(a)};a.set_environment_colors=function(a,c,d){if(!h.X())return b.error("No active scene"),!1;var e=h.o();h.nq(e,parseFloat(a),c,d)};a.get_fog_color_density=function(a){if(!h.X())return b.error("No active scene"),!1;var c=h.o();return h.Kw(c,a)};a.set_fog_color_density=function(a){if(!h.X())return b.error("No active scene"),!1;var c=h.o();h.Cz(c,a)};a.get_ssao_params=function(){if(!h.X())return b.error("No active scene"),!1;var a=h.o();return h.Uw(a)};a.set_ssao_params=function(a){if(!h.X())return b.error("No active scene"),
!1;var c=h.o();h.Lz(c,a)};a.get_color_correction_params=function(){if(!h.X())return b.error("No active scene"),null;var a=h.o(),a=h.ma(a,"COMPOSITING");if(!a)return null;var c={};c.brightness=a.Og;c.contrast=a.Ug;c.exposure=a.dh;c.saturation=a.eg;return c};a.set_color_correction_params=function(a){if(!h.X())return b.error("No active scene"),null;var c=h.o(),c=h.ma(c,"COMPOSITING");if(!c)return null;"brightness"in a&&(c.Og=a.brightness);"contrast"in a&&(c.Ug=a.contrast);"exposure"in a&&(c.dh=a.exposure);
"saturation"in a&&(c.eg=a.saturation);c.Ma=!0};a.get_sky_params=function(){if(!h.X())return b.error("No active scene"),!1;var a=h.o();return h.Sw(a)};a.set_sky_params=function(a){if(!h.X())return b.error("No active scene"),!1;var c=h.o();h.Kz(c,a)};a.get_dof_params=function(){if(!h.X())return b.error("No active scene"),!1;var a=h.o();return h.ma(a,"DOF")?h.Fw(a):null};a.set_dof_params=function(a){if(!h.X())return b.error("No active scene"),!1;var c=h.o();h.Az(c,a)};a.get_god_rays_params=function(){if(!h.X())return b.error("No active scene"),
!1;var a=h.o();return h.ma(a,"GOD_RAYS")?h.Lw(a):null};a.set_god_rays_params=function(a){if(!h.X())return b.error("No active scene"),!1;var c=h.o();h.Ez(c,a)};a.get_bloom_params=function(){if(!h.X())return b.error("No active scene"),!1;var a=h.o();return h.ma(a,"BLOOM")?h.ww(a):null};a.set_bloom_params=function(a){if(!h.X())return b.error("No active scene"),!1;var c=h.o();h.nz(c,a)};a.get_wind_params=function(){return h.cx()};a.set_wind_params=function(a){if(!h.X())return b.error("No active scene"),
!1;var c=h.o();h.Rz(c,a)};a.get_water_surface_level=h.Wo;a.set_water_params=function(a){if(!h.X())return b.error("No active scene"),!1;var c=h.o();h.Qz(c,a)};a.get_water_mat_params=function(a){if(!h.X())return b.error("No active scene"),!1;var c=h.o();h.bx(c,a)};a.update_scene_materials_params=function(){if(!h.X())return b.error("No active scene"),!1;var a=h.o();h.RA(a)};a.append_object=function(){throw'Method "append_object" is deprecated';};a.add_object=function(){throw'Method "add_object" is deprecated';
};a.remove_object=function(){throw'Method "remove_object" is deprecated';};a.hide_object=function(a){h.o();h.ux(a)};a.show_object=function(a){h.o();h.$z(a)};a.is_visible=function(a){return a.d.rp};a.check_object=function(a){return h.X()?h.Nt(a,h.o()):(b.error("No active scene"),!1)};a.remove_all=function(){throw"unimplemented";};a.check_collision=Tc(!1);a.check_ray_hit=Tc(!1);a.get_appended_objs=function(a){var b=h.o();return h.dl(b,a)};a.get_object_name=function(a){return a?a.name:(b.error("Wrong object name"),
"")};a.get_object_type=function(a){return a&&a.type?a.type:(b.error("Wrong object ID"),"UNDEFINED")};a.get_object_children=function(a){return a.Kd.slice(0)};a.get_first_character=function(){for(var a=h.La(h.o(),"MESH"),b=0;b<a.length;b++){var c=a[b];if(e.jj(c))return c}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return h.Rw(a,b)};a.get_cam_water_depth=function(){return h.yw()}};b4w.module.sfx=function(a,q){var c=q("__scenes"),b=q("__sfx");a.play=function(a,c,h){b.play(a,c,h)};a.play_def=function(a){b.Wp(a)};a.is_play=function(a){return b.pl(a)};a.speaker_play=function(a,c,h,p){b.Tb(a,c);p&&b.Dj(a,p);b.play(a,0,h)};a.speaker_stop=function(a){b.stop(a)};a.stop=function(a){b.stop(a)};a.speaker_playback_rate=function(a,c){b.Dj(a,c)};a.playrate=function(a,c){b.Dj(a,c)};a.cyclic=function(a,c){b.Tb(a,c)};a.is_cyclic=function(a){return b.kh(a)};a.listener_reset_speed=function(){b.Rx()};
a.speaker_reset_speed=function(a){b.dA(a)};a.get_volume=function(a){return a&&"object"===typeof a?b.$w(a):b.Mw()};a.set_volume=function(a,c){a&&"object"===typeof a?b.uq(a,c):b.Iz(c)};a.mute=function(a,c){a&&"object"===typeof a?b.Gp(a,c):b.ky(c)};a.is_muted=function(a){return a&&"object"===typeof a?b.Lx(a):b.Kx()};a.get_speaker_objects=function(){return b.So().slice(0)};a.get_speakers=function(){return a.get_speaker_objects()};a.set_compressor_params=function(a){b.xz(c.o(),a)};a.get_compressor_params=
function(){return b.Bw(c.o())};a.duck=function(a,c,h){a&&"object"===typeof a?b.Av(a,c,h):b.Bv(c,h)};a.unduck=function(a){a&&"object"===typeof a?b.HA(a):b.IA()};a.apply_playlist=b.Xs;a.clear_playlist=b.Wt;a.set_positional_params=b.Jz;a.get_positional_params=b.Ow;a.set_filter_params=b.Bz;a.get_filter_params=b.Jw;a.get_filter_freq_response=b.Iw};b4w.module.shaders=function(a,q){function c(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function b(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);
if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function e(a){for(var b=1;999>=b;b++){var c={fa:"main.glslv",ea:"main.glslf",Y:[["MAX_BONES",b],["SKINNED",1],["FRAMES_BLENDING",a],["WIND_BEND",0],["DETAIL_BEND",0],["DYNAMIC_GRASS",0],["VERTEX_ANIM",0],["TEXTURE_COLOR",1],["TEXTURE_SPEC",1],["TEXTURE_NORM",1],["TEXTURE_MIRROR",1],["VERTEX_COLOR",1],["WATER_EFFECTS",1],["REFLECTIVE",0],["REFLECTION_PASS",0],["SHADOW_SRC_NONE",10],["SHADOW_SRC_RGBA",20],["SHADOW_SRC_RGBA_PCF",
30],["SHADOW_SRC_DEPTH",40],["SHADOW_SRC_VSM",50],["SHADOW_SRC_MASK",60],["SHADOW_SRC","SHADOW_SRC_DEPTH"],["CSM_SECTION1",1],["CSM_SECTION2",1],["CSM_SECTION3",0],["CSM_SECTION_DIST0",2.0001],["CSM_SECTION_DIST1",4.0001],["CSM_SECTION_DIST2",7.0001],["CSM_SECTION_DIST3",9.0001],["NUM_LIGHTS",4],["DOUBLE_SIDED_LIGHTING",1],["NUM_CAUSTS",3],["TEXTURE_COORDS_UV",10],["TEXTURE_COORDS_NORMAL",20],["TEXTURE_COORDS","TEXTURE_COORDS_NORMAL"],["DISABLE_FOG",0],["ALPHA_AS_SPEC",0],["TEXTURE_STENCIL_ALPHA_MASK",
0],["PARALLAX",0],["PARALLAX_STEPS",0],["TEXTURE_BLEND_TYPE_MIX",10],["TEXTURE_BLEND_TYPE_MULTIPLY",20],["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX"],["ALPHA",1],["ALPHA_CLIP",0],["SSAO_ONLY",0]]};try{s.el(c,null)}catch(d){return n.log("vertex uniforms limit exceeded, max bones =",b-1),b-1}n.log("shaders successfully compiled and linked")}return 999}function d(a){for(var b=l.bl(),c=0;c<b.length;c++)for(var d=l.La(b[c],"MESH"),e=0;e<d.length;e++){var f=d[e];if(f.aa)for(var k=0;k<f.aa.length;k++){var h=
f.aa[k];if(h.mc==a&&h.ob.length)return h.ob}}return null}function h(a){a.sort(function(a,b){return b.$k.ALU_OPS-a.$k.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],e=c.$k,f=c.dB,g=d(c.dv),g=g?"\t\t("+g.join(", ")+")":"\t\t(NA)";n.groupCollapsed("FRAG --\x3e","ALU",e.ALU_OPS,"TEX",e.TEX_OPS,"\t\tVERT --\x3e","ALU",f.ALU_OPS,"TEX",f.TEX_OPS,g);n.groupCollapsed("directives");for(var g=c.za.Y,k=0;k<g.length;k++){var h=g[k];n.log(h[0],h[1])}n.groupEnd();n.groupCollapsed("vert src");n.log(c.cB);n.groupEnd();
n.groupCollapsed("vert stats");for(var l in f)"ALU_OPS"!=l&&"TEX_OPS"!=l&&n.log(l,f[l]);n.groupEnd();n.groupCollapsed("frag src");n.log(c.$v);n.groupEnd();n.groupCollapsed("frag stats");for(l in e)"ALU_OPS"!=l&&"TEX_OPS"!=l&&n.log(l,e[l]);n.groupEnd();n.groupEnd()}}function p(a){function b(a){for(var c=l-1;0<=c;c--)if(a[c]+1>d[c].ug.length-1)a[c]=0;else{a[c]++;break}}function c(a){for(var b=Array(a.length),d=0;d<a.length;d++)b[d]=a[d];return b}for(var d=[],e=0;e<a.Qa.length;e++)d.push({name:a.Qa[e],
ug:[0,1]});for(e=0;e<a.Ja.length;e++){var f=a.Ja[e][0];d.push({name:f,ug:a.Ja[e][1]})}for(e=0;e<a.Ga.length;e++){for(var f=a.Ga[e][0],k=a.Ga[e][1],h=0;h<k.length;h++)d.push({name:k[h],ug:[10+10*h]});d.push({name:f,ug:k})}var l=d.length;a=[];for(var n,f=1,e=0;e<d.length;e++)f*=d[e].ug.length;for(e=0;e<f;e++){if(n)n=c(n),b(n);else for(n=Array(l),h=0;h<l;h++)n[h]=0;a.push(n)}f=[];for(e=0;e<a.length;e++){n=a[e];k=[];for(h=0;h<n.length;h++){var p=d[h];k.push([p.name,p.ug[n[h]]])}f.push(k)}return f}q("__config");
var n=q("__print"),k=q("__extensions"),l=q("__scenes"),s=q("__shaders");q("__util");var f=[{fa:"depth.glslv",ea:"depth.glslf",Y:{Qa:"SKINNED FRAMES_BLENDING WIND_BEND DETAIL_BEND VERTEX_ANIM TEXTURE_COLOR VERTEX_COLOR DEPTH_RGBA ALPHA CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 PCF_SHADOWS VSM_SHADOWS".split(" "),Ja:[["MAX_BONES",[100]],["CSM_SECTION_DIST0",[2.0001]],["CSM_SECTION_DIST1",[4.0001]],["CSM_SECTION_DIST2",[7.0001]],["CSM_SECTION_DIST3",[9.0001]],["PCF_TEXEL_SIZE",[1/1024]]],Ga:[["SHADOW_SOURCE",
["SHADOW_SOURCE_NONE","SHADOW_SOURCE_MAP","SHADOW_SOURCE_MASK"]]]}},{fa:"shadeless.glslv",ea:"shadeless.glslf",Y:{Qa:"SKINNED FRAMES_BLENDING WIND_BEND DETAIL_BEND VERTEX_ANIM VERTEX_COLOR TEXTURE_STENCIL_ALPHA_MASK REFLECTION TEXTURE_COLOR WATER_EFFECTS ALPHA ALPHA_CLIP DISABLE_FOG".split(" "),Ja:[["MAX_BONES",[100]]],Ga:[["TEXTURE_BLEND_TYPE",["TEXTURE_BLEND_TYPE_MIX","TEXTURE_BLEND_TYPE_MULTIPLY"]]]}},{fa:"color_id.glslv",ea:"color_id.glslf",Y:{Qa:"SKINNED FRAMES_BLENDING WIND_BEND DETAIL_BEND VERTEX_ANIM TEXTURE_COLOR ALPHA_CLIP".split(" "),
Ja:[["MAX_BONES",[100]]],Ga:[]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/anaglyph.glslf",Y:{Qa:[],Ja:[],Ga:[]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/antialiasing.glslf",Y:{Qa:[],Ja:[],Ga:[["AA_METHOD",["AA_METHOD_PASS","AA_METHOD_LIGHT","AA_METHOD_QUALITY"]]]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/blur_depth.glslf",Y:{Qa:[],Ja:[],Ga:[]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/compositing.glslf",Y:{Qa:[],Ja:[],
Ga:[]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/depth_pack.glslf",Y:{Qa:["DEPTH_RGBA"],Ja:[],Ga:[]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/dof.glslf",Y:{Qa:["DEPTH_RGBA"],Ja:[],Ga:[]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/edge.glslf",Y:{Qa:["DEPTH_RGBA"],Ja:[],Ga:[]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/bloom_combine.glslf",Y:{Qa:[],Ja:[],Ga:[]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/luminance.glslf",
Y:{Qa:[],Ja:[],Ga:[]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/luminance_av.glslf",Y:{Qa:[],Ja:[],Ga:[]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/luminance_trunced.glslf",Y:{Qa:[],Ja:[],Ga:[]}},{fa:"postprocessing/god_rays.glslv",ea:"postprocessing/god_rays.glslf",Y:{Qa:["DEPTH_RGBA","WATER_EFFECTS"],Ja:[["NUM_LIGHTS",[1,10,100]]],Ga:[]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/god_rays_combine.glslf",Y:{Qa:[],Ja:[],Ga:[]}},{fa:"special_skydome.glslv",
ea:"procedural_skydome.glslf",Y:{Ja:[["NUM_LIGHTS",[1,10,100]]],Ga:[]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/motion_blur.glslf",Y:{Qa:[],Ja:[["MAX_STEPS",[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,100]]],Ga:[]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/postprocessing.glslf",Y:{Qa:[],Ja:[],Ga:[["POST_EFFECT",["POST_EFFECT_NONE","POST_EFFECT_GRAYSCALE","POST_EFFECT_X_BLUR","POST_EFFECT_Y_BLUR"]]]}},{fa:"postprocessing/postprocessing.glslv",ea:"postprocessing/ssao.glslf",
Y:{Qa:["SSAO_WHITE"],Ja:[],Ga:[]}}];a.determine_max_bones=function(){return{max_bones:e(1),max_bones_no_blending:e(0)}};a.report_repeatful_compilation=function(){var a=s.hv(),b=0,c;for(c in a){var d=a[c],e=d.count;1<e&&n.log(e-1,d.Vz,d.tx);b+=e-1}n.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var d=s.zw(),e=0,f;for(f in d)a&&-1===f.indexOf(a)||e++;var e="of "+e+" analyzing...",l={};for(f in d)if(!a||-1!==f.indexOf(a)){var g=d[f],p;var q=g.ar;p=g.Ao;var w=k.Go();if(w){q=w.getTranslatedShaderSource(q);
p=w.getTranslatedShaderSource(p);var w=b("/nvidia_vert",q),G=c(w),F=b("/nvidia_frag",p),x=c(F);p={cB:q,HD:w,dB:G,$v:p,tC:F,$k:x}}else n.error("B4W Error: WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),p=void 0;w=g.za;q=w.fa+" + "+w.ea;p.dv=g;p.za=w;g=l[q]=l[q]||[];g.push(p);n.log(e)}for(q in l)n.group("%c"+q,"color: #800"),g=l[q],h(g),n.groupEnd()};a.compile_all=function(a,b){function c(){cleanup();for(var a=O;d.length&&a--;){var b=d.shift();n.log(b.El);s.el(b.za,
null)}setTimeout(c,S)}for(var d=[],e=0;e<f.length;e++){var g=f[e].fa,k=f[e].ea,h=p(f[e].Y),l=h.length,q="of "+l+" "+g+" + "+k,F=a||0,x=b||l;x>l&&(x=l);for(l=F;l<x;l++)d.push({za:{fa:g,ea:k,Y:h[l]},El:q})}var O=100,S=50;setTimeout(c,0)}};b4w.module.transform=function(a,q){var c=q("__print"),b=q("__physics"),e=q("__transform"),d=q("__util"),h=new Float32Array(3),p=new Float32Array(4);a.set_translation=function(a,c,d,p){h[0]=c;h[1]=d;h[2]=p;e.Rc(a,h);e.H(a);b.Na(a)};a.set_translation_v=function(a,c){e.Rc(a,c);e.H(a);b.Na(a)};a.set_translation_rel=function(a,c,l,p,f){h[0]=c;h[1]=l;h[2]=p;d.Sj(h,1,f.d.h,f.d.e,h);e.Rc(a,h);e.H(a);b.Na(a)};a.get_translation=function(a,b){b||(b=new Float32Array(3));e.Vo(a,b);return b};a.set_rotation=function(a,
c,d,h,f){p[0]=c;p[1]=d;p[2]=h;p[3]=f;e.pe(a,p);e.H(a);b.Na(a)};a.set_rotation_quat=a.set_rotation;a.set_rotation_v=function(a,c){e.pe(a,c);e.H(a);b.Na(a)};a.set_rotation_quat_v=a.set_rotation_v;a.get_rotation=function(a,b){b||(b=new Float32Array(4));e.Po(a,b);return b};a.get_rotation_quat=a.get_rotation;a.set_rotation_euler=function(a,c,d,p){h[0]=c;h[1]=d;h[2]=p;e.Wl(a,h);e.H(a);b.Na(a)};a.set_rotation_euler_v=function(a,c){e.Wl(a,c);e.H(a);b.Na(a)};a.set_scale=function(a,b){e.kf(a,b);e.H(a)};a.get_scale=
function(a){return e.hl(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return c.error("Wrong object: "+a.name),!1;e.Rc(a,[0,0,0]);e.pe(a,[0,0,0,1]);e.kf(a,1);e.H(a);b.Na(a)};a.get_object_size=function(a){return d.Vb(a)?e.No(a):(c.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,b,h){return d.Vb(a)?e.Mo(a,b,h):(c.error("Wrong object: "+a.name),null)};a.move_local=function(a,c,d,h){e.Fp(a,c,d,h);e.H(a);b.Na(a)}};b4w.module.util=function(a,q){var c=q("__print"),b=q("__util"),e=q("vec3");q("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=b.tp;a.keysearch=b.Nc;a.matrix_to_quat=function(a){return b.ge(a)};a.euler_to_quat=function(a){return b.Mf(a)};a.quat_to_euler=function(a){return b.Ry(a)};a.sign=b.nf;a.clamp=b.$a;a.quat_to_dir=
b.Xb;a.ground_project_quat=function(a,c){return b.$p(a,b.Jd,b.ib,b.Om,c)};a.cam_quat_to_mesh_quat=function(a,c){return b.At(a,c)};a.quat_project=function(a,h,p,n,k){return 0!=e.dot(p,n)?(c.error("Wrong in-plane direction"),null):b.$p(a,h,p,n,k)};a.hash_code=b.cp;a.smooth=b.jg;a.smooth_v=b.Yh;a.is_vector=b.nh;a.correct_cam_quat_up=b.iu;a.quat_to_angle_axis=b.Qy;a.random_from_array=b.Vy;a.xz_direction=b.nB};"object"==typeof module&&module.Sk&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,q){var c=q("__version");a.version=c.version;a.type=c.type;a.date=c.jo};"object"==typeof module&&module.Sk&&b4w.module.version(exports);b4w.module.main=function(a,q){function c(){}function b(){}function e(){}function d(a){for(var b=null,c=0;c<ea.length;c++){var d=ea[c];try{b=a.getContext(d,r)}catch(e){}if(b)break}return b}function h(a,c){a.addEventListener("webglcontextlost",function(a){a.preventDefault();y.error("B4W Error: WebGL context lost");n()},!1);I.Bc(c);var d=I.Pw();d&&y.log("%cRENDERER INFO:","color: #00a",c.getParameter(d.UNMASKED_VENDOR_WEBGL)+", "+c.getParameter(d.UNMASKED_RENDERER_WEBGL));S.Bc(c);w.Bc(c);H.Bc(c);M.Bc(c);
E.Bc(c);Q.vq(a.width,a.height);P.jh();X=0;b=f();l()}function p(){c=$a()}function n(){k()||(ha=performance.now()/1E3,P.pause(),O.pause())}function k(){return z<ha}function l(){ka(l);var a=performance.now()/1E3;Z||(Z=a);var c=a-Z;c<1/m.Dp||S.Ix()||(k()||(z>Z&&(c-=z-Math.max(ha,Z)),X+=c,E.update(),x.update(),g.update(),s(X,c),b(c)),Z=a)}function s(a,b){g.yc()&&(G.reset(),K.update(b),F.update(a,b),P.update(a,b),t.update(b),g.yc()&&(O.update(a,b),g.yc()&&(c(b,a),g.yc()&&(u.update(a,b),g.yc()&&Q.update(a,
b)))))}function f(){var a=60,b=0,c=0,d=m.Wv,f=m.Vv;return function(g){a=B.jg(1/g,a,g,d);b=B.jg(0,b,g,d);c=(c+1)%f;0==c&&e(Math.round(a),Math.round(b))}}var t=q("__animation"),A=q("__compat"),D=q("__config"),y=q("__print"),u=q("__controls"),g=q("__data"),E=q("__debug"),I=q("__extensions"),w=q("__geometry"),G=q("__hud"),F=q("__nla"),x=q("__assets"),O=q("__physics"),S=q("__renderer"),Q=q("__scenes"),P=q("__sfx"),M=q("__shaders"),H=q("__textures"),K=q("__transform"),B=q("__util"),L=q("__version"),r=D.context,
m=D.s,R=null,U=null,X=0,Z=0,ha=0,z=0,ea=["webgl","experimental-webgl"],ka=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/m.Dp)}}();a.init=function(a,b){y.Pz(m.Hk);var c=L.version()+" "+L.type()+" ("+L.jo()+")";y.log("%cINIT B4W ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;window.performance||(y.log("Apply performance workaround"),
window.performance={});window.performance.now||(y.log("Apply performance.now() workaround"),window.performance.now=function(){return(new Date).getTime()});R=a;c=d(a);if(!c)return null;h(R,c);A.Gz(c);D.Ys();y.log("%cSET PRECISION:","color: #00a",m.precision);b?(G.jh(b),U=b):(D.s.Nj=!1,D.hg.sj=!1);O.yx();return c};a.set_check_gl_errors=function(a){E.wz(a)};a.resize=function(a,b){R.style.width=a+"px";R.style.height=b+"px";U&&(U.style.width=a+"px",U.style.height=b+"px");R.width=a;R.height=b;U&&(U.width=
a,U.height=b);G.gi();Q.vq(a,b);S.clear();s(X,0)};a.set_fps_callback=function(a){e=a};a.clear_fps_callback=function(){e=$a()};a.set_on_before_render_callback=function(a){c=a};a.set_render_callback=function(a){c=a};a.clear_on_before_render_callback=function(){p()};a.clear_render_callback=function(){p()};a.global_timeline=function(){return X};a.set_texture_quality=function(){y.error("set_texture_quality() deprecated")};a.set_shaders_dir=function(){y.error("set_shaders_dir() deprecated")};a.redraw=function(){s(X,
0)};a.pause=n;a.resume=function(){k()&&(z=performance.now()/1E3,P.Sl(),O.Sl())};a.is_paused=k;a.reset=function(){g.Uq();U=R=null;z=ha=Z=X=0;e=$a();b=$a();c=$a()};a.canvas_data_url=$a()};b4w.animation=b4w.require("animation");b4w.assets=b4w.require("assets");b4w.camera=b4w.require("camera");b4w.config=b4w.require("config");b4w.controls=b4w.require("controls");b4w.constraints=b4w.require("constraints");b4w.data=b4w.require("data");b4w.debug=b4w.require("debug");b4w.geometry=b4w.require("geometry");
b4w.lights=b4w.require("lights");b4w.main=b4w.require("main");b4w.material=b4w.require("material");b4w.physics=b4w.require("physics");b4w.scenes=b4w.require("scenes");b4w.shaders=b4w.require("shaders");b4w.sfx=b4w.require("sfx");b4w.transform=b4w.require("transform");b4w.util=b4w.require("util");b4w.version=b4w.require("version");b4w.vec3=b4w.require("vec3");b4w.vec4=b4w.require("vec4");b4w.quat=b4w.require("quat");b4w.mat3=b4w.require("mat3");b4w.mat4=b4w.require("mat4");
for(var dd in b4w.main)b4w[dd]=b4w.main[dd];
