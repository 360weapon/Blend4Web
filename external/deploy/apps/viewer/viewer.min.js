b4w.module.storage=function(d,b){function B(){if(!localStorage)throw"Local storage is not supported";return localStorage.b4w?JSON.parse(localStorage.b4w):{}}var D=b("__print");d.set=function(b,d){var k=B();k[b]=String(d);if(!localStorage)throw"Local storage is not supported";localStorage.b4w=JSON.stringify(k)};d.cleanup=function(){if(!localStorage)throw"Local storage is not supported";delete localStorage.b4w};d.get=function(b){var d=B();return d[b]?d[b]:""};d.debug=function(){D.log(B())}};
if(window.b4w)window.b4w.storage=b4w.require("storage");else throw"Failed to register storage, load b4w first";b4w.module.camera_anim=function(d,b){var B=new Float32Array(3),D=new Float32Array(3),M=new Float32Array(3),G=new Float32Array(4),k=b("controls"),J=b("vec3"),E=b("quat");d.track_to_target=function(b,d,a,z,O,c,w,n){if(b&&d){if(b4w.util.is_vector(d))var l=d;else l=M,b4w.transform.get_object_center(d,!1,l);d=a||1;a=z||2;var v=O||1;O=c||1;D[0]=0;D[1]=-1;D[2]=0;var F=b4w.transform.get_rotation_quat(b);c=b4w.util.quat_to_dir(F,D);z=b4w.camera.get_angles(b);var S=b4w.transform.get_translation(b);J.subtract(l,
S,B);J.normalize(B,B);var y=E.rotationTo(c,B,E.create());E.multiply(y,F,G);b4w.util.correct_cam_quat_up(G,!1);J.subtract(l,S,D);var q=J.length(D)*(1-1/a),l=Math.asin(B[1]);a=Math.acos(-B[2]/Math.abs(Math.cos(l)));0<B[0]&&(a=2*Math.PI-a);var x=a-z[0],R=l-z[1];M[0]=0;M[1]=0;M[2]=-1;a=b4w.transform.get_rotation_quat(b);0>b4w.util.quat_to_dir(a,M)[1]?(R=0<c[1]?l-Math.PI+z[1]:l+Math.PI+z[1],x=0<x?-Math.PI+x:Math.PI+x):Math.abs(x)>Math.PI&&(x=0<x?x-2*Math.PI:x+2*Math.PI);var R=-R,f=0,l=k.create_elapsed_sensor();
c=Math.abs(x/d);d=Math.abs(R/d);var t=c>d?c:d,ga=t+v,s=ga+O,u=s+v,fa=x,ia=R,e=q;k.create_sensor_manifold(b,"TRACK_TO_TARGET",k.CT_CONTINUOUS,[l],null,function(a,c,y,b){if(b)if(f+=y,f<t){var d=x/t*y;y*=R/t;c=f/t;c=6*c*(1-c);d*=c;y*=c;fa-=d;ia-=y;b4w.camera.rotate(a,d,y)}else f<ga?(fa&&(b4w.camera.rotate(a,fa,ia),fa=0,n&&n()),c=(f-t)/v,y=-q*y/v,e-=d,b4w.transform.move_local(a,0,6*y*c*(1-c),0)):f<s?e&&(b4w.transform.move_local(a,0,e,0),e=0):f<u?(c=(f-s)/v,y=q*y/v,y=6*y*c*(1-c),b4w.transform.move_local(a,
0,y,0)):(b4w.transform.set_translation_v(a,S),k.remove_sensor_manifold(a,c),w&&w())})}};d.auto_rotate=function(b){function d(a,c,n,k){1==k&&b4w.camera.rotate_pivot(a,n*b,0)}function a(){k.remove_sensor_manifold(z,"AUTO_ROTATE");k.remove_sensor_manifold(z,"DISABLE_AUTO_ROTATE")}var z=b4w.scenes.get_active_camera();if("TARGET"!==z.data.b4w_move_style)throw"wrong camera type";if(k.check_sensor_manifold(z,"AUTO_ROTATE"))a();else{var B=k.create_mouse_move_sensor("X"),c=k.create_mouse_move_sensor("Y"),
w=k.create_mouse_click_sensor(),n=k.create_elapsed_sensor();k.create_sensor_manifold(z,"DISABLE_AUTO_ROTATE",k.CT_LEVEL,[B,c,w],function(a){return a[0]&&a[2]||a[1]&&a[2]},a);k.create_sensor_manifold(z,"AUTO_ROTATE",k.CT_CONTINUOUS,[n],function(a){return a[0]},d)}}};if(window.b4w)window.b4w.camera_anim=b4w.require("camera_anim");else throw"Failed to register camera_anim, load b4w first";b4w.module.mixer=function(d,b){function B(){l=n.length=0;v=D(100);F=new Float32Array(v.length);S=new Float32Array(v.length);var a=c.get_speakers();if(a.length){n.push(M());for(var q=0;q<a.length;q++)n.push(k(a[q]));n.sort(function(a,c){return"MASTER"==a.id?-1:"MASTER"==c.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==c.id?1:a.id.toUpperCase()<c.id.toUpperCase()?-1:a.id.toUpperCase()>c.id.toUpperCase()?1:0})}}function D(a){for(var c=new Float32Array(a),b=0,d=0;d<a;d++)c[d]=20*Math.pow(1E3,b),b+=1/(a-1);
return c}function M(){var a=G("MASTER");a.params.push(["VOLUME",c.get_volume(null),0,1,50,!1]);var q=c.get_compressor_params();q&&(a.params.push(["THRESHOLD",q.threshold,-100,0,100,!1]),a.params.push(["KNEE",q.knee,0,40,40,!1]),a.params.push(["RATIO",q.ratio,1,20,20,!1]),a.params.push(["ATTACK",q.attack,0,1,1E3,!1]),a.params.push(["RELEASE",q.release,0,1,1E3,!1]));a.mute=c.is_muted(null)?1:0;a.solo=-1;return a}function G(a){return{id:a,params:[],active_param:0,mute:-1,solo:-1,speaker:null}}function k(a){var q=
G(O.get_object_name(a));q.mute=c.is_muted(a)?1:0;q.solo=0;q.speaker=a;return q}function J(a){if(a.speaker){a.params.length=0;a.params.push(["VOLUME",c.get_volume(a.speaker),0,1,50,!1]);var q=c.get_positional_params(a.speaker);q&&(a.params.push(["DIST_REF",q.dist_ref,0,1E3,1E4,!1]),a.params.push(["ATTENUATION",q.attenuation,0,50,1E3,!1]),a.params.push(["DIST_MAX",q.dist_max,0,1E4,1E4,!1]));if(q=c.get_filter_params(a.speaker))a.params.push(["EQ_FREQ",q.freq,20,2E4,100,!0]),a.params.push(["EQ_Q",q.Q,
0,10,100,!1]),a.params.push(["EQ_GAIN",q.gain,-70,30,100,!1]);w.clamp(a.active_param,0,a.params.length-1)}}function E(a){for(var c=0;c<n.length;c++){var b=n[c];if(b!=a&&1==b.solo)return!0}return!1}function r(a){for(var b=0;b<n.length;b++){var d=n[b];d!=a&&0==d.mute&&0==d.solo&&c.mute(d.speaker,!1)}}function N(){if(0==n.length)return[0,-1];var a=8*Math.floor(l/8),c=a+7,a=w.clamp(a,0,n.length-1),c=w.clamp(c,0,n.length-1);return[a,c]}var a=b("controls");b("debug");var z=b("hud"),O=b("scenes"),c=b("sfx"),
w=b("util"),n=[],l=0,v=null,F=null,S=null;d.enable_mixer_controls=function(b){B();var d=a.create_keyboard_sensor(a.KEY_LEFT_SQ_BRACKET),k=a.create_keyboard_sensor(a.KEY_RIGHT_SQ_BRACKET),D=a.create_keyboard_sensor(a.KEY_SEMI_COLON),f=a.create_keyboard_sensor(a.KEY_SINGLE_QUOTE),t=a.create_keyboard_sensor(a.KEY_SHIFT),ga=a.create_timer_sensor(0.15),s=a.create_timer_sensor(0.05),d=[d,k,D,f,t,ga,s],k=function(u,f,c,e){if(1==e){c=Boolean(a.get_sensor_value(u,f,0))?-1:1;if(n.length)for(1==c&&l<n.length-
1?l++:-1==c&&0<l&&l--,c=N(),e=c[0];e<=c[1];e++)J(n[e]);"SWITCH_STRIP"==f?a.reset_timer_sensor(u,f,5,0.3):a.reset_timer_sensor(u,f,5,0)}else a.reset_timer_sensor(u,f,5,10)};a.create_sensor_manifold(b,"SWITCH_STRIP",a.CT_TRIGGER,d,function(a){return(a[0]||a[1])&&!a[4]},k);a.create_sensor_manifold(b,"SWITCH_STRIP_HOLD",a.CT_SHOT,d,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},k);a.create_sensor_manifold(b,"SWITCH_PARAM",a.CT_SHOT,d,function(a){return(a[0]||a[1])&&a[4]},function(f,c,d,e){f=Boolean(a.get_sensor_value(f,
c,0))?-1:1;(c=n[l])&&(1==f&&c.active_param<c.params.length-1?c.active_param++:-1==f&&0<c.active_param&&c.active_param--)});k=function(f,d,b,e){if(1==e){var t=Boolean(a.get_sensor_value(f,d,2))?-1:1;if(e=n[l])switch(b=e.params[e.active_param],b[1]=b[5]?b[1]*Math.pow(b[3]/b[2],t/b[4]):b[1]+t*((b[3]-b[2])/b[4]),b[1]=w.clamp(b[1],b[2],b[3]),b[0]){case "VOLUME":"MASTER"!=e.id?c.set_volume(e.speaker,b[1]):c.set_volume(null,b[1]);break;case "DIST_REF":t=c.get_positional_params(e.speaker);t.dist_ref=b[1];
c.set_positional_params(e.speaker,t);break;case "ATTENUATION":t=c.get_positional_params(e.speaker);t.attenuation=b[1];c.set_positional_params(e.speaker,t);break;case "DIST_MAX":t=c.get_positional_params(e.speaker);t.dist_max=b[1];c.set_positional_params(e.speaker,t);break;case "EQ_FREQ":t=c.get_filter_params(e.speaker);t.freq=b[1];c.set_filter_params(e.speaker,t);break;case "EQ_Q":t=c.get_filter_params(e.speaker);t.Q=b[1];c.set_filter_params(e.speaker,t);break;case "EQ_GAIN":t=c.get_filter_params(e.speaker);
t.gain=b[1];c.set_filter_params(e.speaker,t);break;case "THRESHOLD":e=c.get_compressor_params();e.threshold=b[1];c.set_compressor_params(e);break;case "KNEE":e=c.get_compressor_params();e.knee=b[1];c.set_compressor_params(e);break;case "RATIO":e=c.get_compressor_params();e.ratio=b[1];c.set_compressor_params(e);break;case "ATTACK":e=c.get_compressor_params();e.attack=b[1];c.set_compressor_params(e);break;case "RELEASE":e=c.get_compressor_params();e.release=b[1];c.set_compressor_params(e);break;default:throw"Unknown strip param";
}"INC_DEC"==d?a.reset_timer_sensor(f,d,6,0.3):a.reset_timer_sensor(f,d,6,0)}else a.reset_timer_sensor(f,d,6,10)};a.create_sensor_manifold(b,"INC_DEC",a.CT_TRIGGER,d,function(a){return(a[2]||a[3])&&!a[4]},k);a.create_sensor_manifold(b,"INC_DEC_HOLD",a.CT_SHOT,d,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},k);a.create_sensor_manifold(b,"MUTE_SOLO",a.CT_SHOT,d,function(a){return(a[2]||a[3])&&a[4]},function(f,b,t,e){if(Boolean(a.get_sensor_value(f,b,2)))(f=n[l])&&0<=f.mute&&("MASTER"!=f.id?0==f.mute?
(f.mute=1,c.mute(f.speaker,!0),1==f.solo&&(f.solo=0,E(f)||r(f))):(f.mute=0,E(f)||c.mute(f.speaker,!1)):0==f.mute?(f.mute=1,c.mute(null,!0)):(f.mute=0,c.mute(null,!1)));else if((f=n[l])&&0<=f.solo)if(0==f.solo)for(f.solo=1,c.mute(f.speaker,!1),1==f.mute&&(f.mute=0),b=0;b<n.length;b++)t=n[b],t!=f&&0==t.mute&&0==t.solo&&c.mute(t.speaker,!0);else f.solo=0,E(f)?c.mute(f.speaker,!0):r(f)});d=a.create_elapsed_sensor();a.create_sensor_manifold(b,"MIXER_DRAW",a.CT_CONTINUOUS,[d],null,function(){if(n[l])for(var a=
N(),f=a[0];f<=a[1];f++){var b=n[f];z.draw_mixer_strip(b.id,f==l,f%8,b.params,b.active_param,b.mute,b.solo);if(b.speaker&&c.get_filter_params(b.speaker)){c.get_filter_freq_response(b.speaker,v,F,S);for(b=0;b<F.length;b++)F[b]=20*Math.log(F[b])/Math.LN10;z.plot_array("EQ",f%8,F,20,2E4,-10,10)}}});d=a.create_timer_sensor(1);a.create_sensor_manifold(b,"MIXER_UPDATE",a.CT_TRIGGER,[d],null,function(){for(var a=N(),f=a[0];f<=a[1];f++)J(n[f])})}};
if(window.b4w)window.b4w.mixer=b4w.require("mixer");else throw"Failed to register mixer, load b4w first";b4w.module.app=function(d,b){function B(){var a=c.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=c.is_paused(),c.pause()):a||c.resume()},!1)}function D(a){var b=window.onload;window.onload=function(){"function"==typeof b&&b();a()}}function M(a){var b=window.onunload;window.onunload=function(){"function"==typeof b&&b();a()}}function G(a,b){var c=String(a);b&&(c+="/"+String(b));x.innerHTML=c}function k(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,
a);return b}function J(a,b,c){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);
document.addEventListener("mozfullscreenchange",d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen;a.requestFullScreen==a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()}var E=b("animation"),r=b("camera"),N=b("config"),a=b("controls"),z=b("data"),O=b("debug"),c=b("main"),w=b("physics"),n=b("print"),l=b("scenes"),v=b("transform"),F=b("util"),S=b("vec3"),y=null,q=null,x=null,R=new Float32Array(3);d.init=function(a){a=
a||{};var b=null,d=function(){},s=!1,k=!1,l=!1,r=!1,e=!1,v=null,w=!1,F=!0,E;for(E in a)switch(E){case "canvas_container_id":b=a.canvas_container_id;break;case "callback":d=a.callback;break;case "do_not_use_onload":s=a.do_not_use_onload;break;case "gl_debug":k=a.gl_debug;break;case "show_hud_debug_info":l=a.show_hud_debug_info;break;case "sfx_mix_mode":r=a.sfx_mix_mode;break;case "show_fps":e=a.show_fps;break;case "fps_elem_id":v=a.fps_elem_id;break;case "bar_id":break;case "caption_id":break;case "do_not_report_init_failure":w=
a.do_not_report_init_failure;break;case "pause_invisible":F=a.pause_invisible;break;default:N.set(E,a[E])}N.set("show_hud_debug_info",l);N.set("sfx_mix_mode",r);var J=l||r||null;a=function(){var a;a=b;var f=w,s=document.createElement("canvas");s.style.cssText="position: absolute;left:0px; top:0px;";if(J){var l=document.createElement("canvas");l.style.cssText="z-index: 2; position:absolute; left:0px; top:0px; pointer-events: none;"}else l=null;if(c.init(s,l))q=s,f=document.getElementById(a),f||(n.error('Warning: canvas container "'+
a+'" not found, appending to body'),f=document.body),f.appendChild(s),l&&f.appendChild(l),a=f;else{if(!f){a=document.createElement("div");var s=document.createElement("div"),l=document.createElement("div"),f=document.createElement("div"),r=document.createElement("div");a.style.cssText="z-index:10;width:100%;height:100%;position:absolute;";f.style.cssText="position:absolute;bottom:0;width:100%;height:auto;";r.style.cssText="position:relative;float:right;margin:20px;width:70px;height:70px;background-image:url('data:image/png;base64,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')";
s.style.cssText="position:relative;top:0;width:100%;background-color:#000;opacity:0.6;height:auto;color:#ffd42a;text-align:center;font-size:32px;padding:10px 0;";l.style.cssText="position:relative;clear:both;bottom:0;width:100%;background-color:#000;opacity:0.6;height:auto;color:#fff;text-align:center;font-size:20px;padding:10px 0;";s.innerHTML="Browser could not initialize WebGL";l.innerHTML='For more info visit   <a style="color:#ffd42a;font-size:20px;width:100%;" href="http://get.webgl.org/troubleshooting">http://get.webgl.org/troubleshooting</a>';
f.appendChild(r);f.appendChild(l);a.appendChild(s);a.appendChild(f);document.body.appendChild(a)}a=null}a?(y=a,c.set_check_gl_errors(k),e&&(v?x=document.getElementById(v):(x=document.createElement("div"),x.innerHTML=0,x.style.cssText="             position:absolute;            top: 23px;            right: 20px;            font-size: 45px;            line-height: 50px;            font-weight: bold;            color: #000;            z-index: 1;        ",document.body.appendChild(x)),c.set_fps_callback(G)),
F&&B(),d(q,!0)):d(q,!1)};l=function(){c.pause();z.cleanup()};s?(a(),l()):(D(a),M(l))};d.get_canvas_container=function(){return y};d.set_onclick=function(a,b){var c=k(a);c.addEventListener("mouseup",function(a){b(c.value)},!1)};d.set_onchange=function(a,b){var c=k(a);c.addEventListener("change",function(a){a=c.checked;b(void 0!=a?a:c.value)},!1)};d.set_onkeypress=function(a,b){var c=k(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};d.enable_camera_controls=function(b,d,k,s){b||
(b=1);d||(d=1);k||(k=1);document.addEventListener("keydown",function(b){b.keyCode==a.KEY_O?J(document.body):b.keyCode==a.KEY_P&&(c.is_paused()?c.resume():c.pause())},!1);var u=l.get_active_camera(),n=s?!1:r.get_move_style(u)==r.MS_TARGET_CONTROLS?!0:!1;s=a.create_elapsed_sensor();var q=w.has_simulated_physics(u),e=function(a,c,e,k){q&&w.apply_force(a,0,0,0);if(1==k){k=[1800,2100,1800];var l=r.get_trans_speed(a);switch(c){case "FORWARD":q?w.apply_force(a,0,-k[1],0):v.move_local(a,0,-b*l*e,0);break;
case "BACKWARD":q?w.apply_force(a,0,k[1],0):v.move_local(a,0,b*l*e,0);break;case "UP":q?w.apply_force(a,0,0,-k[2]):v.move_local(a,0,0,-b*l*e);break;case "DOWN":q?w.apply_force(a,0,0,k[2]):v.move_local(a,0,0,b*l*e);break;case "LEFT":q?w.apply_force(a,-k[0],0,0):v.move_local(a,-b*l*e,0,0);break;case "RIGHT":q?w.apply_force(a,k[0],0,0):v.move_local(a,b*l*e,0,0);break;case "ROT_LEFT":n?r.rotate_pivot(a,2*-d*e,0):r.rotate(a,2*d*e,0);break;case "ROT_RIGHT":n?r.rotate_pivot(a,2*d*e,0):r.rotate(a,2*-d*e,
0);break;case "ROT_UP":n?r.rotate_pivot(a,0,2*-d*e):r.rotate(a,0,2*-d*e);break;case "ROT_DOWN":n?r.rotate_pivot(a,0,2*d*e):r.rotate(a,0,2*d*e);break;case "ROT_LEFT":n?r.rotate_pivot(a,2*-d*e,0):r.rotate(a,2*d*e,0);break;case "ROT_RIGHT":n?r.rotate_pivot(a,2*d*e,0):r.rotate(a,2*-d*e,0)}}},y=a.create_keyboard_sensor(a.KEY_W),x=a.create_keyboard_sensor(a.KEY_S),z=a.create_keyboard_sensor(a.KEY_A),B=a.create_keyboard_sensor(a.KEY_D),D=a.create_keyboard_sensor(a.KEY_R),na=a.create_keyboard_sensor(a.KEY_F),
M=a.create_keyboard_sensor(a.KEY_UP),N=a.create_keyboard_sensor(a.KEY_DOWN),T=a.create_keyboard_sensor(a.KEY_LEFT),O=a.create_keyboard_sensor(a.KEY_RIGHT),P=function(a){return a[0]&&(a[1]||a[2])};a.create_sensor_manifold(u,"FORWARD",a.CT_CONTINUOUS,[s,y],null,e);a.create_sensor_manifold(u,"BACKWARD",a.CT_CONTINUOUS,[s,x],null,e);n?(a.create_sensor_manifold(u,"ROT_UP",a.CT_CONTINUOUS,[s,M,D],P,e),a.create_sensor_manifold(u,"ROT_DOWN",a.CT_CONTINUOUS,[s,N,na],P,e),a.create_sensor_manifold(u,"ROT_LEFT",
a.CT_CONTINUOUS,[s,T,z],P,e),a.create_sensor_manifold(u,"ROT_RIGHT",a.CT_CONTINUOUS,[s,O,B],P,e)):(a.create_sensor_manifold(u,"UP",a.CT_CONTINUOUS,[s,D],P,e),a.create_sensor_manifold(u,"DOWN",a.CT_CONTINUOUS,[s,na],P,e),a.create_sensor_manifold(u,"LEFT",a.CT_CONTINUOUS,[s,z],P,e),a.create_sensor_manifold(u,"RIGHT",a.CT_CONTINUOUS,[s,B],P,e),a.create_sensor_manifold(u,"ROT_UP",a.CT_CONTINUOUS,[s,M],P,e),a.create_sensor_manifold(u,"ROT_DOWN",a.CT_CONTINUOUS,[s,N],P,e),a.create_sensor_manifold(u,"ROT_LEFT",
a.CT_CONTINUOUS,[s,T],P,e),a.create_sensor_manifold(u,"ROT_RIGHT",a.CT_CONTINUOUS,[s,O],P,e));var G=0,e=a.create_mouse_wheel_sensor();a.create_sensor_manifold(u,"MOUSE_WHEEL",a.CT_LEVEL,[e],null,function(a,c,d,e){1==e&&(n?(c=r.get_eye(a),r.get_pivot(a,R),a=S.dist(R,c),G+=0.1*-d*a*b):(d*=k,a=l.get_active_camera(),r.change_trans_speed(a,d)))});var Y=0,e=a.create_touch_zoom_sensor();a.create_sensor_manifold(u,"TOUCH_ZOOM",a.CT_LEVEL,[e],null,function(a,c,d,e,k){1==e&&n&&(c=r.get_eye(a),r.get_pivot(a,
R),a=S.dist(R,c),Y+=0.005*-d*a*b)});a.create_sensor_manifold(u,"ZOOM_INTERPOL",a.CT_CONTINUOUS,[s],null,function(a,b,c,f){1==f&&(0.001<Math.abs(G)||0.001<Math.abs(Y))&&n&&(b=F.smooth(G,0,c,0.1),G-=b,c=F.smooth(Y,0,c,0.15),Y-=c,v.move_local(a,0,b+c,0))});var ea=0,H=0,e=a.create_mouse_move_sensor("X"),y=a.create_mouse_move_sensor("Y"),x=a.create_mouse_click_sensor(),z=function(a,b,c,f,e){1==f&&n&&(a=0.01*d,ea+="X"==e?-c*a:0,H+="Y"==e?-c*a:0)};a.create_sensor_manifold(u,"MOUSE_X",a.CT_LEVEL,[e,x],null,
z,"X");a.create_sensor_manifold(u,"MOUSE_Y",a.CT_LEVEL,[y,x],null,z,"Y");var Z=0,Q=0,e=a.create_touch_move_sensor("X"),y=a.create_touch_move_sensor("Y"),x=function(a,b,c,f,e){1==f&&n&&(a=0.007*d,Z+="X"==e?-c*a:0,Q+="Y"==e?-c*a:0)};a.create_sensor_manifold(u,"TOUCH_X",a.CT_LEVEL,[e],null,x,"X");a.create_sensor_manifold(u,"TOUCH_Y",a.CT_LEVEL,[y],null,x,"Y");a.create_sensor_manifold(u,"ROT_INTERPOL",a.CT_CONTINUOUS,[s],null,function(a,b,c,f){if(1==f&&(0.001<Math.abs(ea)||0.001<Math.abs(H)||0.001<Math.abs(Z)||
0.001<Math.abs(Q))&&n){b=F.smooth(ea,0,c,0.08);f=F.smooth(H,0,c,0.08);ea-=b;H-=f;var d=F.smooth(Z,0,c,0.12);c=F.smooth(Q,0,c,0.12);Z-=d;Q-=c;r.rotate_pivot(a,b+d,f+c)}});a.create_kb_sensor_manifold(u,"TOGGLE_CAMERA_COLLISION",a.CT_SHOT,a.KEY_C,function(){var a=l.get_active_camera();E.is_detect_collisions_used(a)?E.detect_collisions(a,!1):E.detect_collisions(a,!0)});a.create_kb_sensor_manifold(u,"DEC_STEREO_DIST",a.CT_SHOT,a.KEY_LEFT_SQ_BRACKET,function(a,b,c,f){b=r.get_stereo_distance(a);r.set_stereo_distance(a,
0.9*b)});a.create_kb_sensor_manifold(u,"INC_STEREO_DIST",a.CT_SHOT,a.KEY_RIGHT_SQ_BRACKET,function(a,b,c,f){b=r.get_stereo_distance(a);r.set_stereo_distance(a,1.1*b)})};d.enable_object_controls=function(b){var c=w.is_vehicle_chassis(b)||w.is_vehicle_hull(b),d=function(a,b,f,d){if(1==d)switch(b){case "FORWARD":c?w.vehicle_throttle(a,1):v.move_local(a,0,0,1*f);break;case "BACKWARD":c?w.vehicle_throttle(a,-1):v.move_local(a,0,0,-1*f);break;case "LEFT":c?w.vehicle_steer(a,-1):v.move_local(a,1*f,0,0);
break;case "RIGHT":c?w.vehicle_steer(a,1):v.move_local(a,-1*f,0,0)}else switch(b){case "FORWARD":case "BACKWARD":c&&w.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":c&&w.vehicle_steer(a,0)}},k=a.create_elapsed_sensor(),l=a.create_keyboard_sensor(a.KEY_W),n=a.create_keyboard_sensor(a.KEY_S),q=a.create_keyboard_sensor(a.KEY_A),e=a.create_keyboard_sensor(a.KEY_D),r=a.create_keyboard_sensor(a.KEY_UP),x=a.create_keyboard_sensor(a.KEY_DOWN),y=a.create_keyboard_sensor(a.KEY_LEFT),z=a.create_keyboard_sensor(a.KEY_RIGHT),
B=function(a){return a[0]&&(a[1]||a[2])};a.create_sensor_manifold(b,"FORWARD",a.CT_CONTINUOUS,[k,l,r],B,d);a.create_sensor_manifold(b,"BACKWARD",a.CT_CONTINUOUS,[k,n,x],B,d);a.create_sensor_manifold(b,"LEFT",a.CT_CONTINUOUS,[k,q,y],B,d);a.create_sensor_manifold(b,"RIGHT",a.CT_CONTINUOUS,[k,e,z],B,d)};d.disable_object_controls=function(b){a.remove_sensor_manifolds(b)};d.enable_controls=function(b){document.addEventListener("keydown",a.keydown_cb,!1);document.addEventListener("keyup",a.keyup_cb,!1);
b.addEventListener("mousewheel",a.mouse_wheel_cb,!1);b.addEventListener("DOMMouseScroll",a.mouse_wheel_cb,!1);document.body.addEventListener("mousedown",a.mouse_down_cb,!1);document.body.addEventListener("mouseup",a.mouse_up_cb,!1);b.addEventListener("mousemove",a.mouse_move_cb,!1);b.addEventListener("touchstart",a.touch_start_cb,!1);b.addEventListener("touchmove",a.touch_move_cb,!1)};d.disable_controls=function(b){document.removeEventListener("keydown",a.keydown_cb,!1);document.removeEventListener("keyup",
a.keyup_cb,!1);b.removeEventListener("mousewheel",a.mouse_wheel_cb,!1);b.removeEventListener("DOMMouseScroll",a.mouse_wheel_cb,!1);document.body.removeEventListener("mousedown",a.mouse_down_cb,!1);document.body.removeEventListener("mouseup",a.mouse_up_cb,!1);b.removeEventListener("mousemove",a.mouse_move_cb,!1);b.removeEventListener("touchstart",a.touch_start_cb,!1);b.removeEventListener("touchmove",a.touch_move_cb,!1)};d.enable_debug_controls=function(){var b=l.get_active_camera();a.create_kb_sensor_manifold(b,
"CAMERA_SHOT",a.CT_SHOT,a.KEY_K,function(){O.make_camera_frustum_shot()});a.create_kb_sensor_manifold(b,"LIGHT_SHOT",a.CT_SHOT,a.KEY_L,function(){O.make_light_frustum_shot()});a.create_kb_sensor_manifold(b,"TELEMETRY",a.CT_SHOT,a.KEY_T,function(){O.plot_telemetry()})};d.request_fullscreen=J;d.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};
d.get_url_params=function(){var a=location.href.toString();if(-1==a.indexOf("?"))return null;for(var a=a.split("?")[1].split("&"),b={},c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]=d[1]}return b}};if(window.b4w)window.b4w.app=b4w.require("app");else throw"Failed to register app, load b4w first";b4w.register("viewer_main",function(d,b){function B(p){return(ta?"../../external/deploy/assets/":"../../assets/")+p}function D(){if(W){var p=b4w.scenes.get_object_by_name(W);if(p)return p}return null}function M(p){if(oa){p.preventDefault&&p.preventDefault();var a=p.clientX;p=p.clientY;var b=D();b&&ha.clear_glow_anim(b);W=a=b4w.scenes.pick_object(a,p);if(a.length){Da(a);var c=D();c&&ha.apply_glow_anim(c,0.2,3.8,1)}else Ea();k();aa||(a.length?c&&(aa=c.name,k(),I.enable_object_controls(c),K.create_kb_sensor_manifold(c,
"QUIT",K.CT_SHOT,K.KEY_Q,function(p,a,m,b){aa=null;k();I.disable_object_controls(p)})):G())}}function G(){var p=ha.get_active_camera();aa=p.name;k();I.enable_camera_controls(1,ua.camera_rot_speed);K.create_kb_sensor_manifold(p,"QUIT",K.CT_SHOT,K.KEY_Q,function(a,p,m,b){aa=null;k();I.disable_object_controls(a)});var a=K.create_keyboard_sensor(K.KEY_Z),b=K.create_keyboard_sensor(K.KEY_DEC_POINT);K.create_sensor_manifold(p,"ZOOM_TO",K.CT_SHOT,[a,b],function(a){return a[0]||a[1]},function(a,p,m,b){(p=
D())&&b4w.camera.zoom_object(a,p)})}function k(){if(oa){var a="CONTROLLED: "+(aa?String(aa):"NONE")+" | SELECTED: "+(W?String(W):"NONE"),m;a:{if(aa&&(m=b4w.scenes.get_object_by_name(aa)))break a;m=!1}W&&m&&"CAMERA"===m.type&&(a+=" | DISTANCE: "+Fa);oa.innerHTML=a}}function J(){var a=L.get("last_item_name");if(!a)return null;for(var m=0;m<U.length;m++){var b=U[m];if(ja("name",a,b.items)[0])return{category:b.name,item:a}}return null}function E(a,m){var b=document.getElementById(a);b.innerHTML="";for(var c=
0;c<m.length;c++){var d=document.createElement("option");d.text=d.value=m[c];0===c&&(d.selected=!0);b.appendChild(d)}$("#"+a).selectmenu();$("#"+a).selectmenu("refresh")}function r(a){a=a.target.id;if(-1!=a.indexOf("MANIFEST_ITEM_")){var m=a.split("__SEPARATOR__");a=m[1];m=m[0].split("MANIFEST_ITEM_")[1];pa=!1;clearTimeout(Ga);N({category:a,item:m},!0,!1)}}function N(p,m,b){ka={load_file:Oa,animated_objects:[]};ba=ca=ua=void 0;if(p){var c=ja("name",p.category,U)[0],c=ja("name",p.item,c.items)[0],
d;for(d in c)ka[d]=c[d];L.set("last_item_name",p.item)}else L.set("last_item_name","");m&&(b4w.clear_render_callback(),b4w.data.cleanup());va=!1;p=ka.name||"Logo";m=ka.load_file;d=document.getElementById("current_file");d.innerHTML=p;d.setAttribute("title",p+" ("+m+")");b4w.data.load(B(m),a,O,b)}function a(a){va=!0;ha.set_glow_color([1,0.4,0.05]);W=null;c(ka);G();I.enable_debug_controls();x()&&Pa.enable_mixer_controls(ha.get_active_camera());b4w.set_render_callback(l);pa&&(Ga=setTimeout(z,Qa));a=
K.create_elapsed_sensor();K.create_sensor_manifold(ha.get_active_camera(),"TO_OBJ",K.CT_CONTINUOUS,[a],null,function(a,p,b,c){if(1==c&&W){if(b=D())p=Ra,b4w.transform.get_object_center(b,!0,p),a=b4w.camera.get_eye(a),Fa=Sa.dist(p,a).toFixed(3);k()}})}function z(){var a=J();if(a){var m=a.item,a=ja("name",a.category,U)[0],m=ja("name",m,a.items)[0],m=a.items.indexOf(m);if(m=a.items[m+1])a={category:a.name,item:m.name};else if(a=U.indexOf(a),a=U[a+1])a={category:a.name,item:a.items[0].name};else{pa=!1;
return}}else a=U[0],m=a.items[0],a={category:a.name,item:m.name};N(a,!0,!0)}function O(a,m){document.getElementById("loading_progress").innerHTML=a+"% ("+Math.round(10*m/1E3)/10+"s)";if(va){var b=b4w.debug.num_vertices(),c=b4w.debug.num_triangles(),d=b4w.debug.num_draw_calls();document.getElementById("info_right_up").innerHTML=b+" verts, "+c+" tris, "+d+" draw calls";var b=b4w.debug.geometry_stats(),c=b4w.debug.num_textures(),d=b4w.debug.num_render_targets(),e=Math.round(10*(b.ibo_memory+b.vbo_memory))/
10,f=Math.round(10*c.memory)/10,g=Math.round(10*d.memory)/10,h=Math.round(10*(e+f+g))/10;document.getElementById("info_right_down").innerHTML="Geometry: "+e+" MiB ("+b.ibo_number+"+"+b.vbo_number+")<br>Textures: "+f+" MiB ("+c.number+")<br>RTs: "+g+" MiB ("+d.number+")<br><br>Total: "+h+" MiB"}}function c(a){for(var m=b4w.scenes.get_active(),b=b4w.scenes.get_scenes(),c=0;c<b.length;c++){var d=b[c];if(d!==m){var e=w(d,a);n(d,e)}}e=w(m,a);n(m,e);Da=function(a){a=b4w.scenes.get_object_by_name(a);var p=
b4w.material.get_materials_names(a);E("material_name",p);Z(a,p[0]);a=b4w.material.get_water_material_params(a,p[0]);p="shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" ");
a?(A(p,"enable"),b4w.scenes.get_water_mat_params(a),a.shallow_water_col&&da("shallow_water_col",a.shallow_water_col),a.shallow_water_col_fac&&h("shallow_water_col_fac",a.shallow_water_col_fac),a.shore_water_col&&da("shore_water_col",a.shore_water_col),a.shore_water_col_fac&&h("shore_water_col_fac",a.shore_water_col_fac),a.water_fog_color&&(da("water_fog_color",a.water_fog_color),h("water_fog_density",a.water_fog_density)),h("absorb_factor",a.absorb_factor),h("sss_strength",a.sss_strength),h("sss_width",
a.sss_width),h("foam_factor",a.foam_factor),h("waves_height",a.waves_height),h("waves_length",a.waves_length),h("dst_noise_scale0",a.dst_noise_scale0),h("dst_noise_scale1",a.dst_noise_scale1),h("dst_noise_freq0",a.dst_noise_freq0),h("dst_noise_freq1",a.dst_noise_freq1),h("dir_min_shore_fac",a.dir_min_shore_fac),h("dir_freq",a.dir_freq),h("dir_noise_scale",a.dir_noise_scale),h("dir_noise_freq",a.dir_noise_freq),h("dir_min_noise_fac",a.dir_min_noise_fac),h("dst_min_fac",a.dst_min_fac),h("waves_hor_fac",
a.waves_hor_fac)):A(p,"disable")};P();a=b4w.lights.get_lights_names();E("light_name",a);Ba(a[0]);Ma();Ka();na();Ta();Ua();La();Va();Na();ea();Wa();Xa();Ea();$("#wireframe_mode").val("WM_NONE");$("#wireframe_mode").selectmenu("refresh",!0);$("#wireframe_edge_color div").css("backgroundColor","#333");a=new Date(document.getElementById("date").value);wa({date:a});ua=e}function w(a,m){function b(a,p){for(var m in a)p[m]=a[m];return p}var c=m.scene_settings;if(c&&c[a]){var d={};b(m,d);b(c[a],d);delete d.scene_settings;
return d}return m}function n(a,m){b4w.scenes.set_active(a);var b=b4w.scenes.get_active_camera();m.camera_target&&b4w.constraints.append_follow(b,m.camera_target);var c=m.h_angle,d=m.v_angle;0!==c&&!c||0!==d&&!d||b4w.camera.set_eye_params(b,c,d);b=m.animated_objects.slice(0);b.unshift("All");E("anim_active_object",b);ba=Ya;ca=b;b=b4w.animation.get_actions();c="anim_action anim_cyclic anim_frame_current anim_play anim_stop get_max_bones".split(" ");if(!b.length)return A(c,"disable"),null;A(c,"enable");
E("anim_action",b);(b=b[Za])&&e({anim_action:b})}function l(a,m){b4w.scenes.get_active_camera();var b=v(ca,ba)[0];if(b){var c=document.getElementById("anim_status");b4w.animation.is_play(b)?c.innerHTML="PLAYING":c.innerHTML="STOPPED";var d=document.getElementById("anim_frame_range");if(c=b4w.animation.get_frame_range(b))d.innerHTML=c[0]+" - "+c[1],d=document.getElementById("anim_frame_current"),d.min=""+c[0],d.max=""+c[1];b=Math.round(b4w.animation.get_current_frame_float(b));parseInt($("#anim_frame_current").val())!==
b&&h("anim_frame_current",b)}}function v(a,b){var c=[];if(0==b)for(var d=1;d<a.length;d++){var e=a[d]instanceof Array?b4w.scenes.get_object_by_empty_name(a[d][0],a[d][1]):b4w.scenes.get_object_by_name(a[d]);e?c.push(e):a.splice(d,1)}else e=a[b]instanceof Array?b4w.scenes.get_object_by_empty_name(a[b][0],a[b][1]):b4w.scenes.get_object_by_name(a[b]),c=[e];return c}function F(a){L.set("quality",a.quality);setTimeout(function(){window.location.reload()},100)}function S(){L.cleanup();window.location.reload()}
function y(){b4w.pause()}function q(){b4w.resume()}function x(){return"true"===L.get("sfx_mix_mode")?!0:!1}function R(a){L.set("show_hud_debug_info","on"===a.show_hud_debug_info);window.location.reload()}function f(a){L.set("sfx_mix_mode","on"===a.sfx_mix_mode);window.location.reload()}function t(a){L.set("anaglyph_use","on"===a.anaglyph_use);window.location.reload()}function ga(){pa=!0;z()}function s(a){var b=a.target.innerWidth;a=a.target.innerHeight;var c=document.getElementById("controls_container").offsetWidth,
b=b-c;b4w.resize(b,a);document.getElementById("info_left_up").innerHTML=b+"x"+a}function u(){for(var a=v(ca,ba),b=0;b<a.length;b++)b4w.animation.play(a[b])}function fa(){for(var a=v(ca,ba),b=0;b<a.length;b++)b4w.animation.stop(a[b])}function ia(){b4w.pause();var a=b4w.shaders.determine_max_bones();document.getElementById("max_bones").innerHTML=a.max_bones;document.getElementById("max_bones_no_blending").innerHTML=a.max_bones_no_blending;b4w.resume()}function e(a){if("anim_active_object"in a)for(var b=
ca,c=0;c<b.length;c++)if(b[c]==a.anim_active_object){ba=c;return}if("anim_action"in a)for(b=v(ca,ba),c=0;c<b.length;c++)b4w.animation.apply(b[c],a.anim_action),b4w.animation.play(b[c]),b4w.animation.cyclic(b[c],!0);if("anim_cyclic"in a)for(b=v(ca,ba),c=0;c<b.length;c++){var d=b[c];b4w.animation.cyclic(d,"on"===a.anim_cyclic)}if("anim_frame_current"in a)for(a=parseInt(a.anim_frame_current),b=v(ca,ba),c=0;c<b.length;c++)d=b[c],b4w.animation.is_play(d)||(b4w.animation.set_current_frame_float(d,a),b4w.animation.update_object_animation(d))}
function Ka(){var a=b4w.scenes.get_ssao_params(),b="ssao_quality ssao_radius_increase ssao_dithering_amount ssao_gauss_center ssao_gauss_width_square ssao_gauss_width_left_square ssao_influence ssao_dist_factor ssao_only ssao_white".split(" ");if(a){A(b,"enable");for(var c=document.getElementById("ssao_quality"),b=a.ssao_quality,c=c.options,d=0;d<c.length;d++){var e=c[d];e.selected=e.value==b?!0:!1}$("#ssao_quality").selectmenu("refresh");h("ssao_radius_increase",a.radius_increase);h("ssao_dithering_amount",
1E3*a.dithering_amount);h("ssao_gauss_center",a.gauss_center);h("ssao_gauss_width_square",Math.sqrt(a.gauss_width_square));h("ssao_gauss_width_left_square",Math.sqrt(a.gauss_width_left_square));h("ssao_influence",a.influence);h("ssao_dist_factor",a.dist_factor);b=0===a.ssao_only?1:0;document.getElementById("ssao_only").options[b].selected=!0;$("#ssao_only").slider("refresh");b=0===a.ssao_white?1:0;document.getElementById("ssao_white").options[b].selected=!0;$("#ssao_white").slider("refresh")}else A(b,
"disable")}function V(a){b4w.scenes.get_ssao_params();var b={};"ssao_quality"in a&&(b.ssao_quality=za(document.getElementById("ssao_quality")));"ssao_radius_increase"in a&&(b.ssao_radius_increase=a.ssao_radius_increase);"ssao_dithering_amount"in a&&(b.ssao_dithering_amount=a.ssao_dithering_amount/1E3);"ssao_gauss_center"in a&&(b.ssao_gauss_center=a.ssao_gauss_center);"ssao_gauss_width_square"in a&&(b.ssao_gauss_width_square=a.ssao_gauss_width_square*a.ssao_gauss_width_square);"ssao_gauss_width_left_square"in
a&&(b.ssao_gauss_width_left_square=a.ssao_gauss_width_left_square*a.ssao_gauss_width_left_square);"ssao_influence"in a&&(b.ssao_influence=a.ssao_influence);"ssao_dist_factor"in a&&(b.ssao_dist_factor=a.ssao_dist_factor);"ssao_only"in a&&(b.ssao_only="on"===a.ssao_only?1:0);"ssao_white"in a&&(b.ssao_white="on"===a.ssao_white?1:0);b4w.scenes.set_ssao_params(b)}function La(){var a=b4w.scenes.get_color_correction_params(),b=["brightness","contrast","exposure","saturation"];a?(A(b,"enable"),h("brightness",
a.brightness),h("contrast",a.contrast),h("exposure",a.exposure),h("saturation",a.saturation)):A(b,"disable")}function ma(a){var b=b4w.scenes.get_color_correction_params();b&&(b={},"brightness"in a&&(b.brightness=parseFloat(a.brightness)),"contrast"in a&&(b.contrast=parseFloat(a.contrast)),"exposure"in a&&(b.exposure=parseFloat(a.exposure)),"saturation"in a&&(b.saturation=parseFloat(a.saturation)),b4w.scenes.set_color_correction_params(b))}function za(a){a=a.options;for(var b=0;b<a.length;b++){var c=
a[b];if(c.selected)return c.value}}function na(){var a=b4w.scenes.get_fog_color_density();0.2<a[3]?h("fog_density",a[3]):h("fog_density1000",1E3*a[3]);da("fog_color",a)}function qa(a){var b=b4w.scenes.get_fog_color_density();"fog_density"in a&&(b[3]=a.fog_density);"fog_density1000"in a&&(b[3]=a.fog_density1000/1E3);"fog_color"in a&&(b[0]=a.fog_color[0],b[1]=a.fog_color[1],b[2]=a.fog_color[2]);b4w.scenes.set_fog_color_density(b)}function Ma(){var a=b4w.scenes.get_shadow_params(),b="optimize_shadow_volume csm_near csm_far shadow_visibility_falloff blur_depth_size_mult blur_depth_edge_size blur_depth_diff_threshold csm_lambda".split(" ");
if(!a)return A(b,"disable"),null;A(b,"enable");b=a.optimize_shadow_volume?0:1;document.getElementById("optimize_shadow_volume").options[b].selected=!0;$("#optimize_shadow_volume").slider("refresh");h("shadow_visibility_falloff",a.shadow_visibility_falloff);h("blur_depth_size_mult",a.blur_depth_size_mult);h("blur_depth_edge_size",a.blur_depth_edge_size);h("blur_depth_diff_threshold",a.blur_depth_diff_threshold);Aa(a);h("csm_near",a.csm_near);h("csm_far",a.csm_far);h("csm_lambda",a.csm_lambda)}function T(a){var b=
{};"optimize_shadow_volume"in a&&(b.optimize_shadow_volume="on"===a.optimize_shadow_volume?!0:!1);"csm_near"in a&&(b.csm_near=parseFloat(a.csm_near));"csm_far"in a&&(b.csm_far=parseFloat(a.csm_far));"csm_lambda"in a&&(b.csm_lambda=parseFloat(a.csm_lambda));"shadow_visibility_falloff"in a&&(b.shadow_visibility_falloff=parseFloat(a.shadow_visibility_falloff));"blur_depth_size_mult"in a&&(b.blur_depth_size_mult=parseFloat(a.blur_depth_size_mult));"blur_depth_edge_size"in a&&(b.blur_depth_edge_size=parseFloat(a.blur_depth_edge_size));
"blur_depth_diff_threshold"in a&&(b.blur_depth_diff_threshold=parseFloat(a.blur_depth_diff_threshold));b4w.scenes.set_shadow_params(b);Aa(b4w.scenes.get_shadow_params())}function Aa(a){document.getElementById("csm_num").innerHTML=" "+a.csm_num;a=a.csm_borders;var b=document.getElementById("csm_borders");b.innerHTML="(";for(var c=0;c<a.length;c++)0<c&&(b.innerHTML+=" __ "),b.innerHTML+=Math.round(10*a[c])/10;b.innerHTML+=")"}function P(){var a=b4w.scenes.get_environment_colors();h("environment_energy",
a[0]);da("horizon_color",a[1]);da("zenith_color",a[2])}function sa(a){"environment_energy"in a&&b4w.scenes.set_environment_colors(a.environment_energy,null,null);"horizon_color"in a&&b4w.scenes.set_environment_colors(null,a.horizon_color,null);"zenith_color"in a&&b4w.scenes.set_environment_colors(null,null,a.zenith_color)}function Y(a){var b={};"wireframe_mode"in a&&(b.wireframe_mode=za(document.getElementById("wireframe_mode")));"wireframe_edge_color"in a&&(b.wireframe_edge_color=a.wireframe_edge_color);
b4w.debug.set_debug_params(b)}function ea(){var a=b4w.scenes.get_sky_params(),b="sky_color rayleigh_brightness mie_brightness spot_brightness scatter_strength rayleigh_strength mie_strength rayleigh_collection_power mie_collection_power mie_distribution".split(" ");if(!a)return A(b,"disable"),null;A(b,"enable");da("sky_color",a.color);h("rayleigh_brightness",a.rayleigh_brightness);h("mie_brightness",a.mie_brightness);h("spot_brightness",a.spot_brightness);h("scatter_strength",a.scatter_strength);
h("rayleigh_strength",a.rayleigh_strength);h("mie_strength",a.mie_strength);h("rayleigh_collection_power",a.rayleigh_collection_power);h("mie_collection_power",a.mie_collection_power);h("mie_distribution",a.mie_distribution)}function H(a){var b={};"sky_color"in a&&(b.color=a.sky_color);"rayleigh_brightness"in a&&(b.rayleigh_brightness=a.rayleigh_brightness);"mie_brightness"in a&&(b.mie_brightness=a.mie_brightness);"spot_brightness"in a&&(b.spot_brightness=a.spot_brightness);"scatter_strength"in a&&
(b.scatter_strength=a.scatter_strength);"rayleigh_strength"in a&&(b.rayleigh_strength=a.rayleigh_strength);"mie_strength"in a&&(b.mie_strength=a.mie_strength);"rayleigh_collection_power"in a&&(b.rayleigh_collection_power=a.rayleigh_collection_power);"mie_collection_power"in a&&(b.mie_collection_power=a.mie_collection_power);"mie_distribution"in a&&(b.mie_distribution=a.mie_distribution);b4w.scenes.set_sky_params(b)}function Z(a,b){var c=b4w.material.get_material_extended_params(a,b),d="material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" ");
if(!c)return A(d,"disable"),null;var e=b4w.material.get_diffuse_color(a,b);e.pop();c.diffuse_color=e;A(d,"enable");da("material_diffuse_color",c.diffuse_color);h("material_reflectivity",c.reflect_factor);h("material_fresnel",c.fresnel);h("material_fresnel_factor",c.fresnel_factor);h("material_parallax_scale",c.parallax_scale);h("material_parallax_steps",c.parallax_steps)}function Q(a){var b=b4w.scenes.get_object_by_name(W);"material_name"in a&&Z(b,a.material_name);if("material_diffuse_color"in a){var c=
a.material_diffuse_color.slice();c.push(1);b4w.material.set_diffuse_color(b,$("#material_name").val(),c)}c={};"material_reflectivity"in a&&(c.material_reflectivity=a.material_reflectivity);"material_fresnel"in a&&(c.material_fresnel=a.material_fresnel);"material_fresnel_factor"in a&&(c.material_fresnel_factor=a.material_fresnel_factor);"material_parallax_scale"in a&&(c.material_parallax_scale=a.material_parallax_scale);"material_parallax_steps"in a&&(c.material_parallax_steps=a.material_parallax_steps);
b4w.material.set_material_extended_params(b,$("#material_name").val(),c);b4w.scenes.update_scene_materials_params()}function C(a){var b=b4w.scenes.get_object_by_name(W),c="waves_height waves_length sss_strength sss_width dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac".split(" ");if(!b)return null;var d={},e=$("#water_dynamic").val(),f=$("#shore_smoothing").val();"1"==e?(e=!0,A(c,
"enable")):(e=!1,A(c,"disable"));"1"==f?(f=!0,A(["absorb_factor"],"enable")):(f=!1,A(["absorb_factor"],"disable"));"shore_smoothing"in a&&(d.shore_smoothing=f);"absorb_factor"in a&&(d.absorb_factor=a.absorb_factor);"water_fog_color"in a&&(d.water_fog_color=a.water_fog_color);"water_fog_density"in a&&(d.water_fog_density=a.water_fog_density);"shallow_water_col"in a&&(d.shallow_water_col=a.shallow_water_col);"shallow_water_col_fac"in a&&(d.shallow_water_col_fac=a.shallow_water_col_fac);"shore_water_col"in
a&&(d.shore_water_col=a.shore_water_col);"shore_water_col_fac"in a&&(d.shore_water_col_fac=a.shore_water_col_fac);"foam_factor"in a&&(d.foam_factor=a.foam_factor);"sss_strength"in a&&(d.sss_strength=a.sss_strength);"sss_width"in a&&(d.sss_width=a.sss_width);"water_dynamic"in a&&(d.water_dynamic=e);"waves_height"in a&&(d.waves_height=a.waves_height);"waves_length"in a&&(d.waves_length=a.waves_length);"dst_noise_scale0"in a&&(d.dst_noise_scale0=a.dst_noise_scale0);"dst_noise_scale1"in a&&(d.dst_noise_scale1=
a.dst_noise_scale1);"dst_noise_freq0"in a&&(d.dst_noise_freq0=a.dst_noise_freq0);"dst_noise_freq1"in a&&(d.dst_noise_freq1=a.dst_noise_freq1);"dir_min_shore_fac"in a&&(d.dir_min_shore_fac=a.dir_min_shore_fac);"dir_freq"in a&&(d.dir_freq=a.dir_freq);"dir_noise_scale"in a&&(d.dir_noise_scale=a.dir_noise_scale);"dir_noise_freq"in a&&(d.dir_noise_freq=a.dir_noise_freq);"dir_min_noise_fac"in a&&(d.dir_min_noise_fac=a.dir_min_noise_fac);"dst_min_fac"in a&&(d.dst_min_fac=a.dst_min_fac);"waves_hor_fac"in
a&&(d.waves_hor_fac=a.waves_hor_fac);if(!b4w.material.set_water_material_params(b,$("#material_name").val(),d))return null;b4w.scenes.update_scene_materials_params();b4w.scenes.set_water_params(d)}function Ba(a){a=b4w.lights.get_light_params(a);da("light_color",a.light_color);h("light_energy",a.light_energy)}function ra(a){"light_name"in a&&Ba(a.light_name);var b={};"light_color"in a&&(b.light_color=a.light_color);"light_energy"in a&&(b.light_energy=parseFloat(a.light_energy));b4w.lights.set_light_params($("#light_name").val(),
b)}function Na(){var a=b4w.lights.get_sun_params(),b=["sun_horizontal_position","sun_vertical_position"];if(!a)return A(b,"disable"),null;h("sun_horizontal_position",a.hor_position);h("sun_vertical_position",a.vert_position)}function Ca(a){var b={};"sun_horizontal_position"in a&&(b.hor_position=parseFloat(a.sun_horizontal_position),b.vert_position=parseFloat(document.getElementById("sun_vertical_position").value));"sun_vertical_position"in a&&(b.hor_position=parseFloat(document.getElementById("sun_horizontal_position").value),
b.vert_position=parseFloat(a.sun_vertical_position));b4w.lights.set_sun_params(b)}function $a(a){a=parseFloat(a.max_sun_angle);b4w.lights.set_max_sun_angle(a)}function wa(a){"day_time"in a&&b4w.lights.set_day_time(a.day_time);"date"in a&&b4w.lights.set_date(new Date(a.date))}function ab(){var a=b4w.controls,b=0,c=parseFloat(document.getElementById("day_time").value),d=a.create_elapsed_sensor(),e=b4w.lights.get_lamps("SUN")[0];a.create_sensor_manifold(e,"ELAPSED",a.CT_CONTINUOUS,[d],function(a){return a[0]},
function(a,d,e,p){1==p&&(b=document.getElementById("sun_time_multiplier").value,c+=e*b/3600,24<c&&(c-=Math.floor(c)),h("day_time",c))})}function Xa(){var a="run_sun stop_sun date sun_time_multiplier day_time max_sun_angle".split(" ");if(!b4w.lights.get_lamps("SUN")[0])return A(a,"disable"),null}function Ea(){A("material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" "),"disable");A("shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" "),
"disable")}function bb(){var a=b4w.lights.get_lamps("SUN")[0];b4w.controls.check_sensor_manifolds(a)&&b4w.controls.remove_sensor_manifold(a,"ELAPSED")}function Ta(){var a=b4w.scenes.get_dof_params(),b=["dof_distance","dof_front","dof_rear","dof_power","dof_on"];a?(h("dof_distance",a.dof_distance),h("dof_front",a.dof_front),h("dof_rear",a.dof_rear),h("dof_power",a.dof_power),A(b,"enable"),a=0<a.dof_distance?0:1,document.getElementById("dof_on").options[a].selected=!0,$("#dof_on").slider("refresh")):
A(b,"disable")}function la(a){var b={};"dof_distance"in a&&1==$("#dof_on").val()&&(b.dof_distance=a.dof_distance);"dof_front"in a&&(b.dof_front=a.dof_front);"dof_rear"in a&&(b.dof_rear=a.dof_rear);"dof_power"in a&&(b.dof_power=a.dof_power);"dof_on"in a&&(b.dof_on=$("#dof_on").val(),b.dof_distance=1==a.dof_on?$("#dof_distance").val():0);b4w.scenes.set_dof_params(b)}function Ua(){var a=b4w.scenes.get_god_rays_params(),b=["god_rays_intensity","god_rays_max_ray_length","god_rays_steps"];a?(A(b,"enable"),
a&&(h("god_rays_intensity",a.god_rays_intensity),h("god_rays_max_ray_length",a.god_rays_max_ray_length),h("god_rays_steps",a.god_rays_steps))):A(b,"disable")}function xa(a){var b={};"god_rays_intensity"in a&&(b.god_rays_intensity=a.god_rays_intensity);"god_rays_max_ray_length"in a&&(b.god_rays_max_ray_length=a.god_rays_max_ray_length);"god_rays_steps"in a&&(b.god_rays_steps=a.god_rays_steps);b4w.scenes.set_god_rays_params(b)}function Wa(){var a=b4w.scenes.get_bloom_params(),b=["bloom_key","bloom_blur",
"bloom_edge_lum"];a?(A(b,"enable"),a&&(h("bloom_key",a.bloom_key),h("bloom_blur",a.bloom_blur),h("bloom_edge_lum",a.bloom_edge_lum))):A(b,"disable")}function ya(a){var b={};"bloom_key"in a&&(b.bloom_key=a.bloom_key);"bloom_blur"in a&&(b.bloom_blur=a.bloom_blur);"bloom_edge_lum"in a&&(b.bloom_edge_lum=a.bloom_edge_lum);b4w.scenes.set_bloom_params(b)}function da(a,b){b=[Math.pow(b[0],1/2.2),Math.pow(b[1],1/2.2),Math.pow(b[2],1/2.2)];var c={r:Math.round(255*b[0]),g:Math.round(255*b[1]),b:Math.round(255*
b[2])};$("#"+a).ColorPickerSetColor(c);$("#"+a+" div").css("backgroundColor","#"+function(a){var b=[a.r.toString(16),a.g.toString(16),a.b.toString(16)];$.each(b,function(a,c){1==c.length&&(b[a]="0"+c)});return b.join("")}(c))}function Va(){var a=b4w.scenes.get_wind_params(),b=["wind_dir","wind_strength"];a?(h("wind_dir",a.wind_dir),h("wind_strength",a.wind_strength)):A(b,"disable")}function Ha(a){var b={};"wind_dir"in a&&(b.wind_dir=a.wind_dir);"wind_strength"in a&&(b.wind_strength=a.wind_strength);
b4w.scenes.set_wind_params(b)}function h(a,b){$("#"+a).val(b);$("#"+a).slider("refresh")}function g(a,b){$("#"+b).bind("change",function(c){var d={};d[b]=c.target.value;a(d)})}function X(a,b){$("#"+b).ColorPicker({onChange:function(c,d,e){$("#"+b+" div").css("backgroundColor","#"+d);c={};d=[];d[0]=e.r/255;d[1]=e.g/255;d[2]=e.b/255;e=d;e=[Math.pow(e[0],2.2),Math.pow(e[1],2.2),Math.pow(e[2],2.2)];c[b]=e;a(c)}})}function ja(a,b,c){for(var d=[],e=0;e<c.length;e++){var f=c[e];f[a]==b&&d.push(f)}return d}
function cb(){b4w.camera_anim.auto_rotate(db)}function A(a,b){if(!a)return null;for(var c=0;c<a.length;c++){var d=$("#"+a[c]).parent().parent();"enable"==b?d.removeClass("ui-disabled"):"disable"==b&&d.addClass("ui-disabled")}}var I=b("app"),Ia=b("assets");b("config");var K=b("controls");b("data");var Pa=b("mixer"),ha=b("scenes"),L=b("storage"),Sa=b("vec3"),ta="DEBUG"===b4w.version.type(),Qa=1E3,db=0.3,Oa="dev/logo.json",Ja;Ja="true"===L.get("show_hud_debug_info")?!0:!1;var eb={canvas_container_id:"main_canvas_container",
callback:function(a,b){if(!b)return console.log("b4w init failure"),null;window.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1};window.ondragstart=function(a){a.preventDefault();a.stopPropagation();return!1};I.enable_controls(a);a.addEventListener("mousedown",M,!1);window.addEventListener("resize",s,!1);var c=document.createEvent("CustomEvent");c.initEvent("resize",!1,!1);window.dispatchEvent(c);Ia.enqueue([["manifest",Ia.AT_JSON,B("assets.json")]],function(a,b,c,d){U=a;
oa=document.getElementById("info_left_down");document.getElementById("build_date").innerHTML=b4w.version.date();g(F,"quality");switch(b4w.config.get("quality")){case b4w.config.P_ULTRA:var h=0;break;case b4w.config.P_HIGH:h=1;break;case b4w.config.P_LOW:h=2}document.getElementById("quality").options[h].selected=!0;$("#quality").selectmenu("refresh");I.set_onclick("reset_memory",S);I.set_onclick("auto_rotate_cam",cb);I.set_onclick("pause",y);I.set_onclick("resume",q);I.set_onclick("auto_view",ga);
a=document.getElementById("manifest");if(U){c="";for(b=0;b<U.length;b++){h=U[b];d=h.name;for(var h=h.items,k="",k=k+"<div data-role='collapsible' data-mini='true' >",k=k+("<h6>"+d+"</h6>"),k=k+"<ul data-role='listview' data-mini='true' data-inset='true' style='margin: -10px 0;'>",m=0;m<h.length;m++)var l=h[m].name,k=k+("<li data-mini='true'><a href='#' class='min_font' id='"+("MANIFEST_ITEM_"+l+"__SEPARATOR__"+d)+"'>"+l+"</a></li>");k+="</ul>";k+="</div>";c+=k}$("#"+a.id).append(c);$("#"+a.id).trigger("create");
a.addEventListener("mouseup",r,!1)}else a.innerHTML="<p style='color: red;'>Failed loading scenes list.</p><p>Maybe a syntax error?</p>";g(e,"anim_active_object");g(e,"anim_action");g(e,"anim_cyclic");g(e,"anim_frame_current");I.set_onclick("anim_play",u);I.set_onclick("anim_stop",fa);I.set_onclick("get_max_bones",ia);g(Q,"material_name");X(Q,"material_diffuse_color");g(Q,"material_reflectivity");g(Q,"material_fresnel");g(Q,"material_fresnel_factor");g(Q,"material_parallax_scale");g(Q,"material_parallax_steps");
g(C,"material_name");g(C,"shore_smoothing");g(C,"absorb_factor");g(C,"sss_strength");g(C,"sss_width");X(C,"water_fog_color");g(C,"water_fog_density");X(C,"shallow_water_col");g(C,"shallow_water_col_fac");X(C,"shore_water_col");g(C,"shore_water_col_fac");g(C,"foam_factor");g(C,"water_dynamic");g(C,"waves_height");g(C,"waves_length");g(C,"dst_noise_scale0");g(C,"dst_noise_scale1");g(C,"dst_noise_freq0");g(C,"dst_noise_freq1");g(C,"dir_min_shore_fac");g(C,"dir_freq");g(C,"dir_noise_scale");g(C,"dir_noise_freq");
g(C,"dir_min_noise_fac");g(C,"dst_min_fac");g(C,"waves_hor_fac");g(sa,"environment_energy");X(sa,"horizon_color");X(sa,"zenith_color");g(ra,"light_name");X(ra,"light_color");g(ra,"light_energy");X(H,"sky_color");g(H,"rayleigh_brightness");g(H,"mie_brightness");g(H,"spot_brightness");g(H,"scatter_strength");g(H,"rayleigh_strength");g(H,"mie_strength");g(H,"rayleigh_collection_power");g(H,"mie_collection_power");g(H,"mie_distribution");g(wa,"date");g(wa,"day_time");g(Ca,"sun_horizontal_position");g(Ca,
"sun_vertical_position");g($a,"max_sun_angle");I.set_onclick("run_sun",ab);I.set_onclick("stop_sun",bb);g(T,"optimize_shadow_volume");g(T,"csm_near");g(T,"csm_far");g(T,"csm_lambda");g(T,"shadow_visibility_falloff");g(T,"blur_depth_size_mult");g(T,"blur_depth_edge_size");g(T,"blur_depth_diff_threshold");g(V,"ssao_quality");g(V,"ssao_radius_increase");g(V,"ssao_dithering_amount");g(V,"ssao_gauss_center");g(V,"ssao_gauss_width_square");g(V,"ssao_gauss_width_left_square");g(V,"ssao_influence");g(V,"ssao_dist_factor");
g(V,"ssao_only");g(V,"ssao_white");g(qa,"fog_density");g(qa,"fog_density1000");X(qa,"fog_color");g(la,"dof_distance");g(la,"dof_front");g(la,"dof_rear");g(la,"dof_power");g(la,"dof_on");g(xa,"god_rays_intensity");g(xa,"god_rays_max_ray_length");g(xa,"god_rays_steps");g(ma,"brightness");g(ma,"contrast");g(ma,"exposure");g(ma,"saturation");g(f,"sfx_mix_mode");a="true"===L.get("sfx_mix_mode")?0:1;document.getElementById("sfx_mix_mode").options[a].selected=!0;$("#sfx_mix_mode").slider("refresh");g(t,
"anaglyph_use");a="true"===L.get("anaglyph_use")?0:1;document.getElementById("anaglyph_use").options[a].selected=!0;$("#anaglyph_use").slider("refresh");g(Ha,"wind_dir");g(Ha,"wind_strength");g(ya,"bloom_key");g(ya,"bloom_blur");g(ya,"bloom_edge_lum");g(Y,"wireframe_mode");X(Y,"wireframe_edge_color");g(R,"show_hud_debug_info");a="true"===L.get("show_hud_debug_info")?0:1;document.getElementById("show_hud_debug_info").options[a].selected=!0;$("#show_hud_debug_info").slider("refresh");a=J();N(a,!1,!1)},
null)},gl_debug:!0,show_hud_debug_info:Ja,sfx_mix_mode:x(),show_fps:!0,alpha:!0,assets_dds_available:!ta,assets_min50_available:!ta,console_verbose:!0,all_objs_selectable:!0,physics_enabled:!0,wireframe_debug:!0},Ya=0,Za=0,pa=!1,Ga,U=null,ca,ba,ka,ua,oa=null,W=null,Da=function(){},aa=null,Fa=null,Ra=new Float32Array(3),va=!1;d.init=function(){var a=L.get("quality");if(a){switch(a){case "ULTRA":var b=b4w.config.P_ULTRA;break;case "HIGH":b=b4w.config.P_HIGH;break;case "LOW":b=b4w.config.P_LOW}b4w.config.set("quality",
b)}b4w.config.set("anaglyph_use","true"===L.get("anaglyph_use"));I.init(eb)}});b4w.require("viewer_main").init();
