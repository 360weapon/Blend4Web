b4w.module.storage=function(c,b){function x(){if(!localStorage)throw"Local storage is not supported";return localStorage[c.prefix]?JSON.parse(localStorage[c.prefix]):{}}var H=b("__print");c.prefix="b4w";c.init=function(b){c.prefix=b};c.set=function(b,B){var l=x();l[b]=String(B);if(!localStorage)throw"Local storage is not supported";localStorage[c.prefix]=JSON.stringify(l)};c.cleanup=function(){if(!localStorage)throw"Local storage is not supported";delete localStorage[c.prefix]};c.get=function(b){var c=
x();return c[b]?c[b]:""};c.debug=function(){H.log(x())}};if(window.b4w)window.b4w.storage=b4w.require("storage");else throw"Failed to register storage, load b4w first";b4w.module.camera_anim=function(c,b){var x=new Float32Array(3),H=new Float32Array(3),K=new Float32Array(3),B=new Float32Array(4),l=b("controls"),D=b("vec3"),L=b("quat");c.track_to_target=function(b,p,d,a,c,g,u,n){if(b&&p){if(b4w.util.is_vector(p))var q=p;else q=K,b4w.transform.get_object_center(p,!1,q);p=d||1;d=a||2;var C=c||1;c=g||1;H[0]=0;H[1]=-1;H[2]=0;var y=b4w.transform.get_rotation_quat(b);g=b4w.util.quat_to_dir(y,H);a=b4w.camera.get_angles(b);var M=b4w.transform.get_translation(b);D.subtract(q,
M,x);D.normalize(x,x);var A=L.rotationTo(g,x,L.create());L.multiply(A,y,B);b4w.util.correct_cam_quat_up(B,!1);D.subtract(q,M,H);var R=D.length(H)*(1-1/d),q=Math.asin(x[1]);d=Math.acos(-x[2]/Math.abs(Math.cos(q)));0<x[0]&&(d=2*Math.PI-d);var v=d-a[0],z=q-a[1];K[0]=0;K[1]=0;K[2]=-1;d=b4w.transform.get_rotation_quat(b);0>b4w.util.quat_to_dir(d,K)[1]?(z=0<g[1]?q-Math.PI+a[1]:q+Math.PI+a[1],v=0<v?-Math.PI+v:Math.PI+v):Math.abs(v)>Math.PI&&(v=0<v?v-2*Math.PI:v+2*Math.PI);var z=-z,E=0,q=l.create_elapsed_sensor();
g=Math.abs(v/p);p=Math.abs(z/p);var h=g>p?g:p,s=h+C,ja=s+c,ya=ja+C,ka=v,ba=z,la=R;l.create_sensor_manifold(b,"TRACK_TO_TARGET",l.CT_CONTINUOUS,[q],null,function(a,A,b){if(b)if(b=l.get_sensor_value(a,A,0),E+=b,E<h){var d=v/h*b;b*=z/h;A=E/h;A=6*A*(1-A);d*=A;b*=A;ka-=d;ba-=b;b4w.camera.rotate(a,d,b)}else E<s?(ka&&(b4w.camera.rotate(a,ka,ba),ka=0,n&&n()),A=(E-h)/C,b=-R*b/C,la-=d,b4w.transform.move_local(a,0,6*b*A*(1-A),0)):E<ja?la&&(b4w.transform.move_local(a,0,la,0),la=0):E<ya?(A=(E-ja)/C,b=R*b/C,b=
6*b*A*(1-A),b4w.transform.move_local(a,0,b,0)):(b4w.transform.set_translation_v(a,M),l.remove_sensor_manifold(a,A),u&&u())})}};c.auto_rotate=function(b,p){function d(a,d,g){1==g&&(d=l.get_sensor_value(a,d,0),b4w.camera.rotate_pivot(a,d*b,0))}function a(){l.remove_sensor_manifold(c,"AUTO_ROTATE");l.remove_sensor_manifold(c,"DISABLE_AUTO_ROTATE");p()}p=p||function(){};var c=b4w.scenes.get_active_camera();if("TARGET"!==c.data.b4w_move_style)throw"wrong camera type";if(l.check_sensor_manifold(c,"AUTO_ROTATE"))a();
else{var g=l.create_mouse_move_sensor("X"),u=l.create_mouse_move_sensor("Y"),n=l.create_mouse_click_sensor(),q=l.create_elapsed_sensor();l.create_sensor_manifold(c,"DISABLE_AUTO_ROTATE",l.CT_LEVEL,[g,u,n],function(a){return a[0]&&a[2]||a[1]&&a[2]},a);l.create_sensor_manifold(c,"AUTO_ROTATE",l.CT_CONTINUOUS,[q],function(a){return a[0]},d)}}};if(window.b4w)window.b4w.camera_anim=b4w.require("camera_anim");else throw"Failed to register camera_anim, load b4w first";b4w.module.mixer=function(c,b){function x(){q=n.length=0;C=H(100);y=new Float32Array(C.length);M=new Float32Array(C.length);var a=g.get_speakers();if(a.length){n.push(K());for(var b=0;b<a.length;b++)n.push(l(a[b]));n.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function H(a){for(var b=new Float32Array(a),d=0,g=0;g<a;g++)b[g]=20*Math.pow(1E3,d),d+=1/(a-1);
return b}function K(){var a=B("MASTER");a.params.push(["VOLUME",g.get_volume(null),0,1,50,!1]);var b=g.get_compressor_params();b&&(a.params.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.params.push(["KNEE",b.knee,0,40,40,!1]),a.params.push(["RATIO",b.ratio,1,20,20,!1]),a.params.push(["ATTACK",b.attack,0,1,1E3,!1]),a.params.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=g.is_muted(null)?1:0;a.solo=-1;return a}function B(a){return{id:a,params:[],active_param:0,mute:-1,solo:-1,speaker:null}}function l(a){var b=
B(pa.get_object_name(a));b.mute=g.is_muted(a)?1:0;b.solo=0;b.speaker=a;return b}function D(a){if(a.speaker){a.params.length=0;a.params.push(["VOLUME",g.get_volume(a.speaker),0,1,50,!1]);var b=g.get_positional_params(a.speaker);b&&(a.params.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.params.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.params.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=g.get_filter_params(a.speaker))a.params.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.params.push(["EQ_Q",b.Q,
0,10,100,!1]),a.params.push(["EQ_GAIN",b.gain,-70,30,100,!1]);u.clamp(a.active_param,0,a.params.length-1)}}function L(a){for(var b=0;b<n.length;b++){var d=n[b];if(d!=a&&1==d.solo)return!0}return!1}function Y(a){for(var b=0;b<n.length;b++){var d=n[b];d!=a&&0==d.mute&&0==d.solo&&g.mute(d.speaker,!1)}}function p(){if(0==n.length)return[0,-1];var a=8*Math.floor(q/8),b=a+7,a=u.clamp(a,0,n.length-1),b=u.clamp(b,0,n.length-1);return[a,b]}var d=b("controls");b("debug");var a=b("hud"),pa=b("scenes"),g=b("sfx"),
u=b("util"),n=[],q=0,C=null,y=null,M=null;c.enable_mixer_controls=function(b){x();var c=d.create_keyboard_sensor(d.KEY_LEFT_SQ_BRACKET),l=d.create_keyboard_sensor(d.KEY_RIGHT_SQ_BRACKET),z=d.create_keyboard_sensor(d.KEY_SEMI_COLON),E=d.create_keyboard_sensor(d.KEY_SINGLE_QUOTE),h=d.create_keyboard_sensor(d.KEY_SHIFT),s=d.create_timer_sensor(0.15),ja=d.create_timer_sensor(0.05),c=[c,l,z,E,h,s,ja],l=function(a,b,h){if(1==h){h=Boolean(d.get_sensor_value(a,b,0))?-1:1;if(n.length){1==h&&q<n.length-1?q++:
-1==h&&0<q&&q--;h=p();for(var s=h[0];s<=h[1];s++)D(n[s])}"SWITCH_STRIP"==b?d.reset_timer_sensor(a,b,5,0.3):d.reset_timer_sensor(a,b,5,0)}else d.reset_timer_sensor(a,b,5,10)};d.create_sensor_manifold(b,"SWITCH_STRIP",d.CT_TRIGGER,c,function(a){return(a[0]||a[1])&&!a[4]},l);d.create_sensor_manifold(b,"SWITCH_STRIP_HOLD",d.CT_SHOT,c,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},l);d.create_sensor_manifold(b,"SWITCH_PARAM",d.CT_SHOT,c,function(a){return(a[0]||a[1])&&a[4]},function(a,b,h){a=Boolean(d.get_sensor_value(a,
b,0))?-1:1;(b=n[q])&&(1==a&&b.active_param<b.params.length-1?b.active_param++:-1==a&&0<b.active_param&&b.active_param--)});l=function(a,b,h){if(1==h){var s=Boolean(d.get_sensor_value(a,b,2))?-1:1,f=n[q];if(f)switch(h=f.params[f.active_param],h[1]=h[5]?h[1]*Math.pow(h[3]/h[2],s/h[4]):h[1]+s*((h[3]-h[2])/h[4]),h[1]=u.clamp(h[1],h[2],h[3]),h[0]){case "VOLUME":"MASTER"!=f.id?g.set_volume(f.speaker,h[1]):g.set_volume(null,h[1]);break;case "DIST_REF":s=g.get_positional_params(f.speaker);s.dist_ref=h[1];
g.set_positional_params(f.speaker,s);break;case "ATTENUATION":s=g.get_positional_params(f.speaker);s.attenuation=h[1];g.set_positional_params(f.speaker,s);break;case "DIST_MAX":s=g.get_positional_params(f.speaker);s.dist_max=h[1];g.set_positional_params(f.speaker,s);break;case "EQ_FREQ":s=g.get_filter_params(f.speaker);s.freq=h[1];g.set_filter_params(f.speaker,s);break;case "EQ_Q":s=g.get_filter_params(f.speaker);s.Q=h[1];g.set_filter_params(f.speaker,s);break;case "EQ_GAIN":s=g.get_filter_params(f.speaker);
s.gain=h[1];g.set_filter_params(f.speaker,s);break;case "THRESHOLD":f=g.get_compressor_params();f.threshold=h[1];g.set_compressor_params(f);break;case "KNEE":f=g.get_compressor_params();f.knee=h[1];g.set_compressor_params(f);break;case "RATIO":f=g.get_compressor_params();f.ratio=h[1];g.set_compressor_params(f);break;case "ATTACK":f=g.get_compressor_params();f.attack=h[1];g.set_compressor_params(f);break;case "RELEASE":f=g.get_compressor_params();f.release=h[1];g.set_compressor_params(f);break;default:throw"Unknown strip param";
}"INC_DEC"==b?d.reset_timer_sensor(a,b,6,0.3):d.reset_timer_sensor(a,b,6,0)}else d.reset_timer_sensor(a,b,6,10)};d.create_sensor_manifold(b,"INC_DEC",d.CT_TRIGGER,c,function(a){return(a[2]||a[3])&&!a[4]},l);d.create_sensor_manifold(b,"INC_DEC_HOLD",d.CT_SHOT,c,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},l);d.create_sensor_manifold(b,"MUTE_SOLO",d.CT_SHOT,c,function(a){return(a[2]||a[3])&&a[4]},function(a,b,h){if(Boolean(d.get_sensor_value(a,b,2)))(a=n[q])&&0<=a.mute&&("MASTER"!=a.id?0==a.mute?(a.mute=
1,g.mute(a.speaker,!0),1==a.solo&&(a.solo=0,L(a)||Y(a))):(a.mute=0,L(a)||g.mute(a.speaker,!1)):0==a.mute?(a.mute=1,g.mute(null,!0)):(a.mute=0,g.mute(null,!1)));else if((a=n[q])&&0<=a.solo)if(0==a.solo)for(a.solo=1,g.mute(a.speaker,!1),1==a.mute&&(a.mute=0),b=0;b<n.length;b++)h=n[b],h!=a&&0==h.mute&&0==h.solo&&g.mute(h.speaker,!0);else a.solo=0,L(a)?g.mute(a.speaker,!0):Y(a)});c=d.create_elapsed_sensor();d.create_sensor_manifold(b,"MIXER_DRAW",d.CT_CONTINUOUS,[c],null,function(){if(n[q])for(var b=
p(),h=b[0];h<=b[1];h++){var s=n[h];a.draw_mixer_strip(s.id,h==q,h%8,s.params,s.active_param,s.mute,s.solo);if(s.speaker&&g.get_filter_params(s.speaker)){g.get_filter_freq_response(s.speaker,C,y,M);for(s=0;s<y.length;s++)y[s]=20*Math.log(y[s])/Math.LN10;a.plot_array("EQ",h%8,y,20,2E4,-10,10)}}});c=d.create_timer_sensor(1);d.create_sensor_manifold(b,"MIXER_UPDATE",d.CT_TRIGGER,[c],null,function(){for(var a=p(),h=a[0];h<=a[1];h++)D(n[h])})}};
if(window.b4w)window.b4w.mixer=b4w.require("mixer");else throw"Failed to register mixer, load b4w first";b4w.module.app=function(c,b){function x(){var a=u.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=u.is_paused(),u.pause()):a||u.resume()},!1)}function H(a){var b=window.onload;window.onload=function(){"function"==typeof b&&b();a()}}function K(a){var b=window.onunload;window.onunload=function(){"function"==typeof b&&b();a()}}function B(a,b){var d=String(a);b&&(d+="/"+String(b));z.innerHTML=d}function l(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,
a);return b}function D(a,b,d){function g(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",g,!1),document.removeEventListener("webkitfullscreenchange",g,!1),document.removeEventListener("mozfullscreenchange",g,!1),document.removeEventListener("MSFullscreenChange",g,!1),d())}b=b||function(){};d=d||function(){};document.addEventListener("fullscreenchange",
g,!1);document.addEventListener("webkitfullscreenchange",g,!1);document.addEventListener("mozfullscreenchange",g,!1);document.addEventListener("MSFullscreenChange",g,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen==a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()}function L(a,b,d,g){var c=document.createElement("div"),p=document.createElement("div"),n=document.createElement("div"),
f=document.createElement("div"),l=document.createElement("div");if(g)for(var q=0;q<g.length;q++){var u=document.getElementById(g[q]);u&&u.parentNode.removeChild(u)}c.style.cssText="z-index:10;width:100%;height:100%;position:absolute;";f.style.cssText="position:absolute;bottom:0;width:100%;height:auto;";l.style.cssText="position:relative;float:right;margin:20px;width:70px;height:70px;background-image:url('data:image/png;base64,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')";
p.style.cssText="position:relative;top:0;width:100%;background-color:#000;opacity:0.6;height:auto;color:#ffd42a;text-align:center;font-size:32px;padding:10px 0;font-family: Arial;";n.style.cssText="position:relative;clear:both;bottom:0;width:100%;background-color:#000;opacity:0.6;height:auto;color:#fff;text-align:center;font-size:20px;padding:10px 0;font-family: Arial;";p.innerHTML=a;n.innerHTML=b+'   <a style="color:#ffd42a;font-size:20px;width:100%;" href="'+d+'">'+d+"</a>";f.appendChild(l);f.appendChild(n);
c.appendChild(p);c.appendChild(f);document.body.appendChild(c)}var Y=b("animation"),p=b("camera"),d=b("config"),a=b("controls"),pa=b("data"),g=b("debug"),u=b("main"),n=b("physics"),q=b("print"),C=b("scenes"),y=b("transform"),M=b("util"),A=b("vec3"),R=null,v=null,z=null,E=new Float32Array(3);c.init=function(a){a=a||{};var b=null,g=function(){},c=!1,p=!1,n=!1,l=!1,f=!1,y=null,A=null,C=!1,E=!0,D;for(D in a)switch(D){case "canvas_container_id":b=a.canvas_container_id;break;case "callback":g=a.callback;
break;case "do_not_use_onload":c=a.do_not_use_onload;break;case "gl_debug":p=a.gl_debug;break;case "show_hud_debug_info":n=a.show_hud_debug_info;break;case "sfx_mix_mode":l=a.sfx_mix_mode;break;case "show_fps":f=a.show_fps;break;case "fps_elem_id":y=a.fps_elem_id;break;case "error_purge_elements":A=a.error_purge_elements;break;case "do_not_report_init_failure":C=a.do_not_report_init_failure;break;case "pause_invisible":E=a.pause_invisible;break;default:d.set(D,a[D])}d.set("show_hud_debug_info",n);
d.set("sfx_mix_mode",l);var na=n||l||null;a=function(){var a;a=b;var h=C,d=A,c=document.createElement("canvas");c.style.cssText="position: absolute;left:0px; top:0px;";if(na){var n=document.createElement("canvas");n.style.cssText="z-index: 2; position:absolute; left:0px; top:0px; pointer-events: none;"}else n=null;u.init(c,n)?(v=c,h=document.getElementById(a),h||(q.error('Warning: canvas container "'+a+'" not found, appending to body'),h=document.body),h.appendChild(c),n&&h.appendChild(n),a=h):(h||
L("Browser could not initialize WebGL","For more info visit","http://blend4web.com/troubleshooting",d),a=null);a?(R=a,u.set_check_gl_errors(p),f&&(y?z=document.getElementById(y):(z=document.createElement("div"),z.innerHTML=0,z.style.cssText="             position:absolute;            top: 23px;            right: 20px;            font-size: 45px;            line-height: 50px;            font-weight: bold;            color: #000;            z-index: 1;        ",document.body.appendChild(z)),u.set_fps_callback(B)),
E&&x(),g(v,!0)):g(v,!1)};n=function(){u.pause();pa.cleanup()};c?(a(),n()):(H(a),K(n))};c.get_canvas_container=function(){return R};c.set_onclick=function(a,b){var d=l(a);d.addEventListener("mouseup",function(a){b(d.value)},!1)};c.set_onchange=function(a,b){var d=l(a);d.addEventListener("change",function(a){a=d.checked;b(void 0!=a?a:d.value)},!1)};c.set_onkeypress=function(a,b){var d=l(a);d.addEventListener("keypress",function(a){b(a.keyCode,d.value)},!1)};c.enable_camera_controls=function(b,d,g,c){b||
(b=1);d||(d=1);g||(g=1);document.addEventListener("keydown",function(b){b.keyCode==a.KEY_O?D(document.body):b.keyCode==a.KEY_P&&(u.is_paused()?u.resume():u.pause())},!1);var l=C.get_active_camera();switch(p.get_move_style(l)){case p.MS_TARGET_CONTROLS:var q=!c;break;case p.MS_EYE_CONTROLS:q=!1;break;case p.MS_STATIC:return}c=a.create_elapsed_sensor();var x=n.has_simulated_physics(l),f=function(c,g,f){x&&n.apply_force(c,0,0,0);if(1==f){f=a.get_sensor_value(c,g,0);var l=[1800,2100,1800],t=p.get_trans_speed(c);
switch(g){case "FORWARD":x?n.apply_force(c,0,-l[1],0):y.move_local(c,0,-b*t*f,0);break;case "BACKWARD":x?n.apply_force(c,0,l[1],0):y.move_local(c,0,b*t*f,0);break;case "UP":x?n.apply_force(c,0,0,-l[2]):y.move_local(c,0,0,-b*t*f);break;case "DOWN":x?n.apply_force(c,0,0,l[2]):y.move_local(c,0,0,b*t*f);break;case "LEFT":x?n.apply_force(c,-l[0],0,0):y.move_local(c,-b*t*f,0,0);break;case "RIGHT":x?n.apply_force(c,l[0],0,0):y.move_local(c,b*t*f,0,0);break;case "ROT_LEFT":q?p.rotate_pivot(c,2*-d*f,0):p.rotate(c,
2*d*f,0);break;case "ROT_RIGHT":q?p.rotate_pivot(c,2*d*f,0):p.rotate(c,2*-d*f,0);break;case "ROT_UP":q?p.rotate_pivot(c,0,2*-d*f):p.rotate(c,0,2*-d*f);break;case "ROT_DOWN":q?p.rotate_pivot(c,0,2*d*f):p.rotate(c,0,2*d*f);break;case "ROT_LEFT":q?p.rotate_pivot(c,2*-d*f,0):p.rotate(c,2*d*f,0);break;case "ROT_RIGHT":q?p.rotate_pivot(c,2*d*f,0):p.rotate(c,2*-d*f,0)}}},v=a.create_keyboard_sensor(a.KEY_W),z=a.create_keyboard_sensor(a.KEY_S),B=a.create_keyboard_sensor(a.KEY_A),H=a.create_keyboard_sensor(a.KEY_D),
K=a.create_keyboard_sensor(a.KEY_R),na=a.create_keyboard_sensor(a.KEY_F),U=a.create_keyboard_sensor(a.KEY_UP),L=a.create_keyboard_sensor(a.KEY_DOWN),R=a.create_keyboard_sensor(a.KEY_LEFT),oa=a.create_keyboard_sensor(a.KEY_RIGHT),N=function(a){return a[0]&&(a[1]||a[2])};a.create_sensor_manifold(l,"FORWARD",a.CT_CONTINUOUS,[c,v],null,f);a.create_sensor_manifold(l,"BACKWARD",a.CT_CONTINUOUS,[c,z],null,f);q?(a.create_sensor_manifold(l,"ROT_UP",a.CT_CONTINUOUS,[c,U,K],N,f),a.create_sensor_manifold(l,"ROT_DOWN",
a.CT_CONTINUOUS,[c,L,na],N,f),a.create_sensor_manifold(l,"ROT_LEFT",a.CT_CONTINUOUS,[c,R,B],N,f),a.create_sensor_manifold(l,"ROT_RIGHT",a.CT_CONTINUOUS,[c,oa,H],N,f)):(a.create_sensor_manifold(l,"UP",a.CT_CONTINUOUS,[c,K],N,f),a.create_sensor_manifold(l,"DOWN",a.CT_CONTINUOUS,[c,na],N,f),a.create_sensor_manifold(l,"LEFT",a.CT_CONTINUOUS,[c,B],N,f),a.create_sensor_manifold(l,"RIGHT",a.CT_CONTINUOUS,[c,H],N,f),a.create_sensor_manifold(l,"ROT_UP",a.CT_CONTINUOUS,[c,U],N,f),a.create_sensor_manifold(l,
"ROT_DOWN",a.CT_CONTINUOUS,[c,L],N,f),a.create_sensor_manifold(l,"ROT_LEFT",a.CT_CONTINUOUS,[c,R],N,f),a.create_sensor_manifold(l,"ROT_RIGHT",a.CT_CONTINUOUS,[c,oa],N,f));var ha=0,f=a.create_mouse_wheel_sensor();a.create_sensor_manifold(l,"MOUSE_WHEEL",a.CT_LEVEL,[f],null,function(c,d,f){1==f&&(d=a.get_sensor_value(c,d,0),q?(f=p.get_eye(c),p.get_pivot(c,E),c=A.dist(E,f),ha+=0.1*-d*c*b):(c=d*g,d=C.get_active_camera(),p.change_trans_speed(d,c)))});var I=0,f=a.create_touch_zoom_sensor();a.create_sensor_manifold(l,
"TOUCH_ZOOM",a.CT_LEVEL,[f],null,function(c,d,f,g){1==f&&q&&(d=a.get_sensor_value(c,d,0),f=p.get_eye(c),p.get_pivot(c,E),c=A.dist(E,f),I+=0.005*-d*c*b)});a.create_sensor_manifold(l,"ZOOM_INTERPOL",a.CT_CONTINUOUS,[c],null,function(b,c,d){1==d&&(0.001<Math.abs(ha)||0.001<Math.abs(I))&&q&&(d=a.get_sensor_value(b,c,0),c=M.smooth(ha,0,d,0.1),ha-=c,d=M.smooth(I,0,d,0.15),I-=d,y.move_local(b,0,c+d,0))});var ca=0,P=0,f=a.create_mouse_move_sensor("X"),v=a.create_mouse_move_sensor("Y"),z=a.create_mouse_click_sensor(),
B=function(b,c,h,f){1==h&&(b=a.get_sensor_value(b,c,1),q&&(c=0.01*d,ca+="X"==f?-b*c:0,P+="Y"==f?-b*c:0))};a.create_sensor_manifold(l,"MOUSE_X",a.CT_LEVEL,[z,f],null,B,"X");a.create_sensor_manifold(l,"MOUSE_Y",a.CT_LEVEL,[z,v],null,B,"Y");var t=0,da=0,f=a.create_touch_move_sensor("X"),v=a.create_touch_move_sensor("Y"),z=function(b,c,h,f){1==h&&q&&(h=0.007*d,b=a.get_sensor_value(b,c,0),t+="X"==f?-b*h:0,da+="Y"==f?-b*h:0)};a.create_sensor_manifold(l,"TOUCH_X",a.CT_LEVEL,[f],null,z,"X");a.create_sensor_manifold(l,
"TOUCH_Y",a.CT_LEVEL,[v],null,z,"Y");a.create_sensor_manifold(l,"ROT_INTERPOL",a.CT_CONTINUOUS,[c],null,function(b,c,d){if(1==d&&(0.001<Math.abs(ca)||0.001<Math.abs(P)||0.001<Math.abs(t)||0.001<Math.abs(da))&&q){var h=a.get_sensor_value(b,c,0);c=M.smooth(ca,0,h,0.08);d=M.smooth(P,0,h,0.08);ca-=c;P-=d;var f=M.smooth(t,0,h,0.12),h=M.smooth(da,0,h,0.12);t-=f;da-=h;p.rotate_pivot(b,c+f,d+h)}});a.create_kb_sensor_manifold(l,"TOGGLE_CAMERA_COLLISION",a.CT_SHOT,a.KEY_C,function(){var a=C.get_active_camera();
Y.is_detect_collisions_used(a)?Y.detect_collisions(a,!1):Y.detect_collisions(a,!0)});a.create_kb_sensor_manifold(l,"DEC_STEREO_DIST",a.CT_SHOT,a.KEY_LEFT_SQ_BRACKET,function(a,b,c){b=p.get_stereo_distance(a);p.set_stereo_distance(a,0.9*b)});a.create_kb_sensor_manifold(l,"INC_STEREO_DIST",a.CT_SHOT,a.KEY_RIGHT_SQ_BRACKET,function(a,b,c){b=p.get_stereo_distance(a);p.set_stereo_distance(a,1.1*b)})};c.disable_camera_controls=function(){for(var b=C.get_active_camera(),c="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_INTERPOL".split(" "),
d=0;d<c.length;d++)a.remove_sensor_manifold(b,c[d])};c.enable_object_controls=function(b){var c=n.is_vehicle_chassis(b)||n.is_vehicle_hull(b),d=function(b,d,h){if(1==h)switch(h=a.get_sensor_value(b,d,0),d){case "FORWARD":c?n.vehicle_throttle(b,1):y.move_local(b,0,0,1*h);break;case "BACKWARD":c?n.vehicle_throttle(b,-1):y.move_local(b,0,0,-1*h);break;case "LEFT":c?n.vehicle_steer(b,-1):y.move_local(b,1*h,0,0);break;case "RIGHT":c?n.vehicle_steer(b,1):y.move_local(b,-1*h,0,0)}else switch(d){case "FORWARD":case "BACKWARD":c&&
n.vehicle_throttle(b,0);break;case "LEFT":case "RIGHT":c&&n.vehicle_steer(b,0)}},g=a.create_elapsed_sensor(),l=a.create_keyboard_sensor(a.KEY_W),p=a.create_keyboard_sensor(a.KEY_S),q=a.create_keyboard_sensor(a.KEY_A),f=a.create_keyboard_sensor(a.KEY_D),u=a.create_keyboard_sensor(a.KEY_UP),x=a.create_keyboard_sensor(a.KEY_DOWN),z=a.create_keyboard_sensor(a.KEY_LEFT),A=a.create_keyboard_sensor(a.KEY_RIGHT),v=function(a){return a[0]&&(a[1]||a[2])};a.create_sensor_manifold(b,"FORWARD",a.CT_CONTINUOUS,
[g,l,u],v,d);a.create_sensor_manifold(b,"BACKWARD",a.CT_CONTINUOUS,[g,p,x],v,d);a.create_sensor_manifold(b,"LEFT",a.CT_CONTINUOUS,[g,q,z],v,d);a.create_sensor_manifold(b,"RIGHT",a.CT_CONTINUOUS,[g,f,A],v,d)};c.disable_object_controls=function(b){for(var c=["FORWARD","BACKWARD","LEFT","RIGHT"],d=0;d<c.length;d++)a.remove_sensor_manifold(b,c[d])};c.enable_controls=function(b){document.addEventListener("keydown",a.keydown_cb,!1);document.addEventListener("keyup",a.keyup_cb,!1);b.addEventListener("mousewheel",
a.mouse_wheel_cb,!1);b.addEventListener("DOMMouseScroll",a.mouse_wheel_cb,!1);b.addEventListener("mousedown",a.mouse_down_cb,!1);b.addEventListener("mouseup",a.mouse_up_cb,!1);b.addEventListener("mousemove",a.mouse_move_cb,!1);b.addEventListener("touchstart",a.touch_start_cb,!1);b.addEventListener("touchmove",a.touch_move_cb,!1)};c.disable_controls=function(b){document.removeEventListener("keydown",a.keydown_cb,!1);document.removeEventListener("keyup",a.keyup_cb,!1);b.removeEventListener("mousewheel",
a.mouse_wheel_cb,!1);b.removeEventListener("DOMMouseScroll",a.mouse_wheel_cb,!1);document.body.removeEventListener("mousedown",a.mouse_down_cb,!1);document.body.removeEventListener("mouseup",a.mouse_up_cb,!1);b.removeEventListener("mousemove",a.mouse_move_cb,!1);b.removeEventListener("touchstart",a.touch_start_cb,!1);b.removeEventListener("touchmove",a.touch_move_cb,!1)};c.enable_debug_controls=function(){var b=C.get_active_camera();a.create_kb_sensor_manifold(b,"CAMERA_SHOT",a.CT_SHOT,a.KEY_K,function(){g.make_camera_frustum_shot()});
a.create_kb_sensor_manifold(b,"LIGHT_SHOT",a.CT_SHOT,a.KEY_L,function(){g.make_light_frustum_shot()});a.create_kb_sensor_manifold(b,"TELEMETRY",a.CT_SHOT,a.KEY_T,function(){g.plot_telemetry()})};c.request_fullscreen=D;c.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};c.report_app_error=L;c.get_url_params=
function(){var a=location.href.toString();if(-1==a.indexOf("?"))return null;for(var a=a.split("?")[1].split("&"),b={},c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]=1<d.length?d[1]:""}return b}};if(window.b4w)window.b4w.app=b4w.require("app");else throw"Failed to register app, load b4w first";b4w.register("viewer_main",function(c,b){function x(e){return(Ca?"../../external/deploy/assets/":"../../assets/")+e}function H(e){if(va){$("#material_warning")[0].style.display="none";e.preventDefault&&e.preventDefault();var a=e.clientX;e=e.clientY;var b=S;b&&r.clear_glow_anim(b);(S=a=r.pick_object(a,e))?(La(a),r.apply_glow_anim(a,0.2,3.8,1)):Ma();B();ia||(a?(ia=a,B(),J.enable_object_controls(a),F.create_kb_sensor_manifold(a,"QUIT",F.CT_SHOT,F.KEY_Q,function(e,a,b,wa){ia=null;B();J.disable_object_controls(e)})):
K())}}function K(){var e=r.get_active_camera();ia=e;B();J.enable_camera_controls(1,Da.camera_rot_speed);F.create_kb_sensor_manifold(e,"QUIT",F.CT_SHOT,F.KEY_Q,function(e,a,b,wa){ia=null;B();J.disable_object_controls(e)});var a=F.create_keyboard_sensor(F.KEY_Z),b=F.create_keyboard_sensor(F.KEY_DEC_POINT);F.create_sensor_manifold(e,"ZOOM_TO",F.CT_SHOT,[a,b],function(e){return e[0]||e[1]},function(e,a,b){(a=S)&&Ea.zoom_object(e,a)})}function B(){if(va){var e="CONTROLLED: "+(ia?String(ia.name):"NONE")+
" | SELECTED: "+(S?String(S.name):"NONE"),a=S;a&&(a=r.get_type_mesh_object(a))&&(e+=" | TYPE: "+a);a=ia;S&&a&&"CAMERA"===a.type&&(e+=" | DISTANCE: "+Na);va.innerHTML=e}}function l(){var e=O.get("last_item_name");if(!e)return null;for(var a=0;a<V.length;a++){var b=V[a];if(qa.keyfind("name",e,b.items)[0])return{category:b.name,item:e}}return null}function D(e,a){var b=document.getElementById(e);b.innerHTML="";for(var c=0;c<a.length;c++){var d=document.createElement("option");d.text=d.value=a[c];0===
c&&(d.selected=!0);b.appendChild(d)}$("#"+e).selectmenu();$("#"+e).selectmenu("refresh")}function L(e){e=e.target.id;if(-1!=e.indexOf("MANIFEST_ITEM_")){var a=e.split("__SEPARATOR__");e=a[1];a=a[0].split("MANIFEST_ITEM_")[1];xa=!1;clearTimeout(Oa);Y({category:e,item:a},!0,!1)}}function Y(e,b,c){for(var d=0;d<ea.children.length;d++)ea.children[d].style.visibility="hidden";ra={load_file:Za,animated_objects:[]};Da=null;Q=[];Z=0;sa=[];if(e){var d=qa.keyfind("name",e.category,V)[0],d=qa.keyfind("name",
e.item,d.items)[0],f;for(f in d)ra[f]=d[f];O.set("last_item_name",e.item)}else O.set("last_item_name","");b&&(fa.clear_render_callback(),Fa.cleanup());fa.get_canvas_elem().removeEventListener("mousedown",H);T.clear_errors_warnings();e=ra.name||"Logo";b=ra.load_file;f=document.getElementById("current_file");f.innerHTML=e;f.setAttribute("title",e+" ("+b+")");Fa.load(x(b),p,a,c)}function p(e){fa.get_canvas_elem().addEventListener("mousedown",H,!1);r.set_glow_color([1,0.4,0.05]);S=null;pa(ra);K();J.enable_debug_controls();
R()&&$a.enable_mixer_controls(r.get_active_camera());fa.set_render_callback(n);xa&&(Oa=setTimeout(d,ab));e=F.create_elapsed_sensor();F.create_sensor_manifold(r.get_active_camera(),"TO_OBJ",F.CT_CONTINUOUS,[e],null,function(e,a,b){if(1==b&&S){if(b=S)a=bb,cb.get_object_center(b,!0,a),e=Ea.get_eye(e),Na=db.dist(a,e).toFixed(3);B()}})}function d(){var e=l();if(e){var a=e.item,e=qa.keyfind("name",e.category,V)[0],a=qa.keyfind("name",a,e.items)[0],a=e.items.indexOf(a);if(a=e.items[a+1])e={category:e.name,
item:a.name};else if(e=V.indexOf(e),e=V[e+1])e={category:e.name,item:e.items[0].name};else{xa=!1;return}}else e=V[0],a=e.items[0],e={category:e.name,item:a.name};Y(e,!0,!0)}function a(e,a){document.getElementById("loading_progress").innerHTML=e+"% ("+Math.round(10*a/1E3)/10+"s)";var b=T.get_error_quantity(),d=T.get_warning_quantity();if(Fa.is_primary_loaded()){var c=T.num_vertices(),f=T.num_triangles(),h=T.num_draw_calls();document.getElementById("info_right_up").innerHTML=c+" verts, "+f+" tris, "+
h+" draw calls";var c=T.geometry_stats(),f=T.num_textures(),h=T.num_render_targets(),g=Math.round(10*(c.ibo_memory+c.vbo_memory))/10,k=Math.round(10*f.memory)/10,l=Math.round(10*h.memory)/10,m=Math.round(10*(g+k+l))/10;document.getElementById("info_right_down").innerHTML="Geometry: "+g+" MiB ("+c.ibo_number+"+"+c.vbo_number+")<br>Textures: "+k+" MiB ("+f.number+")<br>RTs: "+l+" MiB ("+h.number+")<br><br>Total: "+m+" MiB";c=T.get_error_quantity();(f=T.get_warning_quantity())||c?ea.setAttribute("title",
"warnings:"+f+"\nerrors:"+c):ea.setAttribute("title","Loaded OK");d||b||(ea.children[2].style.visibility="visible")}d&&!b&&(ea.children[1].style.visibility="visible");b&&(ea.children[1].style.visibility="hidden",ea.children[0].style.visibility="visible")}function pa(e){for(var a=r.get_active(),b=r.get_scenes(),c=0;c<b.length;c++){var d=b[c];if(d!==a){var f=g(d,e);u(d,f)}}f=g(a,e);u(a,f);La=function(e){var a=ma.get_materials_names(e);D("material_name",a);ca(e,a[0]);e=ma.get_water_material_params(e,
a[0]);a="shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" ");e?(w(a,"enable"),r.get_water_mat_params(e),e.shallow_water_col&&ga("shallow_water_col",e.shallow_water_col),
e.shallow_water_col_fac&&m("shallow_water_col_fac",e.shallow_water_col_fac),e.shore_water_col&&ga("shore_water_col",e.shore_water_col),e.shore_water_col_fac&&m("shore_water_col_fac",e.shore_water_col_fac),e.water_fog_color&&(ga("water_fog_color",e.water_fog_color),m("water_fog_density",e.water_fog_density)),m("absorb_factor",e.absorb_factor),m("sss_strength",e.sss_strength),m("sss_width",e.sss_width),m("foam_factor",e.foam_factor),m("waves_height",e.waves_height),m("waves_length",e.waves_length),
m("dst_noise_scale0",e.dst_noise_scale0),m("dst_noise_scale1",e.dst_noise_scale1),m("dst_noise_freq0",e.dst_noise_freq0),m("dst_noise_freq1",e.dst_noise_freq1),m("dir_min_shore_fac",e.dir_min_shore_fac),m("dir_freq",e.dir_freq),m("dir_noise_scale",e.dir_noise_scale),m("dir_noise_freq",e.dir_noise_freq),m("dir_min_noise_fac",e.dir_min_noise_fac),m("dst_min_fac",e.dst_min_fac),m("waves_hor_fac",e.waves_hor_fac)):w(a,"disable")};Wa();e=W.get_lights_names();D("light_name",e);da(e[0]);na();la();Va();eb();
fb();Ua();gb();Xa();ha();hb();ib();Ma();$("#wireframe_mode").val("WM_NONE");$("#wireframe_mode").selectmenu("refresh",!0);$("#wireframe_edge_color div").css("backgroundColor","#333");e=new Date(document.getElementById("date").value);Ba({date:e});Da=f}function g(e,a){function b(e,a){for(var wa in e)a[wa]=e[wa];return a}var c=a.scene_settings;if(c&&c[e]){var d={};b(a,d);b(c[e],d);delete d.scene_settings;return d}return a}function u(e,a){r.set_active(e);var b=r.get_active_camera();a.camera_target&&jb.append_follow(b,
a.camera_target);var c=a.h_angle,d=a.v_angle;0!==c&&!c||0!==d&&!d||Ea.set_eye_params(b,c,d);Z=Pa;for(b=0;b<a.animated_objects.length;b++)if(d=a.animated_objects[b],c=d instanceof Array?r.get_object_by_dupli_name(d[0],d[1]):r.get_object_by_name(d)){if(d=G.get_anim_names(c)[kb])G.apply(c,d),G.play(c),G.cyclic(c,!0)}else console.error("Animated object not found: ",d);c=[];d=r.get_appended_objs("ALL");for(b=0;b<d.length;b++){var f=d[b];if(G.is_animated(f)){var h=G.get_first_armature_object(f);h&&G.is_animated(h)?
sa.push(h,f):(Q.push(f),c.push(r.get_object_name(f)))}}b="anim_active_object anim_action anim_cyclic anim_frame_range anim_frame_current anim_play anim_stop get_max_bones".split(" ");Q.length?(w(b,"enable"),D("anim_active_object",c),ba({anim_active_object:r.get_object_name(Q[Pa])})):w(b,"disable")}function n(e,a){r.get_active_camera();var b=q(Q,Z)[0];if(b){var c=document.getElementById("anim_status");G.is_play(b)?c.innerHTML="PLAYING":c.innerHTML="STOPPED";var d=document.getElementById("anim_frame_range");
if(c=G.get_frame_range(b))d.innerHTML=c[0]+" - "+c[1],d=document.getElementById("anim_frame_current"),d.min=""+c[0],d.max=""+c[1];b=Math.round(G.get_frame(b));parseInt($("#anim_frame_current").val())!==b&&m("anim_frame_current",b)}}function q(e,a){var b=[];if(e[a]){b.push(e[a]);for(var c=0;c<sa.length;c+=2){var d=sa[c+1];sa[c]==e[a]&&b.push(d)}}return b}function C(e){O.set("quality",e.quality);setTimeout(function(){window.location.reload()},100)}function y(){O.cleanup();window.location.reload()}function M(){fa.pause()}
function A(){fa.resume()}function R(){return"true"===O.get("sfx_mix_mode")?!0:!1}function v(e){O.set("show_hud_debug_info","on"===e.show_hud_debug_info);window.location.reload()}function z(e){O.set("sfx_mix_mode","on"===e.sfx_mix_mode);window.location.reload()}function E(e){O.set("anaglyph_use","on"===e.anaglyph_use);window.location.reload()}function h(){xa=!0;d()}function s(e){var a=e.target.innerWidth;e=e.target.innerHeight;var b=document.getElementById("controls_container").offsetWidth,a=a-b;fa.resize(a,
e);document.getElementById("info_left_up").innerHTML=a+"x"+e}function ja(){for(var e=q(Q,Z),a=0;a<e.length;a++)G.play(e[a])}function ya(){for(var e=q(Q,Z),a=0;a<e.length;a++)G.stop(e[a])}function ka(){fa.pause();var e=lb.determine_max_bones();document.getElementById("max_bones").innerHTML=e.max_bones;document.getElementById("max_bones_no_blending").innerHTML=e.max_bones_no_blending;fa.resume()}function ba(e){if("anim_active_object"in e)for(var a=0;a<Q.length;a++)if(r.get_object_name(Q[a])==e.anim_active_object){Z=
a;a=G.get_anim_names(Q[Z]);a.length?D("anim_action",a):D("anim_action",["N/A"]);return}if("anim_action"in e)for(var b=q(Q,Z),a=0;a<b.length;a++)G.apply(b[a],e.anim_action),G.play(b[a]),G.cyclic(b[a],!0);if("anim_cyclic"in e)for(b=q(Q,Z),a=0;a<b.length;a++){var c=b[a];G.cyclic(c,"on"===e.anim_cyclic)}if("anim_frame_current"in e)for(e=parseInt(e.anim_frame_current),b=q(Q,Z),a=0;a<b.length;a++)c=b[a],G.is_play(c)||G.set_frame(c,e)}function la(){var a=r.get_ssao_params(),b="ssao_quality ssao_radius_increase ssao_dithering_amount ssao_gauss_center ssao_gauss_width_square ssao_gauss_width_left_square ssao_influence ssao_dist_factor ssao_only ssao_white".split(" ");
if(a){w(b,"enable");for(var c=document.getElementById("ssao_quality"),b=a.ssao_quality,c=c.options,d=0;d<c.length;d++){var f=c[d];f.selected=f.value==b?!0:!1}$("#ssao_quality").selectmenu("refresh");m("ssao_radius_increase",a.radius_increase);m("ssao_dithering_amount",1E3*a.dithering_amount);m("ssao_gauss_center",a.gauss_center);m("ssao_gauss_width_square",Math.sqrt(a.gauss_width_square));m("ssao_gauss_width_left_square",Math.sqrt(a.gauss_width_left_square));m("ssao_influence",a.influence);m("ssao_dist_factor",
a.dist_factor);b=0===a.ssao_only?1:0;document.getElementById("ssao_only").options[b].selected=!0;$("#ssao_only").slider("refresh");b=0===a.ssao_white?1:0;document.getElementById("ssao_white").options[b].selected=!0;$("#ssao_white").slider("refresh")}else w(b,"disable")}function f(a){r.get_ssao_params();var b={};"ssao_quality"in a&&(b.ssao_quality=Ia(document.getElementById("ssao_quality")));"ssao_radius_increase"in a&&(b.ssao_radius_increase=a.ssao_radius_increase);"ssao_dithering_amount"in a&&(b.ssao_dithering_amount=
a.ssao_dithering_amount/1E3);"ssao_gauss_center"in a&&(b.ssao_gauss_center=a.ssao_gauss_center);"ssao_gauss_width_square"in a&&(b.ssao_gauss_width_square=a.ssao_gauss_width_square*a.ssao_gauss_width_square);"ssao_gauss_width_left_square"in a&&(b.ssao_gauss_width_left_square=a.ssao_gauss_width_left_square*a.ssao_gauss_width_left_square);"ssao_influence"in a&&(b.ssao_influence=a.ssao_influence);"ssao_dist_factor"in a&&(b.ssao_dist_factor=a.ssao_dist_factor);"ssao_only"in a&&(b.ssao_only="on"===a.ssao_only?
1:0);"ssao_white"in a&&(b.ssao_white="on"===a.ssao_white?1:0);r.set_ssao_params(b)}function Ua(){var a=r.get_color_correction_params(),b=["brightness","contrast","exposure","saturation"];a?(w(b,"enable"),m("brightness",a.brightness),m("contrast",a.contrast),m("exposure",a.exposure),m("saturation",a.saturation)):w(b,"disable")}function ua(a){var b=r.get_color_correction_params();b&&(b={},"brightness"in a&&(b.brightness=parseFloat(a.brightness)),"contrast"in a&&(b.contrast=parseFloat(a.contrast)),"exposure"in
a&&(b.exposure=parseFloat(a.exposure)),"saturation"in a&&(b.saturation=parseFloat(a.saturation)),r.set_color_correction_params(b))}function Ia(a){a=a.options;for(var b=0;b<a.length;b++){var c=a[b];if(c.selected)return c.value}}function Va(){var a=r.get_fog_color_density();0.2<a[3]?m("fog_density",a[3]):m("fog_density1000",1E3*a[3]);ga("fog_color",a)}function za(a){var b=r.get_fog_color_density();"fog_density"in a&&(b[3]=a.fog_density);"fog_density1000"in a&&(b[3]=a.fog_density1000/1E3);"fog_color"in
a&&(b[0]=a.fog_color[0],b[1]=a.fog_color[1],b[2]=a.fog_color[2]);r.set_fog_color_density(b)}function na(){var a=r.get_shadow_params(),b="optimize_shadow_volume csm_near csm_far shadow_visibility_falloff blur_depth_size_mult blur_depth_edge_size blur_depth_diff_threshold csm_lambda".split(" ");if(!a)return w(b,"disable"),null;w(b,"enable");b=a.optimize_shadow_volume?0:1;document.getElementById("optimize_shadow_volume").options[b].selected=!0;$("#optimize_shadow_volume").slider("refresh");m("shadow_visibility_falloff",
a.shadow_visibility_falloff);m("blur_depth_size_mult",a.blur_depth_size_mult);m("blur_depth_edge_size",a.blur_depth_edge_size);m("blur_depth_diff_threshold",a.blur_depth_diff_threshold);Ja(a);m("csm_near",a.csm_near);m("csm_far",a.csm_far);m("csm_lambda",a.csm_lambda)}function U(a){var b={};"optimize_shadow_volume"in a&&(b.optimize_shadow_volume="on"===a.optimize_shadow_volume?!0:!1);"csm_near"in a&&(b.csm_near=parseFloat(a.csm_near));"csm_far"in a&&(b.csm_far=parseFloat(a.csm_far));"csm_lambda"in
a&&(b.csm_lambda=parseFloat(a.csm_lambda));"shadow_visibility_falloff"in a&&(b.shadow_visibility_falloff=parseFloat(a.shadow_visibility_falloff));"blur_depth_size_mult"in a&&(b.blur_depth_size_mult=parseFloat(a.blur_depth_size_mult));"blur_depth_edge_size"in a&&(b.blur_depth_edge_size=parseFloat(a.blur_depth_edge_size));"blur_depth_diff_threshold"in a&&(b.blur_depth_diff_threshold=parseFloat(a.blur_depth_diff_threshold));r.set_shadow_params(b);Ja(r.get_shadow_params())}function Ja(a){document.getElementById("csm_num").innerHTML=
" "+a.csm_num;a=a.csm_borders;var b=document.getElementById("csm_borders");b.innerHTML="(";for(var c=0;c<a.length;c++)0<c&&(b.innerHTML+=" __ "),b.innerHTML+=Math.round(10*a[c])/10;b.innerHTML+=")"}function Wa(){var a=r.get_environment_colors();m("environment_energy",a[0]);ga("horizon_color",a[1]);ga("zenith_color",a[2])}function oa(a){"environment_energy"in a&&r.set_environment_colors(a.environment_energy,null,null);"horizon_color"in a&&r.set_environment_colors(null,a.horizon_color,null);"zenith_color"in
a&&r.set_environment_colors(null,null,a.zenith_color)}function N(a){var b={};"wireframe_mode"in a&&(b.wireframe_mode=Ia(document.getElementById("wireframe_mode")));"wireframe_edge_color"in a&&(b.wireframe_edge_color=a.wireframe_edge_color);T.set_debug_params(b)}function ha(){var a=r.get_sky_params(),b="sky_color rayleigh_brightness mie_brightness spot_brightness scatter_strength rayleigh_strength mie_strength rayleigh_collection_power mie_collection_power mie_distribution".split(" ");if(!a)return w(b,
"disable"),null;w(b,"enable");ga("sky_color",a.color);m("rayleigh_brightness",a.rayleigh_brightness);m("mie_brightness",a.mie_brightness);m("spot_brightness",a.spot_brightness);m("scatter_strength",a.scatter_strength);m("rayleigh_strength",a.rayleigh_strength);m("mie_strength",a.mie_strength);m("rayleigh_collection_power",a.rayleigh_collection_power);m("mie_collection_power",a.mie_collection_power);m("mie_distribution",a.mie_distribution)}function I(a){var b={};"sky_color"in a&&(b.color=a.sky_color);
"rayleigh_brightness"in a&&(b.rayleigh_brightness=a.rayleigh_brightness);"mie_brightness"in a&&(b.mie_brightness=a.mie_brightness);"spot_brightness"in a&&(b.spot_brightness=a.spot_brightness);"scatter_strength"in a&&(b.scatter_strength=a.scatter_strength);"rayleigh_strength"in a&&(b.rayleigh_strength=a.rayleigh_strength);"mie_strength"in a&&(b.mie_strength=a.mie_strength);"rayleigh_collection_power"in a&&(b.rayleigh_collection_power=a.rayleigh_collection_power);"mie_collection_power"in a&&(b.mie_collection_power=
a.mie_collection_power);"mie_distribution"in a&&(b.mie_distribution=a.mie_distribution);r.set_sky_params(b)}function ca(a,b){var c=ma.get_material_extended_params(a,b),d="material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" ");if(!c)return w(d,"disable"),$("#material_warning")[0].style.display="block",null;var f=ma.get_diffuse_color(a,b);f.pop();c.diffuse_color=f;w(d,"enable");ga("material_diffuse_color",
c.diffuse_color);m("material_reflectivity",c.reflect_factor);m("material_fresnel",c.fresnel);m("material_fresnel_factor",c.fresnel_factor);m("material_parallax_scale",c.parallax_scale);m("material_parallax_steps",c.parallax_steps)}function P(a){var b=S;"material_name"in a&&ca(b,a.material_name);if("material_diffuse_color"in a){var c=a.material_diffuse_color.slice();c.push(1);ma.set_diffuse_color(b,$("#material_name").val(),c)}c={};"material_reflectivity"in a&&(c.material_reflectivity=a.material_reflectivity);
"material_fresnel"in a&&(c.material_fresnel=a.material_fresnel);"material_fresnel_factor"in a&&(c.material_fresnel_factor=a.material_fresnel_factor);"material_parallax_scale"in a&&(c.material_parallax_scale=a.material_parallax_scale);"material_parallax_steps"in a&&(c.material_parallax_steps=a.material_parallax_steps);ma.set_material_extended_params(b,$("#material_name").val(),c);r.update_scene_materials_params()}function t(a){var b=S,c="waves_height waves_length sss_strength sss_width dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac".split(" ");
if(!b)return null;var d={},f=$("#water_dynamic").val(),h=$("#shore_smoothing").val();"1"==f?(f=!0,w(c,"enable")):(f=!1,w(c,"disable"));"1"==h?(h=!0,w(["absorb_factor"],"enable")):(h=!1,w(["absorb_factor"],"disable"));"shore_smoothing"in a&&(d.shore_smoothing=h);"absorb_factor"in a&&(d.absorb_factor=a.absorb_factor);"water_fog_color"in a&&(d.water_fog_color=a.water_fog_color);"water_fog_density"in a&&(d.water_fog_density=a.water_fog_density);"shallow_water_col"in a&&(d.shallow_water_col=a.shallow_water_col);
"shallow_water_col_fac"in a&&(d.shallow_water_col_fac=a.shallow_water_col_fac);"shore_water_col"in a&&(d.shore_water_col=a.shore_water_col);"shore_water_col_fac"in a&&(d.shore_water_col_fac=a.shore_water_col_fac);"foam_factor"in a&&(d.foam_factor=a.foam_factor);"sss_strength"in a&&(d.sss_strength=a.sss_strength);"sss_width"in a&&(d.sss_width=a.sss_width);"water_dynamic"in a&&(d.water_dynamic=f);"waves_height"in a&&(d.waves_height=a.waves_height);"waves_length"in a&&(d.waves_length=a.waves_length);
"dst_noise_scale0"in a&&(d.dst_noise_scale0=a.dst_noise_scale0);"dst_noise_scale1"in a&&(d.dst_noise_scale1=a.dst_noise_scale1);"dst_noise_freq0"in a&&(d.dst_noise_freq0=a.dst_noise_freq0);"dst_noise_freq1"in a&&(d.dst_noise_freq1=a.dst_noise_freq1);"dir_min_shore_fac"in a&&(d.dir_min_shore_fac=a.dir_min_shore_fac);"dir_freq"in a&&(d.dir_freq=a.dir_freq);"dir_noise_scale"in a&&(d.dir_noise_scale=a.dir_noise_scale);"dir_noise_freq"in a&&(d.dir_noise_freq=a.dir_noise_freq);"dir_min_noise_fac"in a&&
(d.dir_min_noise_fac=a.dir_min_noise_fac);"dst_min_fac"in a&&(d.dst_min_fac=a.dst_min_fac);"waves_hor_fac"in a&&(d.waves_hor_fac=a.waves_hor_fac);if(!ma.set_water_material_params(b,$("#material_name").val(),d))return null;r.update_scene_materials_params();r.set_water_params(d)}function da(a){a=W.get_light_params(a);ga("light_color",a.light_color);m("light_energy",a.light_energy)}function Aa(a){"light_name"in a&&da(a.light_name);var b={};"light_color"in a&&(b.light_color=a.light_color);"light_energy"in
a&&(b.light_energy=parseFloat(a.light_energy));W.set_light_params($("#light_name").val(),b)}function Xa(){var a=W.get_sun_params(),b=["sun_horizontal_position","sun_vertical_position"];if(!a)return w(b,"disable"),null;m("sun_horizontal_position",a.hor_position);m("sun_vertical_position",a.vert_position)}function Ka(a){var b={};"sun_horizontal_position"in a&&(b.hor_position=parseFloat(a.sun_horizontal_position),b.vert_position=parseFloat(document.getElementById("sun_vertical_position").value));"sun_vertical_position"in
a&&(b.hor_position=parseFloat(document.getElementById("sun_horizontal_position").value),b.vert_position=parseFloat(a.sun_vertical_position));W.set_sun_params(b)}function Ya(a){a=parseFloat(a.max_sun_angle);W.set_max_sun_angle(a)}function Ba(a){"day_time"in a&&W.set_day_time(a.day_time);"date"in a&&W.set_date(new Date(a.date))}function mb(){var a=0,b=parseFloat(document.getElementById("day_time").value),c=F.create_elapsed_sensor(),d=W.get_lamps("SUN")[0];F.create_sensor_manifold(d,"ELAPSED",F.CT_CONTINUOUS,
[c],function(a){return a[0]},function(c,d,f){1==f&&(a=document.getElementById("sun_time_multiplier").value,c=F.get_sensor_value(c,d,0),b+=c*a/3600,24<b&&(b-=Math.floor(b)),m("day_time",b))})}function ib(){var a="run_sun stop_sun date sun_time_multiplier day_time max_sun_angle".split(" ");if(!W.get_lamps("SUN")[0])return w(a,"disable"),null}function Ma(){w("material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" "),
"disable");w("shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" "),"disable")}function nb(){var a=W.get_lamps("SUN")[0];F.check_sensor_manifolds(a)&&F.remove_sensor_manifold(a,
"ELAPSED")}function eb(){var a=r.get_dof_params(),b=["dof_distance","dof_front","dof_rear","dof_power","dof_on"];a?(m("dof_distance",a.dof_distance),m("dof_front",a.dof_front),m("dof_rear",a.dof_rear),m("dof_power",a.dof_power),w(b,"enable"),a=0<a.dof_distance?0:1,document.getElementById("dof_on").options[a].selected=!0,$("#dof_on").slider("refresh")):w(b,"disable")}function ta(a){var b={};"dof_distance"in a&&1==$("#dof_on").val()&&(b.dof_distance=a.dof_distance);"dof_front"in a&&(b.dof_front=a.dof_front);
"dof_rear"in a&&(b.dof_rear=a.dof_rear);"dof_power"in a&&(b.dof_power=a.dof_power);"dof_on"in a&&(b.dof_on=$("#dof_on").val(),b.dof_distance=1==a.dof_on?$("#dof_distance").val():0);r.set_dof_params(b)}function fb(){var a=r.get_god_rays_params(),b=["god_rays_intensity","god_rays_max_ray_length","god_rays_steps"];a?(w(b,"enable"),a&&(m("god_rays_intensity",a.god_rays_intensity),m("god_rays_max_ray_length",a.god_rays_max_ray_length),m("god_rays_steps",a.god_rays_steps))):w(b,"disable")}function Ga(a){var b=
{};"god_rays_intensity"in a&&(b.god_rays_intensity=a.god_rays_intensity);"god_rays_max_ray_length"in a&&(b.god_rays_max_ray_length=a.god_rays_max_ray_length);"god_rays_steps"in a&&(b.god_rays_steps=a.god_rays_steps);r.set_god_rays_params(b)}function hb(){var a=r.get_bloom_params(),b=["bloom_key","bloom_blur","bloom_edge_lum"];a?(w(b,"enable"),a&&(m("bloom_key",a.bloom_key),m("bloom_blur",a.bloom_blur),m("bloom_edge_lum",a.bloom_edge_lum))):w(b,"disable")}function Ha(a){var b={};"bloom_key"in a&&(b.bloom_key=
a.bloom_key);"bloom_blur"in a&&(b.bloom_blur=a.bloom_blur);"bloom_edge_lum"in a&&(b.bloom_edge_lum=a.bloom_edge_lum);r.set_bloom_params(b)}function ga(a,b){b=[Math.pow(b[0],1/2.2),Math.pow(b[1],1/2.2),Math.pow(b[2],1/2.2)];var c={r:Math.round(255*b[0]),g:Math.round(255*b[1]),b:Math.round(255*b[2])};$("#"+a).ColorPickerSetColor(c);$("#"+a+" div").css("backgroundColor","#"+function(a){var b=[a.r.toString(16),a.g.toString(16),a.b.toString(16)];$.each(b,function(a,c){1==c.length&&(b[a]="0"+c)});return b.join("")}(c))}
function gb(){var a=r.get_wind_params(),b=["wind_dir","wind_strength"];a?(m("wind_dir",a.wind_dir),m("wind_strength",a.wind_strength)):w(b,"disable")}function Qa(a){var b={};"wind_dir"in a&&(b.wind_dir=a.wind_dir);"wind_strength"in a&&(b.wind_strength=a.wind_strength);r.set_wind_params(b)}function m(a,b){$("#"+a).val(b);$("#"+a).slider("refresh")}function k(a,b){$("#"+b).bind("change",function(c){var d={};d[b]=c.target.value;a(d)})}function aa(a,b){$("#"+b).ColorPicker({onChange:function(c,d,f){$("#"+
b+" div").css("backgroundColor","#"+d);c={};d=[];d[0]=f.r/255;d[1]=f.g/255;d[2]=f.b/255;f=d;f=[Math.pow(f[0],2.2),Math.pow(f[1],2.2),Math.pow(f[2],2.2)];c[b]=f;a(c)}})}function ob(){pb.auto_rotate(qb)}function w(a,b){if(!a)return null;for(var c=0;c<a.length;c++){var d=$("#"+a[c]).parent().parent();"enable"==b?d.removeClass("ui-disabled"):"disable"==b&&d.addClass("ui-disabled")}}var G=b("animation"),J=b("app"),Ra=b("assets"),Ea=b("camera"),pb=b("camera_anim"),X=b("config"),jb=b("constraints"),F=b("controls"),
Fa=b("data"),T=b("debug"),W=b("lights"),fa=b("main"),$a=b("mixer"),ma=b("material"),r=b("scenes"),lb=b("shaders"),O=b("storage"),cb=b("transform"),qa=b("util"),Sa=b("version"),db=b("vec3"),Ca="DEBUG"===Sa.type(),ab=1E3,qb=0.3,Za="dev/logo.json",Ta;Ta="true"===O.get("show_hud_debug_info")?!0:!1;var rb={canvas_container_id:"main_canvas_container",callback:function(a,b){if(!b)return console.log("b4w init failure"),null;window.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1};
window.ondragstart=function(a){a.preventDefault();a.stopPropagation();return!1};J.enable_controls(a);window.addEventListener("resize",s,!1);var c=document.createEvent("CustomEvent");c.initEvent("resize",!1,!1);window.dispatchEvent(c);Ra.enqueue([["manifest",Ra.AT_JSON,x("assets.json")]],function(a,b,c,d){V=a;va=document.getElementById("info_left_down");ea=document.getElementById("lights_cont");document.getElementById("build_date").innerHTML=Sa.date();k(C,"quality");switch(X.get("quality")){case X.P_ULTRA:var e=
0;break;case X.P_HIGH:e=1;break;case X.P_LOW:e=2;break;case X.P_CUSTOM:e=3}document.getElementById("quality").options[e].selected=!0;$("#quality").selectmenu("refresh");J.set_onclick("reset_memory",y);J.set_onclick("auto_rotate_cam",ob);J.set_onclick("pause",M);J.set_onclick("resume",A);J.set_onclick("auto_view",h);a=document.getElementById("manifest");if(V){c="";for(b=0;b<V.length;b++){e=V[b];d=e.name;for(var e=e.items,g="",g=g+"<div data-role='collapsible' data-mini='true' >",g=g+("<h6>"+d+"</h6>"),
g=g+"<ul data-role='listview' data-mini='true' data-inset='true' style='margin: -10px 0;'>",m=0;m<e.length;m++)var n=e[m].name,g=g+("<li data-mini='true'><a href='#' class='min_font' id='"+("MANIFEST_ITEM_"+n+"__SEPARATOR__"+d)+"'>"+n+"</a></li>");g+="</ul>";g+="</div>";c+=g}$("#"+a.id).append(c);$("#"+a.id).trigger("create");a.addEventListener("mouseup",L,!1)}else a.innerHTML="<p style='color: red;'>Failed loading scenes list.</p><p>Maybe a syntax error?</p>";k(ba,"anim_active_object");k(ba,"anim_action");
k(ba,"anim_cyclic");k(ba,"anim_frame_current");J.set_onclick("anim_play",ja);J.set_onclick("anim_stop",ya);J.set_onclick("get_max_bones",ka);k(P,"material_name");aa(P,"material_diffuse_color");k(P,"material_reflectivity");k(P,"material_fresnel");k(P,"material_fresnel_factor");k(P,"material_parallax_scale");k(P,"material_parallax_steps");k(t,"material_name");k(t,"shore_smoothing");k(t,"absorb_factor");k(t,"sss_strength");k(t,"sss_width");aa(t,"water_fog_color");k(t,"water_fog_density");aa(t,"shallow_water_col");
k(t,"shallow_water_col_fac");aa(t,"shore_water_col");k(t,"shore_water_col_fac");k(t,"foam_factor");k(t,"water_dynamic");k(t,"waves_height");k(t,"waves_length");k(t,"dst_noise_scale0");k(t,"dst_noise_scale1");k(t,"dst_noise_freq0");k(t,"dst_noise_freq1");k(t,"dir_min_shore_fac");k(t,"dir_freq");k(t,"dir_noise_scale");k(t,"dir_noise_freq");k(t,"dir_min_noise_fac");k(t,"dst_min_fac");k(t,"waves_hor_fac");k(oa,"environment_energy");aa(oa,"horizon_color");aa(oa,"zenith_color");k(Aa,"light_name");aa(Aa,
"light_color");k(Aa,"light_energy");aa(I,"sky_color");k(I,"rayleigh_brightness");k(I,"mie_brightness");k(I,"spot_brightness");k(I,"scatter_strength");k(I,"rayleigh_strength");k(I,"mie_strength");k(I,"rayleigh_collection_power");k(I,"mie_collection_power");k(I,"mie_distribution");k(Ba,"date");k(Ba,"day_time");k(Ka,"sun_horizontal_position");k(Ka,"sun_vertical_position");k(Ya,"max_sun_angle");J.set_onclick("run_sun",mb);J.set_onclick("stop_sun",nb);k(U,"optimize_shadow_volume");k(U,"csm_near");k(U,
"csm_far");k(U,"csm_lambda");k(U,"shadow_visibility_falloff");k(U,"blur_depth_size_mult");k(U,"blur_depth_edge_size");k(U,"blur_depth_diff_threshold");k(f,"ssao_quality");k(f,"ssao_radius_increase");k(f,"ssao_dithering_amount");k(f,"ssao_gauss_center");k(f,"ssao_gauss_width_square");k(f,"ssao_gauss_width_left_square");k(f,"ssao_influence");k(f,"ssao_dist_factor");k(f,"ssao_only");k(f,"ssao_white");k(za,"fog_density");k(za,"fog_density1000");aa(za,"fog_color");k(ta,"dof_distance");k(ta,"dof_front");
k(ta,"dof_rear");k(ta,"dof_power");k(ta,"dof_on");k(Ga,"god_rays_intensity");k(Ga,"god_rays_max_ray_length");k(Ga,"god_rays_steps");k(ua,"brightness");k(ua,"contrast");k(ua,"exposure");k(ua,"saturation");k(z,"sfx_mix_mode");a="true"===O.get("sfx_mix_mode")?0:1;document.getElementById("sfx_mix_mode").options[a].selected=!0;$("#sfx_mix_mode").slider("refresh");k(E,"anaglyph_use");a="true"===O.get("anaglyph_use")?0:1;document.getElementById("anaglyph_use").options[a].selected=!0;$("#anaglyph_use").slider("refresh");
k(Qa,"wind_dir");k(Qa,"wind_strength");k(Ha,"bloom_key");k(Ha,"bloom_blur");k(Ha,"bloom_edge_lum");k(N,"wireframe_mode");aa(N,"wireframe_edge_color");k(v,"show_hud_debug_info");a="true"===O.get("show_hud_debug_info")?0:1;document.getElementById("show_hud_debug_info").options[a].selected=!0;$("#show_hud_debug_info").slider("refresh");a=l();Y(a,!1,!1)},null)},gl_debug:!0,show_hud_debug_info:Ta,sfx_mix_mode:R(),show_fps:!0,alpha:!0,assets_dds_available:!Ca,assets_min50_available:!Ca,console_verbose:!0,
all_objs_selectable:!0,physics_enabled:!0,wireframe_debug:!0},Pa=0,kb=0,bb=new Float32Array(3),xa=!1,Oa,V=null,Q=[],Z=0,sa=[],ra=null,Da=null,va=null,ea=null,S=null,La=function(){},ia=null,Na=null;c.init=function(){var a=O.get("quality");if(a){switch(a){case "ULTRA":var b=X.P_ULTRA;break;case "HIGH":b=X.P_HIGH;break;case "LOW":b=X.P_LOW;break;case "CUSTOM":b=X.P_CUSTOM}X.set("quality",b)}X.set("anaglyph_use","true"===O.get("anaglyph_use"));J.init(rb)}});b4w.require("viewer_main").init();
