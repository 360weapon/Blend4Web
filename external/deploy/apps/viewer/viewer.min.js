b4w.module.storage=function(c,b){function x(){if(!localStorage)throw"Local storage is not supported";return localStorage.b4w?JSON.parse(localStorage.b4w):{}}var y=b("__print");c.set=function(b,c){var m=x();m[b]=String(c);if(!localStorage)throw"Local storage is not supported";localStorage.b4w=JSON.stringify(m)};c.cleanup=function(){if(!localStorage)throw"Local storage is not supported";delete localStorage.b4w};c.get=function(b){var c=x();return c[b]?c[b]:""};c.debug=function(){y.log(x())}};
if(window.b4w)window.b4w.storage=b4w.require("storage");else throw"Failed to register storage, load b4w first";b4w.module.camera_anim=function(c,b){var x=new Float32Array(3),y=new Float32Array(3),L=new Float32Array(3),Q=new Float32Array(4),m=b("controls"),J=b("vec3"),C=b("quat");c.track_to_target=function(b,c,a,z,N,d,u,f){if(b&&c){if(b4w.util.is_vector(c))var s=c;else s=L,b4w.transform.get_object_center(c,!1,s);c=a||1;a=z||2;var t=N||1;N=d||1;y[0]=0;y[1]=-1;y[2]=0;var D=b4w.transform.get_rotation_quat(b);d=b4w.util.quat_to_dir(D,y);z=b4w.camera.get_angles(b);var U=b4w.transform.get_translation(b);J.subtract(s,
U,x);J.normalize(x,x);var r=C.rotationTo(d,x,C.create());C.multiply(r,D,Q);b4w.util.correct_cam_quat_up(Q,!1);J.subtract(s,U,y);var I=J.length(y)*(1-1/a),s=Math.asin(x[1]);a=Math.acos(-x[2]/Math.abs(Math.cos(s)));0<x[0]&&(a=2*Math.PI-a);var v=a-z[0],R=s-z[1];L[0]=0;L[1]=0;L[2]=-1;a=b4w.transform.get_rotation_quat(b);0>b4w.util.quat_to_dir(a,L)[1]?(R=0<d[1]?s-Math.PI+z[1]:s+Math.PI+z[1],v=0<v?-Math.PI+v:Math.PI+v):Math.abs(v)>Math.PI&&(v=0<v?v-2*Math.PI:v+2*Math.PI);var R=-R,h=0,s=m.create_elapsed_sensor();
d=Math.abs(v/c);c=Math.abs(R/c);var w=d>c?d:c,ma=w+t,k=ma+N,ya=k+t,ja=v,na=R,q=I;m.create_sensor_manifold(b,"TRACK_TO_TARGET",m.CT_CONTINUOUS,[s],null,function(a,d,r){if(r)if(r=m.get_sensor_value(a,d,0),h+=r,h<w){var b=v/w*r;r*=R/w;d=h/w;d=6*d*(1-d);b*=d;r*=d;ja-=b;na-=r;b4w.camera.rotate(a,b,r)}else h<ma?(ja&&(b4w.camera.rotate(a,ja,na),ja=0,f&&f()),d=(h-w)/t,r=-I*r/t,q-=b,b4w.transform.move_local(a,0,6*r*d*(1-d),0)):h<k?q&&(b4w.transform.move_local(a,0,q,0),q=0):h<ya?(d=(h-k)/t,r=I*r/t,r=6*r*d*
(1-d),b4w.transform.move_local(a,0,r,0)):(b4w.transform.set_translation_v(a,U),m.remove_sensor_manifold(a,d),u&&u())})}};c.auto_rotate=function(b){function c(a,d,f){1==f&&(d=m.get_sensor_value(a,d,0),b4w.camera.rotate_pivot(a,d*b,0))}function a(){m.remove_sensor_manifold(z,"AUTO_ROTATE");m.remove_sensor_manifold(z,"DISABLE_AUTO_ROTATE")}var z=b4w.scenes.get_active_camera();if("TARGET"!==z.data.b4w_move_style)throw"wrong camera type";if(m.check_sensor_manifold(z,"AUTO_ROTATE"))a();else{var x=m.create_mouse_move_sensor("X"),
d=m.create_mouse_move_sensor("Y"),u=m.create_mouse_click_sensor(),f=m.create_elapsed_sensor();m.create_sensor_manifold(z,"DISABLE_AUTO_ROTATE",m.CT_LEVEL,[x,d,u],function(a){return a[0]&&a[2]||a[1]&&a[2]},a);m.create_sensor_manifold(z,"AUTO_ROTATE",m.CT_CONTINUOUS,[f],function(a){return a[0]},c)}}};if(window.b4w)window.b4w.camera_anim=b4w.require("camera_anim");else throw"Failed to register camera_anim, load b4w first";b4w.module.mixer=function(c,b){function x(){s=f.length=0;t=y(100);D=new Float32Array(t.length);U=new Float32Array(t.length);var a=d.get_speakers();if(a.length){f.push(L());for(var b=0;b<a.length;b++)f.push(m(a[b]));f.sort(function(a,d){return"MASTER"==a.id?-1:"MASTER"==d.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==d.id?1:a.id.toUpperCase()<d.id.toUpperCase()?-1:a.id.toUpperCase()>d.id.toUpperCase()?1:0})}}function y(a){for(var d=new Float32Array(a),b=0,c=0;c<a;c++)d[c]=20*Math.pow(1E3,b),b+=1/(a-1);
return d}function L(){var a=Q("MASTER");a.params.push(["VOLUME",d.get_volume(null),0,1,50,!1]);var b=d.get_compressor_params();b&&(a.params.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.params.push(["KNEE",b.knee,0,40,40,!1]),a.params.push(["RATIO",b.ratio,1,20,20,!1]),a.params.push(["ATTACK",b.attack,0,1,1E3,!1]),a.params.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=d.is_muted(null)?1:0;a.solo=-1;return a}function Q(a){return{id:a,params:[],active_param:0,mute:-1,solo:-1,speaker:null}}function m(a){var b=
Q(N.get_object_name(a));b.mute=d.is_muted(a)?1:0;b.solo=0;b.speaker=a;return b}function J(a){if(a.speaker){a.params.length=0;a.params.push(["VOLUME",d.get_volume(a.speaker),0,1,50,!1]);var b=d.get_positional_params(a.speaker);b&&(a.params.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.params.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.params.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=d.get_filter_params(a.speaker))a.params.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.params.push(["EQ_Q",b.Q,
0,10,100,!1]),a.params.push(["EQ_GAIN",b.gain,-70,30,100,!1]);u.clamp(a.active_param,0,a.params.length-1)}}function C(a){for(var b=0;b<f.length;b++){var d=f[b];if(d!=a&&1==d.solo)return!0}return!1}function p(a){for(var b=0;b<f.length;b++){var c=f[b];c!=a&&0==c.mute&&0==c.solo&&d.mute(c.speaker,!1)}}function M(){if(0==f.length)return[0,-1];var a=8*Math.floor(s/8),b=a+7,a=u.clamp(a,0,f.length-1),b=u.clamp(b,0,f.length-1);return[a,b]}var a=b("controls");b("debug");var z=b("hud"),N=b("scenes"),d=b("sfx"),
u=b("util"),f=[],s=0,t=null,D=null,U=null;c.enable_mixer_controls=function(b){x();var c=a.create_keyboard_sensor(a.KEY_LEFT_SQ_BRACKET),m=a.create_keyboard_sensor(a.KEY_RIGHT_SQ_BRACKET),y=a.create_keyboard_sensor(a.KEY_SEMI_COLON),h=a.create_keyboard_sensor(a.KEY_SINGLE_QUOTE),w=a.create_keyboard_sensor(a.KEY_SHIFT),ma=a.create_timer_sensor(0.15),k=a.create_timer_sensor(0.05),c=[c,m,y,h,w,ma,k],m=function(b,h,d){if(1==d){d=Boolean(a.get_sensor_value(b,h,0))?-1:1;if(f.length){1==d&&s<f.length-1?s++:
-1==d&&0<s&&s--;d=M();for(var c=d[0];c<=d[1];c++)J(f[c])}"SWITCH_STRIP"==h?a.reset_timer_sensor(b,h,5,0.3):a.reset_timer_sensor(b,h,5,0)}else a.reset_timer_sensor(b,h,5,10)};a.create_sensor_manifold(b,"SWITCH_STRIP",a.CT_TRIGGER,c,function(a){return(a[0]||a[1])&&!a[4]},m);a.create_sensor_manifold(b,"SWITCH_STRIP_HOLD",a.CT_SHOT,c,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},m);a.create_sensor_manifold(b,"SWITCH_PARAM",a.CT_SHOT,c,function(a){return(a[0]||a[1])&&a[4]},function(b,h,d){b=Boolean(a.get_sensor_value(b,
h,0))?-1:1;(h=f[s])&&(1==b&&h.active_param<h.params.length-1?h.active_param++:-1==b&&0<h.active_param&&h.active_param--)});m=function(b,h,c){if(1==c){var w=Boolean(a.get_sensor_value(b,h,2))?-1:1,k=f[s];if(k)switch(c=k.params[k.active_param],c[1]=c[5]?c[1]*Math.pow(c[3]/c[2],w/c[4]):c[1]+w*((c[3]-c[2])/c[4]),c[1]=u.clamp(c[1],c[2],c[3]),c[0]){case "VOLUME":"MASTER"!=k.id?d.set_volume(k.speaker,c[1]):d.set_volume(null,c[1]);break;case "DIST_REF":w=d.get_positional_params(k.speaker);w.dist_ref=c[1];
d.set_positional_params(k.speaker,w);break;case "ATTENUATION":w=d.get_positional_params(k.speaker);w.attenuation=c[1];d.set_positional_params(k.speaker,w);break;case "DIST_MAX":w=d.get_positional_params(k.speaker);w.dist_max=c[1];d.set_positional_params(k.speaker,w);break;case "EQ_FREQ":w=d.get_filter_params(k.speaker);w.freq=c[1];d.set_filter_params(k.speaker,w);break;case "EQ_Q":w=d.get_filter_params(k.speaker);w.Q=c[1];d.set_filter_params(k.speaker,w);break;case "EQ_GAIN":w=d.get_filter_params(k.speaker);
w.gain=c[1];d.set_filter_params(k.speaker,w);break;case "THRESHOLD":k=d.get_compressor_params();k.threshold=c[1];d.set_compressor_params(k);break;case "KNEE":k=d.get_compressor_params();k.knee=c[1];d.set_compressor_params(k);break;case "RATIO":k=d.get_compressor_params();k.ratio=c[1];d.set_compressor_params(k);break;case "ATTACK":k=d.get_compressor_params();k.attack=c[1];d.set_compressor_params(k);break;case "RELEASE":k=d.get_compressor_params();k.release=c[1];d.set_compressor_params(k);break;default:throw"Unknown strip param";
}"INC_DEC"==h?a.reset_timer_sensor(b,h,6,0.3):a.reset_timer_sensor(b,h,6,0)}else a.reset_timer_sensor(b,h,6,10)};a.create_sensor_manifold(b,"INC_DEC",a.CT_TRIGGER,c,function(a){return(a[2]||a[3])&&!a[4]},m);a.create_sensor_manifold(b,"INC_DEC_HOLD",a.CT_SHOT,c,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},m);a.create_sensor_manifold(b,"MUTE_SOLO",a.CT_SHOT,c,function(a){return(a[2]||a[3])&&a[4]},function(b,h,c){if(Boolean(a.get_sensor_value(b,h,2)))(b=f[s])&&0<=b.mute&&("MASTER"!=b.id?0==b.mute?(b.mute=
1,d.mute(b.speaker,!0),1==b.solo&&(b.solo=0,C(b)||p(b))):(b.mute=0,C(b)||d.mute(b.speaker,!1)):0==b.mute?(b.mute=1,d.mute(null,!0)):(b.mute=0,d.mute(null,!1)));else if((b=f[s])&&0<=b.solo)if(0==b.solo)for(b.solo=1,d.mute(b.speaker,!1),1==b.mute&&(b.mute=0),h=0;h<f.length;h++)c=f[h],c!=b&&0==c.mute&&0==c.solo&&d.mute(c.speaker,!0);else b.solo=0,C(b)?d.mute(b.speaker,!0):p(b)});c=a.create_elapsed_sensor();a.create_sensor_manifold(b,"MIXER_DRAW",a.CT_CONTINUOUS,[c],null,function(){if(f[s])for(var a=
M(),b=a[0];b<=a[1];b++){var h=f[b];z.draw_mixer_strip(h.id,b==s,b%8,h.params,h.active_param,h.mute,h.solo);if(h.speaker&&d.get_filter_params(h.speaker)){d.get_filter_freq_response(h.speaker,t,D,U);for(h=0;h<D.length;h++)D[h]=20*Math.log(D[h])/Math.LN10;z.plot_array("EQ",b%8,D,20,2E4,-10,10)}}});c=a.create_timer_sensor(1);a.create_sensor_manifold(b,"MIXER_UPDATE",a.CT_TRIGGER,[c],null,function(){for(var a=M(),b=a[0];b<=a[1];b++)J(f[b])})}};
if(window.b4w)window.b4w.mixer=b4w.require("mixer");else throw"Failed to register mixer, load b4w first";b4w.module.app=function(c,b){function x(){var a=d.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=d.is_paused(),d.pause()):a||d.resume()},!1)}function y(a){var b=window.onload;window.onload=function(){"function"==typeof b&&b();a()}}function L(a){var b=window.onunload;window.onunload=function(){"function"==typeof b&&b();a()}}function Q(a,b){var c=String(a);b&&(c+="/"+String(b));v.innerHTML=c}function m(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,
a);return b}function J(a,b,c){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);
document.addEventListener("mozfullscreenchange",d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen;a.requestFullScreen==a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()}var C=b("animation"),p=b("camera"),M=b("config"),a=b("controls"),z=b("data"),N=b("debug"),d=b("main"),u=b("physics"),f=b("print"),s=b("scenes"),t=b("transform"),D=b("util"),U=b("vec3"),r=null,I=null,v=null,R=new Float32Array(3);c.init=function(a){a=
a||{};var b=null,c=function(){},k=!1,m=!1,p=!1,s=!1,q=!1,t=null,u=!1,D=!0,C;for(C in a)switch(C){case "canvas_container_id":b=a.canvas_container_id;break;case "callback":c=a.callback;break;case "do_not_use_onload":k=a.do_not_use_onload;break;case "gl_debug":m=a.gl_debug;break;case "show_hud_debug_info":p=a.show_hud_debug_info;break;case "sfx_mix_mode":s=a.sfx_mix_mode;break;case "show_fps":q=a.show_fps;break;case "fps_elem_id":t=a.fps_elem_id;break;case "bar_id":break;case "caption_id":break;case "do_not_report_init_failure":u=
a.do_not_report_init_failure;break;case "pause_invisible":D=a.pause_invisible;break;default:M.set(C,a[C])}M.set("show_hud_debug_info",p);M.set("sfx_mix_mode",s);var J=p||s||null;a=function(){var a;a=b;var h=u,k=document.createElement("canvas");k.style.cssText="position: absolute;left:0px; top:0px;";if(J){var p=document.createElement("canvas");p.style.cssText="z-index: 2; position:absolute; left:0px; top:0px; pointer-events: none;"}else p=null;if(d.init(k,p))I=k,h=document.getElementById(a),h||(f.error('Warning: canvas container "'+
a+'" not found, appending to body'),h=document.body),h.appendChild(k),p&&h.appendChild(p),a=h;else{if(!h){a=document.createElement("div");var k=document.createElement("div"),p=document.createElement("div"),h=document.createElement("div"),s=document.createElement("div");a.style.cssText="z-index:10;width:100%;height:100%;position:absolute;";h.style.cssText="position:absolute;bottom:0;width:100%;height:auto;";s.style.cssText="position:relative;float:right;margin:20px;width:70px;height:70px;background-image:url('data:image/png;base64,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')";
k.style.cssText="position:relative;top:0;width:100%;background-color:#000;opacity:0.6;height:auto;color:#ffd42a;text-align:center;font-size:32px;padding:10px 0;font-family: Arial;";p.style.cssText="position:relative;clear:both;bottom:0;width:100%;background-color:#000;opacity:0.6;height:auto;color:#fff;text-align:center;font-size:20px;padding:10px 0;font-family: Arial;";k.innerHTML="Browser could not initialize WebGL";p.innerHTML='For more info visit   <a style="color:#ffd42a;font-size:20px;width:100%;" href="http://blend4web.com/troubleshooting">http://blend4web.com/troubleshooting</a>';
h.appendChild(s);h.appendChild(p);a.appendChild(k);a.appendChild(h);document.body.appendChild(a)}a=null}a?(r=a,d.set_check_gl_errors(m),q&&(t?v=document.getElementById(t):(v=document.createElement("div"),v.innerHTML=0,v.style.cssText="             position:absolute;            top: 23px;            right: 20px;            font-size: 45px;            line-height: 50px;            font-weight: bold;            color: #000;            z-index: 1;        ",document.body.appendChild(v)),d.set_fps_callback(Q)),
D&&x(),c(I,!0)):c(I,!1)};p=function(){d.pause();z.cleanup()};k?(a(),p()):(y(a),L(p))};c.get_canvas_container=function(){return r};c.set_onclick=function(a,b){var c=m(a);c.addEventListener("mouseup",function(a){b(c.value)},!1)};c.set_onchange=function(a,b){var c=m(a);c.addEventListener("change",function(a){a=c.checked;b(void 0!=a?a:c.value)},!1)};c.set_onkeypress=function(a,b){var c=m(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};c.enable_camera_controls=function(b,c,m,k){b||
(b=1);c||(c=1);m||(m=1);document.addEventListener("keydown",function(b){b.keyCode==a.KEY_O?J(document.body):b.keyCode==a.KEY_P&&(d.is_paused()?d.resume():d.pause())},!1);var f=s.get_active_camera();switch(p.get_move_style(f)){case p.MS_TARGET_CONTROLS:var r=!k;break;case p.MS_EYE_CONTROLS:r=!1;break;case p.MS_STATIC:return}k=a.create_elapsed_sensor();var v=u.has_simulated_physics(f),q=function(d,k,f){v&&u.apply_force(d,0,0,0);if(1==f){f=a.get_sensor_value(d,k,0);var m=[1800,2100,1800],q=p.get_trans_speed(d);
switch(k){case "FORWARD":v?u.apply_force(d,0,-m[1],0):t.move_local(d,0,-b*q*f,0);break;case "BACKWARD":v?u.apply_force(d,0,m[1],0):t.move_local(d,0,b*q*f,0);break;case "UP":v?u.apply_force(d,0,0,-m[2]):t.move_local(d,0,0,-b*q*f);break;case "DOWN":v?u.apply_force(d,0,0,m[2]):t.move_local(d,0,0,b*q*f);break;case "LEFT":v?u.apply_force(d,-m[0],0,0):t.move_local(d,-b*q*f,0,0);break;case "RIGHT":v?u.apply_force(d,m[0],0,0):t.move_local(d,b*q*f,0,0);break;case "ROT_LEFT":r?p.rotate_pivot(d,2*-c*f,0):p.rotate(d,
2*c*f,0);break;case "ROT_RIGHT":r?p.rotate_pivot(d,2*c*f,0):p.rotate(d,2*-c*f,0);break;case "ROT_UP":r?p.rotate_pivot(d,0,2*-c*f):p.rotate(d,0,2*-c*f);break;case "ROT_DOWN":r?p.rotate_pivot(d,0,2*c*f):p.rotate(d,0,2*c*f);break;case "ROT_LEFT":r?p.rotate_pivot(d,2*-c*f,0):p.rotate(d,2*c*f,0);break;case "ROT_RIGHT":r?p.rotate_pivot(d,2*c*f,0):p.rotate(d,2*-c*f,0)}}},z=a.create_keyboard_sensor(a.KEY_W),x=a.create_keyboard_sensor(a.KEY_S),y=a.create_keyboard_sensor(a.KEY_A),L=a.create_keyboard_sensor(a.KEY_D),
M=a.create_keyboard_sensor(a.KEY_R),ta=a.create_keyboard_sensor(a.KEY_F),N=a.create_keyboard_sensor(a.KEY_UP),ua=a.create_keyboard_sensor(a.KEY_DOWN),V=a.create_keyboard_sensor(a.KEY_LEFT),Q=a.create_keyboard_sensor(a.KEY_RIGHT),O=function(a){return a[0]&&(a[1]||a[2])};a.create_sensor_manifold(f,"FORWARD",a.CT_CONTINUOUS,[k,z],null,q);a.create_sensor_manifold(f,"BACKWARD",a.CT_CONTINUOUS,[k,x],null,q);r?(a.create_sensor_manifold(f,"ROT_UP",a.CT_CONTINUOUS,[k,N,M],O,q),a.create_sensor_manifold(f,"ROT_DOWN",
a.CT_CONTINUOUS,[k,ua,ta],O,q),a.create_sensor_manifold(f,"ROT_LEFT",a.CT_CONTINUOUS,[k,V,y],O,q),a.create_sensor_manifold(f,"ROT_RIGHT",a.CT_CONTINUOUS,[k,Q,L],O,q)):(a.create_sensor_manifold(f,"UP",a.CT_CONTINUOUS,[k,M],O,q),a.create_sensor_manifold(f,"DOWN",a.CT_CONTINUOUS,[k,ta],O,q),a.create_sensor_manifold(f,"LEFT",a.CT_CONTINUOUS,[k,y],O,q),a.create_sensor_manifold(f,"RIGHT",a.CT_CONTINUOUS,[k,L],O,q),a.create_sensor_manifold(f,"ROT_UP",a.CT_CONTINUOUS,[k,N],O,q),a.create_sensor_manifold(f,
"ROT_DOWN",a.CT_CONTINUOUS,[k,ua],O,q),a.create_sensor_manifold(f,"ROT_LEFT",a.CT_CONTINUOUS,[k,V],O,q),a.create_sensor_manifold(f,"ROT_RIGHT",a.CT_CONTINUOUS,[k,Q],O,q));var Z=0,q=a.create_mouse_wheel_sensor();a.create_sensor_manifold(f,"MOUSE_WHEEL",a.CT_LEVEL,[q],null,function(c,d,f){1==f&&(d=a.get_sensor_value(c,d,0),r?(f=p.get_eye(c),p.get_pivot(c,R),c=U.dist(R,f),Z+=0.1*-d*c*b):(c=d*m,d=s.get_active_camera(),p.change_trans_speed(d,c)))});var I=0,q=a.create_touch_zoom_sensor();a.create_sensor_manifold(f,
"TOUCH_ZOOM",a.CT_LEVEL,[q],null,function(c,d,f,k){1==f&&r&&(d=a.get_sensor_value(c,d,0),f=p.get_eye(c),p.get_pivot(c,R),c=U.dist(R,f),I+=0.005*-d*c*b)});a.create_sensor_manifold(f,"ZOOM_INTERPOL",a.CT_CONTINUOUS,[k],null,function(b,c,d){1==d&&(0.001<Math.abs(Z)||0.001<Math.abs(I))&&r&&(d=a.get_sensor_value(b,c,0),c=D.smooth(Z,0,d,0.1),Z-=c,d=D.smooth(I,0,d,0.15),I-=d,t.move_local(b,0,c+d,0))});var ia=0,G=0,q=a.create_mouse_move_sensor("X"),z=a.create_mouse_move_sensor("Y"),x=a.create_mouse_click_sensor(),
y=function(b,d,h,f){1==h&&(b=a.get_sensor_value(b,d,1),r&&(d=0.01*c,ia+="X"==f?-b*d:0,G+="Y"==f?-b*d:0))};a.create_sensor_manifold(f,"MOUSE_X",a.CT_LEVEL,[x,q],null,y,"X");a.create_sensor_manifold(f,"MOUSE_Y",a.CT_LEVEL,[x,z],null,y,"Y");var da=0,P=0,q=a.create_touch_move_sensor("X"),z=a.create_touch_move_sensor("Y"),x=function(b,d,h,f){1==h&&r&&(h=0.007*c,b=a.get_sensor_value(b,d,0),da+="X"==f?-b*h:0,P+="Y"==f?-b*h:0)};a.create_sensor_manifold(f,"TOUCH_X",a.CT_LEVEL,[q],null,x,"X");a.create_sensor_manifold(f,
"TOUCH_Y",a.CT_LEVEL,[z],null,x,"Y");a.create_sensor_manifold(f,"ROT_INTERPOL",a.CT_CONTINUOUS,[k],null,function(b,d,c){if(1==c&&(0.001<Math.abs(ia)||0.001<Math.abs(G)||0.001<Math.abs(da)||0.001<Math.abs(P))&&r){var h=a.get_sensor_value(b,d,0);d=D.smooth(ia,0,h,0.08);c=D.smooth(G,0,h,0.08);ia-=d;G-=c;var f=D.smooth(da,0,h,0.12),h=D.smooth(P,0,h,0.12);da-=f;P-=h;p.rotate_pivot(b,d+f,c+h)}});a.create_kb_sensor_manifold(f,"TOGGLE_CAMERA_COLLISION",a.CT_SHOT,a.KEY_C,function(){var a=s.get_active_camera();
C.is_detect_collisions_used(a)?C.detect_collisions(a,!1):C.detect_collisions(a,!0)});a.create_kb_sensor_manifold(f,"DEC_STEREO_DIST",a.CT_SHOT,a.KEY_LEFT_SQ_BRACKET,function(a,b,d){b=p.get_stereo_distance(a);p.set_stereo_distance(a,0.9*b)});a.create_kb_sensor_manifold(f,"INC_STEREO_DIST",a.CT_SHOT,a.KEY_RIGHT_SQ_BRACKET,function(a,b,d){b=p.get_stereo_distance(a);p.set_stereo_distance(a,1.1*b)})};c.enable_object_controls=function(b){var d=u.is_vehicle_chassis(b)||u.is_vehicle_hull(b),c=function(b,
c,h){if(1==h)switch(h=a.get_sensor_value(b,c,0),c){case "FORWARD":d?u.vehicle_throttle(b,1):t.move_local(b,0,0,1*h);break;case "BACKWARD":d?u.vehicle_throttle(b,-1):t.move_local(b,0,0,-1*h);break;case "LEFT":d?u.vehicle_steer(b,-1):t.move_local(b,1*h,0,0);break;case "RIGHT":d?u.vehicle_steer(b,1):t.move_local(b,-1*h,0,0)}else switch(c){case "FORWARD":case "BACKWARD":d&&u.vehicle_throttle(b,0);break;case "LEFT":case "RIGHT":d&&u.vehicle_steer(b,0)}},f=a.create_elapsed_sensor(),m=a.create_keyboard_sensor(a.KEY_W),
p=a.create_keyboard_sensor(a.KEY_S),r=a.create_keyboard_sensor(a.KEY_A),q=a.create_keyboard_sensor(a.KEY_D),s=a.create_keyboard_sensor(a.KEY_UP),v=a.create_keyboard_sensor(a.KEY_DOWN),x=a.create_keyboard_sensor(a.KEY_LEFT),z=a.create_keyboard_sensor(a.KEY_RIGHT),y=function(a){return a[0]&&(a[1]||a[2])};a.create_sensor_manifold(b,"FORWARD",a.CT_CONTINUOUS,[f,m,s],y,c);a.create_sensor_manifold(b,"BACKWARD",a.CT_CONTINUOUS,[f,p,v],y,c);a.create_sensor_manifold(b,"LEFT",a.CT_CONTINUOUS,[f,r,x],y,c);a.create_sensor_manifold(b,
"RIGHT",a.CT_CONTINUOUS,[f,q,z],y,c)};c.disable_object_controls=function(b){a.remove_sensor_manifolds(b)};c.enable_controls=function(b){document.addEventListener("keydown",a.keydown_cb,!1);document.addEventListener("keyup",a.keyup_cb,!1);b.addEventListener("mousewheel",a.mouse_wheel_cb,!1);b.addEventListener("DOMMouseScroll",a.mouse_wheel_cb,!1);document.body.addEventListener("mousedown",a.mouse_down_cb,!1);document.body.addEventListener("mouseup",a.mouse_up_cb,!1);b.addEventListener("mousemove",
a.mouse_move_cb,!1);b.addEventListener("touchstart",a.touch_start_cb,!1);b.addEventListener("touchmove",a.touch_move_cb,!1)};c.disable_controls=function(b){document.removeEventListener("keydown",a.keydown_cb,!1);document.removeEventListener("keyup",a.keyup_cb,!1);b.removeEventListener("mousewheel",a.mouse_wheel_cb,!1);b.removeEventListener("DOMMouseScroll",a.mouse_wheel_cb,!1);document.body.removeEventListener("mousedown",a.mouse_down_cb,!1);document.body.removeEventListener("mouseup",a.mouse_up_cb,
!1);b.removeEventListener("mousemove",a.mouse_move_cb,!1);b.removeEventListener("touchstart",a.touch_start_cb,!1);b.removeEventListener("touchmove",a.touch_move_cb,!1)};c.enable_debug_controls=function(){var b=s.get_active_camera();a.create_kb_sensor_manifold(b,"CAMERA_SHOT",a.CT_SHOT,a.KEY_K,function(){N.make_camera_frustum_shot()});a.create_kb_sensor_manifold(b,"LIGHT_SHOT",a.CT_SHOT,a.KEY_L,function(){N.make_light_frustum_shot()});a.create_kb_sensor_manifold(b,"TELEMETRY",a.CT_SHOT,a.KEY_T,function(){N.plot_telemetry()})};
c.request_fullscreen=J;c.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};c.get_url_params=function(){var a=location.href.toString();if(-1==a.indexOf("?"))return null;for(var a=a.split("?")[1].split("&"),b={},d=0;d<a.length;d++){var c=a[d].split("=");b[c[0]]=c[1]}return b}};
if(window.b4w)window.b4w.app=b4w.require("app");else throw"Failed to register app, load b4w first";b4w.register("viewer_main",function(c,b){function x(e){return(Ba?"../../external/deploy/assets/":"../../assets/")+e}function y(){if(aa){var e=n.get_object_by_name(aa);if(e)return e}return null}function L(e){if(va){e.preventDefault&&e.preventDefault();var a=e.clientX;e=e.clientY;var b=y();b&&n.clear_glow_anim(b);aa=a=n.pick_object(a,e);if(a.length){Na(a);var d=y();d&&n.apply_glow_anim(d,0.2,3.8,1)}else Oa();m();ea||(a.length?d&&(ea=d.name,m(),H.enable_object_controls(d),E.create_kb_sensor_manifold(d,
"QUIT",E.CT_SHOT,E.KEY_Q,function(e,a,b,wa){ea=null;m();H.disable_object_controls(e)})):Q())}}function Q(){var e=n.get_active_camera();ea=e.name;m();H.enable_camera_controls(1,Ca.camera_rot_speed);E.create_kb_sensor_manifold(e,"QUIT",E.CT_SHOT,E.KEY_Q,function(e,a,b,wa){ea=null;m();H.disable_object_controls(e)});var a=E.create_keyboard_sensor(E.KEY_Z),b=E.create_keyboard_sensor(E.KEY_DEC_POINT);E.create_sensor_manifold(e,"ZOOM_TO",E.CT_SHOT,[a,b],function(e){return e[0]||e[1]},function(e,a,b){(a=
y())&&Da.zoom_object(e,a)})}function m(){if(va){var e="CONTROLLED: "+(ea?String(ea):"NONE")+" | SELECTED: "+(aa?String(aa):"NONE"),a;a:{if(ea&&(a=n.get_object_by_name(ea)))break a;a=!1}aa&&a&&"CAMERA"===a.type&&(e+=" | DISTANCE: "+Pa);va.innerHTML=e}}function J(){var e=K.get("last_item_name");if(!e)return null;for(var a=0;a<W.length;a++){var b=W[a];if(oa("name",e,b.items)[0])return{category:b.name,item:e}}return null}function C(e,a){var b=document.getElementById(e);b.innerHTML="";for(var d=0;d<a.length;d++){var c=
document.createElement("option");c.text=c.value=a[d];0===d&&(c.selected=!0);b.appendChild(c)}$("#"+e).selectmenu();$("#"+e).selectmenu("refresh")}function p(e){e=e.target.id;if(-1!=e.indexOf("MANIFEST_ITEM_")){var a=e.split("__SEPARATOR__");e=a[1];a=a[0].split("MANIFEST_ITEM_")[1];xa=!1;clearTimeout(Qa);M({category:e,item:a},!0,!1)}}function M(e,b,d){for(var c=0;c<fa.children.length;c++)fa.children[c].style.visibility="hidden";pa={load_file:Za,animated_objects:[]};Ca=null;S=[];ba=0;qa=[];if(e){var c=
oa("name",e.category,W)[0],c=oa("name",e.item,c.items)[0],f;for(f in c)pa[f]=c[f];K.set("last_item_name",e.item)}else K.set("last_item_name","");b&&(ka.clear_render_callback(),Ea.cleanup());T.clear_errors_warnings();e=pa.name||"Logo";b=pa.load_file;f=document.getElementById("current_file");f.innerHTML=e;f.setAttribute("title",e+" ("+b+")");Ea.load(x(b),a,N,d)}function a(e){n.set_glow_color([1,0.4,0.05]);aa=null;d(pa);Q();H.enable_debug_controls();v()&&$a.enable_mixer_controls(n.get_active_camera());
ka.set_render_callback(s);xa&&(Qa=setTimeout(z,ab));e=E.create_elapsed_sensor();E.create_sensor_manifold(n.get_active_camera(),"TO_OBJ",E.CT_CONTINUOUS,[e],null,function(e,a,b){if(1==b&&aa){if(b=y())a=bb,cb.get_object_center(b,!0,a),e=Da.get_eye(e),Pa=db.dist(a,e).toFixed(3);m()}})}function z(){var e=J();if(e){var a=e.item,e=oa("name",e.category,W)[0],a=oa("name",a,e.items)[0],a=e.items.indexOf(a);if(a=e.items[a+1])e={category:e.name,item:a.name};else if(e=W.indexOf(e),e=W[e+1])e={category:e.name,
item:e.items[0].name};else{xa=!1;return}}else e=W[0],a=e.items[0],e={category:e.name,item:a.name};M(e,!0,!0)}function N(e,a){document.getElementById("loading_progress").innerHTML=e+"% ("+Math.round(10*a/1E3)/10+"s)";var b=T.get_error_quantity(),d=T.get_warning_quantity();if(Ea.is_loaded()){var c=T.num_vertices(),f=T.num_triangles(),g=T.num_draw_calls();document.getElementById("info_right_up").innerHTML=c+" verts, "+f+" tris, "+g+" draw calls";var c=T.geometry_stats(),f=T.num_textures(),g=T.num_render_targets(),
h=Math.round(10*(c.ibo_memory+c.vbo_memory))/10,k=Math.round(10*f.memory)/10,l=Math.round(10*g.memory)/10,m=Math.round(10*(h+k+l))/10;document.getElementById("info_right_down").innerHTML="Geometry: "+h+" MiB ("+c.ibo_number+"+"+c.vbo_number+")<br>Textures: "+k+" MiB ("+f.number+")<br>RTs: "+l+" MiB ("+g.number+")<br><br>Total: "+m+" MiB";c=T.get_error_quantity();(f=T.get_warning_quantity())||c?fa.setAttribute("title","warnings:"+f+"\nerrors:"+c):fa.setAttribute("title","Loaded OK");d||b||(fa.children[2].style.visibility=
"visible")}d&&!b&&(fa.children[1].style.visibility="visible");b&&(fa.children[1].style.visibility="hidden",fa.children[0].style.visibility="visible")}function d(e){for(var a=n.get_active(),b=n.get_scenes(),c=0;c<b.length;c++){var d=b[c];if(d!==a){var g=u(d,e);f(d,g)}}g=u(a,e);f(a,g);Na=function(e){e=n.get_object_by_name(e);var a=la.get_materials_names(e);C("material_name",a);da(e,a[0]);e=la.get_water_material_params(e,a[0]);a="shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" ");
e?(A(a,"enable"),n.get_water_mat_params(e),e.shallow_water_col&&ga("shallow_water_col",e.shallow_water_col),e.shallow_water_col_fac&&l("shallow_water_col_fac",e.shallow_water_col_fac),e.shore_water_col&&ga("shore_water_col",e.shore_water_col),e.shore_water_col_fac&&l("shore_water_col_fac",e.shore_water_col_fac),e.water_fog_color&&(ga("water_fog_color",e.water_fog_color),l("water_fog_density",e.water_fog_density)),l("absorb_factor",e.absorb_factor),l("sss_strength",e.sss_strength),l("sss_width",e.sss_width),
l("foam_factor",e.foam_factor),l("waves_height",e.waves_height),l("waves_length",e.waves_length),l("dst_noise_scale0",e.dst_noise_scale0),l("dst_noise_scale1",e.dst_noise_scale1),l("dst_noise_freq0",e.dst_noise_freq0),l("dst_noise_freq1",e.dst_noise_freq1),l("dir_min_shore_fac",e.dir_min_shore_fac),l("dir_freq",e.dir_freq),l("dir_noise_scale",e.dir_noise_scale),l("dir_noise_freq",e.dir_noise_freq),l("dir_min_noise_fac",e.dir_min_noise_fac),l("dst_min_fac",e.dst_min_fac),l("waves_hor_fac",e.waves_hor_fac)):
A(a,"disable")};O();e=X.get_lights_names();C("light_name",e);Ka(e[0]);ua();Wa();ta();eb();fb();Xa();gb();Ya();ia();hb();ib();Oa();$("#wireframe_mode").val("WM_NONE");$("#wireframe_mode").selectmenu("refresh",!0);$("#wireframe_edge_color div").css("backgroundColor","#333");e=new Date(document.getElementById("date").value);Fa({date:e});Ca=g}function u(e,a){function b(e,a){for(var wa in e)a[wa]=e[wa];return a}var c=a.scene_settings;if(c&&c[e]){var d={};b(a,d);b(c[e],d);delete d.scene_settings;return d}return a}
function f(e,a){n.set_active(e);var b=n.get_active_camera();a.camera_target&&jb.append_follow(b,a.camera_target);var c=a.h_angle,d=a.v_angle;0!==c&&!c||0!==d&&!d||Da.set_eye_params(b,c,d);ba=Ra;for(b=0;b<a.animated_objects.length;b++)if(d=a.animated_objects[b],c=d instanceof Array?n.get_object_by_empty_name(d[0],d[1]):n.get_object_by_name(d)){if(d=F.get_anim_names(c)[kb])F.apply(c,d),F.play(c),F.cyclic(c,!0)}else console.error("Animated object not found: ",d);c=[];d=n.get_appended_objs("ALL");for(b=
0;b<d.length;b++){var f=d[b];if(F.is_animated(f)){var g=F.get_first_armature_object(f);g&&F.is_animated(g)?qa.push(g,f):(S.push(f),c.push(n.get_object_name(f)))}}b="anim_active_object anim_action anim_cyclic anim_frame_range anim_frame_current anim_play anim_stop get_max_bones".split(" ");S.length?(A(b,"enable"),C("anim_active_object",c),q({anim_active_object:n.get_object_name(S[Ra])})):A(b,"disable")}function s(e,a){n.get_active_camera();var b=t(S,ba)[0];if(b){var c=document.getElementById("anim_status");
F.is_play(b)?c.innerHTML="PLAYING":c.innerHTML="STOPPED";var d=document.getElementById("anim_frame_range");if(c=F.get_frame_range(b))d.innerHTML=c[0]+" - "+c[1],d=document.getElementById("anim_frame_current"),d.min=""+c[0],d.max=""+c[1];b=Math.round(F.get_frame(b));parseInt($("#anim_frame_current").val())!==b&&l("anim_frame_current",b)}}function t(e,a){var b=[];if(e[a]){b.push(e[a]);for(var c=0;c<qa.length;c+=2){var d=qa[c+1];qa[c]==e[a]&&b.push(d)}}return b}function D(e){K.set("quality",e.quality);
setTimeout(function(){window.location.reload()},100)}function U(){K.cleanup();window.location.reload()}function r(){ka.pause()}function I(){ka.resume()}function v(){return"true"===K.get("sfx_mix_mode")?!0:!1}function R(e){K.set("show_hud_debug_info","on"===e.show_hud_debug_info);window.location.reload()}function h(e){K.set("sfx_mix_mode","on"===e.sfx_mix_mode);window.location.reload()}function w(e){K.set("anaglyph_use","on"===e.anaglyph_use);window.location.reload()}function ma(){xa=!0;z()}function k(e){var a=
e.target.innerWidth;e=e.target.innerHeight;var b=document.getElementById("controls_container").offsetWidth,a=a-b;ka.resize(a,e);document.getElementById("info_left_up").innerHTML=a+"x"+e}function ya(){for(var e=t(S,ba),a=0;a<e.length;a++)F.play(e[a])}function ja(){for(var e=t(S,ba),a=0;a<e.length;a++)F.stop(e[a])}function na(){ka.pause();var e=lb.determine_max_bones();document.getElementById("max_bones").innerHTML=e.max_bones;document.getElementById("max_bones_no_blending").innerHTML=e.max_bones_no_blending;
ka.resume()}function q(e){if("anim_active_object"in e)for(var a=0;a<S.length;a++)if(n.get_object_name(S[a])==e.anim_active_object){ba=a;a=F.get_anim_names(S[ba]);a.length?C("anim_action",a):C("anim_action",["N/A"]);return}if("anim_action"in e)for(var b=t(S,ba),a=0;a<b.length;a++)F.apply(b[a],e.anim_action),F.play(b[a]),F.cyclic(b[a],!0);if("anim_cyclic"in e)for(b=t(S,ba),a=0;a<b.length;a++){var c=b[a];F.cyclic(c,"on"===e.anim_cyclic)}if("anim_frame_current"in e)for(e=parseInt(e.anim_frame_current),
b=t(S,ba),a=0;a<b.length;a++)c=b[a],F.is_play(c)||F.set_frame(c,e)}function Wa(){var a=n.get_ssao_params(),b="ssao_quality ssao_radius_increase ssao_dithering_amount ssao_gauss_center ssao_gauss_width_square ssao_gauss_width_left_square ssao_influence ssao_dist_factor ssao_only ssao_white".split(" ");if(a){A(b,"enable");for(var c=document.getElementById("ssao_quality"),b=a.ssao_quality,c=c.options,d=0;d<c.length;d++){var f=c[d];f.selected=f.value==b?!0:!1}$("#ssao_quality").selectmenu("refresh");
l("ssao_radius_increase",a.radius_increase);l("ssao_dithering_amount",1E3*a.dithering_amount);l("ssao_gauss_center",a.gauss_center);l("ssao_gauss_width_square",Math.sqrt(a.gauss_width_square));l("ssao_gauss_width_left_square",Math.sqrt(a.gauss_width_left_square));l("ssao_influence",a.influence);l("ssao_dist_factor",a.dist_factor);b=0===a.ssao_only?1:0;document.getElementById("ssao_only").options[b].selected=!0;$("#ssao_only").slider("refresh");b=0===a.ssao_white?1:0;document.getElementById("ssao_white").options[b].selected=
!0;$("#ssao_white").slider("refresh")}else A(b,"disable")}function Y(a){n.get_ssao_params();var b={};"ssao_quality"in a&&(b.ssao_quality=Ia(document.getElementById("ssao_quality")));"ssao_radius_increase"in a&&(b.ssao_radius_increase=a.ssao_radius_increase);"ssao_dithering_amount"in a&&(b.ssao_dithering_amount=a.ssao_dithering_amount/1E3);"ssao_gauss_center"in a&&(b.ssao_gauss_center=a.ssao_gauss_center);"ssao_gauss_width_square"in a&&(b.ssao_gauss_width_square=a.ssao_gauss_width_square*a.ssao_gauss_width_square);
"ssao_gauss_width_left_square"in a&&(b.ssao_gauss_width_left_square=a.ssao_gauss_width_left_square*a.ssao_gauss_width_left_square);"ssao_influence"in a&&(b.ssao_influence=a.ssao_influence);"ssao_dist_factor"in a&&(b.ssao_dist_factor=a.ssao_dist_factor);"ssao_only"in a&&(b.ssao_only="on"===a.ssao_only?1:0);"ssao_white"in a&&(b.ssao_white="on"===a.ssao_white?1:0);n.set_ssao_params(b)}function Xa(){var a=n.get_color_correction_params(),b=["brightness","contrast","exposure","saturation"];a?(A(b,"enable"),
l("brightness",a.brightness),l("contrast",a.contrast),l("exposure",a.exposure),l("saturation",a.saturation)):A(b,"disable")}function sa(a){var b=n.get_color_correction_params();b&&(b={},"brightness"in a&&(b.brightness=parseFloat(a.brightness)),"contrast"in a&&(b.contrast=parseFloat(a.contrast)),"exposure"in a&&(b.exposure=parseFloat(a.exposure)),"saturation"in a&&(b.saturation=parseFloat(a.saturation)),n.set_color_correction_params(b))}function Ia(a){a=a.options;for(var b=0;b<a.length;b++){var c=
a[b];if(c.selected)return c.value}}function ta(){var a=n.get_fog_color_density();0.2<a[3]?l("fog_density",a[3]):l("fog_density1000",1E3*a[3]);ga("fog_color",a)}function za(a){var b=n.get_fog_color_density();"fog_density"in a&&(b[3]=a.fog_density);"fog_density1000"in a&&(b[3]=a.fog_density1000/1E3);"fog_color"in a&&(b[0]=a.fog_color[0],b[1]=a.fog_color[1],b[2]=a.fog_color[2]);n.set_fog_color_density(b)}function ua(){var a=n.get_shadow_params(),b="optimize_shadow_volume csm_near csm_far shadow_visibility_falloff blur_depth_size_mult blur_depth_edge_size blur_depth_diff_threshold csm_lambda".split(" ");
if(!a)return A(b,"disable"),null;A(b,"enable");b=a.optimize_shadow_volume?0:1;document.getElementById("optimize_shadow_volume").options[b].selected=!0;$("#optimize_shadow_volume").slider("refresh");l("shadow_visibility_falloff",a.shadow_visibility_falloff);l("blur_depth_size_mult",a.blur_depth_size_mult);l("blur_depth_edge_size",a.blur_depth_edge_size);l("blur_depth_diff_threshold",a.blur_depth_diff_threshold);Ja(a);l("csm_near",a.csm_near);l("csm_far",a.csm_far);l("csm_lambda",a.csm_lambda)}function V(a){var b=
{};"optimize_shadow_volume"in a&&(b.optimize_shadow_volume="on"===a.optimize_shadow_volume?!0:!1);"csm_near"in a&&(b.csm_near=parseFloat(a.csm_near));"csm_far"in a&&(b.csm_far=parseFloat(a.csm_far));"csm_lambda"in a&&(b.csm_lambda=parseFloat(a.csm_lambda));"shadow_visibility_falloff"in a&&(b.shadow_visibility_falloff=parseFloat(a.shadow_visibility_falloff));"blur_depth_size_mult"in a&&(b.blur_depth_size_mult=parseFloat(a.blur_depth_size_mult));"blur_depth_edge_size"in a&&(b.blur_depth_edge_size=parseFloat(a.blur_depth_edge_size));
"blur_depth_diff_threshold"in a&&(b.blur_depth_diff_threshold=parseFloat(a.blur_depth_diff_threshold));n.set_shadow_params(b);Ja(n.get_shadow_params())}function Ja(a){document.getElementById("csm_num").innerHTML=" "+a.csm_num;a=a.csm_borders;var b=document.getElementById("csm_borders");b.innerHTML="(";for(var c=0;c<a.length;c++)0<c&&(b.innerHTML+=" __ "),b.innerHTML+=Math.round(10*a[c])/10;b.innerHTML+=")"}function O(){var a=n.get_environment_colors();l("environment_energy",a[0]);ga("horizon_color",
a[1]);ga("zenith_color",a[2])}function Z(a){"environment_energy"in a&&n.set_environment_colors(a.environment_energy,null,null);"horizon_color"in a&&n.set_environment_colors(null,a.horizon_color,null);"zenith_color"in a&&n.set_environment_colors(null,null,a.zenith_color)}function Ma(a){var b={};"wireframe_mode"in a&&(b.wireframe_mode=Ia(document.getElementById("wireframe_mode")));"wireframe_edge_color"in a&&(b.wireframe_edge_color=a.wireframe_edge_color);T.set_debug_params(b)}function ia(){var a=n.get_sky_params(),
b="sky_color rayleigh_brightness mie_brightness spot_brightness scatter_strength rayleigh_strength mie_strength rayleigh_collection_power mie_collection_power mie_distribution".split(" ");if(!a)return A(b,"disable"),null;A(b,"enable");ga("sky_color",a.color);l("rayleigh_brightness",a.rayleigh_brightness);l("mie_brightness",a.mie_brightness);l("spot_brightness",a.spot_brightness);l("scatter_strength",a.scatter_strength);l("rayleigh_strength",a.rayleigh_strength);l("mie_strength",a.mie_strength);l("rayleigh_collection_power",
a.rayleigh_collection_power);l("mie_collection_power",a.mie_collection_power);l("mie_distribution",a.mie_distribution)}function G(a){var b={};"sky_color"in a&&(b.color=a.sky_color);"rayleigh_brightness"in a&&(b.rayleigh_brightness=a.rayleigh_brightness);"mie_brightness"in a&&(b.mie_brightness=a.mie_brightness);"spot_brightness"in a&&(b.spot_brightness=a.spot_brightness);"scatter_strength"in a&&(b.scatter_strength=a.scatter_strength);"rayleigh_strength"in a&&(b.rayleigh_strength=a.rayleigh_strength);
"mie_strength"in a&&(b.mie_strength=a.mie_strength);"rayleigh_collection_power"in a&&(b.rayleigh_collection_power=a.rayleigh_collection_power);"mie_collection_power"in a&&(b.mie_collection_power=a.mie_collection_power);"mie_distribution"in a&&(b.mie_distribution=a.mie_distribution);n.set_sky_params(b)}function da(a,b){var c=la.get_material_extended_params(a,b),d="material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" ");
if(!c)return A(d,"disable"),null;var f=la.get_diffuse_color(a,b);f.pop();c.diffuse_color=f;A(d,"enable");ga("material_diffuse_color",c.diffuse_color);l("material_reflectivity",c.reflect_factor);l("material_fresnel",c.fresnel);l("material_fresnel_factor",c.fresnel_factor);l("material_parallax_scale",c.parallax_scale);l("material_parallax_steps",c.parallax_steps)}function P(a){var b=n.get_object_by_name(aa);"material_name"in a&&da(b,a.material_name);if("material_diffuse_color"in a){var c=a.material_diffuse_color.slice();
c.push(1);la.set_diffuse_color(b,$("#material_name").val(),c)}c={};"material_reflectivity"in a&&(c.material_reflectivity=a.material_reflectivity);"material_fresnel"in a&&(c.material_fresnel=a.material_fresnel);"material_fresnel_factor"in a&&(c.material_fresnel_factor=a.material_fresnel_factor);"material_parallax_scale"in a&&(c.material_parallax_scale=a.material_parallax_scale);"material_parallax_steps"in a&&(c.material_parallax_steps=a.material_parallax_steps);la.set_material_extended_params(b,$("#material_name").val(),
c);n.update_scene_materials_params()}function B(a){var b=n.get_object_by_name(aa),c="waves_height waves_length sss_strength sss_width dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac".split(" ");if(!b)return null;var d={},f=$("#water_dynamic").val(),g=$("#shore_smoothing").val();"1"==f?(f=!0,A(c,"enable")):(f=!1,A(c,"disable"));"1"==g?(g=!0,A(["absorb_factor"],"enable")):(g=!1,A(["absorb_factor"],
"disable"));"shore_smoothing"in a&&(d.shore_smoothing=g);"absorb_factor"in a&&(d.absorb_factor=a.absorb_factor);"water_fog_color"in a&&(d.water_fog_color=a.water_fog_color);"water_fog_density"in a&&(d.water_fog_density=a.water_fog_density);"shallow_water_col"in a&&(d.shallow_water_col=a.shallow_water_col);"shallow_water_col_fac"in a&&(d.shallow_water_col_fac=a.shallow_water_col_fac);"shore_water_col"in a&&(d.shore_water_col=a.shore_water_col);"shore_water_col_fac"in a&&(d.shore_water_col_fac=a.shore_water_col_fac);
"foam_factor"in a&&(d.foam_factor=a.foam_factor);"sss_strength"in a&&(d.sss_strength=a.sss_strength);"sss_width"in a&&(d.sss_width=a.sss_width);"water_dynamic"in a&&(d.water_dynamic=f);"waves_height"in a&&(d.waves_height=a.waves_height);"waves_length"in a&&(d.waves_length=a.waves_length);"dst_noise_scale0"in a&&(d.dst_noise_scale0=a.dst_noise_scale0);"dst_noise_scale1"in a&&(d.dst_noise_scale1=a.dst_noise_scale1);"dst_noise_freq0"in a&&(d.dst_noise_freq0=a.dst_noise_freq0);"dst_noise_freq1"in a&&
(d.dst_noise_freq1=a.dst_noise_freq1);"dir_min_shore_fac"in a&&(d.dir_min_shore_fac=a.dir_min_shore_fac);"dir_freq"in a&&(d.dir_freq=a.dir_freq);"dir_noise_scale"in a&&(d.dir_noise_scale=a.dir_noise_scale);"dir_noise_freq"in a&&(d.dir_noise_freq=a.dir_noise_freq);"dir_min_noise_fac"in a&&(d.dir_min_noise_fac=a.dir_min_noise_fac);"dst_min_fac"in a&&(d.dst_min_fac=a.dst_min_fac);"waves_hor_fac"in a&&(d.waves_hor_fac=a.waves_hor_fac);if(!la.set_water_material_params(b,$("#material_name").val(),d))return null;
n.update_scene_materials_params();n.set_water_params(d)}function Ka(a){a=X.get_light_params(a);ga("light_color",a.light_color);l("light_energy",a.light_energy)}function Aa(a){"light_name"in a&&Ka(a.light_name);var b={};"light_color"in a&&(b.light_color=a.light_color);"light_energy"in a&&(b.light_energy=parseFloat(a.light_energy));X.set_light_params($("#light_name").val(),b)}function Ya(){var a=X.get_sun_params(),b=["sun_horizontal_position","sun_vertical_position"];if(!a)return A(b,"disable"),null;
l("sun_horizontal_position",a.hor_position);l("sun_vertical_position",a.vert_position)}function La(a){var b={};"sun_horizontal_position"in a&&(b.hor_position=parseFloat(a.sun_horizontal_position),b.vert_position=parseFloat(document.getElementById("sun_vertical_position").value));"sun_vertical_position"in a&&(b.hor_position=parseFloat(document.getElementById("sun_horizontal_position").value),b.vert_position=parseFloat(a.sun_vertical_position));X.set_sun_params(b)}function mb(a){a=parseFloat(a.max_sun_angle);
X.set_max_sun_angle(a)}function Fa(a){"day_time"in a&&X.set_day_time(a.day_time);"date"in a&&X.set_date(new Date(a.date))}function nb(){var a=0,b=parseFloat(document.getElementById("day_time").value),c=E.create_elapsed_sensor(),d=X.get_lamps("SUN")[0];E.create_sensor_manifold(d,"ELAPSED",E.CT_CONTINUOUS,[c],function(a){return a[0]},function(c,d,f){1==f&&(a=document.getElementById("sun_time_multiplier").value,c=E.get_sensor_value(c,d,0),b+=c*a/3600,24<b&&(b-=Math.floor(b)),l("day_time",b))})}function ib(){var a=
"run_sun stop_sun date sun_time_multiplier day_time max_sun_angle".split(" ");if(!X.get_lamps("SUN")[0])return A(a,"disable"),null}function Oa(){A("material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" "),"disable");A("shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" "),
"disable")}function ob(){var a=X.get_lamps("SUN")[0];E.check_sensor_manifolds(a)&&E.remove_sensor_manifold(a,"ELAPSED")}function eb(){var a=n.get_dof_params(),b=["dof_distance","dof_front","dof_rear","dof_power","dof_on"];a?(l("dof_distance",a.dof_distance),l("dof_front",a.dof_front),l("dof_rear",a.dof_rear),l("dof_power",a.dof_power),A(b,"enable"),a=0<a.dof_distance?0:1,document.getElementById("dof_on").options[a].selected=!0,$("#dof_on").slider("refresh")):A(b,"disable")}function ra(a){var b={};
"dof_distance"in a&&1==$("#dof_on").val()&&(b.dof_distance=a.dof_distance);"dof_front"in a&&(b.dof_front=a.dof_front);"dof_rear"in a&&(b.dof_rear=a.dof_rear);"dof_power"in a&&(b.dof_power=a.dof_power);"dof_on"in a&&(b.dof_on=$("#dof_on").val(),b.dof_distance=1==a.dof_on?$("#dof_distance").val():0);n.set_dof_params(b)}function fb(){var a=n.get_god_rays_params(),b=["god_rays_intensity","god_rays_max_ray_length","god_rays_steps"];a?(A(b,"enable"),a&&(l("god_rays_intensity",a.god_rays_intensity),l("god_rays_max_ray_length",
a.god_rays_max_ray_length),l("god_rays_steps",a.god_rays_steps))):A(b,"disable")}function Ga(a){var b={};"god_rays_intensity"in a&&(b.god_rays_intensity=a.god_rays_intensity);"god_rays_max_ray_length"in a&&(b.god_rays_max_ray_length=a.god_rays_max_ray_length);"god_rays_steps"in a&&(b.god_rays_steps=a.god_rays_steps);n.set_god_rays_params(b)}function hb(){var a=n.get_bloom_params(),b=["bloom_key","bloom_blur","bloom_edge_lum"];a?(A(b,"enable"),a&&(l("bloom_key",a.bloom_key),l("bloom_blur",a.bloom_blur),
l("bloom_edge_lum",a.bloom_edge_lum))):A(b,"disable")}function Ha(a){var b={};"bloom_key"in a&&(b.bloom_key=a.bloom_key);"bloom_blur"in a&&(b.bloom_blur=a.bloom_blur);"bloom_edge_lum"in a&&(b.bloom_edge_lum=a.bloom_edge_lum);n.set_bloom_params(b)}function ga(a,b){b=[Math.pow(b[0],1/2.2),Math.pow(b[1],1/2.2),Math.pow(b[2],1/2.2)];var c={r:Math.round(255*b[0]),g:Math.round(255*b[1]),b:Math.round(255*b[2])};$("#"+a).ColorPickerSetColor(c);$("#"+a+" div").css("backgroundColor","#"+function(a){var b=[a.r.toString(16),
a.g.toString(16),a.b.toString(16)];$.each(b,function(a,c){1==c.length&&(b[a]="0"+c)});return b.join("")}(c))}function gb(){var a=n.get_wind_params(),b=["wind_dir","wind_strength"];a?(l("wind_dir",a.wind_dir),l("wind_strength",a.wind_strength)):A(b,"disable")}function Sa(a){var b={};"wind_dir"in a&&(b.wind_dir=a.wind_dir);"wind_strength"in a&&(b.wind_strength=a.wind_strength);n.set_wind_params(b)}function l(a,b){$("#"+a).val(b);$("#"+a).slider("refresh")}function g(a,b){$("#"+b).bind("change",function(c){var d=
{};d[b]=c.target.value;a(d)})}function ca(a,b){$("#"+b).ColorPicker({onChange:function(c,d,f){$("#"+b+" div").css("backgroundColor","#"+d);c={};d=[];d[0]=f.r/255;d[1]=f.g/255;d[2]=f.b/255;f=d;f=[Math.pow(f[0],2.2),Math.pow(f[1],2.2),Math.pow(f[2],2.2)];c[b]=f;a(c)}})}function oa(a,b,c){for(var d=[],f=0;f<c.length;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function pb(){qb.auto_rotate(rb)}function A(a,b){if(!a)return null;for(var c=0;c<a.length;c++){var d=$("#"+a[c]).parent().parent();"enable"==b?
d.removeClass("ui-disabled"):"disable"==b&&d.addClass("ui-disabled")}}var F=b("animation"),H=b("app"),Ta=b("assets"),Da=b("camera"),qb=b("camera_anim"),ha=b("config"),jb=b("constraints"),E=b("controls"),Ea=b("data"),T=b("debug"),X=b("lights"),ka=b("main"),$a=b("mixer"),la=b("material"),n=b("scenes"),lb=b("shaders"),K=b("storage"),cb=b("transform"),Ua=b("version"),db=b("vec3"),Ba="DEBUG"===Ua.type(),ab=1E3,rb=0.3,Za="dev/logo.json",Va;Va="true"===K.get("show_hud_debug_info")?!0:!1;var sb={canvas_container_id:"main_canvas_container",
callback:function(a,b){if(!b)return console.log("b4w init failure"),null;window.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1};window.ondragstart=function(a){a.preventDefault();a.stopPropagation();return!1};H.enable_controls(a);a.addEventListener("mousedown",L,!1);window.addEventListener("resize",k,!1);var c=document.createEvent("CustomEvent");c.initEvent("resize",!1,!1);window.dispatchEvent(c);Ta.enqueue([["manifest",Ta.AT_JSON,x("assets.json")]],function(a,b,c,d){W=a;
va=document.getElementById("info_left_down");fa=document.getElementById("lights_cont");document.getElementById("build_date").innerHTML=Ua.date();g(D,"quality");switch(ha.get("quality")){case ha.P_ULTRA:var e=0;break;case ha.P_HIGH:e=1;break;case ha.P_LOW:e=2}document.getElementById("quality").options[e].selected=!0;$("#quality").selectmenu("refresh");H.set_onclick("reset_memory",U);H.set_onclick("auto_rotate_cam",pb);H.set_onclick("pause",r);H.set_onclick("resume",I);H.set_onclick("auto_view",ma);
a=document.getElementById("manifest");if(W){c="";for(b=0;b<W.length;b++){e=W[b];d=e.name;for(var e=e.items,f="",f=f+"<div data-role='collapsible' data-mini='true' >",f=f+("<h6>"+d+"</h6>"),f=f+"<ul data-role='listview' data-mini='true' data-inset='true' style='margin: -10px 0;'>",k=0;k<e.length;k++)var l=e[k].name,f=f+("<li data-mini='true'><a href='#' class='min_font' id='"+("MANIFEST_ITEM_"+l+"__SEPARATOR__"+d)+"'>"+l+"</a></li>");f+="</ul>";f+="</div>";c+=f}$("#"+a.id).append(c);$("#"+a.id).trigger("create");
a.addEventListener("mouseup",p,!1)}else a.innerHTML="<p style='color: red;'>Failed loading scenes list.</p><p>Maybe a syntax error?</p>";g(q,"anim_active_object");g(q,"anim_action");g(q,"anim_cyclic");g(q,"anim_frame_current");H.set_onclick("anim_play",ya);H.set_onclick("anim_stop",ja);H.set_onclick("get_max_bones",na);g(P,"material_name");ca(P,"material_diffuse_color");g(P,"material_reflectivity");g(P,"material_fresnel");g(P,"material_fresnel_factor");g(P,"material_parallax_scale");g(P,"material_parallax_steps");
g(B,"material_name");g(B,"shore_smoothing");g(B,"absorb_factor");g(B,"sss_strength");g(B,"sss_width");ca(B,"water_fog_color");g(B,"water_fog_density");ca(B,"shallow_water_col");g(B,"shallow_water_col_fac");ca(B,"shore_water_col");g(B,"shore_water_col_fac");g(B,"foam_factor");g(B,"water_dynamic");g(B,"waves_height");g(B,"waves_length");g(B,"dst_noise_scale0");g(B,"dst_noise_scale1");g(B,"dst_noise_freq0");g(B,"dst_noise_freq1");g(B,"dir_min_shore_fac");g(B,"dir_freq");g(B,"dir_noise_scale");g(B,"dir_noise_freq");
g(B,"dir_min_noise_fac");g(B,"dst_min_fac");g(B,"waves_hor_fac");g(Z,"environment_energy");ca(Z,"horizon_color");ca(Z,"zenith_color");g(Aa,"light_name");ca(Aa,"light_color");g(Aa,"light_energy");ca(G,"sky_color");g(G,"rayleigh_brightness");g(G,"mie_brightness");g(G,"spot_brightness");g(G,"scatter_strength");g(G,"rayleigh_strength");g(G,"mie_strength");g(G,"rayleigh_collection_power");g(G,"mie_collection_power");g(G,"mie_distribution");g(Fa,"date");g(Fa,"day_time");g(La,"sun_horizontal_position");
g(La,"sun_vertical_position");g(mb,"max_sun_angle");H.set_onclick("run_sun",nb);H.set_onclick("stop_sun",ob);g(V,"optimize_shadow_volume");g(V,"csm_near");g(V,"csm_far");g(V,"csm_lambda");g(V,"shadow_visibility_falloff");g(V,"blur_depth_size_mult");g(V,"blur_depth_edge_size");g(V,"blur_depth_diff_threshold");g(Y,"ssao_quality");g(Y,"ssao_radius_increase");g(Y,"ssao_dithering_amount");g(Y,"ssao_gauss_center");g(Y,"ssao_gauss_width_square");g(Y,"ssao_gauss_width_left_square");g(Y,"ssao_influence");
g(Y,"ssao_dist_factor");g(Y,"ssao_only");g(Y,"ssao_white");g(za,"fog_density");g(za,"fog_density1000");ca(za,"fog_color");g(ra,"dof_distance");g(ra,"dof_front");g(ra,"dof_rear");g(ra,"dof_power");g(ra,"dof_on");g(Ga,"god_rays_intensity");g(Ga,"god_rays_max_ray_length");g(Ga,"god_rays_steps");g(sa,"brightness");g(sa,"contrast");g(sa,"exposure");g(sa,"saturation");g(h,"sfx_mix_mode");a="true"===K.get("sfx_mix_mode")?0:1;document.getElementById("sfx_mix_mode").options[a].selected=!0;$("#sfx_mix_mode").slider("refresh");
g(w,"anaglyph_use");a="true"===K.get("anaglyph_use")?0:1;document.getElementById("anaglyph_use").options[a].selected=!0;$("#anaglyph_use").slider("refresh");g(Sa,"wind_dir");g(Sa,"wind_strength");g(Ha,"bloom_key");g(Ha,"bloom_blur");g(Ha,"bloom_edge_lum");g(Ma,"wireframe_mode");ca(Ma,"wireframe_edge_color");g(R,"show_hud_debug_info");a="true"===K.get("show_hud_debug_info")?0:1;document.getElementById("show_hud_debug_info").options[a].selected=!0;$("#show_hud_debug_info").slider("refresh");a=J();M(a,
!1,!1)},null)},gl_debug:!0,show_hud_debug_info:Va,sfx_mix_mode:v(),show_fps:!0,alpha:!0,assets_dds_available:!Ba,assets_min50_available:!Ba,console_verbose:!0,all_objs_selectable:!0,physics_enabled:!0,wireframe_debug:!0},Ra=0,kb=0,bb=new Float32Array(3),xa=!1,Qa,W=null,S=[],ba=0,qa=[],pa=null,Ca=null,va=null,fa=null,aa=null,Na=function(){},ea=null,Pa=null;c.init=function(){var a=K.get("quality");if(a){switch(a){case "ULTRA":var b=ha.P_ULTRA;break;case "HIGH":b=ha.P_HIGH;break;case "LOW":b=ha.P_LOW}ha.set("quality",
b)}ha.set("anaglyph_use","true"===K.get("anaglyph_use"));H.init(sb)}});b4w.require("viewer_main").init();
