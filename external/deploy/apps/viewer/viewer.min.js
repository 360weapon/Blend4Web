b4w.register("viewer_main",function(ya,p){function za(a,b){if(!b)return console.log("b4w init failure"),null;window.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1};window.ondragstart=function(a){a.preventDefault();a.stopPropagation();return!1};q.enable_controls(a);window.addEventListener("resize",Aa,!1);var h=document.createEvent("CustomEvent");h.initEvent("resize",!1,!1);window.dispatchEvent(h);ca.enqueue([["manifest",ca.AT_JSON,da("assets.json")]],function(a,b,h,e){v=
a;N=document.getElementById("info_left_down");s=document.getElementById("lights_cont");document.getElementById("build_date").innerHTML=ea.date();c(Ba,"quality","string");switch(w.get("quality")){case w.P_ULTRA:var f=0;break;case w.P_HIGH:f=1;break;case w.P_LOW:f=2;break;case w.P_CUSTOM:f=3}document.getElementById("quality").options[f].selected=!0;$("#quality").selectmenu("refresh");q.set_onclick("reset_memory",Ca);q.set_onclick("auto_rotate_cam",Da);q.set_onclick("pause",Ea);q.set_onclick("resume",
Fa);q.set_onclick("auto_view",Ga);a=document.getElementById("manifest");if(v){h="";for(b=0;b<v.length;b++){f=v[b];e=f.name;for(var f=f.items,g="",g=g+"<div data-role='collapsible' data-mini='true' >",g=g+("<h6>"+e+"</h6>"),g=g+"<ul data-role='listview' data-mini='true' data-inset='true' style='margin: -10px 0;'>",k=0;k<f.length;k++)var m=f[k].name,g=g+("<li data-mini='true'><a href='#' class='min_font' id='"+("MANIFEST_ITEM_"+m+"__SEPARATOR__"+e)+"'>"+m+"</a></li>");g+="</ul>";g+="</div>";h+=g}$("#"+
a.id).append(h);$("#"+a.id).trigger("create");a.addEventListener("mouseup",Ha,!1)}else a.innerHTML="<p style='color: red;'>Failed loading scenes list.</p><p>Maybe a syntax error?</p>";c(E,"anim_active_object","string");c(E,"animation","string");c(E,"anim_mix_factor","number");c(E,"anim_slot","number");c(E,"anim_cyclic","bool");c(E,"anim_frame_current","number");q.set_onclick("anim_play",Ia);q.set_onclick("anim_stop",Ja);q.set_onclick("get_max_bones",Ka);c(F,"material_name","string");y(F,"material_diffuse_color");
c(F,"material_reflectivity","number");c(F,"material_fresnel","number");c(F,"material_fresnel_factor","number");c(F,"material_parallax_scale","number");c(F,"material_parallax_steps","number");c(l,"material_name","string");c(l,"shore_smoothing","bool");c(l,"absorb_factor","number");c(l,"sss_strength","number");c(l,"sss_width","number");y(l,"water_fog_color");c(l,"water_fog_density","number");y(l,"shallow_water_col");c(l,"shallow_water_col_fac","number");y(l,"shore_water_col");c(l,"shore_water_col_fac",
"number");c(l,"foam_factor","number");c(l,"water_dynamic","bool");c(l,"waves_height","number");c(l,"waves_length","number");c(l,"dst_noise_scale0","number");c(l,"dst_noise_scale1","number");c(l,"dst_noise_freq0","number");c(l,"dst_noise_freq1","number");c(l,"dir_min_shore_fac","number");c(l,"dir_freq","number");c(l,"dir_noise_scale","number");c(l,"dir_noise_freq","number");c(l,"dir_min_noise_fac","number");c(l,"dst_min_fac","number");c(l,"waves_hor_fac","number");c(Q,"environment_energy","string");
y(Q,"horizon_color");y(Q,"zenith_color");c(R,"light_name","string");y(R,"light_color");c(R,"light_energy","number");y(z,"sky_color");c(z,"rayleigh_brightness","number");c(z,"mie_brightness","number");c(z,"spot_brightness","number");c(z,"scatter_strength","number");c(z,"rayleigh_strength","number");c(z,"mie_strength","number");c(z,"rayleigh_collection_power","number");c(z,"mie_collection_power","number");c(z,"mie_distribution","number");c(S,"date","string");c(S,"day_time","number");c(fa,"sun_horizontal_position",
"number");c(fa,"sun_vertical_position","number");c(La,"max_sun_angle","number");q.set_onclick("run_sun",Ma);q.set_onclick("stop_sun",Na);c(H,"csm_first_cascade_border","number");c(H,"csm_last_cascade_border","number");c(H,"self_shadow_polygon_offset","number");c(H,"self_shadow_normal_offset","number");c(H,"first_cascade_blur_radius","number");c(H,"last_cascade_blur_radius","number");c(A,"ssao_quality","string");c(A,"ssao_radius_increase","number");c(A,"ssao_dithering_amount","number");c(A,"ssao_gauss_center",
"number");c(A,"ssao_gauss_width_square","number");c(A,"ssao_gauss_width_left_square","number");c(A,"ssao_influence","number");c(A,"ssao_dist_factor","number");c(A,"ssao_only","bool");c(A,"ssao_white","bool");c(T,"fog_density","number");c(T,"fog_density1000","number");y(T,"fog_color");c(K,"dof_distance","number");c(K,"dof_front","number");c(K,"dof_rear","number");c(K,"dof_power","number");c(K,"dof_on","bool");c(U,"god_rays_intensity","number");c(U,"god_rays_max_ray_length","number");c(U,"god_rays_steps",
"number");c(O,"brightness","number");c(O,"contrast","number");c(O,"exposure","number");c(O,"saturation","number");c(Oa,"sfx_mix_mode","bool");a=Number("true"===r.get("sfx_mix_mode"));document.getElementById("sfx_mix_mode").options[a].selected=!0;$("#sfx_mix_mode").slider("refresh");c(Pa,"anaglyph_use","bool");a=Number("true"===r.get("anaglyph_use"));document.getElementById("anaglyph_use").options[a].selected=!0;$("#anaglyph_use").slider("refresh");c(ga,"wind_dir","number");c(ga,"wind_strength","number");
c(V,"bloom_key","number");c(V,"bloom_blur","number");c(V,"bloom_edge_lum","number");c(ha,"wireframe_mode","string");y(ha,"wireframe_edge_color","object");c(Qa,"show_hud_debug_info","bool");a=Number("true"===r.get("show_hud_debug_info"));document.getElementById("show_hud_debug_info").options[a].selected=!0;$("#show_hud_debug_info").slider("refresh");a=ia();W(a,!1,!1)},null)}function da(a){return(X?"../../external/deploy/assets/":"../../assets/")+a}function ja(a){if(N){$("#material_warning")[0].style.display=
"none";a.preventDefault&&a.preventDefault();var b=a.clientX;a=a.clientY;var h=t;h&&f.clear_glow_anim(h);(t=b=f.pick_object(b,a))?(ka(b),f.apply_glow_anim(b,.2,3.8,1)):la();I();D||(b?(D=b,I(),q.enable_object_controls(b),n.create_kb_sensor_manifold(b,"QUIT",n.CT_SHOT,n.KEY_Q,function(a,b,h,c){D=null;I();q.disable_object_controls(a)})):ma())}}function ma(){var a=f.get_active_camera();D=a;I();q.enable_camera_controls();n.create_kb_sensor_manifold(a,"QUIT",n.CT_SHOT,n.KEY_Q,function(a,b,h,c){D=null;I();
q.disable_camera_controls(a);n.remove_sensor_manifold(a,"ZOOM_TO")});var b=n.create_keyboard_sensor(n.KEY_Z),h=n.create_keyboard_sensor(n.KEY_DEC_POINT);n.create_sensor_manifold(a,"ZOOM_TO",n.CT_SHOT,[b,h],function(a){return a[0]||a[1]},function(a,b,h){(b=t)&&Y.zoom_object(a,b)})}function I(){if(N){var a="CONTROLLED: "+(D?String(D.name):"NONE")+" | SELECTED: "+(t?String(t.name):"NONE"),b=t;b&&(b=f.get_type_mesh_object(b))&&(a+=" | TYPE: "+b);b=D;t&&b&&"CAMERA"===b.type&&(a+=" | DISTANCE: "+na);N.innerHTML=
a}}function ia(){var a=r.get("last_item_name");if(!a)return null;for(var b=0;b<v.length;b++){var h=v[b];if(L.keyfind("name",a,h.items)[0])return{category:h.name,item:a}}return null}function J(a,b){var h=document.getElementById(a);h.innerHTML="";for(var d=0;d<b.length;d++){var c=document.createElement("option");c.text=c.value=b[d];0===d&&(c.selected=!0);h.appendChild(c)}$("#"+a).selectmenu();$("#"+a).selectmenu("refresh")}function Ha(a){a=a.target.id;if(-1!=a.indexOf("MANIFEST_ITEM_")){var b=a.split("__SEPARATOR__");
a=b[1];b=b[0].split("MANIFEST_ITEM_")[1];P=!1;clearTimeout(oa);W({category:a,item:b},!0,!1)}}function W(a,b,h){for(var d=0;d<s.children.length;d++)s.children[d].style.visibility="hidden";M={load_file:"dev/logo.json",animated_objects:[]};g=null;if(a){var d=L.keyfind("name",a.category,v)[0],d=L.keyfind("name",a.item,d.items)[0],c;for(c in d)M[c]=d[c];r.set("last_item_name",a.item)}else r.set("last_item_name","");b&&(B.clear_render_callback(),Z.cleanup());B.get_canvas_elem().removeEventListener("mousedown",
ja);u.clear_errors_warnings();a=M.name||"Logo";b=M.load_file;c=document.getElementById("current_file");c.innerHTML=a;c.setAttribute("title",a+" ("+b+")");Z.load(da(b),Ra,Sa,h)}function Ra(a){B.get_canvas_elem().addEventListener("mousedown",ja,!1);f.set_glow_color([1,.4,.05]);t=null;Ta(M);ma();q.enable_debug_controls();pa()&&Ua.enable_mixer_controls();B.set_render_callback(Va);P&&(oa=setTimeout(qa,1E3));a=n.create_elapsed_sensor();n.create_sensor_manifold(f.get_active_camera(),"TO_OBJ",n.CT_CONTINUOUS,
[a],null,function(a,h,d){if(1==d&&t){if(d=t)h=Wa,Xa.get_object_center(d,!0,h),a=Y.get_eye(a),na=Ya.dist(h,a).toFixed(3);I()}})}function qa(){var a=ia();if(a){var b=a.item,a=L.keyfind("name",a.category,v)[0],b=L.keyfind("name",b,a.items)[0],b=a.items.indexOf(b);if(b=a.items[b+1])a={category:a.name,item:b.name};else if(a=v.indexOf(a),a=v[a+1])a={category:a.name,item:a.items[0].name};else{P=!1;return}}else a=v[0],b=a.items[0],a={category:a.name,item:b.name};W(a,!0,!0)}function Sa(a,b){document.getElementById("loading_progress").innerHTML=
a+"% ("+Math.round(10*b/1E3)/10+"s)";var h=u.get_error_quantity(),d=u.get_warning_quantity();if(Z.is_primary_loaded()){var c=u.num_vertices(),e=u.num_triangles(),f=u.num_draw_calls();document.getElementById("info_right_up").innerHTML=c+" verts, "+e+" tris, "+f+" draw calls";var c=u.geometry_stats(),e=u.num_textures(),f=u.num_render_targets(),g=Math.round(10*(c.ibo_memory+c.vbo_memory))/10,k=Math.round(10*e.memory)/10,m=Math.round(10*f.memory)/10,l=Math.round(10*(g+k+m))/10;document.getElementById("info_right_down").innerHTML=
"Geometry: "+g+" MiB ("+c.ibo_number+"+"+c.vbo_number+")<br>Textures: "+k+" MiB ("+e.number+")<br>RTs: "+m+" MiB ("+f.number+")<br><br>Total: "+l+" MiB";c=u.get_error_quantity();(e=u.get_warning_quantity())||c?s.setAttribute("title","warnings:"+e+"\nerrors:"+c):s.setAttribute("title","Loaded OK");d||h||(s.children[0].style.visibility="hidden",s.children[1].style.visibility="hidden",s.children[2].style.visibility="visible")}d&&!h&&(s.children[0].style.visibility="hidden",s.children[1].style.visibility=
"visible",s.children[2].style.visibility="hidden");h&&(s.children[0].style.visibility="visible",s.children[1].style.visibility="hidden",s.children[2].style.visibility="hidden")}function Ta(a){for(var b=f.get_active(),h=f.get_scenes(),d=0;d<h.length;d++){var c=h[d];if(c!==b){var g=ra(c,a);sa(c,g)}}g=ra(b,a);sa(b,g);ka=function(a){var b=G.get_materials_names(a);J("material_name",b);ta(a,b[0]);a=G.get_water_material_params(a,b[0]);b="shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" ");
a?(k(b,"enable"),f.get_water_mat_params(a),a.shallow_water_col&&C("shallow_water_col",a.shallow_water_col),a.shallow_water_col_fac&&e("shallow_water_col_fac",a.shallow_water_col_fac),a.shore_water_col&&C("shore_water_col",a.shore_water_col),a.shore_water_col_fac&&e("shore_water_col_fac",a.shore_water_col_fac),a.water_fog_color&&(C("water_fog_color",a.water_fog_color),e("water_fog_density",a.water_fog_density)),e("absorb_factor",a.absorb_factor),e("sss_strength",a.sss_strength),e("sss_width",a.sss_width),
e("foam_factor",a.foam_factor),e("waves_height",a.waves_height),e("waves_length",a.waves_length),e("dst_noise_scale0",a.dst_noise_scale0),e("dst_noise_scale1",a.dst_noise_scale1),e("dst_noise_freq0",a.dst_noise_freq0),e("dst_noise_freq1",a.dst_noise_freq1),e("dir_min_shore_fac",a.dir_min_shore_fac),e("dir_freq",a.dir_freq),e("dir_noise_scale",a.dir_noise_scale),e("dir_noise_freq",a.dir_noise_freq),e("dir_min_noise_fac",a.dir_min_noise_fac),e("dst_min_fac",a.dst_min_fac),e("waves_hor_fac",a.waves_hor_fac)):
k(b,"disable")};Za();a=x.get_lights_names();J("light_name",a);ua(a[0]);$a();ab();bb();cb();db();eb();fb();gb();hb();ib();jb();la();$("#wireframe_mode").val("WM_NONE");$("#wireframe_mode").selectmenu("refresh",!0);$("#wireframe_edge_color div").css("backgroundColor","#333");a=new Date(document.getElementById("date").value);S({date:a})}function ra(a,b){function h(a,b){for(var d in a)b[d]=a[d];return b}var d=b.scene_settings;if(d&&d[a]){var c={};h(b,c);h(d[a],c);delete c.scene_settings;return c}return b}
function sa(a,b){f.set_active(a);var c=f.get_active_camera();b.camera_target&&kb.append_follow(c,b.camera_target);var d=b.h_angle,e=b.v_angle;0!==d&&!d||0!==e&&!e||Y.set_eye_params(c,d,e);c=[];d=f.get_all_objects();for(e=0;e<d.length;e++){var l=d[e];m.is_animated(l)&&(g||(g=l),c.push(f.get_object_name(l)))}d="anim_active_object anim_slot animation anim_cyclic anim_frame_range anim_mix_factor anim_frame_current anim_play anim_stop get_max_bones".split(" ");g?(k(d,"enable"),J("anim_active_object",c),
E({anim_active_object:f.get_object_name(g)})):k(d,"disable")}function Va(a,b){f.get_active_camera();if(g){var c=parseInt(document.getElementById("anim_slot").value),d=Math.round(m.get_frame(g,c));parseInt($("#anim_frame_current").val())!==d&&e("anim_frame_current",d);d=document.getElementById("anim_status");m.is_play(g,c)?d.innerHTML="PLAYING":d.innerHTML="STOPPED"}}function Ba(a){r.set("quality",a.quality);setTimeout(function(){window.location.reload()},100)}function Ca(){r.cleanup();window.location.reload()}
function Ea(){B.pause()}function Fa(){B.resume()}function pa(){return"true"===r.get("sfx_mix_mode")?!0:!1}function Qa(a){r.set("show_hud_debug_info",a.show_hud_debug_info);window.location.reload()}function Oa(a){r.set("sfx_mix_mode",a.sfx_mix_mode);window.location.reload()}function Pa(a){r.set("anaglyph_use",a.anaglyph_use);window.location.reload()}function Ga(){P=!0;qa()}function Aa(a){var b=a.target.innerWidth;a=a.target.innerHeight;var c=document.getElementById("controls_container").offsetWidth,
b=b-c;B.resize(b,a);document.getElementById("info_left_up").innerHTML=b+"x"+a}function Ia(){var a=document.getElementById("animation").value,b=parseInt(document.getElementById("anim_slot").value);"None"!==a&&m.play(g,null,b)}function Ja(){document.getElementById("animation");var a=parseInt(document.getElementById("anim_slot").value);m.stop(g,a)}function Ka(){B.pause();var a=lb.determine_max_bones();document.getElementById("max_bones").innerHTML=a.max_bones;document.getElementById("max_bones_no_blending").innerHTML=
a.max_bones_no_blending;B.resume()}function E(a){if("anim_active_object"in a){g=f.get_object_by_name(a.anim_active_object);var b=m.get_anim_names(g);if(b.length){for(var c=[],d=0;d<b.length&&8>d;d++)c.push(d);b.push("None");J("animation",b);J("anim_slot",c);b=parseInt(document.getElementById("anim_slot").value);va(g,b);aa(g,b)}else J("animation",["N/A"]);ba(g)}if("anim_slot"in a){if(!g)return;b=a.anim_slot;va(g,b);aa(g,b);ba(g)}"animation"in a&&(b=parseInt(document.getElementById("anim_slot").value),
m.get_current_anim_name(g,b),"None"==a.animation?m.remove_slot_animation(g,b):(m.apply(g,a.animation,b),m.play(g,null,b)),aa(g,b),ba(g));"anim_cyclic"in a&&(b=document.getElementById("animation").value,b=m.get_slot_num_by_anim(g,b),m.cyclic(g,a.anim_cyclic,b));"anim_frame_current"in a&&(b=parseInt(document.getElementById("anim_slot").value),m.is_play(g,b)||(c=parseInt(a.anim_frame_current),m.set_frame(g,c,b)));"anim_mix_factor"in a&&m.set_skel_mix_factor(g,a.anim_mix_factor)}function va(a,b){for(var c=
m.get_anim_name(a,b),c=c||"None",d=$("#animation"),e=d.children(),f=0;f<e.length;f++){var g=e[f];if(g.value==c){g.selected=!0;d.selectmenu();d.selectmenu("refresh");break}}}function aa(a,b){var c=m.is_cyclic(a,b);e("anim_cyclic",Number(c));var d=document.getElementById("anim_frame_range");(c=m.get_frame_range(a,b))?(d.innerHTML=c[0]+" - "+c[1],d=document.getElementById("anim_frame_current"),d.min=""+c[0],d.max=""+c[1]):d.innerHTML="N/A"}function ba(a){for(var b=$("#anim_slot-listbox").find("a"),c=
parseInt(document.getElementById("anim_slot").value),d=m.get_anim_type(a,c),c=0;c<b.length;c++){d=m.get_anim_type(a,c);switch(d){case m.OBJ_ANIM_TYPE_ARMATURE:d="ARMATURE";break;case m.OBJ_ANIM_TYPE_OBJECT:d="OBJECT";break;case m.OBJ_ANIM_TYPE_PARTICLES:d="PARTICLES";break;case m.OBJ_ANIM_TYPE_VERTEX:d="VERTEX";break;case m.OBJ_ANIM_TYPE_MATERIAL:d="MATERIAL";break;case m.OBJ_ANIM_TYPE_STATIC:d="STATIC";break;default:d="NONE"}b.eq(c);d=c+" ("+d+")";$("#anim_slot").children().eq(c).text(d)}$("#anim_slot").selectmenu();
$("#anim_slot").selectmenu("refresh")}function ab(){var a=f.get_ssao_params(),b="ssao_quality ssao_radius_increase ssao_dithering_amount ssao_gauss_center ssao_gauss_width_square ssao_gauss_width_left_square ssao_influence ssao_dist_factor ssao_only ssao_white".split(" ");if(a){k(b,"enable");for(var c=document.getElementById("ssao_quality"),b=a.ssao_quality,c=c.options,d=0;d<c.length;d++){var g=c[d];g.selected=g.value==b?!0:!1}$("#ssao_quality").selectmenu("refresh");e("ssao_radius_increase",a.radius_increase);
e("ssao_dithering_amount",1E3*a.dithering_amount);e("ssao_gauss_center",a.gauss_center);e("ssao_gauss_width_square",Math.sqrt(a.gauss_width_square));e("ssao_gauss_width_left_square",Math.sqrt(a.gauss_width_left_square));e("ssao_influence",a.influence);e("ssao_dist_factor",a.dist_factor);b=Number(a.ssao_only);document.getElementById("ssao_only").options[b].selected=!0;$("#ssao_only").slider("refresh");b=Number(a.ssao_white);document.getElementById("ssao_white").options[b].selected=!0;$("#ssao_white").slider("refresh")}else k(b,
"disable")}function A(a){f.get_ssao_params();var b={};"ssao_quality"in a&&(b.ssao_quality=wa(document.getElementById("ssao_quality")));"ssao_radius_increase"in a&&(b.ssao_radius_increase=a.ssao_radius_increase);"ssao_dithering_amount"in a&&(b.ssao_dithering_amount=a.ssao_dithering_amount/1E3);"ssao_gauss_center"in a&&(b.ssao_gauss_center=a.ssao_gauss_center);"ssao_gauss_width_square"in a&&(b.ssao_gauss_width_square=a.ssao_gauss_width_square*a.ssao_gauss_width_square);"ssao_gauss_width_left_square"in
a&&(b.ssao_gauss_width_left_square=a.ssao_gauss_width_left_square*a.ssao_gauss_width_left_square);"ssao_influence"in a&&(b.ssao_influence=a.ssao_influence);"ssao_dist_factor"in a&&(b.ssao_dist_factor=a.ssao_dist_factor);"ssao_only"in a&&(b.ssao_only=Number(a.ssao_only));"ssao_white"in a&&(b.ssao_white=Number(a.ssao_white));f.set_ssao_params(b)}function eb(){var a=f.get_color_correction_params(),b=["brightness","contrast","exposure","saturation"];a?(k(b,"enable"),e("brightness",a.brightness),e("contrast",
a.contrast),e("exposure",a.exposure),e("saturation",a.saturation)):k(b,"disable")}function O(a){var b=f.get_color_correction_params();b&&(b={},"brightness"in a&&(b.brightness=parseFloat(a.brightness)),"contrast"in a&&(b.contrast=parseFloat(a.contrast)),"exposure"in a&&(b.exposure=parseFloat(a.exposure)),"saturation"in a&&(b.saturation=parseFloat(a.saturation)),f.set_color_correction_params(b))}function wa(a){a=a.options;for(var b=0;b<a.length;b++){var c=a[b];if(c.selected)return c.value}}function bb(){var a=
f.get_fog_color_density();.2<a[3]?e("fog_density",a[3]):e("fog_density1000",1E3*a[3]);C("fog_color",a)}function T(a){var b=f.get_fog_color_density();"fog_density"in a&&(b[3]=a.fog_density);"fog_density1000"in a&&(b[3]=a.fog_density1000/1E3);"fog_color"in a&&(b[0]=a.fog_color[0],b[1]=a.fog_color[1],b[2]=a.fog_color[2]);f.set_fog_color_density(b)}function $a(){var a=f.get_shadow_params(),b="csm_first_cascade_border csm_last_cascade_border self_shadow_polygon_offset self_shadow_normal_offset first_cascade_blur_radius last_cascade_blur_radius".split(" ");
if(!a)return k(b,"disable"),null;k(b,"enable");xa(a);e("csm_first_cascade_border",a.csm_first_cascade_border);e("first_cascade_blur_radius",a.first_cascade_blur_radius);1<a.csm_num?(e("csm_last_cascade_border",a.csm_last_cascade_border),e("last_cascade_blur_radius",a.last_cascade_blur_radius)):k(["csm_last_cascade_border","last_cascade_blur_radius"],"disable");e("self_shadow_polygon_offset",a.self_shadow_polygon_offset);e("self_shadow_normal_offset",a.self_shadow_normal_offset)}function H(a){var b=
{};"csm_first_cascade_border"in a&&(b.csm_first_cascade_border=a.csm_first_cascade_border);"csm_last_cascade_border"in a&&(b.csm_last_cascade_border=a.csm_last_cascade_border);"self_shadow_polygon_offset"in a&&(b.self_shadow_polygon_offset=a.self_shadow_polygon_offset);"self_shadow_normal_offset"in a&&(b.self_shadow_normal_offset=a.self_shadow_normal_offset);"first_cascade_blur_radius"in a&&(b.first_cascade_blur_radius=a.first_cascade_blur_radius);"last_cascade_blur_radius"in a&&(b.last_cascade_blur_radius=
a.last_cascade_blur_radius);f.set_shadow_params(b);xa(f.get_shadow_params())}function xa(a){document.getElementById("csm_num").innerHTML=" "+a.csm_num;document.getElementById("csm_resolution").innerHTML="&nbsp;&nbsp;"+a.csm_resolution;for(var b=["csm_borders","blur_radii"],c=0;c<b.length;c++){var d=b[c],e=a[d],d=document.getElementById(d);d.innerHTML="(";for(var f=0;f<e.length;f++)0<f&&(d.innerHTML+=" __ "),d.innerHTML+=Math.round(10*e[f])/10;d.innerHTML+=")"}}function Za(){var a=f.get_environment_colors();
e("environment_energy",a[0]);C("horizon_color",a[1]);C("zenith_color",a[2])}function Q(a){"environment_energy"in a&&f.set_environment_colors(a.environment_energy,null,null);"horizon_color"in a&&f.set_environment_colors(null,a.horizon_color,null);"zenith_color"in a&&f.set_environment_colors(null,null,a.zenith_color)}function ha(a){var b={};"string"==typeof a.wireframe_mode&&(b.wireframe_mode=wa(document.getElementById("wireframe_mode")));"object"==typeof a.wireframe_edge_color&&(b.wireframe_edge_color=
a.wireframe_edge_color);u.set_debug_params(b)}function hb(){var a=f.get_sky_params(),b="sky_color rayleigh_brightness mie_brightness spot_brightness scatter_strength rayleigh_strength mie_strength rayleigh_collection_power mie_collection_power mie_distribution".split(" ");if(!a)return k(b,"disable"),null;k(b,"enable");C("sky_color",a.color);e("rayleigh_brightness",a.rayleigh_brightness);e("mie_brightness",a.mie_brightness);e("spot_brightness",a.spot_brightness);e("scatter_strength",a.scatter_strength);
e("rayleigh_strength",a.rayleigh_strength);e("mie_strength",a.mie_strength);e("rayleigh_collection_power",a.rayleigh_collection_power);e("mie_collection_power",a.mie_collection_power);e("mie_distribution",a.mie_distribution)}function z(a){var b={};"sky_color"in a&&(b.color=a.sky_color);"rayleigh_brightness"in a&&(b.rayleigh_brightness=a.rayleigh_brightness);"mie_brightness"in a&&(b.mie_brightness=a.mie_brightness);"spot_brightness"in a&&(b.spot_brightness=a.spot_brightness);"scatter_strength"in a&&
(b.scatter_strength=a.scatter_strength);"rayleigh_strength"in a&&(b.rayleigh_strength=a.rayleigh_strength);"mie_strength"in a&&(b.mie_strength=a.mie_strength);"rayleigh_collection_power"in a&&(b.rayleigh_collection_power=a.rayleigh_collection_power);"mie_collection_power"in a&&(b.mie_collection_power=a.mie_collection_power);"mie_distribution"in a&&(b.mie_distribution=a.mie_distribution);f.set_sky_params(b)}function ta(a,b){var c=G.get_material_extended_params(a,b),d="material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" ");
if(!c)return k(d,"disable"),$("#material_warning")[0].style.display="block",null;var f=G.get_diffuse_color(a,b);f.pop();c.diffuse_color=f;k(d,"enable");C("material_diffuse_color",c.diffuse_color);e("material_reflectivity",c.reflect_factor);e("material_fresnel",c.fresnel);e("material_fresnel_factor",c.fresnel_factor);e("material_parallax_scale",c.parallax_scale);e("material_parallax_steps",c.parallax_steps)}function F(a){var b=t;"material_name"in a&&ta(b,a.material_name);if("material_diffuse_color"in
a){var c=a.material_diffuse_color.slice();c.push(1);G.set_diffuse_color(b,$("#material_name").val(),c)}c={};"material_reflectivity"in a&&(c.material_reflectivity=a.material_reflectivity);"material_fresnel"in a&&(c.material_fresnel=a.material_fresnel);"material_fresnel_factor"in a&&(c.material_fresnel_factor=a.material_fresnel_factor);"material_parallax_scale"in a&&(c.material_parallax_scale=a.material_parallax_scale);"material_parallax_steps"in a&&(c.material_parallax_steps=a.material_parallax_steps);
G.set_material_extended_params(b,$("#material_name").val(),c);f.update_scene_materials_params()}function l(a){var b=t,c="waves_height waves_length sss_strength sss_width dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac".split(" ");if(!b)return null;var d={},e=$("#water_dynamic").val(),g=$("#shore_smoothing").val();Boolean(Number(e))?k(c,"enable"):k(c,"disable");Boolean(Number(g))?
k(["absorb_factor"],"enable"):k(["absorb_factor"],"disable");"shore_smoothing"in a&&(d.shore_smoothing=a.shore_smoothing);"absorb_factor"in a&&(d.absorb_factor=a.absorb_factor);"water_fog_color"in a&&(d.water_fog_color=a.water_fog_color);"water_fog_density"in a&&(d.water_fog_density=a.water_fog_density);"shallow_water_col"in a&&(d.shallow_water_col=a.shallow_water_col);"shallow_water_col_fac"in a&&(d.shallow_water_col_fac=a.shallow_water_col_fac);"shore_water_col"in a&&(d.shore_water_col=a.shore_water_col);
"shore_water_col_fac"in a&&(d.shore_water_col_fac=a.shore_water_col_fac);"foam_factor"in a&&(d.foam_factor=a.foam_factor);"sss_strength"in a&&(d.sss_strength=a.sss_strength);"sss_width"in a&&(d.sss_width=a.sss_width);"water_dynamic"in a&&(d.water_dynamic=a.water_dynamic);"waves_height"in a&&(d.waves_height=a.waves_height);"waves_length"in a&&(d.waves_length=a.waves_length);"dst_noise_scale0"in a&&(d.dst_noise_scale0=a.dst_noise_scale0);"dst_noise_scale1"in a&&(d.dst_noise_scale1=a.dst_noise_scale1);
"dst_noise_freq0"in a&&(d.dst_noise_freq0=a.dst_noise_freq0);"dst_noise_freq1"in a&&(d.dst_noise_freq1=a.dst_noise_freq1);"dir_min_shore_fac"in a&&(d.dir_min_shore_fac=a.dir_min_shore_fac);"dir_freq"in a&&(d.dir_freq=a.dir_freq);"dir_noise_scale"in a&&(d.dir_noise_scale=a.dir_noise_scale);"dir_noise_freq"in a&&(d.dir_noise_freq=a.dir_noise_freq);"dir_min_noise_fac"in a&&(d.dir_min_noise_fac=a.dir_min_noise_fac);"dst_min_fac"in a&&(d.dst_min_fac=a.dst_min_fac);"waves_hor_fac"in a&&(d.waves_hor_fac=
a.waves_hor_fac);if(!G.set_water_material_params(b,$("#material_name").val(),d))return null;f.update_scene_materials_params();f.set_water_params(d)}function ua(a){a=x.get_light_params(a);C("light_color",a.light_color);e("light_energy",a.light_energy)}function R(a){"light_name"in a&&ua(a.light_name);var b={};"light_color"in a&&(b.light_color=a.light_color);"light_energy"in a&&(b.light_energy=parseFloat(a.light_energy));x.set_light_params($("#light_name").val(),b)}function gb(){var a=x.get_sun_params(),
b=["sun_horizontal_position","sun_vertical_position"];if(!a)return k(b,"disable"),null;e("sun_horizontal_position",a.hor_position);e("sun_vertical_position",a.vert_position)}function fa(a){var b={};"sun_horizontal_position"in a&&(b.hor_position=parseFloat(a.sun_horizontal_position),b.vert_position=parseFloat(document.getElementById("sun_vertical_position").value));"sun_vertical_position"in a&&(b.hor_position=parseFloat(document.getElementById("sun_horizontal_position").value),b.vert_position=parseFloat(a.sun_vertical_position));
x.set_sun_params(b)}function La(a){a=parseFloat(a.max_sun_angle);x.set_max_sun_angle(a)}function S(a){"day_time"in a&&x.set_day_time(a.day_time);"date"in a&&x.set_date(new Date(a.date))}function Ma(){var a=0,b=parseFloat(document.getElementById("day_time").value),c=n.create_elapsed_sensor(),d=x.get_lamps("SUN")[0];n.create_sensor_manifold(d,"ELAPSED",n.CT_CONTINUOUS,[c],function(a){return a[0]},function(c,d,f){1==f&&(a=document.getElementById("sun_time_multiplier").value,c=n.get_sensor_value(c,d,
0),b+=c*a/3600,24<b&&(b-=Math.floor(b)),e("day_time",b))})}function jb(){var a="run_sun stop_sun date sun_time_multiplier day_time max_sun_angle".split(" ");if(!x.get_lamps("SUN")[0])return k(a,"disable"),null}function la(){k("material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" "),"disable");k("shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" "),
"disable")}function Na(){var a=x.get_lamps("SUN")[0];n.check_sensor_manifolds(a)&&n.remove_sensor_manifold(a,"ELAPSED")}function cb(){var a=f.get_dof_params(),b=["dof_distance","dof_front","dof_rear","dof_power","dof_on"];a?(e("dof_distance",a.dof_distance),e("dof_front",a.dof_front),e("dof_rear",a.dof_rear),e("dof_power",a.dof_power),k(b,"enable"),a=0<a.dof_distance?0:1,document.getElementById("dof_on").options[a].selected=!0,$("#dof_on").slider("refresh")):k(b,"disable")}function K(a){var b={};
"dof_distance"in a&&Number($("#dof_on").val())&&(b.dof_distance=a.dof_distance);"dof_front"in a&&(b.dof_front=a.dof_front);"dof_rear"in a&&(b.dof_rear=a.dof_rear);"dof_power"in a&&(b.dof_power=a.dof_power);"dof_on"in a&&(b.dof_on=Boolean($("#dof_on").val()),b.dof_distance=Number(a.dof_on)?parseFloat($("#dof_distance").val()):0);f.set_dof_params(b)}function db(){var a=f.get_god_rays_params(),b=["god_rays_intensity","god_rays_max_ray_length","god_rays_steps"];a?(k(b,"enable"),a&&(e("god_rays_intensity",
a.god_rays_intensity),e("god_rays_max_ray_length",a.god_rays_max_ray_length),e("god_rays_steps",a.god_rays_steps))):k(b,"disable")}function U(a){var b={};"god_rays_intensity"in a&&(b.god_rays_intensity=a.god_rays_intensity);"god_rays_max_ray_length"in a&&(b.god_rays_max_ray_length=a.god_rays_max_ray_length);"god_rays_steps"in a&&(b.god_rays_steps=a.god_rays_steps);f.set_god_rays_params(b)}function ib(){var a=f.get_bloom_params(),b=["bloom_key","bloom_blur","bloom_edge_lum"];a?(k(b,"enable"),a&&(e("bloom_key",
a.bloom_key),e("bloom_blur",a.bloom_blur),e("bloom_edge_lum",a.bloom_edge_lum))):k(b,"disable")}function V(a){var b={};"bloom_key"in a&&(b.bloom_key=a.bloom_key);"bloom_blur"in a&&(b.bloom_blur=a.bloom_blur);"bloom_edge_lum"in a&&(b.bloom_edge_lum=a.bloom_edge_lum);f.set_bloom_params(b)}function C(a,b){b=mb(b);var c={r:Math.round(255*b[0]),g:Math.round(255*b[1]),b:Math.round(255*b[2])};$("#"+a).ColorPickerSetColor(c);$("#"+a+" div").css("backgroundColor","#"+function(a){var b=[a.r.toString(16),a.g.toString(16),
a.b.toString(16)];$.each(b,function(a,c){1==c.length&&(b[a]="0"+c)});return b.join("")}(c))}function mb(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]}function fb(){var a=f.get_wind_params(),b=["wind_dir","wind_strength"];a?(e("wind_dir",a.wind_dir),e("wind_strength",a.wind_strength)):k(b,"disable")}function ga(a){var b={};"wind_dir"in a&&(b.wind_dir=a.wind_dir);"wind_strength"in a&&(b.wind_strength=a.wind_strength);f.set_wind_params(b)}function e(a,b){$("#"+a).val(b);$("#"+
a).slider("refresh")}function c(a,b,c){$("#"+b).bind("change",function(d){var e={};switch(c){case "string":e[b]=d.target.value;break;case "number":e[b]=parseFloat(d.target.value);break;case "bool":e[b]=Boolean(Number(d.target.value));break;default:return console.log("wrong value type"),null}a(e)})}function y(a,b){$("#"+b).ColorPicker({onChange:function(c,d,e){$("#"+b+" div").css("backgroundColor","#"+d);c={};d=[];d[0]=e.r/255;d[1]=e.g/255;d[2]=e.b/255;e=d;e=[Math.pow(e[0],2.2),Math.pow(e[1],2.2),
Math.pow(e[2],2.2)];c[b]=e;a(c)}})}function Da(){nb.auto_rotate(.3)}function k(a,b){if(!a)return null;for(var c=0;c<a.length;c++){var d=$("#"+a[c]).parent().parent();"enable"==b?d.removeClass("ui-disabled"):"disable"==b&&d.addClass("ui-disabled")}}var m=p("animation"),q=p("app"),ca=p("assets"),Y=p("camera"),nb=p("camera_anim"),w=p("config"),kb=p("constraints"),n=p("controls"),Z=p("data"),u=p("debug"),x=p("lights"),B=p("main"),Ua=p("mixer"),G=p("material"),f=p("scenes"),lb=p("shaders"),r=p("storage"),
Xa=p("transform"),L=p("util"),ea=p("version"),Ya=p("vec3"),X="DEBUG"===ea.type(),Wa=new Float32Array(3),P=!1,oa,v=null,g=null,M=null,N=null,s=null,t=null,ka=function(){},D=null,na=null;ya.init=function(){r.init("b4w_viewer");var a=r.get("quality");if(a){switch(a){case "ULTRA":var b=w.P_ULTRA;break;case "HIGH":b=w.P_HIGH;break;case "LOW":b=w.P_LOW;break;case "CUSTOM":b=w.P_CUSTOM}w.set("quality",b)}w.set("anaglyph_use","true"===r.get("anaglyph_use"));q.init({canvas_container_id:"main_canvas_container",
callback:za,gl_debug:!0,show_hud_debug_info:"true"===r.get("show_hud_debug_info")?!0:!1,sfx_mix_mode:pa(),show_fps:!0,alpha:!0,assets_dds_available:!X,assets_min50_available:!X,console_verbose:!0,all_objs_selectable:!0,physics_enabled:!0,wireframe_debug:!0})}});b4w.require("viewer_main").init();
