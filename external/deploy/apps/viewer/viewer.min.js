b4w.register("viewer_main",function(Fa,n){function ha(a){return(U?"../../external/deploy/assets/":"../../assets/")+a}function ia(a){if(R){$("#material_warning")[0].style.display="none";a.preventDefault&&a.preventDefault();var b=a.clientX;a=a.clientY;var f=t;f&&g.clear_glow_anim(f);(t=b=g.pick_object(b,a))?(ja(b),g.apply_glow_anim(b,0.2,3.8,1)):ka();J();F||(b?(F=b,J(),q.enable_object_controls(b),p.create_kb_sensor_manifold(b,"QUIT",p.CT_SHOT,p.KEY_Q,function(a,b,f,c){F=null;J();q.disable_object_controls(a)})):
la())}}function la(){var a=g.get_active_camera();F=a;J();q.enable_camera_controls(1,V.camera_rot_speed);p.create_kb_sensor_manifold(a,"QUIT",p.CT_SHOT,p.KEY_Q,function(a,b,f,c){F=null;J();q.disable_object_controls(a)});var b=p.create_keyboard_sensor(p.KEY_Z),f=p.create_keyboard_sensor(p.KEY_DEC_POINT);p.create_sensor_manifold(a,"ZOOM_TO",p.CT_SHOT,[b,f],function(a){return a[0]||a[1]},function(a,b,f){(b=t)&&W.zoom_object(a,b)})}function J(){if(R){var a="CONTROLLED: "+(F?String(F.name):"NONE")+" | SELECTED: "+
(t?String(t.name):"NONE"),b=t;b&&(b=g.get_type_mesh_object(b))&&(a+=" | TYPE: "+b);b=F;t&&b&&"CAMERA"===b.type&&(a+=" | DISTANCE: "+ma);R.innerHTML=a}}function na(){var a=r.get("last_item_name");if(!a)return null;for(var b=0;b<v.length;b++){var f=v[b];if(N.keyfind("name",a,f.items)[0])return{category:f.name,item:a}}return null}function K(a,b){var f=document.getElementById(a);f.innerHTML="";for(var d=0;d<b.length;d++){var m=document.createElement("option");m.text=m.value=b[d];0===d&&(m.selected=!0);
f.appendChild(m)}$("#"+a).selectmenu();$("#"+a).selectmenu("refresh")}function Ga(a){a=a.target.id;if(-1!=a.indexOf("MANIFEST_ITEM_")){var b=a.split("__SEPARATOR__");a=b[1];b=b[0].split("MANIFEST_ITEM_")[1];S=!1;clearTimeout(oa);X({category:a,item:b},!0,!1)}}function X(a,b,f){for(var d=0;d<C.children.length;d++)C.children[d].style.visibility="hidden";O={load_file:Ha,animated_objects:[]};V=null;s=[];y=0;P=[];if(a){var d=N.keyfind("name",a.category,v)[0],d=N.keyfind("name",a.item,d.items)[0],m;for(m in d)O[m]=
d[m];r.set("last_item_name",a.item)}else r.set("last_item_name","");b&&(D.clear_render_callback(),Y.cleanup());D.get_canvas_elem().removeEventListener("mousedown",ia);u.clear_errors_warnings();a=O.name||"Logo";b=O.load_file;m=document.getElementById("current_file");m.innerHTML=a;m.setAttribute("title",a+" ("+b+")");Y.load(ha(b),Ia,Ja,f)}function Ia(a){D.get_canvas_elem().addEventListener("mousedown",ia,!1);g.set_glow_color([1,0.4,0.05]);t=null;Ka(O);la();q.enable_debug_controls();pa()&&La.enable_mixer_controls(g.get_active_camera());
D.set_render_callback(Ma);S&&(oa=setTimeout(qa,Na));a=p.create_elapsed_sensor();p.create_sensor_manifold(g.get_active_camera(),"TO_OBJ",p.CT_CONTINUOUS,[a],null,function(a,f,d){if(1==d&&t){if(d=t)f=Oa,Pa.get_object_center(d,!0,f),a=W.get_eye(a),ma=Qa.dist(f,a).toFixed(3);J()}})}function qa(){var a=na();if(a){var b=a.item,a=N.keyfind("name",a.category,v)[0],b=N.keyfind("name",b,a.items)[0],b=a.items.indexOf(b);if(b=a.items[b+1])a={category:a.name,item:b.name};else if(a=v.indexOf(a),a=v[a+1])a={category:a.name,
item:a.items[0].name};else{S=!1;return}}else a=v[0],b=a.items[0],a={category:a.name,item:b.name};X(a,!0,!0)}function Ja(a,b){document.getElementById("loading_progress").innerHTML=a+"% ("+Math.round(10*b/1E3)/10+"s)";var f=u.get_error_quantity(),d=u.get_warning_quantity();if(Y.is_primary_loaded()){var m=u.num_vertices(),c=u.num_triangles(),e=u.num_draw_calls();document.getElementById("info_right_up").innerHTML=m+" verts, "+c+" tris, "+e+" draw calls";var m=u.geometry_stats(),c=u.num_textures(),e=u.num_render_targets(),
g=Math.round(10*(m.ibo_memory+m.vbo_memory))/10,h=Math.round(10*c.memory)/10,k=Math.round(10*e.memory)/10,l=Math.round(10*(g+h+k))/10;document.getElementById("info_right_down").innerHTML="Geometry: "+g+" MiB ("+m.ibo_number+"+"+m.vbo_number+")<br>Textures: "+h+" MiB ("+c.number+")<br>RTs: "+k+" MiB ("+e.number+")<br><br>Total: "+l+" MiB";m=u.get_error_quantity();(c=u.get_warning_quantity())||m?C.setAttribute("title","warnings:"+c+"\nerrors:"+m):C.setAttribute("title","Loaded OK");d||f||(C.children[2].style.visibility=
"visible")}d&&!f&&(C.children[1].style.visibility="visible");f&&(C.children[1].style.visibility="hidden",C.children[0].style.visibility="visible")}function Ka(a){for(var b=g.get_active(),f=g.get_scenes(),d=0;d<f.length;d++){var m=f[d];if(m!==b){var c=ra(m,a);sa(m,c)}}c=ra(b,a);sa(b,c);ja=function(a){var b=H.get_materials_names(a);K("material_name",b);ta(a,b[0]);a=H.get_water_material_params(a,b[0]);b="shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" ");
a?(k(b,"enable"),g.get_water_mat_params(a),a.shallow_water_col&&E("shallow_water_col",a.shallow_water_col),a.shallow_water_col_fac&&e("shallow_water_col_fac",a.shallow_water_col_fac),a.shore_water_col&&E("shore_water_col",a.shore_water_col),a.shore_water_col_fac&&e("shore_water_col_fac",a.shore_water_col_fac),a.water_fog_color&&(E("water_fog_color",a.water_fog_color),e("water_fog_density",a.water_fog_density)),e("absorb_factor",a.absorb_factor),e("sss_strength",a.sss_strength),e("sss_width",a.sss_width),
e("foam_factor",a.foam_factor),e("waves_height",a.waves_height),e("waves_length",a.waves_length),e("dst_noise_scale0",a.dst_noise_scale0),e("dst_noise_scale1",a.dst_noise_scale1),e("dst_noise_freq0",a.dst_noise_freq0),e("dst_noise_freq1",a.dst_noise_freq1),e("dir_min_shore_fac",a.dir_min_shore_fac),e("dir_freq",a.dir_freq),e("dir_noise_scale",a.dir_noise_scale),e("dir_noise_freq",a.dir_noise_freq),e("dir_min_noise_fac",a.dir_min_noise_fac),e("dst_min_fac",a.dst_min_fac),e("waves_hor_fac",a.waves_hor_fac)):
k(b,"disable")};Ra();a=w.get_lights_names();K("light_name",a);ua(a[0]);Sa();Ta();Ua();Va();Wa();Xa();Ya();Za();$a();ab();bb();ka();$("#wireframe_mode").val("WM_NONE");$("#wireframe_mode").selectmenu("refresh",!0);$("#wireframe_edge_color div").css("backgroundColor","#333");a=new Date(document.getElementById("date").value);Z({date:a});V=c}function ra(a,b){function f(a,b){for(var d in a)b[d]=a[d];return b}var d=b.scene_settings;if(d&&d[a]){var c={};f(b,c);f(d[a],c);delete c.scene_settings;return c}return b}
function sa(a,b){g.set_active(a);var f=g.get_active_camera();b.camera_target&&cb.append_follow(f,b.camera_target);var d=b.h_angle,c=b.v_angle;0!==d&&!d||0!==c&&!c||W.set_eye_params(f,d,c);y=va;f=[];d=g.get_all_objects();for(c=0;c<d.length;c++){var e=d[c];if(h.is_animated(e)){var l=h.get_first_armature_object(e);l&&h.is_animated(l)&&P.push(l,e);s.push(e);f.push(g.get_object_name(e))}}d="anim_active_object anim_slot animation anim_cyclic anim_frame_range anim_frame_current anim_play anim_stop get_max_bones".split(" ");
s.length?(k(d,"enable"),K("anim_active_object",f),L({anim_active_object:g.get_object_name(s[va])})):k(d,"disable")}function Ma(a,b){g.get_active_camera();var f=M(s,y)[0];if(f){var d=parseInt(document.getElementById("anim_slot").value),c=Math.round(h.get_frame(f,d));parseInt($("#anim_frame_current").val())!==c&&e("anim_frame_current",c);c=document.getElementById("anim_status");h.is_play(f,d)?c.innerHTML="PLAYING":c.innerHTML="STOPPED"}}function M(a,b){var f=[];if(a[b]){f.push(a[b]);for(var d=0;d<P.length;d+=
2){var c=P[d+1];P[d]==a[b]&&f.push(c)}}return f}function db(a){r.set("quality",a.quality);setTimeout(function(){window.location.reload()},100)}function eb(){r.cleanup();window.location.reload()}function fb(){D.pause()}function gb(){D.resume()}function pa(){return"true"===r.get("sfx_mix_mode")?!0:!1}function hb(a){r.set("show_hud_debug_info",a.show_hud_debug_info);window.location.reload()}function ib(a){r.set("sfx_mix_mode",a.sfx_mix_mode);window.location.reload()}function jb(a){r.set("anaglyph_use",
a.anaglyph_use);window.location.reload()}function kb(){S=!0;qa()}function lb(a){var b=a.target.innerWidth;a=a.target.innerHeight;var f=document.getElementById("controls_container").offsetWidth,b=b-f;D.resize(b,a);document.getElementById("info_left_up").innerHTML=b+"x"+a}function mb(){var a=M(s,y),b=document.getElementById("animation").value,f=parseInt(document.getElementById("anim_slot").value);"None"!==b&&h.play(a[0],null,f);for(var d=1;d<a.length;d++){var c=a[d],f=h.get_slot_num_by_anim(c,b);-1<
f&&h.play(c,null,f)}}function nb(){var a=M(s,y),b=document.getElementById("animation").value,f=parseInt(document.getElementById("anim_slot").value);h.stop(a[0],f);for(var d=1;d<a.length;d++){var c=a[d],f=h.get_slot_num_by_anim(c,b);-1<f&&h.stop(c,f)}}function ob(){D.pause();var a=pb.determine_max_bones();document.getElementById("max_bones").innerHTML=a.max_bones;document.getElementById("max_bones_no_blending").innerHTML=a.max_bones_no_blending;D.resume()}function L(a){if("anim_active_object"in a)for(var b=
0;b<s.length;b++){var f=s[b];if(g.get_object_name(f)==a.anim_active_object){y=b;var d=h.get_anim_names(f);if(d.length){a=[];for(b=0;b<d.length&&8>b;b++)a.push(b);d.push("None");K("animation",d);K("anim_slot",a);d=parseInt(document.getElementById("anim_slot").value);wa(f,d);aa(f,d)}else K("animation",["N/A"]);ba(f);return}}if("anim_slot"in a){f=s[y];if(!f)return;d=a.anim_slot;wa(f,d);aa(f,d);ba(f)}if("animation"in a){var c=M(s,y),d=parseInt(document.getElementById("anim_slot").value),e=h.get_current_anim_name(c[0],
d);"None"==a.animation?h.remove_slot_animation(c[0],d):(h.apply(c[0],a.animation,d),h.play(c[0],null,d));aa(c[0],d);for(b=1;b<c.length;b++)f=c[b],d=h.get_slot_num_by_anim(f,e),"None"==a.animation?null!==d&&h.remove_slot_animation(f,d):(null===d?d=h.apply_to_first_empty_slot(f,a.animation):h.apply(f,a.animation,d),h.play(f,null,d));ba(c[0])}if("anim_cyclic"in a)for(c=M(s,y),e=document.getElementById("animation").value,b=0;b<c.length;b++)f=c[b],d=h.get_slot_num_by_anim(f,e),h.cyclic(f,a.anim_cyclic,
d);"anim_frame_current"in a&&(c=M(s,y),f=c[0],h.is_play(f)||(a=parseInt(a.anim_frame_current),d=parseInt(document.getElementById("anim_slot").value),h.set_frame(f,a,d)))}function wa(a,b){for(var f=h.get_anim_name(a,b),f=f||"None",d=$("#animation"),c=d.children(),e=0;e<c.length;e++){var g=c[e];if(g.value==f){g.selected=!0;d.selectmenu();d.selectmenu("refresh");break}}}function aa(a,b){var c=h.is_cyclic(a,b);e("anim_cyclic",Number(c));var d=document.getElementById("anim_frame_range");(c=h.get_frame_range(a,
b))?(d.innerHTML=c[0]+" - "+c[1],d=document.getElementById("anim_frame_current"),d.min=""+c[0],d.max=""+c[1]):d.innerHTML="N/A"}function ba(a){for(var b=$("#anim_slot-listbox").find("a"),c=parseInt(document.getElementById("anim_slot").value),d=h.get_anim_type(a,c),c=0;c<b.length;c++){d=h.get_anim_type(a,c);switch(d){case h.OBJ_ANIM_TYPE_ARMATURE:d="ARMATURE";break;case h.OBJ_ANIM_TYPE_SKELETAL:d="SKELETAL";break;case h.OBJ_ANIM_TYPE_OBJECT:d="OBJECT";break;case h.OBJ_ANIM_TYPE_PARTICLES:d="PARTICLES";
break;case h.OBJ_ANIM_TYPE_VERTEX:d="VERTEX";break;default:d="NONE"}b.eq(c);d=c+" ("+d+")";$("#anim_slot").children().eq(c).text(d)}$("#anim_slot").selectmenu();$("#anim_slot").selectmenu("refresh")}function Ta(){var a=g.get_ssao_params(),b="ssao_quality ssao_radius_increase ssao_dithering_amount ssao_gauss_center ssao_gauss_width_square ssao_gauss_width_left_square ssao_influence ssao_dist_factor ssao_only ssao_white".split(" ");if(a){k(b,"enable");for(var c=document.getElementById("ssao_quality"),
b=a.ssao_quality,c=c.options,d=0;d<c.length;d++){var m=c[d];m.selected=m.value==b?!0:!1}$("#ssao_quality").selectmenu("refresh");e("ssao_radius_increase",a.radius_increase);e("ssao_dithering_amount",1E3*a.dithering_amount);e("ssao_gauss_center",a.gauss_center);e("ssao_gauss_width_square",Math.sqrt(a.gauss_width_square));e("ssao_gauss_width_left_square",Math.sqrt(a.gauss_width_left_square));e("ssao_influence",a.influence);e("ssao_dist_factor",a.dist_factor);b=Number(a.ssao_only);document.getElementById("ssao_only").options[b].selected=
!0;$("#ssao_only").slider("refresh");b=Number(a.ssao_white);document.getElementById("ssao_white").options[b].selected=!0;$("#ssao_white").slider("refresh")}else k(b,"disable")}function z(a){g.get_ssao_params();var b={};"ssao_quality"in a&&(b.ssao_quality=xa(document.getElementById("ssao_quality")));"ssao_radius_increase"in a&&(b.ssao_radius_increase=a.ssao_radius_increase);"ssao_dithering_amount"in a&&(b.ssao_dithering_amount=a.ssao_dithering_amount/1E3);"ssao_gauss_center"in a&&(b.ssao_gauss_center=
a.ssao_gauss_center);"ssao_gauss_width_square"in a&&(b.ssao_gauss_width_square=a.ssao_gauss_width_square*a.ssao_gauss_width_square);"ssao_gauss_width_left_square"in a&&(b.ssao_gauss_width_left_square=a.ssao_gauss_width_left_square*a.ssao_gauss_width_left_square);"ssao_influence"in a&&(b.ssao_influence=a.ssao_influence);"ssao_dist_factor"in a&&(b.ssao_dist_factor=a.ssao_dist_factor);"ssao_only"in a&&(b.ssao_only=Number(a.ssao_only));"ssao_white"in a&&(b.ssao_white=Number(a.ssao_white));g.set_ssao_params(b)}
function Xa(){var a=g.get_color_correction_params(),b=["brightness","contrast","exposure","saturation"];a?(k(b,"enable"),e("brightness",a.brightness),e("contrast",a.contrast),e("exposure",a.exposure),e("saturation",a.saturation)):k(b,"disable")}function T(a){var b=g.get_color_correction_params();b&&(b={},"brightness"in a&&(b.brightness=parseFloat(a.brightness)),"contrast"in a&&(b.contrast=parseFloat(a.contrast)),"exposure"in a&&(b.exposure=parseFloat(a.exposure)),"saturation"in a&&(b.saturation=parseFloat(a.saturation)),
g.set_color_correction_params(b))}function xa(a){a=a.options;for(var b=0;b<a.length;b++){var c=a[b];if(c.selected)return c.value}}function Ua(){var a=g.get_fog_color_density();0.2<a[3]?e("fog_density",a[3]):e("fog_density1000",1E3*a[3]);E("fog_color",a)}function ca(a){var b=g.get_fog_color_density();"fog_density"in a&&(b[3]=a.fog_density);"fog_density1000"in a&&(b[3]=a.fog_density1000/1E3);"fog_color"in a&&(b[0]=a.fog_color[0],b[1]=a.fog_color[1],b[2]=a.fog_color[2]);g.set_fog_color_density(b)}function Sa(){var a=
g.get_shadow_params(),b="optimize_shadow_volume csm_near csm_far shadow_visibility_falloff blur_depth_size_mult blur_depth_edge_size blur_depth_diff_threshold csm_lambda".split(" ");if(!a)return k(b,"disable"),null;k(b,"enable");b=Number("true"===a.optimize_shadow_volume);document.getElementById("optimize_shadow_volume").options[b].selected=!0;$("#optimize_shadow_volume").slider("refresh");e("shadow_visibility_falloff",a.shadow_visibility_falloff);e("blur_depth_size_mult",a.blur_depth_size_mult);
e("blur_depth_edge_size",a.blur_depth_edge_size);e("blur_depth_diff_threshold",a.blur_depth_diff_threshold);ya(a);e("csm_near",a.csm_near);e("csm_far",a.csm_far);e("csm_lambda",a.csm_lambda)}function G(a){var b={};"optimize_shadow_volume"in a&&(b.optimize_shadow_volume=Boolean(a.optimize_shadow_volume));"csm_near"in a&&(b.csm_near=a.csm_near);"csm_far"in a&&(b.csm_far=a.csm_far);"csm_lambda"in a&&(b.csm_lambda=a.csm_lambda);"shadow_visibility_falloff"in a&&(b.shadow_visibility_falloff=a.shadow_visibility_falloff);
"blur_depth_size_mult"in a&&(b.blur_depth_size_mult=a.blur_depth_size_mult);"blur_depth_edge_size"in a&&(b.blur_depth_edge_size=a.blur_depth_edge_size);"blur_depth_diff_threshold"in a&&(b.blur_depth_diff_threshold=a.blur_depth_diff_threshold);g.set_shadow_params(b);ya(g.get_shadow_params())}function ya(a){document.getElementById("csm_num").innerHTML=" "+a.csm_num;a=a.csm_borders;var b=document.getElementById("csm_borders");b.innerHTML="(";for(var c=0;c<a.length;c++)0<c&&(b.innerHTML+=" __ "),b.innerHTML+=
Math.round(10*a[c])/10;b.innerHTML+=")"}function Ra(){var a=g.get_environment_colors();e("environment_energy",a[0]);E("horizon_color",a[1]);E("zenith_color",a[2])}function da(a){"environment_energy"in a&&g.set_environment_colors(a.environment_energy,null,null);"horizon_color"in a&&g.set_environment_colors(null,a.horizon_color,null);"zenith_color"in a&&g.set_environment_colors(null,null,a.zenith_color)}function za(a){var b={};"string"==typeof a.wireframe_mode&&(b.wireframe_mode=xa(document.getElementById("wireframe_mode")));
"object"==typeof a.wireframe_edge_color&&(b.wireframe_edge_color=a.wireframe_edge_color);u.set_debug_params(b)}function $a(){var a=g.get_sky_params(),b="sky_color rayleigh_brightness mie_brightness spot_brightness scatter_strength rayleigh_strength mie_strength rayleigh_collection_power mie_collection_power mie_distribution".split(" ");if(!a)return k(b,"disable"),null;k(b,"enable");E("sky_color",a.color);e("rayleigh_brightness",a.rayleigh_brightness);e("mie_brightness",a.mie_brightness);e("spot_brightness",
a.spot_brightness);e("scatter_strength",a.scatter_strength);e("rayleigh_strength",a.rayleigh_strength);e("mie_strength",a.mie_strength);e("rayleigh_collection_power",a.rayleigh_collection_power);e("mie_collection_power",a.mie_collection_power);e("mie_distribution",a.mie_distribution)}function A(a){var b={};"sky_color"in a&&(b.color=a.sky_color);"rayleigh_brightness"in a&&(b.rayleigh_brightness=a.rayleigh_brightness);"mie_brightness"in a&&(b.mie_brightness=a.mie_brightness);"spot_brightness"in a&&
(b.spot_brightness=a.spot_brightness);"scatter_strength"in a&&(b.scatter_strength=a.scatter_strength);"rayleigh_strength"in a&&(b.rayleigh_strength=a.rayleigh_strength);"mie_strength"in a&&(b.mie_strength=a.mie_strength);"rayleigh_collection_power"in a&&(b.rayleigh_collection_power=a.rayleigh_collection_power);"mie_collection_power"in a&&(b.mie_collection_power=a.mie_collection_power);"mie_distribution"in a&&(b.mie_distribution=a.mie_distribution);g.set_sky_params(b)}function ta(a,b){var c=H.get_material_extended_params(a,
b),d="material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" ");if(!c)return k(d,"disable"),$("#material_warning")[0].style.display="block",null;var m=H.get_diffuse_color(a,b);m.pop();c.diffuse_color=m;k(d,"enable");E("material_diffuse_color",c.diffuse_color);e("material_reflectivity",c.reflect_factor);e("material_fresnel",c.fresnel);e("material_fresnel_factor",c.fresnel_factor);e("material_parallax_scale",
c.parallax_scale);e("material_parallax_steps",c.parallax_steps)}function I(a){var b=t;"material_name"in a&&ta(b,a.material_name);if("material_diffuse_color"in a){var c=a.material_diffuse_color.slice();c.push(1);H.set_diffuse_color(b,$("#material_name").val(),c)}c={};"material_reflectivity"in a&&(c.material_reflectivity=a.material_reflectivity);"material_fresnel"in a&&(c.material_fresnel=a.material_fresnel);"material_fresnel_factor"in a&&(c.material_fresnel_factor=a.material_fresnel_factor);"material_parallax_scale"in
a&&(c.material_parallax_scale=a.material_parallax_scale);"material_parallax_steps"in a&&(c.material_parallax_steps=a.material_parallax_steps);H.set_material_extended_params(b,$("#material_name").val(),c);g.update_scene_materials_params()}function l(a){var b=t,c="waves_height waves_length sss_strength sss_width dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac".split(" ");if(!b)return null;
var d={},e=$("#water_dynamic").val(),h=$("#shore_smoothing").val();Boolean(Number(e))?k(c,"enable"):k(c,"disable");Boolean(Number(h))?k(["absorb_factor"],"enable"):k(["absorb_factor"],"disable");"shore_smoothing"in a&&(d.shore_smoothing=a.shore_smoothing);"absorb_factor"in a&&(d.absorb_factor=a.absorb_factor);"water_fog_color"in a&&(d.water_fog_color=a.water_fog_color);"water_fog_density"in a&&(d.water_fog_density=a.water_fog_density);"shallow_water_col"in a&&(d.shallow_water_col=a.shallow_water_col);
"shallow_water_col_fac"in a&&(d.shallow_water_col_fac=a.shallow_water_col_fac);"shore_water_col"in a&&(d.shore_water_col=a.shore_water_col);"shore_water_col_fac"in a&&(d.shore_water_col_fac=a.shore_water_col_fac);"foam_factor"in a&&(d.foam_factor=a.foam_factor);"sss_strength"in a&&(d.sss_strength=a.sss_strength);"sss_width"in a&&(d.sss_width=a.sss_width);"water_dynamic"in a&&(d.water_dynamic=a.water_dynamic);"waves_height"in a&&(d.waves_height=a.waves_height);"waves_length"in a&&(d.waves_length=a.waves_length);
"dst_noise_scale0"in a&&(d.dst_noise_scale0=a.dst_noise_scale0);"dst_noise_scale1"in a&&(d.dst_noise_scale1=a.dst_noise_scale1);"dst_noise_freq0"in a&&(d.dst_noise_freq0=a.dst_noise_freq0);"dst_noise_freq1"in a&&(d.dst_noise_freq1=a.dst_noise_freq1);"dir_min_shore_fac"in a&&(d.dir_min_shore_fac=a.dir_min_shore_fac);"dir_freq"in a&&(d.dir_freq=a.dir_freq);"dir_noise_scale"in a&&(d.dir_noise_scale=a.dir_noise_scale);"dir_noise_freq"in a&&(d.dir_noise_freq=a.dir_noise_freq);"dir_min_noise_fac"in a&&
(d.dir_min_noise_fac=a.dir_min_noise_fac);"dst_min_fac"in a&&(d.dst_min_fac=a.dst_min_fac);"waves_hor_fac"in a&&(d.waves_hor_fac=a.waves_hor_fac);if(!H.set_water_material_params(b,$("#material_name").val(),d))return null;g.update_scene_materials_params();g.set_water_params(d)}function ua(a){a=w.get_light_params(a);E("light_color",a.light_color);e("light_energy",a.light_energy)}function ea(a){"light_name"in a&&ua(a.light_name);var b={};"light_color"in a&&(b.light_color=a.light_color);"light_energy"in
a&&(b.light_energy=parseFloat(a.light_energy));w.set_light_params($("#light_name").val(),b)}function Za(){var a=w.get_sun_params(),b=["sun_horizontal_position","sun_vertical_position"];if(!a)return k(b,"disable"),null;e("sun_horizontal_position",a.hor_position);e("sun_vertical_position",a.vert_position)}function Aa(a){var b={};"sun_horizontal_position"in a&&(b.hor_position=parseFloat(a.sun_horizontal_position),b.vert_position=parseFloat(document.getElementById("sun_vertical_position").value));"sun_vertical_position"in
a&&(b.hor_position=parseFloat(document.getElementById("sun_horizontal_position").value),b.vert_position=parseFloat(a.sun_vertical_position));w.set_sun_params(b)}function qb(a){a=parseFloat(a.max_sun_angle);w.set_max_sun_angle(a)}function Z(a){"day_time"in a&&w.set_day_time(a.day_time);"date"in a&&w.set_date(new Date(a.date))}function rb(){var a=0,b=parseFloat(document.getElementById("day_time").value),c=p.create_elapsed_sensor(),d=w.get_lamps("SUN")[0];p.create_sensor_manifold(d,"ELAPSED",p.CT_CONTINUOUS,
[c],function(a){return a[0]},function(c,d,f){1==f&&(a=document.getElementById("sun_time_multiplier").value,c=p.get_sensor_value(c,d,0),b+=c*a/3600,24<b&&(b-=Math.floor(b)),e("day_time",b))})}function bb(){var a="run_sun stop_sun date sun_time_multiplier day_time max_sun_angle".split(" ");if(!w.get_lamps("SUN")[0])return k(a,"disable"),null}function ka(){k("material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" "),
"disable");k("shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" "),"disable")}function sb(){var a=w.get_lamps("SUN")[0];p.check_sensor_manifolds(a)&&p.remove_sensor_manifold(a,
"ELAPSED")}function Va(){var a=g.get_dof_params(),b=["dof_distance","dof_front","dof_rear","dof_power","dof_on"];a?(e("dof_distance",a.dof_distance),e("dof_front",a.dof_front),e("dof_rear",a.dof_rear),e("dof_power",a.dof_power),k(b,"enable"),a=0<a.dof_distance?0:1,document.getElementById("dof_on").options[a].selected=!0,$("#dof_on").slider("refresh")):k(b,"disable")}function Q(a){var b={};"dof_distance"in a&&Number($("#dof_on").val())&&(b.dof_distance=a.dof_distance);"dof_front"in a&&(b.dof_front=
a.dof_front);"dof_rear"in a&&(b.dof_rear=a.dof_rear);"dof_power"in a&&(b.dof_power=a.dof_power);"dof_on"in a&&(b.dof_on=Boolean($("#dof_on").val()),b.dof_distance=Number(a.dof_on)?parseFloat($("#dof_distance").val()):0);g.set_dof_params(b)}function Wa(){var a=g.get_god_rays_params(),b=["god_rays_intensity","god_rays_max_ray_length","god_rays_steps"];a?(k(b,"enable"),a&&(e("god_rays_intensity",a.god_rays_intensity),e("god_rays_max_ray_length",a.god_rays_max_ray_length),e("god_rays_steps",a.god_rays_steps))):
k(b,"disable")}function fa(a){var b={};"god_rays_intensity"in a&&(b.god_rays_intensity=a.god_rays_intensity);"god_rays_max_ray_length"in a&&(b.god_rays_max_ray_length=a.god_rays_max_ray_length);"god_rays_steps"in a&&(b.god_rays_steps=a.god_rays_steps);g.set_god_rays_params(b)}function ab(){var a=g.get_bloom_params(),b=["bloom_key","bloom_blur","bloom_edge_lum"];a?(k(b,"enable"),a&&(e("bloom_key",a.bloom_key),e("bloom_blur",a.bloom_blur),e("bloom_edge_lum",a.bloom_edge_lum))):k(b,"disable")}function ga(a){var b=
{};"bloom_key"in a&&(b.bloom_key=a.bloom_key);"bloom_blur"in a&&(b.bloom_blur=a.bloom_blur);"bloom_edge_lum"in a&&(b.bloom_edge_lum=a.bloom_edge_lum);g.set_bloom_params(b)}function E(a,b){b=tb(b);var c={r:Math.round(255*b[0]),g:Math.round(255*b[1]),b:Math.round(255*b[2])};$("#"+a).ColorPickerSetColor(c);$("#"+a+" div").css("backgroundColor","#"+function(a){var b=[a.r.toString(16),a.g.toString(16),a.b.toString(16)];$.each(b,function(a,c){1==c.length&&(b[a]="0"+c)});return b.join("")}(c))}function tb(a){return[Math.pow(a[0],
1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]}function Ya(){var a=g.get_wind_params(),b=["wind_dir","wind_strength"];a?(e("wind_dir",a.wind_dir),e("wind_strength",a.wind_strength)):k(b,"disable")}function Ba(a){var b={};"wind_dir"in a&&(b.wind_dir=a.wind_dir);"wind_strength"in a&&(b.wind_strength=a.wind_strength);g.set_wind_params(b)}function e(a,b){$("#"+a).val(b);$("#"+a).slider("refresh")}function c(a,b,c){$("#"+b).bind("change",function(d){var e={};switch(c){case "string":e[b]=d.target.value;
break;case "number":e[b]=parseFloat(d.target.value);break;case "bool":e[b]=Boolean(Number(d.target.value));break;default:return console.log("wrong value type"),null}a(e)})}function B(a,b){$("#"+b).ColorPicker({onChange:function(c,d,e){$("#"+b+" div").css("backgroundColor","#"+d);c={};d=[];d[0]=e.r/255;d[1]=e.g/255;d[2]=e.b/255;e=d;e=[Math.pow(e[0],2.2),Math.pow(e[1],2.2),Math.pow(e[2],2.2)];c[b]=e;a(c)}})}function ub(){vb.auto_rotate(wb)}function k(a,b){if(!a)return null;for(var c=0;c<a.length;c++){var d=
$("#"+a[c]).parent().parent();"enable"==b?d.removeClass("ui-disabled"):"disable"==b&&d.addClass("ui-disabled")}}var h=n("animation"),q=n("app"),Ca=n("assets"),W=n("camera"),vb=n("camera_anim"),x=n("config"),cb=n("constraints"),p=n("controls"),Y=n("data"),u=n("debug"),w=n("lights"),D=n("main"),La=n("mixer"),H=n("material"),g=n("scenes"),pb=n("shaders"),r=n("storage"),Pa=n("transform"),N=n("util"),Da=n("version"),Qa=n("vec3"),U="DEBUG"===Da.type(),Na=1E3,wb=0.3,Ha="dev/logo.json",Ea;Ea="true"===r.get("show_hud_debug_info")?
!0:!1;var xb={canvas_container_id:"main_canvas_container",callback:function(a,b){if(!b)return console.log("b4w init failure"),null;window.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1};window.ondragstart=function(a){a.preventDefault();a.stopPropagation();return!1};q.enable_controls(a);window.addEventListener("resize",lb,!1);var e=document.createEvent("CustomEvent");e.initEvent("resize",!1,!1);window.dispatchEvent(e);Ca.enqueue([["manifest",Ca.AT_JSON,ha("assets.json")]],
function(a,b,e,f){v=a;R=document.getElementById("info_left_down");C=document.getElementById("lights_cont");document.getElementById("build_date").innerHTML=Da.date();c(db,"quality","string");switch(x.get("quality")){case x.P_ULTRA:var g=0;break;case x.P_HIGH:g=1;break;case x.P_LOW:g=2;break;case x.P_CUSTOM:g=3}document.getElementById("quality").options[g].selected=!0;$("#quality").selectmenu("refresh");q.set_onclick("reset_memory",eb);q.set_onclick("auto_rotate_cam",ub);q.set_onclick("pause",fb);q.set_onclick("resume",
gb);q.set_onclick("auto_view",kb);a=document.getElementById("manifest");if(v){e="";for(b=0;b<v.length;b++){g=v[b];f=g.name;for(var g=g.items,h="",h=h+"<div data-role='collapsible' data-mini='true' >",h=h+("<h6>"+f+"</h6>"),h=h+"<ul data-role='listview' data-mini='true' data-inset='true' style='margin: -10px 0;'>",k=0;k<g.length;k++)var n=g[k].name,h=h+("<li data-mini='true'><a href='#' class='min_font' id='"+("MANIFEST_ITEM_"+n+"__SEPARATOR__"+f)+"'>"+n+"</a></li>");h+="</ul>";h+="</div>";e+=h}$("#"+
a.id).append(e);$("#"+a.id).trigger("create");a.addEventListener("mouseup",Ga,!1)}else a.innerHTML="<p style='color: red;'>Failed loading scenes list.</p><p>Maybe a syntax error?</p>";c(L,"anim_active_object","string");c(L,"animation","string");c(L,"anim_slot","number");c(L,"anim_cyclic","bool");c(L,"anim_frame_current","number");q.set_onclick("anim_play",mb);q.set_onclick("anim_stop",nb);q.set_onclick("get_max_bones",ob);c(I,"material_name","string");B(I,"material_diffuse_color");c(I,"material_reflectivity",
"number");c(I,"material_fresnel","number");c(I,"material_fresnel_factor","number");c(I,"material_parallax_scale","number");c(I,"material_parallax_steps","number");c(l,"material_name","string");c(l,"shore_smoothing","bool");c(l,"absorb_factor","number");c(l,"sss_strength","number");c(l,"sss_width","number");B(l,"water_fog_color");c(l,"water_fog_density","number");B(l,"shallow_water_col");c(l,"shallow_water_col_fac","number");B(l,"shore_water_col");c(l,"shore_water_col_fac","number");c(l,"foam_factor",
"number");c(l,"water_dynamic","bool");c(l,"waves_height","number");c(l,"waves_length","number");c(l,"dst_noise_scale0","number");c(l,"dst_noise_scale1","number");c(l,"dst_noise_freq0","number");c(l,"dst_noise_freq1","number");c(l,"dir_min_shore_fac","number");c(l,"dir_freq","number");c(l,"dir_noise_scale","number");c(l,"dir_noise_freq","number");c(l,"dir_min_noise_fac","number");c(l,"dst_min_fac","number");c(l,"waves_hor_fac","number");c(da,"environment_energy","string");B(da,"horizon_color");B(da,
"zenith_color");c(ea,"light_name","string");B(ea,"light_color");c(ea,"light_energy","number");B(A,"sky_color");c(A,"rayleigh_brightness","number");c(A,"mie_brightness","number");c(A,"spot_brightness","number");c(A,"scatter_strength","number");c(A,"rayleigh_strength","number");c(A,"mie_strength","number");c(A,"rayleigh_collection_power","number");c(A,"mie_collection_power","number");c(A,"mie_distribution","number");c(Z,"date","string");c(Z,"day_time","number");c(Aa,"sun_horizontal_position","number");
c(Aa,"sun_vertical_position","number");c(qb,"max_sun_angle","number");q.set_onclick("run_sun",rb);q.set_onclick("stop_sun",sb);c(G,"optimize_shadow_volume","bool");c(G,"csm_near","number");c(G,"csm_far","number");c(G,"csm_lambda","number");c(G,"shadow_visibility_falloff","number");c(G,"blur_depth_size_mult","number");c(G,"blur_depth_edge_size","number");c(G,"blur_depth_diff_threshold","number");c(z,"ssao_quality","string");c(z,"ssao_radius_increase","number");c(z,"ssao_dithering_amount","number");
c(z,"ssao_gauss_center","number");c(z,"ssao_gauss_width_square","number");c(z,"ssao_gauss_width_left_square","number");c(z,"ssao_influence","number");c(z,"ssao_dist_factor","number");c(z,"ssao_only","bool");c(z,"ssao_white","bool");c(ca,"fog_density","number");c(ca,"fog_density1000","number");B(ca,"fog_color");c(Q,"dof_distance","number");c(Q,"dof_front","number");c(Q,"dof_rear","number");c(Q,"dof_power","number");c(Q,"dof_on","bool");c(fa,"god_rays_intensity","number");c(fa,"god_rays_max_ray_length",
"number");c(fa,"god_rays_steps","number");c(T,"brightness","number");c(T,"contrast","number");c(T,"exposure","number");c(T,"saturation","number");c(ib,"sfx_mix_mode","bool");a=Number("true"===r.get("sfx_mix_mode"));document.getElementById("sfx_mix_mode").options[a].selected=!0;$("#sfx_mix_mode").slider("refresh");c(jb,"anaglyph_use","bool");a=Number("true"===r.get("anaglyph_use"));document.getElementById("anaglyph_use").options[a].selected=!0;$("#anaglyph_use").slider("refresh");c(Ba,"wind_dir","number");
c(Ba,"wind_strength","number");c(ga,"bloom_key","number");c(ga,"bloom_blur","number");c(ga,"bloom_edge_lum","number");c(za,"wireframe_mode","string");B(za,"wireframe_edge_color","object");c(hb,"show_hud_debug_info","bool");a=Number("true"===r.get("show_hud_debug_info"));document.getElementById("show_hud_debug_info").options[a].selected=!0;$("#show_hud_debug_info").slider("refresh");a=na();X(a,!1,!1)},null)},gl_debug:!0,show_hud_debug_info:Ea,sfx_mix_mode:pa(),show_fps:!0,alpha:!0,assets_dds_available:!U,
assets_min50_available:!U,console_verbose:!0,all_objs_selectable:!0,physics_enabled:!0,wireframe_debug:!0},va=0,Oa=new Float32Array(3),S=!1,oa,v=null,s=[],y=0,P=[],O=null,V=null,R=null,C=null,t=null,ja=function(){},F=null,ma=null;Fa.init=function(){var a=r.get("quality");if(a){switch(a){case "ULTRA":var b=x.P_ULTRA;break;case "HIGH":b=x.P_HIGH;break;case "LOW":b=x.P_LOW;break;case "CUSTOM":b=x.P_CUSTOM}x.set("quality",b)}x.set("anaglyph_use","true"===r.get("anaglyph_use"));q.init(xb)}});b4w.require("viewer_main").init();
