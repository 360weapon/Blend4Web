b4w.module.storage=function(c,b){function y(){if(!localStorage)throw"Local storage is not supported";return localStorage[c.prefix]?JSON.parse(localStorage[c.prefix]):{}}var t=b("__print");c.prefix="b4w";c.init=function(b){c.prefix=b};c.set=function(b,t){var g=y();g[b]=String(t);if(!localStorage)throw"Local storage is not supported";localStorage[c.prefix]=JSON.stringify(g)};c.cleanup=function(){if(!localStorage)throw"Local storage is not supported";delete localStorage[c.prefix]};c.get=function(b){var c=
y();return c[b]?c[b]:""};c.debug=function(){t.log(y())}};if(window.b4w)window.b4w.storage=b4w.require("storage");else throw"Failed to register storage, load b4w first";b4w.module.camera_anim=function(c,b){var y=new Float32Array(3),t=new Float32Array(3),K=new Float32Array(3),N=new Float32Array(4),g=b("controls"),O=b("vec3"),B=b("quat");c.track_to_target=function(b,p,e,a,c,d,u,n){if(b&&p){if(b4w.util.is_vector(p))var r=p;else r=K,b4w.transform.get_object_center(p,!1,r);p=e||1;e=a||2;var w=c||1;c=d||1;t[0]=0;t[1]=-1;t[2]=0;var z=b4w.transform.get_rotation_quat(b);d=b4w.util.quat_to_dir(z,t);a=b4w.camera.get_angles(b);var E=b4w.transform.get_translation(b);O.subtract(r,
E,y);O.normalize(y,y);var A=B.rotationTo(d,y,B.create());B.multiply(A,z,N);b4w.util.correct_cam_quat_up(N,!1);O.subtract(r,E,t);var R=O.length(t)*(1-1/e),r=Math.asin(y[1]);e=Math.acos(-y[2]/Math.abs(Math.cos(r)));0<y[0]&&(e=2*Math.PI-e);var v=e-a[0],G=r-a[1];K[0]=0;K[1]=0;K[2]=-1;e=b4w.transform.get_rotation_quat(b);0>b4w.util.quat_to_dir(e,K)[1]?(G=0<d[1]?r-Math.PI+a[1]:r+Math.PI+a[1],v=0<v?-Math.PI+v:Math.PI+v):Math.abs(v)>Math.PI&&(v=0<v?v-2*Math.PI:v+2*Math.PI);var G=-G,C=0,r=g.create_elapsed_sensor();
d=Math.abs(v/p);p=Math.abs(G/p);var k=d>p?d:p,oa=k+w,la=oa+c,ya=la+w,ma=v,pa=G,S=R;g.create_sensor_manifold(b,"TRACK_TO_TARGET",g.CT_CONTINUOUS,[r],null,function(a,A,b){if(b)if(b=g.get_sensor_value(a,A,0),C+=b,C<k){var e=v/k*b;b*=G/k;A=C/k;A=6*A*(1-A);e*=A;b*=A;ma-=e;pa-=b;b4w.camera.rotate(a,e,b)}else C<oa?(ma&&(b4w.camera.rotate(a,ma,pa),ma=0,n&&n()),A=(C-k)/w,b=-R*b/w,S-=e,b4w.transform.move_local(a,0,6*b*A*(1-A),0)):C<la?S&&(b4w.transform.move_local(a,0,S,0),S=0):C<ya?(A=(C-la)/w,b=R*b/w,b=6*
b*A*(1-A),b4w.transform.move_local(a,0,b,0)):(b4w.transform.set_translation_v(a,E),g.remove_sensor_manifold(a,A),u&&u())})}};c.auto_rotate=function(b,p){function e(a,e,d){1==d&&(e=g.get_sensor_value(a,e,0),b4w.camera.rotate_pivot(a,e*b,0))}function a(){g.remove_sensor_manifold(c,"AUTO_ROTATE");g.remove_sensor_manifold(c,"DISABLE_AUTO_ROTATE");p()}p=p||function(){};var c=b4w.scenes.get_active_camera();if("TARGET"!==c.data.b4w_move_style)throw"wrong camera type";if(g.check_sensor_manifold(c,"AUTO_ROTATE"))a();
else{var d=g.create_mouse_move_sensor("X"),u=g.create_mouse_move_sensor("Y"),n=g.create_mouse_click_sensor(),r=g.create_elapsed_sensor();g.create_sensor_manifold(c,"DISABLE_AUTO_ROTATE",g.CT_LEVEL,[d,u,n],function(a){return a[0]&&a[2]||a[1]&&a[2]},a);g.create_sensor_manifold(c,"AUTO_ROTATE",g.CT_CONTINUOUS,[r],function(a){return a[0]},e)}}};if(window.b4w)window.b4w.camera_anim=b4w.require("camera_anim");else throw"Failed to register camera_anim, load b4w first";b4w.module.mixer=function(c,b){function y(){r=n.length=0;w=t(100);z=new Float32Array(w.length);E=new Float32Array(w.length);var a=d.get_speakers();if(a.length){n.push(K());for(var b=0;b<a.length;b++)n.push(g(a[b]));n.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function t(a){for(var b=new Float32Array(a),e=0,d=0;d<a;d++)b[d]=20*Math.pow(1E3,e),e+=1/(a-1);
return b}function K(){var a=N("MASTER");a.params.push(["VOLUME",d.get_volume(null),0,1,50,!1]);var b=d.get_compressor_params();b&&(a.params.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.params.push(["KNEE",b.knee,0,40,40,!1]),a.params.push(["RATIO",b.ratio,1,20,20,!1]),a.params.push(["ATTACK",b.attack,0,1,1E3,!1]),a.params.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=d.is_muted(null)?1:0;a.solo=-1;return a}function N(a){return{id:a,params:[],active_param:0,mute:-1,solo:-1,speaker:null}}function g(a){var b=
N(ia.get_object_name(a));b.mute=d.is_muted(a)?1:0;b.solo=0;b.speaker=a;return b}function O(a){if(a.speaker){a.params.length=0;a.params.push(["VOLUME",d.get_volume(a.speaker),0,1,50,!1]);var b=d.get_positional_params(a.speaker);b&&(a.params.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.params.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.params.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=d.get_filter_params(a.speaker))a.params.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.params.push(["EQ_Q",b.Q,
0,10,100,!1]),a.params.push(["EQ_GAIN",b.gain,-70,30,100,!1]);u.clamp(a.active_param,0,a.params.length-1)}}function B(a){for(var b=0;b<n.length;b++){var e=n[b];if(e!=a&&1==e.solo)return!0}return!1}function ha(a){for(var b=0;b<n.length;b++){var e=n[b];e!=a&&0==e.mute&&0==e.solo&&d.mute(e.speaker,!1)}}function p(){if(0==n.length)return[0,-1];var a=8*Math.floor(r/8),b=a+7,a=u.clamp(a,0,n.length-1),b=u.clamp(b,0,n.length-1);return[a,b]}var e=b("controls");b("debug");var a=b("hud"),ia=b("scenes"),d=b("sfx"),
u=b("util"),n=[],r=0,w=null,z=null,E=null;c.enable_mixer_controls=function(b){y();var c=e.create_keyboard_sensor(e.KEY_LEFT_SQ_BRACKET),g=e.create_keyboard_sensor(e.KEY_RIGHT_SQ_BRACKET),t=e.create_keyboard_sensor(e.KEY_SEMI_COLON),C=e.create_keyboard_sensor(e.KEY_SINGLE_QUOTE),k=e.create_keyboard_sensor(e.KEY_SHIFT),oa=e.create_timer_sensor(0.15),la=e.create_timer_sensor(0.05),c=[c,g,t,C,k,oa,la],g=function(a,b,k){if(1==k){k=Boolean(e.get_sensor_value(a,b,0))?-1:1;if(n.length){1==k&&r<n.length-1?
r++:-1==k&&0<r&&r--;k=p();for(var d=k[0];d<=k[1];d++)O(n[d])}"SWITCH_STRIP"==b?e.reset_timer_sensor(a,b,5,0.3):e.reset_timer_sensor(a,b,5,0)}else e.reset_timer_sensor(a,b,5,10)};e.create_sensor_manifold(b,"SWITCH_STRIP",e.CT_TRIGGER,c,function(a){return(a[0]||a[1])&&!a[4]},g);e.create_sensor_manifold(b,"SWITCH_STRIP_HOLD",e.CT_SHOT,c,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},g);e.create_sensor_manifold(b,"SWITCH_PARAM",e.CT_SHOT,c,function(a){return(a[0]||a[1])&&a[4]},function(a,b,k){a=Boolean(e.get_sensor_value(a,
b,0))?-1:1;(b=n[r])&&(1==a&&b.active_param<b.params.length-1?b.active_param++:-1==a&&0<b.active_param&&b.active_param--)});g=function(a,b,k){if(1==k){var c=Boolean(e.get_sensor_value(a,b,2))?-1:1,l=n[r];if(l)switch(k=l.params[l.active_param],k[1]=k[5]?k[1]*Math.pow(k[3]/k[2],c/k[4]):k[1]+c*((k[3]-k[2])/k[4]),k[1]=u.clamp(k[1],k[2],k[3]),k[0]){case "VOLUME":"MASTER"!=l.id?d.set_volume(l.speaker,k[1]):d.set_volume(null,k[1]);break;case "DIST_REF":c=d.get_positional_params(l.speaker);c.dist_ref=k[1];
d.set_positional_params(l.speaker,c);break;case "ATTENUATION":c=d.get_positional_params(l.speaker);c.attenuation=k[1];d.set_positional_params(l.speaker,c);break;case "DIST_MAX":c=d.get_positional_params(l.speaker);c.dist_max=k[1];d.set_positional_params(l.speaker,c);break;case "EQ_FREQ":c=d.get_filter_params(l.speaker);c.freq=k[1];d.set_filter_params(l.speaker,c);break;case "EQ_Q":c=d.get_filter_params(l.speaker);c.Q=k[1];d.set_filter_params(l.speaker,c);break;case "EQ_GAIN":c=d.get_filter_params(l.speaker);
c.gain=k[1];d.set_filter_params(l.speaker,c);break;case "THRESHOLD":l=d.get_compressor_params();l.threshold=k[1];d.set_compressor_params(l);break;case "KNEE":l=d.get_compressor_params();l.knee=k[1];d.set_compressor_params(l);break;case "RATIO":l=d.get_compressor_params();l.ratio=k[1];d.set_compressor_params(l);break;case "ATTACK":l=d.get_compressor_params();l.attack=k[1];d.set_compressor_params(l);break;case "RELEASE":l=d.get_compressor_params();l.release=k[1];d.set_compressor_params(l);break;default:throw"Unknown strip param";
}"INC_DEC"==b?e.reset_timer_sensor(a,b,6,0.3):e.reset_timer_sensor(a,b,6,0)}else e.reset_timer_sensor(a,b,6,10)};e.create_sensor_manifold(b,"INC_DEC",e.CT_TRIGGER,c,function(a){return(a[2]||a[3])&&!a[4]},g);e.create_sensor_manifold(b,"INC_DEC_HOLD",e.CT_SHOT,c,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},g);e.create_sensor_manifold(b,"MUTE_SOLO",e.CT_SHOT,c,function(a){return(a[2]||a[3])&&a[4]},function(a,b,k){if(Boolean(e.get_sensor_value(a,b,2)))(a=n[r])&&0<=a.mute&&("MASTER"!=a.id?0==a.mute?(a.mute=
1,d.mute(a.speaker,!0),1==a.solo&&(a.solo=0,B(a)||ha(a))):(a.mute=0,B(a)||d.mute(a.speaker,!1)):0==a.mute?(a.mute=1,d.mute(null,!0)):(a.mute=0,d.mute(null,!1)));else if((a=n[r])&&0<=a.solo)if(0==a.solo)for(a.solo=1,d.mute(a.speaker,!1),1==a.mute&&(a.mute=0),b=0;b<n.length;b++)k=n[b],k!=a&&0==k.mute&&0==k.solo&&d.mute(k.speaker,!0);else a.solo=0,B(a)?d.mute(a.speaker,!0):ha(a)});c=e.create_elapsed_sensor();e.create_sensor_manifold(b,"MIXER_DRAW",e.CT_CONTINUOUS,[c],null,function(){if(n[r])for(var b=
p(),k=b[0];k<=b[1];k++){var c=n[k];a.draw_mixer_strip(c.id,k==r,k%8,c.params,c.active_param,c.mute,c.solo);if(c.speaker&&d.get_filter_params(c.speaker)){d.get_filter_freq_response(c.speaker,w,z,E);for(c=0;c<z.length;c++)z[c]=20*Math.log(z[c])/Math.LN10;a.plot_array("EQ",k%8,z,20,2E4,-10,10)}}});c=e.create_timer_sensor(1);e.create_sensor_manifold(b,"MIXER_UPDATE",e.CT_TRIGGER,[c],null,function(){for(var a=p(),b=a[0];b<=a[1];b++)O(n[b])})}};
if(window.b4w)window.b4w.mixer=b4w.require("mixer");else throw"Failed to register mixer, load b4w first";b4w.module.app=function(c,b){function y(){var a=u.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=u.is_paused(),u.pause()):a||u.resume()},!1)}function t(a){var b=window.onload;window.onload=function(){"function"==typeof b&&b();a()}}function K(a){var b=window.onunload;window.onunload=function(){"function"==typeof b&&b();a()}}function N(a,b){var c=String(a);b&&(c+="/"+String(b));G.innerHTML=c}function g(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,
a);return b}function O(a,b,c){function e(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",e,!1),document.removeEventListener("webkitfullscreenchange",e,!1),document.removeEventListener("mozfullscreenchange",e,!1),document.removeEventListener("MSFullscreenChange",e,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",
e,!1);document.addEventListener("webkitfullscreenchange",e,!1);document.addEventListener("mozfullscreenchange",e,!1);document.addEventListener("MSFullscreenChange",e,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen==a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()}function B(a,b,c,e){var d=document.createElement("div"),p=document.createElement("div"),n=document.createElement("div"),
l=document.createElement("div"),g=document.createElement("div");if(e)for(var r=0;r<e.length;r++){var u=document.getElementById(e[r]);u&&u.parentNode.removeChild(u)}d.style.cssText="z-index:10;width:100%;height:100%;position:absolute;";l.style.cssText="position:absolute;bottom:0;width:100%;height:auto;";g.style.cssText="position:relative;float:right;margin:20px;width:70px;height:70px;background-image:url('data:image/png;base64,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')";
p.style.cssText="position:relative;top:0;width:100%;background-color:#000;opacity:0.6;height:auto;color:#ffd42a;text-align:center;font-size:32px;padding:10px 0;font-family: Arial;";n.style.cssText="position:relative;clear:both;bottom:0;width:100%;background-color:#000;opacity:0.6;height:auto;color:#fff;text-align:center;font-size:20px;padding:10px 0;font-family: Arial;";p.innerHTML=a;n.innerHTML=b+'   <a style="color:#ffd42a;font-size:20px;width:100%;" href="'+c+'">'+c+"</a>";l.appendChild(g);l.appendChild(n);
d.appendChild(p);d.appendChild(l);document.body.appendChild(d)}var ha=b("animation"),p=b("camera"),e=b("config"),a=b("controls"),ia=b("data"),d=b("debug"),u=b("main"),n=b("physics"),r=b("print"),w=b("scenes"),z=b("transform"),E=b("util"),A=b("vec3"),R=null,v=null,G=null,C=new Float32Array(3);c.init=function(a){a=a||{};var b=null,c=function(){},d=!1,p=!1,n=!1,g=!1,l=!1,w=null,z=null,A=!1,C=!0,E;for(E in a)switch(E){case "canvas_container_id":b=a.canvas_container_id;break;case "callback":c=a.callback;
break;case "do_not_use_onload":d=a.do_not_use_onload;break;case "gl_debug":p=a.gl_debug;break;case "show_hud_debug_info":n=a.show_hud_debug_info;break;case "sfx_mix_mode":g=a.sfx_mix_mode;break;case "show_fps":l=a.show_fps;break;case "fps_elem_id":w=a.fps_elem_id;break;case "error_purge_elements":z=a.error_purge_elements;break;case "do_not_report_init_failure":A=a.do_not_report_init_failure;break;case "pause_invisible":C=a.pause_invisible;break;default:e.set(E,a[E])}e.set("show_hud_debug_info",n);
e.set("sfx_mix_mode",g);var ja=n||g||null;a=function(){var a;a=b;var k=A,e=z,d=document.createElement("canvas");d.style.cssText="position: absolute;left:0px; top:0px;";if(ja){var n=document.createElement("canvas");n.style.cssText="z-index: 2; position:absolute; left:0px; top:0px; pointer-events: none;"}else n=null;u.init(d,n)?(v=d,k=document.getElementById(a),k||(r.error('Warning: canvas container "'+a+'" not found, appending to body'),k=document.body),k.appendChild(d),n&&k.appendChild(n),a=k):(k||
B("Browser could not initialize WebGL","For more info visit","http://blend4web.com/troubleshooting",e),a=null);a?(R=a,u.set_check_gl_errors(p),l&&(w?G=document.getElementById(w):(G=document.createElement("div"),G.innerHTML=0,G.style.cssText="             position:absolute;            top: 23px;            right: 20px;            font-size: 45px;            line-height: 50px;            font-weight: bold;            color: #000;            z-index: 1;        ",document.body.appendChild(G)),u.set_fps_callback(N)),
C&&y(),c(v,!0)):c(v,!1)};n=function(){u.pause();ia.cleanup()};d?(a(),n()):(t(a),K(n))};c.get_canvas_container=function(){return R};c.set_onclick=function(a,b){var c=g(a);c.addEventListener("mouseup",function(a){b(c.value)},!1)};c.set_onchange=function(a,b){var c=g(a);c.addEventListener("change",function(a){a=c.checked;b(void 0!=a?a:c.value)},!1)};c.set_onkeypress=function(a,b){var c=g(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};c.enable_camera_controls=function(b,c,e,d){b||
(b=1);c||(c=1);e||(e=1);document.addEventListener("keydown",function(b){b.keyCode==a.KEY_O?O(document.body):b.keyCode==a.KEY_P&&(u.is_paused()?u.resume():u.pause())},!1);var g=w.get_active_camera();switch(p.get_move_style(g)){case p.MS_TARGET_CONTROLS:var r=!d;break;case p.MS_EYE_CONTROLS:r=!1;break;case p.MS_STATIC:return}d=a.create_elapsed_sensor();var t=n.has_simulated_physics(g),l=function(d,e,g){t&&n.apply_force(d,0,0,0);if(1==g){g=a.get_sensor_value(d,e,0);var l=[1800,2100,1800],s=p.get_trans_speed(d);
switch(e){case "FORWARD":t?n.apply_force(d,0,-l[1],0):z.move_local(d,0,-b*s*g,0);break;case "BACKWARD":t?n.apply_force(d,0,l[1],0):z.move_local(d,0,b*s*g,0);break;case "UP":t?n.apply_force(d,0,0,-l[2]):z.move_local(d,0,0,-b*s*g);break;case "DOWN":t?n.apply_force(d,0,0,l[2]):z.move_local(d,0,0,b*s*g);break;case "LEFT":t?n.apply_force(d,-l[0],0,0):z.move_local(d,-b*s*g,0,0);break;case "RIGHT":t?n.apply_force(d,l[0],0,0):z.move_local(d,b*s*g,0,0);break;case "ROT_LEFT":r?p.rotate_pivot(d,2*-c*g,0):p.rotate(d,
2*c*g,0);break;case "ROT_RIGHT":r?p.rotate_pivot(d,2*c*g,0):p.rotate(d,2*-c*g,0);break;case "ROT_UP":r?p.rotate_pivot(d,0,2*-c*g):p.rotate(d,0,2*-c*g);break;case "ROT_DOWN":r?p.rotate_pivot(d,0,2*c*g):p.rotate(d,0,2*c*g);break;case "ROT_LEFT":r?p.rotate_pivot(d,2*-c*g,0):p.rotate(d,2*c*g,0);break;case "ROT_RIGHT":r?p.rotate_pivot(d,2*c*g,0):p.rotate(d,2*-c*g,0)}}},v=a.create_keyboard_sensor(a.KEY_W),y=a.create_keyboard_sensor(a.KEY_S),B=a.create_keyboard_sensor(a.KEY_A),G=a.create_keyboard_sensor(a.KEY_D),
K=a.create_keyboard_sensor(a.KEY_R),ja=a.create_keyboard_sensor(a.KEY_F),N=a.create_keyboard_sensor(a.KEY_UP),T=a.create_keyboard_sensor(a.KEY_DOWN),R=a.create_keyboard_sensor(a.KEY_LEFT),ia=a.create_keyboard_sensor(a.KEY_RIGHT),J=function(a){return a[0]&&(a[1]||a[2])};a.create_sensor_manifold(g,"FORWARD",a.CT_CONTINUOUS,[d,v],null,l);a.create_sensor_manifold(g,"BACKWARD",a.CT_CONTINUOUS,[d,y],null,l);r?(a.create_sensor_manifold(g,"ROT_UP",a.CT_CONTINUOUS,[d,N,K],J,l),a.create_sensor_manifold(g,"ROT_DOWN",
a.CT_CONTINUOUS,[d,T,ja],J,l),a.create_sensor_manifold(g,"ROT_LEFT",a.CT_CONTINUOUS,[d,R,B],J,l),a.create_sensor_manifold(g,"ROT_RIGHT",a.CT_CONTINUOUS,[d,ia,G],J,l)):(a.create_sensor_manifold(g,"UP",a.CT_CONTINUOUS,[d,K],J,l),a.create_sensor_manifold(g,"DOWN",a.CT_CONTINUOUS,[d,ja],J,l),a.create_sensor_manifold(g,"LEFT",a.CT_CONTINUOUS,[d,B],J,l),a.create_sensor_manifold(g,"RIGHT",a.CT_CONTINUOUS,[d,G],J,l),a.create_sensor_manifold(g,"ROT_UP",a.CT_CONTINUOUS,[d,N],J,l),a.create_sensor_manifold(g,
"ROT_DOWN",a.CT_CONTINUOUS,[d,T],J,l),a.create_sensor_manifold(g,"ROT_LEFT",a.CT_CONTINUOUS,[d,R],J,l),a.create_sensor_manifold(g,"ROT_RIGHT",a.CT_CONTINUOUS,[d,ia],J,l));var ba=0,l=a.create_mouse_wheel_sensor();a.create_sensor_manifold(g,"MOUSE_WHEEL",a.CT_LEVEL,[l],null,function(c,d,g){1==g&&(d=a.get_sensor_value(c,d,0),r?(g=p.get_eye(c),p.get_pivot(c,C),c=A.dist(C,g),ba+=0.1*-d*c*b):(c=d*e,d=w.get_active_camera(),p.change_trans_speed(d,c)))});var ka=0,l=a.create_touch_zoom_sensor();a.create_sensor_manifold(g,
"TOUCH_ZOOM",a.CT_LEVEL,[l],null,function(c,d,e,g){1==e&&r&&(d=a.get_sensor_value(c,d,0),e=p.get_eye(c),p.get_pivot(c,C),c=A.dist(C,e),ka+=0.005*-d*c*b)});a.create_sensor_manifold(g,"ZOOM_INTERPOL",a.CT_CONTINUOUS,[d],null,function(b,c,d){1==d&&(0.001<Math.abs(ba)||0.001<Math.abs(ka))&&r&&(d=a.get_sensor_value(b,c,0),c=E.smooth(ba,0,d,0.1),ba-=c,d=E.smooth(ka,0,d,0.15),ka-=d,z.move_local(b,0,c+d,0))});var H=0,ca=0,l=a.create_mouse_move_sensor("X"),v=a.create_mouse_move_sensor("Y"),y=a.create_mouse_click_sensor(),
B=function(b,d,e,k){1==e&&(b=a.get_sensor_value(b,d,1),r&&(d=0.01*c,H+="X"==k?-b*d:0,ca+="Y"==k?-b*d:0))};a.create_sensor_manifold(g,"MOUSE_X",a.CT_LEVEL,[y,l],null,B,"X");a.create_sensor_manifold(g,"MOUSE_Y",a.CT_LEVEL,[y,v],null,B,"Y");var M=0,s=0,l=a.create_touch_move_sensor("X"),v=a.create_touch_move_sensor("Y"),y=function(b,d,e,k){1==e&&r&&(e=0.007*c,b=a.get_sensor_value(b,d,0),M+="X"==k?-b*e:0,s+="Y"==k?-b*e:0)};a.create_sensor_manifold(g,"TOUCH_X",a.CT_LEVEL,[l],null,y,"X");a.create_sensor_manifold(g,
"TOUCH_Y",a.CT_LEVEL,[v],null,y,"Y");a.create_sensor_manifold(g,"ROT_INTERPOL",a.CT_CONTINUOUS,[d],null,function(b,c,d){if(1==d&&(0.001<Math.abs(H)||0.001<Math.abs(ca)||0.001<Math.abs(M)||0.001<Math.abs(s))&&r){var e=a.get_sensor_value(b,c,0);c=E.smooth(H,0,e,0.08);d=E.smooth(ca,0,e,0.08);H-=c;ca-=d;var k=E.smooth(M,0,e,0.12),e=E.smooth(s,0,e,0.12);M-=k;s-=e;p.rotate_pivot(b,c+k,d+e)}});a.create_kb_sensor_manifold(g,"TOGGLE_CAMERA_COLLISION",a.CT_SHOT,a.KEY_C,function(){var a=w.get_active_camera();
ha.is_detect_collisions_used(a)?ha.detect_collisions(a,!1):ha.detect_collisions(a,!0)});a.create_kb_sensor_manifold(g,"DEC_STEREO_DIST",a.CT_SHOT,a.KEY_LEFT_SQ_BRACKET,function(a,b,c){b=p.get_stereo_distance(a);p.set_stereo_distance(a,0.9*b)});a.create_kb_sensor_manifold(g,"INC_STEREO_DIST",a.CT_SHOT,a.KEY_RIGHT_SQ_BRACKET,function(a,b,c){b=p.get_stereo_distance(a);p.set_stereo_distance(a,1.1*b)})};c.enable_object_controls=function(b){var c=n.is_vehicle_chassis(b)||n.is_vehicle_hull(b),d=function(b,
d,e){if(1==e)switch(e=a.get_sensor_value(b,d,0),d){case "FORWARD":c?n.vehicle_throttle(b,1):z.move_local(b,0,0,1*e);break;case "BACKWARD":c?n.vehicle_throttle(b,-1):z.move_local(b,0,0,-1*e);break;case "LEFT":c?n.vehicle_steer(b,-1):z.move_local(b,1*e,0,0);break;case "RIGHT":c?n.vehicle_steer(b,1):z.move_local(b,-1*e,0,0)}else switch(d){case "FORWARD":case "BACKWARD":c&&n.vehicle_throttle(b,0);break;case "LEFT":case "RIGHT":c&&n.vehicle_steer(b,0)}},e=a.create_elapsed_sensor(),g=a.create_keyboard_sensor(a.KEY_W),
p=a.create_keyboard_sensor(a.KEY_S),r=a.create_keyboard_sensor(a.KEY_A),l=a.create_keyboard_sensor(a.KEY_D),t=a.create_keyboard_sensor(a.KEY_UP),u=a.create_keyboard_sensor(a.KEY_DOWN),w=a.create_keyboard_sensor(a.KEY_LEFT),y=a.create_keyboard_sensor(a.KEY_RIGHT),v=function(a){return a[0]&&(a[1]||a[2])};a.create_sensor_manifold(b,"FORWARD",a.CT_CONTINUOUS,[e,g,t],v,d);a.create_sensor_manifold(b,"BACKWARD",a.CT_CONTINUOUS,[e,p,u],v,d);a.create_sensor_manifold(b,"LEFT",a.CT_CONTINUOUS,[e,r,w],v,d);a.create_sensor_manifold(b,
"RIGHT",a.CT_CONTINUOUS,[e,l,y],v,d)};c.disable_object_controls=function(b){a.remove_sensor_manifolds(b)};c.enable_controls=function(b){document.addEventListener("keydown",a.keydown_cb,!1);document.addEventListener("keyup",a.keyup_cb,!1);b.addEventListener("mousewheel",a.mouse_wheel_cb,!1);b.addEventListener("DOMMouseScroll",a.mouse_wheel_cb,!1);document.body.addEventListener("mousedown",a.mouse_down_cb,!1);document.body.addEventListener("mouseup",a.mouse_up_cb,!1);b.addEventListener("mousemove",
a.mouse_move_cb,!1);b.addEventListener("touchstart",a.touch_start_cb,!1);b.addEventListener("touchmove",a.touch_move_cb,!1)};c.disable_controls=function(b){document.removeEventListener("keydown",a.keydown_cb,!1);document.removeEventListener("keyup",a.keyup_cb,!1);b.removeEventListener("mousewheel",a.mouse_wheel_cb,!1);b.removeEventListener("DOMMouseScroll",a.mouse_wheel_cb,!1);document.body.removeEventListener("mousedown",a.mouse_down_cb,!1);document.body.removeEventListener("mouseup",a.mouse_up_cb,
!1);b.removeEventListener("mousemove",a.mouse_move_cb,!1);b.removeEventListener("touchstart",a.touch_start_cb,!1);b.removeEventListener("touchmove",a.touch_move_cb,!1)};c.enable_debug_controls=function(){var b=w.get_active_camera();a.create_kb_sensor_manifold(b,"CAMERA_SHOT",a.CT_SHOT,a.KEY_K,function(){d.make_camera_frustum_shot()});a.create_kb_sensor_manifold(b,"LIGHT_SHOT",a.CT_SHOT,a.KEY_L,function(){d.make_light_frustum_shot()});a.create_kb_sensor_manifold(b,"TELEMETRY",a.CT_SHOT,a.KEY_T,function(){d.plot_telemetry()})};
c.request_fullscreen=O;c.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};c.report_app_error=B;c.get_url_params=function(){var a=location.href.toString();if(-1==a.indexOf("?"))return null;for(var a=a.split("?")[1].split("&"),b={},c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]=d[1]}return b}};
if(window.b4w)window.b4w.app=b4w.require("app");else throw"Failed to register app, load b4w first";b4w.register("viewer_main",function(c,b){function y(f){return(Aa?"../../external/deploy/assets/":"../../assets/")+f}function t(){if(Y){var f=q.get_object_by_name(Y);if(f)return f}return null}function K(f){if(va){f.preventDefault&&f.preventDefault();var a=f.clientX;f=f.clientY;var b=t();b&&q.clear_glow_anim(b);Y=a=q.pick_object(a,f);if(a.length){La(a);var c=t();c&&q.apply_glow_anim(c,0.2,3.8,1)}else Ma();g();da||(a.length?c&&(da=c.name,g(),I.enable_object_controls(c),D.create_kb_sensor_manifold(c,
"QUIT",D.CT_SHOT,D.KEY_Q,function(f,a,b,wa){da=null;g();I.disable_object_controls(f)})):N())}}function N(){var f=q.get_active_camera();da=f.name;g();I.enable_camera_controls(1,Ba.camera_rot_speed);D.create_kb_sensor_manifold(f,"QUIT",D.CT_SHOT,D.KEY_Q,function(f,a,b,wa){da=null;g();I.disable_object_controls(f)});var a=D.create_keyboard_sensor(D.KEY_Z),b=D.create_keyboard_sensor(D.KEY_DEC_POINT);D.create_sensor_manifold(f,"ZOOM_TO",D.CT_SHOT,[a,b],function(f){return f[0]||f[1]},function(f,a,b){(a=
t())&&Ca.zoom_object(f,a)})}function g(){if(va){var f="CONTROLLED: "+(da?String(da):"NONE")+" | SELECTED: "+(Y?String(Y):"NONE"),a;a:{if(da&&(a=q.get_object_by_name(da)))break a;a=!1}Y&&a&&"CAMERA"===a.type&&(f+=" | DISTANCE: "+Na);va.innerHTML=f}}function O(){var f=L.get("last_item_name");if(!f)return null;for(var a=0;a<U.length;a++){var b=U[a];if(qa("name",f,b.items)[0])return{category:b.name,item:f}}return null}function B(f,a){var b=document.getElementById(f);b.innerHTML="";for(var c=0;c<a.length;c++){var d=
document.createElement("option");d.text=d.value=a[c];0===c&&(d.selected=!0);b.appendChild(d)}$("#"+f).selectmenu();$("#"+f).selectmenu("refresh")}function ha(f){f=f.target.id;if(-1!=f.indexOf("MANIFEST_ITEM_")){var a=f.split("__SEPARATOR__");f=a[1];a=a[0].split("MANIFEST_ITEM_")[1];xa=!1;clearTimeout(Oa);p({category:f,item:a},!0,!1)}}function p(f,a,b){for(var c=0;c<ea.children.length;c++)ea.children[c].style.visibility="hidden";ra={load_file:$a,animated_objects:[]};Ba=null;P=[];Z=0;sa=[];if(f){var c=
qa("name",f.category,U)[0],c=qa("name",f.item,c.items)[0],d;for(d in c)ra[d]=c[d];L.set("last_item_name",f.item)}else L.set("last_item_name","");a&&(fa.clear_render_callback(),Da.cleanup());fa.get_canvas_elem().removeEventListener("mousedown",K);Q.clear_errors_warnings();f=ra.name||"Logo";a=ra.load_file;d=document.getElementById("current_file");d.innerHTML=f;d.setAttribute("title",f+" ("+a+")");Da.load(y(a),e,ia,b)}function e(f){fa.get_canvas_elem().addEventListener("mousedown",K,!1);q.set_glow_color([1,
0.4,0.05]);Y=null;d(ra);N();I.enable_debug_controls();v()&&ab.enable_mixer_controls(q.get_active_camera());fa.set_render_callback(r);xa&&(Oa=setTimeout(a,bb));f=D.create_elapsed_sensor();D.create_sensor_manifold(q.get_active_camera(),"TO_OBJ",D.CT_CONTINUOUS,[f],null,function(f,a,b){if(1==b&&Y){if(b=t())a=cb,db.get_object_center(b,!0,a),f=Ca.get_eye(f),Na=eb.dist(a,f).toFixed(3);g()}})}function a(){var f=O();if(f){var a=f.item,f=qa("name",f.category,U)[0],a=qa("name",a,f.items)[0],a=f.items.indexOf(a);
if(a=f.items[a+1])f={category:f.name,item:a.name};else if(f=U.indexOf(f),f=U[f+1])f={category:f.name,item:f.items[0].name};else{xa=!1;return}}else f=U[0],a=f.items[0],f={category:f.name,item:a.name};p(f,!0,!0)}function ia(f,a){document.getElementById("loading_progress").innerHTML=f+"% ("+Math.round(10*a/1E3)/10+"s)";var b=Q.get_error_quantity(),c=Q.get_warning_quantity();if(Da.is_loaded()){var d=Q.num_vertices(),e=Q.num_triangles(),g=Q.num_draw_calls();document.getElementById("info_right_up").innerHTML=
d+" verts, "+e+" tris, "+g+" draw calls";var d=Q.geometry_stats(),e=Q.num_textures(),g=Q.num_render_targets(),h=Math.round(10*(d.ibo_memory+d.vbo_memory))/10,k=Math.round(10*e.memory)/10,l=Math.round(10*g.memory)/10,m=Math.round(10*(h+k+l))/10;document.getElementById("info_right_down").innerHTML="Geometry: "+h+" MiB ("+d.ibo_number+"+"+d.vbo_number+")<br>Textures: "+k+" MiB ("+e.number+")<br>RTs: "+l+" MiB ("+g.number+")<br><br>Total: "+m+" MiB";d=Q.get_error_quantity();(e=Q.get_warning_quantity())||
d?ea.setAttribute("title","warnings:"+e+"\nerrors:"+d):ea.setAttribute("title","Loaded OK");c||b||(ea.children[2].style.visibility="visible")}c&&!b&&(ea.children[1].style.visibility="visible");b&&(ea.children[1].style.visibility="hidden",ea.children[0].style.visibility="visible")}function d(f){for(var a=q.get_active(),b=q.get_scenes(),c=0;c<b.length;c++){var d=b[c];if(d!==a){var e=u(d,f);n(d,e)}}e=u(a,f);n(a,e);La=function(f){f=q.get_object_by_name(f);var a=na.get_materials_names(f);B("material_name",
a);ca(f,a[0]);f=na.get_water_material_params(f,a[0]);a="shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" ");f?(x(a,"enable"),q.get_water_mat_params(f),f.shallow_water_col&&
ga("shallow_water_col",f.shallow_water_col),f.shallow_water_col_fac&&m("shallow_water_col_fac",f.shallow_water_col_fac),f.shore_water_col&&ga("shore_water_col",f.shore_water_col),f.shore_water_col_fac&&m("shore_water_col_fac",f.shore_water_col_fac),f.water_fog_color&&(ga("water_fog_color",f.water_fog_color),m("water_fog_density",f.water_fog_density)),m("absorb_factor",f.absorb_factor),m("sss_strength",f.sss_strength),m("sss_width",f.sss_width),m("foam_factor",f.foam_factor),m("waves_height",f.waves_height),
m("waves_length",f.waves_length),m("dst_noise_scale0",f.dst_noise_scale0),m("dst_noise_scale1",f.dst_noise_scale1),m("dst_noise_freq0",f.dst_noise_freq0),m("dst_noise_freq1",f.dst_noise_freq1),m("dir_min_shore_fac",f.dir_min_shore_fac),m("dir_freq",f.dir_freq),m("dir_noise_scale",f.dir_noise_scale),m("dir_noise_freq",f.dir_noise_freq),m("dir_min_noise_fac",f.dir_min_noise_fac),m("dst_min_fac",f.dst_min_fac),m("waves_hor_fac",f.waves_hor_fac)):x(a,"disable")};Xa();f=V.get_lights_names();B("light_name",
f);Ja(f[0]);Wa();l();Va();fb();gb();Ua();hb();Ya();ka();ib();jb();Ma();$("#wireframe_mode").val("WM_NONE");$("#wireframe_mode").selectmenu("refresh",!0);$("#wireframe_edge_color div").css("backgroundColor","#333");f=new Date(document.getElementById("date").value);Ea({date:f});Ba=e}function u(f,a){function b(f,a){for(var wa in f)a[wa]=f[wa];return a}var c=a.scene_settings;if(c&&c[f]){var d={};b(a,d);b(c[f],d);delete d.scene_settings;return d}return a}function n(f,a){q.set_active(f);var b=q.get_active_camera();
a.camera_target&&kb.append_follow(b,a.camera_target);var c=a.h_angle,d=a.v_angle;0!==c&&!c||0!==d&&!d||Ca.set_eye_params(b,c,d);Z=Pa;for(b=0;b<a.animated_objects.length;b++)if(d=a.animated_objects[b],c=d instanceof Array?q.get_object_by_empty_name(d[0],d[1]):q.get_object_by_name(d)){if(d=F.get_anim_names(c)[lb])F.apply(c,d),F.play(c),F.cyclic(c,!0)}else console.error("Animated object not found: ",d);c=[];d=q.get_appended_objs("ALL");for(b=0;b<d.length;b++){var e=d[b];if(F.is_animated(e)){var g=F.get_first_armature_object(e);
g&&F.is_animated(g)?sa.push(g,e):(P.push(e),c.push(q.get_object_name(e)))}}b="anim_active_object anim_action anim_cyclic anim_frame_range anim_frame_current anim_play anim_stop get_max_bones".split(" ");P.length?(x(b,"enable"),B("anim_active_object",c),S({anim_active_object:q.get_object_name(P[Pa])})):x(b,"disable")}function r(f,a){q.get_active_camera();var b=w(P,Z)[0];if(b){var c=document.getElementById("anim_status");F.is_play(b)?c.innerHTML="PLAYING":c.innerHTML="STOPPED";var d=document.getElementById("anim_frame_range");
if(c=F.get_frame_range(b))d.innerHTML=c[0]+" - "+c[1],d=document.getElementById("anim_frame_current"),d.min=""+c[0],d.max=""+c[1];b=Math.round(F.get_frame(b));parseInt($("#anim_frame_current").val())!==b&&m("anim_frame_current",b)}}function w(f,a){var b=[];if(f[a]){b.push(f[a]);for(var c=0;c<sa.length;c+=2){var d=sa[c+1];sa[c]==f[a]&&b.push(d)}}return b}function z(f){L.set("quality",f.quality);setTimeout(function(){window.location.reload()},100)}function E(){L.cleanup();window.location.reload()}function A(){fa.pause()}
function R(){fa.resume()}function v(){return"true"===L.get("sfx_mix_mode")?!0:!1}function G(f){L.set("show_hud_debug_info","on"===f.show_hud_debug_info);window.location.reload()}function C(f){L.set("sfx_mix_mode","on"===f.sfx_mix_mode);window.location.reload()}function k(f){L.set("anaglyph_use","on"===f.anaglyph_use);window.location.reload()}function oa(){xa=!0;a()}function la(f){var a=f.target.innerWidth;f=f.target.innerHeight;var b=document.getElementById("controls_container").offsetWidth,a=a-b;
fa.resize(a,f);document.getElementById("info_left_up").innerHTML=a+"x"+f}function ya(){for(var f=w(P,Z),a=0;a<f.length;a++)F.play(f[a])}function ma(){for(var f=w(P,Z),a=0;a<f.length;a++)F.stop(f[a])}function pa(){fa.pause();var f=mb.determine_max_bones();document.getElementById("max_bones").innerHTML=f.max_bones;document.getElementById("max_bones_no_blending").innerHTML=f.max_bones_no_blending;fa.resume()}function S(f){if("anim_active_object"in f)for(var a=0;a<P.length;a++)if(q.get_object_name(P[a])==
f.anim_active_object){Z=a;a=F.get_anim_names(P[Z]);a.length?B("anim_action",a):B("anim_action",["N/A"]);return}if("anim_action"in f)for(var b=w(P,Z),a=0;a<b.length;a++)F.apply(b[a],f.anim_action),F.play(b[a]),F.cyclic(b[a],!0);if("anim_cyclic"in f)for(b=w(P,Z),a=0;a<b.length;a++){var c=b[a];F.cyclic(c,"on"===f.anim_cyclic)}if("anim_frame_current"in f)for(f=parseInt(f.anim_frame_current),b=w(P,Z),a=0;a<b.length;a++)c=b[a],F.is_play(c)||F.set_frame(c,f)}function l(){var a=q.get_ssao_params(),b="ssao_quality ssao_radius_increase ssao_dithering_amount ssao_gauss_center ssao_gauss_width_square ssao_gauss_width_left_square ssao_influence ssao_dist_factor ssao_only ssao_white".split(" ");
if(a){x(b,"enable");for(var c=document.getElementById("ssao_quality"),b=a.ssao_quality,c=c.options,d=0;d<c.length;d++){var e=c[d];e.selected=e.value==b?!0:!1}$("#ssao_quality").selectmenu("refresh");m("ssao_radius_increase",a.radius_increase);m("ssao_dithering_amount",1E3*a.dithering_amount);m("ssao_gauss_center",a.gauss_center);m("ssao_gauss_width_square",Math.sqrt(a.gauss_width_square));m("ssao_gauss_width_left_square",Math.sqrt(a.gauss_width_left_square));m("ssao_influence",a.influence);m("ssao_dist_factor",
a.dist_factor);b=0===a.ssao_only?1:0;document.getElementById("ssao_only").options[b].selected=!0;$("#ssao_only").slider("refresh");b=0===a.ssao_white?1:0;document.getElementById("ssao_white").options[b].selected=!0;$("#ssao_white").slider("refresh")}else x(b,"disable")}function X(a){q.get_ssao_params();var b={};"ssao_quality"in a&&(b.ssao_quality=Ha(document.getElementById("ssao_quality")));"ssao_radius_increase"in a&&(b.ssao_radius_increase=a.ssao_radius_increase);"ssao_dithering_amount"in a&&(b.ssao_dithering_amount=
a.ssao_dithering_amount/1E3);"ssao_gauss_center"in a&&(b.ssao_gauss_center=a.ssao_gauss_center);"ssao_gauss_width_square"in a&&(b.ssao_gauss_width_square=a.ssao_gauss_width_square*a.ssao_gauss_width_square);"ssao_gauss_width_left_square"in a&&(b.ssao_gauss_width_left_square=a.ssao_gauss_width_left_square*a.ssao_gauss_width_left_square);"ssao_influence"in a&&(b.ssao_influence=a.ssao_influence);"ssao_dist_factor"in a&&(b.ssao_dist_factor=a.ssao_dist_factor);"ssao_only"in a&&(b.ssao_only="on"===a.ssao_only?
1:0);"ssao_white"in a&&(b.ssao_white="on"===a.ssao_white?1:0);q.set_ssao_params(b)}function Ua(){var a=q.get_color_correction_params(),b=["brightness","contrast","exposure","saturation"];a?(x(b,"enable"),m("brightness",a.brightness),m("contrast",a.contrast),m("exposure",a.exposure),m("saturation",a.saturation)):x(b,"disable")}function ua(a){var b=q.get_color_correction_params();b&&(b={},"brightness"in a&&(b.brightness=parseFloat(a.brightness)),"contrast"in a&&(b.contrast=parseFloat(a.contrast)),"exposure"in
a&&(b.exposure=parseFloat(a.exposure)),"saturation"in a&&(b.saturation=parseFloat(a.saturation)),q.set_color_correction_params(b))}function Ha(a){a=a.options;for(var b=0;b<a.length;b++){var c=a[b];if(c.selected)return c.value}}function Va(){var a=q.get_fog_color_density();0.2<a[3]?m("fog_density",a[3]):m("fog_density1000",1E3*a[3]);ga("fog_color",a)}function ja(a){var b=q.get_fog_color_density();"fog_density"in a&&(b[3]=a.fog_density);"fog_density1000"in a&&(b[3]=a.fog_density1000/1E3);"fog_color"in
a&&(b[0]=a.fog_color[0],b[1]=a.fog_color[1],b[2]=a.fog_color[2]);q.set_fog_color_density(b)}function Wa(){var a=q.get_shadow_params(),b="optimize_shadow_volume csm_near csm_far shadow_visibility_falloff blur_depth_size_mult blur_depth_edge_size blur_depth_diff_threshold csm_lambda".split(" ");if(!a)return x(b,"disable"),null;x(b,"enable");b=a.optimize_shadow_volume?0:1;document.getElementById("optimize_shadow_volume").options[b].selected=!0;$("#optimize_shadow_volume").slider("refresh");m("shadow_visibility_falloff",
a.shadow_visibility_falloff);m("blur_depth_size_mult",a.blur_depth_size_mult);m("blur_depth_edge_size",a.blur_depth_edge_size);m("blur_depth_diff_threshold",a.blur_depth_diff_threshold);Ia(a);m("csm_near",a.csm_near);m("csm_far",a.csm_far);m("csm_lambda",a.csm_lambda)}function T(a){var b={};"optimize_shadow_volume"in a&&(b.optimize_shadow_volume="on"===a.optimize_shadow_volume?!0:!1);"csm_near"in a&&(b.csm_near=parseFloat(a.csm_near));"csm_far"in a&&(b.csm_far=parseFloat(a.csm_far));"csm_lambda"in
a&&(b.csm_lambda=parseFloat(a.csm_lambda));"shadow_visibility_falloff"in a&&(b.shadow_visibility_falloff=parseFloat(a.shadow_visibility_falloff));"blur_depth_size_mult"in a&&(b.blur_depth_size_mult=parseFloat(a.blur_depth_size_mult));"blur_depth_edge_size"in a&&(b.blur_depth_edge_size=parseFloat(a.blur_depth_edge_size));"blur_depth_diff_threshold"in a&&(b.blur_depth_diff_threshold=parseFloat(a.blur_depth_diff_threshold));q.set_shadow_params(b);Ia(q.get_shadow_params())}function Ia(a){document.getElementById("csm_num").innerHTML=
" "+a.csm_num;a=a.csm_borders;var b=document.getElementById("csm_borders");b.innerHTML="(";for(var c=0;c<a.length;c++)0<c&&(b.innerHTML+=" __ "),b.innerHTML+=Math.round(10*a[c])/10;b.innerHTML+=")"}function Xa(){var a=q.get_environment_colors();m("environment_energy",a[0]);ga("horizon_color",a[1]);ga("zenith_color",a[2])}function J(a){"environment_energy"in a&&q.set_environment_colors(a.environment_energy,null,null);"horizon_color"in a&&q.set_environment_colors(null,a.horizon_color,null);"zenith_color"in
a&&q.set_environment_colors(null,null,a.zenith_color)}function ba(a){var b={};"wireframe_mode"in a&&(b.wireframe_mode=Ha(document.getElementById("wireframe_mode")));"wireframe_edge_color"in a&&(b.wireframe_edge_color=a.wireframe_edge_color);Q.set_debug_params(b)}function ka(){var a=q.get_sky_params(),b="sky_color rayleigh_brightness mie_brightness spot_brightness scatter_strength rayleigh_strength mie_strength rayleigh_collection_power mie_collection_power mie_distribution".split(" ");if(!a)return x(b,
"disable"),null;x(b,"enable");ga("sky_color",a.color);m("rayleigh_brightness",a.rayleigh_brightness);m("mie_brightness",a.mie_brightness);m("spot_brightness",a.spot_brightness);m("scatter_strength",a.scatter_strength);m("rayleigh_strength",a.rayleigh_strength);m("mie_strength",a.mie_strength);m("rayleigh_collection_power",a.rayleigh_collection_power);m("mie_collection_power",a.mie_collection_power);m("mie_distribution",a.mie_distribution)}function H(a){var b={};"sky_color"in a&&(b.color=a.sky_color);
"rayleigh_brightness"in a&&(b.rayleigh_brightness=a.rayleigh_brightness);"mie_brightness"in a&&(b.mie_brightness=a.mie_brightness);"spot_brightness"in a&&(b.spot_brightness=a.spot_brightness);"scatter_strength"in a&&(b.scatter_strength=a.scatter_strength);"rayleigh_strength"in a&&(b.rayleigh_strength=a.rayleigh_strength);"mie_strength"in a&&(b.mie_strength=a.mie_strength);"rayleigh_collection_power"in a&&(b.rayleigh_collection_power=a.rayleigh_collection_power);"mie_collection_power"in a&&(b.mie_collection_power=
a.mie_collection_power);"mie_distribution"in a&&(b.mie_distribution=a.mie_distribution);q.set_sky_params(b)}function ca(a,b){var c=na.get_material_extended_params(a,b),d="material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" ");if(!c)return x(d,"disable"),null;var e=na.get_diffuse_color(a,b);e.pop();c.diffuse_color=e;x(d,"enable");ga("material_diffuse_color",c.diffuse_color);m("material_reflectivity",
c.reflect_factor);m("material_fresnel",c.fresnel);m("material_fresnel_factor",c.fresnel_factor);m("material_parallax_scale",c.parallax_scale);m("material_parallax_steps",c.parallax_steps)}function M(a){var b=q.get_object_by_name(Y);"material_name"in a&&ca(b,a.material_name);if("material_diffuse_color"in a){var c=a.material_diffuse_color.slice();c.push(1);na.set_diffuse_color(b,$("#material_name").val(),c)}c={};"material_reflectivity"in a&&(c.material_reflectivity=a.material_reflectivity);"material_fresnel"in
a&&(c.material_fresnel=a.material_fresnel);"material_fresnel_factor"in a&&(c.material_fresnel_factor=a.material_fresnel_factor);"material_parallax_scale"in a&&(c.material_parallax_scale=a.material_parallax_scale);"material_parallax_steps"in a&&(c.material_parallax_steps=a.material_parallax_steps);na.set_material_extended_params(b,$("#material_name").val(),c);q.update_scene_materials_params()}function s(a){var b=q.get_object_by_name(Y),c="waves_height waves_length sss_strength sss_width dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac".split(" ");
if(!b)return null;var d={},e=$("#water_dynamic").val(),g=$("#shore_smoothing").val();"1"==e?(e=!0,x(c,"enable")):(e=!1,x(c,"disable"));"1"==g?(g=!0,x(["absorb_factor"],"enable")):(g=!1,x(["absorb_factor"],"disable"));"shore_smoothing"in a&&(d.shore_smoothing=g);"absorb_factor"in a&&(d.absorb_factor=a.absorb_factor);"water_fog_color"in a&&(d.water_fog_color=a.water_fog_color);"water_fog_density"in a&&(d.water_fog_density=a.water_fog_density);"shallow_water_col"in a&&(d.shallow_water_col=a.shallow_water_col);
"shallow_water_col_fac"in a&&(d.shallow_water_col_fac=a.shallow_water_col_fac);"shore_water_col"in a&&(d.shore_water_col=a.shore_water_col);"shore_water_col_fac"in a&&(d.shore_water_col_fac=a.shore_water_col_fac);"foam_factor"in a&&(d.foam_factor=a.foam_factor);"sss_strength"in a&&(d.sss_strength=a.sss_strength);"sss_width"in a&&(d.sss_width=a.sss_width);"water_dynamic"in a&&(d.water_dynamic=e);"waves_height"in a&&(d.waves_height=a.waves_height);"waves_length"in a&&(d.waves_length=a.waves_length);
"dst_noise_scale0"in a&&(d.dst_noise_scale0=a.dst_noise_scale0);"dst_noise_scale1"in a&&(d.dst_noise_scale1=a.dst_noise_scale1);"dst_noise_freq0"in a&&(d.dst_noise_freq0=a.dst_noise_freq0);"dst_noise_freq1"in a&&(d.dst_noise_freq1=a.dst_noise_freq1);"dir_min_shore_fac"in a&&(d.dir_min_shore_fac=a.dir_min_shore_fac);"dir_freq"in a&&(d.dir_freq=a.dir_freq);"dir_noise_scale"in a&&(d.dir_noise_scale=a.dir_noise_scale);"dir_noise_freq"in a&&(d.dir_noise_freq=a.dir_noise_freq);"dir_min_noise_fac"in a&&
(d.dir_min_noise_fac=a.dir_min_noise_fac);"dst_min_fac"in a&&(d.dst_min_fac=a.dst_min_fac);"waves_hor_fac"in a&&(d.waves_hor_fac=a.waves_hor_fac);if(!na.set_water_material_params(b,$("#material_name").val(),d))return null;q.update_scene_materials_params();q.set_water_params(d)}function Ja(a){a=V.get_light_params(a);ga("light_color",a.light_color);m("light_energy",a.light_energy)}function za(a){"light_name"in a&&Ja(a.light_name);var b={};"light_color"in a&&(b.light_color=a.light_color);"light_energy"in
a&&(b.light_energy=parseFloat(a.light_energy));V.set_light_params($("#light_name").val(),b)}function Ya(){var a=V.get_sun_params(),b=["sun_horizontal_position","sun_vertical_position"];if(!a)return x(b,"disable"),null;m("sun_horizontal_position",a.hor_position);m("sun_vertical_position",a.vert_position)}function Ka(a){var b={};"sun_horizontal_position"in a&&(b.hor_position=parseFloat(a.sun_horizontal_position),b.vert_position=parseFloat(document.getElementById("sun_vertical_position").value));"sun_vertical_position"in
a&&(b.hor_position=parseFloat(document.getElementById("sun_horizontal_position").value),b.vert_position=parseFloat(a.sun_vertical_position));V.set_sun_params(b)}function Za(a){a=parseFloat(a.max_sun_angle);V.set_max_sun_angle(a)}function Ea(a){"day_time"in a&&V.set_day_time(a.day_time);"date"in a&&V.set_date(new Date(a.date))}function nb(){var a=0,b=parseFloat(document.getElementById("day_time").value),c=D.create_elapsed_sensor(),d=V.get_lamps("SUN")[0];D.create_sensor_manifold(d,"ELAPSED",D.CT_CONTINUOUS,
[c],function(a){return a[0]},function(c,d,e){1==e&&(a=document.getElementById("sun_time_multiplier").value,c=D.get_sensor_value(c,d,0),b+=c*a/3600,24<b&&(b-=Math.floor(b)),m("day_time",b))})}function jb(){var a="run_sun stop_sun date sun_time_multiplier day_time max_sun_angle".split(" ");if(!V.get_lamps("SUN")[0])return x(a,"disable"),null}function Ma(){x("material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" "),
"disable");x("shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" "),"disable")}function ob(){var a=V.get_lamps("SUN")[0];D.check_sensor_manifolds(a)&&D.remove_sensor_manifold(a,
"ELAPSED")}function fb(){var a=q.get_dof_params(),b=["dof_distance","dof_front","dof_rear","dof_power","dof_on"];a?(m("dof_distance",a.dof_distance),m("dof_front",a.dof_front),m("dof_rear",a.dof_rear),m("dof_power",a.dof_power),x(b,"enable"),a=0<a.dof_distance?0:1,document.getElementById("dof_on").options[a].selected=!0,$("#dof_on").slider("refresh")):x(b,"disable")}function ta(a){var b={};"dof_distance"in a&&1==$("#dof_on").val()&&(b.dof_distance=a.dof_distance);"dof_front"in a&&(b.dof_front=a.dof_front);
"dof_rear"in a&&(b.dof_rear=a.dof_rear);"dof_power"in a&&(b.dof_power=a.dof_power);"dof_on"in a&&(b.dof_on=$("#dof_on").val(),b.dof_distance=1==a.dof_on?$("#dof_distance").val():0);q.set_dof_params(b)}function gb(){var a=q.get_god_rays_params(),b=["god_rays_intensity","god_rays_max_ray_length","god_rays_steps"];a?(x(b,"enable"),a&&(m("god_rays_intensity",a.god_rays_intensity),m("god_rays_max_ray_length",a.god_rays_max_ray_length),m("god_rays_steps",a.god_rays_steps))):x(b,"disable")}function Fa(a){var b=
{};"god_rays_intensity"in a&&(b.god_rays_intensity=a.god_rays_intensity);"god_rays_max_ray_length"in a&&(b.god_rays_max_ray_length=a.god_rays_max_ray_length);"god_rays_steps"in a&&(b.god_rays_steps=a.god_rays_steps);q.set_god_rays_params(b)}function ib(){var a=q.get_bloom_params(),b=["bloom_key","bloom_blur","bloom_edge_lum"];a?(x(b,"enable"),a&&(m("bloom_key",a.bloom_key),m("bloom_blur",a.bloom_blur),m("bloom_edge_lum",a.bloom_edge_lum))):x(b,"disable")}function Ga(a){var b={};"bloom_key"in a&&(b.bloom_key=
a.bloom_key);"bloom_blur"in a&&(b.bloom_blur=a.bloom_blur);"bloom_edge_lum"in a&&(b.bloom_edge_lum=a.bloom_edge_lum);q.set_bloom_params(b)}function ga(a,b){b=[Math.pow(b[0],1/2.2),Math.pow(b[1],1/2.2),Math.pow(b[2],1/2.2)];var c={r:Math.round(255*b[0]),g:Math.round(255*b[1]),b:Math.round(255*b[2])};$("#"+a).ColorPickerSetColor(c);$("#"+a+" div").css("backgroundColor","#"+function(a){var b=[a.r.toString(16),a.g.toString(16),a.b.toString(16)];$.each(b,function(a,c){1==c.length&&(b[a]="0"+c)});return b.join("")}(c))}
function hb(){var a=q.get_wind_params(),b=["wind_dir","wind_strength"];a?(m("wind_dir",a.wind_dir),m("wind_strength",a.wind_strength)):x(b,"disable")}function Qa(a){var b={};"wind_dir"in a&&(b.wind_dir=a.wind_dir);"wind_strength"in a&&(b.wind_strength=a.wind_strength);q.set_wind_params(b)}function m(a,b){$("#"+a).val(b);$("#"+a).slider("refresh")}function h(a,b){$("#"+b).bind("change",function(c){var d={};d[b]=c.target.value;a(d)})}function aa(a,b){$("#"+b).ColorPicker({onChange:function(c,d,e){$("#"+
b+" div").css("backgroundColor","#"+d);c={};d=[];d[0]=e.r/255;d[1]=e.g/255;d[2]=e.b/255;e=d;e=[Math.pow(e[0],2.2),Math.pow(e[1],2.2),Math.pow(e[2],2.2)];c[b]=e;a(c)}})}function qa(a,b,c){for(var d=[],e=0;e<c.length;e++){var g=c[e];g[a]==b&&d.push(g)}return d}function pb(){qb.auto_rotate(rb)}function x(a,b){if(!a)return null;for(var c=0;c<a.length;c++){var d=$("#"+a[c]).parent().parent();"enable"==b?d.removeClass("ui-disabled"):"disable"==b&&d.addClass("ui-disabled")}}var F=b("animation"),I=b("app"),
Ra=b("assets"),Ca=b("camera"),qb=b("camera_anim"),W=b("config"),kb=b("constraints"),D=b("controls"),Da=b("data"),Q=b("debug"),V=b("lights"),fa=b("main"),ab=b("mixer"),na=b("material"),q=b("scenes"),mb=b("shaders"),L=b("storage"),db=b("transform"),Sa=b("version"),eb=b("vec3"),Aa="DEBUG"===Sa.type(),bb=1E3,rb=0.3,$a="dev/logo.json",Ta;Ta="true"===L.get("show_hud_debug_info")?!0:!1;var sb={canvas_container_id:"main_canvas_container",callback:function(a,b){if(!b)return console.log("b4w init failure"),
null;window.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1};window.ondragstart=function(a){a.preventDefault();a.stopPropagation();return!1};I.enable_controls(a);window.addEventListener("resize",la,!1);var c=document.createEvent("CustomEvent");c.initEvent("resize",!1,!1);window.dispatchEvent(c);Ra.enqueue([["manifest",Ra.AT_JSON,y("assets.json")]],function(a,b,c,d){U=a;va=document.getElementById("info_left_down");ea=document.getElementById("lights_cont");document.getElementById("build_date").innerHTML=
Sa.date();h(z,"quality");switch(W.get("quality")){case W.P_ULTRA:var e=0;break;case W.P_HIGH:e=1;break;case W.P_LOW:e=2;break;case W.P_CUSTOM:e=3}document.getElementById("quality").options[e].selected=!0;$("#quality").selectmenu("refresh");I.set_onclick("reset_memory",E);I.set_onclick("auto_rotate_cam",pb);I.set_onclick("pause",A);I.set_onclick("resume",R);I.set_onclick("auto_view",oa);a=document.getElementById("manifest");if(U){c="";for(b=0;b<U.length;b++){e=U[b];d=e.name;for(var e=e.items,f="",
f=f+"<div data-role='collapsible' data-mini='true' >",f=f+("<h6>"+d+"</h6>"),f=f+"<ul data-role='listview' data-mini='true' data-inset='true' style='margin: -10px 0;'>",g=0;g<e.length;g++)var l=e[g].name,f=f+("<li data-mini='true'><a href='#' class='min_font' id='"+("MANIFEST_ITEM_"+l+"__SEPARATOR__"+d)+"'>"+l+"</a></li>");f+="</ul>";f+="</div>";c+=f}$("#"+a.id).append(c);$("#"+a.id).trigger("create");a.addEventListener("mouseup",ha,!1)}else a.innerHTML="<p style='color: red;'>Failed loading scenes list.</p><p>Maybe a syntax error?</p>";
h(S,"anim_active_object");h(S,"anim_action");h(S,"anim_cyclic");h(S,"anim_frame_current");I.set_onclick("anim_play",ya);I.set_onclick("anim_stop",ma);I.set_onclick("get_max_bones",pa);h(M,"material_name");aa(M,"material_diffuse_color");h(M,"material_reflectivity");h(M,"material_fresnel");h(M,"material_fresnel_factor");h(M,"material_parallax_scale");h(M,"material_parallax_steps");h(s,"material_name");h(s,"shore_smoothing");h(s,"absorb_factor");h(s,"sss_strength");h(s,"sss_width");aa(s,"water_fog_color");
h(s,"water_fog_density");aa(s,"shallow_water_col");h(s,"shallow_water_col_fac");aa(s,"shore_water_col");h(s,"shore_water_col_fac");h(s,"foam_factor");h(s,"water_dynamic");h(s,"waves_height");h(s,"waves_length");h(s,"dst_noise_scale0");h(s,"dst_noise_scale1");h(s,"dst_noise_freq0");h(s,"dst_noise_freq1");h(s,"dir_min_shore_fac");h(s,"dir_freq");h(s,"dir_noise_scale");h(s,"dir_noise_freq");h(s,"dir_min_noise_fac");h(s,"dst_min_fac");h(s,"waves_hor_fac");h(J,"environment_energy");aa(J,"horizon_color");
aa(J,"zenith_color");h(za,"light_name");aa(za,"light_color");h(za,"light_energy");aa(H,"sky_color");h(H,"rayleigh_brightness");h(H,"mie_brightness");h(H,"spot_brightness");h(H,"scatter_strength");h(H,"rayleigh_strength");h(H,"mie_strength");h(H,"rayleigh_collection_power");h(H,"mie_collection_power");h(H,"mie_distribution");h(Ea,"date");h(Ea,"day_time");h(Ka,"sun_horizontal_position");h(Ka,"sun_vertical_position");h(Za,"max_sun_angle");I.set_onclick("run_sun",nb);I.set_onclick("stop_sun",ob);h(T,
"optimize_shadow_volume");h(T,"csm_near");h(T,"csm_far");h(T,"csm_lambda");h(T,"shadow_visibility_falloff");h(T,"blur_depth_size_mult");h(T,"blur_depth_edge_size");h(T,"blur_depth_diff_threshold");h(X,"ssao_quality");h(X,"ssao_radius_increase");h(X,"ssao_dithering_amount");h(X,"ssao_gauss_center");h(X,"ssao_gauss_width_square");h(X,"ssao_gauss_width_left_square");h(X,"ssao_influence");h(X,"ssao_dist_factor");h(X,"ssao_only");h(X,"ssao_white");h(ja,"fog_density");h(ja,"fog_density1000");aa(ja,"fog_color");
h(ta,"dof_distance");h(ta,"dof_front");h(ta,"dof_rear");h(ta,"dof_power");h(ta,"dof_on");h(Fa,"god_rays_intensity");h(Fa,"god_rays_max_ray_length");h(Fa,"god_rays_steps");h(ua,"brightness");h(ua,"contrast");h(ua,"exposure");h(ua,"saturation");h(C,"sfx_mix_mode");a="true"===L.get("sfx_mix_mode")?0:1;document.getElementById("sfx_mix_mode").options[a].selected=!0;$("#sfx_mix_mode").slider("refresh");h(k,"anaglyph_use");a="true"===L.get("anaglyph_use")?0:1;document.getElementById("anaglyph_use").options[a].selected=
!0;$("#anaglyph_use").slider("refresh");h(Qa,"wind_dir");h(Qa,"wind_strength");h(Ga,"bloom_key");h(Ga,"bloom_blur");h(Ga,"bloom_edge_lum");h(ba,"wireframe_mode");aa(ba,"wireframe_edge_color");h(G,"show_hud_debug_info");a="true"===L.get("show_hud_debug_info")?0:1;document.getElementById("show_hud_debug_info").options[a].selected=!0;$("#show_hud_debug_info").slider("refresh");a=O();p(a,!1,!1)},null)},gl_debug:!0,show_hud_debug_info:Ta,sfx_mix_mode:v(),show_fps:!0,alpha:!0,assets_dds_available:!Aa,assets_min50_available:!Aa,
console_verbose:!0,all_objs_selectable:!0,physics_enabled:!0,wireframe_debug:!0},Pa=0,lb=0,cb=new Float32Array(3),xa=!1,Oa,U=null,P=[],Z=0,sa=[],ra=null,Ba=null,va=null,ea=null,Y=null,La=function(){},da=null,Na=null;c.init=function(){var a=L.get("quality");if(a){switch(a){case "ULTRA":var b=W.P_ULTRA;break;case "HIGH":b=W.P_HIGH;break;case "LOW":b=W.P_LOW;break;case "CUSTOM":b=W.P_CUSTOM}W.set("quality",b)}W.set("anaglyph_use","true"===L.get("anaglyph_use"));I.init(sb)}});b4w.require("viewer_main").init();
