b4w.module.storage=function(f,b){function r(){if(!localStorage)throw"Local storage is not supported";return localStorage.b4w?JSON.parse(localStorage.b4w):{}}var q=b("__print");f.set=function(b,f){var k=r();k[b]=String(f);if(!localStorage)throw"Local storage is not supported";localStorage.b4w=JSON.stringify(k)};f.cleanup=function(){if(!localStorage)throw"Local storage is not supported";delete localStorage.b4w};f.get=function(b){var f=r();return f[b]?f[b]:""};f.debug=function(){q.log(r())}};
if(window.b4w)window.b4w.storage=b4w.require("storage");else throw"Failed to register storage, load b4w first";b4w.module.camera_anim=function(f,b){var r=new Float32Array(3),q=new Float32Array(3),z=new Float32Array(3),A=new Float32Array(4),k=b("controls"),C=b("vec3"),I=b("quat");f.track_to_target=function(b,f,d,F,U,c,D,a){if(b&&f){if(b4w.util.is_vector(f))var t=f;else t=z,b4w.transform.get_object_center(f,!1,t);f=d||1;d=F||2;var u=U||1;U=c||1;q[0]=0;q[1]=-1;q[2]=0;var B=b4w.transform.get_rotation_quat(b);c=b4w.util.quat_to_dir(B,q);F=b4w.camera.get_angles(b);var y=b4w.transform.get_translation(b);C.subtract(t,
y,r);C.normalize(r,r);var v=I.rotationTo(c,r,I.create());I.multiply(v,B,A);b4w.util.correct_cam_quat_up(A,!1);C.subtract(t,y,q);var M=C.length(q)*(1-1/d),t=Math.asin(r[1]);d=Math.acos(-r[2]/Math.abs(Math.cos(t)));0<r[0]&&(d=2*Math.PI-d);var s=d-F[0],G=t-F[1];z[0]=0;z[1]=0;z[2]=-1;d=b4w.transform.get_rotation_quat(b);0>b4w.util.quat_to_dir(d,z)[1]?(G=0<c[1]?t-Math.PI+F[1]:t+Math.PI+F[1],s=0<s?-Math.PI+s:Math.PI+s):Math.abs(s)>Math.PI&&(s=0<s?s-2*Math.PI:s+2*Math.PI);var G=-G,R=0,t=k.create_elapsed_sensor();
c=Math.abs(s/f);f=Math.abs(G/f);var H=c>f?c:f,V=H+u,J=V+U,da=J+u,n=s,g=G,p=M;k.create_sensor_manifold(b,"TRACK_TO_TARGET",k.CT_CONTINUOUS,[t],null,function(m,c,v,d){if(d)if(R+=v,R<H){var b=s/H*v;v*=G/H;c=R/H;c=6*c*(1-c);b*=c;v*=c;n-=b;g-=v;b4w.camera.rotate(m,b,v)}else R<V?(n&&(b4w.camera.rotate(m,n,g),n=0,a&&a()),c=(R-H)/u,v=-M*v/u,p-=b,b4w.transform.move_local(m,0,6*v*c*(1-c),0)):R<J?p&&(b4w.transform.move_local(m,0,p,0),p=0):R<da?(c=(R-J)/u,v=M*v/u,v=6*v*c*(1-c),b4w.transform.move_local(m,0,v,
0)):(b4w.transform.set_translation_v(m,y),k.remove_sensor_manifold(m,c),D&&D())})}};f.auto_rotate=function(b){function f(a,c,d,k){1==k&&b4w.camera.rotate_pivot(a,d*b,0)}function d(){k.remove_sensor_manifold(r,"AUTO_ROTATE");k.remove_sensor_manifold(r,"DISABLE_AUTO_ROTATE")}var r=b4w.scenes.get_active_camera();if("TARGET"!==r.data.b4w_move_style)throw"wrong camera type";if(k.check_sensor_manifold(r,"AUTO_ROTATE"))d();else{var q=k.create_mouse_move_sensor("X"),c=k.create_mouse_move_sensor("Y"),D=k.create_mouse_click_sensor(),
a=k.create_elapsed_sensor();k.create_sensor_manifold(r,"DISABLE_AUTO_ROTATE",k.CT_LEVEL,[q,c,D],function(a){return a[0]&&a[2]||a[1]&&a[2]},d);k.create_sensor_manifold(r,"AUTO_ROTATE",k.CT_CONTINUOUS,[a],function(a){return a[0]},f)}}};if(window.b4w)window.b4w.camera_anim=b4w.require("camera_anim");else throw"Failed to register camera_anim, load b4w first";b4w.module.mixer=function(f,b){function r(){t=a.length=0;u=q(100);B=new Float32Array(u.length);y=new Float32Array(u.length);var v=c.get_speakers();if(v.length){a.push(z());for(var M=0;M<v.length;M++)a.push(k(v[M]));a.sort(function(a,c){return"MASTER"==a.id?-1:"MASTER"==c.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==c.id?1:a.id.toUpperCase()<c.id.toUpperCase()?-1:a.id.toUpperCase()>c.id.toUpperCase()?1:0})}}function q(a){for(var c=new Float32Array(a),d=0,b=0;b<a;b++)c[b]=20*Math.pow(1E3,d),d+=1/(a-1);
return c}function z(){var a=A("MASTER");a.params.push(["VOLUME",c.get_volume(null),0,1,50,!1]);var d=c.get_compressor_params();d&&(a.params.push(["THRESHOLD",d.threshold,-100,0,100,!1]),a.params.push(["KNEE",d.knee,0,40,40,!1]),a.params.push(["RATIO",d.ratio,1,20,20,!1]),a.params.push(["ATTACK",d.attack,0,1,1E3,!1]),a.params.push(["RELEASE",d.release,0,1,1E3,!1]));a.mute=c.is_muted(null)?1:0;a.solo=-1;return a}function A(a){return{id:a,params:[],active_param:0,mute:-1,solo:-1,speaker:null}}function k(a){var d=
A(U.get_object_name(a));d.mute=c.is_muted(a)?1:0;d.solo=0;d.speaker=a;return d}function C(a){if(a.speaker){a.params.length=0;a.params.push(["VOLUME",c.get_volume(a.speaker),0,1,50,!1]);var d=c.get_positional_params(a.speaker);d&&(a.params.push(["DIST_REF",d.dist_ref,0,1E3,1E4,!1]),a.params.push(["ATTENUATION",d.attenuation,0,50,1E3,!1]),a.params.push(["DIST_MAX",d.dist_max,0,1E4,1E4,!1]));if(d=c.get_filter_params(a.speaker))a.params.push(["EQ_FREQ",d.freq,20,2E4,100,!0]),a.params.push(["EQ_Q",d.Q,
0,10,100,!1]),a.params.push(["EQ_GAIN",d.gain,-70,30,100,!1]);D.clamp(a.active_param,0,a.params.length-1)}}function I(c){for(var d=0;d<a.length;d++){var b=a[d];if(b!=c&&1==b.solo)return!0}return!1}function fa(d){for(var b=0;b<a.length;b++){var f=a[b];f!=d&&0==f.mute&&0==f.solo&&c.mute(f.speaker,!1)}}function E(){if(0==a.length)return[0,-1];var c=8*Math.floor(t/8),d=c+7,c=D.clamp(c,0,a.length-1),d=D.clamp(d,0,a.length-1);return[c,d]}var d=b("controls");b("debug");var F=b("hud"),U=b("scenes"),c=b("sfx"),
D=b("util"),a=[],t=0,u=null,B=null,y=null;f.enable_mixer_controls=function(b){r();var f=d.create_keyboard_sensor(d.KEY_LEFT_SQ_BRACKET),s=d.create_keyboard_sensor(d.KEY_RIGHT_SQ_BRACKET),k=d.create_keyboard_sensor(d.KEY_SEMI_COLON),q=d.create_keyboard_sensor(d.KEY_SINGLE_QUOTE),H=d.create_keyboard_sensor(d.KEY_SHIFT),z=d.create_timer_sensor(0.15),J=d.create_timer_sensor(0.05),f=[f,s,k,q,H,z,J],s=function(c,n,g,p){if(1==p){g=Boolean(d.get_sensor_value(c,n,0))?-1:1;if(a.length)for(1==g&&t<a.length-
1?t++:-1==g&&0<t&&t--,g=E(),p=g[0];p<=g[1];p++)C(a[p]);"SWITCH_STRIP"==n?d.reset_timer_sensor(c,n,5,0.3):d.reset_timer_sensor(c,n,5,0)}else d.reset_timer_sensor(c,n,5,10)};d.create_sensor_manifold(b,"SWITCH_STRIP",d.CT_TRIGGER,f,function(a){return(a[0]||a[1])&&!a[4]},s);d.create_sensor_manifold(b,"SWITCH_STRIP_HOLD",d.CT_SHOT,f,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},s);d.create_sensor_manifold(b,"SWITCH_PARAM",d.CT_SHOT,f,function(a){return(a[0]||a[1])&&a[4]},function(c,n,g,p){c=Boolean(d.get_sensor_value(c,
n,0))?-1:1;(n=a[t])&&(1==c&&n.active_param<n.params.length-1?n.active_param++:-1==c&&0<n.active_param&&n.active_param--)});s=function(b,n,g,p){if(1==p){var m=Boolean(d.get_sensor_value(b,n,2))?-1:1;if(p=a[t])switch(g=p.params[p.active_param],g[1]=g[5]?g[1]*Math.pow(g[3]/g[2],m/g[4]):g[1]+m*((g[3]-g[2])/g[4]),g[1]=D.clamp(g[1],g[2],g[3]),g[0]){case "VOLUME":"MASTER"!=p.id?c.set_volume(p.speaker,g[1]):c.set_volume(null,g[1]);break;case "DIST_REF":m=c.get_positional_params(p.speaker);m.dist_ref=g[1];
c.set_positional_params(p.speaker,m);break;case "ATTENUATION":m=c.get_positional_params(p.speaker);m.attenuation=g[1];c.set_positional_params(p.speaker,m);break;case "DIST_MAX":m=c.get_positional_params(p.speaker);m.dist_max=g[1];c.set_positional_params(p.speaker,m);break;case "EQ_FREQ":m=c.get_filter_params(p.speaker);m.freq=g[1];c.set_filter_params(p.speaker,m);break;case "EQ_Q":m=c.get_filter_params(p.speaker);m.Q=g[1];c.set_filter_params(p.speaker,m);break;case "EQ_GAIN":m=c.get_filter_params(p.speaker);
m.gain=g[1];c.set_filter_params(p.speaker,m);break;case "THRESHOLD":p=c.get_compressor_params();p.threshold=g[1];c.set_compressor_params(p);break;case "KNEE":p=c.get_compressor_params();p.knee=g[1];c.set_compressor_params(p);break;case "RATIO":p=c.get_compressor_params();p.ratio=g[1];c.set_compressor_params(p);break;case "ATTACK":p=c.get_compressor_params();p.attack=g[1];c.set_compressor_params(p);break;case "RELEASE":p=c.get_compressor_params();p.release=g[1];c.set_compressor_params(p);break;default:throw"Unknown strip param";
}"INC_DEC"==n?d.reset_timer_sensor(b,n,6,0.3):d.reset_timer_sensor(b,n,6,0)}else d.reset_timer_sensor(b,n,6,10)};d.create_sensor_manifold(b,"INC_DEC",d.CT_TRIGGER,f,function(a){return(a[2]||a[3])&&!a[4]},s);d.create_sensor_manifold(b,"INC_DEC_HOLD",d.CT_SHOT,f,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},s);d.create_sensor_manifold(b,"MUTE_SOLO",d.CT_SHOT,f,function(a){return(a[2]||a[3])&&a[4]},function(b,n,g,p){if(Boolean(d.get_sensor_value(b,n,2)))(b=a[t])&&0<=b.mute&&("MASTER"!=b.id?0==b.mute?
(b.mute=1,c.mute(b.speaker,!0),1==b.solo&&(b.solo=0,I(b)||fa(b))):(b.mute=0,I(b)||c.mute(b.speaker,!1)):0==b.mute?(b.mute=1,c.mute(null,!0)):(b.mute=0,c.mute(null,!1)));else if((b=a[t])&&0<=b.solo)if(0==b.solo)for(b.solo=1,c.mute(b.speaker,!1),1==b.mute&&(b.mute=0),n=0;n<a.length;n++)g=a[n],g!=b&&0==g.mute&&0==g.solo&&c.mute(g.speaker,!0);else b.solo=0,I(b)?c.mute(b.speaker,!0):fa(b)});f=d.create_elapsed_sensor();d.create_sensor_manifold(b,"MIXER_DRAW",d.CT_CONTINUOUS,[f],null,function(){if(a[t])for(var b=
E(),n=b[0];n<=b[1];n++){var g=a[n];F.draw_mixer_strip(g.id,n==t,n%8,g.params,g.active_param,g.mute,g.solo);if(g.speaker&&c.get_filter_params(g.speaker)){c.get_filter_freq_response(g.speaker,u,B,y);for(g=0;g<B.length;g++)B[g]=20*Math.log(B[g])/Math.LN10;F.plot_array("EQ",n%8,B,20,2E4,-10,10)}}});f=d.create_timer_sensor(1);d.create_sensor_manifold(b,"MIXER_UPDATE",d.CT_TRIGGER,[f],null,function(){for(var c=E(),n=c[0];n<=c[1];n++)C(a[n])})}};
if(window.b4w)window.b4w.mixer=b4w.require("mixer");else throw"Failed to register mixer, load b4w first";b4w.module.app=function(f,b){var r,q,z,A,k;function C(a){var g=window.onload;window.onload=function(){"function"==typeof g&&g();a()}}function I(a){var g=window.onunload;window.onunload=function(){"function"==typeof g&&g();a()}}function fa(a,g){var c=String(a);g&&(c+="/"+String(g));J.innerHTML=c}function E(a){a=document.getElementById(a);var c=a.cloneNode(!0);a.parentNode.replaceChild(c,a);return c}function d(a,c,b){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||
document.mozFullScreenElement===a||document.webkitIsFullScreen?c():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),b())}c=c||function(){};b=b||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||
a.mozRequestFullScreen;a.requestFullScreen==a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()}function F(a,c){var b=document.createElement("div");b.innerHTML=a+'<p /><a href="'+c+'">'+c+"</a>";b.style.top="50%";b.style.width="100%";b.style.position="absolute";b.style.fontFamily="Arial";b.style.lineHeight="20px";b.style.color="#ff9900";b.style.fontSize="40px";b.style.textAlign="center";document.body.appendChild(b)}var U=b("animation"),c=b("camera"),D=
b("config"),a=b("controls"),t=b("data"),u=b("debug"),B=b("main"),y=b("physics"),v=b("print"),M=b("scenes"),s=b("transform"),G=b("util"),R=b("vec3"),H=null,V=null,J=null,da=new Float32Array(3);f.init=function(a){a=a||{};var c=null,b=function(){},d=!1,T=!1,k=!1,s=!1,r=!1,y=null,q=!1,u=null,z=null,G=null,ea=!1,N;for(N in a)switch(N){case "canvas_container_id":c=a.canvas_container_id;break;case "callback":b=a.callback;break;case "do_not_use_onload":d=a.do_not_use_onload;break;case "gl_debug":T=a.gl_debug;
break;case "show_hud_debug_info":k=a.show_hud_debug_info;break;case "sfx_mix_mode":s=a.sfx_mix_mode;break;case "show_fps":r=a.show_fps;break;case "fps_elem_id":y=a.fps_elem_id;break;case "show_preloader":q=a.show_preloader;break;case "preloader_elem_id":u=a.preloader_elem_id;break;case "bar_id":z=a.bar_id;break;case "caption_id":G=a.caption_id;break;case "do_not_report_init_failure":ea=a.do_not_report_init_failure;break;default:D.set(N,a[N])}D.set("show_hud_debug_info",k);D.set("sfx_mix_mode",s);
var M=k||s||null;a=function(){var a;a:{a=c;var n=ea,d=document.createElement("canvas");d.style.cssText="position: absolute;left:0px; top:0px;";if(M){var m=document.createElement("canvas");m.style.cssText="z-index: 2; position:absolute; left:0px; top:0px; pointer-events: none;"}else m=null;switch(B.init(d,m)){case B.BROWSER_NOT_SUPPORTED:n||F("Browser does not support WebGL.<p />For more info visit","http://get.webgl.org");a=!1;break a;case B.UNDERLYING_ERROR:n||F("Browser could not initialize WebGL. <p />For more info visit",
"http://get.webgl.org/troubleshooting");a=!1;break a}V=d;n=document.getElementById(a);n||(v.error('Warning: canvas container "'+a+'" not found, appending to body'),n=document.body);n.appendChild(d);m&&n.appendChild(m);a=n}a?(H=a,B.set_check_gl_errors(T),r&&(y?J=document.getElementById(y):(J=document.createElement("div"),J.innerHTML=0,J.style.cssText="             position:absolute;            top: 23px;            right: 20px;            font-size: 45px;            line-height: 50px;            font-weight: bold;            color: #000;            z-index: 1;        ",
document.body.appendChild(J)),B.set_fps_callback(fa)),q&&f.create_preloader(u,z,G),b(V,!0)):b(V,!1)};k=function(){B.pause();t.cleanup()};d?(a(),k()):(C(a),I(k))};f.create_preloader=function(a,c,b){k=A=z=q=r=void 0;if(a)a=document.getElementById(a),c=document.getElementById(c),b=document.getElementById(b);else{a=document.createElement("div");var d=document.createElement("div");c=document.createElement("div");b=document.createElement("div");a.className="preloader_container";d.className="preloader_frame";
c.className="preloader_bar";b.className="preloader_caption";d.appendChild(c);d.appendChild(b);a.appendChild(d);document.body.appendChild(a)}var d=document.getElementById("background_image_container"),f=document.getElementById("fill_container");r=a;q=c;z=b;A=d;k=f};f.update_preloader=function(a){q.style.width=a+"%";z.innerHTML=a+"%";k&&(k.style.width=65-a+"%");0==a&&(r.style.display="",V.style.display="none");100==a&&(r.style.display="none",r.style.zIndex=0,V.style.display="",V.style.zIndex=1,H&&(H.style.zIndex=
1),A&&(A.style.zIndex=0))};f.get_canvas_container=function(){return H};f.set_onclick=function(a,c){var b=E(a);b.addEventListener("mouseup",function(a){c(b.value)},!1)};f.set_onchange=function(a,c){var b=E(a);b.addEventListener("change",function(a){a=b.checked;c(void 0!=a?a:b.value)},!1)};f.set_onkeypress=function(a,c){var b=E(a);b.addEventListener("keypress",function(a){c(a.keyCode,b.value)},!1)};f.enable_camera_controls=function(b,g,f,m){b||(b=1);g||(g=1);f||(f=1);document.addEventListener("keydown",
function(b){b.keyCode==a.KEY_O?d(document.body):b.keyCode==a.KEY_P&&(B.is_paused()?B.resume():B.pause())},!1);var k=M.get_active_camera(),r=m?!1:c.get_move_style(k)==c.MS_TARGET_CONTROLS?!0:!1;m=a.create_elapsed_sensor();var t=y.has_simulated_physics(k),q=function(a,d,f,k){t&&y.apply_force(a,0,0,0);if(1==k){k=[1800,2100,1800];var m=c.get_trans_speed(a);switch(d){case "FORWARD":t?y.apply_force(a,0,-k[1],0):s.move_local(a,0,-b*m*f,0);break;case "BACKWARD":t?y.apply_force(a,0,k[1],0):s.move_local(a,
0,b*m*f,0);break;case "UP":t?y.apply_force(a,0,0,-k[2]):s.move_local(a,0,0,-b*m*f);break;case "DOWN":t?y.apply_force(a,0,0,k[2]):s.move_local(a,0,0,b*m*f);break;case "LEFT":t?y.apply_force(a,-k[0],0,0):s.move_local(a,-b*m*f,0,0);break;case "RIGHT":t?y.apply_force(a,k[0],0,0):s.move_local(a,b*m*f,0,0);break;case "ROT_LEFT":r?c.rotate_pivot(a,2*-g*f,0):c.rotate(a,2*g*f,0);break;case "ROT_RIGHT":r?c.rotate_pivot(a,2*g*f,0):c.rotate(a,2*-g*f,0);break;case "ROT_UP":r?c.rotate_pivot(a,0,2*-g*f):c.rotate(a,
0,2*-g*f);break;case "ROT_DOWN":r?c.rotate_pivot(a,0,2*g*f):c.rotate(a,0,2*g*f);break;case "ROT_LEFT":r?c.rotate_pivot(a,2*-g*f,0):c.rotate(a,2*g*f,0);break;case "ROT_RIGHT":r?c.rotate_pivot(a,2*g*f,0):c.rotate(a,2*-g*f,0)}}},v=a.create_keyboard_sensor(a.KEY_W),u=a.create_keyboard_sensor(a.KEY_S),z=a.create_keyboard_sensor(a.KEY_A),D=a.create_keyboard_sensor(a.KEY_D),F=a.create_keyboard_sensor(a.KEY_R),ea=a.create_keyboard_sensor(a.KEY_F),N=a.create_keyboard_sensor(a.KEY_UP),H=a.create_keyboard_sensor(a.KEY_DOWN),
I=a.create_keyboard_sensor(a.KEY_LEFT),J=a.create_keyboard_sensor(a.KEY_RIGHT),O=function(a){return a[0]&&(a[1]||a[2])};a.create_sensor_manifold(k,"FORWARD",a.CT_CONTINUOUS,[m,v],null,q);a.create_sensor_manifold(k,"BACKWARD",a.CT_CONTINUOUS,[m,u],null,q);r?(a.create_sensor_manifold(k,"ROT_UP",a.CT_CONTINUOUS,[m,N,F],O,q),a.create_sensor_manifold(k,"ROT_DOWN",a.CT_CONTINUOUS,[m,H,ea],O,q),a.create_sensor_manifold(k,"ROT_LEFT",a.CT_CONTINUOUS,[m,I,z],O,q),a.create_sensor_manifold(k,"ROT_RIGHT",a.CT_CONTINUOUS,
[m,J,D],O,q)):(a.create_sensor_manifold(k,"UP",a.CT_CONTINUOUS,[m,F],O,q),a.create_sensor_manifold(k,"DOWN",a.CT_CONTINUOUS,[m,ea],O,q),a.create_sensor_manifold(k,"LEFT",a.CT_CONTINUOUS,[m,z],O,q),a.create_sensor_manifold(k,"RIGHT",a.CT_CONTINUOUS,[m,D],O,q),a.create_sensor_manifold(k,"ROT_UP",a.CT_CONTINUOUS,[m,N],O,q),a.create_sensor_manifold(k,"ROT_DOWN",a.CT_CONTINUOUS,[m,H],O,q),a.create_sensor_manifold(k,"ROT_LEFT",a.CT_CONTINUOUS,[m,I],O,q),a.create_sensor_manifold(k,"ROT_RIGHT",a.CT_CONTINUOUS,
[m,J],O,q));var A=0,q=a.create_mouse_wheel_sensor();a.create_sensor_manifold(k,"MOUSE_WHEEL",a.CT_LEVEL,[q],null,function(a,d,g,k){1==k&&(r?(d=c.get_eye(a),c.get_pivot(a,da),a=R.dist(da,d),A+=0.1*-g*a*b):(g*=f,a=M.get_active_camera(),c.change_trans_speed(a,g)))});var K=0,q=a.create_touch_zoom_sensor();a.create_sensor_manifold(k,"TOUCH_ZOOM",a.CT_LEVEL,[q],null,function(a,d,g,f,k){1==f&&r&&(d=c.get_eye(a),c.get_pivot(a,da),a=R.dist(da,d),K+=0.005*-g*a*b)});a.create_sensor_manifold(k,"ZOOM_INTERPOL",
a.CT_CONTINUOUS,[m],null,function(a,b,c,d){1==d&&(0.001<Math.abs(A)||0.001<Math.abs(K))&&r&&(b=G.smooth(A,0,c,0.1),A-=b,c=G.smooth(K,0,c,0.15),K-=c,s.move_local(a,0,b+c,0))});var C=0,S=0,q=a.create_mouse_move_sensor("X"),v=a.create_mouse_move_sensor("Y"),u=a.create_mouse_click_sensor(),z=function(a,b,c,d,f){1==d&&r&&(a=0.01*g,C+="X"==f?-c*a:0,S+="Y"==f?-c*a:0)};a.create_sensor_manifold(k,"MOUSE_X",a.CT_LEVEL,[q,u],null,z,"X");a.create_sensor_manifold(k,"MOUSE_Y",a.CT_LEVEL,[v,u],null,z,"Y");var w=
0,E=0,q=a.create_touch_move_sensor("X"),v=a.create_touch_move_sensor("Y"),u=function(a,b,c,d,f){1==d&&r&&(a=0.007*g,w+="X"==f?-c*a:0,E+="Y"==f?-c*a:0)};a.create_sensor_manifold(k,"TOUCH_X",a.CT_LEVEL,[q],null,u,"X");a.create_sensor_manifold(k,"TOUCH_Y",a.CT_LEVEL,[v],null,u,"Y");a.create_sensor_manifold(k,"ROT_INTERPOL",a.CT_CONTINUOUS,[m],null,function(a,b,d,g){if(1==g&&(0.001<Math.abs(C)||0.001<Math.abs(S)||0.001<Math.abs(w)||0.001<Math.abs(E))&&r){b=G.smooth(C,0,d,0.08);g=G.smooth(S,0,d,0.08);
C-=b;S-=g;var f=G.smooth(w,0,d,0.12);d=G.smooth(E,0,d,0.12);w-=f;E-=d;c.rotate_pivot(a,b+f,g+d)}});a.create_kb_sensor_manifold(k,"TOGGLE_CAMERA_COLLISION",a.CT_SHOT,a.KEY_C,function(){var a=M.get_active_camera();U.is_detect_collisions_used(a)?U.detect_collisions(a,!1):U.detect_collisions(a,!0)});a.create_kb_sensor_manifold(k,"DEC_STEREO_DIST",a.CT_SHOT,a.KEY_LEFT_SQ_BRACKET,function(a,b,d,g){b=c.get_stereo_distance(a);c.set_stereo_distance(a,0.9*b)});a.create_kb_sensor_manifold(k,"INC_STEREO_DIST",
a.CT_SHOT,a.KEY_RIGHT_SQ_BRACKET,function(a,b,d,g){b=c.get_stereo_distance(a);c.set_stereo_distance(a,1.1*b)})};f.enable_object_controls=function(b){var c=y.is_vehicle_chassis(b)||y.is_vehicle_hull(b),d=function(a,b,d,f){if(1==f)switch(b){case "FORWARD":c?y.vehicle_throttle(a,1):s.move_local(a,0,0,1*d);break;case "BACKWARD":c?y.vehicle_throttle(a,-1):s.move_local(a,0,0,-1*d);break;case "LEFT":c?y.vehicle_steer(a,-1):s.move_local(a,1*d,0,0);break;case "RIGHT":c?y.vehicle_steer(a,1):s.move_local(a,
-1*d,0,0)}else switch(b){case "FORWARD":case "BACKWARD":c&&y.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":c&&y.vehicle_steer(a,0)}},f=a.create_elapsed_sensor(),k=a.create_keyboard_sensor(a.KEY_W),q=a.create_keyboard_sensor(a.KEY_S),r=a.create_keyboard_sensor(a.KEY_A),t=a.create_keyboard_sensor(a.KEY_D),u=a.create_keyboard_sensor(a.KEY_UP),v=a.create_keyboard_sensor(a.KEY_DOWN),z=a.create_keyboard_sensor(a.KEY_LEFT),B=a.create_keyboard_sensor(a.KEY_RIGHT),A=function(a){return a[0]&&(a[1]||
a[2])};a.create_sensor_manifold(b,"FORWARD",a.CT_CONTINUOUS,[f,k,u],A,d);a.create_sensor_manifold(b,"BACKWARD",a.CT_CONTINUOUS,[f,q,v],A,d);a.create_sensor_manifold(b,"LEFT",a.CT_CONTINUOUS,[f,r,z],A,d);a.create_sensor_manifold(b,"RIGHT",a.CT_CONTINUOUS,[f,t,B],A,d)};f.disable_object_controls=function(b){a.remove_sensor_manifolds(b)};f.enable_controls=function(b){document.addEventListener("keydown",a.keydown_cb,!1);document.addEventListener("keyup",a.keyup_cb,!1);b.addEventListener("mousewheel",a.mouse_wheel_cb,
!1);b.addEventListener("DOMMouseScroll",a.mouse_wheel_cb,!1);document.body.addEventListener("mousedown",a.mouse_down_cb,!1);document.body.addEventListener("mouseup",a.mouse_up_cb,!1);b.addEventListener("mousemove",a.mouse_move_cb,!1);b.addEventListener("touchstart",a.touch_start_cb,!1);b.addEventListener("touchmove",a.touch_move_cb,!1)};f.disable_controls=function(b){document.removeEventListener("keydown",a.keydown_cb,!1);document.removeEventListener("keyup",a.keyup_cb,!1);b.removeEventListener("mousewheel",
a.mouse_wheel_cb,!1);b.removeEventListener("DOMMouseScroll",a.mouse_wheel_cb,!1);document.body.removeEventListener("mousedown",a.mouse_down_cb,!1);document.body.removeEventListener("mouseup",a.mouse_up_cb,!1);b.removeEventListener("mousemove",a.mouse_move_cb,!1);b.removeEventListener("touchstart",a.touch_start_cb,!1);b.removeEventListener("touchmove",a.touch_move_cb,!1)};f.enable_debug_controls=function(){var b=M.get_active_camera();a.create_kb_sensor_manifold(b,"CAMERA_SHOT",a.CT_SHOT,a.KEY_K,function(){u.make_camera_frustum_shot()});
a.create_kb_sensor_manifold(b,"LIGHT_SHOT",a.CT_SHOT,a.KEY_L,function(){u.make_light_frustum_shot()});a.create_kb_sensor_manifold(b,"TELEMETRY",a.CT_SHOT,a.KEY_T,function(){u.plot_telemetry()})};f.request_fullscreen=d;f.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen;if("function"!=typeof a)throw"B2W App: exit fullscreen method is not supported";a.apply(document)};f.get_url_params=function(){var a=location.href.toString();if(-1==
a.indexOf("?"))return null;for(var a=a.split("?")[1].split("&"),b={},c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]=d[1]}return b}};if(window.b4w)window.b4w.app=b4w.require("app");else throw"Failed to register app, load b4w first";b4w.register("viewer_main",function(f,b){function r(e){return(ta?"../../external/deploy/assets/":"../../assets/")+e}function q(){if(X){var e=b4w.scenes.get_object_by_name(X);if(e)return e}return null}function z(e){if(ma){e.preventDefault&&e.preventDefault();var a=e.clientX;e=e.clientY;var b=q();b&&ga.clear_glow_anim(b);X=a=b4w.scenes.pick_object(a,e);if(a.length){Da(a);var c=q();c&&ga.apply_glow_anim(c,0.2,3.8,1)}else Ea();k();Z||(a.length?c&&(Z=c.name,k(),L.enable_object_controls(c),P.create_kb_sensor_manifold(c,
"QUIT",P.CT_SHOT,P.KEY_Q,function(e,a,ha,b){Z=null;k();L.disable_object_controls(e)})):A())}}function A(){var e=ga.get_active_camera();Z=e.name;k();L.enable_camera_controls(1,ua.camera_rot_speed);P.create_kb_sensor_manifold(e,"QUIT",P.CT_SHOT,P.KEY_Q,function(e,a,ha,b){Z=null;k();L.disable_object_controls(e)});var a=P.create_keyboard_sensor(P.KEY_Z),b=P.create_keyboard_sensor(P.KEY_DEC_POINT);P.create_sensor_manifold(e,"ZOOM_TO",P.CT_SHOT,[a,b],function(e){return e[0]||e[1]},function(e,a,ha,b){(a=
q())&&b4w.camera.zoom_object(e,a)})}function k(){if(ma){var e="CONTROLLED: "+(Z?String(Z):"NONE")+" | SELECTED: "+(X?String(X):"NONE"),a;a:{if(Z&&(a=b4w.scenes.get_object_by_name(Z)))break a;a=!1}X&&a&&"CAMERA"===a.type&&(e+=" | DISTANCE: "+Fa);ma.innerHTML=e}}function C(){var e=Q.get("last_item_name");if(!e)return null;for(var a=0;a<W.length;a++){var b=W[a];if(ia("name",e,b.items)[0])return{category:b.name,item:e}}return null}function I(e,a){var b=document.getElementById(e);b.innerHTML="";for(var c=
0;c<a.length;c++){var d=document.createElement("option");d.text=d.value=a[c];0===c&&(d.selected=!0);b.appendChild(d)}$("#"+e).selectmenu();$("#"+e).selectmenu("refresh")}function fa(e){e=e.target.id;if(-1!=e.indexOf("MANIFEST_ITEM_")){var a=e.split("__SEPARATOR__");e=a[1];a=a[0].split("MANIFEST_ITEM_")[1];na=!1;clearTimeout(Ga);E({category:e,item:a},!0,!1)}}function E(e,a,b){ja={load_file:Sa,animated_objects:[]};aa=ba=ua=void 0;if(e){var c=ia("name",e.category,W)[0],c=ia("name",e.item,c.items)[0],
f;for(f in c)ja[f]=c[f];Q.set("last_item_name",e.item)}else Q.set("last_item_name","");a&&(b4w.clear_render_callback(),b4w.data.cleanup(),b4w.reset_timeline());va=!1;e=ja.name||"Logo";a=ja.load_file;f=document.getElementById("current_file");f.innerHTML=e;f.setAttribute("title",e+" ("+a+")");b4w.data.load(r(a),d,U,b)}function d(e){va=!0;ga.set_glow_color([1,0.4,0.05]);X=null;c(ja);A();L.enable_debug_controls();s()&&Ta.enable_mixer_controls(ga.get_active_camera());b4w.set_render_callback(t);na&&(Ga=
setTimeout(F,Ua));e=P.create_elapsed_sensor();P.create_sensor_manifold(ga.get_active_camera(),"TO_OBJ",P.CT_CONTINUOUS,[e],null,function(e,a,b,c){if(1==c&&X){if(b=q())a=Va,b4w.transform.get_object_center(b,!0,a),e=b4w.camera.get_eye(e),Fa=Wa.dist(a,e).toFixed(3);k()}})}function F(){var e=C();if(e){var a=e.item,e=ia("name",e.category,W)[0],a=ia("name",a,e.items)[0],a=e.items.indexOf(a);if(a=e.items[a+1])e={category:e.name,item:a.name};else if(e=W.indexOf(e),e=W[e+1])e={category:e.name,item:e.items[0].name};
else{na=!1;return}}else e=W[0],a=e.items[0],e={category:e.name,item:a.name};E(e,!0,!0)}function U(e,a){document.getElementById("loading_progress").innerHTML=e+"% ("+Math.round(10*a/1E3)/10+"s)";if(va){var b=b4w.debug.num_vertices(),c=b4w.debug.num_triangles(),d=b4w.debug.num_draw_calls();document.getElementById("info_right_up").innerHTML=b+" verts, "+c+" tris, "+d+" draw calls";var b=b4w.debug.geometry_stats(),c=b4w.debug.num_textures(),d=b4w.debug.num_render_targets(),f=Math.round(10*(b.ibo_memory+
b.vbo_memory))/10,g=Math.round(10*c.memory)/10,h=Math.round(10*d.memory)/10,k=Math.round(10*(f+g+h))/10;document.getElementById("info_right_down").innerHTML="Geometry: "+f+" MiB ("+b.ibo_number+"+"+b.vbo_number+")<br>Textures: "+g+" MiB ("+c.number+")<br>RTs: "+h+" MiB ("+d.number+")<br><br>Total: "+k+" MiB"}}function c(e){for(var b=b4w.scenes.get_active(),c=b4w.scenes.get_scenes(),d=0;d<c.length;d++){var f=c[d];if(f!==b){var g=D(f,e);a(f,g)}}g=D(b,e);a(b,g);Da=function(e){e=b4w.scenes.get_object_by_name(e);
var a=b4w.material.get_materials_names(e);I("material_name",a);Ba(e,a[0]);e=b4w.material.get_water_material_params(e,a[0]);a="shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" ");
e?(x(a,"enable"),b4w.scenes.get_water_mat_params(e),e.shallow_water_col&&ca("shallow_water_col",e.shallow_water_col),e.shallow_water_col_fac&&l("shallow_water_col_fac",e.shallow_water_col_fac),e.shore_water_col&&ca("shore_water_col",e.shore_water_col),e.shore_water_col_fac&&l("shore_water_col_fac",e.shore_water_col_fac),e.water_fog_color&&(ca("water_fog_color",e.water_fog_color),l("water_fog_density",e.water_fog_density)),l("absorb_factor",e.absorb_factor),l("sss_strength",e.sss_strength),l("sss_width",
e.sss_width),l("foam_factor",e.foam_factor),l("waves_height",e.waves_height),l("waves_length",e.waves_length),l("dst_noise_scale0",e.dst_noise_scale0),l("dst_noise_scale1",e.dst_noise_scale1),l("dst_noise_freq0",e.dst_noise_freq0),l("dst_noise_freq1",e.dst_noise_freq1),l("dir_min_shore_fac",e.dir_min_shore_fac),l("dir_freq",e.dir_freq),l("dir_noise_scale",e.dir_noise_scale),l("dir_noise_freq",e.dir_noise_freq),l("dir_min_noise_fac",e.dir_min_noise_fac),l("dst_min_fac",e.dst_min_fac),l("waves_hor_fac",
e.waves_hor_fac)):x(a,"disable")};Oa();e=b4w.lights.get_lights_names();I("light_name",e);Ca(e[0]);ea();m();Na();Xa();Ya();Ka();La();Za();Qa();Pa();$a();ab();Ea();$("#wireframe_mode").val("WM_NONE");$("#wireframe_mode").selectmenu("refresh",!0);$("#wireframe_edge_color div").css("backgroundColor","#333");e=new Date(document.getElementById("date").value);sa({date:e});ua=g}function D(e,a){function b(e,a){for(var ha in e)a[ha]=e[ha];return a}var c=a.scene_settings;if(c&&c[e]){var d={};b(a,d);b(c[e],d);
delete d.scene_settings;return d}return a}function a(e,a){b4w.scenes.set_active(e);var b=b4w.scenes.get_active_camera();a.camera_target&&b4w.constraints.append_follow(b,a.camera_target);var c=a.h_angle,d=a.v_angle;0!==c&&!c||0!==d&&!d||b4w.camera.set_eye_params(b,c,d);b=a.animated_objects.slice(0);b.unshift("All");I("anim_active_object",b);aa=bb;ba=b;b=b4w.animation.get_actions();c="anim_action anim_cyclic anim_frame_current anim_play anim_stop get_max_bones".split(" ");if(!b.length)return x(c,"disable"),
null;x(c,"enable");I("anim_action",b);(b=b[cb])&&p({anim_action:b})}function t(e,a){b4w.scenes.get_active_camera();var b=u(ba,aa)[0];if(b){var c=document.getElementById("anim_status");b4w.animation.is_play(b)?c.innerHTML="PLAYING":c.innerHTML="STOPPED";var d=document.getElementById("anim_frame_range");if(c=b4w.animation.get_frame_range(b))d.innerHTML=c[0]+" - "+c[1],d=document.getElementById("anim_frame_current"),d.min=""+c[0],d.max=""+c[1];b=Math.round(b4w.animation.get_current_frame_float(b));parseInt($("#anim_frame_current").val())!==
b&&l("anim_frame_current",b)}}function u(e,a){var b=[];if(0==a)for(var c=1;c<e.length;c++){var d=e[c]instanceof Array?b4w.scenes.get_object_by_empty_name(e[c][0],e[c][1]):b4w.scenes.get_object_by_name(e[c]);d?b.push(d):e.splice(c,1)}else d=e[a]instanceof Array?b4w.scenes.get_object_by_empty_name(e[a][0],e[a][1]):b4w.scenes.get_object_by_name(e[a]),b=[d];return b}function B(e){Q.set("quality",e.quality);setTimeout(function(){window.location.reload()},100)}function y(){Q.cleanup();window.location.reload()}
function v(){b4w.pause()}function M(){b4w.resume()}function s(){return"true"===Q.get("sfx_mix_mode")?!0:!1}function G(e){Q.set("show_hud_debug_info","on"===e.show_hud_debug_info);window.location.reload()}function R(e){Q.set("sfx_mix_mode","on"===e.sfx_mix_mode);window.location.reload()}function H(e){Q.set("anaglyph_use","on"===e.anaglyph_use);window.location.reload()}function V(){na=!0;F()}function J(e){var a=e.target.innerWidth;e=e.target.innerHeight;var b=document.getElementById("controls_container").offsetWidth,
a=a-b;b4w.resize(a,e);document.getElementById("info_left_up").innerHTML=a+"x"+e}function da(){for(var e=u(ba,aa),a=0;a<e.length;a++)b4w.animation.play(e[a])}function n(){for(var e=u(ba,aa),a=0;a<e.length;a++)b4w.animation.stop(e[a])}function g(){b4w.pause();var e=b4w.shaders.determine_max_bones();document.getElementById("max_bones").innerHTML=e.max_bones;document.getElementById("max_bones_no_blending").innerHTML=e.max_bones_no_blending;b4w.resume()}function p(e){if("anim_active_object"in e)for(var a=
ba,b=0;b<a.length;b++)if(a[b]==e.anim_active_object){aa=b;return}if("anim_action"in e)for(a=u(ba,aa),b=0;b<a.length;b++)b4w.animation.apply(a[b],e.anim_action),b4w.animation.play(a[b]),b4w.animation.cyclic(a[b],!0);if("anim_cyclic"in e)for(a=u(ba,aa),b=0;b<a.length;b++){var c=a[b];b4w.animation.cyclic(c,"on"===e.anim_cyclic)}if("anim_frame_current"in e)for(e=parseInt(e.anim_frame_current),a=u(ba,aa),b=0;b<a.length;b++)c=a[b],b4w.animation.is_play(c)||(b4w.animation.set_current_frame_float(c,e),b4w.animation.update_object_animation(c))}
function m(){var a=b4w.scenes.get_ssao_params(),b="ssao_quality ssao_radius_increase ssao_dithering_amount ssao_gauss_center ssao_gauss_width_square ssao_gauss_width_left_square ssao_influence ssao_dist_factor ssao_only ssao_white".split(" ");a?(x(b,"enable"),ya(document.getElementById("ssao_quality"),a.ssao_quality),$("#ssao_quality").selectmenu("refresh"),l("ssao_radius_increase",a.radius_increase),l("ssao_dithering_amount",1E3*a.dithering_amount),l("ssao_gauss_center",a.gauss_center),l("ssao_gauss_width_square",
Math.sqrt(a.gauss_width_square)),l("ssao_gauss_width_left_square",Math.sqrt(a.gauss_width_left_square)),l("ssao_influence",a.influence),l("ssao_dist_factor",a.dist_factor),b=0===a.ssao_only?1:0,document.getElementById("ssao_only").options[b].selected=!0,$("#ssao_only").slider("refresh"),b=0===a.ssao_white?1:0,document.getElementById("ssao_white").options[b].selected=!0,$("#ssao_white").slider("refresh")):x(b,"disable")}function T(a){b4w.scenes.get_ssao_params();var b={};"ssao_quality"in a&&(b.ssao_quality=
oa(document.getElementById("ssao_quality")));"ssao_radius_increase"in a&&(b.ssao_radius_increase=a.ssao_radius_increase);"ssao_dithering_amount"in a&&(b.ssao_dithering_amount=a.ssao_dithering_amount/1E3);"ssao_gauss_center"in a&&(b.ssao_gauss_center=a.ssao_gauss_center);"ssao_gauss_width_square"in a&&(b.ssao_gauss_width_square=a.ssao_gauss_width_square*a.ssao_gauss_width_square);"ssao_gauss_width_left_square"in a&&(b.ssao_gauss_width_left_square=a.ssao_gauss_width_left_square*a.ssao_gauss_width_left_square);
"ssao_influence"in a&&(b.ssao_influence=a.ssao_influence);"ssao_dist_factor"in a&&(b.ssao_dist_factor=a.ssao_dist_factor);"ssao_only"in a&&(b.ssao_only="on"===a.ssao_only?1:0);"ssao_white"in a&&(b.ssao_white="on"===a.ssao_white?1:0);b4w.scenes.set_ssao_params(b)}function Ka(){var a=b4w.scenes.get_color_correction_params(),b=["brightness","contrast","exposure","saturation"];a?(x(b,"enable"),l("brightness",a.brightness),l("contrast",a.contrast),l("exposure",a.exposure),l("saturation",a.saturation)):
x(b,"disable")}function la(a){var b=b4w.scenes.get_color_correction_params();b&&(b={},"brightness"in a&&(b.brightness=parseFloat(a.brightness)),"contrast"in a&&(b.contrast=parseFloat(a.contrast)),"exposure"in a&&(b.exposure=parseFloat(a.exposure)),"saturation"in a&&(b.saturation=parseFloat(a.saturation)),b4w.scenes.set_color_correction_params(b))}function La(){var a=b4w.scenes.get_aa_params();if(!a)return x(["aa_method"],"disable"),null;x(["aa_method"],"enable");ya(document.getElementById("aa_method"),
a.aa_method);$("#aa_method").selectmenu("refresh")}function ya(a,b){for(var c=a.options,d=0;d<c.length;d++){var f=c[d];f.selected=f.value==b?!0:!1}}function oa(a){a=a.options;for(var b=0;b<a.length;b++){var c=a[b];if(c.selected)return c.value}}function Ma(a){b4w.scenes.get_aa_params();var b={};"aa_method"in a&&(b.aa_method=oa(document.getElementById("aa_method")));b4w.scenes.set_aa_params(b)}function Na(){var a=b4w.scenes.get_fog_color_density();0.2<a[3]?l("fog_density",a[3]):l("fog_density1000",
1E3*a[3]);ca("fog_color",a)}function pa(a){var b=b4w.scenes.get_fog_color_density();"fog_density"in a&&(b[3]=a.fog_density);"fog_density1000"in a&&(b[3]=a.fog_density1000/1E3);"fog_color"in a&&(b[0]=a.fog_color[0],b[1]=a.fog_color[1],b[2]=a.fog_color[2]);b4w.scenes.set_fog_color_density(b)}function ea(){var a=b4w.scenes.get_shadow_params(),b="optimize_shadow_volume csm_near csm_far shadow_visibility_falloff blur_depth_size_mult blur_depth_edge_size blur_depth_diff_threshold csm_lambda".split(" ");
if(!a)return x(b,"disable"),null;x(b,"enable");b=a.optimize_shadow_volume?0:1;document.getElementById("optimize_shadow_volume").options[b].selected=!0;$("#optimize_shadow_volume").slider("refresh");l("shadow_visibility_falloff",a.shadow_visibility_falloff);l("blur_depth_size_mult",a.blur_depth_size_mult);l("blur_depth_edge_size",a.blur_depth_edge_size);l("blur_depth_diff_threshold",a.blur_depth_diff_threshold);za(a);l("csm_near",a.csm_near);l("csm_far",a.csm_far);l("csm_lambda",a.csm_lambda)}function N(a){var b=
{};"optimize_shadow_volume"in a&&(b.optimize_shadow_volume="on"===a.optimize_shadow_volume?!0:!1);"csm_near"in a&&(b.csm_near=parseFloat(a.csm_near));"csm_far"in a&&(b.csm_far=parseFloat(a.csm_far));"csm_lambda"in a&&(b.csm_lambda=parseFloat(a.csm_lambda));"shadow_visibility_falloff"in a&&(b.shadow_visibility_falloff=parseFloat(a.shadow_visibility_falloff));"blur_depth_size_mult"in a&&(b.blur_depth_size_mult=parseFloat(a.blur_depth_size_mult));"blur_depth_edge_size"in a&&(b.blur_depth_edge_size=parseFloat(a.blur_depth_edge_size));
"blur_depth_diff_threshold"in a&&(b.blur_depth_diff_threshold=parseFloat(a.blur_depth_diff_threshold));b4w.scenes.set_shadow_params(b);za(b4w.scenes.get_shadow_params())}function za(a){document.getElementById("csm_num").innerHTML=" "+a.csm_num;a=a.csm_borders;var b=document.getElementById("csm_borders");b.innerHTML="(";for(var c=0;c<a.length;c++)0<c&&(b.innerHTML+=" __ "),b.innerHTML+=Math.round(10*a[c])/10;b.innerHTML+=")"}function Oa(){var a=b4w.scenes.get_environment_colors();l("environment_energy",
a[0]);ca("horizon_color",a[1]);ca("zenith_color",a[2])}function qa(a){"environment_energy"in a&&b4w.scenes.set_environment_colors(a.environment_energy,null,null);"horizon_color"in a&&b4w.scenes.set_environment_colors(null,a.horizon_color,null);"zenith_color"in a&&b4w.scenes.set_environment_colors(null,null,a.zenith_color)}function O(a){var b={};"wireframe_mode"in a&&(b.wireframe_mode=oa(document.getElementById("wireframe_mode")));"wireframe_edge_color"in a&&(b.wireframe_edge_color=a.wireframe_edge_color);
b4w.debug.set_debug_params(b)}function Pa(){var a=b4w.scenes.get_sky_params(),b="sky_color rayleigh_brightness mie_brightness spot_brightness scatter_strength rayleigh_strength mie_strength rayleigh_collection_power mie_collection_power mie_distribution".split(" ");if(!a)return x(b,"disable"),null;x(b,"enable");ca("sky_color",a.color);l("rayleigh_brightness",a.rayleigh_brightness);l("mie_brightness",a.mie_brightness);l("spot_brightness",a.spot_brightness);l("scatter_strength",a.scatter_strength);
l("rayleigh_strength",a.rayleigh_strength);l("mie_strength",a.mie_strength);l("rayleigh_collection_power",a.rayleigh_collection_power);l("mie_collection_power",a.mie_collection_power);l("mie_distribution",a.mie_distribution)}function K(a){var b={};"sky_color"in a&&(b.color=a.sky_color);"rayleigh_brightness"in a&&(b.rayleigh_brightness=a.rayleigh_brightness);"mie_brightness"in a&&(b.mie_brightness=a.mie_brightness);"spot_brightness"in a&&(b.spot_brightness=a.spot_brightness);"scatter_strength"in a&&
(b.scatter_strength=a.scatter_strength);"rayleigh_strength"in a&&(b.rayleigh_strength=a.rayleigh_strength);"mie_strength"in a&&(b.mie_strength=a.mie_strength);"rayleigh_collection_power"in a&&(b.rayleigh_collection_power=a.rayleigh_collection_power);"mie_collection_power"in a&&(b.mie_collection_power=a.mie_collection_power);"mie_distribution"in a&&(b.mie_distribution=a.mie_distribution);b4w.scenes.set_sky_params(b)}function Ba(a,b){var c=b4w.material.get_material_extended_params(a,b),d="material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" ");
if(!c)return x(d,"disable"),null;var f=b4w.material.get_diffuse_color(a,b);f.pop();c.diffuse_color=f;x(d,"enable");ca("material_diffuse_color",c.diffuse_color);l("material_reflectivity",c.reflect_factor);l("material_fresnel",c.fresnel);l("material_fresnel_factor",c.fresnel_factor);l("material_parallax_scale",c.parallax_scale);l("material_parallax_steps",c.parallax_steps)}function S(a){var b=b4w.scenes.get_object_by_name(X);"material_name"in a&&Ba(b,a.material_name);if("material_diffuse_color"in a){var c=
a.material_diffuse_color.slice();c.push(1);b4w.material.set_diffuse_color(b,$("#material_name").val(),c)}c={};"material_reflectivity"in a&&(c.material_reflectivity=a.material_reflectivity);"material_fresnel"in a&&(c.material_fresnel=a.material_fresnel);"material_fresnel_factor"in a&&(c.material_fresnel_factor=a.material_fresnel_factor);"material_parallax_scale"in a&&(c.material_parallax_scale=a.material_parallax_scale);"material_parallax_steps"in a&&(c.material_parallax_steps=a.material_parallax_steps);
b4w.material.set_material_extended_params(b,$("#material_name").val(),c);b4w.scenes.update_scene_materials_params()}function w(a){var b=b4w.scenes.get_object_by_name(X),c="waves_height waves_length sss_strength sss_width dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac".split(" ");if(!b)return null;var d={},f=$("#water_dynamic").val(),g=$("#shore_smoothing").val();"1"==f?(f=!0,x(c,
"enable")):(f=!1,x(c,"disable"));"1"==g?(g=!0,x(["absorb_factor"],"enable")):(g=!1,x(["absorb_factor"],"disable"));"shore_smoothing"in a&&(d.shore_smoothing=g);"absorb_factor"in a&&(d.absorb_factor=a.absorb_factor);"water_fog_color"in a&&(d.water_fog_color=a.water_fog_color);"water_fog_density"in a&&(d.water_fog_density=a.water_fog_density);"shallow_water_col"in a&&(d.shallow_water_col=a.shallow_water_col);"shallow_water_col_fac"in a&&(d.shallow_water_col_fac=a.shallow_water_col_fac);"shore_water_col"in
a&&(d.shore_water_col=a.shore_water_col);"shore_water_col_fac"in a&&(d.shore_water_col_fac=a.shore_water_col_fac);"foam_factor"in a&&(d.foam_factor=a.foam_factor);"sss_strength"in a&&(d.sss_strength=a.sss_strength);"sss_width"in a&&(d.sss_width=a.sss_width);"water_dynamic"in a&&(d.water_dynamic=f);"waves_height"in a&&(d.waves_height=a.waves_height);"waves_length"in a&&(d.waves_length=a.waves_length);"dst_noise_scale0"in a&&(d.dst_noise_scale0=a.dst_noise_scale0);"dst_noise_scale1"in a&&(d.dst_noise_scale1=
a.dst_noise_scale1);"dst_noise_freq0"in a&&(d.dst_noise_freq0=a.dst_noise_freq0);"dst_noise_freq1"in a&&(d.dst_noise_freq1=a.dst_noise_freq1);"dir_min_shore_fac"in a&&(d.dir_min_shore_fac=a.dir_min_shore_fac);"dir_freq"in a&&(d.dir_freq=a.dir_freq);"dir_noise_scale"in a&&(d.dir_noise_scale=a.dir_noise_scale);"dir_noise_freq"in a&&(d.dir_noise_freq=a.dir_noise_freq);"dir_min_noise_fac"in a&&(d.dir_min_noise_fac=a.dir_min_noise_fac);"dst_min_fac"in a&&(d.dst_min_fac=a.dst_min_fac);"waves_hor_fac"in
a&&(d.waves_hor_fac=a.waves_hor_fac);if(!b4w.material.set_water_material_params(b,$("#material_name").val(),d))return null;b4w.scenes.update_scene_materials_params();b4w.scenes.set_water_params(d)}function Ca(a){a=b4w.lights.get_light_params(a);ca("light_color",a.light_color);l("light_energy",a.light_energy)}function ra(a){"light_name"in a&&Ca(a.light_name);var b={};"light_color"in a&&(b.light_color=a.light_color);"light_energy"in a&&(b.light_energy=parseFloat(a.light_energy));b4w.lights.set_light_params($("#light_name").val(),
b)}function Qa(){var a=b4w.lights.get_sun_params(),b=["sun_horizontal_position","sun_vertical_position"];if(!a)return x(b,"disable"),null;l("sun_horizontal_position",a.hor_position);l("sun_vertical_position",a.vert_position)}function Aa(a){var b={};"sun_horizontal_position"in a&&(b.hor_position=parseFloat(a.sun_horizontal_position),b.vert_position=parseFloat(document.getElementById("sun_vertical_position").value));"sun_vertical_position"in a&&(b.hor_position=parseFloat(document.getElementById("sun_horizontal_position").value),
b.vert_position=parseFloat(a.sun_vertical_position));b4w.lights.set_sun_params(b)}function Ra(a){a=parseFloat(a.max_sun_angle);b4w.lights.set_max_sun_angle(a)}function sa(a){"day_time"in a&&b4w.lights.set_day_time(a.day_time);"date"in a&&b4w.lights.set_date(new Date(a.date))}function db(){var a=b4w.controls,b=0,c=parseFloat(document.getElementById("day_time").value),d=a.create_elapsed_sensor(),f=b4w.lights.get_lamps("SUN")[0];a.create_sensor_manifold(f,"ELAPSED",a.CT_CONTINUOUS,[d],function(a){return a[0]},
function(a,e,d,f){1==f&&(b=document.getElementById("sun_time_multiplier").value,c+=d*b/3600,24<c&&(c-=Math.floor(c)),l("day_time",c))})}function ab(){var a="run_sun stop_sun date sun_time_multiplier day_time max_sun_angle".split(" ");if(!b4w.lights.get_lamps("SUN")[0])return x(a,"disable"),null}function Ea(){x("material_diffuse_color material_name material_reflectivity material_fresnel material_fresnel_factor material_parallax_scale material_parallax_steps".split(" "),"disable");x("shallow_water_col shallow_water_col_fac shore_water_col shore_water_col_fac water_fog_color water_fog_density absorb_factor sss_strength sss_width foam_factor waves_height waves_length dst_noise_scale0 dst_noise_scale1 dst_noise_freq0 dst_noise_freq1 dir_min_shore_fac dir_freq dir_noise_scale dir_noise_freq dir_min_noise_fac dst_min_fac waves_hor_fac water_dynamic shore_smoothing".split(" "),
"disable")}function eb(){var a=b4w.lights.get_lamps("SUN")[0];b4w.controls.check_sensor_manifolds(a)&&b4w.controls.remove_sensor_manifold(a,"ELAPSED")}function Xa(){var a=b4w.scenes.get_dof_params(),b=["dof_distance","dof_front","dof_rear","dof_power","dof_on"];a?(l("dof_distance",a.dof_distance),l("dof_front",a.dof_front),l("dof_rear",a.dof_rear),l("dof_power",a.dof_power),x(b,"enable"),a=0<a.dof_distance?0:1,document.getElementById("dof_on").options[a].selected=!0,$("#dof_on").slider("refresh")):
x(b,"disable")}function ka(a){var b={};"dof_distance"in a&&1==$("#dof_on").val()&&(b.dof_distance=a.dof_distance);"dof_front"in a&&(b.dof_front=a.dof_front);"dof_rear"in a&&(b.dof_rear=a.dof_rear);"dof_power"in a&&(b.dof_power=a.dof_power);"dof_on"in a&&(b.dof_on=$("#dof_on").val(),b.dof_distance=1==a.dof_on?$("#dof_distance").val():0);b4w.scenes.set_dof_params(b)}function Ya(){var a=b4w.scenes.get_god_rays_params(),b=["god_rays_intensity","god_rays_max_ray_length","god_rays_steps"];a?(x(b,"enable"),
a&&(l("god_rays_intensity",a.god_rays_intensity),l("god_rays_max_ray_length",a.god_rays_max_ray_length),l("god_rays_steps",a.god_rays_steps))):x(b,"disable")}function wa(a){var b={};"god_rays_intensity"in a&&(b.god_rays_intensity=a.god_rays_intensity);"god_rays_max_ray_length"in a&&(b.god_rays_max_ray_length=a.god_rays_max_ray_length);"god_rays_steps"in a&&(b.god_rays_steps=a.god_rays_steps);b4w.scenes.set_god_rays_params(b)}function $a(){var a=b4w.scenes.get_bloom_params(),b=["bloom_key","bloom_blur",
"bloom_edge_lum"];a?(x(b,"enable"),a&&(l("bloom_key",a.bloom_key),l("bloom_blur",a.bloom_blur),l("bloom_edge_lum",a.bloom_edge_lum))):x(b,"disable")}function xa(a){var b={};"bloom_key"in a&&(b.bloom_key=a.bloom_key);"bloom_blur"in a&&(b.bloom_blur=a.bloom_blur);"bloom_edge_lum"in a&&(b.bloom_edge_lum=a.bloom_edge_lum);b4w.scenes.set_bloom_params(b)}function ca(a,b){b=[Math.pow(b[0],1/2.2),Math.pow(b[1],1/2.2),Math.pow(b[2],1/2.2)];var c={r:Math.round(255*b[0]),g:Math.round(255*b[1]),b:Math.round(255*
b[2])};$("#"+a).ColorPickerSetColor(c);$("#"+a+" div").css("backgroundColor","#"+function(a){var b=[a.r.toString(16),a.g.toString(16),a.b.toString(16)];$.each(b,function(a,c){1==c.length&&(b[a]="0"+c)});return b.join("")}(c))}function Za(){var a=b4w.scenes.get_wind_params(),b=["wind_dir","wind_strength"];a?(l("wind_dir",a.wind_dir),l("wind_strength",a.wind_strength)):x(b,"disable")}function Ha(a){var b={};"wind_dir"in a&&(b.wind_dir=a.wind_dir);"wind_strength"in a&&(b.wind_strength=a.wind_strength);
b4w.scenes.set_wind_params(b)}function l(a,b){$("#"+a).val(b);$("#"+a).slider("refresh")}function h(a,b){$("#"+b).bind("change",function(c){var d={};d[b]=c.target.value;a(d)})}function Y(a,b){$("#"+b).ColorPicker({onChange:function(c,d,f){$("#"+b+" div").css("backgroundColor","#"+d);c={};d=[];d[0]=f.r/255;d[1]=f.g/255;d[2]=f.b/255;f=d;f=[Math.pow(f[0],2.2),Math.pow(f[1],2.2),Math.pow(f[2],2.2)];c[b]=f;a(c)}})}function ia(a,b,c){for(var d=[],f=0;f<c.length;f++){var g=c[f];g[a]==b&&d.push(g)}return d}
function fb(){b4w.camera_anim.auto_rotate(gb)}function x(a,b){if(!a)return null;for(var c=0;c<a.length;c++){var d=$("#"+a[c]).parent().parent();"enable"==b?d.removeClass("ui-disabled"):"disable"==b&&d.addClass("ui-disabled")}}var L=b("app"),Ia=b("assets");b("config");var P=b("controls");b("data");var Ta=b("mixer"),ga=b("scenes"),Q=b("storage"),Wa=b("vec3"),ta="DEBUG"===b4w.version.type(),Ua=1E3,gb=0.3,Sa="dev/logo.json",Ja;Ja="true"===Q.get("show_hud_debug_info")?!0:!1;var hb={canvas_container_id:"main_canvas_container",
callback:function(a,b){if(!b)return console.log("b4w init failure"),null;window.oncontextmenu=function(a){a.preventDefault();a.stopPropagation();return!1};window.ondragstart=function(a){a.preventDefault();a.stopPropagation();return!1};L.enable_controls(a);a.addEventListener("mousedown",z,!1);window.addEventListener("resize",J,!1);var c=document.createEvent("CustomEvent");c.initEvent("resize",!1,!1);window.dispatchEvent(c);Ia.enqueue([["manifest",Ia.AT_JSON,r("assets.json")]],function(a,b,c,d){W=a;
ma=document.getElementById("info_left_down");document.getElementById("build_date").innerHTML=b4w.version.date();h(B,"quality");switch(b4w.config.get("quality")){case b4w.config.P_ULTRA:var e=0;break;case b4w.config.P_HIGH:e=1;break;case b4w.config.P_LOW:e=2}document.getElementById("quality").options[e].selected=!0;$("#quality").selectmenu("refresh");L.set_onclick("reset_memory",y);L.set_onclick("auto_rotate_cam",fb);L.set_onclick("pause",v);L.set_onclick("resume",M);L.set_onclick("auto_view",V);a=
document.getElementById("manifest");if(W){c="";for(b=0;b<W.length;b++){e=W[b];d=e.name;for(var e=e.items,f="",f=f+"<div data-role='collapsible' data-mini='true' >",f=f+("<h6>"+d+"</h6>"),f=f+"<ul data-role='listview' data-mini='true' data-inset='true' style='margin: -10px 0;'>",k=0;k<e.length;k++)var l=e[k].name,f=f+("<li data-mini='true'><a href='#' class='min_font' id='"+("MANIFEST_ITEM_"+l+"__SEPARATOR__"+d)+"'>"+l+"</a></li>");f+="</ul>";f+="</div>";c+=f}$("#"+a.id).append(c);$("#"+a.id).trigger("create");
a.addEventListener("mouseup",fa,!1)}else a.innerHTML="<p style='color: red;'>Failed loading scenes list.</p><p>Maybe a syntax error?</p>";h(p,"anim_active_object");h(p,"anim_action");h(p,"anim_cyclic");h(p,"anim_frame_current");L.set_onclick("anim_play",da);L.set_onclick("anim_stop",n);L.set_onclick("get_max_bones",g);h(S,"material_name");Y(S,"material_diffuse_color");h(S,"material_reflectivity");h(S,"material_fresnel");h(S,"material_fresnel_factor");h(S,"material_parallax_scale");h(S,"material_parallax_steps");
h(w,"material_name");h(w,"shore_smoothing");h(w,"absorb_factor");h(w,"sss_strength");h(w,"sss_width");Y(w,"water_fog_color");h(w,"water_fog_density");Y(w,"shallow_water_col");h(w,"shallow_water_col_fac");Y(w,"shore_water_col");h(w,"shore_water_col_fac");h(w,"foam_factor");h(w,"water_dynamic");h(w,"waves_height");h(w,"waves_length");h(w,"dst_noise_scale0");h(w,"dst_noise_scale1");h(w,"dst_noise_freq0");h(w,"dst_noise_freq1");h(w,"dir_min_shore_fac");h(w,"dir_freq");h(w,"dir_noise_scale");h(w,"dir_noise_freq");
h(w,"dir_min_noise_fac");h(w,"dst_min_fac");h(w,"waves_hor_fac");h(qa,"environment_energy");Y(qa,"horizon_color");Y(qa,"zenith_color");h(ra,"light_name");Y(ra,"light_color");h(ra,"light_energy");Y(K,"sky_color");h(K,"rayleigh_brightness");h(K,"mie_brightness");h(K,"spot_brightness");h(K,"scatter_strength");h(K,"rayleigh_strength");h(K,"mie_strength");h(K,"rayleigh_collection_power");h(K,"mie_collection_power");h(K,"mie_distribution");h(sa,"date");h(sa,"day_time");h(Aa,"sun_horizontal_position");h(Aa,
"sun_vertical_position");h(Ra,"max_sun_angle");L.set_onclick("run_sun",db);L.set_onclick("stop_sun",eb);h(N,"optimize_shadow_volume");h(N,"csm_near");h(N,"csm_far");h(N,"csm_lambda");h(N,"shadow_visibility_falloff");h(N,"blur_depth_size_mult");h(N,"blur_depth_edge_size");h(N,"blur_depth_diff_threshold");h(T,"ssao_quality");h(T,"ssao_radius_increase");h(T,"ssao_dithering_amount");h(T,"ssao_gauss_center");h(T,"ssao_gauss_width_square");h(T,"ssao_gauss_width_left_square");h(T,"ssao_influence");h(T,"ssao_dist_factor");
h(T,"ssao_only");h(T,"ssao_white");h(pa,"fog_density");h(pa,"fog_density1000");Y(pa,"fog_color");h(ka,"dof_distance");h(ka,"dof_front");h(ka,"dof_rear");h(ka,"dof_power");h(ka,"dof_on");h(wa,"god_rays_intensity");h(wa,"god_rays_max_ray_length");h(wa,"god_rays_steps");h(la,"brightness");h(la,"contrast");h(la,"exposure");h(la,"saturation");h(Ma,"aa_method");h(R,"sfx_mix_mode");a="true"===Q.get("sfx_mix_mode")?0:1;document.getElementById("sfx_mix_mode").options[a].selected=!0;$("#sfx_mix_mode").slider("refresh");
h(H,"anaglyph_use");a="true"===Q.get("anaglyph_use")?0:1;document.getElementById("anaglyph_use").options[a].selected=!0;$("#anaglyph_use").slider("refresh");h(Ha,"wind_dir");h(Ha,"wind_strength");h(xa,"bloom_key");h(xa,"bloom_blur");h(xa,"bloom_edge_lum");h(O,"wireframe_mode");Y(O,"wireframe_edge_color");h(G,"show_hud_debug_info");a="true"===Q.get("show_hud_debug_info")?0:1;document.getElementById("show_hud_debug_info").options[a].selected=!0;$("#show_hud_debug_info").slider("refresh");a=C();E(a,
!1,!1)},null)},gl_debug:!0,show_hud_debug_info:Ja,sfx_mix_mode:s(),show_fps:!0,alpha:!0,assets_dds_available:!ta,assets_min50_available:!ta,console_verbose:!0,all_objs_selectable:!0,physics_enabled:!0,wireframe_debug:!0},bb=0,cb=0,na=!1,Ga,W=null,ba,aa,ja,ua,ma=null,X=null,Da=function(){},Z=null,Fa=null,Va=new Float32Array(3),va=!1;f.init=function(){var a=Q.get("quality");if(a){switch(a){case "ULTRA":var b=b4w.config.P_ULTRA;break;case "HIGH":b=b4w.config.P_HIGH;break;case "LOW":b=b4w.config.P_LOW}b4w.config.set("quality",
b)}b4w.config.set("anaglyph_use","true"===Q.get("anaglyph_use"));L.init(hb)}});b4w.require("viewer_main").init();
