b4w={module:{},register:function(a,p){var b=b4w.module;if(b[a])throw Error('Module "'+a+'" already registered');b[a]=p},require:function(a){var p=b4w.require,b=b4w.module[a];if(!b)throw Error('Module "'+a+'" not found');b.wj||(b.wj={},b(b.wj,p));return b.wj},module_check:function(a){return b4w.module[a]?!0:!1}};"object"==typeof module&&module.ak&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a){function p(){if("DEBUG"==b){var a=new Date,c=a.getDate(),c=10>c?"0"+String(c):String(c),k=a.getMonth()+1,k=10>k?"0"+String(k):String(k),l=String(a.getFullYear()),e=a.getHours(),e=10>e?"0"+String(e):String(e),f=a.getMinutes(),f=10>f?"0"+String(f):String(f),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return c+"."+k+"."+l+" "+e+":"+f+":"+a}return d}var b="RELEASE",d="25.08.2014 11:51:10";a.version=function(){return"14.08"};a.type=function(){return b};a.date=p;a.timestamp=
function(){var a=p(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.ak&&b4w.module.__version(exports);b4w.module.__config=function(a,p){var b=p("__print"),d=p("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.os=d.ua(a.context);a.q={alpha_sort:!0,alpha_sort_threshold:0.1,ho:5,Fd:1E4,console_verbose:!1,do_not_load_resources:!1,rj:!1,yt:1.5,xt:10,background_color:[0,0,0,0],force_selectable:!1,all_objs_selectable:!1,Le:0.01,resolution_factor:1,ij:3,Sh:!0,show_hud_debug_info:!1,ey:!0,Ze:"DEPTH",anaglyph_use:!1,aj:!0,qh:0.5,Md:!0,glow:!0,
Zf:!0,ni:!0,yf:!0,mf:!0,Lf:!0,pf:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,Qk:1,vf:!0,eh:!0,pa:!0,kh:!0,water_dynamic:!0,shore_smoothing:!0,Vf:!0,max_bones:53,Dp:!0,precision:"highp",deferred_rendering:!0,quality:a.P_HIGH,zj:!0,Ce:!1,$u:!1};a.at=d.ua(a.q);a.ie={mb:24,dn:!1,ze:1};a.controls={Sr:[5,5,5,5],Tr:0.1,Yu:1/120};a.td={Su:15,Mo:!0,Hk:!1,Xj:!1};a.Dr=d.ua(a.td);a.xb={shaders_dir:"../../shaders/",dw:"include/",ap:"shader_texts",Xh:"built_in_data",smaa_search_texture_path:"../common/smaa_search_texture.png",
smaa_area_texture_path:"../common/smaa_area_texture.png"};a.eb={Wc:!0,Fd:60,sl:"../common/uranium.js"};a.fv=d.ua(a.eb);a.Sf={ah:1024,Ye:2048,zi:1024};a.Kv=d.ua(a.Sf);a.Uf={jx:!0,Ni:!1};a.bw=d.ua(a.Uf);a.Ar=function(){var b=a.q,c=a.eb,d=a.Sf;switch(b.quality){case a.P_ULTRA:b.Ze="DEPTH";b.shore_smoothing=!0;b.glow=!0;b.Zf=!0;b.ni=!0;b.yf=!0;b.mf=!0;b.aj=!0;b.qh=1;b.Md=!0;b.vf=!0;b.eh=!0;b.pa=!0;b.kh=!0;b.resolution_factor=1.75;d.ah=2048;d.Ye=4096;d.zi=2048;b.ij=3;b.Sh=!0;b.rj=!1;b.max_bones=53;b.precision=
"highp";b.water_dynamic=!0;b.Vf=!0;b.antialiasing=!0;b.smaa=!0;b.pf=!0;b.Lf=!0;c.Fd=120;break;case a.P_HIGH:b.Ze="DEPTH";b.shore_smoothing=!0;b.glow=!0;b.Zf=!0;b.ni=!0;b.yf=!0;b.mf=!0;b.aj=!0;b.qh=0.5;b.Md=!0;b.vf=!0;b.eh=!0;b.pa=!0;b.kh=!0;b.resolution_factor=1;d.ah=1024;d.Ye=2048;d.zi=1024;b.ij=3;b.Sh=!0;b.rj=!1;b.max_bones=53;b.precision="highp";b.water_dynamic=!0;b.Vf=!0;b.antialiasing=!0;b.smaa=!1;b.pf=!0;b.Lf=!0;c.Fd=60;break;case a.P_LOW:b.Ze="NONE",b.shore_smoothing=!1,b.glow=!1,b.Zf=!1,b.ni=
!1,b.yf=!1,b.mf=!1,b.aj=!1,b.qh=0.5,b.Md=!1,b.vf=!1,b.eh=!1,b.pa=!1,b.kh=!1,b.resolution_factor=1,d.ah=512,d.Ye=1024,d.zi=512,b.ij=2,b.Sh=!1,b.rj=!0,b.max_bones=53,b.precision="mediump",b.water_dynamic=!1,b.Vf=!1,b.antialiasing=!1,b.smaa=!1,b.pf=!1,b.Lf=!1,c.Fd=60}};a.set=function(d,c){switch(d){case "all_objs_selectable":a.q.all_objs_selectable=c;break;case "alpha":a.context.alpha=c;break;case "alpha_sort":a.q.alpha_sort=c;break;case "alpha_sort_threshold":a.q.alpha_sort_threshold=c;break;case "anaglyph_use":a.q.anaglyph_use=
c;break;case "animation_framerate":a.ie.mb=c;break;case "antialiasing":a.q.antialiasing=c;break;case "assets_dds_available":a.td.Xj=c;break;case "assets_min50_available":a.td.Hk=c;break;case "background_color":a.q.background_color=c;break;case "built_in_module_name":a.xb.Xh=c;break;case "console_verbose":a.q.console_verbose=c;break;case "context_antialias":a.context.antialias=c;break;case "deferred_rendering":a.q.deferred_rendering=c;break;case "do_not_load_resources":a.q.do_not_load_resources=c;
break;case "force_selectable":a.q.force_selectable=c;break;case "glow":a.q.glow=c;break;case "physics_enabled":a.eb.Wc=c;break;case "physics_uranium_path":a.eb.sl=c;break;case "precision":a.q.precision=c;break;case "quality":a.q.quality=c;break;case "resolution_factor":a.q.resolution_factor=c;break;case "sfx_mix_mode":a.Uf.Ni=c;break;case "shaders_dir":a.xb.shaders_dir=c;break;case "show_hud_debug_info":a.q.show_hud_debug_info=c;break;case "smaa":a.q.smaa=c;break;case "smaa_search_texture_path":a.xb.smaa_search_texture_path=
c;break;case "smaa_area_texture_path":a.xb.smaa_area_texture_path=c;break;case "wireframe_debug":a.q.wireframe_debug=c;break;default:b.error("B4W config set - property unknown: "+d)}};a.get=function(d){switch(d){case "all_objs_selectable":return a.q.all_objs_selectable;case "alpha":return a.context.alpha;case "alpha_sort":return a.q.alpha_sort;case "alpha_sort_threshold":return a.q.alpha_sort_threshold;case "anaglyph_use":return a.q.anaglyph_use;case "animation_framerate":return a.ie.mb;case "antialiasing":return a.q.antialiasing;
case "assets_dds_available":return a.td.Xj;case "assets_min50_available":return a.td.Hk;case "background_color":return a.q.background_color;case "built_in_module_name":return a.xb.Xh;case "console_verbose":return a.q.console_verbose;case "context_antialias":return a.context.antialias;case "deferred_rendering":return a.q.deferred_rendering;case "do_not_load_resources":return a.q.do_not_load_resources;case "force_selectable":return a.q.force_selectable;case "glow":return a.q.glow;case "physics_enabled":return a.eb.Wc;
case "physics_uranium_path":return a.eb.sl;case "precision":return a.q.precision;case "quality":return a.q.quality;case "resolution_factor":return a.q.resolution_factor;case "sfx_mix_mode":return a.Uf.Ni;case "shaders_dir":return a.xb.shaders_dir;case "show_hud_debug_info":return a.q.show_hud_debug_info;case "smaa":return a.q.smaa;case "smaa_search_texture_path":return a.xb.smaa_search_texture_path;case "smaa_area_texture_path":return a.xb.smaa_area_texture_path;case "wireframe_debug":return a.q.wireframe_debug;
default:b.error("B4W config get - property unknown: "+d)}};a.reset=function(){a.context=d.ua(a.os);a.q=d.ua(a.at);a.td=d.ua(a.Dr);a.eb=d.ua(a.fv);a.Sf=d.ua(a.Kv);a.Uf=d.ua(a.bw)}};b4w.module.__boundings=function(a,p){function b(a,b){for(var c=a[0],d=a[1],h=a[2],m=a[0],g=a[1],s=a[2],t=3;t<a.length;t+=3)var k=a[t],x=a[t+1],q=a[t+2],c=Math.max(c,k),d=Math.max(d,x),h=Math.max(h,q),m=Math.min(m,k),g=Math.min(g,x),s=Math.min(s,q);b.max_x=c;b.max_y=d;b.max_z=h;b.min_x=m;b.min_y=g;b.min_z=s;return b}var d=p("__util"),h=p("__tsr"),c=p("vec3"),k=new Float32Array(24);a.ps=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.Lx=
function(){return{max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.nc=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.Vm=function(a,b){var c=a.max_y,d=a.max_z,h=a.min_x,m=a.min_y,g=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,h);a.min_y=Math.min(b.min_y,m);a.min_z=Math.min(b.min_z,g)};a.Hr=b;a.Wh=function(c,e,f){f||(f=a.nc());var h;(h=k)||(h=new Float32Array(24));
var n=c.max_x,m=c.max_y,g=c.max_z,s=c.min_x,t=c.min_y;c=c.min_z;h[0]=s;h[1]=t;h[2]=c;h[3]=n;h[4]=t;h[5]=c;h[6]=n;h[7]=m;h[8]=c;h[9]=s;h[10]=m;h[11]=c;h[12]=s;h[13]=t;h[14]=g;h[15]=n;h[16]=t;h[17]=g;h[18]=n;h[19]=m;h[20]=g;h[21]=s;h[22]=m;h[23]=g;d.ih(h,e,h);return b(h,f)};a.gw=function(b,c,d){d||(d=a.nc());var h=c.min_x,k=c.max_x,m=c.min_y,g=c.max_y,s=c.min_z;c=c.max_z;h>=b.max_x||k<=b.min_x||m>=b.max_y||g<=b.min_y||s>=b.max_z||c<=b.min_z?(d.min_x=-0.1,d.max_x=0.1,d.min_y=-0.1,d.max_y=0.1,d.min_z=
-0.2,d.max_z=-0.1):(d.min_x=Math.max(b.min_x,h),d.max_x=Math.min(b.max_x,k),d.min_y=Math.max(b.min_y,m),d.max_y=Math.min(b.max_y,g),d.min_z=Math.max(b.min_z,s),d.max_z=Math.min(b.max_z,c))};a.vz=function(b,c,d){d||(d=a.nc());var h=b.max_x-b.min_x,k=b.max_y-b.min_y,m=b.max_z-b.min_z;d.min_x=b.min_x-0.5*(c-1)*h;d.max_x=b.max_x+0.5*(c-1)*h;d.min_y=b.min_y-0.5*(c-1)*k;d.max_y=b.max_y+0.5*(c-1)*k;d.min_z=b.min_z-0.5*(c-1)*m;d.max_z=b.max_z+0.5*(c-1)*m;return d};a.Mj=function(b,e,f){f||(f=a.tj());c.transformMat4(b.U,
e,f.U);f.Na=b.Na*d.Ji(e);return f};a.Lj=function(a,b,d){d||(d={je:new Float32Array(3),ke:new Float32Array(3),le:new Float32Array(3),U:new Float32Array([0,0,0])});h.Dh(a.U,b,d.U);c.copy(a.je,d.je);c.copy(a.ke,d.ke);c.copy(a.le,d.le);h.kj(d.je,b,d.je);h.kj(d.ke,b,d.ke);h.kj(d.le,b,d.le);return d};a.Tj=function(a,b){return{Na:a,U:new Float32Array(b)}};a.tj=function(){return{U:new Float32Array([0,0,0]),Na:0}};a.Sj=function(a,b,c,d){return{je:new Float32Array(a),ke:new Float32Array(b),le:new Float32Array(c),
U:new Float32Array([d[0],d[1],d[2]])}};a.Jr=function(){return{U:new Float32Array([0,0,0]),Na:1E12}};a.ot=function(a,b){var d=c.subtract(b.U,a.U,c.create());0==c.length(d)&&c.set(1,0,0,d);var h=c.normalize(d,c.create()),d=c.scale(h,a.Na,c.create());c.add(d,a.U,d);var k=c.scale(h,-a.Na,c.create());c.add(k,a.U,k);var m=c.scale(h,b.Na,c.create());c.add(m,b.U,m);var g=c.scale(h,-b.Na,c.create());c.add(g,b.U,g);d=[d,k,m,g];h=c.normalize(h,c.create());k=d[0];m=d[0];for(g=1;g<d.length;g++){var s=c.dot(d[g],
h);s<c.dot(k,h)&&(k=d[g]);s>c.dot(m,h)&&(m=d[g])}h=[k,m];d=h[0];h=h[1];a.U=c.scale(c.add(d,h,c.create()),0.5,c.create());a.Na=c.length(c.subtract(h,d,c.create()))/2};a.Hm=function(a,b){var d=b.max_y,c=b.min_y,h=Math.max(0,d-c-2*a);return{Na:a,height:h,U:new Float32Array([0,(d+c)/2,0])}};a.Jm=function(a,b){var d=b.max_y,c=b.min_y,h=Math.max(0,d-c);return{Na:a,height:h,U:new Float32Array([0,(d+c)/2,0])}};a.Im=function(a,b){var d=b.max_y,c=b.min_y,h=Math.max(0,d-c);return{Na:a,height:h,U:new Float32Array([0,
(d+c)/2,0])}};a.Yr=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.tv=function(a){for(var b=0,d=0,c=0,h=0,m=0,g=0,k=0,t=0,y=0;y<a.submeshes.length;y++){var x=a.submeshes[y];if(x.position.length){b=h=x.position[0];d=m=x.position[1];c=g=x.position[2];break}}for(y=0;y<a.submeshes.length;y++)for(var x=a.submeshes[y],x=x.position,q=0;q<x.length/3;q++)var r=x[3*q],I=x[3*q+1],A=x[3*q+2],b=Math.max(r,b),d=Math.max(I,d),
c=Math.max(A,c),h=Math.min(r,h),m=Math.min(I,m),g=Math.min(A,g),k=Math.max(Math.sqrt(r*r+I*I+A*A),k),t=Math.max(Math.sqrt(r*r+A*A),t);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=h;a.b4w_bounding_box.max_y=d;a.b4w_bounding_box.min_y=m;a.b4w_bounding_box.max_z=c;a.b4w_bounding_box.min_z=g;a.b4w_bounding_sphere_radius=k;a.b4w_bounding_cylinder_radius=t}};b4w.module.__compat=function(a,p){function b(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}var d=p("__config"),h=p("__extensions"),c=p("__print"),k=p("__util");a.Sv=function(a){var e=d.ie,f=d.q,w=Boolean(h.Wt());b("Firefox/28.0")&&(b("Linux")||b("Macintosh"))&&(c.warn("Firefox 28 detected, applying depth hack"),w=!1);if(b("iPad")||b("iPhone"))c.warn("iOS detected, applying depth hack"),w=!1,f.antialiasing=!1;if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||
navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))c.warn("Mobile detected, applying glsl loops unroll hack"),f.Ce=!0;var n=h.un();n&&(b("Macintosh")&&-1<a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(c.warn("OS X / Intel HD 3000 detected, applying depth and glsl loops unroll hacks"),w=!1,f.Ce=!0),-1<a.getParameter(n.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&
(w=!1,e.dn=!0),-1<a.getParameter(n.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(n.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&(f.precision="highp"));0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(f.zj=!1);w||(f.deferred_rendering=!1,f.vf=!1,f.eh=!1,f.pa=!1,f.kh=!1,f.water_dynamic=!1,f.shore_smoothing=!1,f.Vf=!1,f.smaa=!1);f.Dp=Boolean(h.vn());e=k.clamp(a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),128,Infinity);f.max_bones=k.lc((e-50)/4);f.fz=k.lc((e-50)/2);0===a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,
a.HIGH_FLOAT).precision&&(f.precision="mediump");b("Windows")&&(f.Qk=2.5)}};b4w.module.__constraints=function(a,p){function b(a){var b={};b.type=a;return b}function d(a,b){a.Qa&&a.Qa.J&&h(a.Qa.J,a);if(b.J){var d=b.J;if(-1==d.qd.indexOf(a))d.qd.push(a);else throw"Descendant object override is forbidden";}a.Qa=b}function h(a,b){var d=a.qd.indexOf(b);if(-1!=d)a.qd.splice(d,1);else throw"No descendant object";}function c(a,b,d){switch(b.type){case y:var c=a.d.g,f=b.J.d.G;d=b.J.d.g;b.Nd?(s.copy(b.Nd,c),s.multiply(d,c,c)):s.copy(d,c);g.transformMat4(b.offset,f,a.d.e);a.d.scale=
b.Vo*b.J.d.scale;break;case u:var h=a.d.e,c=a.d.g,f=b.J.d.G;d=b.J.d.g;s.multiply(s.invert(b.Ue,b.Ue),c,c);s.multiply(d,c,c);g.transformMat4(b.offset,f,h);s.copy(d,b.Ue);break;case z:h=a.d.e;c=a.d.g;f=b.J.d.G;d=b.J.d.g;s.multiply(s.invert(b.Ue,b.Ue),c,c);s.multiply(d,c,c);g.transformMat4(b.offset,f,h);s.copy(d,b.Ue);var c=a.d.g,h=b.J.d.g,S=g.transformQuat(m.AXIS_Y,c,H),ca=s.invert(h,E),ka=g.transformQuat(S,ca,J),X=P;X[0]=ka[0];X[1]=0;X[2]=ka[2];f=g.length(X);ca=-X[2]/f;ca=Math.acos(ca)*m.sign(X[0]);
f/=g.length(ka);f=Math.acos(f)*m.sign(ka[1]);ka=!1;ca<-b.vm&&(ca=-b.vm,ka=!0);ca>b.wm&&(ca=b.wm,ka=!0);f<-b.xm&&(f=-b.xm,ka=!0);f>b.um&&(f=b.um,ka=!0);ka&&(b=Math.sin(f),f=Math.cos(f),ka=Math.sin(ca),ca=Math.cos(ca),X=J,X[0]=f*ka,X[1]=b,X[2]=-f*ca,g.transformQuat(X,h,X),b=s.rotationTo(S,X,E),s.multiply(b,c,c),s.normalize(c,c));"CAMERA"==a.d.type&&(b=g.transformQuat(m.AXIS_Y,d,J),e(a,b));break;case F:h=a.d.e;c=a.d.g;f=b.J.d.G;ca=b.J.d.e;a=b.hw;ka=H;S=E;g.transformMat4(b.offset,f,ka);m.smooth_v(ka,
h,d,a,h);b=H;g.sub(ca,h,b);g.normalize(b,b);X=c;h=T;ca=h.subarray(0,3);f=h.subarray(3,6);ka=h.subarray(6,9);g.copy(b,f);g.negate(f,f);g.normalize(f,f);Boolean(0.999999<Math.abs(g.dot(b,m.AXIS_Y)))?(b=t.fromQuat(s.normalize(X,S),oa),g.copy(b.subarray(0,3),ca)):g.cross(m.AXIS_Y,f,ca);g.normalize(ca,ca);g.cross(ca,f,ka);g.normalize(ka,ka);s.fromMat3(h,S);s.normalize(S,S);m.bp(S,c,d,0.16*a,c);break;case x:c=a.d.g;ca=N;d=E;w(b.J,b.Nr,!0,ca,d);b.Nd?(s.copy(b.Nd,c),s.multiply(d,c,c)):s.copy(d,c);m.Dh(b.offset,
1,d,ca,a.d.e);break;case q:h=a.d.e;c=a.d.g;d=b.J.d.e;k(h,c,d);"CAMERA"==a.d.type&&e(a,m.AXIS_Y);break;case r:h=a.d.e;c=a.d.g;d=b.target;k(h,c,d);"CAMERA"==a.d.type&&e(a,m.AXIS_Y);break;case I:h=a.d.e;c=a.d.g;d=b.J.d.e;c=l(h,c,d,b.fd,Z);S=g.dist(h,d);if(b=c?S+b.fd:S>b.bh?S-b.bh:S<b.fd?S-b.fd:0)g.sub(d,h,H),g.normalize(H,H),g.scale(H,b,H),g.add(h,H,h);"CAMERA"==a.d.type&&e(a,m.AXIS_Y);break;case A:h=a.d.e;c=a.d.g;d=b.target;c=l(h,c,d,b.fd,Z);S=g.dist(h,d);if(b=c?S+b.fd:S>b.bh?S-b.bh:S<b.fd?S-b.fd:0)g.sub(d,
h,H),g.normalize(H,H),g.scale(H,b,H),g.add(h,H,h);"CAMERA"==a.d.type&&e(a,m.AXIS_Y);break;case G:f=b.J.d.G;g.transformMat4(b.offset,f,a.d.e);break;case Q:ca=b.J.d.e;h=a.d.e;g.add(ca,b.offset,h);break;case K:c=a.d.g;f=b.J.d.G;d=b.J.d.g;b.Nd?(s.copy(b.Nd,c),s.multiply(d,c,c)):s.copy(d,c);g.transformMat4(b.offset,f,a.d.e);break;case O:d=b.J.d,d=n.qf(d.e,d.scale,d.g,da),n.multiply(d,b.yp,d),h=a.d.e,h[0]=d[0],h[1]=d[1],h[2]=d[2],a.d.scale=d[3],c=a.d.g,c[0]=d[4],c[1]=d[5],c[2]=d[6],c[3]=d[7]}}function k(a,
b,d){var c=H;m.quat_to_dir(b,m.AXIS_MY,c);g.normalize(c,c);var f=J;g.subtract(d,a,f);g.normalize(f,f);a=N;s.rotationTo(c,f,a);s.multiply(a,b,b)}function l(a,b,d,c,f){var r=!1,e=H;m.quat_to_dir(b,m.AXIS_MY,e);g.normalize(e,e);var q=J;g.subtract(d,a,q);a=g.length(q);g.normalize(q,q);g.dot(e,q)<Math.cos(f)&&(g.scale(q,-1,q),r=!0);a>c-U&&(c=s.rotationTo(e,q,N),s.multiply(c,b,b),s.normalize(b,b));return r}function e(a,b){var d=a.d.g,c=f(d,b,E);s.multiply(c,d,d)}function f(a,b,d){a=t.fromQuat(a,T);var c=
H;c[0]=a[3];c[1]=a[4];c[2]=a[5];if(0.999<Math.abs(g.dot(b,c)))return s.identity(d),d;b=g.cross(b,c,c);g.normalize(b,b);0<a[7]&&(b[0]*=-1,b[1]*=-1,b[2]*=-1);c=J;c[0]=a[0];c[1]=a[1];c[2]=a[2];g.normalize(c,c);s.rotationTo(c,b,d);return d}function w(a,b,d,c,f){var r=a.d,e=r.Lg,q=r.gc[b];b=q.ki;a=a.pose.bones[q.Rk];var q=a.Tl,z=N,h=r.Bh,g=r.Ah,m=r.nh,B=r.mh,k=h[4*b+1],t=h[4*b+2],x=h[4*b+3],l=g[4*b+1],u=g[4*b+2],P=g[4*b+3];z[0]=(1-e)*h[4*b]+e*g[4*b];z[1]=(1-e)*k+e*l;z[2]=(1-e)*t+e*u;z[3]=(1-e)*x+e*P;h=
E;g=S;h[0]=m[4*b];h[1]=m[4*b+1];h[2]=m[4*b+2];h[3]=m[4*b+3];g[0]=B[4*b];g[1]=B[4*b+1];g[2]=B[4*b+2];g[3]=B[4*b+3];s.slerp(h,g,e,h);e=da;n.Yv(z,e);n.Zk(h,e);d?(d=ba,n.translate(q,a.hr,d),n.multiply(e,d,e)):n.multiply(e,q,e);n.multiply(r.Ic,e,e);c[0]=e[0];c[1]=e[1];c[2]=e[2];c[3]=e[3];f&&(f[0]=e[4],f[1]=e[5],f[2]=e[6],f[3]=e[7])}var n=p("__tsr"),m=p("__util"),g=p("vec3"),s=p("quat"),t=p("mat3");p("mat4");var y=1,x=2,q=3,r=4,I=5,A=6,G=7,Q=8,u=9,z=10,O=11,F=12,K=13;a.ux=y;a.tx=x;a.xx=q;a.yx=r;a.ox=I;
a.px=A;a.vx=G;a.nx=Q;a.sx=u;a.rx=z;a.Mc=O;a.qx=F;a.wx=K;var H=new Float32Array(3),J=new Float32Array(3),P=new Float32Array(3),N=new Float32Array(4),E=new Float32Array(4),S=new Float32Array(4),da=new Float32Array(16),ba=new Float32Array(16),T=new Float32Array(9),oa=new Float32Array(9),da=new Float32Array(8),Z=9*Math.PI/10;a.Rp=Z;var U=0.001;a.$l=function(a,f,e,r,q){var z=b(y);z.J=f;z.offset=new Float32Array(e);z.Vo=q||1;z.Nd=r?new Float32Array(r):null;d(a,z);c(a,z,0)};a.Zl=function(a,f,e,r,q){var z=
b(x);z.J=f;z.Nr=e;z.offset=new Float32Array(r);z.Nd=q?new Float32Array(q):null;d(a,z);c(a,z,0)};a.sr=function(a,f,e,r){var q=b(u),z=a.d.g,h=f.d.g;q.J=f;q.offset=new Float32Array(e);q.Ue=new Float32Array(h);r&&(s.copy(r,z),s.multiply(h,z,z));d(a,q);c(a,q,0)};a.rr=function(a,f,e,r,q,h,g,m){var k=b(z),t=a.d.g,x=f.d.g;k.J=f;k.offset=new Float32Array(e);k.Ue=new Float32Array(x);k.vm=q;k.wm=h;k.xm=g;k.um=m;r&&(s.copy(r,t),s.multiply(x,t,t));d(a,k);c(a,k,0)};a.qr=function(a,f,e,r){var q=b(F);q.J=f;q.offset=
new Float32Array(e);q.hw=r;d(a,q);c(a,q,0)};a.ur=function(a,f,e,r){var q=b(K);q.J=f;q.offset=new Float32Array(e);q.Vo=1;q.Nd=r?new Float32Array(r):null;d(a,q);c(a,q,0)};a.wr=function(a,f){var e=b(q);e.J=f;d(a,e);c(a,e,0)};a.xr=function(a,f){var e=b(r);e.target=new Float32Array(f);d(a,e);c(a,e,0)};a.nr=function(a,f,e,r){var q=b(I);q.J=f;q.fd=e;q.bh=r;d(a,q);c(a,q,0)};a.or=function(a,f,e,r){var q=b(A);q.target=new Float32Array(f);q.fd=e;q.bh=r;d(a,q);c(a,q,0)};a.tr=function(a,f,e){var r=b(G);r.J=f;
r.offset=new Float32Array(e);d(a,r);c(a,r,0)};a.mr=function(a,f,e){var r=b(Q);r.J=f;r.offset=new Float32Array(e);d(a,r);c(a,r,0)};a.lr=function(a,f,e){var r=b(O);r.J=f;r.yp=new Float32Array(e);d(a,r);c(a,r,0)};a.Qw=function(a,b){a.Qa&&c(a,a.Qa,b)};a.Dv=k;a.Ev=l;a.correct_up=e;a.Nx=f;a.remove=function(a){a.Qa.J&&h(a.Qa.J,a);a.Qa=null};a.get_type=function(a){return a.Qa?a.Qa.type:null};a.By=function(a){return a.Qa&&a.Qa.J?a.Qa.J:null};a.Zc=function(a){return a.Qa&&a.Qa.type==O?a.Qa.yp:null};a.Tt=w};b4w.module.__controls=function(a,p){function b(a){var b={};b.type=a;b.value=0;b.Zb=null;b.Dk=null;b.Ck=null;b.Ii=null;return b}function d(a,b){var d;if(a.Ii){d=a.Dk;for(var c=a.Ck,f=0;f<d.length;f++)c[f]=d[f].value;d=a.Ii(c)}else d=!1;d||(a.value=Number(b))}function h(a){a=x.indexOf(a);-1<a?x.splice(a,1):w.error("Wrong object")}function c(a,b){for(var d=0,c=0;c<b.length;c++){var f=b[c],e=f.ub,r;for(r in e)for(var e=f.ub[r].kd,q=0;q<e.length;q++)e[q]===a&&d++}return d}function k(a,b){switch(a.type){case P:n.remove_collision_test(a.is,
a.Tb,a.Am);break;case N:n.clear_collision_impulse_test(a.zm);break;case E:n.remove_ray_test(a.xh,a.Tb,a.uw,a.nt,a.Lu)}var d=b.indexOf(a);-1<d&&b.splice(d,1)}function l(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]}function e(a){var b=a[0],d=a[1];a=b.pageX;var b=b.pageY,c=d.pageX,d=d.pageY;return Math.sqrt((a-c)*(a-c)+(b-d)*(b-d))}var f=p("__config"),w=p("__print"),n=p("__physics"),m=p("__scenes"),g=p("__util"),s=p("vec3"),t=p("quat"),y=f.controls,x=[],q=[],r=0,I=0,A=0,G=
0,Q=0,u=0,z=0,O=0,F=0,K=0,H=0,J=0,P=80,N=90,E=100;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=40;a.update=function(b,c){J=b;m.get_active();for(var f=0;f<q.length;f++){var e=q[f],h=b,k=c;if(k)switch(m.get_active(),e.type){case 110:var l=e.xh,P=l.d.e,l=l.d.g,E=s.dist(e.Ch,P),L=e.ov;t.invert(e.Sk,L);t.multiply(l,L,L);t.normalize(L,L);L=Math.abs(2*Math.acos(L[3]));E/=k;e.Ej=g.smooth(E,e.Ej,k,0.3);e.Zb[0]=E;E=L/k;e.Dj=g.smooth(E,e.Dj,k,0.3);e.Zb[1]=E;e.Ej>=e.threshold||e.Dj>=e.Fv?d(e,1):
d(e,0);s.copy(P,e.Ch);t.copy(l,e.Sk);e.dc=h;break;case 120:l=e.xh;P=l.d.e;l=Math.abs(P[1]-e.Ch[1])/k;e.Fj=g.smooth(l,e.Fj,k,0.3);e.Zb=l;e.Fj>=e.threshold?d(e,1):d(e,0);s.copy(P,e.Ch);e.dc=h;break;case 130:h-e.dc>=e.Xi&&(d(e,1),e.dc=h);break;case 140:e.dc||(e.dc=h);d(e,h-e.dc);e.dc=h;break;case 150:d(e,h)}}for(f=0;f<x.length;f++){var e=x[f],v;for(v in e.ub){k=h=e.ub[v];P=k.kd;l=k.Nv;for(E=0;E<P.length;E++)l[E]=P[E].value;k=k.Mu(l);P=h.Yn;E=l=void 0;switch(h.type){case a.CT_CONTINUOUS:k?E=l=1:1==P?
E=l=-1:l=0;break;case a.CT_TRIGGER:k&&-1==P?E=l=1:k||1!=P?l=0:E=l=-1;break;case a.CT_SHOT:k&&-1==P?E=l=1:k||1!=P?l=0:(l=0,E=-1);break;case a.CT_LEVEL:l=h.Xn!=k?1:0;break;default:throw"Wrong sensor manifold type: "+h.type;}E&&(h.Yn=E);if(P=l)h.callback(e,v,P,h.Rr),h.Xn=k}}for(f=0;f<x.length;f++)for(v in e=x[f],e.ub)for(h=e.ub[v],h=h.kd,k=0;k<h.length;k++)switch(P=h[k],P.type){case 30:d(P,0);break;case 40:d(P,0);break;case 60:d(P,0);break;case 70:d(P,0);break;case 130:d(P,0)}r=0;G=I;Q=A;O=u;F=z;H=K};
a.create_custom_sensor=function(a){var c=b(10);d(c,a);return c};a.create_keyboard_sensor=function(a){var d=b(20);d.key=a;return d};a.create_collision_sensor=function(a,c,e){if(!a||!a.k)return w.error("Wrong collision object"),null;var f=b(P);f.is=a;f.Tb=c||null;f.Am=function(a,b){d(f,a);a&&b&&e&&(f.Zb=f.Zb||new Float32Array(3),f.Zb[0]=b[0],f.Zb[1]=b[1],f.Zb[2]=b[2])};n.append_collision_test(a,f.Tb,f.Am,e);return f};a.create_collision_impulse_sensor=function(a){if(!a||!a.k)return w.error("Wrong collision impulse object"),
null;var c=b(N);c.zm=a;c.hs=function(a){d(c,a)};n.apply_collision_impulse_test(c.zm,c.hs);return c};a.create_ray_sensor=function(a,c,e,f,r){if(!a)return w.error("Wrong collision object"),null;var q=b(E);q.xh=a;q.uw=c;q.nt=e;q.Lu=f;q.Tb=r;q.rv=function(a,b){d(q,a);a&&(q.Zb=b)};n.append_ray_test(a,q.Tb,c,e,f,q.rv);return q};a.create_mouse_click_sensor=function(){return b(50)};a.create_mouse_wheel_sensor=function(){return b(30)};a.create_mouse_move_sensor=function(a){var c=b(40);c.axis=a||"XY";return c};
a.create_touch_move_sensor=function(a){var c=b(60);c.axis=a||"XY";return c};a.create_touch_zoom_sensor=function(){return b(70)};a.create_motion_sensor=function(a,c,d){if(!a)return w.error("Wrong collision object"),null;var e=b(110);e.xh=a;var f=a.d.e;a=a.d.g;e.ov=new Float32Array(4);e.Ch=new Float32Array(f);e.Sk=new Float32Array(a);e.Ej=0;e.Dj=0;e.threshold=c;e.Fv=d;e.dc=0;e.Zb=new Float32Array([0,0]);return e};a.create_vertical_velocity_sensor=function(a,c){if(!a)return w.error("Wrong collision object"),
null;var d=b(120);d.xh=a;var e=a.d.g;d.Ch=new Float32Array(a.d.e);d.Sk=new Float32Array(e);d.Fj=0;d.threshold=c;d.dc=0;d.Zb=0;return d};a.create_timer_sensor=function(a){var c=b(130);c.Xi=a;c.dc=J;return c};a.reset_timer_sensor=function(a,b,c,d){d=d||0;a=a.ub;if(!a||!a[b])return w.error("reset_timer_sensor(): wrong object"),null;b=a[b].kd[c];if(!b)return w.error("reset_timer_sensor(): sensor not found"),null;b.dc=J+d};a.create_elapsed_sensor=function(){var a=b(140);a.dc=0;return a};a.create_timeline_sensor=
function(){return b(150)};a.create_selection_sensor=function(a){var c=b(160);c.obj=a;return c};a.Mv=d;a.cleanup=function(){x=[];q=[];J=0};a.check_sensor_manifold=function(a,b){if(b)for(var c in a.ub){if(c===b)return!0}else for(c in a.ub)return!0;return!1};a.remove_sensor_manifold=function(a,b){var d=a.ub;if(b){var e=d[b];if(e){for(var e=e.kd,f=0;f<e.length;f++)1===c(e[f],x)&&k(e[f],q);delete d[b];Object.getOwnPropertyNames(d).length||h(a)}}else{for(var r in d){e=d[r];e=e.kd;for(f=0;f<e.length;f++)1===
c(e[f],x)&&k(e[f],q);delete d[r]}h(a)}};a.create_sensor_manifold=function(a,b,c,d,e,f,r){a.ub=a.ub||{};var z={};z.name=name;z.type=c;z.kd=d.slice(0);z.Mu=e||l;z.Nv=Array(d.length);z.callback=f;z.Rr=r||null;z.Yn=-1;z.Xn=0;a.ub[b]=z;-1==x.indexOf(a)&&x.push(a);a=z.kd;for(b=0;b<a.length;b++)c=a[b],-1==q.indexOf(c)&&q.push(c)};a.$s=l;a.reset=function(){for(var a=0;a<x.length;a++){var b=x[a].ub,c;for(c in b)delete b[c]}for(a=0;a<q.length;a++)k(q[a],q),a--;x.splice(0,x.length)};a.debug=function(){m.get_active();
w.log(String(x.length)+" objects with manifolds",x);w.log(String(q.length)+" sensors",q);for(var a=[],b=[],c=0;c<q.length;c++){var d=q[c];d.type==P&&a.push(d);d.type==E&&b.push(d)}w.log(String(a.length)+" collision sensors",a);w.log(String(b.length)+" ray sensors",b)};a.keydown_cb=function(a){for(var b=0;b<q.length;b++){var c=q[b];20==c.type&&a.keyCode==c.key&&d(c,1)}};a.keyup_cb=function(a){for(var b=0;b<q.length;b++){var c=q[b];20==c.type&&0==a.keyCode&&16==c.key&&d(c,0);20==c.type&&a.keyCode==
c.key&&d(c,0)}};a.mouse_down_cb=function(a){for(var b=!1,c=null,e=0;e<q.length;e++){var f=q[e];50==f.type&&d(f,1);160==f.type&&(b||(c=m.pick_object(a.clientX,a.clientY),b=!0),f.value=c==f.obj)}a.preventDefault()};a.mouse_up_cb=function(a){for(var b=0;b<q.length;b++){var c=q[b];50==c.type&&d(c,0)}a.preventDefault()};a.mouse_wheel_cb=function(a){var b=a.wheelDelta||-40*a.detail,b=b*y.Yu;r+=b;for(b=0;b<q.length;b++){var c=q[b];30===c.type&&d(c,r)}a.preventDefault()};a.mouse_move_cb=function(a){var b=
a.clientX,c=a.clientY;I=b;A=c;for(var b=b-G,c=c-Q,e=Math.sqrt(b*b+c*c),f=0;f<q.length;f++){var r=q[f];if(40===r.type)switch(r.axis){case "X":d(r,b);break;case "Y":d(r,c);break;case "XY":d(r,e)}}a.preventDefault()};a.touch_start_cb=function(a){a=a.targetTouches;if(1==a.length){var b=a[0];a=b.pageX;for(var b=b.pageY,c=!1,d=null,f=0;f<q.length;f++){var r=q[f];160==r.type&&(c||(d=m.pick_object(a,b),c=!0),r.value=d==r.obj)}u=O=a;z=F=b}else 1<a.length&&(K=H=e(a))};a.touch_move_cb=function(a){var b=a.targetTouches;
if(0!==b.length){if(1===b.length){var c=b[0],b=c.pageX,c=c.pageY;u=b;z=c;for(var b=b-O,f=c-F,r=Math.sqrt(b*b+f*f),c=0;c<q.length;c++){var h=q[c];if(60===h.type)switch(h.axis){case "X":d(h,b);break;case "Y":d(h,f);break;case "XY":d(h,r)}}}else if(1<b.length)for(K=e(b),b=K-H,c=0;c<q.length;c++)h=q[c],70===h.type&&d(h,b);a.preventDefault()}}};b4w.module.__curve=function(a,p){function b(a,b,c,d,h){var n=d.length;h||(h=new Float32Array(n));for(var m=n+a,g=new Float32Array(m),s=1;s<=m-1;s++)g[s-1]=b>=c[s-1]&&b<c[s+1-1]?1:0;for(var t=2;t<=a;t++)for(s=1;s<=m-t;s++)g[s-1]=(0!=g[s-1]?(b-c[s-1])*g[s-1]/(c[s+t-1-1]-c[s-1]):0)+(0!=g[s+1-1]?(c[s+t-1]-b)*g[s+1-1]/(c[s+t-1]-c[s+1-1]):0);b==c[m-1]&&(g[n-1]=1);a=0;for(s=1;s<=n;s++)a+=g[s-1]*d[s-1];for(s=1;s<=n;s++)h[s-1]=0!=a?g[s-1]*d[s-1]/a:0;return h}function d(a){a=a.Gi;return a[a.length-1]}function h(a){a=
a.Om;return a[a.length-1]}var c=p("__util");a.Os=function(a){var c={},d=a.data;a=d.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var f=a.order_u;c.Jd=f;a=a.points;var h=a.length/5,n=[],m=h+f,h=h+2;n[0]=0;for(var g=2;g<=m;g++)n[g-1]=g>f&&g<h?n[g-2]+1:n[g-2];c.Gi=n;if("2D"==d.dimensions)c.Ed=!1;else if("3D"==d.dimensions)c.Ed=!0;else throw"Wrong curve dimensions";f=[];n=[];for(d=0;d<a.length;d+=5)f.push(a[d]),f.push(a[d+1]),f.push(a[d+2]),c.Ed&&f.push(a[d+3]),n.push(a[d+4]);c.Rj=
f;c.zl=n;a=[];for(var d=c.Rj,f=c.Ed?4:3,n=c.zl,m=c.Gi,h=c.Jd,g=d.length/f,s=g+h,t=0,y=m[s-1]/999,x=0;1E3>x;x++){5E-6>m[s-1]-t&&(t=m[s-1]);for(var q=b(h,t,m,n),r=0;r<f;r++)for(var I=a[f*x+r]=0;I<g;I++)a[f*x+r]+=q[I]*d[f*I+r];t+=y}f=c.Ed?4:3;n=new Float32Array(1E3);n[0]=0;for(d=1;1E3>d;d+=1)m=a[(d-1)*f],h=a[(d-1)*f+1],g=a[(d-1)*f+2],s=a[d*f],t=a[d*f+1],y=a[d*f+2],n[d]=n[d-1]+Math.sqrt((s-m)*(s-m)+(t-h)*(t-h)+(y-g)*(y-g));c.Om=n;return c};a.qw=function(a,c,e){e||(e=[]);var f=c,h=Math.max(f,0);c=h=Math.min(f,
d(a));var f=a.Rj,h=a.Ed?4:3,n=a.zl,m=a.Gi,g=a.Jd;a=f.length/h;var s=a+g;5E-6>m[s-1]-c&&(c=m[s-1]);s=new Float32Array(a);b(g,c,m,n,s);for(c=0;c<h;c++)for(n=e[c]=0;n<a;n++)e[c]+=s[n]*f[h*n+c]};a.nw=function(a,b,c){c||(c=[]);var d=a.Rj,h=a.Ed?4:3,n=a.zl,m=a.Gi,g=a.Jd;a=d.length/h;var s=a+g;5E-6>m[s-1]-b&&(b=m[s-1]);var s=new Float32Array(a),t=b;b=s;var y=n.length;b||(b=new Float32Array(y));var x=new Float32Array(y),q=new Float32Array(y),r=x,I=q;r||(r=new Float32Array(y));I||(I=new Float32Array(y));for(var A=
y+g,G=new Float32Array(A),Q=new Float32Array(A),u=1;u<=A-1;u++)G[u-1]=t>=m[u-1]&&t<m[u+1-1]?1:0;t==m[A-1]&&(G[y-1]=1);for(var z=2;z<=g;z++)for(u=1;u<=A-z;u++){var O=0!=G[u-1]?G[u-1]/(m[u+z-1-1]-m[u-1]):0,F=0!=G[u+1-1]?-G[u+1-1]/(m[u+z-1]-m[u+1-1]):0,K=0!=Q[u-1]?(t-m[u-1])*Q[u-1]/(m[u+z-1-1]-m[u-1]):0,H=0!=Q[u+1-1]?(m[u+z-1]-t)*Q[u+1-1]/(m[u+z-1]-m[u+1-1]):0;G[u-1]=(0!=G[u-1]?(t-m[u-1])*G[u-1]/(m[u+z-1-1]-m[u-1]):0)+(0!=G[u+1-1]?(m[u+z-1]-t)*G[u+1-1]/(m[u+z-1]-m[u+1-1]):0);Q[u-1]=O+F+K+H}for(u=1;u<=
y;u++)r[u-1]=G[u-1],I[u-1]=Q[u-1];m=0;for(g=1;g<=y;g++)m+=x[g-1]*n[g-1];t=0;for(g=1;g<=y;g++)t+=q[g-1]*n[g-1];for(g=1;g<=y;g++)b[g-1]=0!=m?q[g-1]*n[g-1]/m+x[g-1]*n[g-1]*t/(m*m):0;for(n=0;n<h;n++)for(m=c[n]=0;m<a;m++)c[n]+=s[m]*d[h*m+n]};a.tz=d;a.pw=h;a.ow=function(a,b){if(0>=b)return 0;var e=d(a);if(b>=h(a))return e;var f=a.Om,w=c.Uh(f,b,0,f.length-1);return e*(w+(b-f[w])/(f[w+1]-f[w]))/1E3}};b4w.module.__dds=function(a,p){function b(a,b,c,d){var f=new Uint16Array(4),e=new Uint16Array(c*d),r=0,q=0,h=0,g=q=r=0,m=0,t=0,s=0,x=c/4;d/=4;for(var k=0;k<d;k++)for(var l=0;l<x;l++)h=b+4*(k*x+l),f[0]=a[h],f[1]=a[h+1],r=f[0]&31,q=f[0]&2016,g=f[0]&63488,m=f[1]&31,t=f[1]&2016,s=f[1]&63488,f[2]=5*r+3*m>>3|5*q+3*t>>3&2016|5*g+3*s>>3&63488,f[3]=5*m+3*r>>3|5*t+3*q>>3&2016|5*s+3*g>>3&63488,r=a[h+2],q=4*k*c+4*l,e[q]=f[r&3],e[q+1]=f[r>>2&3],e[q+2]=f[r>>4&3],e[q+3]=f[r>>6&3],q+=c,e[q]=f[r>>8&3],e[q+1]=f[r>>
10&3],e[q+2]=f[r>>12&3],e[q+3]=f[r>>14],r=a[h+3],q+=c,e[q]=f[r&3],e[q+1]=f[r>>2&3],e[q+2]=f[r>>4&3],e[q+3]=f[r>>6&3],q+=c,e[q]=f[r>>8&3],e[q+1]=f[r>>10&3],e[q+2]=f[r>>12&3],e[q+3]=f[r>>14];return e}function d(a,c,d,h){var F=new Int32Array(d,0,s),K,H,J,P,N,E;if(F[t]!=e)return l.error("Invalid magic number in DDS header"),0;if(!F[A]&w)return l.error("Unsupported format, must contain a FourCC code"),0;K=F[G];switch(K){case n:H=8;J=c?c.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case m:H=16;J=c?c.COMPRESSED_RGBA_S3TC_DXT3_EXT:
null;break;case g:H=16;J=c?c.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return l.error("Unsupported FourCC code:",k(K)),null}E=1;F[x]&f&&!1!==h&&(E=Math.max(1,F[I]));P=F[r];N=F[q];F=F[y]+4;if(c)for(K=0;K<E;++K)h=Math.max(4,P)/4*Math.max(4,N)/4*H,c=new Uint8Array(d,F,h),a.compressedTexImage2D(a.TEXTURE_2D,K,J,P,N,0,c),F+=h,P=Math.max(0.5*P,1),N=Math.max(0.5*N,1);else if(K==n)Math.max(4,P),Math.max(4,N),c=new Uint16Array(d),d=b(c,F/2,P,N),a.texImage2D(a.TEXTURE_2D,0,a.RGB,P,N,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,
d),h&&a.generateMipmap(a.TEXTURE_2D);else return l.error("No manual decoder for",k(K),"and no native support"),0;return E}function h(a,b,c,f,e,r){var q=new XMLHttpRequest;q.open("GET",c,!0);q.responseType="arraybuffer";q.onload=function(){if(200==q.status){a.bindTexture(a.TEXTURE_2D,f);var c=d(a,b,q.response,e);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<c?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}r&&r(f)};q.send(null);return f}function c(a){return a.charCodeAt(0)+
(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function k(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var l=p("__print"),e=542327876,f=131072,w=4,n=c("DXT1"),m=c("DXT3"),g=c("DXT5"),s=31,t=0,y=1,x=2,q=3,r=4,I=7,A=20,G=21;a.gy=b;a.Zw=d;a.An=function(a){a=new Int32Array(a,0,s);return{width:a[r],height:a[q]}};a.Vt=function(a){var b=1;a=(new Int32Array(a,0,s))[G];switch(a){case n:b=6;break;case m:case g:b=4;break;default:l.error("Unsupported FourCC code:",k(a))}return b};
a.Yy=h;a.Xy=function(a,b,c,d){var f=a.createTexture();h(a,b,c,f,!0,d);return f}};b4w.module.__debug=function(a,p){function b(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function d(a,b){typeof a!=typeof b&&l.Pf("Structure assertion failed: incompatible types");for(var c in a)c in b||l.Pf("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||l.Pf("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&l.Pf("Structure assertion failed: incompatible types for key "+c)}var h=
p("__extensions"),c=p("__print"),k=p("__textures"),l=p("__util"),e=null,f={},w=!1,n={},m=[],g=-1,s=null,t=!1;a.Nl={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.kc=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var d=b[c];d in a&&(f[a[d]]=d)}e=a};a.bs=function(a){if(w){var b=e.getError();if(b!=e.NO_ERROR){if(b in f)throw"B4W Error: "+b+", gl."+f[b]+
" ("+a+")";throw"Unknown GL error: "+b+" ("+a+")";}}};a.Zr=function(){if(w)switch(e.checkFramebufferStatus(e.FRAMEBUFFER)){case e.FRAMEBUFFER_COMPLETE:break;case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:c.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:c.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:c.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case e.FRAMEBUFFER_UNSUPPORTED:c.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:c.error("B4W Error: FRAMEBUFFER CHECK FAILED")}};a.sm=function(){if(-1!=g)return g;e.bindFramebuffer(e.FRAMEBUFFER,e.createFramebuffer());var a=k.ii("DEBUG",k.xg);k.resize(a,1,1);e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,a.qb,a.Ba,0);e.checkFramebufferStatus(e.FRAMEBUFFER)!=e.FRAMEBUFFER_COMPLETE?(g=!0,c.warn("B4W warning: depth-only issue was found")):g=!1;e.bindFramebuffer(e.FRAMEBUFFER,
null);return g};a.cs=function(a,d,f){if(w&&!e.getShaderParameter(a,e.COMPILE_STATUS))throw f=b(f),c.error("B4W Error: shader compilation failed:\n"+f+"\n"+e.getShaderInfoLog(a)+" ("+d+")"),"Engine failed: see above for error messages";};a.ds=function(a,d,f,g,m,t){if(w&&!e.getProgramParameter(a,e.LINK_STATUS)){var s=h.nn();s&&(m=s.getTranslatedShaderSource(f),t=s.getTranslatedShaderSource(g));m=b(m);t=b(t);c.error("B4W Error: shader linking failed:\n"+m+"\n\n\n"+t+"\n"+e.getProgramInfoLog(a)+" ("+
d+")");throw"Engine failed: see above for error messages";}};a.set_check_gl_errors=function(a){w=a};a.hy=function(a){n[a]=a in n?n[a]+1:1};a.update=function(){for(var a in n)c.log(a,n[a]),n[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(l.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}m.push(a)};a.msg=function(){for(var a=1,b=0;b<m.length;b++){var c=m[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=
arguments[b],l.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);m.push(c)};var y=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,d={},f=Math.max(0,performance.now()-1E3*a),e=0;e<m.length;e++){var h=m[e];a=h[0];if(!(a<f)){var g=String(h[1]);d[g]||(d[g]=y[b++%y.length]);a=["%c"+(a/1E3).toFixed(6),d[g],g];for(g=2;g<h.length;g++)a.push(h[g]);c.log.apply(this,a)}}m.splice(0)};a.plot_telemetry=
function(a){a||(a=1);for(var b={},d=Math.max(0,performance.now()-1E3*a),f=0;f<m.length;f++){var e=m[f];a=e[0];if(!(a<d))for(var h=2;h<e.length;h++){var g=String(e[1]);3<e.length&&(g+="_"+String(h-2));b[g]||(b[g]=g+"\n");b[g]+=String(a)+" "+e[h]+"\n"}}a="";for(g in b)a+=b[g]+"\n\n";c.log(a);m.splice(0)};a.Px=function(a){function b(a){return-1<c.indexOf(a)?!0:!1}var c=navigator.userAgent.toLowerCase();switch(a.toLowerCase()){case "chrome":return b("mozilla")&&b("applewebkit")&&b("chrome");case "firefox":return b("mozilla")&&
b("gecko")&&b("firefox");case "msie":return b("mozilla")&&b("trident")&&b("msie");case "opera":return b("opera")&&b("presto");case "safari":return b("mozilla")&&b("applewebkit")&&b("safari")&&!b("chrome");default:return!1}};a.check_finite=function(a){if(l.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.Jx=function(a,b){typeof a!=b&&l.Pf("Type assertion failed: value type is not a {"+b+"}:",a)};a.Hx=d;a.Ix=function(a){t?d(a,
s):t=!0;s=a}};b4w.module.__extensions=function(a,p){function b(a){if(a in c)return c[a];var b=h.getExtension(a)||null;c[a]=b;d.log("%cGET EXTENSION","color: #"+(b?"0a0":"a00"),a);return b}var d=p("__print"),h=null,c={};a.kc=function(a){h=a};a.vn=function(){return b("WEBGL_compressed_texture_s3tc")||b("WEBKIT_WEBGL_compressed_texture_s3tc")||b("MOZ_WEBGL_compressed_texture_s3tc")};a.Wt=function(){return b("WEBGL_depth_texture")||b("WEBKIT_WEBGL_depth_texture")||b("MOZ_WEBGL_depth_texture")};a.Qt=function(){return b("EXT_texture_filter_anisotropic")||
b("WEBKIT_EXT_texture_filter_anisotropic")||b("MOZ_EXT_texture_filter_anisotropic")};a.nn=function(){return b("WEBGL_debug_shaders")};a.un=function(){return b("WEBGL_debug_renderer_info")};a.on=function(){return b("OES_element_index_uint")};a.bu=function(){return b("OES_standard_derivatives")};a.cleanup=function(){c={}}};b4w.module.__graph=function(a){function p(a,c,d){d||(d=null);if(b(a,c))throw"Graph already has node with given ID";a.xa.push(c,d)}function b(a,b){for(var c=a.xa,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function d(a,c,d,f){f||(f=null);if(b(a,c)&&b(a,d))a.na.push(c,d,f);else throw"Wrong node IDs";}function h(a,c){if(!b(a,c))throw"Node not found";for(var d=a.xa,f=0;f<d.length;f+=2)d[f]==c&&(d.splice(f,2),f-=2)}function c(a){a=a.xa;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}
function k(a,b){for(var c=a.xa,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return z}function l(a){var b=[],c={};e(a,c);for(var d=a.xa,r=0;r<d.length;r+=2)0==q(a,d[r])&&f(a,d[r],c,b);return{xa:b,na:a.na.slice(0)}}function e(a,b){for(var c=a.xa,d=0;d<c.length;d+=2)b[c[d]]=!1}function f(a,b,c,d){if(!c[b]){c[b]=!0;for(var e=0;e<x(a,b);e++)f(a,r(a,b,e),c,d);d.unshift(b,y(a,b))}}function w(a,b,c,d){if(!c[b]){c[b]=!0;if(d==F||d==H)for(var f=0;f<x(a,b);f++){var e=r(a,b,f);w(a,e,c,d)}if(d==K||d==H)for(f=
0;f<q(a,b);f++)e=I(a,b,f),w(a,e,c,d)}}function n(a){var b=a.xa;a=a.na;for(var c=[],d=[],f=[],e=0;e<b.length;e++)f[b[2*e]]=e,c.push(e,b[2*e+1]);for(e=0;e<a.length;e+=3)d.push(f[a[e]],f[a[e+1]],a[e+2]);return{xa:c,na:d}}function m(a,b,c){if(c.uc==c.Hd){for(var d=0,f=0;d<c.Hd;d++)c.Rc[d]!=z&&(a[f]=d,b[f]=c.Rc[d],f++);return!0}if(c.Hd>c.Mf||c.Sd>c.Td||c.kg>c.mg||c.jg>c.lg)return!1;for(var f=d=z,e=!1;!e&&g(c,J,d,f);)if(d=J[0],f=J[1],s(c,d,f)){var h;h=c;e={};e.Og=h.Og;e.Pg=h.Pg;e.Lk=h.Lk;e.qi=h.qi;e.Hd=
h.Hd;e.Mf=h.Mf;e.Jd=h.Jd;e.uc=e.Ri=h.uc;e.jg=h.jg;e.kg=h.kg;e.Sd=h.Sd;e.lg=h.lg;e.mg=h.mg;e.Td=h.Td;e.Ag=z;e.Rc=h.Rc;e.qe=h.qe;e.Fe=h.Fe;e.Ge=h.Ge;e.Qe=h.Qe;e.Re=h.Re;e.ej=h.ej;h.ej[0]+=1;var e=h=e,k=d,l=f,u=e.Og,O=e.Pg,H=e.Hd,L=e.Mf,v=e.Rc,M=e.qe,w=e.Fe,y=e.Ge,n=e.Qe,F=e.Re;t(k<H);t(l<L);t(e.uc<H);t(e.uc<L);H=++e.uc;e.Ag=k;w[k]||(w[k]=H,e.jg++,n[k]&&e.Sd++);n[k]||(n[k]=H,e.kg++,w[k]&&e.Sd++);y[l]||(y[l]=H,e.lg++,F[l]&&e.Td++);F[l]||(F[l]=H,e.mg++,y[l]&&e.Td++);v[k]=l;M[l]=k;for(v=0;v<q(u,k);v++)M=
I(u,k,v),w[M]||(w[M]=H,e.jg++,n[M]&&e.Sd++);for(v=0;v<x(u,k);v++)M=r(u,k,v),n[M]||(n[M]=H,e.kg++,w[M]&&e.Sd++);for(v=0;v<q(O,l);v++)M=I(O,l,v),y[M]||(y[M]=H,e.lg++,F[M]&&e.Td++);for(v=0;v<x(O,l);v++)M=r(O,l,v),F[M]||(F[M]=H,e.mg++,y[M]&&e.Td++);e=m(a,b,h);t(1>=h.uc-h.Ri);t(h.Ag!=z);M=h.Og;k=h.Pg;l=h.uc;u=h.Ag;O=h.Rc;w=h.qe;H=h.Fe;y=h.Ge;L=h.Qe;n=h.Re;if(h.Ri<l){H[u]==l&&(H[u]=0);for(F=0;F<q(M,u);F++)v=I(M,u,F),H[v]==l&&(H[v]=0);L[u]==l&&(L[u]=0);for(F=0;F<x(M,u);F++)v=r(M,u,F),L[v]==l&&(L[v]=0);M=
O[u];y[M]==l&&(y[M]=0);for(F=0;F<q(k,M);F++)v=I(k,M,F),y[v]==l&&(y[v]=0);n[M]==l&&(n[M]=0);for(F=0;F<x(k,M);F++)v=r(k,M,F),n[v]==l&&(n[v]=0);O[u]=z;w[M]=z;h.uc=h.Ri;h.Ag=z}}return e}function g(a,b,c,d){c==z&&(c=0);d==z?d=0:d++;var e=a.Sd,f=a.Td,r=a.kg,h=a.mg,q=a.jg,g=a.lg,m=a.uc,t=a.Hd,L=a.Mf,v=a.Rc,s=a.qe,k=a.Fe,l=a.Ge,u=a.Qe,H=a.Re;if(e>m&&f>m)for(;c<t&&(v[c]!=z||0==u[c]||0==k[c]);)c++,d=0;else if(r>m&&h>m)for(;c<t&&(v[c]!=z||0==u[c]);)c++,d=0;else if(q>m&&g>m)for(;c<t&&(v[c]!=z||0==k[c]);)c++,
d=0;else if(0==c&&a.Jd!=O){for(k=0;k<t&&v[c=a.Jd[k]]!=z;)k++;k==t&&(c=t)}else for(;c<t&&v[c]!=z;)c++,d=0;if(e>m&&f>m)for(;d<L&&(s[d]!=z||0==H[d]||0==l[d]);)d++;else if(r>m&&h>m)for(;d<L&&(s[d]!=z||0==H[d]);)d++;else if(q>m&&g>m)for(;d<L&&(s[d]!=z||0==l[d]);)d++;else for(;d<L&&s[d]!=z;)d++;return c<t&&d<L?(b[0]=c,b[1]=d,!0):!1}function s(a,b,c){var d=a.Og,e=a.Pg,f=a.Mf,h=a.Rc,g=a.qe,m=a.Fe,s=a.Ge,k=a.Qe,l=a.Re;t(b<a.Hd);t(c<f);t(h[b]==z);t(g[c]==z);if(!(0,a.Lk)(y(d,b),y(e,c)))return!1;for(var L=f=
0,v=0,u=0,H=0,O=0,w=0;w<x(d,b);w++){var n=r(d,b,w);if(h[n]!=z){var F=h[n];if(!A(e,c,F)||!G(a.qi,d,b,n,e,c,F))return!1}else m[n]&&v++,k[n]&&f++,m[n]||k[n]||H++}for(w=0;w<q(d,b);w++)if(n=I(d,b,w),h[n]!=z){if(F=h[n],!A(e,F,c)||!G(a.qi,d,n,b,e,F,c))return!1}else m[n]&&v++,k[n]&&f++,m[n]||k[n]||H++;for(w=0;w<x(e,c);w++)if(F=r(e,c,w),g[F]!=z){if(n=g[F],!A(d,b,n))return!1}else s[F]&&u++,l[F]&&L++,s[F]||l[F]||O++;for(w=0;w<q(e,c);w++)if(F=I(e,c,w),g[F]!=z){if(n=g[F],!A(d,n,b))return!1}else s[F]&&u++,l[F]&&
L++,s[F]||l[F]||O++;return v<=u&&f<=L&&H<=O}function t(a){if(!a)throw"Assertion failed";}function y(a,b){for(var c=a.xa,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function x(a,b){for(var c=a.na,d=0,e=0;e<c.length;e+=3)c[e]==b&&d++;return d}function q(a,b){for(var c=a.na,d=0,e=0;e<c.length;e+=3)c[e+1]==b&&d++;return d}function r(a,b,c){a=a.na;for(var d=0,e=0;e<a.length;e+=3)if(a[e]==b){if(d==c)return a[e+1];d++}return z}function I(a,b,c){a=a.na;for(var d=0,e=0;e<a.length;e+=3)if(a[e+
1]==b){if(d==c)return a[e];d++}return z}function A(a,b,c){a=a.na;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function G(a,b,c,d,e,f,r){for(var h=Q(b,c,d),q=Q(e,f,r),z=0;z<h;z++){for(var g=!1,m=0;m<q;m++)if(a(u(b,c,d,z),u(e,f,r,m))){g=!0;break}if(!g)return!1}return!0}function Q(a,b,c){var d=0;a=a.na;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&d++;return d}function u(a,b,c,d){a=a.na;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(e==d)return a[f+2];e++}return null}
var z=-1,O=0,F=10,K=20,H=30,J=[z,z];a.Jl=z;a.Ax=F;a.Qp=K;a.Ex=H;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var e=a[d];switch(e.length){case 2:b.push(e[0],e[1]);break;case 3:c.push(e[0],e[1],e[2]);break;default:throw"Wrong graph constructor params";}}return{xa:b,na:c}};a.$x=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)c.push(a[e][0],a[e][1]);for(e=0;e<b.length;e++)d.push(b[e][0],b[e][1],b[e][2]);return{xa:c,na:d}};a.Aj=p;a.Hy=b;a.sd=d;a.Rf=h;a.gd=function(a,b,c,d){if(!A(a,
b,c))throw"Edge not found";a=a.na;for(var e=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(-1==d)a.splice(f,3);else{if(d==e){a.splice(f,3);break}e++}f-=3}};a.p=function(a,b){if(k(a,b)==z)p(a,c(a),b);else throw"Non-unique attribute";};a.Bv=function(a,b,c,d,e){a=a.na;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&a[f+2]==d&&(a[f+2]=e)};a.gn=c;a.Pi=k;a.j=function(a,b,c,e){b=k(a,b);c=k(a,c);if(b!=z&&c!=z)d(a,b,c,e);else throw"Attributes not found";};a.K=function(a,b){for(var c=a.xa,d=0;d<c.length&&
!b(c[d],c[d+1]);d+=2);};a.af=function(a,b){for(var c=a.na,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.Ud=function(a,b,c){for(var d=a.na,e=0;e<d.length;e+=3)if(d[e+1]==b){var f=d[e];if(c(f,y(a,f),d[e+2]))break}};a.Vd=function(a,b,c){for(var d=a.na,e=0;e<d.length;e+=3)if(d[e]==b){var f=d[e+1];if(c(f,y(a,f),d[e+2]))break}};a.vp=l;a.Gw=function(a){a=l(a).xa;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.Oy=function(){};a.ww=function(a,c,d){if(!b(a,c))throw"No such node";var f={};e(a,
f);w(a,c,f,d);c=[];for(var r in f)f[r]&&(r=Number(r),c.push(r,y(a,r)));a={xa:c,na:a.na.slice(0)};f=a.na;for(r=0;r<f.length;r+=3)c=f[r+1],b(a,f[r])&&b(a,c)||(f.splice(r,3),r-=3);return a};a.au=function(a){for(var b=[],c=a.xa,d=0;d<c.length;d+=2){var e=c[d];q(a,e)||b.push(e)}return b};a.xn=function(a){for(var b=[],c=a.xa,d=0;d<c.length;d+=2){var e=c[d];x(a,e)||b.push(e)}return b};a.match=function(a,b,c,d){var e={};e.Og=n(a);e.Pg=n(b);e.Lk=c||function(a,b){return a==b};e.qi=d||function(a,b){return a==
b};d=a.xa.length/2;var f=b.xa.length/2;e.Hd=d;e.Mf=f;e.Jd=O;e.uc=e.Ri=0;e.Sd=e.jg=e.kg=0;e.Td=e.lg=e.mg=0;e.Ag=z;e.Rc=Array(d);e.qe=Array(f);e.Fe=Array(d);e.Ge=Array(f);e.Qe=Array(d);e.Re=Array(f);e.ej=[1];for(c=0;c<d;c++)e.Rc[c]=z,e.Fe[c]=0,e.Qe[c]=0;for(c=0;c<f;c++)e.qe[c]=z,e.Ge[c]=0,e.Re[c]=0;f=Array(d);d=Array(d);if(m(f,d,e)){for(c=0;c<f.length;c++)f[c]=a.xa[2*f[c]],d[c]=b.xa[2*d[c]];return[f,d]}return null};a.qa=y;a.Se=x;a.Nn=q;a.Be=r;a.vi=I;a.xy=Q;a.Ac=u;a.replace=function(a,b,d){for(var e=
a.na,f=c(a),r=0;r<b.length;r++){var q=b[r];h(a,q);for(var z=0;z<e.length;z+=3)e[z]==q&&(e[z]=f),e[z+1]==q&&(e[z+1]=f),e[z]==e[z+1]&&(e.splice(z,3),z-=3)}p(a,f,d)};a.ay=function(a,b){var c=a.xa,d=a.na,e;e="digraph debug {\n    node [shape=box];\n";for(var f=0;f<c.length;f+=2){var r=c[f],h=c[f+1],h=b?b(r,h):String(r);e+="    ";e+=String(r)+' [label="'+h.replace(/\"/g,'\\"')+'"];\n'}for(f=0;f<d.length;f+=3)c=d[f],r=d[f+1],e+="    ",e+=String(c)+" -> "+String(r)+";\n";return e+="}"}};b4w.module.__ipc=function(a){var p=a.Up=0;a.Vp=1;a.Wp=2;a.Xp=3;a.Yp=4;a.Zp=5;var b=a.aq=6,d=a.bq=7,h=a.cq=8;a.dq=9;a.$p=10;a.Cq=11;a.oc=12;a.eq=13;a.fq=14;a.gq=15;a.iq=16;a.hq=17;a.jq=18;a.kq=19;a.lq=20;a.mq=21;a.nq=22;a.oq=23;a.pq=24;a.qq=25;a.rq=26;a.sq=27;a.tq=28;a.uq=29;a.vq=30;a.wq=31;a.xq=32;a.yq=33;a.Aq=34;a.Bq=35;a.Dq=36;a.Ll=37;a.Eq=38;a.Fq=39;a.Gq=40;a.Hq=41;a.Iq=42;a.Jq=43;a.Kq=44;a.Lq=45;a.Mq=46;a.Nq=47;a.Oq=48;a.Pq=49;a.Qq=50;a.Ml=51;var c=a.hf=52;a.Rq=53;a.Kl=54;a.Sq=55;a.Tq=56;a.Bx=
57;a.zq=58;for(var k=null,l=[],e=[],f=[],w=[],n=0;59>n;n++)l.push(null),e.push(null),f.push(null),w.push(null);e[h]={msg_id:0,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3)};e[b]={msg_id:0,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4)};e[d]={msg_id:0,body_id:0,from:new Float32Array(3),to:new Float32Array(3),local:0,body_id_b_hit:0,cur_result:0};e[p]={msg_id:0,body_id_a:0,body_id_b:0,result:0,
coll_point:new Float32Array(3)};e[c]={msg_id:0,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4)};w[h]=["msg_id",1,"body_id",1,"time",1,"trans",3,"quat",4,"linvel",3,"angvel",3];w[b]=["msg_id",1,"chassis_hull_body_id",1,"prop_ind",1,"trans",3,"quat",4];w[d]=["msg_id",1,"body_id",1,"from",3,"to",3,"local",1,"body_id_b_hit",1,"cur_result",1];w[p]=["msg_id",1,"body_id_a",1,"body_id_b",1,"result",1,"coll_point",3];w[c]=["msg_id",1,"body_id",1,"trans",3,"quat",4];a.init=function(a,b){a.addEventListener("message",
function(a){var c=a.data;a=c[0]|0;if(w[a]){for(var d=e[a],f=w[a],h=0,r=0;r<f.length;r+=2){var m=f[r],k=f[r+1];if(1==k)d[m]="msg_id"==m||"body_id"==m||"body_id_a"==m||"body_id_b"==m?c[h]|0:c[h];else for(var l=0;l<k;l++)d[m][l]=c[h+l];h+=k}c=d}b(a,c)},!1);k=a};a.cleanup=function(){k=null};a.n=function(){var a=arguments[0]|0;if(w[a]){var b=e[a],c=w[a],d=0;if(!f[a]){for(var h=0,x=1;x<c.length;x+=2)h+=c[x];f[a]=new Float32Array(h)}h=f[a];for(x=0;x<c.length;x+=2){var q=b[c[x]],r=c[x+1];1==r?h[d]=q:h.set(q,
d);d+=r}l[a]||(l[a]=h);a=l[a]}else for(b=arguments.length,l[a]||(l[a]=Array(b),l[a][0]=a),a=l[a],c=1;c<b;c++)a[c]=arguments[c];k.postMessage(a)};a.sn=function(a){return e[a]}};b4w.module.__hud=function(a,p){function b(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function d(a){h(' SCENE "'+a.name+'"');if(a.d){var b=0,c=0;e.K(a.d.La,function(a,d){if("SINK"==d.type)h(" (F)",d.type);else{var e=d.type,f=Math.round(d.i.width)+"x"+Math.round(d.i.height),g=d.m.length,m=d.Hg,k=d.enqueue&&d.M;k?h(" (A)",e,d.Nf,f,m,"of",g):h(" (P)",e,d.Nf,f,m,"of",g);d.Hg=0;k&&(b+=g,c+=m)}});return[b,c]}h("No INFO")}function h(){for(var a=f,b=w+g[0]*n,c=
[5,18,3,10,4,3,5],d=arguments[0],e=1;e<arguments.length;e++){for(var r="",h=0;h<c[e]-String(arguments[e]).length;h++)r+=" ";d+=r+arguments[e]}g[0]++;m.fillText(d,a,b)}function c(a,b,c){b*=a.la;c.x=a.x+b;c.y=a.y;c.la=a.la-2*b;c.fa=a.fa}function k(a){return a.x+a.la/2}function l(a){var b=m,d={x:0,y:0,la:0,fa:0},e=b.canvas.width,b=b.canvas.height;d.x=0;d.y=0;d.la=e;d.fa=b;c(d,0.01,d);e=0.02*d.fa;d.x=d.x;d.y+=e;d.la=d.la;d.fa-=2*e;e=d.la/8;d.x+=e*a;d.y=d.y;d.la=e;d.fa=d.fa;c(d,0.02,d);return d}var e=
p("__graph"),f=30,w=80,n=20,m=null,g=[0,0];a.init=function(a){a=a.getContext("2d");b(a);return m=a};a.Eh=function(){m&&b(m)};a.reset=function(){var a=m;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),g[0]=0,g[1]=0)};a.fw=function(a,b){var c=m;if(c){c.textAlign="left";c.fillStyle="rgba(0,255,0,255)";h(" FPS",(1/b).toFixed(2));g[0]++;for(var e=c=0,f=0;f<a.length;f++){var r=d(a[f]),c=c+r[0],e=e+r[1];g[0]++}h(" ---------------------------------------------");
h("    ","TOTAL ACTIVE","","",e,"of",c)}};a.print=function(){var a=m;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",h.apply(Math,arguments))};a.plot_array=function(a,b,c,d,e,f,h){var g=m;if(g){b=l(b);var w=b.fa/5;b.x=b.x;b.y+=4*w;b.la=b.la;b.fa=w;g.textAlign="center";g.fillStyle="#00FF00";m.fillText(a,k(b),b.y-10);g.strokeStyle="#00FF00";g.lineWidth=0.5;g.beginPath();g.moveTo(b.x,b.y);g.lineTo(b.x+b.la,b.y);g.lineTo(b.x+b.la,b.y+b.fa);g.lineTo(b.x,b.y+b.fa);g.closePath();g.stroke();if(!f&&
!h)for(f=1E6,h=-1E6,a=0;a<c.length;a++)f=Math.min(f,c[a]),h=Math.max(h,c[a]);g.textAlign="right";m.fillText(String(f),b.x-10,b.y+b.fa);m.fillText(String(h),b.x-10,b.y);g.textAlign="center";m.fillText(String(d),b.x,b.y+b.fa+15);m.fillText(String(e),b.x+b.la,b.y+b.fa+15);g.strokeStyle="#FF0000";g.lineWidth=1.5;g.beginPath();d=b.la/(c.length-1);h=b.fa/(h-f);for(a=0;a<c.length;a++)e=b.x+d*a,w=b.y+b.fa-(c[a]-f)*h,0==a?g.moveTo(e,w):g.lineTo(e,w);g.stroke()}};a.draw_mixer_strip=function(a,b,c,d,e,f,h){var g=
m;if(g)for(g.textAlign="center",g.fillStyle="#00FF00",g.font="bold 12px Courier",c=l(c),m.fillText(b?"["+a+"]":a,k(c),c.y),0<=f&&m.fillText(f?"[M]":"[ ]",k(c)-15,c.y+30),0<=h&&m.fillText(h?"[S]":"[ ]",k(c)+15,c.y+30),a={x:0,y:0,la:0,fa:0},b=0;b<d.length;b++){f=d[b];var w="VOLUME"==f[0];if(w){h=c.y+350;var n=c.la,u=a;u.x=c.x;u.y=h;u.la=n;u.fa=250}else{h=c.y+10+50*b;var n=c.la,u=c.fa,z=a;z.x=c.x;z.y=h;z.la=n;z.fa=u}h=g;var n=a,z=b==e,O=f[0],u=f[1],F=f[2],K=f[3],H=(K-F)/f[4],H=1>H?Math.floor(1/H-1E-5).toFixed(0).length:
0;f=f[5]?Math.log(u/F)/Math.log(K/F):(u-F)/(K-F);h.textAlign="center";z?h.fillText("["+O+"]",k(n),n.y):h.fillText(O,k(n),n.y);h.strokeStyle="#00FF00";h.lineWidth=w?3:1;w?(h.textAlign="right",h.fillText(K.toFixed(H),k(n)-10,n.y+15),h.textAlign="right",h.fillText(F.toFixed(H),k(n)-10,n.y+n.fa-15)):(h.textAlign="right",h.fillText(F.toFixed(H),n.x+28,n.y+15),h.textAlign="left",h.fillText(K.toFixed(H),n.x+n.la-28,n.y+15));h.beginPath();if(w){var J=n.y+15+(n.fa-30)*(1-f);h.moveTo(k(n),n.y+15);h.lineTo(k(n),
n.y+n.fa-15);h.moveTo(k(n)-5,n.y+15);h.lineTo(k(n)+5,n.y+15);h.moveTo(k(n)-5,n.y+n.fa-15);h.lineTo(k(n)+5,n.y+n.fa-15);h.moveTo(k(n)-5,J);h.lineTo(k(n)+5,J)}else{var P=n.x+30+(n.la-60)*f;h.moveTo(n.x+30,n.y+15);h.lineTo(n.x+n.la-30,n.y+15);h.moveTo(n.x+30,n.y+15-5);h.lineTo(n.x+30,n.y+15+5);h.moveTo(n.x+n.la-30,n.y+15-5);h.lineTo(n.x+n.la-30,n.y+15+5);h.moveTo(P,n.y+15-5);h.lineTo(P,n.y+15+5)}h.stroke();"EQ_Q"==O?(f=Math.log(1+1/(2*u*u)+Math.sqrt((2+1/(u*u))*(2+1/(u*u))/4-1))/Math.log(2),w?(h.textAlign=
"left",h.fillText(u.toFixed(H),k(n)+10,J),h.textAlign="left",h.fillText("("+f.toFixed(H+1)+")",k(n)+10,J+10)):(h.textAlign="right",h.fillText(u.toFixed(H),P,n.y+30),h.textAlign="left",h.fillText("("+f.toFixed(H+1)+")",P,n.y+30))):w?(h.textAlign="left",h.fillText(u.toFixed(H),k(n)+10,J)):(h.textAlign="center",h.fillText(u.toFixed(H),P,n.y+30))}}};b4w.module.__renderer=function(a,p){function b(a){if(a){var b=(a.V?t.COLOR_BUFFER_BIT:0)|(a.Z?t.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=w;break;case "DEPTH":a=n;break;case "SHORE_SMOOTHING":a=w;break;case "COLOR_PICKING":a=m;break;case "GLOW_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=g;break;default:a=f.background_color}}else b=t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT,a=f.background_color;t.colorMask(!0,!0,!0,!0);t.depthMask(!0);t.clearColor(a[0],
a[1],a[2],a[3]);t.clear(b)}function d(a,b,c){var d=b.attributes;b=b.dm;t.bindBuffer(t.ARRAY_BUFFER,a.df);for(var e=a.Gb,f=b.length;f--;){var h=b[f],g=d[h],h=e[h];t.enableVertexAttribArray(g);t.vertexAttribPointer(g,h.Id,t.FLOAT,!1,0,c&&1<h.frames?(h.offset+c*h.length)*s:h.offset*s)}a.ad?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.ad),t.drawElements(a.mode,a.count,a.rk,0)):t.drawArrays(a.mode,0,a.count);for(f=b.length;f--;)h=b[f],t.disableVertexAttribArray(d[h])}function h(a){switch(a){case 0:return t.TEXTURE_CUBE_MAP_NEGATIVE_Y;
case 1:return t.TEXTURE_CUBE_MAP_POSITIVE_Y;case 2:return t.TEXTURE_CUBE_MAP_POSITIVE_X;case 3:return t.TEXTURE_CUBE_MAP_NEGATIVE_X;case 4:return t.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return t.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function c(a){var b=a.bf,c=[],d=[],e={},f;for(f in b){var h=!1;switch(f){case "u_proj_matrix":var g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.ga)},h=!0;break;case "u_view_matrix":case "u_view_matrix_frag":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.oa)};h=!0;break;case "u_view_proj_prev":g=
function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.lv)};h=!0;break;case "u_view_proj_inverse":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.sg)};h=!0;break;case "u_sky_vp_inverse":g=function(a,b,c,d,e,f){a.uniformMatrix4fv(b,!1,f.Cc)};h=!0;break;case "u_camera_eye":case "u_camera_eye_frag":g=function(a,b,c,d,e,f){a.uniform3fv(b,f.Bd)};h=!0;break;case "u_camera_eye_last":g=function(a,b,c,d,e,f){a.uniform3fv(b,f.$m)};h=!0;break;case "u_camera_quat":g=function(a,b,c,d,e,f){a.uniform4fv(b,f.g)};h=!0;
break;case "u_view_max_depth":g=function(a,b,c,d,e,f){a.uniform1f(b,f.Ka)};h=!0;break;case "u_camera_range":g=function(a,b,c,d,e,f){a.uniform2f(b,f.cb,f.Ka)};break;case "u_cam_water_depth":g=function(a,b,c){a.uniform1f(b,c.Oj)};h=!0;break;case "u_waves_height":g=function(a,b,c){a.uniform1f(b,c.Zd)};break;case "u_waves_length":g=function(a,b,c){a.uniform1f(b,c.gf)};break;case "u_fog_color_density":g=function(a,b,c){a.uniform4fv(b,c.wb)};break;case "u_underwater_fog_color_density":g=function(a,b,c){a.uniform4fv(b,
c.mc)};break;case "u_shadow_visibility_falloff":g=function(a,b,c){a.uniform1f(b,c.shadow_visibility_falloff)};break;case "u_bloom_key":g=function(a,b,c){a.uniform1f(b,c.bloom_key)};break;case "u_bloom_edge_lum":g=function(a,b,c){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":g=function(a,b,c){a.uniform1f(b,c.time)};h=!0;break;case "u_wind":g=function(a,b,c){a.uniform3fv(b,c.Jh)};break;case "u_horizon_color":g=function(a,b,c){a.uniform3fv(b,c.Wb)};break;case "u_zenith_color":g=function(a,b,c){a.uniform3fv(b,
c.ec)};break;case "u_environment_energy":g=function(a,b,c){a.uniform1f(b,c.Ad)};break;case "u_sky_color":g=function(a,b,c){a.uniform3fv(b,c.Xf)};break;case "u_rayleigh_brightness":g=function(a,b,c){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":g=function(a,b,c){a.uniform1f(b,c.mie_brightness)};break;case "u_spot_brightness":g=function(a,b,c){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":g=function(a,b,c){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":g=
function(a,b,c){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":g=function(a,b,c){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":g=function(a,b,c){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":g=function(a,b,c){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":g=function(a,b,c){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":g=function(a,b,c){a.uniform3fv(b,c.Gf)};break;case "u_light_directions":g=
function(a,b,c){a.uniform3fv(b,c.Df)};break;case "u_light_color_intensities":g=function(a,b,c){a.uniform3fv(b,c.Cf)};break;case "u_light_factors1":g=function(a,b,c){a.uniform4fv(b,c.Ef)};break;case "u_light_factors2":g=function(a,b,c){a.uniform4fv(b,c.Ff)};break;case "u_sun_quaternion":g=function(a,b,c){a.uniform4fv(b,c.sp)};break;case "u_sun_intensity":g=function(a,b,c){a.uniform3fv(b,c.rp)};break;case "u_sun_direction":g=function(a,b,c){a.uniform3fv(b,c.hj)};break;case "u_height":g=function(a,b,
c,d,e,f){a.uniform1f(b,f.height)};h=!0;break;case "u_model_matrix":g=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.G)};h=!0;break;case "u_transb":g=function(a,b,c,d){a.uniform4fv(b,d.Bh)};h=!0;break;case "u_transa":g=function(a,b,c,d){a.uniform4fv(b,d.Ah)};h=!0;break;case "u_quat":g=function(a,b,c,d){a.uniform4fv(b,d.g)};h=!0;break;case "u_quatsb":g=function(a,b,c,d){a.uniform4fv(b,d.nh)};h=!0;break;case "u_quatsa":g=function(a,b,c,d){a.uniform4fv(b,d.mh)};h=!0;break;case "u_frame_factor":g=function(a,
b,c,d){a.uniform1f(b,d.Lg)};h=!0;break;case "au_center_pos":g=function(){};h=!0;break;case "au_wind_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.Lc)};h=!0;break;case "au_wind_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.$d)};h=!0;break;case "au_detail_bending_freq":g=function(a,b,c,d){a.uniform1f(b,d.yd)};h=!0;break;case "au_detail_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.xd)};h=!0;break;case "au_branch_bending_amp":g=function(a,b,c,d){a.uniform1f(b,d.ud)};h=!0;break;case "u_diffuse_color":g=
function(a,b,c,d,e){a.uniform4fv(b,e.Sa)};h=!0;break;case "u_diffuse_intensity":g=function(a,b,c,d,e){a.uniform1f(b,e.te)};h=!0;break;case "u_diffuse_params":g=function(a,b,c,d,e){a.uniform2fv(b,e.Uc)};h=!0;break;case "u_emit":g=function(a,b,c,d,e){a.uniform1f(b,e.zd)};h=!0;break;case "u_ambient":g=function(a,b,c,d,e){a.uniform1f(b,e.rc)};h=!0;break;case "u_specular_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.md)};h=!0;break;case "u_specular_params":g=function(a,b,c,d,e){a.uniform3fv(b,e.cc)};h=
!0;break;case "u_reflect_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.ph)};h=!0;break;case "u_mirror_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.Ik)};h=!0;break;case "u_grass_map_dim":g=function(a,b,c,d,e){a.uniform3fv(b,e.Eb)};h=!0;break;case "u_grass_size":g=function(a,b,c,d,e){a.uniform1f(b,e.qk)};h=!0;break;case "u_scale_threshold":g=function(a,b,c,d,e){a.uniform1f(b,e.yi)};h=!0;break;case "u_cube_fog":g=function(a,b,c,d,e){a.uniformMatrix4fv(b,!1,e.vc)};break;case "u_jitter_amp":g=function(a,
b,c,d,e){a.uniform1f(b,e.Ei)};h=!0;break;case "u_jitter_freq":g=function(a,b,c,d,e){a.uniform1f(b,e.Fi)};h=!0;break;case "u_wireframe_mode":g=function(a,b,c,d,e){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":g=function(a,b,c){a.uniform2fv(b,c.Gu)};h=!0;break;case "u_subsample_indices":g=function(a,b,c){a.uniform4fv(b,c.Hu)};h=!0;break;case "u_refr_bump":g=function(a,b,c,d,e){a.uniform1f(b,
e.Po)};h=!0;break;case "u_lamp_light_positions":g=function(a,b,c,d,e){a.uniform3fv(b,e.xk)};break;case "u_lamp_light_directions":g=function(a,b,c,d,e){a.uniform3fv(b,e.vk)};break;case "u_lamp_light_color_intensities":g=function(a,b,c,d,e){a.uniform3fv(b,e.uk)};break;case "u_lamp_light_factors":g=function(a,b,c,d,e){a.uniform4fv(b,e.wk)};break;case "u_halo_size":g=function(a,b,c,d,e){a.uniform1f(b,e.Hn)};h=!0;break;case "u_halo_hardness":g=function(a,b,c,d,e){a.uniform1f(b,e.En)};h=!0;break;case "u_halo_rings_color":g=
function(a,b,c,d,e){a.uniform3fv(b,e.Gn)};h=!0;break;case "u_halo_lines_color":g=function(a,b,c,d,e){a.uniform3fv(b,e.Fn)};h=!0;break;case "u_halo_stars_blend":g=function(a,b,c,d,e){a.uniform1f(b,e.In)};h=!0;break;case "u_halo_stars_height":g=function(a,b,c,d,e){a.uniform1f(b,e.Jn)};h=!0;break;case "u_fresnel_params":g=function(a,b,c,d,e){a.uniform4fv(b,e.Yc)};h=!0;break;case "u_texture_scale":g=function(a,b,c,d,e){a.uniform3fv(b,e.Fc)};h=!0;break;case "u_parallax_scale":g=function(a,b,c,d,e){a.uniform1f(b,
e.fh)};h=!0;break;case "u_color_id":g=function(a,b,c,d,e){a.uniform3fv(b,e.Dm)};h=!0;break;case "u_line_points":g=function(a,b,c,d,e){a.uniform3fv(b,e.Ju)};h=!0;break;case "u_diffuse_color_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.se)};h=!0;break;case "u_alpha_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.ge)};h=!0;break;case "u_specular_color_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.dp)};h=!0;break;case "u_normal_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.ko)};h=!0;break;case "u_colormap0_uv_velocity":g=
function(a,b,c,d,e){a.uniform2fv(b,e.wd)};h=!0;break;case "u_normalmap0_uv_velocity":g=function(a,b,c,d,e){a.uniform2fv(b,e.Oe[0])};h=!0;break;case "u_normalmap1_uv_velocity":g=function(a,b,c,d,e){a.uniform2fv(b,e.Oe[1])};h=!0;break;case "u_normalmap2_uv_velocity":g=function(a,b,c,d,e){a.uniform2fv(b,e.Oe[2])};h=!0;break;case "u_normalmap3_uv_velocity":g=function(a,b,c,d,e){a.uniform2fv(b,e.Oe[3])};h=!0;break;case "u_normalmap0_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Ne[0])};h=!0;break;case "u_normalmap1_scale":g=
function(a,b,c,d,e){a.uniform2fv(b,e.Ne[1])};h=!0;break;case "u_normalmap2_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Ne[2])};h=!0;break;case "u_normalmap3_scale":g=function(a,b,c,d,e){a.uniform2fv(b,e.Ne[3])};h=!0;break;case "u_foam_factor":g=function(a,b,c,d,e){a.uniform1f(b,e.foam_factor)};h=!0;break;case "u_foam_uv_freq":g=function(a,b,c,d,e){a.uniform2fv(b,e.bn)};h=!0;break;case "u_foam_mag":g=function(a,b,c,d,e){a.uniform2fv(b,e.an)};h=!0;break;case "u_foam_scale":g=function(a,b,c,d,e){a.uniform2fv(b,
e.ek)};h=!0;break;case "u_shallow_water_col":g=function(a,b,c,d,e){a.uniform3fv(b,e.shallow_water_col)};h=!0;break;case "u_shore_water_col":g=function(a,b,c,d,e){a.uniform3fv(b,e.shore_water_col)};h=!0;break;case "u_water_shallow_col_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.shallow_water_col_fac)};h=!0;break;case "u_water_shore_col_fac":g=function(a,b,c,d,e){a.uniform1f(b,e.shore_water_col_fac)};h=!0;break;case "u_p_length":g=function(a,b,c,d,e){a.uniform1f(b,e.xo)};h=!0;break;case "u_p_cyclic":g=
function(a,b,c,d,e){a.uniform1i(b,e.so)};h=!0;break;case "u_p_max_lifetime":g=function(a,b,c,d,e){a.uniform1f(b,e.zo)};h=!0;break;case "u_p_fade_in":g=function(a,b,c,d,e){a.uniform1f(b,e.uo)};h=!0;break;case "u_p_fade_out":g=function(a,b,c,d,e){a.uniform1f(b,e.vo)};h=!0;break;case "u_p_size":g=function(a,b,c,d,e){a.uniform1f(b,e.Nk)};h=!0;break;case "u_p_alpha_start":g=function(a,b,c,d,e){a.uniform1f(b,e.po)};h=!0;break;case "u_p_alpha_end":g=function(a,b,c,d,e){a.uniform1f(b,e.oo)};h=!0;break;case "u_p_nfactor":g=
function(a,b,c,d,e){a.uniform1f(b,e.Mk)};h=!0;break;case "u_p_gravity":g=function(a,b,c,d,e){a.uniform1f(b,e.wo)};h=!0;break;case "u_p_mass":g=function(a,b,c,d,e){a.uniform1f(b,e.yo)};h=!0;break;case "u_p_size_ramp":g=function(a,b,c,d,e){a.uniform2fv(b,e.Ao)};h=!0;break;case "u_p_color_ramp":g=function(a,b,c,d,e){a.uniform4fv(b,e.qo)};h=!0;break;case "u_p_wind":g=function(a,b,c,d,e){a.uniform3fv(b,e.Ti)};h=!0;break;case "u_texel_size":g=function(a,b,c,d,e){a.uniform2fv(b,e.ml)};h=!0;break;case "u_p_time":g=
function(a,b,c,d,e){a.uniform1f(b,e.Bc.F.time)};h=!0;break;case "u_va_frame_factor":g=function(a,b,c,d){a.uniform1f(b,d.Fp)};h=!0;break;case "u_v_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Ep)};h=!0;break;case "u_b_light_matrix":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.fm)};break;case "u_p_light_matrix0":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Te[0])};h=!0;break;case "u_p_light_matrix1":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Te[1])};h=!0;break;case "u_p_light_matrix2":g=
function(a,b,c){a.uniformMatrix4fv(b,!1,c.Te[2])};h=!0;break;case "u_p_light_matrix3":g=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Te[3])};h=!0;break;case "u_motion_blur_exp":g=function(a,b,c){a.uniform1f(b,c.io)};h=!0;break;case "u_refl_plane":g=function(a,b,c){a.uniform4fv(b,c.fb)};break;case "u_radial_blur_step":g=function(a,b,c){a.uniform1f(b,c.$i)};break;case "u_god_rays_intensity":g=function(a,b,c){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":g=function(a,b,c){a.uniform1f(b,
c.fg)};break;case "u_ssao_dithering_amount":g=function(a,b,c){a.uniform1f(b,c.ag)};break;case "u_ssao_gauss_center":g=function(a,b,c){a.uniform1f(b,c.bg)};break;case "u_ssao_gauss_width_square":g=function(a,b,c){a.uniform1f(b,c.dg)};break;case "u_ssao_gauss_width_left_square":g=function(a,b,c){a.uniform1f(b,c.cg)};break;case "u_ssao_influence":g=function(a,b,c){a.uniform1f(b,c.eg)};break;case "u_ssao_dist_factor":g=function(a,b,c){a.uniform1f(b,c.$f)};break;case "u_dof_dist":g=function(a,b,c,d,e,
f){a.uniform1f(b,f.dof_distance)};h=!0;break;case "u_dof_front":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_front)};h=!0;break;case "u_dof_rear":g=function(a,b,c,d,e,f){a.uniform1f(b,f.dof_rear)};h=!0;break;case "u_glow_intensity":g=function(a,b,c,d,e){a.uniform1f(b,e.xf)};h=!0;break;case "u_glow_color":g=function(a,b,c){a.uniform3fv(b,c.Rg)};break;case "u_draw_glow":g=function(a,b,c){a.uniform1f(b,c.$j)};h=!0;break;case "u_blur_depth_edge_size":g=function(a,b,c){a.uniform1f(b,c.blur_depth_edge_size)};
break;case "u_blur_depth_diff_threshold":g=function(a,b,c){a.uniform1f(b,c.blur_depth_diff_threshold)};break;case "u_brightness":g=function(a,b,c){a.uniform1f(b,c.brightness)};break;case "u_contrast":g=function(a,b,c){a.uniform1f(b,c.contrast)};break;case "u_exposure":g=function(a,b,c){a.uniform1f(b,c.exposure)};break;case "u_saturation":g=function(a,b,c){a.uniform1f(b,c.saturation)};break;default:g=null}g&&(g={name:f,jk:g,Bk:b[f]},h?c.push(g):(d.push(g),e[f]=g))}a.xp=c;a.gh=d;a.Pk=e}var k=p("__config"),
l=p("__debug"),e=p("__textures"),f=k.q,w=[1,1,1,1],n=[1,1,1,1],m=[0,0,0,1],g=[0,0,0,0],s=4;new Float32Array([0.25,-0.25]);new Float32Array([-0.25,0.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var t=null,y=new Uint8Array(4);a.kc=function(a){var b=f.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);t=a};
a.oi=function(a){if(a.M){var e=a.i;t.bindFramebuffer(t.FRAMEBUFFER,e.Cd);if(a.Cj){var r=e.Ra;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,r.qb,r.Ba,0)}t.viewport(0,0,e.width,e.height);b(a);a.ma?t.enable(t.BLEND):t.disable(t.BLEND);a.bb?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST);if(a.wa){for(var e=a.i,r=a.m,g=0;g<r.length;g++){var m=r[g],k=m.l,s=k.Ab;t.useProgram(s.Yi);m=m.Ma;s.gh.length||c(s);for(var s=s.gh,n=s.length;n--;){var z=s[n];z.jk(t,z.Bk,a,m,k,e)}}a.wa=!1}switch(a.type){case "SHADOW_CAST":t.enable(t.POLYGON_OFFSET_FILL);
t.polygonOffset(1*f.Qk,1*f.Qk);t.cullFace(t.BACK);break;case "MAIN_REFLECT":t.disable(t.POLYGON_OFFSET_FILL);t.cullFace(t.FRONT);break;default:t.disable(t.POLYGON_OFFSET_FILL),t.cullFace(t.BACK)}e=a.i;r=a.m;for(g=0;g<r.length;g++)if(s=r[g],s.M){var k=a,z=e,m=s.Ma,w=s.l,s=w.Ab;t.useProgram(s.Yi);for(var n=w.Ya,F=s.xp,p=F.length;p--;){var H=F[p];H.jk(t,H.Bk,k,m,w,z)}z=w.Em;t.colorMask(z,z,z,z);t.depthMask(w.L);w.da?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE);z=w.Aa;w=w.Rb;F=s.bf;p=z.length|0;if(0!==
p)if(1===p)t.activeTexture(t.TEXTURE0),t.bindTexture(z[0].qb,z[0].Ba);else for(H=0;H<p;H++){var J=z[H],P=w[H];t.activeTexture(t.TEXTURE0+H);t.bindTexture(J.qb,J.Ba);t.uniform1i(F[P],H)}if("SKY"==k.type){z=k;w=z.i;F=s.bf;p=z.Nm;for(H=0;6>H;H++)if(t.uniformMatrix4fv(F.u_cube_view_matrix,!1,p[H]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,h(H),w.Ra.Ba,0),d(n,s,m.tl),z.Oi&&0!=H){var J=z,P=H,N=y;t.readPixels(191,191,1,1,t.RGBA,t.UNSIGNED_BYTE,N);255!=N[0]&&255!=N[1]&&255!=N[2]||t.readPixels(191,
220,1,1,t.RGBA,t.UNSIGNED_BYTE,N);var E=N[0],S=N[1],N=N[2],E=E/255,S=S/255,N=N/255;1===P?(J.vc[3]=E,J.vc[7]=S,J.vc[11]=N):(J.vc[4*(P-2)]=E,J.vc[4*(P-2)+1]=S,J.vc[4*(P-2)+2]=N)}k.Hg+=6}else d(n,s,m.tl),k.Hg++}l.bs("draw subscene: "+a.type);t.bindFramebuffer(t.FRAMEBUFFER,null)}};a.clear=b;a.Fr=c;a.sv=function(a,b,c){var d,e,f;d||(d=1);e||(e=1);f||(f=new Uint8Array(4*d*e));if(f.length!=4*d*e)throw"Wrong storage";t.bindFramebuffer(t.FRAMEBUFFER,a);t.readPixels(b,c,d,e,t.RGBA,t.UNSIGNED_BYTE,f);t.bindFramebuffer(t.FRAMEBUFFER,
null);return f};a.Mw=function(a){var b=a.Ab;t.useProgram(b.Yi);b.gh.length||c(b);b=b.Pk.u_cube_fog;b.jk(t,b.Bk,null,null,a,null)};a.Ro=function(a,b){var c=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,c);if(a){var d=a,f=d.Ba,d=d.qb==t.TEXTURE_CUBE_MAP?t.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.qb;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,d,f,0)}e.Tn(b)?t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,b.ug):e.Wg(b)&&(d=b,f=d.Ba,d=d.qb,t.framebufferTexture2D(t.FRAMEBUFFER,
t.DEPTH_ATTACHMENT,d,f,0));l.Zr();t.bindFramebuffer(t.FRAMEBUFFER,null);return c};a.Av=function(a,b,c,d,f){null==a?(t.bindFramebuffer(t.FRAMEBUFFER,a),t.viewport(0,0,d,f),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)):(e.Wg(b)&&t.deleteTexture(b.Ba),e.Tn(c)?t.deleteRenderbuffer(c.ug):e.Wg(c)&&t.deleteTexture(c.Ba),t.deleteFramebuffer(a))};a.Iy=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,p){function b(a,b,c){var e=a.S;"string"==typeof c&&(a=d(a,c))&&(c=a[1]);for(a=0;a<e.length;a++)if(e[a][0]==b){e[a][1]=c;return}e.push([b,c])}function d(a,b){for(var c=a.S,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function h(a,b){var c=a+b;if(I[c])return I[c];if(x){var d=x[b];if(!d)return null}else{d=s.cu(a+b);if(!d)return null;d=q.Ho.parse(d)}return I[c]=d}function c(a,b,c,d){function e(b){b=b.a;for(var c=0;c<b.length;c++){var q=b[c];switch(q.type){case "condition":a:for(var q=
q.a,s=0;s<q.length;s++){var t=q[s];switch(t.type){case "if":case "elif":var w=t.c;try{var z,D=k(w,r,m,!0);z=g.Ho.parse(D)}catch(x){throw"Failed to process #"+t.type+" expression: "+w.join(" ");}if(z){e(t.group);break a}break;case "else":e(t.group);break;case "ifdef":t.name in r&&e(t.group);break;case "ifndef":t.name in r||e(t.group)}}break;case "include":q=h(y.shaders_dir,y.dw+q.file);e(q);break;case "var":case "export":case "import":break;case "define":s=q.name;r[s]=q.b;q.N&&(m[s]=q.N);break;case "error":throw"Shader error: #error "+
q.b.join(" ");case "line":break;case "pragma":f.push("#pragma "+q.name+" "+q.b.join(" "));break;case "undef":q=q.name;delete r[q];delete m[q];break;case "warning":n.warn("Shader warning: #warning "+q.b.join(" "));break;case "extension":f.push("#extension "+k(q.b,r,m,!1));break;case "#":break;case "node":l[q.name]=q.group.a;break;case "nodes_global":q=d;for(s=0;s<q.length;s++)if(t=q[s],w=l[t.id])for(var L=0,v=0;v<w.length;v++){var M=w[v];"node_param"==M.type&&(M=M.qualifier.join(" ")+" ","vert"==a?
M+=t.Ih[L]:"frag"==a&&(M+=t.N[L],null!==t.Go[L]&&(M+=" = "+t.Go[L])),M+=";",f.push(M),L++)}break;case "nodes_main":q=d;for(s=0;s<q.length;s++)if(t=q[s],w=l[t.id]){var P=M=0,A=0;t.rh={};for(L=0;L<w.length;L++)switch(v=w[L],v.type){case "node_in":var ca=t.A[M];if(null!==t.Pn[M]){var G=v.qualifier.join(" ")+" ",G=G+ca,G=G+(" = "+t.Pn[M]),G=G+";";f.push(G)}t.rh[v.name]=ca;M++;break;case "node_out":ca=t.Ea[P];G=v.qualifier.join(" ")+" ";G+=ca;G+=";";f.push(G);t.rh[v.name]=ca;P++;break;case "node_param":"vert"==
a?ca=t.Ih[A]:"frag"==a&&(ca=t.N[A]),t.rh[v.name]=ca,A++}}for(s=0;s<q.length;s++)if(t=q[s],w=l[t.id])for(L=0;L<w.length;L++)if(v=w[L],"textline"==v.type){M=[];for(P=0;P<v.b.length;P++)A=v.b[P],A in t.rh?M.push(t.rh[A]):M.push(A);f.push(k(M,r,m,!1))}break;case "textline":f.push(k(q.b,r,m,!1));break;default:throw"Unknown element type: "+q.type;}}}for(var f=[],r={},q=0;q<c.length;q++)r[c[q][0]]=[c[q][1]];for(q=0;q<d.length;q++)r["USE_NODE_"+d[q].id]=[1];var m={},l={};e(b);return f.join("\n")}function k(a,
b,c,d){var e=[];l(a,b,c,d,e);return e.join(" ")}function l(a,b,c,d,e){for(var f=0;f<a.length;f++){var h=a[f];h in b?(h=b[h],0==h.length&&d?e.push(0):l(h,b,c,d,e)):e.push(h)}}function e(a,b,c,d,e){if(A){e=d==Q.VERTEX_SHADER?e.aa:e.$;var f=t.ru(c,0),h=G[f];h?h.count++:(h={count:1,cw:e,su:f},G[f]=h)}d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);m.cs(d,b,c);return d}function f(a){return a%1?String(a):String(a)+".0"}var w=p("__config"),n=p("__print"),m=p("__debug"),g=p("__gpp_eval"),s=p("__assets"),
t=p("__util"),y=w.xb;if(b4w.module_check(w.xb.ap))var x=p(w.xb.ap),q=null;else x=null,q=p("__gpp_parser");var r={},I={},A=!1,G=[],Q=null;a.kc=function(a){Q=a};a.I=b;a.Xt=d;a.Py=function(a,b){for(var c=a.S,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.Pv=function(a){a.S=[];for(var c="ALPHA ALPHA_CLIP ALPHA_MAP BEND_CENTER_ONLY CAUSTICS CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING HAIR_BILLBOARD_JITTERED HAIR_BILLBOARD_SPHERICAL MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE SHORE_SMOOTHING SKINNED SKY_TEXTURE SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS NUM_LAMP_LIGHTS MAX_STEPS CSM_SECTION_DIST0 CSM_SECTION_DIST1 CSM_SECTION_DIST2 CSM_SECTION_DIST3 BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER HAIR_BILLBOARD HAIR_BILLBOARD_RANDOM PRECISION EPSILON WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
d=0;d<c.length;d++){var e=c[d],f;switch(e){case "ALPHA":case "ALPHA_CLIP":case "ALPHA_MAP":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "HAIR_BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_TEXTURE":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "HAIR_BILLBOARD":case "HAIR_BILLBOARD_RANDOM":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":f=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "DEPTH_RGBA":case "HAIR_BILLBOARD_SPHERICAL":case "NUM_LIGHTS":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":f=1;break;case "CSM_SECTION_DIST0":f=2.0001;break;case "CSM_SECTION_DIST1":f=4.0001;break;case "CSM_SECTION_DIST2":f=7.0001;break;case "CSM_SECTION_DIST3":f=9.0001;break;case "AA_METHOD":f="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":f="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":f="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":f="POST_EFFECT_NONE";
break;case "SHADOW_SRC":f="SHADOW_SRC_NONE";break;case "SHADOW_DST":f="SHADOW_DST_NONE";break;case "SSAO_QUALITY":f="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":f="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":f="TEXTURE_COORDS_UV";break;case "PRECISION":f=w.q.precision;break;case "EPSILON":f="highp"==w.q.precision?1E-6:1E-4;break;default:n.error("Unknown directive ("+a.aa+", "+a.$+"): "+e)}b(a,e,f)}};a.Dy=function(a){return a.aa};a.qn=function(a){return a.$};a.uu=function(a,c){for(var e=
c.S,f=0;f<e.length;f++){var h=e[f][0],r=e[f][1];d(a,h)&&b(a,h,r)}};a.mk=function(a,b){var d=JSON.stringify(a)+JSON.stringify(b),f=r[d];if(f)return f;var g=a.$,f=h(y.shaders_dir,a.aa),g=h(y.shaders_dir,g);if(!f||!g)return null;var q=a.S||[],k=c("vert",f,q,b),q=c("frag",g,q,b),f=Q,l=e(f,d,k,f.VERTEX_SHADER,a),t=e(f,d,q,f.FRAGMENT_SHADER,a),g=f.createProgram();f.attachShader(g,l);f.attachShader(g,t);f.linkProgram(g);f.validateProgram(g);f.getProgramParameter(g,f.VALIDATE_STATUS)==f.zx&&n.error("B4W Error - shader program is not valid",
d);m.ds(g,d,l,t,k,q);k={Jp:l,fn:t,Yi:g,attributes:{},bf:{},dm:[],gh:[],Pk:{},xp:[],Fa:a};l=f.getProgramParameter(g,f.ACTIVE_ATTRIBUTES);for(q=0;q<l;q++)t=f.getActiveAttrib(g,q).name,k.attributes[t]=f.getAttribLocation(g,t),k.dm.push(t);l=f.getProgramParameter(g,f.ACTIVE_UNIFORMS);for(q=0;q<l;q++)t=f.getActiveUniform(g,q).name.split("[0]").join(""),k.bf[t]=f.getUniformLocation(g,t);return r[d]=f=k};a.Xs=function(){return G};a.Ut=function(){return r};a.cleanup=function(){for(var a in r){var b=r[a];
Q.deleteProgram(b.Yi);Q.deleteShader(b.Jp);Q.deleteShader(b.fn);delete r[a]}for(var c in I)delete I[c];for(var d in G)delete G[d]};a.by=function(a){var b=a.S;n.log("Shader: "+a.aa+" "+a.$+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)n.log("  "+b[a][0],b[a][1])};a.s=function(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return f(a);case 2:return"vec2("+f(a[0])+","+f(a[1])+")";case 3:return"vec3("+f(a[0])+","+f(a[1])+","+f(a[2])+")";case 4:return"vec4("+f(a[0])+","+f(a[1])+
","+f(a[2])+","+f(a[3])+")";case 9:return"mat3("+f(a[0])+","+f(a[1])+","+f(a[2])+","+f(a[3])+","+f(a[4])+","+f(a[5])+","+f(a[6])+","+f(a[7])+","+f(a[8])+")";case 16:return"mat4("+f(a[0])+","+f(a[1])+","+f(a[2])+","+f(a[3])+","+f(a[4])+","+f(a[5])+","+f(a[6])+","+f(a[7])+","+f(a[8])+","+f(a[9])+","+f(a[10])+","+f(a[11])+","+f(a[12])+","+f(a[13])+","+f(a[14])+","+f(a[15])+")";default:throw"Wrong glsl value dimension";}};a.tm=function(a,b){return b in a.bf?!0:!1}};b4w.module.shader_texts=function(a){a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_glow_intensity",";"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",
b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_glow_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},
{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",
a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],
group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 cd = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"cd = mix ( cd , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 ce = vec3 ( 0.0 ) ; vec3 cf = vec3 ( 0.0 ) ; vec3 cg = vec3 ( 0.0 ) ; bl ( cd , ce , cf , cg ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","ch","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ch = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ci = ( u_model_matrix * vec4 ( ch , 1.0 ) ) . xyz ; mat4 cj = _ ( u_camera_eye , ci , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 ck = ( u_model_matrix * vec4 ( ch , 1.0 ) ) . xyz ; cj = cj * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , ck ) ;".split(" ")}]}}]},{type:"textline",b:"c cl = ag ( cd - ch , ch , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , cj ) ; cl . b = ci ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c cl = ag ( cd , ch , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","cm","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cm = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cc ( cl . a , cl . b , cm ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = aj ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( cl . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:["uniform","float",
"u_shadow_visibility_falloff",";"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_DST == SHADOW_DST_NONE || SHADOW_DST == SHADOW_DST_RGBA || SHADOW_DST == SHADOW_DST_VSM".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","float","cu",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cv",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cx",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cy",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"include",file:"shadow.glslf"},{type:"textline",b:["void","main",
"(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float dj = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float dj = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( dj < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = ch ( cu ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_RGBA"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = ch ( cu ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_VSM"],
group:{type:"group",a:[{type:"textline",b:"float dk = cu ; float dl = dk * dk ; gl_FragColor = vec4 ( dk , dl , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( dc ( cA . z , u_shadow_visibility_falloff ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],
group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_DST == SHADOW_DST_NONE || SHADOW_DST == SHADOW_DST_RGBA || SHADOW_DST == SHADOW_DST_VSM".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_DST == SHADOW_DST_NONE || SHADOW_DST == SHADOW_DST_RGBA || SHADOW_DST == SHADOW_DST_VSM".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","cu",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cv",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cw",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cy",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 ef = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"ef = mix ( ef , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",
a:[{type:"textline",b:"vec3 eg = vec3 ( 0.0 ) ; vec3 eh = vec3 ( 0.0 ) ; vec3 ei = vec3 ( 0.0 ) ; bl ( ef , eg , eh , ei ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","ej","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ej = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",
b:"c ek = dZ ( ef , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ej , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 el = ( u_model_matrix * vec4 ( ej , 1.0 ) ) . xyz ; mat4 em = _ ( u_camera_eye , el , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND",
"&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 en = ( u_model_matrix * vec4 ( ej , 1.0 ) ) . xyz ; em = em * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , en ) ;".split(" ")}]}}]},{type:"textline",b:"c ek = ag ( ef - ej , ej , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , em ) ; ek . b = el ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c ek = ag ( ef , ej , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","eo","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 eo = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"cc ( ek . a , ek . b , eo ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 ep = u_view_matrix * vec4 ( ek . a , 1.0 ) ; vec4 eq = u_proj_matrix * ep ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:"eq . xy += u_subpixel_jitter * eq . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = aj ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"ea ( ek . a ) ; cA = ep ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_DST == SHADOW_DST_NONE || SHADOW_DST == SHADOW_DST_RGBA || SHADOW_DST == SHADOW_DST_VSM".split(" "),
group:{type:"group",a:[{type:"textline",b:"cu = - ep . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","eq",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ef",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:["varying","float","ef",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ef",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","ef",";"]}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"gl_FragColor = vec4 ( ef , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , ef ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",
file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ef",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","ef",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ef",";"]}]}}]}]}}]},{type:"textline",b:["void",
"main","(",")","{"]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 eg = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 eh = _ ( u_camera_eye , eg , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"eh = eh * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"c ei = ag ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , eh ) ; ei . b = eg ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"c ei = ag ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 ej = u_proj_matrix * u_view_matrix * vec4 ( ei . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"ef = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["ef","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["ef","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",b:["gl_Position","=","ej",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",
b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS",
"&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 en ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float eo ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int ep = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int ep = NUM_LINES ;".split(" ")}]}}]},
{type:"textline",b:"float er ( float eq ) { return eq - floor ( eq * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void eA ( inout float es , in float et [ ep ] , in float eu ) { for ( int ev = NUM_RINGS ; ev > 0 ; ev -- ) { float ew = 40.0 * et [ ev ] ; float ex = 300.0 * ( er ( ew ) - 0.005 ) ; float ey = ew ; float ez = abs ( ey * ( u_halo_size * ex - eu ) ) ; es += 1.0 - min ( ez , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void eJ ( inout float eB , in float eC [ ep ] , in float eD ) { for ( int eE = NUM_LINES ; eE > 0 ; eE -- ) { float eF = eC [ eE ] ; float eG = eF ; float eH = 1000.0 * ( er ( eF ) - 0.005 ) ; float eI = 20.0 * abs ( eG * a . x + eH * a . y ) ; eB += 1.0 - min ( eI , 1.0 ) ; } eB *= eD ; }".split(" ")}]}}]},{type:"textline",b:"void eQ ( inout float eK , in vec2 eL ) { float eM , eN ; eN = atan ( eL . y , eL . x ) ; eN *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float eO = cos ( eN ) ; float eP = sin ( eN ) ; eN = ( eO * eL . x + eP * eL . y ) * ( eO * eL . y - eP * eL . x ) ; eM = abs ( eN ) ; if ( eM < 1.0 ) { eM = ( 0.01 * u_halo_size ) / ( eM ) ; eK *= sqrt ( min ( eM , 1.0 ) ) ; } } void main ( ) { float eR = ( a . x * a . x + a . y * a . y ) ; float eS = sqrt ( eR ) ; eR = max ( 1.0 - eR , 0.0 ) ; eR = pow ( eR , u_halo_hardness ) ; float eT = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float eU [ ep ] ; for ( int eV = 0 ; eV < ep ; eV ++ ) { eU [ eV ] = fract ( eo / float ( eV ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"float eW = 0.0 ; eA ( eW , eU , eS ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float eX = 0.0 ; eJ ( eX , eU , eR ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"eQ ( eR , a ) ;".split(" ")}]}}]},{type:"textline",b:"eR *= eT ; vec3 eY = u_diffuse_color . rgb * eR ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"eW *= eR ; eY += u_halo_rings_color * eW ; eR += eW ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"eX *= eT ; eY += u_halo_lines_color * eX ; eR += eX ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"eR *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float eZ = u_halo_stars_blend * ( en . y - u_halo_stars_height ) ; eR *= clamp ( eZ , 0.0 , 1.0 ) ; eR *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"ej ( eY ) ; em ( eY , eR ) ; gl_FragColor = vec4 ( eY , eR ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float eo ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec4","en",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 ep = a_position ; a = a_halo_bb_vertex * 2.0 ; eo = fract ( ep . x + ep . y + ep . z ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"mat4 eq = y ( ep , u_view_matrix ) ; mat4 er = u_view_matrix ; er [ 3 ] [ 0 ] = 0.0 ; er [ 3 ] [ 1 ] = 0.0 ; er [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 eq = y ( ep , u_view_matrix ) ;".split(" ")}]}}]},
{type:"textline",b:"vec4 es = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 et = eq * es ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"vec4 eu = u_proj_matrix * er * et ; eu . z = 0.99999 * eu . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["en","=","et",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 eu = u_proj_matrix * u_view_matrix * et ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","eu",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 ep = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( ep , 1.0 ) ; }".split(" ")}]};
a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"include",file:"lighting.glslf"},{type:"condition",
a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"TEXCOORD",b:"( TEXTURE_COLOR && TEXTURE_COORDS == TEXTURE_COORDS_UV || TEXTURE_STENCIL_ALPHA_MASK || TEXTURE_SPEC || TEXTURE_NORM )".split(" ")},{type:"textline",b:["uniform","float","u_time",";"]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",
a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ; uniform float u_shadow_visibility_falloff ; uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_NORMAL","||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform",
"samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform float u_normal_factor ; uniform vec2 u_normalmap0_uv_velocity ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ; uniform vec2 u_colormap0_uv_velocity ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_NORM","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform float u_reflect_factor ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 i_ ; varying vec3 ja ; varying vec3 jb ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jc",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],
group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jd",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cv",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec4","cw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cy",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],
group:{type:"group",a:[{type:"textline",b:["varying","float","je",";"]}]}}]},{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float jQ = ja . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],
group:{type:"group",a:[{type:"textline",b:["vec2","jR","=","a",";"]}]}}]},{type:"textline",b:["vec3","jS","=","jb",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) jS = jS ; else jS = - jS ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"vec3 jT = cross ( jS , jc . xyz ) * jc . w ; mat3 jU = mat3 ( jc . xyz , jT , jS ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:"float jV = length ( cA ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"if ( jV < PARALLAX_LOD_DIST ) { float jW = clamp ( 5.0 - 0.5 * jV , 0.0 , 1.0 ) ; float jX = u_parallax_scale * jW ; vec3 jY = normalize ( i_ * jU ) ; float jZ = 1.0 / PARALLAX_STEPS ; vec2 j_ = jY . xy * jX / ( PARALLAX_STEPS * jY . z ) ; float ka = 1.0 ; float kb = texture2D ( u_normalmap0 , jR ) . a ; for ( float kc = 1.0 ; kc <= PARALLAX_STEPS ; kc ++ ) { if ( kb < ka ) { ka -= jZ ; jR -= j_ ; kb = texture2D ( u_normalmap0 , jR ) . a ; } } vec2 kd = jR + j_ ; float ke = texture2D ( u_normalmap0 , kd ) . a - ( ka + jZ ) ; float kf = kb - ka ; float kg = kf / ( kf - ke ) ; jR = kg * kd + ( 1.0 - kg ) * jR ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"vec4 kh = texture2D ( u_normalmap0 , jR + u_time * u_normalmap0_uv_velocity ) ; vec3 ki = kh . rgb - 0.5 ; ki = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , ki , u_normal_factor ) ; vec3 kj = jU * ki ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","kj","=","jS",";"]}]}}]},{type:"textline",b:"kj = normalize ( kj ) ; vec3 kk = normalize ( i_ ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec3 kl = jd ; eh ( kl ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec4 km = vec4 ( kl , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","km","=","u_diffuse_color",";"]}]}}]},{type:"textline",b:["float","kn","=","1.0",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec2 ko = normalize ( u_view_matrix_frag * vec4 ( kj , 0.0 ) ) . st ; ko = ko * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:"vec4 kp = texture2D ( u_colormap0 , jR ) ; eh ( kp . rgb ) ; vec4 kq ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COORDS",
"==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"kq = texture2D ( u_colormap1 , ko ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_UV"],group:{type:"group",a:[{type:"textline",b:"kq = texture2D ( u_colormap1 , jR ) ;".split(" ")}]}}]},{type:"textline",b:"eh ( kq . rgb ) ; vec4 kr = texture2D ( u_stencil0 , jR ) ; vec4 ks = mix ( kp , kq , kr . r ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COORDS",
"==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec4 ks = texture2D ( u_colormap0 , ko ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_UV"],group:{type:"group",a:[{type:"textline",b:"vec4 ks = texture2D ( u_colormap0 , jR + u_time * u_colormap0_uv_velocity ) ;".split(" ")}]}}]},{type:"textline",b:"eh ( ks . rgb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",
b:"km . rgb = mix ( km . rgb , ks . rgb , u_diffuse_color_factor ) ; float kt = u_alpha_factor * ks . a ; kt += ( 1.0 - step ( 0.0 , kt ) ) ; km . a = mix ( kt , 1.0 , u_diffuse_color . a ) ; kn = ks . a ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"km . rgb *= mix ( vec3 ( 1.0 ) , ks . rgb , u_diffuse_color_factor ) ; km . a = ks . a ; kn = ks . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 ku = u_diffuse_intensity * km . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADELESS"],group:{type:"group",a:[{type:"textline",b:["vec3","kv","=","ku",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float kw = 0.5 * kj . y + 0.5 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 kx = u_environment_energy * textureCube ( u_sky_texture , kj ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 kx = u_environment_energy * mix ( u_horizon_color , u_zenith_color , kw ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 ky = u_ambient * kx ; float kz = di ( u_shadow_visibility_falloff , ku ) ; vec3 kA = u_emit * km . rgb ; vec3 kB = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"vec3 kC = vec3 ( kn ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 kC = texture2D ( u_specmap , jR ) . rgb ;".split(" ")}]}}]},
{type:"textline",b:"eh ( kC . rgb ) ; kB = mix ( kB , kC , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"float kD = u_specular_params [ 0 ] ; vec2 kE = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 kF = kD * kB ; fd kG = hy ( kA , ky , ku , kF , ja , kj , kk , kE , u_diffuse_params , kz , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ; vec3 kv = kG . a . rgb ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["float","kH","=","u_reflect_factor",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","kH","=","0.0",";"]}]}}]},{type:"textline",b:"jB ( kv , kk , kj , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , kH ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",
a:[{type:"textline",b:"kv += kG . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"kv = max ( kv - sqrt ( 0.01 * - min ( jQ , 0.0 ) ) , 0.5 * kv ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"iZ ( kv , jQ , u_time , kz , kj , u_sun_direction , u_sun_intensity , u_sun_quaternion , ja , jV ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"float kI = km . a ; if ( kI <= 0.5 ) discard ; kI = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float kI = km . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"kI += kG . a . a * kF . r ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["float","kI","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kv = mix ( jP ( cz , kj . xz * u_refr_bump ) , kv , kI ) ; kI = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 kJ = eB ( u_cube_fog , kk ) ; vec4 kK = vec4 ( kJ , u_fog_color_density . a ) ; eh ( kK . rgb ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 kK = u_fog_color_density ; kK . rgb *= u_sun_intensity ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","SHADELESS"],group:{type:"group",a:[{type:"textline",b:"eU ( kv , jV , kk , u_cam_water_depth , u_underwater_fog_color_density , kK , jQ , length ( u_sun_intensity ) + u_environment_energy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"eu ( kv , jV , kK ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"SSAO_ONLY && SHADOW_SRC == SHADOW_SRC_MASK && ! SHADELESS".split(" "),group:{type:"group",a:[{type:"textline",b:"kv = vec3 ( cB . a ) ;".split(" ")}]}}]},{type:"textline",b:["ej","(","kv",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"em ( kv , kI ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kv , kI ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",
b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"define",name:"TEXCOORD",b:"( TEXTURE_COLOR && TEXTURE_COORDS == TEXTURE_COORDS_UV || TEXTURE_STENCIL_ALPHA_MASK || TEXTURE_SPEC || TEXTURE_NORM )".split(" ")},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",
a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",
b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",
a:[{type:"textline",b:"uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",
b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 i_ ; varying vec3 ja ; varying vec3 jb ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jc",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jd",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cv",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cy",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || REFRACTIVE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","je",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 jQ = a_position ; vec3 jR = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],
group:{type:"group",a:[{type:"textline",b:"vec3 jS = vec3 ( a_tangent ) ; vec3 jT = a_tangent [ 3 ] * cross ( jR , jS ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 jS = vec3 ( 0.0 ) ; vec3 jT = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"jQ = mix ( jQ , a_position_next , u_va_frame_factor ) ; jR = mix ( jR , a_normal_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",
c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"vec3 jU = vec3 ( a_tangent ) ; vec3 jV = a_tangent_next [ 3 ] * cross ( a_normal_next , jU ) ; jS = mix ( jS , jU , u_va_frame_factor ) ; jT = mix ( jT , jV , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bl ( jQ , jS , jT , jR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",
a:[{type:"textline",b:["vec3","jW","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 jW = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c jX = dZ ( jQ , jS , jT , jR , jW , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 jY = ( u_model_matrix * vec4 ( jW , 1.0 ) ) . xyz ; mat4 jZ = _ ( u_camera_eye , jY , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 j_ = ( u_model_matrix * vec4 ( jW , 1.0 ) ) . xyz ; jZ = jZ * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , j_ ) ;".split(" ")}]}}]},
{type:"textline",b:"c jX = ag ( jQ - jW , jW , jS , jT , jR , jZ ) ; jX . b = jY ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c jX = ag ( jQ , jW , jS , jT , jR , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"float ka = ( dot ( cross ( jX . e , jX . c ) , jX . d ) < 0.0 ) ? - 1.0 : 1.0 ; jc = vec4 ( jX . c , ka ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",
b:"c jX = dZ ( jQ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , jR , jW , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 jY = ( u_model_matrix * vec4 ( jW , 1.0 ) ) . xyz ; mat4 jZ = _ ( u_camera_eye , jY , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&",
"HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 j_ = ( u_model_matrix * vec4 ( jW , 1.0 ) ) . xyz ; jZ = jZ * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , j_ ) ;".split(" ")}]}}]},{type:"textline",b:"c jX = ag ( jQ - jW , jW , vec3 ( 0.0 ) , vec3 ( 0.0 ) , jR , jZ ) ; jX . b = jY ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c jX = ag ( jQ , jW , vec3 ( 0.0 ) , vec3 ( 0.0 ) , jR , u_model_matrix ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cc ( jX . a , jX . b , jR ) ;".split(" ")}]}}]},{type:"textline",b:"ja = jX . a ; jb = jX . e ; i_ = u_camera_eye - jX . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"a = aj ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"jd = jX . f ;".split(" ")}]}},{type:"elif",c:["VERTEX_COLOR"],
group:{type:"group",a:[{type:"textline",b:["jd","=","a_color",";"]}]}}]},{type:"textline",b:"vec4 kb = u_view_matrix * vec4 ( jX . a , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"! DISABLE_FOG || ( TEXTURE_NORM && PARALLAX ) || ( WATER_EFFECTS && CAUSTICS )".split(" "),group:{type:"group",a:[{type:"textline",b:["cA","=","kb",";"]}]}}]},{type:"textline",b:"vec4 kc = u_proj_matrix * kb ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",
b:"kc . xy += u_subpixel_jitter * kc . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["ea","(","kc",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"ea ( jX . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float kd = kc . x ; float ke = kc . y ; float kf = kc . w ; cz . x = ( kd + kf ) / 2.0 ; cz . y = ( ke + kf ) / 2.0 ; cz . z = kf ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"je = - kb . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","kc",";","}"]}]};a["nodes.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",
file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",
a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"textline",b:"uniform float u_shadow_visibility_falloff ; uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",
b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS",
"||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADED","&&","WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_NORMAL_VIEW",
"||","REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_reflectmap ; uniform vec4 u_refl_plane ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_refractmap ; uniform sampler2D u_scene_depth ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",
b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_LAMP"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 ja ; varying vec4 cA ;".split(" ")},{type:"condition",a:[{type:"if",
c:["SHADED","||","USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jb",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jc",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cv",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","cw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cy",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_REFRACTION".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec3","cz",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","je",";"]}]}}]},{type:"textline",b:"float jQ = 0.0 ; float jR = 1.0 ; vec3 jS = vec3 ( jR ) ; vec3 jT = vec3 ( jQ ) ;".split(" ")},{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"},{type:"textline",b:"vec3 jX ( in vec3 jU , in float jV ) { vec3 jW = vec3 ( jQ ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"jW = jP ( cz , jU . xz * jV ) ;".split(" ")}]}}]},{type:"textline",b:["return","jW",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_SEPHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 kd ( vec3 jY ) { vec4 jZ = vec4 ( jQ , - jR / 3.0 , 2.0 / 3.0 , - jR ) ; vec4 j_ = mix ( vec4 ( jY . bg , jZ . wz ) , vec4 ( jY . gb , jZ . xy ) , step ( jY . b , jY . g ) ) ; vec4 ka = mix ( vec4 ( j_ . xyw , jY . r ) , vec4 ( jY . r , j_ . yzx ) , step ( j_ . x , jY . r ) ) ; float kb = ka . x - min ( ka . w , ka . y ) ; float kc = 1.0e-10 ; return vec3 ( abs ( ka . z + ( ka . w - ka . y ) / ( 6.0 * kb + kc ) ) , kb / ( ka . x + kc ) , ka . x ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR || USE_NODE_COMBHSV".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 kh ( vec3 ke ) { vec4 kf = vec4 ( jR , 2.0 / 3.0 , jR / 3.0 , 3.0 ) ; vec3 kg = abs ( fract ( vec3 ( ke . r , ke . r , ke . r ) + kf . xyz ) * 6.0 - kf . www ) ; return ke . b * mix ( kf . xxx , clamp ( kg - kf . xxx , jQ , jR ) , ke . g ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 kj ( vec2 ki ) { return vec3 ( ki * 2.0 - vec2 ( jR , jR ) , jQ ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_TEXTURE_COLOR || USE_NODE_TEXTURE_NORMAL || USE_NODE_TEXTURE_COLOR2 || USE_NODE_TEXTURE_NORMAL2 || USE_NODE_TEXTURE_COLOR3 || USE_NODE_TEXTURE_NORMAL3 || USE_NODE_PARALLAX".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 kl ( vec3 kk ) { return vec2 ( kk . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},
{type:"textline",b:"void kq ( inout vec3 km , vec3 kn , vec3 ko , float kp ) {".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"jB ( km , kn , ko , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , kp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"jB ( km , kn , ko , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , kp ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["}"]},{type:"node",name:"CAMERA",group:{type:"group",a:[{type:"node_out",name:"lg",qualifier:["vec3"]},{type:"node_out",name:"lh",qualifier:["float"]},{type:"node_out",name:"li",qualifier:["float"]},{type:"textline",b:"lg = normalize ( kW . xyz ) ; lh = abs ( kW . z ) ; li = length ( kW . xyz ) ;".split(" ")}]}},{type:"node",name:"COMBRGB",group:{type:"group",a:[{type:"node_in",name:"lj",qualifier:["float"]},{type:"node_in",name:"lk",qualifier:["float"]},{type:"node_in",name:"ll",
qualifier:["float"]},{type:"node_out",name:"lm",qualifier:["vec3"]},{type:"textline",b:"lm = vec3 ( lj , lk , ll ) ;".split(" ")}]}},{type:"node",name:"COMBHSV",group:{type:"group",a:[{type:"node_in",name:"ln",qualifier:["float"]},{type:"node_in",name:"lo",qualifier:["float"]},{type:"node_in",name:"lp",qualifier:["float"]},{type:"node_out",name:"lq",qualifier:["vec3"]},{type:"textline",b:"lq = kh ( vec3 ( ln , lo , lp ) ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",
name:"kr",qualifier:["varying","vec2"]},{type:"node_out",name:"lr",qualifier:["vec3"]},{type:"textline",b:"lr = kj ( kr ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VC",group:{type:"group",a:[{type:"node_param",name:"ks",qualifier:["varying","vec3"]},{type:"node_out",name:"ls",qualifier:["vec3"]},{type:"textline",b:["ls","=","ks",";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"kt",qualifier:["varying","float"]},{type:"node_out",name:"lt",qualifier:["float"]},
{type:"textline",b:["lt","=","kt",";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"ku",qualifier:["varying","vec2"]},{type:"node_out",name:"lu",qualifier:["float"]},{type:"node_out",name:"lv",qualifier:["float"]},{type:"textline",b:"lu = ku [ 0 ] ; lv = ku [ 1 ] ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VC3",group:{type:"group",a:[{type:"node_param",name:"kv",qualifier:["varying","vec3"]},{type:"node_out",name:"lw",qualifier:["float"]},{type:"node_out",
name:"lx",qualifier:["float"]},{type:"node_out",name:"ly",qualifier:["float"]},{type:"textline",b:"lw = kv [ 0 ] ; lx = kv [ 1 ] ; ly = kv [ 2 ] ;".split(" ")}]}},{type:"node",name:"GEOMETRY_NO",group:{type:"group",a:[{type:"node_out",name:"lz",qualifier:["vec3"]},{type:"textline",b:["lz","=","kQ",";"]}]}},{type:"node",name:"GEOMETRY_FB",group:{type:"group",a:[{type:"node_out",name:"lA",qualifier:["float"]},{type:"textline",b:"lA = ( gl_FrontFacing ) ? jR : jQ ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VW",
group:{type:"group",a:[{type:"node_out",name:"lB",qualifier:["vec3"]},{type:"textline",b:["lB","=","kU",";"]}]}},{type:"node",name:"GEOMETRY_GL",group:{type:"group",a:[{type:"node_out",name:"lC",qualifier:["vec3"]},{type:"textline",b:"lC = vec3 ( kV . r , - kV . b , kV . g ) ;".split(" ")}]}},{type:"node",name:"HUE_SAT",group:{type:"group",a:[{type:"node_in",name:"lD",qualifier:["float"]},{type:"node_in",name:"lE",qualifier:["float"]},{type:"node_in",name:"lF",qualifier:["float"]},{type:"node_in",
name:"lG",qualifier:["float"]},{type:"node_in",name:"lH",qualifier:["vec3"]},{type:"node_out",name:"lI",qualifier:["vec3"]},{type:"textline",b:"{ vec3 lJ = kd ( lH ) ; lJ [ 0 ] += ( lD - 0.5 ) ; if ( lJ [ 0 ] > jR ) lJ [ 0 ] -= jR ; else if ( lJ [ 0 ] < jQ ) lJ [ 0 ] += jR ; lJ *= vec3 ( jR , lE , lF ) ; lJ = mix ( jS , mix ( jT , lJ , step ( jT , lJ ) ) , step ( lJ , jS ) ) ; lI = mix ( lH , kh ( lJ ) , lG ) ; }".split(" ")}]}},{type:"node",name:"INVERT",group:{type:"group",a:[{type:"node_in",name:"lK",
qualifier:["float"]},{type:"node_in",name:"lL",qualifier:["vec3"]},{type:"node_out",name:"lM",qualifier:["vec3"]},{type:"textline",b:"lM = mix ( lL , vec3 ( jR ) - lL , lK ) ;".split(" ")}]}},{type:"node",name:"LAMP",group:{type:"group",a:[{type:"node_param",name:"kw",qualifier:["const","float"]},{type:"node_out",name:"lN",qualifier:["vec3"]},{type:"node_out",name:"lO",qualifier:["vec3"]},{type:"node_out",name:"lP",qualifier:["float"]},{type:"node_out",name:"lQ",qualifier:["float"]},{type:"textline",
b:"{ const int lR = int ( kw ) ; float lS = u_lamp_light_factors [ lR ] . z ; lN = u_lamp_light_color_intensities [ lR ] ; if ( lS != - jR ) { lO = u_lamp_light_positions [ lR ] - ja ; lP = length ( lO ) ; lO = normalize ( lO ) ; lQ = lS / ( lS + lP * lP ) ; } else { lO = u_lamp_light_directions [ lR ] ; lP = length ( u_lamp_light_positions [ lR ] - ja ) ; lQ = jR ; } }".split(" ")}]}},{type:"node",name:"NORMAL",group:{type:"group",a:[{type:"node_param",name:"kx",qualifier:["vec3"]},{type:"node_in",
name:"lT",qualifier:["vec3"]},{type:"node_out",name:"lU",qualifier:["vec3"]},{type:"node_out",name:"lV",qualifier:["float"]},{type:"textline",b:"lU = kx ; lV = - dot ( lT , kx ) ;".split(" ")}]}},{type:"node",name:"NORMAL_VIEW",group:{type:"group",a:[{type:"node_in",name:"lW",qualifier:["vec3"]},{type:"node_out",name:"lX",qualifier:["vec3"]},{type:"textline",b:"lX = - ( u_view_matrix_frag * vec4 ( lW , jQ ) ) . xyz ;".split(" ")}]}},{type:"node",name:"MAPPING_LIGHT",group:{type:"group",a:[{type:"node_param",
name:"ky",qualifier:["vec3"]},{type:"node_in",name:"lY",qualifier:["vec3"]},{type:"node_out",name:"lZ",qualifier:["vec3"]},{type:"textline",b:"lZ = lY * ky ;".split(" ")}]}},{type:"node",name:"MAPPING_HEAVY",group:{type:"group",a:[{type:"node_param",name:"kz",qualifier:["mat4"]},{type:"node_param",name:"kA",qualifier:["const","float"]},{type:"node_param",name:"kB",qualifier:["const","float"]},{type:"node_param",name:"kC",qualifier:["vec3"]},{type:"node_param",name:"kD",qualifier:["vec3"]},{type:"node_in",
name:"l_",qualifier:["vec3"]},{type:"node_out",name:"ma",qualifier:["vec3"]},{type:"textline",b:"ma = ( kz * vec4 ( l_ , jR ) ) . xyz ; if ( kA == jR ) ma = max ( ma , kC ) ; if ( kB == jR ) ma = min ( ma , kD ) ;".split(" ")}]}},{type:"node",name:"MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"mb",qualifier:["float"]},{type:"node_in",name:"mc",qualifier:["float"]},{type:"node_out",name:"md",qualifier:["float"]},{type:"textline",b:"md = mb + mc ;".split(" ")}]}},{type:"node",name:"MATH_SUBTRACT",
group:{type:"group",a:[{type:"node_in",name:"me",qualifier:["float"]},{type:"node_in",name:"mf",qualifier:["float"]},{type:"node_out",name:"mg",qualifier:["float"]},{type:"textline",b:"mg = me - mf ;".split(" ")}]}},{type:"node",name:"MATH_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"mh",qualifier:["float"]},{type:"node_in",name:"mi",qualifier:["float"]},{type:"node_out",name:"mj",qualifier:["float"]},{type:"textline",b:"mj = mh * mi ;".split(" ")}]}},{type:"node",name:"MATH_DIVIDE",group:{type:"group",
a:[{type:"node_in",name:"mk",qualifier:["float"]},{type:"node_in",name:"ml",qualifier:["float"]},{type:"node_out",name:"mm",qualifier:["float"]},{type:"textline",b:"mm = ( ml != jQ ) ? mk / ml : jQ ;".split(" ")}]}},{type:"node",name:"MATH_SINE",group:{type:"group",a:[{type:"node_in",name:"mn",qualifier:["float"]},{type:"node_in",name:"mo",qualifier:["float"]},{type:"node_out",name:"mp",qualifier:["float"]},{type:"textline",b:"mp = sin ( mn ) ; mo ;".split(" ")}]}},{type:"node",name:"MATH_COSINE",
group:{type:"group",a:[{type:"node_in",name:"mq",qualifier:["float"]},{type:"node_in",name:"mr",qualifier:["float"]},{type:"node_out",name:"ms",qualifier:["float"]},{type:"textline",b:"ms = cos ( mq ) ; mr ;".split(" ")}]}},{type:"node",name:"MATH_TANGENT",group:{type:"group",a:[{type:"node_in",name:"mt",qualifier:["float"]},{type:"node_in",name:"mu",qualifier:["float"]},{type:"node_out",name:"mv",qualifier:["float"]},{type:"textline",b:"mv = tan ( mt ) ; mu ;".split(" ")}]}},{type:"node",name:"MATH_ARCSINE",
group:{type:"group",a:[{type:"node_in",name:"mw",qualifier:["float"]},{type:"node_in",name:"mx",qualifier:["float"]},{type:"node_out",name:"my",qualifier:["float"]},{type:"textline",b:"my = ( mw <= jR && mw >= - jR ) ? asin ( mw ) : jQ ; mx ;".split(" ")}]}},{type:"node",name:"MATH_ARCCOSINE",group:{type:"group",a:[{type:"node_in",name:"mz",qualifier:["float"]},{type:"node_in",name:"mA",qualifier:["float"]},{type:"node_out",name:"mB",qualifier:["float"]},{type:"textline",b:"mB = ( mz <= jR && mz >= - jR ) ? acos ( mz ) : jQ ; mA ;".split(" ")}]}},
{type:"node",name:"MATH_ARCTANGENT",group:{type:"group",a:[{type:"node_in",name:"mC",qualifier:["float"]},{type:"node_in",name:"mD",qualifier:["float"]},{type:"node_out",name:"mE",qualifier:["float"]},{type:"textline",b:"mE = atan ( mC ) ; mD ;".split(" ")}]}},{type:"node",name:"MATH_POWER",group:{type:"group",a:[{type:"node_in",name:"mF",qualifier:["float"]},{type:"node_in",name:"mG",qualifier:["float"]},{type:"node_out",name:"mH",qualifier:["float"]},{type:"textline",b:"if ( mF < jQ || mF == jQ && mG == jQ ) mH = jQ ; else mH = pow ( mF , mG ) ;".split(" ")}]}},
{type:"node",name:"MATH_LOGARITHM",group:{type:"group",a:[{type:"node_in",name:"mI",qualifier:["float"]},{type:"node_in",name:"mJ",qualifier:["float"]},{type:"node_out",name:"mK",qualifier:["float"]},{type:"textline",b:"mK = ( mI > jQ && mJ > jQ ) ? log2 ( mI ) / log2 ( mJ ) : jQ ;".split(" ")}]}},{type:"node",name:"MATH_MINIMUM",group:{type:"group",a:[{type:"node_in",name:"mL",qualifier:["float"]},{type:"node_in",name:"mM",qualifier:["float"]},{type:"node_out",name:"mN",qualifier:["float"]},{type:"textline",
b:"mN = min ( mL , mM ) ;".split(" ")}]}},{type:"node",name:"MATH_MAXIMUM",group:{type:"group",a:[{type:"node_in",name:"mO",qualifier:["float"]},{type:"node_in",name:"mP",qualifier:["float"]},{type:"node_out",name:"mQ",qualifier:["float"]},{type:"textline",b:"mQ = max ( mO , mP ) ;".split(" ")}]}},{type:"node",name:"MATH_ROUND",group:{type:"group",a:[{type:"node_in",name:"mR",qualifier:["float"]},{type:"node_in",name:"mS",qualifier:["float"]},{type:"node_out",name:"mT",qualifier:["float"]},{type:"textline",
b:"mT = floor ( mR + 0.5 ) ; mS ;".split(" ")}]}},{type:"node",name:"MATH_LESS_THAN",group:{type:"group",a:[{type:"node_in",name:"mU",qualifier:["float"]},{type:"node_in",name:"mV",qualifier:["float"]},{type:"node_out",name:"mW",qualifier:["float"]},{type:"textline",b:"mW = ( mU < mV ) ? jR : jQ ;".split(" ")}]}},{type:"node",name:"MATH_GREATER_THAN",group:{type:"group",a:[{type:"node_in",name:"mX",qualifier:["float"]},{type:"node_in",name:"mY",qualifier:["float"]},{type:"node_out",name:"mZ",qualifier:["float"]},
{type:"textline",b:"mZ = ( mX > mY ) ? jR : jQ ;".split(" ")}]}},{type:"node",name:"MATH_MODULO",group:{type:"group",a:[{type:"node_in",name:"m_",qualifier:["float"]},{type:"node_in",name:"na",qualifier:["float"]},{type:"node_out",name:"nb",qualifier:["float"]},{type:"textline",b:"nb = abs ( na ) > 0.000001 ? mod ( m_ , na ) : jQ ;".split(" ")}]}},{type:"node",name:"MIX_RGB_MIX",group:{type:"group",a:[{type:"node_in",name:"nc",qualifier:["float"]},{type:"node_in",name:"nd",qualifier:["vec3"]},{type:"node_in",
name:"ne",qualifier:["vec3"]},{type:"node_out",name:"nf",qualifier:["vec3"]},{type:"textline",b:"{ float ng = clamp ( nc , jQ , jR ) ; nf = mix ( nd , ne , ng ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_ADD",group:{type:"group",a:[{type:"node_in",name:"nh",qualifier:["float"]},{type:"node_in",name:"ni",qualifier:["vec3"]},{type:"node_in",name:"nj",qualifier:["vec3"]},{type:"node_out",name:"nk",qualifier:["vec3"]},{type:"textline",b:"{ float nl = clamp ( nh , jQ , jR ) ; nk = mix ( ni , ni + nj , nl ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"nm",qualifier:["float"]},{type:"node_in",name:"nn",qualifier:["vec3"]},{type:"node_in",name:"no",qualifier:["vec3"]},{type:"node_out",name:"np",qualifier:["vec3"]},{type:"textline",b:"{ float nq = clamp ( nm , jQ , jR ) ; np = mix ( nn , nn * no , nq ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"nr",qualifier:["float"]},{type:"node_in",name:"ns",qualifier:["vec3"]},
{type:"node_in",name:"nt",qualifier:["vec3"]},{type:"node_out",name:"nu",qualifier:["vec3"]},{type:"textline",b:"{ float nv = clamp ( nr , jQ , jR ) ; nu = mix ( ns , ns - nt , nv ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_SCREEN",group:{type:"group",a:[{type:"node_in",name:"nw",qualifier:["float"]},{type:"node_in",name:"nx",qualifier:["vec3"]},{type:"node_in",name:"ny",qualifier:["vec3"]},{type:"node_out",name:"nz",qualifier:["vec3"]},{type:"textline",b:"{ float nA = clamp ( nw , jQ , jR ) ; float nB = jR - nA ; nz = jS - ( vec3 ( nB ) + nA * ( jS - ny ) ) * ( jS - nx ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_DIVIDE",group:{type:"group",a:[{type:"node_in",name:"nC",qualifier:["float"]},{type:"node_in",name:"nD",qualifier:["vec3"]},{type:"node_in",name:"nE",qualifier:["vec3"]},{type:"node_out",name:"nF",qualifier:["vec3"]},{type:"textline",b:"{ float nG = clamp ( nC , jQ , jR ) ; float nH = jR - nG ; nE += step ( nE , jT ) ; nF = nH * nD + nG * nD / nE ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DIFFERENCE",group:{type:"group",a:[{type:"node_in",name:"nI",qualifier:["float"]},
{type:"node_in",name:"nJ",qualifier:["vec3"]},{type:"node_in",name:"nK",qualifier:["vec3"]},{type:"node_out",name:"nL",qualifier:["vec3"]},{type:"textline",b:"{ float nM = clamp ( nI , jQ , jR ) ; nL = mix ( nJ , abs ( nJ - nK ) , nM ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DARKEN",group:{type:"group",a:[{type:"node_in",name:"nN",qualifier:["float"]},{type:"node_in",name:"nO",qualifier:["vec3"]},{type:"node_in",name:"nP",qualifier:["vec3"]},{type:"node_out",name:"nQ",qualifier:["vec3"]},{type:"textline",
b:"{ float nR = clamp ( nN , jQ , jR ) ; nQ = min ( nO . rgb , nP . rgb * nR ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LIGHTEN",group:{type:"group",a:[{type:"node_in",name:"nS",qualifier:["float"]},{type:"node_in",name:"nT",qualifier:["vec3"]},{type:"node_in",name:"nU",qualifier:["vec3"]},{type:"node_out",name:"nV",qualifier:["vec3"]},{type:"textline",b:"{ float nW = clamp ( nS , jQ , jR ) ; nV = max ( nT . rgb , nU . rgb * nW ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_OVERLAY",group:{type:"group",
a:[{type:"node_in",name:"nX",qualifier:["float"]},{type:"node_in",name:"nY",qualifier:["vec3"]},{type:"node_in",name:"nZ",qualifier:["vec3"]},{type:"node_out",name:"n_",qualifier:["vec3"]},{type:"textline",b:"{ float oa = clamp ( nX , jQ , jR ) ; float ob = jR - oa ; vec3 oc = vec3 ( ob ) ; n_ = mix ( nY * ( oc + 2.0 * oa * nZ ) , jS - ( oc + 2.0 * oa * ( jS - nZ ) ) * ( jS - nY ) , step ( 0.5 , nY ) ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DODGE",group:{type:"group",a:[{type:"node_in",name:"od",
qualifier:["float"]},{type:"node_in",name:"oe",qualifier:["vec3"]},{type:"node_in",name:"of",qualifier:["vec3"]},{type:"node_out",name:"og",qualifier:["vec3"]},{type:"textline",b:"{ float oh = clamp ( od , jQ , jR ) ; vec3 oi = jS - oh * of ; vec3 oj = oe / ( oi + step ( oi , jT ) ) ; og = ( jS - step ( oe , jT ) ) * mix ( mix ( jS , oj , step ( oj , jS ) ) , jS , step ( oi , jT ) ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_BURN",group:{type:"group",a:[{type:"node_in",name:"ok",qualifier:["float"]},
{type:"node_in",name:"ol",qualifier:["vec3"]},{type:"node_in",name:"om",qualifier:["vec3"]},{type:"node_out",name:"on",qualifier:["vec3"]},{type:"textline",b:"{ float oo = clamp ( ok , jQ , jR ) ; vec3 op = jS - oo * ( jS - om ) ; vec3 oq = jS - ( jS - ol ) / ( op + step ( op , jT ) ) ; on = mix ( mix ( jT , mix ( jS , oq , step ( oq , jS ) ) , step ( jQ , oq ) ) , jT , step ( op , jT ) ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_HUE",group:{type:"group",a:[{type:"node_in",name:"or",qualifier:["float"]},
{type:"node_in",name:"os",qualifier:["vec3"]},{type:"node_in",name:"ot",qualifier:["vec3"]},{type:"node_out",name:"ou",qualifier:["vec3"]},{type:"textline",b:"{ float ov = clamp ( or , jQ , jR ) ; vec3 ow , ox , oy ; ou = os ; ox = kd ( ot ) ; if ( ox . y != jQ ) { ow = kd ( ou ) ; ow . x = ox . x ; oy = kh ( ow ) ; ou = mix ( ou , oy , ov ) ; } }".split(" ")}]}},{type:"node",name:"MIX_RGB_SATURATION",group:{type:"group",a:[{type:"node_in",name:"oz",qualifier:["float"]},{type:"node_in",name:"oA",
qualifier:["vec3"]},{type:"node_in",name:"oB",qualifier:["vec3"]},{type:"node_out",name:"oC",qualifier:["vec3"]},{type:"textline",b:"{ float oD = clamp ( oz , jQ , jR ) ; float oE = jR - oD ; oC = oA ; vec3 oF , oG ; oF = kd ( oC ) ; if ( oF . y != jQ ) { oG = kd ( oB ) ; oF . y = oE * oF . y + oD * oG . y ; oC = kh ( oF ) ; } }".split(" ")}]}},{type:"node",name:"MIX_RGB_VALUE",group:{type:"group",a:[{type:"node_in",name:"oH",qualifier:["float"]},{type:"node_in",name:"oI",qualifier:["vec3"]},{type:"node_in",
name:"oJ",qualifier:["vec3"]},{type:"node_out",name:"oK",qualifier:["vec3"]},{type:"textline",b:"{ float oL = clamp ( oH , jQ , jR ) ; float oM = jR - oL ; vec3 oN , oO ; oN = kd ( oI ) ; oO = kd ( oJ ) ; oN . z = oM * oN . z + oL * oO . z ; oK = kh ( oN ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_COLOR",group:{type:"group",a:[{type:"node_in",name:"oP",qualifier:["float"]},{type:"node_in",name:"oQ",qualifier:["vec3"]},{type:"node_in",name:"oR",qualifier:["vec3"]},{type:"node_out",name:"oS",qualifier:["vec3"]},
{type:"textline",b:"{ float oT = clamp ( oP , jQ , jR ) ; vec3 oU , oV , oW ; oS = oQ ; oV = kd ( oR ) ; if ( oV . y != jQ ) { oU = kd ( oS ) ; oU . x = oV . x ; oU . y = oV . y ; oW = kh ( oU ) ; oS = mix ( oS , oW , oT ) ; } }".split(" ")}]}},{type:"node",name:"MIX_RGB_SOFT_LIGHT",group:{type:"group",a:[{type:"node_in",name:"oX",qualifier:["float"]},{type:"node_in",name:"oY",qualifier:["vec3"]},{type:"node_in",name:"oZ",qualifier:["vec3"]},{type:"node_out",name:"o_",qualifier:["vec3"]},{type:"textline",
b:"{ float pa = clamp ( oX , jQ , jR ) ; float pb = jR - pa ; vec3 pc = oZ + oY - oZ * oY ; o_ = oY * ( vec3 ( pb ) + vec3 ( pa ) * ( ( jS - oY ) * oZ + pc ) ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",group:{type:"group",a:[{type:"node_in",name:"pd",qualifier:["float"]},{type:"node_in",name:"pe",qualifier:["vec3"]},{type:"node_in",name:"pf",qualifier:["vec3"]},{type:"node_out",name:"pg",qualifier:["vec3"]},{type:"textline",b:"{ float ph = clamp ( pd , jQ , jR ) ; pg = clamp ( pe + ph * ( 2.0 * pf - jS ) , jQ , jR ) ; }".split(" ")}]}},
{type:"node",name:"OUTPUT",group:{type:"group",a:[{type:"node_in",name:"pi",qualifier:["vec3"]},{type:"node_in",name:"pj",qualifier:["float"]},{type:"textline",b:"la = pi ; lf = pj ;".split(" ")}]}},{type:"node",name:"MATERIAL",group:{type:"group",a:[{type:"node_param",name:"kE",qualifier:["const","vec3"]},{type:"node_param",name:"kF",qualifier:["const","vec4"]},{type:"node_param",name:"kG",qualifier:["const","float"]},{type:"node_in",name:"pk",qualifier:["vec3"]},{type:"node_in",name:"pl",qualifier:["float"]},
{type:"node_in",name:"pm",qualifier:["vec3"]},{type:"node_in",name:"pn",qualifier:["vec3"]},{type:"node_out",name:"po",qualifier:["vec3"]},{type:"node_out",name:"pp",qualifier:["float"]},{type:"node_out",name:"pq",qualifier:["vec3"]},{type:"textline",b:"{ pk = clamp ( pk , jQ , jR ) ; pl = clamp ( pl , jQ , jR ) ; pm = clamp ( pm , jQ , jR ) ; vec3 pr = pk ; float ps = kE [ 0 ] ; vec2 pt = vec2 ( kE [ 1 ] , kE [ 2 ] ) ; vec3 pu = kX * pk ; vec3 pv = kY * kS ; vec3 pw = kF [ 1 ] * pm ; float px = kF [ 0 ] ; vec2 py = vec2 ( kF [ 2 ] , kF [ 3 ] ) ; float pz = di ( kZ , pr ) ; vec3 pA ; if ( kG == jR ) pA = normalize ( pn ) ; else pA = kQ ; fd pB = hy ( pu , pv , pr , pw , kV , pA , kU , py , pt , pz , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , jQ , vec4 ( jQ ) ) ; po = ( ps == jR ) ? pB . a . rgb : vec3 ( jQ ) ; pp = pl + pB . a . a * pw . r ; pp = clamp ( pp , jQ , jR ) ; pq = pA ; if ( px == jR ) { po += pB . b ; lb = pB . b ; } else { lb = vec3 ( jQ ) ; } lc = pA ; le = pz ; }".split(" ")}]}},
{type:"node",name:"MATERIAL_EXT",group:{type:"group",a:[{type:"node_param",name:"kH",qualifier:["const","vec3"]},{type:"node_param",name:"kI",qualifier:["const","vec4"]},{type:"node_param",name:"kJ",qualifier:["const","float"]},{type:"node_in",name:"pC",qualifier:["vec3"]},{type:"node_in",name:"pD",qualifier:["float"]},{type:"node_in",name:"pE",qualifier:["vec3"]},{type:"node_in",name:"pF",qualifier:["vec3"]},{type:"node_in",name:"pG",qualifier:["float"]},{type:"node_in",name:"pH",qualifier:["float"]},
{type:"node_in",name:"pI",qualifier:["vec4"]},{type:"node_in",name:"pJ",qualifier:["float"]},{type:"node_out",name:"pK",qualifier:["vec3"]},{type:"node_out",name:"pL",qualifier:["float"]},{type:"node_out",name:"pM",qualifier:["vec3"]},{type:"node_out",name:"pN",qualifier:["vec3"]},{type:"node_out",name:"pO",qualifier:["vec3"]},{type:"textline",b:"{ pC = clamp ( pC , jQ , jR ) ; pD = clamp ( pD , jQ , jR ) ; pE = clamp ( pE , jQ , jR ) ; vec3 pP = pC ; float pQ = kH [ 0 ] ; vec2 pR = vec2 ( kH [ 1 ] , kH [ 2 ] ) ; vec3 pS = pG * pC ; vec3 pT = kY * kS ; vec3 pU = kI [ 1 ] * pE ; float pV = kI [ 0 ] ; vec2 pW = vec2 ( kI [ 2 ] , kI [ 3 ] ) ; float pX = di ( kZ , pP ) ; vec3 pY ; if ( kJ == jR ) pY = normalize ( pF ) ; else pY = kQ ; fd pZ = hy ( pS , pT , pP , pU , kV , pY , kU , pW , pR , pX , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , pH , pI ) ; pK = ( pQ == jR ) ? pZ . a . rgb : vec3 ( jQ ) ; pL = pD ; pM = pY ; pN = pZ . a . rgb ; pO = pZ . b ; kq ( pK , kU , pM , pJ ) ; if ( pV == jR ) { pK += pZ . b ; pL += pZ . a . a * pU . r ; pL = clamp ( pL , jQ , jR ) ; lb = pZ . b ; } else { lb = vec3 ( jQ ) ; } lc = pY ; le = pX ; }".split(" ")}]}},
{type:"node",name:"RGB",group:{type:"group",a:[{type:"node_param",name:"kK",qualifier:["vec3"]},{type:"node_out",name:"p_",qualifier:["vec3"]},{type:"textline",b:["p_","=","kK",";"]}]}},{type:"node",name:"RGBTOBW",group:{type:"group",a:[{type:"node_in",name:"qa",qualifier:["vec3"]},{type:"node_out",name:"qb",qualifier:["float"]},{type:"textline",b:"qb = qa . r * 0.35 + qa . g * 0.45 + qa . b * 0.2 ;".split(" ")}]}},{type:"node",name:"SEPRGB",group:{type:"group",a:[{type:"node_in",name:"qc",qualifier:["vec3"]},
{type:"node_out",name:"qd",qualifier:["float"]},{type:"node_out",name:"qe",qualifier:["float"]},{type:"node_out",name:"qf",qualifier:["float"]},{type:"textline",b:"qd = qc . r ; qe = qc . g ; qf = qc . b ;".split(" ")}]}},{type:"node",name:"SEPHSV",group:{type:"group",a:[{type:"node_in",name:"qg",qualifier:["vec3"]},{type:"node_out",name:"qh",qualifier:["float"]},{type:"node_out",name:"qi",qualifier:["float"]},{type:"node_out",name:"qj",qualifier:["float"]},{type:"textline",b:"{ vec3 qk = kd ( qg ) ; qh = qk . r ; qi = qk . g ; qj = qk . b ; }".split(" ")}]}},
{type:"node",name:"SQUEEZE",group:{type:"group",a:[{type:"node_in",name:"ql",qualifier:["float"]},{type:"node_in",name:"qm",qualifier:["float"]},{type:"node_in",name:"qn",qualifier:["float"]},{type:"node_out",name:"qo",qualifier:["float"]},{type:"textline",b:"qo = jR / ( jR + pow ( 2.71828183 , - ( ( ql - qn ) * qm ) ) ) ;".split(" ")}]}},{type:"node",name:"SRGB_TO_LINEAR",group:{type:"group",a:[{type:"node_in",name:"qp",qualifier:["vec3"]},{type:"node_out",name:"qq",qualifier:["vec3"]},{type:"textline",
b:"qq = max ( jT , qp ) ; qq = pow ( qq , vec3 ( 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"LINEAR_TO_SRGB",group:{type:"group",a:[{type:"node_in",name:"qr",qualifier:["vec3"]},{type:"node_out",name:"qs",qualifier:["vec3"]},{type:"textline",b:"qs = max ( jT , qr ) ; qs = pow ( qs , vec3 ( jR / 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"qt",qualifier:["vec3"]},
{type:"node_out",name:"qu",qualifier:["vec3"]},{type:"node_out",name:"qv",qualifier:["float"]},{type:"textline",b:"{ vec4 qw = texture2D ( node_TEXTURE_COLOR_var_texture , kl ( qt ) ) ; qu = qw . xyz ; eh ( qu ) ; qv = qw . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"qx",qualifier:["vec3"]},{type:"node_out",name:"qy",qualifier:["vec3"]},{type:"node_out",
name:"qz",qualifier:["float"]},{type:"textline",b:"{ vec4 qA = texture2D ( node_TEXTURE_NORMAL_var_texture , kl ( qx ) ) ; ld = qA . xyz - 0.5 ; qy = normalize ( k_ * ld ) ; qz = qA . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_ENVIRONMENT",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]},{type:"node_in",name:"qB",qualifier:["vec3"]},{type:"node_out",name:"qC",qualifier:["vec3"]},{type:"node_out",name:"qD",qualifier:["float"]},
{type:"textline",b:"{ vec4 qE = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , qB ) ; qC = qE . xyz ; eh ( qC ) ; qD = qE . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR2",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR2_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"qF",qualifier:["vec3"]},{type:"node_in",name:"qG",qualifier:["vec3"]},{type:"node_out",name:"qH",qualifier:["vec3"]},{type:"node_out",name:"qI",qualifier:["float"]},{type:"node_out",
name:"qJ",qualifier:["vec3"]},{type:"node_out",name:"qK",qualifier:["float"]},{type:"textline",b:"{ vec4 qL = texture2D ( node_TEXTURE_COLOR2_var_texture , kl ( qF ) ) ; qH = qL . xyz ; eh ( qH ) ; qI = qL . w ; qL = texture2D ( node_TEXTURE_COLOR2_var_texture , kl ( qG ) ) ; qJ = qL . xyz ; eh ( qJ ) ; qK = qL . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL2",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL2_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",
name:"qM",qualifier:["vec3"]},{type:"node_in",name:"qN",qualifier:["vec3"]},{type:"node_out",name:"qO",qualifier:["vec3"]},{type:"node_out",name:"qP",qualifier:["float"]},{type:"node_out",name:"qQ",qualifier:["vec3"]},{type:"node_out",name:"qR",qualifier:["float"]},{type:"textline",b:"{ vec4 qS = texture2D ( node_TEXTURE_NORMAL2_var_texture , kl ( qM ) ) ; ld = qS . xyz - 0.5 ; qO = normalize ( k_ * ld ) ; qP = qS . w ; qS = texture2D ( node_TEXTURE_NORMAL2_var_texture , kl ( qN ) ) ; ld = qS . xyz - 0.5 ; qQ = normalize ( k_ * ld ) ; qR = qS . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_COLOR3",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"qT",qualifier:["vec3"]},{type:"node_in",name:"qU",qualifier:["vec3"]},{type:"node_in",name:"qV",qualifier:["vec3"]},{type:"node_out",name:"qW",qualifier:["vec3"]},{type:"node_out",name:"qX",qualifier:["float"]},{type:"node_out",name:"qY",qualifier:["vec3"]},{type:"node_out",name:"qZ",qualifier:["float"]},{type:"node_out",name:"q_",
qualifier:["vec3"]},{type:"node_out",name:"ra",qualifier:["float"]},{type:"textline",b:"{ vec4 rb = texture2D ( node_TEXTURE_COLOR3_var_texture , kl ( qT ) ) ; qW = rb . xyz ; eh ( qW ) ; qX = rb . w ; rb = texture2D ( node_TEXTURE_COLOR3_var_texture , kl ( qU ) ) ; qY = rb . xyz ; eh ( qY ) ; qZ = rb . w ; rb = texture2D ( node_TEXTURE_COLOR3_var_texture , kl ( qV ) ) ; q_ = rb . xyz ; eh ( q_ ) ; ra = rb . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL3",group:{type:"group",a:[{type:"node_param",
name:"node_TEXTURE_NORMAL3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"rc",qualifier:["vec3"]},{type:"node_in",name:"rd",qualifier:["vec3"]},{type:"node_in",name:"re",qualifier:["vec3"]},{type:"node_out",name:"rf",qualifier:["vec3"]},{type:"node_out",name:"rg",qualifier:["float"]},{type:"node_out",name:"rh",qualifier:["vec3"]},{type:"node_out",name:"ri",qualifier:["float"]},{type:"node_out",name:"rj",qualifier:["vec3"]},{type:"node_out",name:"rk",qualifier:["float"]},{type:"textline",
b:"{ vec4 rl = texture2D ( node_TEXTURE_NORMAL3_var_texture , kl ( rc ) ) ; ld = rl . xyz - 0.5 ; rf = normalize ( k_ * ld ) ; rg = rl . w ; rl = texture2D ( node_TEXTURE_NORMAL3_var_texture , kl ( rd ) ) ; ld = rl . xyz - 0.5 ; rh = normalize ( k_ * ld ) ; ri = rl . w ; rl = texture2D ( node_TEXTURE_NORMAL3_var_texture , kl ( re ) ) ; ld = rl . xyz - 0.5 ; rj = normalize ( k_ * ld ) ; rk = rl . w ; }".split(" ")}]}},{type:"node",name:"VALUE",group:{type:"group",a:[{type:"node_param",name:"kL",qualifier:["float"]},
{type:"node_out",name:"rm",qualifier:["float"]},{type:"textline",b:["rm","=","kL",";"]}]}},{type:"node",name:"VECT_MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"rn",qualifier:["vec3"]},{type:"node_in",name:"ro",qualifier:["vec3"]},{type:"node_out",name:"rp",qualifier:["vec3"]},{type:"node_out",name:"rq",qualifier:["float"]},{type:"textline",b:"rp = rn + ro ; rq = ( abs ( rp [ 0 ] ) + abs ( rp [ 1 ] ) + abs ( rp [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_SUBTRACT",group:{type:"group",
a:[{type:"node_in",name:"rr",qualifier:["vec3"]},{type:"node_in",name:"rs",qualifier:["vec3"]},{type:"node_out",name:"rt",qualifier:["vec3"]},{type:"node_out",name:"ru",qualifier:["float"]},{type:"textline",b:"rt = rr - rs ; ru = ( abs ( rt [ 0 ] ) + abs ( rt [ 1 ] ) + abs ( rt [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_AVERAGE",group:{type:"group",a:[{type:"node_in",name:"rv",qualifier:["vec3"]},{type:"node_in",name:"rw",qualifier:["vec3"]},{type:"node_out",name:"rx",qualifier:["vec3"]},
{type:"node_out",name:"ry",qualifier:["float"]},{type:"textline",b:"rx = rv + rw ; ry = length ( rx ) ; rx = normalize ( rx ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_DOT_PRODUCT",group:{type:"group",a:[{type:"node_in",name:"rz",qualifier:["vec3"]},{type:"node_in",name:"rA",qualifier:["vec3"]},{type:"node_out",name:"rB",qualifier:["vec3"]},{type:"node_out",name:"rC",qualifier:["float"]},{type:"textline",b:"rB = vec3 ( jQ ) ; rC = dot ( rz , rA ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",
group:{type:"group",a:[{type:"node_in",name:"rD",qualifier:["vec3"]},{type:"node_in",name:"rE",qualifier:["vec3"]},{type:"node_out",name:"rF",qualifier:["vec3"]},{type:"node_out",name:"rG",qualifier:["float"]},{type:"textline",b:"rF = cross ( rD , rE ) ; rG = length ( rF ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_NORMALIZE",group:{type:"group",a:[{type:"node_in",name:"rH",qualifier:["vec3"]},{type:"node_in",name:"rI",qualifier:["vec3"]},{type:"node_out",name:"rJ",qualifier:["vec3"]},{type:"node_out",
name:"rK",qualifier:["float"]},{type:"textline",b:"rJ = normalize ( rH ) ; rK = length ( rH ) ; rI ;".split(" ")}]}},{type:"node",name:"REFLECT",group:{type:"group",a:[{type:"node_in",name:"rL",qualifier:["vec3"]},{type:"node_in",name:"rM",qualifier:["vec3"]},{type:"node_out",name:"rN",qualifier:["vec3"]},{type:"textline",b:"rN = reflect ( - rL , rM ) ;".split(" ")}]}},{type:"node",name:"PARALLAX",group:{type:"group",a:[{type:"node_param",name:"node_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]},
{type:"node_in",name:"rO",qualifier:["vec3"]},{type:"node_in",name:"rP",qualifier:["float"]},{type:"node_in",name:"rQ",qualifier:["const","float"]},{type:"node_in",name:"rR",qualifier:["const","float"]},{type:"node_out",name:"rS",qualifier:["vec3"]},{type:"textline",b:"{ float rT = length ( kW ) ; if ( rT < rR ) { vec2 rU = kl ( rO ) ; float rV = clamp ( 0.5 * ( rR - rT ) , jQ , jR ) ; float rW = rP * rV ; vec3 rX = normalize ( kU * k_ ) ; float rY = jR / rQ ; vec2 rZ = rX . xy * rW / ( rQ * rX . z ) ; float r_ = jR ; float sa = texture2D ( node_PARALLAX_var_texture , rU ) . a ; for ( float sb = 1.0 ; sb <= rQ ; sb ++ ) { if ( sa < r_ ) { r_ -= rY ; rU -= rZ ; sa = texture2D ( node_PARALLAX_var_texture , rU ) . a ; } } vec2 sc = rU + rZ ; float sd = texture2D ( node_PARALLAX_var_texture , sc ) . a - ( r_ + rY ) ; float se = sa - r_ ; float sf = se / ( se - sd ) ; rU = sf * sc + ( jR - sf ) * rU ; rS = kj ( rU ) ; } else rS = rO ; }".split(" ")}]}},
{type:"node",name:"CLAMP",group:{type:"group",a:[{type:"node_in",name:"sg",qualifier:["vec3"]},{type:"node_out",name:"sh",qualifier:["vec3"]},{type:"textline",b:"sh = clamp ( sg , jQ , jR ) ;".split(" ")}]}},{type:"node",name:"REFRACTION",group:{type:"group",a:[{type:"node_in",name:"si",qualifier:["vec3"]},{type:"node_in",name:"sj",qualifier:["float"]},{type:"node_out",name:"sk",qualifier:["vec3"]},{type:"textline",b:"sk = jX ( si , sj ) ;".split(" ")}]}},{type:"node",name:"TRANSLUCENCY",group:{type:"group",
a:[{type:"node_in",name:"sl",qualifier:["float"]},{type:"node_in",name:"sm",qualifier:["float"]},{type:"node_in",name:"sn",qualifier:["float"]},{type:"node_in",name:"so",qualifier:["float"]},{type:"node_in",name:"sp",qualifier:["float"]},{type:"node_out",name:"sq",qualifier:["float"]},{type:"node_out",name:"sr",qualifier:["vec4"]},{type:"textline",b:"sq = sl ; sr = vec4 ( sm , sn , so , sp ) ;".split(" ")}]}},{type:"node",name:"TIME",group:{type:"group",a:[{type:"node_out",name:"ss",qualifier:["float"]},
{type:"textline",b:["ss","=","u_time",";"]}]}},{type:"nodes_global"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SHADED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float kM = ja . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"textline",b:["vec3","kN","=","jb",";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) kN = kN ; else kN = - kN ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 kO = cross ( kN , jc . xyz ) * jc . w ; mat3 kP = mat3 ( jc . xyz , kO , kN ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 kQ = normalize ( kN ) ; float kR = 0.5 * kQ . y + 0.5 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 kS = u_environment_energy * textureCube ( u_sky_texture , kQ ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"vec3 kS = u_environment_energy * mix ( u_horizon_color , u_zenith_color , kR ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 kT = u_camera_eye_frag - ja ; vec3 kU = normalize ( kT ) ; vec3 kV = ja ; vec4 kW = cA ; float kX = u_emit ; float kY = u_ambient ; float kZ = u_shadow_visibility_falloff ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["mat3","k_","=","kP",";"]}]}}]},{type:"textline",b:"vec3 la ; vec3 lb ; vec3 lc ; vec3 ld ; float le ; float lf ;".split(" ")},
{type:"nodes_main"},{type:"textline",b:"vec3 st = la ; float su = lf ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["vec3","sv","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"st = max ( st - sqrt ( 0.01 * - min ( kM , jQ ) ) , 0.5 * st ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"iZ ( st , kM , u_time , le , kN , u_sun_direction , sv , u_sun_quaternion , ja , length ( cA ) ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 sw = eB ( u_cube_fog , kU ) ; vec4 sx = vec4 ( sw , u_fog_color_density . a ) ; eh ( sx . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"vec4 sx = u_fog_color_density ; sx . rgb *= sv ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"eU ( st , length ( cA ) , kU , u_cam_water_depth , u_underwater_fog_color_density , sx , kM , length ( sv ) + u_environment_energy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"eu ( st , length ( cA ) , sx ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 sy = texture2DProj ( u_shadow_mask , cz ) . rg ; float sz = sy . g ; st = vec3 ( sz ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 kV = ja ; vec4 kW = cA ; vec3 kT = u_camera_eye_frag - ja ; vec3 kU = normalize ( kT ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["vec3","kN","=","jb",";"]},{type:"condition",a:[{type:"if",
c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( gl_FrontFacing ) kN = kN ; else kN = - kN ;".split(" ")}]}}]},{type:"textline",b:"vec3 kQ = normalize ( kN ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 la ; float lf ;".split(" ")},{type:"nodes_main"},{type:"textline",b:"vec3 st = la ; float su = lf ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( su < 0.5 ) discard ; su = jR ;".split(" ")}]}}]},
{type:"textline",b:["ej","(","st",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"em ( st , su ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( st , su ) ; }".split(" ")}]};a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",
file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SHADED","||","USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",
b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",
b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["SHADED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",
a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",
b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION"],group:{type:"group",
a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",b:"varying vec3 ja ; varying vec4 cA ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADED","||","USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jb",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","jc",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec4","cv",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cw",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cx",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cy",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"REFLECTIVE || SHADOW_SRC == SHADOW_SRC_MASK || USE_NODE_REFRACTION".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","vec3","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","float","je",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",
name:"kr",qualifier:["varying","vec2"]},{type:"textline",b:["kr","=","node_GEOMETRY_UV_var_a_uv",";"]}]}},{type:"node",name:"GEOMETRY_VC",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"kw",qualifier:["varying","vec3"]},{type:"textline",b:["kw","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",
qualifier:["attribute","float"]},{type:"node_param",name:"kx",qualifier:["varying","float"]},{type:"textline",b:["kx","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"ky",qualifier:["varying","vec2"]},{type:"textline",b:["ky","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC3",group:{type:"group",
a:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"kz",qualifier:["varying","vec3"]},{type:"textline",b:["kz","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]}},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec3 kA = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADED"],group:{type:"group",a:[{type:"textline",b:["vec3","kB","=","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],
group:{type:"group",a:[{type:"textline",b:"vec3 kC = vec3 ( a_tangent ) ; vec3 kD = a_tangent [ 3 ] * cross ( kB , kC ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 kC = vec3 ( 0.0 ) ; vec3 kD = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["vec3","kB","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 kB = vec3 ( 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 kC = vec3 ( 0.0 ) ; vec3 kD = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"kA = mix ( kA , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADED"],group:{type:"group",a:[{type:"textline",b:"kB = mix ( kB , a_normal_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 kE = vec3 ( a_tangent ) ; vec3 kF = a_tangent_next [ 3 ] * cross ( a_normal_next , kE ) ; kC = mix ( kC , kE , u_va_frame_factor ) ; kD = mix ( kD , kF , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bl ( kA , kC , kD , kB ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","kG","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 kG = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:"vec3 kH = ( u_model_matrix * vec4 ( kG , 1.0 ) ) . xyz ; mat4 kI = _ ( u_camera_eye , kH , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 kJ = ( u_model_matrix * vec4 ( kG , 1.0 ) ) . xyz ; kI = kI * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , kJ ) ;".split(" ")}]}}]},{type:"textline",b:"c kK = ag ( kA - kG , kG , kC , kD , kB , kI ) ; kK . b = kH ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"c kK = ag ( kA , kG , kC , kD , kB , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"float kL = ( dot ( cross ( kK . e , kK . c ) , kK . d ) < 0.0 ) ? - 1.0 : 1.0 ; jc = vec4 ( kK . c , kL ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 kH = ( u_model_matrix * vec4 ( kG , 1.0 ) ) . xyz ; mat4 kI = _ ( u_camera_eye , kH , u_view_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 kJ = ( u_model_matrix * vec4 ( kG , 1.0 ) ) . xyz ; kI = kI * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , kJ ) ;".split(" ")}]}}]},{type:"textline",b:"c kK = ag ( kA - kG , kG , vec3 ( 0.0 ) , vec3 ( 0.0 ) , kB , kI ) ; kK . b = kH ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c kK = ag ( kA , kG , vec3 ( 0.0 ) , vec3 ( 0.0 ) , kB , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cc ( kK . a , kK . b , kB ) ;".split(" ")}]}}]},{type:"textline",b:"ja = kK . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADED","||","USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:"jb = kK . e ;".split(" ")}]}}]},{type:"textline",b:"cA = u_view_matrix * vec4 ( kK . a , 1.0 ) ; vec4 kM = u_proj_matrix * cA ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_JITTER"],group:{type:"group",
a:[{type:"textline",b:"kM . xy += u_subpixel_jitter * kM . w ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["ea","(","kM",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"ea ( kK . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","USE_NODE_REFRACTION"],group:{type:"group",a:[{type:"textline",b:"float kN = kM . x ; float kO = kM . y ; float kP = kM . w ; cz . x = ( kN + kP ) / 2.0 ; cz . y = ( kO + kP ) / 2.0 ; cz . z = kP ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_REFRACTION","&&","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"je = - cA . z / u_view_max_depth ;".split(" ")}]}}]},{type:"nodes_main"},{type:"textline",b:["gl_Position","=","kM",";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float kA ; varying vec3 jd ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cA",";"]}]}}]},{type:"textline",b:"void main ( ) { float kB = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; float kC = smoothstep ( u_p_alpha_start , u_p_alpha_end , kB ) ; float kD = u_diffuse_color . a * kA * ( 1.0 - clamp ( kC , 0.0 , 1.0 ) ) ; vec3 kE = jd * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"eu ( kE , length ( cA ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["ej","(","kE",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"em ( kE , kD ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kE , kD ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"var",name:"COLOR_RAMP_LENGTH",
b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",
b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ; varying float kA ; varying vec3 jd ; varying vec3 cA ;".split(" ")},
{type:"include",file:"particles.glslv"},{type:"textline",b:"void main ( ) { kB ls ; ls = lr ( ) ; vec4 lt = u_view_matrix * vec4 ( ls . b , 1.0 ) ; gl_Position = u_proj_matrix * lt ; kA = ls . c ; jd = ls . d ; cA = lt . xyz ; float lu = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = ls . a * lu ; }".split(" ")}]};a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"gamma.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"fog.glslf"},{type:"var",name:"PARTICLES_SHADELESS",b:["0"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ; uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float kA ; varying vec3 jd ; varying vec2 a ; varying vec3 i_ ; varying vec3 ja ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"textline",b:"void main ( ) { vec4 jQ = u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"vec4 jR = texture2D ( u_sampler , a ) ; eh ( jR . rgb ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"jQ . rgb = mix ( jQ . rgb , jR . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"jQ . rgb *= mix ( vec3 ( 1.0 ) , jR . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"jQ . a = jR . a ;".split(" ")}]}}]},{type:"textline",b:"jQ . rgb *= jd ; vec3 jS = u_diffuse_intensity * jQ . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","PARTICLES_SHADELESS"],group:{type:"group",a:[{type:"textline",b:"vec3 jT = u_emit * jQ . rgb ; vec3 jU = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 jV = u_environment_energy * textureCube ( u_sky_texture , jU ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float jW = 0.5 ; vec3 jV = u_environment_energy * mix ( u_horizon_color , u_zenith_color , jW ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 jX = u_ambient * jV ; float jY = u_specular_params [ 0 ] ; vec2 jZ = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 j_ = jY * u_specular_color ; vec3 ka = normalize ( i_ ) ; fd kb = hy ( jT , jX , jS , j_ , ja , jU , ka , jZ , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ; vec3 kc = kb . a . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","kc","=","jS",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"eu ( kc , length ( cA ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:"float kd = jQ . a * kA ; ej ( kc ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"em ( kc , kd ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kc , kd ) ; }".split(" ")}]};
a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",b:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",b:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform float u_p_size ; varying float kA ; varying vec3 jd ; varying vec2 a ; varying vec3 i_ ; varying vec3 ja ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cA",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",b:"float jS ( vec2 jQ , vec2 jR ) { return ( atan ( jR . y , jR . x ) - atan ( jQ . y , jQ . x ) ) ; } void main ( ) { kB jT ; jT = lr ( ) ; float jU ; mat4 jV ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { jU = jT . e ; jV = y ( jT . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { jU = jT . e ; jV = j ( ) ; jV [ 3 ] = vec4 ( jT . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { jU = jT . e ; jV = n ( radians ( 90.0 ) ) ; jV [ 3 ] = vec4 ( jT . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { jU = jS ( vec2 ( 0.0 , - 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + jT . e ; jV = l ( radians ( - 90.0 ) ) ; jV [ 3 ] = vec4 ( jT . b , 1.0 ) ; } vec4 jW = vec4 ( a_p_bb_vertex * 2.0 * jT . a * u_p_size , 0.0 , 1.0 ) ; vec4 jX = jV * p ( jU ) * jW ; vec4 jY = u_view_matrix * jX ; vec4 jZ = u_proj_matrix * jY ; gl_Position = jZ ; kA = jT . c ; jd = jT . d ; a = a_p_bb_vertex + 0.5 ; ja = jX . xyz ; i_ = u_camera_eye - jX . xyz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["cA","=","jY",";"]}]}}]},{type:"textline",b:["}"]}]};a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 ls ; const float lt = 0.99 ; const float lu = 1.8 ; const int lv = 8 ; float lF ( vec3 lw , vec3 lx ) { float ly = dot ( lx , lx ) ; float lz = 2.0 * dot ( lx , lw ) ; float lA = dot ( lw , lw ) - 1.0 ; float lB = lz * lz - 4.0 * ly * lA ; float lC = sqrt ( lB ) ; float lD = ( - lz - lC ) / 2.0 ; float lE = lA / lD ; return lE ; } float lM ( float lG , float lH ) { float lI = 3.0 * ( 1.0 - lH * lH ) ; float lJ = 2.0 * ( 2.0 + lH * lH ) ; float lK = 1.0 + lG * lG ; float lL = pow ( 1.0 + lH * lH - 2.0 * lH * lG , 1.5 ) ; lL = max ( lL , 0.00001 ) ; return ( lI / lJ ) * ( lK / lL ) ; } float lU ( vec3 lN , vec3 lO , float lP ) { float lQ = dot ( lO , - lN ) ; if ( lQ < 0.0 ) { return 1.0 ; } vec3 lR = lN + lQ * lO ; if ( length ( lR ) < lP ) { return 0.0 ; } else if ( length ( lR ) >= lP ) { vec3 lS = normalize ( lR ) * lP - lN ; float lT = acos ( dot ( normalize ( lS ) , lO ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( lT * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 lY ( float lV , vec3 lW , float lX ) { return lW - lW * pow ( u_sky_color , vec3 ( lX / lV ) ) ; } void main ( ) { vec3 lZ = normalize ( ls ) ; vec3 l_ = u_sun_direction ; float ma = dot ( lZ , l_ ) ; float mb = lM ( ma , - 0.01 ) * u_rayleigh_brightness * l_ . y ; float mc = lM ( ma - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - l_ . y ) ; float md = smoothstep ( 0.0 , 100.0 , lM ( ma , 0.9995 ) ) * u_spot_brightness ; vec3 me = vec3 ( 0.0 , lt , 0.0 ) ; float mf = lF ( me , lZ ) ; float mg = mf / float ( lv ) ; float mh = lU ( me , lZ , lt - 0.3 ) ; vec3 mi = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 mj = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int mk = 0 ; mk < lv ; mk ++ ) { float ml = mg * float ( mk ) ; vec3 mm = me + lZ * ml ; float mn = lU ( mm , l_ , lt - 0.2 ) ; float mo = lF ( mm , l_ ) ; vec3 mp = lY ( mo , vec3 ( lu ) , u_scatter_strength ) * mn ; mi += lY ( sqrt ( ml ) , u_sky_color * mp , u_rayleigh_strength ) ; mj += lY ( ml , mp , u_mie_strength ) ; } mi = mi * mh * pow ( mf , u_rayleigh_collection_power ) / float ( lv ) ; mj = ( mj * mh * pow ( mf , u_mie_collection_power ) ) / float ( lv ) ; vec3 mq = vec3 ( md * mj + mc * mj + mb * mi ) ; ej ( mq ) ; gl_FragColor = vec4 ( mq , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 ls ; void main ( ) { vec4 jQ = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 jR = u_cube_view_matrix * jQ ; ls = jR . xyz ; gl_Position = jQ ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 jQ = texture2D ( u_sampler , a ) ; ej ( jQ . rgb ) ; em ( jQ . rgb , jQ . a ) ; gl_FragColor = jQ ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { a = a_texcoord ; vec3 jQ = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 jR = u_proj_matrix * u_view_matrix * vec4 ( jQ , 0.0 ) ; jR . x /= jR . w ; jR . y /= jR . w ; jR += 99999.0 * step ( jR . z , 0.0 ) ; jR += 100.0 * ( step ( 1.0 , abs ( jR . x ) ) + step ( 1.0 , abs ( jR . y ) ) ) ; jR . x = - a_lf_dist * jR . x ; jR . y = - a_lf_dist * jR . y ; float jS = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 jT = vec2 ( a_lf_bb_vertex . x / jS , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float jU = 1.9 ; jT *= ( 1.0 + jU * length ( jR . xy ) ) ; } gl_Position = vec4 ( jR . xy + jT , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:["uniform","samplerCube","u_sky",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 ls ; void main ( ) { vec3 jQ = textureCube ( u_sky , ls ) . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"eh ( jQ . rgb ) ; float jR = u_camera_eye_frag . y - WATER_LEVEL ; jR = min ( - jR * 0.03 , 0.8 ) ; float jS = length ( u_sun_intensity ) + u_environment_energy ; vec3 jT = normalize ( ls ) ; vec3 jU = vec3 ( 0.0 ) ; vec4 jV = u_underwater_fog_color_density ; jV . rgb = mix ( jV . rgb , jU , min ( - jT . y + jR , 1.0 ) ) * jS ; float jW = clamp ( sign ( jT . y - 0.05 * jR ) , 0.0 , 1.0 ) ; jQ = mix ( jV . rgb , jQ , jW ) ; ej ( jQ . rgb ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( jQ , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 ls ; void main ( ) { vec4 jQ = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 jR = u_sky_vp_inverse * jQ ; ls = jR . xyz ; gl_Position = jQ ; }".split(" ")}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",
name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.001"]},{type:"textline",b:"uniform float u_time ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_sky_texture",";"]}]}}]},{type:"textline",b:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ; uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",
a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["!",
"DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_scene_depth",";"]}]}},{type:"elif",c:["ALPHA_MAP"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_alphamap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap0_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap1_uv_velocity ; uniform vec2 u_normalmap1_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap2_uv_velocity ; uniform vec2 u_normalmap2_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap3_uv_velocity ; uniform vec2 u_normalmap3_scale ;".split(" ")}]}}]}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ; uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform",
"float","u_refr_bump",";"]}]}}]},{type:"textline",b:"varying vec3 i_ ; varying vec3 ja ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jb",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 jc ; varying vec3 lt ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","lu",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","lv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","float","je",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE","&&","SHORE_SMOOTHING"],group:{type:"group",a:[{type:"include",file:"refraction.glslf"}]}}]},{type:"textline",b:"vec3 lK ( in vec2 lw , in vec3 lx , in vec3 ly , in vec3 lz , out float lA ) { vec3 lB = reflect ( - ly , lx ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 lC = lw . xy + lx . xz * REFL_BUMP / je ; lA = u_reflect_factor ; vec3 lD ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"lD = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lD = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"float lE = dot ( ly , lx ) ; lA *= max ( 1.0 - 1.0 / lE , 1.0 ) ; } else { lD = texture2D ( u_reflectmap , lC ) . rgb ; eh ( lD ) ; }".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",
a:[{type:"textline",b:"lA = u_mirror_factor ; vec3 lD = lz * textureCube ( u_mirrormap , lB ) . rgb ; eh ( lD ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lA = 1.0 ; vec3 lD = lz * vec3 ( 0.3 , 0.5 , 1.0 ) ; eh ( lD ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lF = normalize ( lB + ly ) ; float lG = 1.0 - dot ( ly , lF ) ; float lH = u_fresnel_params [ 3 ] ; float lI = u_fresnel_params [ 2 ] ; float lJ = lH + ( 1.0 - lH ) * pow ( lG , lI ) ; lA = min ( lA * lJ , 1.0 ) ; return lD ; } void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 lL = mat3 ( jc , lt , jb ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lM = normalize ( jb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 lL = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"vec3 lM = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"DYNAMIC && ( REFLECTIVE || FOAM || ( WATER_EFFECTS && ! DISABLE_FOG ) ) || GENERATED_MESH".split(" "),group:{type:"group",a:[{type:"textline",b:"float lN = ja . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec2 lO = vec2 ( lu . x , - lu . z ) + 0.5 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec2 lO = vec2 ( ja . x , - ja . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2","lO","=","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lP = vec3 ( 0.0 ) ; vec3 lQ = texture2D ( u_normalmap0 , lO * u_normalmap0_scale + u_normalmap0_uv_velocity * u_time ) . xyz - 0.5 ; lP += lQ ;".split(" ")},{type:"condition",a:[{type:"if",
c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 lR = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",b:["lR","+=","lQ",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"lQ = texture2D ( u_normalmap0 , lO * u_normalmap1_scale + u_normalmap1_uv_velocity * u_time ) . xyz - 0.5 ; lP += lQ ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["lR","+=","lQ",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"lQ = texture2D ( u_normalmap0 , lO * u_normalmap2_scale + u_normalmap2_uv_velocity * u_time ) . xyz - 0.5 ; lP += lQ ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",
a:[{type:"textline",b:["lR","+=","lQ",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"lQ = texture2D ( u_normalmap0 , lO * u_normalmap3_scale + u_normalmap3_uv_velocity * u_time ) . xyz - 0.5 ; lP += lQ ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["lR","+=","lQ",";"]}]}}]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 lS = lL * lR ; if ( ! f ( lS , vec3 ( 0.0 ) ) ) lS = normalize ( lS ) ; vec3 lT = mix ( lM , lS , 0.2 ) ; lT = normalize ( lT ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"lM = mix ( lM , normalize ( lL * lP ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"lM = mix ( lM , normalize ( lL * lP ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"lM = normalize ( lM ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 lU = normalize ( i_ ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 lV = cz . xy / cz . z ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float lW = je * u_view_max_depth ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float lX = u_diffuse_color . a ; vec4 lY = texture2DProj ( u_scene_depth , cz ) ; float lZ = cl ( lY ) ; float l_ = max ( lZ - je , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 ma = lV + lM . xz * u_refr_bump / je ; float mb = jH ( lZ , ma , lV ) ; float mc = max ( mb - je , 0.0 ) ; float md = u_view_max_depth / ABSORB * mc ; float me ; if ( u_cam_water_depth < 0.0 ) me = 0.0 ; else me = min ( lX * md , 1.0 ) ; float mf = u_view_max_depth / ABSORB * l_ ; lX = min ( 15.0 * lX * u_view_max_depth * l_ , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float mf = u_view_max_depth / ABSORB * l_ ; if ( u_cam_water_depth > 0.0 ) lX = min ( lX * mf , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"lX *= min ( 5.0 * lW , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_MAP"],group:{type:"group",a:[{type:"textline",b:"vec4 mg = texture2D ( u_alphamap , lO ) ; float lX = mg . r ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"float lX = u_diffuse_color . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float me = 1.0 - lX ; vec2 ma = lV + lM . xz * REFR_BUMP / je ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 mh = texture2D ( u_refractmap , ma ) . rgb ; eh ( mh ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float mi = pow ( min ( lv . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 mj = mix ( u_shallow_water_col , u_diffuse_color . rgb , mi ) ; mi = pow ( min ( lv . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; mj = mix ( u_shore_water_col , mj , mi ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mj = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float mk = max ( 1.0 - u_view_max_depth * l_ , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float mk = 1.0 - lX ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",
a:[{type:"textline",b:"float ml = max ( 3.0 * lN , 0.0 ) ; ml *= ml ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 mm = normalize ( vec3 ( lv . r , 0.0 , lv . g ) ) ; vec3 mn = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , mm , 0.8 ) ) ; float mo = max ( 2.5 * dot ( lT , mn ) - 0.7 , 0.0 ) ; mk += mo * ( 1.0 - lv . b ) ; ml *= ( 1.0 - 0.95 * pow ( lv . b , 0.1 ) ) ;".split(" ")}]}}]},{type:"textline",b:"mk += ml ; mk = min ( u_foam_factor * mk , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"vec4 mp = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + lO * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"float mq = u_specular_params [ 0 ] ; vec2 mr = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 ms = mq * u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_TEXTURE"],group:{type:"group",a:[{type:"textline",b:"vec3 mt = u_environment_energy * textureCube ( u_sky_texture , lM ) . rgb ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"vec3 mt = u_environment_energy * u_zenith_color ;".split(" ")}]}}]},{type:"textline",b:"vec3 mu = u_ambient * mt ; vec3 mv = mu + u_sun_intensity ; float mw ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 mx = lK ( lV , lM , lU , mv , mw ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 mx = lK ( vec2 ( 0.0 ) , lM , lU , mv , mw ) ;".split(" ")}]}}]},{type:"textline",
b:"vec3 my = u_diffuse_intensity * mj ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS","&&","DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float mz = max ( dot ( u_sun_direction , - jb ) + SSS_WIDTH , 0.0 ) * max ( dot ( - lU , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; mz = clamp ( SSS_STRENGTH * mz , 0.0 , 1.0 ) ; my = mix ( my , u_shallow_water_col , mz ) ; my = mix ( my , u_shore_water_col , mz ) ;".split(" ")}]}}]},{type:"textline",
b:"fd mA = hy ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , my , ms , ja , lM , lU , mr , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ; my = mA . a . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"my = mix ( mh , my , me ) ;".split(" ")}]}}]},{type:"textline",b:"my = mix ( my , mx , mw ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],
group:{type:"group",a:[{type:"textline",b:"float mB = mix ( mp . g , mp . r , clamp ( 4.0 * ( mk - 0.75 ) , 0.0 , 1.0 ) ) ; mB = mix ( mp . b , mB , clamp ( 2.0 * mk - 1.0 , 0.0 , 1.0 ) ) ; mB = mix ( 0.0 , mB , mk ) ; my = mix ( my , mv , mB ) ;".split(" ")}]}}]},{type:"textline",b:"my += mA . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 mC = eB ( u_cube_fog , lU ) ; vec4 mD = vec4 ( mC , u_fog_color_density . a ) ; eh ( mD . rgb ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","mD","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { fc ( my , lW , u_cam_water_depth , u_underwater_fog_color_density , length ( u_sun_intensity ) + u_environment_energy ) ; } else { eu ( my , lW , mD ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"eu ( my , lW , mD ) ;".split(" ")}]}}]}]}}]},
{type:"textline",b:["ej","(","my",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"lX = max ( lX , mA . b . r ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["lX","+=","mB",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"em ( my , lX ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( my , lX ) ; }".split(" ")}]};a["special_water.glslv"]=
{type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",
b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Z",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Z",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",
file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_cascad_step",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",
a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},{type:"textline",b:"varying vec3 i_ ; varying vec3 ja ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",
b:["varying","vec3","jb",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 jc ; varying vec3 lt ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","lu",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","lv",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING",
"||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cz",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","je",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 jW ( in vec2 jQ ) { vec2 jR = vec2 ( ( jQ . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( SHORE_MAP_CENTER_Z + jQ . y ) / SHORE_MAP_SIZE_Z ) + 0.5 ; jR = clamp ( jR , 0.0 , 1.0 ) ; vec4 jS = texture2D ( u_shore_dist_map , jR ) ; const vec2 jT = vec2 ( 1.0 / 255.0 , 1.0 ) ; float jU = dot ( jS . ba , jT ) ; vec2 jV = normalize ( jS . rg * 2.0 - 1.0 ) ; return vec3 ( jV , jU ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"void kj ( inout vec3 jX , in float jY , in vec3 jZ ) { float j_ = iy ( DST_NOISE_SCALE_0 * ( jX . xz + DST_NOISE_FREQ_0 * jY ) ) * iy ( DST_NOISE_SCALE_1 * ( jX . zx - DST_NOISE_FREQ_1 * jY ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float ka = jZ . b ; float kb = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float kc = sqrt ( ka ) ; float kd = max ( ka , DIR_MIN_SHR_FAC ) * ( sin ( ( kc / kb + DIR_FREQ * jY ) ) ) * max ( iy ( DIR_NOISE_SCALE * ( jX . xz + DIR_NOISE_FREQ * jY ) ) , DIR_MIN_NOISE_FAC ) ; float ke = WAVES_HEIGHT * mix ( kd , j_ , max ( kc , DST_MIN_FAC ) ) ; vec2 kf = jZ . rg ; float kg = WAVES_HOR_FAC * kd * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - ka ) , 0.0 ) ; vec2 kh = kg * kf ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float ke = WAVES_HEIGHT * j_ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float ki = hS ( 20.0 / WAVES_LENGTH * ( jX . xz - 0.25 * jY ) ) . x + hS ( 17.0 / WAVES_LENGTH * ( jX . zx + 0.1 * jY ) ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"jX . xz += kh ; ki *= ka ;".split(" ")}]}}]},{type:"textline",
b:"ke += 0.05 * ki ;".split(" ")}]}}]},{type:"textline",b:"jX . y += ke ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec3 kk = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float kl = abs ( a_cascad_step ) ; vec2 km = u_camera_eye . xz - mod ( u_camera_eye . xz , kl ) ; kk . y += WATER_LEVEL ; kk . xz += km ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},
{type:"textline",b:"c kn = ag ( kk , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"lu = kn . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"lv = jW ( kn . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float ko = length ( u_wind ) ; float kp = u_time ; kp *= ko ;".split(" ")},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["float","kq","=","kl",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","kq","=","0.1",";"]}]}}]},{type:"textline",b:"vec3 lw = kn . a + vec3 ( kq , 0.0 , 0.0 ) ; vec3 lx = kn . a + vec3 ( 0.0 , 0.0 , kq ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 ly = jW ( lw . xz ) ; vec3 lz = jW ( lx . xz ) ; kj ( lw , kp , ly ) ; kj ( lx , kp , lz ) ; kj ( kn . a , kp , lv ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"kj ( lw , kp , vec3 ( 0.0 ) ) ; kj ( lx , kp , vec3 ( 0.0 ) ) ; kj ( kn . a , kp , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_cascad_step < 0.0 ) { lw . y = kn . a . y ; lx . y = kn . a . y ; }".split(" ")}]}}]},{type:"textline",b:"vec3 lA = normalize ( lw - kn . a ) ; vec3 lB = normalize ( lx - kn . a ) ; jb = normalize ( cross ( lB , lA ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"jc = lB ; lt = cross ( jb , jc ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float lC = dot ( jb , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float lD = clamp ( 0.8 - lC , 0.0 , 1.0 ) ; jb = mix ( jb , vec3 ( 0.0 , 1.0 , 0.0 ) , lD ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"ja = kn . a ; i_ = u_camera_eye - kn . a ; vec4 lE = u_view_matrix * vec4 ( kn . a , 1.0 ) ; vec4 lF = u_proj_matrix * lE ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float lG = lF . x ; float lH = lF . y ; float lI = lF . w ; cz . x = ( lG + lI ) / 2.0 ; cz . y = ( lH + lI ) / 2.0 ; cz . z = lI ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"je = - lE . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["gl_Position","=","lF",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 lw ; const float lx = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 ly = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 ly = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 lz = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 lA = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 lB = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec3 lC = vec3 ( 0.0 ) ; float lD = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"vec3 lE = sign ( lw - vec3 ( 0.02 * lx ) ) ; if ( lE . x < 0.0 || lE . y < 0.0 || lE . z < 0.0 ) { lC = ly ; lD = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lE = sign ( lw - vec3 ( 0.02 * lx ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( lE . x < 0.0 || lE . y < 0.0 || lE . z < 0.0 ) lC = u_wireframe_edge_color ; else lC = lB ; lD = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( lE . x < 0.0 || lE . y < 0.0 || lE . z < 0.0 ) lD = 1.0 ; else lD = 0.0 ; lC = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( lE . x < 0.0 || lE . y < 0.0 || lE . z < 0.0 ) lC = u_wireframe_edge_color ; else if ( gl_FrontFacing ) lC = lz ; else lC = lA ; lD = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 lF = fwidth ( lw ) ; vec3 lG = smoothstep ( vec3 ( 0.0 ) , lF * lx , lw ) ; float lH = min ( min ( lG . x , lG . y ) , lG . z ) ; lH = clamp ( lH , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { lC = vec3 ( mix ( u_wireframe_edge_color , lB , lH ) ) ; lD = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { lC = u_wireframe_edge_color ; lD = mix ( 1.0 , 0.0 , lH ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) lC = mix ( u_wireframe_edge_color , lz , lH ) ; else lC = mix ( u_wireframe_edge_color , lA , lH ) ; lD = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["ej","(","lC",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"em ( lC , lD ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( lC , lD ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],
group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||",
"HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",
b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},{type:"textline",b:["varying","vec3","lw",";"]},{type:"condition",
a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { if ( a_polyindex == 0.0 ) lw = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) lw = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) lw = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 jQ = a_position ; vec3 jR = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],
group:{type:"group",a:[{type:"textline",b:"c jS = ag ( jQ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"jQ = mix ( jQ , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 jT = vec3 ( 0.0 ) ; vec3 jU = vec3 ( 0.0 ) ; bl ( jQ , jT , jU , jR ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","jV","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 jV = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c jS = dZ ( jQ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , jV , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 jW = ( u_model_matrix * vec4 ( jV , 1.0 ) ) . xyz ; mat4 jX = _ ( u_camera_eye , jW , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 jY = ( u_model_matrix * vec4 ( jV , 1.0 ) ) . xyz ; jX = jX * P ( u_wind , u_time , u_jitter_amp , u_jitter_freq , jY ) ;".split(" ")}]}}]},
{type:"textline",b:"c jS = ag ( jQ - jV , jV , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , jX ) ; jS . b = jW ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c jS = ag ( jQ , jV , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"cc ( jS . a , jS . b , jR ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 jZ = u_view_matrix * vec4 ( jS . a , 1.0 ) ; gl_Position = u_proj_matrix * jZ ; }".split(" ")}]};
a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 jQ = texture2D ( u_sampler_left , a ) ; vec4 jR = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( jQ [ 0 ] , jR [ 1 ] , jR [ 2 ] , jQ [ 3 ] + jR [ 3 ] ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 jT ( float jQ , float jR ) { vec2 jS = a + vec2 ( jQ , jR ) * u_texel_size ; return texture2D ( u_color , jS ) ; } float jX ( vec4 jU ) { vec3 jV = vec3 ( 0.299 , 0.587 , 0.114 ) ; float jW = dot ( jU . rgb , jV ) ; return jW ; } vec4 kp ( ) { vec4 jY = jT ( - 1.0 , - 1.0 ) ; vec4 jZ = jT ( 1.0 , - 1.0 ) ; vec4 j_ = jT ( - 1.0 , 1.0 ) ; vec4 ka = jT ( 1.0 , 1.0 ) ; vec4 kb = jT ( 0.0 , 0.0 ) ; float kc = jX ( jY ) ; float kd = jX ( jZ ) ; float ke = jX ( j_ ) ; float kf = jX ( ka ) ; float kg = jX ( kb ) ; float kh = min ( kg , min ( min ( kc , kd ) , min ( ke , kf ) ) ) ; float ki = max ( kg , max ( max ( kc , kd ) , max ( ke , kf ) ) ) ; vec2 kj ; kj . x = - ( ( kc + kd ) - ( ke + kf ) ) ; kj . y = ( ( kc + ke ) - ( kd + kf ) ) ; float kk = max ( ( kc + kd + ke + kf ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float kl = 1.0 / ( min ( abs ( kj . x ) , abs ( kj . y ) ) + kk ) ; kj = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , kj * kl ) ) * u_texel_size ; vec4 km = 0.5 * ( texture2D ( u_color , a + kj * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + kj * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 kn = km * 0.5 + 0.25 * ( texture2D ( u_color , a + kj * - 0.5 ) + texture2D ( u_color , a + kj * 0.5 ) ) ; float ko = jX ( kn ) ; if ( ( ko < kh ) || ( ko > ki ) ) return km ; else return kn ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 ng ( ) { vec2 kq ; kq . x = a . x ; kq . y = a . y ; vec4 lx = texture2D ( u_color , kq ) ; vec4 ly = jT ( 0.0 , 1.0 ) ; vec4 lz = jT ( 1.0 , 0.0 ) ; vec4 lA = jT ( 0.0 , - 1.0 ) ; vec4 lB = jT ( - 1.0 , 0.0 ) ; float lC = jX ( ly ) ; float lD = jX ( lz ) ; float lE = jX ( lA ) ; float lF = jX ( lB ) ; float lG = jX ( lx ) ; float lH = max ( lC , lG ) ; float lI = min ( lC , lG ) ; float lJ = max ( lD , lH ) ; float lK = min ( lD , lI ) ; float lL = max ( lE , lF ) ; float lM = min ( lE , lF ) ; float lN = max ( lL , lJ ) ; float lO = min ( lM , lK ) ; float lP = lN * FXAA_QUALITY_EDGE_THRESHOLD ; float lQ = lN - lO ; float lR = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , lP ) ; bool lS = lQ < lR ; if ( lS ) return lx ; vec4 lT = jT ( - 1.0 , - 1.0 ) ; vec4 lU = jT ( 1.0 , 1.0 ) ; vec4 lV = jT ( 1.0 , - 1.0 ) ; vec4 lW = jT ( - 1.0 , 1.0 ) ; float lX = jX ( lT ) ; float lY = jX ( lU ) ; float lZ = jX ( lV ) ; float l_ = jX ( lW ) ; float ma = lE + lC ; float mb = lF + lD ; float mc = 1.0 / lQ ; float md = ma + mb ; float me = ( - 2.0 * lG ) + ma ; float mf = ( - 2.0 * lG ) + mb ; float mg = lZ + lY ; float mh = lX + lZ ; float mi = ( - 2.0 * lD ) + mg ; float mj = ( - 2.0 * lE ) + mh ; float mk = lX + l_ ; float ml = l_ + lY ; float mm = ( abs ( me ) * 2.0 ) + abs ( mi ) ; float mn = ( abs ( mf ) * 2.0 ) + abs ( mj ) ; float mo = ( - 2.0 * lF ) + mk ; float mp = ( - 2.0 * lC ) + ml ; float mq = abs ( mo ) + mm ; float mr = abs ( mp ) + mn ; float ms = mk + mg ; float mt = u_texel_size . x ; bool mu = mq >= mr ; float mv = md * 2.0 + ms ; if ( ! mu ) lE = lF ; if ( ! mu ) lC = lD ; if ( mu ) mt = u_texel_size . y ; float mw = ( mv * ( 1.0 / 12.0 ) ) - lG ; float mx = lE - lG ; float my = lC - lG ; float mz = lE + lG ; float mA = lC + lG ; bool mB = abs ( mx ) >= abs ( my ) ; float mC = max ( abs ( mx ) , abs ( my ) ) ; if ( mB ) mt = - mt ; float mD = clamp ( abs ( mw ) * mc , 0.0 , 1.0 ) ; vec2 mE ; mE . x = kq . x ; mE . y = kq . y ; vec2 mF ; mF . x = ( ! mu ) ? 0.0 : u_texel_size . x ; mF . y = ( mu ) ? 0.0 : u_texel_size . y ; if ( ! mu ) mE . x += mt * 0.5 ; if ( mu ) mE . y += mt * 0.5 ; vec2 mG ; mG . x = mE . x - mF . x ; mG . y = mE . y - mF . y ; vec2 mH ; mH . x = mE . x + mF . x ; mH . y = mE . y + mF . y ; float mI = ( ( - 2.0 ) * mD ) + 3.0 ; float mJ = jX ( texture2D ( u_color , mG ) ) ; float mK = mD * mD ; float mL = jX ( texture2D ( u_color , mH ) ) ; if ( ! mB ) mz = mA ; float mM = mC * 1.0 / 4.0 ; float mN = lG - mz * 0.5 ; float mO = mI * mK ; bool mP = mN < 0.0 ; mJ -= mz * 0.5 ; mL -= mz * 0.5 ; bool mQ = abs ( mJ ) >= mM ; bool mR = abs ( mL ) >= mM ; if ( ! mQ ) mG . x -= mF . x * 1.5 ; if ( ! mQ ) mG . y -= mF . y * 1.5 ; bool mS = ( ! mQ ) || ( ! mR ) ; if ( ! mR ) mH . x += mF . x * 1.5 ; if ( ! mR ) mH . y += mF . y * 1.5 ; if ( mS ) { if ( ! mQ ) mJ = jX ( texture2D ( u_color , mG . xy ) ) ; if ( ! mR ) mL = jX ( texture2D ( u_color , mH . xy ) ) ; if ( ! mQ ) mJ = mJ - mz * 0.5 ; if ( ! mR ) mL = mL - mz * 0.5 ; mQ = abs ( mJ ) >= mM ; mR = abs ( mL ) >= mM ; if ( ! mQ ) mG . x -= mF . x * 2.0 ; if ( ! mQ ) mG . y -= mF . y * 2.0 ; mS = ( ! mQ ) || ( ! mR ) ; if ( ! mR ) mH . x += mF . x * 2.0 ; if ( ! mR ) mH . y += mF . y * 2.0 ; if ( mS ) { if ( ! mQ ) mJ = jX ( texture2D ( u_color , mG . xy ) ) ; if ( ! mR ) mL = jX ( texture2D ( u_color , mH . xy ) ) ; if ( ! mQ ) mJ = mJ - mz * 0.5 ; if ( ! mR ) mL = mL - mz * 0.5 ; mQ = abs ( mJ ) >= mM ; mR = abs ( mL ) >= mM ; if ( ! mQ ) mG . x -= mF . x * 2.0 ; if ( ! mQ ) mG . y -= mF . y * 2.0 ; mS = ( ! mQ ) || ( ! mR ) ; if ( ! mR ) mH . x += mF . x * 2.0 ; if ( ! mR ) mH . y += mF . y * 2.0 ; if ( mS ) { if ( ! mQ ) mJ = jX ( texture2D ( u_color , mG . xy ) ) ; if ( ! mR ) mL = jX ( texture2D ( u_color , mH . xy ) ) ; if ( ! mQ ) mJ = mJ - mz * 0.5 ; if ( ! mR ) mL = mL - mz * 0.5 ; mQ = abs ( mJ ) >= mM ; mR = abs ( mL ) >= mM ; if ( ! mQ ) mG . x -= mF . x * 4.0 ; if ( ! mQ ) mG . y -= mF . y * 4.0 ; mS = ( ! mQ ) || ( ! mR ) ; if ( ! mR ) mH . x += mF . x * 4.0 ; if ( ! mR ) mH . y += mF . y * 4.0 ; if ( mS ) { if ( ! mQ ) mJ = jX ( texture2D ( u_color , mG . xy ) ) ; if ( ! mR ) mL = jX ( texture2D ( u_color , mH . xy ) ) ; if ( ! mQ ) mJ = mJ - mz * 0.5 ; if ( ! mR ) mL = mL - mz * 0.5 ; mQ = abs ( mJ ) >= mM ; mR = abs ( mL ) >= mM ; if ( ! mQ ) mG . x -= mF . x * 2.0 ; if ( ! mQ ) mG . y -= mF . y * 2.0 ; if ( ! mR ) mH . x += mF . x * 2.0 ; if ( ! mR ) mH . y += mF . y * 2.0 ; } } } } float mT = kq . x - mG . x ; float mU = mH . x - kq . x ; if ( ! mu ) mT = kq . y - mG . y ; if ( ! mu ) mU = mH . y - kq . y ; bool mV = ( mJ < 0.0 ) != mP ; float mW = ( mU + mT ) ; bool mX = ( mL < 0.0 ) != mP ; float mY = 1.0 / mW ; bool mZ = mT < mU ; float m_ = min ( mT , mU ) ; bool na = mZ ? mV : mX ; float nb = mO * mO ; float nc = ( m_ * ( - mY ) ) + 0.5 ; float nd = nb * FXAA_QUALITY_SUBPIX ; float ne = na ? nc : 0.0 ; float nf = max ( ne , nd ) ; if ( ! mu ) kq . x += nf * mt ; if ( mu ) kq . y += nf * mt ; return texture2D ( u_color , kq ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = kp ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = ng ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 jQ = vec2 ( 0.0 , 0.0 ) ; vec2 jR = u_texel_size ; vec4 jS = texture2D ( u_color , a ) ; gl_FragColor = jS * 0.0875447373698 ; jQ += jR ; gl_FragColor += texture2D ( u_color , a + jQ ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - jQ ) * 0.0858112354248 ; jQ += jR ; gl_FragColor += texture2D ( u_color , a + jQ ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - jQ ) * 0.0808139781061 ; jQ += jR ; gl_FragColor += texture2D ( u_color , a + jQ ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - jQ ) * 0.0731235112908 ; jQ += jR ; gl_FragColor += texture2D ( u_color , a + jQ ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - jQ ) * 0.0635705267419 ; jQ += jR ; gl_FragColor += texture2D ( u_color , a + jQ ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - jQ ) * 0.0530985673112 ; jQ += jR ; gl_FragColor += texture2D ( u_color , a + jQ ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - jQ ) * 0.0426125984122 ; jQ += jR ; gl_FragColor += texture2D ( u_color , a + jQ ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - jQ ) * 0.0328565115809 ; jQ += jR ; gl_FragColor += texture2D ( u_color , a + jQ ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - jQ ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * jS , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 jQ = texture2D ( u_main , a ) ; vec4 jR = texture2D ( u_bloom , a ) ; vec4 jS = jQ ; jS += jR ; gl_FragColor = vec4 ( jS . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/blur_depth.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},
{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform vec2 u_texel_size ; uniform vec2 u_camera_range ; uniform float u_blur_depth_edge_size ; uniform float u_blur_depth_diff_threshold ; varying vec2 a ; float lG ( in vec2 lF ) { return lE ( u_depth , lF , u_camera_range ) ; } void main ( ) { vec2 lH = u_texel_size ; vec4 lI = texture2D ( u_color , a ) ; float lJ = lG ( a ) ; float lK = lG ( a + u_blur_depth_edge_size * lH ) ; float lL = lG ( a - u_blur_depth_edge_size * lH ) ; float lM = abs ( lJ - lK ) ; float lN = abs ( lJ - lL ) ; float lO = max ( lM , lN ) ; if ( lO > u_blur_depth_diff_threshold ) { gl_FragColor = lI ; return ; } vec2 lP = vec2 ( 0.0 , 0.0 ) ; gl_FragColor = lI * 0.2270270270 ; lP += lH ; gl_FragColor += texture2D ( u_color , a + lP ) * 0.1945945946 , gl_FragColor += texture2D ( u_color , a - lP ) * 0.1945945946 , lP += lH ; gl_FragColor += texture2D ( u_color , a + lP ) * 0.1216216216 , gl_FragColor += texture2D ( u_color , a - lP ) * 0.1216216216 , lP += lH ; gl_FragColor += texture2D ( u_color , a + lP ) * 0.0540540541 , gl_FragColor += texture2D ( u_color , a - lP ) * 0.0540540541 , lP += lH ; gl_FragColor += texture2D ( u_color , a + lP ) * 0.0162162162 ; gl_FragColor += texture2D ( u_color , a - lP ) * 0.0162162162 ; }".split(" ")}]};
a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { vec4 jQ = texture2D ( u_color , a ) ; vec3 jR = jQ . rgb ; if ( u_brightness < 0.0 ) jR = jR * ( 1.0 + u_brightness ) ; else jR = jR + ( ( 1.0 - jR ) * u_brightness ) ; jR = ( jR - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; jR *= u_exposure ; vec3 jS = vec3 ( 0.299 , 0.587 , 0.114 ) ; float jT = dot ( jR , jS ) ; jR = mix ( vec3 ( jT ) , jR , u_saturation ) ; gl_FragColor = vec4 ( jR , jQ . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = ch ( clamp ( lE ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { vec4 lF = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { float lG = lE ( u_depth , a , u_camera_range ) ; lG *= u_view_max_depth ; float lH ; if ( lG < u_dof_dist ) lH = ( u_dof_dist - lG ) / u_dof_front ; else lH = ( lG - u_dof_dist ) / u_dof_rear ; lH = clamp ( lH , 0.0 , 1.0 ) ; vec4 lI = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( lF , lI , lH ) ; } else gl_FragColor = lF ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float jV ( float jQ , float jR , float jS ) { vec2 jT = a + vec2 ( jQ , jR ) * u_texel_size ; vec4 jU = texture2D ( u_sampler , jT ) * jS ; return cl ( jU ) ; } void main ( ) { float jW = ( jV ( - 1.0 , - 1.0 , - 1.0 ) + jV ( 0.0 , - 1.0 , - 1.0 ) + jV ( 1.0 , - 1.0 , - 1.0 ) + jV ( - 1.0 , 0.0 , - 1.0 ) + jV ( 0.0 , 0.0 , 8.0 ) + jV ( 1.0 , 0.0 , - 1.0 ) + jV ( - 1.0 , 1.0 , - 1.0 ) + jV ( 0.0 , 1.0 , - 1.0 ) + jV ( 1.0 , 1.0 , - 1.0 ) ) ; jW *= 1000.0 ; gl_FragColor = vec4 ( jW , jW , jW , 1.0 ) ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_glow_src ; uniform sampler2D u_glow_mask ; uniform sampler2D u_glow_mask_blurred ; uniform vec3 u_glow_color ; uniform float u_draw_glow ; varying vec2 a ; void main ( ) { vec4 jQ = texture2D ( u_glow_src , a ) ; gl_FragColor = jQ ; if ( u_draw_glow != 0.0 ) { vec4 jR = texture2D ( u_glow_mask , a ) ; vec4 jS = texture2D ( u_glow_mask_blurred , a ) ; float jT = jS . a - jR . a ; if ( jT != 0.0 ) { float jU = smoothstep ( 0.0 , 1.0 , jS . a ) ; if ( jR . a == 0.0 ) { vec3 jV = u_glow_color ; ej ( jV ) ; vec4 jW = vec4 ( clamp ( jV , 0.0 , 1.0 ) , jU ) ; gl_FragColor = mix ( jQ , jW , jU ) ; } } } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform vec3 u_sun_intensity ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float lF ; varying vec2 lG ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 lH ; void main ( ) { vec3 lI = u_sun_intensity ; vec2 lJ = ( lH . xy - a ) ; float lK = length ( lJ ) ; vec2 lL = u_radial_blur_step * lJ / lK ; float lM = lK / u_radial_blur_step ; lL *= min ( lM , STEPS_PER_PASS ) / STEPS_PER_PASS ; lM = max ( lM , STEPS_PER_PASS ) ; vec2 lN = a ; float lO = 0.0 ; for ( float lP = 0.0 ; lP < STEPS_PER_PASS ; lP += 1.0 ) { if ( lP <= lM ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"float lQ = lE ( u_input , lN , u_camera_range ) ; lO += ( 1.0 - pow ( lK , 0.3 ) ) * step ( 0.9 , lQ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lO += texture2D ( u_input , lN ) . r ;".split(" ")}]}}]},{type:"textline",b:"} lN += lL ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"vec2 lR = a + lG ; float lS = hS ( vec2 ( 2.5 * ( lR . x ) , 2.5 * ( lR . y ) + 1.0 * u_time ) ) . x + 0.75 * hS ( vec2 ( 5.0 * ( lR . x ) - 0.66 * u_time , 5.0 * ( lR . y ) + 0.66 * u_time ) ) . x + 0.5 * iy ( vec2 ( 7.5 * ( lR . x ) + 0.33 * u_time , 7.5 * ( lR . y ) - 0.33 * u_time ) ) ; lS *= clamp ( 1.2 - sqrt ( 0.2 * lK ) , 0.0 , 1.0 ) * lF ; lO = max ( lS , lO ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( lO / STEPS_PER_PASS * clamp ( lI , 0.4 , 0.8 ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]={type:"group",a:[{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform vec4 u_refl_plane ; varying float lF ; varying vec2 lG ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 lH ; void jX ( in vec4 jQ , in vec3 jR , out vec3 jS ) { float jT = jQ . w * jR . x + jQ . y * jR . z - jQ . z * jR . y ; float jU = jQ . w * jR . y + jQ . z * jR . x - jQ . x * jR . z ; float jV = jQ . w * jR . z + jQ . x * jR . y - jQ . y * jR . x ; float jW = - jQ . x * jR . x - jQ . y * jR . y - jQ . z * jR . z ; jS . x = jT * jQ . w - jW * jQ . x - jU * jQ . z + jV * jQ . y ; jS . y = jU * jQ . w - jW * jQ . y - jV * jQ . x + jT * jQ . z ; jS . z = jV * jQ . w - jW * jQ . z - jT * jQ . y + jU * jQ . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 jY = normalize ( u_sun_direction ) ; lH = u_proj_matrix * u_view_matrix * vec4 ( jY , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_camera_eye . y + a_bb_vertex . t < - u_refl_plane . w ) { lF = 1.0 ; vec3 jZ = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 j_ ; jX ( u_camera_quat , jZ , j_ ) ; j_ = normalize ( j_ ) ; float ka = dot ( j_ , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float kb = atan ( j_ . x , j_ . z ) ; lG = vec2 ( - kb , acos ( ka ) ) ; } else { lF = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"lH . x /= lH . w ; lH . y /= lH . w ; lH . x = 0.5 * ( lH . x + 1.0 ) ; lH . y = 0.5 * ( lH . y + 1.0 ) ; lH += 99999.0 * step ( lH . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; varying vec2 a ; void main ( ) { vec4 jQ = texture2D ( u_main , a ) ; eh ( jQ . rgb ) ; vec3 jR = jQ . rgb + u_god_rays_intensity * ( texture2D ( u_god_rays , a ) ) . rgb ; ej ( jR ) ; gl_FragColor . rgb = jR ; gl_FragColor . a = jQ . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 jQ = texture2D ( u_color , a ) * 0.38026 ; jQ += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; jQ += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; jQ += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; jQ += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; jQ += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; jQ += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; jQ += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; jQ += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = jQ ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { vec4 jQ = texture2D ( u_input , a ) ; float jR = dot ( jQ . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( jR ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float jQ ; float jR = 0.0 ; for ( float jS = 0.025 ; jS < 1.0 ; jS += 0.05 ) for ( float jT = 0.025 ; jT < 1.0 ; jT += 0.05 ) { jQ = max ( texture2D ( u_input , vec2 ( jS , jT ) ) . r , 0.01 ) ; jR += log ( jQ ) ; } float jU = exp ( jR / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( jU ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float lI ; void main ( ) { float lJ = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float lK = texture2D ( u_luminance , a ) . r ; vec4 lL = texture2D ( u_main , a ) ; float lM = lK / lJ ; float lN = u_bloom_edge_lum ; gl_FragColor = lL * max ( lM - lN , 0.0 ) * lI ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float lI ; const vec3 jQ = vec3 ( 0.0 , 1.0 , 0.0 ) ; void jY ( in vec4 jR , in vec3 jS , out vec3 jT ) { float jU = jR . w * jS . x + jR . y * jS . z - jR . z * jS . y ; float jV = jR . w * jS . y + jR . z * jS . x - jR . x * jS . z ; float jW = jR . w * jS . z + jR . x * jS . y - jR . y * jS . x ; float jX = - jR . x * jS . x - jR . y * jS . y - jR . z * jS . z ; jT . x = jU * jR . w - jX * jR . x - jV * jR . z + jW * jR . y ; jT . y = jV * jR . w - jX * jR . y - jW * jR . x + jU * jR . z ; jT . z = jW * jR . w - jX * jR . z - jU * jR . y + jV * jR . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 jZ ; jY ( u_camera_quat , jQ , jZ ) ; lI = dot ( - jZ , u_sun_direction ) * u_bloom_key ; lI *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 jQ = texture2D ( u_mb_tex_curr , a ) ; vec4 jR = texture2D ( u_mb_tex_accum , a ) ; if ( length ( jQ - jR ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * jQ + u_motion_blur_exp * jR ; } else { gl_FragColor = jQ ; } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"vec4 jQ = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( jQ . r + jQ . g + jQ . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 jR = vec2 ( 0.0 , 0.0 ) ; vec2 jS = u_texel_size ; vec4 jT ; jT = texture2D ( u_color , a ) ; gl_FragColor = jT * 0.2270270270 ; jR += jS ; jT = texture2D ( u_color , a + jR ) ; gl_FragColor += jT * 0.1945945946 ; jT = texture2D ( u_color , a - jR ) ; gl_FragColor += jT * 0.1945945946 ; jR += jS ; jT = texture2D ( u_color , a + jR ) ; gl_FragColor += jT * 0.1216216216 ; jT = texture2D ( u_color , a - jR ) ; gl_FragColor += jT * 0.1216216216 ; jR += jS ; jT = texture2D ( u_color , a + jR ) ; gl_FragColor += jT * 0.0540540541 ; jT = texture2D ( u_color , a - jR ) ; gl_FragColor += jT * 0.0540540541 ; jR += jS ; jT = texture2D ( u_color , a + jR ) ; gl_FragColor += jT * 0.0162162162 ; jT = texture2D ( u_color , a - jR ) ; gl_FragColor += jT * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 jS = u_texel_size ; vec4 jT = texture2D ( u_color , a ) ; gl_FragColor = jT ; if ( jT . a == 0.0 ) { jT = texture2D ( u_color , a + jS ) ; if ( jT . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , jT . a ) ; else { jT = texture2D ( u_color , a - jS ) ; if ( jT . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , jT . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; varying vec2 a ; void main ( ) { a = a_bb_vertex + 0.5 ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",b:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",
b:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",
b:["varying","vec4","lJ",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 lK ; varying vec4 lL ; varying vec4 lM ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","lN",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",
b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",
b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",
a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",
")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec3 lT ( vec2 lO , sampler2D lP ) { float lQ = texture2D ( lP , lO ) . r ; float lR = texture2D ( lP , lK . xy ) . r ; float lS = texture2D ( lP , lK . zw ) . r ; return vec3 ( lQ , lR , lS ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 lZ ( vec2 lU , sampler2D lV ) { vec3 lW = lT ( lU , lV ) ; vec2 lX = abs ( lW . xx - lW . yz ) ; vec2 lY = step ( SMAA_PREDICATION_THRESHOLD , lX ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * lY ) ; }".split(" ")}]}}]},{type:"textline",b:"void mc ( bvec2 l_ , inout vec2 ma , vec2 mb ) { if ( l_ . x ) ma . x = mb . x ; if ( l_ . y ) ma . y = mb . y ; } void mc ( bvec4 md , inout vec4 me , vec4 mf ) { mc ( md . xy , me . xy , mf . xy ) ; mc ( md . zw , me . zw , mf . zw ) ; } vec2 mh ( vec2 mg ) { return sign ( mg ) * floor ( abs ( mg ) + .5 ) ; } vec4 mh ( vec4 mi ) { return sign ( mi ) * floor ( abs ( mi ) + .5 ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 mz ( vec2 mj , sampler2D mk".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","ml"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 mm = lZ ( mj , ml ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec2 mm = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 mn = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float mo = dot ( texture2D ( mk , mj ) . rgb , mn ) ; float mp = dot ( texture2D ( mk , lK . xy ) . rgb , mn ) ; float mq = dot ( texture2D ( mk , lK . zw ) . rgb , mn ) ; vec4 mr ; mr . xy = abs ( mo - vec2 ( mp , mq ) ) ; vec2 ms = step ( mm , mr . xy ) ; if ( dot ( ms , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float mt = dot ( texture2D ( mk , lL . xy ) . rgb , mn ) ; float mu = dot ( texture2D ( mk , lL . zw ) . rgb , mn ) ; mr . zw = abs ( mo - vec2 ( mt , mu ) ) ; vec2 mv = max ( mr . xy , mr . zw ) ; float mw = dot ( texture2D ( mk , lM . xy ) . rgb , mn ) ; float mx = dot ( texture2D ( mk , lM . zw ) . rgb , mn ) ; mr . zw = abs ( vec2 ( mp , mq ) - vec2 ( mw , mx ) ) ; mv = max ( mv . xy , mr . zw ) ; float my = max ( mv . x , mv . y ) ; ms . xy *= step ( my , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * mr . xy ) ; return ms ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 mB ( vec2 mA ) { mA . r = mA . r * abs ( 5.0 * mA . r - 5.0 * 0.75 ) ; return mh ( mA ) ; } vec4 mB ( vec4 mC ) { mC . rb = mC . rb * abs ( 5.0 * mC . rb - 5.0 * 0.75 ) ; return mh ( mC ) ; } vec2 mK ( sampler2D mD , vec2 mE , vec2 mF , out vec2 mG ) { vec4 mH = vec4 ( mE , - 1.0 , 1.0 ) ; vec3 mI = vec3 ( u_texel_size , 1.0 ) ; for ( int mJ = 0 ; mJ < SMAA_MAX_SEARCH_STEPS_DIAG ; mJ ++ ) { if ( mH . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && mH . w > 0.9 ) { mH . xyz += mI * vec3 ( mF , 1.0 ) ; mG = texture2D ( mD , mH . xy , 0.0 ) . rg ; mH . w = dot ( mG , vec2 ( 0.5 , 0.5 ) ) ; } } return mH . zw ; } vec2 mS ( sampler2D mL , vec2 mM , vec2 mN , out vec2 mO ) { vec4 mP = vec4 ( mM , - 1.0 , 1.0 ) ; mP . x += 0.25 * u_texel_size . x ; vec3 mQ = vec3 ( u_texel_size , 1.0 ) ; for ( int mR = 0 ; mR < SMAA_MAX_SEARCH_STEPS_DIAG ; mR ++ ) { if ( mP . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && mP . w > 0.9 ) { mP . xyz = mQ * vec3 ( mN , 1.0 ) + mP . xyz ; mO = texture2D ( mL , mP . xy , 0.0 ) . rg ; mO = mB ( mO ) ; mP . w = dot ( mO , vec2 ( 0.5 , 0.5 ) ) ; } } return mP . zw ; } vec2 mY ( sampler2D mT , vec2 mU , vec2 mV , float mW ) { vec2 mX = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * mV + mU ; mX = SMAA_AREATEX_PIXEL_SIZE * mX + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; mX . x += 0.5 ; mX . y += SMAA_AREATEX_SUBTEX_SIZE * mW ; return texture2D ( mT , mX , 0.0 ) . rg ; } vec2 nm ( sampler2D mZ , sampler2D m_ , vec2 na , vec2 nb , vec4 nc ) { vec2 nd = vec2 ( 0.0 , 0.0 ) ; vec4 ne ; vec2 nf ; if ( nb . r > 0.0 ) { ne . xz = mK ( mZ , na , vec2 ( - 1.0 , 1.0 ) , nf ) ; ne . x += float ( nf . y > 0.9 ) ; } else ne . xz = vec2 ( 0.0 , 0.0 ) ; ne . yw = mK ( mZ , na , vec2 ( 1.0 , - 1.0 ) , nf ) ; if ( ne . x + ne . y > 2.0 ) { vec4 ng = vec4 ( - ne . x + 0.25 , ne . x , ne . y , - ne . y - 0.25 ) * u_texel_size . xyxy + na . xyxy ; vec4 nh ; nh . xy = texture2D ( mZ , ng . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; nh . zw = texture2D ( mZ , ng . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; nh . yxwz = mB ( nh . xyzw ) ; vec2 ni = vec2 ( 2.0 , 2.0 ) * nh . xz + nh . yw ; mc ( bvec2 ( step ( 0.9 , ne . zw ) ) , ni , vec2 ( 0.0 , 0.0 ) ) ; nd += mY ( m_ , ne . xy , ni , nc . z ) ; } ne . xz = mS ( mZ , na , vec2 ( - 1 , - 1 ) , nf ) ; if ( texture2D ( mZ , na + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { ne . yw = mS ( mZ , na , vec2 ( 1 , 1 ) , nf ) ; ne . y += float ( nf . y > 0.9 ) ; } else ne . yw = vec2 ( 0.0 , 0.0 ) ; if ( ne . x + ne . y > 2.0 ) { vec4 nj = vec4 ( - ne . x , - ne . x , ne . y , ne . y ) * u_texel_size . xyxy + na . xyxy ; vec4 nk ; nk . x = texture2D ( mZ , nj . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; nk . y = texture2D ( mZ , nj . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; nk . zw = texture2D ( mZ , nj . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 nl = vec2 ( 2.0 , 2.0 ) * nk . xz + nk . yw ; mc ( bvec2 ( step ( 0.9 , ne . zw ) ) , nl , vec2 ( 0 , 0 ) ) ; nd += mY ( m_ , ne . xy , nl , nc . w ) . gr ; } return nd ; }".split(" ")}]}}]},
{type:"textline",b:"float ns ( sampler2D nn , vec2 no , float np ) { vec2 nq = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 nr = SMAA_SEARCHTEX_SIZE * vec2 ( np , 1.0 ) ; nq += vec2 ( - 1.0 , 1.0 ) ; nr += vec2 ( 0.5 , - 0.5 ) ; nq *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; nr *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( nn , nq * no + nr , 0.0 ) . r ; } float nA ( sampler2D nt , sampler2D nu , vec2 nv , float nw ) { vec2 nx = vec2 ( 0.0 , 1.0 ) ; for ( int ny = 0 ; ny < SMAA_MAX_SEARCH_STEPS ; ny ++ ) { if ( nv . x > nw && nx . g > 0.8281 && nx . r == 0.0 ) { nx = texture2D ( nt , nv , 0.0 ) . rg ; nv = - vec2 ( 2.0 , 0.0 ) * u_texel_size + nv ; } } float nz = - ( 255.0 / 127.0 ) * ns ( nu , nx , 0.0 ) + 3.25 ; return u_texel_size . x * nz + nv . x ; } float nI ( sampler2D nB , sampler2D nC , vec2 nD , float nE ) { vec2 nF = vec2 ( 0.0 , 1.0 ) ; for ( int nG = 0 ; nG < SMAA_MAX_SEARCH_STEPS ; nG ++ ) { if ( nD . x < nE && nF . g > 0.8281 && nF . r == 0.0 ) { nF = texture2D ( nB , nD , 0.0 ) . rg ; nD = vec2 ( 2.0 , 0.0 ) * u_texel_size + nD ; } } float nH = - ( 255.0 / 127.0 ) * ns ( nC , nF , 0.5 ) + 3.25 ; return - u_texel_size . x * nH + nD . x ; } float nQ ( sampler2D nJ , sampler2D nK , vec2 nL , float nM ) { vec2 nN = vec2 ( 1.0 , 0.0 ) ; for ( int nO = 0 ; nO < SMAA_MAX_SEARCH_STEPS ; nO ++ ) { if ( nL . y > nM && nN . r > 0.8281 && nN . g == 0.0 ) { nN = texture2D ( nJ , nL , 0.0 ) . rg ; nL = - vec2 ( 0.0 , 2.0 ) * u_texel_size + nL ; } } float nP = - ( 255.0 / 127.0 ) * ns ( nK , nN . gr , 0.0 ) + 3.25 ; return u_texel_size . y * nP + nL . y ; } float nY ( sampler2D nR , sampler2D nS , vec2 nT , float nU ) { vec2 nV = vec2 ( 1.0 , 0.0 ) ; for ( int nW = 0 ; nW < SMAA_MAX_SEARCH_STEPS ; nW ++ ) { if ( nT . y < nU && nV . r > 0.8281 && nV . g == 0.0 ) { nV = texture2D ( nR , nT , 0.0 ) . rg ; nT = vec2 ( 0.0 , 2.0 ) * u_texel_size + nT ; } } float nX = - ( 255.0 / 127.0 ) * ns ( nS , nV . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * nX + nT . y ; } vec2 oe ( sampler2D nZ , vec2 n_ , float oa , float ob , float oc ) { vec2 od = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * mh ( 4.0 * vec2 ( oa , ob ) ) + n_ ; od = SMAA_AREATEX_PIXEL_SIZE * od + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; od . y = SMAA_AREATEX_SUBTEX_SIZE * oc + od . y ; return texture2D ( nZ , od , 0.0 ) . rg ; } void om ( sampler2D of , inout vec2 og , vec4 oh , vec2 oi ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 oj = step ( oi . xy , oi . yx ) ; vec2 ok = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * oj ; ok /= oj . x + oj . y ; vec2 ol = vec2 ( 1.0 , 1.0 ) ; ol . x -= ok . x * texture2D ( of , oh . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; ol . x -= ok . y * texture2D ( of , oh . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; ol . y -= ok . x * texture2D ( of , oh . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; ol . y -= ok . y * texture2D ( of , oh . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; og *= clamp ( ol , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void ou ( sampler2D on , inout vec2 oo , vec4 op , vec2 oq ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 or = step ( oq . xy , oq . yx ) ; vec2 os = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * or ; os /= or . x + or . y ; vec2 ot = vec2 ( 1.0 , 1.0 ) ; ot . x -= os . x * texture2D ( on , op . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; ot . x -= os . y * texture2D ( on , op . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; ot . y -= os . x * texture2D ( on , op . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; ot . y -= os . y * texture2D ( on , op . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; oo *= clamp ( ot , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 oN ( vec2 ov , vec2 ow , sampler2D ox , sampler2D oy , sampler2D oz , vec4 oA ) { vec4 oB = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 oC = texture2D ( ox , ov ) . rg ; if ( oC . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"oB . rg = nm ( ox , oy , ov , oC , oA ) ; if ( oB . r == - oB . g ) {".split(" ")}]}}]},
{type:"textline",b:"vec2 oD ; vec3 oE ; oE . x = nA ( ox , oz , lK . xy , lM . x ) ; oE . y = lL . y ; oD . x = oE . x ; float oF = texture2D ( ox , oE . xy , 0.0 ) . r ; oE . z = nI ( ox , oz , lK . zw , lM . y ) ; oD . y = oE . z ; oD = abs ( mh ( oD / u_texel_size . xx - ow . xx ) ) ; vec2 oG = sqrt ( oD ) ; float oH = texture2D ( ox , oE . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; oB . rg = oe ( oy , oG , oF , oH , oA . y ) ; oE . y = ov . y ; om ( ox , oB . rg , oE . xyzy , oD ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else oC . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( oC . r > 0.0 ) { vec2 oI ; vec3 oJ ; oJ . y = nQ ( ox , oz , lL . xy , lM . z ) ; oJ . x = lK . x ; oI . x = oJ . y ; float oK = texture2D ( ox , oJ . xy , 0.0 ) . g ; oJ . z = nY ( ox , oz , lL . zw , lM . w ) ; oI . y = oJ . z ; oI = abs ( mh ( oI / u_texel_size . yy - ow . yy ) ) ; vec2 oL = sqrt ( oI ) ; float oM = texture2D ( ox , oJ . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; oB . ba = oe ( oy , oL , oK , oM , oA . x ) ; oJ . x = ov . x ; ou ( ox , oB . ba , oJ . xyxz , oI ) ; } return oB ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 pd ( vec2 oO , sampler2D oP , sampler2D oQ".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","oR"]}]}}]},{type:"textline",b:") { vec4 oS ; oS . x = texture2D ( oQ , lJ . xy ) . a ; oS . y = texture2D ( oQ , lJ . zw ) . g ; oS . wz = texture2D ( oQ , oO ) . xz ; if ( dot ( oS , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 oT = texture2D ( oP , oO , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 oU = texture2D ( oR , a ) ; vec2 oV = 2.0 * ct ( oU ) - 1.0 ; oT . a = sqrt ( 2.0 * length ( oV ) ) ;".split(" ")}]}}]},{type:"textline",b:"return oT ; } else { bool oW = max ( oS . x , oS . z ) > max ( oS . y , oS . w ) ; vec4 oX = vec4 ( 0.0 , oS . y , 0.0 , oS . w ) ; vec2 oY = oS . yw ; mc ( bvec4 ( oW , oW , oW , oW ) , oX , vec4 ( oS . x , 0.0 , oS . z , 0.0 ) ) ; mc ( bvec2 ( oW , oW ) , oY , oS . xz ) ; oY /= dot ( oY , vec2 ( 1.0 , 1.0 ) ) ; vec4 oZ = oX * vec4 ( u_texel_size , - u_texel_size ) + oO . xyxy ; vec4 o_ = oY . x * texture2D ( oP , oZ . xy , 0.0 ) ; o_ += oY . y * texture2D ( oP , oZ . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 pa = texture2D ( oR , oZ . xy ) ; vec2 pb = 2.0 * ct ( pa ) - 1.0 ; vec2 pc = oY . x * pb ; pa = texture2D ( oR , oZ . zw ) ; pb = 2.0 * ct ( pa ) - 1.0 ; pc += oY . y * pb ; o_ . a = sqrt ( 2.0 * length ( pc ) ) ;".split(" ")}]}}]},{type:"textline",b:["return","o_",";","}","}"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 pp ( vec2 pe , sampler2D pf , sampler2D pg".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","ph"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 pi = texture2D ( ph , a ) ; vec2 pj ; pj = 2.0 * ct ( pi ) - 1.0 ; vec4 pk = texture2D ( pf , pe ) ; vec4 pl = texture2D ( pg , pe - pj ) ; float pm = abs ( pk . a * pk . a - pl . a * pl . a ) / 2.0 ; float pn = 0.5 * clamp ( 1.0 - sqrt ( pm ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 po = mix ( pk , pl , pn ) ; po . a = 1.0 ; return po ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 pk = texture2D ( pf , pe ) ; vec4 pl = texture2D ( pg , pe ) ; return mix ( pk , pl , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 pq = vec4 ( mz ( a , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",
b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"vec4 pq = oN ( a , lN , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 pq = pd ( a , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],
group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_RESOLVE"],group:{type:"group",a:[{type:"textline",b:"vec4 pq = vec4 ( pp ( a , u_color , u_color_prev".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 pq = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","pq",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","lJ",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 lK ; varying vec4 lL ; varying vec4 lM ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","lN",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],
group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",
a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"void jR ( vec2 jQ ) { lK = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + jQ . xyxy ; lL = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + jQ . xyxy ; lM = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + jQ . xyxy ; }".split(" ")}]}},
{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"void jU ( vec2 jS , out vec2 jT ) { jT = jS / u_texel_size ; lK = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + jS . xyxy ; lL = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + jS . xyxy ; lM = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( lK . xz , lL . yw ) ; }".split(" ")}]}},{type:"elif",c:["SMAA_PASS",
"==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"void jW ( vec2 jV ) { lJ = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + jV . xyxy ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { a = a_bb_vertex + 0.5 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:["jR","(","a",")",";"]}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"jU ( a , lN ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["jW","(","a",")",";"]}]}}]},{type:"textline",b:"gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"define",name:"SSAO_QUALITY_16",b:["1"]},{type:"define",name:"SSAO_QUALITY_32",b:["2"]},{type:"textline",
b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform vec2 u_texel_size ; uniform float u_view_max_depth ; uniform vec2 u_camera_range ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_dithering_amount ; uniform float u_ssao_gauss_center ; uniform float u_ssao_gauss_width_square ; uniform float u_ssao_gauss_width_left_square ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; vec2 lT ( vec2 lO ) { float lP = dot ( lO , vec2 ( 12.9898 , 78.233 ) ) ; float lQ = dot ( lO , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float lR = fract ( sin ( lP ) * 43758.5453 ) * 2.0 - 1.0 ; float lS = fract ( sin ( lQ ) * 43758.5453 ) * 2.0 - 1.0 ; return vec2 ( lR , lS ) ; } float lV ( in vec2 lU ) { return lE ( u_depth , lU , u_camera_range ) ; } float mc ( in float lW , in float lX , inout int lY ) { float lZ = u_ssao_gauss_width_square ; float l_ = ( lW - lX ) * 100.0 ; if ( l_ < u_ssao_gauss_center ) lZ = u_ssao_gauss_width_left_square ; else lY = 1 ; float ma = l_ - u_ssao_gauss_center ; float mb = exp ( - 2.0 * ma * ma / lZ ) ; return mb ; } float ml ( float md , vec2 me ) { float mf = 0.0 ; float mg = 0.0 ; float mh = max ( 1.0 , u_view_max_depth / 100.0 ) ; md *= mh ; me /= md ; vec2 mi = a + me ; vec2 mj = a - me ; int mk = 0 ; mf = mc ( md , mh * lV ( mi ) , mk ) ; if ( mk > 0 || mi . y < 0.0 || mi . y > 1.0 || mi . x < 0.0 || mi . x > 1.0 ) { mg = mc ( mh * lV ( mj ) , md , mk ) ; mf += ( 1.0 - mf ) * mg ; } return mf ; } void main ( ) { vec2 mm = lT ( a ) * u_ssao_dithering_amount ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:["mm","*=","1.5",";"]}]}}]},{type:"textline",b:"float mn = lV ( a ) ; float mo = 0.0 ; vec2 mp = u_texel_size * 0.5 ; for ( int mq = 0 ; mq < 4 ; mq ++ ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"if ( mq == 0 || mq == 2 ) {".split(" ")}]}}]},{type:"textline",b:"mo += ml ( mn , mp ) ; mo += ml ( mn , vec2 ( mp . x , - mp . y ) ) ; mo += ml ( mn , vec2 ( - mp . x , mp . y ) ) ; mo += ml ( mn , vec2 ( - mp . x , - mp . y ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"} else if ( mq == 1 || mq == 3 ) {".split(" ")}]}}]},{type:"textline",b:"mo += ml ( mn , vec2 ( mp . x * 1.2 , 0.0 ) ) ; mo += ml ( mn , vec2 ( - mp . x * 1.2 , 0.0 ) ) ; mo += ml ( mn , vec2 ( 0.0 , mp . y * 1.2 ) ) ; mo += ml ( mn , vec2 ( 0.0 , - mp . y * 1.2 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",
b:["}"]}]}}]},{type:"textline",b:"mp += mm ; mp *= u_ssao_radius_increase ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"mo = 1.0 - mo / 16.0 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"mo = 1.0 - mo / 32.0 ;".split(" ")}]}}]},{type:"textline",b:"float mr = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * mn ) ; mo = ( 1.0 - mr ) + mo * mr ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:["mo","=","1.0",";"]}]}}]},{type:"textline",b:"float ms = texture2D ( u_color , a ) . r ; gl_FragColor = vec4 ( ms , mo , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/velocity.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 a ; void main ( ) { float jQ = texture2D ( u_depth , a ) . x ; vec4 jR = vec4 ( a * 2.0 - 1.0 , 2.0 * jQ - 1.0 , 1.0 ) ; vec4 jS = u_view_proj_inverse * jR ; vec4 jT = jS / jS . w ; vec4 jU = u_view_proj_prev * jT ; jU /= jU . w ; vec2 jV = ( jR . xy - jU . xy ) / 4.0 + 0.5 ; jV = clamp ( jV , 0.0 , 1.0 ) ; gl_FragColor = ch ( jV ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"float b = 0.0 ; struct c { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool f ( vec3 d , vec3 e ) { return any ( lessThan ( abs ( d - e ) , vec3 ( EPSILON ) ) ) ; } vec3 i ( in vec4 g , in vec3 h ) { return h + 2.0 * cross ( g . xyz , cross ( g . xyz , h ) + g . w * h ) ; } mat4 j ( ) { return mat4 ( 1.0 , b , b , b , b , 1.0 , b , b , b , b , 1.0 , b , b , b , b , 1.0 ) ; } mat4 l ( float k ) { return mat4 ( 1.0 , b , b , b , b , cos ( k ) , sin ( k ) , b , b , - sin ( k ) , cos ( k ) , b , b , b , b , 1.0 ) ; } mat4 n ( float m ) { return mat4 ( cos ( m ) , b , - sin ( m ) , b , b , 1.0 , b , b , sin ( m ) , b , cos ( m ) , b , b , b , b , 1.0 ) ; } mat4 p ( float o ) { return mat4 ( cos ( o ) , sin ( o ) , b , b , - sin ( o ) , cos ( o ) , b , b , b , b , 1.0 , b , b , b , b , 1.0 ) ; } c r ( in c q ) { return c ( q . a , q . b , normalize ( q . c ) , normalize ( q . d ) , normalize ( q . e ) , q . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",b:["(","M_PI","/","4.0",")"]},{type:"textline",b:"const vec3 s = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:"HAIR_BILLBOARD_SPHERICAL || ! HAIR_BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 y ( vec3 t , mat4 u ) { vec3 v = vec3 ( u [ 0 ] [ 0 ] , u [ 1 ] [ 0 ] , u [ 2 ] [ 0 ] ) ; vec3 w = vec3 ( u [ 0 ] [ 1 ] , u [ 1 ] [ 1 ] , u [ 2 ] [ 1 ] ) ; vec3 x = vec3 ( u [ 0 ] [ 2 ] , u [ 1 ] [ 2 ] , u [ 2 ] [ 2 ] ) ; w = cross ( x , v ) ; return mat4 ( vec4 ( v , 0.0 ) , vec4 ( w , 0.0 ) , vec4 ( x , 0.0 ) , vec4 ( t , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 E ( vec3 z , vec3 A ) { vec3 B = z - A ; B . y = 0.0 ; B = normalize ( B ) ; vec3 C = normalize ( cross ( s , B ) ) ; vec3 D = normalize ( cross ( B , C ) ) ; return mat4 ( vec4 ( C , 0.0 ) , vec4 ( D , 0.0 ) , vec4 ( B , 0.0 ) , vec4 ( A , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 P ( in vec3 F , float G , float H , float I , vec3 J ) { float L = fract ( length ( J ) / 0.17 ) ; float M = I + L / 10.0 ; float N = L ; if ( I != 0.0 ) N /= I ; F *= 1.0 + 0.5 * sin ( G ) ; float O = length ( F ) * H * sin ( 2.0 * 3.14 * G * M + N ) ; return p ( O ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 _ ( in vec3 Q , in vec3 R , in mat4 S ) {".split(" ")},{type:"condition",a:[{type:"if",c:"HAIR_BILLBOARD_SPHERICAL || ! HAIR_BILLBOARD && ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW )".split(" "),group:{type:"group",a:[{type:"textline",b:"mat4 T = y ( R , S ) ;".split(" ")}]}},{type:"elif",c:["HAIR_BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"float U = fract ( ( R . x * 1.43 + R . y * 0.123 + R . z * 6.1 ) ) ; float V = 2.0 * M_PI * U ; vec3 W = normalize ( vec3 ( S [ 0 ] [ 2 ] , 0.0 , S [ 2 ] [ 2 ] ) ) ; float X = acos ( W [ 2 ] ) ; if ( W [ 0 ] < 0.0 ) X = 2.0 * M_PI - X ; float Y = X - V ; if ( Y < 0.0 ) Y = 2.0 * M_PI + Y ; float Z = V ; if ( Y <= MAX_BILLBOARD_ANGLE ) Z += Y ; else if ( Y <= M_PI - MAX_BILLBOARD_ANGLE ) Z += MAX_BILLBOARD_ANGLE * ( 2.0 * Y - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( Y <= M_PI + MAX_BILLBOARD_ANGLE ) Z += Y - M_PI ; else if ( Y <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) Z += MAX_BILLBOARD_ANGLE * ( 2.0 * Y - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else Z += Y - 2.0 * M_PI ; mat4 T = n ( Z ) ; T [ 3 ] = vec4 ( R , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 T = E ( Q , R ) ;".split(" ")}]}}]},{type:"textline",b:"return T ; } c ag ( in vec3 aa , in vec3 ab , in vec3 ac , in vec3 ad , in vec3 ae , in mat4 af ) { aa = ( af * vec4 ( aa , 1.0 ) ) . xyz ; ab = ( af * vec4 ( ab , 1.0 ) ) . xyz ; ac = ( af * vec4 ( ac , 0.0 ) ) . xyz ; ad = ( af * vec4 ( ad , 0.0 ) ) . xyz ; ae = ( af * vec4 ( ae , 0.0 ) ) . xyz ; return r ( c ( aa , ab , ac , ad , ae , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]=
{type:"group",a:[{type:"textline",b:"vec2 aj ( vec2 ah , vec3 ai ) { return ( ah + 0.5 ) * ai . xy - 0.5 ; }".split(" ")}]};a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 as ( in vec4 ak , in vec4 al , in float am ) { float an = ak [ 0 ] * al [ 0 ] + ak [ 1 ] * al [ 1 ] + ak [ 2 ] * al [ 2 ] + ak [ 3 ] * al [ 3 ] ; if ( an < 0.0 ) { al *= - 1.0 ; an = - an ; } if ( abs ( an ) >= 1.0 ) return ak ; float ao = acos ( an ) ; float ap = sqrt ( 1.0 - an * an ) ; if ( abs ( ap ) < 0.001 ) return vec4 ( ak * 0.5 + al * 0.5 ) ; float aq = sin ( ( 1.0 - am ) * ao ) / ap ; float ar = sin ( am * ao ) / ap ; return ak * aq + al * ar ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aH ( in vec3 at , in vec4 au , in vec4 av , in vec4 aw , in vec4 ax , in float ay ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 az = as ( au , av , ay ) ; vec4 aA = mix ( aw , ax , ay ) ; vec3 aB = i ( az , at ) ; vec3 aC = aB * aA . w + aA . xyz ; return aC ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aD = i ( au , at ) ; vec3 aE = i ( av , at ) ; vec3 aF = aD * aw . w + aw . xyz ; vec3 aG = aE * ax . w + ax . xyz ; return mix ( aF , aG , ay ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aQ ( in vec3 aI , in vec4 aJ , in vec4 aK , in float aL ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aM = as ( aJ , aK , aL ) ; vec3 aN = i ( aM , aI ) ; return aN ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aO = i ( aJ , aI ) ; vec3 aP = i ( aK , aI ) ; return mix ( aO , aP , aL ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 aH ( in vec3 aR , in vec4 aS , in vec4 aT ) { vec3 aU = i ( aS , aR ) ; vec3 aV = aU * aT . w + aT . xyz ; return aV ; } vec3 aQ ( in vec3 aW , in vec4 aX ) { vec3 aY = i ( aX , aW ) ; return aY ; }".split(" ")}]}}]},{type:"textline",b:"void bl ( inout vec3 aZ , inout vec3 a_ , inout vec3 ba , inout vec3 bb ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["float","bc","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { vec3 bd = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 be = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bf = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bg = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int bh = 0 ; bh < 4 ; bh ++ ) { int bi = int ( a_influence [ bh ] ) ; float bj = fract ( a_influence [ bh ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bd += bj * aH ( aZ , u_quatsb [ bi ] , u_quatsa [ bi ] , u_transb [ bi ] , u_transa [ bi ] , bc ) ; be += bj * aQ ( a_ , u_quatsb [ bi ] , u_quatsa [ bi ] , bc ) ; bf += bj * aQ ( ba , u_quatsb [ bi ] , u_quatsa [ bi ] , bc ) ; bg += bj * aQ ( bb , u_quatsb [ bi ] , u_quatsa [ bi ] , bc ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bd += bj * aH ( aZ , u_quatsb [ bi ] , u_transb [ bi ] ) ; be += bj * aQ ( a_ , u_quatsb [ bi ] ) ; bf += bj * aQ ( ba , u_quatsb [ bi ] ) ; bg += bj * aQ ( bb , u_quatsb [ bi ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} aZ = bd ; a_ = be ; ba = bf ; bb = bg ; } if ( ! ( a_influence . y > 0.0 ) ) { int bk = int ( a_influence [ 0 ] - 1.0 ) ; if ( bk > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"aZ = aH ( aZ , u_quatsb [ bk ] , u_quatsa [ bk ] , u_transb [ bk ] , u_transa [ bk ] , bc ) ; a_ = aQ ( a_ , u_quatsb [ bk ] , u_quatsa [ bk ] , bc ) ; ba = aQ ( ba , u_quatsb [ bk ] , u_quatsa [ bk ] , bc ) ; bb = aQ ( bb , u_quatsb [ bk ] , u_quatsa [ bk ] , bc ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"aZ = aH ( aZ , u_quatsb [ bk ] , u_transb [ bk ] ) ; a_ = aQ ( a_ , u_quatsb [ bk ] ) ; ba = aQ ( ba , u_quatsb [ bk ] ) ; bb = aQ ( bb , u_quatsb [ bk ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bz ( inout vec3 bm , in vec3 bn , in float bo , in float bp , in float bq , in vec3 br , in float bs ) { float bt = length ( bn ) ; float bu = bp * ( 1.0 + 0.1 * fract ( bt ) ) ; float bv = bo * bs * ( 1.0 + sin ( 2.0 * 3.14 * bq * bu + bt ) ) ; float bw = ( bm . y - bn . y ) * abs ( bv ) ; bw += 1.0 ; bw *= bw ; bw = bw * bw - bw ; vec3 bx = bm ; bx . xz += br . xz * bw * sign ( bv ) ; float by = length ( bm - bn ) ; bm = bn + normalize ( bx - bn ) * by ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bB ( vec4 bA ) { return bA * bA * ( 3.0 - 2.0 * bA ) ; } vec4 bD ( vec4 bC ) { return abs ( fract ( bC + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bF ( vec4 bE ) { return bB ( bD ( bE ) ) ; } void bW ( inout vec3 bG , in float bH , in vec3 bI , in vec3 bJ , in vec3 bK , in float bL , in float bM , in float bN , in vec3 bO ) { float bP ; float bQ ; float bR ; vec2 bS ; vec4 bT ; vec2 bU ; vec3 bV ; bP = dot ( bK , vec3 ( 1.0 ) ) ; bQ = bP + bO . g ; bR = dot ( bG , vec3 ( bO . g ) ) ; bS = ( bH + vec2 ( bR , bQ ) ) ; bT = ( ( fract ( ( bS . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bJ ) * bL ; bT = bF ( bT ) ; bU = bT . xz + bT . yw ; bU . y = 0.5 - bU . y ; bV = bU . xyx * bO . rbr * vec3 ( bM * bI . x , bN , bM * bI . z ) ; bG += bV ; }".split(" ")}]}}]},
{type:"textline",b:"void cc ( inout vec3 bX , inout vec3 bY , in vec3 bZ ) { vec3 b_ = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vec3 ca = bY ; vec3 cb = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ca = bX ; vec3 cb = bY ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"bW ( ca , u_time , bZ , b_ , cb , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bz ( ca , cb , au_wind_bending_amp , au_wind_bending_freq , u_time , b_ , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bz ( ca , cb , au_wind_bending_amp , au_wind_bending_freq , u_time , b_ , 1.0 ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"bX += ca - bY ; bY = ca ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bX = ca ; bY = cb ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",b:["2"]},
{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_RGBA",b:["2"]},{type:"define",name:"SHADOW_SRC_RGBA_PCF",b:["3"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["4"]},{type:"define",name:"SHADOW_SRC_VSM",b:["5"]},{type:"define",name:"SHADOW_SRC_MASK",b:["6"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_RGBA",b:["2"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["3"]},{type:"define",name:"SHADOW_DST_VSM",b:["4"]},{type:"define",name:"SHADOW_DST_MASK",
b:["5"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"vec4 ch ( const in float cd ) { const vec4 ce = vec4 ( 255.0 * 255.0 * 255.0 , 255.0 * 255.0 , 255.0 , 1.0 ) ; const vec4 cf = vec4 ( 0.0 , 1.0 / 255.0 , 1.0 / 255.0 , 1.0 / 255.0 ) ; vec4 cg = fract ( cd * ce ) ; cg -= cg . xxyz * cf ; return cg ; } float cl ( const in vec4 ci ) { float cj ; const vec4 ck = vec4 ( 1.0 / ( 255.0 * 255.0 * 255.0 ) , 1.0 / ( 255.0 * 255.0 ) , 1.0 / 255.0 , 1.0 ) ; cj = dot ( ci , ck ) ; return cj ; } vec4 ch ( const in vec2 cm ) { const vec2 cn = vec2 ( 255.0 , 1.0 ) ; const vec2 co = vec2 ( 0.0 , 1.0 / 255.0 ) ; vec4 cp = fract ( cm . xxyy * cn . xyxy ) ; cp -= cp . xxzz * co . xyxy ; if ( cm . r == 1.0 ) cp . rg = vec2 ( 0.0 , 1.0 ) ; if ( cm . g == 1.0 ) cp . ba = vec2 ( 0.0 , 1.0 ) ; return cp ; } vec2 ct ( const in vec4 cq ) { vec2 cr ; const vec2 cs = vec2 ( 1.0 / 255.0 , 1.0 ) ; cr . r = dot ( cq . rg , cs ) ; cr . g = dot ( cq . ba , cs ) ; return cr ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_SECTION_DIST0",b:["0.0"]},{type:"var",name:"CSM_SECTION_DIST1",b:["0.0"]},{type:"var",name:"CSM_SECTION_DIST2",b:["0.0"]},{type:"var",name:"CSM_SECTION_DIST3",b:["0.0"]},{type:"var",name:"PCF_TEXEL_SIZE",b:["0.0"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","cB",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_RGBA_PCF"],group:{type:"group",a:[{type:"textline",b:"float cI ( sampler2D cC , vec3 cD , float cE , float cF ) { vec2 cG = cD . xy + vec2 ( cE , cF ) * PCF_TEXEL_SIZE ; vec4 cH = texture2D ( cC , cG ) ; return cl ( cH ) ; }".split(" ")}]}}]},{type:"textline",b:"float cX ( vec3 cJ , sampler2D cK , float cL ) { float cM ; cJ . z = clamp ( cJ . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_RGBA"],
group:{type:"group",a:[{type:"textline",b:"vec4 cN = texture2D ( cK , cJ . xy ) ; float cO = cl ( cN ) ; if ( all ( lessThan ( cJ . xy , vec2 ( 1.0 ) ) ) && all ( greaterThan ( cJ . xy , vec2 ( 0.0 ) ) ) && cO < cJ . z ) { float cP = cJ . z - cO ; cM = exp ( - cP * cL ) ; } else cM = 1.0 ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","==","SHADOW_SRC_RGBA_PCF"],group:{type:"group",a:[{type:"textline",b:"vec4 cO ; cO . r = cI ( cK , cJ , 0.5 , 0.5 ) ; cO . g = cI ( cK , cJ , 0.5 , - 0.5 ) ; cO . b = cI ( cK , cJ , - 0.5 , - 0.5 ) ; cO . a = cI ( cK , cJ , - 0.5 , 0.5 ) ; vec4 cQ = vec4 ( cJ . z , cJ . z , cJ . z , cJ . z ) ; if ( all ( lessThan ( cJ . xy , vec2 ( 1.0 ) ) ) && all ( greaterThan ( cJ . xy , vec2 ( 0.0 ) ) ) ) cM = dot ( vec4 ( greaterThanEqual ( cO , cQ ) ) , vec4 ( 0.25 , 0.25 , 0.25 , 0.25 ) ) ; else cM = 1.0 ;".split(" ")}]}},
{type:"elif",c:["SHADOW_SRC","==","SHADOW_SRC_VSM"],group:{type:"group",a:[{type:"textline",b:"vec4 cR = texture2D ( cK , cJ . xy ) ; float cS = cR . r ; float cT = cR . g ; if ( all ( lessThan ( cJ . xy , vec2 ( 1.0 ) ) ) && all ( greaterThan ( cJ . xy , vec2 ( 0.0 ) ) ) && cS < cJ . z ) { float cU = cT - cS * cS ; float cV = cJ . z - cS ; cM = cU / ( cU + cV * cV ) ; } else cM = 1.0 ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float cO = texture2D ( cK , cJ . xy ) . r ; if ( all ( lessThan ( cJ . xy , vec2 ( 1.0 ) ) ) && all ( greaterThan ( cJ . xy , vec2 ( 0.0 ) ) ) && cO < cJ . z ) { cM = 0.0 ; float cW = cJ . z - cO ; cM = exp ( - cW * cL ) ; } else cM = 1.0 ;".split(" ")}]}}]},
{type:"textline",b:"return clamp ( cM , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"float dc ( float cY , float cZ ) { vec3 c_ ; float da = 1.0 ; float db = - cY ; if ( db < CSM_SECTION_DIST0 ) { c_ = cv . xyz / cv . w ; da = cX ( c_ , u_shadow_map0 , cZ ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else if ( db < CSM_SECTION_DIST1 ) { c_ = cw . xyz / cw . w ; da = cX ( c_ , u_shadow_map1 , cZ ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else if ( db < CSM_SECTION_DIST2 ) { c_ = cx . xyz / cx . w ; da = cX ( c_ , u_shadow_map2 , cZ ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else if ( db < CSM_SECTION_DIST3 ) { c_ = cy . xyz / cy . w ; da = cX ( c_ , u_shadow_map3 , cZ ) ; }".split(" ")}]}}]},{type:"textline",b:["return","da",";","}"]}]}}]}]}}]},{type:"textline",b:"float di ( in float dd , inout vec3 de ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 df = texture2DProj ( u_shadow_mask , cz ) . rg ; vec3 dg = vec3 ( df . r ) ; float dh = df . g ; cB = vec4 ( dg , dh ) ; de *= cB . a ; return cB . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return dc ( cA . z , dd ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},
{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec2 dn ( vec3 dj , float dk , vec2 dl ) { vec2 dm = vec2 ( ( dj . x - dl . x ) / dk , - ( dj . z - dl . y ) / dk ) ; return fract ( dm ) ; } vec2 ds ( vec2 dp , float dq , vec2 dr ) { return vec2 ( dp . x * dq , - dp . y * dq ) + dr ; } c dt ( ) { return c ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } c dZ ( vec3 du , vec3 dv , vec3 dw , vec3 dx , vec3 dy , sampler2D dz , sampler2D dA , vec3 dB , float dC , vec3 dD , vec4 dE , mat4 dF ) { vec3 dG = i ( dE , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float dH = - dG . x ; float dI = - dG . z ; vec2 dJ = vec2 ( dD . x + dC * ( - 1.0 - dH ) / 2.0 , dD . z + dC * ( 1.0 - dI ) / 2.0 ) ; vec2 dK = dn ( dy , dC , dJ ) ; float dL = dC / 2.0 ; vec2 dM = abs ( ds ( dK - vec2 ( 0.5 ) , dC , vec2 ( 0.0 ) ) ) ; float dN = dL * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( dM ) > dN ) return dt ( ) ; float dO = dC / dB . z ; vec2 dP = ( dK - vec2 ( 0.5 ) ) * dO + vec2 ( 0.5 ) ; vec3 dQ = dG * ( dC / dB . z - 1.0 ) / 2.0 ; dP . x += dQ . x ; dP . y -= dQ . z ; vec4 dR = texture2D ( dA , dP ) ; float dS = dR . r ; if ( dS < u_scale_threshold ) return dt ( ) ; float dT = dB . y - dB . x ; float dU = dB . y - texture2D ( dz , dP ) . r * dT ; vec2 dV = du . xz - dy . xz ; dy . xz = ds ( dK , dC , dJ ) ; dy . y = dU ; du . xz = dy . xz + dV ; du . y *= dS ; du . y += dU ; vec3 dW = dR . gba ;".split(" ")},
{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"du -= dy ; mat4 dX = _ ( dD , dy , dF ) ; c dY = ag ( du , dy , dv , dw , dx , dX ) ; dY . b = dy ; dY . f = dW ; return r ( dY ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return r ( c ( du , dy , dv , dw , dx , dW ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"void ea ( vec3 d_ ) { cv = u_b_light_matrix * u_p_light_matrix0 * u_v_light_matrix * vec4 ( d_ , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"cw = u_b_light_matrix * u_p_light_matrix1 * u_v_light_matrix * vec4 ( d_ , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cx = u_b_light_matrix * u_p_light_matrix2 * u_v_light_matrix * vec4 ( d_ , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cy = u_b_light_matrix * u_p_light_matrix3 * u_v_light_matrix * vec4 ( d_ , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void ea ( vec4 eb ) { float ec = eb . x ; float ed = eb . y ; float ee = eb . w ; cz . x = ( ec + ee ) / 2.0 ; cz . y = ( ed + ee ) / 2.0 ; cz . z = ee ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]=
{type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void eh ( inout vec3 eg ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"eg = max ( vec3 ( 0.0 ) , eg ) ; eg = pow ( eg , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void ej ( inout vec3 ei ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"ei = max ( vec3 ( 0.0 ) , ei ) ; ei = pow ( ei , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"} void em ( inout vec3 ek , in float el ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"ek = ek * el ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"void eu ( inout vec3 ep , in float eq , in vec4 er ) { float es = er . w * eq ; float et = exp ( - es * es ) ; et = clamp ( et , 0.0 , 1.0 ) ; ep = mix ( er . rgb , ep , et ) ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 eB ( in mat4 ev , in vec3 ew ) { vec3 ex = mix ( ev [ 0 ] . rgb , ev [ 1 ] . rgb , max ( sign ( ew . x ) , 0.0 ) ) ; vec3 ey = mix ( ev [ 2 ] . rgb , ev [ 3 ] . rgb , max ( sign ( ew . z ) , 0.0 ) ) ; vec3 ez = vec3 ( ev [ 0 ] . a , ev [ 1 ] . a , ev [ 2 ] . a ) ; vec3 eA = mix ( ex , ey , abs ( ew . z ) ) ; eA = mix ( eA , ez , abs ( ew . y ) ) ; return eA ; }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void eD ( inout float eC ) { eC -= 0.5 ; eC = 4.0 * ( eC * eC * eC ) + 0.5 ; } void eU ( inout vec3 eE , in float eF , in vec3 eG , in float eH , in vec4 eI , in vec4 eJ , in float eK , in float eL ) { float eM = eJ . w * eF ; float eN = exp ( - eM * eM ) ; eN = clamp ( eN , 0.0 , 1.0 ) ; float eO = max ( eG . y , 0.0 ) ; eF = max ( eF - max ( eH / eO , 0.0 ) , 0.0 ) ; float eP = eI . w * eF ; float eQ = 1.0 - eP ; eQ = clamp ( eQ , 0.0 , 1.0 ) ; eQ += max ( eK , 0.0 ) ; eD ( eQ ) ; if ( eQ < eN ) { vec3 eR = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 eS = eI . rgb ; eH = clamp ( - eH * 0.03 , 0.0 , 0.8 ) ; vec3 eT = mix ( eS , eR , min ( eO , 1.0 ) ) ; eT = mix ( eT , vec3 ( 0.0 ) , eH ) * eL ; eE = mix ( eT , eE , eQ ) ; } if ( eQ >= eN ) { eE = mix ( eJ . rgb , eE , eN ) ; } } void fc ( inout vec3 eV , in float eW , in float eX , in vec4 eY , in float eZ ) { float e_ = eY . w * eW ; float fa = 1.0 - e_ ; fa = clamp ( fa , 0.0 , 1.0 ) ; eD ( fa ) ; eX = clamp ( - eX * 0.03 , 0.0 , 0.8 ) ; vec3 fb = mix ( eY . rgb , vec3 ( 0.0 ) , eX ) * eZ ; eV = mix ( fb , eV , fa ) ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"struct fd { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float fl ( vec3 fe , vec3 ff , vec3 fg , vec4 fh , float fi ) { vec3 fj = normalize ( fe + ff ) ; float fk = fh [ 0 ] * max ( dot ( fg , fj ) , 0.0 ) + fh [ 1 ] ; return pow ( fk , fi ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float fw ( vec3 fm , vec3 fn , vec3 fo , float fp ) { vec3 fq = normalize ( fm + fn ) ; float fr = max ( dot ( fo , fq ) , 0.001 ) ; float fs = max ( dot ( fo , fn ) , 0.001 ) ; float ft = max ( dot ( fo , fm ) , 0.001 ) ; float fu = tan ( acos ( fr ) ) ; float fv = max ( fp , 0.001 ) ; return ft * ( 1.0 / ( 4.0 * M_PI * fv * fv ) ) * ( exp ( - ( fu * fu ) / ( fv * fv ) ) / ( sqrt ( fs * ft ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float fE ( vec3 fx , vec3 fy , vec3 fz , float fA , float fB ) { vec3 fC = normalize ( fx + fy ) ; float fD = acos ( dot ( fC , fz ) ) ; if ( fD < fA ) return 1.0 ; else if ( fD >= fA + fB || fB == 0.0 ) return 0.0 ; else return 1.0 - ( fD - fA ) / fB ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",
b:"void fY ( float fF , vec3 fG , vec3 fH , vec3 fI , float fJ , inout float fK ) { if ( fJ > 0.0 ) { float fL = max ( dot ( fG , fI ) , 0.0 ) ; float fM = fJ * fJ ; float fN = 1.0 - 0.5 * ( fM / ( fM + 0.33 ) ) ; vec3 fO = fH - fF * fG ; vec3 fP = fI - fL * fG ; if ( length ( fO ) == 0.0 || length ( fP ) == 0.0 || abs ( fF ) > 1.0 || abs ( fL ) > 1.0 ) fK = fK * fN ; else { float fQ = acos ( fF ) ; float fR = acos ( fL ) ; vec3 fS = normalize ( fO ) ; vec3 fT = normalize ( fP ) ; float fU , fV ; fU = max ( fQ , fR ) ; fV = min ( fQ , fR ) ; fV *= 0.95 ; float fW = max ( dot ( fS , fT ) , 0.0 ) ; float fX = 0.45 * ( fM / ( fM + 0.09 ) ) ; fK = fK * ( fN + ( fX * fW * sin ( fU ) * tan ( fV ) ) ) ; } } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void ge ( vec3 fZ , vec3 f_ , float ga , float gb , out float gc ) { float gd ; if ( ga == 0.0 ) { gc = 1.0 ; } else { gd = 1.0 + abs ( dot ( f_ , fZ ) ) ; gd = gb + ( 1.0 - gb ) * pow ( gd , ga ) ; gc = clamp ( gd , 0.0 , 1.0 ) ; } }".split(" ")}]}}]},{type:"textline",b:"void gM ( inout fd gf , vec3 gg , vec3 gh , vec3 gi , vec3 gj , vec3 gk , vec2 gl , vec2 gm , float gn , vec3 go , vec3 gp , vec3 gq , vec4 gr , vec4 gs , float gt , vec4 gu ) { vec3 gv = vec3 ( 0.0 ) ; vec3 gw = gq * gn ; float gx = gs . z ; if ( gx != - 1.0 ) { gv = go - gi ; float gy = length ( gv ) ; gw *= gx / ( gx + gy * gy ) ; gv = normalize ( gv ) ; float gz = gs . x ; float gA = gs . y ; if ( gz > - 1.0 ) { float gB = dot ( gv , gp ) ; gB *= smoothstep ( 0.0 , 1.0 , ( gB - gz ) / gA ) ; gw *= gB ; } } else gv = gp ; float gC ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"ge ( gj , gv , gm [ 0 ] , gm [ 1 ] , gC ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float gD = max ( dot ( gj , gv ) , 0.0 ) ; gC = gr [ 0 ] * gD + gr [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"fY ( gD , gj , gv , gk , gm [ 0 ] , gC ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float gE = fl ( gv , gk , gj , gr , gl [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float gE = fw ( gv , gk , gj , gl [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float gE = fE ( gv , gk , gj , gl [ 0 ] , gl [ 1 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["float","gE","=","0.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( gv , gj ) * dot ( gk , gj ) < 0.0 ) { float gF = gu . x ; float gG = gu . y ; float gH = gu . z ; float gI = gu . w ; float gJ = clamp ( abs ( dot ( gv , gj ) ) , 0.0 , 1.0 ) ; float gK = clamp ( dot ( gk , - gv ) , 0.0 , 1.0 ) ; float gL = pow ( gK , gG ) ; gf . a += gt * vec4 ( gw * gJ * pow ( gg , vec3 ( gF ) ) , 1.0 ) ; gf . a += gH * mix ( vec4 ( gg , 1.0 ) , vec4 ( 1.0 ) , gI ) * gt * vec4 ( gw * gJ * vec3 ( gL ) , 1.0 ) ; } else { gf . b += gw * gh * gE ; gf . a += vec4 ( gw * gg * gC , gE ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gf . b += gw * gh * gE ; gf . a += vec4 ( gw * gg * gC , gE ) ;".split(" ")}]}}]},{type:"textline",b:"} fd hy ( vec3 gN , vec3 gO , vec3 gP , vec3 gQ , vec3 gR , vec3 gS , vec3 gT , vec2 gU , vec2 gV , float gW , vec3 gX [ NUM_LIGHTS ] , vec3 gY [ NUM_LIGHTS ] , vec3 gZ [ NUM_LIGHTS ] , vec4 g_ [ NUM_LIGHTS ] , vec4 ha [ NUM_LIGHTS ] , float hb , vec4 hc ) { fd hd ; hd . a = vec4 ( gN + gP * gO , 0.0 ) ; hd . b = vec3 ( 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","0"],group:{type:"group",a:[{type:"textline",b:"gM ( hd , gP , gQ , gR , gS , gT , gU , gV , gW , gX [ 0 ] , gY [ 0 ] , gZ [ 0 ] , g_ [ 0 ] , ha [ 0 ] , hb , hc ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","1"],group:{type:"group",a:[{type:"textline",b:"gM ( hd , gP , gQ , gR , gS , gT , gU , gV , gW , gX [ 1 ] , gY [ 1 ] , gZ [ 1 ] , g_ [ 1 ] , ha [ 1 ] , hb , hc ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","2"],group:{type:"group",a:[{type:"textline",b:"gM ( hd , gP , gQ , gR , gS , gT , gU , gV , gW , gX [ 2 ] , gY [ 2 ] , gZ [ 2 ] , g_ [ 2 ] , ha [ 2 ] , hb , hc ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LIGHTS",">","3"],group:{type:"group",a:[{type:"textline",b:"gM ( hd , gP , gQ , gR , gS , gT , gU , gV , gW , gX [ 3 ] , gY [ 3 ] , gZ [ 3 ] , g_ [ 3 ] , ha [ 3 ] , hb , hc ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",
a:[{type:"textline",b:"for ( int he = 0 ; he < NUM_LIGHTS ; he ++ ) { vec4 hf = g_ [ he ] ; vec4 hg = ha [ he ] ; vec3 hh = vec3 ( 0.0 ) ; vec3 hi = gZ [ he ] ; hi *= gW ; float hj = hg . z ; if ( hj != - 1.0 ) { hh = gX [ he ] - gR ; float hk = length ( hh ) ; hi *= hj / ( hj + hk * hk ) ; hh = normalize ( hh ) ; float hl = hg . x ; float hm = hg . y ; if ( hl > - 1.0 ) { float hn = dot ( hh , gY [ he ] ) ; hn *= smoothstep ( 0.0 , 1.0 , ( hn - hl ) / hm ) ; hi *= hn ; } } else hh = gY [ he ] ; float ho ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"ge ( gS , hh , gV [ 0 ] , gV [ 1 ] , ho ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float hp = max ( dot ( gS , hh ) , 0.0 ) ; ho = hf [ 0 ] * hp + hf [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"fY ( hp , gS , hh , gT , gV [ 0 ] , ho ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float hq = fl ( hh , gT , gS , hf , gU [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float hq = fw ( hh , gT , gS , gU [ 0 ] ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_TOON"],group:{type:"group",a:[{type:"textline",b:"float hq = fE ( hh , gT , gS , gU [ 0 ] , gU [ 1 ] ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["float","hq","=","0.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["USE_NODE_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( hh , gS ) * dot ( gT , gS ) < 0.0 ) { float hr = hc . x ; float hs = hc . y ; float ht = hc . z ; float hu = hc . w ; float hv = clamp ( abs ( dot ( hh , gS ) ) , 0.0 , 1.0 ) ; float hw = clamp ( dot ( gT , - hh ) , 0.0 , 1.0 ) ; float hx = pow ( hw , hs ) ; hd . a += hb * vec4 ( hi * hv * pow ( gP , vec3 ( hr ) ) , 1.0 ) ; hd . a += ht * mix ( vec4 ( gP , 1.0 ) , vec4 ( 1.0 ) , hu ) * hb * vec4 ( hi * hv * vec3 ( hx ) , 1.0 ) ; } else { hd . b += hi * gQ * hq ; hd . a += vec4 ( hi * gP * ho , hq ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"hd . b += hi * gQ * hq ; hd . a += vec4 ( hi * gP * ho , hq ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]},{type:"textline",b:["return","hd",";","}"]}]};a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"vec4 hA ( vec4 hz ) { return hz - floor ( hz * ( 1.0 / 289.0 ) ) * 289.0 ; } vec3 hA ( vec3 hB ) { return hB - floor ( hB * ( 1.0 / 289.0 ) ) * 289.0 ; } vec2 hA ( vec2 hC ) { return hC - floor ( hC * ( 1.0 / 289.0 ) ) * 289.0 ; } vec4 hE ( vec4 hD ) { return hD - floor ( hD * ( 1.0 / 7.0 ) ) * 7.0 ; } vec4 hG ( vec4 hF ) { return hA ( ( 34.0 * hF + 5.0 ) * hF ) ; }".split(" ")},
{type:"define",name:"K",b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 hS ( vec2 hH ) { vec2 hI = hA ( floor ( hH ) ) ; vec2 hJ = fract ( hH ) ; vec4 hK = hJ . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 hL = hJ . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 hM = hG ( hI . x + vec4 ( 0.0 , 1.0 , 0.0 , 1.0 ) ) ; hM = hG ( hM + hI . y + vec4 ( 0.0 , 0.0 , 1.0 , 1.0 ) ) ; vec4 hN = hE ( hM ) * K + K2 ; vec4 hO = hE ( floor ( hM * K ) ) * K + K2 ; vec4 hP = hK + JITTER * hN ; vec4 hQ = hL + JITTER * hO ; vec4 hR = hP * hP + hQ * hQ ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"hR . xy = min ( hR . xy , hR . zw ) ; hR . x = min ( hR . x , hR . y ) ; return hR . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"hR . xy = ( hR . x < hR . y ) ? hR . xy : hR . yx ; hR . xz = ( hR . x < hR . z ) ? hR . xz : hR . zx ; hR . xw = ( hR . x < hR . w ) ? hR . xw : hR . wx ; hR . y = min ( hR . y , hR . z ) ; hR . y = min ( hR . y , hR . w ) ; return sqrt ( hR . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 ih ( vec2 hT , float hU ) { vec2 hV = hA ( floor ( hT ) ) ; vec2 hW = fract ( hT ) ; vec4 hX = hW . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 hY = hW . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 hZ = hG ( hV . x + vec4 ( 0.0 , 1.0 , 0.0 , 1.0 ) ) ; hZ = hG ( hZ + hV . y + vec4 ( 0.0 , 0.0 , 1.0 , 1.0 ) ) ; vec4 h_ = hE ( hZ ) * K + K2 ; vec4 ia = hE ( floor ( hZ * K ) ) * K + K2 ; vec4 ib = hX + JITTER * h_ ; vec4 ic = hY + JITTER * ia ; vec4 id = ib * ib + ic * ic ; ib += hU ; ic += hU ; vec4 ie = ib * ib + ic * ic ; ib += hU ; ic += hU ; vec4 ig = ib * ib + ic * ic ; id . xy = min ( id . xy , id . zw ) ; id . x = min ( id . x , id . y ) ; ie . xy = min ( ie . xy , ie . zw ) ; ie . x = min ( ie . x , ie . y ) ; ig . xy = min ( ig . xy , ig . zw ) ; ig . x = min ( ig . x , ig . y ) ; return mat3 ( id . xx , 0.0 , ie . xx , 0.0 , ig . xx , 0.0 ) ; } vec3 ij ( vec3 ii ) { return hA ( ( ( ii * 34.0 ) + 1.0 ) * ii ) ; } float iy ( vec2 ik ) { const vec4 il = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 im = floor ( ik + dot ( ik , il . yy ) ) ; vec2 io = ik - im + dot ( im , il . xx ) ; vec2 ip ; ip = ( io . x > io . y ) ? vec2 ( 1.0 , 0.0 ) : vec2 ( 0.0 , 1.0 ) ; vec4 iq = io . xyxy + il . xxzz ; iq . xy -= ip ; im = hA ( im ) ; vec3 ir = ij ( ij ( im . y + vec3 ( 0.0 , ip . y , 1.0 ) ) + im . x + vec3 ( 0.0 , ip . x , 1.0 ) ) ; vec3 is = max ( 0.5 - vec3 ( dot ( io , io ) , dot ( iq . xy , iq . xy ) , dot ( iq . zw , iq . zw ) ) , 0.0 ) ; is = is * is ; is = is * is ; vec3 it = 2.0 * fract ( ir * il . www ) - 1.0 ; vec3 iu = abs ( it ) - 0.5 ; vec3 iv = floor ( it + 0.5 ) ; vec3 iw = it - iv ; is *= 1.79284291400159 - 0.85373472095314 * ( iw * iw + iu * iu ) ; vec3 ix ; ix . x = iw . x * io . x + iu . x * io . y ; ix . yz = iw . yz * iq . xz + iu . yz * iq . yw ; return 130.0 * dot ( is , ix ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",b:["100.0"]},{type:"textline",b:"void iZ ( inout vec3 iz , float iA , float iB , float iC , vec3 iD , vec3 iE , vec3 iF , vec4 iG , vec3 iH , float iI ) { if ( iI > CAUSTICS_VIEW_DISTANCE ) return ; vec4 iJ = iG ; vec3 iK = iH + iD ; iK . xz = 10.0 * sin ( 0.1 * iK . xz ) ; vec3 iL = iK + 2.0 * cross ( - iJ . xyz , cross ( - iJ . xyz , iK ) + iJ . w * iK ) ; vec2 iM = iL . xz ; vec3 iN = iE ; float iO = max ( dot ( iD , iN ) , 0.0 ) ; float iP = 0.025 ; iM . s += 0.5 * sin ( dot ( iH + iB , vec3 ( 1.0 ) ) ) ; iM . t += 0.7 * ( - sin ( dot ( iH - iB , vec3 ( - 0.7 ) ) ) ) ; iM . st += 0.23 * cos ( 4.0 * iA - CAUST_SPEED . x * iB ) ; iM . st += 3.0 * sin ( iA - 0.3 * CAUST_SPEED . y * iB ) ; float iQ = CAUST_SCALE * ( 1.0 + max ( 0.1 * iA , 0.0 ) ) ; mat3 iR = ih ( ( iM / iQ ) , iP ) ; float iS = ( iR * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; float iT = ( iR * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; float iU = ( iR * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; vec3 iV = CAUST_BRIGHT * vec3 ( iS , iT , iU ) ; float iW = iC * iO ; float iX = max ( sign ( iA ) , 0.0 ) ; iW = min ( iW + 0.5 * sign ( - iD . y ) * iX , 1.0 ) ; iW *= 1.0 - iX * ( 0.1 * iA ) ; iV *= iW ; iV *= iV ; float iY = min ( - iA + 10.0 , 1.0 ) ; iz += max ( ( 2.0 * iF * iV ) * iY , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"define",name:"REFL_BUMP",b:["0.1"]},{type:"textline",b:"float jm ( in vec3 jf , in vec3 jg , in float jh , in float ji ) { vec3 jj = normalize ( jg + jf ) ; float jk = 1.0 - dot ( jf , jj ) ; float jl = ji + ( 1.0 - ji ) * pow ( jk , jh ) ; return jl ; } void jB ( inout vec3 jn , in vec3 jo , in vec3 jp , in float jq , in float jr , in float js ) { vec3 jt = reflect ( - jo , jp ) ; float ju = jm ( jo , jt , jq , jr ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 jv = u_refl_plane . xyz * dot ( jp , u_refl_plane . xyz ) ; vec3 jw = jp - jv ; vec2 jx = ( u_view_matrix_frag * vec4 ( jw , 0.0 ) ) . xy ; vec2 jy = cz . xy / cz . z ; jy += jx * REFL_BUMP ; vec3 jz = texture2D ( u_reflectmap , jy ) . rgb ; eh ( jz . rgb ) ; jn = mix ( jn , jz , js * ju ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"vec3 jA = textureCube ( u_mirrormap , jt ) . xyz ; eh ( jA . rgb ) ; jn = mix ( jn , jA , u_mirror_factor * ju ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]}}]}]};a["include/refraction.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float jH ( in float jC , inout vec2 jD , in vec2 jE ) { vec4 jF = texture2D ( u_scene_depth , jD ) ; float jG = cl ( jF ) ; if ( jG < je ) { jD = jE ; return jC ; } else { return jG ; } return jC ; } vec3 jP ( in vec3 jI , in vec2 jJ ) { vec2 jK = jI . xy / jI . z ; vec2 jL = jK + jJ ; vec4 jM = texture2DProj ( u_scene_depth , jI ) ; float jN = cl ( jM ) ; jH ( jN , jL , jK ) ; vec3 jO = texture2D ( u_refractmap , jL ) . rgb ; eh ( jO ) ; return jO ; }".split(" ")}]}}]}]};
a["include/particles.glslv"]={type:"group",a:[{type:"var",name:"EPSILON",b:["0.0001"]},{type:"textline",b:"struct kB { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void kI ( inout float kC , float kD , vec2 kE , vec2 kF ) { float kG = kF . x - kE . x ; float kH = ( kD - kE . x ) / kG ; kC = mix ( kC , kF . y , clamp ( kH , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"void kP ( inout vec3 kJ , float kK , vec4 kL , vec4 kM ) { float kN = kM . x - kL . x ; float kO = ( kK - kL . x ) / kN ; kJ = mix ( kJ , kM . yzw , clamp ( kO , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"float kW ( float kQ , float kR , vec2 kS [ SIZE_RAMP_LENGTH ] ) { float kT = kQ / kR ; float kU = kS [ 0 ] . y ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"kI ( kU , kT , kS [ 0 ] , kS [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"kI ( kU , kT , kS [ 1 ] , kS [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"kI ( kU , kT , kS [ 2 ] , kS [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int kV = 1 ; kV < SIZE_RAMP_LENGTH ; kV ++ ) kI ( kU , kT , kS [ kV - 1 ] , kS [ kV ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","kU",";","}"]}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 lc ( float kX , float kY , vec4 kZ [ COLOR_RAMP_LENGTH ] ) { float k_ = kX / kY ; vec3 la = kZ [ 0 ] . yzw ;".split(" ")},
{type:"condition",a:[{type:"if",c:["UNROLL_LOOPS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","1"],group:{type:"group",a:[{type:"textline",b:"kP ( la , k_ , kZ [ 0 ] , kZ [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","2"],group:{type:"group",a:[{type:"textline",b:"kP ( la , k_ , kZ [ 1 ] , kZ [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","3"],group:{type:"group",a:[{type:"textline",
b:"kP ( la , k_ , kZ [ 2 ] , kZ [ 3 ] ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"for ( int lb = 1 ; lb < COLOR_RAMP_LENGTH ; lb ++ ) kP ( la , k_ , kZ [ lb - 1 ] , kZ [ lb ] ) ;".split(" ")}]}}]},{type:"textline",b:["return","la",";","}"]}]}}]},{type:"textline",b:"float ll ( float ld , float le , float lf , float lg ) { float lh = max ( 0.01 , min ( le , lf ) ) ; float li = max ( 0.01 , min ( le , lg ) ) ; float lj = le - li ; float lk = clamp ( ld / lh , 0.0 , 1.0 ) - step ( lj , ld ) * ( ld - lj ) / li ; return lk ; } kB lr ( ) { kB lm ; float ln ; if ( u_p_cyclic == 1 ) { ln = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( ln < 0.0 ) ln += u_p_length ; } if ( u_p_cyclic != 1 ) { ln = u_p_time - a_p_delay ; } if ( ln < 0.0 || ln >= a_p_lifetime ) { lm . a = 0.0001 ; lm . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( ln < 0.0 || ln >= a_p_lifetime ) ) { vec3 lo = a_position ; vec3 lp = a_normal ; lo += u_p_nfactor * ln * lp ; lo += a_p_vels . xyz * ln ; lo . y -= u_p_gravity * ln * ln / 2.0 ; float lq = max ( u_p_mass , EPSILON ) ; lo += ( u_p_wind / lq ) * ln * ln / 2.0 ; lm . b = lo ; lm . e = a_p_vels . w * ln ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SIZE_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"lm . a = kW ( ln , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lm . a = 1.0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["COLOR_RAMP_LENGTH",">","0"],group:{type:"group",a:[{type:"textline",b:"lm . d = lc ( ln , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"lm . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"lm . c = ll ( ln , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return lm ; }".split(" ")}]};a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float lE ( in sampler2D lx , in vec2 ly , in vec2 lz ) { float lA = texture2D ( lx , ly ) . r ; float lB = lz . x ; float lC = lz . y ; float lD = 2.0 * lB / ( lB + lC - ( 2.0 * lA - 1.0 ) * ( lC - lB ) ) ; return lD ; }".split(" ")}]}};b4w.module.__geometry=function(a,p){function b(a){return a.w>Q?A.on()?!1:!0:!1}function d(a){return 0<a.W.length?!0:!1}function h(a,b,d){d||q.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.w*(b||1)+", will use drawArrays","color: #aa0");b=a.W;d=a.w;var e=a.u,f=a.r,h;for(h in e){var r=e[h],m=g(r,d);e[h]=c(b,r,m)}for(e=0;e<f.length;e++){var k=f[e];for(h in k)r=k[h],m=g(r,d),k[h]=c(b,r,m)}a.w=b.length;a.W=new Uint16Array(0);return a}function c(a,b,c){if(0==b.length)return new Float32Array(0);
for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var f=a[e],h=0;h<c;h++)d[c*e+h]=b[c*f+h];return d}function k(a,b){var c=a.Jc,d=a.Gb[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function l(b,c){var d,e;switch(c){case a.wg:case a.Lh:d=J.TRIANGLES;e=J.STATIC_DRAW;break;case a.Fl:d=J.POINTS;e=J.STATIC_DRAW;break;case a.Dl:d=J.TRIANGLES;e=J.DYNAMIC_DRAW;break;case a.Sp:d=J.POINTS;e=J.DYNAMIC_DRAW;break;case a.El:d=J.LINES;e=J.STATIC_DRAW;
break;default:throw"Wrong draw_mode";}b.mode=d;b.Fh=e}function e(a){a.Dd?(a.ad||(a.ad=J.createBuffer()),J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,a.ad),J.bufferData(J.ELEMENT_ARRAY_BUFFER,a.Dd,a.Fh),a.ji=a.Dd.byteLength):a.ji=0;a.df||(a.df=J.createBuffer());J.bindBuffer(J.ARRAY_BUFFER,a.df);J.bufferData(J.ARRAY_BUFFER,a.Jc,a.Fh);a.Rm=a.Jc.byteLength}function f(a){for(var b=I.ab("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].W.length;b.W=new Uint32Array(c);for(d=c=0;d<a.length;d++)c+=a[d].w;
b.w=c;var e=a[0],f;for(f in e.u){for(d=c=0;d<a.length;d++)c+=a[d].u[f].length;b.u[f]=new Float32Array(c)}for(f in e.r[0]){for(d=c=0;d<a.length;d++)c+=a[d].r[0][f].length;for(d=0;d<e.r.length;d++)b.r[d]=b.r[d]||{},b.r[d][f]=new Float32Array(c)}for(e=d=c=0;e<a.length;e++){f=a[e];for(var h=f.W,r=f.w,q=f.u,m=0;m<h.length;m++)b.W[c+m]=h[m]+d;var c=c+h.length,k;for(k in q){var h=q[k],l=d*g(h,r);b.u[k].set(h,l)}for(m=0;m<f.r.length;m++){var q=f.r[m],L=b.r[m];for(k in q)h=q[k],l=d*g(h,r),L[k].set(h,l)}d+=
r}return b}function w(a,b,c,d,e,f){var r=I.ab("SUBMESH_"+a.name+"_"+b);b=a.submeshes[b];var g=b.base_length;r.w=g;var k=n(c,"a_texcoord")?new Float32Array(b.texcoord):new Float32Array(0),l,t=b.group;if(n(c,"a_influence")&&d){l=new Float32Array(g*H);for(var s=t.length/g,L=new Float32Array(s),v=0;v<s;v++){L[v]=-1;for(var M in d){var w=d[M];if(w.Hp===v){L[v]=w.ki;break}}}var y=3<s?s:4;d=new Float32Array(y);M=new Uint32Array(y);for(var v=new Float32Array(H),w=new Float32Array(y),y=new Uint32Array(y),
ca=new Float32Array(H),A=0;A<g;A++)d.set(w),M.set(y),v.set(ca),l.set(m(t,s,A,g,L,d,M,v),A*H)}else l=new Float32Array(0);t=e?I.ua(e):{};t.a_color={Ae:!0};t.a_color.src=n(c,"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,Yb:7}]:[];e={a_texcoord:k,a_influence:l};k=b.vertex_colors;l=b.color;s=a.name;L=[];for(d=0;d<k.length;d++)L.push(k[d].name);for(var X in t)if(d=t[X].src,d.length){for(v=M=0;v<d.length;v++)M+=I.We(d[v].Yb);e[X]=new Float32Array(M*g);for(v=w=0;v<d.length;v++){var G=d[v].name,
y=d[v].Yb,ca=I.So(y),u=L.indexOf(G);if(-1==u)throw'B4W Error: vertex color "'+G+'" for mesh "'+s+'" not found.';var A=k[u].mask,B=I.We(A);(y&A)!==y&&q.error("B4W Error: Wrong color extraction from "+G+" to "+X+".");for(var aa=G=0;aa<u;aa++)G+=I.We(k[aa].mask);u=G*g;for(G=0;G<g;G++)for(aa=0;aa<K;aa++)ca[aa]&&(e[X][G*M+(w+I.sh(y,aa))]=l[u+G*B+I.sh(A,aa)]);w+=B}}else e[X]=new Float32Array(0);X=a.uv_textures;t=b.texcoord;k=b.texcoord2;a=a.name;if(f)for(var J in f){l=X.indexOf(J);if(-1==l)throw'B4W Error: uv map "'+
J+'" for mesh "'+a+'" not found';if(0==l)var p=new Float32Array(t);else 1==l&&(p=new Float32Array(k));e[f[J]]=p}r.u=e;r.W=new Uint32Array(b.indices);J=b.position.length/g/z;a=(p=n(c,"a_normal")&&b.normal.length?!0:!1)&&n(c,"a_tangent")&&b.tangent.length?!0:!1;for(X=0;X<J;X++)f={},e=new Float32Array(g*z),t=new Float32Array(p?g*O:0),k=new Float32Array(a?g*F:0),l=X*g*z,s=l+g*z,e.set(b.position.subarray(l,s),0),p&&(l=X*g*O,s=l+g*O,t.set(b.normal.subarray(l,s),0)),a&&(l=X*g*F,s=l+g*F,k.set(b.tangent.subarray(l,
s),0)),f.a_position=e,f.a_normal=t,f.a_tangent=k,r.r.push(f);if(1<J){b=r.r[0];f={};for(var Q in b)f[Q]=new Float32Array(b[Q]);r.r.push(f)}n(c,"a_polyindex")&&(h(r,1,!0),r.u.a_polyindex=x(r));return r}function n(a,b){return-1<a.indexOf(b)?!0:!1}function m(a,b,c,d,e,f,h,r){for(var g=!0,q=0;q<b;q++){var m=a[q*d+c];if(-1!==m){var k=e[q];-1!==k&&(f[q]=m,h[q]=k,g=!1)}}if(g)return r;s(f,h,!1);for(q=a=0;q<H;q++)a+=f[q];if(0.01>a)return r;for(q=0;q<H;q++)f[q]/=a;if(0.01>Math.abs(f[0]-1))r[0]=h[0]+1;else for(q=
0;q<H;q++)r[q]=h[q]+f[q];return r}function g(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+c+", base length="+b;return d}function s(a,b,c){var d=a.length,e=d,f=!1;for(c=c?-1:1;1<e||f;){1<e&&(e=Math.floor(e/u));for(var f=!1,h=0;e+h<d;h++)0>c*(a[h]-a[h+e])&&(f=a[h],a[h]=a[h+e],a[h+e]=f,f=b[h],b[h]=b[h+e],b[h+e]=f,f=!0)}}function t(a,b,c){var d=[],e=[];G.subtract(b,a,d);G.subtract(c,a,e);G.normalize(d,d);G.normalize(e,
e);return Math.acos(G.dot(d,e))}function y(a,b,c){b||(b=[]);c=c?a.r[0].a_normal:a.r[0].a_position;if(d(a)){a=a.W;for(var e=a.length/3,f=0;f<e;f++){var h=new Float32Array(9),r=a[3*f];h[0]=c[3*r];h[1]=c[3*r+1];h[2]=c[3*r+2];r=a[3*f+1];h[3]=c[3*r];h[4]=c[3*r+1];h[5]=c[3*r+2];r=a[3*f+2];h[6]=c[3*r];h[7]=c[3*r+1];h[8]=c[3*r+2];b[f]=h}}else for(f=0;f<c.length;f++)h=new Float32Array(9),h[0]=c[9*f],h[1]=c[9*f+1],h[2]=c[9*f+2],h[3]=c[9*f+3],h[4]=c[9*f+4],h[5]=c[9*f+5],h[6]=c[9*f+6],h[7]=c[9*f+7],h[8]=c[9*
f+8],b[f]=h;return b}function x(a){for(var b=new Float32Array(a.w),c=0;c<a.w;c++)b[c]=c%3;return b}var q=p("__print"),r=p("__tsr"),I=p("__util"),A=p("__extensions"),G=p("vec3"),Q=65536,u=1.247330950103979,z=3,O=3,F=4,K=3,H=4;a.pd=10;a.Ol=20;a.Fx=30;a.Lh=10;a.Fl=20;a.Dl=30;a.Sp=40;a.El=50;a.wg=a.Lh;var J=null;a.kc=function(a){J=a};a.dy=function(a){var b=_buffers[a];J.deleteBuffer(b.ad);J.deleteBuffer(b.df);delete _buffers[a]};a.Aw=function(c,f,r,q){b(c)&&d(c)&&h(c);var m=c.W,k=c.w,t=c.r,s={},w;for(w in c.u)w in
q&&!q[w].Ae||(s[w]=c.u[w]);q={Dd:null,Jc:null,rk:0,count:0,Gb:{},mode:0,Fh:0,ji:0,Rm:0,df:null,ad:null,Bi:null};if(m.length)if(w=m.length,k<=Q)var n=new Uint16Array(m),z=J.UNSIGNED_SHORT;else n=new Uint32Array(m),z=J.UNSIGNED_INT;else w=k,n=null;var x=0,L=t.length,v;for(v in t[0])var M=t[0][v],x=x+M.length*L;for(v in s)M=s[v],x+=M.length;v=new Float32Array(x);var x=0,L={},y;for(y in s){var H=s[y];if(M=H.length)v.set(H,x),L[y]={Kx:y,Id:g(H,k),offset:x,frames:1,length:M},x+=M}s=t.length;for(y in t[0])if(H=
t[0][y],M=H.length,H=g(H,k),M){L[y]={Id:H,offset:x,frames:s,length:M};1<s&&(L[y+"_next"]={Id:H,offset:x+M,frames:s,length:M});for(var ca=0;ca<s;ca++)H=t[ca][y],v.set(H,x),x+=M}q.count=w;q.Dd=n;q.Jc=v;q.rk=z;q.Gb=L;l(q,r);e(q);f!=a.pd&&d(c)&&(q.Bi={Vu:new Float32Array(m.length),Wu:new Float32Array(m.length),gt:new Float32Array(m.length/3),type:f});return q};a.Eu=b;a.Du=d;a.pp=h;a.Ow=function(a,b,c){l(a,b);a.count=c.length;a.Dd=c;a.rk=c instanceof Uint16Array?J.UNSIGNED_SHORT:J.UNSIGNED_INT};a.nj=function(a,
b,c,d){var f=a.Jc,h=a.Gb,r=h[b];if(r){if(c&&r.Id!=c)throw'Error: invalid num_comp for "'+b+'"';f.set(d,r.offset)}else f=f.length,r=new Float32Array(f+d.length),r.set(a.Jc),r.set(d,f),a.Jc=r,h[b]={Id:c,offset:f};e(a)};a.pt=k;a.az=function(a){a.Fh=J.STATIC_DRAW};a.Pu=function(a){a.Fh=J.DYNAMIC_DRAW};a.Sw=e;a.ym=function(a){a.ad&&J.deleteBuffer(a.ad);a.df&&J.deleteBuffer(a.df)};a.Kn=function(a,b){return a.submeshes[b].base_length?!1:!0};a.op=function(a,b){for(var c=0;c<a.r.length;c++){var d=a.r[c].a_position;
r.og(d,b,d,0);d=a.r[c].a_normal;0<d.length&&r.lj(d,b,d,0);d=a.r[c].a_tangent;0<d.length&&r.wp(d,b,d,0)}(c=a.u.au_center_pos)&&c.length&&r.og(c,b,c,0);return a};a.yw=function(a,b){var c=a.u.au_center_pos;if(c&&c.length){var d=new Float32Array(c);r.og(d,b,d,0);for(var e=0;e<a.r.length;e++)for(var f=0;f<d.length;f++)a.r[e].a_position[f]+=d[f]-c[f];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';};a.xw=function(a,b){var c=a.w,d;for(d in b){var e=b[d].length;a.u[d]=new Float32Array(e*
c);for(var f=0;f<c;f++)for(var h=0;h<e;h++)a.u[d][f*e+h]=b[d][h]}};a.zw=f;a.Ou=function(a,b,c){if(!a.w)return I.ab("EMPTY");var d=c.length;a.w*d>Q&&!A.on()&&h(a,d);var e=a.W,f=a.w,q=a.u;a=a.r;for(var m in b){var k=b[m].length,l=k*f;q[m]=new Float32Array(l);for(var t=0;t<f;t++)for(l=0;l<k;l++)q[m][t*k+l]=b[m][l]}b=I.ab("CLONE_"+d+"_SUBMESHES");b.w=f*d;b.W=new Uint32Array(e.length*d);for(t=0;t<d;t++)for(k=e.length*t,m=f*t,l=0;l<e.length;l++)b.W[k+l]=e[l]+m;for(var s in q)for(e=q[s],l=e.length*d,k=g(e,
f),b.u[s]=new Float32Array(l),t=0;t<d;t++)m=f*k*t,b.u[s].set(e,m);for(s in a[0])for(t=0;t<a.length;t++)for(e=a[t][s],l=e.length*d,k=g(e,f),b.r[t]=b.r[t]||{},b.r[t][s]=new Float32Array(l),l=0;l<d;l++)switch(q=c[l],m=f*k*l,s){case "a_position":r.og(e,q,b.r[t][s],m);break;case "a_normal":r.lj(e,q,b.r[t][s],m);break;case "a_tangent":r.wp(e,q,b.r[t][s],m);break;default:throw"Wrong attribute name: "+s;}return b};a.Zm=w;a.qt=function(a){var b=a.w,c=a.r[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*
b);a=new Uint16Array(4*a.W.length);for(var f=0;f<b;f++)d[12*f]=c[3*f],d[12*f+1]=c[3*f+1],d[12*f+2]=c[3*f+2],d[12*f+3]=c[3*f],d[12*f+4]=c[3*f+1],d[12*f+5]=c[3*f+2],d[12*f+6]=c[3*f],d[12*f+7]=c[3*f+1],d[12*f+8]=c[3*f+2],d[12*f+9]=c[3*f],d[12*f+10]=c[3*f+1],d[12*f+11]=c[3*f+2],e[8*f]=-0.5,e[8*f+1]=-0.5,e[8*f+2]=-0.5,e[8*f+3]=0.5,e[8*f+4]=0.5,e[8*f+5]=0.5,e[8*f+6]=0.5,e[8*f+7]=-0.5,a[6*f]=4*f+2,a[6*f+1]=4*f+1,a[6*f+2]=4*f,a[6*f+3]=4*f+2,a[6*f+4]=4*f,a[6*f+5]=4*f+3;c=I.ab("HALO");c.r=[];c.r[0]={};c.w=
4*b;c.r[0].a_position=d;c.u.a_halo_bb_vertex=e;c.W=a;return c};a.nu=n;a.st=function(a){for(var b=["a_position","a_normal"],c=[],d=0;d<a.submeshes.length;d++){var e=w(a,d,b,null,null,null);e.w&&c.push(e)}return 0==c.length?I.ab("EMPTY"):1==c.length?c[0]:f(c)};a.Nw=function(a,b,c){for(var d=a.Dd,e=k(a,"a_position"),f=a.Bi,h=f.Vu,r=f.Wu,f=f.gt,g=d,q=g.length/3,m=0;m<q;m++){var l=g[3*m],L=g[3*m+1],v=g[3*m+2],t=e[3*l+1],s=e[3*l+2],w=e[3*L+1],n=e[3*L+2],z=e[3*v+1],x=e[3*v+2];h[3*m]=(e[3*l]+e[3*L]+e[3*v])/
3;h[3*m+1]=(t+w+z)/3;h[3*m+2]=(s+n+x)/3}I.ih(h,b,r);b=h.length/3;for(e=0;e<b;e++)r=h[3*e]-c[0],g=h[3*e+1]-c[1],q=h[3*e+2]-c[2],f[e]=r*r+g*g+q*q;c=d;d=f.length;if(!(2>d))for(h=d,e=!1;1<h||e;)for(1<h&&(h=Math.floor(h/u)),e=!1,b=0;h+b<d;b++)0>f[b]-f[b+h]&&(e=f[b],f[b]=f[b+h],f[b+h]=e,e=c,r=b,g=b+h,q=e[3*r],m=e[3*r+1],l=e[3*r+2],e[3*r]=e[3*g],e[3*r+1]=e[3*g+1],e[3*r+2]=e[3*g+2],e[3*g]=q,e[3*g+1]=m,e[3*g+2]=l,e=!0);d=c;J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,a.ad);J.bufferData(J.ELEMENT_ARRAY_BUFFER,d,J.DYNAMIC_DRAW)};
a.iw=s;a.lm=function(a,b,c){for(var d=b.length/z,e=a.length/3,f=[],h=Array(3),r=Array(3),g=Array(3),q=0;q<e;q++){for(var m=a[3*q],k=a[3*q+1],L=a[3*q+2],v=0;v<z;v++)h[v]=b[z*m+v],r[v]=b[z*k+v],g[v]=b[z*L+v];if(c)var v=t(h,r,g),l=t(r,g,h),s=Math.PI-v-l;else s=l=v=1;var w=f,n;n=h;var x=g,y=[],H=[],A=[];G.subtract(r,n,y);G.subtract(x,n,H);G.cross(y,H,A);G.normalize(A,A);n=A;for(x=0;x<O;x++)y=O*k+x,H=O*L+x,w[O*m+x]=v*n[x],w[y]=l*n[x],w[H]=s*n[x]}if(c)for(var B in c)for(q=c[B],a=0;a<O;a++){b=O*q[0]+a;for(e=
1;e<q.length;e++)h=O*q[e]+a,f[b]+=f[h];for(e=1;e<q.length;e++)h=O*q[e]+a,f[h]=f[b]}for(q=0;q<d;q++){c=q;B=f;a=new Float32Array(O);for(b=0;b<O;b++)e=O*c+b,a[b]=B[e];G.normalize(a,a);for(b=0;b<O;b++)e=O*c+b,B[e]=a[b]}return f};a.nm=function(a,b,c){for(var d={},e=b.length/3,f=0;f<e;f++){var h=String(b[3*f])+String(b[3*f+1])+String(b[3*f+2]);d[h]=[]}e=a.length;for(f=0;f<e;f++)b=a[f],h=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),h in d&&d[h].push(b);return d};a.kk=function(a,b,c,d){var e=y(a,null,
!1);if(c)var f=y(a,null,!0);var h=e.length,r=new Float32Array(h);for(a=0;a<h;a++){var g=e[a],q=r,m=a,k=g,L=new Float32Array([k[0],k[1],k[2]]),g=new Float32Array([k[3],k[4],k[5]]),v=new Float32Array([k[6],k[7],k[8]]),k=G.dist(L,g),L=G.dist(L,v),g=G.dist(g,v),v=(k+L+g)/2;q[m]=Math.sqrt(v*(v-k)*(v-L)*(v-g))}q=new Float32Array(h);q[0]=r[0];for(a=1;a<h;a++)q[a]=q[a-1]+r[a];h=q[r.length-1];r=[];for(a=0;a<b;a++){var m=h*I.$b(d),m=I.Uh(q,m,0,q.length-1),g=c?f[m]:e[m],m=r,k=a,l=g,t=d,g=void 0,g=new Float32Array(3),
L=l[0],s=l[1],w=l[2],v=l[3],n=l[4],z=l[5],x=l[6],H=l[7],B=l[8],l=I.$b(t),t=I.$b(t);1<l+t&&(l=1-l,t=1-t);var aa=1-l-t,s=aa*s+l*n+t*H,w=aa*w+l*z+t*B;g[0]=aa*L+l*v+t*x;g[1]=s;g[2]=w;m[k]=g}return r};a.iy=y;a.rt=x;a.Iv=function(a,b,c){a=a.r[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]}};b4w.module.__objects=function(a,p){function b(a){a={type:a,Tc:0,scale:0,mu:[0,0],e:new Float32Array(3),g:new Float32Array(4),Ic:new Float32Array(8),G:new Float32Array(16),Qn:new Float32Array(16),ob:new Float32Array(3),Da:0,jj:0,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,ve:null,zp:!1,ue:0,mi:0,pg:!1,Xb:null,hb:null,R:null,wi:null,Ng:0,Ig:0,fk:0,cd:0,Zg:0,Le:0,Io:"",qj:!1,Kb:!1,gb:!1,Lb:!1,Pb:!1,Jb:!1,ac:!1,oe:!1,Kc:!1,li:!1,Vc:!1,pa:!1,rf:!1,Sg:!1,Hi:!1,jd:!1,Si:!1,tk:!1,is_visible:!1,Kh:0,
Lc:0,$d:0,yd:0,xd:0,ud:0,dd:"",lb:null,Th:!1,Ai:"",zf:!1,Cn:!1,Lg:0,time:0,tl:0,Fp:0,max_bones:0,Mg:!1,Gh:!1,Ie:!1,nh:null,mh:null,Bh:null,Ah:null,gc:null,vb:null,Jj:null,Hj:null,Ij:null,Ha:null,hc:null,Xa:null,me:null,ne:null,scale:1,cd:1E4};y.identity(a.g);s.identity(a.Ic);q.identity(a.G);q.identity(a.Qn);return a}var d=p("__animation"),h=p("__batch"),c=p("__boundings"),k=p("__camera"),l=p("__config"),e=p("__constraints"),f=p("__curve"),w=p("__lights"),n=p("__particles");p("__print");var m=p("__scenes"),
g=p("__transform"),s=p("__tsr"),t=p("__util"),y=p("quat"),x=p("vec3"),q=p("mat4"),r=l.q,I=0,A=new Float32Array(4);a.hi=b;a.rl=function(a){var l;l=a.parent;if(!(l=l&&l.dr)&&!(l="ARMATURE"===a.type)&&!(l="CAMERA"===a.type)&&(l="MESH"===a.type)){var y=a.b4w_do_not_batch,z=a.b4w_dynamic_geometry,p=a.b4w_collision,F=a.b4w_vehicle,K=a.b4w_floating;l=a.b4w_character;var H=n.pu(a),J;if(!(J=d.sk(a))){if(!y){if(!z){if(!p){if(!F){if(!K){a:{K=a.data;for(F=0;F<K.materials.length;F++)if("LENS_FLARES"===K.materials[F].name){K=
!0;break a}K=!1}K=K||H||l}F=K}p=F}z=p}y=z}J=y}l=J}l=l?!0:!1;a.dr=l;a.d=b("MESH"===a.type?l?"DYNAMIC":"STATIC":a.type);a.Qa=null;a.qd=[];a.sb||(a.sb=null);l=a.d;K=a.location;H=a.scale[0];t.nv(a.rotation_quaternion,A);g.set_translation(a,K);g.set_rotation(a,A);g.set_scale(a,H);switch(a.type){case "ARMATURE":K=a.pose.bones;for(H=0;H<K.length;H++){F=K[H];p=F.bone;z=new Float32Array(p.matrix_local);y=new Float32Array(16);q.invert(z,y);J=new Float32Array(F.matrix_basis);var P=new Float32Array(3);x.subtract(p.tail_local,
p.head_local,P);t.bx(P,y,P);F.hr=P;F.ar=[F].concat(F.parent_recursive);F.Tl=s.en(z,s.create());F.Sl=s.en(J,s.create());F.xj=s.create();F.Qh=!1}H=d.Or(a);l.gc=H;H=d.mm(a,H);l.nh=H.yb;l.mh=H.yb;l.Bh=H.e;l.Ah=H.e;l.Lg=0;break;case "MESH":l.jd=r.all_objs_selectable||a.b4w_selectable;l.Si=a.b4w_selectable;l.wi={hu:a.b4w_glow_settings.glow_duration,ju:a.b4w_glow_settings.glow_period,ku:a.b4w_glow_settings.glow_relapses};l.jd&&(a.Pl=t.Bt(I),I++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;H=a.d;
if(p=d.get_first_armature_object(a))if(K=a.data,K.vertex_groups.length){H.Ie=!0;K=K.vertex_groups;F=p.data.bones;p=p.pose.bones;z=0;y={};for(J=0;J<F.length;J++){var P=F[J].name,N=t.keysearch("name",P,K);if(N){var E=t.ok(p,"name",P);y[P]={Mr:J,ki:z++,Rk:E,Hp:N.index}}}H.gc=y;H.max_bones=z}else H.Ie=!1;else H.Ie=!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.Gh=a.data.b4w_vertex_anim.length?!0:!1;if(K=d.get_first_armature_object(a))H=a.d.gc,H=d.mm(K,H),l.nh=H.yb,l.mh=H.yb,l.Bh=H.e,l.Ah=
H.e,l.Lg=0;a.O=[];l.Kb=a.b4w_shadow_cast;l.gb=a.b4w_shadow_receive;l.Lb=a.b4w_shadow_cast_only&&l.Kb;l.Pb=a.b4w_reflexible;l.Jb=a.b4w_reflexible_only&&l.Pb;l.ac=a.b4w_reflective;l.oe=a.b4w_caustics;l.Kc=a.b4w_wind_bending;l.Kh=a.b4w_wind_bending_angle;H=h.ix(a.b4w_wind_bending_angle,h.Gr(a.data.b4w_bounding_box),a.scale[0]);l.Lc=H;l.$d=a.b4w_wind_bending_freq;l.yd=a.b4w_detail_bending_freq;l.xd=a.b4w_detail_bending_amp;l.ud=a.b4w_branch_bending_amp;l.Sg=!1;l.dd=a.b4w_main_bend_stiffness_col;H=a.b4w_detail_bend_colors;
l.lb={};l.lb.$n=H.leaves_stiffness_col;l.lb.Zn=H.leaves_phase_col;l.lb.no=H.overall_stiffness_col;l.rf=a.b4w_do_not_cull;l.li=a.b4w_disable_fogging;l.Vc=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";H=a.data.materials[0];l.Ng=H.physics.friction;l.Ig=H.physics.elasticity;l.Zg=0;l.cd=1E4;l.Le=a.b4w_lod_transition;l.Hi=!0;break;case "CAMERA":k.Ur(a);k.Er(a);break;case "LAMP":w.Iu(a);break;case "CURVE":if(H=f.Os(a))a.gr=H;break;case "EMPTY":l.vb=c.nc(),H=c.tj(),l.hc=H}a.parent&&"OBJECT"==
a.parent_type&&"ARMATURE"!=a.parent.type?(K=l.e,F=l.g,H=l.scale,e.$l(a,a.parent,K,F,H)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?(K=l.e,F=l.g,e.Zl(a,a.parent,a.parent_bone,K,F)):a.sb&&a.sb.b4w_group_relative?(H=s.qf(l.e,l.scale,l.g),e.lr(a,a.sb,H)):a.sb&&!a.sb.b4w_group_relative&&(g.D(a),F=l.G,q.multiply(a.sb.d.G,F,F),K=t.Me(F),H=t.Ji(F),F=t.matrix_to_quat(F),g.set_translation(a,K),g.set_rotation(a,F),g.set_scale(a,H));a.field&&(l.fk=a.field.strength,m.Bp(a));if(H=a.dupli_group)for(K=
H.objects,H=0;H<K.length;H++)K[H].sb=a;l.qj=a.game.use_collision_compound;l.Io=a.game.physics_type;g.D(a)};a.Uw=function(a){for(var b=[],c=0;c<a.length;c++){var e=a[c];!e.d||"DYNAMIC"!=e.d.type&&"CAMERA"!=e.d.type||g.D(e);e.b4w_use_default_animation&&d.sk(e)&&(d.apply_def(e),d.play(e,null,d.SLOT_ALL),"ARMATURE"==e.type&&b.push(e))}if(b.length)for(c=0;c<a.length;c++)if(e=a[c],t.Nb(e))for(var f=0;f<b.length;f++){var h=b[f];if(d.get_first_armature_object(e)==h){var r=d.jn(h,d.SLOT_0);r&&(r=d.apply_to_first_empty_slot(e,
r),d.set_behavior(e,h.b4w_cyclic_animation?d.AB_CYCLIC:d.AB_FINISH_RESET,r),d.play(e,null,r))}}};a.cleanup=function(){I=0}};b4w.module.__particles=function(a,p){function b(){throw"_rand() undefined";}function d(a,b,c,d,e,h,l){var k=a.F.Zj,w=a.F.xc,n=a.F.time;a=a.F.Lo;for(var u=b?4:1,z=0;z<k.length;z+=u){var p=k[z];if(p>a&&p<=n)for(p=0;8>p;p++)w[8*z+p]=e[p];for(p=0;8>p;p++)m[p]=w[8*z+p];p=g;p[0]=c[3*z];p[1]=c[3*z+1];p[2]=c[3*z+2];f.Dh(p,m,p);h[3*z]=p[0];h[3*z+1]=p[1];h[3*z+2]=p[2];var F=g;F[0]=d[3*z];F[1]=d[3*z+1];F[2]=d[3*z+2];f.kj(F,m,F);l[3*z]=F[0];l[3*z+1]=F[1];l[3*z+2]=F[2];if(b)for(p=1;4>p;p++)h[3*(z+p)]=h[3*z],h[3*
(z+p)+1]=h[3*z+1],h[3*(z+p)+2]=h[3*z+2],l[3*(z+p)]=F[0],l[3*(z+p)+1]=F[1],l[3*(z+p)+2]=F[2]}}function h(a){a?(e.tw(a),b=function(){return e.qv()}):b=function(){return Math.random()}}var c=p("__config"),k=p("__geometry"),l=p("__scenes"),e=p("__util"),f=p("__tsr"),w=p("vec3"),n=c.ie,m=new Float32Array(8),g=new Float32Array(3);a.$c=function(a){return 0<a.particle_systems.length?!0:!1};a.Ee=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;
return!1};a.Fy=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==a.particle_systems[b].settings.type)return!0;return!1};a.pu=function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.Gt=function(a,c,g,l){g.F=g.F||{};var q=k.st(c),r=g.settings.count,m=g.settings.frame_start/n.mb,A=g.settings.frame_end/n.mb,p=g.settings.lifetime/n.mb,Q=g.settings.lifetime_random,u=g.settings.emit_from,z=
g.settings.factor_random,O=g.settings.angular_velocity_mode,F=g.settings.angular_velocity_factor,K=g.settings.b4w_randomize_emission;h(g.seed);var H=g.F.ax="WORLD"==g.settings.b4w_coordinate_system?!0:!1;g.F.frame=0;if(c=!a.De){var J;J=[];for(var P=0;P<r;P++)J.push(-0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,-0.5);J=new Float32Array(J);for(var P=[],N=0;N<r;N++)P.push(4*N,4*N+2,4*N+1,4*N,4*N+3,4*N+2);P=new Uint16Array(P)}switch(u){case "VERT":for(var N=q.r[0].a_position,q=q.r[0].a_normal,E=N.length/3,u=[],S=0;S<
r;S++){var da=Math.round((E-1)*b());u.push(da);c&&(u.push(da),u.push(da),u.push(da))}E=[];for(S=0;S<u.length;S++)E.push(N[3*u[S]]),E.push(N[3*u[S]+1]),E.push(N[3*u[S]+2]);N=new Float32Array(E);E=[];for(S=0;S<u.length;S++)E.push(q[3*u[S]]),E.push(q[3*u[S]+1]),E.push(q[3*u[S]+2]);u=new Float32Array(E);break;case "FACE":N=[];u=[];S=[];e.Ci(0,S);E=k.kk(q,r,!1,S);e.Ci(0,S);q=k.kk(q,r,!0,S);for(S=0;S<E.length;S++)N.push(E[S][0],E[S][1],E[S][2]),c&&(N.push(E[S][0],E[S][1],E[S][2]),N.push(E[S][0],E[S][1],
E[S][2]),N.push(E[S][0],E[S][1],E[S][2])),u.push(q[S][0],q[S][1],q[S][2]),c&&(u.push(q[S][0],q[S][1],q[S][2]),u.push(q[S][0],q[S][1],q[S][2]),u.push(q[S][0],q[S][1],q[S][2]));N=new Float32Array(N);u=new Float32Array(u);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}u=[N,u];q=u[0];u=u[1];g.F.hv=new Float32Array(q);g.F.cv=new Float32Array(u);g.F.iv=new Float32Array(q.length);g.F.dv=new Float32Array(u.length);g.F.time=0;g.F.Lo=-1;N=[];
A=(A-m)/r;for(E=0;E<r;E++)S=K?A*E+10*A*(0.5-b()):A*E,S+=m,N.push(S),c&&(N.push(S),N.push(S),N.push(S));m=new Float32Array(N);g.F.Zj=new Float32Array(m);g.F.Sm=new Float32Array(m);g.F.xc=new Float32Array(8*m.length);for(K=0;K<8*m.length;K++)for(A=0;8>A;A++)g.F.xc[8*K+A]=l[A];H?d(g,c,q,u,l,q,u):(f.og(q,l,q,0),f.lj(u,l,u,0));g=[];l=p*Q;for(Q=0;Q<r;Q++)H=l*b(),g.push(p-H),c&&(g.push(p-H),g.push(p-H),g.push(p-H));p=new Float32Array(g);g=[];for(l=0;l<r;l++){Q=[b()-0.5,b()-0.5,b()-0.5];w.normalize(Q,Q);
g.push(z*Q[0]);g.push(z*Q[1]);g.push(z*Q[2]);switch(O){case "NONE":g.push(0);break;case "SPIN":case "VELOCITY":g.push(F);break;case "RAND":g.push(2*F*(b()-0.5));break;default:throw"Undefined velocity factor";}if(c)for(Q=g.slice(-4),H=0;12>H;H++)g.push(Q[H%4])}r=new Float32Array(g);z=e.ab("EMITTER_PARTICLES");O=e.Sc();O.a_position=q;O.a_normal=u;z.r[0]=O;c?z.W=P:(a.wc=k.Fl,z.W=new Uint16Array(0));z.w=q.length/3;z.u.a_p_delay=m;z.u.a_p_lifetime=p;z.u.a_p_vels=r;c&&(z.u.a_p_bb_vertex=J);return z};a.Rw=
function(a){for(var b=a.O,c=0;c<b.length;c++){var e=b[c],h=b[c].Bc;if(h){var g=e.Ya,l=h.F.iv,m=h.F.dv,w=h.F.hv,n=h.F.cv;h.F.ax?d(h,!e.De,w,n,a.d.Ic,l,m):(e=n,h=a.d.Ic,n=m,f.og(w,h,l,0),f.lj(e,h,n,0));k.Pu(g);k.nj(g,"a_position",3,l);k.nj(g,"a_normal",3,m)}}};a.Qv=function(a,b,c){var d=b.settings.lifetime/n.mb,e=b.settings.normal_factor,f=9.81*b.settings.effector_weights.gravity,h=b.settings.effector_weights.wind,g=b.settings.mass,m=b.settings.b4w_fade_in/n.mb,k=b.settings.b4w_fade_out/n.mb,w=b.settings.b4w_cyclic;
a.xo=b.settings.frame_end/n.mb-b.settings.frame_start/n.mb;a.so=w?1:0;a.Mk=e;a.wo=f;e=l.gu();a.Ti[0]=e[0]*h;a.Ti[1]=e[1]*h;a.Ti[2]=e[2]*h;a.zo=d;a.yo=g;a.uo=m;a.vo=k;a.De?(d=c.halo.size,h=c.halo.hardness,30>h?(h=0.5,g=0.9):40>h?(h=0.1,g=1):50>h?(h=0,g=0.8):(h=0,g=0.5)):(d=b.settings.particle_size,g=h=1);a.Nk=d;a.po=h;a.oo=g;d=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];if(d[0]&&d[0].use_map_size&&d[0].texture&&"BLEND"==d[0].texture.type&&d[0].texture.use_color_ramp){d=d[0].texture.color_ramp.elements;
h=Math.min(2*d.length,b.length);for(g=0;g<h;g+=2)m=d[g/2],b[g]=m.position,b[g+1]=(m.color[0]+m.color[1]+m.color[2])/3;a.Bo=d.length}a.Ao.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){d=b[0].texture.color_ramp.elements;h=Math.min(4*d.length,c.length);for(g=0;g<h;g+=4)m=d[g/4],c[g]=m.position,c[g+1]=m.color[0],c[g+2]=m.color[1],c[g+3]=m.color[2];a.ro=d.length}a.qo.set(c)};
a.Wv=function(a,b){a.F.Lo=a.F.time;a.F.time=b};a.jv=function(a){for(var b=a.w,c=a.r[0].a_position,d=a.u.a_texcoord,e=[],f=[],h=0;h<b;h++)f.push(c[3*h]),f.push(c[3*h+1]),e.push(c[3*h+2]);e=new Float32Array(e);f=new Float32Array(f);a.u.a_lf_dist=e;a.u.a_lf_bb_vertex=f;a.u.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.O;for(var d=0;d<a.length;d++){var e=a[d],f=e.Bc;f&&f.name==b&&(e.Nk=c)}};a.set_normal_factor=function(a,b,c){a=a.O;for(var d=0;d<a.length;d++){var e=a[d],f=e.Bc;f&&f.name==b&&(e.Mk=
c)}};a.set_factor=function(a,b,c){a=a.O;for(var d=0;d<a.length;d++){var e=a[d],f=e.Bc;if(f&&f.name==b){var h=f.F.Zj;if(1==c)f=h;else if(0==c)for(var g=!e.De,l=g?4:1,f=f.F.Sm,m=0;m<f.length;m+=l)f[m]=1E4,g&&(f[m+1]=f[m],f[m+2]=f[m],f[m+3]=f[m]);else for(var w=1/c,f=f.F.Sm,l=(g=!e.De)?4:1,n=0,m=0;m<f.length;m+=l)m>=n?(f[m]=h[m],n+=w):f[m]=1E4,g&&(f[m+1]=f[m],f[m+2]=f[m],f[m+3]=f[m]);k.nj(e.Ya,"a_p_delay",1,f)}}};a.Yw=function(a,b,c){a=a.particle_systems;for(var d=0;d<a.length;d++){var e=a[d];if("EMITTER"==
e.settings.type)for(var f=e.F.Zj,d=0;d<8*f.length;d++)e.F.xc[8*d]=b[0],e.F.xc[8*d+1]=b[1],e.F.xc[8*d+2]=b[2],e.F.xc[8*d+3]=b[3],e.F.xc[8*d+4]=c[0],e.F.xc[8*d+5]=c[1],e.F.xc[8*d+6]=c[2],e.F.xc[8*d+7]=c[3]}}};b4w.module.__primitives=function(a,p){function b(a,b,c,d){for(var h=[],g=[],k=[],t=[],y=2*c/(a-1),x=2*d/(b-1),q=0;q<a;q++)for(var r=-c+q*y,p=0;p<b;p++)if(g.push(r,0,-d+p*x),k.push(0,1,0),t.push(q/(a-1),p/(b-1)),q&&p){var A=q*b+p,G=A-1,Q=(q-1)*b+p,u=Q-1;h.push(A,G,Q);h.push(G,u,Q)}a=l.Sc();a.a_position=new Float32Array(g);a.a_normal=new Float32Array(k);k=l.ab("GRID_PLANE");k.r[0]=a;k.u.a_texcoord=new Float32Array(t);k.W=new Uint32Array(h);k.w=g.length/3;return k}function d(a){var b=a.length;if(b%4)throw"Wrong array";
for(var d=[],h=[],m=0;m<b;m+=4){var g=a[m+1],k=a[m+2],t=a[m+3];c(a[m],h);c(g,h);c(k,h);c(t,h);d.push(m,m+1,m+2);d.push(m,m+2,m+3)}a=l.Sc();a.a_position=new Float32Array(h);b=l.ab("FROM_QUADS");b.r[0]=a;b.W=new Uint32Array(d);b.w=h.length/3;return b}function h(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function c(a,b){b.push(a[0],a[1],a[2])}var k=p("__geometry"),l=p("__util");a.Jt=function(){for(var a=l.ab("LINE"),b=[],c=0;2>c;c++)b.push(c);c=l.Sc();c.a_point=new Float32Array(b);a.r[0]=c;a.W=new Uint32Array(b);
a.w=2;return a};a.vy=function(a,c){var d=b(2,2,a,c);d.name="PLANE";return d};a.uy=b;a.Lt=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==t-1)||1==b%2&&(0==a||a==k-1)?!0:!1}var h=c/Math.pow(2,a-1),g=c=h,k=b+1,t=b+1;b=[];for(var h=[],y=[],x=0,q=0,r=-1,p=[],A=0;A<a;A++){for(var G=2*c/(k-1),Q=2*g/(t-1),u=[],z=[],O=0,F=0;F<k;F++){for(var K=-c+F*G,H=[],J=0;J<t;J++){var P=-g+J*Q;if(K>-x&&K<x&&P>-q&&P<q)H.push(-1),O++;else{for(var N=null,E=0;E<p.length;E+=3)if(K==p[E]&&P==p[E+1]){N=p[E+2];break}E=
null!==N?N:r+1;d(F,J)?(H.push(-2),O++):(null==N&&(0!=J&&J!=t-1&&0!=F&&F!=k-1||A==a-1?y.push(G):(y.push(2*G),u.push(K,P,E)),h.push(K,0,P),r++),H.push(E));if(F&&J)if(1==F)if(d(F-1,J)){if(1<J){var P=E-1,N=z[F-1][J+1],S=N-1;b.push(E,P,S)}else N=z[F-1][J+1],S=N-1;b.push(E,S,N)}else d(F,J)||(P=E-1,N=z[F-1][J],b.push(E,P,N));else if(F==k-1){if(!d(F,J))if(J==t-1)P=E-1,N=z[F-1][J-1],S=z[F-2][J],b.push(E,P,N),b.push(E,N,S);else{var P=E-1,N=z[F-1][J],S=N-1,da=N+1;b.push(E,P,S);b.push(E,S,N);b.push(E,N,da);2==
J&&(da=z[F-2][J-2],b.push(P,da,S))}}else 1==J?d(F,J-1)?(P=z[F-1][J],N=z[F-1][J-1],b.push(E,N,P)):(P=H[J-1],N=z[F-1][J],S=z[F-2][J-1],b.push(E,P,N),b.push(P,S,N)):J==t-1?d(F,J)||(P=H[J-1],N=z[F-1][J-1],S=z[F-2][J],b.push(E,P,N),b.push(E,N,S)):-1!=z[F-1][J]&&-1!=z[F-1][J-1]&&-1!=H[J-1]?(P=H[J-1],N=z[F-1][J],S=z[F-1][J-1],b.push(E,P,N),b.push(P,S,N),J==t-2&&d(F,J+1)&&(da=z[F-1][J+1],b.push(E,N,da))):J==t-2&&d(F,J+1)&&(N=z[F-1][J],da=z[F-1][J+1],b.push(E,N,da))}}z.push(H)}p=u;x=c;q=g;c*=2;g*=2}if(2E4>
x)for(K=-2E4,h.push(-2E4,-1,-2E4),h.push(-2E4,-1,2E4),h.push(-x,-1,-q),h.push(-x,-1,q),h.push(2E4,-1,-2E4),h.push(2E4,-1,2E4),h.push(x,-1,-q),h.push(x,-1,q),E=r+1,b.push(E+3,E+2,E+1,E+2,E+0,E+1,E+6,E+4,E+2,E+4,E+0,E+2,E+5,E+7,E+1,E+7,E+3,E+1,E+5,E+4,E+7,E+7,E+4,E+6),G=2*x/(k-1),F=0;8>F;F++)y.push(-G);a=l.Sc();a.a_position=new Float32Array(h);a.a_cascad_step=new Float32Array(y);c=l.ab("multigrid_plane");c.r[0]=a;c.W=new Uint32Array(b);c.w=h.length/3;return c};a.ty=function(a){var b=a.length;if(b%3)throw"Wrong array";
for(var d=[],h=[],m=0;m<b;m+=3){var g=a[m+1],k=a[m+2];c(a[m],h);c(g,h);c(k,h);d.push(m,m+1,m+2)}a=l.Sc();a.a_position=new Float32Array(h);b=l.ab("FROM_TRIANGLES");b.r[0]=a;b.W=new Uint32Array(d);b.w=h.length/3;return b};a.sy=d;a.Ht=function(a){a=l.cx(a);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=d(b);a.name="FRUSTUM";return a};a.It=function(){var a=l.ab("BILLBOARD"),
b=l.Sc();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.r[0]=b;a.W=new Uint32Array([0,2,1,1,2,3]);a.w=4;return a};a.va=function(){var a=l.ab("BILLBOARD"),b=l.Sc();b.a_bb_vertex=new Float32Array([-0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,-0.5]);a.r[0]=b;a.W=new Uint32Array([0,2,1,0,3,2]);a.w=4;return a};a.Et=function(){var a=l.ab("CUBEMAP_BOARD"),b=l.Sc();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.r[0]=b;a.W=new Uint32Array([0,2,1,0,3,2]);a.w=4;return a};a.hn=function(a,b){var d=l.ab("UV_SPHERE"),
n,m,g=[],s=[],t=[];for(m=0;8>=m;m++)for(n=0;16>=n;n++){var y=n/16,x=m/8;s.push(-a*Math.cos(2*y*Math.PI)*Math.sin(x*Math.PI)+b[0],a*Math.cos(x*Math.PI)+b[1],a*Math.sin(2*y*Math.PI)*Math.sin(x*Math.PI)+b[2])}for(m=y=0;8>m;m++)for(n=0;16>n;n++){var x=h(s,17*m+n+1),q=h(s,17*m+n),r=h(s,17*(m+1)+n),p=h(s,17*(m+1)+n+1);Math.abs(x[1])==a+b[1]?(c(x,g),c(r,g),c(p,g),t.push(y,y+1,y+2),y+=3):Math.abs(r[1])==a+b[1]?(c(x,g),c(q,g),c(r,g),t.push(y,y+1,y+2),y+=3):(c(x,g),c(q,g),c(r,g),c(p,g),t.push(y,y+1,y+2),t.push(y,
y+2,y+3),y+=4)}n={};n.a_position=g;s=k.nm(t,s,g);n.a_normal=k.lm(t,g,s);n.a_tangent=[];d.u.a_influence=[];d.u.a_color=[];d.u.a_texcoord=[];d.r[0]=n;d.W=t;d.w=g.length/3;return d}};b4w.module.__prerender=function(a,p){var b=p("__config"),d=p("__debug"),h=p("__geometry"),c=p("__util"),k=p("vec3"),l=b.q,e="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH GLOW_MASK WIREFRAME COLOR_PICKING".split(" ");a.Jo=function(a){if(-1<e.indexOf(a.type)){for(var b=!1,n=a.m,m=0;m<n.length;m++){var g=n[m],s=g,t=a,y=s.Ma,x=t.i;s.M=!0;y.is_visible=!1;if(y)if(y.Sg)s.M=!1;else{var q=x.Bd,r=y.Xa.U,p=y.cd,q=Math.sqrt((r[0]-q[0])*(r[0]-q[0])+(r[1]-q[1])*(r[1]-q[1])+(r[2]-q[2])*(r[2]-q[2])),r=y.Le*
y.Xa.Na;q>=y.Zg&&q<p+r?(y.is_visible=!0,"GLOW_MASK"!=t.type||Boolean(s.l.xf)?(x=x.hk,y.rf?y=!1:"STATIC"===y.type?(p=y.Xa,y=p.U,y=c.mw(y,x,p.Na)):(p=y.ne,y=p.U,y=c.mt(y,x,p.je,p.ke,p.le)),y?s.M=!1:"WIREFRAME"==t.type&&(s.M=s.l.wireframe_mode==d.Nl.WM_DEBUG_SPHERES?s.l.Yj:!s.l.Yj)):s.M=!1):s.M=!1}else s.M=!1;g.M&&(b=!0)}switch(a.type){case "WIREFRAME":break;default:a.M="MAIN_OPAQUE"===a.type||"DEPTH"===a.type||b?!0:!1}}if("MAIN_BLEND"==a.type&&(b=a.i.Bd,k.dist(b,a.Pp)>l.alpha_sort_threshold&&l.alpha_sort&&
a.m)){for(n=0;n<a.m.length;n++)g=a.m[n],s=g.l,m=g.Ma.G,s&&s.ma&&s.ae!=h.pd&&(s=s.Ya)&&g.M&&(g=s.Bi)&&g.type==h.Ol&&h.Nw(s,m,b);a.Pp.set(b)}}};b4w.module.__print=function(a){var p=!1,b=0,d=0;a.Zv=function(a){p=a};a.log=function(){p&&console.log.apply(console,arguments)};a.error=function(){b++;console.error.apply(console,arguments)};a.warn=function(){p&&(d++,console.warn.apply(console,arguments))};a.time=function(){p&&console.time.apply(console,arguments)};a.timeEnd=function(){p&&console.timeEnd.apply(console,arguments)};a.group=function(){p&&console.group.apply(console,arguments)};a.groupCollapsed=function(){p&&console.groupCollapsed.apply(console,
arguments)};a.groupEnd=function(){p&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.fu=function(){return d};a.Yt=function(){return b};a.clear_errors_warnings=function(){b=d=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,p){function b(a,b,d){t?f.warn("WARNING "+String(d)+" for "+String(a)+' "'+b.name+'" undefined, reexport '+(b.library?"library "+c(b):"main scene")):y=!0}function d(a,b,d){t?f.warn('B4W Warning: "'+String(d)+'" for '+String(a)+' "'+b.name+'" is deprecated, reexport '+(b.library?'library "'+c(b)+'"':"main scene.")):y=!0}function h(a){t?f.warn(a):y=!0}function c(a){return a.library.split("/").slice(-1)[0]}function k(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;
a.materials=null;a.submeshes=null;var e=w.Pc(a);a.materials=c;a.submeshes=d;e.name=b;e.materials=a.materials.slice(0);e.submeshes=[];for(c=0;c<d.length;c++){var f=w.bi(d[c]);e.submeshes.push(f)}return e}var l=p("__boundings"),e=p("__curve"),f=p("__print"),w=p("__util"),n=p("vec3"),m=p("vec4"),g=p("quat"),s=p("mat4"),t=!0,y=!1;a.$r=function(a){var e=a.worlds;if(0==e.length){t?f.warn("WARNING Datablock world is missing, reexport scene"):y=!0;var g={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,
0,0],light_settings:{use_environment_light:!1,environment_energy:1,environment_color:"PLAIN"},b4w_fog_color:[0.5,0.5,0.5],b4w_fog_density:0};e.push(g)}for(var e=a.worlds,l=0;l<e.length;l++){var g=e[l],m=g.b4w_ssao_settings;"dist_factor"in m||(b("world",g,"b4w_ssao_settings.dist_factor"),m.dist_factor=0,m.samples=16);"b4w_glow_color"in g||(g.b4w_glow_color=[1,1,1],b("object",g,"b4w_glow_color"));"b4w_glow_factor"in g||(g.b4w_glow_factor=1,b("object",g,"b4w_glow_factor"));"b4w_fog_density"in g||(b("world",
g,"b4w_fog_density"),g.b4w_fog_density=0);"b4w_sky_settings"in g&&"rayleigh_brightness"in g.b4w_sky_settings||(b("world",g,"rayleigh_brightness"),g.b4w_sky_settings={procedural_skydome:!1,use_as_enviroment_map:!1,color:[0.24,0.43,0.75],rayleigh_brightness:3.3,mie_brightness:0.1,spot_brightness:10,scatter_strength:0.2,rayleigh_strength:0.2,mie_strength:0.006,rayleigh_collection_power:0.5,mie_collection_power:0.5,mie_distribution:0.4});"b4w_bloom_settings"in g?("blur"in g.b4w_bloom_settings||(b("world",
g,"b4w_bloom_settings.blur"),g.b4w_bloom_settings.blur=4),"edge_lum"in g.b4w_bloom_settings||(b("world",g,"b4w_bloom_settings.edge_lum"),g.b4w_bloom_settings.edge_lum=1)):(b("world",g,"b4w_bloom_settings"),g.b4w_bloom_settings={key:0.2,blur:4});"b4w_motion_blur_settings"in g?("motion_blur_factor"in g.b4w_motion_blur_settings||(b("world",g,"b4w_motion_blur_settings.motion_blur_factor"),g.b4w_motion_blur_settings.motion_blur_factor=0.01),"motion_blur_decay_threshold"in g.b4w_motion_blur_settings||(b("world",
g,"b4w_motion_blur_settings.motion_blur_decay_threshold"),g.b4w_motion_blur_settings.motion_blur_decay_threshold=0.01)):(b("world",g,"b4w_motion_blur_settings"),g.b4w_motion_blur_settings={motion_blur_factor:0.01,motion_blur_decay_threshold:0.01});"b4w_color_correction_settings"in g||(b("world",g,"b4w_color_correction_settings"),g.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in g.b4w_god_rays_settings||(b("world",g,"b4w_god_rays_settings.steps_per_pass"),
g.b4w_god_rays_settings.steps_per_pass=10)}e=a.scenes;for(l=0;l<e.length;l++)g=e[l],"b4w_use_nla"in g||(g.b4w_use_nla=!1,b("scene",g,"b4w_use_nla")),"b4w_nla_cyclic"in g||(g.b4w_nla_cyclic=!1,b("scene",g,"b4w_nla_cyclic")),"b4w_detect_collisions"in g&&(d("scene",g,"b4w_detect_collisions"),delete g.b4w_detect_collisions),"audio_doppler_speed"in g||(g.audio_doppler_speed=343.3),"audio_doppler_factor"in g||(g.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in g||(g.b4w_dynamic_compressor_settings=
{threshold:-24,knee:30,ratio:12,attack:0.003,release:0.25},b("scene",g,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in g||(g.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in g||(g.b4w_enable_bloom=!1,b("scene",g,"b4w_enable_bloom")),"b4w_enable_motion_blur"in g||(g.b4w_enable_motion_blur=!1,b("scene",g,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in g||(g.b4w_enable_color_correction=!1,b("scene",g,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in g||
(g.b4w_enable_antialiasing=!0,b("scene",g,"b4w_enable_antialiasing"));e=a.meshes;for(l=0;l<e.length;l++)g=e[l],g.b4w_bounding_box||(b("mesh",g,"b4w_bounding_box"),g.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0}),g.uv_textures||(b("mesh",g,"uv_textures"),g.uv_textures=[]),g.b4w_bounding_sphere_center||(g.b4w_bounding_sphere_center=[0,0,0]),g.b4w_bounding_cylinder_center||(g.b4w_bounding_cylinder_center=[0,0,0]),g.b4w_bounding_ellipsoid_center||(g.b4w_bounding_ellipsoid_center=
[0,0,0]),g.b4w_bounding_ellipsoid_axes||(m=g.b4w_bounding_box,g.b4w_bounding_ellipsoid_axes=[(m.max_x-m.min_x)/2,(m.max_y-m.min_y)/2,(m.max_z-m.min_z)/2]);e=a.cameras;for(l=0;l<e.length;l++)g=e[l],g.type||(g.type="PERSP",b("camera",g,"type")),"b4w_eye_target_dist"in g&&(delete g.b4w_eye_target_dist,d("camera",g,"b4w_eye_target_dist")),"b4w_use_distance_limits"in g||(g.b4w_use_distance_limits=!1,b("camera",g,"b4w_use_distance_limits")),"b4w_distance_min"in g||(g.b4w_distance_min=1,b("camera",g,"b4w_distance_min")),
"b4w_distance_max"in g||(g.b4w_distance_max=100,b("camera",g,"b4w_distance_max")),"b4w_use_horizontal_clamping"in g||(g.b4w_use_horizontal_clamping=!1,b("camera",g,"b4w_use_horizontal_clamping")),"b4w_rotation_left_limit"in g||(g.b4w_rotation_left_limit=-Math.PI,b("camera",g,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in g||(g.b4w_rotation_right_limit=Math.PI,b("camera",g,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in g||(g.b4w_horizontal_clamping_type="LOCAL",b("camera",
g,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in g||(g.b4w_use_vertical_clamping=!1,b("camera",g,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in g||(g.b4w_rotation_down_limit=-Math.PI/2,b("camera",g,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in g||(g.b4w_rotation_up_limit=Math.PI/2,b("camera",g,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in g||(g.b4w_vertical_clamping_type="LOCAL",b("camera",g,"b4w_vertical_clamping_type"));e=a.lamps;for(l=0;l<e.length;l++)g=
e[l],"b4w_generate_shadows"in g||(g.b4w_generate_shadows=!1,b("lamp",g,"b4w_generate_shadows")),"b4w_dynamic_intensity"in g||(g.b4w_dynamic_intensity=!1,b("lamp",g,"b4w_dynamic_intensity"));e=a.speakers;for(l=0;l<e.length;l++)g=e[l],"b4w_behavior"in g||(g.b4w_behavior=g.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in g||(g.b4w_disable_doppler=!1),"b4w_delay"in g||(g.b4w_delay=0),"b4w_delay_random"in g||(g.b4w_delay_random=0),"b4w_volume_random"in g||(g.b4w_volume_random=
0),"b4w_pitch_random"in g||(g.b4w_pitch_random=0),"b4w_fade_in"in g||(g.b4w_fade_in=0),"b4w_fade_out"in g||(g.b4w_fade_out=0),"b4w_loop"in g||(g.b4w_loop=!1),"b4w_loop_count"in g||(g.b4w_loop_count=0),"b4w_loop_count_random"in g||(g.b4w_loop_count_random=0),"b4w_playlist_id"in g||(g.b4w_playlist_id="");e=a.textures;for(l=0;l<e.length;l++)g=e[l],"b4w_anisotropic_filtering"in g||(g.b4w_anisotropic_filtering="OFF",b("texture",g,"b4w_anisotropic_filtering")),"b4w_water_foam"in g||(g.b4w_water_foam=!1,
b("texture",g,"b4w_water_foam")),"b4w_foam_uv_freq"in g||(g.b4w_foam_uv_freq=[1,1],b("texture",g,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in g||(g.b4w_foam_uv_magnitude=[1,1],b("texture",g,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in g||(g.b4w_parallax_steps=5,b("material",g,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in g||(g.b4w_parallax_lod_dist=10,b("material",g,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in g||(g.b4w_shore_dist_map=!1,b("texture",g,"b4w_shore_dist_map")),"b4w_shore_boundings"in
g||(g.b4w_shore_boundings=new Float32Array(4),g.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",g,"b4w_shore_boundings")),"b4w_max_shore_dist"in g||(g.b4w_max_shore_dist=100,b("texture",g,"b4w_max_shore_dist")),"b4w_disable_compression"in g||(g.b4w_disable_compression=!1,b("texture",g,"b4w_disable_compression"));e=a.materials;for(l=0;l<e.length;l++)for(g=e[l],("b4w_node_mat_type"in g)&&d("material",g,"b4w_node_mat_type"),("b4w_skydome"in g)&&d("material",g,"b4w_skydome"),("b4w_procedural_skydome"in
g)&&d("material",g,"b4w_procedural_skydome"),g.b4w_water&&("b4w_water_shore_smoothing"in g||(g.b4w_water_shore_smoothing=!1,b("material",g,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in g||(g.b4w_water_dynamic=!1,b("material",g,"b4w_water_dynamic")),"b4w_waves_height"in g||(g.b4w_waves_height=1,b("material",g,"b4w_waves_height")),"b4w_waves_length"in g||(g.b4w_waves_length=1,b("material",g,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in g||(g.b4w_water_dst_noise_scale0=0.05,b("material",
g,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in g||(g.b4w_water_dst_noise_scale1=0.03,b("material",g,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in g||(g.b4w_water_dst_noise_freq0=1.3,b("material",g,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in g||(g.b4w_water_dst_noise_freq1=1,b("material",g,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in g||(g.b4w_water_dir_min_shore_fac=0.4,b("material",g,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in
g||(g.b4w_water_dir_freq=0.5,b("material",g,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in g||(g.b4w_water_dir_noise_scale=0.05,b("material",g,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in g||(g.b4w_water_dir_noise_freq=0.07,b("material",g,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in g||(g.b4w_water_dir_min_noise_fac=0.5,b("material",g,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in g||(g.b4w_water_dst_min_fac=0.2,b("material",g,"b4w_water_dst_min_fac")),
"b4w_water_waves_hor_fac"in g||(g.b4w_water_waves_hor_fac=5,b("material",g,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in g||(g.b4w_water_absorb_factor=6,b("material",g,"b4w_water_absorb_factor")),"b4w_water_fog_color"in g||(g.b4w_water_fog_color=new Float32Array(3),g.b4w_water_fog_color=[0.5,0.7,0.7],b("material",g,"b4w_water_fog_color")),"b4w_foam_factor"in g||(g.b4w_foam_factor=5,b("material",g,"b4w_foam_factor")),"b4w_generated_mesh"in g||(g.b4w_generated_mesh=!1,b("material",g,"b4w_generated_mesh")),
"b4w_water_num_cascads"in g||(g.b4w_water_num_cascads=5,b("material",g,"b4w_water_num_cascads")),"b4w_water_subdivs"in g||(g.b4w_water_subdivs=64,b("material",g,"b4w_water_subdivs")),"b4w_water_detailed_dist"in g||(g.b4w_water_detailed_dist=1E3,b("material",g,"b4w_water_detailed_dist"))),("b4w_dynamic_grass_size"in g)||(g.b4w_dynamic_grass_size=""),("b4w_dynamic_grass_color"in g)||(g.b4w_dynamic_grass_color=""),("diffuse_intensity"in g)||(g.diffuse_intensity=1,b("material",g,"diffuse_intensity")),
("b4w_use_ghost"in g)||(g.b4w_use_ghost=!1),("b4w_collision_group"in g)||(g.b4w_collision_group=128,b("material",g,"b4w_collision_group")),("b4w_collision_mask"in g)||(g.b4w_collision_mask=127,b("material",g,"b4w_collision_mask")),"HALO"!=g.type||("b4w_halo_sky_stars"in g)||(g.b4w_halo_sky_stars=!1,b("material",g,"b4w_halo_sky_stars")),"HALO"!=g.type||("b4w_halo_stars_blend_height"in g)||(g.b4w_halo_stars_blend_height=10,b("material",g,"b4w_halo_stars_blend_height")),"HALO"!=g.type||("b4w_halo_stars_min_height"in
g)||(g.b4w_halo_stars_min_height=0,b("material",g,"b4w_halo_stars_min_height")),("specular_shader"in g)||(g.specular_shader="COOKTORR",b("material",g,"specular_shader")),("diffuse_shader"in g)||(g.diffuse_shader="LAMBERT",b("material",g,"diffuse_shader")),("roughness"in g)||(g.roughness=0.5,b("material",g,"roughness")),("diffuse_fresnel"in g)||(g.diffuse_fresnel=0.1,b("material",g,"diffuse_fresnel")),("diffuse_fresnel_factor"in g)||(g.diffuse_fresnel_factor=0.5,b("material",g,"diffuse_fresnel_factor")),
("specular_slope"in g)||(g.specular_slope=0.2,b("material",g,"specular_slope")),("specular_toon_size"in g)||(g.specular_toon_size=0.5,b("material",g,"specular_toon_size")),("specular_toon_smooth"in g)||(g.specular_toon_smooth=0.1,b("material",g,"specular_toon_smooth")),("b4w_wettable"in g)||(g.b4w_wettable=!1,b("material",g,"b4w_wettable")),("b4w_refractive"in g)||(g.b4w_refractive=!1,b("material",g,"b4w_refractive")),("b4w_refr_bump"in g)||(g.b4w_refr_bump=0,b("material",g,"b4w_refr_bump")),("b4w_shallow_water_col"in
g)||(g.b4w_shallow_water_col=[0,0.8,0.3],b("material",g,"b4w_shallow_water_col")),("b4w_shore_water_col"in g)||(g.b4w_shore_water_col=[0,0.9,0.2],b("material",g,"b4w_shore_water_col")),("b4w_shallow_water_col_fac"in g)||(g.b4w_shallow_water_col_fac=1,b("material",g,"b4w_shallow_water_col_fac")),("b4w_shore_water_col_fac"in g)||(g.b4w_shore_water_col_fac=0.5,b("material",g,"b4w_shore_water_col_fac")),("b4w_water_sss_strength"in g)||(g.b4w_water_sss_strength=5.9,b("material",g,"b4w_water_sss_strength")),
("b4w_water_sss_width"in g)||(g.b4w_water_sss_width=0.45,b("material",g,"b4w_water_sss_width")),m=g.texture_slots,g=0;g<m.length;g++){var k=m[g];"blend_type"in k||(k.blend_type="MIX",b("texture_slot",k,"blend_type"))}a=a.objects;for(l=0;l<a.length;l++){e=a[l];switch(e.type){case "MESH":"b4w_dynamic_geometry"in e||(e.b4w_dynamic_geometry=!1);"b4w_reflexible"in e||(e.b4w_reflexible=!1);"b4w_reflexible_only"in e||(e.b4w_reflexible_only=!1);"b4w_reflective"in e||(e.b4w_reflective=!1);"b4w_wind_bending"in
e||(e.b4w_wind_bending=!1,b("object",e,"b4w_wind_bending"));"b4w_wind_bending_angle"in e||(e.b4w_wind_bending_angle=10,e.b4w_wind_bending_freq=0.25,b("object",e,"wind bending params"));"b4w_detail_bending_amp"in e||(e.b4w_detail_bending_amp=0.1,e.b4w_branch_bending_amp=0.3,b("object",e,"detail bending params"));"b4w_detail_bending_freq"in e||(e.b4w_detail_bending_freq=1,b("object",e,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in e||(e.b4w_main_bend_stiffness_col="",b("object",e,"b4w_main_bend_stiffness_col"));
"b4w_detail_bend_colors"in e||(e.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",e,"b4w_detail_bend_colors"));"b4w_caustics"in e||(e.b4w_caustics=!1);"vertex_groups"in e&&e.vertex_groups.length&&e.data&&0==e.data.vertex_groups.length&&(e.data.vertex_groups=e.vertex_groups,delete e.vertex_groups,b("object",e,"vertex_groups"));"b4w_vertex_anim"in e&&e.b4w_vertex_anim.length&&e.data&&0==e.data.b4w_vertex_anim.length&&(e.data.b4w_vertex_anim=e.b4w_vertex_anim,
delete e.b4w_vertex_anim,b("object",e,"b4w_vertex_anim"));"b4w_do_not_render"in e||(e.b4w_do_not_render=!1);"use_ghost"in e.game||(e.game.use_ghost=!1);"use_sleep"in e.game||(e.game.use_sleep=!1);"velocity_min"in e.game||(e.game.velocity_min=0);"velocity_max"in e.game||(e.game.velocity_max=0);"collision_group"in e.game||(e.game.collision_group=1);"collision_mask"in e.game||(e.game.collision_mask=255);"b4w_vehicle_settings"in e?e.b4w_vehicle_settings&&("steering_ratio"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.steering_ratio=
10),"steering_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.steering_max=1),"inverse_control"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.inverse_control=!1),"force_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.force_max=1500),"brake_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.brake_max=100),"speed_ratio"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.speed_ratio=0.027),"max_speed_angle"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.max_speed_angle=Math.PI),
"delta_tach_angle"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in e.b4w_vehicle_settings||
(e.b4w_vehicle_settings.roll_influence=0.1),"max_suspension_travel_cm"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.floating_factor=3),"floating_factor"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.water_lin_damp=0.9),"water_rot_damp"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.water_rot_damp=0.9)):(e.b4w_vehicle_settings=
null,b("object",e,"b4w_vehicle_settings"));"b4w_floating_settings"in e?e.b4w_floating_settings&&("floating_factor"in e.b4w_floating_settings||(e.b4w_floating_settings.floating_factor=3),"water_lin_damp"in e.b4w_floating_settings||(e.b4w_floating_settings.water_lin_damp=0.8),"water_rot_damp"in e.b4w_floating_settings||(e.b4w_floating_settings.water_rot_damp=0.8)):(e.b4w_floating_settings=null,b("object",e,"b4w_floating_settings"));"b4w_character_settings"in e?e.b4w_character_settings&&("walk_speed"in
e.b4w_character_settings||(e.b4w_character_settings.walk_speed=4),"run_speed"in e.b4w_character_settings||(e.b4w_character_settings.run_speed=8),"step_height"in e.b4w_character_settings||(e.b4w_character_settings.step_height=0.25),"jump_strength"in e.b4w_character_settings||(e.b4w_character_settings.jump_strength=5),"waterline"in e.b4w_character_settings||(e.b4w_character_settings.waterline=0)):(e.b4w_character_settings=null,b("object",e,"b4w_character_settings"));"b4w_selectable"in e||(e.b4w_selectable=
!1,b("object",e,"b4w_selectable"));"b4w_glow_settings"in e||(e.b4w_glow_settings={},e.b4w_glow_settings.glow_duration=1,e.b4w_glow_settings.glow_period=1,e.b4w_glow_settings.glow_relapses=0,b("object",e,"b4w_glow_settings"));"b4w_lod_transition"in e||(e.b4w_lod_transition=0.01,b("object",e,"b4w_lod_transition"));"lod_levels"in e||(e.lod_levels=[],b("object",e,"lod_levels"));break;case "EMPTY":"b4w_group_relative"in e||(e.b4w_group_relative=!1,b("object",e,"b4w_group_relative"))}if(!("rotation_quaternion"in
e)){g=[0,0,0,1];w.euler_to_quat(e.rotation_euler,g);var m=g,k=g[0],n=g[1],s=g[2];m[0]=g[3];m[1]=k;m[2]=n;m[3]=s;e.rotation_quaternion=g;b("object",e,"rotation_quaternion")}"webgl_do_not_batch"in e&&(e.b4w_do_not_batch=e.webgl_do_not_batch)&&d("object",e,"webgl_do_not_batch");"b4w_shadow_cast_only"in e||(e.b4w_shadow_cast_only=!1,b("object",e,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in e||(e.b4w_correct_bounding_offset="AUTO",b("object",e,"b4w_correct_bounding_offset"));m=e.particle_systems;
for(g=0;g<m.length;g++)k=m[g],n=k.settings,"use_whole_group"in n||(n.use_whole_group=!1,b("object",n,"use_whole_group")),k.transforms||(k.transforms=new Float32Array,b("particle_system",k,"transforms")),"b4w_billboard_align"in n||(n.b4w_billboard_align="VIEW",b("particle_settings",n,"b4w_billboard_align")),"b4w_dynamic_grass"in n||(n.b4w_dynamic_grass=!1,b("object",n,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in n||(n.b4w_dynamic_grass_scale_threshold=0.01,b("object",n,"b4w_dynamic_grass_scale_threshold")),
"b4w_initial_rand_rotation"in n||(n.b4w_initial_rand_rotation=!1,b("particle_settings",n,"b4w_initial_rand_rotation")),"b4w_rotation_type"in n||(n.b4w_rotation_type="Z",b("particle_settings",n,"b4w_rotation_type")),"b4w_rand_rotation_strength"in n||(n.b4w_rand_rotation_strength=1,b("particle_settings",n,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in n||(n.b4w_hair_billboard=!1,b("particle_settings",n,"b4w_hair_billboard")),"b4w_hair_billboard_type"in n||(n.b4w_hair_billboard_type="BASIC",b("particle_settings",
n,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in n||(n.b4w_hair_billboard_jitter_amp=0,b("particle_settings",n,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in n||(n.b4w_hair_billboard_jitter_freq=0,b("particle_settings",n,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in n||(n.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",n,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in n||(n.b4w_wind_bend_inheritance="PARENT",b("particle_settings",
n,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in n||(n.b4w_shadow_inheritance="PARENT",b("particle_settings",n,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in n||(n.b4w_reflection_inheritance="PARENT",b("particle_settings",n,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in n||(n.b4w_vcol_from_name="",b("particle_settings",n,"b4w_vcol_from_name")),"b4w_vcol_to_name"in n||(n.b4w_vcol_to_name="",b("particle_settings",n,"b4w_vcol_to_name")),"b4w_coordinate_system"in n||(n.b4w_coordinate_system=
"LOCAL",b("particle_settings",n,"b4w_coordinate_system"));"constraints"in e||(e.constraints=[],b("object",e,"constraints"));m=e.modifiers;for(g=0;g<m.length;g++){a:{k=m[g];switch(k.type){case "ARRAY":if(!("fit_type"in k)){t?f.error("WARNING Incomplete modifier "+String(k.type)+' for "'+e.name+'", reexport '+(e.library?"library"+c(e):"main scene")):y=!0;k=!1;break a}}k=!0}k||(m.splice(g,1),g--)}"animation_data"in e||(e.animation_data={action:null,nla_tracks:[]},b("object",e,"animation_data"));if(e.animation_data)for(("action"in
e.animation_data)||(e.animation_data.action=null,h("B4W Warning: no action in animation data "+e.name)),("nla_tracks"in e.animation_data)||(e.animation_data.nla_tracks=[],h("B4W Warning: no NLA in animation data "+e.name)),m=e.animation_data.nla_tracks,g=0;g<m.length;g++)for(k=m[g],n=0;n<k.strips.length;n++)"action"in k.strips[n]||(k.strips[n].action=null,h("B4W Warning: no action in NLA strip "+e.name));"b4w_collision_id"in e||(e.b4w_collision_id="",b("material",e,"b4w_collision_id"));g=e.scale;
m=Math.abs((g[1]-g[2])/g[1]);0.001>Math.abs((g[0]-g[1])/g[0])&&0.001>m||h("B4W Warning: non-uniform scale for object "+e.name)}y&&f.error("Compatibility issues detected")};a.zr=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var d=b[c].type;if("ARRAY"==d||"CURVE"==d){b=!0;break a}}b=!1}if(!b)return null;b=k(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var f=a[c];switch(f.type){case "ARRAY":for(var d=b,h=f,t=0,y=0,z=0,p=new Float32Array(16),f=[],F=1;F<h.count;F++){h.use_constant_offset&&
(t+=h.constant_offset_displace[0],y+=h.constant_offset_displace[1],z+=h.constant_offset_displace[2]);if(h.use_relative_offset)var K=d.b4w_bounding_box,t=t+(K.max_x-K.min_x)*h.relative_offset_displace[0],y=y+(K.max_y-K.min_y)*h.relative_offset_displace[1],z=z+(K.max_z-K.min_z)*h.relative_offset_displace[2];w.Hw(t,y,z,p);for(var H=K=k(d),J=p,P=0;P<H.submeshes.length;P++){var N=H.submeshes[P];w.ih(N.position,J,N.position,0);w.dx(N.normal,J,N.normal);w.Ew(N.tangent,J,N.tangent)}f.push(K)}for(F=0;F<f.length;F++)for(h=
d,t=f[F],y=0;y<h.submeshes.length;y++){z=h.submeshes[y];p=t.submeshes[y];K=z.base_length;H=z.indices.length;z.base_length+=p.base_length;for(var E in z)if("base_length"!=E)if("indices"==E)for(z[E]=w.Kw(z[E],p[E]),J=H;J<z.indices.length;J++)z.indices[J]+=K;else z[E]=w.wt(z[E],p[E])}break;case "CURVE":for(var d=b,F=f.object.gr,h=new Float32Array(16),y=F.Ed?4:3,t=new Float32Array(y),y=new Float32Array(y),z=new Float32Array(3),p=new Float32Array(4),K=new Float32Array(4),H=new Float32Array(3),J=new Float32Array(3),
P=new Float32Array(3),N=new Float32Array(4),S=new Float32Array(4),da=0;da<d.submeshes.length;da++){var ba=d.submeshes[da],T=ba.position,oa=ba.normal,ba=ba.tangent,Z;a:switch(Z=f.deform_axis,Z){case "POS_X":case "NEG_X":Z=0;break a;case "POS_Y":case "NEG_Y":Z=1;break a;case "POS_Z":case "NEG_Z":Z=2;break a;default:throw"Wrong deform axis value "+Z;}H[0]=0;H[1]=0;H[2]=0;H[Z]=1;for(var U=e.pw(F),D=0;D<T.length/3;D++){P[0]=T[3*D];P[1]=T[3*D+1];P[2]=T[3*D+2];var ha=P[Z],L=e.ow(F,ha);e.qw(F,L,t);z[0]=t[0];
z[1]=t[1];z[2]=t[2];e.nw(F,L,y);J[0]=y[0];J[1]=0;J[2]=y[2];n.normalize(J,J);g.rotationTo(H,J,p);0>ha?(t[0]=J[0],t[1]=J[1],t[2]=J[2],n.scale(t,ha,t),n.add(z,t,z)):ha>U&&(t[0]=J[0],t[1]=J[1],t[2]=J[2],n.scale(t,ha-U,t),n.add(z,t,z));s.fromRotationTranslation(p,z,h);F.Ed&&(g.setAxisAngle(H,t[3],K),n.transformQuat(P,K,P));P[Z]=0;n.transformMat4(P,h,P);T[3*D]=P[0];T[3*D+1]=P[1];T[3*D+2]=P[2];oa.length&&(N[0]=oa[3*D],N[1]=oa[3*D+1],N[2]=oa[3*D+2],N[3]=0,m.transformMat4(N,h,N),oa[3*D]=N[0],oa[3*D+1]=N[1],
oa[3*D+2]=N[2]);ba.length&&(S[0]=ba[3*D],S[1]=ba[3*D+1],S[2]=ba[3*D+2],S[3]=0,m.transformMat4(S,h,S),ba[3*D]=S[0],ba[3*D+1]=S[1],ba[3*D+2]=S[2])}}}l.tv(b)}return b};a.Zx=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[0.8,0.8,0.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:0.5,specular_shader:"COOKTORR",specular_hardness:50,
specular_slope:0.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[0.5,0.5,0.5],b4w_water_fog_density:0.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:0.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,game_settings:{alpha_blend:"OPAQUE",
use_backface_culling:!0},halo:{size:0.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}}};b4w.module.__scenegraph=function(a,p){function b(a){a=la.ua(a);a.Cd=null;a.Ra=null;a.Ub=null;return a}function d(a,b){var d=[];R.af(a,function(b,c,e){-1<d.indexOf(e)?R.Bv(a,b,c,e,k(e)):d.push(e)});R.K(a,function(b,c){for(var e=0;e<c.X.length;e++){var g=c.X[e];-1<d.indexOf(g)?c.X[e]=k(g):d.push(g)}"ANTIALIASING"==c.type&&R.Ud(a,b,function(a,b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.X.length;c++){var d=b.X[c];d.ja=ga.t;d.ia=ga.t}})});R.K(a,function(d){var e={};h(a,d,e);for(var g in e){d=e[g];if(b)for(var f=
0;f<d.length;f++){var B=d[f];if("DEPTH"==B.C){if(c(B))throw"Failed to use renderbuffer as input texture: "+B.C+"->"+B.T;B.qg=!0}}B=d[0];for(f=0;f<d.length;f++)if(d[f].ja==ga.t){B=d[f];break}for(var l=d[0],f=0;f<d.length;f++)if(d[f].ia==ga.t){l=d[f];break}for(var m=d[0],f=0;f<d.length;f++)if(!d[f].qg){m=d[f];break}for(f=0;f<d.length;f++)d[f].ja=B.ja,d[f].ia=l.ia,d[f].qg=m.qg}})}function h(a,b,c){R.Ud(a,b,function(b,d,e){e.sa&&e.C==e.T&&(c[e.C]=c[e.C]||[],-1==c[e.C].indexOf(e)&&c[e.C].push(e),h(a,b,
c))});R.Vd(a,b,function(a,b,d){d.sa&&(c[d.C]=c[d.C]||[],-1==c[d.C].indexOf(d)&&c[d.C].push(d))});b=R.qa(a,b);if("MOTION_BLUR"==b.type)for(var d=0;d<b.X.length;d++){var e=b.X[d];c[e.C].push(e)}}function c(a){switch(a.T){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "NONE":return!1;default:return!0}}function k(a){if(a.ka)throw"Failed to clone slink with attached texture";return la.Pc(a)}function l(a){var b=R.vp(a),c=[];R.K(b,function(a,d){switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":var e=
[];break;default:e=c}for(var g=0;g<d.X.length;g++){var h=d.X[g],B=m(e,h,f(h));h.ka=B;d.Gc[g]=B}for(g=0;g<d.Gc.length;g++)B=d.Gc[g],n(e,B);switch(d.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_REFLECT":e=[]}R.Vd(b,a,function(c,d,g){if((c=w(b,a,g.C))&&g.sa&&!g.ka){d=e;for(var h=c,B=0;B<d.length;B++){var l=d[B];l.ll===h&&l.oh++}}else c=m(e,g,f(g));g.ka=c});R.Ud(b,a,function(a,b,c){n(e,c.ka)});R.Vd(b,a,function(a,b,c){c.ka&&"NONE"==c.T&&n(e,c.ka)})})}function e(a){s(a,
function(b,c,d){b.Eh&&(W(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||W(a,d,"ANTIALIASING"))&&(b.$e*=ya.resolution_factor)})}function f(a){a=la.Pc(a);delete a.T;delete a.sa;return JSON.stringify(a)}function w(a,b,c){var d=null;R.Ud(a,b,function(a,b,e){if(e.sa&&e.C==e.T&&e.C==c&&e.ka)return d=e.ka,!0});R.Vd(a,b,function(a,b,e){if(e.sa&&e.C==c&&e.ka)return d=e.ka,!0});return d}function n(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.ll===b&&d.oh&&d.oh--}}function m(a,b,c){for(var d=
null,e=0;e<a.length;e++){var f=a[e];if(f.id==c&&0===f.oh){d=f;break}}if(d&&!Ba)return d.oh++,d.ll;b=g(b);a.push({id:c,oh:1,ll:b});return b}function g(a){var b=a.$e*a.size;switch(a.C){case "COLOR":var c=ga.ii("COLOR",ga.de);ga.resize(c,b,b);ga.dj(c,a.ja,a.ia);return c;case "DEPTH":return a.qg?(c=ga.ii("DEPTH_RBUF",ga.jf),ga.resize(c,b,b)):(c=ga.ii("DEPTH_TEX",ga.xg),ga.resize(c,b,b),ga.dj(c,a.ja,a.ia)),c;case "CUBEMAP":return c=ga.xs(b);case "SCREEN":return null;default:throw"Wrong slink param: "+
a.C;}}function s(a,b){var c=!1;R.af(a,function(d,e,f){if(f&&(d=R.qa(a,d),e=R.qa(a,e),b(f,!1,d,e)))return c=!0});c||R.K(a,function(a,c){for(var d=0;d<c.X.length;d++)if(b(c.X[d],!0,c,null))return!0})}function t(a){R.K(a,function(b,c){if("SINK"!=c.type){var d=c.i;R.Vd(a,b,function(a,b,c){c.sa&&c.ka&&(aa.cj(d,c.C,c.ka),c.C==c.T&&b.i&&aa.cj(b.i,c.C,c.ka))});for(var e=0;e<c.X.length;e++){var f=c.X[e];f.sa&&f.C==f.T&&aa.cj(d,f.C,c.Gc[e])}!d.Ra&&!d.Ub||d.Cd||(d.Cd=ja.Ro(d.Ra,d.Ub))}})}function y(a){var b=
x("SHADOW_CAST");b.Mm=a;b.i=aa.$a(aa.zg);return b}function x(a){return{type:a,M:!1,enqueue:!1,V:!1,Z:!1,bb:!1,ma:!1,Co:!1,Cj:!1,Oi:!1,wa:!1,Hg:0,shadow_visibility_falloff:0,time:0,i:null,Nm:null,fb:null,m:[],X:[],Gc:[],Jh:new Float32Array(3),Pp:new Float32Array(3),Eb:new Float32Array(3),wb:new Float32Array(4),vc:new Float32Array(16),Ad:0,Nf:0,Df:null,Gf:null,Cf:null,Ef:null,Ff:null,Wb:new Float32Array(3),ec:new Float32Array(3),rp:new Float32Array(3),hj:new Float32Array(3),sp:new Float32Array(4),Yf:null,
xi:0,$j:0,Vg:!1,Rg:new Float32Array(3),Xd:0,ra:null,sj:!1,Od:new Float32Array(2),Pd:new Float32Array(2),Wf:0,Kf:0,Oj:0,mc:null,Zd:0,gf:0,Yd:0,oe:!1,pm:0,qm:new Float32Array(2),om:0,procedural_skydome:!1,use_as_environment_lighting:!1,mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,Xf:new Float32Array(3),fg:0,ag:0,bg:0,dg:0,cg:0,eg:0,$f:0,ip:0,ssao_only:0,brightness:0,
contrast:0,exposure:0,saturation:0,god_rays_intensity:0,Jf:0,$i:0,ig:0,Mm:0,Ep:null,fm:null,Te:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,blur_depth_size_mult:0,blur_depth_edge_size:0,blur_depth_diff_threshold:0,im:0,Wm:0,Ki:0,Li:0,io:0,jh:"",orientation:"",Gu:new Float32Array(2),M:!0,enqueue:!0,V:!0,Z:!0,bb:!0,wa:!0}}function q(a,b,c,d,e){return{C:a,T:b,size:c,$e:d,Eh:e,sa:!0,ka:null,qg:!1,ja:ga.pc,ia:ga.pc}}function r(){var a=x("GRASS_MAP");a.i=aa.$a(aa.yg);return a}function I(a){var b=x("POSTPROCESSING");
b.V=!1;b.Z=!1;b.bb=!1;b.i=aa.$a(aa.Pa);b.jh=a;return b}function A(a){var b=x("BLOOM_BLUR");b.V=!1;b.Z=!1;b.bb=!1;b.i=aa.$a(aa.Pa);b.jh=a;return b}function G(a,b,c,d,e,f,g,h){var B=x("MAIN_"+a);if("OPAQUE"===a&&c)B.V=!0,B.Z=!1,B.ma=!1;else if("OPAQUE"===a)B.V=!0,B.Z=!0,B.ma=!1;else if("BLEND"===a&&c)B.V=!1,B.Z=!1,B.ma=!0;else if("BLEND"===a)B.V=!0,B.Z=!0,B.ma=!0;else if("REFLECT"===a)B.V=!0,B.Z=!0,B.ma=!1;else throw"wrong main subscene type";"BLEND"==a&&h&&(B.shadow_visibility_falloff=h.Ip);B.i=b;
B.Wb.set(g.Wb);B.ec.set(g.ec);B.Ad=g.Ad;B.Yf=g.Yf;B.wb=f;d&&(B.ra=d,d.wb&&(B.mc=new Float32Array(d.wb)),B.Zd=d.waves_height,B.gf=d.waves_length,B.Yd=d.Yd,d.ai&&(B.oe=!0,B.pm=d.ai,B.qm.set(d.Qj),B.om=d.Pj),d.fj&&(B.sj=!0,a=d.ew,B.Od[0]=(a[0]+a[1])/2,B.Od[1]=(a[2]+a[3])/2,B.Pd[0]=a[0]-a[1],B.Pd[1]=a[2]-a[3],B.Wf=d.Wf,B.Kf=d.Kf));B.Df=new Float32Array(3*e);B.Gf=new Float32Array(3*e);B.Cf=new Float32Array(3*e);B.Ef=new Float32Array(4*e);B.Ff=new Float32Array(4*e);return B}function Q(a){var b=x("COLOR_PICKING");
b.enqueue=!1;b.i=a;return b}function u(a){var b=x("WIREFRAME");b.M=!1;b.V=!1;b.Z=!1;b.i=a;return b}function z(a,b){var c=x("DEPTH");c.i=a;c.shadow_visibility_falloff=b;return c}function O(a,b,c,d,e){var f=x("BLUR_DEPTH");f.V=!1;f.Z=!1;f.bb=!1;f.i=a;f.orientation=b;f.blur_depth_size_mult=c;f.blur_depth_edge_size=d;f.blur_depth_diff_threshold=e;return f}function F(a){var b=x("DEPTH_PACK");b.V=!1;b.Z=!1;b.i=a;return b}function K(a,b,c){var d=x("SSAO");d.V=!1;d.Z=!1;d.bb=!1;d.i=a;d.wb=b;d.mc=new Float32Array(b);
d.fg=c.radius_increase;d.ag=c.dithering_amount/1E3;d.bg=c.gauss_center;d.dg=c.gauss_width_square;d.cg=c.gauss_width_left_square;d.eg=c.influence;d.$f=c.dist_factor;d.ip=c.Gv;return d}function H(){var a=x("ANTIALIASING");a.V=!1;a.Z=!1;a.bb=!1;a.i=aa.$a(aa.Pa);return a}function J(a){var b=x(a);b.V="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.Z=!1;b.bb=!1;b.i=aa.$a(aa.Pa);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.Hu=new Float32Array(4));return b}function P(a,b,c,d){var e=x("COMPOSITING");
e.V=!1;e.Z=!1;e.bb=!1;e.i=aa.$a(aa.Pa);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function N(a,b){var c=x("MOTION_BLUR");c.V=!1;c.Z=!1;c.bb=!1;c.i=aa.$a(aa.Pa);c.Cj=!0;c.Ki=a;c.Li=b;return c}function E(a){var b=x("DOF");b.V=!1;b.Z=!1;b.bb=!1;b.i=a;return b}function S(a){var b=x("GLOW_MASK");b.i=a;b.bb=!1;return b}function da(a){var b=x("GLOW");b.Rg.set(a.Rg);b.xi=a.xi;b.Wm=5;b.im=3;b.bb=!1;b.i=aa.$a(aa.Pa);return b}function ba(){var a=x("REFRACT");a.V=!1;a.Z=!1;a.bb=!1;a.i=aa.$a(aa.Pa);
return a}function T(a,b,c,d,e,f,g){var h=x("GOD_RAYS");h.V=!1;h.Z=!1;h.bb=!1;h.Wb[0]=1;h.Wb[1]=1;h.Wb[2]=1;h.ec[0]=1;h.ec[1]=1;h.ec[2]=1;h.Ad=1;h.Co=d;h.Xd=b;h.$i=e;h.Jf=c;h.ig=g;h.i=a;h.Nf=f;h.Df=new Float32Array(3*f);h.Gf=new Float32Array(3*f);h.Cf=new Float32Array(3*f);h.Ef=new Float32Array(4*f);h.Ff=new Float32Array(4*f);return h}function oa(a){var b=x("GOD_RAYS_COMBINE");b.V=!1;b.Z=!1;b.bb=!1;b.i=aa.$a(aa.Pa);b.god_rays_intensity=a;return b}function Z(a,b){var c=x("SKY");c.enqueue=!1;c.V=!1;
c.Z=!1;c.bb=!1;var d=aa.$a(aa.Pa);d.width=wa;d.height=wa;c.i=d;c.Nm=la.Ft();c.Nf=a;c.Df=new Float32Array(3*a);c.Gf=new Float32Array(3*a);c.Cf=new Float32Array(3*a);c.Ef=new Float32Array(4*a);c.Ff=new Float32Array(4*a);c.Wb[0]=1;c.Wb[1]=1;c.Wb[2]=1;c.ec[0]=1;c.ec[1]=1;c.ec[2]=1;c.Ad=1;c.Xf.set(b.Xf);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=b.mie_brightness;c.spot_brightness=b.spot_brightness;
c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function U(){var a=x("SCREEN");a.V=!1;a.Z=!1;a.i=aa.$a(aa.Pa);return a}function D(){var a=x("ANAGLYPH");a.V=!1;a.Z=!1;a.i=aa.$a(aa.Pa);return a}function ha(){var a=x("LUMINANCE");a.V=!1;a.Z=!1;a.i=aa.$a(aa.Pa);return a}function L(){var a=x("AVERAGE_LUMINANCE");
a.V=!1;a.Z=!1;a.i=aa.$a(aa.Pa);return a}function v(a,b,c,d){var e=x("LUMINANCE_TRUNCED");e.V=!1;e.Z=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.i=d;e.Df=new Float32Array(3*c);e.Gf=new Float32Array(3*c);e.Cf=new Float32Array(3*c);e.Ef=new Float32Array(4*c);e.Ff=new Float32Array(4*c);return e}function M(a){var b=x("BLOOM");b.V=!1;b.Z=!1;b.i=aa.$a(aa.Pa);b.bloom_blur=a;return b}function fa(){var a=x("SINK");a.enqueue=!1;return a}function W(a,b,c){if(b.type===c)return!0;b=na(a,b);for(var d=0;d<b.length;d++)if(W(a,
b[d],c))return!0;return!1}function ca(a,b,c){if(b.type===c)return!0;b=X(a,b);for(var d=0;d<b.length;d++)if(ca(a,b[d],c))return!0;return!1}function ka(a,b,c){if(b.type===c)return b;b=X(a,b);for(var d=0;d<b.length;d++){var e=ka(a,b[d],c);if(e)return e}return null}function X(a,b){var c=R.Pi(a,b);if(c==R.Jl)throw"Subscene not in graph";for(var d=[],e=R.Nn(a,c),f=0;f<e;f++){var g=R.vi(a,c,f);g!=c&&d.push(R.qa(a,g))}return d}function na(a,b){var c=R.Pi(a,b);if(c==R.Jl)throw"Subscene not in graph";for(var d=
[],e=R.Se(a,c),f=0;f<e;f++){var g=R.Be(a,c,f);g!=c&&d.push(R.qa(a,g))}return d}function ia(a){var b=[],c=[];s(a,function(a){a.ka&&-1==b.indexOf(a.ka)&&(b.push(a.ka),c.push(a.ka,b.length-1))});return c}function B(a,b){var c;c=""+(a.C+"\\n");c+="NONE"!=a.T?a.T+"\\n":"";c+="(";if(a.Eh){var d=a.$e;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.C){c+=" ";if(a.qg)c+="RR";else{var d=a.ja,e=a.ia,f="";d==ga.t?f+="L":d==ga.pc&&(f+="N");e==ga.t?f+="L":
e==ga.pc&&(f+="N");c+=f}for(d=0;d<b.length;d+=2)b[d]==a.ka&&(c+=" "+b[d+1])}return c+")\\n"}var aa=p("__camera"),sa=p("__config"),pa=p("__debug"),R=p("__graph"),ja=p("__renderer"),ga=p("__textures"),la=p("__util");p("vec4");var ya=sa.q,Ha=sa.Sf,Ba=!1,wa=384;a.Js=function(a,c){var f=R.create(),g=a.R[0],h=c.yk,B=c.Al,m=c.wb,v=G("OPAQUE",g,!1,c.ra,h,m,B);R.p(f,v);m=G("BLEND",g,!0,null,h,m,B,null);R.p(f,m);R.j(f,v,m,q("SCREEN","NONE",1,1,!0));B=fa();R.p(f,B);ya.wireframe_debug?(g=u(g),R.p(f,g),R.j(f,
m,g,q("SCREEN","NONE",1,1,!0)),R.j(f,g,B,q("SCREEN","NONE",1,1,!0))):R.j(f,m,B,q("SCREEN","NONE",1,1,!0));c.ei&&(g=b(v.i),a.R.push(g),v=Q(g),R.p(f,v),R.j(f,v,B,q("COLOR","NONE",1,1,!0)),R.j(f,v,B,q("DEPTH","NONE",1,1,!0)));c.Qf&&(h=Z(h,c.cl),R.p(f,h),R.j(f,h,B,q("CUBEMAP","u_sky",wa,1,!1)));d(f,!0);1<ya.resolution_factor&&e(f);l(f);t(f);return f};a.es=c;a.Jw=s;a.Is=function(a,c,f){var g=R.create(),h=[],B=[],m=[],k=[],n=[],s=[],w=[],ca=[],x=[],X=[],p=[],ka=c.yk,na=c.ra,sa=c.zv,ia=c.Zf,W=c.yf,ja=c.Md,
Ba=c.uv,kc=c.mf,Mc=c.Lf,bb=c.pf,Vc=c.antialiasing,Nc=c.Al,sc=c.wb,lc=c.wh,Eb=c.Uu,jb=c.Kr,Jb=c.Wr,bc=c.lu,Fc=c.iu;if(sa){var Ub=lc.csm_num;if(!Ub)throw"Zero CSM sections is forbidden";for(var Y=0;Y<Ub;Y++){var cb=y(Y);R.p(g,cb);X.push(cb);var Sa=Ha.Ye,ta=cb.i;ta.width=Sa;ta.height=Sa;cb.V=!1;p.push(q("DEPTH","u_shadow_map"+Y,Sa,1,!1));pa.sm()&&cb.X.push(q("COLOR","COLOR",Sa,1,!1))}}var tc=ya.ni&&(0<f.dof_distance||f.ve)?!0:!1,va=[];if(ya.anaglyph_use&&!a){var rb=f.R[0],sb=b(rb);aa.fo(rb,aa.ib);aa.fo(sb,
aa.rb);va.push(rb,sb);f.R.push(sb)}else ta=f.R[0],va.push(ta);if(0<Ba.length&&!a)for(Y=0;Y<va.length;Y++){ta=b(va[Y]);f.R.push(ta);var ra=G("REFLECT",ta,!1,na,ka,sc,Nc);ra.fb=Ba[0];ra.i.fb=Ba[0];R.p(g,ra);s.push(ra);w.push(q("COLOR","u_reflectmap",1,ya.qh,!0));ra.X.push(q("DEPTH","DEPTH",1,ya.qh,!0))}h=[];B=[];if(c.pa){var Ja=r();R.p(g,Ja);Sa=Ha.zi;Ja.i.width=Sa;Ja.i.height=Sa;var tb=q("DEPTH","u_grass_map_depth",Sa,1,!1);tb.ja=ga.t;tb.ia=ga.t;var ub=q("COLOR","u_grass_map_color",Sa,1,!1);ub.ja=ga.t;
ub.ia=ga.t}else ub=tb=Ja=null;for(Y=0;Y<va.length;Y++){var ta=va[Y],Fb=b(ta),ua=lc.Ip;f.R.push(Fb);if(sa){var qa=z(Fb,ua);R.p(g,qa);for(var Ka=0;Ka<X.length;Ka++){var cb=X[Ka],Kb=p[Ka];R.j(g,cb,qa,Kb)}var cc=q("COLOR","u_color",1,1,!0),Lb=q("DEPTH","u_depth",1,1,!0);if(ia){var dc=b(ta);f.R.push(dc);var Vb=K(dc,sc,c.hp);R.p(g,Vb);var vb=q("COLOR","u_color",1,1,!0);R.j(g,qa,Vb,cc);R.j(g,qa,Vb,Lb)}var uc=b(ta);f.R.push(uc);var Mb=b(ta);f.R.push(Mb);var Nb=lc.blur_depth_size_mult,mc=lc.blur_depth_edge_size,
nc=lc.blur_depth_diff_threshold,db=O(uc,"X",Nb,mc,nc);R.p(g,db);var wb=q("COLOR","u_color",1,1,!0);ia?R.j(g,Vb,db,vb):R.j(g,qa,db,cc);R.j(g,qa,db,Lb);var Gb=O(Mb,"Y",Nb,mc,nc);R.p(g,Gb);R.j(g,db,Gb,wb);R.j(g,qa,Gb,Lb);var Ta=q("COLOR","u_shadow_mask",1,1,!0),Ya=b(Fb);f.R.push(Ya);var Oa=F(Ya);R.p(g,Oa);R.j(g,qa,Oa,q("DEPTH","u_depth",1,1,!0));m.push(Oa);var xb=q("DEPTH","DEPTH",1,1,!0);n.push(xb)}else qa=z(Fb,ua),R.p(g,qa),xb=q("DEPTH","DEPTH",1,1,!0),n.push(xb),pa.sm()&&qa.X.push(q("COLOR","COLOR",
1,1,!0)),Ya=b(Fb),f.R.push(Ya),Oa=F(Ya),R.p(g,Oa),R.j(g,qa,Oa,q("DEPTH","u_depth",1,1,!0)),m.push(Oa);Ja&&(R.j(g,Ja,qa,tb),R.j(g,Ja,qa,ub));ra=G("OPAQUE",ta,!0,na,ka,sc,Nc);R.p(g,ra);B.push(ra);R.j(g,qa,ra,n[Y]);Gb&&R.j(g,Gb,ra,Ta);var C=q("COLOR","u_color",1,1,!0);k.push(q("COLOR","COLOR",1,1,!0));Ja&&(R.j(g,Ja,ra,tb),R.j(g,Ja,ra,ub));s.length&&(R.j(g,s[Y],ra,w[Y]),ra.fb=Ba[0])}h=B;B=[];if(!a&&c.ei){ta=b(h[0].i);f.R.push(ta);var za=Q(ta);R.p(g,za)}else za=null;if(ja&&!a)for(Y=0;Y<va.length;Y++){var Za=
ba();R.p(g,Za);R.j(g,h[Y],Za,C);ca.push(Za);x.push(q("COLOR","u_refractmap",1,1,!0))}for(var ma=[],Y=0;Y<va.length;Y++){qa=m[Y];ta=b(va[Y]);f.R.push(ta);ra=G("BLEND",ta,!0,na,ka,sc,Nc,lc);B.push(ra);R.p(g,ra);R.j(g,h[Y],ra,k[Y]);R.j(g,h[Y],ra,n[Y]);Ja&&(R.j(g,Ja,ra,tb),R.j(g,Ja,ra,ub));for(Ka=0;Ka<X.length;Ka++)cb=X[Ka],Kb=p[Ka],R.j(g,cb,ra,Kb);if("DEPTH_PACK"==qa.type){var Ca=q("COLOR","u_scene_depth",1,1,!0);Ca.ja=ga.pc;Ca.ia=ga.pc}else Ca=q("DEPTH","u_scene_depth",1,1,!0),Ca.ja=ga.t,Ca.ia=ga.t;
R.j(g,qa,ra,Ca);s.length&&(R.j(g,s[Y],ra,w[Y]),ra.fb=Ba[0]);ca.length&&R.j(g,ca[Y],ra,x[Y]);ma.push(ra)}h=B;B=[];if(ya.wireframe_debug){for(Y=0;Y<va.length;Y++){ta=la.ua(va[Y]);f.R.push(ta);var V=u(ta);B.push(V);R.p(g,V);R.j(g,h[Y],V,k[Y]);R.j(g,h[Y],V,n[Y]);Ja&&(R.j(g,Ja,V,tb),R.j(g,Ja,V,ub))}h=B;B=[]}if(W&&!a){for(Y=0;Y<va.length;Y++){var Qa=bc.Jf,Ia=bc.xu,lb=bc.ig,Ga=h[Y],Ob=na?1:0,yb=q("DEPTH","u_input",1,1,!0);yb.ja=ga.t;yb.ia=ga.t;var Hb=q("COLOR","u_input",1,0.25,!0);Hb.ja=ga.t;Hb.ia=ga.pc;
var zb=Qa/lb,Pb=b(va[Y]);f.R.push(Pb);var Qb=T(Pb,Ob,Qa,!0,zb,ka,lb);R.p(g,Qb);R.j(g,Ga,Qb,yb);var zb=Qa/lb*0.5,ec=b(va[Y]);f.R.push(ec);var xa=T(ec,Ob,Qa,!1,zb,ka,lb);R.p(g,xa);R.j(g,Qb,xa,Hb);var zb=Qa/lb*0.25,Da=b(va[Y]);f.R.push(Da);var eb=T(Da,Ob,Qa,!1,zb,ka,lb);R.p(g,eb);R.j(g,xa,eb,Hb);s.length&&(Qb.fb=Ba[0],xa.fb=Ba[0],eb.fb=Ba[0]);var Rb=oa(Ia);B.push(Rb);R.p(g,Rb);R.j(g,Ga,Rb,q("COLOR","u_main",1,1,!0));R.j(g,eb,Rb,q("COLOR","u_god_rays",1,1,!0))}h=B;B=[]}if(kc&&!a){for(Y=0;Y<va.length;Y++){var Ga=
h[Y],fb=ha();R.p(g,fb);R.j(g,Ga,fb,q("COLOR","u_input",1,1,!0));var fc=L();R.p(g,fc);fc.i.width=1;fc.i.height=1;var kb=q("COLOR","u_input",1,0.25,!0);kb.ja=ga.t;kb.ia=ga.t;var mb=q("COLOR","u_luminance",1,0.25,!0);mb.ja=ga.t;mb.ia=ga.t;R.j(g,fb,fc,kb);var vc=jb.key,Sb=jb.jt,Xa=b(va[Y]);f.R.push(Xa);var gc=v(vc,Sb,ka,Xa);R.p(g,gc);R.j(g,Ga,gc,q("COLOR","u_main",1,1,!0));R.j(g,fb,gc,mb);R.j(g,fc,gc,q("COLOR","u_average_lum",1,1,!1));var nb=q("COLOR","u_color",1,0.25,!0);nb.ja=ga.t;nb.ia=ga.t;var Gc=
A("X_BLUR");R.p(g,Gc);R.j(g,gc,Gc,nb);var Wb=A("Y_BLUR");R.p(g,Wb);R.j(g,Gc,Wb,nb);var Xb=M(jb.blur);R.p(g,Xb);R.j(g,Wb,Xb,q("COLOR","u_bloom",1,0.25,!0));R.j(g,Ga,Xb,q("COLOR","u_main",1,1,!0));B.push(Xb)}h=B;B=[]}if(Mc&&!a){for(Y=0;Y<h.length;Y++){var Oc=h[Y],$a=N(Eb.Ki,Eb.Li);B.push($a);R.p(g,$a);R.j(g,Oc,$a,q("COLOR","u_mb_tex_curr",1,1,!0));$a.X.push(q("COLOR","u_mb_tex_accum",1,1,!0))}h=B;B=[]}if(tc&&!a){for(Y=0;Y<h.length;Y++){var Ga=h[Y],Ab=b(va[Y]);f.R.push(Ab);nb=q("COLOR","u_color",1,1,
!0);nb.ja=ga.t;nb.ia=ga.t;var Tb=I("X_BLUR");R.p(g,Tb);R.j(g,Ga,Tb,nb);var gb=I("Y_BLUR");R.p(g,gb);R.j(g,Tb,gb,nb);var qa=ma[Y],wc=E(Ab);Ab.dof_distance=f.dof_distance;Ab.ve=f.ve;Ab.dof_front=f.dof_front;Ab.dof_rear=f.dof_rear;Ab.dof_power=f.dof_power;Ab.dof_on=1;B.push(wc);R.p(g,wc);R.j(g,Ga,wc,q("COLOR","u_sharp",1,1,!0));R.j(g,gb,wc,q("COLOR","u_blurred",1,1,!0));R.j(g,qa,wc,q("DEPTH","u_depth",1,1,!0))}h=B;B=[]}if(!a&&c.glow){for(Y=0;Y<va.length;Y++){var Ga=h[Y],hb=b(va[Y]);f.R.push(hb);var xc=
S(hb);R.p(g,xc);var Hc=I("X_EXTEND"),yc=q("COLOR","u_color",1,1,!0),Ic=q("COLOR","u_glow_mask",1,1,!0);Hc.Vg=!0;R.p(g,Hc);R.j(g,xc,Hc,yc);var hc=q("COLOR","u_color",1,0.5,!0);hc.ja=ga.t;hc.ia=ga.t;var Pc=I("Y_EXTEND");Pc.Vg=!0;R.p(g,Pc);R.j(g,Hc,Pc,hc);Tb=I("X_BLUR");Tb.Vg=!0;R.p(g,Tb);R.j(g,Pc,Tb,hc);var Qc=q("COLOR","u_color",1,0.25,!0);Qc.ja=ga.t;Qc.ia=ga.t;var Rc=q("COLOR","u_glow_mask_blurred",1,0.25,!0);Rc.ja=ga.t;Rc.ia=ga.t;gb=I("Y_BLUR");gb.Vg=!0;R.p(g,gb);R.j(g,Tb,gb,Qc);var zc=da(Fc);R.p(g,
zc);R.j(g,Ga,zc,q("COLOR","u_glow_src",1,1,!0));R.j(g,xc,zc,Ic);R.j(g,gb,zc,Rc);B.push(zc)}h=B;B=[]}if(bb&&!a){for(Y=0;Y<h.length;Y++){var Ga=h[Y],Jc=P(Jb.brightness,Jb.contrast,Jb.exposure,Jb.saturation);R.p(g,Jc);R.j(g,Ga,Jc,q("COLOR","u_color",1,1,!0));B.push(Jc)}h=B;B=[]}if(Vc&&!a){for(Y=0;Y<h.length;Y++)if(Ga=h[Y],ya.smaa){var Ac=q("COLOR","u_color",1,1,!0);Ac.ja=ga.t;Ac.ia=ga.t;var ob=J("SMAA_EDGE_DETECTION");R.p(g,ob);R.j(g,Ga,ob,Ac);var Bc=J("SMAA_BLENDING_WEIGHT_CALCULATION");R.p(g,Bc);R.j(g,
ob,Bc,Ac);var Cc=q("COLOR","u_search_tex",1,1,!1),Yb=q("COLOR","u_area_tex",1,1,!1);Cc.ja=ga.t;Cc.ia=ga.t;Yb.ja=ga.t;Yb.ia=ga.t;Bc.X.push(Cc);Bc.X.push(Yb);var Zb=J("SMAA_NEIGHBORHOOD_BLENDING");R.p(g,Zb);R.j(g,Ga,Zb,Ac);var Sc=q("COLOR","u_blend",1,1,!0);Sc.ja=ga.t;Sc.ia=ga.t;R.j(g,Bc,Zb,Sc);B.push(Zb)}else{var ea=H();R.p(g,ea);var Ea=q("COLOR","u_color",1,1,!0);Ea.ja=ga.t;Ea.ia=ga.t;R.j(g,Ga,ea,Ea);if(1<ya.resolution_factor){var Wc=I("NONE");R.p(g,Wc);R.j(g,ea,Wc,Ea);B.push(Wc)}else B.push(ea)}h=
B;B=[]}if(ya.anaglyph_use&&!a){var $b=D();R.p(g,$b);R.j(g,h[0],$b,q("COLOR","u_sampler_left",1,1,!0));R.j(g,h[1],$b,q("COLOR","u_sampler_right",1,1,!0));B.push($b)}else B.push(h[0]);var Aa=R.Pi(g,h[0]),Ma=!1;R.Ud(g,Aa,function(a,b,c){if(c.C==c.T)return Ma=!0});if(Ma||a){var Xc=U();R.p(g,Xc);R.j(g,h[0],Xc,q("COLOR","u_color",1,1,!0));h=B;B=[];B.push(Xc)}za&&B.push(za);if(!a&&c.Qf){var Ua=Z(ka,c.cl);R.p(g,Ua);B.push(Ua)}var ic=fa();R.p(g,ic);for(Y=0;Y<B.length;Y++)switch(B[Y].type){case "COLOR_PICKING":R.j(g,
B[Y],ic,q("COLOR","NONE",1,1,!0));R.j(g,B[Y],ic,q("DEPTH","NONE",1,1,!0));break;case "SKY":R.j(g,Ua,ic,q("CUBEMAP","u_sky",wa,1,!1));break;default:R.j(g,B[Y],ic,q("SCREEN","NONE",1,1,!0))}for(var oc=R.xn(g),Y=0;Y<oc.length;Y++)for(var Kc=oc[Y],Ka=0;Ka<m.length;Ka++)qa=m[Ka],R.qa(g,Kc)==qa&&R.Rf(g,Kc);d(g,!1);1<ya.resolution_factor&&e(g);l(g);t(g);return g};a.Ky=x;a.ly=function(a){var b=null;R.K(a,function(a,c){return c.i&&null===c.i.Cd?(b=c,!0):!1});return b};a.Ta=function(a,b,c){a=X(a,b);for(b=0;b<
a.length;b++)if(a[b].type===c)return a[b];return null};a.Gy=W;a.qu=ca;a.vt=ka;a.rn=X;a.Ay=na;a.Ca=function(a,b){var c=null;R.K(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.Ws=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=ia(a);R.K(a,function(a,d){var e=b+="    ",g="",g=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type?g+=" ("+d.jh.replace(/_/g," ")+")":"BLUR_DEPTH"==
d.type&&(g+=" ("+d.orientation+")");if(d.i){for(var g=g+"\\n",f=0;f<c.length;f+=2)c[f]==d.i.Ra&&(g+="C"+c[f+1]+" ");for(f=0;f<c.length;f+=2)c[f]==d.i.Ub&&(g+="D"+c[f+1])}d.X.length&&(g+="\\n-----\\n");for(f=0;f<d.X.length;f++)g+=B(d.X[f],c);f="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+g+'" color="black" style="'+(f+",bold")+'"];\n')});R.af(a,function(a,d,e){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+B(e,c)+'" style="'+(e.sa?"solid":"dotted")+'"];\n'});return b+=
"}"};a.Lm=function(a){a=R.Gw(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,p){function b(){return{name:"",type:0,source:"",width:0,height:0,Fg:1,Rh:!0,canvas:null,Vr:null,qb:0,Ba:null,ug:null}}function d(a){g.texParameteri(a,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(a,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.texParameteri(a,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(a,g.TEXTURE_MIN_FILTER,g.LINEAR)}function h(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function c(b){switch(b.type){case a.de:b=
g.RGBA;break;case a.vj:b=g.RGB;break;case a.Mh:b=g.RGBA;break;case a.Nh:b=g.RGB;break;case a.xg:b=g.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function k(b){switch(b.type){case a.de:b=g.UNSIGNED_BYTE;break;case a.vj:b=g.UNSIGNED_BYTE;break;case a.Mh:b=g.FLOAT;break;case a.Nh:b=g.FLOAT;break;case a.xg:b=g.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}var l=p("__config"),e=p("__print"),f=p("__dds"),w=p("__extensions"),n=p("__util"),m=l.q;a.pc=0;a.t=0;a.Yq=0;a.Wq=
0;a.Xq=0;a.Vq=0;a.de=10;a.vj=20;a.Mh=30;a.Nh=40;a.xg=50;a.jf=60;var g=null,s;a.kc=function(b){s=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];a.pc=b.NEAREST;a.t=b.LINEAR;a.Yq=b.NEAREST_MIPMAP_NEAREST;a.Wq=b.LINEAR_MIPMAP_NEAREST;a.Xq=b.NEAREST_MIPMAP_LINEAR;a.Vq=b.LINEAR_MIPMAP_LINEAR;g=b};a.ii=function(c,d){var e=b();e.name=c;e.type=d;e.source="NONE";if(d==a.jf)e.ug=g.createRenderbuffer();else{var f=g.TEXTURE_2D,h=g.createTexture();g.bindTexture(f,
h);g.texParameteri(f,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(f,g.TEXTURE_MIN_FILTER,g.LINEAR);g.texParameteri(f,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(f,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.bindTexture(f,null);e.qb=f;e.Ba=h}return e};a.xs=function(c){var d=g.createTexture(),e=g.TEXTURE_CUBE_MAP;g.bindTexture(e,d);g.texParameteri(e,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(e,g.TEXTURE_MIN_FILTER,g.LINEAR);g.texParameteri(e,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(e,g.TEXTURE_WRAP_T,
g.CLAMP_TO_EDGE);for(var f="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),h=0;6>h;h++)g.texImage2D(g[f[h]],0,g.RGBA,c,c,0,g.RGBA,g.UNSIGNED_BYTE,null);g.bindTexture(e,null);e=b();e.name="CUBEMAP";e.type=a.de;e.source="NONE";e.width=3*c;e.height=2*c;e.Fg=1;e.Ba=d;e.qb=g.TEXTURE_CUBE_MAP;return e};a.dj=function(b,c,d){if(b.type!=a.jf){var e=b.qb;g.bindTexture(e,b.Ba);
c&&g.texParameteri(e,g.TEXTURE_MIN_FILTER,c);d&&g.texParameteri(e,g.TEXTURE_MAG_FILTER,d);g.bindTexture(e,null)}};a.yy=function(b){if(b.type==a.jf)return{min:a.pc,Nu:a.pc};var c=b.qb;g.bindTexture(c,b.Ba);b=g.getTexParameter(c,g.TEXTURE_MIN_FILTER);var d=g.getTexParameter(c,g.TEXTURE_MAG_FILTER);g.bindTexture(c,null);return{min:b,Nu:d}};a.resize=function(b,d,e){d=Math.max(d,1);e=Math.max(e,1);if(b.width!=d||b.height!=e){if(b.type==a.jf)g.bindRenderbuffer(g.RENDERBUFFER,b.ug),g.renderbufferStorage(g.RENDERBUFFER,
g.DEPTH_COMPONENT16,d,e),g.bindRenderbuffer(g.RENDERBUFFER,null);else{var f=b.qb;g.bindTexture(f,b.Ba);var h=c(b),l=k(b);g.texImage2D(f,0,h,d,e,0,h,l,null);g.bindTexture(f,null)}b.width=d;b.height=e}};a.Qs=function(c,d,f){var h=c.type,l=new Uint8Array([204,204,204,255]),k=b();switch(h){case "IMAGE":f=g.createTexture();var p=g.TEXTURE_2D;g.bindTexture(p,f);g.texImage2D(p,0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,l);break;case "NONE":if(c.b4w_render_scene)if(f=n.keysearch("name",c.b4w_render_scene,f))k.Qi=
f,f.Rl=!0,f=g.createTexture(),p=g.TEXTURE_2D,g.bindTexture(p,f),g.texImage2D(p,0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,l);else return;else return;break;case "ENVIRONMENT_MAP":f=g.createTexture();p=g.TEXTURE_CUBE_MAP;g.bindTexture(p,f);for(var G="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" "),Q=0;6>Q;Q++)g.texImage2D(g["TEXTURE_CUBE_MAP_"+G[Q]],0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,l);break;case "VORONOI":case "BLEND":return;default:e.error('B4W warning: texture "'+c.name+
'" has unsupported type "'+h+'"');return}"NONE"==h?g.texParameteri(p,g.TEXTURE_MIN_FILTER,g.LINEAR):g.texParameteri(p,g.TEXTURE_MIN_FILTER,s[m.ij]);g.texParameteri(p,g.TEXTURE_MAG_FILTER,g.LINEAR);l=p;G=c.b4w_anisotropic_filtering;"DEFAULT"===G&&(G=d);"OFF"!==G&&m.Sh&&(d=w.Qt())&&(G=parseFloat(G.split("x")[0]),g.texParameterf(l,d.TEXTURE_MAX_ANISOTROPY_EXT,G));"REPEAT"==c.extension&&"NONE"!=h?(g.texParameteri(p,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(p,g.TEXTURE_WRAP_T,g.REPEAT)):(g.texParameteri(p,
g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(p,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE));g.generateMipmap(p);g.bindTexture(p,null);k.name=c.name;k.type=a.de;k.source=h;k.width=1;k.height=1;k.Fg=1;k.Ba=f;k.qb=p;c.d=k};a.Rs=function(){var c=g.createTexture(),d=g.TEXTURE_2D;g.bindTexture(d,c);g.texParameteri(d,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(d,g.TEXTURE_MIN_FILTER,g.LINEAR);g.texParameteri(d,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(d,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);g.bindTexture(d,
null);var e=document.createElement("canvas");e.width=1;e.height=1;var f=e.getContext("2d"),h=b();h.name="HUD";h.type=a.de;h.source="CANVAS";h.width=1;h.height=1;h.Fg=1;h.Ba=c;h.qb=d;h.canvas=e;h.Vr=f;return h};a.lz=function(a,b,d){if("CANVAS"!=a.source)throw"Wrong texture";b=Math.max(b,1);d=Math.max(d,1);var e=a.canvas;e.width=b;e.height=d;if("CANVAS"!=a.source)throw"Wrong texture";b=a.qb;g.bindTexture(b,a.Ba);d=c(a);var e=k(a),f=a.canvas;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!0);g.texImage2D(b,0,d,
d,e,f);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1);g.bindTexture(b,null);a.width=width;a.height=height};a.pj=function(a,b,c,l){var m=a.source,k=a.qb;g.bindTexture(k,a.Ba);if(4==b.length){var n=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==m)n?(g.texImage2D(k,0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,b),a.width=1,a.height=1):c?(f.Zw(g,w.vn(),b,!0),c=f.An(b),h(c.width,c.height)&&(a.em||e.warn("B4W warning: using NPOT-texture",l),d(k)),a.width=c.width,a.height=c.height,a.Fg=f.Vt(b)):
(g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!0),g.texImage2D(k,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,b),a.width=b.width,a.height=b.height,h(b.width,b.height)?(a.em||e.warn("B4W warning: using NPOT-texture",l),d(k)):g.generateMipmap(k));else if("ENVIRONMENT_MAP"==m)if(c=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],n){for(n=0;6>n;n++)m=c[n],g.texImage2D(g["TEXTURE_CUBE_MAP_"+m[0]],0,g.RGBA,1,1,0,g.RGBA,g.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,
!1);for(var s=b.width/3,n=0;6>n;n++){var m=c[n],p=document.createElement("canvas");p.width=s;p.height=s;var u=p.getContext("2d");"POSITIVE_Y"==m[0]||"NEGATIVE_Y"==m[0]?(u.translate(0,s),u.scale(1,-1)):(u.translate(s,0),u.scale(-1,1));u.drawImage(b,m[1]*s,m[2]*s,s,s,0,0,s,s);g.texImage2D(g["TEXTURE_CUBE_MAP_"+m[0]],0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,p)}a.width=3*s;a.height=2*s;h(b.width/3,b.height/2)?(e.warn("B4W warning: using NPOT cube map texture",l),d(k)):g.generateMipmap(k)}g.bindTexture(k,null)};
a.ct=function(a){g.deleteTexture(a)};a.Wg=function(a){return a&&a.name&&(a.Ba||a.ug)?!0:!1};a.Tn=function(a){return a&&a.name&&a.ug?!0:!1};a.Qy=function(b){return b.type==a.Mh||b.type==a.Nh?!0:!1};a.du=function(b){var c=0;switch(b.type){case a.de:case a.vj:c=4;break;case a.Mh:case a.Nh:c=16;break;case a.xg:c=3;break;case a.jf:c=2}return c}};b4w.module.__assets=function(a,p){function b(){return n()?p(m.xb.Xh).data:null}function d(){var a={Ph:null,er:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},open:function(b,c){a.Ph=c;a.readyState=1},send:function(){a.status=
404;a.readyState=4;var c=b();c&&a.Ph in c&&(a.status=200,c[a.Ph]&&(a.response=a.er(c[a.Ph])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function h(b){for(var d=0,g=0;g<b.length;g++){var f=b[g];f.state===r&&d++;if(d>=x.Su)break;if(f.state===q)switch(f.state=r,d++,f.type){case a.AT_ARRAYBUFFER:c(f,"arraybuffer");break;case a.AT_JSON:c(f,"json");break;case a.AT_TEXT:c(f,"text");break;case a.AT_AUDIOBUFFER:k(f);break;case a.AT_IMAGE_ELEMENT:l(f);
break;case a.AT_AUDIO_ELEMENT:e(f);break;default:throw"Wrong asset type: "+f.type;}}}function c(a,c){var e=b(),f=e&&a.v in e?new d:new XMLHttpRequest;f.open("GET",a.v,!0);"text"==c?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==c?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=c;f.onreadystatechange=function(){if(a.state!=A&&4==f.readyState)if(200==f.status||0==f.status){var b=f.response;if(b){if("json"==c&&"string"==typeof b)try{b=JSON.parse(b)}catch(d){a.sc(null,
a.uri,a.type,a.v);g.error(d+" (parsing JSON "+a.v+")");return}a.sc(b,a.uri,a.type,a.v);a.state=I}else a.sc(null,a.uri,a.type,a.v),g.error("B4W Error: empty responce when trying to get "+a.v)}else a.sc(null,a.uri,a.type,a.v),g.error("B4W Error: "+f.status+" when trying to get "+a.v)};f.addEventListener("progress",function(b){b.lengthComputable&&a.mv(b.loaded/b.total)},!1);f.send(null)}function k(a){var c=b(),e=c&&a.v in c?new d:new XMLHttpRequest;e.open("GET",a.v,!0);e.responseType="arraybuffer";e.onreadystatechange=
function(){if(a.state!=A&&4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?s.Zs(b,function(b){a.sc(b,a.uri,a.type,a.v);a.state=I},function(){a.sc(null,a.uri,a.type,a.v);g.error("B4W Error: failed to decode "+a.v)}):(a.sc(null,a.uri,a.type,a.v),g.error("B4W Error: empty responce when trying to get "+a.v))}else a.sc(null,a.uri,a.type,a.v),g.error("B4W Error: "+e.status+" when trying to get "+a.v)};e.send(null)}function l(a){var c=document.createElement("img");c.onload=function(){a.state!=
A&&(a.sc(c,a.uri,a.type,a.v),a.state=I)};c.addEventListener("error",function(){a.state!=A&&g.error("B4W Error: could not load image: "+a.v)},!1);var d=b();if(d&&a.v in d)if(d[a.v]){var e=f(a.v);c.src="data:"+e+";base64,"+d[a.v]}else d=new CustomEvent("error"),c.dispatchEvent(d);else c.src=a.v}function e(a){var c=document.createElement("audio");c.addEventListener("loadeddata",function(){a.state!=A&&(a.sc(c,a.uri,a.type,a.v),a.state=I)},!1);c.addEventListener("error",function(){a.state!=A&&g.error("B4W Error: could not load sound: "+
a.v)},!1);var d=b();if(d&&a.v in d)if(d[a.v]){var e=w(a.v);c.src="data:"+e+";base64,"+d[a.v]}else d=new CustomEvent("error"),c.dispatchEvent(d);else c.src=a.v;setTimeout(function(){c.sz=1},5E3)}function f(a){var b="image";switch(t.pn(a)){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function w(a){var b="audio";switch(t.pn(a)){case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "mp4":b+="/mp4"}return b}function n(){return b4w.module_check(m.xb.Xh)}var m=p("__config"),
g=p("__print"),s=p("__sfx"),t=p("__util"),y=p("__version"),x=m.td;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;var q=10,r=20,I=30,A=40,G=[],Q=0,u={};a.gl=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.cu=function(a){if(u[a])return u[a];var b=x.Mo?a+y.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=
c.responseText;if(b.length)return u[a]=b;throw"Error XHR: responce is empty, GET "+a;}throw"Error XHR: "+c.status+", GET "+a;};a.cleanup=function(){for(var a=0;a<G.length;a++)G[a].state=A;G=[];Q=0;u={}};a.enqueue=function(a,c,d,e){for(var g=0;g<a.length;g++){var f=a[g],f={uri:f[0],type:f[1],v:f[2],name:f[3],state:q,sc:c||function(){},Do:d||function(){},mv:e||function(){},Eo:Q};if(x.Mo){var l=b();l&&f.v in l||(f.v+=y.timestamp())}G.push(f)}h(G);Q++};a.update=function(){h(G);for(var a=G,b=0,c=!0,d=
0;d<a.length;d++){var e=a[d];e.Eo===a[b].Eo?e.state!==I&&(c=!1):(c&&(a[d-1].Do(),c=d-b,a.splice(b,c),d-=c),b=d,c=a[d].state===I?!0:!1);d===a.length-1&&c&&(a[d].Do(),a.splice(b))}};a.zu=n};b4w.module.__loader=function(a,p){function b(b,c,e,f,h){var l=u,k=g.create(),n;for(n in c){var q=d(c[n]);(f&&q.nb||!b&&q.Hb)&&m(q);g.p(k,q)}for(n in c)for(q=c[n],q.name=n,b=0;b<q.A.length;b++)g.j(k,c[q.A[b]],q,null);c=d({name:"out",Va:a.Tp,Za:function(a,b,c,d,e){0===b.id&&(l.No=!0);b.status!=x&&(b.status=y);h(b.id);e(b,c);s.log("%cTHREAD "+b.id+": LOADED CALLBACK",Q)}});var r=[];if(e)for(e=g.xn(k),b=0;b<e.length;b++)r.push(g.qa(k,e[b]));else g.K(k,function(a,b){b.jb||r.push(b)});g.p(k,c);for(b=0;b<
r.length;b++)c.A.push(r[b].name),g.j(k,r[b],c,null);return k}function d(a){a.jb=a.jb||!1;a.Va||0===a.Va||(a.Va=a.ce);a.A=a.A||[];a.Ug=a.Ug||!1;a.al=a.al||!1;a.zb=a.zb||0;a.nb=a.nb||!1;a.Hb=a.Hb||!1;a.status=q;a.Zy=0;a.Ak=0;a.pe=a.pe||null;return a}function h(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];g.qa(a.Dc,f).Ug&&(g.Vd(a.Dc,f,function(d){var e=!0;g.Ud(a.Dc,d,function(a,b){if(!b.Ug)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-1;0<=e;e--)b.splice(d[e],
1);return c}function c(a){function b(c,d){var e=g.qa(a.Dc,c),f=g.qa(a.Dc,d),h=f.Va-e.Va;0==h&&(h=e.jb-f.jb);return h}var c=[],d=a.nd,e=!1;do{var f=h(a,d);c.push.apply(c,d);0<f.length&&(e=!0);d=f}while(0<f.length);e&&c.sort(b);a.nd=c;return a.nd.length}function k(a,b,c){if(b.al)return b.Ug=!0,G&&s.log("%cTHREAD "+a.id+": SKIP STAGE "+b.name,Q),e(a,b),!1;if(G&&b.status==q){var d=l(a);s.log("%cTHREAD "+a.id+": "+d+"% "+("LOADING START "+b.name)+" "+Math.round(performance.now()-a.zh)+"ms ",Q)}if(!b.Za&&
!b.Eg&&!b.Dg)return e(a,b),!1;if(b.status==q&&(b.status++,b.Za))return b.Za(c,a,b,b.pe,e,f),!0;if(b.status==r){if(b.Eg)return b.Eg(c,a,b,b.pe,e,f),!0;b.status++}return b.status==I&&(b.status++,b.Dg)?(b.Dg(c,a,b,b.pe,e,f),!0):!1}function l(a){if(0==a.gj)return 100;var b=0;g.K(a.Dc,function(c,d){a.do_not_load_resources&&d.nb||(b+=d.Ak*d.zb)});return t.lc(100*b/a.gj)}function e(a,b){b.Ug=!0;b.status=A;w(a,b,1);if(G){var c=l(a);s.log("%cTHREAD "+a.id+": "+c+"% "+("LOADING END "+b.name)+" "+Math.round(performance.now()-
a.zh)+"ms ",Q)}}function f(a,b,c){1>c?w(a,b,c):b.status++}function w(a,b,c){var d=u;if(b.Za||b.Eg||b.Dg)if(b.Ak=c,b=l(a),a.Pm!=b||1==c)a.hl(b,performance.now()-a.zh),a.Pm=b,d.Ek=!0}function n(a,b){var c=null;g.K(a.Dc,function(a,d){if(d.name==b)return c=d,1});return c}function m(a){a.al=!0;a.Ak=1}var g=p("__graph"),s=p("__print"),t=p("__util"),y=2,x=3,q=0,r=1,I=2,A=3,G=!1,Q="color: #f0f;";a.ce=0;a.be=1;a.Tp=2;var u=null;a.wn=function(){return u};a.Ks=function(){var a={Hc:[],Wj:0,yj:0,No:!1,Ek:!1};
return u=a};a.Ss=function(a,c,d,e,f,h,l,m){var k=u,n={id:k.Hc.length,status:0,v:c,hm:"",co:m||!1,Ez:h,zh:0,Pm:0,gj:0,Vk:!1,hl:e||function(){},Fm:f||function(){},Dc:null,nd:null};a=b(0===n.id,a,h,l,d||function(){});n.Dc=a;c=[];d=g.au(a);for(e=0;e<d.length;e++)c.push(d[e]);n.nd=c;g.K(a,function(a,b){!(b.Za||b.Eg||b.Dg)||n.do_not_load_resources&&b.nb||(n.gj+=b.zb)});k.Hc.push(n);k.yj++;return n.id};a.Ww=function(b){var d=u;if(d&&0!=u.yj)if(d.Ek)d.Ek=!1;else{var e=performance.now();do{var f=d.Hc[d.Wj],
h=b[f.id];if(f.status!=x)if(0==f.status&&(f.status=1,f.zh=performance.now(),f.hl(0,0),G&&s.log("%cTHREAD "+f.id+": 0% LOADING START 0ms",Q)),c(f)){var l=f,m=l.nd.length;do{var n=g.qa(l.Dc,l.nd[0]),q=k(l,n,h);n.Va==a.be&&(l.Vk=!0);n=l.nd.shift();l.nd.push(n);m--}while(!q&&0!=m)}else f.Fm(h,f),f.status=x,d.yj--,G&&s.log("%cTHREAD "+f.id+": 100% LOADING END "+Math.round(performance.now()-f.zh)+"ms",Q),l=f,l.hl=null,l.Fm=null,l.Dc=null,l.nd=null;d.No&&(d.Wj=(d.Wj+1)%d.Hc.length);if(f.Vk){f.Vk=!1;break}}while(16>
performance.now()-e)}};a.uz=f;a.bl=function(a,b){var c=n(a,b);null!==c&&m(c)};a.Fw=function(a){return a&&a.status==x};a.is_primary_loaded=function(a){var b=u;if(!b)return!1;a|=0;return b.Hc[a]&&(b.Hc[a].status==x||b.Hc[a].status==y)};a.cleanup=function(){u=null}};b4w.module.__nla=function(a,p){function b(a){l.$c(a)&&l.Ee(a)?h.stop(a,h.SLOT_0):(n.He(a)||n.Nb(a)||c.is_camera(a))&&h.stop(a,h.SLOT_0)}function d(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].strips;if(d)for(var e=0;e<d.length;e++){var f=d[e];b.push({Db:f.frame_start,Vb:f.frame_end,gk:0,Xe:!1,action:f.action?f.action.name:null})}}return b}var h=p("__animation"),c=p("__camera"),k=p("__config");p("__loader");var l=p("__particles"),e=p("__print"),f=p("__scenes"),w=p("__sfx"),n=p("__util"),m=k.ie,g=
[],s=-1;a.Vw=function(a,b){for(var m={Db:a.frame_start,Vb:a.frame_end,Xg:-1,cyclic:b,Fb:[]},k=f.ha(a,"ALL",f.DATA_ID_ALL),s=0;s<k.length;s++){var p=k[s],A=p.animation_data;if(A&&A.nla_tracks.length){A=A.nla_tracks;if(n.He(p)||c.is_camera(p)||n.Nb(p)){var G=d(A);p.lf=G;m.Fb.push(p)}w.Je(p)&&(G=d(A),p.lf=G,m.Fb.push(p))}}for(s=0;s<k.length;s++){p=k[s];for(A=0;A<m.Fb.length;A++)h.get_first_armature_object(p)==m.Fb[A]&&(p.lf=n.Pc(m.Fb[A].lf),m.Fb.push(p));l.$c(p)&&l.Ee(p)&&(p.lf=[{Db:m.Db,Vb:m.Vb+1,gk:0,
Xe:!1,action:null}],m.Fb.push(p))}k=m.Db;s=m.Vb;for(p=0;p<m.Fb.length;p++)for(var A=m.Fb[p],G=A.lf,Q=0;Q<G.length;Q++){var u=G[Q],z=A.name+" ["+u.Db+":"+u.Vb+"]";u.gk=Math.max(0,k-u.Db);u.Db=Math.max(k,u.Db);u.Vb=Math.min(s+1,u.Vb);u.Db>u.Vb&&(e.warn("NLA: out of scene range: "+z),G.splice(Q,1),Q--)}g.push(m)};a.update=function(a,d){-1==s&&(s=a);for(var e=0;e<g.length;e++){var f=g[e],k=(a-s)*m.mb-f.Db;f.cyclic&&(k%=f.Vb-f.Db+1);for(var k=k+f.Db,p=0;p<f.Fb.length;p++){for(var A=f.Fb[p],G=A.lf,Q=0;Q<
G.length;Q++){var u=G[Q];k<f.Xg&&u.Xe&&(b(A),u.Xe=!1)}for(Q=0;Q<G.length;Q++){u=G[Q];if((k<f.Xg||f.Xg<u.Db)&&u.Db<=k&&!u.Xe){var z=A,O=u,F=k,K=O.gk-d*m.mb;l.$c(z)&&l.Ee(z)?(h.apply_def(z),h.set_behavior(z,h.AB_FINISH_STOP,h.SLOT_0),h.set_current_frame_float(z,K,h.SLOT_0),h.play(z,null,h.SLOT_0)):n.He(z)||n.Nb(z)||c.is_camera(z)?(h.apply(z,O.action,h.SLOT_0),h.set_behavior(z,h.AB_FINISH_STOP,h.SLOT_0),h.set_current_frame_float(z,K,h.SLOT_0),h.play(z,null,h.SLOT_0)):w.Je(z)&&w.play(z,0,(O.Vb-F)/m.mb);
u.Xe=!0}f.Xg<u.Vb&&u.Vb<=k&&u.Xe&&(b(A),u.Xe=!1)}}f.Xg=k}};a.cleanup=function(){g.length=0;s=-1}};b4w.module.__camera=function(a,p){function b(b){var d={type:b,name:"",$e:1,width:0,height:0,Cd:null,Ra:null,Ub:null,Wa:0,zc:0,cb:0,Ka:0,left:0,right:0,top:0,bottom:0,Bd:new Float32Array(3),$m:new Float32Array(3),g:new Float32Array(4),oa:new Float32Array(16),ga:new Float32Array(16),sg:new Float32Array(16),lv:new Float32Array(16),Cc:new Float32Array(16),ff:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,ve:null,dof_on:0,hk:{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,
0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),cb:new Float32Array([0,0,0,0]),Ka:new Float32Array([0,0,0,0])},yh:0,Ec:0,fb:null};if(b==a.Pa)return d;switch(b){case a.qc:c(d,H,J,P);break;case a.kf:c(d,K,J,P);break;case a.ee:break;case a.yg:break;case a.zg:break;case a.ib:case a.rb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return d}function d(b,c,d){if(b.type!=a.ib&&b.type!=a.rb)throw"set_stereo_params(): wrong camera type";
b.yh=c;b.Ec=d;g(b,b.Wa)}function h(a,b){var c=a.d,d=A.quat_to_dir(c.g,A.AXIS_MY,S),e=Math.asin(d[1]/G.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?A.quat_to_dir(c.g,A.AXIS_MZ,da):A.quat_to_dir(c.g,A.AXIS_Z,da)),c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b}function c(b,c,d,e,f){switch(b.type){case a.qc:case a.ib:case a.rb:b.zc=c;b.Wa=1;break;case a.kf:b.top=c;b.Wa=1;break;case a.ee:delete b.zc;b.zc=c;b.Wa=f/c;break;case a.yg:b.top=
c;b.Wa=f/c;break;default:I.error("set_frustum(): Unsupported camera type: "+b.type)}b.cb=d;b.Ka=e}function k(b,c){var d=c.d.e,e=c.d.g,f=U;O.rotateX(c.d.G,-Math.PI/2,f);O.invert(f,b.oa);if(b.fb){var f=b.fb[0],h=b.fb[1],l=b.fb[2],m=b.fb[3],k=U;k[0]=1-2*f*f;k[1]=-2*f*h;k[2]=-2*f*l;k[3]=0;k[4]=-2*f*h;k[5]=1-2*h*h;k[6]=-2*h*l;k[7]=0;k[8]=-2*f*l;k[9]=-2*h*l;k[10]=1-2*l*l;k[11]=0;k[12]=-2*f*m;k[13]=-2*h*m;k[14]=-2*l*m;k[15]=1;O.multiply(b.oa,k,b.oa);g(b,b.Wa,!0);f=T;h=U;O.invert(b.oa,h);O.transpose(h,h);
Q.transformMat4(b.fb,h,f);h=oa;h[0]=(A.sign(f[0])+b.ga[8])/b.ga[0];h[1]=(A.sign(f[1])+b.ga[9])/b.ga[5];h[2]=-1;h[3]=(1+b.ga[10])/b.ga[14];Q.scale(f,2/(f[0]*h[0]+f[1]*h[1]+f[2]*h[2]+f[3]*h[3]),f);b.ga[2]=f[0];b.ga[6]=f[1];b.ga[10]=f[2]+1;b.ga[14]=f[3]}b.type==a.ib?b.oa[12]+=b.Ec/2:b.type==a.rb&&(b.oa[12]-=b.Ec/2);O.multiply(b.ga,b.oa,b.ff);t(b);s(b);G.copy(b.Bd,b.$m);G.copy(d,b.Bd);u.copy(e,b.g)}function l(b,c,d,e){O.lookAt(c,d,e,b.oa);b.type==a.ib?b.oa[12]+=b.Ec/2:b.type==a.rb&&(b.oa[12]-=b.Ec/2);
O.multiply(b.ga,b.oa,b.ff);t(b);s(b);G.copy(c,b.Bd)}function e(b){b=b.d;if(b.Xb){var c=S;b.Da==a.MS_TARGET_CONTROLS?G.subtract(b.e,b.ob,c):A.quat_to_dir(b.g,A.AXIS_MY,c);c[1]=0;G.normalize(c,c);var d=-Math.acos(-c[2]);0>c[0]&&(d=-2*Math.PI-d);b.Da==a.MS_EYE_CONTROLS&&(d*=-1);b.Xb.left+=d;b.Xb.right+=d}}function f(b){b=b.d;if(b.hb){var c=S;b.Da==a.MS_TARGET_CONTROLS?G.subtract(b.e,b.ob,c):A.quat_to_dir(b.g,A.AXIS_MY,c);G.normalize(c,c);c=Math.asin(c[1]);b.hb.Wd+=c;b.hb.we+=c}}function w(a){a=a.d;if(a.Xb)if(a.hb){var b=
A.he(a.hb.Wd+Math.PI/2),c=A.he(a.hb.we+Math.PI/2);if(c>Math.PI)a.hb={we:-Math.PI/2,Wd:Math.PI/2};else if(b>Math.PI||b<c)a.hb.Wd=Math.PI/2}else a.hb={we:-Math.PI/2,Wd:Math.PI/2}}function n(a,b,c){if(b==c)return c-a;a=A.he(a);b=A.he(b);c=A.he(c);if(Math.abs(b-c)<N)return 0;b=2*Math.PI-b;c=A.he(c+b);a=A.he(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0}function m(a,b,c){a=a.d;var d=G.subtract(a.ob,a.e,S);b=u.setAxisAngle(b,c,ba);G.transformQuat(d,b,d);G.subtract(a.ob,d,a.e);u.multiply(b,a.g,a.g)}function g(b,
c,d){switch(b.type){case a.qc:if(!c)throw"No aspect ratio";b.Wa=c;case a.ee:O.perspective(A.pv(b.zc),b.Wa,b.cb,b.Ka,b.ga);break;case a.kf:if(!c)throw"No aspect ratio";b.Wa=c;case a.yg:c=b.top*b.Wa;O.ortho(-c,c,-b.top,b.top,b.cb,b.Ka,b.ga);break;case a.zg:O.ortho(b.left,b.right,b.bottom,b.top,b.cb,b.Ka,b.ga);break;case a.ib:case a.rb:if(!c)throw"No aspect ratio";b.Wa=c;var e=Math.tan(b.zc*Math.PI/360);c=b.cb*e;var f=b.Wa*b.yh*e;b.type==a.ib?(e=f-b.Ec/2,f+=b.Ec/2):(e=f+b.Ec/2,f-=b.Ec/2);e=-(b.cb/b.yh*
e);f*=b.cb/b.yh;O.frustum(e,f,-c,c,b.cb,b.Ka,b.ga);b.left=e;b.right=f;break;case a.Pa:return;default:throw"Wrong camera type: "+b.type;}d||(O.multiply(b.ga,b.oa,b.ff),t(b),s(b))}function s(a){O.copy(a.oa,a.Cc);a.Cc[12]=0;a.Cc[13]=0;a.Cc[14]=0;a.Cc[15]=1;O.multiply(a.ga,a.Cc,a.Cc);O.invert(a.Cc,a.Cc)}function t(a){O.copy(a.oa,a.sg);O.multiply(a.ga,a.sg,a.sg);O.invert(a.sg,a.sg)}function y(a){return"CAMERA"===a.type?!0:!1}var x=p("__boundings"),q=p("__config"),r=p("__constraints"),I=p("__print"),A=
p("__util"),G=p("vec3"),Q=p("vec4"),u=p("quat"),z=p("mat3"),O=p("mat4"),F=q.controls;a.Pa=10;a.qc=20;a.kf=30;a.ee=40;a.yg=50;a.zg=60;a.ib=70;a.rb=80;a.MS_STATIC=0;a.MS_ANIMATION=1;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;var K=2.5,H=40,J=0.1,P=1E3,N=0.001,E=new Float32Array(2),S=new Float32Array(3),da=new Float32Array(3),ba=new Float32Array(4),T=new Float32Array(4),oa=new Float32Array(4),Z=new Float32Array(16),U=new Float32Array(16);a.Ur=function(d){var g=d.d,h=d.data;switch(h.type){case "PERSP":var l=
b(a.qc);if(h.angle_y)var m=h.angle_y/Math.PI*180;c(l,m,h.clip_start,h.clip_end);break;case "ORTHO":l=b(a.kf),c(l,h.ortho_scale/2,h.clip_start,h.clip_end)}l.name=d.name;g.jj=F.Sr.slice();g.zp=!1;a:switch(h.b4w_move_style){case "STATIC":m=a.MS_STATIC;break a;case "TARGET":m=a.MS_TARGET_CONTROLS;break a;case "EYE":m=a.MS_EYE_CONTROLS;break a;default:throw"Unknown move style";}g.Da=m;g.dof_distance=d.data.dof_distance;g.ve=d.data.dof_object;g.dof_front=d.data.b4w_dof_front;g.dof_rear=d.data.b4w_dof_rear;
g.dof_power=d.data.b4w_dof_power;g.R=[l];g.Da==a.MS_TARGET_CONTROLS&&g.ob.set(h.b4w_target);g=d.d;if(g.Da===a.MS_TARGET_CONTROLS||g.Da===a.MS_EYE_CONTROLS)h=d.data,h.b4w_use_horizontal_clamping&&(g.Xb={left:h.b4w_rotation_left_limit,right:h.b4w_rotation_right_limit}),h.b4w_use_vertical_clamping&&(g.hb={we:h.b4w_rotation_down_limit,Wd:h.b4w_rotation_up_limit}),"LOCAL"==h.b4w_horizontal_clamping_type&&e(d),"LOCAL"==h.b4w_vertical_clamping_type&&f(d),w(d),g.pg=h.b4w_use_distance_limits&&h.b4w_distance_min<=
h.b4w_distance_max,g.pg&&(g.ue=h.b4w_distance_min,g.mi=h.b4w_distance_max)};a.$a=b;a.Ox=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.Ra);case "DEPTH":return Boolean(a.Ub);case "SCREEN":return!Boolean(a.Ra)&&!Boolean(a.Ub);default:throw"Wrong attachment type: "+b;}};a.cj=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.Ra=c;break;case "DEPTH":a.Ub=c;break;case "SCREEN":a.Ra=null;a.Ub=null;break;default:throw"Wrong attachment type: "+b;}};a.wy=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.Ra;
case "DEPTH":return a.Ub;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.fo=function(b,c){if(b.type!=a.qc||c!=a.ib&&c!=a.rb)throw"make_stereo(): wrong camera type";b.type=c;d(b,6,0.065)};a.Vv=d;a.To=function(a,b){var c=a.d.g,d=ba,e=S;e[0]=0;e[1]=1;e[2]=0;u.setAxisAngle(e,b,d);u.multiply(d,c,c)};a.oz=function(a,b){var c=a.d.g,d=ba,e=S;e[0]=1;e[1]=0;e[2]=0;u.setAxisAngle(e,b,d);u.multiply(d,c,c)};a.nz=function(a,b){var c=a.d.g;u.invert(c,c);var d=ba,e=S;e[0]=0;e[1]=0;e[2]=1;
u.setAxisAngle(e,-b,d);u.multiply(d,c,c);u.invert(c,c)};a.Wk=function(a,b){var c=a.d.g;u.invert(c,c);var d=ba,e=S;e[0]=1;e[1]=0;e[2]=0;u.setAxisAngle(e,-b,d);u.multiply(d,c,c);u.invert(c,c)};a.get_angles=h;a.Wo=c;a.Rv=function(b,c,d,e,f,g,h){switch(b.type){case a.zg:b.left=c;b.right=d;b.bottom=e;b.top=f;b.cb=g;b.Ka=h;break;default:I.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.d.Da};a.qz=k;a.rz=l;a.Zo=function(a,b,c){var d=S;d[0]=0;d[1]=
-1;d[2]=0;G.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=da;e[0]=0;e[1]=0;e[2]=-1;G.transformQuat(e,c,e);l(a,b,d,e)};a.pz=function(a,b,c){if("CAMERA"!=a.type)throw"Wrong camera object";a=a.d;a.e.set(b);a.g.set(c)};a.tt=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];O.lookAt(a,b,c,U);O.invert(U,U);O.rotateX(U,Math.PI/2,U);z.fromMat4(U,Z);u.fromMat3(Z,e)};a.Ap=function(a){var b=a.d.R;if(!b)throw"Wrong object";for(var c=a.d,d=0;d<b.length;d++){var e=b[d];k(e,a);A.Ym(e.ff,e.hk);if(e.ve)if(e.dof_on){var f=
G.dist(c.e,e.ve.location);e.dof_distance=f}else e.dof_distance=0}};a.Pw=function(b){var c=b.d;if(c.Da==a.MS_TARGET_CONTROLS)if(c.pg){if(r.Ev(c.e,c.g,c.ob,c.ue,r.Rp)){var d=G.subtract(c.e,c.ob,S);G.scale(d,-c.ue/G.length(d),d);G.add(c.ob,d,c.e)}}else r.Dv(c.e,c.g,c.ob);c.Da!=a.MS_TARGET_CONTROLS&&c.Da!=a.MS_EYE_CONTROLS||r.correct_up(b,A.AXIS_Y)};a.tu=e;a.ex=f;a.ul=w;a.fs=function(b){var c=b.d;if(c.Da===a.MS_TARGET_CONTROLS||c.Da===a.MS_EYE_CONTROLS){if(c.Xb){var d=c.Xb.left,e=c.Xb.right,f=h(b,E),
f=f[0],f=c.Da==a.MS_TARGET_CONTROLS?f-Math.PI:-1*f;if(f=n(f,d,e))c.Da==a.MS_TARGET_CONTROLS?m(b,A.AXIS_Y,f):(f=u.setAxisAngle(A.AXIS_MY,f,ba),u.multiply(f,b.d.g,b.d.g))}c.hb&&(d=c.hb.we,e=c.hb.Wd,f=h(b,E),f=f[1],c.Da==a.MS_TARGET_CONTROLS&&(f*=-1),f=0<A.quat_to_dir(c.g,A.AXIS_Z,S)[1]?A.sign(f)*Math.PI-f:f,f=n(f,d,e))&&(c.Da==a.MS_TARGET_CONTROLS?(d=A.quat_to_dir(b.d.g,A.AXIS_MX,da),m(b,d,f)):(d=f,f=b.d,e=A.quat_to_dir(f.g,A.AXIS_X,S),d=u.setAxisAngle(e,d,ba),u.multiply(d,f.g,f.g)));c.Da==a.MS_TARGET_CONTROLS&&
c.pg&&(b=b.d,c=G.subtract(b.e,b.ob,S),f=G.length(c),f>b.mi?(G.scale(c,b.mi/f,c),G.add(b.ob,c,b.e)):f<b.ue&&(f=A.quat_to_dir(b.g,A.AXIS_MY,da),G.scale(f,100*b.ue,f),G.add(c,f,c),G.scale(c,-b.ue/G.length(c),c),G.add(b.ob,c,b.e)))}};a.Ry=function(b){switch(b.type){case a.qc:case a.kf:case a.ib:case a.rb:return!0;default:return!1}};a.Pt=function(b){b=b.d.R[0];switch(b.type){case a.qc:case a.ee:case a.ib:case a.rb:return Math.PI*b.zc/180;default:return I.error("get_min_fov(): Unsupported camera type: "+
b.type),0}};a.Tf=g;a.Pr=s;a.Qr=t;a.Xm=function(b,c,d,e){e||(e=new Float32Array(24));c||(c=b.cb);d||(d=b.Ka);var f,g,h,l,m,k,n,q;switch(b.type){case a.Pa:throw"Extraction from NONE camera is not possible";case a.qc:case a.ee:f=c*Math.tan(b.zc*Math.PI/360);g=f*b.Wa;l=-f;h=-g;m=d*Math.tan(b.zc*Math.PI/360);k=m*b.Wa;q=-m;n=-k;break;case a.kf:case a.yg:h=b.top*b.Wa;f=m=b.top;g=k=h;l=q=-b.top;h=n=-h;break;case a.zg:f=m=b.top;g=k=b.right;l=q=b.bottom;h=n=b.left;break;case a.ib:case a.rb:f=c*Math.tan(b.zc*
Math.PI/360);g=b.right;l=-f;h=b.left;n=d/c;m=f*n;k=g*n;q=l*n;n*=h;break;default:throw"Wrong camera type: "+b.type;}e[0]=h;e[1]=l;e[2]=-c;e[3]=g;e[4]=l;e[5]=-c;e[6]=g;e[7]=f;e[8]=-c;e[9]=h;e[10]=f;e[11]=-c;e[12]=n;e[13]=q;e[14]=-d;e[15]=n;e[16]=m;e[17]=-d;e[18]=k;e[19]=m;e[20]=-d;e[21]=k;e[22]=q;e[23]=-d;c=U;O.invert(b.oa,c);A.ih(e,c,e,0);return e};a.Er=function(a){a=a.d;var b=x.nc();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.vb=b;var c=x.Tj(1,[0,0,0]);a.hc=c;a.Hj=x.Hm(1,b);a.Jj=
x.Jm(1,b);a.Ij=x.Im(1,b)};a.is_camera=y;a.Af=function(b){return y(b)&&b.d&&b.d.Da==a.MS_TARGET_CONTROLS?!0:!1}};b4w.module.__lights=function(a,p){function b(a){a.nf[0]=a.color[0]*a.tf;a.nf[1]=a.color[1]*a.tf;a.nf[2]=a.color[2]*a.tf}var d=p("__util"),h=p("vec3"),c=0;a.Iu=function(a){var l={};l.direction=new Float32Array(3);h.normalize(l.direction,l.direction);l.color=new Float32Array(3);l.tf=1;l.nf=new Float32Array(3);b(l);l.distance=25;l.Mt=!1;l.index=c++;l.name=a.name;var e=a.data;l.type=e.type;var f=d.quat_to_dir(a.d.g,d.AXIS_Y,[]);h.normalize(f,f);l.direction[0]=f[0];l.direction[1]=f[1];l.direction[2]=f[2];
l.color[0]=e.color[0];l.color[1]=e.color[1];l.color[2]=e.color[2];l.tf=e.energy;b(l);l.distance=e.distance;if("POINT"===l.type||"SPOT"===l.type)l.ky=e.falloff_type;"SPOT"===l.type&&(l.sw=e.spot_size,l.rw=e.spot_blend);l.Mt=e.b4w_generate_shadows;l.it=e.b4w_dynamic_intensity;a.Cb=l};a.Tv=function(a,c){a.color[0]=c[0];a.color[1]=c[1];a.color[2]=c[2];b(a)};a.Xo=function(a,c){a.tf=c;b(a)};a.Tw=function(a){if("LAMP"!=a.type)throw"Wrong light object";var b=a.Cb;b&&d.quat_to_dir(a.d.g,d.AXIS_Y,b.direction)};
a.cleanup=function(){c=0}};b4w.module.__scenes=function(a,p){function b(){if(!Fa)throw"no active scene";return Fa}function d(){return Fa?!0:!1}function h(a,b,c,d){d|=0;for(var e=null,f=0;f<b.length;f++){var g=b[f];if((c?g.origin_name:g.name)==a&&g.d.Tc==d){e=g;break}}return e}function c(a,b){b||(b="ALL");var c=[];k(a.objects,b,c);return c}function k(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];"ALL"!=b&&b!=e.type||c.push(e);(e=e.dupli_group)&&k(e.objects,b,c)}}function l(b){var c=J(b),d=[];b=H(b,"MESH",a.DATA_ID_ALL);for(var e=
0;e<c.length;e++){var f=c[e];if(f.b4w_water){for(var g={},h=0;h<b.length;h++)for(var B=b[h],l=B.data.materials,m=0;m<l.length;m++)l[m]==f&&(g.Yd=B.location[1]);if(wa.deferred_rendering)for(g.wb=f.b4w_water_fog_color.slice(0),g.wb.push(f.b4w_water_fog_density),f.b4w_water_dynamic?(g.sf=!0,g.waves_height=f.b4w_waves_height,g.waves_length=f.b4w_waves_length,g.dst_noise_scale0=f.b4w_water_dst_noise_scale0,g.dst_noise_scale1=f.b4w_water_dst_noise_scale1,g.dst_noise_freq0=f.b4w_water_dst_noise_freq0,g.dst_noise_freq1=
f.b4w_water_dst_noise_freq1,g.dir_min_shore_fac=f.b4w_water_dir_min_shore_fac,g.dir_freq=f.b4w_water_dir_freq,g.dir_noise_scale=f.b4w_water_dir_noise_scale,g.dir_noise_freq=f.b4w_water_dir_noise_freq,g.dir_min_noise_fac=f.b4w_water_dir_min_noise_fac,g.dst_min_fac=f.b4w_water_dst_min_fac,g.waves_hor_fac=f.b4w_water_waves_hor_fac):(g.sf=!1,g.waves_height=0,g.waves_length=0),g.ai=null,g.Pj=null,g.Qj=new Float32Array(2),g.fj=null,f=f.texture_slots,h=0;h<f.length;h++)B=f[h].texture,"VORONOI"==B.type&&
(g.ai=B.noise_scale,g.Qj.set(B.b4w_uv_velocity_trans),g.Pj=B.noise_intensity),!0===B.b4w_shore_dist_map&&(g.fj=B.image,g.Wf=B.image.size[0],g.ew=B.b4w_shore_boundings,g.Kf=B.b4w_max_shore_dist);else g.waves_height=0,g.waves_length=0,g.ai=null,g.Pj=null,g.Qj=null,g.wb=null,g.sf=!1;d.push(g)}}if(0<d.length){g=d[0];if(!g.sf)for(e=0;e<d.length;e++)d[e].sf&&(g=d[e]);return g}return null}function e(a){return a.world.b4w_sky_settings.procedural_skydome?!0:!1}function f(a){var b={};a=a.world.b4w_sky_settings;
b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.Xf=a.color;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}function w(a){var b=
{};a=a.world.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.dithering_amount=a.dithering_amount;b.gauss_center=a.gauss_center;b.gauss_width_square=a.gauss_width*a.gauss_width;b.gauss_width_left_square=a.gauss_width_left*a.gauss_width_left;b.influence=a.influence;b.dist_factor=a.dist_factor;b.Gv=a.samples;return b}function n(a){var b=a.world;a=[0,0,0];var c=[0,0,0],d=b.light_settings,e=b.texture_slots;if(d.use_environment_light)if("SKY_COLOR"==d.environment_color||"SKY_TEXTURE"==d.environment_color)a=
b.horizon_color.slice(0),c=b.zenith_color.slice(0);else if("PLAIN"==d.environment_color)a=[1,1,1],c=[1,1,1];else throw"Unsupported world environment color"+d.environment_color;b={};b.Ad=d.environment_energy;b.Wb=a;b.ec=c;b.Yf=e;return b}function m(b){b=H(b,"MESH",a.DATA_ID_ALL);for(var c=0;c<b.length;c++)if(b[c].d.jd)return!0;return!1}function g(a,b,c){c=na.Pi(a,b);na.Ud(a,c,function(a,c,d){if(d.sa){switch(d.C){case "COLOR":case "CUBEMAP":a=c.i.Ra;break;case "DEPTH":a=c.i.Ub;break;case "SCREEN":a=
null;break;default:throw"Wrong slink";}switch(d.T){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:if(!a)throw"Connection of SCREEN is forbidden";c=b.m;for(var e=0;e<c.length;e++){var f=c[e].l;la.tm(f.Ab,d.T)&&M.Bg(f,a,d.T)}}}});for(a=0;a<b.X.length;a++){var d=b.X[a],e=b.Gc[a];switch(d.T){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:for(var f=b.m,g=0;g<f.length;g++)c=f[g].l,la.tm(c.Ab,d.T)&&M.Bg(c,e,d.T)}}}function s(a,b,c,d,e){var f=
b.d;b=b.O;for(var h=0;h<b.length;h++){var B=b[h];if(!(B.Lb||B.Jb||"MAIN"!=B.type&&"NODES"!=B.type&&"PARTICLES"!=B.type||A(a,B))){if("OPAQUE"===d){if(B.ma)continue;var l=ja.Ca(c,"SHADOW_CAST")&&B.gb?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE"}else if("BLEND"===d){if(!B.ma)continue;if(ja.Ca(c,"SHADOW_CAST")&&B.gb)switch(wa.Ze){case "RGBA":l="SHADOW_SRC_RGBA";break;case "RGBA_PCF":l="SHADOW_SRC_RGBA_PCF";break;case "DEPTH":l="SHADOW_SRC_DEPTH";break;case "VSM":l="SHADOW_SRC_VSM";break;default:throw"Wrong shadows type";
}else l="SHADOW_SRC_NONE"}else throw"Wrong main subscene type";var m=B.Fa;la.I(m,"SHADOW_SRC",l);M.Bj(B,u(e));la.I(m,"NUM_LIGHTS",a.Nf);"special_skydome.glslf"==la.qn(m)&&la.I(m,"REFLECTION_PASS",0);la.I(m,"SSAO_ONLY",0);a.ra&&a.mc?la.I(m,"WATER_EFFECTS",1):la.I(m,"WATER_EFFECTS",0);a.ra&&a.oe&&f.oe?(la.I(m,"CAUSTICS",1),la.I(m,"CAUST_SCALE",a.pm),la.I(m,"CAUST_SPEED",la.s(a.qm,2)),la.I(m,"CAUST_BRIGHT",a.om)):la.I(m,"CAUSTICS",0);a.ra&&(la.I(m,"WAVES_HEIGHT",la.s(a.Zd)),la.I(m,"WAVES_LENGTH",la.s(a.gf)),
la.I(m,"WATER_LEVEL",la.s(a.Yd)));B.ac&&ja.Ca(c,"MAIN_REFLECT")&&-1===B.Rb.indexOf("u_mirrormap")?la.I(m,"REFLECTIVE",1):la.I(m,"REFLECTIVE",0);var k=ja.Ca(c,"SKY");if(k)if(B.Qf){var v=k.i.Ra;M.Bg(B,v,"u_sky")}else!wa.kh||"MAIN_OPAQUE"!==a.type&&"MAIN_BLEND"!==a.type?la.I(m,"PROCEDURAL_FOG",0):(B.vc=k.vc,la.I(m,"PROCEDURAL_FOG",1));else la.I(m,"PROCEDURAL_FOG",0);if("SKY_TEXTURE"==e.world.light_settings.environment_color){v=null;if(e.world.b4w_sky_settings.procedural_skydome&&e.world.b4w_sky_settings.use_as_environment_lighting)v=
k.i.Ra;else for(h=0;h<a.Yf.length;h++)if(a.Yf[h].texture.b4w_use_as_environment_lighting){v=M.St(a.Yf[h],!1);break}v?(la.I(m,"SKY_TEXTURE",1),M.Bg(B,v,"u_sky_texture")):pa.warn("B4W Warning: environment lighting is set to 'Sky Texture', but there is no world texture with environment map")}B.pa&&(k=ja.Ca(c,"GRASS_MAP"))&&I(B,k,f);ja.Ca(c,"REFRACT")&&B.Uk?la.I(m,"REFRACTIVE",1):la.I(m,"REFRACTIVE",0);B.Xd&&(B.yl&&ja.Ca(c,"DEPTH")?la.I(m,"SHORE_SMOOTHING",1):la.I(m,"SHORE_SMOOTHING",0),B.water_dynamic&&
a.ra&&a.Zd?la.I(m,"DYNAMIC",1):la.I(m,"DYNAMIC",0));"PARTICLES"==B.type&&(la.I(m,"SIZE_RAMP_LENGTH",B.Bo),la.I(m,"COLOR_RAMP_LENGTH",B.ro));if("OPAQUE"===d||"BLEND"===d){for(var k=B.Aa,n=0;n<k.length;n++){var v=k[n],q=v.Qi;if(q){var s=q.d.La,L=null,aa=null;na.af(s,function(a,b,c){if("SCREEN"==c.C)return L=na.qa(s,a),aa=c,!0});if(!L||!aa)throw"Failed to assign RTT";ya.dj(v,ya.t,ya.t);aa.ka=v;var w=L.i;w.Ra=v;w.Cd=R.Ro(v,null);P(q,pb.ah,pb.ah,!0);v=ja.Lm(s);for(q=v.length-1;0<=q;q--)w=v[q],W.Tf(w.i,
1),e.d.Zi.unshift(w)}}if(B.Bf){var k=0,ca;for(ca in B.Bf)k++;la.I(m,"NUM_LAMP_LIGHTS",k);B.xk=new Float32Array(3*k);B.vk=new Float32Array(3*k);B.uk=new Float32Array(3*k);B.wk=new Float32Array(4*k);for(n=0;n<e.tb.LAMP.length;n++)t(B,e.tb.LAMP[n])}}r(c,a,l);M.Bb(B);l={M:!0,Ma:f,l:B};y(B);a.m.push(l);g(c,a,B);x(B)}}a.m.sort(function(a,b){var c;if(a.l&&b.l){c=a.l.ma;var d=b.l.ma;(c=c==d?0:c>d?1:-1)||(c=a.l.Pe,d=b.l.Pe,c=c==d?0:c>d?1:-1)}else c=0;return c})}function t(a,b){var c=b.uuid;if(c in a.Bf){c=
a.Bf[c];a.xk.set(b.d.e,3*c);a.vk.set(b.Cb.direction,3*c);a.uk.set(b.Cb.nf,3*c);var d=jc;O(b.Cb,Wa,d);a.wk.set(d,4*c)}}function y(a){var b=a.Ab.attributes,c=a.Ya.Gb,d;for(d in b)if(!c[d])throw'B4W Error: missing data for "'+d+'" attribute';"MAIN"==a.type&&(b=4+q(a.Ab.attributes,["a_color","a_tangent","a_texcoord"]),b+=q(a.Ab.bf,["u_shadow_map0","u_shadow_map1","u_shadow_map2","u_shadow_map3","u_shadow_mask"]),b>qb&&pa.warn("B4W Warning: Varying limit exceeded for main shader - "+b+', materials "'+
a.ic.join(", ")+'"'));"NODES"==a.type&&(b=2,d=c=0,a.cf&&(c+=Ha.Qg(a.cf),b+=c),a.Ga&&(d+=Ha.Qg(a.Ga),b+=d),b+=q(a.Ab.attributes,["a_color","a_normal","a_tangent"]),b+=q(a.Ab.bf,["u_shadow_map0","u_shadow_map1","u_shadow_map2","u_shadow_map3","u_shadow_mask"]),b>qb&&pa.warn("B4W Warning: Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials "'+a.ic.join(", ")+'"'))}function x(a){a.Aa.length>qc&&pa.warn("B4W Warning: too many textures used - "+a.Aa.length+" (max "+qc+'), materials "'+
a.ic.join(", ")+'"')}function q(a,b){for(var c=0,d=0;d<b.length;d++)b[d]in a&&c++;return c}function r(a,b,c){for(var d=0,e=ja.rn(a,b),f=0;f<e.length;f++){var g=e[f];"SHADOW_SRC_RGBA"!=c&&"SHADOW_SRC_RGBA_PCF"!=c&&"SHADOW_SRC_DEPTH"!=c&&"SHADOW_SRC_VSM"!=c||"SHADOW_CAST"!=g.type&&"POSTPROCESSING"!=g.type||(g=ja.vt(a,g,"SHADOW_CAST").i,b.Ep=g.oa,b.fm=new Float32Array([0.5,0,0,0,0,0.5,0,0,0,0,0.5,0,0.5,0.5,0.5,1]),b.Te=b.Te||[],b.Te[d]=g.ga,d++)}}function I(a,b,c){a.Eb=b.Eb;var d=b.Eb[0],e=b.Eb[1],f=
b.Eb[2];c=c.vb;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);f=0==f?c:Math.max(f,c);b.Eb[2]=f;b=b.i;W.Wo(b,f/2,-e,-d,f/2);W.Tf(b);d=a.qk||0;d=0==d?c:Math.max(d,c);a.qk=d}function A(a,b){for(var c=a.m,d=0;d<c.length;d++){var e=c[d].l;if(e&&e.id==b.id)return!0}return!1}function G(a){var b=S(a,"MAIN_OPAQUE");na.K(a.d.La,function(c,d){"SHADOW_CAST"===d.type&&Q(d,b,d.m,a)})}function Q(b,c,d,e){if(0!=d.length){var f=b.i;c=c.i;var g=H(e,"LAMP",a.DATA_ID_ALL),h;a:{for(h=0;h<g.length;h++){var B=g[h];if(B.data.b4w_generate_shadows){h=
B;break a}}h=!1}g=(h||g[0]).d;W.Zo(f,g.e,g.g);Ba.copy(c.Bd,f.Bd);e=e.d.wh;b=b.Mm+1;g=e.csm_near;h=e.csm_far;B=e.csm_num;e=e.csm_lambda;b=e*g*Math.pow(h/g,b/B)+(1-e)*(g+b/B*(h-g));b=b>c.Ka?c.Ka:b;e=Ec;g=Lc;W.Xm(c,c.cb,b,g);Ha.ih(g,f.oa,g,0);fa.Hr(g,e);c=kc;fa.nc(c);g=f.oa;h=!1;for(B=0;B<d.length;B++){var m=fa.Wh(d[B].Ma.Ha,g,Mc);fa.Yr(m,e)&&(h?fa.Vm(c,m):(fa.ps(m,c),h=!0))}d=c.max_z;fa.gw(c,e,c);c.max_z=d;d=c.max_x-c.min_x;e=c.max_y-c.min_y;h=64/Math.ceil(64/(d/(2*b)));g=64/Math.ceil(64/(e/(2*b)));
h=2*h*b;b*=2*g;c.min_x-=0.5*(h-d);c.max_x+=0.5*(h-d);c.min_y-=0.5*(b-e);c.max_y+=0.5*(b-e);d=(c.max_x-c.min_x)/pb.Ye;b=(c.max_y-c.min_y)/pb.Ye;c.min_x=Math.floor(c.min_x/d)*d;c.max_x=Math.floor(c.max_x/d)*d;c.min_y=Math.floor(c.min_y/b)*b;c.max_y=Math.floor(c.max_y/b)*b;W.Rv(f,c.min_x,c.max_x,c.min_y,c.max_y,-c.max_z,-c.min_z);W.Tf(f);Ha.Ym(f.ff,f.hk)}}function u(a){var b=a.d.wh;a=b.csm_near;for(var c=b.csm_far,d=b.csm_num,b=b.csm_lambda,e=[],f=1;f<=d;f++){var g=b*a*Math.pow(c/a,f/d)+(1-b)*(a+f/d*
(c-a));g===Math.round(g)&&(g+=1E-4);e.push(g)}return e}function z(a){var b=Ha.bi(a);a.Fa=JSON.parse(JSON.stringify(a.Fa));return b}function O(a,b,c){b[0]=1;b[1]=0;b[2]=0;b[3]=0;c[0]=-1;c[1]=-1;c[2]=-1;c[3]=0;switch(a.type){case "HEMI":b[0]=0.5;b[1]=0.5;break;case "POINT":c[2]=a.distance;break;case "SPOT":c[2]=a.distance,b=c[0]=Math.cos(a.sw/2),c[1]=a.rw*(1-b)}}function F(a,b){for(var c=E(b,ab),d=a.Cb,e=a.d,f=d.index,g=0;g<c.length;g++){var h=c[g];h.Gf.set(e.e,3*f);h.Df.set(d.direction,3*f);h.Cf.set(d.nf,
3*f);var B=Wa,m=jc;O(d,B,m);switch(d.type){case "SUN":if(h.sp.set(e.g),h.rp=d.nf,"SKY"===h.type){var l=Va;l[0]=l[1]=l[2]=1;var k=Math.acos(Ba.dot(h.hj,l)),l=Math.acos(Ba.dot(d.direction,l));h.Oi=Math.floor(k/0.025)!=Math.floor(l/0.025)?!0:!1;Ba.copy(d.direction,h.hj);K(b,h)}else Ba.copy(d.direction,h.hj);case "HEMI":case "POINT":case "SPOT":break;default:pa.error("B4W Warning: unknown light type: "+d.type)}h.Ef.set(B,4*f);h.Ff.set(m,4*f);h.wa=!0}c=E(b,ib);for(d=0;d<c.length;d++)switch(e=c[d],e.type){case "MAIN_OPAQUE":case "MAIN_BLEND":for(f=
0;f<e.m.length;f++)g=e.m[f].l,g.Bf&&t(g,a)}}function K(a,b){R.oi(b);if(b.Oi)for(var c=E(a,["MAIN_OPAQUE","MAIN_BLEND"]),d=0;d<c.length;d++)for(var e=c[d].m,f=0;f<e.length;f++){var g=e[f];g.M&&(g=g.l,M.Xr(g)&&R.Mw(g))}}function H(b,c,d){if(!b.tb)throw"Access to uninitialized scene";b=b.tb[c];if(d==a.DATA_ID_ALL)return b;c=[];for(var e=0;e<b.length;e++){var f=b[e];f.d.Tc==d&&c.push(f)}return c}function J(b){var c=[];b=H(b,"MESH",a.DATA_ID_ALL);for(var d=0;d<b.length;d++)for(var e=b[d].data,f=0;f<e.materials.length;f++){var g=
e.materials[f];-1==c.indexOf(g)&&c.push(g)}return c}function P(a,b,c,d){for(var e=a.camera.d.R,f=0;f<e.length;f++)W.Tf(e[f],b/c);W.Ap(a.camera);ja.Jw(a.d.La,function(e,f,g){if(d||e.Eh){var h=e.$e*b,B=e.$e*c;if(f)for(f=0;f<g.X.length;f++)g.X[f]==e&&ya.resize(e.ka,h,B);else ya.Wg(e.ka)&&ya.resize(e.ka,h,B),e=g.i,e.width=h,e.height=B,"DOF"==g.type&&da(a,{dof_power:g.i.dof_power,dof_on:g.i.dof_on}),N(g,1/b,1/c)}})}function N(a,b,c){a=a.m;for(var d=0;d<a.length;d++){var e=a[d].l;e&&M.vh(e,b,c)}}function E(a,
b){for(var c=[],d=0;d<b.length;d++){var e=b[d];na.K(a.d.La,function(a,b){b.type==e&&c.push(b)})}return c}function S(a,b){return ja.Ca(a.d.La,b)}function da(a,b){var c=S(a,"DOF");if(!c)return pa.error("DOF is not enabled on scene. Check camera settings"),0;var d=a.d.La;"boolean"==typeof b.dof_on&&(c.i.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.i.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.i.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.i.dof_rear=b.dof_rear);
if("number"==typeof b.dof_power){c.i.dof_power=b.dof_power;for(var e=ja.Ta(d,c,"POSTPROCESSING"),d=ja.Ta(d,e,"POSTPROCESSING"),e=[e,d],d=0;d<e.length;d++){var f=e[d].m[0].l;f&&(M.ld(f,c.i.dof_power),N(e[d],1/c.i.width,1/c.i.height))}}c.wa=!0}function ba(a,b){var c=S(Fa,"MAIN_OPAQUE");if(!c||!c.ra)return pa.error("get_water_surface_level() - no water parameters on this scene"),0;var d=c.Zd,e=c.gf,f=c.Yd,g=c.ra;if(!d||!g.sf)return g.Yd;var h=Ba.length(c.Jh),B=c.time;h&&(B*=h);var m=Dc;m[0]=20/e*(a-
0.25*B);m[1]=20/e*(b-0.25*B);h=Ha.rm(m);m[0]=17/e*(b+0.1*B);m[1]=17/e*(a+0.1*B);var m=Ha.rm(m),h=h+m-1,l=g.dst_noise_scale0,m=g.dst_noise_scale1,k=g.dst_noise_freq0,v=g.dst_noise_freq1,n=Dc;n[0]=l*(a+k*B);n[1]=l*(b+k*B);l=Ha.dl(n);n[0]=m*(b-v*B);n[1]=m*(a-v*B);m=Ha.dl(n);m*=d*l;if(c.sj)if(v=(a-c.Od[0])/c.Pd[0],n=(c.Od[1]+b)/c.Pd[1],v+=0.5,n+=0.5,1<v||0>v||1<n||0>n)d=m;else var v=Ha.kn(Fa.d.$k,c.Wf,v,n),l=g.dir_freq,q=g.dir_noise_scale,s=g.dir_noise_freq,k=g.dir_min_noise_fac,n=g.dst_min_fac,c=e/c.Kf/
Math.PI,q=[q/e*(a+s*B),q/e*(b+s*B)],e=Math.sqrt(v),d=d*Math.max(v,g.dir_min_shore_fac)*Math.sin(e/c+l*B)*Math.max(Ha.dl(q),k),g=Math.max(e,n),d=d*(1-g)+m*g,h=h*v;else d=m;return f+(d+0.05*h)}function T(a,b){a.Vg&&"POSTPROCESSING"==a.type&&b.M!=a.M&&(a.M=b.M);b.M||"GLOW"!=a.type||(a.$j=0)}function oa(a,b,c,d){var e=na.qa(a,b);W.cj(e.i,c,d);e.Cj=!0;na.Vd(a,b,function(b,e,f){f.sa&&f.C==c&&ja.es(f)&&Z(a,b,f.T,d)});na.Ud(a,b,function(b,e,f){f.sa&&f.C==c&&f.C==f.T&&oa(a,b,c,d)})}function Z(a,b,c,d){a=na.qa(a,
b).m;for(b=0;b<a.length;b++)M.Cv(a[b].l,d,c)}function U(a){var b=S(a,"GRASS_MAP");if(b){var c=b.i,d=a.camera.d,e=d.e;a=Va;a[0]=0;a[1]=-b.Eb[2]/2;a[2]=0;Ba.transformQuat(a,d.g,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=Db;b[0]=0;b[1]=0;b[2]=0;b[3]=1;W.Zo(c,a,b)}}function D(a,b){na.K(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.X[0]||!d.Gc[0])throw"Wrong MOTION_BLUR subscene";var e=d.X[0],f=d.Gc[0];d.Gc[0]=d.i.Ra;na.Vd(a,c,function(b,c,d){d.sa&&Z(a,b,d.T,f)});oa(a,c,e.C,f);Z(a,c,e.T,d.Gc[0]);d.io=Math.exp(-b/
d.Li)}})}function ha(b,c){var d=0,e=b.cr;0==e.nl&&(e.nl=c);var f=c-e.nl;if(e.Qo&&f/e.Xi>=e.Qo)a.clear_glow_anim(b);else{f%=e.Xi;if(f<e.Bn)switch(e=f/(e.Bn/5),f=Math.floor(e),f){case 0:d=(e-f)/2;break;case 1:d=(e-f)/2+0.5;break;case 2:d=1;break;case 3:d=1-(e-f)/2;break;case 4:d=0.5-(e-f)/2}for(e=0;e<b.O.length;e++)f=b.O[e],"COLOR_ID"==f.type&&(f.xf=d)}}function L(a){na.K(a.d.La,function(a,b){b.wa=!0})}function v(a){if("WIND"==a.field.type){a=a.d;Ha.quat_to_dir(a.g,Ha.AXIS_Y,bb);Ba.normalize(bb,bb);
Ba.scale(bb,a.fk,bb);a=Pa;for(var b=0;b<a.length;b++)for(var c=E(a[b],Na),d=0;d<c.length;d++)c[d].Jh.set(bb)}}var M=p("__batch"),fa=p("__boundings"),W=p("__camera"),ca=p("__config"),ka=p("__debug"),X=p("__geometry"),na=p("__graph"),ia=p("__hud"),B=p("__objects");p("__particles");var aa=p("__prerender"),sa=p("__primitives"),pa=p("__print"),R=p("__renderer"),ja=p("__scenegraph"),ga=p("__sfx"),la=p("__shaders"),ya=p("__textures"),Ha=p("__util"),Ba=p("vec3");p("mat4");var wa=ca.q,pb=ca.Sf,Bb="ARMATURE CAMERA EMPTY LAMP MESH SPEAKER".split(" "),
ac=["ARMATURE","EMPTY","MESH","SPEAKER"],ib="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT COLOR_PICKING DEPTH GLOW_MASK WIREFRAME".split(" "),ab="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT GOD_RAYS SKY LUMINANCE_TRUNCED".split(" "),Ra=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_REFLECT"],Na="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT COLOR_PICKING DEPTH GOD_RAYS GLOW_MASK WIREFRAME".split(" "),La=["MAIN_OPAQUE","MAIN_BLEND","MAIN_REFLECT"],qc=8,Fa=null,Pa=[],Ib=[],Cb,rc,qb=10;a.Il=0;a.Gl=
1;a.Hl=2;a.DATA_ID_ALL=-1;var Dc=new Float32Array(2),Va=new Float32Array(3),Wa=new Float32Array(4),jc=new Float32Array(4),Db=new Float32Array(4),Lc=new Float32Array(24),Ec=fa.nc(),kc=fa.nc(),Mc=fa.nc(),bb=new Float32Array(3);a.set_active=function(a){Fa=a;ga.Ov(a)};a.kv=function(a){if(!a.Rl){for(var b=a.d,c=ja.Lm(b.La),d=0;d<c.length;d++)b.Zi.push(c[d]);P(a,Cb,rc,!1)}a=E(a,Na);for(b=0;b<a.length;b++)a[b].Jh.set(bb)};a.get_active=b;a.Y=d;a.ui=function(){return Pa};a.pk=function(b,c,d,e){for(var f=Pa,
g=null,B="",m=0;m<f.length;m++){var l=H(f[m],"ALL",a.DATA_ID_ALL);switch(b){case a.Il:B=c;g=h(c,l,!1,d);break;case a.Gl:B=d;g=null;(l=h(c,l,!1,e))&&l.dupli_group&&(g=h(d,l.dupli_group.objects,!0,e));break;case a.Hl:for(var B=c[c.length-1],g=null,k=0;k<c.length;k++)if((g=h(c[k],l,0!=k,d))&&g.dupli_group)l=g.dupli_group.objects;else break}if(g)break}g||pa.warn("get object "+B+": not found");return g};a.vr=function(a,b){for(var d in ac){var e=ac[d],f=c(a,e);e in b.tb||(b.tb[e]=[]);for(var g=0;g<f.length;g++)Ha.He(f[g])&&
f[g].proxy||(b.tb.ALL.push(f[g]),b.tb[e].push(f[g]))}};a.pr=function(b){b.tb={ALL:[]};for(var d in Bb){var g=Bb[d],h=c(b,g);b.tb[g]=[];for(var B=0;B<h.length;B++)Ha.He(h[B])&&h[B].proxy||(b.tb.ALL.push(h[B]),b.tb[g].push(h[B]))}b.d=b.d||{};d=b.d;g=b.camera.d;h=b.world.b4w_shadow_settings;B=d.wh={};B.csm_near=h.csm_near;B.csm_far=h.csm_far;B.csm_num=h.csm_num;B.csm_lambda=h.csm_lambda;B.blur_depth_size_mult=h.blur_depth_size_mult;B.blur_depth_edge_size=h.blur_depth_edge_size;B.blur_depth_diff_threshold=
h.blur_depth_diff_threshold/1E3;B.Ip=h.visibility_falloff;h=b.world.b4w_fog_color;d.wb=new Float32Array([h[0],h[1],h[2],b.world.b4w_fog_density]);if(wa.deferred_rendering){h=b.Rl;a:{if("NONE"!=wa.Ze&&b.b4w_render_shadows)for(var k=B=!1,v=H(b,"MESH",a.DATA_ID_ALL),q=0;q<v.length;q++){var s=v[q];s.b4w_shadow_cast&&(B=!0);s.b4w_shadow_receive&&(k=!0);if(B&&k){B=!0;break a}}B=!1}d.zv=B;d.oy=b.world.b4w_fog_color;a:{if(wa.shore_smoothing)for(B=J(b),k=0;k<B.length;k++)if(v=B[k],v.b4w_water&&v.b4w_water_shore_smoothing){B=
!0;break a}B=!1}d.shore_smoothing=B;if(wa.aj&&b.b4w_render_reflections)for(B=[],k=H(b,"MESH",a.DATA_ID_ALL),v=0;v<k.length;v++){if(q=k[v],q.b4w_reflective){b:{q=q.constraints;for(s=0;s<q.length;s++){var L=q[s];if("LOCKED_TRACK"==L.type&&"REFLECTION PLANE"==L.name){s=L.target;break b}}s=null}s&&(q=s.location,s=s.d.g,L=new Float32Array(4),Ha.Iw(q,s,Ha.AXIS_Y,L),B.push(L))}}else B=!1;d.uv=B;d.ra=l(b);d.Qf=e(b);d.cl=f(b);d.hp=w(b);B={};k=b.world.b4w_bloom_settings;B.blur=k.blur;B.jt=k.edge_lum;B.key=
k.key;d.Kr=B;B={};k=b.world.b4w_motion_blur_settings;B.Ki=k.motion_blur_decay_threshold;B.Li=k.motion_blur_factor;d.Uu=B;B={};k=b.world.b4w_color_correction_settings;B.brightness=k.brightness;B.contrast=k.contrast;B.exposure=k.exposure;B.saturation=k.saturation;d.Wr=B;B={};k=b.world.b4w_god_rays_settings;B.xu=k.intensity;B.Jf=k.max_ray_length;B.ig=k.steps_per_pass;d.lu=B;B={};k=b.world;B.Rg=k.b4w_glow_color;B.xi=k.b4w_glow_factor;d.iu=B;d.Al=n(b);a:{if(wa.pa)for(k=B=!1,v=H(b,"MESH",a.DATA_ID_ALL),
q=0;q<v.length;q++){for(var L=v[q],aa=L.data.materials,s=0;s<aa.length;s++)aa[s].b4w_terrain&&(B=!0);L=L.particle_systems;for(s=0;s<L.length;s++)aa=L[s].settings,"HAIR"==aa.type&&aa.b4w_dynamic_grass&&(k=!0);if(B&&k){B=!0;break a}}B=!1}d.pa=B;d.Lf=wa.Lf&&b.b4w_enable_motion_blur;d.pf=wa.pf&&b.b4w_enable_color_correction;d.antialiasing=wa.antialiasing&&b.b4w_enable_antialiasing;d.yk=H(b,"LAMP",a.DATA_ID_ALL).length;d.mf=wa.mf&&b.b4w_enable_bloom;d.Zf=wa.Zf&&b.b4w_enable_ssao;d.yf=wa.yf&&b.b4w_enable_god_rays;
d.Md=wa.Md&&b.b4w_render_refractions;d.ei=m(b)||wa.force_selectable;d.glow=wa.glow?d.ei:!1;d.La=ja.Is(h,d,g)}else d.cl=f(b),d.Al=n(b),d.hp=w(b),d.yk=H(b,"LAMP",a.DATA_ID_ALL).length,d.Qf=e(b),d.ra=l(b),d.pa=!1,d.ei=m(b)||wa.force_selectable,d.La=ja.Js(g,d);d.Zi=[];d.Kk=!1;d.Jk=!1;Pa.push(b)};a.fi=c;a.nk=function(a){return a.d.La};a.Dt=function(a){na.K(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=M.Km(c.jh);break;case "SSAO":d=M.Ps(c.ip);break;case "DEPTH_PACK":d=M.ys();break;
case "BLUR_DEPTH":d=M.vs(c.orientation);M.ld(d,c.blur_depth_size_mult);break;case "REFRACT":case "SCREEN":d=M.Km("NONE");break;case "GOD_RAYS":ja.Ta(a,c,"WIREFRAME")||ja.Ta(a,c,"MAIN_BLEND")||ja.Ta(a,c,"GOD_RAYS");d=M.Bs(c.Co|0,(c.fb&&c.Xd)|0,c.ig);break;case "GOD_RAYS_COMBINE":ja.Ta(a,c,"WIREFRAME")||ja.Ta(a,c,"MAIN_BLEND");ja.Ta(a,c,"GOD_RAYS");d=M.Cs();break;case "MOTION_BLUR":d=M.Hs(c.Ki);break;case "DOF":d=M.zs();M.ld(d,c.i.dof_power);for(var e=ja.Ta(a,c,"POSTPROCESSING"),f=ja.Ta(a,e,"POSTPROCESSING"),
h=[e,f],m=0;m<h.length;m++){var l=h[m].m;(e=l[0].l)&&M.ld(e,c.i.dof_power)}break;case "GLOW":h=ja.Ta(a,c,"POSTPROCESSING");m=ja.Ta(a,h,"POSTPROCESSING");e=ja.Ta(a,m,"POSTPROCESSING");f=ja.Ta(a,e,"POSTPROCESSING");d=M.As();h=[m,h];for(m=0;m<h.length;m++)l=h[m].m,(l=l[0].l)&&M.ld(l,c.im);h=[f,e];for(m=0;m<h.length;m++)l=h[m].m,(l=l[0].l)&&M.ld(l,c.Wm*c.xi);break;case "COMPOSITING":d=M.ws();break;case "ANTIALIASING":d=M.rs();break;case "LANCZOS":d=M.Es(c.Wy);break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=
M.Ns(c.type);break;case "ANAGLYPH":d=M.qs();break;case "HUD":d=M.Ds();e=ya.Rs();M.Bg(d,e);break;case "SKY":d=M.Ms();M.vh(d,1/c.i.width,1/c.i.height);break;case "LUMINANCE":d=M.Fs();break;case "AVERAGE_LUMINANCE":d=M.ss();break;case "LUMINANCE_TRUNCED":d=M.Gs();break;case "BLOOM_BLUR":d=M.ts(c.jh);M.vh(d,1/c.i.width,1/c.i.height);break;case "BLOOM":d=ja.Ta(a,c,"BLOOM_BLUR");h=[ja.Ta(a,d,"BLOOM_BLUR"),d];for(m=0;m<h.length;m++)l=h[m].m,(l=l[0].l)&&M.ld(l,c.bloom_blur);d=M.us();break;case "VELOCITY":d=
M.Ts()}d&&(e={M:!0,Ma:B.hi("NONE"),l:d},y(d),c.m.push(e),g(a,c,d),x(d))})};a.append_object=function(a,b){switch(b.type){case "MESH":var c=a.d.La,d=b.d;!ja.Ca(c,"SHADOW_CAST")&&d.gb&&(d.gb=!1);for(var d=E(a,ib),e=0;e<d.length;e++){var f=d[e],h=b,B=c,m=a;switch(f.type){case "MAIN_OPAQUE":s(f,h,B,"OPAQUE",m);break;case "MAIN_BLEND":s(f,h,B,"BLEND",m);break;case "MAIN_REFLECT":B=h.d;h=h.O;for(m=0;m<h.length;m++){var l=h[m],k=z(l);if(!("MAIN"!=k.type&&"NODES"!=k.type||A(f,k)||k.ma)&&k.Pb){var v=k.Fa;la.I(v,
"DISABLE_FOG",0);la.I(v,"WATER_EFFECTS",0);"special_skydome.glslf"==la.qn(v)&&la.I(v,"REFLECTION_PASS",1);la.I(v,"SHADOW_SRC","SHADOW_SRC_NONE");la.I(v,"TEXTURE_NORM",0);M.Bb(k);v={M:!0,Ma:B,l:k};y(k);f.m.push(v);"MAIN"==k.type&&(l.kb||(l.kb=[]),l.kb.push(k))}}break;case "DEPTH":l=h.d;h=h.O;for(k=0;k<h.length;k++){var n=h[k];if("DEPTH"==n.type&&!A(f,n)&&!n.Lb){if(ja.qu(B,f,"SHADOW_CAST"))if(n.gb){switch(wa.Ze){case "RGBA":var v="SHADOW_SRC_RGBA",q="SHADOW_DST_MASK";break;case "RGBA_PCF":v="SHADOW_SRC_RGBA_PCF";
q="SHADOW_DST_MASK";break;case "DEPTH":v="SHADOW_SRC_DEPTH";q="SHADOW_DST_MASK";break;case "VSM":v="SHADOW_SRC_VSM";q="SHADOW_DST_MASK";break;default:throw"Wrong shadows type";}n=M.ti(n,v,q);M.Bj(n,u(m));ja.rn(B,f);r(B,f,v)}else n=M.ti(n,"SHADOW_SRC_NONE","SHADOW_DST_MASK");else n=M.ti(n,"SHADOW_SRC_NONE","SHADOW_DST_NONE");n.pa&&(v=ja.Ca(B,"GRASS_MAP"))&&I(n,v,l);M.Bb(n);v={M:!0,Ma:l,l:n};y(n);f.m.push(v);g(B,f,n);x(n)}}break;case "SHADOW_CAST":l=!1;k=h.d;h=h.O;for(v=0;v<h.length;v++)if(n=h[v],n.Kb||
n.gb)if(l=!0,"DEPTH"==n.type&&!A(f,n)&&n.Kb){switch(wa.Ze){case "RGBA":case "RGBA_PCF":q="SHADOW_DST_RGBA";break;case "DEPTH":q="SHADOW_DST_DEPTH";break;case "VSM":q="SHADOW_DST_VSM";break;default:throw"Wrong shadows type";}n=M.ti(n,"SHADOW_SRC_NONE",q);n.pa&&(q=ja.Ca(B,"GRASS_MAP"))&&I(n,q,k);M.Bb(n);q={M:!0,Ma:k,l:n};y(n);f.m.push(q)}l&&Q(f,ja.Ca(B,"MAIN_OPAQUE"),f.m,m);break;case "COLOR_PICKING":B=h.d;h=h.O;for(m=0;m<h.length;m++)l=h[m],"COLOR_ID"!=l.type||A(f,l)||(M.ba(l,"USE_GLOW",0),M.Bb(l),
k={M:!0,Ma:B,l:l},y(l),f.m.push(k));break;case "GRASS_MAP":B=h.d;h=h.O;for(m=0;m<h.length;m++)l=h[m],"GRASS_MAP"!=l.type||A(f,l)||(M.Bb(l),k={M:!0,Ma:B,l:l},y(l),f.m.push(k),l=f.i,q=B.Ha,k=f.Eb[0],v=f.Eb[1],n=f.Eb[2],0==k&&0==v?(k=q.min_y,v=q.max_y):(k=Math.min(k,q.min_y),v=Math.max(v,q.max_y)),q=1E-4*(v-k),f.Eb[0]=k-q,f.Eb[1]=v+q,W.Wo(l,n/2,-v,-k,n/2),W.Tf(l));break;case "GLOW_MASK":B=h.d;h=h.O;for(m=0;m<h.length;m++)l=h[m],"COLOR_ID"!=l.type||A(f,l)||(k=z(l),M.ba(k,"USE_GLOW",1),M.Bb(k),h.push(k),
v={M:!0,Ma:B,l:k},y(k),f.m.push(v),l.kb||(l.kb=[]),l.kb.push(k));break;case "WIREFRAME":for(m=h.d,h=h.O,l=0;l<h.length;l++)k=h[l],"WIREFRAME"!=k.type||A(f,k)||(k.pa&&(v=ja.Ca(B,"GRASS_MAP"))&&I(k,v,m),M.Bb(k),v={M:!0,Ma:m,l:k},y(k),f.m.push(v),g(B,f,k),x(k))}}break;case "LAMP":c=E(a,ab);for(d=0;d<c.length;d++)c[d].Nf++;F(b,a)}};a.Ey=A;a.Yk=function(a){a.d.Kk=!0};a.ln=u;a.hide_object=function(a){a.d.Sg=!0};a.show_object=function(a){a.d.Sg=!1};a.xv=function(a,b){for(var c=b.d,d=E(a,ib),e=0;e<d.length;e++)for(var f=
d[e].m,g=f.length-1;0<=g;g--){var h=f[g];h.Ma==c&&(h.l&&X.ym(h.l.Ya),f.splice(g,1))}};a.check_object=function(a,b){return b.tb[a.type]&&-1<b.tb[a.type].indexOf(a)?!0:!1};a.oj=F;a.cleanup=function(){for(var a=0;a<Pa.length;a++){var b=Pa[a];na.K(b.d.La,function(a,b){if("SINK"!=b.type){var c=b.i;R.Av(c.Cd,c.Ra,c.Ub,c.width,c.height);for(var c=b.m,d=0;d<c.length;d++){var e=c[d].l;e&&M.gs(e)}}});b.d.La=[];b.d.Zi=[]}Fa=null;Pa.length=0;Ib.length=0;bb[0]=0;bb[1]=0;bb[2]=0};a.eo=function(a,b,c){a=W.Xm(a,
a.cb,a.Ka,null);var d=sa.Ht(a);a=B.hi("DYNAMIC");a.Ha=a.vb={max_x:1E12,min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12};a.Xa=a.hc=fa.Jr();var e=a.Xa.Na;a.ne=a.me=fa.Sj([e,0,0],[0,e,0],[0,0,e],a.Xa.U);c=M.Ls(d,c);b.m.push({M:!0,Ma:a,l:c})};a.ha=H;a.$t=function(a){return[a.frame_start,a.frame_end]};a.$o=function(a,b){Cb=a;rc=b;Fa&&P(Fa,a,b,!1)};a.vh=N;a.jl=E;a.ea=S;a.get_environment_colors=function(a){a=E(a,ab)[0];var b=a.Wb,c=a.ec,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];
e[2]=c[2];return[a.Ad,d,e]};a.set_environment_colors=function(a,b,c,d){a=E(a,ab);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.Ad=b);c&&f.Wb.set(c);d&&f.ec.set(d);f.wa=!0}};a.get_sky_params=function(a){if(a=S(a,"SKY")){var b={};b.color=Array(3);Ba.copy(a.Xf,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=
a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,c){for(var d=E(a,["SKY"]),e=0;e<d.length;e++){var f=d[e];"number"==typeof c.procedural_skydome&&(f.procedural_skydome=c.procedural_skydome);"number"==typeof c.use_as_environment_lighting&&(f.use_as_environment_lighting=c.use_as_environment_lighting);
"object"==typeof c.color&&f.Xf.set(c.color);"number"==typeof c.rayleigh_brightness&&(f.rayleigh_brightness=c.rayleigh_brightness);"number"==typeof c.mie_brightness&&(f.mie_brightness=c.mie_brightness);"number"==typeof c.spot_brightness&&(f.spot_brightness=c.spot_brightness);"number"==typeof c.scatter_strength&&(f.scatter_strength=c.scatter_strength);"number"==typeof c.rayleigh_strength&&(f.rayleigh_strength=c.rayleigh_strength);"number"==typeof c.mie_strength&&(f.mie_strength=c.mie_strength);"number"==
typeof c.rayleigh_collection_power&&(f.rayleigh_collection_power=c.rayleigh_collection_power);"number"==typeof c.mie_collection_power&&(f.mie_collection_power=c.mie_collection_power);"number"==typeof c.mie_distribution&&(f.mie_distribution=c.mie_distribution);f.wa=!0;f.Oi=!0;K(b(),f);R.oi(f)}};a.get_fog_color_density=function(a,b){var c=b||[],d=E(a,Ra)[0].wb;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=E(a,Ra),d=0;d<c.length;d++){var e=c[d];e.wb.set(b);
e.wa=!0}};a.get_ssao_params=function(a){a=S(a,"SSAO");if(!a)return null;var b=a.m[0].l,c={};c.ssao_quality=M.Ua(b,"SSAO_QUALITY")[1];c.radius_increase=a.fg;c.dithering_amount=a.ag;c.gauss_center=a.bg;c.gauss_width_square=a.dg;c.gauss_width_left_square=a.cg;c.influence=a.eg;c.dist_factor=a.$f;c.ssao_only=a.ssao_only;c.ssao_white=M.Ua(b,"SSAO_WHITE")[1];return c};a.set_ssao_params=function(a,b){var c=S(a,"SSAO");if(!c)return pa.error("SSAO is not enabled on scene"),0;if("string"==typeof b.ssao_quality){var d=
c.m[0].l;M.ba(d,"SSAO_QUALITY",b.ssao_quality);M.Bb(d,!0)}"number"==typeof b.fg&&(c.fg=b.fg);"number"==typeof b.ag&&(c.ag=b.ag);"number"==typeof b.bg&&(c.bg=b.bg);"number"==typeof b.dg&&(c.dg=b.dg);"number"==typeof b.cg&&(c.cg=b.cg);"number"==typeof b.eg&&(c.eg=b.eg);"number"==typeof b.$f&&(c.$f=b.$f);if("number"==typeof b.ssao_only){c=S(a,"MAIN_OPAQUE");c.ssao_only=b.ssao_only;for(var e=0;e<c.m.length;e++)d=c.m[e].l,M.ba(d,"SSAO_ONLY",b.ssao_only),M.Bb(d,!0)}"number"==typeof b.ssao_white&&(d=c.m[0].l,
M.ba(d,"SSAO_WHITE",b.ssao_white),M.Bb(d,!0));c.wa=!0};a.get_dof_params=function(a){a=S(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.i.dof_distance;b.dof_front=a.i.dof_front;b.dof_rear=a.i.dof_rear;b.dof_power=a.i.dof_power;return b};a.set_dof_params=da;a.get_god_rays_params=function(a){var b=E(a,["GOD_RAYS"]);a=S(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].Jf;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=M.Ua(b[0].m[0].l,"STEPS_PER_PASS")[1];
return c};a.set_god_rays_params=function(a,b){var c=E(a,["GOD_RAYS"]),d=S(a,"GOD_RAYS_COMBINE");if(!c||!d)return pa.error("God Rays are not enabled on scene"),0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].Jf=e,c[f].$i=e/c[f].ig/(f+1),c[f].wa=!0;if("number"==typeof b.god_rays_steps)for(var g=la.s(b.god_rays_steps,1),e=c[0].Jf,f=0;f<c.length;f++){c[f].ig=g;
c[f].$i=e/g/(f+1);c[f].wa=!0;var h=c[f].m[0].l;M.ba(h,"STEPS_PER_PASS",g);M.Bb(h,!0)}d.wa=!0};a.get_bloom_params=function(a){var b=S(a,["LUMINANCE_TRUNCED"]);a=S(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=function(a,b){var c=S(a,"LUMINANCE_TRUNCED"),d=S(a,"BLOOM");if(!c||!d)return pa.error("Bloom is not enabled on scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.wa=!0);
"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.wa=!0);if("number"==typeof b.bloom_blur)for(var e=a.d.La,c=ja.Ta(e,d,"BLOOM_BLUR"),e=ja.Ta(e,c,"BLOOM_BLUR"),c=[c,e],e=0;e<c.length;e++){var f=c[e].m[0].l;f&&M.ld(f,b.bloom_blur);N(c[e],1/d.i.width,1/d.i.height)}};a.get_wind_params=function(){var a=bb,b=Ba.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.set_wind_params=function(b,c){for(var d=H(b,"ALL",a.DATA_ID_ALL),
e=0;e<d.length;e++){var f=d[e];if("EMPTY"===f.type&&f.field&&"WIND"===f.field.type)var g=f}if(!g)return pa.error("There is no wind on the scene"),0;d=g.d;"number"==typeof c.wind_dir&&(Va=[0,c.wind_dir/180*Math.PI,-Math.PI/2],Ha.euler_to_quat(Va,Db),d.g.set(Db),v(g));"number"==typeof c.wind_strength&&(d.fk=c.wind_strength,v(g));L(b)};a.Lv=function(a){a.d.Jk=!0};a.get_water_surface_level=ba;a.get_water_mat_params=function(a,b){var c=S(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.Zd,b.waves_length=c.gf,
c.mc)){b.water_fog_density=c.mc[3];var d=b.water_fog_color=[];d[0]=c.mc[0];d[1]=c.mc[1];d[2]=c.mc[2]}};a.set_water_params=function(a,b){var c=S(a,"MAIN_OPAQUE");if(!c||!c.ra)return pa.error("set_water_params() - no water parameters on this scene"),null;c=c.ra;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&
(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=
b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.sf=b.water_dynamic);for(var d=E(a,La),e=0;e<d.length;e++){var f=d[e];"number"==typeof b.water_fog_density&&c.wb&&(f.mc[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.wb&&f.mc.set(b.water_fog_color);"number"==typeof b.waves_height&&(f.Zd=b.waves_height);"number"==typeof b.waves_length&&(f.gf=b.waves_length);f.wa=!0}};a.get_shore_dist=function(a,b){var c=S(Fa,"MAIN_OPAQUE");if(!c.sj)return 100;var d=c.Kf,e=c.Yd,f=(a[0]-c.Od[0])/c.Pd[0],
g=(c.Od[1]+a[2])/c.Pd[1],f=f+0.5,g=g+0.5;if(1<f||0>f||1<g||0>g)e=1;else return c=d*Ha.kn(Fa.d.$k,c.Wf,f,g),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,c){for(var d=b().camera.d,e=0;e<Pa.length;e++){var f=Pa[e],g=f.d.La;if(f.d.ra)var h=d.e[1]-ba(d.e[0],d.e[2]);na.K(g,function(b,c){-1<Na.indexOf(c.type)&&(c.time=a);-1<La.indexOf(c.type)&&f.d.ra&&(c.Oj=h)})}if(wa.deferred_rendering)for(e=0;e<Ib.length;e++)ha(Ib[e],a);for(e=0;e<Pa.length;e++)if(f=Pa[e],g=f.d,d=g.Zi,g.Kk&&(G(f),g.Kk=!1),g.Jk&&
(U(f),g.Jk=!1),d.length){f.b4w_enable_motion_blur&&D(g.La,c);if(wa.deferred_rendering&&g.glow){for(var B=S(f,"GLOW_MASK").m,m=0,g=0;g<B.length;g++)m+=B[g].l.xf;na.K(f.d.La,function(a,b){"GLOW"===b.type&&(b.$j=m)})}B=null;for(g=0;g<d.length;g++)"GLOW_MASK"==d[g].type&&(B=g);for(g=0;g<d.length;g++){var l=d[g];aa.Jo(l);null!==B&&T(l,d[B]);R.oi(l)}}wa.show_hud_debug_info&&ia.fw(Pa,c)};a.lk=function(a){var b=[];na.K(a.d.La,function(a,c){b.push(c)});return b};a.apply_glow_anim=function(a,b,c,d){a.cr={nl:0,
Bn:b,Xi:c,Qo:d};-1==Ib.indexOf(a)&&Ib.push(a)};a.clear_glow_anim=function(a){if(a.O)for(var b=0;b<a.O.length;b++){var c=a.O[b];"COLOR_ID"==c.type&&(c.xf=0)}a=Ib.indexOf(a);-1!=a&&Ib.splice(a,1)};a.Ux=function(){Ib=[]};a.get_cam_water_depth=function(){var a=S(Fa,"MAIN_BLEND"),b=Fa;return a||b.d.ra?a.Oj:null};a.get_object_data_id=function(a){return a.d.Tc};a.Cp=L;a.aw=function(a,b){switch(b){case "WM_NONE":a.M=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=
0;c<a.m.length;c++)a.m[c].l.wireframe_mode=ka.Nl[b];a.M=!0}a.ma="WM_TRANSPARENT_WIREFRAME"==b;a.wa=!0};a.$v=function(a,b){for(var c=0;c<a.m.length;c++)a.m[c].l.wireframe_edge_color=b,a.wa=!0};a.Wl=function(a,b){for(var c=0;c<b.length;c++)a.tb.ALL.push(b[c]),a.tb.MESH.push(b[c])};a.Bp=v;a.pick_object=function(c,e){if(!d())return pa.error("No active scene"),null;var f=b(),g=S(f,"COLOR_PICKING");if(g){aa.Jo(g);R.oi(g);g=g.i;e=g.height-e;for(var g=R.sv(g.Cd,c,e),f=H(f,"MESH",a.DATA_ID_ALL),h=0;h<f.length;h++){var B=
f[h].Pl;if(B&&5>Math.abs(255*B[0]-g[0])&&5>Math.abs(255*B[1]-g[1])&&5>Math.abs(255*B[2]-g[2]))return f[h]}}else pa.error("Color picking is not available");return null};a.gu=function(){return bb}};b4w.module.__physics=function(a,p){function b(a,c){for(var d=a.qd,e=0;e<d.length;e++)d[e].d.qj&&c.push(d[e]),b(d[e],c)}function d(a,b){if(ba)switch(a){case u.Zp:G.log(b);break;case u.Wp:G.error(b);break;case u.Xp:Q.fbmsg.apply(this,b.slice(1));break;case u.cq:var c=h(b.body_id);if(c){var d=b.trans,e=b.quat,f=b.linvel,g=b.angvel,c=c.k;c.Uj=b.time;F.uh(d,1,e,c.Vj);J.copy(f,c.ao);J.copy(g,c.Yl)}break;case u.aq:(d=h(b.chassis_hull_body_id))&&F.uh(b.trans,1,b.quat,d.f.lh[b.prop_ind]);break;case u.Yp:if(c=
h(b[1]))d=b[4],c=c.fc.Vh[b[2]],O.set_translation(c,b[3]),O.set_rotation(c,d),O.D(c);break;case u.dq:if(c=h(b[1]))c.f.speed=b[2];break;case u.Up:for(var d=b.body_id_a,c=b.body_id_b,e=b.result,f=b.coll_point,d=parseInt(d),g=ba.k.m,m=0;m<g.length;m++)for(var l=g[m].eb,k=0;k<l.tc.length;k++){for(var v=l.tc[k],n=v.Ui,q=!1,s=0;s<n.length;s++){var L=n[s];if(L[0]===d&&L[1]===c){v.Fo[s]=e;q=!0;break}}if(q){n=v.Fo;for(s=q=0;s<n.length;s++)q=q||n[s];v.callback(q,f)}}break;case u.Vp:if(c=h(b[1]))c=c.k,c.di&&
c.di(b[2]);break;case u.bq:if(c=h(b.body_id))for(c=c.k,e=b.from,f=b.to,g=b.local,m=b.body_id_b_hit,l=b.cur_result,k=0;k<c.Kd.length;k++)if(n=c.Kd[k],K.ci(n.C,e,da)&&K.ci(n.T,f,da)&&n.If==g){for(d in n.hd)n.hd[d]=1;-1!=m&&(n.hd[m]=l);for(var v=n.Tb,s=n.callback,n=n.hd,q=!1,L=1,w=0;w<ba.k.m.length;w++){var r=ba.k.m[w].eb;if(("ANY"==v||r.id==v)&&r.B in n&&1!==n[r.B]){q=!0;L=n[r.B];break}}s(q,L)}break;case u.$p:console.log("Physics message ping: ",performance.now()-b[1]);break;default:G.error("Wrong message: "+
a)}}function h(a){return oa[a]||null}function c(){Z.body++;return Z.body}function k(a){return{B:a,Fk:0,Di:!1,Qd:!0,Ty:!1,is_character:!1,Bu:!1,gi:null,id:"",Wx:{},tc:[],di:null,Kd:[],Uj:0,Vj:new Float32Array([0,0,0,1,0,0,0,1]),ao:new Float32Array(3),Yl:new Float32Array(3),Zh:new Float32Array(3),Yh:new Float32Array(4)}}function l(a,b){switch(a){case "BOX":var c=b.vb;break;case "CYLINDER":c=b.Jj;break;case "CONE":c=b.Ij;break;case "SPHERE":c=b.hc;break;case "CAPSULE":c=b.Hj}return c}function e(a){if(!a)return null;
var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.U&&(b.center=a.U);"number"===typeof a.Na&&(b.radius=a.Na);"number"===typeof a.height&&(b.height=a.height);return b}function f(a,b,c,d){var e=a.d.e,f=b.d.G,g=new Float32Array(16);N.invert(f,g);f=new Float32Array(3);
J.transformMat4(e,g,f);switch(b.f.type){case fa:b=b.b4w_vehicle_settings;a=a.d.vb;u.n(u.fq,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case W:u.n(u.eq,c,f,a.wz)}}function w(a){return a.k&&a.k.gi?!0:!1}function n(a,b,c,d,e,f,g,h,m,l){var k;Z.Gm++;k=Z.Gm.toString(16);u.n(u.mq,k,a,h,b.k.B,c,d,e.k.B,f,g,m,l);b.k.gi=k}function m(a){var b=a.k;if(b&&(0===b.Fk||!0===b.Di||!1===b.Qd||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.d.e[0]!=a.k.Zh[0]||a.d.e[1]!=a.k.Zh[1]||a.d.e[2]!=
a.k.Zh[2]||a.d.g[0]!=a.k.Yh[0]||a.d.g[1]!=a.k.Yh[1]||a.d.g[2]!=a.k.Yh[2])){a.k.Zh.set(a.d.e);a.k.Yh.set(a.d.g);var b=a.k,c=u.sn(u.hf);c.msg_id=u.hf;c.body_id=a.k.B;c.trans=a.d.e;"DYNAMIC"===b.type?(c.quat=D,P.identity(D)):c.quat=a.d.g;u.n(u.hf,c)}a=a.qd;for(b=0;b<a.length;b++)m(a[b])}function g(a,b,c,d,e){e=e||new Float32Array(3);a=a.d.g;e[0]=b;e[1]=c;e[2]=d;J.transformQuat(e,a,e)}function s(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.k.m.length;e++){var f=b.k.m[e];
if("ANY"==a||f.eb.id==a)f=f.eb.B,c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function t(a,b){u.n(u.oc,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=K.am(e.C)+K.am(e.T)+String(e.If);c[f]=c[f]||{C:e.C,T:e.T,If:e.If,jm:[]};var g=c[f].jm,h;for(h in e.hd)-1==g.indexOf(h)&&g.push(h)}for(f in c)d=c[f].C,e=c[f].T,h=c[f].If,g=c[f].jm,u.n(u.Ll,a,d,e,h,g)}else u.n(u.Ll,a,null,null,!1,null)}function y(a,b){if(b.hg){var c=a.k.B,d=b.uf*b.cn,e=b.Cg*b.km,f=-b.gg*b.il*2*Math.PI/b.kp;b.Rn&&(f*=-1);
switch(b.type){case fa:u.n(u.oc,c);u.n(u.Tq,c,d,e,f);break;case W:u.n(u.oc,c),u.n(u.Sq,c,d,e,f)}}}function x(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function q(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function r(a){return a.b4w_character?!0:!1}function I(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}p("__camera");var A=p("__config");p("__constraints");var G=p("__print"),Q=p("__debug"),u=p("__ipc");p("__renderer");
var z=p("__scenes"),O=p("__transform"),F=p("__tsr"),K=p("__util"),H=p("__version"),J=p("vec3"),P=p("quat"),N=p("mat4"),E=A.eb,S=A.q,da=1E-7,ba=null,T=[],oa=[],Z={Op:0,body:0,Gm:0,shape:0},U=new Float32Array(3),D=new Float32Array(4),ha=new Float32Array(4),L=new Float32Array(16),v=new Float32Array(8),M=new Float32Array(8),fa=10,W=20;a.vu=function(a){if(E.Wc){var b=E.sl+H.timestamp();G.log("%cLOAD PHYSICS","color: #0a0",b,"Max FPS: "+E.Fd);b=new Worker(b);u.init(b,d);u.n(u.Cq,a,E.Fd)}};a.bm=function(a){var b;
Z.Op++;b=Z.Op;u.n(u.rq,b);a.k={};a.k.mx=b;a.k.m=[]};a.cleanup=function(){if(E.Wc){u.n(u.xq);ba=null;T.length=0;oa.length=0;for(var a in Z)Z[a]=0}};a.append_object=function(a,d){ba=d;u.n(u.Hq,d.k.mx);var g=a.d;if(!g)throw"No object render: "+a.name;if(a.parent&&g.qj)return null;var h=[];g.qj&&b(a,h);for(var m=a.O||[],B=0;B<m.length;B++){var v=m[B],s;if(s="PHYSICS"==v.type){var t;a:{for(var M=d.k.m,p=0;p<M.length;p++){var H=M[p].l;if(H&&H.id==v.id){t=!0;break a}}t=!1}s=!t}if(s)if(v.Mb.w)if(v.Xd&&d.d.ra){var A=
v;u.n(u.qq);var E=ba,D=z.ea(E,"MAIN_OPAQUE");if(D.ra&&A.hx){var F={};F.dst_noise_scale0=A.dst_noise_scale0;F.dst_noise_scale1=A.dst_noise_scale1;F.dst_noise_freq0=A.dst_noise_freq0;F.dst_noise_freq1=A.dst_noise_freq1;F.dir_min_shore_fac=A.dir_min_shore_fac;F.dir_freq=A.dir_freq;F.dir_noise_scale=A.dir_noise_scale;F.dir_noise_freq=A.dir_noise_freq;F.dir_min_noise_fac=A.dir_min_noise_fac;F.dst_min_fac=A.dst_min_fac;F.waves_hor_fac=A.waves_hor_fac;var S=D.Zd,O=D.gf,Q=D.Yd;D.sj?u.n(u.Kl,F,D.Pd[0],D.Pd[1],
D.Od[0],D.Od[1],D.Kf,S,O,Q,D.Wf,E.d.$k):u.n(u.Kl,F,0,0,0,0,0,S,O,Q,0,null)}}else{var da;if(v.$w){var U=a,Z=v,Ra=c(),Na=Z.Mb;u.n(u.oq,Ra,Na.r[0].a_position,Na.W||null,U.d.e,Z.Bm,Z.Cm);var La=k(Ra);La.Di=!0;da=La}else{var qc=a,Fa=v,Pa=c(),Ib=Fa.Mb;u.n(u.pq,Pa,Ib.r[0].a_position,Ib.W||null,qc.d.e,Fa.Ng,Fa.Ig,Fa.Bm,Fa.Cm);da=k(Pa)}var Cb=da;Cb.id=v.Tb;var rc={l:v,eb:Cb};d.k.m.push(rc)}else G.error("Object "+a.name+" has collision material with no assigned vertices")}if(x(a)||q(a)||r(a)||I(a)||a.b4w_collision){var qb=
a,Dc=g.Io,Va=qb.d,Wa=qb.game,jc=c();if("CAMERA"==qb.type)var Db=Wa.use_collision_bounds?Wa.collision_bounds_type:"BOX",Lc=l(Db,Va),Ec=Va.Ng,kc=Va.Ig,Ec=0.5,kc=0;else"EMPTY"==qb.type?(Db="EMPTY",Lc=null,kc=Ec=0):(Db=Wa.use_collision_bounds?Wa.collision_bounds_type:"BOX",Lc=l(Db,Va),Ec=Va.Ng,kc=Va.Ig);var Mc=Va.e,bb=Va.g,Vc=Wa.use_ghost,Nc=Wa.use_sleep,sc=Wa.mass,lc=Wa.velocity_min,Eb=Wa.velocity_max,jb=Wa.damping,Jb=Wa.rotation_damping,bc=Wa.collision_group,Fc=Wa.collision_mask,Ub=Va.hc.Na,Y=e(Lc),
cb=qb.b4w_correct_bounding_offset,Sa;var ta=Db;if(h.length){var tc=[],va={};va.quat=new Float32Array([0,0,0,1]);va.trans=new Float32Array(3);va.worker_bounding=Y;va.bounding_type=ta;tc.push(va);N.invert(Va.G,L);P.invert(Va.g,ha);for(var rb=0;rb<h.length;rb++){var sb={},ra=h[rb],Ja=ra.game.collision_bounds_type,tb=new Float32Array(4),ub=new Float32Array(3);J.transformMat4(ra.d.e,L,ub);P.multiply(ha,ra.d.g,tb);sb.trans=ub;sb.quat=tb;sb.bounding_type=Ja;sb.worker_bounding=e(l(Ja,ra.d));tc.push(sb)}Sa=
tc}else Sa=[];u.n(u.iq,jc,Mc,bb,Dc,Vc,Nc,sc,lc,Eb,jb,Jb,bc,Fc,Db,Y,Ub,Ec,kc,Sa,cb);T.push(qb);oa[jc]=qb;var Fb=k(jc);Fb.type=Dc;Fb.Fk=sc;Fb.Di=Vc;Cb=Fb;a.k=Cb;rc={l:null,eb:Cb};d.k.m.push(rc)}if(x(a)||q(a)){var ua=a,qa=ua.k.B;x(ua)?(ua.f.type=fa,u.n(u.jq,qa,ua.f.Bw,ua.f.Dw,ua.f.Cw,ua.f.kx,ua.f.Tu)):q(ua)&&(ua.f.type=W,u.n(u.hq,qa,ua.f.dk,ua.f.wl,ua.f.xl));if(ua.f.Ve){var Ka=ua.f.Ve;switch(ua.f.type){case fa:f(Ka[1],ua,qa,!0);f(Ka[0],ua,qa,!0);f(Ka[3],ua,qa,!1);f(Ka[2],ua,qa,!1);break;case W:for(var Kb=
0;Kb<Ka.length;Kb++)f(Ka[Kb],ua,qa,!1)}}ua.k.id=ua.b4w_vehicle_settings.name;y(a,a.f)}else if(r(a)){var cc=a.d,Lb=a.k,dc=cc.vb.max_y-cc.vb.min_y,Vb=Lb.B,vb=a.b4w_character_settings,uc=vb.walk_speed,Mb=vb.run_speed,Nb=vb.step_height,mc=vb.jump_strength,nc=vb.waterline,db=K.et(a);u.n(u.kq,Vb,db,dc,uc,Mb,Nb,mc,nc);Lb.is_character=!0}else if(I(a)){var wb=a,Gb=wb.k.B;u.n(u.nq,Gb,wb.fc.dk,wb.fc.wl,wb.fc.xl);if(wb.fc.Vh)for(var Ta=wb.fc.Vh,Ya=0;Ya<Ta.length;Ya++){var Oa=Ta[Ya],xb=Oa.d.e,C=wb.d.G,za=new Float32Array(16);
N.invert(C,za);var Za=new Float32Array(3);J.transformMat4(xb,za,Za);u.n(u.gq,Gb,Za,Oa.Lr)}wb.k.Bu=!0}else a.b4w_collision&&(Cb.id=a.b4w_collision_id);for(B=0;B<T.length;B++)if(a=T[B],a.k){var ma=a;if(!w(ma))for(var Ca=0;Ca<ma.constraints.length;Ca++){var V=ma.constraints[Ca],Qa=V.target,Ia=V.pivot_type;if("RIGID_BODY_JOINT"==V.type&&Qa.k){var lb=new Float32Array([V.pivot_x,V.pivot_y,V.pivot_z]),Ga,Ob=new Float32Array([V.axis_x,V.axis_y,V.axis_z]);Ga=K.euler_to_quat(Ob,new Float32Array(4));var yb=
N.fromRotationTranslation(Ga,lb,new Float32Array(16)),Hb=N.multiply(ma.d.G,yb,new Float32Array(16)),zb=N.invert(Qa.d.G,new Float32Array(16)),Pb=N.multiply(zb,Hb,zb),Qb=K.Me(Pb),ec=K.matrix_to_quat(Pb),xa=V,Da={};Da.use_limit_x=xa.use_limit_x;Da.use_limit_y=xa.use_limit_y;Da.use_limit_z=xa.use_limit_z;Da.use_angular_limit_x=xa.use_angular_limit_x;Da.use_angular_limit_y=xa.use_angular_limit_y;Da.use_angular_limit_z=xa.use_angular_limit_z;Da.limit_max_x=xa.limit_max_x;Da.limit_min_x=xa.limit_min_x;Da.limit_max_y=
xa.limit_max_y;Da.limit_min_y=xa.limit_min_y;Da.limit_max_z=xa.limit_max_z;Da.limit_min_z=xa.limit_min_z;Da.limit_angle_max_x=xa.limit_angle_max_x;Da.limit_angle_min_x=xa.limit_angle_min_x;Da.limit_angle_max_y=xa.limit_angle_max_y;Da.limit_angle_min_y=xa.limit_angle_min_y;Da.limit_angle_max_z=xa.limit_angle_max_z;Da.limit_angle_min_z=xa.limit_angle_min_z;n(Ia,ma,lb,Ga,Qa,Qb,ec,Da,null,null)}}}};a.ut=h;a.update=function(){for(var a=0;a<T.length;a++){var b=T[a],c=b.k;if(c.Qd&&c.Uj){var d=performance.now()/
1E3-c.Uj,d=Math.min(d,10/60);S.$u&&(d=0);var e=v;F.wu(c.Vj,d,c.ao,c.Yl,v);O.set_translation(b,F.zn(e));O.set_rotation(b,F.tn(e));O.D(b);m(b);if(b.f)for(var c=b,d=c.f.Ve,e=c.d.Ic,f=v,g=0;g<d.length;g++){var h=d[g];F.multiply(e,c.f.lh[g],f);O.Yo(h,f);O.D(h)}b.f&&b.f.hg&&(c=b.f,d=c.hg)&&(e=b.f.lp,h=L,f=b.d.e,g=b.d.g,K.pl(b.f.mp,g,f,h),K.Me(h,d.d.e),K.matrix_to_quat(h,d.d.g),h=D,K.ql(e,g,f,h),e=ha,P.setAxisAngle(h,-c.gg*c.il*2*Math.PI,e),P.multiply(e,d.d.g,d.d.g),O.D(d));b.f&&b.f.fl&&(c=b.f,d=c.fl)&&
(f=b.f.fp,e=L,g=b.d.e,h=b.d.g,K.pl(b.f.gp,h,g,e),K.Me(e,d.d.e),K.matrix_to_quat(e,d.d.g),e=D,K.ql(f,h,g,e),f=ha,g=Math.abs(c.speed)*c.ep,g>c.Gk&&(g=c.Gk),P.setAxisAngle(e,-g,f),P.multiply(f,d.d.g,d.d.g),O.D(d));b.f&&b.f.kl&&(c=b.f,d=c.kl)&&(e=b.f.tp,h=L,f=b.d.e,g=b.d.g,K.pl(b.f.up,g,f,h),K.Me(h,d.d.e),K.matrix_to_quat(h,d.d.g),b=D,K.ql(e,g,f,b),e=ha,P.setAxisAngle(b,-Math.abs(c.uf)*c.Tm,e),P.multiply(e,d.d.g,d.d.g),O.D(d))}}if(a=ba)a=z.ea(a,"MAIN_OPAQUE"),a.ra&&0<a.ra.waves_height&&(b=J.length(a.Jh),
u.n(u.Rq,a.time*b))};a.Nt=function(){return ba};a.pause=function(){E.Wc&&u.n(u.Dq)};a.resume=function(){E.Wc&&u.n(u.Gq)};a.enable_simulation=function(a){a=a.k;if(!a)throw"No object physics";if(!a.Qd){var b=a.B;a.Qd=!0;u.n(u.Bq,b)}};a.disable_simulation=function(a){a=a.k;if(!a)throw"No object physics";if(a.Qd){var b=a.B;a.Qd=!1;u.n(u.Aq,b)}};a.has_physics=function(a){return a.k?!0:!1};a.has_dynamic_physics=function(a){return(a=a.k)&&a.Qd&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.Fk&&!1==a.Di?
!0:!1};a.has_simulated_physics=function(a){return(a=a.k)&&a.Qd?!0:!1};a.set_gravity=function(a,b){u.n(u.Qq,a.k.B,b)};a.ou=w;a.apply_constraint=n;a.clear_constraint=function(a){a=a.k;u.n(u.Fq,a.gi);a.gi=null};a.pull_to_constraint_pivot=function(b,c,d,e,f,g){c=F.qf(c,1,d,v);f=F.qf(f,1,g,M);F.invert(c,c);F.multiply(f,c,c);O.eu(e,f);F.multiply(f,c,c);O.Yo(b,c);O.D(b);a.set_transform(b,b.d.e,b.d.g)};a.set_transform=function(a,b,c){F.uh(a.d.e,1,a.d.g,a.k.Vj);var d=u.sn(u.hf);d.msg_id=u.hf;d.body_id=a.k.B;
d.trans=b;d.quat=c;u.n(u.oc,a.k.B);u.n(u.hf,d)};a.sync_transform=m;a.apply_velocity=function(a,b,c,d){g(a,b,c,d,U);a=a.k.B;u.n(u.oc,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(U[0]),f=Math.abs(U[1]),h=Math.abs(U[2]);U[0]=e?U[0]/e*Math.max(e,b):0;U[1]=f?U[1]/f*Math.max(f,c):0;U[2]=h?U[2]/h*Math.max(h,d):0;u.n(u.Ml,a,U[0],U[1],U[2])};a.apply_velocity_world=function(a,b,c,d){a=a.k.B;u.n(u.oc,a);u.n(u.Ml,a,b,c,d)};a.apply_force=function(a,b,c,d){g(a,b,c,d,U);a=a.k.B;u.n(u.oc,a);u.n(u.sq,
a,U[0],U[1],U[2])};a.apply_torque=function(a,b,c,d){g(a,b,c,d,U);a=a.k.B;u.n(u.oc,a);u.n(u.uq,a,U[0],U[1],U[2])};a.set_character_move_dir=function(a,b,c){a=a.k.B;u.n(u.oc,a);u.n(u.Kq,a,b,c)};a.set_character_move_type=function(a,b){u.n(u.Lq,a.k.B,b)};a.set_character_walk_velocity=function(a,b){u.n(u.Pq,a.k.B,b)};a.set_character_run_velocity=function(a,b){u.n(u.Nq,a.k.B,b)};a.set_character_fly_velocity=function(a,b){u.n(u.Iq,a.k.B,b)};a.character_jump=function(a){u.n(u.vq,a.k.B)};a.character_rotation_inc=
function(a,b,c){u.n(u.wq,a.k.B,b,c)};a.set_character_rotation=function(a,b,c){u.n(u.Mq,a.k.B,b,c)};a.set_character_rotation_h=function(a,b){u.n(u.Jq,a.k.B,b)};a.set_character_rotation_v=function(a,b){u.n(u.Oq,a.k.B,b)};a.Sx=function(){return!1};a.Rx=function(){return!1};a.check_collision=function(){G.error("check_collision() deprecated");return!1};a.Qx=function(){G.error("check_collision_any() deprecated");return!1};a.check_ray_hit=function(){G.error("check_ray_hit() deprecated");return!1};a.Az=function(){G.error("update_object_coords() deprecated")};
a.append_collision_test=function(a,b,c,d){var e=a.k,f=e.B;b=b||"ANY";for(var g=0;g<e.tc.length;g++){var h=e.tc[g];if(h.Tb==b&&h.callback==c)return}g=[];a=a.k.B;h=[];s(b,ba,h,null);for(var m=0;m<h.length;m++){var l=h[m];a<l?g.push([a,l]):a>l&&g.push([l,a])}h={Tb:b,callback:c,Ui:g,Fo:new Uint8Array(g.length),gz:d||!1};e.tc.push(h);u.n(u.oc,f);u.n(u.lq,g,d)};a.remove_collision_test=function(a,b,c){a=a.k;b=b||"ANY";for(var d=0;d<a.tc.length;d++){var e=a.tc[d];if(e.Tb==b&&e.callback==c){a.tc.splice(d,
1);d--;for(var e=e.Ui,f=ba.k.m,g=0;g<f.length;g++)for(var h=f[g].eb,m=0;m<h.tc.length;m++)for(var l=h.tc[m],k=0;k<l.Ui.length;k++)for(var v=l.Ui[k],n=0;n<e.length;n++){var q=e[n];v[0]===q[0]&&v[1]===q[1]&&(e.splice(n,1),n--)}e.length&&u.n(u.Eq,e)}}};a.apply_collision_impulse_test=function(a,b){var c=a.k;c?(u.n(u.tq,c.B),c.di=b):G.error("Object "+a.name+" has no physics")};a.clear_collision_impulse_test=function(a){var b=a.k;b?(u.n(u.yq,b.B),b.di=null):G.error("Object "+a.name+" has no physics")};
a.append_ray_test=function(a,b,c,d,e,f){var g=a.k;if(g){a=g.B;b=b||"ANY";c={C:new Float32Array(c),T:new Float32Array(d),If:e,callback:f,Tb:b,hd:{}};s(b,ba,null,c.hd);delete c.hd[a];for(var h in c.hd)c.hd[h]=1;g.Kd.push(c);t(a,g.Kd)}else G.error("Object "+a.name+" has no physics")};a.remove_ray_test=function(a,b,c,d,e){if(b=a.k){a=b.B;for(var f=0;f<b.Kd.length;f++){var g=b.Kd[f];K.ci(g.C,c,da)&&K.ci(g.T,d,da)&&g.If==e&&(b.Kd.splice(f,1),f--)}t(a,b.Kd)}else G.error("Object "+a.name+" has no physics")};
a.vehicle_throttle=function(a,b){var c=a.f;c.uf=b;y(a,c)};a.vehicle_steer=function(a,b){var c=a.f;c.gg=b;y(a,c)};a.vehicle_brake=function(a,b){var c=a.f;c.Cg=b;y(a,c)};a.is_vehicle_chassis=x;a.is_vehicle_hull=q;a.Au=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.yu=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.Cu=function(a){return a.b4w_floating?
"BOB"==a.b4w_floating_settings.part?!0:!1:!1};a.Vn=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.Un=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.Wn=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.f.speed};a.lx=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};
a.is_character=r;a.Sy=I;a.zy=function(){return 0};a.Ys=function(){u.n(u.zq)};a.wv=function(a){var b=T.indexOf(a);-1!=b?(T.splice(b,1),a=oa.indexOf(a),-1!=a&&oa.splice(a,1)):G.error("Object ",a.name," doesn't have bounding physics")}};b4w.module.__data=function(a,p){function b(a,b){for(var c=P(a,b.id),d=0;d<c.length;d++){var e=c[d];"MESH"==e.type&&delete e.data.submeshes}ib[b.id]=null;ab[b.id]=null}function d(a,b,c){var d;a instanceof ArrayBuffer&&(a=Z.An(a));d=a.width;a=a.height;W.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(Ra)&&c&&W.warn("B4W Warning: image",b,"is not from app root.")}function h(a,b,c,d,e,f){d=b.v;if(!d)throw"Nothing requested";L.enqueue([[d,L.AT_JSON,
d]],function(d,f,g,h){if(d){W.log("%cLOAD METADATA","color: #616",h);f=d.b4w_format_version;if(Number(f)<ga.ho)throw"Incompatible file version: "+f+". Required: "+ga.ho;for(var B in d)a[B]=d[B];(d=a.binaries[0].binfile)?b.hm=d:(ha.bl(b,"load_binaries"),ha.bl(b,"prepare_bindata"));if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)W.error("EXPORT WARNING:",a.b4w_export_warnings[d]);e(b,c)}},null,function(a){f(b,c,a)})}function c(a,b,c,d,e,f){d=H(b.v)+b.hm;if(!d)throw"Binary data is missing";
L.enqueue([[d,L.AT_ARRAYBUFFER,d]],function(d,f,g,h){d&&(W.log("%cLOAD BINARY","color: #616",h),a.bin_data=d,e(b,c))},null,function(a){f(b,c,a)})}function k(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],g=a.objects,h=a.meshes;a=a.actions;for(var B=pa.as(),m=["indices"],k=["normal","tangent"],v=["color","group"],n=["position","texcoord","texcoord2"],q=0;q<h.length;q++)for(var s=h[q].submeshes,L=0;L<s.length;L++)for(var w in s[L]){var r=s[L][w][1];if(-1!=m.indexOf(w)){var t=s[L][w][0]*pb+f["int"],aa=
s[L],M=w,p=d;if(B)var H=new Uint32Array(p,t,r);else for(var H=new Uint32Array(r),p=new DataView(p),y=0;y<r;y++)H[y]=p.getUint32(t+y*pb,!0);aa[M]=H}else if(-1!=n.indexOf(w))t=s[L][w][0]*ac+f["float"],s[L][w]=l(d,t,r,B);else if(-1!=k.indexOf(w)){t=s[L][w][0]*Bb+f["short"];aa=s[L];M=w;p=d;H=new Float32Array(r);p=new DataView(p);for(y=0;y<r;y++)H[y]=p.getInt16(t+y*Bb,!0)/32767;aa[M]=H}else if(-1!=v.indexOf(w)){t=s[L][w][0]*Bb+f.ushort;aa=s[L];M=w;p=d;H=new Float32Array(r);p=new DataView(p);for(y=0;y<
r;y++)H[y]=p.getUint16(t+y*Bb,!0)/65535;aa[M]=H}}for(w=0;w<g.length;w++)for(h=g[w].particle_systems,m=0;m<h.length;m++)k=h[m],k.transforms=l(d,k.transforms[0]*ac+f["float"],k.transforms[1],B);for(g=0;g<a.length;g++){w=a[g];var h=w.fcurves,k=w.frame_range,m=k[0],k=k[1],v=da.Rt(m,k),n=null,u;for(u in h){var q=h[u],x;for(x in q)s=q[x],L=l(d,f["float"]+s.bin_data_pos[0]*ac,s.bin_data_pos[1],B),r=new Float32Array(v),null===n&&(n=new Int8Array(v)),da.Br(s,L,r,n,m,k),s.fr=r}w.$q=n}e(b,c)}function l(a,b,
c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+e*ac,!0)}return d}function e(a,b,c,d,e){var f=a.cameras,h=a.groups,B=a.materials,m=a.meshes,l=a.node_groups,k=a.objects,v=a.particles,n=a.scenes,q=a.speakers,L=a.textures,w=a.worlds;l||(W.warn('B4W Warning: "node_groups" datablock undefined. reexport main scene.'),l=a.node_groups=[]);for(var r="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),
t={},p=0;p<r.length;p++)for(var H=a[r[p]],y=0;y<H.length;y++){var u=H[y];t[u.uuid]=u}for(var x=0;x<n.length;x++){for(var z=n[x],J=z.objects,E=0;E<J.length;E++)s(J,E,t);z.camera&&s(z,"camera",t);z.world&&s(z,"world",t)}for(x=0;x<h.length;x++)for(var I=h[x].objects,E=0;E<I.length;E++)s(I,E,t);for(x=0;x<k.length;x++){var sa=k[x];sa.dupli_group&&s(sa,"dupli_group",t);sa.parent&&s(sa,"parent",t);if(sa.animation_data){var D=sa.animation_data;D.action&&s(D,"action",t);if(D.nla_tracks)for(E=0;E<D.nla_tracks.length;E++)for(var na=
D.nla_tracks[E],F=0;F<na.strips.length;F++)na.strips[F].action&&s(na.strips[F],"action",t)}switch(sa.type){case "MESH":if(!sa.data)throw"mesh not found for object "+sa.name;s(sa,"data",t);for(var ia=sa.modifiers,E=0;E<ia.length;E++){var K=ia[E];"ARMATURE"==K.type?s(K,"object",t):"CURVE"==K.type&&s(K,"object",t)}var S=sa.particle_systems;if(S)for(E=0;E<S.length;E++)s(S[E],"settings",t);break;case "ARMATURE":s(sa,"data",t);for(var ka=sa.pose.bones,O=sa.data.bones,E=0;E<ka.length;E++){var la=ka[E];la.bone=
O[la.bone];for(var Q=la.parent_recursive,F=0;F<Q.length;F++)Q[F]=ka[Q[F]]}break;case "LAMP":s(sa,"data",t);break;case "CAMERA":s(sa,"data",t);break;case "SPEAKER":s(sa,"data",t);break;case "CURVE":s(sa,"data",t)}var T=sa.constraints;if(T)for(E=0;E<T.length;E++){var ya=T[E];ya.target&&s(ya,"target",t)}var U=sa.lod_levels;if(U)for(E=0;E<U.length;E++){var Z=U[E];Z.object&&s(Z,"object",t)}}for(x=0;x<m.length;x++)for(var oa=m[x].materials,E=0;E<oa.length;E++)s(oa,E,t);for(x=0;x<B.length;x++){for(var Fa=
B[x],ba=Fa.texture_slots,E=0;E<ba.length;E++)s(ba[E],"texture",t);var Bb=Fa.node_tree;Bb&&g(Bb,t)}for(x=0;x<l.length;x++)(Bb=l[x].node_tree)&&g(Bb,t);for(x=0;x<L.length;x++){var Ba=L[x],ha=Ba.type;"IMAGE"!=ha&&"ENVIRONMENT_MAP"!=ha||s(Ba,"image",t)}for(x=0;x<f.length;x++){var Pa=f[x];Pa.dof_object&&s(Pa,"dof_object",t)}for(x=0;x<q.length;x++){var pb=q[x];pb.sound&&s(pb,"sound",t);pb.animation_data&&pb.animation_data.action&&s(pb.animation_data,"action",t)}for(x=0;x<v.length;x++){for(var ib=v[x],ba=
ib.texture_slots,E=0;E<ba.length;E++)s(ba[E],"texture",t);ib.dupli_group&&s(ib,"dupli_group",t);ib.dupli_object&&s(ib,"dupli_object",t)}for(x=0;x<w.length;x++)if(ba=w[x].texture_slots)for(E=0;E<ba.length;E++)s(ba[E],"texture",t);ca.$r(a);Na=0===b.id;La||(La=a.scenes[0]);for(var ab=a.textures,ac=Na?a.scenes[0].b4w_anisotropic_filtering:La.b4w_anisotropic_filtering,Ra=0;Ra<ab.length;Ra++)Na||(ab[Ra].b4w_render_scene=""),aa.Qs(ab[Ra],ac,a.scenes);for(var Ta={},Ya=a.objects,Oa=0;Oa<Ya.length;Oa++){var xb=
Ya[Oa];if("MESH"===xb.type&&!xb.particle_systems.length)for(var C=xb.data,za=C.name,Za=C.submeshes,ma=C.materials,Ca=0;Ca<Za.length;Ca++)0!==Za[Ca].base_length||Ta[za]||(W.warn('B4W Warning: material "'+ma[Ca].name+'" is not assigned to any face (object "'+xb.name+'").'),Ta[za]=!0)}for(var V=a.meshes,Qa=0;Qa<V.length;Qa++){var Ia=V[Qa];Ia.materials.length||Ia.uv_textures.length&&W.warn('B4W Warning: mesh "'+Ia.name+'" has a UV map but has no exported material.')}a.materials.push({name:"DEFAULT",use_nodes:!1,
diffuse_shader:"LAMBERT",diffuse_color:[0.8,0.8,0.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:0.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:0.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[0.5,0.5,0.5],b4w_water_fog_density:0.06,
b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:0.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},halo:{size:0.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]});for(var lb=
a.meshes,Ga=pa.keysearch("name","DEFAULT",a.materials),Ob=0;Ob<lb.length;Ob++){var yb=lb[Ob];0==yb.materials.length&&yb.materials.push(Ga)}for(var Hb=a.actions,zb=b.id,Pb=0;Pb<Hb.length;Pb++){var Qb=Hb[Pb];Qb.br=zb;da.kr(Qb)}for(var ec=a.scenes,xa=0;xa<ec.length;xa++){for(var Da=ec[xa],eb=X.fi(Da,"ALL"),Rb=[],fb=0;fb<eb.length;fb++)for(var fc=eb[fb].particle_systems,kb=0;kb<fc.length;kb++){var mb=fc[kb].settings;if("HAIR"==mb.type)if("OBJECT"==mb.render_type)M.rl(mb.dupli_object);else if("GROUP"==
mb.render_type){for(var vc=mb.dupli_group,Sb=X.fi(Da,"EMPTY"),Xa=0;Xa<Sb.length;Xa++)Sb[Xa].dupli_group==vc&&Rb.push(Sb[Xa]);for(Xa=0;Xa<vc.objects.length;Xa++)M.rl(vc.objects[Xa])}else W.warn("B4W Warning: render type",mb.render_type,"not supported for particle systems ("+mb.name+").")}for(fb=0;fb<Rb.length;fb++)G(Rb[fb],[Da])}N(a,b.id);for(var gc=a.scenes,nb=0;nb<gc.length;nb++){for(var Gc=gc[nb],Wb=[],Xb=[],Oc=gc[nb].objects,$a=0;$a<Oc.length;$a++){var Ab=Oc[$a];A(Oc,Ab,Wb,Xb);var Tb=Ab.dupli_group;
if(Tb)for(var gb=Tb.objects,wc=0;wc<gb.length;wc++)A(gb,gb[wc],Wb,Xb)}for($a=0;$a<Xb.length;$a++)G(Xb[$a],[Gc]);for($a=0;$a<Wb.length;$a++)pa.yr(Wb[$a][0],Wb[$a][1])}N(a,b.id);for(var hb=P(a,b.id),Ra=0;Ra<hb.length;Ra++){var xc=hb[Ra];!Na&&xc.parent&&-1<qc.indexOf(xc.parent.type)&&(xc.parent="");M.rl(xc);xc.d.Tc=b.id}for(var Hc=-1,yc=0;yc<hb.length;yc++){var Ic=hb[yc],hc=Ic.d;if(pa.Nb(Ic)&&hc.Ie){var Pc=hc.max_bones;Pc>Hc&&(Hc=Pc)}}for(yc=0;yc<hb.length;yc++)if(Ic=hb[yc],hc=Ic.d,pa.Nb(Ic)&&hc.Ie){hc.max_bones=
Hc;var Qc=Ic,Rc=hc.max_bones,zc=ga.max_bones,Jc=Qc.d;Rc>2*zc?pa.Pf('B4W Error: too many bones for "'+Qc.name):Rc>zc?(W.warn('B4W Warning: too many bones for "'+Qc.name+" / "+Rc+" bones (max "+zc+"). Blending between frames will be disabled."),Jc.Mg=!1):Jc.Mg=!0;Jc.Mg=Jc.Mg&&!Ha.dn}for(var Ac=0;Ac<hb.length;Ac++){var ob=hb[Ac];if(pa.Nb(ob)){var Bc=ob.lod_levels.length;if(Bc){for(var Cc=ob,Yb=0;Yb<Bc;Yb++){var Zb=ob.lod_levels[Yb].object;if(!Zb){Cc.d.Hi=!0;Cc.d.cd=ob.lod_levels[Yb].distance;break}Zb.d.Le=
ob.d.Le;Cc.d.cd=ob.lod_levels[Yb].distance;Zb.d.Zg=ob.lod_levels[Yb].distance;if(ob.lod_levels[Yb+1])Zb.d.cd=ob.lod_levels[Yb+1].distance;else{Zb.d.Hi=!0;Zb.d.cd=1E4;break}Cc.d.Hi=!1;Cc=Zb}wa&&1E4===ob.lod_levels[Bc-1].distance&&W.warn('B4W Warning: object "'+ob.name+'" has default LOD distance.')}}}for(var Sc=0;Sc<hb.length;Sc++){var ea=hb[Sc];if(ea.b4w_vehicle){var Ea=ea.b4w_vehicle_settings;if("CHASSIS"==Ea.part){ea.f={};ea.f.cn=Ea.force_max;ea.f.km=Ea.brake_max;ea.f.Bw=Ea.suspension_compression;
ea.f.Dw=Ea.suspension_stiffness;ea.f.Cw=Ea.suspension_damping;ea.f.kx=Ea.wheel_friction;ea.f.mz=Ea.roll_influence;ea.f.Tu=Ea.max_suspension_travel_cm;ea.f.uf=0;ea.f.Cg=1;ea.f.gg=0;ea.f.speed=0;ea.f.Ve=[];ea.f.lh=[];ea.f.hg=null;for(var Wc=ea.sb?ea.sb.dupli_group.objects:hb,$b=0;$b<Wc.length;$b++){var Aa=Wc[$b];if(Aa.b4w_vehicle){var Ma=Aa.b4w_vehicle_settings;if(fa.Au(Aa)&&Ea.name==Ma.name){var Xc=fa.lx(Aa.b4w_vehicle_settings.part);ea.f.Ve[Xc]=Aa;ea.f.lh[Xc]=new Float32Array(8)}else if(fa.Vn(Aa)&&
Ea.name==Ma.name){ea.f.hg=Aa;ea.f.il=Ma.steering_max;ea.f.kp=Ma.steering_ratio;ea.f.Rn=Ma.inverse_control;var Ua=ja.invert(ea.d.G,new Float32Array(16)),ic=ja.multiply(Ua,Aa.d.G,Ua);ea.f.mp=ic;var oc=new Float32Array([1,0,0,0]);R.transformMat4(oc,ic,oc);ea.f.lp=oc}else if(fa.Un(Aa)&&Ea.name==Ma.name){ea.f.fl=Aa;ea.f.ep=Ma.speed_ratio;ea.f.Gk=Ma.max_speed_angle;var Ua=ja.invert(ea.d.G,new Float32Array(16)),Kc=ja.multiply(Ua,Aa.d.G,Ua);ea.f.gp=Kc;var Tc=new Float32Array([1,0,0,0]);R.transformMat4(Tc,
Kc,Tc);ea.f.fp=Tc}else if(fa.Wn(Aa)&&Ea.name==Ma.name){ea.f.kl=Aa;ea.f.Tm=Ma.delta_tach_angle;var Ua=ja.invert(ea.d.G,new Float32Array(16)),Zc=ja.multiply(Ua,Aa.d.G,Ua);ea.f.up=Zc;var Uc=new Float32Array([1,0,0,0]);R.transformMat4(Uc,Zc,Uc);ea.f.tp=Uc}}}if(4!=ea.f.Ve.length)throw"Not enough wheels for chassis "+ea.name;}else if("HULL"==Ea.part){ea.f={};ea.f.Ve=[];ea.f.lh=[];ea.f.cn=Ea.force_max;ea.f.km=Ea.brake_max;ea.f.dk=Ea.floating_factor;ea.f.wl=Ea.water_lin_damp;ea.f.xl=Ea.water_rot_damp;ea.f.uf=
0;ea.f.Cg=1;ea.f.gg=0;ea.f.speed=0;ea.f.hg=null;for(var cd=ea.sb?ea.sb.dupli_group.objects:hb,$b=0;$b<cd.length;$b++)Aa=cd[$b],Aa.b4w_vehicle&&(Ma=Aa.b4w_vehicle_settings,fa.yu(Aa)&&Ea.name==Ma.name?(ea.f.Ve.push(Aa),ea.f.lh.push(new Float32Array(8))):fa.Vn(Aa)&&Ea.name==Ma.name?(ea.f.hg=Aa,ea.f.il=Ma.steering_max,ea.f.kp=Ma.steering_ratio,ea.f.Rn=Ma.inverse_control,Ua=ja.invert(ea.d.G,new Float32Array(16)),ic=ja.multiply(Ua,Aa.d.G,Ua),ea.f.mp=ic,oc=new Float32Array([1,0,0,0]),R.transformMat4(oc,
ic,oc),ea.f.lp=oc):fa.Un(Aa)&&Ea.name==Ma.name?(ea.f.fl=Aa,ea.f.ep=Ma.speed_ratio,ea.f.Gk=Ma.max_speed_angle,Ua=ja.invert(ea.d.G,new Float32Array(16)),Kc=ja.multiply(Ua,Aa.d.G,Ua),ea.f.gp=Kc,Tc=new Float32Array([1,0,0,0]),R.transformMat4(Tc,Kc,Tc),ea.f.fp=Tc):fa.Wn(Aa)&&Ea.name==Ma.name&&(ea.f.kl=Aa,ea.f.Tm=Ma.delta_tach_angle,Ua=ja.invert(ea.d.G,new Float32Array(16)),Zc=ja.multiply(Ua,Aa.d.G,Ua),ea.f.up=Zc,Uc=new Float32Array([1,0,0,0]),R.transformMat4(Uc,Zc,Uc),ea.f.tp=Uc))}}}for(var ad=0;ad<hb.length;ad++){var pc=
hb[ad];if(pc.b4w_floating){var $c=pc.b4w_floating_settings;if("MAIN_BODY"==$c.part){pc.fc={};pc.fc.dk=$c.floating_factor;pc.fc.wl=$c.water_lin_damp;pc.fc.xl=$c.water_rot_damp;pc.fc.Vh=[];for(var dd=pc.sb?pc.sb.dupli_group.objects:hb,bd=0;bd<dd.length;bd++){var Yc=dd[bd];if(Yc.b4w_floating){var ed=Yc.b4w_floating_settings;fa.Cu(Yc)&&$c.name==ed.name&&(pc.fc.Vh.push(Yc),Yc.Lr=Yc.b4w_floating_settings.synchronize_position)}}}}}e(b,c)}function f(a,b,c,d,e){!Na&&1<a.scenes.length&&(a.scenes=[a.scenes[0]],
W.warn("B4W Warning: loading data contains multiple scenes.","Only the first one will be loaded."));for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];if(Na){if(!f.camera)throw"Scene check failed: No camera";if(!X.fi(f,"LAMP").length)throw"Scene check failed: No lamp";}for(var g=X.fi(f,"MESH"),h=0;h<g.length;h++){var B=g[h],m=ca.zr(B);m&&(a.meshes.push(m),B.data=m)}for(var h=P(a,b.id),B=a.meshes,m=B.slice(0),l=0;l<h.length;l++){var k=h[l];"MESH"==k.type&&(k=m.indexOf(k.data),-1<k&&m.splice(k,1))}for(l=
0;l<m.length;l++)B.splice(B.indexOf(m[l]),1);Na?(X.pr(f),ya.Wc&&f.b4w_enable_physics&&fa.bm(f),f.b4w_enable_audio&&ia.cm(f),h=X.nk(f),B=f.b4w_batch_grid_size):(X.vr(f,La),ya.Wc&&f.b4w_enable_physics&&!La.k&&fa.bm(La),f.b4w_enable_audio&&!La.h&&ia.cm(La),h=X.nk(La),B=La.b4w_batch_grid_size);g=ba.Kt(h,B,g,f.world);Na?(X.Wl(f,g),X.Dt(h)):X.Wl(La,g)}d=a.materials;if(la.Xj&&ga.Dp)for(f=0;f<d.length;f++){g=d[f];m=g.texture_slots;for(h=0;h<m.length;h++)if(l=m[h],k=l.texture,"IMAGE"==k.type||"ENVIRONMENT_MAP"==
k.type)B=k.image,B.Sb||(-1<B.filepath.indexOf(".dds")?B.Sb=!0:(B.Sb=!k.b4w_disable_compression&&!l.use_map_normal&&"ENVIRONMENT_MAP"!=k.type&&!k.b4w_shore_dist_map,B.Sb&&(B.filepath+=".dds")));if(h=g.node_tree)for(m=h.nodes,h=0;h<m.length;h++)B=m[h],"TEXTURE"==B.type&&((l=B.texture)?(B=l.image,B.Sb||(B.Sb=l.d.Rh&&!l.b4w_disable_compression,B.Sb&&(B.filepath+=".dds"))):W.warn("B4W Warning: material ",g.name," has empty textures."))}else for(d=a.images,f=0;f<d.length;f++)g=d[f],g.Sb=Boolean("FILE"==
g.source&&-1<g.filepath.indexOf(".dds"));Ba&&W.log("%cDEBUG BPYDATA:","color: #a0a",a);e(b,c)}function w(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},g={},h={},B={},m=0;m<d.length;m++){var l=d[m];f[l.uuid]=l;h[l.uuid]=l}for(m=0;m<a.length;m++)l=a[m],g[l.uuid]=l,B[l.uuid]=l;n(a,null,B,h);for(var k in h)k in f||d.push(h[k]);for(k in B)k in g||a.push(B[k]);e(b,c)}function n(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=c[g.uuid];if(g=h.proxy){b&&-1==e.indexOf(g.uuid)&&e.push(g.uuid);for(var B=
c[g.uuid],l=B.constraints,g=0;g<l.length;g++){var k=pa.Pc(l[g]);k.name+="_CLONE";h.constraints.push(k)}"b4w_proxy_inherit_anim"in h&&!h.b4w_proxy_inherit_anim||(h.animation_data&&(B.animation_data=pa.Pc(h.animation_data)),B.b4w_use_default_animation=h.b4w_use_default_animation,B.b4w_auto_skel_anim=h.b4w_auto_skel_anim,B.b4w_cyclic_animation=h.b4w_cyclic_animation)}}for(f=0;f<e.length;f++)h=pa.ok(a,"uuid",e[f]),-1<h&&a.splice(h,1);e={};for(f=0;f<a.length;f++)g=a[f],h=c[g.uuid],b&&(l=pa.Pc(h),h="origin_name"in
h?h.origin_name:h.name,l.name=b+"*"+h,l.origin_name=h,m(l),c[l.uuid]=l,e[g.uuid]=l.uuid,g.uuid=l.uuid),h=c[g.uuid],h.dupli_group&&(g=h.dupli_group,l=d[g.uuid],B=pa.Pc(l),B.name=pa.mj(l.name+"_CLONE"),B.uuid=v.Ln("Group"+B.name),d[B.uuid]=B,g.uuid=B.uuid,n(B.objects,h.name,c,d));if(b)for(f=0;f<a.length;f++){g=a[f];h=c[g.uuid];h.parent&&h.parent.uuid in e?h.parent.uuid=e[h.parent.uuid]:h.parent&&(W.warn("B4W Warning: Object's \""+h.name+'" parent is not in dupli group. Disabling parenting.'),h.parent=
null);l=h.constraints;for(g=0;g<l.length;g++)b=l[g],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=h.modifiers;for(g=0;g<b.length;g++)d=b[g],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((h=h.lod_levels)&&h.length)for(g=0;g<h.length;g++)b=h[g],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}}function m(a){a.uuid=v.Ln("Object"+a.name)}function g(a,b){for(var c=a.nodes,d=0;d<c.length;d++){var e=c[d];"MATERIAL"!=e.type&&"MATERIAL_EXT"!=e.type||!e.material||
s(e,"material",b);"TEXTURE"==e.type&&e.texture&&s(e,"texture",b);"GROUP"==e.type&&e.node_group&&s(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var f=e[d];t(f,"from_node",c);t(f,"to_node",c);y(f,"from_socket",f.from_node.outputs);y(f,"to_socket",f.to_node.inputs)}}function s(a,b,c){(c=c[a[b].uuid])||W.error("Dangling link found:",b,a);a[b]=c}function t(a,b,c){c=pa.keysearch("name",a[b].name,c);a[b]=c}function y(a,b,c){c=pa.keysearch("identifier",a[b].identifier,c);a[b]=c}function x(a,b,c,e,
f,g){if(!ga.do_not_load_resources){for(var h=H(b.v),B=a.images,l={},m=[],k=0;k<B.length;k++){var v=B[k],n=v.uuid;if("FILE"===v.source){var s=q(v,a.textures);if(!s.length)W.warn("B4W Warning: image ",v.name," has no users.");else if(!s[0].b4w_shore_dist_map){var w=J(h+v.filepath),s=v.Sb?L.AT_ARRAYBUFFER:L.AT_IMAGE_ELEMENT;la.Hk&&ga.rj&&(w=L.gl(w),"dds"==w[1]?(w=L.gl(w[0]),w=w[0]+".min50."+w[1]+".dds"):w=w[0]+".min50."+w[1]);m.push([n,s,w,v.name]);l[n]=v}}}m.length?(e.Mn=0,L.enqueue(m,function(f,h,
B,k){if(f){d(f,k,!0);h=l[h];B=q(h,a.textures);for(k=0;k<B.length;k++){var v=B[k];aa.pj(v.d,f,h.Sb,v.image.filepath)}f=++e.Mn/m.length;g(b,c,f)}},function(){W.log("%cLOADED ALL IMAGES","color: #0a0");f(b,c)})):f(b,c)}}function q(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function r(a,b,c,d,e,f){if(!ga.do_not_load_resources){a=P(a,b.id);for(var g=H(b.v),h=[],B={},m=0;m<a.length;m++){var l=a[m];if(I(l)){var k=l.data.sound,v=k.uuid;"BACKGROUND_MUSIC"==ia.yn(l)&&(v=
pa.Ct());if(!(v in B)){B[v]=[];k=J(g+k.filepath);switch(ia.cp(l)){case ia.uj:var n=L.AT_AUDIOBUFFER;break;case ia.Bl:n=L.AT_AUDIO_ELEMENT}var k=L.gl(k),q=ia.dt(k[1]);if(q!=k[1]){if(L.zu()){ha.bl(b,"load_speakers");return}k=k[0]+".lossconv."+q}else k=k[0]+"."+q;h.push([v,n,k])}B[v].push(l)}}h.length?L.enqueue(h,function(a,e,g,l){if(a){W.log("%cLOAD SOUND","color: #0aa",l);-1==l.indexOf(Ra)&&W.warn("B4W Warning: sound",l,"is not from app root.");e=B[e];for(g=0;g<e.length;g++)ia.Xw(e[g],a);a=++d.jw/
h.length;f(b,c,a)}},function(){W.log("%cLOADED ALL SOUNDS","color: #0aa");for(var a=X.get_active(),a=X.ha(a,"SPEAKER",X.DATA_ID_ALL),d=0;d<a.length;d++){var f=a[d];ia.Je(f)&&ia.is_cyclic(f)&&ia.play_def(f)}e(b,c)}):e(b,c)}}function I(a){return ia.Je(a)&&ia.cp(a)!=ia.Cl?!0:!1}function A(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,f=0;f<e;f++){var g=b.lod_levels[f],h=g.object;if(h){var B=pa.bi(h);B.name=b.name+"_LOD_"+String(f+1);m(B);B.lod_levels=[];c.push([a,B]);d.push(h);
g.object=B}}}function G(a,b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=f.objects,g=f.indexOf(a),-1<g&&f.splice(g,1))}var g=d.indexOf(a);-1<g&&d.splice(g,1)}}function Q(a,b,c,d,e){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d],g=Na?f.b4w_enable_physics:La.b4w_enable_physics||f.b4w_enable_physics;Na||(f=La);for(var h=0;h<Fa.length;h++)for(var B=X.ha(f,Fa[h],X.DATA_ID_ALL),l=0;l<B.length;l++){var m=B[l];m.d.Tc==b.id&&ya.Wc&&g&&(fa.append_object(m,
f),b.co&&fa.has_physics(m)&&fa.disable_simulation(m))}}e(b,c)}function u(a,b,c,e,f){var g={};e=[];for(var h=a.scenes,B=0;B<a.scenes.length;B++){var l=h[B];if(l.d.ra&&(l=l.d.ra.fj)&&"FILE"===l.source){var m=l.uuid,k=J(H(b.v)+l.filepath);e.push([m,l.Sb?L.AT_ARRAYBUFFER:L.AT_IMAGE_ELEMENT,k,l.name]);g[m]=l}}e.length?L.enqueue(e,function(b,c,e,f){if(b){d(b,f,!0);c=g[c];f=q(c,a.textures);for(e=0;e<f.length;e++){var B=f[e];aa.pj(B.d,b,c.Sb,B.image.filepath)}for(e=0;e<h.length;e++)if(f=h[e],f.d.ra.fj===
c){var l=b,m=c,k=document.createElement("canvas"),B=m.size[0],m=m.size[1];k.width=B;k.height=m;k=k.getContext("2d");k.drawImage(l,0,0);l=k.getImageData(0,0,B,m).data;k=new Float32Array(4);k[0]=1/16581375;k[1]=1/65025;k[2]=1/255;k[3]=1;for(var B=B*m,m=new Float32Array(B),v=0;v<B;v++)m[v]=k[1]*l[4*v+2]+k[2]*l[4*v+3];f.d.$k=m}}},function(){f(b,c)}):f(b,c)}function z(a,b,c,e,f){if(ga.antialiasing&&ga.smaa){e=a.scenes[0];a=[];for(var g=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING",
"SMAA_RESOLVE"],h=0;h<g.length;h++){var B=X.ea(e,g[h]);B&&a.push(B)}if(a.length){e=[];h=L.AT_IMAGE_ELEMENT;e.push(["SEARCH_TEXTURE",h,T.xb.smaa_search_texture_path,"smaa_search_texture"]);e.push(["AREA_TEXTURE",h,T.xb.smaa_area_texture_path,"smaa_area_texture"]);for(h=0;h<a.length;h++)if(g=a[h],"SMAA_BLENDING_WEIGHT_CALCULATION"==g.type){a=g.X;for(h=0;h<a.length;h++)if(g=a[h],"u_search_tex"==g.T)var l=g.ka;else if("u_area_tex"==g.T)var m=g.ka;break}e.length?L.enqueue(e,function(a,b,c,e){a&&(d(a,e,
!1),b="SEARCH_TEXTURE"==b?l:m,b.source="IMAGE",b.em=!0,aa.pj(b,a,-1!=e.indexOf(".dds")?1:0,e),aa.dj(b,aa.t,aa.t))},function(){f(b,c)}):f(b,c)}else f(b,c)}else f(b,c)}function O(a,b,c,d){for(c=0;c<a.scenes.length;c++){var e=a.scenes[c];Na||(e=La);for(var f=X.ha(e,"ALL",X.DATA_ID_ALL),g=0;g<f.length;g++){var h=f[g];h.d.Tc==b.id&&(b.co&&X.hide_object(h),d.Xl.push({Jv:e,obj:h}))}}}function F(a,b,c,d,e,f){a=d.Xl;var g=d.mo;a?(e=a[g].obj,g=a[g].Jv,X.append_object(g,e),-1!=Pa.indexOf(e.type)&&g.b4w_enable_audio&&
ia.append_object(e,g),d=++d.mo/a.length):d=1;f(b,c,d)}function K(a,b,c,d,e){if(Na){for(d=0;d<a.scenes.length;d++){var f=a.scenes[d];X.kv(f);f.b4w_use_nla&&na.Vw(f,f.b4w_nla_cyclic)}X.set_active(a.scenes[0])}else X.Cp(La);a=P(a,b.id);M.Uw(a);e(b,c)}function H(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function J(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&
(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function P(a,b){ab[b]||N(a,b);return ab[b]}function N(a,b){for(var c=a.scenes,d=[],e=0;e<c.length;e++)E(c[e].objects,0,d);ab[b]=[];for(e=0;e<d.length;e++)for(var c=d[e],f=0;f<c.length;f++)for(var g=c[f],h=0;h<g.length;h++)ab[b].push(g[h])}function E(a,b,c){c[b]=c[b]||[];for(var d=c[b],e=0;e<a.length;e++){var f=a[e],g=S(f);d[g]=d[g]||[];(Na||-1==qc.indexOf(f.type))&&
-1==d[g].indexOf(f)&&d[g].push(f);(f=f.dupli_group)&&E(f.objects,b+1,c)}}function S(a){return(a=a.parent||da.get_first_armature_object(a))?1+S(a):0}var da=p("__animation"),ba=p("__batch"),T=p("__config"),oa=p("__controls"),Z=p("__dds"),U=p("__extensions"),D=p("__lights"),ha=p("__loader"),L=p("__assets"),v=p("__md5"),M=p("__objects"),fa=p("__physics"),W=p("__print"),ca=p("__reformer"),ka=p("__renderer"),X=p("__scenes"),na=p("__nla"),ia=p("__sfx"),B=p("__shaders"),aa=p("__textures"),sa=p("__nodemat"),
pa=p("__util"),R=p("vec4"),ja=p("mat4"),ga=T.q,la=T.td,ya=T.eb,Ha=T.ie,Ba=!1,wa=!1,pb=4,Bb=2,ac=4,ib=null,ab=null,Ra="",Na=!1,La=null,qc=["LAMP","CAMERA"],Fa=["MESH","CAMERA","EMPTY"],Pa=["SPEAKER"];a.is_primary_loaded=function(a){return ha.is_primary_loaded(a)};a.update=function(){ha.Ww(ib)};a.load=function(a,d,g,B,l){var m={load_main:{Va:ha.be,jb:!1,A:[],nb:!1,zb:500,Hb:!1,Za:h},duplicate_objects:{Va:ha.ce,jb:!1,A:["load_main"],nb:!1,zb:50,Hb:!1,Za:w},load_binaries:{Va:ha.be,jb:!1,A:["load_main"],
nb:!1,zb:500,Hb:!1,Za:c},prepare_bindata:{Va:ha.ce,jb:!1,A:["duplicate_objects","load_binaries"],nb:!1,zb:0,Hb:!1,Za:k},prepare_root_datablocks:{Va:ha.ce,jb:!1,A:["duplicate_objects","prepare_bindata"],nb:!1,zb:150,Hb:!1,Za:e},prepare_root_scenes:{Va:ha.ce,jb:!1,A:["prepare_root_datablocks"],nb:!1,zb:350,Hb:!1,Za:f},load_smaa_textures:{Va:ha.be,jb:!0,A:["prepare_root_scenes"],nb:!1,zb:10,Hb:!0,Za:z},load_shoremap:{Va:ha.be,jb:!0,A:["prepare_root_scenes"],nb:!1,zb:10,Hb:!0,Za:u},load_textures:{Va:ha.be,
jb:!0,A:["prepare_root_scenes"],nb:!0,zb:500,Hb:!1,Za:x,pe:{Mn:0}},add_physics_objects:{Va:ha.ce,jb:!1,A:["load_shoremap"],nb:!1,zb:20,Hb:!1,Za:Q},add_objects:{Va:ha.ce,jb:!1,A:["add_physics_objects"],nb:!1,zb:800,Hb:!1,Za:O,Eg:F,Dg:K,pe:{Xl:[],mo:0}},load_speakers:{Va:ha.be,jb:!0,A:["add_objects"],nb:!0,zb:30,Hb:!1,Za:r,pe:{jw:0}}},v=ha.wn();v||(v=ha.Ks(),ib=[],ab=[]);ib[v.Hc.length]={};return ha.Ss(m,a,d,g,b,B,ga.do_not_load_resources,l)};a.unload=function(a){var b=ha.wn();if(!b||!b.Hc.length||
a&&!ha.Fw(b.Hc[a]))W.error("Unable to unload data!");else if(0==a)W.log("%cUNLOAD ALL","color: #00a"),da.cleanup(),ia.cleanup(),na.cleanup(),X.cleanup(),D.cleanup(),ha.cleanup(),fa.cleanup(),M.cleanup(),pa.cleanup(),ka.cleanup(),sa.cleanup(),B.cleanup(),oa.cleanup(),U.cleanup(),L.cleanup(),ab=null,Na=!1,ib=La=null;else{W.log("%cUNLOAD DATA "+a,"color: #00a");da.vv(a);for(var b=X.ui(),c=0;c<b.length;c++)for(var d=b[c],e=X.ha(d,"ALL",X.DATA_ID_ALL),f=e.length-1;0<=f;f--){var g=e[f];if(g.d.Tc==a){var h=
d,l=g;da.is_animated(l)&&da.remove(l);X.clear_glow_anim(l);fa.has_physics(l)&&(fa.disable_simulation(l),fa.wv(l));oa.check_sensor_manifold(l)&&oa.remove_sensor_manifold(l);X.xv(h,l);ia.Je(l)&&ia.kw(l);e.splice(f,1);h=X.ha(d,g.type,X.DATA_ID_ALL);g=h.indexOf(g);-1!=g&&h.splice(g,1)}}}};a.set_debug_resources_root=function(a){Ra=a}};b4w.module.__batch=function(a,p){function b(a){a={type:a,id:0,yv:0,Of:"",Aa:[],Rb:[],ic:[],jo:[],Qc:[],cf:null,Ga:{},Ab:null,Fa:null,Bc:null,Ya:null,gc:null,kb:null,Qm:!1,num_vertices:0,num_triangles:0,Ei:0,Fi:0,xf:0,yi:0,qk:0,Eb:new Float32Array(3),Dm:new Float32Array(3),vc:new Float32Array(16),ma:!1,Em:!1,L:!1,da:!1,Vc:!1,Kb:!1,Lb:!1,gb:!1,Pb:!1,Jb:!1,ac:!1,pa:!1,Qf:!1,wc:N.wg,ae:N.pd,ng:0,ml:new Float32Array(2),o:new Float32Array(2),Dn:!1,Hn:0,En:0,In:0,Jn:0,Gn:new Float32Array(3),Fn:new Float32Array(3),
De:!1,rc:0,zd:0,te:1,ph:0,dp:0,fh:0,se:0,ge:1,ko:0,Ik:0,Pe:0,Po:0,Uc:Array(2),Oe:Array(4),wd:new Float32Array(2),cc:new Float32Array(3),Fc:new Float32Array(3),md:new Float32Array(3),Sa:new Float32Array(4),Yc:new Float32Array(4),Bf:null,xk:null,vk:null,uk:null,wk:null,Xd:!1,water_dynamic:!1,yl:!1,Lp:!1,Mp:0,Np:0,Kp:0,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,bn:new Float32Array(2),an:new Float32Array(2),ek:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
Ne:null,Uk:!1,xo:0,so:0,Mk:0,wo:0,zo:0,yo:0,uo:0,vo:0,Nk:0,po:0,oo:0,Bo:0,ro:0,Ti:new Float32Array(3),Ao:new Float32Array(8),qo:new Float32Array(16)};a.Sa[3]=1;a.Em=!0;a.L=!0;a.ng=1;return a}function d(a,b){for(var d=[],e=0;e<a.length;e++){var f=a[e],g=f.d,h=k(f.data.b4w_bounding_box);g.vb=h;var l=f.data.b4w_bounding_cylinder_radius,m=g,v=l,n=h;m.Jj=K.Jm(v,n);m.Hj=K.Hm(l,n);m.Ij=K.Im(v,n);h=K.Wh(h,g.G);g.Ha=h;h=K.Tj(f.data.b4w_bounding_sphere_radius,f.data.b4w_bounding_sphere_center);g.hc=h;h=K.Mj(h,
g.G);g.Xa=h;h=f.data.b4w_bounding_ellipsoid_axes;h=K.Sj([h[0],0,0],[0,h[1],0],[0,0,h[2]],f.data.b4w_bounding_ellipsoid_center);g.me=h;h=K.Lj(h,g.Ic);g.ne=h;d=d.concat(c(f,g,b))}return d}function h(a,b,d){for(var e=[],f=[],g={},h=0;h<a.length;h++){var l=a[h],m=l.d,v=k(l.data.b4w_bounding_box),n=K.Wh(v,m.G),q=K.Tj(l.data.b4w_bounding_sphere_radius,l.data.b4w_bounding_sphere_center),s=K.Mj(q,m.G),w=l.data.b4w_bounding_ellipsoid_axes,w=K.Sj([w[0],0,0],[0,w[1],0],[0,0,w[2]],l.data.b4w_bounding_ellipsoid_center),
r=K.Lj(w,m.Ic);m.vb=v;m.Ha=n;m.hc=q;m.Xa=s;m.me=w;m.ne=r;v={};v.Kb=m.Kb;v.Lb=m.Lb;v.gb=m.gb;v.jd=m.jd;v.Si=m.Si;v.wi=m.wi;v.Pb=m.Pb;v.Jb=m.Jb;v.ac=m.ac;v.oe=m.oe;v.Kc=m.Kc;v.dd=m.dd;v.lb=m.lb;v.zf=m.zf;v.Ai=m.Ai;v.pa=m.pa;v.rf=m.rf;v.li=m.li;v.Vc=m.Vc;n=m.Xa.U;v.mu=0==d?[0,0]:[Math.floor(n[0]/d),Math.floor(n[2]/d)];v.cd=m.cd;v.Zg=m.Zg;v.Le=m.Le;m=JSON.stringify(v);g[m]=g[m]||[];g[m].push(l)}for(var t in g){v=JSON.parse(t);d=g[t];var l=da.hi("STATIC"),M;for(M in v)l[M]=v[M];l.Tc=a[0].d.Tc;l.Lc=0;l.$d=
0;l.yd=0;l.xd=0;l.ud=0;l.Sg=!1;for(h=0;h<d.length;h++)m=d[h],0==h?(l.Ha=L.ua(m.d.Ha),l.Xa=L.ua(m.d.Xa),l.me=L.ua(m.d.me),l.ne=L.ua(m.d.ne)):(K.Vm(l.Ha,m.d.Ha),K.ot(l.Xa,m.d.Xa));l.vb=L.ua(l.Ha);l.hc=L.ua(l.Xa);f.push({pb:l,Fb:d})}for(a=0;a<f.length;a++)for(g=f[a].pb,h=f[a].Fb,t=0;t<h.length;t++){m=h[t];M=c(m,g,b);d=G(m.d)||G(g);l={};g.Kc&&(l.au_center_pos=[d[0],d[1],d[2]],l.au_wind_bending_amp=[m.d.Lc],l.au_wind_bending_freq=[m.b4w_wind_bending_freq],l.au_detail_bending_amp=[m.b4w_detail_bending_amp],
l.au_detail_bending_freq=[m.b4w_detail_bending_freq],l.au_branch_bending_amp=[m.b4w_branch_bending_amp]);for(m=0;m<M.length;m++)v=M[m].pb,n=M[m].Mb,v.tk?v.zf?N.yw(n,d):N.op(n,d):(n=N.op(n,d),N.xw(n,l));e=e.concat(M)}for(a=0;a<f.length;a++)for(g=f[a].pb,h=f[a].Fb,t=0;t<h.length;t++)m=h[t],m.Ql=m.d,m.d=g;return e}function c(a,c,d){var f=[];if(a.b4w_do_not_render)return f;for(var g=l(d,c),h=L.$h(c,0),m=a.data,k=m.materials,n=0;n<g.length;n++)for(var q=g[n],s=0;s<k.length;s++)if(!N.Kn(m,s)){var w=b(q),
t=k[s];if(e(w,t,!0)){w.wc=m.wc||N.wg;"COLOR_ID"===q&&w.Dm.set(a.Pl);x(w,c);for(var M=w,p=a.particle_systems,H=0;H<p.length;H++){var y=p[H].settings.b4w_vcol_from_name,u=p[H].settings.b4w_vcol_to_name;""!==y&&""!==u&&(M.Ga[y]={Ae:!1,src:[{name:y,Yb:7}]})}"DYNAMIC"==c.type&&(w.Of=a.uuid);Q(w,h);M=N.Zm(m,s,w.Qc,w.gc,w.Ga,w.cf);"LENS_FLARES"==t.name&&(M=ba.jv(M));f.push({l:w,Mb:M,Ob:[t.name],pb:c,jc:[a]})}}m=a.particle_systems;if(0<m.length&&f.length){g=!0;for(n=0;n<m.length;n++)if(m[n].settings.use_render_emitter){g=
!1;break}n=f[0].l;m=f[0].Mb;k=[];q=a.particle_systems;s=a.data;for(w=0;w<q.length;w++)if(t=q[w],M=t.settings,M.count)if("EMITTER"==M.type){if("DYNAMIC"==c.type){p=b("PARTICLES");H=s.materials;y=t.settings.material-1;y>=H.length&&(J.warn('B4W Warning: Wrong material used for rendering particle system "'+t.name+'"'),y=0);H=H[y];"HALO"===t.settings.render_type&&(p.De=!0);e(p,H);x(p,c);y=p;switch(t.settings.b4w_billboard_align){case "VIEW":r(y,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":r(y,
"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":r(y,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":r(y,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}p.Vc=!0;p.Of=a.name+"_"+M.uuid;Q(p,h);p.Bc=t;M=ba.Gt(p,s,t,a.d.Ic);ba.Qv(p,t,H);k.push({l:p,Mb:M,Ob:[H.name],pb:c,jc:[a]})}}else if("HAIR"==M.type){p=L.Ci(t.seed);M.b4w_dynamic_grass&&(c.rf=!0);if(t.transforms.length)var E=t.transforms;else for(var H=N.kk(m,M.count,!1,p),E=new Float32Array(4*
H.length),z=0;z<H.length;z++)y=0.75+0.5*L.$b(p),E[4*z]=H[z][0],E[4*z+1]=H[z][1],E[4*z+2]=H[z][2],E[4*z+3]=y;H=Z.Ca(d,"GRASS_MAP")?!0:!1;if("OBJECT"==M.render_type)y=[l(d,M.dupli_object.d)],t=A(a,c,n,m,[M.dupli_object],y,[E],M,t,H,p,!1),k=k.concat(t);else if("GROUP"==M.render_type){for(var u=M.dupli_group.objects,X=!1,y=[],z=0;z<u.length;z++){var fa=l(d,M.dupli_group.objects[z].d);y.push(fa)}if(M.use_whole_group){X=E;E=u;z={};for(fa=0;fa<X.length;fa+=4)for(var P=0;P<E.length;P++){var G=v.create();
v.scale(E[P].d.e,E[P].d.scale,G);var I=v.clone([X[fa],X[fa+1],X[fa+2]]);v.add(I,G,I);z[P]||(z[P]=new Float32Array(X.length));z[P][fa]=I[0];z[P][fa+1]=I[1];z[P][fa+2]=I[2];z[P][fa+3]=X[fa+3]}E=z;X=!0}else if(M.use_group_count){for(var I=u,W=M.dupli_weights,z=p,fa={},P=[],G=0;G<I.length;G++)for(var D=I[G],D=D.origin_name||D.name,na=0;na<W.length;na++){var F=W[na];D==F.name.split(": ")[0]&&P.push(F)}W.length!=P.length&&J.error("B4W Error: dupli weights match failed");for(G=0;G<E.length;G+=4){var ia,
W=P;ia=[0];for(I=0;I<W.length;I++)ia[I+1]=ia[I]+W[I].count;W=ia[ia.length-1]*L.$b(z);for(I=D=0;I<ia.length;I++)if(W>=ia[I]&&W<ia[I+1]){D=I;break}ia=D;fa[ia]=fa[ia]||[];fa[ia].push(E[G],E[G+1],E[G+2],E[G+3])}for(ia in fa)fa[ia]=new Float32Array(fa[ia]);E=fa}else{z=p;fa=u.length;P={};for(G=0;G<E.length;G+=4){var ca=Math.floor(fa*L.$b(z));P[ca]=P[ca]||[];P[ca].push(E[G],E[G+1],E[G+2],E[G+3])}for(ca in P)P[ca]=new Float32Array(P[ca]);E=P}t=A(a,c,n,m,u,y,E,M,t,H,p,X);k=k.concat(t)}"INSTANCE"==M.b4w_wind_bend_inheritance&&
(a.d.Lc=0)}else throw"Unknown particle settings type";a=k;f=g?a:f.concat(a)}return f}function k(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}}function l(a,b){var c=["MAIN","NODES"];b.jd&&(Z.Ca(a,"COLOR_PICKING")||Z.Ca(a,"GLOW_MASK"))&&c.push("COLOR_ID");Z.Ca(a,"WIREFRAME")&&c.push("WIREFRAME");c.push("PHYSICS");(Z.Ca(a,"DEPTH")||Z.Ca(a,"SHADOW_CAST"))&&c.push("DEPTH");Z.Ca(a,"GRASS_MAP")&&c.push("GRASS_MAP");if(b.Lb||b.Jb){var d=null;b.Lb&&(d=["MAIN",
"NODES","COLOR_ID","PHYSICS","WIREFRAME"]);if(b.Jb)var e=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],d=null!==d?L.Cr(d,e):e;for(e=0;e<d.length;e++){var f=c.indexOf(d[e]);-1!==f&&c.splice(f,1)}}return c}function e(a,b,c){var d,e;switch(a.type){case "MAIN":if(b.b4w_collision||b.use_nodes)a=!1;else{for(var h=0;4>h;h++)a.Oe[h]=new Float32Array([0,0]);f(a,b);a.Pe=b.offset_z;a.Fc.set([1,1,1]);var l=b.texture_slots;M.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Sa);switch(b.name){case "LENS_FLARES":z(a,
"special_lens_flares.glslv","special_lens_flares.glslf");q(a,"a_position");q(a,"a_texcoord");var k=c?[1,1,1,0]:null,k=w(l[0],k);O(a,k);break;default:z(a,"main.glslv","main.glslf");var h=n("use_map_color_diffuse",l)[0],v=n("use_map_color_spec",l)[0],L=n("use_map_normal",l)[0],p=n("use_map_mirror",l)[0],H=n("use_map_color_diffuse",l)[1],y=n("use_rgb_to_intensity",l)[0]&&n("use_stencil",l)[0];if(h){switch(h.blend_type){case "MIX":r(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":r(a,
"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}k="IMAGE"==h.texture.d.source&&c?[a.Sa[0],a.Sa[1],a.Sa[2],1]:"ENVIRONMENT_MAP"==h.texture.d.source&&c?[0.8,0.8,0.8,1]:null;k=w(h,k);O(a,k,"u_colormap0");a.se=h.diffuse_color_factor;a.ge=h.use_map_alpha?h.alpha_factor:0;a.wd.set(h.texture.b4w_uv_velocity_trans);a.Fc.set(h.scale)}var x=h&&h==v;v&&(x||(k=c?[0.5,0.5,0.5,1]:null,k=w(v,k),O(a,k,"u_specmap")),a.dp=v.specular_color_factor);if(L&&(q(a,"a_normal"),q(a,"a_tangent"),k=c?[0.5,0.5,1,1]:null,k=
w(L,k),O(a,k,"u_normalmap0"),a.ko=L.normal_factor,l=L.texture,a.Oe[0].set(l.b4w_uv_velocity_trans),l.b4w_use_map_parallax&&W.eh)){var k=U.s(l.b4w_parallax_steps),E=U.s(l.b4w_parallax_lod_dist);r(a,"PARALLAX",1);r(a,"PARALLAX_STEPS",k);r(a,"PARALLAX_LOD_DIST",E);a.fh=l.b4w_parallax_scale}p&&(k=c?[0,0,0.5,1]:null,k=w(p,k),O(a,k,"u_mirrormap"),a.Ik=p.mirror_factor);if(l=h&&H&&y?1:0)k=c?[0.8,0.8,0.8,1]:null,k=w(H,k),O(a,k,"u_colormap1"),k=c?[0.5,0.5,0.5,1]:null,k=w(y,k),O(a,k,"u_stencil0");(c=h||v||L)&&
a.Fc.set(c.scale);r(a,"TEXTURE_COLOR",void 0==h?0:1);r(a,"TEXTURE_SPEC",void 0==v?0:1);r(a,"TEXTURE_NORM",void 0==L?0:1);r(a,"TEXTURE_MIRROR",void 0==p?0:1);r(a,"ALPHA_AS_SPEC",x?1:0);r(a,"TEXTURE_STENCIL_ALPHA_MASK",l);q(a,"a_position");q(a,"a_normal");(h||v||L)&&q(a,"a_texcoord");if(b.b4w_water){a.Xd=!0;a.yl=b.b4w_water_shore_smoothing;a.water_dynamic=b.b4w_water_dynamic;c=b.texture_slots;z(a,"special_water.glslv","special_water.glslf");q(a,"a_position");q(a,"a_texcoord");q(a,"a_normal");q(a,"a_tangent");
p=n("use_map_normal",c);v=n("use_map_mirror",c)[0];L=n("use_map_alpha",c)[0];p.length&&(x=w(p[0]),O(a,x,"u_normalmap0"));r(a,"NUM_NORMALMAPS",p.length);a.Ne=Array(p.length);for(x=0;x<p.length;x++)a.Oe[x].set(p[x].texture.b4w_uv_velocity_trans),a.Ne[x]=new Float32Array(2),a.Ne[x].set([p[x].scale[0],p[x].scale[1]]);v?(r(a,"TEXTURE_MIRROR",1),p=w(v),O(a,p,"u_mirrormap"),a.Ik=v.mirror_factor):r(a,"TEXTURE_MIRROR",0);L?(r(a,"ALPHA_MAP",1),v=w(L),O(a,v,"u_alphamap")):r(a,"ALPHA_MAP",0);v=null;for(x=0;x<
c.length;x++)if(d=c[x],!0===d.texture.b4w_water_foam){v=d;break}v&&W.vf?(r(a,"FOAM",1),L=w(v),O(a,L,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.bn.set(v.texture.b4w_foam_uv_freq),a.an.set(v.texture.b4w_foam_uv_magnitude),a.ek[0]=v.scale[0],a.ek[1]=v.scale[1]):r(a,"FOAM",0);for(x=0;x<c.length;x++)if(d=c[x],!0===d.texture.b4w_shore_dist_map){e=d;break}e&&W.zj?(e=w(e),O(a,e,"u_shore_dist_map"),r(a,"SHORE_PARAMS",1),e=d.texture.b4w_shore_boundings,r(a,"MAX_SHORE_DIST",U.s(d.texture.b4w_max_shore_dist)),
r(a,"SHORE_MAP_SIZE_X",U.s(e[0]-e[1])),r(a,"SHORE_MAP_SIZE_Z",U.s(e[2]-e[3])),r(a,"SHORE_MAP_CENTER_X",U.s((e[0]+e[1])/2)),r(a,"SHORE_MAP_CENTER_Z",U.s((e[2]+e[3])/2))):r(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&W.deferred_rendering?(r(a,"GENERATED_MESH",1),a.Lp=!0,a.Mp=b.b4w_water_num_cascads,a.Np=b.b4w_water_subdivs,a.Kp=b.b4w_water_detailed_dist):r(a,"GENERATED_MESH",0);if(b.b4w_water_dynamic){d=U.s(b.b4w_water_dst_noise_scale0);e=U.s(b.b4w_water_dst_noise_scale1);c=U.s(b.b4w_water_dst_noise_freq0);
var v=U.s(b.b4w_water_dst_noise_freq1),L=U.s(b.b4w_water_dir_min_shore_fac),p=U.s(b.b4w_water_dir_freq),x=U.s(b.b4w_water_dir_noise_scale),y=U.s(b.b4w_water_dir_noise_freq),k=U.s(b.b4w_water_dir_min_noise_fac),E=U.s(b.b4w_water_dst_min_fac),u=U.s(b.b4w_water_waves_hor_fac);r(a,"DST_NOISE_SCALE_0",d);r(a,"DST_NOISE_SCALE_1",e);r(a,"DST_NOISE_FREQ_0",c);r(a,"DST_NOISE_FREQ_1",v);r(a,"DIR_MIN_SHR_FAC",L);r(a,"DIR_FREQ",p);r(a,"DIR_NOISE_SCALE",x);r(a,"DIR_NOISE_FREQ",y);r(a,"DIR_MIN_NOISE_FAC",k);r(a,
"DST_MIN_FAC",E);r(a,"WAVES_HOR_FAC",u)}g(a,b);s(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;r(a,"ABSORB",U.s(b.b4w_water_absorb_factor));r(a,"SSS_STRENGTH",U.s(b.b4w_water_sss_strength));r(a,"SSS_WIDTH",U.s(b.b4w_water_sss_width));d=a.Fa;e=a.Qc;a.Fa=d;a.Qc=e}"HALO"===b.type&&(d=b.halo,z(a,"halo.glslv","halo.glslf"),r(a,"NUM_RINGS",d.ring_count),
r(a,"NUM_LINES",d.line_count),r(a,"NUM_STARS",d.star_tip_count),r(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.Qc=["a_position"],a.Hn=d.size,a.En=d.hardness/20,a.Gn.set(d.b4w_halo_rings_color),a.Fn.set(d.b4w_halo_lines_color),a.In=1/b.b4w_halo_stars_blend_height,a.Jn=b.b4w_halo_stars_min_height,a.Dn=!0);h&&"NORMAL"==h.texture_coords||l&&"NORMAL"==H.texture_coords?r(a,"TEXTURE_COORDS","TEXTURE_COORDS_NORMAL"):h&&"UV"==h.texture_coords?r(a,"TEXTURE_COORDS","TEXTURE_COORDS_UV"):r(a,"TEXTURE_COORDS",0);
r(a,"SHADELESS",b.use_shadeless?1:0)}h=b.game_settings.alpha_blend;r(a,"ALPHA","OPAQUE"===h?0:1);r(a,"ALPHA_CLIP","CLIP"===h?1:0);r(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(r(a,"VERTEX_COLOR",1),q(a,"a_color")):r(a,"VERTEX_COLOR",0);a.rc=b.ambient;a.te=b.diffuse_intensity;a.zd=b.emit;a.md.set(b.specular_color);g(a,b);s(a,b);b.b4w_wettable?r(a,"WETTABLE",1):r(a,"WETTABLE",0);m(a,b);b.b4w_refractive&&W.Md?(a.Uk=!0,a.Po=b.b4w_refr_bump,r(a,"REFRACTIVE",1)):
r(a,"REFRACTIVE",0);W.Ce?r(a,"UNROLL_LOOPS",1):r(a,"UNROLL_LOOPS",0);a=!0}break;case "NODES":a=t(a,b);break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_collision||"HALO"===b.type)a=!1;else if(f(a,b),a.ma)a=!1;else{z(a,"depth.glslv","depth.glslf");q(a,"a_position");h=b.game_settings.alpha_blend;r(a,"ALPHA","OPAQUE"===h?0:1);a.Fc.set([1,1,1]);if((b=n("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===h){a.Fc.set(b.scale);r(a,"TEXTURE_COLOR",1);q(a,"a_texcoord");if("IMAGE"==b.texture.d.source||
"ENVIRONMENT_MAP"==b.texture.d.source)h=w(b),O(a,h,"u_colormap0"),a.wd.set(b.texture.b4w_uv_velocity_trans);"NONE"==b.texture.d.source&&(h=w(b),O(a,h,"u_colormap0"),a.wd.set(b.texture.b4w_uv_velocity_trans))}else r(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.$w=b.b4w_use_ghost,a.Tb=b.b4w_collision_id,a.Bm=b.b4w_collision_group,a.Cm=b.b4w_collision_mask,a.Ng=b.physics.friction,a.Ig=b.physics.elasticity,a=!0):b.b4w_water?(a.Xd=!0,a.hx=b.b4w_water_dynamic,a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,
a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||
b.b4w_collision||"HALO"===b.type)a=!1;else{f(a,b);a.ma=!1;z(a,"color_id.glslv","color_id.glslf");q(a,"a_position");h=b.game_settings.alpha_blend;r(a,"ALPHA","OPAQUE"===h?0:1);a.Fc.set([1,1,1]);if((b=n("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===h){a.Fc.set(b.scale);r(a,"TEXTURE_COLOR",1);q(a,"a_texcoord");if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)h=w(b),O(a,h,"u_colormap0"),a.wd.set(b.texture.b4w_uv_velocity_trans);"NONE"==b.texture.d.source&&(h=w(b),O(a,h,"u_colormap0"),
a.wd.set(b.texture.b4w_uv_velocity_trans))}else r(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":b.b4w_terrain?(f(a,b),a.ma=!1,a.ae=N.pd,a.L=!0,z(a,"grass_map.glslv","grass_map.glslf"),q(a,"a_position"),h=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.Ga.a_grass_size={Ae:!0,src:[]},h?(a.Ga.a_grass_size.src.push({name:h,Yb:4}),r(a,"DYNAMIC_GRASS_SIZE",1)):r(a,"DYNAMIC_GRASS_SIZE",0),a.Ga.a_grass_color={Ae:!0,src:[]},b?(a.Ga.a_grass_color.src.push({name:b,
Yb:7}),r(a,"DYNAMIC_GRASS_COLOR",1)):r(a,"DYNAMIC_GRASS_COLOR",0),W.Ce?r(a,"UNROLL_LOOPS",1):r(a,"UNROLL_LOOPS",0),a=!0):a=!1;break;case "WIREFRAME":"LENS_FLARES"===b.name||b.b4w_water||b.b4w_collision||"HALO"===b.type?a=!1:(z(a,"wireframe.glslv","wireframe.glslf"),q(a,"a_position"),q(a,"a_normal"),q(a,"a_polyindex"),a.L=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],W.Ce?r(a,"UNROLL_LOOPS",1):r(a,"UNROLL_LOOPS",0),a=!0);break;case "PARTICLES":h=b.texture_slots;if(a.De)z(a,"particles_color.glslv",
"particles_color.glslf");else if(z(a,"particles_texture.glslv","particles_texture.glslf"),h=n("use_map_color_diffuse",h)[0]){r(a,"TEXTURE_COLOR",1);switch(h.blend_type){case "MIX":r(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":r(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.se=h.diffuse_color_factor;a.ge=h.use_map_alpha?h.alpha_factor:0;h=w(h);O(a,h)}M.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Sa);a.rc=b.ambient;a.te=b.diffuse_intensity;
a.zd=b.emit;a.md.set(b.specular_color);q(a,"a_position");q(a,"a_normal");h=b.game_settings.alpha_blend;r(a,"ALPHA","OPAQUE"===h?0:1);r(a,"ALPHA_CLIP","CLIP"===h?1:0);r(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);g(a,b);s(a,b);f(a,b);a.Pe=b.offset_z;W.Ce?r(a,"UNROLL_LOOPS",1):r(a,"UNROLL_LOOPS",0);a=!0;break;default:throw"Wrong batch type: "+a.type;}return a}function f(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.ma=!0;a.ae=N.Ol;a.L=!0;break;case "ALPHA":a.ma=!0;a.ae=N.pd;
a.L=!0;break;case "CLIP":a.ma=!1;a.ae=N.pd;a.L=!0;break;case "ADD":a.ma=!0;a.ae=N.pd;a.L=!1;break;case "OPAQUE":a.ma=!1;a.ae=N.pd;a.L=!0;break;default:throw Error("Unknown alpha blend mode: "+d);}a.da=c.use_backface_culling}function w(a,b){var c=a.texture,d=c.d,c=c.image;d&&b&&c&&D.pj(d,b,c.Sb,c.filepath);return d}function n(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];!0==f[a]&&f.texture&&f.texture.d&&c.push(f)}return c}function m(a,b){var c=b.raytrace_transparency;a.Yc[0]=c.fresnel;a.Yc[1]=
1-c.fresnel_factor/5;c=b.raytrace_mirror;a.ph=c.reflect_factor;a.Yc[2]=c.fresnel;a.Yc[3]=1-c.fresnel_factor/5}function g(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":r(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":r(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;case "TOON":r(a,"SPECULAR_SHADER","SPECULAR_TOON");c=b.specular_toon_size;d=b.specular_toon_smooth;break;default:J.error("B4W Error: unsupported specular shader: "+
b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.cc[0]=b.specular_intensity;a.cc[1]=c;a.cc[2]=d}function s(a,b){switch(b.diffuse_shader){case "LAMBERT":r(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.Uc[0]=0;a.Uc[1]=0;break;case "OREN_NAYAR":r(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.Uc[0]=b.roughness;a.Uc[1]=0;break;case "FRESNEL":r(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.Uc[0]=b.diffuse_fresnel;a.Uc[1]=b.diffuse_fresnel_factor;break;default:J.error("B4W Error: unsupported diffuse shader: "+
b.diffuse_shader+' (material "'+b.name+'")'),a.Uc[0]=0,a.Uc[1]=0}}function t(a,b){if(!b.use_nodes)return!1;var c=S.js(b.node_tree,b.uuid,!1);if(!c)return J.error('Failed to create node graph for material "'+b.name+'", disable nodes'),y(a,b),!0;z(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;r(a,"ALPHA","OPAQUE"===d?0:1);r(a,"ALPHA_CLIP","CLIP"===d?1:0);r(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);q(a,"a_position");f(a,b);a.Pe=b.offset_z;M.set(b.diffuse_color[0],
b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.Sa);a.zd=b.emit;a.rc=b.ambient;m(a,b);b.b4w_wettable?r(a,"WETTABLE",1):r(a,"WETTABLE",0);a.jo=S.ks(c);E.K(c,function(c,d){switch(d.type){case "GEOMETRY_UV":var e=d.data.name,f=d.data.value;a.cf||(a.cf={});a.cf[f]=e;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":e=d.data.name;a.Ga[e]={Ae:!0,src:[{name:d.data.value}]};f=0;if("GEOMETRY_VC"==d.type)f=7;else for(var g=0;g<d.Ea.length;g++){var h="RGB".indexOf(d.Ea[g].identifier);
-1<h&&(f|=1<<2-h)}a.Ga[e].src[0].Yb=f;break;case "GEOMETRY_NO":q(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":e=d.data.value;r(a,"SHADED",1);q(a,"a_normal");r(a,"DIFFUSE_SHADER","DIFFUSE_"+e.diffuse_shader);r(a,"SPECULAR_SHADER","SPECULAR_"+e.specular_shader);break;case "TEXTURE_COLOR":case "TEXTURE_COLOR2":case "TEXTURE_COLOR3":case "TEXTURE_ENVIRONMENT":e=d.data.name;f=d.data.value;!1!==f.d.Rh&&(f.d.Rh="TEXTURE_ENVIRONMENT"!=d.type?!0:!1);O(a,f.d,e);break;case "TEXTURE_NORMAL":case "TEXTURE_NORMAL2":case "TEXTURE_NORMAL3":case "PARALLAX":r(a,
"CALC_TBN_SPACE",1);q(a,"a_normal");q(a,"a_tangent");e=d.data.name;(f=d.data.value)?(f.d.Rh=!1,O(a,f.d,e)):J.error("Missing texture in node ",d.name,"for material ",b.name);break;case "LAMP":d.data&&(a.Bf=d.data);case "REFRACTION":W.Md&&(a.Uk=!0)}});W.Ce?r(a,"UNROLL_LOOPS",1):r(a,"UNROLL_LOOPS",0);return!0}function y(a,b){z(a,"main.glslv","main.glslf");var c=b.game_settings.alpha_blend;r(a,"ALPHA","OPAQUE"===c?0:1);r(a,"ALPHA_CLIP","CLIP"===c?1:0);r(a,"SHADELESS",1);q(a,"a_position");M.set(1,0,1,
1,a.Sa);r(a,"VERTEX_COLOR",0);a.Pe=b.offset_z;f(a,b)}function x(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.tk?r(a,"AU_QUALIFIER","attribute"):r(a,"AU_QUALIFIER","uniform"),r(a,"STATIC_BATCH",0)):(r(a,"AU_QUALIFIER","attribute"),r(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(P.bu()?r(a,"WIREFRAME_QUALITY",1):r(a,"WIREFRAME_QUALITY",0),a.Yj?(r(a,"DEBUG_SPHERE",1),a.Qm?r(a,"DEBUG_SPHERE_DYNAMIC",1):r(a,"DEBUG_SPHERE_DYNAMIC",0)):r(a,"DEBUG_SPHERE",0),r(a,"ALPHA",1));b.Kc?(""!==b.dd?(a.Ga.a_bending_col_main=
{Ae:!0,src:[{name:b.dd,Yb:4}]},q(a,"a_bending_col_main"),""!==b.lb.$n&&""!==b.lb.Zn&&""!==b.lb.no?(a.Ga.a_bending_col_detail={Ae:!0,src:[{name:b.lb.$n,Yb:4},{name:b.lb.Zn,Yb:2},{name:b.lb.no,Yb:1}]},q(a,"a_bending_col_detail"),q(a,"a_normal"),r(a,"DETAIL_BEND",1)):r(a,"DETAIL_BEND",0),r(a,"MAIN_BEND_COL",1)):r(a,"MAIN_BEND_COL",0),r(a,"WIND_BEND",1)):r(a,"WIND_BEND",0);b.Th?r(a,"BEND_CENTER_ONLY",1):r(a,"BEND_CENTER_ONLY",0);b.zf?r(a,"HAIR_BILLBOARD",1):r(a,"HAIR_BILLBOARD",0);b.Cn?r(a,"HAIR_BILLBOARD_SPHERICAL",
1):r(a,"HAIR_BILLBOARD_SPHERICAL",0);switch(b.Ai){case "RANDOM":r(a,"HAIR_BILLBOARD_RANDOM",1);r(a,"HAIR_BILLBOARD_JITTERED",0);break;case "JITTERED":r(a,"HAIR_BILLBOARD_RANDOM",0);r(a,"HAIR_BILLBOARD_JITTERED",1);break;default:r(a,"HAIR_BILLBOARD_RANDOM",0),r(a,"HAIR_BILLBOARD_JITTERED",0)}b.pa&&W.zj?r(a,"DYNAMIC_GRASS",1):r(a,"DYNAMIC_GRASS",0);a.pa=b.pa;a.Vc=b.Vc;a.Kb=b.Kb;a.Lb=b.Lb;a.gb=b.gb;a.Pb=b.Pb;a.Jb=b.Jb;a.ac=b.ac;b.Ie?(q(a,"a_influence"),r(a,"SKINNED",1),b.Mg?r(a,"FRAMES_BLENDING",1):
r(a,"FRAMES_BLENDING",0),r(a,"MAX_BONES",b.max_bones)):(r(a,"SKINNED",0),r(a,"FRAMES_BLENDING",0));b.Gh?r(a,"VERTEX_ANIM",1):r(a,"VERTEX_ANIM",0);if(b.Ie&&b.Gh)throw"Skinning and vertex animation are mutually exlusive";b.li?r(a,"DISABLE_FOG",1):r(a,"DISABLE_FOG",0);b.gc&&(a.gc=b.gc)}}function q(a,b){var c=a.Qc;-1==c.indexOf(b)&&c.push(b)}function r(a,b,c){U.I(a.Fa,b,c)}function I(a,b){if("PHYSICS"==a.type)a.Mb=b;else{var c=a.ae,d=a.wc;a.Dn&&(b=N.qt(b));a.Lp&&(b=T.Lt(a.Mp,a.Np,a.Kp));c=N.Aw(b,c,d,
a.Ga);X||a.Vc||c.Bi||(c.Dd=null,c.Jc=null);a.Ya=c;c=b.r.length;a.num_vertices=b.w*c;a:switch(a.wc){case N.wg:case N.Lh:case N.Dl:d=!0;break a;default:d=!1}d?N.Du(b)?a.num_triangles=b.W.length/3*c:a.num_triangles=b.w/3*c:a.num_triangles=0;ka&&(a.Mb=b)}}function A(a,c,d,f,g,h,m,l,k,n,q,s){var w=[],t=l.b4w_dynamic_grass;if(!n&&t)return w;for(var r="INSTANCE"==l.b4w_wind_bend_inheritance,p="INSTANCE"==l.b4w_shadow_inheritance,H="INSTANCE"==l.b4w_reflection_inheritance,y=[],E=[],u=0;u<g.length;u++){var z=
g[u],A=L.bi(c);A.zf=l.b4w_hair_billboard;A.Ai=l.b4w_hair_billboard_type;A.pa=t;A.Cn="SPHERICAL"==l.b4w_hair_billboard_geometry;A.tk=!0;r?(A.Kc=z.d.Kc,A.Kh=z.d.Kh,A.$d=z.d.$d,A.yd=z.d.yd,A.dd=z.d.dd,A.xd=z.d.xd,A.ud=z.d.ud,A.Lc=z.d.Lc,A.lb=z.d.lb,A.Th=!1):(A.Kc=a.d.Kc,A.Kh=a.d.Kh,A.$d=a.d.$d,A.yd=a.d.yd,A.dd=a.d.dd,A.xd=a.d.xd,A.ud=a.d.ud,A.Lc=a.d.Lc,A.lb=a.d.lb,A.Th=!0);p?(A.Kb=z.d.Kb,A.Lb=z.d.Lb,A.gb=z.d.gb):(A.Kb=a.d.Kb,A.Lb=a.d.Lb,A.gb=a.d.gb);H?(A.Pb=z.d.Pb,A.Jb=z.d.Jb,A.ac=z.d.ac):(A.Pb=a.d.Pb,
A.Jb=a.d.Jb,A.ac=a.d.ac);y.push(A);var X=m[u];X||(X=new Float32Array);s&&L.Ci(k.seed,q);for(var P=new Float32Array(3),G=new Float32Array([0,0,0,1]),I=[],W=0;W<X.length;W+=4){P[0]=X[W];P[1]=X[W+1];P[2]=X[W+2];var D=X[W+3];if(l.b4w_initial_rand_rotation){switch(l.b4w_rotation_type){case "XYZ":var na=new Float32Array([L.$b(q),L.$b(q),L.$b(q)]);v.normalize(na,na);break;case "Z":na=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+l.b4w_rotation_type;}fa.setAxisAngle(na,
l.b4w_rand_rotation_strength*(2*Math.PI*L.$b(q)-Math.PI),G)}var F=ha.qf(P,D,G);I.push(F)}E.push(I)}for(var ca={},u=0;u<g.length;u++){var K=h[u],A=y[u],S=L.$h(A,0),I=E[u];if(I.length)for(var ka=g[u].data,O=ka.materials,W=0;W<O.length;W++)if(!N.Kn(ka,W))for(var da=0;da<K.length;da++){var T=K[da];if("COLOR_ID"!==T){var U=b(T),Z=O[W];if(e(U,Z,!0)){U.wc=ka.wc||N.wg;x(U,A);U.Of=l.uuid;"JITTERED"==l.b4w_hair_billboard_type&&(U.Ei=l.b4w_hair_billboard_jitter_amp,U.Fi=l.b4w_hair_billboard_jitter_freq);t&&
(U.yi=l.b4w_dynamic_grass_scale_threshold);r||(delete U.Ga.a_bending_col_main,delete U.Ga.a_bending_col_detail);Q(U,S);var oa=N.Zm(ka,W,U.Qc,U.gc,U.Ga,U.cf),ba=[];if(A.Kc||A.pa||A.zf)ba.au_wind_bending_amp=[A.Lc],ba.au_wind_bending_freq=[A.$d],ba.au_detail_bending_freq=[A.yd],ba.au_detail_bending_amp=[A.xd],ba.au_branch_bending_amp=[A.ud];var Eb=N.Ou(oa,ba,I),jb=Eb,Jb=I;jb.u.au_center_pos=new Float32Array(3*jb.w);for(var bc=Jb.length,Fc=jb.w/bc,Ub=0;Ub<bc;Ub++)for(var Y=Jb[Ub],cb=3*Fc*Ub,Sa=0;Sa<
Fc;Sa++)jb.u.au_center_pos[cb+3*Sa]=Y[0],jb.u.au_center_pos[cb+3*Sa+1]=Y[1],jb.u.au_center_pos[cb+3*Sa+2]=Y[2];Eb=jb;if(A.Th){var ta=Eb,tc=a.d.G;ta.u.a_emitter_center=new Float32Array(3*ta.w);var va=M.fromValues(0,0,0,1);M.transformMat4(va,tc,va);for(var rb=0;rb<ta.w;rb++)ta.u.a_emitter_center[3*rb]=va[0],ta.u.a_emitter_center[3*rb+1]=va[1],ta.u.a_emitter_center[3*rb+2]=va[2];Eb=ta}var sb=l.b4w_vcol_from_name,ra=l.b4w_vcol_to_name,Ja=U,tb=d,ub=!r,Fb=ka,ua=[];if(""!==sb&&""!==ra){var qa,Ka=ra,Kb=Ja.Ga,
cc=[],Lb=void 0;for(Lb in Kb)for(var dc=Kb[Lb].src,Vb=0,vb=0;vb<dc.length;vb++){var uc=dc[vb].Yb;Ka==dc[vb].name&&cc.push(Lb,uc,Vb);Vb+=L.We(uc)}qa=cc;if(0<qa.length)for(var Mb=0;Mb<qa.length;Mb+=3)ua.push({Jg:sb,ri:7,Vi:qa[Mb],Wi:qa[Mb+1],pi:qa[Mb+2]});else N.nu(Ja.Qc,"a_color")&&ra==Fb.active_vcol_name&&ua.push({Jg:sb,ri:7,Vi:"a_color",Wi:7,pi:0})}ub&&("a_bending_col_main"in tb.Ga&&ua.push({Jg:"a_bending_col_main",ri:4,Vi:"a_bending_col_main",Wi:4,pi:0}),"a_bending_col_detail"in tb.Ga&&ua.push({Jg:"a_bending_col_detail",
ri:7,Vi:"a_bending_col_detail",Wi:7,pi:0}));for(var Nb=Eb,mc=I,nc=f,db=ua,wb=U.Ga,Gb=!1,Ta=0;Ta<db.length;Ta++){var Ya=db[Ta].Jg,Oa=nc.u[Ya];if(Oa&&0<Oa.length){Gb=!0;break}}if(Gb){var xb,C=a.d.vb,za=nc.r[0].a_position,Za=mc,ma=ca,Ca=new Float32Array(3),V=new Float32Array(3),Qa=new Uint32Array(Za.length);if(!("verts_indices"in ma)){ma.Oc=new Float32Array(3);ma.Nc=new Float32Array(3);ma.vl=new Uint32Array(za.length/3);ma.$g=new Uint32Array(za.length/3);ma.Oc[0]=(C.max_x-C.min_x)/ia;ma.Oc[1]=(C.max_y-
C.min_y)/ia;ma.Oc[2]=(C.max_z-C.min_z)/ia;ma.Nc[0]=C.min_x;ma.Nc[1]=C.min_y;ma.Nc[2]=C.min_z;for(var Ia=0;Ia<za.length/3;Ia++){var lb=L.lc((za[3*Ia]-ma.Nc[0])/ma.Oc[0]),Ga=L.lc((za[3*Ia+1]-ma.Nc[1])/ma.Oc[1]),Ob=L.lc((za[3*Ia+2]-ma.Nc[2])/ma.Oc[2]),lb=L.clamp(lb,0,ia-1),Ga=L.clamp(Ga,0,ia-1),Ob=L.clamp(Ob,0,ia-1);ma.vl[Ia]=Ia;ma.$g[Ia]=Ob*Math.pow(ia,2)+Ga*ia+lb}N.iw(ma.$g,ma.vl,!0);ma.ef=new Uint32Array(Math.pow(ia,3));for(Ia=0;Ia<ma.$g.length;Ia++)ma.ef[ma.$g[Ia]]++;delete ma.$g;for(Ia=1;Ia<ma.ef.length;Ia++)ma.ef[Ia]+=
ma.ef[Ia-1]}for(var yb=0;yb<Za.length;yb++){Ca[0]=Za[yb][0];Ca[1]=Za[yb][1];Ca[2]=Za[yb][2];for(var Hb=1E10,zb=-1,Pb=L.lc((Ca[0]-ma.Nc[0])/ma.Oc[0]),Qb=L.lc((Ca[1]-ma.Nc[1])/ma.Oc[1]),ec=L.lc((Ca[2]-ma.Nc[2])/ma.Oc[2]),Pb=L.clamp(Pb,0,ia-1),Qb=L.clamp(Qb,0,ia-1),ec=L.clamp(ec,0,ia-1),xa=ec*Math.pow(ia,2)+Qb*ia+Pb,Da=ma.ef[xa],eb=0==xa?0:ma.ef[xa-1];eb<Da;eb++){var Rb=ma.vl[eb];V[0]=za[3*Rb];V[1]=za[3*Rb+1];V[2]=za[3*Rb+2];v.sub(V,Ca,V);var fb=v.sqrLen(V);fb<=Hb&&(Hb=fb,zb=Rb)}if(-1==zb)for(eb=0;eb<
za.length/3;eb++)V[0]=za[3*eb],V[1]=za[3*eb+1],V[2]=za[3*eb+2],v.sub(V,Ca,V),fb=v.sqrLen(V),fb<=Hb&&(Hb=fb,zb=eb);Qa[yb]=zb}xb=Qa;for(var fc=Nb.w/mc.length,Ta=0;Ta<db.length;Ta++){var kb=db[Ta].Vi,mb=db[Ta].Wi,Ya=db[Ta].Jg,vc=db[Ta].ri,Oa=nc.u[Ya];switch(kb){case "a_bending_col_main":var Sb=1;break;case "a_bending_col_detail":Sb=3;break;case "a_color":Sb=3;break;default:for(var Xa=Sb=0;Xa<wb[kb].src.length;Xa++)Sb+=L.We(wb[kb].src[Xa].Yb)}if(Oa&&0<Oa.length){var gc=L.We(vc),nb=L.We(mb),Gc=vc&mb,Wb=
L.So(Gc);Gc!=mb&&J.error("Wrong color extraction from "+Ya+" to "+kb+".");if("a_bending_col_main"==kb||"a_bending_col_detail"==kb)Nb.u[kb]=new Float32Array(Nb.w*nb);for(Xa=0;Xa<mc.length;Xa++){var Xb=xb[Xa],Oc=Xb*gc,$a=Xa*fc*Sb;if(-1!=Xb)for(var Ab=0;Ab<fc;Ab++)for(var Tb=Ab*Sb,gb=0;gb<Wb.length;gb++)Wb[gb]&&(Nb.u[kb][$a+Tb+(db[Ta].pi+L.sh(mb,gb))]=Oa[Oc+L.sh(vc,gb)])}}else Nb.u[kb]=new Float32Array(0)}}Eb=Nb;w.push({l:U,Mb:Eb,Ob:[Z.name],pb:A,jc:[a]})}}}}return w}function G(a){return ha.qf(a.e,a.scale,
a.g)}function Q(a,b){for(var c=null,d=0;d<a.Aa.length;d++){var e=a.Aa[d].Qi;e&&(c||(c={}),c[d]=e,a.Aa[d].Qi=null)}a.id=0;a.yv=b;a.id=L.$h(a,b);if(c)for(d in c)a.Aa[d].Qi=c[d]}function u(a,c,d,e,f){var g=b("WIREFRAME");z(g,"wireframe.glslv","wireframe.glslf");g.wireframe_mode=0;g.Yj=!0;g.L=!0;g.Of=d;f&&(g.Qm=!0);x(g,c);Q(g,L.$h(c,0));e?(c=T.hn(1,a.U),N.Iv(c,[a.je[0],a.ke[1],a.le[2]],a.U)):c=T.hn(a.Na,a.U);N.pp(c,1,!0);c.u.a_polyindex=N.rt(c);I(g,c);return g}function z(a,b,c){a.Fa={aa:b,$:c,S:[]};U.Pv(a.Fa)}
function O(a,b,c){1==a.Aa.length&&0==a.Rb.length&&a.Rb.push("default0");c=c||"default"+String(a.Aa.length);-1==a.Rb.indexOf(c)&&(a.Aa.push(b),a.Rb.push(c))}function F(a){if(!a.Fa)throw"No shaders info for batch "+a.name;a.Ab=U.mk(a.Fa,a.jo);oa.Fr(a.Ab)}var K=p("__boundings"),H=p("__config"),J=p("__print"),P=p("__extensions"),N=p("__geometry"),E=p("__graph"),S=p("__nodemat"),da=p("__objects"),ba=p("__particles"),T=p("__primitives");p("__reformer");var oa=p("__renderer"),Z=p("__scenegraph"),U=p("__shaders"),
D=p("__textures"),ha=p("__tsr"),L=p("__util"),v=p("vec3"),M=p("vec4"),fa=p("quat"),W=H.q,ca=H.Sf,ka=!1,X=!1,na=["MAIN","NODES"],ia=20;a.Jy=b;a.Kt=function(a,c,e,f){for(var g=[],l=[],m=0;m<e.length;m++){var k=e[m];switch(k.d.type){case "DYNAMIC":g.push(k);break;case "STATIC":l.push(k)}}e=[];e=e.concat(d(g,a));a=e=e.concat(h(l,a,c));m=[];e=[];c={};for(k=0;k<a.length;k++){var l=a[k].l,v=a[k].pb,g=null;if(l.id in c){var n=c[l.id],s=e[n].pb;L.np(l,e[n].l)&&L.np(v,s)&&(g=e[n]);if(!g){do l.id++;while(c[l.id])
}}g||(g={l:l,pb:a[k].pb,jc:[],qp:[],Ob:[]},c[l.id]=e.length,e.push(g));g.jc=g.jc.concat(a[k].jc);a[k].Mb&&a[k].Mb.w&&g.qp.push(a[k].Mb);if(g.Ob.length)for(l=0;l<a[k].Ob.length;l++)v=a[k].Ob[l],-1==g.Ob.indexOf(v)&&g.Ob.push(v);else g.Ob=a[k].Ob}for(k=0;k<e.length;k++){a=e[k].qp;if(0==a.length)a=L.ab(L.mj("%empty"));else if(1==a.length)a=a[0];else{c=[];for(l=0;l<a.length;l++)N.Eu(a[l])||c.push(l);if(c.length<a.length)for(l=0;l<c.length;l++)N.pp(a[c[l]]);a=N.zw(a)}m.push({l:e[k].l,pb:e[k].pb,Mb:a,Ob:e[k].Ob,
jc:e[k].jc})}e=m;for(m=0;m<e.length;m++)I(e[m].l,e[m].Mb),e[m].l.ic=e[m].Ob;a=[];for(m=0;m<e.length;m++)"STATIC"==e[m].pb.type&&(c=e[m].l,"COLOR_ID"!==c.type&&(k=L.On(L.mj("%meta")),k.d=e[m].pb,k.O=[c],a.push(k)));for(m=0;m<e.length;m++)if(c=e[m].l,k=e[m].pb.type,"DYNAMIC"==k||"STATIC"==k&&"COLOR_ID"==c.type)for(g=[],l=0;l<e[m].jc.length;l++)if(k=e[m].jc[l],-1==g.indexOf(k.name)){for(v=0;v<k.O.length;v++)if(k.O[v]==c)throw"Batch already exist in object";k.O.push(c);g.push(k.name)}if(W.wireframe_debug){for(m=
0;m<e.length;m++)c=e[m].pb,"DYNAMIC"==c.type&&(k=e[m].jc[0],-1<na.indexOf(e[m].l.type)&&(c=u(c.me,c,k.name,!0,!0),k.O.push(c)));for(m=0;m<a.length;m++)k=a[m],c=k.d,-1<na.indexOf(k.O[0].type)&&(c=u(c.hc,c,k.name,!1),k.O.push(c))}e=null;if(f.texture_slots)for(m=0;m<f.texture_slots.length;m++)if(f.texture_slots[m].texture.b4w_use_as_skydome){e=w(f.texture_slots[m],null);break}if(f.b4w_sky_settings.procedural_skydome||e)c=b("MAIN"),z(c,"special_skydome.glslv","special_skydome.glslf"),f.b4w_sky_settings.procedural_skydome?
c.Qf=!0:O(c,e,"u_sky"),f.b4w_sky_settings.reflexible&&(c.Pb=!0,f.b4w_sky_settings.reflexible_only&&(c.Jb=!0)),q(c,"a_position"),c.Pe=99999,f=T.It(),I(c,f),k=L.On(L.mj("%meta")),k.d=da.hi("DYNAMIC"),k.d.rf=!0,k.d.vb=K.nc(),k.d.hc=K.tj(),k.d.Ha=K.nc(),k.d.Xa=K.tj(),k.O=[c],a.push(k);return a};a.ix=function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";return 0==b?0:0.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b};a.Gr=k;a.St=w;a.Bj=function(a,b){r(a,"CSM_SECTION0",
0);r(a,"CSM_SECTION1",0);r(a,"CSM_SECTION2",0);r(a,"CSM_SECTION3",0);for(var c=0;c<b.length;c++)r(a,"CSM_SECTION"+String(c),1),r(a,"CSM_SECTION_DIST"+String(c),b[c]);r(a,"PCF_TEXEL_SIZE",1/ca.Ye)};a.ba=r;a.Ua=function(a,b){return U.Xt(a.Fa,b)};a.Bg=O;a.Cv=function(a,b,c){c=a.Rb.indexOf(c);-1<c&&(a.Aa[c]=b)};a.Ls=function(a,c){var d=b("MAIN");z(d,"main.glslv","main.glslf");r(d,"SHADELESS",1);F(d);d.ma=!0;M.set(c[0],c[1],c[2],0.5,d.Sa);d.wc=N.Lh;I(d,a);return d};a.Bb=F;a.Xr=function(a){return a.Ab.gh.length?
a.Ab.Pk.u_cube_fog?!0:!1:!1};a.ti=function(a,c,d){var e=b("DEPTH");z(e,"depth.glslv","depth.glslf");var f=e.Fa;U.uu(f,a.Fa);U.I(f,"SHADOW_SRC",c);U.I(f,"SHADOW_DST",d);e.da=a.da;e.Fc.set(a.Fc);e.pa=a.pa;e.Ya=a.Ya;e.id=a.id;a.Aa.length&&(e.Aa[0]=a.Aa[0],e.Rb[0]=a.Rb[0]);e.wd.set(a.wd);e.Qc=a.Qc;e.Ei=a.Ei;e.Fi=a.Fi;e.yi=a.yi;e.num_triangles=a.num_triangles;e.num_vertices=a.num_vertices;e.Of=a.Of;for(c=0;c<a.ic.length;c++)e.ic.push(a.ic[c]);e.Bc=a.Bc;a.kb||(a.kb=[]);a.kb.push(e);return e};a.ys=function(){var a=
b("DEPTH_PACK");z(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");F(a);a.da=!0;a.L=!1;var c=T.va();I(a,c);return a};a.Ds=function(){var a=b("HUD");z(a,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");F(a);a.da=!0;a.ma=!0;a.L=!1;a.o[0]=1;a.o[1]=1;var c=T.va();I(a,c);return a};a.Km=function(a){var c=b("POSTPROCESSING");z(c,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":r(c,"POST_EFFECT","POST_EFFECT_NONE");
c.o[0]=1;c.o[1]=1;break;case "GRAYSCALE":r(c,"POST_EFFECT","POST_EFFECT_GRAYSCALE");c.o[0]=1;c.o[1]=1;break;case "X_BLUR":r(c,"POST_EFFECT","POST_EFFECT_X_BLUR");c.o[0]=1;c.o[1]=0;break;case "Y_BLUR":r(c,"POST_EFFECT","POST_EFFECT_Y_BLUR");c.o[0]=0;c.o[1]=1;break;case "X_EXTEND":r(c,"POST_EFFECT","POST_EFFECT_X_EXTEND");c.o[0]=1;c.o[1]=0;break;case "Y_EXTEND":r(c,"POST_EFFECT","POST_EFFECT_Y_EXTEND");c.o[0]=0;c.o[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}F(c);c.da=!0;c.L=!1;a=T.va();
I(c,a);return c};a.Xx=function(){var a=b("EDGE");z(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");F(a);a.L=!1;a.da=!0;a.o[0]=1;a.o[1]=1;var c=T.va();I(a,c);return a};a.Ps=function(a){var c=b("SSAO");z(c,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");r(c,"SSAO_QUALITY","SSAO_QUALITY_"+a);F(c);c.L=!1;c.da=!0;c.o[0]=1;c.o[1]=1;a=T.va();I(c,a);return c};a.zs=function(){var a=b("DOF");z(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");r(a,"DEPTH_RGBA",
1);F(a);a.L=!1;a.da=!0;a.o[0]=1;a.o[1]=1;var c=T.va();I(a,c);return a};a.As=function(){var a=b("GLOW");z(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");F(a);a.L=!1;a.da=!0;a.o[0]=1;a.o[1]=1;var c=T.va();I(a,c);return a};a.Bs=function(a,c,d){var e=b("GOD_RAYS");z(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");r(e,"DEPTH_RGBA",a);r(e,"WATER_EFFECTS",c);r(e,"STEPS_PER_PASS",U.s(d,1));F(e);e.L=!1;e.da=!0;e.o[0]=1;e.o[1]=1;a=T.va();I(e,a);return e};a.Cs=function(){var a=
b("GOD_RAYS_COM");z(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");F(a);a.L=!1;a.da=!0;a.o[0]=1;a.o[1]=1;var c=T.va();I(a,c);return a};a.Ms=function(){var a=b("SKY");z(a,"procedural_skydome.glslv","procedural_skydome.glslf");r(a,"NUM_LIGHTS",1);r(a,"WATER_EFFECTS",1);F(a);a.L=!1;a.da=!0;a.o[0]=1;a.o[1]=1;var c=T.Et();I(a,c);return a};a.vs=function(a){var c=b("BLUR_DEPTH");z(c,"postprocessing/postprocessing.glslv","postprocessing/blur_depth.glslf");F(c);c.L=!1;c.da=
!0;"X"===a?(c.o[0]=1,c.o[1]=0):(c.o[0]=0,c.o[1]=1);a=T.va();I(c,a);return c};a.rs=function(){var a=b("ANTIALIASING");z(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");r(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");F(a);a.L=!1;a.da=!0;a.o[0]=1;a.o[1]=1;a.ng=1/W.resolution_factor;var c=T.va();I(a,c);return a};a.Ns=function(a){var c=b("SMAA");z(c,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");r(c,"AA_METHOD","AA_METHOD_SMAA_HIGH");r(c,"SMAA_PASS",a);r(c,"SMAA_PREDICATION",
0);r(c,"SMAA_REPROJECTION",0);F(c);c.L=!1;c.da=!0;c.o[0]=1;c.o[1]=1;c.ng=1/W.resolution_factor;a=T.va();I(c,a);return c};a.Es=function(a){var c=b("LANCZOS");z(c,"postprocessing/postprocessing.glslv","postprocessing/lanczos.glslf");F(c);c.L=!1;c.da=!0;c.ng=1/W.resolution_factor;"LANCZOS_X"==a?(c.o[0]=1,c.o[1]=0):"LANCZOS_Y"==a&&(c.o[0]=0,c.o[1]=1);a=T.va();I(c,a);return c};a.ws=function(){var a=b("COMPOSITING");z(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");F(a);a.L=
!1;a.da=!0;a.o[0]=1;a.o[1]=1;var c=T.va();I(a,c);return a};a.Hs=function(a){var c=b("MOTION_BLUR");z(c,"postprocessing/postprocessing.glslv","postprocessing/motion_blur.glslf");r(c,"BLUR_DECAY_THRESHOLD",U.s(a));F(c);c.da=!0;c.L=!1;a=T.va();I(c,a);return c};a.qs=function(){var a=b("ANAGLYPH");z(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");F(a);a.da=!0;a.L=!1;var c=T.va();I(a,c);return a};a.Yx=function(){var a=b("MAIN");z(a,"line.glslv","line.glslf");r(a,"NUM_POINTS",2);
F(a);a.L=!1;M.set(0,1,0,1,a.Sa);a.wc=N.El;a.Ju=new Float32Array([0,0,0,1,1,1]);var c=T.Jt();I(a,c);return a};a.Fs=function(){var a=b("LUMINANCE");z(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");F(a);a.L=!1;a.da=!0;a.o[0]=1;a.o[1]=1;var c=T.va();I(a,c);return a};a.ss=function(){var a=b("LUMINANCE");z(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");F(a);a.L=!1;a.da=!0;a.o[0]=1;a.o[1]=1;var c=T.va();I(a,c);return a};a.Gs=function(){var a=b("LUMINANCE_X_BLUR");
z(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");F(a);a.L=!1;a.da=!0;a.o[0]=1;a.o[1]=1;var c=T.va();I(a,c);return a};a.ts=function(a){var c=b("POSTPROCESSING");z(c,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");switch(a){case "X_BLUR":c.o[0]=1;c.o[1]=0;break;case "Y_BLUR":c.o[0]=0;c.o[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}F(c);c.da=!0;c.L=!1;a=T.va();I(c,a);return c};a.us=function(){var a=b("BLOOM");
z(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");F(a);a.L=!1;a.da=!0;a.o[0]=1;a.o[1]=1;var c=T.va();I(a,c);return a};a.Ts=function(){var a=b("VELOCITY");z(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");F(a);a.L=!1;a.da=!0;a.o[0]=1;a.o[1]=1;var c=T.va();I(a,c);return a};a.vh=function(a,b,c){var d=a.ng;a.ml[0]=b*a.o[0]*d;a.ml[1]=c*a.o[1]*d};a.ld=function(a,b){a.ng=b};a.P=function(a,b,c){a=a.O;for(var d=null,e=0;e<a.length;e++){var f=a[e];if(-1<
f.ic.indexOf(b)&&(c&&f.type==c||!c)){if(f.kb)return f;d=null===d?f:d}}return d};a.gs=function(a){for(var b=a.Aa,c=0;c<b.length;c++)D.ct(b[c].Ba);N.ym(a.Ya)}};b4w.module.__nodemat=function(a,p){function b(a,b,c){if(b in U)return U[b];for(var f=E.create(),m=a.nodes,q=a.links,r=0;r<m.length;r++)if(!t(f,m[r],0))return U[b]=null;if(c&&-1==s(a,f,"GROUP_OUTPUT","group"))return null;r=O(f);if(!F(f,q,r))return null;if(c)return f;for(r=0;r<q.length;r++){c=q[r];for(var m=l(c.from_node,f),p=l(c.to_node,f),H=0;H<m.length;H++)for(var y=0;y<p.length;y++){for(var B=m[H],x=p[y],u=E.qa(f,B),A=E.qa(f,x),z=f,J=A,A=[],P=c.from_socket.identifier,G=c.to_socket.identifier,I=
u.Ea,u=0;u<I.length;u++)if(I[u].identifier==P){A.push(u);break}J=J.A;for(u=0;u<J.length;u++)if(J[u].identifier==G){A.push(u);break}2==A.length&&E.sd(z,B,x,A)}}k(f);a=s(a,f,"OUTPUT","material");if(-1==a)return U[b]=null;e(f);f=E.ww(f,a,E.Qp);h(f);w(f);n(f);g(f);return d(f)?U[b]=f:(N.error("Material has normalmap node but no material node"),U[b]=null)}function d(a){var b=!1,c=!1;E.K(a,function(a,d){if("MATERIAL"==d.type||"MATERIAL_EXT"==d.type)c=!0;"TEXTURE_NORMAL"==d.type&&(b=!0)});return b&&!c?!1:
!0}function h(a){E.K(a,function(b,d){for(var e=d.A,f=d.Ea,g=0;g<e.length;g++)c(a,e[g],b,g,1);for(g=0;g<f.length;g++)c(a,f[g],b,g,0)})}function c(a,b,c,d,e){if(b.bd){var f=!0;E.af(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&g[1]==d)f=!1});f&&(b.bd=!1)}}function k(a){var b=[];E.K(a,function(c,d){switch(d.type){case "TRANSLUCENCY":E.af(a,function(a,e,f){a==c&&"Translucency"==d.Ea[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)E.sd(a,b[c],b[c+1],b[c+2])}function l(a,b){var c=
[];E.K(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function e(a){var b=[];E.K(a,function(a,c){"REPLACE"==c.type&&b.push(a,c);"PARALLAX"==c.type&&b.push(a,c);"REROUTE"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("REPLACE"==e.type){var g=f(a,d,0),h=f(a,d,1),m=E.Ac(a,g,d,0),l;l=g!=h?E.Ac(a,h,d,0):E.Ac(a,h,d,1);-1!=g&&E.gd(a,g,d,-1);-1!=h&&g!=h&&E.gd(a,h,d,-1);var k=e=-1;m&&1==m[1]?(e=g,k=m[0]):l&&1==l[1]&&(e=h,k=l[0]);for(var h=
[],n=E.qa(a,d),g=0;g<E.Se(a,d);g++){var m=E.Be(a,d,g),q=0;for(l=1;l<h.length;l+=3)h[l]===m&&q++;l=E.Ac(a,d,m,q)[1];-1==e?E.qa(a,m).A[l].Ja=n.A[1].Ja:E.sd(a,e,m,[k,l]);h.push(d,m,q)}for(g=0;g<h.length;g+=3)E.gd(a,h[g],h[g+1],h[g+2])}else if("PARALLAX"==e.type)h=f(a,d,1),-1!=h&&(k=E.vi(a,h,0),E.gd(a,h,d,-1),-1!=k&&E.gd(a,k,h,-1),d=E.qa(a,h),e.data=d.data,e.N[0]=d.N[0],E.Rf(a,h)),e.A.splice(1,1);else if("REROUTE"==e.type){e=E.vi(a,d,0);k=E.Se(a,d);h=[];n=[];q=[];for(g=0;g<k;g++)m=E.Be(a,d,g),l=n.indexOf(m),
-1!=l?q[l]+=1:(n.push(m),q.push(1),h.push(d,m));if(-1!=e)for(k=E.Ac(a,e,d,0)[0],g=0;g<n.length;g++)for(m=0;m<q[g];m++)l=E.Ac(a,d,n[g],m)[1],E.sd(a,e,n[g],[k,l]);for(g=0;g<h.length;g+=2)E.gd(a,h[g],h[g+1],-1)}}}function f(a,b,c){a=a.na;for(var d=0;d<a.length;d+=3)if(a[d+1]==b&&a[d+2][1]==c)return a[d];return-1}function w(a){var b=[];E.K(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type||b.push(a,
c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var l=c[h];if(m(f,l.ta)){g=[];h=E.Se(a,e);for(q=0;q<h;q++){var k=E.Be(a,e,q),n=E.Ac(a,e,k,0);g.push(e,k,n);E.sd(a,l.id,k,n)}for(var q=0;q<g.length;q+=3)E.gd(a,g[q],g[q+1],0);E.Rf(a,e);g=!1;break}}g&&(l={id:e,ta:f},c.push(l))}}function n(a){var b=[];E.K(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var l=
c[h];if(!(2<=l.Mi.length)&&m(f,l.ta)){for(var h=[],k=E.Nn(a,e),g={},n=0;n<k;n++){var q=E.vi(a,e,n);q in g||(g[q]=0);var s=E.Ac(a,q,e,g[q]++);h.push(q,e,s)}for(var k=[],g=E.Se(a,e),w={},n=0;n<g;n++)q=E.Be(a,e,n),q in w||(w[q]=0),s=E.Ac(a,e,q,w[q]++),k.push(e,q,s);for(var g=h.concat(k),n=0;n<g.length;n+=3)E.gd(a,g[n],g[n+1],0);E.Rf(a,e);n={ta:f,kt:h,lt:k};l.Mi.push(n);g=!1;break}}g&&(l={id:e,ta:f,Mi:[]},c.push(l))}for(d=0;d<c.length;d++){l=c[d];e=l.Mi.length;k=l.ta.A.length;g=l.ta.Ea.length;for(h=0;h<
e;h++){s=l.Mi[h];n=s.ta;f=s.kt;w=s.lt;l.ta.A=l.ta.A.concat(n.A);l.ta.Ea=l.ta.Ea.concat(n.Ea);for(n=0;n<l.ta.A.length;n++)l.ta.A[n].identifier+=da.lc(n/k)+1;for(n=0;n<l.ta.Ea.length;n++)l.ta.Ea[n].identifier+=da.lc(n/g)+1;for(n=0;n<f.length;n+=3)q=f[n],s=f[n+2],s[1]+=(h+1)*k,E.sd(a,q,l.id,s);for(n=0;n<w.length;n+=3)q=w[n+1],s=w[n+2],s[0]+=(h+1)*g,E.sd(a,l.id,q,s)}switch(e){case 1:l.ta.type+="2";break;case 2:l.ta.type+="3"}E.Rf(a,l.id);E.Aj(a,l.id,l.ta)}}function m(a,b){if(a.type!==b.type)return!1;
switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function g(a){var b=[];E.K(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],h=[],l=[[],[],[]],m=E.Se(a,d),k=0;k<m;k++){var n=E.Be(a,d,k);if("SEPRGB"!=E.qa(a,n).type){f=
!1;break}g.push(d,n);for(var q={},s=E.Se(a,n),f=0;f<s;f++){var w=E.Be(a,n,f);w in q||(q[w]=0);var t=E.Ac(a,n,w,q[w]++);g.push(n,w);l[t[0]].push(d,w,t)}h.push(n);f=!0}if(f){for(k=d=m=0;k<l.length;k++)l[k].length&&(m++,d|=1<<2-k);if(m){e.type+=m;e.Ea=[];for(k=0;k<l.length;k++)if(l[k].length)for(e.Ea.push({Ja:0,identifier:"RGB"[k],bd:!0,name:"RGB"[k]}),f=0;f<l[k].length;f+=3)l[k][f+2][0]=da.sh(d,k);for(k=0;k<g.length;k+=2)E.gd(a,g[k],g[k+1],0);for(k=0;k<h.length;k++)E.Rf(a,h[k]);for(k=0;k<l.length;k++)for(f=
0;f<l[k].length;f+=3)E.sd(a,l[k][f],l[k][f+1],l[k][f+2])}}}}function s(a,b,c,d){a=a.nodes;for(var e=null,f=0;f<a.length;f++){var g=a[f];g.type==c&&(e=g)}return e?l(e,b)[0]:(N.error('No "'+c+'" node in node '+d),-1)}function t(a,c,d){var e=c.name,f=c.type,g=[],h=[],l=[],m=[],k=null;switch(f){case "CAMERA":h=[];l=Q(c);break;case "COMBRGB":case "COMBHSV":h=G(c);l=Q(c);break;case "GEOMETRY":a:{for(var f=c.outputs,n=0;n<f.length;n++)if(f[n].is_linked){f=!0;break a}f=!1}if(!f)return!0;f=x(c,d);if(!f)return N.error("Geometry output is not supported"),
!1;switch(f){case "GEOMETRY_UV":if(!c.uv_layer)return N.error('Missing uv layer in node "',c.name,'"'),!1;k=y("param_GEOMETRY_UV_a");n=y("param_GEOMETRY_UV_v");g.push(u(k));g.push(u(n));l.push(r(c,"UV"));m.push(u(n));k={name:k,value:c.uv_layer};break;case "GEOMETRY_VC":if(!c.color_layer)return N.error("Missing vertex color layer in node ",c.name),!1;k=y("param_GEOMETRY_VC_a");n=y("param_GEOMETRY_VC_v");g.push(u(k));g.push(u(n));l.push(r(c,"Vertex Color"));m.push(u(n));k={name:k,value:c.color_layer};
break;case "GEOMETRY_NO":l.push(r(c,"Normal"));break;case "GEOMETRY_FB":l.push(r(c,"Front/Back"));break;case "GEOMETRY_VW":l.push(r(c,"View"));break;case "GEOMETRY_GL":l.push(r(c,"Global"))}break;case "GROUP":n=c.node_tree_name.replace(/\.[0-9]{3,}$/g,"");switch(n){case "LINEAR_TO_SRGB":f="LINEAR_TO_SRGB";break;case "NORMAL_VIEW":f="NORMAL_VIEW";break;case "REPLACE":f="REPLACE";break;case "SRGB_TO_LINEAR":f="SRGB_TO_LINEAR";break;case "REFLECT":f="REFLECT";break;case "REFRACTION":f="REFRACTION";break;
case "PARALLAX":f="PARALLAX";if(!c.inputs[1].is_linked)return N.error('Missing texture in node "',c.name,'"'),!1;var s=y("temp_texture");m.push(u(s));break;case "CLAMP":f="CLAMP";break;case "TRANSLUCENCY":f="TRANSLUCENCY";break;case "TIME":f="TIME";break;default:for(var h=da.Pc(c.node_group.node_tree),l=c.name,k=h.nodes,s=h.links,w=0;w<k.length;w++)k[w].name=z(k[w].type,l,k[w].name);for(w=0;w<s.length;w++)s[w].from_node.name=z(s[w].from_node.type,l,s[w].from_node.name),s[w].to_node.name=z(s[w].to_node.type,
l,s[w].to_node.name);k={av:b(h,c.node_group.uuid,!0),bv:h.links}}h=G(c);l=Q(c);"TRANSLUCENCY"==n&&(n=A("TranslucencyParams","TranslucencyParams",[0,0,0,0]),n.bd=l[0].bd,l.push(n));break;case "LAMP":l.push(r(c,"Color"));l.push(r(c,"Light Vector"));l.push(r(c,"Distance"));l.push(r(c,"Visibility Factor"));if(!c.lamp_index)return null;c.lamp_index.uuid in D?m.push(u(y("param_LAMP_lamp_index"),D[c.lamp_index.uuid],1)):(D[c.lamp_index.uuid]=ha,m.push(u(y("param_LAMP_lamp_index"),ha++,1)));k=D;break;case "NORMAL":h=
G(c);l=Q(c);n=r(c,"Normal");m.push(u(y("param_NORMAL_Normal"),n.Ja,3));break;case "MAPPING":h.push(q(c,"Vector"));l.push(r(c,"Vector"));if(0!=ba.length(c.translation)||0!=ba.length(c.rotation)||c.use_max||c.use_min){var f="MAPPING_HEAVY",p=c.rotation,n=T.create(),s=Math.cos(p[0]),w=Math.cos(p[1]),H=Math.cos(p[2]),J=Math.sin(p[0]),P=Math.sin(p[1]),p=Math.sin(p[2]),I=s*H,F=s*p,K=J*H,S=J*p;n[0]=w*H;n[1]=w*p;n[2]=-P;n[3]=P*K-F;n[4]=P*S+I;n[5]=w*J;n[6]=P*I+S;n[7]=P*F-K;n[8]=w*s;s=c.scale;w=new Float32Array([s[0],
0,0,0,s[1],0,0,0,s[2]]);s=T.create();T.multiply(n,w,s);n=c.translation;s=da.Qu(s,oa.create());s[12]=n[0];s[13]=n[1];s[14]=n[2];m.push(u(y("param_MAPPING_HEAVY_trs_matrix"),s,16));m.push(u(y("param_MAPPING_HEAVY_use_min"),~~c.use_min,1));m.push(u(y("param_MAPPING_HEAVY_use_max"),~~c.use_max,1));m.push(u(y("param_MAPPING_LIGHT_min_clip"),c.min,3));m.push(u(y("param_MAPPING_LIGHT_max_clip"),c.max,3))}else f="MAPPING_LIGHT",m.push(u(y("param_MAPPING_LIGHT_scale"),c.scale,3));break;case "MATERIAL":case "MATERIAL_EXT":k=
c.material;if(!k)return N.error("Emtpy material slot in node: "+c.name),!1;J=q(c,"Color");J.Ja.splice(3);h.push(J);(J=q(c,"Alpha"))?h.push(J):h.push(A("Alpha","Alpha",1));J=q(c,"Spec");J.Ja.splice(3);h.push(J);H=q(c,"Normal");H.Ja.splice(3);h.push(H);l.push(r(c,"Color"));l.push(r(c,"Alpha"));l.push(r(c,"Normal"));"MATERIAL_EXT"==f&&((J=q(c,"Emit"))?h.push(J):h.push(A("Emit","Emit",0)),J=q(c,"Translucency"),J.Ja=0,J.name="Translucency",J.identifier="Translucency",J?h.push(J):h.push(A(J.name,J.identifier,
J.Ja)),J=q(c,"Translucency"),J.Ja=[0,0,0,0],J.name="TranslucencyParams",J.identifier="TranslucencyParams",J?h.push(J):h.push(A(J.name,J.identifier,J.Ja)),(J=q(c,"Ray Mirror"))?h.push(J):h.push(A("Ray Mirror","Ray Mirror",0)),l.push(r(c,"Diffuse")),l.push(r(c,"Spec")));J=0;switch(k.specular_shader){case "COOKTORR":case "PHONG":n=k.specular_hardness;break;case "WARDISO":n=k.specular_slope;break;case "TOON":n=k.specular_toon_size,J=k.specular_toon_smooth}switch(k.diffuse_shader){case "LAMBERT":w=s=0;
break;case "OREN_NAYAR":s=k.roughness;w=0;break;case "FRESNEL":s=k.diffuse_fresnel,w=k.diffuse_fresnel_factor}m.push(u(y("param_MATERIAL_diffuse"),[c.use_diffuse?1:0,s,w],3));m.push(u(y("param_MATERIAL_spec"),[c.use_specular?1:0,k.specular_intensity,n,J],4));m.push(u(y("param_MATERIAL_norm"),H.bd?1:0,1));k={name:c.name,value:k};break;case "MATH":switch(c.operation){case "ADD":f="MATH_ADD";break;case "SUBTRACT":f="MATH_SUBTRACT";break;case "MULTIPLY":f="MATH_MULTIPLY";break;case "DIVIDE":f="MATH_DIVIDE";
break;case "SINE":f="MATH_SINE";break;case "COSINE":f="MATH_COSINE";break;case "TANGENT":f="MATH_TANGENT";break;case "ARCSINE":f="MATH_ARCSINE";break;case "ARCCOSINE":f="MATH_ARCCOSINE";break;case "ARCTANGENT":f="MATH_ARCTANGENT";break;case "POWER":f="MATH_POWER";break;case "LOGARITHM":f="MATH_LOGARITHM";break;case "MINIMUM":f="MATH_MINIMUM";break;case "MAXIMUM":f="MATH_MAXIMUM";break;case "ROUND":f="MATH_ROUND";break;case "LESS_THAN":f="MATH_LESS_THAN";break;case "GREATER_THAN":f="MATH_GREATER_THAN";
break;case "MODULO":f="MATH_MODULO";break;default:return N.error("Unsupported MATH operation: "+c.operation),!1}h=G(c);l=Q(c);break;case "MIX_RGB":switch(c.blend_type){case "MIX":f="MIX_RGB_MIX";break;case "ADD":f="MIX_RGB_ADD";break;case "MULTIPLY":f="MIX_RGB_MULTIPLY";break;case "SUBTRACT":f="MIX_RGB_SUBTRACT";break;case "SCREEN":f="MIX_RGB_SCREEN";break;case "DIVIDE":f="MIX_RGB_DIVIDE";break;case "DIFFERENCE":f="MIX_RGB_DIFFERENCE";break;case "DARKEN":f="MIX_RGB_DARKEN";break;case "LIGHTEN":f=
"MIX_RGB_LIGHTEN";break;case "OVERLAY":f="MIX_RGB_OVERLAY";break;case "DODGE":f="MIX_RGB_DODGE";break;case "BURN":f="MIX_RGB_BURN";break;case "HUE":f="MIX_RGB_HUE";break;case "SATURATION":f="MIX_RGB_SATURATION";break;case "VALUE":f="MIX_RGB_VALUE";break;case "COLOR":f="MIX_RGB_COLOR";break;case "SOFT_LIGHT":f="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":f="MIX_RGB_LINEAR_LIGHT";break;default:return N.error("Unsupported MIX_RGB blend type: "+c.blend_type),!1}h=G(c);l=Q(c);break;case "OUTPUT":h=G(c);
l=[];break;case "RGB":n=r(c,"Color");l.push(n);m.push(u(y("param_RGB_Color"),n.Ja,3));break;case "SEPRGB":case "SEPHSV":h=G(c);l=Q(c);break;case "TEXTURE":if(!c.texture)return N.error("No texture attached to node: "+c.name),!1;a:{f=c.outputs;k=!1;for(n=0;n<f.length;n++)if(s=f[n],s.is_linked)switch(s.identifier){case "Color":f="ENVIRONMENT_MAP"==c.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";break a;case "Normal":f="TEXTURE_NORMAL";break a;case "Value":k=!0;break;default:throw"Unknown texture output";
}f=k?"ENVIRONMENT_MAP"==c.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR":void 0}h.push(q(c,"Vector"));if("TEXTURE_COLOR"==f||"TEXTURE_ENVIRONMENT"==f)l.push(r(c,"Color")),l.push(r(c,"Value"));"TEXTURE_NORMAL"==f&&(l.push(r(c,"Normal")),l.push(r(c,"Value")));s=y("param_TEXTURE_texture");m.push(u(s));k={name:s,value:c.texture};break;case "VALUE":n=r(c,"Value");l.push(n);m.push(u(y("param_VALUE_Value"),n.Ja,1));break;case "VECT_MATH":switch(c.operation){case "ADD":f="VECT_MATH_ADD";break;case "SUBTRACT":f=
"VECT_MATH_SUBTRACT";break;case "AVERAGE":f="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":f="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":f="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":f="VECT_MATH_NORMALIZE";break;default:return N.error("Unsupported VECT_MATH operation: "+c.operation),!1}h=G(c);l=Q(c);break;default:h=G(c),l=Q(c)}e={name:e,type:f,Ih:g,A:h,Ea:l,N:m,data:k};E.Aj(a,E.gn(a),e);if(e="GEOMETRY"==c.type)a:{e=c.outputs;for(m=g=0;m<e.length;m++)if(e[m].is_linked&&g++>d){e=!0;break a}e=
!1}return e&&!t(a,c,++d)?!1:!0}function y(a){Z[a]||(Z[a]=0);var b=a+Z[a],b=b.replace(/ /g,"_").replace(/\//g,"_");Z[a]++;return b}function x(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";default:return null}}}function q(a,b){for(var c=
a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return I(e)}return null}function r(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return I(e)}return null}function I(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=da.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,bd:d,Ja:a}}function A(a,b,c){return{name:a,identifier:b,bd:!1,Ja:c}}function G(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=I(a.inputs[c]);d.Ja.length&&d.Ja.splice(3);b.push(d)}return b}
function Q(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=I(a.outputs[c]);b.push(d)}return b}function u(a,b,c){b=null===b||void 0===b?null:S.s(b,c);return{name:a,value:b}}function z(a,b,c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"*"+c}function O(a){var b=[];E.K(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function F(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.av,f=c[d].data.bv;if(!e)return!1;E.K(e,function(b,c){E.Aj(a,E.gn(a),c)});for(e=0;e<f.length;e++)b.push(f[e]);
P(c[d],b,a)}return!0}function K(a,b,c,d,e,f){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||f.push(c)}}function H(a,b,c){for(var d=[],e=0;e<b.length;e++){for(var f=b[e],g=null,h=0;h<c.length;h++)if(f.from_socket.identifier==c[h].to_socket.identifier){g=c[h];break}g?(f.from_node=g.from_node,f.from_socket=g.from_socket):d.push(f)}for(e=0;e<c.length;e++)a.splice(a.indexOf(c[e]),1);return d}
function J(a,b,c,d){for(var e=0;e<d.length;e++){for(var f=d[e],g,h=0;h<c.A.length;h++)if(f.from_socket.identifier==c.A[h].identifier){g=c.A[h].Ja;break}for(var h=f,m=b,k=g,n=l(h.to_node,m),q=0;q<n.length;q++)for(var s=E.qa(m,n[q]),w=0;w<s.A.length;w++)if(s.A[w].identifier==h.to_socket.identifier){s.A[w].Ja=k;break}a.splice(a.indexOf(f),1)}}function P(a,b,c){for(var d=a.name,e=[],f=[],g=[],h=[],l=0;l<b.length;l++){var m=b[l];K(m.from_node,d,m,e,g,h);K(m.to_node,d,m,f,g,h)}f=H(b,g,f);e=H(b,e,h);J(b,
c,a,f);if(e.length){var k;E.K(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(k=b)});J(b,c,k,e)}}var N=p("__print"),E=p("__graph"),S=p("__shaders"),da=p("__util"),ba=p("vec3"),T=p("mat3"),oa=p("mat4"),Z={},U={},D={},ha=0;a.js=b;a.ks=function(a){var b=[],c={};Z={};var d=E.vp(a);E.K(d,function(a,d){var e;e=[];for(var f=[],g=[],h=[],l=[],m=[],k=0;k<d.A.length;k++){var n=d.A[k];n.bd?(e.push(null),f.push(null)):(e.push(y("in_"+d.type+"_"+n.identifier)),f.push(S.s(n.Ja,0)))}for(k=0;k<
d.Ea.length;k++)n=d.Ea[k],n.bd?g.push(null):g.push(y("out_"+d.type+"_"+n.identifier));for(k=0;k<d.N.length;k++)n=d.N[k],h.push(n.name),l.push(n.value);for(k=0;k<d.Ih.length;k++)m.push(d.Ih[k].name);e={id:d.type,A:e,Pn:f,Ea:g,N:h,Go:l,Ih:m};b.push(e);c[a]=e});E.af(d,function(a,b,e){var f=E.qa(d,a);E.qa(d,b);var g=f.Ea[e[0]];a=c[a].Ea;b=c[b].A;f=a[e[0]]||y("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.cleanup=function(){for(var a in U)delete U[a];for(var b in D)delete D[b];ha=0}};b4w.module.__animation=function(a,p){function b(a,b){var c=a.H[b];c&&c.ck&&c.Kg&&(c.Kg=!1,c.ck(a))}function d(a,b,c){c=a.H[c];c.type=S;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.re=d;c.rd=b.name;for(e=d=0;e<a.data.b4w_vertex_anim.length;e++){var f=a.data.b4w_vertex_anim[e];if(f==b)break;else d+=f.frame_end-f.frame_start+1}c.Gp=d}function h(a,b,c){a=a.H[c];a.type=ba;a.rd=b.name;c=b.settings;a.start=c.frame_start;a.length=c.frame_end-a.start;b.settings.b4w_cyclic||(a.length+=c.lifetime);
a.Bc=b}function c(a){return a.replace(/_B4W_BAKED$/,"")}function k(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}return null}function l(a,b,c){if(b==oa)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function e(a,c,d){m(a,c,d);b(a,d)}function f(a,b,c){if(!K.Qg(b.fcurves))throw Error('No fcurves in action "'+b.name+'"');var d=b.frame_range,e=b.d;c=a.H[c];c.rd=b.name;c.Ul=d;c.jr=e.gv;c.ir=e.Ir;c.start=d[0];c.length=d[1]-d[0];c.re=d[0];var d=e.lo,
f=k(a),g=K.Qg(e.Kj);if(K.He(a)&&g)c.type=P,e=w(a,b),e||(e=n(a),e=s(a,b,e),a.Oh.push(b,e)),c.e=e.e,c.yb=e.yb;else if(f&&g)c.type=N,e=w(a,b),e||(e=a.d.gc,e=s(f,b,e),a.Oh.push(b,e)),c.e=e.e,c.yb=e.yb;else if(z.Je(a)&&(e.N.volume||e.N.pitch))c.volume=e.N.volume||null,c.pitch=e.N.pitch||null,c.type=da;else if(e=e.N.tsr){c.e=[];c.yb=[];for(b=0;b<d;b++)c.e.push(e.subarray(8*b,8*b+4)),c.yb.push(e.subarray(8*b+4,8*b+8));c.type=E;A.$c(a)&&A.Yw(a,c.e,c.yb)}else Q.warn('B4W Warning: Incompatible action "'+b.name+
'" has been applied to object "'+a.name+'"'),c.type=T}function w(a,b){for(var c=a.Oh,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function n(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var e=b[d].name;c[e]={Mr:d,ki:d,Rk:K.ok(a,"name",e),Hp:-1}}return c}function m(a,b,c){if((c=a.H[c])&&(c.play||0==b)){var d=a.d,e=c.re,f=c.start,h=c.length,e=e+c.speed*b*J.mb,l=c.type,m=c.speed;if(0<=m&&e>=f+h||0>m&&e<f)switch(c.Kg=!0,c.behavior){case Z:e=0<=m?(e-f)%h+f:f+h-1E-6;
break;case U:e=0<=m?f:f+h-1E-6;c.play=!1;break;case D:e=0<=m?f+h-1E-6:f,c.play=!1}c.re=e;switch(l){case P:case N:e=g(c,e,ha);b=e[0];h=e[1];e=e[2];f=c.e;c=c.yb;d.nh=c[b];d.mh=c[h];d.Bh=f[b];d.Ah=f[h];d.Lg=e;l===P&&O.D(a);break;case E:h=e=g(c,e,ha);(d=L)||(d=new Float32Array(4));var f=h[0],l=h[1],h=h[2],m=c.e,k=m[f][1],n=m[f][2],q=m[l][1],s=m[l][2];d[0]=(1-h)*m[f][0]+h*m[l][0];d[1]=(1-h)*k+h*q;d[2]=(1-h)*n+h*s;f=d;d=e;(l=M)||(l=new Float32Array(4));h=c.yb;H.slerp(h[d[0]].subarray(0,4),h[d[1]].subarray(0,
4),d[2],l);d=l;l=e[2];h=c.e;e=(1-l)*h[e[0]][3]+l*h[e[1]][3];c.ol&&(l=v,O.get_translation(a,l),K.smooth_v(f,l,b,c.ol,f));c.Tk&&(l=fa,O.get_rotation(a,l),K.bp(d,l,b,c.Tk,d));O.set_translation(a,f);O.set_rotation(a,d);O.set_scale(a,e);O.D(a);G.sync_transform(a);break;case S:(a=ha)||(a=Array(3));f=e-c.start;0>f&&(f=0);f>=c.length&&(f=c.length);b=Math.floor(f);e=b+1;f-=b;c.behavior!=Z&&e==c.length&&(e=b-=1,f=1);c=c.Gp;a[0]=b+c;a[1]=e+c;a[2]=f;e=ha;d.tl=e[0];d.Fp=e[2];break;case da:e=g(c,e,ha);b=e[0];d=
e[1];e=e[2];c.volume&&z.set_volume(a,(1-e)*c.volume[b]+e*c.volume[d]);c.pitch&&z.playrate(a,(1-e)*c.pitch[b]+e*c.pitch[d]);break;case ba:A.Wv(c.Bc,e/J.mb);break;case T:break;default:throw"Unknown animation type:"+l;}}}function g(a,b,c){c||(c=Array(3));var d=a.Ul[0],e=a.Ul[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.jr;e=Math.floor(b);a=a.ir[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function s(a,b,c){for(var d=a.pose.bones,e=[],f=[],g=b.d.lo,h=0;h<g;h++){for(var l=0;l<d.length;l++){var m=d[l],k=F.create(),
n=b.d.Kj[m.name];n&&F.copy(n.subarray(8*h,8*h+8),k);m.Sl=k;m.Qh=!1}l=t(a,c);e.push(l.e);f.push(l.yb)}return{e:e,yb:f}}function t(a,b){var c=[],d=[],e=a.pose.bones,f=new Float32Array(4),g=new Float32Array(4),h;for(h in b){var l=b[h],m=l.ki,k=e[l.Rk],l=f,n=g,q=k.ar,s=q[q.length-1],v=s.xj;s.Qh||F.identity(v);for(s=q.length-1;0<=s;s--){var k=q[s],w=k.xj;if(k.Qh)v=w;else{var t=k.Tl,r=k.Sl;F.invert(t,W);F.multiply(r,W,W);F.multiply(t,W,W);F.multiply(v,W,w);v=w;k.Qh=!0}}k=k.xj;l[0]=k[0];l[1]=k[1];l[2]=k[2];
l[3]=k[3];n[0]=k[4];n[1]=k[5];n[2]=k[6];n[3]=k[7];H.normalize(n,n);for(l=0;4>l;l++)n=4*m+l,c[n]=f[l],d[n]=g[l]}c=new Float32Array(c);d=new Float32Array(d);return{e:c,yb:d}}function y(a,b,c,d,e,f,g){var h=a+(b-a)/2,l=x(h,d,e,f,g)-c;return 0.02>Math.abs(l)?h:0<l?y(a,h,c,d,e,f,g):y(h,b,c,d,e,f,g)}function x(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function q(a,b){a.H||(a.H=[null,null,null,null,null,null,null,null]);a.H[b]={type:null,rd:null,play:!1,behavior:U,re:0,start:0,length:0,
ol:0,Tk:0,Kg:!1,Gp:null,speed:1};a.Oh=a.Oh||[];-1==ca.indexOf(a)&&ca.push(a)}function r(a,b){O.D(a);G.sync_transform(a);e(a,0,b)}var I=p("__config"),A=p("__particles"),G=p("__physics"),Q=p("__print"),u=p("__scenes"),z=p("__sfx"),O=p("__transform"),F=p("__tsr"),K=p("__util");p("mat4");var H=p("quat"),J=I.ie,P=10,N=20,E=30,S=40,da=50,ba=60,T=70;a.OBJ_ANIM_TYPE_ARMATURE=P;a.OBJ_ANIM_TYPE_SKELETAL=N;a.OBJ_ANIM_TYPE_OBJECT=E;a.OBJ_ANIM_TYPE_VERTEX=S;a.OBJ_ANIM_TYPE_SOUND=da;a.OBJ_ANIM_TYPE_PARTICLES=ba;
a.OBJ_ANIM_TYPE_STATIC=T;var oa=-1;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=oa;var Z=10,U=20,D=30;a.AB_CYCLIC=Z;a.AB_FINISH_RESET=U;a.AB_FINISH_STOP=D;var ha=Array(3),L=new Float32Array(3),v=new Float32Array(3),M=new Float32Array(4),fa=new Float32Array(4),W=new Float32Array(8);new Float32Array(16);var ca=[],ka=[];a.frame_to_sec=function(a){return a/J.mb};a.update=function(a){for(var c=0;c<ca.length;c++)for(var d=ca[c],e=0;8>e;e++)m(d,a,e);
for(c=0;c<ca.length;c++)for(d=ca[c],e=0;8>e;e++)b(d,e)};a.Ot=function(){return ka};a.mn=function(a,b){var d=a.H[b];return d&&d.rd?c(d.rd):null};a.get_anim_names=function(a){var b=[];if(K.Nb(a)&&a.d.Gh)for(var d=0;d<a.data.b4w_vertex_anim.length;d++)b.push(a.data.b4w_vertex_anim[d].name);for(d=0;d<ka.length;d++)b.push(c(ka[d].name));if(A.$c(a)&&A.Ee(a))for(d=0;d<a.particle_systems.length;d++)b.push(a.particle_systems[d].name);return b};a.vw=c;a.get_anim_type=function(a,b){var c=a.H[b];return c?c.type:
null};a.apply_def=function(a){var b=0,c=[],e=a.animation_data;if(e&&e.action){var g=K.Qg(e.action.d.Kj);"ARMATURE"!=a.type&&g||c.push(e.action)}z.Je(a)&&a.data.animation_data&&a.data.animation_data.action&&c.push(a.data.animation_data.action);for(e=0;e<c.length;e++)g=c[e],q(a,b),f(a,g,b),r(a,b),a.H[b].behavior=a.b4w_cyclic_animation?Z:U,b++;g=a.particle_systems;for(e=0;e<g.length;e++){var l=g[e],m=l.settings;"EMITTER"==m.type&&(q(a,b),h(a,l,b),r(a,b),a.H[b].behavior=a.b4w_cyclic_animation||m.b4w_cyclic?
Z:U,b++)}K.Nb(a)&&a.d.Gh?(q(a,b),d(a,a.data.b4w_vertex_anim[0],b),r(a,b),a.H[b].behavior=a.b4w_cyclic_animation?Z:U):c.length||A.Ee(a)||(q(a,0),c=a.H[0],c.type=T,e=u.$t(u.get_active()),c.start=e[0],c.length=e[1]-e[0]+1,r(a,b))};a.get_first_armature_object=k;a.play=function(a,b,c){l(a.H,c,function(a){a.play=!0;a.ck=b?b:null;a.Kg=!1})};a.stop=function(a,b){l(a.H,b,function(a){a.play=!1;a.ck=null;a.Kg=!1})};a.is_play=function(a,b){var c=a.H[b];return c?c.play:!1};a.set_current_frame_float=function(a,
b,c){l(a.H,c,function(a){a.re=b})};a.get_current_frame_float=function(a,b){var c=a.H[b];return c&&c.re?c.re:0};a.cyclic=function(a,b,c){l(a.H,c,function(a){a.behavior=b?Z:U})};a.is_cyclic=function(a,b){var c=a.H[b];return c&&c.behavior==Z};a.set_behavior=function(a,b,c){l(a.H,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.H[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){l(a.H,d,function(a){a.ol=b||0;a.Tk=c||0})};a.remove_slot_animation=function(a,b){if(b==oa)for(var c=
0;8>c;c++)a.H[c]=null;else a.H[b]=null};a.update_object_animation=e;a.sk=function(a){if("ARMATURE"==a.type||k(a))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action||A.$c(a)&&A.Ee(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length?!0:!1};a.is_animated=function(a){return a.H?!0:!1};a.Or=n;a.mm=t;a.kr=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a.subarray(8*d+4,8*d+8);H.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=
0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):(d=-1<a.indexOf("scale")?3:0,e=0);return d+e}function d(a,b,c,e){if(-1<c.search(f)){a=b;c=c.split('"')[1];var h=g}else-1<c.indexOf("location")?(c="tsr",h=g):-1<c.indexOf("rotation_quaternion")?(c="tsr",h=g):-1<c.indexOf("scale")?(c="tsr",h=g):h=0;if(!a[c]){b=a;var l=c;if("object"==typeof h&&h.length)for(var m=h.length,k=new Float32Array(e*m),n=0;n<e;n++)for(var q=0;q<m;q++)k[n*m+q]=h[q];else if("number"==typeof h)for(k=new Float32Array(e),
n=0;n<e;n++)k[n]=h;else throw"Wrong storage default value";b[l]=k}return a[c]}a.d={};var e=a.d;e.gv=1/J.ze;var f=new RegExp(/pose.bones\[\".+\"\]/g),g=F.create(),h=a.fcurves,l={},m={},k=0,n;for(n in h){var q=h[n],s;for(s in q){var v=q[s].fr;k||(k=v.length);for(var w=d(l,m,n,k),t=w.length/k,r=c(n,s|0),L=0;L<k;L++)w[L*t+r]=v[L]}}for(var p in l)"tsr"==p&&b(l[p],k);for(var M in m)b(m[M],k);e.N=l;e.Kj=m;e.Ir=a.$q;e.lo=k;ka.push(a)};a.Rt=function(a,b){return(b-a)*J.ze+1};a.Br=function(a,b,c,d,e,f){var g,
h,l=new Float32Array(2),m=new Float32Array(2),k=new Float32Array(2),n=new Float32Array(2),q=b[1],s=b[2],v=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var w=0,t=0,r=null;e<=f;e++)if(e<q)for(var L=0;L<J.ze;L++)c[w++]=s;else if(e>v)for(L=0;L<J.ze;L++)c[w++]=a;else{var p=b[t],H=3;0===p&&(H+=2);0===r&&(H+=2);var M=2===p?0:1;if(b[t+1]==b[t+H+1])r=p,t+=H;else{L=0;e==b[t+1]&&(M&&(d[w]=1),c[w]=b[t+2],w++,L++);if(e==v)for(;L<J.ze;L++)c[w++]=a;else for(l[0]=b[t+1],l[1]=b[t+2],0!==p?(m[0]=0,m[1]=
0):0===r?(m[0]=b[t+5],m[1]=b[t+6]):(m[0]=b[t+3],m[1]=b[t+4]),0!==p?(k[0]=0,k[1]=0):(k[0]=b[t+H+3],k[1]=b[t+H+4]),n[0]=b[t+H+1],n[1]=b[t+H+2];L<J.ze;L++){var u=e+L/J.ze;switch(p){case 0:g=l;h=m;var A=k,E=n,z=[],N=[],P=void 0,I=void 0,G=void 0,P=void 0;z[0]=g[0]-h[0];z[1]=g[1]-h[1];N[0]=E[0]-A[0];N[1]=E[1]-A[1];G=E[0]-g[0];P=Math.abs(z[0]);I=Math.abs(N[0]);0!=P+I&&P+I>G&&(P=G/(P+I),h[0]=g[0]-P*z[0],h[1]=g[1]-P*z[1],A[0]=E[0]-P*N[0],A[1]=E[1]-P*N[1]);M&&(d[w]=1);c[w]=x(y(0,1,u,l[0],m[0],k[0],n[0]),l[1],
m[1],k[1],n[1]);w++;break;case 1:h=l[0];A=l[1];g=E=(n[1]-A)/(n[0]-h);h=A-E*h;M&&(d[w]=1);c[w]=g*u+h;w++;break;case 2:M&&(d[w]=1);c[w]=b[t+2];w++;break;default:throw"Unknown keyframe intepolation mode: "+p;}}e+1==b[t+H+1]&&(r=p,t+=H)}}};a.my=function(a){for(var b=0;b<a.length;b++)if(a[b].Gx)return a[b];return!1};a.apply=function(a,b,c){c=c||0;if(K.Nb(a)){var e=K.keysearch("name",b,a.data.b4w_vertex_anim);if(e){q(a,c);d(a,e,c);r(a,c);return}if((e=K.keysearch("name",b,a.particle_systems))&&"EMITTER"==
e.settings.type){q(a,c);h(a,e,c);r(a,c);return}}(e=K.keysearch("name",b,ka)||K.keysearch("name",b+"_B4W_BAKED",ka))?(q(a,c),f(a,e,c),r(a,c)):Q.error("Unsupported object or animation name: ",b)};a.get_slot_num_by_anim=function(a,b){for(var d=a.H,e=0;e<d.length;e++){var f=d[e];if(f&&c(f.rd)==c(b))return e}return-1};a.jn=function(a,b){var d=a.H[b];return d&&d.rd?c(d.rd):null};a.remove=function(a){a.H=null;a=ca.indexOf(a);-1!=a&&ca.splice(a,1)};a.vv=function(a){for(var b=ka.length-1;0<=b;b--)ka[b].br==
a&&ka.splice(b,1)};a.apply_to_first_empty_slot=function(b,c){if(!a.is_animated(b))return a.apply(b,c,0),0;for(var d=0;d<b.H.length;d++)if(!b.H[d])return a.apply(b,c,d),d};a.set_speed=function(a,b,c){l(a.H,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.H[b].speed};a.cleanup=function(){ca.length=0;ka.length=0}};b4w.module.__transform=function(a,p){function b(a){var g=a.d;c.Qw(a,r);h.Pw(a);"CAMERA"==a.type&&h.fs(a);var m=g.e,q=g.scale,s=g.g;w.uh(m,q,s,g.Ic);var p=g.G;t.identity(p);t.fromQuat(s,p);"CAMERA"!=a.type&&n.Hv(p,q,p);p[12]=m[0];p[13]=m[1];p[14]=m[2];t.invert(p,g.Qn);a.H&&l.Ee(a)&&l.Rw(a);g.vb&&g.Ha&&(d.Wh(g.vb,p,g.Ha),d.Mj(g.hc,p,g.Xa),d.Lj(g.me,g.Ic,g.ne),g.Kb&&e.Yk(e.get_active()));switch(a.type){case "SPEAKER":f.lw(a,r);break;case "CAMERA":h.Ap(a);e.Y()&&f.Ku(e.get_active(),m,s,r);break;case "LAMP":k.Tw(a);
e.Y()&&e.oj(a,e.get_active());break;case "EMPTY":a.field&&e.Bp(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!e.Y()||(g=e.get_active(),e.Yk(g),e.Lv(g));a=a.qd;for(g=0;g<a.length;g++)b(a[g])}var d=p("__boundings"),h=p("__camera"),c=p("__constraints"),k=p("__lights"),l=p("__particles"),e=p("__scenes"),f=p("__sfx"),w=p("__tsr"),n=p("__util"),m=p("vec3"),g=p("quat"),s=p("mat3"),t=p("mat4"),y=new Float32Array(3),x=new Float32Array(4),q=new Float32Array(9),r=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.update=function(a){r=
a};a.set_translation=function(a,b){c.get_type(a)==c.Mc?w.Xv(b,c.Zc(a)):a.d.e.set(b)};a.get_translation=function(a,b){c.get_type(a)==c.Mc?m.copy(w.zn(c.Zc(a)),b):m.copy(a.d.e,b)};a.set_rotation=function(a,b){c.get_type(a)==c.Mc?w.Zk(b,c.Zc(a)):a.d.g.set(b)};a.get_rotation=function(a,b){c.get_type(a)==c.Mc?g.copy(w.tn(c.Zc(a)),b):g.copy(a.d.g,b)};a.set_rotation_euler=function(a,b){if(c.get_type(a)==c.Mc){var d=n.euler_to_quat(b,x);w.Zk(d,c.Zc(a))}else n.euler_to_quat(b,a.d.g)};a.set_scale=function(a,
b){c.get_type(a)==c.Mc?w.set_scale(b,c.Zc(a)):a.d.scale=b};a.get_scale=function(a){return c.get_type(a)==c.Mc?w.get_scale(c.Zc(a)):a.d.scale};a.eu=function(a,b){if(c.get_type(a)==c.Mc)w.copy(c.Zc(a),b);else{var d=a.d;w.uh(d.e,d.scale,d.g,b)}};a.Yo=function(a,b){if(c.get_type(a)==c.Mc)w.copy(b,c.Zc(a));else{var d=a.d;d.e[0]=b[0];d.e[1]=b[1];d.e[2]=b[2];d.scale=b[3];d.g[0]=b[4];d.g[1]=b[5];d.g[2]=b[6];d.g[3]=b[7]}};a.get_object_size=function(a){var b="STATIC"==a.d.type?a.Ql:a.d,c=a.data.b4w_bounding_box;
a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return 0.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(b=a.d,m.copy(b.Xa.U,c)):(b="STATIC"==a.d.type?a.Ql:a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,m.transformMat4(c,b.G,c));return c};a.move_local=function(a,b,c,d){a=a.d;y[0]=b;y[1]=c;y[2]=d;b=s.fromMat4(a.G,q);m.transformMat3(y,b,y);m.add(a.e,y,a.e)};a.D=
b;a.distance=function(a,b){return m.dist(a.d.e,b.d.e)};a.ev=function(a,b){return m.dist(a.d.e,b)};a.get_object_bounding_box=function(a){return{max_x:a.d.Ha.max_x,min_x:a.d.Ha.min_x,max_y:a.d.Ha.max_y,min_y:a.d.Ha.min_y,max_z:a.d.Ha.max_z,min_z:a.d.Ha.min_z}}};b4w.module.__tsr=function(a,p){function b(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function d(a,b,c){var d=b[0],e=b[1],h=b[2],l=b[3],k=b[4],p=b[5],q=b[6];b=b[7];var r=a[0]*l,I=a[1]*l,A=a[2]*l;a=b*r+p*A-q*I;var l=b*I+q*r-k*A,G=b*A+k*I-p*r,r=-k*r-p*I-q*A;c[0]=a*b+r*-k+l*-q-G*-p;c[1]=l*b+r*-p+G*-k-a*-q;c[2]=G*b+r*-q+a*-p-l*-k;c[0]+=d;c[1]+=e;c[2]+=h;return c}var h=p("__util"),c=p("vec3"),k=p("quat");p("mat4");var l=new Float32Array(3),e=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.qf=function(a,c,d,e){e||(e=new Float32Array(8));b(a,c,d,e);return e};a.uh=b;a.Xv=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.set_scale=function(a,b){b[3]=a};a.Yv=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.Zk=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.zn=function(a){return a.subarray(0,
3)};a.get_scale=function(a){return a[3]};a.tn=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],g=a[1],h=a[2];e[0]=a[4];e[1]=a[5];e[2]=a[6];e[3]=a[7];k.invert(e,e);var l=e[0],p=e[1],x=e[2],q=e[3],d=d*c,g=g*c,r=h*c,h=q*d+p*r-x*g,I=q*g+x*d-l*r,A=q*r+l*g-p*d,d=-l*d-p*g-x*r;b[0]=-(h*q+d*-l+I*-x-A*-p);b[1]=-(I*q+d*-p+A*-l-h*-x);b[2]=-(A*q+d*-x+h*-p-I*-l);b[3]=c;b[4]=l;b[5]=p;b[6]=x;b[7]=q;return b};a.en=function(a,c){var d=h.Me(a,l),k=h.Ji(a),g=h.matrix_to_quat(a,
e);b(d,k,g,c);return c};a.multiply=function(a,b,c){d(b,a,c);c[3]=a[3]*b[3];var e=a[4],g=a[5],h=a[6];a=a[7];var l=b[4],k=b[5],p=b[6];b=b[7];c[4]=e*b+a*l+g*p-h*k;c[5]=g*b+a*k+h*l-e*p;c[6]=h*b+a*p+e*k-g*l;c[7]=a*b-e*l-g*k-h*p;return c};a.Dh=d;a.og=function(a,b,c,d){d||(d=0);var e=a.length,h=b[0],l=b[1],k=b[2],p=b[3],q=b[4],r=b[5],I=b[6];b=b[7];for(var A=0;A<e;A+=3){var G=a[A]*p,Q=a[A+1]*p,u=a[A+2]*p,z=b*G+r*u-I*Q,O=b*Q+I*G-q*u,F=b*u+q*Q-r*G,G=-q*G-r*Q-I*u;c[d+A]=z*b+G*-q+O*-I-F*-r;c[d+A+1]=O*b+G*-r+
F*-q-z*-I;c[d+A+2]=F*b+G*-I+z*-r-O*-q;c[d+A]+=h;c[d+A+1]+=l;c[d+A+2]+=k}};a.lj=function(a,b,c,d){d||(d=0);var e=a.length,h=b[3],l=b[4],k=b[5],p=b[6];b=b[7];for(var q=0;q<e;q+=3){var r=a[q]*h,I=a[q+1]*h,A=a[q+2]*h,G=b*r+k*A-p*I,Q=b*I+p*r-l*A,u=b*A+l*I-k*r,r=-l*r-k*I-p*A;c[d+q]=G*b+r*-l+Q*-p-u*-k;c[d+q+1]=Q*b+r*-k+u*-l-G*-p;c[d+q+2]=u*b+r*-p+G*-k-Q*-l}};a.kj=function(a,b,c){var d=b[3],e=b[4],h=b[5],l=b[6];b=b[7];var k=a[0]*d,p=a[1]*d,q=a[2]*d;a=b*k+h*q-l*p;var d=b*p+l*k-e*q,r=b*q+e*p-h*k,k=-e*k-h*p-
l*q;c[0]=a*b+k*-e+d*-l-r*-h;c[1]=d*b+k*-h+r*-e-a*-l;c[2]=r*b+k*-l+a*-h-d*-e};a.wp=function(a,b,c,d){d||(d=0);var e=a.length,h=b[3],l=b[4],k=b[5],p=b[6];b=b[7];for(var q=0;q<e;q+=4){var r=a[q]*h,I=a[q+1]*h,A=a[q+2]*h,G=b*r+k*A-p*I,Q=b*I+p*r-l*A,u=b*A+l*I-k*r,r=-l*r-k*I-p*A;c[d+q]=G*b+r*-l+Q*-p-u*-k;c[d+q+1]=Q*b+r*-k+u*-l-G*-p;c[d+q+2]=u*b+r*-p+G*-k-Q*-l;c[d+q+3]=a[q+3]}};a.translate=function(a,b,c){var d=a[3],e=a[4],h=a[5],l=a[6],k=a[7],p=b[0]*d,q=b[1]*d,r=b[2]*d;b=k*p+h*r-l*q;var d=k*q+l*p-e*r,I=
k*r+e*q-h*p,p=-e*p-h*q-l*r;c[0]=a[0]+b*k+p*-e+d*-l-I*-h;c[1]=a[1]+d*k+p*-h+I*-e-b*-l;c[2]=a[2]+I*k+p*-l+b*-h-d*-e;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.Ly=function(a,b,d,e){e||(e=new Float32Array(8));c.lerp(a.subarray(0,3),b.subarray(0,3),d,e.subarray(0,3));var g=a[3];e[3]=g+d*(b[3]-g);k.slerp(a.subarray(4),b.subarray(4),d,e.subarray(4));return e};a.jy=function(a,b,c,d){d||(d=new Float32Array(8));var e=a.subarray(0,3),h=b.subarray(0,3),l=d.subarray(0,3);l[0]=h[0]*(c+1)-e[0]*
c;l[1]=h[1]*(c+1)-e[1]*c;l[2]=h[2]*(c+1)-e[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);e=d.subarray(4);e[0]=b[0]*(c+1)-a[0]*c;e[1]=b[1]*(c+1)-a[1]*c;e[2]=b[2]*(c+1)-a[2]*c;e[3]=b[3]*(c+1)-a[3]*c;k.normalize(e,e);return d};a.wu=function(a,b,c,d,e){var h=a.subarray(0,3),l=e.subarray(0,3);l[0]=h[0]+b*c[0];l[1]=h[1]+b*c[1];l[2]=h[2]+b*c[2];e[3]=a[3];a=a.subarray(4);e=e.subarray(4);c=d[0];h=d[1];d=d[2];var l=a[0],p=a[1],x=a[2],q=a[3];e[0]=0.5*(c*q+h*x-d*p);e[1]=0.5*(h*q+d*l-c*x);e[2]=0.5*
(d*q+c*p-h*l);e[3]=0.5*(-c*l-h*p-d*x);e[0]=a[0]+e[0]*b;e[1]=a[1]+e[1]*b;e[2]=a[2]+e[2]*b;e[3]=a[3]+e[3]*b;k.normalize(e,e)}};b4w.module.__util=function(a,p){function b(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function d(a,b){var c=a instanceof Array?[]:{},e;for(e in a)c[e]=!a[e]||"object"!=typeof a[e]||-1!=b.indexOf(a[e])||a[e]instanceof Float32Array?a[e]:d(a[e],b);return c}function h(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=e*f}function c(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function k(a,b){var c=b;switch(typeof a){case "number":return l(a,
c);case "string":return e(a,c);case "boolean":return l(a|0,c);case "function":case "undefined":return l(0,c);case "object":if(a){var d=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength)for(d=0;d<a.length;d++)c=l(a[d],c);else if(d)for(d=0;d<a.length;d++)c=k(a[d],c);else for(var f in a)c=k(a[f],c)}else c=l(0,c)}return c}function l(a,b){var c=b;J[0]=a;c=(c<<5)-c+P[0];c&=c;c=(c<<5)-c+P[1];return c&c}function e(a,b){for(var c=b,d=0;d<a.length;d++)c=(c<<5)-c+a.charCodeAt(d),
c&=c;return c}function f(a){return(34*a+1)*a%289}function w(a){return a-Math.floor(a)}function n(a){return m((34*a+5)*a)}function m(a){return a-289*Math.floor(a/289)}function g(a){return a-7*Math.floor(a/7)}function s(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!t(a[c],b[c]))return!1}else if(d){if(a.length!=
b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var f in a)if(!t(a[f],b[f]))return!1;for(f in b)if(!(f in a))return!1}return!0}return!(a||b)}function t(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return s(a,b);default:return!0}}var y=p("__print"),x=p("vec3"),q=p("vec4"),r=p("quat"),I=p("mat3"),A=p("mat4"),G=0,Q={},u=new Float32Array(3),z=new Float32Array(3),O=new Float32Array(4),F=new Float32Array(4),
K=new Float32Array(9),H=new Float32Array(16),J=new Float64Array(1),P=new Uint32Array(J.buffer),N=new Float32Array([0,0,0]),E=new Float32Array([0,0,0,1]),S=new Float32Array([0,0,0,1,0,0,0,1]),da=new Float32Array([1,0,0]),ba=new Float32Array([0,1,0]),T=new Float32Array([0,0,1]),oa=new Float32Array([-1,0,0]),Z=new Float32Array([0,-1,0]),U=new Float32Array([0,0,-1]),D=Math.floor(44488.07041494893);a.Zq=N;a.Uq=E;a.Dx=S;a.AXIS_X=da;a.AXIS_Y=ba;a.AXIS_Z=T;a.AXIS_MX=oa;a.AXIS_MY=Z;a.AXIS_MZ=U;a.keyfind=b;
a.wt=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Kw=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.as=function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.Cr=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.sign=function(a){return 0<a?1:0>a?-1:0};a.Vy=function(a,b,c){for(var d=c.length,
e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.Uy=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};a.ok=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.yr=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.Tx=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;
return!0};a.jz=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.hz=function(a,c){var d=b("name",c,a);1<d.length&&y.error("obj_by_name(): name resolution ambiguity");return d};a.iz=function(a,c){var d=b("name",c,a),e=d.length;1<e&&y.error("obj_by_name(): name resolution ambiguity");if(0>=e)return[];for(var f=[],g=0;g<e;g++){var h=d[g];if("EMPTY"==h.type&&h.dupli_group)for(var h=h.dupli_group.objects,l=0;l<h.length;l++)f.push(h[l])}return d=d.concat(f)};a.Hw=
function(a,b,c,d){d||(d=new Float32Array(16));A.identity(d);d[12]=a;d[13]=b;d[14]=c};var ha=1;a.qv=function(){ha=(69069*ha+5)%Math.pow(2,32);return Math.round(ha/65536)%32768/32767};a.tw=function(a){ha=a};a.$b=function(a){var b=a[0]%D*48271-3399*Math.floor(a[0]/D);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.Ci=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/
2),g=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.quat_to_euler=function(a){var b=[],c=a[0],d=a[1],e=a[2];a=a[3];var f=e*e,g=c*d+e*a;0.499999<g?(b[0]=0,b[1]=2*Math.atan2(c,a),b[2]=Math.PI/2):-0.499999>g?(b[0]=0,b[1]=-2*Math.atan2(c,a),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*a-2*d*e,1-2*c*c-2*f),b[1]=Math.atan2(2*d*a-2*c*e,1-2*d*d-2*f),b[2]=Math.asin(2*c*d+2*e*a));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));
x.transformQuat(b,a,c);return c};a.fy=function(a,b,c){c||(c=new Float32Array(4));a=x.normalize(a,u);var d=x.dot(b,a);a=x.cross(b,a,z);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.Iw=function(a,b,c,d){d||(d=new Float32Array(4));x.transformQuat(c,b,d);d[3]=-x.dot(a,d)};a.et=function(a){var b=a.d.g;switch(a.type){case "CAMERA":u[0]=0;u[1]=-1;u[2]=0;x.transformQuat(u,b,u);z[0]=0;z[1]=0;z[2]=-1;break;case "MESH":u[0]=0;u[1]=0;u[2]=
1;x.transformQuat(u,b,u);z[0]=0;z[1]=0;z[2]=1;break;case "EMPTY":u[0]=0,u[1]=1,u[2]=0,x.transformQuat(u,b,u),z[0]=0,z[1]=1,z[2]=0}u[1]=0;x.normalize(u,u);a=x.dot(u,z);return Math.acos(a)*(0<-u[0]*z[2]?-1:1)};a.Mx=function(a,b,c){if(0==c)return a;for(var d=[],e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e];return d};a.zz=function(){G++;return G.toString(16)};a.mj=function(a){Q[a]||(Q[a]=0);var b=a+Q[a];Q[a]++;return b};a.Sc=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};
a.ab=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,w:0,W:null,r:[],u:b}};a.On=function(a){return{name:a,type:"MESH",modifiers:[],particle_systems:[]}};a.Pc=function(a){return JSON.parse(JSON.stringify(a))};a.Vx=function(a,b){var c=[],e;for(e in b){var f=b[e];if(f)for(var g=0;g<f.length;g++)c.push(f[g])}return d(a,c)};a.ua=function(b){var c=b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof
Float32Array?new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.ua(b[d]):b[d];return c};a.bi=function(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?new Float32Array(a[c]):a[c]instanceof Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof Array?a[c].slice(0):a[c]:a[c];return b};a.Nb=function(a){return"MESH"===a.type?!0:!1};
a.Sn=function(a){return"MESH"===a.type&&a.d&&"DYNAMIC"===a.d.type?!0:!1};a.He=function(a){return"ARMATURE"===a.type?!0:!1};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));I.fromMat4(a,K);var c=K[0],d=K[3],e=K[6],f=K[1],g=K[4],h=K[7],l=K[2],k=K[5],m=K[8],c=Math.sqrt(c*c+d*d+e*e)||1,f=Math.sqrt(f*f+g*g+h*h)||1,l=Math.sqrt(l*l+k*k+m*m)||1;K[0]/=c;K[3]/=c;K[6]/=c;K[1]/=f;K[4]/=f;K[7]/=f;K[2]/=l;K[5]/=l;K[8]/=l;r.fromMat3(K,b);return b};a.Me=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];
b[1]=a[13];b[2]=a[14];return b};a.Ji=function(a){O[0]=0.577350269189626;O[1]=0.577350269189626;O[2]=0.577350269189626;O[3]=0;q.transformMat4(O,a,O);return q.length(O)};a.Ym=function(a,b){var c=b.left,d=b.right,e=b.top,f=b.bottom,g=b.cb,l=b.Ka;c[0]=a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-a[8];d[3]=a[15]-a[12];e[0]=a[3]-a[1];e[1]=a[7]-a[5];e[2]=a[11]-a[9];e[3]=a[15]-a[13];f[0]=a[3]+a[1];f[1]=a[7]+a[5];f[2]=a[11]+a[9];f[3]=a[15]+a[13];g[0]=a[3]+
a[2];g[1]=a[7]+a[6];g[2]=a[11]+a[10];g[3]=a[15]+a[14];l[0]=a[3]-a[2];l[1]=a[7]-a[6];l[2]=a[11]-a[10];l[3]=a[15]-a[14];h(c);h(d);h(e);h(f);h(g);h(l)};a.mw=function(a,b,d){return d<-c(a,b.left)||d<-c(a,b.right)||d<-c(a,b.top)||d<-c(a,b.bottom)||d<-c(a,b.cb)||d<-c(a,b.Ka)?!0:!1};a.mt=function(a,b,d,e,f){g=x.dot(d,b.Ka);h=x.dot(e,b.Ka);l=x.dot(f,b.Ka);g=Math.sqrt(g*g+h*h+l*l);if(g<-c(a,b.cb)||g<-c(a,b.Ka))return!0;var g=x.dot(d,b.left),h=x.dot(e,b.left),l=x.dot(f,b.left);if(Math.sqrt(g*g+h*h+l*l)<-c(a,
b.left))return!0;g=x.dot(d,b.right);h=x.dot(e,b.right);l=x.dot(f,b.right);if(Math.sqrt(g*g+h*h+l*l)<-c(a,b.right))return!0;g=x.dot(d,b.top);h=x.dot(e,b.top);l=x.dot(f,b.top);if(Math.sqrt(g*g+h*h+l*l)<-c(a,b.top))return!0;g=x.dot(d,b.bottom);h=x.dot(e,b.bottom);l=x.dot(f,b.bottom);return Math.sqrt(g*g+h*h+l*l)<-c(a,b.bottom)?!0:!1};a.ih=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],l=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*l+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*l+b[13];c[d+
f+2]=b[2]*g+b[6]*h+b[10]*l+b[14]}};a.dx=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],l=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*l;c[d+f+1]=b[1]*g+b[5]*h+b[9]*l;c[d+f+2]=b[2]*g+b[6]*h+b[10]*l}};a.Ew=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],l=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*l;c[d+f+1]=b[1]*g+b[5]*h+b[9]*l;c[d+f+2]=b[2]*g+b[6]*h+b[10]*l;c[d+f+3]=a[f+3]}};a.bx=function(a,b,c){c||(c=new Float32Array(3));O[0]=a[0];O[1]=a[1];O[2]=a[2];O[3]=0;q.transformMat4(O,
b,O);c[0]=O[0];c[1]=O[1];c[2]=O[2]};a.ny=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.cx=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.Uh=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.Uh(b,c,d,f-1):b[f]<c?a.Uh(b,
c,f+1,e):f};a.vd=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.ci=function(a,b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.Hv=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.pl=function(a,b,c,d){d||(d=new Float32Array(16));b=A.fromRotationTranslation(b,c,H);A.multiply(b,a,d)};a.Dh=function(a,b,c,d,e){e||(e=new Float32Array(3));b=A.fromRotationTranslation(c,
d,H);x.transformMat4(a,b,e);return e};a.ql=function(a,b,c,d){d||(d=new Float32Array(4));b=A.fromRotationTranslation(b,c,H);q.transformMat4(a,b,d)};a.My=function(a,b,c,d,e){e||(e=new Float32Array(3));b=A.fromRotationTranslation(c,d,H);A.invert(b,b);x.transformMat4(a,b,e);return e};a.xz=function(a,b,c){c||(c=new Float32Array(16));A.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.ez=function(b,c,d){a.Me(b,c);c[3]=a.Ji(b);a.matrix_to_quat(b,d)};a.am=function(a){for(var b=[],
c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.Uo=function(a,b,c,d){d||(d=new Float32Array(3));x.subtract(b,a,u);x.transformQuat(u,c,u);x.subtract(b,u,d)};a.Ft=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16),g=new Float32Array(16);A.lookAt(a,[-1,0,0],[0,-1,0],b);A.scale(b,[-1,1,1],b);A.scale(b,[-1,1,-1],c);A.lookAt(a,[0,0,-1],[0,-1,0],d);A.scale(d,[-1,1,1],d);A.scale(d,[-1,1,
-1],e);A.lookAt(a,[0,-1,0],[0,0,-1],g);A.scale(g,[1,1,-1],g);A.scale(g,[-1,-1,-1],f);return[f,g,b,c,d,e]};a.$h=function(a,b){return k(a,b)};a.hash_code=k;a.ru=e;a.dz=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,l,k,m,n,q,s,r,w,t;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];h=a[2];l=a[3];k=a[4];m=a[5];n=a[6];q=a[7];s=a[8];r=a[9];w=a[10];t=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=
l;c[4]=k;c[5]=m;c[6]=n;c[7]=q;c[8]=s;c[9]=r;c[10]=w;c[11]=t;c[12]=f*d+k*e+s*b+a[12];c[13]=g*d+m*e+r*b+a[13];c[14]=h*d+n*e+w*b+a[14];c[15]=l*d+q*e+t*b+a[15];return c};a.Qu=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):
(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.lc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.pv=function(a){return a*Math.PI/180};a.cy=function(a){return 180*a/Math.PI};a.dl=function(a){var b=0.366025403784439*a[0]+0.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=0.211324865405187*c+0.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var g=b>a?1:0,h=1-g,e=b+0.211324865405187-g,l=a+0.211324865405187-h,k=b+-0.577350269189626,m=a+-0.577350269189626,c=c%289,d=d%289,n=f(f(d)+c),h=
f(f(d+h)+c+g),q=f(f(d+1)+c+1),c=Math.max(0.5-(b*b+a*a),0),d=Math.max(0.5-(e*e+l*l),0),g=Math.max(0.5-(k*k+m*m),0),s=2*w(0.024390243902439*n)-1,r=2*w(0.024390243902439*h)-1,t=2*w(0.024390243902439*q)-1,n=Math.abs(s)-0.5,h=Math.abs(r)-0.5,q=Math.abs(t)-0.5,s=s-Math.floor(s+0.5),r=r-Math.floor(r+0.5),t=t-Math.floor(t+0.5),c=c*c*c*c*(1.79284291400159-0.85373472095314*(s*s+n*n)),d=d*d*d*d*(1.79284291400159-0.85373472095314*(r*r+h*h)),g=g*g*g*g*(1.79284291400159-0.85373472095314*(t*t+q*q));return 130*(c*
(s*b+n*a)+d*(r*e+h*l)+g*(t*k+q*m))};a.rm=function(a){var b=1/7,c=b/2,d=m(Math.floor(a[0])),e=m(Math.floor(a[1])),f=w(a[0]);a=w(a[1]);var h=f-0.5,l=f-1.5,f=a-0.5;a-=1.5;var k=n(d),q=n(d+1),s=k,d=q,k=n(k+e),q=n(q+e),s=n(s+e+1),d=n(d+e+1),e=h+0.7*(g(k)*b+c),r=l+0.7*(g(q)*b+c),h=h+0.7*(g(s)*b+c),l=l+0.7*(g(d)*b+c),k=f+0.7*(g(Math.floor(k*b))*b+c),f=f+0.7*(g(Math.floor(q*b))*b+c),s=a+0.7*(g(Math.floor(s*b))*b+c),b=a+0.7*(g(Math.floor(d*b))*b+c);return Math.min(e*e+k*k,r*r+f*f,h*h+s*s,l*l+b*b)};a.quat_project=
function(a,b,c,d,e){e||(e=new Float32Array(4));a=x.transformQuat(b,a,u);b=c[0];var f=c[1];c=c[2];K[0]=f*f+c*c;K[1]=-f*b;K[2]=-c*b;K[3]=-b*f;K[4]=b*b+c*c;K[5]=-c*f;K[6]=-b*c;K[7]=-f*c;K[8]=b*b+f*f;x.transformMat3(a,K,a);x.normalize(a,a);r.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=O,d=F,c=r.setAxisAngle([0,1,0],Math.PI,r.create()),d=r.setAxisAngle([1,0,0],Math.PI/2,r.create());r.multiply(c,d,c);r.multiply(a,c,b);return b};a.cleanup=function(){G=
0;Q={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.bp=function(a,b,c,d,e){e||(e=new Float32Array(a.length));r.slerp(a,b,Math.exp(-c/d),e)};a.Ny=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&
a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=I.fromQuat(a,K);z[0]=0;z[1]=1;z[2]=0;u[0]=c[3];u[1]=c[4];u[2]=c[5];var d=x.cross(z,u,u);x.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);z[0]=c[0];z[1]=c[1];z[2]=c[2];x.normalize(z,z);r.rotationTo(z,d,F);r.multiply(F,a,a)};a.kn=function(a,b,c,d){c=c*b-0.5;var e=d*b-0.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],l=a[e*
b+Math.min(c+1,g)],k=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+l*d)*(1-f)+(k*(1-d)+a*d)*f};a.We=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.So=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.sh=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.Ct=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};
a.Qg=function(a){var b=0;for(prop in a)a.hasOwnProperty(prop)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];x.normalize(c,c)};a.yz=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var l=g*a-h*e,k=h*d-f*a,m=f*e-g*d,n=g*m-h*k,h=h*l-f*m,f=f*k-g*l;c[0]=d+2*l*b+2*n;c[1]=e+2*k*b+2*h;c[2]=a+2*m*b+2*f;return c};
a.Pf=function(a){a&&y.error.apply(y,arguments);throw"panic: see above for possible error messages";};a.he=function(a){return a-2*Math.floor(a/(2*Math.PI))*Math.PI};a.pn=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.np=function(a,b){for(var c in a){var d=!0,e=a[c],f=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==f;break;case "object":d=s(e,f)}if(!d)return!1}return!0};a.nv=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c};a.Bt=function(a){a+=1;132651<
a&&y.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return[b/51,c/51,a%51/51]};a.line_plane_intersect=function(a,b,c,d,e){O.set(a);O[3]=b;F.set(d);F[3]=0;a=q.dot(O,F);if(0==a)return null;F.set(c);F[3]=1;a=-q.dot(O,F)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e}};b4w.module.__sfx=function(a,p){function b(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;m.warn("B4W warning: deprecated WebAudio implementation");return null}m.warn("B4W warning: WebAudio is not supported");return null}function d(a,b,d){var e=a.h;if("NONE"!=e.behavior){d||(d=0);var f=e.loop,h=e.pitch;if(e.src&&(f||0<=d)){e.Gj=Math.floor(5E4*Math.random());b=u.currentTime+b;e.Qb=b;e.state=y;var m=a.h;if(!m.Ib){var n=a.d.e,q=a.d.g;if(t.Ni){var s=u.createBiquadFilter();
s.type="peaking"}else s=null;var r=u.createGain();switch(m.behavior){case "POSITIONAL":var p=u.createPanner();p.panningModel=p.EQUALPOWER;p.distanceModel=p.INVERSE_DISTANCE;p.setPosition(n[0],n[1],n[2]);m.zk.set(n);var x=I;g.quat_to_dir(q,g.AXIS_MY,x);p.setOrientation(x[0],x[1],x[2]);m.direction.set(x);p.refDistance=m.dist_ref;p.maxDistance=m.dist_max;p.rolloffFactor=m.attenuation;p.coneInnerAngle=m.ls;p.coneOuterAngle=m.ms;p.coneOuterGain=m.ns;x=u.createGain();x.gain.value=w(m);s?(p.connect(s),s.connect(x)):
p.connect(x);x.connect(r);m.Ib=p;if(m.tg){var A=u.createGain();r.connect(A);A.connect(u?z.h.Ib:null)}else A=null,r.connect(u?z.h.Ib:null);break;case "BACKGROUND_SOUND":p=null;x=u.createGain();x.gain.value=w(m);s?(m.Ib=s,s.connect(x)):m.Ib=x;x.connect(r);m.tg?(A=u.createGain(),r.connect(A),A.connect(u?z.h.Ib:null)):(A=null,r.connect(u?z.h.Ib:null));break;case "BACKGROUND_MUSIC":A=p=null,x=u.createGain(),x.gain.value=w(m),s?(m.Ib=s,s.connect(x)):m.Ib=x,x.connect(r),r.connect(u?z.h.Ib:null)}m.dh=p;m.yc=
s;m.wf=x;m.ye=r;m.Oo=A}if("POSITIONAL"==e.behavior||"BACKGROUND_SOUND"==e.behavior)a=u.createBufferSource(),a.buffer=e.src,a.playbackRate.value=h,f?(e.Oa&&e.Oa.disconnect(),a.loop=!0,a.start(b),e.duration=0):(f=a.buffer?a.buffer.duration:0,d>f?(f=b+d+e.Xc,a.loop=!0,a.start(b),a.stop(f),e.duration=d):(a.loop=!1,a.start(b),e.duration=f)),a.connect(e.Ib),e.Oa=a,c(e),k(e);else if("BACKGROUND_MUSIC"==e.behavior){window.clearTimeout(e.gm);d=a.h;if(f=d.src)f.volume=1,f.loop=d.cyclic,d.Oa=d.Oa||u.createMediaElementSource(f),
d.Oa.connect(d.Ib),d.state==y&&f.play();e.duration=1E6}l(e,b)}}}function h(a){var b=a.h,c=b.duration,b=b.delay+b.bt*Math.random();d(a,b,c)}function c(a){a.tg&&a.Oo.gain.cancelScheduledValues(a.Qb);a.hh&&a.Oa.playbackRate.cancelScheduledValues(a.Qb);a.Hh=a.Qb}function k(a){if(a.tg||a.hh){var b=a.Oo,c=a.Oa,d=c.buffer?c.buffer.duration:0;if(d){var e=a.Qb;F[0]=a.Gj;for(var f=0;f<r;){var h=a.pitch+a.hh*g.$b(F);if(e>=a.Hh){if(a.tg){var l=1-g.clamp(a.tg,0,1)*Math.random();b.gain.setValueAtTime(l,e)}a.hh&&
c.playbackRate.setValueAtTime(h,e);f++}e+=d/h}a.Hh=e-0.001}}}function l(a,b){if(a.bk||a.Xc){var c=a.ye;c.gain.cancelScheduledValues(b);a.bk?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.bk)):c.gain.setValueAtTime(1,b);a.Xc&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.Xc))}}function e(a){if("SPEAKER"!=a.type)throw"Wrong object type";a=a.h;if(a.state==y||a.state==q){var b=a.ye,c=u.currentTime;a.Xc&&(b.gain.setValueAtTime(b.gain.value,
c),b.gain.linearRampToValueAtTime(0,c+a.Xc));if("BACKGROUND_MUSIC"==a.behavior){var d=a.src;d&&(a.gm=window.setTimeout(function(){d.currentTime&&(d.currentTime=0);d.pause()},1E3*a.Xc))}else b=a.Oa,a.duration<b.buffer.duration?a.Xc&&a.state==y?b.stop(c+a.Xc):a.state==y&&(b.stop(0),b.disconnect()):b.disconnect(),a.Qb=0,a.Ok=0,a.Nj=0;a.state=x}}function f(a){return!a.h||a.h.state!=y&&a.h.state!=q&&a.h.state!=x?!1:!0}function w(a){return a.muted?0:a.volume}var n=p("__config"),m=p("__print"),g=p("__util"),
s=p("vec3"),t=n.Uf,y=20,x=30,q=40,r=5;a.Cl=10;a.uj=20;a.Bl=30;var I=new Float32Array(3),A=new Float32Array(3),G=new Float32Array(3),Q=[],u=null,z=null,O=[],F=[1],K=null;a.init=function(){var a=document.createElement("audio");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&Q.push("ogg"),""!=a.canPlayType("audio/mpeg")&&Q.push("mp3"),""!=a.canPlayType("audio/mp4")&&Q.push("mp4"));(u=t.jx?b():null)&&m.log("%cINIT WEBAUDIO: "+u.sampleRate+"Hz","color: #00a")};a.cm=function(a){var b={Ke:new Float32Array(3),
bo:new Float32Array(3),Hf:new Float32Array(3)};a.h=b;if(u){var c=u.createGain(),d=u.createGain();b.wf=c;b.ye=d;c.connect(d);d.connect(u.destination);if(a.b4w_enable_dynamic_compressor){var d=u.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.Gg=d;b.Ib=d}else b.Gg=null,b.Ib=c;c=u.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;
b.muted=!1;b.volume=1;b.xe=0}};a.Ov=function(a){z=a};a.dt=function(a){a||(a="ogg");new Audio;return-1<Q.indexOf(a)?a:"ogg"==a&&-1<Q.indexOf("mp4")?"mp4":"mp3"==a&&-1<Q.indexOf("ogg")?"ogg":"mp4"==a&&-1<Q.indexOf("ogg")?"ogg":""};a.append_object=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.h={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.h.behavior=u?b.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var c=a.h,d;u?(window.MediaElementAudioSourceNode?
d=!0:(m.warn("B4W warning: MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.behavior=d;break;default:throw"Wrong speaker behavior";}b.sound||(a.h.behavior="NONE");a.h.ft=b.b4w_disable_doppler;a.h.muted=b.muted;a.h.volume=b.volume;a.h.pitch=b.pitch;a.h.attenuation=b.attenuation;a.h.dist_ref=b.distance_reference;a.h.dist_max=b.distance_max||1E4;a.h.ls=b.cone_angle_inner;a.h.ms=b.cone_angle_outer;a.h.ns=b.cone_volume_outer;a.h.cyclic=b.b4w_cyclic_play;
a.h.loop=b.b4w_loop;a.h.delay=b.b4w_delay;a.h.bt=b.b4w_delay_random;a.h.tg=b.b4w_volume_random;a.h.hh=b.b4w_pitch_random;a.h.bk=b.b4w_fade_in;a.h.Xc=b.b4w_fade_out;a.h.Qb=0;a.h.Ok=0;a.h.Nj=0;a.h.duration=0;a.h.Hh=0;a.h.Gj=1;a.h.src=null;a.h.state=10;a.h.zk=new Float32Array(3);a.h.direction=new Float32Array(3);a.h.el=new Float32Array(3);a.h.gm=null;a.h.xe=0;O.push(a)};a.cp=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.h.behavior){case "POSITIONAL":return a.uj;case "BACKGROUND_SOUND":return a.uj;
case "BACKGROUND_MUSIC":return a.Bl;case "NONE":return a.Cl;default:throw"Wrong speaker behavior";}};a.Xw=function(a,b){if("SPEAKER"!=a.type)throw"Wrong object type";var c=a.h;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.Zs=function(a,b,c){u?u.decodeAudioData(a,b,c):c()};a.kw=function(a){e(a);delete a.h;O.splice(O.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<O.length;a++){var b=
O[a].h;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.Oa&&b.Oa.disconnect()}z&&z.h&&(a=z.h,a.Ke[0]=0,a.Ke[1]=0,a.Ke[2]=0,a.Hf[0]=0,a.Hf[1]=0,a.Hf[2]=0);z=null;O.splice(0);K=null};a.update=function(a){if(u&&0!=O.length){for(var b=0;b<O.length;b++){var c=O[b],d=c.h,f=u.currentTime;!d.loop&&d.cyclic&&d.state==y&&d.duration&&u&&d.Qb+d.duration<f&&h(c);d.state==y&&3>d.Hh-f&&k(d)}K&&(-1==K.sa||a>K.Vl+K.Um[K.sa])&&(b=K,-1<b.sa&&e(b.Rd[b.sa]),-1==b.sa&&b.random?c=Math.round(Math.random()*(b.Rd.length-
1)):b.random?(c=1+Math.round(Math.random()*(b.Rd.length-2)),c=(b.sa+c)%b.Rd.length):c=(b.sa+1)%b.Rd.length,h(b.Rd[c]),b.sa=c,b.Vl=a)}};a.play=d;a.play_def=h;a.stop=e;a.is_play=function(a){return a.h.state==y};a.playrate=function(a,b){var d=a.h;d.pitch=b;!f(a)||"POSITIONAL"!=d.behavior&&"BACKGROUND_SOUND"!=d.behavior||(d.Oa.playbackRate.value=b,c(d),k(d))};a.Cy=function(a){return a.h.pitch};a.cyclic=function(a,b){a.h.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.h.cyclic};a.Ku=function(a,b,c,
d){if(u&&a.h){var e=I;e[0]=0;e[1]=-1;e[2]=0;s.transformQuat(e,c,e);A[0]=0;A[1]=0;A[2]=-1;s.transformQuat(A,c,A);c=u.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],A[0],A[1],A[2]);a.h.bo.set(e);d&&(G[0]=(b[0]-a.h.Ke[0])/d,G[1]=(b[1]-a.h.Ke[1])/d,G[2]=(b[2]-a.h.Ke[2])/d,g.smooth_v(G,a.h.Hf,d,0.3,G),c.setVelocity(G[0],G[1],G[2]),a.h.Hf.set(G));a.h.Ke.set(b)}};a.listener_reset_speed=function(a,b){if(u&&z.h){var c=I;b?c.set(b):c.set(z.h.bo);s.scale(c,a,c);u.listener.setVelocity(c[0],
c[1],c[2]);z.h.Hf.set(c)}};a.lw=function(a,b){var c=a.h;if(f(a)&&"POSITIONAL"==c.behavior){var d=a.d.e,e=c.dh;e.setPosition(d[0],d[1],d[2]);var h=I;g.quat_to_dir(a.d.g,g.AXIS_MY,h);e.setOrientation(h[0],h[1],h[2]);h=c.zk;!c.ft&&b&&(A[0]=(d[0]-h[0])/b,A[1]=(d[1]-h[1])/b,A[2]=(d[2]-h[2])/b,g.smooth_v(A,c.el,b,0.3,A),e.setVelocity(A[0],A[1],A[2]),c.el.set(A));h.set(d)}};a.speaker_reset_speed=function(a,b,c){var d=a.h;if(f(a)&&"POSITIONAL"==d.behavior){var e=I;c?e.set(c):e.set(d.direction);s.scale(e,
b,e);d.dh.setVelocity(e[0],e[1],e[2]);d.el.set(e);d.zk.set(a.d.e)}};a.Je=function(a){return a.h?!0:!1};a.yn=function(a){return a.h.behavior};a.Uv=function(a){var b=z.h;b&&(b.volume=a,u&&(b.wf.gain.value=w(b)))};a.Zt=function(){var a=z.h;return a?a.volume:0};a.set_volume=function(a,b){var c=a.h;c.volume=b;f(a)&&(c.wf.gain.value=w(c))};a.get_volume=function(a){return a.h.volume};a.mute=function(a,b){a.h.muted=Boolean(b);f(a)&&(a.h.wf.gain.value=w(a.h))};a.is_muted=function(a){return a.h.muted};a.Zu=
function(a){var b=z.h;b&&(b.muted=Boolean(a),u&&(b.wf.gain.value=w(b)))};a.Fu=function(){var a=z.h;return a?a.muted:!1};a.get_speaker_objects=function(){return O};a.pause=function(){for(var a=0;a<O.length;a++){var b=O[a].h;if(b.state==y){if("BACKGROUND_MUSIC"==b.behavior){var d=b.src;d&&d.pause()}else{var e=u.currentTime;b.Ok=e;var d=b,f;if(e>b.Qb){f=b;F[0]=f.Gj;for(var h=f.Oa.buffer.duration,l=f.Qb,k=void 0;l<e;)k=f.pitch+f.hh*g.$b(F),l+=h/k;f=(h/k-(l-e))*k}else f=0;d.Nj=f;b.Oa.stop(0);b.Oa.disconnect();
c(b)}b.state=q}}};a.resume=function(){for(var a=0;a<O.length;a++){var b=O[a],c=b.h;if(c.state==q){if("BACKGROUND_MUSIC"==c.behavior)c.src.play();else{var b=b.h,d=u.createBufferSource();d.loop=b.Oa.loop;d.buffer=b.Oa.buffer;d.playbackRate.value=b.Oa.playbackRate.value;b.dh?d.connect(b.dh):d.connect(b.wf);b.Oa=d;b=u.currentTime;c.Qb+=b-c.Ok;c.Hh=b;c.Oa.start(c.Qb,c.Nj);k(c);l(c,c.Qb)}c.state=y}}};a.set_compressor_params=function(a,b){if(a.h&&a.h.Gg){var c=a.h.Gg;c.threshold.value=b.threshold;c.knee.value=
b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a.h||!a.h.Gg)return null;a=a.h.Gg;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.duck=function(a,b,c){if(f(a)){a=a.h;var d=a.ye,e=u.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.xe=c}};a.unduck=function(a){if(f(a)){a=a.h;var b=a.ye,c=u.currentTime;b.gain.setValueAtTime(b.gain.value,
c);b.gain.linearRampToValueAtTime(1,c+a.xe);a.xe=0}};a.ht=function(a,b){if(u){var c=z.h,d=c.ye,e=u.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.xe=b}};a.Lw=function(){if(u){var a=z.h,b=a.ye,c=u.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.xe);a.xe=0}};a.apply_playlist=function(a,b,c){K={sa:-1,Vl:0,random:c,Rd:[],Um:[]};for(c=0;c<a.length;c++){var d=a[c];e(d);K.Rd.push(d);d=d.h;d=(d=d.src)?d.duration:0;K.Um.push(d+
b)}};a.clear_playlist=function(){if(K)for(var a=K.Rd,b=0;b<a.length;b++)e(a[b]);K=null};a.get_positional_params=function(a){return(a=a.h)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.h;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.dh;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=
function(a,b){var c=a.h;c&&c.yc&&(c.yc.frequency.value=b.freq,c.yc.Q.value=b.Q,c.yc.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.h)&&a.yc?{freq:a.yc.frequency.value,Q:a.yc.Q.value,gain:a.yc.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.h;if(!a||!a.yc)return null;a.yc.getFrequencyResponse(b,c,d)}};b4w.module.vec3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,b=Math.random;a.create=function(){var a=new p(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var b=new p(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.fromValues=function(a,b,c){var k=new p(3);k[0]=a;k[1]=b;k[2]=c;return k};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set=function(a,b,c,k){k[0]=a;k[1]=b;k[2]=c;return k};a.add=function(a,b,c){c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c};
a.subtract=function(a,b,c){c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c};a.sub=a.subtract;a.multiply=function(a,b,c){c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c};a.mul=a.multiply;a.divide=function(a,b,c){c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];return c};a.div=a.divide;a.min=function(a,b,c){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);return c};a.max=function(a,b,c){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],b[2]);return c};
a.scale=function(a,b,c){c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c};a.scaleAndAdd=function(a,b,c,k){k[0]=a[0]+b[0]*c;k[1]=a[1]+b[1]*c;k[2]=a[2]+b[2]*c;return k};a.distance=function(a,b){var c=b[0]-a[0],k=b[1]-a[1],l=b[2]-a[2];return Math.sqrt(c*c+k*k+l*l)};a.dist=a.distance;a.squaredDistance=function(a,b){var c=b[0]-a[0],k=b[1]-a[1],l=b[2]-a[2];return c*c+k*k+l*l};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)};a.len=a.length;a.squaredLength=
function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];return b};a.normalize=function(a,b){var c=a[0],k=a[1],l=a[2],c=c*c+k*k+l*l;0<c&&(c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};a.cross=function(a,b,c){var k=a[0],l=a[1];a=a[2];var e=b[0],f=b[1];b=b[2];c[0]=l*b-a*f;c[1]=
a*e-k*b;c[2]=k*f-l*e;return c};a.lerp=function(a,b,c,k){var l=a[0],e=a[1];a=a[2];k[0]=l+c*(b[0]-l);k[1]=e+c*(b[1]-e);k[2]=a+c*(b[2]-a);return k};a.random=function(a,h){a=a||1;var c=2*b()*Math.PI,k=2*b()-1,l=Math.sqrt(1-k*k)*a;h[0]=Math.cos(c)*l;h[1]=Math.sin(c)*l;h[2]=k*a;return h};a.transformMat4=function(a,b,c){var k=a[0],l=a[1];a=a[2];var e=b[3]*k+b[7]*l+b[11]*a+b[15],e=e||1;c[0]=(b[0]*k+b[4]*l+b[8]*a+b[12])/e;c[1]=(b[1]*k+b[5]*l+b[9]*a+b[13])/e;c[2]=(b[2]*k+b[6]*l+b[10]*a+b[14])/e;return c};a.transformMat3=
function(a,b,c){var k=a[0],l=a[1];a=a[2];c[0]=k*b[0]+l*b[3]+a*b[6];c[1]=k*b[1]+l*b[4]+a*b[7];c[2]=k*b[2]+l*b[5]+a*b[8];return c};a.transformQuat=function(a,b,c){var k=a[0],l=a[1],e=a[2];a=b[0];var f=b[1],w=b[2];b=b[3];var n=b*k+f*e-w*l,m=b*l+w*k-a*e,g=b*e+a*l-f*k,k=-a*k-f*l-w*e;c[0]=n*b+k*-a+m*-w-g*-f;c[1]=m*b+k*-f+g*-a-n*-w;c[2]=g*b+k*-w+n*-f-m*-a;return c};a.rotateX=function(a,b,c,k){var l=[],e=[];l[0]=a[0]-b[0];l[1]=a[1]-b[1];l[2]=a[2]-b[2];e[0]=l[0];e[1]=l[1]*Math.cos(c)-l[2]*Math.sin(c);e[2]=
l[1]*Math.sin(c)+l[2]*Math.cos(c);k[0]=e[0]+b[0];k[1]=e[1]+b[1];k[2]=e[2]+b[2];return k};a.rotateY=function(a,b,c,k){var l=[],e=[];l[0]=a[0]-b[0];l[1]=a[1]-b[1];l[2]=a[2]-b[2];e[0]=l[2]*Math.sin(c)+l[0]*Math.cos(c);e[1]=l[1];e[2]=l[2]*Math.cos(c)-l[0]*Math.sin(c);k[0]=e[0]+b[0];k[1]=e[1]+b[1];k[2]=e[2]+b[2];return k};a.rotateZ=function(a,b,c,k){var l=[],e=[];l[0]=a[0]-b[0];l[1]=a[1]-b[1];l[2]=a[2]-b[2];e[0]=l[0]*Math.cos(c)-l[1]*Math.sin(c);e[1]=l[0]*Math.sin(c)+l[1]*Math.cos(c);e[2]=l[2];k[0]=e[0]+
b[0];k[1]=e[1]+b[1];k[2]=e[2]+b[2];return k};a.forEach=function(){var b=a.create();return function(a,c,k,l,e,f){c||(c=3);k||(k=0);for(l=l?Math.min(l*c+k,a.length):a.length;k<l;k+=c)b[0]=a[k],b[1]=a[k+1],b[2]=a[k+2],e(b,f,b),a[k]=b[0],a[k+1]=b[1],a[k+2]=b[2];return a}}();a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==typeof a&&(a.Bz=a)};
b4w.module.vec4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array,b=Math.random;a.create=function(){var a=new p(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var b=new p(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=function(a,b,c,k){var l=new p(4);l[0]=a;l[1]=b;l[2]=c;l[3]=k;return l};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set=function(a,b,c,k,l){l[0]=a;l[1]=b;l[2]=c;l[3]=k;return l};a.add=function(a,b,c){c[0]=
a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c};a.subtract=function(a,b,c){c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c};a.sub=a.subtract;a.multiply=function(a,b,c){c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];c[3]=a[3]*b[3];return c};a.mul=a.multiply;a.divide=function(a,b,c){c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c};a.div=a.divide;a.min=function(a,b,c){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);c[3]=
Math.min(a[3],b[3]);return c};a.max=function(a,b,c){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],b[2]);c[3]=Math.max(a[3],b[3]);return c};a.scale=function(a,b,c){c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};a.scaleAndAdd=function(a,b,c,k){k[0]=a[0]+b[0]*c;k[1]=a[1]+b[1]*c;k[2]=a[2]+b[2]*c;k[3]=a[3]+b[3]*c;return k};a.distance=function(a,b){var c=b[0]-a[0],k=b[1]-a[1],l=b[2]-a[2],e=b[3]-a[3];return Math.sqrt(c*c+k*k+l*l+e*e)};a.dist=a.distance;a.squaredDistance=
function(a,b){var c=b[0]-a[0],k=b[1]-a[1],l=b[2]-a[2],e=b[3]-a[3];return c*c+k*k+l*l+e*e};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],c=a[1],k=a[2];a=a[3];return Math.sqrt(b*b+c*c+k*k+a*a)};a.len=a.length;a.squaredLength=function(a){var b=a[0],c=a[1],k=a[2];a=a[3];return b*b+c*c+k*k+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};a.inverse=function(a,b){b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];b[3]=1/a[3];return b};a.normalize=
function(a,b){var c=a[0],k=a[1],l=a[2],e=a[3],c=c*c+k*k+l*l+e*e;0<c&&(c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c,b[3]=a[3]*c);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};a.lerp=function(a,b,c,k){var l=a[0],e=a[1],f=a[2];a=a[3];k[0]=l+c*(b[0]-l);k[1]=e+c*(b[1]-e);k[2]=f+c*(b[2]-f);k[3]=a+c*(b[3]-a);return k};a.random=function(d,h){d=d||1;h[0]=b();h[1]=b();h[2]=b();h[3]=b();a.normalize(h,h);a.scale(h,d,h);return h};a.transformMat4=function(a,b,c){var k=a[0],
l=a[1],e=a[2];a=a[3];c[0]=b[0]*k+b[4]*l+b[8]*e+b[12]*a;c[1]=b[1]*k+b[5]*l+b[9]*e+b[13]*a;c[2]=b[2]*k+b[6]*l+b[10]*e+b[14]*a;c[3]=b[3]*k+b[7]*l+b[11]*e+b[15]*a;return c};a.transformQuat=function(a,b,c){var k=a[0],l=a[1],e=a[2];a=b[0];var f=b[1],w=b[2];b=b[3];var n=b*k+f*e-w*l,m=b*l+w*k-a*e,g=b*e+a*l-f*k,k=-a*k-f*l-w*e;c[0]=n*b+k*-a+m*-w-g*-f;c[1]=m*b+k*-f+g*-a-n*-w;c[2]=g*b+k*-w+n*-f-m*-a;return c};a.forEach=function(){var b=a.create();return function(a,c,k,l,e,f){c||(c=4);k||(k=0);for(l=l?Math.min(l*
c+k,a.length):a.length;k<l;k+=c)b[0]=a[k],b[1]=a[k+1],b[2]=a[k+2],b[3]=a[k+3],e(b,f,b),a[k]=b[0],a[k+1]=b[1],a[k+2]=b[2],a[k+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.Cz=a)};
b4w.module.quat=function(a,p){var b=p("vec3"),d=p("vec4"),h=p("mat3"),c="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new c(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var c=b.create(),d=b.fromValues(1,0,0),e=b.fromValues(0,1,0);return function(f,h,n){var m=b.dot(f,h);if(-0.9999999>m)return b.cross(d,f,c),1E-6>b.length(c)&&b.cross(e,f,c),b.normalize(c,c),a.setAxisAngle(c,Math.PI,n),n;if(0.9999999<m)return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n;b.cross(f,
h,c);n[0]=c[0];n[1]=c[1];n[2]=c[2];n[3]=1+m;return a.normalize(n,n)}}();a.setAxes=function(){var b=h.create();return function(c,d,f,h){b[0]=d[0];b[3]=d[1];b[6]=d[2];b[1]=f[0];b[4]=f[1];b[7]=f[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,h),h)}}();a.clone=d.clone;a.fromValues=d.fromValues;a.copy=d.copy;a.set=d.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=0.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=d.add;a.multiply=function(a,b,c){var d=a[0],h=a[1],n=a[2];a=a[3];var m=b[0],g=b[1],s=b[2];b=b[3];c[0]=d*b+a*m+h*s-n*g;c[1]=h*b+a*g+n*m-d*s;c[2]=n*b+a*s+d*g-h*m;c[3]=a*b-d*m-h*g-n*s;return c};a.mul=a.multiply;a.scale=d.scale;a.rotateX=function(a,b,c){b*=0.5;var d=a[0],h=a[1],n=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*m;c[1]=h*b+n*m;c[2]=n*b-h*m;c[3]=a*b-d*m;return c};a.rotateY=function(a,b,c){b*=0.5;var d=a[0],h=a[1],n=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=
d*b-n*m;c[1]=h*b+a*m;c[2]=n*b+d*m;c[3]=a*b-h*m;return c};a.rotateZ=function(a,b,c){b*=0.5;var d=a[0],h=a[1],n=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);c[0]=d*b+h*m;c[1]=h*b-d*m;c[2]=n*b+a*m;c[3]=a*b-n*m;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],h=a[2];b[0]=c;b[1]=d;b[2]=h;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-h*h));return b};a.dot=d.dot;a.lerp=d.lerp;a.slerp=function(a,b,c,d){var h=a[0],n=a[1],m=a[2];a=a[3];var g=b[0],s=b[1],t=b[2];b=b[3];var p,x,q;x=h*g+n*s+m*t+a*b;0>x&&(x=-x,g=-g,s=
-s,t=-t,b=-b);1E-6<1-x?(p=Math.acos(x),q=Math.sin(p),x=Math.sin((1-c)*p)/q,c=Math.sin(c*p)/q):x=1-c;d[0]=x*h+c*g;d[1]=x*n+c*s;d[2]=x*m+c*t;d[3]=x*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],h=a[2],n=a[3],m=c*c+d*d+h*h+n*n,m=m?1/m:0;b[0]=-c*m;b[1]=-d*m;b[2]=-h*m;b[3]=n*m;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=d.length;a.len=a.length;a.squaredLength=d.squaredLength;a.sqrLen=a.squaredLength;a.normalize=d.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=0.5*c,c=0.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var h=(d+1)%3,n=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*h+h]-a[3*n+n]+1);b[d]=0.5*c;c=0.5/c;b[3]=(a[3*h+n]-a[3*n+h])*c;b[h]=(a[3*h+d]+a[3*d+h])*c;b[n]=(a[3*n+d]+a[3*d+n])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.g=a)};
b4w.module.mat3=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[4];d[4]=a[5];d[5]=a[6];d[6]=a[8];d[7]=a[9];d[8]=a[10];return d};a.clone=function(a){var d=new p(9);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];return d};a.copy=function(a,d){d[0]=a[0];d[1]=a[1];d[2]=
a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];return d};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,d){if(d===a){var h=a[1],c=a[2],k=a[5];d[1]=a[3];d[2]=a[6];d[3]=h;d[5]=a[7];d[6]=c;d[7]=k}else d[0]=a[0],d[1]=a[3],d[2]=a[6],d[3]=a[1],d[4]=a[4],d[5]=a[7],d[6]=a[2],d[7]=a[5],d[8]=a[8];return d};a.invert=function(a,d){var h=a[0],c=a[1],k=a[2],l=a[3],e=a[4],f=a[5],p=a[6],n=a[7],m=a[8],g=m*e-f*n,s=-m*l+f*p,t=
n*l-e*p,y=h*g+c*s+k*t;if(!y)return null;y=1/y;d[0]=g*y;d[1]=(-m*c+k*n)*y;d[2]=(f*c-k*e)*y;d[3]=s*y;d[4]=(m*h-k*p)*y;d[5]=(-f*h+k*l)*y;d[6]=t*y;d[7]=(-n*h+c*p)*y;d[8]=(e*h-c*l)*y;return d};a.adjoint=function(a,d){var h=a[0],c=a[1],k=a[2],l=a[3],e=a[4],f=a[5],p=a[6],n=a[7],m=a[8];d[0]=e*m-f*n;d[1]=k*n-c*m;d[2]=c*f-k*e;d[3]=f*p-l*m;d[4]=h*m-k*p;d[5]=k*l-h*f;d[6]=l*n-e*p;d[7]=c*p-h*n;d[8]=h*e-c*l;return d};a.determinant=function(a){var d=a[3],h=a[4],c=a[5],k=a[6],l=a[7],e=a[8];return a[0]*(e*h-c*l)+a[1]*
(-e*d+c*k)+a[2]*(l*d-h*k)};a.multiply=function(a,d,h){var c=a[0],k=a[1],l=a[2],e=a[3],f=a[4],p=a[5],n=a[6],m=a[7];a=a[8];var g=d[0],s=d[1],t=d[2],y=d[3],x=d[4],q=d[5],r=d[6],I=d[7];d=d[8];h[0]=g*c+s*e+t*n;h[1]=g*k+s*f+t*m;h[2]=g*l+s*p+t*a;h[3]=y*c+x*e+q*n;h[4]=y*k+x*f+q*m;h[5]=y*l+x*p+q*a;h[6]=r*c+I*e+d*n;h[7]=r*k+I*f+d*m;h[8]=r*l+I*p+d*a;return h};a.mul=a.multiply;a.translate=function(a,d,h){var c=a[0],k=a[1],l=a[2],e=a[3],f=a[4],p=a[5],n=a[6],m=a[7];a=a[8];var g=d[0];d=d[1];h[0]=c;h[1]=k;h[2]=l;
h[3]=e;h[4]=f;h[5]=p;h[6]=g*c+d*e+n;h[7]=g*k+d*f+m;h[8]=g*l+d*p+a;return h};a.rotate=function(a,d,h){var c=a[0],k=a[1],l=a[2],e=a[3],f=a[4],p=a[5],n=a[6],m=a[7];a=a[8];var g=Math.sin(d);d=Math.cos(d);h[0]=d*c+g*e;h[1]=d*k+g*f;h[2]=d*l+g*p;h[3]=d*e-g*c;h[4]=d*f-g*k;h[5]=d*p-g*l;h[6]=n;h[7]=m;h[8]=a;return h};a.scale=function(a,d,h){var c=d[0];d=d[1];h[0]=c*a[0];h[1]=c*a[1];h[2]=c*a[2];h[3]=d*a[3];h[4]=d*a[4];h[5]=d*a[5];h[6]=a[6];h[7]=a[7];h[8]=a[8];return h};a.fromMat2d=function(a,d){d[0]=a[0];d[1]=
a[1];d[2]=0;d[3]=a[2];d[4]=a[3];d[5]=0;d[6]=a[4];d[7]=a[5];d[8]=1;return d};a.fromQuat=function(a,d){var h=a[0],c=a[1],k=a[2],l=a[3],e=h+h,f=c+c,p=k+k,h=h*e,n=c*e,c=c*f,m=k*e,g=k*f,k=k*p,e=l*e,f=l*f,l=l*p;d[0]=1-c-k;d[3]=n-l;d[6]=m+f;d[1]=n+l;d[4]=1-h-k;d[7]=g-e;d[2]=m-f;d[5]=g+e;d[8]=1-h-c;return d};a.normalFromMat4=function(a,d){var h=a[0],c=a[1],k=a[2],l=a[3],e=a[4],f=a[5],p=a[6],n=a[7],m=a[8],g=a[9],s=a[10],t=a[11],y=a[12],x=a[13],q=a[14],r=a[15],I=h*f-c*e,A=h*p-k*e,G=h*n-l*e,Q=c*p-k*f,u=c*n-
l*f,z=k*n-l*p,O=m*x-g*y,F=m*q-s*y,m=m*r-t*y,K=g*q-s*x,g=g*r-t*x,s=s*r-t*q,t=I*s-A*g+G*K+Q*m-u*F+z*O;if(!t)return null;t=1/t;d[0]=(f*s-p*g+n*K)*t;d[1]=(p*m-e*s-n*F)*t;d[2]=(e*g-f*m+n*O)*t;d[3]=(k*g-c*s-l*K)*t;d[4]=(h*s-k*m+l*F)*t;d[5]=(c*m-h*g-l*O)*t;d[6]=(x*z-q*u+r*Q)*t;d[7]=(q*G-y*z-r*A)*t;d[8]=(y*u-x*G+r*I)*t;return d};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.zt=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],
2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.bz=a)};
b4w.module.mat4=function(a){var p="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new p(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var d=new p(16);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];d[9]=a[9];d[10]=a[10];d[11]=a[11];d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};a.copy=function(a,d){d[0]=a[0];d[1]=
a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];d[9]=a[9];d[10]=a[10];d[11]=a[11];d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,d){if(d===a){var h=a[1],c=a[2],k=a[3],l=a[6],e=a[7],f=a[11];d[1]=a[4];d[2]=a[8];d[3]=a[12];d[4]=h;d[6]=a[9];d[7]=a[13];d[8]=c;d[9]=l;d[11]=a[14];d[12]=k;d[13]=e;
d[14]=f}else d[0]=a[0],d[1]=a[4],d[2]=a[8],d[3]=a[12],d[4]=a[1],d[5]=a[5],d[6]=a[9],d[7]=a[13],d[8]=a[2],d[9]=a[6],d[10]=a[10],d[11]=a[14],d[12]=a[3],d[13]=a[7],d[14]=a[11],d[15]=a[15];return d};a.invert=function(a,d){var h=a[0],c=a[1],k=a[2],l=a[3],e=a[4],f=a[5],p=a[6],n=a[7],m=a[8],g=a[9],s=a[10],t=a[11],y=a[12],x=a[13],q=a[14],r=a[15],I=h*f-c*e,A=h*p-k*e,G=h*n-l*e,Q=c*p-k*f,u=c*n-l*f,z=k*n-l*p,O=m*x-g*y,F=m*q-s*y,K=m*r-t*y,H=g*q-s*x,J=g*r-t*x,P=s*r-t*q,N=I*P-A*J+G*H+Q*K-u*F+z*O;if(!N)return null;
N=1/N;d[0]=(f*P-p*J+n*H)*N;d[1]=(k*J-c*P-l*H)*N;d[2]=(x*z-q*u+r*Q)*N;d[3]=(s*u-g*z-t*Q)*N;d[4]=(p*K-e*P-n*F)*N;d[5]=(h*P-k*K+l*F)*N;d[6]=(q*G-y*z-r*A)*N;d[7]=(m*z-s*G+t*A)*N;d[8]=(e*J-f*K+n*O)*N;d[9]=(c*K-h*J-l*O)*N;d[10]=(y*u-x*G+r*I)*N;d[11]=(g*G-m*u-t*I)*N;d[12]=(f*F-e*H-p*O)*N;d[13]=(h*H-c*F+k*O)*N;d[14]=(x*A-y*Q-q*I)*N;d[15]=(m*Q-g*A+s*I)*N;return d};a.adjoint=function(a,d){var h=a[0],c=a[1],k=a[2],l=a[3],e=a[4],f=a[5],p=a[6],n=a[7],m=a[8],g=a[9],s=a[10],t=a[11],y=a[12],x=a[13],q=a[14],r=a[15];
d[0]=f*(s*r-t*q)-g*(p*r-n*q)+x*(p*t-n*s);d[1]=-(c*(s*r-t*q)-g*(k*r-l*q)+x*(k*t-l*s));d[2]=c*(p*r-n*q)-f*(k*r-l*q)+x*(k*n-l*p);d[3]=-(c*(p*t-n*s)-f*(k*t-l*s)+g*(k*n-l*p));d[4]=-(e*(s*r-t*q)-m*(p*r-n*q)+y*(p*t-n*s));d[5]=h*(s*r-t*q)-m*(k*r-l*q)+y*(k*t-l*s);d[6]=-(h*(p*r-n*q)-e*(k*r-l*q)+y*(k*n-l*p));d[7]=h*(p*t-n*s)-e*(k*t-l*s)+m*(k*n-l*p);d[8]=e*(g*r-t*x)-m*(f*r-n*x)+y*(f*t-n*g);d[9]=-(h*(g*r-t*x)-m*(c*r-l*x)+y*(c*t-l*g));d[10]=h*(f*r-n*x)-e*(c*r-l*x)+y*(c*n-l*f);d[11]=-(h*(f*t-n*g)-e*(c*t-l*g)+m*
(c*n-l*f));d[12]=-(e*(g*q-s*x)-m*(f*q-p*x)+y*(f*s-p*g));d[13]=h*(g*q-s*x)-m*(c*q-k*x)+y*(c*s-k*g);d[14]=-(h*(f*q-p*x)-e*(c*q-k*x)+y*(c*p-k*f));d[15]=h*(f*s-p*g)-e*(c*s-k*g)+m*(c*p-k*f);return d};a.determinant=function(a){var d=a[0],h=a[1],c=a[2],k=a[3],l=a[4],e=a[5],f=a[6],p=a[7],n=a[8],m=a[9],g=a[10],s=a[11],t=a[12],y=a[13],x=a[14];a=a[15];return(d*e-h*l)*(g*a-s*x)-(d*f-c*l)*(m*a-s*y)+(d*p-k*l)*(m*x-g*y)+(h*f-c*e)*(n*a-s*t)-(h*p-k*e)*(n*x-g*t)+(c*p-k*f)*(n*y-m*t)};a.multiply=function(a,d,h){var c=
a[0],k=a[1],l=a[2],e=a[3],f=a[4],p=a[5],n=a[6],m=a[7],g=a[8],s=a[9],t=a[10],y=a[11],x=a[12],q=a[13],r=a[14];a=a[15];var I=d[0],A=d[1],G=d[2],Q=d[3];h[0]=I*c+A*f+G*g+Q*x;h[1]=I*k+A*p+G*s+Q*q;h[2]=I*l+A*n+G*t+Q*r;h[3]=I*e+A*m+G*y+Q*a;I=d[4];A=d[5];G=d[6];Q=d[7];h[4]=I*c+A*f+G*g+Q*x;h[5]=I*k+A*p+G*s+Q*q;h[6]=I*l+A*n+G*t+Q*r;h[7]=I*e+A*m+G*y+Q*a;I=d[8];A=d[9];G=d[10];Q=d[11];h[8]=I*c+A*f+G*g+Q*x;h[9]=I*k+A*p+G*s+Q*q;h[10]=I*l+A*n+G*t+Q*r;h[11]=I*e+A*m+G*y+Q*a;I=d[12];A=d[13];G=d[14];Q=d[15];h[12]=I*c+
A*f+G*g+Q*x;h[13]=I*k+A*p+G*s+Q*q;h[14]=I*l+A*n+G*t+Q*r;h[15]=I*e+A*m+G*y+Q*a;return h};a.mul=a.multiply;a.translate=function(a,d,h){var c=d[0],k=d[1];d=d[2];var l,e,f,p,n,m,g,s,t,y,x,q;a===h?(h[12]=a[0]*c+a[4]*k+a[8]*d+a[12],h[13]=a[1]*c+a[5]*k+a[9]*d+a[13],h[14]=a[2]*c+a[6]*k+a[10]*d+a[14],h[15]=a[3]*c+a[7]*k+a[11]*d+a[15]):(l=a[0],e=a[1],f=a[2],p=a[3],n=a[4],m=a[5],g=a[6],s=a[7],t=a[8],y=a[9],x=a[10],q=a[11],h[0]=l,h[1]=e,h[2]=f,h[3]=p,h[4]=n,h[5]=m,h[6]=g,h[7]=s,h[8]=t,h[9]=y,h[10]=x,h[11]=q,
h[12]=l*c+n*k+t*d+a[12],h[13]=e*c+m*k+y*d+a[13],h[14]=f*c+g*k+x*d+a[14],h[15]=p*c+s*k+q*d+a[15]);return h};a.scale=function(a,d,h){var c=d[0],k=d[1];d=d[2];h[0]=a[0]*c;h[1]=a[1]*c;h[2]=a[2]*c;h[3]=a[3]*c;h[4]=a[4]*k;h[5]=a[5]*k;h[6]=a[6]*k;h[7]=a[7]*k;h[8]=a[8]*d;h[9]=a[9]*d;h[10]=a[10]*d;h[11]=a[11]*d;h[12]=a[12];h[13]=a[13];h[14]=a[14];h[15]=a[15];return h};a.rotate=function(a,d,h,c){var k=h[0],l=h[1];h=h[2];var e=Math.sqrt(k*k+l*l+h*h),f,p,n,m,g,s,t,y,x,q,r,I,A,G,Q,u,z,O,F,K;if(1E-7>Math.abs(e))return null;
e=1/e;k*=e;l*=e;h*=e;f=Math.sin(d);p=Math.cos(d);n=1-p;d=a[0];e=a[1];m=a[2];g=a[3];s=a[4];t=a[5];y=a[6];x=a[7];q=a[8];r=a[9];I=a[10];A=a[11];G=k*k*n+p;Q=l*k*n+h*f;u=h*k*n-l*f;z=k*l*n-h*f;O=l*l*n+p;F=h*l*n+k*f;K=k*h*n+l*f;k=l*h*n-k*f;l=h*h*n+p;c[0]=d*G+s*Q+q*u;c[1]=e*G+t*Q+r*u;c[2]=m*G+y*Q+I*u;c[3]=g*G+x*Q+A*u;c[4]=d*z+s*O+q*F;c[5]=e*z+t*O+r*F;c[6]=m*z+y*O+I*F;c[7]=g*z+x*O+A*F;c[8]=d*K+s*k+q*l;c[9]=e*K+t*k+r*l;c[10]=m*K+y*k+I*l;c[11]=g*K+x*k+A*l;a!==c&&(c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);
return c};a.rotateX=function(a,d,h){var c=Math.sin(d);d=Math.cos(d);var k=a[4],l=a[5],e=a[6],f=a[7],p=a[8],n=a[9],m=a[10],g=a[11];a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[4]=k*d+p*c;h[5]=l*d+n*c;h[6]=e*d+m*c;h[7]=f*d+g*c;h[8]=p*d-k*c;h[9]=n*d-l*c;h[10]=m*d-e*c;h[11]=g*d-f*c;return h};a.rotateY=function(a,d,h){var c=Math.sin(d);d=Math.cos(d);var k=a[0],l=a[1],e=a[2],f=a[3],p=a[8],n=a[9],m=a[10],g=a[11];a!==h&&(h[4]=a[4],h[5]=a[5],h[6]=a[6],
h[7]=a[7],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[0]=k*d-p*c;h[1]=l*d-n*c;h[2]=e*d-m*c;h[3]=f*d-g*c;h[8]=k*c+p*d;h[9]=l*c+n*d;h[10]=e*c+m*d;h[11]=f*c+g*d;return h};a.rotateZ=function(a,d,h){var c=Math.sin(d);d=Math.cos(d);var k=a[0],l=a[1],e=a[2],f=a[3],p=a[4],n=a[5],m=a[6],g=a[7];a!==h&&(h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]);h[0]=k*d+p*c;h[1]=l*d+n*c;h[2]=e*d+m*c;h[3]=f*d+g*c;h[4]=p*d-k*c;h[5]=n*d-l*c;h[6]=m*d-e*c;h[7]=g*d-f*c;return h};
a.fromRotationTranslation=function(a,d,h){var c=a[0],k=a[1],l=a[2],e=a[3],f=c+c,p=k+k,n=l+l;a=c*f;var m=c*p,c=c*n,g=k*p,k=k*n,l=l*n,f=e*f,p=e*p,e=e*n;h[0]=1-(g+l);h[1]=m+e;h[2]=c-p;h[3]=0;h[4]=m-e;h[5]=1-(a+l);h[6]=k+f;h[7]=0;h[8]=c+p;h[9]=k-f;h[10]=1-(a+g);h[11]=0;h[12]=d[0];h[13]=d[1];h[14]=d[2];h[15]=1;return h};a.fromQuat=function(a,d){var h=a[0],c=a[1],k=a[2],l=a[3],e=h+h,f=c+c,p=k+k,h=h*e,n=c*e,c=c*f,m=k*e,g=k*f,k=k*p,e=l*e,f=l*f,l=l*p;d[0]=1-c-k;d[1]=n+l;d[2]=m-f;d[3]=0;d[4]=n-l;d[5]=1-h-k;
d[6]=g+e;d[7]=0;d[8]=m+f;d[9]=g-e;d[10]=1-h-c;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};a.frustum=function(a,d,h,c,k,l,e){var f=1/(d-a),p=1/(c-h),n=1/(k-l);e[0]=2*k*f;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=2*k*p;e[6]=0;e[7]=0;e[8]=(d+a)*f;e[9]=(c+h)*p;e[10]=(l+k)*n;e[11]=-1;e[12]=0;e[13]=0;e[14]=l*k*2*n;e[15]=0;return e};a.perspective=function(a,d,h,c,k){a=1/Math.tan(a/2);var l=1/(h-c);k[0]=a/d;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=a;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=(c+h)*l;k[11]=-1;k[12]=0;k[13]=0;
k[14]=2*c*h*l;k[15]=0;return k};a.ortho=function(a,d,h,c,k,l,e){var f=1/(a-d),p=1/(h-c),n=1/(k-l);e[0]=-2*f;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=-2*p;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=2*n;e[11]=0;e[12]=(a+d)*f;e[13]=(c+h)*p;e[14]=(l+k)*n;e[15]=1;return e};a.lookAt=function(b,d,h,c){var k,l,e,f,p,n,m,g,s=b[0],t=b[1];b=b[2];e=h[0];f=h[1];l=h[2];m=d[0];h=d[1];k=d[2];if(1E-7>Math.abs(s-m)&&1E-7>Math.abs(t-h)&&1E-7>Math.abs(b-k))return a.identity(c);d=s-m;h=t-h;m=b-k;g=1/Math.sqrt(d*d+h*h+m*m);d*=g;h*=g;m*=
g;k=f*m-l*h;l=l*d-e*m;e=e*h-f*d;(g=Math.sqrt(k*k+l*l+e*e))?(g=1/g,k*=g,l*=g,e*=g):e=l=k=0;f=h*e-m*l;p=m*k-d*e;n=d*l-h*k;(g=Math.sqrt(f*f+p*p+n*n))?(g=1/g,f*=g,p*=g,n*=g):n=p=f=0;c[0]=k;c[1]=f;c[2]=d;c[3]=0;c[4]=l;c[5]=p;c[6]=h;c[7]=0;c[8]=e;c[9]=n;c[10]=m;c[11]=0;c[12]=-(k*s+l*t+e*b);c[13]=-(f*s+p*t+n*b);c[14]=-(d*s+h*t+m*b);c[15]=1;return c};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+
", "+a[13]+", "+a[14]+", "+a[15]+")"};a.zt=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.cz=a)};b4w.module.__gpp_eval=function(a){a.Ho=function(){function a(b,d,h,c,k,l){this.message=b;this.offset=c;this.Yg=k;this.of=l;this.name="SyntaxError"}(function(a,d){function h(){this.constructor=a}h.prototype=d.prototype;a.prototype=new h})(a,Error);return{Cx:a,parse:function(b){function d(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function h(a){if(za!==a){za>a&&(za=0,Za={Yg:1,of:1,th:!1});var c=Za,d,e;for(d=za;d<a;d++)e=
b.charAt(d),"\n"===e?(c.th||c.Yg++,c.of=1,c.th=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(c.Yg++,c.of=1,c.th=!0):(c.of++,c.th=!1);za=a}return Za}function c(a){C<ma||(C>ma&&(ma=C,Ca=[]),Ca.push(a))}function k(){var a,d,e;a=C;d=T();d!==D?(d=l(),d!==D?(e=T(),e!==D?(V++,10===b.charCodeAt(C)?(e=db,C++):(e=D,0===V&&c(wb)),e===D&&(b.substr(C,2)===Gb?(e=Gb,C+=2):(e=D,0===V&&c(Ta)),e===D&&(13===b.charCodeAt(C)?(e=Ya,C++):(e=D,0===V&&c(Oa)))),V--,e===D&&0===V&&c(nc),e===D&&(e=M),e!==D?a=d:(C=a,a=v)):(C=a,a=
v)):(C=a,a=v)):(C=a,a=v);return a}function l(){var a,d,f,g,h,l,m,k;a=C;d=e();if(d!==D){f=[];g=C;h=T();h!==D?(44===b.charCodeAt(C)?(l=fa,C++):(l=D,0===V&&c(W)),l!==D?(m=T(),m!==D?(k=e(),k!==D?g=h=[h,l,m,k]:(C=g,g=v)):(C=g,g=v)):(C=g,g=v)):(C=g,g=v);for(;g!==D;)f.push(g),g=C,h=T(),h!==D?(44===b.charCodeAt(C)?(l=fa,C++):(l=D,0===V&&c(W)),l!==D?(m=T(),m!==D?(k=e(),k!==D?g=h=[h,l,m,k]:(C=g,g=v)):(C=g,g=v)):(C=g,g=v)):(C=g,g=v);f!==D?a=d=0==f.length?d:f[f.length-1]:(C=a,a=v)}else C=a,a=v;return a}function e(){var a,
d,e,g;a=C;d=f();d!==D?(e=T(),e!==D?(63===b.charCodeAt(C)?(e=ca,C++):(e=D,0===V&&c(ka)),e!==D?(e=T(),e!==D?(e=l(),e!==D?(g=T(),g!==D?(58===b.charCodeAt(C)?(g=X,C++):(g=D,0===V&&c(na)),g!==D?(g=T(),g!==D?(g=l(),g!==D?a=d?e:g:(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v);a===D&&(a=f());return a}function f(){var a,b,c,d,e,f,g,h;a=C;b=w();if(b!==D){c=[];d=C;e=T();e!==D?(f=ba(),f!==D?(g=T(),g!==D?(h=w(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=
v)):(C=d,d=v);for(;d!==D;)c.push(d),d=C,e=T(),e!==D?(f=ba(),f!==D?(g=T(),g!==D?(h=w(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==D)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else C=a,a=v}else C=a,a=v;return a}function w(){var a,b,c,d,e,f,g,h;a=C;b=n();if(b!==D){c=[];d=C;e=T();e!==D?(f=da(),f!==D?(g=T(),g!==D?(h=n(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==D;)c.push(d),d=C,e=T(),e!==D?(f=da(),f!==D?(g=T(),g!==D?(h=n(),h!==D?d=e=[e,f,g,h]:(C=d,
d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==D)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else C=a,a=v}else C=a,a=v;return a}function n(){var a,b,c,d,e,f,g,h;a=C;b=m();if(b!==D){c=[];d=C;e=T();e!==D?(f=S(),f!==D?(g=T(),g!==D?(h=m(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==D;)c.push(d),d=C,e=T(),e!==D?(f=S(),f!==D?(g=T(),g!==D?(h=m(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==D)for(a=b,b=0;b<c.length;b++)a|=c[b][3];else C=a,a=v}else C=a,a=v;return a}
function m(){var a,b,c,d,e,f,h,l;a=C;b=g();if(b!==D){c=[];d=C;e=T();e!==D?(f=E(),f!==D?(h=T(),h!==D?(l=g(),l!==D?d=e=[e,f,h,l]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==D;)c.push(d),d=C,e=T(),e!==D?(f=E(),f!==D?(h=T(),h!==D?(l=g(),l!==D?d=e=[e,f,h,l]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==D)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else C=a,a=v}else C=a,a=v;return a}function g(){var a,b,c,d,e,f,g,h;a=C;b=s();if(b!==D){c=[];d=C;e=T();e!==D?(f=N(),f!==D?(g=T(),g!==D?(h=s(),h!==D?d=
e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==D;)c.push(d),d=C,e=T(),e!==D?(f=N(),f!==D?(g=T(),g!==D?(h=s(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==D)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else C=a,a=v}else C=a,a=v;return a}function s(){var a,b,c,d,e,f,g,h;a=C;b=t();if(b!==D){c=[];d=C;e=T();e!==D?(f=P(),f!==D?(g=T(),g!==D?(h=t(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==D;)c.push(d),d=C,e=T(),e!==D?(f=P(),f!==D?(g=T(),g!==
D?(h=t(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==D)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else C=a,a=v}else C=a,a=v;return a}function t(){var a,b,c,d,e,f,g,h;a=C;b=y();if(b!==D){c=[];d=C;e=T();e!==D?(f=J(),f!==D?(g=T(),g!==D?(h=y(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==D;)c.push(d),d=C,e=T(),e!==D?(f=J(),f!==D?(g=T(),g!==D?(h=y(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=
v)):(C=d,d=v);if(c!==D)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else C=a,a=v}else C=a,a=v;return a}function y(){var a,b,c,d,e,f,g,h;a=C;b=x();if(b!==D){c=[];d=C;e=T();e!==D?(f=H(),f!==D?(g=T(),g!==D?(h=x(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==D;)c.push(d),d=C,e=T(),e!==D?(f=H(),f!==D?(g=T(),g!==D?(h=x(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):
(C=d,d=v);if(c!==D)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else C=a,a=v}else C=a,a=v;return a}function x(){var a,b,c,d,e,f,g,h;a=C;b=q();if(b!==D){c=[];d=C;e=T();e!==D?(f=K(),f!==D?(g=T(),g!==D?(h=q(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==D;)c.push(d),d=C,e=T(),e!==D?(f=K(),f!==D?(g=T(),g!==D?(h=q(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==D)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "+":a+=
c[b][3];break;case "-":a-=c[b][3]}else C=a,a=v}else C=a,a=v;return a}function q(){var a,b,c,d,e,f,g,h;a=C;b=r();if(b!==D){c=[];d=C;e=T();e!==D?(f=F(),f!==D?(g=T(),g!==D?(h=r(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);for(;d!==D;)c.push(d),d=C,e=T(),e!==D?(f=F(),f!==D?(g=T(),g!==D?(h=r(),h!==D?d=e=[e,f,g,h]:(C=d,d=v)):(C=d,d=v)):(C=d,d=v)):(C=d,d=v);if(c!==D)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=Math.floor(a/c[b][3]);break;case "%":a%=
c[b][3]}else C=a,a=v}else C=a,a=v;return a}function r(){var a,e,f;a=C;b.substr(C,7)===ia?(e=ia,C+=7):(e=D,0===V&&c(B));e!==D?(f=T(),f!==D?(f=A(),f!==D?a=f:(C=a,a=v)):(C=a,a=v)):(C=a,a=v);if(a===D){a=C;e=I();if(e!==D)if(f=T(),f!==D)if(b.substr(C,2)===Cb?(f=Cb,C+=2):(f=D,0===V&&c(rc)),f===D&&(b.substr(C,2)===qb?(f=qb,C+=2):(f=D,0===V&&c(Dc))),f!==D){a:{a=e;switch(f){case "++":e=++a;break a;case "--":e=--a;break a}e=void 0}a=e}else C=a,a=v;else C=a,a=v;else C=a,a=v;a===D&&(a=I());a===D&&(a=C,b.substr(C,
2)===Cb?(e=Cb,C+=2):(e=D,0===V&&c(rc)),e===D&&(b.substr(C,2)===qb?(e=qb,C+=2):(e=D,0===V&&c(Dc)),e===D&&(43===b.charCodeAt(C)?(e=Va,C++):(e=D,0===V&&c(Wa)),e===D&&(45===b.charCodeAt(C)?(e=jc,C++):(e=D,0===V&&c(Db)),e===D&&(126===b.charCodeAt(C)?(e=Lc,C++):(e=D,0===V&&c(Ec)),e===D&&(33===b.charCodeAt(C)?(e=kc,C++):(e=D,0===V&&c(Mc))))))),e!==D?(f=T(),f!==D?(f=r(),f!==D?a=e=d(e,f):(C=a,a=v)):(C=a,a=v)):(C=a,a=v))}return a}function I(){var a,d,e;V++;var f;a=C;48===b.charCodeAt(C)?(d=la,C++):(d=D,0===
V&&c(ya));if(d!==D)if(Bb.test(b.charAt(C))?(d=b.charAt(C),C++):(d=D,0===V&&c(ac)),d!==D){d=C;e=[];f=Q();if(f!==D)for(;f!==D;)e.push(f),f=Q();else e=v;e!==D&&(e=b.substring(d,C));d=e;d!==D?a=d=parseInt("0x"+d):(C=a,a=v)}else C=a,a=v;else C=a,a=v;if(a===D){a=C;48===b.charCodeAt(C)?(d=la,C++):(d=D,0===V&&c(ya));if(d===D)if(d=C,wa.test(b.charAt(C))?(e=b.charAt(C),C++):(e=D,0===V&&c(pb)),e!==D){var g;f=[];g=G();if(g!==D)for(;g!==D;)f.push(g),g=G();else f=v;f===D&&(f=M);f!==D?d=e=[e,f]:(C=d,d=v)}else C=
d,d=v;d!==D&&(d=b.substring(a,C));a=d;a!==D&&(a=parseInt(a))}V--;a===D&&0===V&&c(ga);a===D&&(d=u(),d!==D&&(d=0),a=d,a===D&&(a=C,40===b.charCodeAt(C)?(d=aa,C++):(d=D,0===V&&c(sa)),d!==D?(d=T(),d!==D?(d=l(),d!==D?(e=T(),e!==D?(41===b.charCodeAt(C)?(e=pa,C++):(e=D,0===V&&c(R)),e!==D?a=d:(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)));return a}function A(){var a,d,e,f,g;d=u();d!==D&&(d=0);a=d;if(a===D){d=[];f=e=C;V++;40===b.charCodeAt(C)?(g=aa,C++):(g=D,0===V&&c(sa));g===D&&(41===b.charCodeAt(C)?
(g=pa,C++):(g=D,0===V&&c(R)));V--;g===D?f=ja:(C=f,f=v);f!==D?(g=Z(),g!==D?e=f=[f,g]:(C=e,e=v)):(C=e,e=v);if(e!==D)for(;e!==D;)d.push(e),f=e=C,V++,40===b.charCodeAt(C)?(g=aa,C++):(g=D,0===V&&c(sa)),g===D&&(41===b.charCodeAt(C)?(g=pa,C++):(g=D,0===V&&c(R))),V--,g===D?f=ja:(C=f,f=v),f!==D?(g=Z(),g!==D?e=f=[f,g]:(C=e,e=v)):(C=e,e=v);else d=v;d!==D&&(d=1);a=d;a===D&&(a=C,40===b.charCodeAt(C)?(d=aa,C++):(d=D,0===V&&c(sa)),d!==D?(e=T(),e!==D?(f=A(),f!==D?(g=T(),g!==D?(41===b.charCodeAt(C)?(d=pa,C++):(d=
D,0===V&&c(R)),d!==D?a=f:(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v)):(C=a,a=v))}return a}function G(){var a;Ha.test(b.charAt(C))?(a=b.charAt(C),C++):(a=D,0===V&&c(Ba));return a}function Q(){var a;ib.test(b.charAt(C))?(a=b.charAt(C),C++):(a=D,0===V&&c(ab));return a}function u(){var a,d;V++;d=a=C;V++;var e,f,g,h;e=C;b.substr(C,7)===ia?(f=ia,C+=7):(f=D,0===V&&c(B));f!==D?(g=C,V++,h=O(),V--,h===D?g=ja:(C=g,g=v),g!==D?e=f=[f,g]:(C=e,e=v)):(C=e,e=v);V--;e===D?d=ja:(C=d,d=v);if(d!==D){V++;d=C;e=z();if(e!==
D){f=[];for(g=O();g!==D;)f.push(g),g=O();f!==D?d=e+=f.join(""):(C=d,d=v)}else C=d,d=v;V--;d===D&&0===V&&c(Ra);d!==D?a=d:(C=a,a=v)}else C=a,a=v;V--;a===D&&0===V&&c(Ra);return a}function z(){var a;Pa.test(b.charAt(C))?(a=b.charAt(C),C++):(a=D,0===V&&c(Ib));a===D&&(36===b.charCodeAt(C)?(a=Na,C++):(a=D,0===V&&c(La)),a===D&&(95===b.charCodeAt(C)?(a=qc,C++):(a=D,0===V&&c(Fa))));return a}function O(){var a;a=z();a===D&&(a=G());return a}function F(){var a,d,e,f;a=C;42===b.charCodeAt(C)?(d=bb,C++):(d=D,0===
V&&c(Vc));d===D&&(47===b.charCodeAt(C)?(d=Nc,C++):(d=D,0===V&&c(sc)),d===D&&(37===b.charCodeAt(C)?(d=lc,C++):(d=D,0===V&&c(Eb))));d!==D?(e=C,V++,61===b.charCodeAt(C)?(f=jb,C++):(f=D,0===V&&c(Jb)),V--,f===D?e=ja:(C=e,e=v),e!==D?a=d:(C=a,a=v)):(C=a,a=v);return a}function K(){var a,d,e;a=C;43===b.charCodeAt(C)?(d=Va,C++):(d=D,0===V&&c(Wa));d!==D?(d=C,V++,43===b.charCodeAt(C)?(e=Va,C++):(e=D,0===V&&c(Wa)),e===D&&(61===b.charCodeAt(C)?(e=jb,C++):(e=D,0===V&&c(Jb))),V--,e===D?d=ja:(C=d,d=v),d!==D?a="+":
(C=a,a=v)):(C=a,a=v);a===D&&(a=C,45===b.charCodeAt(C)?(d=jc,C++):(d=D,0===V&&c(Db)),d!==D?(d=C,V++,45===b.charCodeAt(C)?(e=jc,C++):(e=D,0===V&&c(Db)),e===D&&(61===b.charCodeAt(C)?(e=jb,C++):(e=D,0===V&&c(Jb))),V--,e===D?d=ja:(C=d,d=v),d!==D?a="-":(C=a,a=v)):(C=a,a=v));return a}function H(){var a;b.substr(C,2)===bc?(a=bc,C+=2):(a=D,0===V&&c(Fc));a===D&&(b.substr(C,2)===Ub?(a=Ub,C+=2):(a=D,0===V&&c(Y)));return a}function J(){var a;b.substr(C,2)===cb?(a=cb,C+=2):(a=D,0===V&&c(Sa));a===D&&(b.substr(C,
2)===ta?(a=ta,C+=2):(a=D,0===V&&c(tc)),a===D&&(60===b.charCodeAt(C)?(a=va,C++):(a=D,0===V&&c(rb)),a===D&&(62===b.charCodeAt(C)?(a=sb,C++):(a=D,0===V&&c(ra)))));return a}function P(){var a;b.substr(C,2)===Ja?(a=Ja,C+=2):(a=D,0===V&&c(tb));a===D&&(b.substr(C,2)===ub?(a=ub,C+=2):(a=D,0===V&&c(Fb)));return a}function N(){var a,d,e;a=C;38===b.charCodeAt(C)?(d=ua,C++):(d=D,0===V&&c(qa));d!==D?(d=C,V++,38===b.charCodeAt(C)?(e=ua,C++):(e=D,0===V&&c(qa)),V--,e===D?d=ja:(C=d,d=v),d!==D?a="&":(C=a,a=v)):(C=
a,a=v);return a}function E(){var a,d,e;a=C;94===b.charCodeAt(C)?(d=Ka,C++):(d=D,0===V&&c(Kb));d!==D?(d=C,V++,94===b.charCodeAt(C)?(e=Ka,C++):(e=D,0===V&&c(Kb)),V--,e===D?d=ja:(C=d,d=v),d!==D?a="^":(C=a,a=v)):(C=a,a=v);return a}function S(){var a,d,e;a=C;124===b.charCodeAt(C)?(d=cc,C++):(d=D,0===V&&c(Lb));d!==D?(d=C,V++,124===b.charCodeAt(C)?(e=cc,C++):(e=D,0===V&&c(Lb)),V--,e===D?d=ja:(C=d,d=v),d!==D?a="|":(C=a,a=v)):(C=a,a=v);return a}function da(){var a;b.substr(C,2)===dc?(a=dc,C+=2):(a=D,0===V&&
c(Vb));a!==D&&(a="&&");return a}function ba(){var a;b.substr(C,2)===vb?(a=vb,C+=2):(a=D,0===V&&c(uc));a!==D&&(a="||");return a}function T(){var a,b;a=[];for(b=oa();b!==D;)a.push(b),b=oa();return a}function oa(){var a;V++;Nb.test(b.charAt(C))?(a=b.charAt(C),C++):(a=D,0===V&&c(mc));V--;a===D&&0===V&&c(Mb);return a}function Z(){var a;b.length>C?(a=b.charAt(C),C++):(a=D,0===V&&c(xb));return a}var U=1<arguments.length?arguments[1]:{},D={},ha={start:k},L=k,v=D,M=null,fa=",",W={type:"literal",value:",",
description:'","'},ca="?",ka={type:"literal",value:"?",description:'"?"'},X=":",na={type:"literal",value:":",description:'":"'},ia="defined",B={type:"literal",value:"defined",description:'"defined"'},aa="(",sa={type:"literal",value:"(",description:'"("'},pa=")",R={type:"literal",value:")",description:'")"'},ja=void 0,ga={type:"other",description:"number"},la="0",ya={type:"literal",value:"0",description:'"0"'},Ha=/^[0-9]/,Ba={type:"class",value:"[0-9]",description:"[0-9]"},wa=/^[1-9]/,pb={type:"class",
value:"[1-9]",description:"[1-9]"},Bb=/^[xX]/,ac={type:"class",value:"[xX]",description:"[xX]"},ib=/^[0-9a-fA-F]/,ab={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},Ra={type:"other",description:"identifier"},Na="$",La={type:"literal",value:"$",description:'"$"'},qc="_",Fa={type:"literal",value:"_",description:'"_"'},Pa=/^[a-zA-Z]/,Ib={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},Cb="++",rc={type:"literal",value:"++",description:'"++"'},qb="--",Dc={type:"literal",value:"--",description:'"--"'},
Va="+",Wa={type:"literal",value:"+",description:'"+"'},jc="-",Db={type:"literal",value:"-",description:'"-"'},Lc="~",Ec={type:"literal",value:"~",description:'"~"'},kc="!",Mc={type:"literal",value:"!",description:'"!"'},bb="*",Vc={type:"literal",value:"*",description:'"*"'},Nc="/",sc={type:"literal",value:"/",description:'"/"'},lc="%",Eb={type:"literal",value:"%",description:'"%"'},jb="=",Jb={type:"literal",value:"=",description:'"="'},bc="<<",Fc={type:"literal",value:"<<",description:'"<<"'},Ub=
">>",Y={type:"literal",value:">>",description:'">>"'},cb="<=",Sa={type:"literal",value:"<=",description:'"<="'},ta=">=",tc={type:"literal",value:">=",description:'">="'},va="<",rb={type:"literal",value:"<",description:'"<"'},sb=">",ra={type:"literal",value:">",description:'">"'},Ja="==",tb={type:"literal",value:"==",description:'"=="'},ub="!=",Fb={type:"literal",value:"!=",description:'"!="'},ua="&",qa={type:"literal",value:"&",description:'"&"'},Ka="^",Kb={type:"literal",value:"^",description:'"^"'},
cc="|",Lb={type:"literal",value:"|",description:'"|"'},dc="&&",Vb={type:"literal",value:"&&",description:'"&&"'},vb="||",uc={type:"literal",value:"||",description:'"||"'},Mb={type:"other",description:"whitespace"},Nb=/^[\t\x0B\f ]/,mc={type:"class",value:"[\\t\\x0B\\f ]",description:"[\\t\\x0B\\f ]"},nc={type:"other",description:"end of line"},db="\n",wb={type:"literal",value:"\n",description:'"\\n"'},Gb="\r\n",Ta={type:"literal",value:"\r\n",description:'"\\r\\n"'},Ya="\r",Oa={type:"literal",value:"\r",
description:'"\\r"'},xb={type:"any",description:"any character"},C=0,za=0,Za={Yg:1,of:1,th:!1},ma=0,Ca=[],V=0,Qa;if("startRule"in U){if(!(U.jp in ha))throw Error("Can't start parsing from rule \""+U.jp+'".');L=ha[U.jp]}Qa=L();if(Qa!==D&&C===b.length)return Qa;Qa!==D&&C<b.length&&c({type:"end",description:"end of input"});throw function(c,d,e){function f(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,
1):b++}function g(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}
var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var l=h(e),m=e<b.length?b.charAt(e):null;null!==d&&f(d);return new a(null!==c?c:g(d,m),0,0,e,l.Yg,l.of)}(null,Ca,ma);}}}()};b4w.module.__md5=function(a){function p(a,e){var f=a[0],k=a[1],n=a[2],m=a[3],f=d(f,k,n,m,e[0],7,-680876936),m=d(m,f,k,n,e[1],12,-389564586),n=d(n,m,f,k,e[2],17,606105819),k=d(k,n,m,f,e[3],22,-1044525330),f=d(f,k,n,m,e[4],7,-176418897),m=d(m,f,k,n,e[5],12,1200080426),n=d(n,m,f,k,e[6],17,-1473231341),k=d(k,n,m,f,e[7],22,-45705983),f=d(f,k,n,m,e[8],7,1770035416),m=d(m,f,k,n,e[9],12,-1958414417),n=d(n,m,f,k,e[10],17,-42063),k=d(k,n,m,f,e[11],22,-1990404162),f=d(f,k,n,m,e[12],7,1804603682),m=d(m,f,k,n,
e[13],12,-40341101),n=d(n,m,f,k,e[14],17,-1502002290),k=d(k,n,m,f,e[15],22,1236535329),f=h(f,k,n,m,e[1],5,-165796510),m=h(m,f,k,n,e[6],9,-1069501632),n=h(n,m,f,k,e[11],14,643717713),k=h(k,n,m,f,e[0],20,-373897302),f=h(f,k,n,m,e[5],5,-701558691),m=h(m,f,k,n,e[10],9,38016083),n=h(n,m,f,k,e[15],14,-660478335),k=h(k,n,m,f,e[4],20,-405537848),f=h(f,k,n,m,e[9],5,568446438),m=h(m,f,k,n,e[14],9,-1019803690),n=h(n,m,f,k,e[3],14,-187363961),k=h(k,n,m,f,e[8],20,1163531501),f=h(f,k,n,m,e[13],5,-1444681467),m=
h(m,f,k,n,e[2],9,-51403784),n=h(n,m,f,k,e[7],14,1735328473),k=h(k,n,m,f,e[12],20,-1926607734),f=b(k^n^m,f,k,e[5],4,-378558),m=b(f^k^n,m,f,e[8],11,-2022574463),n=b(m^f^k,n,m,e[11],16,1839030562),k=b(n^m^f,k,n,e[14],23,-35309556),f=b(k^n^m,f,k,e[1],4,-1530992060),m=b(f^k^n,m,f,e[4],11,1272893353),n=b(m^f^k,n,m,e[7],16,-155497632),k=b(n^m^f,k,n,e[10],23,-1094730640),f=b(k^n^m,f,k,e[13],4,681279174),m=b(f^k^n,m,f,e[0],11,-358537222),n=b(m^f^k,n,m,e[3],16,-722521979),k=b(n^m^f,k,n,e[6],23,76029189),f=
b(k^n^m,f,k,e[9],4,-640364487),m=b(f^k^n,m,f,e[12],11,-421815835),n=b(m^f^k,n,m,e[15],16,530742520),k=b(n^m^f,k,n,e[2],23,-995338651),f=c(f,k,n,m,e[0],6,-198630844),m=c(m,f,k,n,e[7],10,1126891415),n=c(n,m,f,k,e[14],15,-1416354905),k=c(k,n,m,f,e[5],21,-57434055),f=c(f,k,n,m,e[12],6,1700485571),m=c(m,f,k,n,e[3],10,-1894986606),n=c(n,m,f,k,e[10],15,-1051523),k=c(k,n,m,f,e[1],21,-2054922799),f=c(f,k,n,m,e[8],6,1873313359),m=c(m,f,k,n,e[15],10,-30611744),n=c(n,m,f,k,e[6],15,-1560198380),k=c(k,n,m,f,e[13],
21,1309151649),f=c(f,k,n,m,e[4],6,-145523070),m=c(m,f,k,n,e[11],10,-1120210379),n=c(n,m,f,k,e[2],15,718787259),k=c(k,n,m,f,e[9],21,-343485551);a[0]=f+a[0]&4294967295;a[1]=k+a[1]&4294967295;a[2]=n+a[2]&4294967295;a[3]=m+a[3]&4294967295}function b(a,b,c,d,h,k){b=(b+a&4294967295)+(d+k&4294967295)&4294967295;return(b<<h|b>>>32-h)+c&4294967295}function d(a,c,d,h,k,m,g){return b(c&d|~c&h,a,c,k,m,g)}function h(a,c,d,h,k,m,g){return b(c&h|d&~h,a,c,k,m,g)}function c(a,c,d,h,k,m,g){return b(d^(c|~h),a,c,k,
m,g)}var k="0123456789abcdef".split("");a.Ln=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var h=b.substring(d-64,d),m=[],g=void 0,g=0;64>g;g+=4)m[g>>2]=h.charCodeAt(g)+(h.charCodeAt(g+1)<<8)+(h.charCodeAt(g+2)<<16)+(h.charCodeAt(g+3)<<24);p(a,m)}b=b.substring(d-64);h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)h[d>>2]|=b.charCodeAt(d)<<(d%4<<3);h[d>>2]|=128<<(d%4<<3);if(55<d)for(p(a,h),d=0;16>d;d++)h[d]=0;h[14]=8*
c;p(a,h);for(b=0;b<a.length;b++){c=a[b];d="";for(h=0;4>h;h++)d+=k[c>>8*h+4&15]+k[c>>8*h&15];a[b]=d}return a.join("")}};b4w.module.animation=function(a,p){var b=p("__animation"),d=p("__constraints");p("__physics");var h=p("__util"),c=p("__print");a.SLOT_0=b.SLOT_0;a.SLOT_1=b.SLOT_1;a.SLOT_2=b.SLOT_2;a.SLOT_3=b.SLOT_3;a.SLOT_4=b.SLOT_4;a.SLOT_5=b.SLOT_5;a.SLOT_6=b.SLOT_6;a.SLOT_7=b.SLOT_7;a.SLOT_ALL=b.SLOT_ALL;a.OBJ_ANIM_TYPE_ARMATURE=b.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_SKELETAL=b.OBJ_ANIM_TYPE_SKELETAL;a.OBJ_ANIM_TYPE_OBJECT=b.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=b.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=
b.OBJ_ANIM_TYPE_SOUND;a.OBJ_ANIM_TYPE_PARTICLES=b.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_STATIC=b.OBJ_ANIM_TYPE_STATIC;a.AB_CYCLIC=b.AB_CYCLIC;a.AB_FINISH_RESET=b.AB_FINISH_RESET;a.AB_FINISH_STOP=b.AB_FINISH_STOP;var k=new Float32Array(4);a.is_animated=function(a){return b.is_animated(a)};a.get_actions=function(){for(var a=[],c=b.Ot(),d=0;d<c.length;d++)a.push(b.vw(c[d].name));return a};a.get_current_action=function(a,c){if(!b.is_animated(a))return null;c=c||b.SLOT_0;return b.mn(a,c)};a.get_anim_names=
function(a){return b.sk(a)?b.get_anim_names(a):[]};a.get_current_anim_name=function(a,c){if(!b.is_animated(a))return null;c=c||b.SLOT_0;return b.mn(a,c)};a.apply=function(a,d,f){f>b.SLOT_7?c.error("Can't apply animation to slot ",f,' for object "',a.name,'". Object can have maximum of 8 animation slots'):(f=f||b.SLOT_0,b.apply(a,d,f))};a.remove=function(a){b.remove(a)};a.remove_slot_animation=function(a,c){b.is_animated(a)&&(c=c||b.SLOT_0,b.remove_slot_animation(a,c))};a.apply_def=function(a){b.apply_def(a)};
a.play=function(a,d,f){b.is_animated(a)?(f=f||b.SLOT_0,b.play(a,d,f),b.update_object_animation(a,0,f)):c.error('Object "'+a.name+'" has no applied animation')};a.stop=function(a,c){b.is_animated(a)&&(c=c||b.SLOT_0,b.stop(a,c))};a.is_play=function(a,c){if(!b.is_animated(a))return!1;c=c||b.SLOT_0;return b.is_play(a,c)};a.set_current_frame_float=function(a,c,d){b.is_animated(a)&&(d=d||b.SLOT_0,b.set_current_frame_float(a,c,d))};a.get_current_frame_float=function(a,c){if(!b.is_animated(a))return 0;c=
c||b.SLOT_0;return b.get_current_frame_float(a,c)};a.set_frame=function(a,c,d){b.is_animated(a)&&(d=d||b.SLOT_0,b.set_current_frame_float(a,c,d),b.update_object_animation(a,0,d))};a.get_frame=function(a,c){if(!b.is_animated(a))return 0;c=c||b.SLOT_0;return b.get_current_frame_float(a,c)};a.set_speed=function(a,c,d){b.is_animated(a)&&(d=d||b.SLOT_0,b.set_speed(a,c||1,d))};a.get_speed=function(a,c){if(!b.is_animated(a))return 0;c=c||b.SLOT_0;return b.get_speed(a,c)};a.get_frame_range=function(a,c){if(b.is_animated(a)){c=
c||b.SLOT_0;var d=a.H[c];if(d)return[d.start,d.start+d.length]}return null};a.get_anim_start_frame=function(a,c){if(b.is_animated(a)){c=c||b.SLOT_0;var d=a.H[c];if(d)return d.start}return-1};a.get_anim_length=function(a,c){if(b.is_animated(a)){c=c||b.SLOT_0;var d=a.H[c];if(d)return d.length}return-1};a.cyclic=function(a,d,f){b.is_animated(a)?(f=f||b.SLOT_0,b.cyclic(a,d,f)):c.error('Object "'+a.name+'" has no applied animation')};a.is_cyclic=function(a,c){if(!b.is_animated(a))return!1;c=c||b.SLOT_0;
return b.is_cyclic(a,c)};a.set_behavior=function(a,c,d){b.is_animated(a)&&(d=d||b.SLOT_0,b.set_behavior(a,c,d))};a.get_behavior=function(a,c){if(!b.is_animated(a))return null;c=c||b.SLOT_0;return b.get_behavior(a,c)};a.apply_smoothing=function(a,c,d){b.is_animated(a)&&b.apply_smoothing(a,c,d)};a.update_object_animation=function(a,c,d){b.is_animated(a)&&(d=d||b.SLOT_0,b.update_object_animation(a,c||0,d))};a.frame_to_sec=function(a){return b.frame_to_sec(a)};a.get_bone_translation=function(a,b,c){if(!h.He(a))return null;
c||(c=new Float32Array(3));d.Tt(a,b,!1,k,null);c[0]=k[0];c[1]=k[1];c[2]=k[2];return c};a.get_first_armature_object=function(a){return h.Nb(a)?b.get_first_armature_object(a):null};a.get_slot_num_by_anim=function(a,c){return b.is_animated(a)&&c?b.get_slot_num_by_anim(a,c):null};a.get_anim_name=function(a,c){if(!b.is_animated(a))return null;c=c||b.SLOT_0;return b.jn(a,c)};a.get_anim_type=function(a,c){return b.is_animated(a)?b.get_anim_type(a,c):null};a.apply_to_first_empty_slot=function(a,c){return b.apply_to_first_empty_slot(a,
c)};a.detect_collisions=function(){throw"Deprecated method execution";};a.is_detect_collisions_used=function(){throw"Deprecated method execution";};a.update_object_transform=function(){throw"Deprecated method execution";};a.set_translation=function(){throw"Deprecated method execution";};a.set_translation_v=function(){throw"Deprecated method execution";};a.set_translation_rel=function(){throw"Deprecated method execution";};a.get_translation=function(){throw"Deprecated method execution";};a.set_rotation_quat=
function(){throw"Deprecated method execution";};a.set_rotation_quat_v=function(){throw"Deprecated method execution";};a.get_rotation_quat=function(){throw"Deprecated method execution";};a.set_rotation_euler=function(){throw"Deprecated method execution";};a.set_rotation_euler_v=function(){throw"Deprecated method execution";};a.set_scale=function(){throw"Deprecated method execution";};a.empty_reset_transform=function(){throw"Deprecated method execution";}};b4w.module.assets=function(a,p){var b=p("__assets");a.AT_ARRAYBUFFER=b.AT_ARRAYBUFFER;a.AT_JSON=b.AT_JSON;a.AT_TEXT=b.AT_TEXT;a.AT_AUDIOBUFFER=b.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=b.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=b.AT_AUDIO_ELEMENT;a.enqueue=function(a,h,c){b.enqueue(a,h,c)}};b4w.module.camera=function(a,p){function b(a,b){d.Af(a)?w.copy(b,a.d.ob):k.error("set_pivot(): Wrong object or camera move style")}var d=p("__camera"),h=p("__config"),c=p("__physics"),k=p("__print"),l=p("__constraints"),e=p("__transform"),f=p("__util"),w=p("vec3"),n=p("vec4"),m=p("quat"),g=p("mat4"),s=h.controls,t=new Float32Array(3);new Float32Array(3);var y=new Float32Array(4),x=new Float32Array(4);a.MS_STATIC=d.MS_STATIC;a.MS_ANIMATION=d.MS_ANIMATION;a.MS_CONTROLS=d.MS_TARGET_CONTROLS;a.MS_TARGET_CONTROLS=
d.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=d.MS_EYE_CONTROLS;a.is_camera=function(a){return d.is_camera(a)};a.set_move_style=function(a,b){a.d.Da=b};a.get_move_style=function(a){return d.is_camera(a)?d.get_move_style(a):(k.error("Wrong object"),null)};a.change_eye_target_dist=function(){k.error("change_eye_target_dist() deprecated")};a.change_trans_speed=function(a,b){var c=a.d,d=c.jj[0],d=d*(1+b*s.Tr);c.jj=[d,d,d]};a.get_trans_speed=function(a){return d.is_camera(a)?a.d.jj[0]:(k.error("Wrong object"),
0)};a.set_look_at=function(a,b,f,g){var h=a.d;d.tt(b,f,g,h.e,h.g);e.D(a);c.sync_transform(a)};a.get_eye=function(a){return a.d.e};a.set_pivot=b;a.get_pivot=function(a,b){if(d.Af(a))return b||(b=new Float32Array(3)),w.copy(a.d.ob,b),b;k.error("get_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(a,b,g){if(d.Af(a)){var h=a.d;t[0]=0;t[1]=1;t[2]=0;m.setAxisAngle(t,b,y);f.Uo(h.e,h.ob,y,h.e);t[0]=1;t[1]=0;t[2]=0;w.transformQuat(t,h.g,t);m.setAxisAngle(t,g,y);f.Uo(h.e,h.ob,y,h.e);e.D(a);
c.sync_transform(a)}else k.error("rotate_pivot(): wrong object")};a.apply_vertical_limits=function(a,b,c,f){a.d.hb={we:b,Wd:c};f==e.SPACE_LOCAL&&d.ex(a);d.ul(a)};a.clear_vertical_limits=function(a){a.d.hb=null;d.ul(a)};a.apply_horizontal_limits=function(a,b,c,f){a.d.Xb={left:b,right:c};f==e.SPACE_LOCAL&&d.tu(a);d.ul(a)};a.clear_horizontal_limits=function(a){a.d.Xb=null};a.apply_distance_limits=function(a,b,c){d.Af(a)?b>c?k.error("apply_distance_limits(): wrong distance limits"):(a=a.d,a.pg=!0,a.ue=
b,a.mi=c):k.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){d.Af(a)?a.d.pg=!1:k.error("clear_distance_limits(): wrong object")};a.set_eye_params=function(a,b,f){m.identity(a.d.g);d.Wk(a,Math.PI/2);d.To(a,b);d.Wk(a,-f);e.D(a);c.sync_transform(a)};a.is_look_up=function(a){f.quat_to_dir(a.d.g,f.AXIS_MY,t);return 0<=t[1]?!0:!1};a.rotate=function(a,b,f){d.To(a,b);d.Wk(a,-f);e.D(a);c.sync_transform(a)};a.get_angles=function(a,b){b||(b=new Float32Array(2));d.get_angles(a,
b);return b};a.set_stereo_distance=function(a,b){for(var c=a.d.R,e=0;e<c.length;e++){var f=c[e];f.type!=d.ib&&f.type!=d.rb||d.Vv(f,b,f.Ec)}};a.get_stereo_distance=function(a){a=a.d.R;for(var b=0;b<a.length;b++){var c=a[b];if(c.type==d.ib||c.type==d.rb)return c.yh}return 0};a.is_underwater=function(a){return a.d.zp};a.translate_view=function(a,b,c,e){a=a.d.R;for(var f=0;f<a.length;f++){var h=a[f];h.fb||d.Tf(h,h.Wa);var k=t;k[0]=-b;k[1]=-c;k[2]=0;g.translate(h.ga,k,h.ga);g.rotateZ(h.ga,e,h.ga);g.multiply(h.ga,
h.oa,h.ff);d.Qr(h);d.Pr(h)}};a.correct_up=function(a,b){b||(b=f.AXIS_Y);l.correct_up(a,b)};a.zoom_object=function(a,f){if(d.Af(a)){e.get_object_center(f,!1,t);b(a,t);e.D(a);var g=e.get_object_size(f),h=d.Pt(a)/2,g=g/Math.sin(h),h=e.ev(a,t);e.move_local(a,0,g-h,0);e.D(a);c.sync_transform(a)}else k.error("zoom_object(): wrong object")};a.calc_ray=function(a,b,c,e){e||(e=new Float32Array(3));var f=a.d.R[0];switch(f.type){case d.qc:case d.ee:case d.ib:case d.rb:var g=Math.tan(f.zc*Math.PI/360);x[0]=(2*
b/f.width-1)*g*f.Wa;x[1]=-1;x[2]=(2*c/f.height-1)*g;x[3]=0;n.transformMat4(x,a.d.G,x);e[0]=x[0];e[1]=x[1];e[2]=x[2];w.normalize(e,e);return e;default:return k.error("Non-compatible camera"),e}};a.project_point=function(a,b,c){c||(c=new Float32Array(2));var f=a.d.R[0];switch(f.type){case d.qc:case d.ee:case d.ib:case d.rb:return e.get_translation(a,t),w.subtract(b,t,t),x.set(t),x[3]=0,n.transformMat4(x,f.ff,x),a=-x[1]/x[3],c[0]=(x[0]/x[3]+1)/2*f.width|0,c[1]=(a+1)/2*f.height|0,c;default:return k.error("Non-compatible camera"),
c}}};b4w.module.config=function(a,p){var b=p("__config");a.P_LOW=b.P_LOW;a.P_HIGH=b.P_HIGH;a.P_ULTRA=b.P_ULTRA;a.P_CUSTOM=b.P_CUSTOM;a.set=b.set;a.get=b.get;a.reset=b.reset};b4w.module.controls=function(a,p){var b=p("__controls"),d=p("__print");a.CT_CONTINUOUS=b.CT_CONTINUOUS;a.CT_TRIGGER=b.CT_TRIGGER;a.CT_SHOT=b.CT_SHOT;a.CT_LEVEL=b.CT_LEVEL;a.KEY_SHIFT=16;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;
a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=
221;a.KEY_SINGLE_QUOTE=222;a.H_ROT=0;a.V_ROT=0;a.H_TRA=0;a.V_TRA=0;a.F_TRA=0;a.JUMP=0;a.X_TRA=0;a.Y_TRA=0;a.Z_TRA=0;a.set=function(){d.error("set() deprecated, use new sensor-based API")};a.get=function(){d.error("get() deprecated, use new sensor-based API");return null};a.get_type=function(){d.error("get_type() deprecated, use new sensor-based API");return null};a.release=function(){d.error("release() deprecated, use new sensor-based API")};a.create_custom_sensor=b.create_custom_sensor;a.create_keyboard_sensor=
b.create_keyboard_sensor;a.create_collision_sensor=b.create_collision_sensor;a.create_collision_impulse_sensor=b.create_collision_impulse_sensor;a.create_ray_sensor=b.create_ray_sensor;a.create_mouse_click_sensor=b.create_mouse_click_sensor;a.create_mouse_wheel_sensor=b.create_mouse_wheel_sensor;a.create_mouse_move_sensor=b.create_mouse_move_sensor;a.create_touch_move_sensor=b.create_touch_move_sensor;a.create_touch_zoom_sensor=b.create_touch_zoom_sensor;a.create_motion_sensor=b.create_motion_sensor;
a.create_vertical_velocity_sensor=b.create_vertical_velocity_sensor;a.create_timer_sensor=b.create_timer_sensor;a.reset_timer_sensor=b.reset_timer_sensor;a.create_elapsed_sensor=b.create_elapsed_sensor;a.create_timeline_sensor=b.create_timeline_sensor;a.create_selection_sensor=b.create_selection_sensor;a.set_custom_sensor=function(a,c){b.Mv(a,c)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=function(a,b,k){a=a.ub;if(!a||!a[b])return d.error("get_sensor_value(): wrong object"),
null;b=a[b].kd[k];return b?b.value:(d.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,b,k){a=a.ub;if(!a||!a[b])return d.error("get_sensor_payload(): wrong object"),null;b=a[b].kd[k];return b?b.Zb:(d.error("get_sensor_payload(): sensor not found"),null)};a.sensor_make_positive=function(){throw"Deprecated method execution";};a.sensor_make_negative=function(){throw"Deprecated method execution";};a.create_sensor_lock=function(a,c,d){a.Dk=c.slice(0);a.Ck=Array(c.length);
a.Ii=d||b.$s};a.remove_sensor_lock=function(a){a.Dk=null;a.Ck=null;a.Ii=null};a.create_sensor_manifold=b.create_sensor_manifold;a.create_kb_sensor_manifold=function(a,c,d,l,e,f){l=b.create_keyboard_sensor(l);b.create_sensor_manifold(a,c,d,[l],null,e,f)};a.check_sensor_manifolds=function(a){return b.check_sensor_manifold(a,null)};a.check_sensor_manifold=b.check_sensor_manifold;a.remove_sensor_manifolds=function(a){b.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=b.remove_sensor_manifold;
a.reset=b.reset;a.keydown_cb=b.keydown_cb;a.keyup_cb=b.keyup_cb;a.mouse_down_cb=b.mouse_down_cb;a.mouse_up_cb=b.mouse_up_cb;a.mouse_wheel_cb=b.mouse_wheel_cb;a.mouse_move_cb=b.mouse_move_cb;a.touch_start_cb=b.touch_start_cb;a.touch_move_cb=b.touch_move_cb};b4w.module.constraints=function(a,p){var b=p("__constraints"),d=p("__physics"),h=p("__transform");a.append_stiff=function(a,k,l,e){k instanceof Array&&2==k.length?b.Zl(a,k[0],k[1],l,e):b.$l(a,k,l,e);h.D(a);d.sync_transform(a)};a.append_semi_stiff=function(a,k,l,e){b.sr(a,k,l,e);h.D(a);d.sync_transform(a)};a.append_semi_stiff_cam=function(a,k,l,e,f,p,n,m){b.rr(a,k,l,e,f,p,n,m);h.D(a);d.sync_transform(a)};a.append_semi_soft_cam=function(a,k,l,e){if(!e||0>e)e=0.25;b.qr(a,k,l,e);h.D(a);d.sync_transform(a)};
a.append_stiff_trans=function(a,k,l){b.tr(a,k,l);h.D(a);d.sync_transform(a)};a.append_copy_trans=function(a,k,l){b.mr(a,k,l);h.D(a);d.sync_transform(a)};a.append_stiff_trans_rot=function(a,k,l,e){b.ur(a,k,l,e);h.D(a);d.sync_transform(a)};a.append_track=function(a,k){3==k.length?b.xr(a,k):b.wr(a,k);h.D(a);d.sync_transform(a)};a.append_follow=function(a,k,l,e){3==k.length?b.or(a,k,l,e):b.nr(a,k,l,e);h.D(a);d.sync_transform(a)};a.remove=function(a){a.Qa&&b.remove(a)}};b4w.module.data=function(a,p){var b=p("__print"),d=p("__data");a.load=d.load;a.load_and_add_new=d.load;a.unload=function(a){d.unload(a|0)};a.cleanup=a.unload;a.get_bpy_world=function(){b.error("get_bpy_world() deprecated");return null};a.set_debug_resources_root=d.set_debug_resources_root;a.is_primary_loaded=d.is_primary_loaded};b4w.module.debug=function(a,p){p("__batch");var b=p("__print"),d=p("__controls"),h=p("__debug"),c=p("__physics"),k=p("__scenegraph"),l=p("__scenes"),e=p("__sfx"),f=p("__textures"),w=p("__util"),n=p("vec3");a.physics_worker=function(){c.Ys()};a.physics_id=function(a){b.log("O",c.ut(a));for(var d=c.Nt().k.m,e=0;e<d.length;e++){var f=d[e];f.eb.B==a&&b.log("B",f)}};a.visible_objects=function(){for(var a=l.get_active(),c=l.ha(a,"MESH",l.DATA_ID_ALL),a=l.ea(a,"MAIN_OPAQUE").m,d=0;d<c.length;d++){var e=
c[d],f=e.d;if("DYNAMIC"==f.type)for(var h=0;h<a.length;h++){var k=a[h];if(k.M&&k.Ma==f){b.log(e.name,e);break}}}};a.object_info=function(a){for(var c=l.get_active(),d=l.ha(c,"MESH",l.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if(f.name==a){b.log("Object",f);for(var h=l.lk(c),k=0;k<h.length;k++){for(var n=h[k],p=n.m,w=[],G=0;G<p.length;G++)p[G].Ma==f.d&&w.push(p[G]);b.log("Subscene "+n.type,w)}}}};a.objects_stat=function(){var a=l.get_active();console.log("Armatures: "+l.ha(a,"ARMATURE",l.DATA_ID_ALL).length);
console.log("Cameras: "+l.ha(a,"CAMERA",l.DATA_ID_ALL).length);console.log("Curves: "+l.ha(a,"CURVE",l.DATA_ID_ALL).length);console.log("Empties: "+l.ha(a,"EMPTY",l.DATA_ID_ALL).length);console.log("Lamps: "+l.ha(a,"LAMP",l.DATA_ID_ALL).length);console.log("Meshes: "+l.ha(a,"MESH",l.DATA_ID_ALL).length);console.log("Speakers: "+l.ha(a,"SPEAKER",l.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=l.get_active(),b=[l.ea(b,"MAIN_OPAQUE"),l.ea(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];
if(d)for(var d=d.m,e=0;e<d.length;e++){var f=d[e].l;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=l.get_active(),b=[l.ea(b,"MAIN_OPAQUE"),l.ea(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.m,e=0;e<d.length;e++){var f=d[e].l;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){var a=l.get_active(),a=[l.ea(a,"MAIN_OPAQUE"),l.ea(a,"MAIN_BLEND")];return a[0].m.length+a[1].m.length};a.geometry_stats=function(){for(var a=l.get_active(),b=l.lk(a),
a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.m,f=0;f<e.length;f++){var h=e[f].l,k=e[f].Ma;h&&("COLOR_PICKING"!=d.type&&"GLOW_MASK"!=d.type||k.Si)&&(a[h.id]=h)}}var e=d=c=b=0,n;for(n in a)h=a[n],h=h.Ya,h.ji&&(d++,e+=h.ji/1048576),b++,c+=h.Rm/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=l.get_active(),c=[l.ea(c,"MAIN_OPAQUE"),l.ea(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=
e.m,f=0;f<e.length;f++){var h=e[f].l;if(h)for(var h=h.Aa,k=0;k<h.length;k++){var n=h[k];if("IMAGE"===n.source||"ENVIRONMENT_MAP"===n.source){var p=n.Ba;-1===a.indexOf(p)&&(a.push(p),n=n.width*n.height*4/1048576/n.Fg,n*=1.3333,b+=n)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=l.get_active(),c=l.lk(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var h=e.i,k=[h.Ra,h.Ub];k.push.apply(k,e.Gc);for(e=0;e<k.length;e++){var n=k[e];f.Wg(n)&&-1==a.indexOf(n)&&
(a.push(n),b+=h.width*h.height*f.du(n))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=l.get_active();(a=l.ea(a,"MAIN_OPAQUE"))&&l.eo(a.i,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=l.get_active(),b=l.ea(a,"MAIN_OPAQUE"),a=l.jl(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}l.eo(d.i,b,e)}};a.scenegraph_to_dot=function(){var a=l.get_active();
b.log(k.Ws(l.nk(a)))};a.controls_info=d.debug;a.object_distance=function(a,b){return n.dist(a.d.e,b.d.e)};a.msg=h.msg;a.fbmsg=h.fbmsg;a.print_telemetry=h.print_telemetry;a.plot_telemetry=h.plot_telemetry;a.fbres=function(a,b){function c(){h.fbmsg("FBRES",a());setTimeout(c,b)}b||(b=16);c()};a.assert_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),f=new Float32Array([-1,0,0]),h=new Float32Array([0,
-1,0]),k=new Float32Array([0,0,-1]);if(!w.vd(a,w.Zq))throw"Wrong VEC3_IDENT";if(!w.vd(b,w.Uq))throw"Wrong QUAT4_IDENT";if(!w.vd(c,w.AXIS_X))throw"Wrong AXIS_X";if(!w.vd(d,w.AXIS_Y))throw"Wrong AXIS_Y";if(!w.vd(e,w.AXIS_Z))throw"Wrong AXIS_Z";if(!w.vd(f,w.AXIS_MX))throw"Wrong AXIS_MX";if(!w.vd(h,w.AXIS_MY))throw"Wrong AXIS_MY";if(!w.vd(k,w.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=e.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==e.yn(c)&&e.mute(c,!0)}};
a.check_finite=function(a){h.check_finite(a)};a.set_debug_params=function(a){var b=l.get_active();if(b=l.ea(b,"WIREFRAME"))"string"==typeof a.wireframe_mode&&l.aw(b,a.wireframe_mode),"object"==typeof a.wireframe_edge_color&&l.$v(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return b.Yt()};a.get_warning_quantity=function(){return b.fu()};a.clear_errors_warnings=function(){return b.clear_errors_warnings()}};b4w.module.geometry=function(a,p){function b(a){return a&&a.d&&a.d.Vc?!0:!1}var d=p("__batch"),h=p("__geometry"),c=p("__print");a.extract_vertex_array=function(a,l,e){if(!b(a))return c.error("Wrong object:",a.name),null;if(a=d.P(a,l,"MAIN")||d.P(a,l,"NODES")){if((l=a.Ya)&&l.Gb&&l.Gb[e])return h.pt(l,e);c.error("Attribute not found:"+e);return null}c.error("Wrong material:",l);return null};a.extract_index_array=function(a,h){if(!b(a))return c.error("Wrong object:",a.name),null;var e=d.P(a,h,"MAIN")||
d.P(a,h,"NODES");if(e){if((e=e.Ya)&&e.Gb)return e.Dd;c.error("Buffer data not found");return null}c.error("Wrong material:",h);return null};a.update_vertex_array=function(a,l,e,f){var p=["MAIN","NODES","DEPTH","COLOR_ID"];if(b(a))for(var n=0;n<p.length;n++){var m=d.P(a,l,p[n]);m&&(m=m.Ya)&&m.Gb&&m.Gb[e]&&h.nj(m,e,0,f)}else c.error("Wrong object:",a.name)};a.override_geometry=function(a,l,e,f,p){var n=["MAIN","NODES","DEPTH","COLOR_ID"];if(b(a))if(e instanceof Uint16Array||e instanceof Uint32Array)if(f instanceof
Float32Array)for(var m=0;m<n.length;m++){var g=d.P(a,l,n[m]);if(g){var s=g.Ya;if(s){h.Ow(s,g.wc,e);var t=0,y;for(y in s.Gb)var x=s.Gb[y],t=t+f.length/3*x.Id;s.Jc=new Float32Array(t);var t=s.Jc,q=0;for(y in s.Gb)switch(x=s.Gb[y],y){case "a_position":t.set(f,q);x.offset=q;x.length=f.length;q+=x.length;break;case "a_normal":var r;p&&(r=h.nm(e,f,f));var I=h.lm(e,f,r);t.set(I,q);x.offset=q;x.length=f.length;q+=x.length;break;case "a_tangent":x.offset=q;x.length=f.length/3*x.Id;for(var A=new Float32Array(x.length),
I=0;I<A.length;I+=4)A[I]=1,A[I+3]=1;t.set(A,q);q+=x.length;break;default:x.offset=q,x.length=f.length/3*x.Id,I=new Float32Array(x.length),t.set(I,q),q+=x.length}h.Sw(s);if(g.kb)for(I=0;I<g.kb.length;I++)(x=g.kb[I])&&x.Ya&&(x.Ya=s)}}}else c.error("Wrong positions_array type");else c.error("Wrong ibo_array type");else c.error("Wrong object:",a.name)}};b4w.module.hud=function(a,p){var b=p("__hud");p("__print");a.draw_mixer_strip=b.draw_mixer_strip;a.plot_array=b.plot_array};b4w.module.lights=function(a,p){function b(a){for(var b=c.get_active(),n=c.ha(b,"LAMP",c.DATA_ID_ALL),p=0;p<n.length;p++){var w=n[p];if("SUN"==w.Cb.type){var x=w;break}}if(!x)return d.error("There is no sun on the scene"),null;"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(n=(90-a.vert_position)/180*Math.PI,p=x.d,k.set_rotation_euler(x,[n,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),l.quat_to_dir(p.g,l.AXIS_Y,a),p=e.length(p.e),e.copy(a,f),e.scale(f,p,f),k.set_translation(x,
f),k.D(x),a=x.Cb,a.it&&(w=x.data.energy,p=b.world.light_settings.environment_energy,n=Math.cos(Math.abs(n)),w*=Math.max(Math.min(3*n,1),0),n=Math.max(n,0.1)*p,h.Xo(a,w),c.set_environment_colors(b,n,null,null)),c.oj(x,b))}var d=p("__print"),h=p("__lights"),c=p("__scenes"),k=p("__transform"),l=p("__util"),e=p("vec3"),f=new Float32Array(3),w,n=60;a.get_lamps=function(a){var b=c.get_active(),b=c.ha(b,"LAMP",c.DATA_ID_ALL);if(!a)return b;for(var d=[],e=0;e<b.length;e++){var f=b[e];f.Cb.type===a&&d.push(f)}return d};
a.get_sun_params=function(){for(var a=c.get_active(),a=c.ha(a,"LAMP",c.DATA_ID_ALL),b=null,d=0;d<a.length;d++){var e=a[d];if("SUN"==e.Cb.type){b=e;break}}return b?(b=b.Cb.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,d={},d.hor_position=a,d.vert_position=b,d):null};a.set_sun_params=b;a.set_day_time=function(a){for(var e=c.get_active(),e=c.ha(e,"LAMP",c.DATA_ID_ALL),f=0;f<e.length;f++){var h=e[f];if("SUN"==h.Cb.type){var k=
h;break}}if(!k)return d.error("There is no sun on the scene"),null;k=-Math.cos(a/12*Math.PI)*n;e={};e.hor_position=12>a?15*a:15*(a-24);e.vert_position=k;b(e)};a.set_date=function(a){(w=a.getDate())?1582==w&&10==a.$y&&4<a.Vs&&15>a.Vs&&d.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):d.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){n=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){var b=c.get_active();if(!b)return d.error("No active scene"),
!1;for(var b=c.ha(b,"LAMP",c.DATA_ID_ALL),e=0;e<b.length;e++){var f=b[e];if(f.name===a){var h=f.Cb;break}}return h?{light_color:h.color,light_energy:h.tf}:(d.error('B4W Warning: light "'+a+'" not found'),!1)};a.set_light_params=function(a,b){var e=c.get_active();if(!e)return d.error("No active scene"),!1;for(var f=c.ha(e,"LAMP",c.DATA_ID_ALL),k=0;k<f.length;k++){var l=f[k];if(l.name===a){var n=l.Cb;break}}if(!n)return d.error('B4W Warning: light "'+a+'" not found'),!1;"number"==typeof b.light_energy&&
(h.Xo(n,b.light_energy),c.oj(l,e));"object"==typeof b.light_color&&(h.Tv(n,b.light_color),c.oj(l,e))};a.get_lights_names=function(){var a=c.get_active();if(!a)return d.error("No active scene"),!1;for(var b=[],a=c.ha(a,"LAMP",c.DATA_ID_ALL),e=0;e<a.length;e++)b.push(a[e].Cb.name);return b}};b4w.module.material=function(a,p){function b(a,b){for(var c=a.O,d=0;d<c.length;d++){var e=c[d];if(-1<e.ic.indexOf(b))return"MAIN"==e.type}return!1}function d(a,b){var d=c.P(a,b,"MAIN");return Boolean(d&&d.cc[0])}function h(a,b){var d=c.P(a,b,"MAIN");return Boolean(d&&d.cc[1])}var c=p("__batch"),k=p("__config"),l=p("__print"),e=p("__shaders"),f=p("__util");p("vec4");var w=k.q,n="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.max_bones=function(){l.error("max_bones() deprecated, return default value");
return w.max_bones};a.set_max_bones=function(){l.error("set_max_bones() deprecated")};a.set_batch_param=function(){l.error("set_batch_param() deprecated")};a.inherit_material=function(a,b,d,e){if(f.Sn(d)&&f.Sn(a)){for(var h=["MAIN","DEPTH","COLOR_ID"],k=!1,p=0;p<h.length;p++){var r=h[p],w=c.P(a,b,r),A=c.P(d,e,r);if(w&&A)for(k=!0,"MAIN"==r&&(A.Sa.set(w.Sa),A.te=w.te,A.md.set(w.md),A.cc.set(w.cc),A.zd=w.zd,A.rc=w.rc,A.rc=w.rc,A.se=w.se,A.ge=w.ge),r=0;r<A.Rb.length;r++){var G=A.Rb[r];if(-1!==n.indexOf(G)){var Q=
w.Rb.indexOf(G);if(-1!==Q&&(A.Aa[r]=w.Aa[Q],A.kb))for(r=0;r<A.kb.length;r++){var u=A.kb[r],z=u.Rb.indexOf(G);-1!==z&&(u.Aa[z]=w.Aa[Q])}}}}k||l.error("Wrong objects for inheriting material!")}else l.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++)b.push(a[c].name);return b};a.set_diffuse_color=function(a,b,d){(a=c.P(a,b,"MAIN"))?a.Sa.set(d):l.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,
b){var d=c.P(a,b,"MAIN");if(d){var e=Array(4);e[0]=d.Sa[0];e[1]=d.Sa[1];e[2]=d.Sa[2];e[3]=d.Sa[3];return e}l.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,d){(a=c.P(a,b,"MAIN"))?a.te=d:l.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_intensity=function(a,b){var d=c.P(a,b,"MAIN");if(d)return d.te;l.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,d){(a=c.P(a,b,"MAIN"))?a.md.set(d):l.error('Couldn\'t set property "specular_color"!')};
a.get_specular_color=function(a,b){var d=c.P(a,b,"MAIN");if(d){var e=Array(3);e[0]=d.md[0];e[1]=d.md[1];e[2]=d.md[2];return e}l.error('Couldn\'t get property "specular_color"!')};a.set_specular_intensity=function(a,b,e){d(a,b)||l.error('Property "specular_intensity" is missing!');c.P(a,b,"MAIN").cc[0]=e};a.get_specular_intensity=function(a,b){d(a,b)||l.error('Property "specular_intensity" is missing!');return c.P(a,b,"MAIN").cc[0]};a.check_specular_intensity=d;a.set_specular_hardness=function(a,b,
d){h(a,b)||l.error('Property "specular_hardness" is missing!');c.P(a,b,"MAIN").cc[1]=d};a.get_specular_hardness=function(a,b){h(a,b)||l.error('Property "specular_hardness" is missing!');return c.P(a,b,"MAIN").cc[1]};a.check_specular_hardness=h;a.set_emit_factor=function(a,b,d){(a=c.P(a,b,"MAIN"))?a.zd=d:l.error('Couldn\'t set property "emit_factor"!')};a.get_emit_factor=function(a,b){var d=c.P(a,b,"MAIN");if(d)return d.zd;l.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,
b,d){(a=c.P(a,b,"MAIN"))?a.rc=d:l.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var d=c.P(a,b,"MAIN");if(d)return d.rc;l.error('Couldn\'t get property "ambient_factor"!')};a.set_diffuse_color_factor=function(a,b,d){(a=c.P(a,b,"MAIN"))?a.se=d:l.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var d=c.P(a,b,"MAIN");if(d)return d.se;l.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,
b){var d=c.P(a,b,"MAIN");d?d.ge=alpha_factor:l.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var d=c.P(a,b,"MAIN");if(d)return d.ge;l.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,d){if(!a||!d)return l.error("B4W Error: missing arguments in get_material_params"),null;if(!b(a,d))return null;var e=c.P(a,d,"MAIN");if(!e)return null;var f={};"MAIN"==e.type&&(f.ph=e.ph,f.qy=e.Yc[2],f.ry=5*(1-e.Yc[3]),f.fh=e.fh,f.kz=c.Ua(e,
"PARALLAX_STEPS")[1]);return f};a.get_water_material_params=function(a,d){if(!a||!d)return l.error("B4W Error: missing arguments in get_water_material_params"),null;if(!b(a,d))return null;var e=c.P(a,d,"MAIN");if(!e||!e.Xd)return null;if(!e)return l.warn("B4W Warning: material not found"),null;var f={};if("MAIN"==e.type){if(w.Vf){var h=f.shallow_water_col=Array(3);h[0]=e.shallow_water_col[0];h[1]=e.shallow_water_col[1];h[2]=e.shallow_water_col[2];h=f.shore_water_col=Array(3);h[0]=e.shore_water_col[0];
h[1]=e.shore_water_col[1];h[2]=e.shore_water_col[2];f.shallow_water_col_fac=e.shallow_water_col_fac;f.shore_water_col_fac=e.shore_water_col_fac}f.foam_factor=e.foam_factor;f.absorb_factor=c.Ua(e,"ABSORB")[1];f.sss_strength=c.Ua(e,"SSS_STRENGTH")[1];f.sss_width=c.Ua(e,"SSS_WIDTH")[1];f.dst_noise_scale0=c.Ua(e,"DST_NOISE_SCALE_0")[1];f.dst_noise_scale1=c.Ua(e,"DST_NOISE_SCALE_1")[1];f.dst_noise_freq0=c.Ua(e,"DST_NOISE_FREQ_0")[1];f.dst_noise_freq1=c.Ua(e,"DST_NOISE_FREQ_1")[1];f.dir_min_shore_fac=c.Ua(e,
"DIR_MIN_SHR_FAC")[1];f.dir_freq=c.Ua(e,"DIR_FREQ")[1];f.dir_noise_scale=c.Ua(e,"DIR_NOISE_SCALE")[1];f.dir_noise_freq=c.Ua(e,"DIR_NOISE_FREQ")[1];f.dir_min_noise_fac=c.Ua(e,"DIR_MIN_NOISE_FAC")[1];f.dst_min_fac=c.Ua(e,"DST_MIN_FAC")[1];f.waves_hor_fac=c.Ua(e,"WAVES_HOR_FAC")[1]}return f};a.set_material_extended_params=function(a,d,f){if(a&&d&&f){if(!b(a,d))return l.warn("B4W Warning: setting material params is not possible"),null;d=c.P(a,d,"MAIN");d?"MAIN"==d.type&&("number"==typeof f.material_reflectivity&&
a.d.ac&&(d.ph=f.material_reflectivity),"number"==typeof f.material_fresnel&&(d.Yc[2]=f.material_fresnel),"number"==typeof f.material_fresnel_factor&&(d.Yc[3]=1-f.material_fresnel_factor/5),"number"==typeof f.material_parallax_scale&&(d.fh=f.material_parallax_scale),"number"==typeof f.material_parallax_steps&&(a=e.s(parseFloat(f.material_parallax_steps)),c.ba(d,"PARALLAX_STEPS",a),c.Bb(d,!0))):l.warn("B4W Warning: material not found")}else l.error("B4W Error: missing arguments in set_material_params")};
a.set_water_material_params=function(a,d,f){if(!a||!d||!f)return l.error("B4W Error: missing arguments in set_water_material_params"),null;if(!b(a,d))return l.warn("B4W Warning: setting water material params is not possible"),null;a=c.P(a,d,"MAIN");if(!a)return l.warn("B4W Warning: material not found"),null;"MAIN"==a.type&&(w.Vf&&("object"==typeof f.shallow_water_col&&a.shallow_water_col.set(f.shallow_water_col),"number"==typeof f.shallow_water_col_fac&&(a.shallow_water_col_fac=f.shallow_water_col_fac),
"object"==typeof f.shore_water_col&&a.shore_water_col.set(f.shore_water_col),"number"==typeof f.shore_water_col_fac&&(a.shore_water_col_fac=f.shore_water_col_fac)),w.shore_smoothing&&a.yl&&("boolean"==typeof f.shore_smoothing&&(f.shore_smoothing?c.ba(a,"SHORE_SMOOTHING",1):c.ba(a,"SHORE_SMOOTHING",0)),"number"==typeof f.absorb_factor&&(d=e.s(parseFloat(f.absorb_factor)),c.ba(a,"ABSORB",d))),"number"==typeof f.foam_factor&&w.vf&&(a.foam_factor=f.foam_factor),w.water_dynamic&&a.water_dynamic&&("boolean"==
typeof f.water_dynamic&&(f.water_dynamic?c.ba(a,"DYNAMIC",1):c.ba(a,"DYNAMIC",0)),"number"==typeof f.waves_height&&(d=e.s(parseFloat(f.waves_height)),c.ba(a,"WAVES_HEIGHT",d)),"number"==typeof f.waves_length&&(d=e.s(parseFloat(f.waves_length)),c.ba(a,"WAVES_LENGTH",d)),"number"==typeof f.sss_strength&&(d=e.s(parseFloat(f.sss_strength)),c.ba(a,"SSS_STRENGTH",d)),"number"==typeof f.sss_width&&(d=e.s(parseFloat(f.sss_width)),c.ba(a,"SSS_WIDTH",d)),"number"==typeof f.dst_noise_scale0&&(d=e.s(parseFloat(f.dst_noise_scale0)),
c.ba(a,"DST_NOISE_SCALE_0",d)),"number"==typeof f.dst_noise_scale1&&(d=e.s(parseFloat(f.dst_noise_scale1)),c.ba(a,"DST_NOISE_SCALE_1",d)),"number"==typeof f.dst_noise_freq0&&(d=e.s(parseFloat(f.dst_noise_freq0)),c.ba(a,"DST_NOISE_FREQ_0",d)),"number"==typeof f.dst_noise_freq1&&(d=e.s(parseFloat(f.dst_noise_freq1)),c.ba(a,"DST_NOISE_FREQ_1",d)),"number"==typeof f.dir_min_shore_fac&&(d=e.s(parseFloat(f.dir_min_shore_fac)),c.ba(a,"DIR_MIN_SHR_FAC",d)),"number"==typeof f.dir_freq&&(d=e.s(parseFloat(f.dir_freq)),
c.ba(a,"DIR_FREQ",d)),"number"==typeof f.dir_noise_scale&&(d=e.s(parseFloat(f.dir_noise_scale)),c.ba(a,"DIR_NOISE_SCALE",d)),"number"==typeof f.dir_noise_freq&&(d=e.s(parseFloat(f.dir_noise_freq)),c.ba(a,"DIR_NOISE_FREQ",d)),"number"==typeof f.dir_min_noise_fac&&(d=e.s(parseFloat(f.dir_min_noise_fac)),c.ba(a,"DIR_MIN_NOISE_FAC",d)),"number"==typeof f.dst_min_fac&&(d=e.s(parseFloat(f.dst_min_fac)),c.ba(a,"DST_MIN_FAC",d)),"number"==typeof f.waves_hor_fac&&(f=e.s(parseFloat(f.waves_hor_fac)),c.ba(a,
"WAVES_HOR_FAC",f))),c.Bb(a,!0));return!0}};b4w.module.particles=function(a,p){var b=p("__particles"),d=p("__print");a.set_size=function(a,c,k){b.$c(a)?b.set_size(a,c,k):d.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,c,k){b.$c(a)?b.set_normal_factor(a,c,k):d.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,c,k){b.$c(a)?(k=Math.min(k,1),k=Math.max(k,0),b.set_factor(a,c,k)):d.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,p){var b=p("__print"),d=p("__physics"),h=p("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){d.has_physics(a)?d.enable_simulation(a):b.error("No physics for object "+a.name)};a.disable_simulation=function(a){d.has_physics(a)?d.disable_simulation(a):b.error("No physics for object "+a.name)};a.has_physics=function(a){return d.has_physics(a)};a.has_simulated_physics=function(a){return d.has_simulated_physics(a)};a.has_dynamic_physics=
function(a){return d.has_dynamic_physics(a)};a.set_gravity=function(a,h){d.has_physics(a)?d.set_gravity(a,h):b.error("No physics for object "+a.name)};a.set_damping=function(a,h,l){d.has_physics(a)?d.n("set_damping",a.k.B,h,l):b.error("No physics for object "+a.name)};a.reset_damping=function(a){if(d.has_physics(a)){var h=a.game;d.n("set_damping",a.k.B,h.damping,h.rotation_damping)}else b.error("No physics for object "+a.name)};a.set_transform=function(a,h,l){d.has_physics(a)?d.set_transform.apply(this,
arguments):b.error("No physics for object "+a.name)};a.sync_transform=function(a){d.has_physics(a)?d.sync_transform(a):b.error("No physics for object "+a.name)};a.apply_velocity=function(a){d.has_physics(a)?d.apply_velocity.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){d.has_physics(a)?d.apply_velocity_world.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_force=function(a,h,l,e){d.has_physics(a)?d.apply_force.apply(this,
arguments):b.error("No physics for object "+a.name)};a.apply_torque=function(a,h,l,e){d.has_physics(a)?d.apply_torque.apply(this,arguments):b.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,k){d.has_physics(a)?(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a)||b.error("Wrong object"),d.vehicle_throttle(a,h.clamp(k,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_throttle_inc=function(a,k,l){if(d.has_physics(a)){d.is_vehicle_chassis(a)||d.is_vehicle_hull(a)||b.error("Wrong object");
k=h.clamp(k,0,1);var e=a.f.uf;-1==l||1==l?e=Math.max(-1,Math.min(e+l*k,1)):0==l&&0<=e?(e-=k,e=Math.max(0,e)):0==l&&0>e?(e+=k,e=Math.min(0,e)):b.error("Wrong steering direction");d.vehicle_throttle(a,h.clamp(e,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_steer=function(a,k){d.has_physics(a)?(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a)||b.error("Wrong object"),d.vehicle_steer(a,h.clamp(k,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,k,l){if(d.has_physics(a)){d.is_vehicle_chassis(a)||
d.is_vehicle_hull(a)||b.error("Wrong object");k=h.clamp(k,0,1);var e=a.f.gg;-1==l||1==l?e=Math.max(-1,Math.min(e+l*k,1)):0==l&&0<=e?(e-=k,e=Math.max(0,e)):0==l&&0>e?(e+=k,e=Math.min(0,e)):b.error("Wrong steering direction");d.vehicle_steer(a,h.clamp(e,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_brake=function(a,k){d.has_physics(a)?(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a)||b.error("Wrong object"),d.vehicle_brake(a,h.clamp(k,0,1))):b.error("No physics for object "+a.name)};
a.vehicle_brake_inc=function(a,k){if(d.has_physics(a)){d.is_vehicle_chassis(a)||d.is_vehicle_hull(a)||b.error("Wrong object");k=h.clamp(k,-1,1);var l=a.f.Cg;d.vehicle_brake(a,h.clamp(l+l*k,0,1))}else b.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return d.is_vehicle_chassis(a)};a.is_vehicle_hull=function(a){return d.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!d.has_physics(a))return b.error("No physics for object "+a.name),null;if(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a))return a.b4w_vehicle_settings.name;
b.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!d.has_physics(a))return b.error("No physics for object "+a.name),null;if(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a))return a.f.uf;b.error("Wrong object")};a.get_vehicle_steering=function(a){if(!d.has_physics(a))return b.error("No physics for object "+a.name),null;if(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a))return a.f.gg;b.error("Wrong object")};a.get_vehicle_brake=function(a){if(!d.has_physics(a))return b.error("No physics for object "+
a.name),null;if(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a))return a.f.Cg;b.error("Wrong object")};a.get_vehicle_speed=function(a){if(!d.has_physics(a))return b.error("No physics for object "+a.name),null;if(d.is_vehicle_chassis(a)||d.is_vehicle_hull(a))return d.get_vehicle_speed(a);b.error("Wrong object")};a.is_character=function(a){return d.is_character(a)};a.set_character_move_dir=function(a,h,l){d.has_physics(a)?d.set_character_move_dir(a,h,l):b.error("No physics for object "+a.name)};a.set_character_move_type=
function(a,h){d.has_physics(a)?d.set_character_move_type(a,h):b.error("No physics for object "+a.name)};a.set_character_dist_to_water=function(){b.warn("Function set_character_dist_to_water() is deprecated")};a.set_character_walk_velocity=function(a,h){d.has_physics(a)?d.set_character_walk_velocity(a,h):b.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,h){d.has_physics(a)?d.set_character_run_velocity(a,h):b.error("No physics for object "+a.name)};a.set_character_fly_velocity=
function(a,h){d.has_physics(a)?d.set_character_fly_velocity(a,h):b.error("No physics for object "+a.name)};a.character_jump=function(a){d.has_physics(a)?d.character_jump(a):b.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,h,l){d.has_physics(a)?d.character_rotation_inc(a,h,l):b.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,h){d.has_physics(a)?d.set_character_rotation_quat(a,h):b.error("No physics for object "+a.name)};a.set_character_rotation=
function(a,h,l){d.has_physics(a)?d.set_character_rotation(a,h,l):b.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,h){d.has_physics(a)?d.set_character_rotation_v(a,h):b.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,h){d.has_physics(a)?d.set_character_rotation_h(a,h):b.error("No physics for object "+a.name)};a.append_collision_test=function(a,h,l,e){d.has_physics(a)?d.append_collision_test(a,h,l,e):b.error("No physics for object "+a.name)};
a.remove_collision_test=function(a,h){d.has_physics(a)?d.remove_collision_test(a,h):b.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,h){d.has_physics(a)?d.apply_collision_impulse_test(a,h):b.error("No physics for object "+a.name)};a.clear_collision_impulse_test=function(a){d.has_physics(a)?d.clear_collision_impulse_test(a):b.error("No physics for object "+a.name)};a.append_ray_test=function(a,h,l,e,f,p){d.has_physics(a)?d.append_ray_test(a,h,l,e,f,p):b.error("No physics for object "+
a.name)};a.remove_ray_test=function(a,h,l,e,f){d.has_physics(a)?d.remove_ray_test(a,h,l,e,f):b.error("No physics for object "+a.name)};a.apply_constraint=function(a,h,l,e,f,p,n,m,g,s){d.has_physics(h)&&d.has_physics(f)?d.apply_constraint(a,h,l,e,f,p,n,m,g,s):b.error("Wrong objects")};a.clear_constraint=function(a){d.has_physics(a)&&d.ou(a)?d.clear_constraint(a):b.error("Wrong object")};a.pull_to_constraint_pivot=function(a,h,l,e,f,p){d.has_physics(a)&&d.has_physics(e)?d.pull_to_constraint_pivot(a,
h,l,e,f,p):b.error("Wrong objects")}};b4w.module.scenes=function(a,p){var b=p("__batch"),d=p("__print"),h=p("__physics"),c=p("__scenes"),k=p("__util");a.DATA_ID_ALL=c.DATA_ID_ALL;var l=["MAIN_OPAQUE","MAIN_BLEND","MAIN_REFLECT","GOD_RAYS","SKY"];a.set_active=function(a){var b=c.ui();c.set_active(k.keysearch("name",a,b))};a.get_active=function(){return c.Y()?c.get_active().name:""};a.get_scenes=function(){for(var a=c.ui(),b=[],d=0;d<a.length;d++)b.push(a[d].name);return b};a.get_screen_scenes=function(){d.log("get_screen_scenes() deprecated");
return""};a.get_active_camera=function(){if(c.Y())return c.get_active().camera;d.error("No active scene");return!1};a.get_object_by_name=function(a,b){return c.pk(c.Il,a,b)};a.get_object_by_dupli_name=function(a,b,d){return c.pk(c.Gl,a,b,d)};a.get_object_by_dupli_name_list=function(a,b){return c.pk(c.Hl,a,b)};a.get_object_by_empty_name=function(b,c,h){d.warn("get_object_by_empty_name() deprecated, use get_object_by_dupli_name() instead");return a.get_object_by_dupli_name(b,c,h)};a.get_object_data_id=
function(a){return c.get_object_data_id(a)};a.pick_object=c.pick_object;a.set_glow_intensity=function(a,b){for(var c=0;c<a.O.length;c++){var d=a.O[c];"COLOR_ID"==d.type&&(d.xf=b)}};a.apply_glow_anim=function(a,b,d,h){a.d&&a.d.jd&&c.apply_glow_anim(a,b,d,h)};a.apply_glow_anim_def=function(a){if(a.d&&a.d.jd){var b=a.d.wi;c.apply_glow_anim(a,b.hu,b.ju,b.ku)}};a.clear_glow_anim=function(a){a.d&&a.d.jd&&c.clear_glow_anim(a)};a.set_glow_color=function(a){var b=c.get_active();if(b=c.ea(b,"GLOW"))b.Rg.set(a),
b.wa=!0};a.set_light_pos=function(){d.error("set_light_pos() deprecated, use lights module instead")};a.set_light_direction=function(){d.error("set_light_direction() deprecated, use lights module instead")};a.set_dir_light_color=function(){d.error("set_dir_light_color() deprecated, use lights module instead")};a.get_lights_names=function(){d.error("set_dir_light_color() deprecated, use lights module instead")};a.get_shadow_params=function(){if(!c.Y())return d.error("No active scene"),!1;var a=c.get_active();
if(!c.ea(a,"SHADOW_CAST"))return null;var b={},h=c.ea(a,"BLUR_DEPTH");h&&(b.blur_depth_size_mult=h.blur_depth_size_mult,b.blur_depth_edge_size=h.blur_depth_edge_size,b.blur_depth_diff_threshold=1E3*h.blur_depth_diff_threshold);if(h=c.ea(a,"DEPTH"))b.shadow_visibility_falloff=h.shadow_visibility_falloff;h=a.d.wh;b.csm_near=h.csm_near;b.csm_far=h.csm_far;b.csm_num=h.csm_num;b.csm_lambda=h.csm_lambda;b.csm_borders=c.ln(a);return b};a.set_shadow_params=function(a){if(!c.Y())return d.error("No active scene"),
!1;var f=c.get_active(),h=c.jl(f,l),k=c.ea(f,"DEPTH");k&&"number"==typeof a.shadow_visibility_falloff&&(k.shadow_visibility_falloff=a.shadow_visibility_falloff);for(var h=c.jl(f,["BLUR_DEPTH"]),m=0;m<h.length;m++){k=h[m];if("number"==typeof a.blur_depth_size_mult){k.blur_depth_size_mult=a.blur_depth_size_mult;var g=k.m,p=g[0].l;p&&(b.ld(p,a.blur_depth_size_mult),c.vh(k,1/k.i.width,1/k.i.width))}"number"==typeof a.blur_depth_edge_size&&(k.blur_depth_edge_size=a.blur_depth_edge_size);"number"==typeof a.blur_depth_diff_threshold&&
(k.blur_depth_diff_threshold=a.blur_depth_diff_threshold/1E3);k.wa=!0}k=f.d.wh;"number"==typeof a.csm_near&&(k.csm_near=a.csm_near);"number"==typeof a.csm_far&&(k.csm_far=a.csm_far);"number"==typeof a.csm_lambda&&(k.csm_lambda=a.csm_lambda);if(k=c.ea(f,"DEPTH")){g=k.m;for(m=0;m<g.length;m++)a=g[m],a.Ma.gb&&(p=a.l,b.Bj(p,c.ln(f)),b.Bb(p));k.wa=!0}c.Yk(f)};a.get_environment_colors=function(){if(!c.Y())return d.error("No active scene"),!1;var a=c.get_active();return c.get_environment_colors(a)};a.set_environment_colors=
function(a,b,h){if(!c.Y())return d.error("No active scene"),!1;var k=c.get_active();c.set_environment_colors(k,parseFloat(a),b,h)};a.get_fog_color_density=function(a){if(!c.Y())return d.error("No active scene"),!1;var b=c.get_active();return c.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(!c.Y())return d.error("No active scene"),!1;var b=c.get_active();c.set_fog_color_density(b,a)};a.get_ssao_params=function(){if(!c.Y())return d.error("No active scene"),!1;var a=c.get_active();
return c.get_ssao_params(a)};a.set_ssao_params=function(a){if(!c.Y())return d.error("No active scene"),!1;var b=c.get_active();c.set_ssao_params(b,a)};a.get_color_correction_params=function(){if(!c.Y())return d.error("No active scene"),null;var a=c.get_active(),a=c.ea(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(!c.Y())return d.error("No active scene"),
null;var b=c.get_active(),b=c.ea(b,"COMPOSITING");if(!b)return null;"number"==typeof a.brightness&&(b.brightness=a.brightness);"number"==typeof a.contrast&&(b.contrast=a.contrast);"number"==typeof a.exposure&&(b.exposure=a.exposure);"number"==typeof a.saturation&&(b.saturation=a.saturation);b.wa=!0};a.get_sky_params=function(){if(!c.Y())return d.error("No active scene"),!1;var a=c.get_active();return c.get_sky_params(a)};a.set_sky_params=function(a){if(!c.Y())return d.error("No active scene"),!1;
var b=c.get_active();c.set_sky_params(b,a)};a.get_dof_params=function(){if(!c.Y())return d.error("No active scene"),!1;var a=c.get_active();return c.ea(a,"DOF")?c.get_dof_params(a):null};a.set_dof_params=function(a){if(!c.Y())return d.error("No active scene"),!1;var b=c.get_active();c.set_dof_params(b,a)};a.get_god_rays_params=function(){if(!c.Y())return d.error("No active scene"),!1;var a=c.get_active();return c.ea(a,"GOD_RAYS")?c.get_god_rays_params(a):null};a.set_god_rays_params=function(a){if(!c.Y())return d.error("No active scene"),
!1;var b=c.get_active();c.set_god_rays_params(b,a)};a.get_bloom_params=function(){if(!c.Y())return d.error("No active scene"),!1;var a=c.get_active();return c.ea(a,"BLOOM")?c.get_bloom_params(a):null};a.set_bloom_params=function(a){if(!c.Y())return d.error("No active scene"),!1;var b=c.get_active();c.set_bloom_params(b,a)};a.get_wind_params=function(){return c.get_wind_params()};a.set_wind_params=function(a){if(!c.Y())return d.error("No active scene"),!1;var b=c.get_active();c.set_wind_params(b,a)};
a.get_water_surface_level=c.get_water_surface_level;a.set_water_params=function(a){if(!c.Y())return d.error("No active scene"),!1;var b=c.get_active();c.set_water_params(b,a)};a.get_water_mat_params=function(a){if(!c.Y())return d.error("No active scene"),!1;var b=c.get_active();c.get_water_mat_params(b,a)};a.update_scene_materials_params=function(){if(!c.Y())return d.error("No active scene"),!1;var a=c.get_active();c.Cp(a)};a.append_object=function(){throw'Method "append_object" is deprecated';};
a.add_object=function(){throw'Method "add_object" is deprecated';};a.remove_object=function(){throw'Method "remove_object" is deprecated';};a.hide_object=function(a){c.hide_object(a)};a.show_object=function(a){c.show_object(a)};a.is_visible=function(a){return a.d.is_visible};a.check_object=function(a){return c.Y()?c.check_object(a,c.get_active()):(d.error("No active scene"),!1)};a.remove_all=function(){throw"unimplemented";};a.check_collision=function(){return!1};a.check_ray_hit=function(){return!1};
a.get_all_objects=function(a,b){var d=c.get_active();a||(a="ALL");b||0===b||(b=c.DATA_ID_ALL);return c.ha(d,a,b)};a.get_appended_objs=function(b,c){d.warn("get_appended_objs() deprecated, use get_all_objects() instead");return a.get_all_objects(b,c)};a.get_object_name=function(a){return a?a.name:(d.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(d.error("Wrong object ID"),"UNDEFINED")};a.get_object_dg_parent=function(a){return a.sb};a.get_object_children=function(a){return a.qd.slice(0)};
a.get_first_character=function(){for(var a=c.ha(c.get_active(),"MESH",c.DATA_ID_ALL),b=0;b<a.length;b++){var d=a[b];if(h.is_character(d))return d}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return c.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return c.get_cam_water_depth()};a.get_type_mesh_object=function(a){return"MESH"==a.type?a.d.type:null}};b4w.module.sfx=function(a,p){var b=p("__scenes"),d=p("__sfx");a.play=function(a,b,k){d.play(a,b,k)};a.play_def=function(a){d.play_def(a)};a.is_play=function(a){return d.is_play(a)};a.speaker_play=function(a,b,k,l){d.cyclic(a,b);l&&d.playrate(a,l);d.play(a,0,k)};a.speaker_stop=function(a){d.stop(a)};a.stop=function(a){d.stop(a)};a.speaker_playback_rate=function(a,b){d.playrate(a,b)};a.playrate=function(a,b){d.playrate(a,b)};a.cyclic=function(a,b){d.cyclic(a,b)};a.is_cyclic=function(a){return d.is_cyclic(a)};
a.listener_reset_speed=function(a,b){d.listener_reset_speed(a,b)};a.speaker_reset_speed=function(a,b,k){d.speaker_reset_speed(a,b,k)};a.get_volume=function(a){return a&&"object"===typeof a?d.get_volume(a):d.Zt()};a.set_volume=function(a,b){a&&"object"===typeof a?d.set_volume(a,b):d.Uv(b)};a.mute=function(a,b){a&&"object"===typeof a?d.mute(a,b):d.Zu(b)};a.is_muted=function(a){return a&&"object"===typeof a?d.is_muted(a):d.Fu()};a.get_speaker_objects=function(){return d.get_speaker_objects().slice(0)};
a.get_speakers=function(){return a.get_speaker_objects()};a.set_compressor_params=function(a){d.set_compressor_params(b.get_active(),a)};a.get_compressor_params=function(){return d.get_compressor_params(b.get_active())};a.duck=function(a,b,k){a&&"object"===typeof a?d.duck(a,b,k):d.ht(b,k)};a.unduck=function(a){a&&"object"===typeof a?d.unduck(a):d.Lw()};a.apply_playlist=d.apply_playlist;a.clear_playlist=d.clear_playlist;a.set_positional_params=d.set_positional_params;a.get_positional_params=d.get_positional_params;
a.set_filter_params=d.set_filter_params;a.get_filter_params=d.get_filter_params;a.get_filter_freq_response=d.get_filter_freq_response};b4w.module.shaders=function(a,p){function b(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function d(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);
c.send(b);if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function h(a){for(var b=1;999>=b;b++){var c={aa:"main.glslv",$:"main.glslf",S:[["MAX_BONES",b],["SKINNED",1],["FRAMES_BLENDING",a],["WIND_BEND",0],["DETAIL_BEND",0],["DYNAMIC_GRASS",0],["VERTEX_ANIM",0],["TEXTURE_COLOR",1],["TEXTURE_SPEC",1],["TEXTURE_NORM",1],["TEXTURE_MIRROR",1],["VERTEX_COLOR",1],["WATER_EFFECTS",1],["REFLECTIVE",0],["REFLECTION_PASS",0],["SHADOW_SRC_NONE",10],["SHADOW_SRC_RGBA",20],["SHADOW_SRC_RGBA_PCF",
30],["SHADOW_SRC_DEPTH",40],["SHADOW_SRC_VSM",50],["SHADOW_SRC_MASK",60],["SHADOW_SRC","SHADOW_SRC_DEPTH"],["CSM_SECTION1",1],["CSM_SECTION2",1],["CSM_SECTION3",0],["CSM_SECTION_DIST0",2.0001],["CSM_SECTION_DIST1",4.0001],["CSM_SECTION_DIST2",7.0001],["CSM_SECTION_DIST3",9.0001],["NUM_LIGHTS",4],["DOUBLE_SIDED_LIGHTING",1],["NUM_CAUSTS",3],["TEXTURE_COORDS_UV",10],["TEXTURE_COORDS_NORMAL",20],["TEXTURE_COORDS","TEXTURE_COORDS_NORMAL"],["DISABLE_FOG",0],["ALPHA_AS_SPEC",0],["TEXTURE_STENCIL_ALPHA_MASK",
0],["PARALLAX",0],["PARALLAX_STEPS",0],["TEXTURE_BLEND_TYPE_MIX",10],["TEXTURE_BLEND_TYPE_MULTIPLY",20],["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX"],["ALPHA",1],["ALPHA_CLIP",0],["SSAO_ONLY",0]]};try{n.mk(c,null)}catch(d){return e.log("vertex uniforms limit exceeded, max bones =",b-1),b-1}e.log("shaders successfully compiled and linked")}return 999}function c(a){for(var b=w.ui(),c=0;c<b.length;c++)for(var d=w.ha(b[c],"MESH",w.DATA_ID_ALL),e=0;e<d.length;e++){var f=d[e];if(f.O)for(var h=0;h<f.O.length;h++){var k=
f.O[h];if(k.Ab==a&&k.ic.length)return k.ic}}return null}function k(a){a.sort(function(a,b){return b.ik.ALU_OPS-a.ik.ALU_OPS});for(var b=0;b<a.length;b++){var d=a[b],f=d.ik,h=d.gx,k=c(d.Us),k=k?"\t\t("+k.join(", ")+")":"\t\t(NA)";e.groupCollapsed("FRAG --\x3e","ALU",f.ALU_OPS,"TEX",f.TEX_OPS,"\t\tVERT --\x3e","ALU",h.ALU_OPS,"TEX",h.TEX_OPS,k);e.groupCollapsed("directives");for(var k=d.Fa.S,l=0;l<k.length;l++){var m=k[l];e.log(m[0],m[1])}e.groupEnd();e.groupCollapsed("vert src");e.log(d.fx);e.groupEnd();
e.groupCollapsed("vert stats");for(var n in h)"ALU_OPS"!=n&&"TEX_OPS"!=n&&e.log(n,h[n]);e.groupEnd();e.groupCollapsed("frag src");e.log(d.At);e.groupEnd();e.groupCollapsed("frag stats");for(n in f)"ALU_OPS"!=n&&"TEX_OPS"!=n&&e.log(n,f[n]);e.groupEnd();e.groupEnd()}}function l(a){function b(a){for(var c=l-1;0<=c;c--)if(a[c]+1>d[c].rg.length-1)a[c]=0;else{a[c]++;break}}function c(a){for(var b=Array(a.length),d=0;d<a.length;d++)b[d]=a[d];return b}for(var d=[],e=0;e<a.Ia.length;e++)d.push({name:a.Ia[e],
rg:[0,1]});for(e=0;e<a.za.length;e++){var f=a.za[e][0];d.push({name:f,rg:a.za[e][1]})}for(e=0;e<a.ya.length;e++){for(var f=a.ya[e][0],h=a.ya[e][1],k=0;k<h.length;k++)d.push({name:h[k],rg:[10+10*k]});d.push({name:f,rg:h})}var l=d.length;a=[];for(var m,f=1,e=0;e<d.length;e++)f*=d[e].rg.length;for(e=0;e<f;e++){if(m)m=c(m),b(m);else for(m=Array(l),k=0;k<l;k++)m[k]=0;a.push(m)}f=[];for(e=0;e<a.length;e++){m=a[e];h=[];for(k=0;k<m.length;k++){var n=d[k];h.push([n.name,n.rg[m[k]]])}f.push(h)}return f}p("__config");
var e=p("__print"),f=p("__extensions"),w=p("__scenes"),n=p("__shaders");p("__util");var m=[{aa:"depth.glslv",$:"depth.glslf",S:{Ia:"SKINNED FRAMES_BLENDING WIND_BEND DETAIL_BEND VERTEX_ANIM TEXTURE_COLOR VERTEX_COLOR DEPTH_RGBA ALPHA CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 PCF_SHADOWS VSM_SHADOWS".split(" "),za:[["MAX_BONES",[100]],["CSM_SECTION_DIST0",[2.0001]],["CSM_SECTION_DIST1",[4.0001]],["CSM_SECTION_DIST2",[7.0001]],["CSM_SECTION_DIST3",[9.0001]],["PCF_TEXEL_SIZE",[1/1024]]],ya:[["SHADOW_SOURCE",
["SHADOW_SOURCE_NONE","SHADOW_SOURCE_MAP","SHADOW_SOURCE_MASK"]]]}},{aa:"color_id.glslv",$:"color_id.glslf",S:{Ia:"SKINNED FRAMES_BLENDING WIND_BEND DETAIL_BEND VERTEX_ANIM TEXTURE_COLOR ALPHA_CLIP".split(" "),za:[["MAX_BONES",[100]]],ya:[]}},{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/anaglyph.glslf",S:{Ia:[],za:[],ya:[]}},{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/antialiasing.glslf",S:{Ia:[],za:[],ya:[["AA_METHOD",["AA_METHOD_PASS","AA_METHOD_LIGHT","AA_METHOD_QUALITY"]]]}},
{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/blur_depth.glslf",S:{Ia:[],za:[],ya:[]}},{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/compositing.glslf",S:{Ia:[],za:[],ya:[]}},{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/depth_pack.glslf",S:{Ia:["DEPTH_RGBA"],za:[],ya:[]}},{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/dof.glslf",S:{Ia:["DEPTH_RGBA"],za:[],ya:[]}},{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/edge.glslf",S:{Ia:["DEPTH_RGBA"],
za:[],ya:[]}},{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/bloom_combine.glslf",S:{Ia:[],za:[],ya:[]}},{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/luminance.glslf",S:{Ia:[],za:[],ya:[]}},{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/luminance_av.glslf",S:{Ia:[],za:[],ya:[]}},{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/luminance_trunced.glslf",S:{Ia:[],za:[],ya:[]}},{aa:"postprocessing/god_rays.glslv",$:"postprocessing/god_rays.glslf",S:{Ia:["DEPTH_RGBA",
"WATER_EFFECTS"],za:[["NUM_LIGHTS",[1,10,100]]],ya:[]}},{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/god_rays_combine.glslf",S:{Ia:[],za:[],ya:[]}},{aa:"special_skydome.glslv",$:"procedural_skydome.glslf",S:{za:[["NUM_LIGHTS",[1,10,100]]],ya:[]}},{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/motion_blur.glslf",S:{Ia:[],za:[["MAX_STEPS",[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,100]]],ya:[]}},{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/postprocessing.glslf",
S:{Ia:[],za:[],ya:[["POST_EFFECT",["POST_EFFECT_NONE","POST_EFFECT_GRAYSCALE","POST_EFFECT_X_BLUR","POST_EFFECT_Y_BLUR"]]]}},{aa:"postprocessing/postprocessing.glslv",$:"postprocessing/ssao.glslf",S:{Ia:["SSAO_WHITE"],za:[],ya:[]}}];a.determine_max_bones=function(){return{max_bones:h(1),max_bones_no_blending:h(0)}};a.report_repeatful_compilation=function(){var a=n.Xs(),b=0,c;for(c in a){var d=a[c],f=d.count;1<f&&e.log(f-1,d.cw,d.su);b+=f-1}e.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var c=
n.Ut(),h=0,l;for(l in c)a&&-1===l.indexOf(a)||h++;var h="of "+h+" analyzing...",m={};for(l in c)if(!a||-1!==l.indexOf(a)){var p=c[l],r;var w=p.Jp;r=p.fn;var A=f.nn();if(A){w=A.getTranslatedShaderSource(w);r=A.getTranslatedShaderSource(r);var A=d("/nvidia_vert",w),G=b(A),Q=d("/nvidia_frag",r),u=b(Q);r={fx:w,Dz:A,gx:G,At:r,py:Q,ik:u}}else e.error("B4W Error: WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),r=void 0;A=p.Fa;w=A.aa+" + "+A.$;r.Us=p;r.Fa=A;p=m[w]=m[w]||
[];p.push(r);e.log(h)}for(w in m)e.group("%c"+w,"color: #800"),p=m[w],k(p),e.groupEnd()};a.compile_all=function(a,b){function c(){cleanup();for(var a=z;d.length&&a--;){var b=d.shift();e.log(b.msg);n.mk(b.Fa,null)}setTimeout(c,O)}for(var d=[],f=0;f<m.length;f++){var h=m[f].aa,k=m[f].$,p=l(m[f].S),w=p.length,G="of "+w+" "+h+" + "+k,Q=a||0,u=b||w;u>w&&(u=w);for(w=Q;w<u;w++)d.push({Fa:{aa:h,$:k,S:p[w]},msg:G})}var z=100,O=50;setTimeout(c,0)}};b4w.module.transform=function(a,p){var b=p("__print"),d=p("__physics"),h=p("__transform"),c=p("__util"),k=new Float32Array(3),l=new Float32Array(4);a.SPACE_LOCAL=h.SPACE_LOCAL;a.SPACE_WORLD=h.SPACE_WORLD;a.set_translation=function(a,b,c,l){k[0]=b;k[1]=c;k[2]=l;h.set_translation(a,k);h.D(a);d.sync_transform(a)};a.set_translation_v=function(a,b){h.set_translation(a,b);h.D(a);d.sync_transform(a)};a.set_translation_rel=function(a,b,l,n,m){k[0]=b;k[1]=l;k[2]=n;c.Dh(k,1,m.d.g,m.d.e,k);h.set_translation(a,
k);h.D(a);d.sync_transform(a)};a.get_translation=function(a,b){b||(b=new Float32Array(3));h.get_translation(a,b);return b};a.set_rotation=function(a,b,c,k,m){l[0]=b;l[1]=c;l[2]=k;l[3]=m;h.set_rotation(a,l);h.D(a);d.sync_transform(a)};a.set_rotation_quat=a.set_rotation;a.set_rotation_v=function(a,b){h.set_rotation(a,b);h.D(a);d.sync_transform(a)};a.set_rotation_quat_v=a.set_rotation_v;a.get_rotation=function(a,b){b||(b=new Float32Array(4));h.get_rotation(a,b);return b};a.get_rotation_quat=a.get_rotation;
a.set_rotation_euler=function(a,b,c,l){k[0]=b;k[1]=c;k[2]=l;h.set_rotation_euler(a,k);h.D(a);d.sync_transform(a)};a.set_rotation_euler_v=function(a,b){h.set_rotation_euler(a,b);h.D(a);d.sync_transform(a)};a.set_scale=function(a,b){h.set_scale(a,b);h.D(a)};a.get_scale=function(a){return h.get_scale(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return b.error("Wrong object: "+a.name),!1;h.set_translation(a,[0,0,0]);h.set_rotation(a,[0,0,0,1]);h.set_scale(a,1);h.D(a);d.sync_transform(a)};
a.get_object_size=function(a){return c.Nb(a)?h.get_object_size(a):(b.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,d,k){return c.Nb(a)?h.get_object_center(a,d,k):(b.error("Wrong object: "+a.name),null)};a.move_local=function(a,b,c,k){h.move_local(a,b,c,k);h.D(a);d.sync_transform(a)};a.get_object_bounding_box=function(a){return h.get_object_bounding_box(a)}};b4w.module.util=function(a,p){var b=p("__print"),d=p("__util"),h=p("vec3");p("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=d.keyfind;a.keysearch=d.keysearch;a.matrix_to_quat=function(a){return d.matrix_to_quat(a)};a.euler_to_quat=function(a){return d.euler_to_quat(a)};a.quat_to_euler=function(a){return d.quat_to_euler(a)};
a.sign=d.sign;a.clamp=d.clamp;a.quat_to_dir=d.quat_to_dir;a.ground_project_quat=function(a,b){return d.quat_project(a,d.AXIS_MY,d.AXIS_Y,d.AXIS_MZ,b)};a.cam_quat_to_mesh_quat=function(a,b){return d.cam_quat_to_mesh_quat(a,b)};a.quat_project=function(a,k,l,e,f){return 0!=h.dot(l,e)?(b.error("Wrong in-plane direction"),null):d.quat_project(a,k,l,e,f)};a.hash_code=d.hash_code;a.smooth=d.smooth;a.smooth_v=d.smooth_v;a.is_vector=d.is_vector;a.correct_cam_quat_up=d.correct_cam_quat_up;a.quat_to_angle_axis=
d.quat_to_angle_axis;a.random_from_array=d.random_from_array;a.xz_direction=d.xz_direction;a.line_plane_intersect=d.line_plane_intersect};"object"==typeof module&&module.ak&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,p){var b=p("__version");a.version=b.version;a.type=b.type;a.date=b.date};"object"==typeof module&&module.ak&&b4w.module.version(exports);b4w.module.main=function(a,p){function b(){}function d(){}function h(){}function c(){oa=0;window.performance||(y.log("Apply performance workaround"),window.performance={});var a=Date.now();if(window.performance.now)return a-performance.now();y.log("Apply performance.now() workaround");window.performance.now=function(){return Date.now()-a};return a}function k(a,b){a.addEventListener("webglcontextlost",function(a){a.preventDefault();y.error("B4W Error: WebGL context lost");e()},!1);I.kc(b);var c=I.un();
c&&y.log("%cRENDERER INFO:","color: #00a",b.getParameter(c.UNMASKED_VENDOR_WEBGL)+", "+b.getParameter(c.UNMASKED_RENDERER_WEBGL));O.kc(b);A.kc(b);J.kc(b);H.kc(b);r.kc(b);F.$o(a.width,a.height);K.init();d=m();w()}function l(){b=function(){}}function e(){f()||(U=performance.now()/1E3,K.pause(),z.pause())}function f(){return D<U}function w(){L(w);var a=performance.now()/1E3;Z||(Z=a);var b=a-Z;b<1/da.Fd||(f()||(D>Z&&(b-=D-Math.max(U,Z)),oa+=b,r.update(),u.update(),q.update(),n(oa,b),d(b)),Z=a)}function n(a,
c){q.is_primary_loaded()&&(G.reset(),P.update(c),Q.update(a,c),K.update(a,c),g.update(c),q.is_primary_loaded()&&(z.update(a,c),q.is_primary_loaded()&&(b(c,a),q.is_primary_loaded()&&(x.update(a,c),q.is_primary_loaded()&&F.update(a,c)))))}function m(){var a=60,b=0,c=0,d=da.yt,e=da.xt;return function(f){a=N.smooth(1/f,a,f,d);b=N.smooth(0,b,f,d);c=(c+1)%e;0==c&&h(Math.round(a),Math.round(b))}}var g=p("__animation"),s=p("__compat"),t=p("__config"),y=p("__print"),x=p("__controls"),q=p("__data"),r=p("__debug"),
I=p("__extensions"),A=p("__geometry"),G=p("__hud"),Q=p("__nla"),u=p("__assets"),z=p("__physics"),O=p("__renderer"),F=p("__scenes"),K=p("__sfx"),H=p("__shaders"),J=p("__textures"),P=p("__transform"),N=p("__util"),E=p("__version"),S=t.context,da=t.q,ba=null,T=null,oa=0,Z=0,U=0,D=0,ha=["webgl","experimental-webgl"],L=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,
1E3/da.Fd)}}();a.init=function(a,b){y.Zv(da.console_verbose);var d=E.version()+" "+E.type()+" ("+E.date()+")";y.log("%cINIT B4W ENGINE","color: #00a",d);if(!window.WebGLRenderingContext)return null;d=c();ba=a;var e;e=null;for(var f=0;f<ha.length;f++){var g=ha[f];try{e=a.getContext(g,S)}catch(h){}if(e)break}if(!e)return null;k(ba,e);t.Ar();s.Sv(e);y.log("%cSET PRECISION:","color: #00a",da.precision);b?(G.init(b),T=b):(t.q.show_hud_debug_info=!1,t.Uf.Ni=!1);z.vu(d);return e};a.set_check_gl_errors=function(a){r.set_check_gl_errors(a)};
a.resize=function(a,b){ba.style.width=a+"px";ba.style.height=b+"px";T&&(T.style.width=a+"px",T.style.height=b+"px");ba.width=a;ba.height=b;T&&(T.width=a,T.height=b);G.Eh();F.$o(a,b);O.clear();n(oa,0)};a.set_fps_callback=function(a){h=a};a.clear_fps_callback=function(){h=function(){}};a.set_on_before_render_callback=function(a){b=a};a.set_render_callback=function(a){b=a};a.clear_on_before_render_callback=function(){l()};a.clear_render_callback=function(){l()};a.global_timeline=function(){return oa};
a.set_texture_quality=function(){y.error("set_texture_quality() deprecated")};a.set_shaders_dir=function(){y.error("set_shaders_dir() deprecated")};a.redraw=function(){n(oa,0)};a.pause=e;a.resume=function(){f()&&(D=performance.now()/1E3,K.resume(),z.resume())};a.is_paused=f;a.reset=function(){q.unload();T=ba=null;D=U=Z=oa=0;h=function(){};d=function(){};b=function(){}};a.canvas_data_url=function(){};a.get_canvas_elem=function(){return ba}};b4w.module.app=function(a,p){function b(){var a=m.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=m.is_paused(),m.pause()):a||m.resume()},!1)}function d(a,b){var c=String(a);b&&(c+="/"+String(b));A.innerHTML=c}function h(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function c(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div"),
k=document.createElement("div");if(d)for(var l=0;l<d.length;l++){var m=document.getElementById(d[l]);m&&m.parentNode.removeChild(m)}e.style.cssText="z-index:10;width:100%;height:100%;position:absolute;";h.style.cssText="position:absolute;bottom:0;width:100%;height:auto;";k.style.cssText="position:relative;float:right;margin:20px;width:70px;height:70px;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAABGCAYAAABxLuKEAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABgbSURBVHic7Vx5VFPX1t8JxDDJLGESQSwCFVAI4ICiURAFHNFa0epSsEKltnXGoYMVqKWvfVLLE6k+i8UBoaACQR5aLfg9BEGoBRmEMCcEqMyZ7/dHctOTSxKC2n7vW+v91lLusM+9e+/sc87eZ+9zSRiGwV8FEolkAQB2AGAEAMbIX/wYAKAfAF7I/vUjf1sxDOv+y3j9MxVDIpFIAGAPAB4AMBsArF7xkV0A8AQAqgCAhf2JzP8piiGRSC4A4AUA7vCHJbxu9ANANQA8xjCs9nU//LUqhkQizQCA9QAwfTxaMpkMEonkdb26CQAyMQxrfF0PfC2KIZFIVgCwFqRdRinMzMwooaGhFkuWLLHy8vKydHJysmhoaOAGBAQUdHZ2ClBaGo02qaioKPCNN96waGho6H78+DH73r17Xbdu3eru7e0VqmGlCgB+wjCs65VlehXFkEgkYwAIBYD5AEAm3qfRaJOOHDkyMyQkZIaDg4MZmUweQxMXF/fg6NGjz9Brp06dco6NjV1EpJVIJJLm5ube27dvN8bHx9dxOBwBkQYAJADwEABuYRj24qVle1nFyMaRXQCgR7xHp9MNY2NjZ61YsWKmjo4ORdUzRCKROCQkJLugoKAXvR4YGGiWm5u7RltbW0tVWx6PJ8zPz6+Li4t7Wl5ePqCEZAQAUl52/HkpxZBIJAYAbACClfj7+5ucPn3a29vbe5psRhrL7cgIv7a2llNeXs7+7rvvGqurq4eU0bm7uxtER0fPoNPpli4uLjQ9PT2qMjoMw7CysrKWAwcOPHrw4AHRQiQAkIFh2N0JyzgRxZBIJC0A2AwAfuh1CoVCOnPmjEdERISXsl+5vr6ek52d3XDnzh32vXv3+iY66JLJZFiyZIlpYGCg5Zo1a95wcnKiEWmEQqE4JSWlbO/evb+KxWKiUMUAkI5hmFjTd2qsGBKJNBkA3gWAN9Drfn5+xhcvXlw8Y8YMC/S6WCyWFBcXN3399ddPc3JyXqtjtnr1aouPPvpo1oIFC6ZraWkpWG1dXR1727ZtP5eWlhK7VwMAnMMwbFCTd2ikGJlSDgHAFPT6V199NSsmJsaXQqHIrQTDMCwnJ+e3o0ePVtXU1AxrwsTLwtXVVf/UqVMeq1evfhPtugKBQJSYmPiQOKgDABcAvtBEOeMqRtZ9PgSCpVy6dIn+zjvveKLX2Gx2//vvv38/IyODPd6LidDS0iJhGIa9jG+zYcMGyzNnzvhbWloqOJOpqallkZGRlQTyBgD4erxuNWb6VILNQFDK9evX56JKwTAMy8rK+tXZ2TlzokoJDw+3Li0tDRwcHNw2NDS0vbS0NDA8PNx6Is/IyMhgOzs7Z2ZlZf2KhgkRERHe6enpPgTyN2QyqYVai5HNPm/h52QyGXJycvxCQkJc8WtCoVD03nvvFZ4/f75NU0GoVCr5gw8+cHj33Xc9HBwczJXRNDc395w7d67qm2++aebz+RqbUWRk5NSzZ88GUCgUbfzazZs3f1u7dm0JwRqvqZutVCpG5qe8D4hVZWVlzV+7du0s/JzP5wt37NjBTE9P18jTNDMzoxw/ftw5PDzczdzc3ECTNj09PUM//vjjrydPnnw2jtcrx+bNm60uXLgQRKVS5T7UTz/99HTdunUPETIJAJxR5ecoVYzMo/0YEOctJibG/syZM4H4+ejoqGDr1q35mZmZnPEYdXFx0Ttx4sSsVatWuerp6U3SRDgiRkZGBDdv3qz57LPPntbW1o6MR79+/XpaWlraCl1dXfn73n///TtJSUks9LEA8KkyD1mVYrYC4qu4urrql5aWrjcwMNABAODz+aL169ffzM3N7VHHHIPBMD1y5Ij74sWLZ2hra2syno0LkUgk+fnnnxvj4+Or796926eONjg42DwzM3MVlUrVBgAYGhri+fr6ZhJmy2IMw9KIbccwKwsI5+PnWlpapOvXry/BlQIAkJCQUKxOKdu2bbOpqKhYUVRUFLZs2TKn16UUAABtbW3ysmXLnIqKisIqKipWbNu2zUYVbW5ubk9CQkIxfm5gYKBz/fr1JVpaWqhXPl8mswLGWAyJRIoGJEpOSUmZExkZ6Y2f379/v3Hx4sVjBi0qlUrev3//9IiICHd7e3ulA+qfBRaL1ZOamlqdmJjYpGyg/vnnnxn+/v4z8PPz58+X7dq1C53GqzAM+w5to6AY2XrKAfzcwcFB59mzZ5snTZqkDQDQ3d094O7unkWMav38/IwzMzODLCwsDF9ZyldAd3f3wPr165nFxcUKYwaNRptUXV29DudPIBCInJ2d05ubm3kI2Zfoeg7RxNejJ/Hx8R64UgAAdu/efVdZqF9cXPyCwWDcKigoeCaRSP66RWQE1dXV7QEBAbeJSgEA4HA4gt27d8utfNKkSdrx8fHEtSMF2eUWI5ueP8Bv2NnZ6dTX17+NT3llZWUtPj4+BeMx6OfnZ5yYmOjj6+trPxHBXhZCoVD87bfflu7fv//peF7zo0ePlnt7e08DkLoaTk5OV1pbW1Gr+QafvlGL8UIfEhcX54b6AZ9//nkF8UWZmZnzent7w/Pz8xe5u7sbAEitZ+7cuXfCwsJynj17NuHQYCJgsVg9y5Yty/zoo4+eSiQSMDMzo+Tk5Czo7e0Nv3r1qi+RHpWBSqVS4uLi3Agkf+hAZjEkADgNAOcA4JylpeXF0dFRASZDZWVlG34P/zd37tyrGAKhUCi6ceNGlZ2d3SWULjo6Or+tra0Xe42QSCSSH3/8sVJHR+c8/p4NGzbkcDicfpRuzpw56US+Kysr2/D7o6OjAktLy4vI/dMg60XS/0gkBwA4jCvr4MGDjl988cVS/Hzjxo03iTEQjUabVFNTs8HU1FQfvT46OipIT0+vPnjwYHVfX58IQDrlb9iwgTZ//nwLDw8PcxqNZtDZ2TnY0tIy0NHRMdzd3c3jcrl8GxsbXScnJ6Pp06cb+fj42E2ePFkHCBCJROLDhw/f++qrr5oAAPT09Mjff/89/a233vJAI+y+vr4hJyenDKK3vGHDBsvr16+vws8PHTpUdPr06ecISQKGYc24YtYAwAr8zp07d/wDAgJmAkhHehqNdpXIIIB0CfMf//jHfC8vLzvivYGBgdGUlJSK48eP1/J4vAmHzFQqlRwRETF13759Xng8NTo6KoiIiCjAQ5C5c+caXbt2LcDOzs4UbdvW1ta3adOmwocPH/YrezaHw9mEz1CFhYV1gYGB95Hb+RiGZeNjzGyCwLb4cVlZWTvxwfr6+loAAOXl5QN0Op0ZHR3NZLPZCkwYGhrq7t+/f0FLS8vG06dPu+JjEFF4X19fw+DgYPOwsDDam2++qY+vl/P5fMnZs2dbXFxcsr///vtyLpc7GBoaehNXysaNGy0LCwtXE5XCZDKfubm5ZeNKwXlFgcqEykrUhQUgfZDBYGSg/XTPnj1MIPTTmJiYgszMzGpra2t5/9TT0zufnJxcyuPxBJgKdHR0/F5ZWdlWWlra3N7e3icSicREGoFAILx9+/Zvenp659F3amlppeDHhw8fLhIKhSK0HY/HExw5cqQIp6FQKCk//PDD45iYmAIi/3v27GGibRkMRgaBxoIM0lyyHGvXrpVrUCwWS65cudJJ1HhFRcWLdevWudXV1W2Kj493oVAopJGREUlUVNQTZ2fnKxcvXiwfGBgYJbaztrY2nj17tq2Pj4+9jY2NCXFZEgCAQqFoBwcHu65cuVJhtRBfxz116pRzXFwcA11bbm1t7WUwGFnx8fGNANLYrqqqKmTr1q2eFRUVY/yaK1eudIrFYnn3RmWWwY4MhBTq7Nmz5QzV19dzlIX6jx496heJRGIDAwOdw4cPL2xsbFy/detWawAAFovF27FjR4WtrW16XFzcg+fPn3OxCWYieDyesLGxccyyaEREhO3hw4f90AREXl5e7axZs+RdJyoqyq60tHS9i4uLlUgkEj969GjMONPb2yusr6+XrwqgMstgpA3SSgM5TE1N5UsN7e3tyvI1IBQKsa6urv6pU6eaAgDY2dmZ/vDDDyHR0dGshISEJzk5Od2Dg4Pio0ePPjt69Ogze3t7nU2bNtnS6XRzQ0NDqq6uLoXNZg81Njb219bW9g8ODoqmTJlCNTMzo2pra5Pu37/PffLkiUJaZe7cuUZJSUkBeNJOIpFgJ06cuHfq1KlGAAAdHR3y5cuXfdatW+eOK66rq6tfKBQq/VXa29sHXFxcrIgyy2CsDQSLMTEx0cWPuVzumO6Ag8Vi/Y4rBmHePjs72/758+fctLS03/72t789HxwcFLNYLF5CQkIjALx0bvnvf/+7L5q8S0xMLMGVQqfTDa9evbrU0dFR4ZdnsVi/q3oeKhsqswxGZCBYjLGxsVx7HA5H5YJQQ0ODypc6OjpO+eSTTxZ3dnaGMxgMU1V0miIsLIzm4+Njj5/n5eXVHjp0qAYAYNGiRcYPHjxYR1TKeDyisqEy45cUFDN58mQtdMWLzWartJinT5+qfCkOAwMDHYFA8MolDVu2bHHEj0dGRgRRUVFlOL9paWnLUJ415RGVTVdXd9LkyZPRad1YYfB1dHRUMKmOjg6ViikrKxtXMQAAtbW1r5xbWrBgwTT8uLi4uAkP/C5fvjyX6MdoyiNRNoLsRgrTZX9/vwg9NzAw0AYVKCsrGxCJRGqtYWRkRIDOal5eXpM///xzZ2tra43XfRkMhqm5uflk/JzJZLYBAEydOpWKZiuIEIlEkrKyMqWTB8BY2Yiya4O0MkkHAKC5uZknFArFeGZx2rRpCnEQCj6fL2Gz2S9sbW1V/mICgUD+Ml9fX8OSkpKNWlpa5KCgIHs6nc5U1Q7FwYMH5VkJsVgsuXz5cjsAwPbt2+3IZLLSwgEAADab/UJd2gWVTSgUigmLVv1kkBb/yfH777/LTd/W1lalYgAAWCyW2voTY2NjPRcXFz0AAB8fH1PcofPy8rLTJKnGYDBM8ZgNAODRo0ctXC5XCAAQHBzs8Cq8obKhMsvwYoxiuFyu3H+wtLRUq5iGhga1q/QAAEFBQTQAgOzs7C6RSCRPix47dow+XtvExERf1CrOnTtXAwBgb2+vQ6fTxwSuE+ENlQ2VWYYXZJB2JTm6u7vl2qPRaGoV89tvv41bseTv728FANDW1sYvKSlpxq87Oztbqlvhd3V11Z8zZ85U/Ly0tJR16dKlDgCAvXv3zlAWTkyEN1Q2VGYZxnYlNpstJxovW1hWVjauxaxcudIZj6zj4uKqJMj6Y2Jiov/MmTPHVGQBSGMjoVAoAgAYHh7mv/POO8UAADY2NtTt27fPVtZmIryhsqEyyzDWYtrb2+VmZWFhYahuBiktLR1AgzFloFAo2klJST4AAHfu3OlNT09/gjJ3586dlZaWlmPeUVdXNxIeHp538eLFcj8/v8z6+voRAIDLly8vUOKQKUAsFkuU1MfIYW1tPQnNaKAyy9BPBoBW9EpOTo48mtbW1iZHR0erLE3l8/mSrq4upYtBKBYtWjQjLCyMBgAQGRlZIVsqBQBpnMVkMpcpa5eRkcHesWNHBR43ffjhhw6LFy+eoYwWRVdXV7+6GSkqKmo6mgREZZahlYxJy9DlSfmSkpIXzc3N8izjmjVr1DLS0tKikaN3+vTpBfr6+lo8Hk+ybNmywufPn3Pxex4eHrbHjh17Q1376Ohou4SEhCWavGs8nlCZmpube0pKStDhpAvDsG5ca0/Qhrm5ufJgz9XV1crV1VXlIPz48eNxk/oAAA4ODuaFhYUMLS0tUl9fnyggICAfXbPZt2+fL5VKHTOgkslkSEhIcE1KSlqO5rjUQR1PLi4uem+++aY8JYvKKsMTgD/SJ1XoneTk5OeYbBGFRCKRoqKiHEEFYmNjazgcjsr+jGLevHkO2dnZCwCkzuS1a9ee4veMjY31duzYIV8w0tLSIh08eNCxubk57NChQ37qnDkUHA5nIDY2tkbV/d27dzvii+YYhmHJycnPCSRVAH8ohgXIIFxTUzNcU1Mj717BwcEqu9Pw8LD4wIEDD/AZZDyEhIS47ty50xYA4NNPP63h8/nykGHz5s1O+PG9e/cYX3zxxVJ1sRARQqFQdODAgQfDw8Mqy8hCQkLkstTU1HQRKh/6QaoLqWJk1lGNPiA7O1tuYra2tibqGEpLS+sMDQ3N6e7u1shy9u7d6wEA0NHRwc/Ly6vDr8+ZM0fu1/T29qoMYJWhu7t7IDQ0NCctLW3MUiwKdA0JlVGGarynoH36MUqRlJTU1Nra2gcAUFVV1TEeYwUFBb2enp4/PX78uHU8Wjc3Nxt/f38TAIBffvlFbpn6+vpU3K+pqakZ10eSM/74caunp+dPxApzZXj69GknAEBra2tfUlJSE/FR+IFcMZg0Zysn5HA4AjqdnrN06dIbixcvLtSEwY6ODr6Pjw/zwoUL5dg4C70eHh5GsjYKljFv3jwTAIDy8vJxFYNhGHbhwoVyHx8fZkdHB18THpcsWVIYFBSUSafTcwgFCk0YUnZGnAUy0RMulyu8e/dun7o+S4REIoGdO3dW7Nq1K39oaIinim7KlCk6AACtra0KinF3dzcBkC64q3vP0NAQb9euXfk7d+6smEgJbH9/v6igoKAXD0YRKMiuoBhMWh+iMEO9LFJTU9sXLlyYhfpEKMzMzKgAACwWS0ExpqamVAAANpstUGV0zc3NPQsXLsxKTU0dkwx8SVRhhL1OygKxn0Ba0agSOjo6GpWOPXnyZMjNzS2noKCAWKENpqamOgBSBaBRt76+PgVAGisJBIIxqZuCgoJnbm5uOcQsgipQKBQSobSMCAlIZVbAGAEx6Saoh8TrAABubm4GnZ2dGzkcTvjJkyedNWFseHhYHBQU9ODkyZP3hUKhXAG4YgCkeW78WFdXV+7EjY6OyhUjFArFJ0+evB8UFKR2Okbx2WefzWSz2W9zudzNCxYsMFZB9hBTsvFL1S9/C6SlngrYvXu3o5WVlbGhoaHusWPHFqWlpY27poLjxIkTdWvWrMnp6ekZBAAwMjKSb7Pp7++Xj0V6enryFMno6KgAAKCnp2dwzZo1OSdOnKgDDZGWlkY/fvy4v6mpqYGJiYl+ZGSkMid1BKSyjoFSxWDSutcUIHSpvLy8DnS22bJliyeTyVxEoVA08krz8vJ6PD09syorK9sMDQ3lFtPT0yN3stANGzweT1RZWdnm6emZlZeXp7Z0FmlPYjKZi7Zs2aJQ0p+bm0t0OSQg3eildN1G5Vghm7oy0Gu5ubk9+/bt+xc6Jixfvty5pKQk0MjISKM4pq2tje/t7c3Mysqqx6/dvn1bvoBVWFgo94OuXLlS4+3tzWxra9NoKjYyMtIuKSkJXL58ubybi0Qi8b59+/6lZI9DBqZm95smu08UiqEBAN5++22r1NTU5WiVd1NTEzcmJuYXTX9ZIvBliRs3bmgUlBKxcuVK86SkpIXTp0+XJ95GRkYEERERBVeuXCGOIUqLnlG89LacpUuXmt64cWMlumiEYRiWn5//LCoqqoxQ9Penwc7OTic5Odl7xYoVzmhF1YsXL0bCwsLyioqKiI6iRttyXmkjl7u7u0F+fv5Ka2trhRF/ZGSE/91335XHxsbWqEqqvyooFAopLi7ONTo6mk7cL9nZ2flixYoVeUr2W76+jVxyQhVb/8zMzCjffvvtnLCwMHdiaXxXV9cLJpPZ+M9//rNJyUbOl8KiRYuMt2/fPj0oKGiGlZWVwg8iEokkN27cqN6zZ0+lkvKV17/1T06sYrMogLRM4+zZs/M8PT2VpjU6Ojp+Lyoqar506VLTeJsjiGAwGKbbtm2bvnTpUgcbGxulkX5FRUXre++99z///ve/lYUSf95mUYVGKrYXA0gLdz7++OP5NBpNZfk8j8cT9vX1Dff09AxxOJxhNps93N7ePgwgTYRZWlrq02g0fXNzcwNTU1N9dXu3ORzOwKeffvowOTlZWVT/12wvVmioZkO6np4e+cCBAzNWrVo13cPDw3a8HNBEIRaLJVVVVe03b95s+vLLLxtHRkaUhTB//YZ0eeNxPmEAIE1V7Nq1yz40NPSVlIQr49atW00pKSks4vcgEPzffsJA4SEafPQCQKqkt956y2batGkGNjY2+jQaTX/KlCn6ZmZm+iYmJvoA0jxyb2/vMJfLHeZwOMMdHR3DLS0tQ9euXetQowwc/xkfvRjzsAl8JoUIvL73JT+d8p/5mZQxD/3vh3XGefh/P8Wk4cv+H328638B28gWIGwyefAAAAAASUVORK5CYII=')";
f.style.cssText="position:relative;top:0;width:100%;background-color:#000;opacity:0.6;height:auto;color:#ffd42a;text-align:center;font-size:32px;padding:10px 0;font-family: Arial;";g.style.cssText="position:relative;clear:both;bottom:0;width:100%;background-color:#000;opacity:0.6;height:auto;color:#fff;text-align:center;font-size:20px;padding:10px 0;font-family: Arial;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#ffd42a;font-size:20px;width:100%;" href="'+c+'">'+c+"</a>";h.appendChild(k);h.appendChild(g);
e.appendChild(f);e.appendChild(h);document.body.appendChild(e)}p("animation");var k=p("camera"),l=p("config"),e=p("constraints"),f=p("controls"),w=p("data"),n=p("debug"),m=p("main"),g=p("physics"),s=p("print"),t=p("scenes"),y=p("transform"),x=p("util"),q=p("vec3"),r=null,I=null,A=null,G=new Float32Array(2),Q=new Float32Array(3),u=new Float32Array(3);a.init=function(a){function e(){var a;a=k;var f=y,g=x,l=document.createElement("canvas");l.style.cssText="position: absolute;left:0px; top:0px;";if(U){var p=
document.createElement("canvas");p.style.cssText="z-index: 2; position:absolute; left:0px; top:0px; pointer-events: none;"}else p=null;m.init(l,p)?(I=l,f=document.getElementById(a),f||(s.error('Warning: canvas container "'+a+'" not found, appending to body'),f=document.body),f.appendChild(l),p&&f.appendChild(p),a=f):(f&&c("Browser could not initialize WebGL","For more info visit","http://blend4web.com/troubleshooting",g),a=null);a?(r=a,m.set_check_gl_errors(n),t&&(u?A=document.getElementById(u):(A=
document.createElement("div"),A.innerHTML=0,A.style.cssText="             position:absolute;            top: 23px;            right: 20px;            font-size: 45px;            line-height: 50px;            font-weight: bold;            color: #000;            z-index: 1;        ",document.body.appendChild(A)),m.set_fps_callback(d)),G&&b(),h(I,!0)):h(I,!1)}function g(a){a.keyCode==f.KEY_P&&(m.is_paused()?m.resume():m.pause())}function h(){}a=a||{};var k=null,n=!1,p=!1,q=!1,t=!1,u=null,x=null,y=!0,
G=!0,Q=!0,Z;for(Z in a)switch(Z){case "canvas_container_id":k=a.canvas_container_id;break;case "callback":h=a.callback;break;case "do_not_use_onload":break;case "gl_debug":n=a.gl_debug;break;case "show_hud_debug_info":p=a.show_hud_debug_info;break;case "sfx_mix_mode":q=a.sfx_mix_mode;break;case "show_fps":t=a.show_fps;break;case "fps_elem_id":u=a.fps_elem_id;break;case "error_purge_elements":x=a.error_purge_elements;break;case "report_init_failure":y=a.report_init_failure;break;case "pause_invisible":G=
a.pause_invisible;break;case "key_pause_enabled":Q=a.key_pause_enabled;break;default:l.set(Z,a[Z])}Q&&document.addEventListener("keydown",g,!1);l.set("show_hud_debug_info",p);l.set("sfx_mix_mode",q);var U=p||q||null;"complete"==document.readyState?window.setTimeout(e,0):window.addEventListener("load",e,!1);window.addEventListener("unload",function(){m.pause();w.cleanup()},!1)};a.get_canvas_container=function(){return r};a.set_onclick=function(a,b){var c=h(a);c.addEventListener("mouseup",function(){b(c.value)},
!1)};a.set_onchange=function(a,b){var c=h(a);c.addEventListener("change",function(){var a=c.checked;b(void 0!=a?a:c.value)},!1)};a.set_onkeypress=function(a,b){var c=h(a);c.addEventListener("keypress",function(a){b(a.keyCode,c.value)},!1)};a.enable_camera_controls=function(a,b,c,d){function h(a,c,d,e){1==d&&r&&(d=0.005*b,a=f.get_sensor_value(a,c,0),B+="X"==e?-a*d:0,aa+="Y"==e?-a*d:0)}function l(a,c,d,e){1==d&&(a=f.get_sensor_value(a,c,1),r&&(c=0.003*b,na+="X"==e?-a*c:0,ia+="Y"==e?-a*c:0))}function m(a){return a[0]&&
(a[1]||a[2])}function n(c,d,e){if(!w||!f.get_sensor_value(c,"CAMERA_COLLISION",1)){if(1==e){e=f.get_sensor_value(c,d,0);var h=k.get_trans_speed(c);switch(d){case "FORWARD":s?Z[0]=1:y.move_local(c,0,-a*h*e,0);break;case "BACKWARD":s?Z[0]=-1:y.move_local(c,0,a*h*e,0);break;case "UP":s||y.move_local(c,0,0,-a*h*e);break;case "DOWN":s||y.move_local(c,0,0,a*h*e);break;case "LEFT":s?Z[1]=1:y.move_local(c,-a*h*e,0,0);break;case "RIGHT":s?Z[1]=-1:y.move_local(c,a*h*e,0,0);break;case "ROT_LEFT":r?k.rotate_pivot(c,
2*-b*e,0):k.rotate(c,2*b*e,0);break;case "ROT_RIGHT":r?k.rotate_pivot(c,2*b*e,0):k.rotate(c,2*-b*e,0);break;case "ROT_UP":r?k.rotate_pivot(c,0,2*-b*e):k.rotate(c,0,2*-b*e);break;case "ROT_DOWN":r?k.rotate_pivot(c,0,2*b*e):k.rotate(c,0,2*b*e)}}else switch(d){case "FORWARD":case "BACKWARD":s&&(Z[0]=0);break;case "LEFT":case "RIGHT":s&&(Z[1]=0)}s&&(g.set_character_move_dir(s,Z[0],Z[1]),k.get_angles(c,G),G[0]+=Math.PI,G[1]*=-1,g.set_character_rotation(s,G[0],G[1]))}}a||(a=1);b||(b=1);c||(c=1);var p=t.get_active_camera();
switch(k.get_move_style(p)){case k.MS_TARGET_CONTROLS:var r=!d,s=null;break;case k.MS_EYE_CONTROLS:r=!1;s=t.get_first_character();break;case k.MS_STATIC:return}d=f.create_elapsed_sensor();if(g.has_simulated_physics(p)){var w=f.create_collision_sensor(p,null,!0);f.create_sensor_manifold(p,"CAMERA_COLLISION",f.CT_CONTINUOUS,[d,w],null,function(a,b,c){1==c&&(b=f.get_sensor_payload(a,b,1),c=y.get_translation(a,Q),q.sub(c,b,u),q.normalize(u,u),q.scale(u,0.01,u),q.add(c,u,c),y.set_translation_v(a,c))})}if(s){var A=
y.get_translation(p),I=y.get_rotation(p),I=x.cam_quat_to_mesh_quat(I);A[1]-=0.5;g.set_transform(s,A,I);e.append_stiff_trans(p,s,[0,0.5,0]);var Z=new Float32Array(2),U=!0;g.set_character_move_type(s,g.CM_FLY);f.create_kb_sensor_manifold(p,"TOGGLE_CHAR_MOVE_TYPE",f.CT_SHOT,f.KEY_C,function(){U=!U;g.set_character_move_type(s,U?g.CM_FLY:g.CM_WALK)})}var A=f.create_keyboard_sensor(f.KEY_W),I=f.create_keyboard_sensor(f.KEY_S),D=f.create_keyboard_sensor(f.KEY_A),ha=f.create_keyboard_sensor(f.KEY_D),L=f.create_keyboard_sensor(f.KEY_R),
v=f.create_keyboard_sensor(f.KEY_F),M=f.create_keyboard_sensor(f.KEY_UP),fa=f.create_keyboard_sensor(f.KEY_DOWN),W=f.create_keyboard_sensor(f.KEY_LEFT),ca=f.create_keyboard_sensor(f.KEY_RIGHT);f.create_sensor_manifold(p,"FORWARD",f.CT_CONTINUOUS,[d,A],null,n);f.create_sensor_manifold(p,"BACKWARD",f.CT_CONTINUOUS,[d,I],null,n);r?(f.create_sensor_manifold(p,"ROT_UP",f.CT_CONTINUOUS,[d,M,L],m,n),f.create_sensor_manifold(p,"ROT_DOWN",f.CT_CONTINUOUS,[d,fa,v],m,n),f.create_sensor_manifold(p,"ROT_LEFT",
f.CT_CONTINUOUS,[d,W,D],m,n),f.create_sensor_manifold(p,"ROT_RIGHT",f.CT_CONTINUOUS,[d,ca,ha],m,n)):(f.create_sensor_manifold(p,"UP",f.CT_CONTINUOUS,[d,L],m,n),f.create_sensor_manifold(p,"DOWN",f.CT_CONTINUOUS,[d,v],m,n),f.create_sensor_manifold(p,"LEFT",f.CT_CONTINUOUS,[d,D],m,n),f.create_sensor_manifold(p,"RIGHT",f.CT_CONTINUOUS,[d,ha],m,n),f.create_sensor_manifold(p,"ROT_UP",f.CT_CONTINUOUS,[d,M],m,n),f.create_sensor_manifold(p,"ROT_DOWN",f.CT_CONTINUOUS,[d,fa],m,n),f.create_sensor_manifold(p,
"ROT_LEFT",f.CT_CONTINUOUS,[d,W],m,n),f.create_sensor_manifold(p,"ROT_RIGHT",f.CT_CONTINUOUS,[d,ca],m,n));var ka=0,A=f.create_mouse_wheel_sensor();f.create_sensor_manifold(p,"MOUSE_WHEEL",f.CT_LEVEL,[A],null,function(b,d,e){1==e&&(d=f.get_sensor_value(b,d,0),r?(e=k.get_eye(b),k.get_pivot(b,Q),b=q.dist(Q,e),ka+=-d*b*0.1*a):(b=d*c,d=t.get_active_camera(),k.change_trans_speed(d,b)))});var X=0,A=f.create_touch_zoom_sensor();f.create_sensor_manifold(p,"TOUCH_ZOOM",f.CT_LEVEL,[A],null,function(b,c,d){1==
d&&r&&(c=f.get_sensor_value(b,c,0),d=k.get_eye(b),k.get_pivot(b,Q),b=q.dist(Q,d),X+=-c*b*0.005*a)});f.create_sensor_manifold(p,"ZOOM_INTERPOL",f.CT_CONTINUOUS,[d],null,function(a,b,c){1==c&&(0.001<Math.abs(ka)||0.001<Math.abs(X))&&r&&(c=f.get_sensor_value(a,b,0),b=x.smooth(ka,0,c,0.1),ka-=b,c=x.smooth(X,0,c,0.15),X-=c,w&&f.get_sensor_value(a,"CAMERA_COLLISION",1)||y.move_local(a,0,b+c,0))});var na=0,ia=0,A=f.create_mouse_move_sensor("X"),I=f.create_mouse_move_sensor("Y"),D=f.create_mouse_click_sensor();
f.create_sensor_manifold(p,"MOUSE_X",f.CT_LEVEL,[D,A],null,l,"X");f.create_sensor_manifold(p,"MOUSE_Y",f.CT_LEVEL,[D,I],null,l,"Y");var B=0,aa=0,A=f.create_touch_move_sensor("X"),I=f.create_touch_move_sensor("Y");f.create_sensor_manifold(p,"TOUCH_X",f.CT_LEVEL,[A],null,h,"X");f.create_sensor_manifold(p,"TOUCH_Y",f.CT_LEVEL,[I],null,h,"Y");f.create_sensor_manifold(p,"ROT_INTERPOL",f.CT_CONTINUOUS,[d],null,function(a,b,c){if(1==c&&(0.001<Math.abs(na)||0.001<Math.abs(ia)||0.001<Math.abs(B)||0.001<Math.abs(aa))&&
r){var d=f.get_sensor_value(a,b,0);b=x.smooth(na,0,d,0.08);c=x.smooth(ia,0,d,0.08);na-=b;ia-=c;var e=x.smooth(B,0,d,0.12),d=x.smooth(aa,0,d,0.12);B-=e;aa-=d;k.rotate_pivot(a,b+e,c+d)}});f.create_kb_sensor_manifold(p,"DEC_STEREO_DIST",f.CT_SHOT,f.KEY_LEFT_SQ_BRACKET,function(a){var b=k.get_stereo_distance(a);k.set_stereo_distance(a,0.9*b)});f.create_kb_sensor_manifold(p,"INC_STEREO_DIST",f.CT_SHOT,f.KEY_RIGHT_SQ_BRACKET,function(a){var b=k.get_stereo_distance(a);k.set_stereo_distance(a,1.1*b)})};a.disable_camera_controls=
function(){for(var a=t.get_active_camera(),b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_INTERPOL".split(" "),c=0;c<b.length;c++)f.remove_sensor_manifold(a,b[c])};a.enable_object_controls=function(a){function b(a){return a[0]&&(a[1]||a[2])}function c(a,b,e){if(1==e)switch(e=f.get_sensor_value(a,b,0),b){case "FORWARD":d?g.vehicle_throttle(a,1):y.move_local(a,0,0,1*e);break;case "BACKWARD":d?g.vehicle_throttle(a,
-1):y.move_local(a,0,0,-1*e);break;case "LEFT":d?g.vehicle_steer(a,-1):y.move_local(a,1*e,0,0);break;case "RIGHT":d?g.vehicle_steer(a,1):y.move_local(a,-1*e,0,0)}else switch(b){case "FORWARD":case "BACKWARD":d&&g.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":d&&g.vehicle_steer(a,0)}}var d=g.is_vehicle_chassis(a)||g.is_vehicle_hull(a),e=f.create_elapsed_sensor(),h=f.create_keyboard_sensor(f.KEY_W),k=f.create_keyboard_sensor(f.KEY_S),l=f.create_keyboard_sensor(f.KEY_A),m=f.create_keyboard_sensor(f.KEY_D),
n=f.create_keyboard_sensor(f.KEY_UP),p=f.create_keyboard_sensor(f.KEY_DOWN),q=f.create_keyboard_sensor(f.KEY_LEFT),r=f.create_keyboard_sensor(f.KEY_RIGHT);f.create_sensor_manifold(a,"FORWARD",f.CT_CONTINUOUS,[e,h,n],b,c);f.create_sensor_manifold(a,"BACKWARD",f.CT_CONTINUOUS,[e,k,p],b,c);f.create_sensor_manifold(a,"LEFT",f.CT_CONTINUOUS,[e,l,q],b,c);f.create_sensor_manifold(a,"RIGHT",f.CT_CONTINUOUS,[e,m,r],b,c)};a.disable_object_controls=function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],
c=0;c<b.length;c++)f.remove_sensor_manifold(a,b[c])};a.enable_controls=function(a){document.addEventListener("keydown",f.keydown_cb,!1);document.addEventListener("keyup",f.keyup_cb,!1);a.addEventListener("mousewheel",f.mouse_wheel_cb,!1);a.addEventListener("DOMMouseScroll",f.mouse_wheel_cb,!1);a.addEventListener("mousedown",f.mouse_down_cb,!1);a.addEventListener("mouseup",f.mouse_up_cb,!1);a.addEventListener("mousemove",f.mouse_move_cb,!1);a.addEventListener("touchstart",f.touch_start_cb,!1);a.addEventListener("touchmove",
f.touch_move_cb,!1);document.addEventListener("touchstart",function(){})};a.disable_controls=function(a){document.removeEventListener("keydown",f.keydown_cb,!1);document.removeEventListener("keyup",f.keyup_cb,!1);a.removeEventListener("mousewheel",f.mouse_wheel_cb,!1);a.removeEventListener("DOMMouseScroll",f.mouse_wheel_cb,!1);document.body.removeEventListener("mousedown",f.mouse_down_cb,!1);document.body.removeEventListener("mouseup",f.mouse_up_cb,!1);a.removeEventListener("mousemove",f.mouse_move_cb,
!1);a.removeEventListener("touchstart",f.touch_start_cb,!1);a.removeEventListener("touchmove",f.touch_move_cb,!1)};a.enable_debug_controls=function(){var a=t.get_active_camera();f.create_kb_sensor_manifold(a,"CAMERA_SHOT",f.CT_SHOT,f.KEY_K,function(){n.make_camera_frustum_shot()});f.create_kb_sensor_manifold(a,"LIGHT_SHOT",f.CT_SHOT,f.KEY_L,function(){n.make_light_frustum_shot()});f.create_kb_sensor_manifold(a,"TELEMETRY",f.CT_SHOT,f.KEY_T,function(){n.plot_telemetry()})};a.request_fullscreen=function(a,
b,c){function d(){document.fullscreenElement===a||document.Fz===a||document.mozFullScreenElement===a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",
d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",d,!1);a.bj=a.bj||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.bj==a.webkitRequestFullScreen?a.bj(Element.ALLOW_KEYBOARD_INPUT):a.bj()};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};
a.check_fullscreen=function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.Gz?!0:!1};a.report_app_error=c;a.get_url_params=function(){var a=location.href.toString();if(-1==a.indexOf("?"))return null;for(var a=a.split("?")[1].split("&"),b={},c=0;c<a.length;c++){var d=a[c].split("=");b[d[0]]=1<d.length?d[1]:""}return b}};b4w.module.camera_anim=function(a,p){var b=p("camera"),d=p("controls"),h=p("scenes"),c=p("transform"),k=p("util"),l=new Float32Array(3),e=new Float32Array(3),f=new Float32Array(3),w=new Float32Array(4),n=p("vec3"),m=p("quat");a.track_to_target=function(a,h,p,y,x,q,r,I){if(a&&h){if(k.is_vector(h))var A=h;else A=f,c.get_object_center(h,!1,A);h=p||1;p=y||2;var G=x||1;x=q||1;e[0]=0;e[1]=-1;e[2]=0;var Q=c.get_rotation_quat(a);q=k.quat_to_dir(Q,e);y=b.get_angles(a);var u=c.get_translation(a);n.subtract(A,
u,l);n.normalize(l,l);var z=m.rotationTo(q,l,m.create());m.multiply(z,Q,w);k.correct_cam_quat_up(w,!1);n.subtract(A,u,e);var O=n.length(e)*(1-1/p),A=Math.asin(l[1]);p=Math.acos(-l[2]/Math.abs(Math.cos(A)));0<l[0]&&(p=2*Math.PI-p);var F=p-y[0],K=A-y[1];f[0]=0;f[1]=0;f[2]=-1;p=c.get_rotation_quat(a);0>k.quat_to_dir(p,f)[1]?(K=0<q[1]?A-Math.PI+y[1]:A+Math.PI+y[1],F=0<F?-Math.PI+F:Math.PI+F):Math.abs(F)>Math.PI&&(F=0<F?F-2*Math.PI:F+2*Math.PI);var K=-K,H=0,A=d.create_elapsed_sensor();q=Math.abs(F/h);
h=Math.abs(K/h);var J=q>h?q:h,P=J+G,N=P+x,E=N+G,S=F,da=K,ba=O;d.create_sensor_manifold(a,"TRACK_TO_TARGET",d.CT_CONTINUOUS,[A],null,function(a,e,f){if(f)if(f=d.get_sensor_value(a,e,0),H+=f,H<J){var g=F/J*f;f*=K/J;e=H/J;e=6*e*(1-e);g*=e;f*=e;S-=g;da-=f;b.rotate(a,g,f)}else H<P?(S&&(b.rotate(a,S,da),S=0,I&&I()),e=(H-J)/G,f=-O*f/G,ba-=g,c.move_local(a,0,6*f*e*(1-e),0)):H<N?ba&&(c.move_local(a,0,ba,0),ba=0):H<E?(e=(H-N)/G,f=O*f/G,f=6*f*e*(1-e),c.move_local(a,0,f,0)):(c.set_translation_v(a,u),d.remove_sensor_manifold(a,
e),r&&r())})}};a.auto_rotate=function(a,c){function e(c,f,h){if(1==h)switch(f=d.get_sensor_value(c,f,0),l){case b.MS_TARGET_CONTROLS:b.rotate_pivot(c,f*a,0);break;case b.MS_EYE_CONTROLS:b.rotate(c,f*a,0)}}function f(){d.remove_sensor_manifold(k,"AUTO_ROTATE");d.remove_sensor_manifold(k,"DISABLE_AUTO_ROTATE");c()}c=c||function(){};var k=h.get_active_camera(),l=b.get_move_style(k);if(l==b.MS_STATIC)throw"wrong camera type";if(d.check_sensor_manifold(k,"AUTO_ROTATE"))f();else{var m=d.create_mouse_move_sensor("X"),
n=d.create_mouse_move_sensor("Y"),p=d.create_mouse_click_sensor(),w=d.create_elapsed_sensor();d.create_sensor_manifold(k,"DISABLE_AUTO_ROTATE",d.CT_LEVEL,[m,n,p],function(a){return a[0]&&a[2]||a[1]&&a[2]},f);d.create_sensor_manifold(k,"AUTO_ROTATE",d.CT_CONTINUOUS,[w],function(a){return a[0]},e)}}};b4w.module.mixer=function(a,p){function b(){x=y.length=0;q=d();r=new Float32Array(q.length);I=new Float32Array(q.length);var a=s.get_speakers();if(a.length){y.push(h());for(var b=0;b<a.length;b++)y.push(k(a[b]));y.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function d(){for(var a=new Float32Array(100),b=0,c=0;100>c;c++)a[c]=20*Math.pow(1E3,b),b+=1/99;return a}
function h(){var a=c("MASTER");a.N.push(["VOLUME",s.get_volume(null),0,1,50,!1]);var b=s.get_compressor_params();b&&(a.N.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.N.push(["KNEE",b.knee,0,40,40,!1]),a.N.push(["RATIO",b.ratio,1,20,20,!1]),a.N.push(["ATTACK",b.attack,0,1,1E3,!1]),a.N.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=s.is_muted(null)?1:0;a.bc=-1;return a}function c(a){return{id:a,N:[],fe:0,mute:-1,bc:-1,ca:null}}function k(a){var b=c(g.get_object_name(a));b.mute=s.is_muted(a)?1:0;
b.bc=0;b.ca=a;return b}function l(a){if(a.ca){a.N.length=0;a.N.push(["VOLUME",s.get_volume(a.ca),0,1,50,!1]);var b=s.get_positional_params(a.ca);b&&(a.N.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.N.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.N.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=s.get_filter_params(a.ca))a.N.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.N.push(["EQ_Q",b.Q,0,10,100,!1]),a.N.push(["EQ_GAIN",b.gain,-70,30,100,!1]);t.clamp(a.fe,0,a.N.length-1)}}function e(a){for(var b=
0;b<y.length;b++){var c=y[b];if(c!=a&&1==c.bc)return!0}return!1}function f(a){for(var b=0;b<y.length;b++){var c=y[b];c!=a&&0==c.mute&&0==c.bc&&s.mute(c.ca,!1)}}function w(){if(0==y.length)return[0,-1];var a=8*Math.floor(x/8),b=a+7,a=t.clamp(a,0,y.length-1),b=t.clamp(b,0,y.length-1);return[a,b]}var n=p("controls");p("debug");var m=p("hud"),g=p("scenes"),s=p("sfx"),t=p("util"),y=[],x=0,q=null,r=null,I=null;a.enable_mixer_controls=function(a){function c(a,b,d){if(1==d){var e=Boolean(n.get_sensor_value(a,
b,2))?-1:1,f=y[x];if(f)switch(d=f.N[f.fe],d[1]=d[5]?d[1]*Math.pow(d[3]/d[2],e/d[4]):d[1]+(d[3]-d[2])/d[4]*e,d[1]=t.clamp(d[1],d[2],d[3]),d[0]){case "VOLUME":"MASTER"!=f.id?s.set_volume(f.ca,d[1]):s.set_volume(null,d[1]);break;case "DIST_REF":e=s.get_positional_params(f.ca);e.dist_ref=d[1];s.set_positional_params(f.ca,e);break;case "ATTENUATION":e=s.get_positional_params(f.ca);e.attenuation=d[1];s.set_positional_params(f.ca,e);break;case "DIST_MAX":e=s.get_positional_params(f.ca);e.dist_max=d[1];s.set_positional_params(f.ca,
e);break;case "EQ_FREQ":e=s.get_filter_params(f.ca);e.freq=d[1];s.set_filter_params(f.ca,e);break;case "EQ_Q":e=s.get_filter_params(f.ca);e.Q=d[1];s.set_filter_params(f.ca,e);break;case "EQ_GAIN":e=s.get_filter_params(f.ca);e.gain=d[1];s.set_filter_params(f.ca,e);break;case "THRESHOLD":f=s.get_compressor_params();f.threshold=d[1];s.set_compressor_params(f);break;case "KNEE":f=s.get_compressor_params();f.knee=d[1];s.set_compressor_params(f);break;case "RATIO":f=s.get_compressor_params();f.ratio=d[1];
s.set_compressor_params(f);break;case "ATTACK":f=s.get_compressor_params();f.attack=d[1];s.set_compressor_params(f);break;case "RELEASE":f=s.get_compressor_params();f.release=d[1];s.set_compressor_params(f);break;default:throw"Unknown strip param";}"INC_DEC"==b?n.reset_timer_sensor(a,b,6,0.3):n.reset_timer_sensor(a,b,6,0)}else n.reset_timer_sensor(a,b,6,10)}function d(a,b,c){if(1==c){c=Boolean(n.get_sensor_value(a,b,0))?-1:1;if(y.length){1==c&&x<y.length-1?x++:-1==c&&0<x&&x--;c=w();for(var e=c[0];e<=
c[1];e++)l(y[e])}"SWITCH_STRIP"==b?n.reset_timer_sensor(a,b,5,0.3):n.reset_timer_sensor(a,b,5,0)}else n.reset_timer_sensor(a,b,5,10)}b();var g=n.create_keyboard_sensor(n.KEY_LEFT_SQ_BRACKET),h=n.create_keyboard_sensor(n.KEY_RIGHT_SQ_BRACKET),k=n.create_keyboard_sensor(n.KEY_SEMI_COLON),p=n.create_keyboard_sensor(n.KEY_SINGLE_QUOTE),K=n.create_keyboard_sensor(n.KEY_SHIFT),H=n.create_timer_sensor(0.15),J=n.create_timer_sensor(0.05),g=[g,h,k,p,K,H,J];n.create_sensor_manifold(a,"SWITCH_STRIP",n.CT_TRIGGER,
g,function(a){return(a[0]||a[1])&&!a[4]},d);n.create_sensor_manifold(a,"SWITCH_STRIP_HOLD",n.CT_SHOT,g,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},d);n.create_sensor_manifold(a,"SWITCH_PARAM",n.CT_SHOT,g,function(a){return(a[0]||a[1])&&a[4]},function(a,b){var c=Boolean(n.get_sensor_value(a,b,0))?-1:1,d=y[x];d&&(1==c&&d.fe<d.N.length-1?d.fe++:-1==c&&0<d.fe&&d.fe--)});n.create_sensor_manifold(a,"INC_DEC",n.CT_TRIGGER,g,function(a){return(a[2]||a[3])&&!a[4]},c);n.create_sensor_manifold(a,"INC_DEC_HOLD",
n.CT_SHOT,g,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},c);n.create_sensor_manifold(a,"MUTE_SOLO",n.CT_SHOT,g,function(a){return(a[2]||a[3])&&a[4]},function(a,b){if(Boolean(n.get_sensor_value(a,b,2))){var c=y[x];c&&0<=c.mute&&("MASTER"!=c.id?0==c.mute?(c.mute=1,s.mute(c.ca,!0),1==c.bc&&(c.bc=0,e(c)||f(c))):(c.mute=0,e(c)||s.mute(c.ca,!1)):0==c.mute?(c.mute=1,s.mute(null,!0)):(c.mute=0,s.mute(null,!1)))}else if((c=y[x])&&0<=c.bc)if(0==c.bc){c.bc=1;s.mute(c.ca,!1);1==c.mute&&(c.mute=0);for(var d=0;d<
y.length;d++){var g=y[d];g!=c&&0==g.mute&&0==g.bc&&s.mute(g.ca,!0)}}else c.bc=0,e(c)?s.mute(c.ca,!0):f(c)});g=n.create_elapsed_sensor();n.create_sensor_manifold(a,"MIXER_DRAW",n.CT_CONTINUOUS,[g],null,function(){if(y[x])for(var a=w(),b=a[0];b<=a[1];b++){var c=y[b];m.draw_mixer_strip(c.id,b==x,b%8,c.N,c.fe,c.mute,c.bc);if(c.ca&&s.get_filter_params(c.ca)){s.get_filter_freq_response(c.ca,q,r,I);for(c=0;c<r.length;c++)r[c]=20*Math.log(r[c])/Math.LN10;m.plot_array("EQ",b%8,r,20,2E4,-10,10)}}});g=n.create_timer_sensor(1);
n.create_sensor_manifold(a,"MIXER_UPDATE",n.CT_TRIGGER,[g],null,function(){for(var a=w(),b=a[0];b<=a[1];b++)l(y[b])})}};b4w.module.npc_ai=function(a,p){function b(a,b){var c=b.destination,d=x;t.get_translation(b.empty,d);var g=q;t.get_translation(b.collider,g);var h=0;b.vg?h=b.vg:b.od&&(h=b.od,b.type==u&&(h*=0.5),b.type==O&&(h*=a));switch(b.type){case u:if(b.random&&b.Ld){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var k=G,d=r,n=b.speed,p=b.rot_speed;t.get_rotation_quat(b.collider,k);e.transformQuat(m.AXIS_Z,k,d);d[1]=0;e.normalize(d,d);k=0.5*n/Math.sin(p/2);n=e.dist(c,g);n<2*k&&e.scaleAndAdd(c,
d,2*k-n,c);b.Ld=!1}c[1]=g[1];h&&(c[1]+=h);break;case z:case O:b.random&&b.Ld&&(b.type==O?(b.speed=Math.random()+0.1,k=b.Ru-b.Xu):k=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=g[1]+(Math.random()*k-0.5*k),c[2]=10*Math.random()-5+d[2],b.Ld=!1),h&&(c[1]=g[1]+h)}var c=x,d=q,n=r,g=Q,s=b.obj,k=b.collider,h=b.destination,y=b.speed,U=b.actions,D=w.get_current_action(s);if(!w.is_play(s)||!U.Tg||-1==U.Tg.indexOf(D)){t.get_translation(k,c);var p=h[0]-c[0],ha=h[2]-c[2],p=Math.sqrt(p*p+ha*ha);
if(p>2*y*a)b.state=K,m.xz_direction(h,c,n),U=b.obj,w.is_animated(U)&&(s=b.speed,y=w.get_current_frame_float(U),U=w.get_anim_length(U),s*=U/24*(1-y/U),0.9>p/s&&e.scaleAndAdd(h,n,s-p,h)),p=G,s=I,t.get_rotation_quat(b.collider,p),e.transformQuat(m.AXIS_Z,p,d),s[0]=d[0],s[1]=0,s[2]=d[2],e.normalize(s,s),y=e.dot(s,n),U=a/(Math.abs(Math.acos(y))/Math.PI)*b.rot_speed*b.Xk,f.rotationTo(s,n,g),f.rotationTo(m.AXIS_Z,s,p),1<=Math.abs(y)?f.copy(p,g):(f.multiply(g,p,g),f.slerp(p,g,Math.min(U,1),g)),n=a,b.type!=
z&&(n=Math.max(n,1/60),p=A,s=G,f.setAxisAngle(m.AXIS_X,-Math.asin(d[1]),s),f.setAxisAngle(m.AXIS_X,-Math.atan(b.od/(b.speed*n)),p),f.slerp(s,p,n,p),f.multiply(g,p,g)),t.set_rotation_quat_v(k,g),d=r,k=I,m.quat_to_dir(g,m.AXIS_Z,d),e.scale(d,b.speed*a,k),e.add(k,c,k),k[1]=b.type!=u?(h[1]-c[1])*a*0.1+c[1]:h[1],t.set_translation_v(b.collider,k);else if(b.type==u)U.move?D&&-1!=U.move.indexOf(D)&&w.is_play(s)?b.state=K:(b.state=F,b.Ld=!0):(b.state=F,b.Ld=!0);else if(b.type==O||b.type==z)b.Ld=!0;if(l(b)&&
(c=b.obj,!w.is_play(c))){g=null;switch(b.state){case F:g=b.actions;g=g.Tg?m.random_from_array(g.Tg):null;break;case K:g=w.get_current_action(b.obj),d=h=b.actions,d.ed&&-1==d.ed.indexOf(g)&&d.move&&-1!=d.move.indexOf(g)&&0.33<Math.random()?(h=b.actions,g=h.ed[h.move.indexOf(g)]):(d=b.actions,d.move&&(-1!=d.move.indexOf(g)||!d.ed&&!d.Gd||!d.Gd&&!g||d.ed&&-1!=d.ed.indexOf(g)||d.Gd&&-1!=d.Gd.indexOf(g))?(h=b.actions,h.ed?(d=h.ed.indexOf(g),-1!=d?(g=d+1,g=g<h.move.length?g:0,g=h.move[g]):g=-1!=h.move.indexOf(g)?
g:m.random_from_array(h.move)):g=m.random_from_array(h.move)):(d=b.actions,g=d.Gd&&-1==d.Gd.indexOf(g)&&d.move&&-1==d.move.indexOf(g)?m.random_from_array(h.Gd):null))}g&&(w.apply(c,g),w.cyclic(c,!1),w.set_current_frame_float(c,0),w.play(c))}}}function d(a,b,c,d){if(d)if(1==c)switch(d.type){case z:a:{for(c=0;3>c;c++){var e=n.get_sensor_payload(a,b,c);if(e){b=e;break a}}b=void 0}a=100*b;d.od=a<d.min_height?10:a>d.max_height?-10:0;break;case u:a=n.get_sensor_payload(a,b,0);d.od=d.Ko==a?0:1-100*a;d.Ko=
a;break;case O:a=n.get_sensor_payload(a,b,0),"CLOSE_GROUND"==b?(d.od=100*a-1,d.od=0.1>d.od?0.05:0):"CLOSE_WATER"==b&&(d.vg=100*a,d.vg=d.vg<d.Xu?-0.02:d.vg>d.Ru?0.02:0)}else d.od=0}function h(){for(var a=0;a<y.length;a++){var b=y[a];c(b);k(b);b.obj&&w.get_current_action(b.obj)&&w.play(b.obj)}}function c(a){var b=[0,0,0],c=a.collider;switch(a.type){case z:var e=n.create_ray_sensor(c,b,[0,-100,0],!1,"TERRAIN"),f=n.create_ray_sensor(c,b,[0,-100,0],!1,"STONE"),b=n.create_ray_sensor(c,b,[0,-100,0],!1,"WATER"),
e=[e,f,b];n.create_sensor_manifold(c,"CLOSE_GROUND",n.CT_CONTINUOUS,e,function(a){return a[0]||a[1]||a[2]},d,a);break;case u:e=n.create_ray_sensor(c,[0,1,0],[0,-99,0],!1,"TERRAIN");e=[e];n.create_sensor_manifold(c,"CLOSE_GROUND",n.CT_CONTINUOUS,e,null,d,a);break;case O:e=n.create_ray_sensor(c,[0,1,0],[0,-99,0],!1,"TERRAIN"),b=n.create_ray_sensor(c,[0,0,0],[0,100,0],!1,"WATER"),e=[e],n.create_sensor_manifold(c,"CLOSE_WATER",n.CT_CONTINUOUS,[b],null,d,a),n.create_sensor_manifold(c,"CLOSE_GROUND",n.CT_CONTINUOUS,
e,null,d,a)}}function k(a){function b(c,d,e){1==e?(t.get_translation(a.empty,a.destination),a.Xk=4):a.Xk=1}var c=a.collider;if(a.type==u){var d=n.create_collision_sensor(c,"CONSTRUCTION",!1);n.create_sensor_manifold(c,"CONSTRUCTION_COLL",n.CT_CONTINUOUS,[d],null,b)}}function l(a){var b=a.obj;if(!w.is_play(b))return!0;b=w.get_current_action(b);if(!b)return!0;var c=a.actions;switch(a.state){case F:if(!c.Tg)return!1;if(-1==c.Tg.indexOf(b))break;break;case K:if(!c.move||-1!=c.move.indexOf(b)||c.Gd&&-1!=
c.Gd.indexOf(b)||c.ed&&-1!=c.ed.indexOf(b))return!1;break;default:return!1}return!0}var e=p("vec3"),f=p("quat"),w=p("animation"),n=p("controls"),m=p("util"),g=p("scenes"),s=p("main"),t=p("transform"),y=[];new Float32Array(9);var x=new Float32Array(3),q=new Float32Array(3),r=new Float32Array(3),I=new Float32Array(3),A=new Float32Array(4),G=new Float32Array(4),Q=new Float32Array(4),u=a.NT_WALKING=10,z=a.NT_FLYING=20,O=a.NT_SWIMMING=30,F=10,K=20;a.new_event_track=function(a){a.destination=new Float32Array(3);
a.start=[];a.ended=[];a.si=[];a.od=null;a.Ko=null;a.vg=null;a.Ld=!0;a.Xk=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.si[b]=!1;y.push(a)};a.enable_animation=function(){if(y.length){h();var a=n.create_elapsed_sensor();n.create_sensor_manifold(y[0].collider,"ELAPSED",n.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,c,d){if(1==d)for(a=n.get_sensor_value(a,c,0),c=0;c<y.length;c++){d=y[c];var e=a;if(g.is_visible(d.obj))if(d.random)b(e,d);else{for(var f=s.global_timeline(),
h=0;h<d.path.length;h++)if(!d.ended[h]){d.si[h]||(d.si[h]=!0,d.destination[0]=d.path[h][0],d.destination[1]=d.path[h][1],d.destination[2]=d.path[h][2],d.start[h]=f+d.delay[h]);if(f<d.start[h])break;b(e,d);d.ended[h]=d.Ld;break}a:{for(e=0;e<d.path.length;e++)if(!1==d.ended[e]){e=!1;break a}e=!0}if(e)for(e=0;e<d.path.length;e++)d.si[e]=!1,d.ended[e]=!1}}})}};a.disable_animation=function(){if(!(0>=y.length))for(var a=0;a<y.length;a++){var b=y[a];n.check_sensor_manifolds(b.collider)&&n.remove_sensor_manifolds(b.collider);
w.is_play(b.obj)&&w.stop(b.obj)}}};b4w.module.pointerlock=function(a,p){function b(){var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document)}function d(a){a.removeEventListener("mousedown",c,!1);a.removeEventListener("mouseup",k,!1);a.removeEventListener("mousemove",h,!1)}function h(a){A()&&(r[0]+=(a.clientX-x)*t,r[1]+=(a.clientY-q)*t,x=a.clientX,q=a.clientY);a.preventDefault()}function c(a){x=a.clientX;q=a.clientY;a.currentTarget.addEventListener("mousemove",
h,!1);a.preventDefault()}function k(a){a.currentTarget.removeEventListener("mousemove",h,!1);a.preventDefault()}function l(a,b){if(0.01<Math.abs(r[0])||0.01<Math.abs(r[1])){var c=f.get_sensor_value(a,b,0),d=g.smooth(r[0],0,c,y),h=g.smooth(r[1],0,c,y),c=m.get_first_character(),k=m.get_active_camera();e.rotate(k,-d*s,h*s);r[0]-=d;r[1]-=h;c&&(d=I,e.get_angles(k,d),d[0]+=Math.PI,d[1]*=-1,w.set_character_rotation(c,d[0],d[1]))}}var e=p("camera"),f=p("controls"),w=p("physics"),n=p("print"),m=p("scenes"),
g=p("util"),s=4E-4,t=2,y=0.1,x=0,q=0,r=new Float32Array(2),I=new Float32Array(2),A=null;a.request_pointerlock=function(a,b,c,e,g){function h(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){d(a);a.addEventListener("mousemove",e,!1);var g=m.get_active_camera();if(!f.check_sensor_manifold(g,"SMOOTH_PL")){var k=f.create_elapsed_sensor();f.create_sensor_manifold(g,"SMOOTH_PL",f.CT_CONTINUOUS,[k],null,l)}b()}else a.removeEventListener("mousemove",
e,!1),document.removeEventListener("pointerlockchange",h,!1),document.removeEventListener("webkitpointerlockchange",h,!1),document.removeEventListener("mozpointerlockchange",h,!1),c()}b=b||function(){};c=c||function(){};g=g||function(){return!0};e=e||function(a){if(g()){var b=a.movementY||a.webkitMovementY||a.mozMovementY||0;r[0]+=a.movementX||a.webkitMovementX||a.mozMovementX||0;r[1]+=b}};document.addEventListener("pointerlockchange",h,!1);document.addEventListener("webkitpointerlockchange",h,!1);
document.addEventListener("mozpointerlockchange",h,!1);var k=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof k?k.apply(a):n.error("Pointer lock is not available")};a.exit_pointerlock=b;a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,d){b();A=d||function(){return!0};a.addEventListener("mousedown",c,!1);a.addEventListener("mouseup",
k,!1);var e=m.get_active_camera();if(!f.check_sensor_manifold(e,"SMOOTH_DRAG")){var g=f.create_elapsed_sensor();f.create_sensor_manifold(e,"SMOOTH_DRAG",f.CT_CONTINUOUS,[g],null,l)}};a.exit_mouse_drag=d};b4w.module.preloader=function(a){var p,b,d,h,c,k,l,e,f=null;a.create_simple_preloader=function(a){var e=null,k=null,g="#bf9221",l="#000",t;for(t in a)switch(t){case "canvas_container_id":e=a.canvas_container_id;break;case "background_container_id":k=a.background_container_id;break;case "bg_color":l=a.bg_color;break;case "bar_color":g=a.bar_color}a=document.createElement("div");t=document.createElement("div");var y=document.createElement("div"),x=document.createElement("div"),k=document.getElementById(k);
f=document.getElementById(e);a.style.cssText="         z-index: 4;        background-color: "+l+";        width: 100%;        height: 100%;        position: absolute;        margin: 0;        padding: 0;    ";t.style.cssText="         position: absolute;        left: 50%;        top: 82%;        width: 400px;        height: 20px;        margin-left: -200px;        margin-top: -10px;        border-style:solid;        border-width:2px;        border-color: "+g+";        border-radius: 6px;    ";y.style.cssText=
"         position: absolute;        left: 0px;        top: 1px;        width: 0px;        height: 18px;        background-color: "+g+";        border-radius: 4px;    ";x.style.cssText="         position: absolute;        left: 50%;        top: 50%;        width: 100%;        height: 100%;        margin-left: -200px;        margin-top: -10px;        text-align: center;        font-size: 17px;        color: #ffffff;        font-family: Verdana;    ";t.appendChild(y);t.appendChild(x);a.appendChild(t);
document.body.appendChild(a);p="SIMPLE";b=a;d=y;h=x;c=k};a.create_rotation_preloader=function(a){var d=null,e=null,g="rgba(0,0,0,0)",l="",t="",y;for(y in a)switch(y){case "canvas_container_id":d=a.canvas_container_id;break;case "background_container_id":e=a.background_container_id;break;case "frame_bg_color":g=a.frame_bg_color;break;case "frame_class":l=a.frame_class;break;case "anim_elem_class":t=a.anim_elem_class}a=document.createElement("div");y=document.createElement("div");var x=document.createElement("div"),
q=document.createElement("div"),e=document.getElementById(e);f=document.getElementById(d);a.style.cssText="         z-index: 4;        background-color: rgba(0,0,0,0);        width: 100%;        height: 100%;        position: absolute;        margin: 0;        padding: 0;    ";y.style.cssText="         position: absolute;        left: 50%;        top: 50%;        width: 117px;        height: 117px;        margin-left: -58px;        margin-top: -58px;        background-color: "+g+";    ";x.style.cssText=
"         position: absolute;        left: 0px;        top: 0px;        width: 100%;        height: 100%;        background-position: center;        background-repeat: no-repeat;    ";q.style.cssText="         position: absolute;        width: 100%;        height: 100%;        text-align: center;        margin-top: 38px;        font-size: 36px;        color: #ffffff;        font-family: Arial;        font-weight: bold;    ";x.className=t;y.appendChild(x);y.className=l;y.appendChild(q);a.appendChild(y);
document.body.appendChild(a);p="ROTATION";b=a;k=x;h=q;c=e};a.create_advanced_preloader=function(a){var k=a.preloader_width,k=k/(k-a.img_width),m=document.getElementById(a.preloader_bar_id),g=document.getElementById(a.fill_band_id),s=document.getElementById(a.preloader_caption_id),t=document.getElementById(a.preloader_container_id),y=document.getElementById(a.background_container_id);f=document.getElementById(a.canvas_container_id);p="ADVANCED";d=m;l=g;e=k;h=s;b=t;c=y};a.update_preloader=function(a){h.innerHTML=
a+"%";"SIMPLE"==p&&(d.style.width=a+"%");"ADVANCED"==p&&(d.style.width=a/e+"%",l.style.width=100-a+"%");"ROTATION"==p&&(k.style.transform="rotate("+a+"deg)");100==a&&(b.style.zIndex=0,f.style.zIndex=1,c&&(c.style.zIndex=0))}};b4w.module.storage=function(a,p){function b(a){c=a;try{k=window.localStorage}catch(b){h.warn("Applying chrome localStorage bug workaround"),k=null}k||(h.warn("localStorage is not available, initializing temporary storage"),k={})}function d(){return k[c]?JSON.parse(k[c]):{}}var h=p("__print"),c="",k=null;a.init=b;a.set=function(a,b){var f=d();f[a]=String(b);k[c]=JSON.stringify(f)};a.cleanup=function(){delete k[c]};a.get=function(a){var b=d();return b[a]?b[a]:""};a.debug=function(){h.log(d())};b("b4w")};
