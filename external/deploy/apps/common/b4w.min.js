function jb(){return function(){}}function Rc(a){return function(){return a}}b4w={module:{},register:function(a,r){var b=b4w.module;if(b[a])throw Error('Module "'+a+'" already registered');b[a]=r},require:function(a){var r=b4w.require,b=b4w.module[a];if(!b)throw Error('Module "'+a+'" not found');b.Vj||(b.Vj={},b(b.Vj,r));return b.Vj},module_check:function(a){return b4w.module[a]?!0:!1}};"object"==typeof module&&module.Fk&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a){function r(){if("DEBUG"==b){var a=new Date,e=a.getDate(),e=10>e?"0"+String(e):String(e),l=a.getMonth()+1,l=10>l?"0"+String(l):String(l),g=String(a.getFullYear()),p=a.getHours(),p=10>p?"0"+String(p):String(p),n=a.getMinutes(),n=10>n?"0"+String(n):String(n),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return e+"."+l+"."+g+" "+p+":"+n+":"+a}return c}var b="RELEASE",c="31.03.2014 10:01:55";a.version=Rc("v14.03.28");a.type=function(){return b};a.Rn=r;a.timestamp=function(){var a=
r(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.Fk&&b4w.module.__version(exports);b4w.module.__config=function(a,r){var b=r("__extensions"),c=r("__print"),d=r("__util");a.Mm=1;a.Tj=2;a.Nm=3;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.Ct=d.$a(a.context);a.u={bk:!0,ck:0.1,jp:3,ip:1E4,tk:!1,te:!1,Vf:!1,qv:1.5,pv:10,ng:[0,0,0,0],ci:!1,pC:50,wb:1,Tf:3,xj:!1,yB:!0,ld:"DEPTH",di:!1,of:!0,Gf:!0,Ff:0.5,Zd:!0,de:!0,Md:!0,zd:!0,Qd:!0,Ed:!0,ec:!0,Ve:!1,cg:!1,Yc:!0,Ud:!0,ta:!0,Vd:!0,rc:!0,Ec:!0,md:!0,jc:53,ed:108,im:!0,precision:"highp",Vc:!0,wl:a.Tj};a.Bk=d.$a(a.u);a.lg={fb:24};
a.controls={Xs:[5,5,5,5],Ys:0.1,Fx:1/120};a.ud={vx:15,Dp:!0,nl:!1,yk:!1};a.Bs=d.$a(a.ud);a.Db={qz:"../../shaders/",rz:"include/",bq:"shader_texts",ki:"built_in_data",Ml:"../common/smaa_search_texture.png",Ll:"../common/smaa_area_texture.png"};a.mb={enabled:!0,hm:"../common/uranium.js"};a.Yx=d.$a(a.mb);a.Jf={Fe:1024,kd:2048,tf:1024};a.Pp=d.$a(a.Jf);a.Lf={DA:!0,cj:!1};a.oz=d.$a(a.Lf);a.vs=function(){var b=a.u,c=a.Bk,g=a.Jf,d=a.Pp;switch(b.wl){case a.Nm:b.ld=c.ld;b.Ec=c.Ec;b.de=c.de;b.of=c.of;b.Md=c.Md;
b.zd=c.zd;b.Gf=c.Gf;b.Ff=1;b.Zd=c.Zd;b.Yc=c.Yc;b.Ud=c.Ud;b.ta=c.ta;b.Vd=c.Vd;b.wb=2;g.Fe=2048;g.kd=4096;g.tf=2048;b.Tf=c.Tf;b.Vf=c.Vf;b.jc=c.jc;b.ed=c.ed;b.precision=c.precision;b.rc=c.rc;b.md=c.md;b.ec=c.ec;b.Ve=c.Ve;b.Ed=c.Ed;b.Qd=c.Qd;break;case a.Tj:b.ld=c.ld;b.Ec=c.Ec;b.de=c.de;b.of=c.of;b.Md=c.Md;b.zd=c.zd;b.Gf=c.Gf;b.Ff=c.Ff;b.Zd=c.Zd;b.Yc=c.Yc;b.Ud=c.Ud;b.ta=c.ta;b.Vd=c.Vd;b.wb=c.wb;g.Fe=d.Fe;g.kd=d.kd;g.tf=d.tf;b.Tf=c.Tf;b.Vf=c.Vf;b.jc=c.jc;b.ed=c.ed;b.precision=c.precision;b.rc=c.rc;b.md=
c.md;b.ec=c.ec;b.Ve=c.Ve;b.Ed=c.Ed;b.Qd=c.Qd;break;case a.Mm:b.ld="NONE",b.Ec=!1,b.de=!1,b.of=!1,b.Md=!1,b.zd=!1,b.Gf=!1,b.Ff=0.5,b.Zd=!1,b.Yc=!1,b.Ud=!1,b.ta=!1,b.Vd=!1,b.wb=c.wb,g.Fe=d.Fe/2,g.kd=d.kd/2,g.tf=d.tf/2,b.Tf=2,b.Vf=!0,b.jc=c.jc,b.ed=c.ed,b.precision="mediump",b.rc=!1,b.md=!1,b.ec=!1,b.Ve=!1,b.Ed=!1,b.Qd=!1}};a.bz=function(c){var l=a.Bk,g=a.u,p=Boolean(b.Yv());g.Yc=l.Yc=p;g.Ud=l.Ud=p;g.ta=l.ta=p;g.Vd=l.Vd=p;g.rc=l.rc=p;g.Ec=l.Ec=p;g.md=l.md=p;g.Vc=l.Vc=p;g.im=l.im=Boolean(b.yo());p=d.Za(c.getParameter(c.MAX_VERTEX_UNIFORM_VECTORS),
251,Infinity);g.jc=l.jc=d.qc((p-40)/4);g.ed=l.ed=d.qc((p-40)/2);0===c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.HIGH_FLOAT).precision&&(g.precision=l.precision="mediump")};a.set=function(b,d){switch(b){case "all_objs_selectable":a.u.ci=d;break;case "alpha":a.context.alpha=d;break;case "context_antialias":a.context.antialias=d;break;case "alpha_sort":a.u.bk=d;break;case "alpha_sort_threshold":a.u.ck=d;break;case "anaglyph_use":a.u.di=d;break;case "animation_framerate":a.lg.fb=d;break;case "antialiasing":a.u.ec=
d;break;case "assets_dds_available":a.ud.yk=d;break;case "assets_min50_available":a.ud.nl=d;break;case "background_color":a.u.ng=d;break;case "built_in_module_name":a.Db.ki=d;break;case "console_verbose":a.u.tk=d;break;case "quality":a.u.wl=d;break;case "do_not_load_resources":a.u.te=d;break;case "deferred_rendering":a.u.Vc=d;break;case "show_hud_debug_info":a.u.xj=d;break;case "sfx_mix_mode":a.Lf.cj=d;break;case "physics_enabled":a.mb.enabled=d;break;case "physics_uranium_path":a.mb.hm=d;break;case "smaa_search_texture_path":a.Db.Ml=
d;break;case "smaa_area_texture_path":a.Db.Ll=d;break;case "resolution_factor":a.u.wb=d;break;case "precision":a.u.precision=d;break;case "wireframe_debug":a.u.cg=d;break;default:c.error("B4W config set - property unknown: "+b)}};a.get=function(b){switch(b){case "all_objs_selectable":return a.u.ci;case "alpha":return a.context.alpha;case "context_antialias":return a.context.antialias;case "alpha_sort":return a.u.bk;case "alpha_sort_threshold":return a.u.ck;case "anaglyph_use":return a.u.di;case "animation_framerate":return a.lg.fb;
case "antialiasing":return a.u.ec;case "assets_dds_available":return a.ud.yk;case "assets_min50_available":return a.ud.nl;case "background_color":return a.u.ng;case "built_in_module_name":return a.Db.ki;case "console_verbose":return a.u.tk;case "quality":return a.u.wl;case "do_not_load_resources":return a.u.te;case "deferred_rendering":return defaults.Vc;case "show_hud_debug_info":return a.u.xj;case "sfx_mix_mode":return a.Lf.cj;case "physics_enabled":return a.mb.enabled;case "physics_uranium_path":return a.mb.hm;
case "smaa_search_texture_path":return a.Db.Ml;case "smaa_area_texture_path":return a.Db.Ll;case "resolution_factor":return a.u.wb;case "precision":return a.u.precision;case "wireframe_debug":return a.u.cg;default:c.error("B4W config get - property unknown: "+b)}};a.reset=function(){a.context=d.$a(a.Ct);a.u=d.$a(a.Bk);a.ud=d.$a(a.Bs);a.mb=d.$a(a.Yx);a.Jf=d.$a(a.Pp);a.Lf=d.$a(a.oz)}};b4w.module.__boundings=function(a,r){function b(a,b){for(var c=a[0],d=a[1],e=a[2],f=a[0],l=a[1],u=a[2],w=3;w<a.length;w+=3)var s=a[w],B=a[w+1],q=a[w+2],c=Math.max(c,s),d=Math.max(d,B),e=Math.max(e,q),f=Math.min(f,s),l=Math.min(l,B),u=Math.min(u,q);b.T=c;b.D=d;b.ga=e;b.R=f;b.A=l;b.ka=u;return b}var c=r("__util"),d=r("__tsr"),e=r("vec3"),l=new Float32Array(24);a.Dt=function(a,b){b.R=a.R;b.T=a.T;b.A=a.A;b.D=a.D;b.ka=a.ka;b.ga=a.ga};a.bB=function(){return{T:1E12,R:-1E12,D:1E12,A:-1E12,ga:1E12,ka:-1E12}};
a.rd=function(a){a||(a={});a.T=0;a.R=0;a.D=0;a.A=0;a.ga=0;a.ka=0;return a};a.Xn=function(a,b){var c=a.D,d=a.ga,e=a.R,f=a.A,l=a.ka;a.T=Math.max(b.T,a.T);a.D=Math.max(b.D,c);a.ga=Math.max(b.ga,d);a.R=Math.min(b.R,e);a.A=Math.min(b.A,f);a.ka=Math.min(b.ka,l)};a.Hs=b;a.ji=function(g,d,e){e||(e=a.rd());var k;(k=l)||(k=new Float32Array(24));var h=g.T,f=g.D,t=g.ga,u=g.R,w=g.A;g=g.ka;k[0]=u;k[1]=w;k[2]=g;k[3]=h;k[4]=w;k[5]=g;k[6]=h;k[7]=f;k[8]=g;k[9]=u;k[10]=f;k[11]=g;k[12]=u;k[13]=w;k[14]=t;k[15]=h;k[16]=
w;k[17]=t;k[18]=h;k[19]=f;k[20]=t;k[21]=u;k[22]=f;k[23]=t;c.Me(k,d,k);return b(k,e)};a.vz=function(b,c,d){d||(d=a.rd());var e=c.R,h=c.T,f=c.A,l=c.D,u=c.ka;c=c.ga;e>=b.T||h<=b.R||f>=b.D||l<=b.A||u>=b.ga||c<=b.ka?(d.R=-0.1,d.T=0.1,d.A=-0.1,d.D=0.1,d.ka=-0.2,d.ga=-0.1):(d.R=Math.max(b.R,e),d.T=Math.min(b.T,h),d.A=Math.max(b.A,f),d.D=Math.min(b.D,l),d.ka=Math.max(b.ka,u),d.ga=Math.min(b.ga,c))};a.NC=function(b,c,d){d||(d=a.rd());var e=b.T-b.R,h=b.D-b.A,f=b.ga-b.ka;d.R=b.R-0.5*(c-1)*e;d.T=b.T+0.5*(c-1)*
e;d.A=b.A-0.5*(c-1)*h;d.D=b.D+0.5*(c-1)*h;d.ka=b.ka-0.5*(c-1)*f;d.ga=b.ga+0.5*(c-1)*f;return d};a.pk=function(a,b,d){d||(d={F:[0,0,0],sa:0});e.transformMat4(a.F,b,d.F);d.sa=a.sa*c.Zi(b);return d};a.ok=function(b,c,n){n||(n=a.IA());d.Ej(c,b.F,n.F);e.copy(b.vd,n.vd);e.copy(b.wd,n.wd);e.copy(b.xd,n.xd);d.cm(n.vd,c,n.vd);d.cm(n.wd,c,n.wd);d.cm(n.xd,c,n.xd);return n};a.ZC=function(){return{F:[0,0,0],sa:0}};a.IA=function(){return{vd:new Float32Array(3),wd:new Float32Array(3),xd:new Float32Array(3),F:[0,
0,0]}};a.cB=function(){return{F:[0,0,0],sa:1E12}};a.cv=function(a,b){var c=e.subtract(b.F,a.F,e.create());0==e.length(c)&&e.set(1,0,0,c);var d=e.normalize(c,e.create()),c=e.scale(d,a.sa,e.create());e.add(c,a.F,c);var h=e.scale(d,-a.sa,e.create());e.add(h,a.F,h);var f=e.scale(d,b.sa,e.create());e.add(f,b.F,f);var l=e.scale(d,-b.sa,e.create());e.add(l,b.F,l);c=[c,h,f,l];d=e.normalize(d,e.create());h=c[0];f=c[0];for(l=1;l<c.length;l++){var u=e.dot(c[l],d);u<e.dot(h,d)&&(h=c[l]);u>e.dot(f,d)&&(f=c[l])}d=
[h,f];c=d[0];d=d[1];a.F=e.scale(e.add(c,d,e.create()),0.5,e.create());a.sa=e.length(e.subtract(d,c,e.create()))/2};a.Mt=function(a,b){var c=b.D,d=b.A,e=Math.max(0,c-d-2*a);return{sa:a,height:e,F:[0,(c+d)/2,0]}};a.Ot=function(a,b){var c=b.D,d=b.A,e=Math.max(0,c-d);return{sa:a,height:e,F:[0,(c+d)/2,0]}};a.Nt=function(a,b){var c=b.D,d=b.A,e=Math.max(0,c-d);return{sa:a,height:e,F:[0,(c+d)/2,0]}};a.dt=function(a,b){return a.R>b.T||a.T<b.R?!1:a.A>b.D||a.D<b.A?!1:a.ka>b.ga||a.ga<b.ka?!1:!0};a.ry=function(a){for(var b=
0,c=0,d=0,e=0,f=0,l=0,u=0,w=0,s=0;s<a.submeshes.length;s++){var B=a.submeshes[s];if(B.position.length){b=e=B.position[0];c=f=B.position[1];d=l=B.position[2];break}}for(s=0;s<a.submeshes.length;s++)for(var B=a.submeshes[s],B=B.position,q=0;q<B.length/3;q++)var y=B[3*q],D=B[3*q+1],z=B[3*q+2],b=Math.max(y,b),c=Math.max(D,c),d=Math.max(z,d),e=Math.min(y,e),f=Math.min(D,f),l=Math.min(z,l),u=Math.max(Math.sqrt(y*y+D*D+z*z),u),w=Math.max(Math.sqrt(y*y+z*z),w);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=
e;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=f;a.b4w_bounding_box.max_z=d;a.b4w_bounding_box.min_z=l;a.b4w_bounding_sphere_radius=u;a.b4w_bounding_cylinder_radius=w}};b4w.module.__constraints=function(a,r){function b(a){var m={};m.type=a;return m}function c(a,m){a.wa&&a.wa.I&&d(a.wa.I,a);if(m.I){var b=m.I;if(-1==b.td.indexOf(a))b.td.push(a);else throw"Descendant object override is forbidden";}a.wa=m}function d(a,m){var b=a.td.indexOf(m);if(-1!=b)a.td.splice(b,1);else throw"No descendant object";}function e(a,m,b){switch(m.type){case w:var c=a.d.e,d=a.d.i,e=m.I.d.G,O=m.I.d.e;b=m.I.d.i;m.$d?(t.copy(m.$d,d),t.multiply(b,d,d)):t.copy(b,d);f.transformMat4(m.offset,
e,a.d.e);a.d.scale=m.Np*m.I.d.scale;break;case M:c=a.d.e;d=a.d.i;e=m.I.d.G;b=m.I.d.i;t.multiply(t.invert(m.Ke,m.Ke),d,d);t.multiply(b,d,d);f.transformMat4(m.offset,e,c);t.copy(b,m.Ke);break;case x:c=a.d.e;d=a.d.i;e=m.I.d.G;b=m.I.d.i;t.multiply(t.invert(m.Ke,m.Ke),d,d);t.multiply(b,d,d);f.transformMat4(m.offset,e,c);t.copy(b,m.Ke);var d=a.d.i,c=m.I.d.i,O=f.transformQuat(h.hb,d,Q),e=t.invert(c,P),r=f.transformQuat(O,e,H),la=K;la[0]=r[0];la[1]=0;la[2]=r[2];var da=f.length(la),e=-la[2]/da,e=Math.acos(e)*
h.Te(la[0]),da=da/f.length(r),da=Math.acos(da)*h.Te(r[1]),r=!1;e<-m.An&&(e=-m.An,r=!0);e>m.Bn&&(e=m.Bn,r=!0);da<-m.Cn&&(da=-m.Cn,r=!0);da>m.zn&&(da=m.zn,r=!0);r&&(m=Math.sin(da),da=Math.cos(da),r=Math.sin(e),e=Math.cos(e),la=H,la[0]=da*r,la[1]=m,la[2]=-da*e,f.transformQuat(la,c,la),m=t.rotationTo(O,la,P),t.multiply(m,d,d),t.normalize(d,d));"CAMERA"==a.d.type&&(m=f.transformQuat(h.hb,b,H),p(a,m));break;case R:c=a.d.e;d=a.d.i;e=m.I.d.G;O=m.I.d.e;da=Q;a=P;f.transformMat4(m.offset,e,da);h.Kh(da,c,b,0.3,
c);m=Q;f.sub(O,c,m);f.normalize(m,m);r=d;c=F;O=c.subarray(0,3);e=c.subarray(3,6);da=c.subarray(6,9);f.copy(m,e);f.negate(e,e);f.normalize(e,e);Boolean(0.999999<Math.abs(f.dot(m,h.hb)))?(m=u.fromQuat(t.normalize(r,a),C),f.copy(m.subarray(0,3),O)):f.cross(h.hb,e,O);f.normalize(O,O);f.cross(O,e,da);f.normalize(da,da);t.fromMat3(c,a);t.normalize(a,a);t.conjugate(a,a);h.dq(a,d,b,0.1,d);break;case s:d=a.d.i;O=S;b=P;n(m.I,m.Os,!0,O,b);m.$d?(t.copy(m.$d,d),t.multiply(b,d,d)):t.copy(b,d);h.Ej(m.offset,1,b,
O,a.d.e);break;case B:c=a.d.e;d=a.d.i;b=m.I.d.e;l(c,d,b);"CAMERA"==a.d.type&&p(a,h.hb);break;case q:c=a.d.e;d=a.d.i;b=m.target;l(c,d,b);"CAMERA"==a.d.type&&p(a,h.hb);break;case y:c=a.d.e;d=a.d.i;b=m.I.d.e;d=g(c,d,b,X);O=f.dist(c,b);if(m=d?O>m.ph?O-m.ph:O<m.Ge?O-m.Ge:0:O+m.Ge)f.sub(b,c,Q),f.normalize(Q,Q),f.scale(Q,m,Q),f.add(c,Q,c);"CAMERA"==a.d.type&&p(a,h.hb);break;case D:c=a.d.e;d=a.d.i;b=m.target;d=g(c,d,b,X);O=f.dist(c,b);if(m=d?O>m.ph?O-m.ph:O<m.Ge?O-m.Ge:0:O+m.Ge)f.sub(b,c,Q),f.normalize(Q,
Q),f.scale(Q,m,Q),f.add(c,Q,c);"CAMERA"==a.d.type&&p(a,h.hb);break;case z:e=m.I.d.G;f.transformMat4(m.offset,e,a.d.e);break;case E:O=m.I.d.e;c=a.d.e;f.add(O,m.offset,c);break;case I:d=a.d.i;e=m.I.d.G;b=m.I.d.i;m.$d?(t.copy(m.$d,d),t.multiply(b,d,d)):t.copy(b,d);f.transformMat4(m.offset,e,a.d.e);break;case L:b=m.I.d,b=k.mf(b.e,b.scale,b.i,T),k.multiply(b,m.Aq,b),c=a.d.e,c[0]=b[0],c[1]=b[1],c[2]=b[2],a.d.scale=b[3],d=a.d.i,d[0]=b[4],d[1]=b[5],d[2]=b[6],d[3]=b[7]}}function l(a,m,b){var c=Q;h.Mb(m,h.sd,
c);f.normalize(c,c);var T=H;f.subtract(b,a,T);f.normalize(T,T);a=S;t.rotationTo(c,T,a);t.multiply(a,m,m)}function g(a,m,b,c){var T=Q;h.Mb(m,h.sd,T);f.normalize(T,T);var F=H;f.subtract(b,a,F);f.normalize(F,F);if(f.dot(T,F)<Math.cos(c))return!1;a=S;t.rotationTo(T,F,a);t.multiply(a,m,m);return!0}function p(a,m){var b=a.d.i,c=u.fromQuat(b,F),T=Q;T[0]=c[3];T[1]=c[4];T[2]=c[5];if(!(0.999<Math.abs(f.dot(m,T)))){T=f.cross(m,T,T);f.normalize(T,T);0<c[7]&&(T[0]*=-1,T[1]*=-1,T[2]*=-1);var C=H;C[0]=c[0];C[1]=
c[1];C[2]=c[2];f.normalize(C,C);c=P;t.rotationTo(C,T,c);t.multiply(c,b,b)}}function n(a,b,c,F,f){var C=a.d,q=C.Mi,d=C.Ad[b];b=d.Eg;a=a.pose.bones[d.nj];var d=a.Yj,e=S,g=C.Dj,G=C.Cj,h=C.rj,p=C.qj,n=g[4*b+1],l=g[4*b+2],u=g[4*b+3],s=G[4*b+1],y=G[4*b+2],B=G[4*b+3];e[0]=(1-q)*g[4*b]+q*G[4*b];e[1]=(1-q)*n+q*s;e[2]=(1-q)*l+q*y;e[3]=(1-q)*u+q*B;g=P;G=O;g[0]=h[4*b];g[1]=h[4*b+1];g[2]=h[4*b+2];g[3]=h[4*b+3];G[0]=p[4*b];G[1]=p[4*b+1];G[2]=p[4*b+2];G[3]=p[4*b+3];t.slerp(g,G,q,g);q=T;k.Wp(e,q);k.uj(g,q);c?(c=
m,k.translate(d,a.cs,c),k.multiply(q,c,q)):k.multiply(q,d,q);k.multiply(C.Uf,q,q);F[0]=q[0];F[1]=q[1];F[2]=q[2];F[3]=q[3];f&&(f[0]=q[4],f[1]=q[5],f[2]=q[6],f[3]=q[7])}var k=r("__tsr"),h=r("__util"),f=r("vec3"),t=r("quat"),u=r("mat3");r("mat4");var w=1,s=2,B=3,q=4,y=5,D=6,z=7,E=8,M=9,x=10,L=11,R=12,I=13;a.QA=w;a.PA=s;a.TA=B;a.UA=q;a.KA=y;a.LA=D;a.RA=z;a.JA=E;a.OA=M;a.NA=x;a.Mc=L;a.MA=R;a.SA=I;var Q=new Float32Array(3),H=new Float32Array(3),K=new Float32Array(3),S=new Float32Array(4),P=new Float32Array(4),
O=new Float32Array(4),T=new Float32Array(16),m=new Float32Array(16),F=new Float32Array(9),C=new Float32Array(9),T=new Float32Array(8),X=9*Math.PI/10;a.bn=function(a,m,T,F,f){var q=b(w);q.I=m;q.offset=new Float32Array(T);q.Np=f||1;q.$d=F?new Float32Array(F):null;c(a,q);e(a,q,0)};a.an=function(a,m,T,F,q){var f=b(s);f.I=m;f.Os=T;f.offset=new Float32Array(F);f.$d=q?new Float32Array(q):null;c(a,f);e(a,f,0)};a.ms=function(a,m,T,F){var f=b(M),q=a.d.i,C=m.d.i;f.I=m;f.offset=new Float32Array(T);f.Ke=new Float32Array(C);
F&&(t.copy(F,q),t.multiply(C,q,q));c(a,f);e(a,f,0)};a.ls=function(a,m,T,F,f,q,C,d){var g=b(x),k=a.d.i,G=m.d.i;g.I=m;g.offset=new Float32Array(T);g.Ke=new Float32Array(G);g.An=f;g.Bn=q;g.Cn=C;g.zn=d;F&&(t.copy(F,k),t.multiply(G,k,k));c(a,g);e(a,g,0)};a.ks=function(a,m,T){var F=b(R);F.I=m;F.offset=new Float32Array(T);c(a,F);e(a,F,0)};a.os=function(a,m,T,F){var f=b(I);f.I=m;f.offset=new Float32Array(T);f.Np=1;f.$d=F?new Float32Array(F):null;c(a,f);e(a,f,0)};a.ps=function(a,m){var T=b(B);T.I=m;c(a,T);
e(a,T,0)};a.cn=function(a,m){var T=b(q);T.target=new Float32Array(m);c(a,T);e(a,T,0)};a.is=function(a,m,T,F){var f=b(y);f.I=m;f.Ge=T;f.ph=F;c(a,f);e(a,f,0)};a.Ym=function(a,m,T,F){var f=b(D);f.target=new Float32Array(m);f.Ge=T;f.ph=F;c(a,f);e(a,f,0)};a.ns=function(a,m,T){var F=b(z);F.I=m;F.offset=new Float32Array(T);c(a,F);e(a,F,0)};a.hs=function(a,m,T){var F=b(E);F.I=m;F.offset=new Float32Array(T);c(a,F);e(a,F,0)};a.gs=function(a,m,T){var F=b(L);F.I=m;F.Aq=new Float32Array(T);c(a,F);e(a,F,0)};a.gA=
function(a,m){a.wa&&e(a,a.wa,m)};a.Ft=p;a.remove=function(a){a.wa.I&&d(a.wa.I,a);a.wa=null};a.cd=function(a){return a.wa?a.wa.type:null};a.UB=function(a){return a.wa&&a.wa.I?a.wa.I:null};a.ad=function(a){return a.wa&&a.wa.type==L?a.wa.Aq:null};a.Sv=n};b4w.module.__controls=function(a,r){function b(a){var m={};m.type=a;m.value=0;m.Xb=null;m.il=null;m.hl=null;m.Yi=null;return m}function c(a,m){var b;if(a.Yi){b=a.il;for(var c=a.hl,f=0;f<b.length;f++)c[f]=b[f].value;b=a.Yi(c)}else b=!1;b||(a.value=Number(m))}function d(a){a=B.indexOf(a);-1<a?B.splice(a,1):k.error("Wrong object")}function e(a,m){for(var b=0,c=0;c<m.length;c++){var f=m[c],q=f.qb,d;for(d in q)for(var q=f.qb[d].kc,e=0;e<q.length;e++)q[e]===a&&b++}return b}function l(a,m){switch(a.type){case S:h.Gp(a.tt,
a.gc,a.Gn);break;case P:h.Dn(a.Fn);break;case O:h.Hp(a.Lh,a.Lz,a.bv,a.nx)}var b=m.indexOf(a);-1<b&&m.splice(b,1)}function g(a){for(var m=0;m<a.length;m++)if(!a[m])return!1;return!0}function p(a){var m=a[0],b=a[1];a=m.pageX;var m=m.pageY,c=b.pageX,b=b.pageY;return Math.sqrt((a-c)*(a-c)+(m-b)*(m-b))}var n=r("__config"),k=r("__print"),h=r("__physics"),f=r("__scenes"),t=r("__util"),u=r("vec3"),w=r("quat"),s=n.controls,B=[],q=[],y=0,D=0,z=0,E=0,M=0,x=0,L=0,R=0,I=0,Q=0,H=0,K=0,S=80,P=90,O=100;a.Am=10;a.Dm=
20;a.Cm=30;a.Bm=40;a.update=function(b,m){K=b;f.n();for(var F=0;F<q.length;F++){var C=q[F],d=b,e=m;if(e)switch(f.n(),C.type){case 110:var g=C.Lh,k=g.d.e,g=g.d.i,h=u.dist(C.Sh,k),p=C.hy;w.invert(C.xl,p);w.multiply(g,p,p);w.normalize(p,p);p=Math.abs(2*Math.acos(p[3]));h/=e;C.gk=t.Nf(h,C.gk,e,0.3);C.Xb[0]=h;h=p/e;C.fk=t.Nf(h,C.fk,e,0.3);C.Xb[1]=h;C.gk>=C.threshold||C.fk>=C.zy?c(C,1):c(C,0);u.copy(k,C.Sh);w.copy(g,C.xl);C.ac=d;break;case 120:g=C.Lh;k=g.d.e;g=Math.abs(k[1]-C.Sh[1])/e;C.hk=t.Nf(g,C.hk,
e,0.3);C.Xb=g;C.hk>=C.threshold?c(C,1):c(C,0);u.copy(k,C.Sh);C.ac=d;break;case 130:d-C.ac>=C.lj&&(c(C,1),C.ac=d);break;case 140:C.ac||(C.ac=d);c(C,d-C.ac);C.ac=d;break;case 150:c(C,d)}}for(F=0;F<B.length;F++){var C=B[F],n;for(n in C.qb){e=d=C.qb[n];k=e.kc;g=e.Fy;for(h=0;h<k.length;h++)g[h]=k[h].value;e=e.px(g);k=d.ap;h=g=void 0;switch(d.type){case a.Am:e?h=g=1:1==k?h=g=-1:g=0;break;case a.Dm:e&&-1==k?h=g=1:e||1!=k?g=0:h=g=-1;break;case a.Cm:e&&-1==k?h=g=1:e||1!=k?g=0:(g=0,h=-1);break;case a.Bm:g=
d.bp!=(e?d.kc[0].value:0)?1:0;break;default:throw"Wrong sensor manifold type: "+d.type;}h&&(d.ap=h);if(k=g)e=e?d.kc[0].value:0,d.ne(C,n,e,k,d.Vs),d.bp=e}}for(F=0;F<B.length;F++)for(n in C=B[F],C.qb)for(d=C.qb[n],d=d.kc,e=0;e<d.length;e++)switch(k=d[e],k.type){case 30:c(k,0);break;case 40:c(k,0);break;case 60:c(k,0);break;case 70:c(k,0);break;case 130:c(k,0)}y=0;E=D;M=z;R=x;I=L;H=Q};a.Tt=function(a){var m=b(10);c(a);return m};a.Kn=function(a){var m=b(20);m.key=a;return m};a.Qt=function(a,m){if(!a||
!a.m)return k.error("Wrong collision object"),null;var F=b(S);F.tt=a;F.gc=m||null;F.Gn=function(a,m){c(F,a);a&&m&&(F.Xb=F.Xb||new Float32Array(3),F.Xb[0]=m[0],F.Xb[1]=m[1],F.Xb[2]=m[2])};h.Xm(a,F.gc,F.Gn);return F};a.Pt=function(a){if(!a||!a.m)return k.error("Wrong collision impulse object"),null;var m=b(P);m.Fn=a;m.st=function(a){c(m,a)};h.dn(m.Fn,m.st);return m};a.iu=function(a,m,F,f,q){if(!a)return k.error("Wrong collision object"),null;var d=b(O);d.Lh=a;d.Lz=m;d.bv=F;d.nx=f;d.gc=q;d.py=function(a,
m){c(d,a);a&&(d.Xb=m)};h.$m(a,d.gc,m,F,f,d.py);return d};a.fu=function(){return b(50)};a.hu=function(){return b(30)};a.gu=function(a){var m=b(40);m.axis=a||"XY";return m};a.wu=function(a){var m=b(60);m.axis=a||"XY";return m};a.xu=function(){return b(70)};a.eu=function(a,m,c){if(!a)return k.error("Wrong collision object"),null;var f=b(110);f.Lh=a;var q=a.d.e;a=a.d.i;f.hy=new Float32Array(4);f.Sh=new Float32Array(q);f.xl=new Float32Array(a);f.gk=0;f.fk=0;f.threshold=m;f.zy=c;f.ac=0;f.Xb=new Float32Array([0,
0]);return f};a.yu=function(a,m){if(!a)return k.error("Wrong collision object"),null;var c=b(120);c.Lh=a;var f=a.d.i;c.Sh=new Float32Array(a.d.e);c.xl=new Float32Array(f);c.hk=0;c.threshold=m;c.ac=0;c.Xb=0;return c};a.vu=function(a){var m=b(130);m.lj=a;m.ac=K;return m};a.yy=function(a,m,b,c){c=c||0;a=a.qb;if(!a||!a[m])return k.error("reset_timer_sensor(): wrong object"),null;m=a[m].kc[b];if(!m)return k.error("reset_timer_sensor(): sensor not found"),null;m.ac=K+c};a.Wt=function(){var a=b(140);a.ac=
0;return a};a.uu=function(){return b(150)};a.Ey=c;a.pa=function(){B=[];q=[];K=0};a.xn=function(a,m){if(m)for(var b in a.qb){if(b===m)return!0}else for(b in a.qb)return!0;return!1};a.Ip=function(a,m){var b=a.qb;if(m){for(var c=b[m],c=c.kc,f=0;f<c.length;f++)1===e(c[f],B)&&l(c[f],q);delete b[m];Object.getOwnPropertyNames(b).length||d(a)}else{for(var g in b){c=b[g];c=c.kc;for(f=0;f<c.length;f++)1===e(c[f],B)&&l(c[f],q);delete b[g]}d(a)}};a.Nn=function(a,m,b,c,f,d,e){a.qb=a.qb||{};var k={};k.name=name;
k.type=b;k.kc=c.slice(0);k.px=f||g;k.Fy=Array(c.length);k.ne=d;k.Vs=e||null;k.ap=-1;k.bp=0;a.qb[m]=k;-1==B.indexOf(a)&&B.push(a);a=k.kc;for(m=0;m<a.length;m++)b=a[m],-1==q.indexOf(b)&&q.push(b)};a.Gu=g;a.reset=function(){for(var a=0;a<B.length;a++){var m=B[a].qb,b;for(b in m)delete m[b]}for(a=0;a<q.length;a++)l(q[a],q),a--;B.splice(0,B.length)};a.debug=function(){f.n();k.log(String(B.length)+" objects with manifolds",B);k.log(String(q.length)+" sensors",q);for(var a=[],m=[],b=0;b<q.length;b++){var c=
q[b];c.type==S&&a.push(c);c.type==O&&m.push(c)}k.log(String(a.length)+" collision sensors",a);k.log(String(m.length)+" ray sensors",m)};a.gx=function(a){for(var m=0;m<q.length;m++){var b=q[m];20==b.type&&a.keyCode==b.key&&c(b,1)}};a.hx=function(a){for(var m=0;m<q.length;m++){var b=q[m];20==b.type&&0==a.keyCode&&16==b.key&&c(b,0);20==b.type&&a.keyCode==b.key&&c(b,0)}};a.Bx=function(){for(var a=0;a<q.length;a++){var m=q[a];50==m.type&&c(m,1)}};a.Dx=function(){for(var a=0;a<q.length;a++){var m=q[a];
50==m.type&&c(m,0)}};a.Ex=function(a){a=a.wheelDelta||-40*a.detail;a*=s.Fx;y+=a;for(a=0;a<q.length;a++){var m=q[a];30===m.type&&c(m,y)}};a.Cx=function(a){var m=a.clientX;a=a.clientY;D=m;z=a;m-=E;a-=M;for(var b=Math.sqrt(m*m+a*a),f=0;f<q.length;f++){var d=q[f];if(40===d.type)switch(d.axis){case "X":c(d,m);break;case "Y":c(d,a);break;case "XY":c(d,b)}}};a.Uz=function(a){a=a.targetTouches;if(1==a.length){a=a[0];var m=a.pageY;x=R=a.pageX;L=I=m}else 1<a.length&&(Q=H=p(a))};a.Tz=function(a){var m=a.targetTouches;
if(0!==m.length)if(a.preventDefault(),1===m.length){m=m[0];a=m.pageX;m=m.pageY;x=a;L=m;a-=R;for(var b=m-I,f=Math.sqrt(a*a+b*b),m=0;m<q.length;m++){var d=q[m];if(60===d.type)switch(d.axis){case "X":c(d,a);break;case "Y":c(d,b);break;case "XY":c(d,f)}}}else if(1<m.length)for(Q=p(m),a=Q-H,m=0;m<q.length;m++)d=q[m],70===d.type&&c(d,a)}};b4w.module.__curve=function(a,r){function b(a,b,c,d,e){var h=d.length;e||(e=new Float32Array(h));for(var f=h+a,t=new Float32Array(f),u=1;u<=f-1;u++)t[u-1]=b>=c[u-1]&&b<c[u+1-1]?1:0;for(var w=2;w<=a;w++)for(u=1;u<=f-w;u++)t[u-1]=(0!=t[u-1]?(b-c[u-1])*t[u-1]/(c[u+w-1-1]-c[u-1]):0)+(0!=t[u+1-1]?(c[u+w-1]-b)*t[u+1-1]/(c[u+w-1]-c[u+1-1]):0);b==c[f-1]&&(t[h-1]=1);a=0;for(u=1;u<=h;u++)a+=t[u-1]*d[u-1];for(u=1;u<=h;u++)e[u-1]=0!=a?t[u-1]*d[u-1]/a:0;return e}function c(a){a=a.Xi;return a[a.length-1]}function d(a){a=
a.Pn;return a[a.length-1]}var e=r("__util");a.qu=function(a){var c={},d=a.data;a=d.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var e=a.order_u;c.Td=e;a=a.points;var k=a.length/5,h=[],f=k+e,k=k+2;h[0]=0;for(var t=2;t<=f;t++)h[t-1]=t>e&&t<k?h[t-2]+1:h[t-2];c.Xi=h;if("2D"==d.dimensions)c.Od=!1;else if("3D"==d.dimensions)c.Od=!0;else throw"Wrong curve dimensions";e=[];h=[];for(d=0;d<a.length;d+=5)e.push(a[d]),e.push(a[d+1]),e.push(a[d+2]),c.Od&&e.push(a[d+3]),h.push(a[d+4]);c.uk=
e;c.rm=h;a=[];for(var d=c.uk,e=c.Od?4:3,h=c.rm,f=c.Xi,k=c.Td,t=d.length/e,u=t+k,w=0,s=f[u-1]/999,B=0;1E3>B;B++){5E-6>f[u-1]-w&&(w=f[u-1]);for(var q=b(k,w,f,h),y=0;y<e;y++)for(var D=a[e*B+y]=0;D<t;D++)a[e*B+y]+=q[D]*d[e*D+y];w+=s}e=c.Od?4:3;h=new Float32Array(1E3);h[0]=0;for(d=1;1E3>d;d+=1)f=a[(d-1)*e],k=a[(d-1)*e+1],t=a[(d-1)*e+2],u=a[d*e],w=a[d*e+1],s=a[d*e+2],h[d]=h[d-1]+Math.sqrt((u-f)*(u-f)+(w-k)*(w-k)+(s-t)*(s-t));c.Pn=h;return c};a.Gz=function(a,d,e){e||(e=[]);var n=d,k=Math.max(n,0);d=k=Math.min(n,
c(a));var n=a.uk,k=a.Od?4:3,h=a.rm,f=a.Xi,t=a.Td;a=n.length/k;var u=a+t;5E-6>f[u-1]-d&&(d=f[u-1]);u=new Float32Array(a);b(t,d,f,h,u);for(d=0;d<k;d++)for(h=e[d]=0;h<a;h++)e[d]+=u[h]*n[k*h+d]};a.Dz=function(a,b,c){c||(c=[]);var d=a.uk,e=a.Od?4:3,h=a.rm,f=a.Xi,t=a.Td;a=d.length/e;var u=a+t;5E-6>f[u-1]-b&&(b=f[u-1]);var u=new Float32Array(a),w=b;b=u;var s=h.length;b||(b=new Float32Array(s));var B=new Float32Array(s),q=new Float32Array(s),y=B,D=q;y||(y=new Float32Array(s));D||(D=new Float32Array(s));for(var z=
s+t,E=new Float32Array(z),M=new Float32Array(z),x=1;x<=z-1;x++)E[x-1]=w>=f[x-1]&&w<f[x+1-1]?1:0;w==f[z-1]&&(E[s-1]=1);for(var L=2;L<=t;L++)for(x=1;x<=z-L;x++){var R=0!=E[x-1]?E[x-1]/(f[x+L-1-1]-f[x-1]):0,I=0!=E[x+1-1]?-E[x+1-1]/(f[x+L-1]-f[x+1-1]):0,Q=0!=M[x-1]?(w-f[x-1])*M[x-1]/(f[x+L-1-1]-f[x-1]):0,H=0!=M[x+1-1]?(f[x+L-1]-w)*M[x+1-1]/(f[x+L-1]-f[x+1-1]):0;E[x-1]=(0!=E[x-1]?(w-f[x-1])*E[x-1]/(f[x+L-1-1]-f[x-1]):0)+(0!=E[x+1-1]?(f[x+L-1]-w)*E[x+1-1]/(f[x+L-1]-f[x+1-1]):0);M[x-1]=R+I+Q+H}for(x=1;x<=
s;x++)y[x-1]=E[x-1],D[x-1]=M[x-1];f=0;for(t=1;t<=s;t++)f+=B[t-1]*h[t-1];w=0;for(t=1;t<=s;t++)w+=q[t-1]*h[t-1];for(t=1;t<=s;t++)b[t-1]=0!=f?q[t-1]*h[t-1]/f+B[t-1]*h[t-1]*w/(f*f):0;for(h=0;h<e;h++)for(f=c[h]=0;f<a;f++)c[h]+=u[f]*d[e*f+h]};a.LC=c;a.Fz=d;a.Ez=function(a,b){if(0>=b)return 0;var p=c(a);if(b>=d(a))return p;var n=a.Pn,k=e.gi(n,b,0,n.length-1);return p*(k+(b-n[k])/(n[k+1]-n[k]))/1E3}};b4w.module.__dds=function(a,r){function b(a,b,c,f){var d=new Uint16Array(4),q=new Uint16Array(c*f),e=0,g=0,k=0,h=g=e=0,u=0,T=0,m=0,F=c/4;f/=4;for(var C=0;C<f;C++)for(var s=0;s<F;s++)k=b+4*(C*F+s),d[0]=a[k],d[1]=a[k+1],e=d[0]&31,g=d[0]&2016,h=d[0]&63488,u=d[1]&31,T=d[1]&2016,m=d[1]&63488,d[2]=5*e+3*u>>3|5*g+3*T>>3&2016|5*h+3*m>>3&63488,d[3]=5*u+3*e>>3|5*T+3*g>>3&2016|5*m+3*h>>3&63488,e=a[k+2],g=4*C*c+4*s,q[g]=d[e&3],q[g+1]=d[e>>2&3],q[g+2]=d[e>>4&3],q[g+3]=d[e>>6&3],g+=c,q[g]=d[e>>8&3],q[g+1]=d[e>>
10&3],q[g+2]=d[e>>12&3],q[g+3]=d[e>>14],e=a[k+3],g+=c,q[g]=d[e&3],q[g+1]=d[e>>2&3],q[g+2]=d[e>>4&3],q[g+3]=d[e>>6&3],g+=c,q[g]=d[e>>8&3],q[g+1]=d[e>>10&3],q[g+2]=d[e>>12&3],q[g+3]=d[e>>14];return q}function c(a,c,d,e){var I=new Int32Array(d,0,u),Q,H,K,S,P,O;if(I[w]!=p)return g.error("Invalid magic number in DDS header"),0;if(!I[z]&k)return g.error("Unsupported format, must contain a FourCC code"),0;Q=I[E];switch(Q){case h:H=8;K=c?c.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case f:H=16;K=c?c.COMPRESSED_RGBA_S3TC_DXT3_EXT:
null;break;case t:H=16;K=c?c.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return g.error("Unsupported FourCC code:",l(Q)),null}O=1;I[B]&n&&!1!==e&&(O=Math.max(1,I[D]));S=I[y];P=I[q];I=I[s]+4;if(c)for(Q=0;Q<O;++Q)e=Math.max(4,S)/4*Math.max(4,P)/4*H,c=new Uint8Array(d,I,e),a.compressedTexImage2D(a.TEXTURE_2D,Q,K,S,P,0,c),I+=e,S=Math.max(0.5*S,1),P=Math.max(0.5*P,1);else if(Q==h)Math.max(4,S),Math.max(4,P),c=new Uint16Array(d),d=b(c,I/2,S,P),a.texImage2D(a.TEXTURE_2D,0,a.RGB,S,P,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,
d),e&&a.generateMipmap(a.TEXTURE_2D);else return g.error("No manual decoder for",l(Q),"and no native support"),0;return O}function d(a,b,d,f,q,e){var g=new XMLHttpRequest;g.open("GET",d,!0);g.responseType="arraybuffer";g.onload=function(){if(200==g.status){a.bindTexture(a.TEXTURE_2D,f);var d=c(a,b,g.response,q);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<d?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}e&&e(f)};g.send(null);return f}function e(a){return a.charCodeAt(0)+
(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function l(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var g=r("__print"),p=542327876,n=131072,k=4,h=e("DXT1"),f=e("DXT3"),t=e("DXT5"),u=31,w=0,s=1,B=2,q=3,y=4,D=7,z=20,E=21;a.AB=b;a.nA=c;a.Eo=function(a){a=new Int32Array(a,0,u);return{width:a[y],height:a[q]}};a.Vv=function(a){var b=1;a=(new Int32Array(a,0,u))[E];switch(a){case h:b=6;break;case f:case t:b=4;break;default:g.error("Unsupported FourCC code:",l(a))}return b};
a.oC=d;a.nC=function(a,b,c,f){var q=a.createTexture();d(a,b,c,q,!0,f);return q}};b4w.module.__debug=function(a,r){function b(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}var c=r("__print"),d=r("__extensions"),e=r("__textures"),l=r("__util"),g,p={},n=!1,k={},h=[],f=-1;a.Om={WM_OPAQUE_WIREFRAME:0,WM_TRANSPARENT_WIREFRAME:1,WM_FRONT_BACK_VIEW:2,WM_DEBUG_SPHERES:3};a.mc=function(a){g=a;a="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" ");for(var b in a){var c=a[b];c in g&&
(p[g[c]]=c)}};a.it=function(a){if(n){var b=g.getError();if(b!=g.NO_ERROR){if(b in p)throw"B4W Error: "+b+", gl."+p[b]+" ("+a+")";throw"Unknown GL error: "+b+" ("+a+")";}}};a.et=function(){if(n)switch(g.checkFramebufferStatus(g.FRAMEBUFFER)){case g.FRAMEBUFFER_COMPLETE:break;case g.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:c.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case g.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:c.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");
break;case g.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:c.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case g.FRAMEBUFFER_UNSUPPORTED:c.error("B4W Error: Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:c.error("B4W Error: FRAMEBUFFER CHECK FAILED")}};a.wn=function(){if(-1!=f)return f;g.bindFramebuffer(g.FRAMEBUFFER,g.createFramebuffer());var a=e.si("DEBUG",e.gg);e.If(a,1,1);g.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,a.xb,a.Ua,0);g.checkFramebufferStatus(g.FRAMEBUFFER)!=
g.FRAMEBUFFER_COMPLETE?(f=!0,c.warn("B4W warning: depth-only issue was found")):f=!1;g.bindFramebuffer(g.FRAMEBUFFER,null);return f};a.kt=function(a,d,f){if(n&&!g.getShaderParameter(a,g.COMPILE_STATUS))throw f=b(f),c.error("B4W Error: shader compilation failed:\n"+f+"\n"+g.getShaderInfoLog(a)+" ("+d+")"),"Engine failed: see above for error messages";};a.lt=function(a,f,e,k,q,h){if(n&&!g.getProgramParameter(a,g.LINK_STATUS)){var p=d.mo();p&&(q=p.getTranslatedShaderSource(e),h=p.getTranslatedShaderSource(k));
q=b(q);h=b(h);c.error("B4W Error: shader linking failed:\n"+q+"\n\n\n"+h+"\n"+g.getProgramInfoLog(a)+" ("+f+")");throw"Engine failed: see above for error messages";}};a.Sy=function(a){n=a};a.BB=function(a){k[a]=a in k?k[a]+1:1};a.update=function(){for(var a in k)c.log(a,k[a]),k[a]=0};a.Hk=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(l.Wg(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}h.push(a)};a.ol=function(){for(var a=1,b=0;b<h.length;b++){var c=
h[b];c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],l.Wg(a))for(var d=0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);h.push(c)};var t=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.fy=function(a){a||(a=1);for(var b=0,d={},f=Math.max(0,performance.now()-1E3*a),q=0;q<h.length;q++){var e=h[q];a=e[0];if(!(a<f)){var g=String(e[1]);d[g]||(d[g]=t[b++%t.length]);a=["%c"+(a/1E3).toFixed(6),d[g],g];for(g=2;g<e.length;g++)a.push(e[g]);
c.log.apply(this,a)}}h.splice(0)};a.ay=function(a){a||(a=1);for(var b={},d=Math.max(0,performance.now()-1E3*a),f=0;f<h.length;f++){var q=h[f];a=q[0];if(!(a<d))for(var e=2;e<q.length;e++){var g=String(q[1]);3<q.length&&(g+="_"+String(e-2));b[g]||(b[g]=g+"\n");b[g]+=String(a)+" "+q[e]+"\n"}}a="";for(g in b)a+=b[g]+"\n\n";c.log(a);h.splice(0)};a.gt=function(){function a(c){return-1<b.indexOf(c)?!0:!1}var b=navigator.userAgent.toLowerCase();switch("safari"){case "chrome":return a("mozilla")&&a("applewebkit")&&
a("chrome");case "firefox":return a("mozilla")&&a("gecko")&&a("firefox");case "msie":return a("mozilla")&&a("trident")&&a("msie");case "opera":return a("opera")&&a("presto");case "safari":return a("mozilla")&&a("applewebkit")&&a("safari")&&!a("chrome");default:return!1}};a.iB=function(a){if(l.Wg(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1}};b4w.module.__extensions=function(a,r){function b(a){if(a in e)return e[a];var b=d.getExtension(a)||null;e[a]=b;c.log("%cGET EXTENSION","color: #"+(b?"0a0":"a00"),a);return b}var c=r("__print"),d,e={};a.mc=function(a){d=a};a.yo=function(){return b("WEBGL_compressed_texture_s3tc")||b("WEBKIT_WEBGL_compressed_texture_s3tc")||b("MOZ_WEBGL_compressed_texture_s3tc")};a.Yv=function(){return b("WEBGL_depth_texture")||b("WEBKIT_WEBGL_depth_texture")||b("MOZ_WEBGL_depth_texture")};a.Ov=function(){return b("EXT_texture_filter_anisotropic")||
b("WEBKIT_EXT_texture_filter_anisotropic")||b("MOZ_EXT_texture_filter_anisotropic")};a.mo=function(){return b("WEBGL_debug_shaders")};a.iw=function(){return b("WEBGL_debug_renderer_info")};a.oo=function(){return b("OES_element_index_uint")};a.ow=function(){return b("OES_standard_derivatives")};a.pa=function(){e={}}};b4w.module.__graph=function(a){function r(a,c,d){d||(d=null);if(b(a,c))throw"Graph already has node with given ID";a.Ha.push(c,d)}function b(a,b){for(var c=a.Ha,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function c(a,c,d,f){f||(f=null);if(b(a,c)&&b(a,d))a.ya.push(c,d,f);else throw"Wrong node IDs";}function d(a,c){if(!b(a,c))throw"Node not found";for(var d=a.Ha,f=0;f<d.length;f+=2)d[f]==c&&(d.splice(f,2),f-=2)}function e(a){a=a.Ha;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}
function l(a,b){for(var c=a.Ha,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return L}function g(a){var b=[],c={};p(a,c);for(var d=a.Ha,m=0;m<d.length;m+=2)0==q(a,d[m])&&n(a,d[m],c,b);return{Ha:b,ya:a.ya.slice(0)}}function p(a,b){for(var c=a.Ha,d=0;d<c.length;d+=2)b[c[d]]=!1}function n(a,b,c,d){if(!c[b]){c[b]=!0;for(var m=0;m<B(a,b);m++)n(a,y(a,b,m),c,d);d.unshift(b,s(a,b))}}function k(a,b,c,d){if(!c[b]){c[b]=!0;if(d==I||d==H)for(var m=0;m<B(a,b);m++){var f=y(a,b,m);k(a,f,c,d)}if(d==Q||d==H)for(m=
0;m<q(a,b);m++)f=D(a,b,m),k(a,f,c,d)}}function h(a){var b=a.Ha;a=a.ya;for(var c=[],d=[],m=[],f=0;f<b.length;f++)m[b[2*f]]=f,c.push(f,b[2*f+1]);for(f=0;f<a.length;f+=3)d.push(m[a[f]],m[a[f+1]],a[f+2]);return{Ha:c,ya:d}}function f(a,b,c){if(c.xc==c.Rd){for(var d=0,m=0;d<c.Rd;d++)c.Tc[d]!=L&&(a[m]=d,b[m]=c.Tc[d],m++);return!0}if(c.Rd>c.zf||c.fe>c.ge||c.Qf>c.Sf||c.Pf>c.Rf)return!1;for(var m=d=L,F=!1;!F&&t(c,K,d,m);)if(d=K[0],m=K[1],u(c,d,m)){var e;e=c;F={};F.Og=e.Og;F.Pg=e.Pg;F.rl=e.rl;F.Ji=e.Ji;F.Rd=
e.Rd;F.zf=e.zf;F.Td=e.Td;F.xc=F.hj=e.xc;F.Pf=e.Pf;F.Qf=e.Qf;F.fe=e.fe;F.Rf=e.Rf;F.Sf=e.Sf;F.ge=e.ge;F.kg=L;F.Tc=e.Tc;F.pe=e.pe;F.Be=e.Be;F.Ce=e.Ce;F.He=e.He;F.Ie=e.Ie;F.wj=e.wj;e.wj[0]+=1;var F=e=F,g=d,k=m,h=F.Og,n=F.Pg,p=F.Rd,s=F.zf,l=F.Tc,z=F.pe,E=F.Be,I=F.Ce,Q=F.He,G=F.Ie;w(g<p);w(k<s);w(F.xc<p);w(F.xc<s);p=++F.xc;F.kg=g;E[g]||(E[g]=p,F.Pf++,Q[g]&&F.fe++);Q[g]||(Q[g]=p,F.Qf++,E[g]&&F.fe++);I[k]||(I[k]=p,F.Rf++,G[k]&&F.ge++);G[k]||(G[k]=p,F.Sf++,I[k]&&F.ge++);l[g]=k;z[k]=g;for(l=0;l<q(h,g);l++)z=
D(h,g,l),E[z]||(E[z]=p,F.Pf++,Q[z]&&F.fe++);for(l=0;l<B(h,g);l++)z=y(h,g,l),Q[z]||(Q[z]=p,F.Qf++,E[z]&&F.fe++);for(l=0;l<q(n,k);l++)z=D(n,k,l),I[z]||(I[z]=p,F.Rf++,G[z]&&F.ge++);for(l=0;l<B(n,k);l++)z=y(n,k,l),G[z]||(G[z]=p,F.Sf++,I[z]&&F.ge++);F=f(a,b,e);w(1>=e.xc-e.hj);w(e.kg!=L);z=e.Og;g=e.Pg;k=e.xc;h=e.kg;n=e.Tc;E=e.pe;p=e.Be;I=e.Ce;s=e.He;Q=e.Ie;if(e.hj<k){p[h]==k&&(p[h]=0);for(G=0;G<q(z,h);G++)l=D(z,h,G),p[l]==k&&(p[l]=0);s[h]==k&&(s[h]=0);for(G=0;G<B(z,h);G++)l=y(z,h,G),s[l]==k&&(s[l]=0);z=
n[h];I[z]==k&&(I[z]=0);for(G=0;G<q(g,z);G++)l=D(g,z,G),I[l]==k&&(I[l]=0);Q[z]==k&&(Q[z]=0);for(G=0;G<B(g,z);G++)l=y(g,z,G),Q[l]==k&&(Q[l]=0);n[h]=L;E[z]=L;e.xc=e.hj;e.kg=L}}return F}function t(a,b,c,d){c==L&&(c=0);d==L?d=0:d++;var m=a.fe,f=a.ge,q=a.Qf,e=a.Sf,g=a.Pf,k=a.Rf,h=a.xc,p=a.Rd,n=a.zf,s=a.Tc,l=a.pe,u=a.Be,y=a.Ce,B=a.He,G=a.Ie;if(m>h&&f>h)for(;c<p&&(s[c]!=L||0==B[c]||0==u[c]);)c++,d=0;else if(q>h&&e>h)for(;c<p&&(s[c]!=L||0==B[c]);)c++,d=0;else if(g>h&&k>h)for(;c<p&&(s[c]!=L||0==u[c]);)c++,
d=0;else if(0==c&&a.Td!=R){for(u=0;u<p&&s[c=a.Td[u]]!=L;)u++;u==p&&(c=p)}else for(;c<p&&s[c]!=L;)c++,d=0;if(m>h&&f>h)for(;d<n&&(l[d]!=L||0==G[d]||0==y[d]);)d++;else if(q>h&&e>h)for(;d<n&&(l[d]!=L||0==G[d]);)d++;else if(g>h&&k>h)for(;d<n&&(l[d]!=L||0==y[d]);)d++;else for(;d<n&&l[d]!=L;)d++;return c<p&&d<n?(b[0]=c,b[1]=d,!0):!1}function u(a,b,c){var d=a.Og,m=a.Pg,f=a.zf,e=a.Tc,g=a.pe,k=a.Be,h=a.Ce,p=a.He,n=a.Ie;w(b<a.Rd);w(c<f);w(e[b]==L);w(g[c]==L);if(!(0,a.rl)(s(d,b),s(m,c)))return!1;for(var l=f=
0,u=0,t=0,I=0,Q=0,K=0;K<B(d,b);K++){var G=y(d,b,K);if(e[G]!=L){var aa=e[G];if(!z(m,c,aa)||!E(a.Ji,d,b,G,m,c,aa))return!1}else k[G]&&u++,p[G]&&f++,k[G]||p[G]||I++}for(K=0;K<q(d,b);K++)if(G=D(d,b,K),e[G]!=L){if(aa=e[G],!z(m,aa,c)||!E(a.Ji,d,G,b,m,aa,c))return!1}else k[G]&&u++,p[G]&&f++,k[G]||p[G]||I++;for(K=0;K<B(m,c);K++)if(aa=y(m,c,K),g[aa]!=L){if(G=g[aa],!z(d,b,G))return!1}else h[aa]&&t++,n[aa]&&l++,h[aa]||n[aa]||Q++;for(K=0;K<q(m,c);K++)if(aa=D(m,c,K),g[aa]!=L){if(G=g[aa],!z(d,G,b))return!1}else h[aa]&&
t++,n[aa]&&l++,h[aa]||n[aa]||Q++;return u<=t&&f<=l&&I<=Q}function w(a){if(!a)throw"Assertion failed";}function s(a,b){for(var c=a.Ha,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function B(a,b){for(var c=a.ya,d=0,m=0;m<c.length;m+=3)c[m]==b&&d++;return d}function q(a,b){for(var c=a.ya,d=0,m=0;m<c.length;m+=3)c[m+1]==b&&d++;return d}function y(a,b,c){a=a.ya;for(var d=0,m=0;m<a.length;m+=3)if(a[m]==b){if(d==c)return a[m+1];d++}return L}function D(a,b,c){a=a.ya;for(var d=0,m=0;m<a.length;m+=
3)if(a[m+1]==b){if(d==c)return a[m];d++}return L}function z(a,b,c){a=a.ya;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function E(a,b,c,d,m,f,q){for(var e=M(b,c,d),g=M(m,f,q),k=0;k<e;k++){for(var h=!1,p=0;p<g;p++)if(a(x(b,c,d,k),x(m,f,q,p))){h=!0;break}if(!h)return!1}return!0}function M(a,b,c){var d=0;a=a.ya;for(var m=0;m<a.length;m+=3)a[m]==b&&a[m+1]==c&&d++;return d}function x(a,b,c,d){a=a.ya;for(var m=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(m==d)return a[f+2];m++}return null}
var L=-1,R=0,I=10,Q=20,H=30,K=[L,L];a.Im=L;a.WA=I;a.Pq=Q;a.ZA=H;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var m=a[d];switch(m.length){case 2:b.push(m[0],m[1]);break;case 3:c.push(m[0],m[1],m[2]);break;default:throw"Wrong graph constructor params";}}return{Ha:b,ya:c}};a.tB=function(a,b){for(var c=[],d=[],m=0;m<a.length;m++)c.push(a[m][0],a[m][1]);for(m=0;m<b.length;m++)d.push(b[m][0],b[m][1],b[m][2]);return{Ha:c,ya:d}};a.Zm=r;a.bC=b;a.Qc=c;a.Hf=d;a.gd=function(a,b,c,d){if(!z(a,
b,c))throw"Edge not found";a=a.ya;for(var m=0,f=0;f<a.length;f+=3)if(a[f]==b&&a[f+1]==c){if(-1==d)a.splice(f,3);else{if(d==m){a.splice(f,3);break}m++}f-=3}};a.q=function(a,b){if(l(a,b)==L)r(a,e(a),b);else throw"Non-unique attribute";};a.wy=function(a,b,c,d,m){a=a.ya;for(var f=0;f<a.length;f+=3)a[f]==b&&a[f+1]==c&&a[f+2]==d&&(a[f+2]=m)};a.yv=e;a.kh=l;a.l=function(a,b,d,f){b=l(a,b);d=l(a,d);if(b!=L&&d!=L)c(a,b,d,f);else throw"Attributes not found";};a.U=function(a,b){for(var c=a.Ha,d=0;d<c.length&&
!b(c[d],c[d+1]);d+=2);};a.Ze=function(a,b){for(var c=a.ya,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.pc=function(a,b,c){for(var d=a.ya,m=0;m<d.length;m+=3)if(d[m+1]==b){var f=d[m];if(c(f,s(a,f),d[m+2]))break}};a.Jc=function(a,b,c){for(var d=a.ya,m=0;m<d.length;m+=3)if(d[m]==b){var f=d[m+1];if(c(f,s(a,f),d[m+2]))break}};a.vq=g;a.Sz=function(a){a=g(a).Ha;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};a.fC=jb();a.Mz=function(a,c,d){if(!b(a,c))throw"No such node";var f={};p(a,f);k(a,
c,f,d);c=[];for(var m in f)f[m]&&(m=Number(m),c.push(m,s(a,m)));a={Ha:c,ya:a.ya.slice(0)};f=a.ya;for(m=0;m<f.length;m+=3)c=f[m+1],b(a,f[m])&&b(a,c)||(f.splice(m,3),m-=3);return a};a.mw=function(a){for(var b=[],c=a.Ha,d=0;d<c.length;d+=2){var m=c[d];q(a,m)||b.push(m)}return b};a.zo=function(a){for(var b=[],c=a.Ha,d=0;d<c.length;d+=2){var m=c[d];B(a,m)||b.push(m)}return b};a.match=function(a,b,c,d){var m={};m.Og=h(a);m.Pg=h(b);m.rl=c||function(a,m){return a==m};m.Ji=d||function(a,m){return a==m};d=
a.Ha.length/2;var q=b.Ha.length/2;m.Rd=d;m.zf=q;m.Td=R;m.xc=m.hj=0;m.fe=m.Pf=m.Qf=0;m.ge=m.Rf=m.Sf=0;m.kg=L;m.Tc=Array(d);m.pe=Array(q);m.Be=Array(d);m.Ce=Array(q);m.He=Array(d);m.Ie=Array(q);m.wj=[1];for(c=0;c<d;c++)m.Tc[c]=L,m.Be[c]=0,m.He[c]=0;for(c=0;c<q;c++)m.pe[c]=L,m.Ce[c]=0,m.Ie[c]=0;q=Array(d);d=Array(d);if(f(q,d,m)){for(c=0;c<q.length;c++)q[c]=a.Ha[2*q[c]],d[c]=b.Ha[2*d[c]];return[q,d]}return null};a.Pa=s;a.Je=B;a.Oo=q;a.ze=y;a.ye=D;a.QB=M;a.bd=x;a.replace=function(a,b,c){for(var f=a.ya,
m=e(a),q=0;q<b.length;q++){var g=b[q];d(a,g);for(var k=0;k<f.length;k+=3)f[k]==g&&(f[k]=m),f[k+1]==g&&(f[k+1]=m),f[k]==f[k+1]&&(f.splice(k,3),k-=3)}r(a,m,c)};a.uB=function(a,b){var c=a.Ha,d=a.ya,m;m="digraph debug {\n    node [shape=box];\n";for(var f=0;f<c.length;f+=2){var q=c[f],e=c[f+1],e=b?b(q,e):String(q);m+="    ";m+=String(q)+' [label="'+e.replace(/\"/g,'\\"')+'"];\n'}for(f=0;f<d.length;f+=3)c=d[f],q=d[f+1],m+="    ",m+=String(c)+" -> "+String(q)+";\n";return m+="}"}};b4w.module.__ipc=function(a){a.Sq=1;a.Tq=2;a.Uq=3;a.Vq=4;a.Wq=5;a.Xq=6;a.Yq=7;a.Zq=8;a.$q=9;a.ar=10;a.br=11;a.Nc=1001;a.dr=1002;a.er=1003;a.fr=1004;a.hr=1006;a.gr=1007;a.ir=1008;a.jr=1009;a.kr=1010;a.lr=1011;a.mr=1012;a.nr=1013;a.or=1014;a.pr=1015;a.qr=1016;a.rr=1017;a.sr=1018;a.tr=1019;a.ur=1020;a.vr=1021;a.wr=1022;a.xr=1023;a.yr=1024;a.zr=1025;a.Ar=1026;a.Br=1027;a.Km=1028;a.Cr=1029;a.Dr=1030;a.Er=1031;a.Fr=1032;a.Gr=1033;a.Hr=1034;a.Ir=1035;a.Jr=1036;a.Kr=1037;a.Lr=1038;a.Mr=1039;a.Nr=1040;a.Or=
1041;a.Lm=1042;a.le=1043;a.Pr=1044;a.Jm=1045;a.Qr=1047;a.Rr=1048;var r=a.le,b=null,c={},d={};d[10]={msg_id:null,body_id:null,time:null,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3)};d[8]={msg_id:null,chassis_hull_body_id:null,prop_ind:null,trans:new Float32Array(3),quat:new Float32Array(4)};d[9]={msg_id:null,body_id:null,from:new Float32Array(3),to:new Float32Array(3),local:null,body_id_b_hit:null,cur_result:null};d[r]={msg_id:null,body_id:null,
trans:new Float32Array(3),quat:new Float32Array(4)};var e={10:["msg_id",1,"body_id",1,"time",1,"trans",3,"quat",4,"linvel",3,"angvel",3],8:["msg_id",1,"chassis_hull_body_id",1,"prop_ind",1,"trans",3,"quat",4],9:["msg_id",1,"body_id",1,"from",3,"to",3,"local",1,"body_id_b_hit",1,"cur_result",1]};e[r]=["msg_id",1,"body_id",1,"trans",3,"quat",4];var l={};a.Rg=function(a,c){a.addEventListener("message",function(a){var b=a.data[0];if(b in e){a=a.data;for(var g=a[0],f=d[g],g=e[g],l=0,u=0;u<g.length;u+=
2){var w=g[u],s=g[u+1],B=l+s;if(1==s)f[w]=a[l];else for(var q=0;q<s;q++)f[w][q]=a[l+q];l=B}a=f}else a=a.data;c(b,a)},!1);b=a};a.pa=function(){b=null;c={}};a.p=function(){var a=arguments[0];if(a in e){var p=d[a],n=e[a],k=0;if(!(a in l)){for(var h=0,f=1;f<n.length;f+=2)h+=n[f];l[a]=new Float32Array(h)}h=l[a];for(f=0;f<n.length;f+=2){var t=p[n[f]],u=n[f+1];1==u?h[k]=t:h.set(t,k);k+=u}a in c||(c[a]=h);a=c[a]}else for(p=arguments.length,(a in c)||(c[a]=Array(p),c[a][0]=a),a=c[a],n=1;n<p;n++)a[n]=arguments[n];
b.postMessage(a)};a.so=function(a){return d[a]}};b4w.module.__hud=function(a,r){function b(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function c(a){d(' SCENE "'+a.name+'"');if(a.d){var b=0,c=0;p.U(a.d.Qa,function(a,f){if("SINK"==f.type)d(" (F)",f.type);else{var e=f.type,g=Math.round(f.k.width)+"x"+Math.round(f.k.height),k=f.o.length,h=f.ti,p=f.jx.length,n=f.H&&f.K;n?d(" (A)",e,p,g,h,"of",k):d(" (P)",e,p,g,h,"of",k);f.ti=0;n&&(b+=k,c+=h)}});return[b,c]}d("No INFO")}function d(){for(var a=n,b=k+t[0]*h,
c=[5,18,2,10,4,3,5],d=arguments[0],q=1;q<arguments.length;q++){for(var e="",g=0;g<c[q]-String(arguments[q]).length;g++)e+=" ";d+=e+arguments[q]}t[0]++;f.fillText(d,a,b)}function e(a,b,c){b*=a.va;c.x=a.x+b;c.y=a.y;c.va=a.va-2*b;c.ra=a.ra}function l(a){return a.x+a.va/2}function g(a){var b=f,c={x:0,y:0,va:0,ra:0},d=b.canvas.width,b=b.canvas.height;c.x=0;c.y=0;c.va=d;c.ra=b;e(c,0.01,c);d=0.02*c.ra;c.x=c.x;c.y+=d;c.va=c.va;c.ra-=2*d;d=c.va/8;c.x+=d*a;c.y=c.y;c.va=d;c.ra=c.ra;e(c,0.02,c);return c}var p=
r("__graph"),n=30,k=80,h=20,f=null,t=[0,0];a.Rg=function(a){a=a.getContext("2d");b(a);return f=a};a.Uh=function(){f&&b(f)};a.reset=function(){var a=f;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),t[0]=0,t[1]=0)};a.tz=function(a,b){var e=f;if(e){e.textAlign="left";e.fillStyle="rgba(0,255,0,255)";d(" FPS",(1/b).toFixed(2));t[0]++;for(var g=e=0,q=0;q<a.length;q++){var k=c(a[q]),e=e+k[0],g=g+k[1];t[0]++}d(" ---------------------------------------------");
d("    ","TOTAL ACTIVE","","",g,"of",e)}};a.print=function(){var a=f;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",d.apply(Math,arguments))};a.$x=function(a,b,c,d,q,e,k){var h=f;if(h){b=g(b);var p=b.ra/5;b.x=b.x;b.y+=4*p;b.va=b.va;b.ra=p;h.textAlign="center";h.fillStyle="#00FF00";f.fillText(a,l(b),b.y-10);h.strokeStyle="#00FF00";h.lineWidth=0.5;h.beginPath();h.moveTo(b.x,b.y);h.lineTo(b.x+b.va,b.y);h.lineTo(b.x+b.va,b.y+b.ra);h.lineTo(b.x,b.y+b.ra);h.closePath();h.stroke();if(!e&&!k)for(e=
1E6,k=-1E6,a=0;a<c.length;a++)e=Math.min(e,c[a]),k=Math.max(k,c[a]);h.textAlign="right";f.fillText(String(e),b.x-10,b.y+b.ra);f.fillText(String(k),b.x-10,b.y);h.textAlign="center";f.fillText(String(d),b.x,b.y+b.ra+15);f.fillText(String(q),b.x+b.va,b.y+b.ra+15);h.strokeStyle="#FF0000";h.lineWidth=1.5;h.beginPath();d=b.va/(c.length-1);k=b.ra/(k-e);for(a=0;a<c.length;a++)q=b.x+d*a,p=b.y+b.ra-(c[a]-e)*k,0==a?h.moveTo(q,p):h.lineTo(q,p);h.stroke()}};a.Uu=function(a,b,c,d,q,e,k){var h=f;if(h)for(h.textAlign=
"center",h.fillStyle="#00FF00",h.font="bold 12px Courier",c=g(c),f.fillText(b?"["+a+"]":a,l(c),c.y),0<=e&&f.fillText(e?"[M]":"[ ]",l(c)-15,c.y+30),0<=k&&f.fillText(k?"[S]":"[ ]",l(c)+15,c.y+30),a={x:0,y:0,va:0,ra:0},b=0;b<d.length;b++){e=d[b];var p="VOLUME"==e[0];if(p){k=c.y+350;var n=c.va,t=a;t.x=c.x;t.y=k;t.va=n;t.ra=250}else{k=c.y+10+50*b;var n=c.va,t=c.ra,L=a;L.x=c.x;L.y=k;L.va=n;L.ra=t}k=h;var n=a,L=b==q,R=e[0],t=e[1],I=e[2],Q=e[3],H=(Q-I)/e[4],H=1>H?Math.floor(1/H-1E-5).toFixed(0).length:0;
e=e[5]?Math.log(t/I)/Math.log(Q/I):(t-I)/(Q-I);k.textAlign="center";L?k.fillText("["+R+"]",l(n),n.y):k.fillText(R,l(n),n.y);k.strokeStyle="#00FF00";k.lineWidth=p?3:1;p?(k.textAlign="right",k.fillText(Q.toFixed(H),l(n)-10,n.y+15),k.textAlign="right",k.fillText(I.toFixed(H),l(n)-10,n.y+n.ra-15)):(k.textAlign="right",k.fillText(I.toFixed(H),n.x+28,n.y+15),k.textAlign="left",k.fillText(Q.toFixed(H),n.x+n.va-28,n.y+15));k.beginPath();if(p){var K=n.y+15+(n.ra-30)*(1-e);k.moveTo(l(n),n.y+15);k.lineTo(l(n),
n.y+n.ra-15);k.moveTo(l(n)-5,n.y+15);k.lineTo(l(n)+5,n.y+15);k.moveTo(l(n)-5,n.y+n.ra-15);k.lineTo(l(n)+5,n.y+n.ra-15);k.moveTo(l(n)-5,K);k.lineTo(l(n)+5,K)}else{var S=n.x+30+(n.va-60)*e;k.moveTo(n.x+30,n.y+15);k.lineTo(n.x+n.va-30,n.y+15);k.moveTo(n.x+30,n.y+15-5);k.lineTo(n.x+30,n.y+15+5);k.moveTo(n.x+n.va-30,n.y+15-5);k.lineTo(n.x+n.va-30,n.y+15+5);k.moveTo(S,n.y+15-5);k.lineTo(S,n.y+15+5)}k.stroke();"EQ_Q"==R?(e=Math.log(1+1/(2*t*t)+Math.sqrt((2+1/(t*t))*(2+1/(t*t))/4-1))/Math.log(2),p?(k.textAlign=
"left",k.fillText(t.toFixed(H),l(n)+10,K),k.textAlign="left",k.fillText("("+e.toFixed(H+1)+")",l(n)+10,K+10)):(k.textAlign="right",k.fillText(t.toFixed(H),S,n.y+30),k.textAlign="left",k.fillText("("+e.toFixed(H+1)+")",S,n.y+30))):p?(k.textAlign="left",k.fillText(t.toFixed(H),l(n)+10,K)):(k.textAlign="center",k.fillText(t.toFixed(H),S,n.y+30))}}};b4w.module.__renderer=function(a,r){function b(a){if(a){var b=(a.fa?k.COLOR_BUFFER_BIT:0)|(a.ia?k.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "SHADOW_CAST":a=h;break;case "DEPTH":a=f;break;case "SHORE_SMOOTHING":a=h;break;case "COLOR_PICKING":a=t;break;case "GLOW_MASK":a=u;break;default:a=n.ng}}else b=k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT,a=n.ng;k.colorMask(!0,!0,!0,!0);k.depthMask(!0);k.clearColor(a[0],a[1],a[2],a[3]);k.clear(b)}function c(a,b,c){var d=b.attributes;b=b.hn;k.bindBuffer(k.ARRAY_BUFFER,
a.Yf);for(var f=a.th,e=b.length;e--;){var g=b[e],h=d[g],g=f[g];k.enableVertexAttribArray(h);k.vertexAttribPointer(h,g.lh,k.FLOAT,!1,0,c&&1<g.frames?(g.offset+c*g.length)*w:g.offset*w)}a.Nd?(k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,a.Nd),k.drawElements(a.mode,a.count,a.Mo,0)):k.drawArrays(a.mode,0,a.count);for(e=b.length;e--;)g=b[e],k.disableVertexAttribArray(d[g])}function d(a){switch(a){case 0:return k.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 1:return k.TEXTURE_CUBE_MAP_POSITIVE_Y;case 2:return k.TEXTURE_CUBE_MAP_POSITIVE_X;
case 3:return k.TEXTURE_CUBE_MAP_NEGATIVE_X;case 4:return k.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return k.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function e(a){var b=a.qd,c=[],d={},f=[],e={},k;for(k in b){var g=!1;switch(k){case "u_proj_matrix":var h=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.ua)},g=!0;break;case "u_view_matrix":case "u_view_matrix_frag":h=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.Da)};g=!0;break;case "u_sky_vp_inverse":h=function(a,b,c,d,f,e){a.uniformMatrix4fv(b,!1,e.Gc)};g=!0;break;
case "u_camera_eye":case "u_camera_eye_frag":h=function(a,b,c,d,f,e){a.uniform3fv(b,e.Jd)};g=!0;break;case "u_camera_eye_last":h=function(a,b,c,d,f,e){a.uniform3fv(b,e.$n)};g=!0;break;case "u_camera_quat":h=function(a,b,c,d,f,e){a.uniform4fv(b,e.i)};g=!0;break;case "u_view_max_depth":h=function(a,b,c,d,f,e){a.uniform1f(b,e.ab)};g=!0;break;case "u_camera_range":h=function(a,b,c,d,f,e){a.uniform2f(b,e.lb,e.ab)};break;case "u_cam_water_depth":h=function(a,b,c){a.uniform1f(b,c.rn)};g=!0;break;case "u_waves_height":h=
function(a,b,c){a.uniform1f(b,c.bf)};break;case "u_waves_length":h=function(a,b,c){a.uniform1f(b,c.bg)};break;case "u_caust_scale":h=function(a,b,c){a.uniform1f(b,c.tn)};break;case "u_caust_bright":h=function(a,b,c){a.uniform1f(b,c.sn)};break;case "u_caust_speed":h=function(a,b,c){a.uniform2fv(b,c.un)};break;case "u_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.Cb)};break;case "u_underwater_fog_color_density":h=function(a,b,c){a.uniform4fv(b,c.yb)};break;case "u_shadow_visibility_falloff":h=
function(a,b,c){a.uniform1f(b,c.Fl)};break;case "u_bloom_key":h=function(a,b,c){a.uniform1f(b,c.nk)};break;case "u_bloom_edge_lum":h=function(a,b,c){a.uniform1f(b,c.mk)};break;case "u_time":h=function(a,b,c){a.uniform1f(b,c.time)};g=!0;break;case "u_wind":h=function(a,b,c){a.uniform3fv(b,c.Pb)};break;case "u_horizon_color":h=function(a,b,c){a.uniform3fv(b,c.Ac)};break;case "u_zenith_color":h=function(a,b,c){a.uniform3fv(b,c.Kc)};break;case "u_environment_energy":h=function(a,b,c){a.uniform1f(b,c.Id)};
break;case "u_sky_color":h=function(a,b,c){a.uniform3fv(b,c.Jh)};break;case "u_rayleigh_brightness":h=function(a,b,c){a.uniform1f(b,c.wh)};break;case "u_mie_brightness":h=function(a,b,c){a.uniform1f(b,c.gh)};break;case "u_spot_brightness":h=function(a,b,c){a.uniform1f(b,c.Mh)};break;case "u_scatter_strength":h=function(a,b,c){a.uniform1f(b,c.Dh)};break;case "u_rayleigh_strength":h=function(a,b,c){a.uniform1f(b,c.yh)};break;case "u_mie_strength":h=function(a,b,c){a.uniform1f(b,c.jh)};break;case "u_rayleigh_collection_power":h=
function(a,b,c){a.uniform1f(b,c.xh)};break;case "u_mie_collection_power":h=function(a,b,c){a.uniform1f(b,c.hh)};break;case "u_mie_distribution":h=function(a,b,c){a.uniform1f(b,c.ih)};break;case "u_light_positions":h=function(a,b,c){a.uniform3fv(b,c.ah)};break;case "u_light_directions":h=function(a,b,c){a.uniform3fv(b,c.Yg)};break;case "u_light_color_intensities":h=function(a,b,c){a.uniform3fv(b,c.Xg)};break;case "u_light_factors1":h=function(a,b,c){a.uniform4fv(b,c.Zg)};break;case "u_light_factors2":h=
function(a,b,c){a.uniform4fv(b,c.$g)};break;case "u_sun_quaternion":h=function(a,b,c){a.uniform4fv(b,c.Qh)};break;case "u_sun_intensity":h=function(a,b,c){a.uniform3fv(b,c.Ph)};break;case "u_sun_direction":h=function(a,b,c){a.uniform3fv(b,c.Ye)};break;case "u_height":h=function(a,b,c,d,f,e){a.uniform1f(b,e.height)};g=!0;break;case "u_model_matrix":h=function(a,b,c,d){a.uniformMatrix4fv(b,!1,d.G)};g=!0;break;case "u_transb":h=function(a,b,c,d){a.uniform4fv(b,d.Dj)};g=!0;break;case "u_transa":h=function(a,
b,c,d){a.uniform4fv(b,d.Cj)};g=!0;break;case "u_quat":h=function(a,b,c,d){a.uniform4fv(b,d.i)};g=!0;break;case "u_quatsb":h=function(a,b,c,d){a.uniform4fv(b,d.rj)};g=!0;break;case "u_quatsa":h=function(a,b,c,d){a.uniform4fv(b,d.qj)};g=!0;break;case "u_frame_factor":h=function(a,b,c,d){a.uniform1f(b,d.Mi)};g=!0;break;case "au_center_pos":h=jb();g=!0;break;case "au_wind_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.sm)};g=!0;break;case "au_wind_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.Yh)};
g=!0;break;case "au_detail_bending_freq":h=function(a,b,c,d){a.uniform1f(b,d.Gg)};g=!0;break;case "au_detail_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.Fg)};g=!0;break;case "au_branch_bending_amp":h=function(a,b,c,d){a.uniform1f(b,d.sg)};g=!0;break;case "u_diffuse_color":h=function(a,b,c,d,f){a.uniform4fv(b,f.xa)};g=!0;break;case "u_diffuse_intensity":h=function(a,b,c,d,f){a.uniform1f(b,f.nf)};g=!0;break;case "u_diffuse_params":h=function(a,b,c,d,f){a.uniform2fv(b,f.se)};g=!0;break;case "u_emit":h=
function(a,b,c,d,f){a.uniform1f(b,f.ve)};g=!0;break;case "u_ambient":h=function(a,b,c,d,f){a.uniform1f(b,f.Pc)};g=!0;break;case "u_specular_color":h=function(a,b,c,d,f){a.uniform3fv(b,f.Gb)};g=!0;break;case "u_specular_params":h=function(a,b,c,d,f){a.uniform2fv(b,f.Hb)};g=!0;break;case "u_reflect_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.Al)};g=!0;break;case "u_mirror_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.bj)};g=!0;break;case "u_grass_map_dim":h=function(a,b,c,d,f){a.uniform3fv(b,f.Lb)};
g=!0;break;case "u_grass_size":h=function(a,b,c,d,f){a.uniform1f(b,f.Go)};g=!0;break;case "u_cube_fog":h=function(a,b,c,d,f){a.uniformMatrix4fv(b,!1,f.Uc)};break;case "u_jitter_amp":h=function(a,b,c,d,f){a.uniform1f(b,f.bl)};g=!0;break;case "u_jitter_freq":h=function(a,b,c,d,f){a.uniform1f(b,f.cl)};g=!0;break;case "u_wireframe_mode":h=function(a,b,c,d,f){a.uniform1i(b,f.Lj)};break;case "u_wireframe_edge_color":h=function(a,b,c,d,f){a.uniform3fv(b,f.Jq)};break;case "u_halo_size":h=function(a,b,c,d,
f){a.uniform1f(b,f.Fw)};g=!0;break;case "u_halo_hardness":h=function(a,b,c,d,f){a.uniform1f(b,f.Cw)};g=!0;break;case "u_halo_rings_color":h=function(a,b,c,d,f){a.uniform3fv(b,f.Ew)};g=!0;break;case "u_halo_lines_color":h=function(a,b,c,d,f){a.uniform3fv(b,f.Dw)};g=!0;break;case "u_halo_stars_blend":h=function(a,b,c,d,f){a.uniform1f(b,f.Gw)};g=!0;break;case "u_halo_stars_height":h=function(a,b,c,d,f){a.uniform1f(b,f.Hw)};g=!0;break;case "u_fresnel_params":h=function(a,b,c,d,f){a.uniform4fv(b,f.$c)};
g=!0;break;case "u_texture_scale":h=function(a,b,c,d,f){a.uniform3fv(b,f.Hc)};g=!0;break;case "u_parallax_scale":h=function(a,b,c,d,f){a.uniform1f(b,f.tl)};g=!0;break;case "u_color_id":h=function(a,b,c,d,f){a.uniform3fv(b,f.ut)};g=!0;break;case "u_line_points":h=function(a,b,c,d,f){a.uniform3fv(b,f.kx)};g=!0;break;case "u_diffuse_color_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.Wc)};g=!0;break;case "u_specular_color_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.Bz)};g=!0;break;case "u_normal_factor":h=
function(a,b,c,d,f){a.uniform1f(b,f.Hx)};g=!0;break;case "u_colormap0_uv_velocity":h=function(a,b,c,d,f){a.uniform2fv(b,f.hc)};g=!0;break;case "u_normalmap0_uv_velocity":h=function(a,b,c,d,f){a.uniform2fv(b,f.Ee[0])};g=!0;break;case "u_normalmap1_uv_velocity":h=function(a,b,c,d,f){a.uniform2fv(b,f.Ee[1])};g=!0;break;case "u_normalmap2_uv_velocity":h=function(a,b,c,d,f){a.uniform2fv(b,f.Ee[2])};g=!0;break;case "u_normalmap3_uv_velocity":h=function(a,b,c,d,f){a.uniform2fv(b,f.Ee[3])};g=!0;break;case "u_normalmap0_scale":h=
function(a,b,c,d,f){a.uniform2fv(b,f.Af[0])};g=!0;break;case "u_normalmap1_scale":h=function(a,b,c,d,f){a.uniform2fv(b,f.Af[1])};g=!0;break;case "u_normalmap2_scale":h=function(a,b,c,d,f){a.uniform2fv(b,f.Af[2])};g=!0;break;case "u_normalmap3_scale":h=function(a,b,c,d,f){a.uniform2fv(b,f.Af[3])};g=!0;break;case "u_foam_factor":h=function(a,b,c,d,f){a.uniform1f(b,f.Jk)};g=!0;break;case "u_foam_uv_freq":h=function(a,b,c,d,f){a.uniform2fv(b,f.ov)};g=!0;break;case "u_foam_mag":h=function(a,b,c,d,f){a.uniform2fv(b,
f.mv)};g=!0;break;case "u_foam_scale":h=function(a,b,c,d,f){a.uniform2fv(b,f.nv)};g=!0;break;case "u_shallow_water_col":h=function(a,b,c,d,f){a.uniform3fv(b,f.Re)};g=!0;break;case "u_shore_water_col":h=function(a,b,c,d,f){a.uniform3fv(b,f.Se)};g=!0;break;case "u_water_shallow_col_fac":h=function(a,b,c,d,f){a.uniform1f(b,f.Gl)};g=!0;break;case "u_water_shore_col_fac":h=function(a,b,c,d,f){a.uniform1f(b,f.Il)};g=!0;break;case "u_p_starttime":h=function(a,b,c,d,f){a.uniform1f(b,f.tp)};g=!0;break;case "u_p_endtime":h=
function(a,b,c,d,f){a.uniform1f(b,f.sp)};g=!0;break;case "u_p_cyclic":h=function(a,b,c,d,f){a.uniform1i(b,f.rp)};g=!0;break;case "u_p_max_lifetime":h=function(a,b,c,d,f){a.uniform1f(b,f.Sx)};g=!0;break;case "u_p_fade_in":h=function(a,b,c,d,f){a.uniform1f(b,f.Ox)};g=!0;break;case "u_p_fade_out":h=function(a,b,c,d,f){a.uniform1f(b,f.Px)};g=!0;break;case "u_p_size":h=function(a,b,c,d,f){a.uniform1f(b,f.Ux)};g=!0;break;case "u_p_alpha_start":h=function(a,b,c,d,f){a.uniform1f(b,f.Mx)};g=!0;break;case "u_p_alpha_end":h=
function(a,b,c,d,f){a.uniform1f(b,f.Lx)};g=!0;break;case "u_p_nfactor":h=function(a,b,c,d,f){a.uniform1f(b,f.Tx)};g=!0;break;case "u_p_gravity":h=function(a,b,c,d,f){a.uniform1f(b,f.Qx)};g=!0;break;case "u_p_mass":h=function(a,b,c,d,f){a.uniform1f(b,f.Rx)};g=!0;break;case "u_p_size_ramp":h=function(a,b,c,d,f){a.uniform2fv(b,f.Vx)};g=!0;break;case "u_p_color_ramp":h=function(a,b,c,d,f){a.uniform4fv(b,f.Nx)};g=!0;break;case "u_p_wind":h=function(a,b,c,d,f){a.uniform3fv(b,f.Wx)};g=!0;break;case "u_texel_size":h=
function(a,b,c,d,f){a.uniform2fv(b,f.ca)};g=!0;break;case "u_p_time":h=function(a,c,d,f,e){a.uniform1f(b.u_p_time,1===e.rp?d.time%(e.sp-e.tp):f.time)};g=!0;break;case "u_va_frame_factor":h=function(a,b,c,d){a.uniform1f(b,d.rA)};g=!0;break;case "u_v_light_matrix":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.qA)};g=!0;break;case "u_b_light_matrix":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Fs)};break;case "u_p_light_matrix0":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Df[0])};g=!0;break;case "u_p_light_matrix1":h=
function(a,b,c){a.uniformMatrix4fv(b,!1,c.Df[1])};g=!0;break;case "u_p_light_matrix2":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Df[2])};g=!0;break;case "u_p_light_matrix3":h=function(a,b,c){a.uniformMatrix4fv(b,!1,c.Df[3])};g=!0;break;case "u_motion_blur_exp":h=function(a,b,c){a.uniform1f(b,c.Ax)};g=!0;break;case "u_refl_plane":h=function(a,b,c){a.uniform4fv(b,c.vb)};break;case "u_radial_blur_step":h=function(a,b,c){a.uniform1f(b,c.zl)};break;case "u_god_rays_intensity":h=function(a,b,c){a.uniform1f(b,
c.Wk)};break;case "u_ssao_radius_increase":h=function(a,b,c){a.uniform1f(b,c.Wl)};break;case "u_ssao_dithering_amount":h=function(a,b,c){a.uniform1f(b,c.Rl)};break;case "u_ssao_gauss_center":h=function(a,b,c){a.uniform1f(b,c.Sl)};break;case "u_ssao_gauss_width_square":h=function(a,b,c){a.uniform1f(b,c.Ul)};break;case "u_ssao_gauss_width_left_square":h=function(a,b,c){a.uniform1f(b,c.Tl)};break;case "u_ssao_influence":h=function(a,b,c){a.uniform1f(b,c.Vl)};break;case "u_ssao_dist_factor":h=function(a,
b,c){a.uniform1f(b,c.Ql)};break;case "u_dof_dist":h=function(a,b,c,d,f,e){a.uniform1f(b,e.Fd)};g=!0;break;case "u_dof_front":h=function(a,b,c,d,f,e){a.uniform1f(b,e.Hg)};g=!0;break;case "u_dof_rear":h=function(a,b,c,d,f,e){a.uniform1f(b,e.Jg)};g=!0;break;case "u_glow_intensity":h=function(a,b,c,d,f){a.uniform1f(b,f.Ld)};g=!0;break;case "u_glow_color":h=function(a,b,c){a.uniform3fv(b,c.Ni)};break;case "u_draw_glow":h=function(a,b,c){a.uniform1f(b,c.Tu)};g=!0;break;case "u_blur_depth_edge_size":h=function(a,
b,c){a.uniform1f(b,c.pg)};break;case "u_blur_depth_diff_threshold":h=function(a,b,c){a.uniform1f(b,c.og)};break;case "u_brightness":h=function(a,b,c){a.uniform1f(b,c.tg)};break;case "u_contrast":h=function(a,b,c){a.uniform1f(b,c.Ag)};break;case "u_exposure":h=function(a,b,c){a.uniform1f(b,c.Ng)};break;case "u_saturation":h=function(a,b,c){a.uniform1f(b,c.Ch)};break;default:h=null}h&&(g?(c.push(k),d[k]=h):(f.push(k),e[k]=h))}a.fm=d;a.zq=c;a.rh=e;a.Ap=f}var l=r("__config"),g=r("__debug"),p=r("__textures"),
n=l.u,k,h=[1,1,1,1],f=[1,1,1,1],t=[0,0,0,1],u=[0,0,0,0],w=4,s=!1,B=new Uint8Array(4);a.mc=function(a){k=a;a=n.ng;k.clearColor(a[0],a[1],a[2],a[3]);k.clearDepth(1);k.enable(k.DEPTH_TEST);k.depthFunc(k.LEQUAL);k.enable(k.CULL_FACE);k.frontFace(k.CCW);k.cullFace(k.BACK);k.enable(k.BLEND);k.blendFunc(k.ONE,k.ONE_MINUS_SRC_ALPHA)};a.Ci=function(a){if(a.K){var f=a.k;k.bindFramebuffer(k.FRAMEBUFFER,f.Kd);if(a.ek){var h=f.Na;k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,h.xb,h.Ua,0)}k.viewport(0,
0,f.width,f.height);b(a);a.O?k.enable(k.BLEND):k.disable(k.BLEND);a.kb?k.enable(k.DEPTH_TEST):k.disable(k.DEPTH_TEST);if(a.Ra){for(var f=a.k,h=a.o,n=0;n<h.length;n++){var p=h[n],l=p.h,s=l.Zb;k.useProgram(s.pj);var p=p.Wa,u=s.qd;s.rh||e(s);for(var t=s.rh,s=s.Ap,w=s.length;w--;){var r=s[w];t[r](k,u[r],a,p,l,f)}}a.Ra=!1}"SHADOW_CAST"==a.type?(k.enable(k.POLYGON_OFFSET_FILL),k.polygonOffset(1,1),k.cullFace(k.BACK)):"MAIN_REFLECT"==a.type?(k.disable(k.POLYGON_OFFSET_FILL),k.cullFace(k.FRONT)):(k.disable(k.POLYGON_OFFSET_FILL),
k.cullFace(k.BACK));f=a.k;h=a.o;for(n=0;n<h.length;n++)if(u=h[n],u.K){l=a;r=f;p=u.Wa;w=u.h;u=w.Zb;u.fm||e(u);k.useProgram(u.pj);for(var t=w.fc,s=u.qd,H=u.fm,K=u.zq,S=K.length;S--;){var P=K[S];H[P](k,s[P],l,p,w,r)}r=w.vt;k.colorMask(r,r,r,r);k.depthMask(w.M);w.oa?k.enable(k.CULL_FACE):k.disable(k.CULL_FACE);r=w.Ba;w=w.nb;H=r.length|0;if(0!==H)if(1===H)k.activeTexture(k.TEXTURE0),k.bindTexture(r[0].xb,r[0].Ua);else for(K=0;K<H;K++)S=r[K],P=w[K],k.activeTexture(k.TEXTURE0+K),k.bindTexture(S.xb,S.Ua),
k.uniform1i(s[P],K);if("SKY"==l.type){s=l;w=s.k;r=u.qd;H=s.Au;for(K=0;6>K;K++)if(k.uniformMatrix4fv(r.u_cube_view_matrix,!1,H[K]),k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,d(K),w.Na.Ua,0),c(t,u,p.Jj),s.dj&&0!=K){var S=s,P=K,O=B;k.readPixels(191,191,1,1,k.RGBA,k.UNSIGNED_BYTE,O);255!=O[0]&&255!=O[1]&&255!=O[2]||k.readPixels(191,220,1,1,k.RGBA,k.UNSIGNED_BYTE,O);var T=O[0],m=O[1],O=O[2],T=T/255,m=m/255,O=O/255;1===P?(S.Uc[3]=T,S.Uc[7]=m,S.Uc[11]=O):(S.Uc[4*(P-2)]=T,S.Uc[4*(P-2)+1]=m,
S.Uc[4*(P-2)+2]=O)}s.ti++}else c(t,u,p.Jj);l.ti++}g.it("draw subscene: "+a.type);k.bindFramebuffer(k.FRAMEBUFFER,null)}};a.clear=b;a.qy=function(a,b,c){var d,f,e;d||(d=1);f||(f=1);e||(e=new Uint8Array(4*d*f));if(e.length!=4*d*f)throw"Wrong storage";k.bindFramebuffer(k.FRAMEBUFFER,a);k.readPixels(b,c,d,f,k.RGBA,k.UNSIGNED_BYTE,e);k.bindFramebuffer(k.FRAMEBUFFER,null);return e};a.eA=function(a){var b=a.Zb;k.useProgram(b.pj);var c=b.qd,d=b.rh;d||e(b);d.u_cube_fog(k,c.u_cube_fog,null,null,a,null)};a.Jp=
function(a,b){var c=k.createFramebuffer();k.bindFramebuffer(k.FRAMEBUFFER,c);if(a){var d=a,f=d.Ua,d=d.xb==k.TEXTURE_CUBE_MAP?k.TEXTURE_CUBE_MAP_NEGATIVE_Z:d.xb;k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,d,f,0)}p.Uo(b)?k.framebufferRenderbuffer(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,k.RENDERBUFFER,b.Xh):p.Vg(b)&&(d=b,f=d.Ua,d=d.xb,k.framebufferTexture2D(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,d,f,0));g.et();k.bindFramebuffer(k.FRAMEBUFFER,null);return c};a.vy=function(a,b,c,d,f){null==a?(k.bindFramebuffer(k.FRAMEBUFFER,
a),k.viewport(0,0,d,f),k.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT)):(p.Vg(b)&&k.deleteTexture(b.Ua),p.Uo(c)?k.deleteRenderbuffer(c.Xh):p.Vg(c)&&k.deleteTexture(c.Ua),k.deleteFramebuffer(a))};a.ox=function(){s=!0};a.dA=function(){s=!1};a.cx=function(){return s};a.pa=function(){s=!1}};b4w.module.__shaders=function(a,r){function b(a,b,d){var f=a.W;"string"==typeof d&&(a=c(a,d))&&(d=a[1]);for(a=0;a<f.length;a++)if(f[a][0]==b){f[a][1]=d;return}f.push([b,d])}function c(a,b){for(var c=a.W,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function d(a,b){var c=a+b;if(z[c])return z[c];if(s){var d=s[b];if(!d)return null}else{d=u.pw(a+b);if(!d)return null;d=B.yp.parse(d)}return z[c]=d}function e(a,b,c,f){function e(b){b=b.a;for(var c=0;c<b.length;c++){var C=b[c];switch(C.type){case "condition":a:for(var C=
C.a,n=0;n<C.length;n++){var s=C[n];switch(s.type){case "if":case "elif":var u=s.c;try{var v,B=l(u,k,p,!0);v=t.yp.parse(B)}catch(z){throw"Failed to process #"+s.type+" expression: "+u.join(" ");}if(v){e(s.group);break a}break;case "else":e(s.group);break;case "ifdef":s.name in k&&e(s.group);break;case "ifndef":s.name in k||e(s.group)}}break;case "include":C=d(q,y+C.file);e(C);break;case "var":case "export":case "import":break;case "define":n=C.name;k[n]=C.b;C.$&&(p[n]=C.$);break;case "error":throw"Shader error: #error "+
C.b.join(" ");case "line":break;case "pragma":g.push("#pragma "+C.name+" "+C.b.join(" "));break;case "undef":C=C.name;delete k[C];delete p[C];break;case "warning":h.warn("Shader warning: #warning "+C.b.join(" "));break;case "extension":g.push("#extension "+l(C.b,k,p,!1));break;case "#":break;case "node":T[C.name]=C.group.a;break;case "nodes_global":C=f;for(n=0;n<C.length;n++)if(s=C[n],u=T[s.id])for(var w=0,D=0;D<u.length;D++){var E=u[D];"node_param"==E.type&&(E=E.qualifier.join(" ")+" ","vert"==a?
E+=s.Wh[w]:"frag"==a&&(E+=s.$[w],null!==s.xp[w]&&(E+=" = "+s.xp[w])),E+=";",g.push(E),w++)}break;case "nodes_main":C=f;for(n=0;n<C.length;n++)if(s=C[n],u=T[s.id]){var x=E=0,P=0;s.Ah={};for(w=0;w<u.length;w++)switch(D=u[w],D.type){case "node_in":var G=s.X[E];if(null!==s.Po[E]){var aa=D.qualifier.join(" ")+" ",aa=aa+G,aa=aa+(" = "+s.Po[E]),aa=aa+";";g.push(aa)}s.Ah[D.name]=G;E++;break;case "node_out":G=s.Sa[x];aa=D.qualifier.join(" ")+" ";aa+=G;aa+=";";g.push(aa);s.Ah[D.name]=G;x++;break;case "node_param":"vert"==
a?G=s.Wh[P]:"frag"==a&&(G=s.$[P]),s.Ah[D.name]=G,P++}}for(n=0;n<C.length;n++)if(s=C[n],u=T[s.id])for(w=0;w<u.length;w++)if(D=u[w],"textline"==D.type){E=[];for(x=0;x<D.b.length;x++)P=D.b[x],P in s.Ah?E.push(s.Ah[P]):E.push(P);g.push(l(E,k,p,!1))}break;case "textline":g.push(l(C.b,k,p,!1));break;default:throw"Unknown element type: "+C.type;}}}for(var g=[],k={},n=0;n<c.length;n++)k[c[n][0]]=[c[n][1]];if(f)for(n=0;n<f.length;n++)k["USE_NODE_"+f[n].id]=[1];var p={},T={};e(b);return g.join("\n")}function l(a,
b,c,d){var f=[];g(a,b,c,d,f);return f.join(" ")}function g(a,b,c,d,f){for(var e=0;e<a.length;e++){var h=a[e];h in b?(h=b[h],0==h.length&&d?f.push(0):g(h,b,c,d,f)):f.push(h)}}function p(a,b,c,d,e){if(E){e=d==x.VERTEX_SHADER?e.da:e.ba;var h=w.Ko(c),g=M[h];g?g.count++:(g={count:1,pz:e,Nw:h},M[h]=g)}d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);f.kt(d,b,c);return d}function n(a){return a%1?String(a):String(a)+".0"}var k=r("__config"),h=r("__print"),f=r("__debug"),t=r("__gpp_eval"),u=r("__assets"),
w=r("__util");if(b4w.module_check(k.Db.bq))var s=r(k.Db.bq),B=null;else s=null,B=r("__gpp_parser");var q=k.Db.qz,y=k.Db.rz,D={},z={},E=!1,M=[],x;a.mc=function(a){x=a};a.S=b;a.Zv=c;a.gC=function(a,b){for(var c=a.W,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.Vy=function(a){a.W=[];for(var c="ALPHA ALPHA_CLIP ALPHA_MAP BEND_CENTER_ONLY CAUSTICS CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING HAIR_BILLBOARD_JITTERED HAIR_BILLBOARD_SPHERICAL MAIN_BEND_COL MAX_BONES NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PROCEDURAL_FOG REFLECTION REFLECTION_PASS REFLECTIVE REFRACTIVE SHORE_SMOOTHING SKINNED SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_MIRROR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA NUM_LIGHTS MAX_STEPS CSM_SECTION_DIST0 CSM_SECTION_DIST1 CSM_SECTION_DIST2 CSM_SECTION_DIST3 BILLBOARD_ALIGN SHADOW_SRC SHADOW_DST POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER HAIR_BILLBOARD HAIR_BILLBOARD_RANDOM PRECISION WIREFRAME_QUALITY".split(" "),
d=0;d<c.length;d++){var f=c[d],e;switch(f){case "ALPHA":case "ALPHA_CLIP":case "ALPHA_MAP":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "HAIR_BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PROCEDURAL_FOG":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTIVE":case "REFRACTIVE":case "SHORE_SMOOTHING":case "SKINNED":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_MIRROR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "HAIR_BILLBOARD":case "HAIR_BILLBOARD_RANDOM":case "WIREFRAME_QUALITY":e=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "DEPTH_RGBA":case "HAIR_BILLBOARD_SPHERICAL":case "NUM_LIGHTS":case "MAX_STEPS":e=1;break;case "CSM_SECTION_DIST0":e=2.0001;break;case "CSM_SECTION_DIST1":e=4.0001;break;case "CSM_SECTION_DIST2":e=7.0001;break;case "CSM_SECTION_DIST3":e=9.0001;break;case "AA_METHOD":e="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":e="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":e="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":e="POST_EFFECT_NONE";break;
case "SHADOW_SRC":e="SHADOW_SRC_NONE";break;case "SHADOW_DST":e="SHADOW_DST_NONE";break;case "SSAO_QUALITY":e="SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":e="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":e="TEXTURE_COORDS_UV";break;case "PRECISION":e=k.u.precision;break;default:h.error("Unknown directive ("+a.da+", "+a.ba+"): "+f)}b(a,f,e)}};a.XB=function(a){return a.da};a.qo=function(a){return a.ba};a.Qw=function(a,d){for(var f=d.W,e=0;e<f.length;e++){var h=f[e][0],g=f[e][1];c(a,h)&&b(a,
h,g)}};a.Qk=function(a,b){var c=JSON.stringify(a)+JSON.stringify(b),g=D[c];if(g)return g;var k=a.ba,g=d(q,a.da),k=d(q,k);if(!g||!k)return null;var n=a.W||[],l=e("vert",g,n,b),n=e("frag",k,n,b),g=x,s=p(g,c,l,g.VERTEX_SHADER,a),u=p(g,c,n,g.FRAGMENT_SHADER,a),k=g.createProgram();g.attachShader(k,s);g.attachShader(k,u);g.linkProgram(k);g.validateProgram(k);g.getProgramParameter(k,g.VALIDATE_STATUS)==g.VA&&h.error("B4W Error - shader program is not valid",c);f.lt(k,c,s,u,l,n);l={Gq:s,ho:u,pj:k,attributes:{},
qd:{},hn:[],Ap:[],zq:[],rh:null,fm:null,Ja:a};s=g.getProgramParameter(k,g.ACTIVE_ATTRIBUTES);for(n=0;n<s;n++)u=g.getActiveAttrib(k,n).name,l.attributes[u]=g.getAttribLocation(k,u),l.hn.push(u);s=g.getProgramParameter(k,g.ACTIVE_UNIFORMS);for(n=0;n<s;n++)u=g.getActiveUniform(k,n).name.split("[0]").join(""),l.qd[u]=g.getUniformLocation(k,u);return D[c]=g=l};a.Du=function(){return M};a.Uv=function(){return D};a.pa=function(){for(var a in D){var b=D[a];x.deleteProgram(b.pj);x.deleteShader(b.Gq);x.deleteShader(b.ho);
delete D[a]}for(var c in z)delete z[c];for(var d in M)delete M[d]};a.vB=function(a){var b=a.W;h.log("Shader: "+a.da+" "+a.ba+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)h.log("  "+b[a][0],b[a][1])};a.s=function(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return n(a);case 2:return"vec2("+n(a[0])+","+n(a[1])+")";case 3:return"vec3("+n(a[0])+","+n(a[1])+","+n(a[2])+")";case 4:return"vec4("+n(a[0])+","+n(a[1])+","+n(a[2])+","+n(a[3])+")";case 9:return"mat3("+n(a[0])+","+n(a[1])+
","+n(a[2])+","+n(a[3])+","+n(a[4])+","+n(a[5])+","+n(a[6])+","+n(a[7])+","+n(a[8])+")";case 16:return"mat4("+n(a[0])+","+n(a[1])+","+n(a[2])+","+n(a[3])+","+n(a[4])+","+n(a[5])+","+n(a[6])+","+n(a[7])+","+n(a[8])+","+n(a[9])+","+n(a[10])+","+n(a[11])+","+n(a[12])+","+n(a[13])+","+n(a[14])+","+n(a[15])+")";default:throw"Wrong glsl value dimension";}};a.yn=function(a,b){return b in a.qd?!0:!1}};b4w.module.shader_texts=function(a){a["color_id.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec3 u_color_id ; uniform vec4 u_diffuse_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_glow_intensity",";"]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float b = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float b = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",
b:"if ( b < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["USE_GLOW"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_glow_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["color_id.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},
{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",
a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",
a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",
b:"void main ( ) { vec3 ci = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"ci = mix ( ci , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 cj = vec3 ( 0.0 ) ; vec3 ck = vec3 ( 0.0 ) ; vec3 cl = vec3 ( 0.0 ) ; bq ( ci , cj , ck , cl ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:["vec3","cm","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cm = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 cn = ( u_model_matrix * vec4 ( cm , 1.0 ) ) . xyz ; mat4 co = ae ( u_camera_eye , cn , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",
a:[{type:"textline",b:"vec3 cp = ( u_model_matrix * vec4 ( cm , 1.0 ) ) . xyz ; co = co * S ( u_wind , u_time , u_jitter_amp , u_jitter_freq , cp ) ;".split(" ")}]}}]},{type:"textline",b:"c cq = al ( ci - cm , cm , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , co ) ; cq . b = cn ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c cq = al ( ci , cm , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","cr","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cr = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ch ( cq . a , cq . b , cr ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ao ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"textline",
b:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( cq . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",b:["uniform","float","u_shadow_visibility_falloff",
";"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_DST == SHADOW_DST_NONE || SHADOW_DST == SHADOW_DST_RGBA || SHADOW_DST == SHADOW_DST_VSM".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","float","cr",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cs",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ct",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cu",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cv",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cw",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cx",";"]}]}}]},{type:"include",file:"shadow.glslf"},{type:"textline",b:["void","main",
"(",")","{"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"float dg = ( texture2D ( u_sampler , a ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float dg = u_diffuse_color . a ;".split(" ")}]}}]},{type:"textline",b:"if ( dg < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_NONE"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["SHADOW_DST","==","SHADOW_DST_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cm ( cr ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_RGBA"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = cm ( cr ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_DEPTH"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_VSM"],
group:{type:"group",a:[{type:"textline",b:"float dh = cr ; float di = dh * dh ; gl_FragColor = vec4 ( dh , di , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["SHADOW_DST","==","SHADOW_DST_MASK"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( c_ ( cx . z , u_shadow_visibility_falloff ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:["}"]}]};a["depth.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"dynamic_grass.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute",
"vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",
b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS",
"||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_DST == SHADOW_DST_NONE || SHADOW_DST == SHADOW_DST_RGBA || SHADOW_DST == SHADOW_DST_VSM".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_DST == SHADOW_DST_NONE || SHADOW_DST == SHADOW_DST_RGBA || SHADOW_DST == SHADOW_DST_VSM".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","cr",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cs",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ct",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cu",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec4","cv",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cw",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cx",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 ee = a_position ;".split(" ")},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"ee = mix ( ee , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 ef = vec3 ( 0.0 ) ; vec3 eg = vec3 ( 0.0 ) ; vec3 eh = vec3 ( 0.0 ) ; bq ( ee , ef , eg , eh ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["vec3","ei","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ei = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c ej = dY ( ee , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ei , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ek = ( u_model_matrix * vec4 ( ei , 1.0 ) ) . xyz ; mat4 el = ae ( u_camera_eye , ek , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 em = ( u_model_matrix * vec4 ( ei , 1.0 ) ) . xyz ; el = el * S ( u_wind , u_time , u_jitter_amp , u_jitter_freq , em ) ;".split(" ")}]}}]},{type:"textline",b:"c ej = al ( ee - ei , ei , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , el ) ; ej . b = ek ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"c ej = al ( ee , ei , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","en","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 en = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",
b:"ch ( ej . a , ej . b , en ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 eo = u_view_matrix * vec4 ( ej . a , 1.0 ) ; vec4 ep = u_proj_matrix * eo ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ao ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"d_ ( ej . a ) ; cx = eo ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",
c:"SHADOW_DST == SHADOW_DST_NONE || SHADOW_DST == SHADOW_DST_RGBA || SHADOW_DST == SHADOW_DST_VSM".split(" "),group:{type:"group",a:[{type:"textline",b:"cr = - eo . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","ep",";","}"]}]};a["grass_map.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","ee",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","ee",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ee",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",a:[{type:"textline",b:["gl_FragColor","=","ee",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( ee , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , ee ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",
b:["}"]}]};a["grass_map.glslv"]={type:"group",a:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&",
"HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ee",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","float","ee",";"]}]}}]}]}},{type:"else",
group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ee",";"]}]}}]}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 ef = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 eg = ae ( u_camera_eye , ef , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],
group:{type:"group",a:[{type:"textline",b:"eg = eg * S ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",b:"c eh = al ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , eg ) ; eh . b = ef ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c eh = al ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 ei = u_proj_matrix * u_view_matrix * vec4 ( eh . a , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_SIZE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:"ee = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["ee","=","a_grass_size",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS_COLOR"],group:{type:"group",a:[{type:"textline",b:["ee","=","a_grass_color",";"]}]}}]}]}}]},
{type:"textline",b:["gl_Position","=","ei",";","}"]}]};a["halo.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"var",name:"NUM_LINES",b:["0"]},{type:"var",name:"NUM_RINGS",b:["0"]},{type:"var",name:"NUM_STARS",b:["0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 em ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying float en ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS",
">","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"const int eo = NUM_RINGS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const int eo = NUM_LINES ;".split(" ")}]}}]},{type:"textline",b:"float eq ( float ep ) { return ep - floor ( ep * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"void ez ( inout float er , in float es [ eo ] , in float et ) { for ( int eu = NUM_RINGS ; eu > 0 ; eu -- ) { float ev = 40.0 * es [ eu ] ; float ew = 300.0 * ( eq ( ev ) - 0.005 ) ; float ex = ev ; float ey = abs ( ex * ( u_halo_size * ew - et ) ) ; er += 1.0 - min ( ey , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"void eI ( inout float eA , in float eB [ eo ] , in float eC ) { for ( int eD = NUM_LINES ; eD > 0 ; eD -- ) { float eE = eB [ eD ] ; float eF = eE ; float eG = 1000.0 * ( eq ( eE ) - 0.005 ) ; float eH = 20.0 * abs ( eF * a . x + eG * a . y ) ; eA += 1.0 - min ( eH , 1.0 ) ; } eA *= eC ; }".split(" ")}]}}]},{type:"textline",b:"void eP ( inout float eJ , in vec2 eK ) { float eL , eM ; eM = atan ( eK . y , eK . x ) ; eM *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float eN = cos ( eM ) ; float eO = sin ( eM ) ; eM = ( eN * eK . x + eO * eK . y ) * ( eN * eK . y - eO * eK . x ) ; eL = abs ( eM ) ; if ( eL < 1.0 ) { eL = ( 0.01 * u_halo_size ) / ( eL ) ; eJ *= sqrt ( min ( eL , 1.0 ) ) ; } } void main ( ) { float eQ = ( a . x * a . x + a . y * a . y ) ; float eR = sqrt ( eQ ) ; eQ = max ( 1.0 - eQ , 0.0 ) ; eQ = pow ( eQ , u_halo_hardness ) ; float eS = u_diffuse_color . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_RINGS","||","NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float eT [ eo ] ; for ( int eU = 0 ; eU < eo ; eU ++ ) { eT [ eU ] = fract ( en / float ( eU ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"float eV = 0.0 ; ez ( eV , eT , eR ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"float eW = 0.0 ; eI ( eW , eT , eQ ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["NUM_STARS"],group:{type:"group",a:[{type:"textline",b:"eP ( eQ , a ) ;".split(" ")}]}}]},{type:"textline",b:"eQ *= eS ; vec3 eX = u_diffuse_color . rgb * eQ ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_RINGS"],group:{type:"group",a:[{type:"textline",b:"eV *= eQ ; eX += u_halo_rings_color * eV ; eQ += eV ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["NUM_LINES"],group:{type:"group",a:[{type:"textline",b:"eW *= eS ; eX += u_halo_lines_color * eW ; eQ += eW ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"eQ *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float eY = u_halo_stars_blend * ( em . y - u_halo_stars_height ) ; eQ *= clamp ( eY , 0.0 , 1.0 ) ; eQ *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"ei ( eX ) ; el ( eX , eQ ) ; gl_FragColor = vec4 ( eX , eQ ) ; }".split(" ")}]};
a["halo.glslv"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 a ; varying float en ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["varying",
"vec4","em",";"]}]}}]},{type:"textline",b:"void main ( ) { vec3 eo = a_position ; a = a_halo_bb_vertex * 2.0 ; en = fract ( eo . x + eo . y + eo . z ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"mat4 ep = B ( eo , u_view_matrix ) ; mat4 eq = u_view_matrix ; eq [ 3 ] [ 0 ] = 0.0 ; eq [ 3 ] [ 1 ] = 0.0 ; eq [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 ep = B ( eo , u_view_matrix ) ;".split(" ")}]}}]},
{type:"textline",b:"vec4 er = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 es = ep * er ;".split(" ")},{type:"condition",a:[{type:"if",c:["SKY_STARS"],group:{type:"group",a:[{type:"textline",b:"vec4 et = u_proj_matrix * eq * es ; et . z = 0.99999 * et . w ;".split(" ")},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["em","=","es",";"]}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 et = u_proj_matrix * u_view_matrix * es ;".split(" ")}]}}]},
{type:"textline",b:["gl_Position","=","et",";","}"]}]};a["line.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};a["line.glslv"]={type:"group",a:[{type:"var",name:"NUM_POINTS",b:["0"]},{type:"textline",b:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 eo = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( eo , 1.0 ) ; }".split(" ")}]};
a["main.glslf"]={type:"group",a:[{type:"var",name:"PARALLAX_STEPS",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"caustics.glslf"}]}}]},
{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"TEXCOORD",b:"( TEXTURE_COLOR && TEXTURE_COORDS == TEXTURE_COORDS_UV || TEXTURE_STENCIL_ALPHA_MASK || TEXTURE_SPEC || TEXTURE_NORM )".split(" ")},{type:"textline",b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ; uniform float u_shadow_visibility_falloff ; uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",
c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC","&&","!","ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_specmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform float u_normal_factor ; uniform vec2 u_normalmap0_uv_velocity ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform float u_diffuse_color_factor ; uniform vec2 u_colormap0_uv_velocity ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",b:"uniform vec3 u_specular_color ; uniform vec2 u_specular_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM","&&","PARALLAX"],
group:{type:"group",a:[{type:"textline",b:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"textline",b:"varying vec3 hZ ; varying vec3 h_ ; varying vec3 ia ; varying vec4 cx ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],
group:{type:"group",a:[{type:"textline",b:["varying","vec4","ib",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ic",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying",
"vec4","cs",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ct",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cu",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cv",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",
a:[{type:"textline",b:["varying","vec3","cw",";"]}]}}]},{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float iB = h_ . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["vec2","iC","=","a",";"]}]}}]},{type:"textline",b:["vec3","iD","=","ia",";"]},{type:"condition",
a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( ! gl_FrontFacing ) iD = - iD ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"vec3 iE = cross ( iD , ib . xyz ) * ib . w ; mat3 iF = mat3 ( ib . xyz , iE , iD ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM","&&","PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 iG = normalize ( hZ * iF ) ; float iH = 1.0 / PARALLAX_STEPS ; vec2 iI = iG . xy * u_parallax_scale / ( PARALLAX_STEPS * iG . z ) ; float iJ = 1.0 ; float iK = texture2D ( u_normalmap0 , iC ) . a ; for ( float iL = 1.0 ; iL <= PARALLAX_STEPS ; iL ++ ) { if ( iK < iJ ) { iJ -= iH ; iC -= iI ; iK = texture2D ( u_normalmap0 , iC ) . a ; } } vec2 iM = iC + iI ; float iN = texture2D ( u_normalmap0 , iM ) . a - ( iJ + iH ) ; float iO = iK - iJ ; float iP = iO / ( iO - iN ) ; iC = iP * iM + ( 1.0 - iP ) * iC ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"vec4 iQ = texture2D ( u_normalmap0 , iC + u_time * u_normalmap0_uv_velocity ) ; vec3 iR = iQ . rgb - 0.5 ; iR = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , iR , u_normal_factor ) ; vec3 iS = iF * iR ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec3","iS","=","iD",";"]}]}}]},{type:"textline",b:"iS = normalize ( iS ) ; vec3 iT = normalize ( hZ ) ; float iU = 0.5 * iS . y + 0.5 ; vec3 iV = u_environment_energy * mix ( u_horizon_color , u_zenith_color , iU ) ; vec3 iW = u_ambient * iV ;".split(" ")},
{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec3 iX = ic ; eg ( iX ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"vec4 iY = vec4 ( iX , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","iY","=","u_diffuse_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_NORMAL"],group:{type:"group",a:[{type:"textline",b:"vec2 iZ = normalize ( u_view_matrix_frag * vec4 ( iS , 0.0 ) ) . st ; iZ = iZ * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:"vec4 i_ = texture2D ( u_colormap0 , iC ) ; eg ( i_ . rgb ) ; vec4 ja ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_NORMAL"],
group:{type:"group",a:[{type:"textline",b:"ja = texture2D ( u_colormap1 , iZ ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_UV"],group:{type:"group",a:[{type:"textline",b:"ja = texture2D ( u_colormap1 , iC ) ;".split(" ")}]}}]},{type:"textline",b:"eg ( ja . rgb ) ; vec4 jb = texture2D ( u_stencil0 , iC ) ; vec4 jc = mix ( i_ , ja , jb . r ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_NORMAL"],
group:{type:"group",a:[{type:"textline",b:"vec4 jc = texture2D ( u_colormap0 , iZ ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_COORDS","==","TEXTURE_COORDS_UV"],group:{type:"group",a:[{type:"textline",b:"vec4 jc = texture2D ( u_colormap0 , iC + u_time * u_colormap0_uv_velocity ) ;".split(" ")}]}}]},{type:"textline",b:"eg ( jc . rgb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"iY . rgb = mix ( iY . rgb , jc . rgb , u_diffuse_color_factor ) ; iY . a = jc . a ;".split(" ")}]}},
{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",b:"iY . rgb *= mix ( vec3 ( 1.0 ) , jc . rgb , u_diffuse_color_factor ) ; iY . a = jc . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 jd = u_diffuse_intensity * iY . rgb ; float je = df ( u_shadow_visibility_falloff , jd ) ; vec3 jf = u_emit * iY . rgb ; vec3 jg = u_specular_color ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_SPEC"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["ALPHA_AS_SPEC"],group:{type:"group",a:[{type:"textline",b:"vec3 jh = vec3 ( iY . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 jh = texture2D ( u_specmap , iC ) . rgb ;".split(" ")}]}}]},{type:"textline",b:"eg ( jh . rgb ) ; jg = mix ( jg , jh , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",b:"float ji = u_specular_params [ 0 ] ; float jj = u_specular_params [ 1 ] ; vec3 jk = ji * jg ; fa jl = gE ( jf , iW , jd , jk , h_ , iS , iT , jj , u_diffuse_params , je , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ; vec3 jm = jl . a . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"iA ( jm , iT , iS , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , jg , iR . st ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"iA ( jm , iT , iS , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , jg , vec2 ( 0.0 ) ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"jm += jl . b ; float jn = jl . a . a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"jm = max ( jm - sqrt ( 0.01 * - min ( iB , 0.0 ) ) , 0.5 * jm ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"vec4 jo = u_sun_quaternion ; vec3 jp = h_ ; jp . xz = 10.0 * sin ( 0.1 * jp . xz ) ; vec3 jq = jp + 2.0 * cross ( - jo . xyz , cross ( - jo . xyz , jp ) + jo . w * jp ) ; vec2 jr = jq . xz ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"mat3 js = ( iF ) ; vec3 jt = js * iS ; jr += jt . st ;".split(" ")}]}}]},{type:"textline",b:"hY ( jm , jr . st , iB , u_time , je , iS , u_sun_direction , u_sun_intensity , h_ ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"float ju = iY . a ; if ( ju < 0.5 ) discard ; ju = 1.0 ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float ju = iY . a + jn * jk . r ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","ju","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 jv = eA ( u_cube_fog , iT ) ; vec4 jw = vec4 ( jv , u_fog_color_density . a ) ; eg ( jw . rgb ) ;".split(" ")}]}},{type:"else",
group:{type:"group",a:[{type:"textline",b:"vec4 jw = u_fog_color_density ; jw . rgb *= u_sun_intensity ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"eR ( jm , length ( cx ) , iT . y , u_cam_water_depth , u_underwater_fog_color_density , jw , iB , length ( u_sun_intensity ) + u_environment_energy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"et ( jm , length ( cx ) , jw ) ;".split(" ")}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"jm = vec3 ( cy . a ) ;".split(" ")}]}}]},{type:"textline",b:["ei","(","jm",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"el ( jm , ju ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( jm , ju ) ; }".split(" ")}]};a["main.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",
name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"dynamic_grass.glslv"},{type:"define",name:"TEXCOORD",b:"( TEXTURE_COLOR && TEXTURE_COORDS == TEXTURE_COORDS_UV || TEXTURE_STENCIL_ALPHA_MASK || TEXTURE_SPEC || TEXTURE_NORM )".split(" ")},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ;".split(" ")},
{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_position_next ; attribute vec3 a_normal_next ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",
a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",
b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",
a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"textline",b:"varying vec3 hZ ; varying vec3 h_ ; varying vec3 ia ; varying vec4 cx ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ib",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",
a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR","||","DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ic",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cs",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ct",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cu",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cv",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cw",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",
file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 iB = a_position ; vec3 iC = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"vec3 iD = vec3 ( a_tangent ) ; vec3 iE = a_tangent [ 3 ] * cross ( iC , iD ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 iD = vec3 ( 0.0 ) ; vec3 iE = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:"iB = mix ( iB , a_position_next , u_va_frame_factor ) ; iC = mix ( iC , a_normal_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"vec3 iF = vec3 ( a_tangent ) ; vec3 iG = a_tangent_next [ 3 ] * cross ( a_normal_next , iF ) ; iD = mix ( iD , iF , u_va_frame_factor ) ; iE = mix ( iE , iG , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",
a:[{type:"textline",b:"bq ( iB , iD , iE , iC ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","iH","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 iH = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",
b:"c iI = dY ( iB , iD , iE , iC , iH , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 iJ = ( u_model_matrix * vec4 ( iH , 1.0 ) ) . xyz ; mat4 iK = ae ( u_camera_eye , iJ , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],
group:{type:"group",a:[{type:"textline",b:"vec3 iL = ( u_model_matrix * vec4 ( iH , 1.0 ) ) . xyz ; iK = iK * S ( u_wind , u_time , u_jitter_amp , u_jitter_freq , iL ) ;".split(" ")}]}}]},{type:"textline",b:"c iI = al ( iB - iH , iH , iD , iE , iC , iK ) ; iI . b = iJ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c iI = al ( iB , iH , iD , iE , iC , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"float iM = ( dot ( cross ( iI . e , iI . c ) , iI . d ) < 0.0 ) ? - 1.0 : 1.0 ; ib = vec4 ( iI . c , iM ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c iI = dY ( iB , vec3 ( 0.0 ) , vec3 ( 0.0 ) , iC , iH , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 iJ = ( u_model_matrix * vec4 ( iH , 1.0 ) ) . xyz ; mat4 iK = ae ( u_camera_eye , iJ , u_view_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 iL = ( u_model_matrix * vec4 ( iH , 1.0 ) ) . xyz ; iK = iK * S ( u_wind , u_time , u_jitter_amp , u_jitter_freq , iL ) ;".split(" ")}]}}]},{type:"textline",b:"c iI = al ( iB - iH , iH , vec3 ( 0.0 ) , vec3 ( 0.0 ) , iC , iK ) ; iI . b = iJ ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c iI = al ( iB , iH , vec3 ( 0.0 ) , vec3 ( 0.0 ) , iC , u_model_matrix ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ch ( iI . a , iI . b , iC ) ;".split(" ")}]}}]},{type:"textline",b:"h_ = iI . a ; ia = iI . e ; hZ = u_camera_eye - iI . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXCOORD"],group:{type:"group",a:[{type:"textline",b:"a = ao ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"ic = iI . f ;".split(" ")}]}},
{type:"elif",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["ic","=","a_color",";"]}]}}]},{type:"textline",b:"cx = u_view_matrix * vec4 ( iI . a , 1.0 ) ; vec4 iN = u_proj_matrix * cx ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["d_","(","iN",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"d_ ( iI . a ) ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"float iO = iN . x ; float iP = iN . y ; float iQ = iN . w ; cw . x = ( iO + iQ ) / 2.0 ; cw . y = ( iP + iQ ) / 2.0 ; cw . z = iQ ;".split(" ")}]}}]},{type:"textline",b:["gl_Position","=","iN",";","}"]}]};a["nodes.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"pack.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"lighting.glslf"},{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"include",file:"procedural.glslf"},{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",b:"uniform float u_time ; uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ; uniform float u_shadow_visibility_falloff ; uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_sun_quaternion",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADED"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye_frag",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",
a:[{type:"textline",b:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADED","&&","WATER_EFFECTS","&&","CAUSTICS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG",
"&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"textline",b:["uniform","mat4","u_view_matrix_frag",";"]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],
group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map0",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"textline",b:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float",
"u_mirror_factor",";"]}]}}]},{type:"textline",b:"varying vec3 h_ ; varying vec4 cx ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADED","||","USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ia",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ib",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cs",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ct",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cu",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cv",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","SHADOW_SRC",
"==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cw",";"]}]}}]},{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 iJ ( vec3 iB ) { float iC , iD , iE , iF , iG , iH ; vec3 iI ; iC = max ( iB [ 0 ] , max ( iB [ 1 ] , iB [ 2 ] ) ) ; iD = min ( iB [ 0 ] , min ( iB [ 1 ] , iB [ 2 ] ) ) ; iH = iC - iD ; iG = iC ; if ( iC != 0.0 ) iF = iH / iC ; else { iF = 0.0 ; iE = 0.0 ; } if ( f ( iF , 0.0 ) ) { iE = 0.0 ; } else { iI = ( vec3 ( iC , iC , iC ) - iB . xyz ) / iH ; if ( f ( iB . x , iC ) ) iE = iI [ 2 ] - iI [ 1 ] ; else if ( f ( iB . y , iC ) ) iE = 2.0 + iI [ 0 ] - iI [ 2 ] ; else iE = 4.0 + iI [ 1 ] - iI [ 0 ] ; iE /= 6.0 ; if ( iE < 0.0 ) iE += 1.0 ; } return vec3 ( iE , iF , iG ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:"USE_NODE_HUE_SAT || USE_NODE_MIX_RGB_HUE || USE_NODE_MIX_RGB_SATURATION || USE_NODE_MIX_RGB_VALUE || USE_NODE_MIX_RGB_COLOR".split(" "),group:{type:"group",a:[{type:"textline",b:"vec3 iU ( vec3 iK ) { float iL , iM , iN , iO , iP , iQ , iR , iS ; vec3 iT ; iQ = iK [ 0 ] ; iR = iK [ 1 ] ; iS = iK [ 2 ] ; if ( f ( iR , 0.0 ) ) { iT = vec3 ( iS , iS , iS ) ; } else { if ( f ( iQ , 0.0 ) ) iQ = 0.0 ; iQ *= 6.0 ; iL = floor ( iQ ) ; iM = iQ - iL ; iT = vec3 ( iM , iM , iM ) ; iN = iS * ( 1.0 - iR ) ; iO = iS * ( 1.0 - ( iR * iM ) ) ; iP = iS * ( 1.0 - ( iR * ( 1.0 - iM ) ) ) ; if ( f ( iL , 0.0 ) ) iT = vec3 ( iS , iP , iN ) ; else if ( f ( iL , 1.0 ) ) iT = vec3 ( iO , iS , iN ) ; else if ( f ( iL , 2.0 ) ) iT = vec3 ( iN , iS , iP ) ; else if ( f ( iL , 3.0 ) ) iT = vec3 ( iN , iO , iS ) ; else if ( f ( iL , 4.0 ) ) iT = vec3 ( iP , iN , iS ) ; else iT = vec3 ( iS , iN , iO ) ; } return iT ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_UV","||","USE_NODE_PARALLAX"],group:{type:"group",a:[{type:"textline",b:"vec3 iW ( vec2 iV ) { return vec3 ( iV * 2.0 - vec2 ( 1.0 , 1.0 ) , 0.0 ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"USE_NODE_TEXTURE_COLOR || USE_NODE_TEXTURE_NORMAL || USE_NODE_TEXTURE_COLOR2 || USE_NODE_TEXTURE_NORMAL2 || USE_NODE_TEXTURE_COLOR3 || USE_NODE_TEXTURE_NORMAL3 || USE_NODE_PARALLAX".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 iY ( vec3 iX ) { return vec2 ( iX . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},
{type:"node",name:"CAMERA",group:{type:"group",a:[{type:"node_out",name:"jN",qualifier:["vec3"]},{type:"node_out",name:"jO",qualifier:["float"]},{type:"node_out",name:"jP",qualifier:["float"]},{type:"textline",b:"jN = normalize ( jC . xyz ) ; jO = abs ( jC . z ) ; jP = length ( jC . xyz ) ;".split(" ")}]}},{type:"node",name:"COMBRGB",group:{type:"group",a:[{type:"node_in",name:"jQ",qualifier:["float"]},{type:"node_in",name:"jR",qualifier:["float"]},{type:"node_in",name:"jS",qualifier:["float"]},{type:"node_out",
name:"jT",qualifier:["vec3"]},{type:"textline",b:"jT = vec3 ( jQ , jR , jS ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"iZ",qualifier:["varying","vec2"]},{type:"node_out",name:"jU",qualifier:["vec3"]},{type:"textline",b:"jU = iW ( iZ ) ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VC",group:{type:"group",a:[{type:"node_param",name:"i_",qualifier:["varying","vec3"]},{type:"node_out",name:"jV",qualifier:["vec3"]},{type:"textline",b:["jV","=","i_",
";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"ja",qualifier:["varying","float"]},{type:"node_out",name:"jW",qualifier:["float"]},{type:"textline",b:["jW","=","ja",";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"jb",qualifier:["varying","vec2"]},{type:"node_out",name:"jX",qualifier:["float"]},{type:"node_out",name:"jY",qualifier:["float"]},{type:"textline",b:"jX = jb [ 0 ] ; jY = jb [ 1 ] ;".split(" ")}]}},{type:"node",
name:"GEOMETRY_VC3",group:{type:"group",a:[{type:"node_param",name:"jc",qualifier:["varying","vec3"]},{type:"node_out",name:"jZ",qualifier:["float"]},{type:"node_out",name:"j_",qualifier:["float"]},{type:"node_out",name:"ka",qualifier:["float"]},{type:"textline",b:"jZ = jc [ 0 ] ; j_ = jc [ 1 ] ; ka = jc [ 2 ] ;".split(" ")}]}},{type:"node",name:"GEOMETRY_NO",group:{type:"group",a:[{type:"node_out",name:"kb",qualifier:["vec3"]},{type:"textline",b:["kb","=","jw",";"]}]}},{type:"node",name:"GEOMETRY_FB",
group:{type:"group",a:[{type:"node_out",name:"kc",qualifier:["float"]},{type:"textline",b:"kc = ( gl_FrontFacing ) ? 1.0 : 0.0 ;".split(" ")}]}},{type:"node",name:"GEOMETRY_VW",group:{type:"group",a:[{type:"node_out",name:"kd",qualifier:["vec3"]},{type:"textline",b:["kd","=","jA",";"]}]}},{type:"node",name:"GEOMETRY_GL",group:{type:"group",a:[{type:"node_out",name:"ke",qualifier:["vec3"]},{type:"textline",b:"ke = vec3 ( jB . r , - jB . b , jB . g ) ;".split(" ")}]}},{type:"node",name:"HUE_SAT",group:{type:"group",
a:[{type:"node_in",name:"kf",qualifier:["float"]},{type:"node_in",name:"kg",qualifier:["float"]},{type:"node_in",name:"kh",qualifier:["float"]},{type:"node_in",name:"ki",qualifier:["float"]},{type:"node_in",name:"kj",qualifier:["vec3"]},{type:"node_out",name:"kk",qualifier:["vec3"]},{type:"textline",b:"{ vec3 kl = iJ ( kj ) ; kl [ 0 ] += ( kf - 0.5 ) ; if ( kl [ 0 ] > 1.0 ) kl [ 0 ] -= 1.0 ; else if ( kl [ 0 ] < 0.0 ) kl [ 0 ] += 1.0 ; kl [ 1 ] *= kg ; if ( kl [ 1 ] > 1.0 ) kl [ 1 ] = 1.0 ; else if ( kl [ 1 ] < 0.0 ) kl [ 1 ] = 0.0 ; kl [ 2 ] *= kh ; if ( kl [ 2 ] > 1.0 ) kl [ 2 ] = 1.0 ; else if ( kl [ 2 ] < 0.0 ) kl [ 2 ] = 0.0 ; kk = mix ( kj , iU ( kl ) , ki ) ; }".split(" ")}]}},
{type:"node",name:"INVERT",group:{type:"group",a:[{type:"node_in",name:"km",qualifier:["float"]},{type:"node_in",name:"kn",qualifier:["vec3"]},{type:"node_out",name:"ko",qualifier:["vec3"]},{type:"textline",b:"ko = mix ( kn , vec3 ( 1.0 ) - kn , km ) ;".split(" ")}]}},{type:"node",name:"NORMAL",group:{type:"group",a:[{type:"node_param",name:"jd",qualifier:["vec3"]},{type:"node_in",name:"kp",qualifier:["vec3"]},{type:"node_out",name:"kq",qualifier:["vec3"]},{type:"node_out",name:"kr",qualifier:["float"]},
{type:"textline",b:"kq = jd ; kr = - dot ( kp , jd ) ;".split(" ")}]}},{type:"node",name:"NORMAL_VIEW",group:{type:"group",a:[{type:"node_in",name:"ks",qualifier:["vec3"]},{type:"node_out",name:"kt",qualifier:["vec3"]},{type:"textline",b:"kt = - ( u_view_matrix_frag * vec4 ( ks , 0.0 ) ) . xyz ;".split(" ")}]}},{type:"node",name:"MAPPING_LIGHT",group:{type:"group",a:[{type:"node_param",name:"je",qualifier:["vec3"]},{type:"node_in",name:"ku",qualifier:["vec3"]},{type:"node_out",name:"kv",qualifier:["vec3"]},
{type:"textline",b:"kv = ku * je ;".split(" ")}]}},{type:"node",name:"MAPPING_HEAVY",group:{type:"group",a:[{type:"node_param",name:"jf",qualifier:["mat4"]},{type:"node_param",name:"jg",qualifier:["const","float"]},{type:"node_param",name:"jh",qualifier:["const","float"]},{type:"node_param",name:"ji",qualifier:["vec3"]},{type:"node_param",name:"jj",qualifier:["vec3"]},{type:"node_in",name:"kw",qualifier:["vec3"]},{type:"node_out",name:"kx",qualifier:["vec3"]},{type:"textline",b:"kx = ( jf * vec4 ( kw , 1.0 ) ) . xyz ; if ( jg == 1.0 ) kx = max ( kx , ji ) ; if ( jh == 1.0 ) kx = min ( kx , jj ) ;".split(" ")}]}},
{type:"node",name:"MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"ky",qualifier:["float"]},{type:"node_in",name:"kz",qualifier:["float"]},{type:"node_out",name:"kA",qualifier:["float"]},{type:"textline",b:"kA = ky + kz ;".split(" ")}]}},{type:"node",name:"MATH_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"kB",qualifier:["float"]},{type:"node_in",name:"kC",qualifier:["float"]},{type:"node_out",name:"kD",qualifier:["float"]},{type:"textline",b:"kD = kB - kC ;".split(" ")}]}},{type:"node",
name:"MATH_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"kE",qualifier:["float"]},{type:"node_in",name:"kF",qualifier:["float"]},{type:"node_out",name:"kG",qualifier:["float"]},{type:"textline",b:"kG = kE * kF ;".split(" ")}]}},{type:"node",name:"MATH_DIVIDE",group:{type:"group",a:[{type:"node_in",name:"kH",qualifier:["float"]},{type:"node_in",name:"kI",qualifier:["float"]},{type:"node_out",name:"kJ",qualifier:["float"]},{type:"textline",b:"kJ = ( kI != 0.0 ) ? kH / kI : 0.0 ;".split(" ")}]}},
{type:"node",name:"MATH_SINE",group:{type:"group",a:[{type:"node_in",name:"kK",qualifier:["float"]},{type:"node_in",name:"kL",qualifier:["float"]},{type:"node_out",name:"kM",qualifier:["float"]},{type:"textline",b:"kM = sin ( kK ) ; kL ;".split(" ")}]}},{type:"node",name:"MATH_COSINE",group:{type:"group",a:[{type:"node_in",name:"kN",qualifier:["float"]},{type:"node_in",name:"kO",qualifier:["float"]},{type:"node_out",name:"kP",qualifier:["float"]},{type:"textline",b:"kP = cos ( kN ) ; kO ;".split(" ")}]}},
{type:"node",name:"MATH_TANGENT",group:{type:"group",a:[{type:"node_in",name:"kQ",qualifier:["float"]},{type:"node_in",name:"kR",qualifier:["float"]},{type:"node_out",name:"kS",qualifier:["float"]},{type:"textline",b:"kS = tan ( kQ ) ; kR ;".split(" ")}]}},{type:"node",name:"MATH_ARCSINE",group:{type:"group",a:[{type:"node_in",name:"kT",qualifier:["float"]},{type:"node_in",name:"kU",qualifier:["float"]},{type:"node_out",name:"kV",qualifier:["float"]},{type:"textline",b:"kV = ( kT <= 1.0 && kT >= - 1.0 ) ? asin ( kT ) : 0.0 ; kU ;".split(" ")}]}},
{type:"node",name:"MATH_ARCCOSINE",group:{type:"group",a:[{type:"node_in",name:"kW",qualifier:["float"]},{type:"node_in",name:"kX",qualifier:["float"]},{type:"node_out",name:"kY",qualifier:["float"]},{type:"textline",b:"kY = ( kW <= 1.0 && kW >= - 1.0 ) ? acos ( kW ) : 0.0 ; kX ;".split(" ")}]}},{type:"node",name:"MATH_ARCTANGENT",group:{type:"group",a:[{type:"node_in",name:"kZ",qualifier:["float"]},{type:"node_in",name:"k_",qualifier:["float"]},{type:"node_out",name:"la",qualifier:["float"]},{type:"textline",
b:"la = atan ( kZ ) ; k_ ;".split(" ")}]}},{type:"node",name:"MATH_POWER",group:{type:"group",a:[{type:"node_in",name:"lb",qualifier:["float"]},{type:"node_in",name:"lc",qualifier:["float"]},{type:"node_out",name:"ld",qualifier:["float"]},{type:"textline",b:"ld = pow ( lb , lc ) ;".split(" ")}]}},{type:"node",name:"MATH_LOGARITHM",group:{type:"group",a:[{type:"node_in",name:"le",qualifier:["float"]},{type:"node_in",name:"lf",qualifier:["float"]},{type:"node_out",name:"lg",qualifier:["float"]},{type:"textline",
b:"lg = ( le > 0.0 && lf > 0.0 ) ? log2 ( le ) / log2 ( lf ) : 0.0 ;".split(" ")}]}},{type:"node",name:"MATH_MINIMUM",group:{type:"group",a:[{type:"node_in",name:"lh",qualifier:["float"]},{type:"node_in",name:"li",qualifier:["float"]},{type:"node_out",name:"lj",qualifier:["float"]},{type:"textline",b:"lj = min ( lh , li ) ;".split(" ")}]}},{type:"node",name:"MATH_MAXIMUM",group:{type:"group",a:[{type:"node_in",name:"lk",qualifier:["float"]},{type:"node_in",name:"ll",qualifier:["float"]},{type:"node_out",
name:"lm",qualifier:["float"]},{type:"textline",b:"lm = max ( lk , ll ) ;".split(" ")}]}},{type:"node",name:"MATH_ROUND",group:{type:"group",a:[{type:"node_in",name:"ln",qualifier:["float"]},{type:"node_in",name:"lo",qualifier:["float"]},{type:"node_out",name:"lp",qualifier:["float"]},{type:"textline",b:"lp = floor ( ln + 0.5 ) ; lo ;".split(" ")}]}},{type:"node",name:"MATH_LESS_THAN",group:{type:"group",a:[{type:"node_in",name:"lq",qualifier:["float"]},{type:"node_in",name:"lr",qualifier:["float"]},
{type:"node_out",name:"ls",qualifier:["float"]},{type:"textline",b:"ls = ( lq < lr ) ? 1.0 : 0.0 ;".split(" ")}]}},{type:"node",name:"MATH_GREATER_THAN",group:{type:"group",a:[{type:"node_in",name:"lt",qualifier:["float"]},{type:"node_in",name:"lu",qualifier:["float"]},{type:"node_out",name:"lv",qualifier:["float"]},{type:"textline",b:"lv = lt + lu ; lv = ( lt > lu ) ? 1.0 : 0.0 ;".split(" ")}]}},{type:"node",name:"MATH_MODULO",group:{type:"group",a:[{type:"node_in",name:"lw",qualifier:["float"]},
{type:"node_in",name:"lx",qualifier:["float"]},{type:"node_out",name:"ly",qualifier:["float"]},{type:"textline",b:"ly = abs ( lx ) < 0.000001 ? mod ( lw , lx ) : 0.0 ;".split(" ")}]}},{type:"node",name:"MIX_RGB_MIX",group:{type:"group",a:[{type:"node_in",name:"lz",qualifier:["float"]},{type:"node_in",name:"lA",qualifier:["vec3"]},{type:"node_in",name:"lB",qualifier:["vec3"]},{type:"node_out",name:"lC",qualifier:["vec3"]},{type:"textline",b:"{ float lD = clamp ( lz , 0.0 , 1.0 ) ; lC = mix ( lA , lB , lD ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_ADD",group:{type:"group",a:[{type:"node_in",name:"lE",qualifier:["float"]},{type:"node_in",name:"lF",qualifier:["vec3"]},{type:"node_in",name:"lG",qualifier:["vec3"]},{type:"node_out",name:"lH",qualifier:["vec3"]},{type:"textline",b:"{ float lI = clamp ( lE , 0.0 , 1.0 ) ; lH = mix ( lF , lF + lG , lI ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_MULTIPLY",group:{type:"group",a:[{type:"node_in",name:"lJ",qualifier:["float"]},{type:"node_in",name:"lK",qualifier:["vec3"]},
{type:"node_in",name:"lL",qualifier:["vec3"]},{type:"node_out",name:"lM",qualifier:["vec3"]},{type:"textline",b:"{ float lN = clamp ( lJ , 0.0 , 1.0 ) ; lM = mix ( lK , lK * lL , lN ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_SUBTRACT",group:{type:"group",a:[{type:"node_in",name:"lO",qualifier:["float"]},{type:"node_in",name:"lP",qualifier:["vec3"]},{type:"node_in",name:"lQ",qualifier:["vec3"]},{type:"node_out",name:"lR",qualifier:["vec3"]},{type:"textline",b:"{ float lS = clamp ( lO , 0.0 , 1.0 ) ; lR = mix ( lP , lP - lQ , lS ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_SCREEN",group:{type:"group",a:[{type:"node_in",name:"lT",qualifier:["float"]},{type:"node_in",name:"lU",qualifier:["vec3"]},{type:"node_in",name:"lV",qualifier:["vec3"]},{type:"node_out",name:"lW",qualifier:["vec3"]},{type:"textline",b:"{ float lX = clamp ( lT , 0.0 , 1.0 ) ; float lY = 1.0 - lX ; lW = vec3 ( 1.0 ) - ( vec3 ( lY ) + lX * ( vec3 ( 1.0 ) - lV ) ) * ( vec3 ( 1.0 ) - lU ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DIVIDE",group:{type:"group",a:[{type:"node_in",
name:"lZ",qualifier:["float"]},{type:"node_in",name:"l_",qualifier:["vec3"]},{type:"node_in",name:"ma",qualifier:["vec3"]},{type:"node_out",name:"mb",qualifier:["vec3"]},{type:"textline",b:"{ float mc = clamp ( lZ , 0.0 , 1.0 ) ; float md = 1.0 - mc ; mb = l_ ; if ( ma . r != 0.0 ) mb . r = md * mb . r + mc * mb . r / ma . r ; if ( ma . g != 0.0 ) mb . g = md * mb . g + mc * mb . g / ma . g ; if ( ma . b != 0.0 ) mb . b = md * mb . b + mc * mb . b / ma . b ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DIFFERENCE",
group:{type:"group",a:[{type:"node_in",name:"me",qualifier:["float"]},{type:"node_in",name:"mf",qualifier:["vec3"]},{type:"node_in",name:"mg",qualifier:["vec3"]},{type:"node_out",name:"mh",qualifier:["vec3"]},{type:"textline",b:"{ float mi = clamp ( me , 0.0 , 1.0 ) ; mh = mix ( mf , abs ( mf - mg ) , mi ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_DARKEN",group:{type:"group",a:[{type:"node_in",name:"mj",qualifier:["float"]},{type:"node_in",name:"mk",qualifier:["vec3"]},{type:"node_in",name:"ml",
qualifier:["vec3"]},{type:"node_out",name:"mm",qualifier:["vec3"]},{type:"textline",b:"{ float mn = clamp ( mj , 0.0 , 1.0 ) ; mm = min ( mk . rgb , ml . rgb * mn ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LIGHTEN",group:{type:"group",a:[{type:"node_in",name:"mo",qualifier:["float"]},{type:"node_in",name:"mp",qualifier:["vec3"]},{type:"node_in",name:"mq",qualifier:["vec3"]},{type:"node_out",name:"mr",qualifier:["vec3"]},{type:"textline",b:"{ float ms = clamp ( mo , 0.0 , 1.0 ) ; mr = max ( mp . rgb , mq . rgb * ms ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_OVERLAY",group:{type:"group",a:[{type:"node_in",name:"mt",qualifier:["float"]},{type:"node_in",name:"mu",qualifier:["vec3"]},{type:"node_in",name:"mv",qualifier:["vec3"]},{type:"node_out",name:"mw",qualifier:["vec3"]},{type:"textline",b:"{ float mx = clamp ( mt , 0.0 , 1.0 ) ; float my = 1.0 - mx ; mw = mu ; if ( mw . r < 0.5 ) mw . r *= my + 2.0 * mx * mv . r ; else mw . r = 1.0 - ( my + 2.0 * mx * ( 1.0 - mv . r ) ) * ( 1.0 - mw . r ) ; if ( mw . g < 0.5 ) mw . g *= my + 2.0 * mx * mv . g ; else mw . g = 1.0 - ( my + 2.0 * mx * ( 1.0 - mv . g ) ) * ( 1.0 - mw . g ) ; if ( mw . b < 0.5 ) mw . b *= my + 2.0 * mx * mv . b ; else mw . b = 1.0 - ( my + 2.0 * mx * ( 1.0 - mv . b ) ) * ( 1.0 - mw . b ) ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_DODGE",group:{type:"group",a:[{type:"node_in",name:"mz",qualifier:["float"]},{type:"node_in",name:"mA",qualifier:["vec3"]},{type:"node_in",name:"mB",qualifier:["vec3"]},{type:"node_out",name:"mC",qualifier:["vec3"]},{type:"textline",b:"{ float mD = clamp ( mz , 0.0 , 1.0 ) ; mC = mA ; if ( mC . r != 0.0 ) { float mE = 1.0 - mD * mB . r ; if ( mE <= 0.0 ) mC . r = 1.0 ; else if ( ( mE = mC . r / mE ) > 1.0 ) mC . r = 1.0 ; else mC . r = mE ; } if ( mC . g != 0.0 ) { float mF = 1.0 - mD * mB . g ; if ( mF <= 0.0 ) mC . g = 1.0 ; else if ( ( mF = mC . g / mF ) > 1.0 ) mC . g = 1.0 ; else mC . g = mF ; } if ( mC . b != 0.0 ) { float mG = 1.0 - mD * mB . b ; if ( mG <= 0.0 ) mC . b = 1.0 ; else if ( ( mG = mC . b / mG ) > 1.0 ) mC . b = 1.0 ; else mC . b = mG ; } }".split(" ")}]}},
{type:"node",name:"MIX_RGB_BURN",group:{type:"group",a:[{type:"node_in",name:"mH",qualifier:["float"]},{type:"node_in",name:"mI",qualifier:["vec3"]},{type:"node_in",name:"mJ",qualifier:["vec3"]},{type:"node_out",name:"mK",qualifier:["vec3"]},{type:"textline",b:"{ float mL = clamp ( mH , 0.0 , 1.0 ) ; float mM = 1.0 - mL ; float mN ; mK = mI ; mN = mM + mL * mJ . r ; if ( mN <= 0.0 ) mK . r = 0.0 ; else if ( ( mN = ( 1.0 - ( 1.0 - mK . r ) / mN ) ) < 0.0 ) mK . r = 0.0 ; else if ( mN > 1.0 ) mK . r = 1.0 ; else mK . r = mN ; mN = mM + mL * mJ . g ; if ( mN <= 0.0 ) mK . g = 0.0 ; else if ( ( mN = ( 1.0 - ( 1.0 - mK . g ) / mN ) ) < 0.0 ) mK . g = 0.0 ; else if ( mN > 1.0 ) mK . g = 1.0 ; else mK . g = mN ; mN = mM + mL * mJ . b ; if ( mN <= 0.0 ) mK . b = 0.0 ; else if ( ( mN = ( 1.0 - ( 1.0 - mK . b ) / mN ) ) < 0.0 ) mK . b = 0.0 ; else if ( mN > 1.0 ) mK . b = 1.0 ; else mK . b = mN ; }".split(" ")}]}},
{type:"node",name:"MIX_RGB_HUE",group:{type:"group",a:[{type:"node_in",name:"mO",qualifier:["float"]},{type:"node_in",name:"mP",qualifier:["vec3"]},{type:"node_in",name:"mQ",qualifier:["vec3"]},{type:"node_out",name:"mR",qualifier:["vec3"]},{type:"textline",b:"{ float mS = clamp ( mO , 0.0 , 1.0 ) ; vec3 mT , mU , mV ; mR = mP ; mU = iJ ( mQ ) ; if ( mU . y != 0.0 ) { mT = iJ ( mR ) ; mT . x = mU . x ; mV = iU ( mT ) ; mR = mix ( mR , mV , mS ) ; } }".split(" ")}]}},{type:"node",name:"MIX_RGB_SATURATION",
group:{type:"group",a:[{type:"node_in",name:"mW",qualifier:["float"]},{type:"node_in",name:"mX",qualifier:["vec3"]},{type:"node_in",name:"mY",qualifier:["vec3"]},{type:"node_out",name:"mZ",qualifier:["vec3"]},{type:"textline",b:"{ float m_ = clamp ( mW , 0.0 , 1.0 ) ; float na = 1.0 - m_ ; mZ = mX ; vec3 nb , nc ; nb = iJ ( mZ ) ; if ( nb . y != 0.0 ) { nc = iJ ( mY ) ; nb . y = na * nb . y + m_ * nc . y ; mZ = iU ( nb ) ; } }".split(" ")}]}},{type:"node",name:"MIX_RGB_VALUE",group:{type:"group",
a:[{type:"node_in",name:"nd",qualifier:["float"]},{type:"node_in",name:"ne",qualifier:["vec3"]},{type:"node_in",name:"nf",qualifier:["vec3"]},{type:"node_out",name:"ng",qualifier:["vec3"]},{type:"textline",b:"{ float nh = clamp ( nd , 0.0 , 1.0 ) ; float ni = 1.0 - nh ; vec3 nj , nk ; nj = iJ ( ne ) ; nk = iJ ( nf ) ; nj . z = ni * nj . z + nh * nk . z ; ng = iU ( nj ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_COLOR",group:{type:"group",a:[{type:"node_in",name:"nl",qualifier:["float"]},{type:"node_in",
name:"nm",qualifier:["vec3"]},{type:"node_in",name:"nn",qualifier:["vec3"]},{type:"node_out",name:"no",qualifier:["vec3"]},{type:"textline",b:"{ float np = clamp ( nl , 0.0 , 1.0 ) ; vec3 nq , nr , ns ; no = nm ; nr = iJ ( nn ) ; if ( nr . y != 0.0 ) { nq = iJ ( no ) ; nq . x = nr . x ; nq . y = nr . y ; ns = iU ( nq ) ; no = mix ( no , ns , np ) ; } }".split(" ")}]}},{type:"node",name:"MIX_RGB_SOFT_LIGHT",group:{type:"group",a:[{type:"node_in",name:"nt",qualifier:["float"]},{type:"node_in",name:"nu",
qualifier:["vec3"]},{type:"node_in",name:"nv",qualifier:["vec3"]},{type:"node_out",name:"nw",qualifier:["vec3"]},{type:"textline",b:"{ float nx = clamp ( nt , 0.0 , 1.0 ) ; float ny = 1.0 - nx ; vec3 nz = vec3 ( 1.0 ) ; vec3 nA = nz - ( nz - nv ) * ( nz - nu ) ; nw = ny * nu + nx * ( ( nz - nu ) * nv * nu + nu * nA ) ; }".split(" ")}]}},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",group:{type:"group",a:[{type:"node_in",name:"nB",qualifier:["float"]},{type:"node_in",name:"nC",qualifier:["vec3"]},{type:"node_in",
name:"nD",qualifier:["vec3"]},{type:"node_out",name:"nE",qualifier:["vec3"]},{type:"textline",b:"{ float nF = clamp ( nB , 0.0 , 1.0 ) ; nE = nC ; if ( nD . r > 0.5 ) nE . r = nC . r + nF * ( 2.0 * ( nD . r - 0.5 ) ) ; else nE . r = nC . r + nF * ( 2.0 * ( nD . r ) - 1.0 ) ; if ( nD . g > 0.5 ) nE . g = nC . g + nF * ( 2.0 * ( nD . g - 0.5 ) ) ; else nE . g = nC . g + nF * ( 2.0 * ( nD . g ) - 1.0 ) ; if ( nD . b > 0.5 ) nE . b = nC . b + nF * ( 2.0 * ( nD . b - 0.5 ) ) ; else nE . b = nC . b + nF * ( 2.0 * ( nD . b ) - 1.0 ) ; nE = clamp ( nE , 0.0 , 1.0 ) ; }".split(" ")}]}},
{type:"node",name:"OUTPUT",group:{type:"group",a:[{type:"node_in",name:"nG",qualifier:["vec3"]},{type:"node_in",name:"nH",qualifier:["float"]},{type:"textline",b:"jH = nG ; jM = nH ;".split(" ")}]}},{type:"node",name:"MATERIAL",group:{type:"group",a:[{type:"node_param",name:"jk",qualifier:["const","vec3"]},{type:"node_param",name:"jl",qualifier:["const","vec3"]},{type:"node_param",name:"jm",qualifier:["const","float"]},{type:"node_in",name:"nI",qualifier:["vec3"]},{type:"node_in",name:"nJ",qualifier:["float"]},
{type:"node_in",name:"nK",qualifier:["vec3"]},{type:"node_in",name:"nL",qualifier:["vec3"]},{type:"node_out",name:"nM",qualifier:["vec3"]},{type:"node_out",name:"nN",qualifier:["float"]},{type:"node_out",name:"nO",qualifier:["vec3"]},{type:"textline",b:"nI = clamp ( nI , 0.0 , 1.0 ) ; nJ = clamp ( nJ , 0.0 , 1.0 ) ; nK = clamp ( nK , 0.0 , 1.0 ) ; vec3 nP = nI ; float nQ = jk [ 0 ] ; vec2 nR = vec2 ( jk [ 1 ] , jk [ 2 ] ) ; vec3 nS = jD * nI ; vec3 nT = jE * jy ; vec3 nU = jl [ 1 ] * nK ; float nV = jl [ 0 ] ; float nW = jl [ 2 ] ; float nX = df ( jF , nP ) ; vec3 nY ; if ( jm == 1.0 ) nY = normalize ( nL ) ; else nY = jw ; fa nZ = gE ( nS , nT , nP , nU , jB , nY , jA , nW , nR , nX , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ; nM = ( nQ == 1.0 ) ? nZ . a . rgb : vec3 ( 0.0 ) ; nN = nJ ; nO = nY ; if ( nV == 1.0 ) { nM += nZ . b ; jI = nZ . b ; } else { jI = vec3 ( 0.0 ) ; } jJ = nY ; jL = nX ;".split(" ")}]}},
{type:"node",name:"MATERIAL_EXT",group:{type:"group",a:[{type:"node_param",name:"jn",qualifier:["const","vec3"]},{type:"node_param",name:"jo",qualifier:["const","vec3"]},{type:"node_param",name:"jp",qualifier:["const","float"]},{type:"node_in",name:"n_",qualifier:["vec3"]},{type:"node_in",name:"oa",qualifier:["float"]},{type:"node_in",name:"ob",qualifier:["vec3"]},{type:"node_in",name:"oc",qualifier:["vec3"]},{type:"node_in",name:"od",qualifier:["float"]},{type:"node_in",name:"oe",qualifier:["float"]},
{type:"node_in",name:"of",qualifier:["vec4"]},{type:"node_out",name:"og",qualifier:["vec3"]},{type:"node_out",name:"oh",qualifier:["float"]},{type:"node_out",name:"oi",qualifier:["vec3"]},{type:"node_out",name:"oj",qualifier:["vec3"]},{type:"node_out",name:"ok",qualifier:["vec3"]},{type:"textline",b:"n_ = clamp ( n_ , 0.0 , 1.0 ) ; oa = clamp ( oa , 0.0 , 1.0 ) ; ob = clamp ( ob , 0.0 , 1.0 ) ; vec3 nP = n_ ; float nQ = jn [ 0 ] ; vec2 nR = vec2 ( jn [ 1 ] , jn [ 2 ] ) ; vec3 nS = od * n_ ; vec3 nT = jE * jy ; vec3 nU = jo [ 1 ] * ob ; float nV = jo [ 0 ] ; float nW = jo [ 2 ] ; float nX = df ( jF , nP ) ; vec3 nY ; if ( jp == 1.0 ) nY = normalize ( oc ) ; else nY = jw ; fa nZ = gE ( nS , nT , nP , nU , jB , nY , jA , nW , nR , nX , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , oe , of ) ; og = ( nQ == 1.0 ) ? nZ . a . rgb : vec3 ( 0.0 ) ; oh = oa ; oi = nY ; oj = nZ . a . rgb ; ok = nZ . b ; if ( nV == 1.0 ) { og += nZ . b ; jI = nZ . b ; } else { jI = vec3 ( 0.0 ) ; } jJ = nY ; jL = nX ;".split(" ")}]}},
{type:"node",name:"RGB",group:{type:"group",a:[{type:"node_param",name:"jq",qualifier:["vec3"]},{type:"node_out",name:"ol",qualifier:["vec3"]},{type:"textline",b:["ol","=","jq",";"]}]}},{type:"node",name:"RGBTOBW",group:{type:"group",a:[{type:"node_in",name:"om",qualifier:["vec3"]},{type:"node_out",name:"on",qualifier:["float"]},{type:"textline",b:"on = om . r * 0.35 + om . g * 0.45 + om . b * 0.2 ;".split(" ")}]}},{type:"node",name:"SEPRGB",group:{type:"group",a:[{type:"node_in",name:"oo",qualifier:["vec3"]},
{type:"node_out",name:"op",qualifier:["float"]},{type:"node_out",name:"oq",qualifier:["float"]},{type:"node_out",name:"or",qualifier:["float"]},{type:"textline",b:"op = oo . r ; oq = oo . g ; or = oo . b ;".split(" ")}]}},{type:"node",name:"SQUEEZE",group:{type:"group",a:[{type:"node_in",name:"os",qualifier:["float"]},{type:"node_in",name:"ot",qualifier:["float"]},{type:"node_in",name:"ou",qualifier:["float"]},{type:"node_out",name:"ov",qualifier:["float"]},{type:"textline",b:"ov = 1.0 / ( 1.0 + pow ( 2.71828183 , - ( ( os - ou ) * ot ) ) ) ;".split(" ")}]}},
{type:"node",name:"SRGB_TO_LINEAR",group:{type:"group",a:[{type:"node_in",name:"ow",qualifier:["vec3"]},{type:"node_out",name:"ox",qualifier:["vec3"]},{type:"textline",b:"ox = pow ( ow , vec3 ( 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"LINEAR_TO_SRGB",group:{type:"group",a:[{type:"node_in",name:"oy",qualifier:["vec3"]},{type:"node_out",name:"oz",qualifier:["vec3"]},{type:"textline",b:"oz = pow ( oy , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR",group:{type:"group",a:[{type:"node_param",
name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"oA",qualifier:["vec3"]},{type:"node_out",name:"oB",qualifier:["vec3"]},{type:"node_out",name:"oC",qualifier:["float"]},{type:"textline",b:"{ vec4 oD = texture2D ( node_TEXTURE_COLOR_var_texture , iY ( oA ) ) ; oB = oD . xyz ; eg ( oB ) ; oC = oD . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform",
"sampler2D"]},{type:"node_in",name:"oE",qualifier:["vec3"]},{type:"node_out",name:"oF",qualifier:["vec3"]},{type:"node_out",name:"oG",qualifier:["float"]},{type:"textline",b:"{ vec4 oH = texture2D ( node_TEXTURE_NORMAL_var_texture , iY ( oE ) ) ; jK = oH . xyz - 0.5 ; oF = normalize ( jG * jK ) ; oG = oH . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_ENVIRONMENT",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",qualifier:["uniform","samplerCube"]},{type:"node_in",
name:"oI",qualifier:["vec3"]},{type:"node_out",name:"oJ",qualifier:["vec3"]},{type:"node_out",name:"oK",qualifier:["float"]},{type:"textline",b:"{ vec4 oL = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , oI ) ; oJ = oL . xyz ; eg ( oJ ) ; oK = oL . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_COLOR2",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR2_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"oM",qualifier:["vec3"]},{type:"node_in",name:"oN",qualifier:["vec3"]},
{type:"node_out",name:"oO",qualifier:["vec3"]},{type:"node_out",name:"oP",qualifier:["float"]},{type:"node_out",name:"oQ",qualifier:["vec3"]},{type:"node_out",name:"oR",qualifier:["float"]},{type:"textline",b:"{ vec4 oS = texture2D ( node_TEXTURE_COLOR2_var_texture , iY ( oM ) ) ; oO = oS . xyz ; eg ( oO ) ; oP = oS . w ; oS = texture2D ( node_TEXTURE_COLOR2_var_texture , iY ( oN ) ) ; oQ = oS . xyz ; eg ( oQ ) ; oR = oS . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL2",group:{type:"group",
a:[{type:"node_param",name:"node_TEXTURE_NORMAL2_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"oT",qualifier:["vec3"]},{type:"node_in",name:"oU",qualifier:["vec3"]},{type:"node_out",name:"oV",qualifier:["vec3"]},{type:"node_out",name:"oW",qualifier:["float"]},{type:"node_out",name:"oX",qualifier:["vec3"]},{type:"node_out",name:"oY",qualifier:["float"]},{type:"textline",b:"{ vec4 oZ = texture2D ( node_TEXTURE_NORMAL2_var_texture , iY ( oT ) ) ; jK = oZ . xyz - 0.5 ; oV = normalize ( jG * jK ) ; oW = oZ . w ; oZ = texture2D ( node_TEXTURE_NORMAL2_var_texture , iY ( oU ) ) ; jK = oZ . xyz - 0.5 ; oX = normalize ( jG * jK ) ; oY = oZ . w ; }".split(" ")}]}},
{type:"node",name:"TEXTURE_COLOR3",group:{type:"group",a:[{type:"node_param",name:"node_TEXTURE_COLOR3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"o_",qualifier:["vec3"]},{type:"node_in",name:"pa",qualifier:["vec3"]},{type:"node_in",name:"pb",qualifier:["vec3"]},{type:"node_out",name:"pc",qualifier:["vec3"]},{type:"node_out",name:"pd",qualifier:["float"]},{type:"node_out",name:"pe",qualifier:["vec3"]},{type:"node_out",name:"pf",qualifier:["float"]},{type:"node_out",name:"pg",
qualifier:["vec3"]},{type:"node_out",name:"ph",qualifier:["float"]},{type:"textline",b:"{ vec4 pi = texture2D ( node_TEXTURE_COLOR3_var_texture , iY ( o_ ) ) ; pc = pi . xyz ; eg ( pc ) ; pd = pi . w ; pi = texture2D ( node_TEXTURE_COLOR3_var_texture , iY ( pa ) ) ; pe = pi . xyz ; eg ( pe ) ; pf = pi . w ; pi = texture2D ( node_TEXTURE_COLOR3_var_texture , iY ( pb ) ) ; pg = pi . xyz ; eg ( pg ) ; ph = pi . w ; }".split(" ")}]}},{type:"node",name:"TEXTURE_NORMAL3",group:{type:"group",a:[{type:"node_param",
name:"node_TEXTURE_NORMAL3_var_texture",qualifier:["uniform","sampler2D"]},{type:"node_in",name:"pj",qualifier:["vec3"]},{type:"node_in",name:"pk",qualifier:["vec3"]},{type:"node_in",name:"pl",qualifier:["vec3"]},{type:"node_out",name:"pm",qualifier:["vec3"]},{type:"node_out",name:"pn",qualifier:["float"]},{type:"node_out",name:"po",qualifier:["vec3"]},{type:"node_out",name:"pp",qualifier:["float"]},{type:"node_out",name:"pq",qualifier:["vec3"]},{type:"node_out",name:"pr",qualifier:["float"]},{type:"textline",
b:"{ vec4 ps = texture2D ( node_TEXTURE_NORMAL3_var_texture , iY ( pj ) ) ; jK = ps . xyz - 0.5 ; pm = normalize ( jG * jK ) ; pn = ps . w ; ps = texture2D ( node_TEXTURE_NORMAL3_var_texture , iY ( pk ) ) ; jK = ps . xyz - 0.5 ; po = normalize ( jG * jK ) ; pp = ps . w ; ps = texture2D ( node_TEXTURE_NORMAL3_var_texture , iY ( pl ) ) ; jK = ps . xyz - 0.5 ; pq = normalize ( jG * jK ) ; pr = ps . w ; }".split(" ")}]}},{type:"node",name:"VALUE",group:{type:"group",a:[{type:"node_param",name:"jr",qualifier:["float"]},
{type:"node_out",name:"pt",qualifier:["float"]},{type:"textline",b:["pt","=","jr",";"]}]}},{type:"node",name:"VECT_MATH_ADD",group:{type:"group",a:[{type:"node_in",name:"pu",qualifier:["vec3"]},{type:"node_in",name:"pv",qualifier:["vec3"]},{type:"node_out",name:"pw",qualifier:["vec3"]},{type:"node_out",name:"px",qualifier:["float"]},{type:"textline",b:"pw = pu + pv ; px = ( abs ( pw [ 0 ] ) + abs ( pw [ 1 ] ) + abs ( pw [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_SUBTRACT",group:{type:"group",
a:[{type:"node_in",name:"py",qualifier:["vec3"]},{type:"node_in",name:"pz",qualifier:["vec3"]},{type:"node_out",name:"pA",qualifier:["vec3"]},{type:"node_out",name:"pB",qualifier:["float"]},{type:"textline",b:"pA = py - pz ; pB = ( abs ( pA [ 0 ] ) + abs ( pA [ 1 ] ) + abs ( pA [ 2 ] ) ) / 3.0 ;".split(" ")}]}},{type:"node",name:"VECT_MATH_AVERAGE",group:{type:"group",a:[{type:"node_in",name:"pC",qualifier:["vec3"]},{type:"node_in",name:"pD",qualifier:["vec3"]},{type:"node_out",name:"pE",qualifier:["vec3"]},
{type:"node_out",name:"pF",qualifier:["float"]},{type:"textline",b:"pE = pC + pD ; pF = length ( pE ) ; pE = normalize ( pE ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_DOT_PRODUCT",group:{type:"group",a:[{type:"node_in",name:"pG",qualifier:["vec3"]},{type:"node_in",name:"pH",qualifier:["vec3"]},{type:"node_out",name:"pI",qualifier:["vec3"]},{type:"node_out",name:"pJ",qualifier:["float"]},{type:"textline",b:"pI = vec3 ( 0.0 ) ; pJ = dot ( pG , pH ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",
group:{type:"group",a:[{type:"node_in",name:"pK",qualifier:["vec3"]},{type:"node_in",name:"pL",qualifier:["vec3"]},{type:"node_out",name:"pM",qualifier:["vec3"]},{type:"node_out",name:"pN",qualifier:["float"]},{type:"textline",b:"pM = cross ( pK , pL ) ; pN = length ( pM ) ;".split(" ")}]}},{type:"node",name:"VECT_MATH_NORMALIZE",group:{type:"group",a:[{type:"node_in",name:"pO",qualifier:["vec3"]},{type:"node_in",name:"pP",qualifier:["vec3"]},{type:"node_out",name:"pQ",qualifier:["vec3"]},{type:"node_out",
name:"pR",qualifier:["float"]},{type:"textline",b:"pQ = normalize ( pO ) ; pR = length ( pO ) ; pP ;".split(" ")}]}},{type:"node",name:"REFLECT",group:{type:"group",a:[{type:"node_in",name:"pS",qualifier:["vec3"]},{type:"node_in",name:"pT",qualifier:["vec3"]},{type:"node_out",name:"pU",qualifier:["vec3"]},{type:"textline",b:"pU = reflect ( - pS , pT ) ;".split(" ")}]}},{type:"node",name:"PARALLAX",group:{type:"group",a:[{type:"node_param",name:"node_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]},
{type:"node_in",name:"pV",qualifier:["vec3"]},{type:"node_in",name:"pW",qualifier:["float"]},{type:"node_in",name:"pX",qualifier:["const","float"]},{type:"node_out",name:"pY",qualifier:["vec3"]},{type:"textline",b:"vec3 pZ = normalize ( jA * jG ) ; float p_ = 1.0 / pX ; vec2 qa = pZ . xy * pW / ( pX * pZ . z ) ; float qb = 1.0 ; vec2 qc = iY ( pV ) ; float qd = texture2D ( node_PARALLAX_var_texture , qc ) . a ; for ( float qe = 1.0 ; qe <= pX ; qe ++ ) { if ( qd < qb ) { qb -= p_ ; qc -= qa ; qd = texture2D ( node_PARALLAX_var_texture , qc ) . a ; } } vec2 qf = qc + qa ; float qg = texture2D ( node_PARALLAX_var_texture , qf ) . a - ( qb + p_ ) ; float qh = qd - qb ; float qi = qh / ( qh - qg ) ; qc = qi * qf + ( 1.0 - qi ) * qc ; pY = iW ( qc ) ;".split(" ")}]}},
{type:"node",name:"CLAMP",group:{type:"group",a:[{type:"node_in",name:"qj",qualifier:["vec3"]},{type:"node_out",name:"qk",qualifier:["vec3"]},{type:"textline",b:"qk = clamp ( qj , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"node",name:"TRANSLUCENCY",group:{type:"group",a:[{type:"node_in",name:"ql",qualifier:["float"]},{type:"node_in",name:"qm",qualifier:["float"]},{type:"node_in",name:"qn",qualifier:["float"]},{type:"node_in",name:"qo",qualifier:["float"]},{type:"node_in",name:"qp",qualifier:["float"]},
{type:"node_out",name:"qq",qualifier:["float"]},{type:"node_out",name:"qr",qualifier:["vec4"]},{type:"textline",b:"qq = ql ; qr = vec4 ( qm , qn , qo , qp ) ;".split(" ")}]}},{type:"nodes_global"},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["SHADED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"float js = h_ . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"textline",b:["vec3","jt","=","ia",
";"]},{type:"condition",a:[{type:"if",c:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",a:[{type:"textline",b:"if ( ! gl_FrontFacing ) jt = - jt ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 ju = cross ( jt , ib . xyz ) * ib . w ; mat3 jv = mat3 ( ib . xyz , ju , jt ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 jw = normalize ( jt ) ; float jx = 0.5 * jw . y + 0.5 ; vec3 jy = u_environment_energy * mix ( u_horizon_color , u_zenith_color , jx ) ; vec3 jz = u_camera_eye_frag - h_ ; vec3 jA = normalize ( jz ) ; vec3 jB = h_ ; vec4 jC = cx ; float jD = u_emit ; float jE = u_ambient ; float jF = u_shadow_visibility_falloff ;".split(" ")},
{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["mat3","jG","=","jv",";"]}]}}]},{type:"textline",b:"vec3 jH ; vec3 jI ; vec3 jJ ; vec3 jK ; float jL ; float jM ;".split(" ")},{type:"nodes_main"},{type:"textline",b:"vec3 qs = jH ; float qt = jM ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"iA ( qs , jA , jJ , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , jI , jK . st ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"iA ( qs , jA , jJ , u_fresnel_params [ 2 ] , u_fresnel_params [ 3 ] , jI , vec2 ( 0.0 ) ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["vec3","qu","=","u_sun_intensity",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WETTABLE"],group:{type:"group",a:[{type:"textline",b:"qs = max ( qs - sqrt ( 0.01 * - min ( js , 0.0 ) ) , 0.5 * qs ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CAUSTICS"],group:{type:"group",a:[{type:"textline",b:"vec4 qv = u_sun_quaternion ; vec3 qw = h_ ; qw . xz = 10.0 * sin ( 0.1 * qw . xz ) ; vec3 qx = qw + 2.0 * cross ( - qv . xyz , cross ( - qv . xyz , qw ) + qv . w * qw ) ; vec2 qy = qx . xz ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"mat3 qz = ( jv ) ; vec3 qA = qz * jJ ; qy += qA . st ;".split(" ")}]}}]},{type:"textline",b:"hY ( qs , qy . st , js , u_time , jL , jt , u_sun_direction , qu , h_ ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 qB = eA ( u_cube_fog , jA ) ; vec4 qC = vec4 ( qB , u_fog_color_density . a ) ; eg ( qC . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 qC = u_fog_color_density ; qC . rgb *= qu ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",
b:"eR ( qs , length ( cx ) , jA . y , u_cam_water_depth , u_underwater_fog_color_density , qC , js , length ( qu ) + u_environment_energy ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"et ( qs , length ( cx ) , qC ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SSAO_ONLY","&&","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 qD = texture2DProj ( u_shadow_mask , cw ) . rg ; float qE = qD . g ; qs = vec3 ( qE ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 jB = h_ ; vec4 jC = cx ;".split(" ")},{type:"condition",a:[{type:"if",c:["USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:"vec3 jw = normalize ( ia ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 jH ; float jM ;".split(" ")},{type:"nodes_main"},{type:"textline",b:"vec3 qs = jH ; float qt = jM ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( qt < 0.5 ) discard ; qt = 1.0 ;".split(" ")}]}}]},
{type:"textline",b:["ei","(","qs",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"el ( qs , qt ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( qs , qt ) ; }".split(" ")}]};a["nodes.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",
file:"to_world.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SHADED","||","USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",
b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]},{type:"condition",a:[{type:"if",c:["SHADED"],group:{type:"group",a:[{type:"textline",b:["attribute",
"vec3","a_normal_next",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},
{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",
a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:"uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix2",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"textline",b:"varying vec3 h_ ; varying vec4 cx ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADED","||","USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ia",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ib",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","vec4","cs",";"]},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","ct",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","cu",";"]}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",
a:[{type:"textline",b:["varying","vec4","cv",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cw",";"]}]}}]},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"node",name:"GEOMETRY_UV",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"iZ",
qualifier:["varying","vec2"]},{type:"textline",b:["iZ","=","node_GEOMETRY_UV_var_a_uv",";"]}]}},{type:"node",name:"GEOMETRY_VC",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"jd",qualifier:["varying","vec3"]},{type:"textline",b:["jd","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC1",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",qualifier:["attribute",
"float"]},{type:"node_param",name:"je",qualifier:["varying","float"]},{type:"textline",b:["je","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC2",group:{type:"group",a:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"jf",qualifier:["varying","vec2"]},{type:"textline",b:["jf","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]}},{type:"node",name:"GEOMETRY_VC3",group:{type:"group",a:[{type:"node_param",
name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"jg",qualifier:["varying","vec3"]},{type:"textline",b:["jg","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]}},{type:"nodes_global"},{type:"textline",b:"void main ( ) { vec3 jh = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADED"],group:{type:"group",a:[{type:"textline",b:["vec3","ji","=","a_normal",";"]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",
b:"vec3 jj = vec3 ( a_tangent ) ; vec3 jk = a_tangent [ 3 ] * cross ( ji , jj ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 jj = vec3 ( 0.0 ) ; vec3 jk = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"elif",c:["USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:["vec3","ji","=","a_normal",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ji = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",
a:[{type:"textline",b:"jh = mix ( jh , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADED"],group:{type:"group",a:[{type:"textline",b:"ji = mix ( ji , a_normal_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"textline",b:"vec3 jl = vec3 ( a_tangent ) ; vec3 jm = a_tangent_next [ 3 ] * cross ( a_normal_next , jl ) ; jj = mix ( jj , jl , u_va_frame_factor ) ; jk = mix ( jk , jm , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"bq ( jh , jj , jk , ji ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","jn","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 jn = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CALC_TBN_SPACE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],
group:{type:"group",a:[{type:"textline",b:"vec3 jo = ( u_model_matrix * vec4 ( jn , 1.0 ) ) . xyz ; mat4 jp = ae ( u_camera_eye , jo , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 jq = ( u_model_matrix * vec4 ( jn , 1.0 ) ) . xyz ; jp = jp * S ( u_wind , u_time , u_jitter_amp , u_jitter_freq , jq ) ;".split(" ")}]}}]},{type:"textline",b:"c jr = al ( jh - jn , jn , jj , jk , ji , jp ) ; jr . b = jo ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"c jr = al ( jh , jn , jj , jk , ji , u_model_matrix ) ;".split(" ")}]}}]},{type:"textline",b:"float js = ( dot ( cross ( jr . e , jr . c ) , jr . d ) < 0.0 ) ? - 1.0 : 1.0 ; ib = vec4 ( jr . c , js ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 jo = ( u_model_matrix * vec4 ( jn , 1.0 ) ) . xyz ; mat4 jp = ae ( u_camera_eye , jo , u_view_matrix ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 jq = ( u_model_matrix * vec4 ( jn , 1.0 ) ) . xyz ; jp = jp * S ( u_wind , u_time , u_jitter_amp , u_jitter_freq , jq ) ;".split(" ")}]}}]},{type:"textline",b:"c jr = al ( jh - jn , jn , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ji , jp ) ; jr . b = jo ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c jr = al ( jh , jn , vec3 ( 0.0 ) , vec3 ( 0.0 ) , ji , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ch ( jr . a , jr . b , ji ) ;".split(" ")}]}}]},{type:"textline",b:"h_ = jr . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADED","||","USE_NODE_GEOMETRY_NO"],group:{type:"group",a:[{type:"textline",b:"ia = jr . e ;".split(" ")}]}}]},{type:"textline",b:"cx = u_view_matrix * vec4 ( jr . a , 1.0 ) ; vec4 jt = u_proj_matrix * cx ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],
group:{type:"group",a:[{type:"textline",b:["d_","(","jt",")",";"]}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"d_ ( jr . a ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"float ju = jt . x ; float jv = jt . y ; float jw = jt . w ; cw . x = ( ju + jw ) / 2.0 ; cw . y = ( jv + jw ) / 2.0 ; cw . z = jw ;".split(" ")}]}}]},{type:"nodes_main"},{type:"textline",b:["gl_Position","=","jt",
";","}"]}]};a["particles_color.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec4 u_fog_color_density ; varying float jh ; varying vec3 ic ; varying vec3 cx ; void main ( ) { float ji = 2.0 * sqrt ( ( gl_PointCoord . x - 0.5 ) * ( gl_PointCoord . x - 0.5 ) + ( gl_PointCoord . y - 0.5 ) * ( gl_PointCoord . y - 0.5 ) ) ; float jj = smoothstep ( u_p_alpha_start , u_p_alpha_end , ji ) ; float jk = u_diffuse_color . a * jh * ( 1.0 - clamp ( jj , 0.0 , 1.0 ) ) ; vec3 jl = ic * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"et ( jl , length ( cx ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["ei","(","jl",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"el ( jl , jk ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( jl , jk ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",a:[{type:"include",file:"particles.glslv"},
{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; uniform vec2 u_p_size_ramp [ RAMPSIZE ] ; uniform vec4 u_p_color_ramp [ RAMPSIZE ] ; uniform float u_p_time ; uniform float u_p_starttime ; uniform float u_p_endtime ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform float u_height ; uniform float u_p_size ; varying float jh ; varying vec3 ic ; varying vec3 cx ; struct jP { float iB ; vec3 iC ; float iD ; vec3 iE ; float iF ; } ; jP jW ( ) { float jQ = u_p_time - u_p_starttime ; jP jR ; if ( jQ < 0.0 ) { jR . iB = 0.0001 ; jR . iC = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } else { float jS ; if ( u_p_cyclic == 1 ) { float jT = u_p_endtime - u_p_starttime ; jS = mod ( jQ , jT ) - a_p_delay ; if ( jS < 0.0 ) jS += jT ; } else { jS = jQ - a_p_delay ; } if ( jS < 0.0 || jS >= a_p_lifetime ) { jR . iB = 0.0001 ; jR . iC = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } else { vec3 jU = a_position ; vec3 jV = a_normal ; jU += u_p_nfactor * jS * jV ; jU += a_p_vels . xyz * jS ; jU . y -= u_p_gravity * jS * jS / 2.0 ; jU += ( u_p_wind / u_p_mass ) * jS * jS / 2.0 ; jR . iC = jU ; jR . iF = a_p_vels . w * jS ; jR . iB = jt ( jS , u_p_max_lifetime , u_p_size_ramp ) ; jR . iD = jO ( jS , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; jR . iE = jF ( jS , u_p_max_lifetime , u_p_color_ramp ) ; } } return jR ; } void main ( ) { jP jX ; jX = jW ( ) ; vec4 jY = u_view_matrix * vec4 ( jX . iC , 1.0 ) ; gl_Position = u_proj_matrix * jY ; jh = jX . iD ; ic = jX . iE ; cx = jY . xyz ; float jZ = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; gl_PointSize = jX . iB * jZ ; }".split(" ")}]};
a["particles_texture.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying float jh ; varying vec3 ic ; varying vec2 a ; void main ( ) { vec4 iB = texture2D ( u_sampler , a ) ; vec3 iC = iB . rgb ; eg ( iC ) ; iC *= ic ; float iD = iB . a * jh ; ei ( iC ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"el ( iC , iD ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( iC , iD ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",a:[{type:"var",name:"BILLBOARD_ALIGN",b:["0"]},{type:"include",file:"particles.glslv"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",b:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",b:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",b:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",b:["4"]},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ; uniform vec2 u_p_size_ramp [ RAMPSIZE ] ; uniform vec4 u_p_color_ramp [ RAMPSIZE ] ; uniform float u_p_time ; uniform float u_p_starttime ; uniform float u_p_endtime ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform vec3 u_p_wind ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform float u_p_size ; varying float jh ; varying vec3 ic ; varying vec2 a ; varying vec4 cx ; struct jP { float iB ; vec3 iC ; float iD ; vec3 iE ; float iF ; } ; jP jW ( ) { float jQ = u_p_time - u_p_starttime ; jP jR ; if ( jQ < 0.0 ) { jR . iB = 0.0001 ; jR . iC = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } else { float jS ; if ( u_p_cyclic == 1 ) { float jT = u_p_endtime - u_p_starttime ; jS = mod ( jQ , jT ) - a_p_delay ; if ( jS < 0.0 ) jS += jT ; } else { jS = jQ - a_p_delay ; } if ( jS < 0.0 || jS >= a_p_lifetime ) { jR . iB = 0.0001 ; jR . iC = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } else { vec3 jU = a_position ; vec3 jV = a_normal ; jU += u_p_nfactor * jS * jV ; jU += a_p_vels . xyz * jS ; jU . y -= u_p_gravity * jS * jS / 2.0 ; jU += ( u_p_wind / u_p_mass ) * jS * jS / 2.0 ; jR . iC = jU ; jR . iF = a_p_vels . w * jS ; jR . iB = jt ( jS , u_p_max_lifetime , u_p_size_ramp ) ; jR . iD = jO ( jS , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; jR . iE = jF ( jS , u_p_max_lifetime , u_p_color_ramp ) ; } } return jR ; } float jZ ( vec2 jX , vec2 jY ) { return ( atan ( jY . y , jY . x ) - atan ( jX . y , jX . x ) ) ; } void main ( ) { jP j_ ; j_ = jW ( ) ; float ka ; mat4 kb ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { ka = j_ . iF ; kb = B ( j_ . iC , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { ka = j_ . iF ; kb = m ( ) ; kb [ 3 ] = vec4 ( j_ . iC , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { ka = j_ . iF ; kb = q ( radians ( - 90.0 ) ) ; kb [ 3 ] = vec4 ( j_ . iC , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { ka = jZ ( vec2 ( 0.0 , - 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + j_ . iF ; kb = o ( radians ( 90.0 ) ) ; kb [ 3 ] = vec4 ( j_ . iC , 1.0 ) ; } vec4 kc = vec4 ( a_p_bb_vertex * 2.0 * j_ . iB * u_p_size , 0.0 , 1.0 ) ; vec4 kd = kb * s ( ka ) * kc ; cx = u_view_matrix * kd ; vec4 ke = u_proj_matrix * cx ; gl_Position = ke ; jh = j_ . iD ; ic = j_ . iE ; a = a_p_bb_vertex + 0.5 ; }".split(" ")}]};
a["procedural_skydome.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 jP ; const float jQ = 0.99 ; const float jR = 1.8 ; const int jS = 8 ; float kb ( vec3 jT , vec3 jU ) { float jV = dot ( jU , jU ) ; float jW = 2.0 * dot ( jU , jT ) ; float jX = dot ( jT , jT ) - 1.0 ; float jY = jW * jW - 4.0 * jV * jX ; float jZ = sqrt ( jY ) ; float j_ = ( - jW - jZ ) / 2.0 ; float ka = jX / j_ ; return ka ; } float ki ( float kc , float kd ) { float ke = 3.0 * ( 1.0 - kd * kd ) ; float kf = 2.0 * ( 2.0 + kd * kd ) ; float kg = 1.0 + kc * kc ; float kh = pow ( 1.0 + kd * kd - 2.0 * kd * kc , 1.5 ) ; return ( ke / kf ) * ( kg / kh ) ; } float kq ( vec3 kj , vec3 kk , float kl ) { float km = dot ( kk , - kj ) ; if ( km < 0.0 ) { return 1.0 ; } vec3 kn = kj + km * kk ; if ( length ( kn ) < kl ) { return 0.0 ; } else if ( length ( kn ) >= kl ) { vec3 ko = normalize ( kn ) * kl - kj ; float kp = acos ( dot ( normalize ( ko ) , kk ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( kp * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 ku ( float kr , vec3 ks , float kt ) { return ks - ks * pow ( u_sky_color , vec3 ( kt / kr ) ) ; } void main ( ) { vec3 kv = normalize ( jP ) ; vec3 kw = u_sun_direction ; float kx = dot ( kv , kw ) ; float ky = ki ( kx , - 0.01 ) * u_rayleigh_brightness * kw . y ; float kz = ki ( kx - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - kw . y ) ; float kA = smoothstep ( 0.0 , 100.0 , ki ( kx , 0.9995 ) ) * u_spot_brightness ; vec3 kB = vec3 ( 0.0 , jQ , 0.0 ) ; float kC = kb ( kB , kv ) ; float kD = kC / float ( jS ) ; float kE = kq ( kB , kv , jQ - 0.3 ) ; vec3 kF = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 kG = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int kH = 0 ; kH < jS ; kH ++ ) { float kI = kD * float ( kH ) ; vec3 kJ = kB + kv * kI ; float kK = kq ( kJ , kw , jQ - 0.2 ) ; float kL = kb ( kJ , kw ) ; vec3 kM = ku ( kL , vec3 ( jR ) , u_scatter_strength ) * kK ; kF += ku ( sqrt ( kI ) , u_sky_color * kM , u_rayleigh_strength ) ; kG += ku ( kI , kM , u_mie_strength ) ; } kF = kF * kE * pow ( kC , u_rayleigh_collection_power ) / float ( jS ) ; kG = ( kG * kE * pow ( kC , u_mie_collection_power ) ) / float ( jS ) ; vec3 kN = vec3 ( kA * kG + kz * kG + ky * kF ) ; ei ( kN ) ; gl_FragColor = vec4 ( kN , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 jP ; void main ( ) { vec4 iB = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 iC = u_cube_view_matrix * iB ; jP = iC . xyz ; gl_Position = iB ; }".split(" ")}]};a["shadeless.glslf"]={type:"group",a:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"gamma.glslf"},
{type:"textline",b:"uniform float u_time ; uniform vec4 u_fog_color_density ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_colormap0 ; uniform float u_diffuse_color_factor ; uniform vec2 u_colormap0_uv_velocity ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ; varying vec2 a ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ic",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_diffuse_color",";"]}]}}]},{type:"textline",b:"varying vec4 cx ; void main ( ) {".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["vec2","iB","=","a",
";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:"vec3 iC = ic ; eg ( iC ) ; vec4 iD = vec4 ( iC , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","iD","=","u_diffuse_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",a:[{type:"textline",b:"vec4 iE = texture2D ( u_colormap0 , iB ) ; eg ( iE . rgb ) ; vec4 iF = texture2D ( u_colormap1 , iB ) ; eg ( iF . rgb ) ; vec4 iG = texture2D ( u_stencil0 , iB ) ; vec4 iH = mix ( iE , iF , iG . r ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 iH = texture2D ( u_colormap0 , iB + u_time * u_colormap0_uv_velocity ) ; eg ( iH . rgb ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MIX"],group:{type:"group",a:[{type:"textline",b:"iD . rgb = mix ( iD . rgb , iH . rgb , u_diffuse_color_factor ) ; iD . a = iH . a ;".split(" ")}]}},{type:"elif",c:["TEXTURE_BLEND_TYPE","==","TEXTURE_BLEND_TYPE_MULTIPLY"],group:{type:"group",a:[{type:"textline",
b:"iD . rgb *= mix ( vec3 ( 1.0 ) , iH . rgb , u_diffuse_color_factor ) ; iD . a = iH . a ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec3 iI = iD . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"float iJ = iD . a ;".split(" ")},{type:"condition",a:[{type:"if",c:["ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"if ( iJ < 0.5 ) discard ; iJ = 1.0 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float",
"iJ","=","1.0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"et ( iI , length ( cx ) , u_fog_color_density ) ;".split(" ")}]}}]},{type:"textline",b:["ei","(","iI",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA","&&","!","ALPHA_CLIP"],group:{type:"group",a:[{type:"textline",b:"el ( iI , iJ ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( iI , iJ ) ; }".split(" ")}]};a["shadeless.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",
b:["uniform"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; attribute vec3 a_normal ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"textline",b:["uniform","vec3","u_texture_scale",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_color",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",a:[{type:"if",
c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",b:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"textline",b:["varying",
"vec4","cx",";"]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ic",";"]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"textline",b:"void main ( ) { vec3 iB = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",
b:"iB = mix ( iB , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 iC = vec3 ( 0.0 ) ; vec3 iD = vec3 ( 0.0 ) ; vec3 iE = vec3 ( 0.0 ) ; bq ( iB , iC , iD , iE ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["vec3","iF","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 iF = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 iG = ( u_model_matrix * vec4 ( iF , 1.0 ) ) . xyz ; mat4 iH = ae ( u_camera_eye , iG , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 iI = ( u_model_matrix * vec4 ( iF , 1.0 ) ) . xyz ; iH = iH * S ( u_wind , u_time , u_jitter_amp , u_jitter_freq , iI ) ;".split(" ")}]}}]},
{type:"textline",b:"c iJ = al ( iB - iF , iF , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , iH ) ; iJ . b = iG ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"c iJ = al ( iB , iF , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL","&&","DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:["vec3","iK","=","a_normal",
";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 iK = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"ch ( iJ . a , iJ . b , iK ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["TEXTURE_COLOR"],group:{type:"group",a:[{type:"textline",b:"a = ao ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_COLOR"],group:{type:"group",a:[{type:"textline",b:["ic","=","a_color",";"]}]}}]},{type:"textline",b:"cx = u_view_matrix * vec4 ( iJ . a , 1.0 ) ; gl_Position = u_proj_matrix * cx ; }".split(" ")}]};
a["special_lens_flares.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; varying vec2 a ; void main ( ) { vec4 iB = texture2D ( u_sampler , a ) ; ei ( iB . rgb ) ; el ( iB . rgb , iB . a ) ; gl_FragColor = iB ; }".split(" ")}]};a["special_lens_flares.glslv"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 a ; void main ( ) { a = a_texcoord ; vec3 iB = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 iC = u_proj_matrix * u_view_matrix * vec4 ( iB , 0.0 ) ; iC . x /= iC . w ; iC . y /= iC . w ; iC += 99999.0 * step ( iC . z , 0.0 ) ; iC += 100.0 * ( step ( 1.0 , abs ( iC . x ) ) + step ( 1.0 , abs ( iC . y ) ) ) ; iC . x = - a_lf_dist * iC . x ; iC . y = - a_lf_dist * iC . y ; float iD = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 iE = vec2 ( a_lf_bb_vertex . x / iD , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 1.0 ) { const float iF = 1.9 ; iE *= ( 1.0 + iF * length ( iC . xy ) ) ; } gl_Position = vec4 ( iC . xy + iE , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",a:[{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:["uniform","samplerCube","u_sky",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS","&&","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 jP ; void main ( ) { vec3 iB = textureCube ( u_sky , jP ) . rgb ;".split(" ")},{type:"condition",a:[{type:"if",c:"WATER_EFFECTS && ! DISABLE_FOG && ! REFLECTION_PASS".split(" "),group:{type:"group",a:[{type:"textline",b:"eg ( iB . rgb ) ; float iC = u_camera_eye_frag . y - WATER_LEVEL ; iC = min ( - iC * 0.03 , 0.8 ) ; float iD = length ( u_sun_intensity ) + u_environment_energy ; vec3 iE = normalize ( jP ) ; vec3 iF = vec3 ( 0.0 ) ; vec4 iG = u_underwater_fog_color_density ; iG . rgb = mix ( iG . rgb , iF , min ( - iE . y + iC , 1.0 ) ) * iD ; float iH = clamp ( sign ( iE . y - 0.05 * iC ) , 0.0 , 1.0 ) ; iB = mix ( iG . rgb , iB , iH ) ; ei ( iB . rgb ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( iB , 1.0 ) ; }".split(" ")}]};a["special_skydome.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 jP ; void main ( ) { vec4 iB = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 iC = u_sky_vp_inverse * iB ; jP = iC . xyz ; gl_Position = iB ; }".split(" ")}]};a["special_water.glslf"]={type:"group",a:[{type:"var",name:"ABSORB",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",
name:"SSS_STRENGTH",b:["6.0"]},{type:"var",name:"SSS_WIDTH",b:["0.0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"fog.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"lighting.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"define",name:"REFL_BUMP",b:["0.001"]},{type:"define",name:"REFR_BUMP",b:["0.0001"]},{type:"textline",b:"uniform float u_time ; uniform vec3 u_zenith_color ; uniform float u_environment_energy ; uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors1 [ NUM_LIGHTS ] ; uniform vec4 u_light_factors2 [ NUM_LIGHTS ] ; uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE","||","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]}]}}]},{type:"condition",
a:[{type:"if",c:["!","DISABLE_FOG","&&","PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_reflectmap",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_depth",";"]}]}},{type:"elif",c:["ALPHA_MAP"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_alphamap",";"]}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",
a:[{type:"textline",b:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",b:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec2 u_specular_params ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap0_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap1_uv_velocity ; uniform vec2 u_normalmap1_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap2_uv_velocity ; uniform vec2 u_normalmap2_scale ;".split(" ")},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"uniform vec2 u_normalmap3_uv_velocity ; uniform vec2 u_normalmap3_scale ;".split(" ")}]}}]}]}}]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",
a:[{type:"textline",b:"uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ; uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"textline",b:"varying vec3 hZ ; varying vec3 h_ ;".split(" ")},{type:"condition",a:[{type:"if",
c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ia",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 ib ; varying vec3 jQ ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jR",";"]}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jS",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cw",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["varying","float","jT",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["REFRACTIVE","&&","SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float jZ ( in float jU , inout vec2 jV , in vec2 jW ) { vec4 jX = texture2D ( u_shore_depth , jV ) ; float jY = cq ( jX ) ; if ( jY < jT ) { jV = jW ; return jU ; } else { return jY ; } }".split(" ")}]}}]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",
b:"mat3 j_ = mat3 ( ib , jQ , ia ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 ka = normalize ( ia ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"mat3 j_ = mat3 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , - 1.0 , 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 ka = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"DYNAMIC && ( REFLECTIVE || FOAM || ( WATER_EFFECTS && ! DISABLE_FOG ) ) || GENERATED_MESH".split(" "),
group:{type:"group",a:[{type:"textline",b:"float kb = h_ . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"vec2 kc = vec2 ( jR . x , - jR . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec2 kc = vec2 ( h_ . x , - h_ . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec2",
"kc","=","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"vec3 kd = vec3 ( 0.0 ) ; vec3 ke = texture2D ( u_normalmap0 , kc * u_normalmap0_scale + u_normalmap0_uv_velocity * u_time ) . xyz - 0.5 ; kd += ke ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 kf = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["NORM_FOAM0"],group:{type:"group",a:[{type:"textline",
b:["kf","+=","ke",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","1"],group:{type:"group",a:[{type:"textline",b:"ke = texture2D ( u_normalmap0 , kc * u_normalmap1_scale + u_normalmap1_uv_velocity * u_time ) . xyz - 0.5 ; kd += ke ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM1"],group:{type:"group",a:[{type:"textline",b:["kf","+=","ke",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",
c:["NUM_NORMALMAPS",">","2"],group:{type:"group",a:[{type:"textline",b:"ke = texture2D ( u_normalmap0 , kc * u_normalmap2_scale + u_normalmap2_uv_velocity * u_time ) . xyz - 0.5 ; kd += ke ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM2"],group:{type:"group",a:[{type:"textline",b:["kf","+=","ke",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","3"],group:{type:"group",a:[{type:"textline",b:"ke = texture2D ( u_normalmap0 , kc * u_normalmap3_scale + u_normalmap3_uv_velocity * u_time ) . xyz - 0.5 ; kd += ke ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["NORM_FOAM3"],group:{type:"group",a:[{type:"textline",b:["kf","+=","ke",";"]}]}}]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"vec3 kg = mix ( ka , normalize ( j_ * kf ) , 0.2 ) ; kg = normalize ( kg ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],
group:{type:"group",a:[{type:"textline",b:"ka = mix ( ka , normalize ( j_ * kd ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"ka = mix ( ka , normalize ( j_ * kd ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",b:"ka = normalize ( ka ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 kh = normalize ( hZ ) ; vec3 ki = reflect ( - kh , ka ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 kj = cw . xy / cw . z ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","!","DISABLE_FOG"],group:{type:"group",a:[{type:"textline",b:"float kk = jT * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float kl = u_diffuse_color . a ; vec4 km = texture2DProj ( u_shore_depth , cw ) ; float kn = cq ( km ) ; float ko = max ( kn - jT , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",
b:"vec2 kp = kj . xy + ka . xz * REFR_BUMP / jT ; float kq = jZ ( kn , kp , kj ) ; float kr = max ( kq - jT , 0.0 ) ; float ks = u_view_max_depth / ABSORB * kr ; float kt ; if ( u_cam_water_depth < 0.0 ) kt = 0.0 ; else kt = min ( kl * ks , 1.0 ) ; float ku = u_view_max_depth / ABSORB * ko ; kl = min ( 15.0 * kl * u_view_max_depth * ko , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float ku = u_view_max_depth / ABSORB * ko ; kl = min ( kl * ku , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"kl *= min ( 5.0 * kk , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["ALPHA_MAP"],group:{type:"group",a:[{type:"textline",b:"vec4 kv = texture2D ( u_alphamap , kc ) ; float kl = kv . r ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float kl = u_diffuse_color . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float kt = 1.0 - kl ; vec2 kp = kj . xy + ka . xz * REFR_BUMP / jT ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"vec3 kw = texture2D ( u_refractmap , kp ) . rgb ; eg ( kw ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float kx = pow ( min ( jS . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 ky = mix ( u_shallow_water_col , u_diffuse_color . rgb , kx ) ; kx = pow ( min ( jS . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; ky = mix ( u_shore_water_col , ky , kx ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 ky = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"vec3 kz = u_diffuse_intensity * ky ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING"],group:{type:"group",a:[{type:"textline",b:"float kA = max ( 1.0 - u_view_max_depth * ko , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float kA = 1.0 - kl ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float kB = max ( 3.0 * kb , 0.0 ) ; kB *= kB ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 kC = normalize ( vec3 ( jS . r , 0.0 , jS . g ) ) ; vec3 kD = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , kC , 0.8 ) ) ; float kE = max ( 2.5 * dot ( kg , kD ) - 0.7 , 0.0 ) ; kA += kE * ( 1.0 - jS . b ) ; kB *= ( 1.0 - 0.95 * pow ( jS . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"kA += kB ; kA = min ( u_foam_factor * kA , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 kF = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + kc * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",b:"float kG = u_specular_params [ 0 ] ; float kH = u_specular_params [ 1 ] ; vec3 kI = kG * u_specular_color ; vec3 kJ = u_environment_energy * u_zenith_color ; vec3 kK = u_ambient * kJ ; vec3 kL = kK + u_sun_intensity ;".split(" ")},{type:"condition",a:[{type:"if",
c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"vec2 kM = kj . xy + ka . xz * REFL_BUMP / jT ; float kN = u_reflect_factor ; vec3 kO ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"kO = u_underwater_fog_color_density . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kO = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",b:"float kP = dot ( kh , ka ) ; kN *= max ( 1.0 - 1.0 / kP , 1.0 ) ; } else { kO = texture2D ( u_reflectmap , kM ) . rgb ; eg ( kO ) ; }".split(" ")}]}},
{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"float kN = u_mirror_factor ; vec3 kO = kL * textureCube ( u_mirrormap , ki ) . rgb ; eg ( kO ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float kN = 1.0 ; vec3 kO = kL * vec3 ( 0.3 , 0.5 , 1.0 ) ; eg ( kO ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 kQ = normalize ( ki + kh ) ; float kR = 1.0 - dot ( kh , kQ ) ; float kS = u_fresnel_params [ 3 ] ; float kT = u_fresnel_params [ 2 ] ; float kU = kS + ( 1.0 - kS ) * pow ( kR , kT ) ; kN = min ( kN * kU , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_PARAMS","&&","DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float kV = max ( dot ( u_sun_direction , - ia ) + SSS_WIDTH , 0.0 ) * max ( dot ( - kh , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; kV = clamp ( SSS_STRENGTH * kV , 0.0 , 1.0 ) ; kz = mix ( kz , u_shallow_water_col , kV ) ; kz = mix ( kz , u_shore_water_col , kV ) ;".split(" ")}]}}]},{type:"textline",b:"fa kW = gE ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , kz , kI , h_ , ka , kh , kH , u_diffuse_params , 1.0 , u_light_positions , u_light_directions , u_light_color_intensities , u_light_factors1 , u_light_factors2 , 0.0 , vec4 ( 0.0 ) ) ; kz = kW . a . rgb ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kz = mix ( kw , kz , kt ) ;".split(" ")}]}}]},{type:"textline",b:"kz = mix ( kz , kO , kN ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:"float kX = mix ( kF . g , kF . r , clamp ( 4.0 * ( kA - 0.75 ) , 0.0 , 1.0 ) ) ; kX = mix ( kF . b , kX , clamp ( 2.0 * kA - 1.0 , 0.0 , 1.0 ) ) ; kX = mix ( 0.0 , kX , kA ) ; kz = mix ( kz , kL , kX ) ;".split(" ")}]}}]},
{type:"textline",b:"kz += kW . b ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DISABLE_FOG"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 kY = eA ( u_cube_fog , kh ) ; vec4 kZ = vec4 ( kY , u_fog_color_density . a ) ; eg ( kZ . rgb ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["vec4","kZ","=","u_fog_color_density",";"]}]}}]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",
a:[{type:"textline",b:"if ( u_cam_water_depth < 0.0 ) { e_ ( kz , kk , u_cam_water_depth , u_underwater_fog_color_density , length ( u_sun_intensity ) + u_environment_energy ) ; } else { et ( kz , kk , kZ ) ; }".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"et ( kz , kk , kZ ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:["ei","(","kz",")",";"]},{type:"condition",a:[{type:"if",c:["!","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"kl = min ( max ( kl , kW . b . r ) , 1.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FOAM"],group:{type:"group",a:[{type:"textline",b:["kl","+=","kX",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"el ( kz , kl ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( kz , kl ) ; }".split(" ")}]};a["special_water.glslv"]={type:"group",a:[{type:"var",name:"DIR_MIN_SHR_FAC",b:["0.0"]},{type:"var",name:"DIR_FREQ",b:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",b:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",
b:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",b:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",b:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",b:["0.0"]},{type:"var",name:"DST_MIN_FAC",b:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",b:["0.0"]},{type:"var",name:"PRECISION",b:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",b:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Z",
b:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Z",b:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",b:["0.0"]},{type:"var",name:"WATER_LEVEL",b:["0.0"]},{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"var",name:"WAVES_LENGTH",b:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",b:["attribute","vec3","a_position",";"]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],
group:{type:"group",a:[{type:"textline",b:["attribute","float","a_cascad_step",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_shore_dist_map",
";"]}]}}]},{type:"textline",b:"varying vec3 hZ ; varying vec3 h_ ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","a",";"]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","ia",";"]},{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"varying vec3 ib ; varying vec3 jQ ;".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jR",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","jS",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:["varying","vec3","cw",";"]}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),
group:{type:"group",a:[{type:"textline",b:["varying","float","jT",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 iH ( in vec2 iB ) { vec2 iC = vec2 ( ( iB . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( SHORE_MAP_CENTER_Z + iB . y ) / SHORE_MAP_SIZE_Z ) + 0.5 ; iC = clamp ( iC , 0.0 , 1.0 ) ; vec4 iD = texture2D ( u_shore_dist_map , iC ) ; const vec2 iE = vec2 ( 1.0 / 255.0 , 1.0 ) ; float iF = dot ( iD . ba , iE ) ; vec2 iG = normalize ( iD . rg * 2.0 - 1.0 ) ; return vec3 ( iG , iF ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"void iV ( inout vec3 iI , in float iJ , in vec3 iK ) { float iL = hC ( DST_NOISE_SCALE_0 * ( iI . xz + DST_NOISE_FREQ_0 * iJ ) ) * hC ( DST_NOISE_SCALE_1 * ( iI . zx - DST_NOISE_FREQ_1 * iJ ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float iM = iK . b ; float iN = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float iO = sqrt ( iM ) ; float iP = max ( iM , DIR_MIN_SHR_FAC ) * ( sin ( ( iO / iN + DIR_FREQ * iJ ) ) ) * max ( hC ( DIR_NOISE_SCALE * ( iI . xz + DIR_NOISE_FREQ * iJ ) ) , DIR_MIN_NOISE_FAC ) ; float iQ = WAVES_HEIGHT * mix ( iP , iL , max ( iO , DST_MIN_FAC ) ) ; vec2 iR = iK . rg ; float iS = WAVES_HOR_FAC * iP * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - iM ) , 0.0 ) ; vec2 iT = iS * iR ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"float iQ = WAVES_HEIGHT * iL ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float iU = gY ( 20.0 / WAVES_LENGTH * ( iI . xz - 0.25 * iJ ) ) . x + gY ( 17.0 / WAVES_LENGTH * ( iI . zx + 0.1 * iJ ) ) . x - 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"iI . xz += iT ; iU *= iM ;".split(" ")}]}}]},{type:"textline",
b:"iQ += 0.05 * iU ;".split(" ")}]}}]},{type:"textline",b:"iI . y += iQ ; }".split(" ")}]}}]},{type:"textline",b:"void main ( ) { vec3 iW = a_position ;".split(" ")},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"float iX = abs ( a_cascad_step ) ; vec2 iY = u_camera_eye . xz - mod ( u_camera_eye . xz , iX ) ; iW . y += WATER_LEVEL ; iW . xz += iY ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["a","=","a_texcoord",";"]}]}}]},
{type:"textline",b:"c jU = al ( iW , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["DYNAMIC","&&","GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"jR = jU . a ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"jS = iH ( jU . a . xz ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"float jV = length ( u_wind ) ; float jW = u_time ; jW *= jV ;".split(" ")},
{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:["float","jX","=","iX",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","jX","=","0.1",";"]}]}}]},{type:"textline",b:"vec3 jY = jU . a + vec3 ( jX , 0.0 , 0.0 ) ; vec3 jZ = jU . a + vec3 ( 0.0 , 0.0 , jX ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"vec3 j_ = iH ( jY . xz ) ; vec3 ka = iH ( jZ . xz ) ; iV ( jY , jW , j_ ) ; iV ( jZ , jW , ka ) ; iV ( jU . a , jW , jS ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"iV ( jY , jW , vec3 ( 0.0 ) ) ; iV ( jZ , jW , vec3 ( 0.0 ) ) ; iV ( jU . a , jW , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["GENERATED_MESH"],group:{type:"group",a:[{type:"textline",b:"if ( a_cascad_step < 0.0 ) { jY . y = jU . a . y ; jZ . y = jU . a . y ; }".split(" ")}]}}]},{type:"textline",b:"vec3 kb = normalize ( jY - jU . a ) ; vec3 kc = normalize ( jZ - jU . a ) ; ia = normalize ( cross ( kc , kb ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["NUM_NORMALMAPS",">","0"],group:{type:"group",a:[{type:"textline",b:"ib = kc ; jQ = cross ( ia , ib ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SHORE_PARAMS"],group:{type:"group",a:[{type:"textline",b:"float kd = dot ( ia , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float ke = clamp ( 0.8 - kd , 0.0 , 1.0 ) ; ia = mix ( ia , vec3 ( 0.0 , 1.0 , 0.0 ) , ke ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"h_ = jU . a ; hZ = u_camera_eye - jU . a ; vec4 kf = u_view_matrix * vec4 ( jU . a , 1.0 ) ; vec4 kg = u_proj_matrix * kf ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SHORE_SMOOTHING","||","REFLECTIVE","||","REFRACTIVE"],group:{type:"group",a:[{type:"textline",b:"float kh = kg . x ; float ki = kg . y ; float kj = kg . w ; cw . x = ( kh + kj ) / 2.0 ; cw . y = ( ki + kj ) / 2.0 ; cw . z = kj ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:"SHORE_SMOOTHING || REFLECTIVE || REFRACTIVE || ! DISABLE_FOG".split(" "),group:{type:"group",a:[{type:"textline",b:"jT = - kf . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",
b:["gl_Position","=","kg",";","}"]}]};a["wireframe.glslf"]={type:"group",a:[{type:"define",name:"WM_OPAQUE_WIREFRAME",b:["0"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",b:["1"]},{type:"define",name:"WM_FRONT_BACK_VIEW",b:["2"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},
{type:"textline",b:"varying vec3 jU ; const float jV = 1.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",a:[{type:"textline",b:"const vec3 jW = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 jW = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"const vec3 jX = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 jY = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 jZ = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"void main ( ) { vec3 j_ = vec3 ( 0.0 ) ; float ka = 0.0 ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"vec3 kb = sign ( jU - vec3 ( 0.02 * jV ) ) ; if ( kb . x < 0.0 || kb . y < 0.0 || kb . z < 0.0 ) { j_ = jW ; ka = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",c:["WIREFRAME_QUALITY","==","0"],group:{type:"group",a:[{type:"textline",b:"vec3 kb = sign ( jU - vec3 ( 0.02 * jV ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( kb . x < 0.0 || kb . y < 0.0 || kb . z < 0.0 ) j_ = u_wireframe_edge_color ; else j_ = jZ ; ka = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( kb . x < 0.0 || kb . y < 0.0 || kb . z < 0.0 ) ka = 1.0 ; else ka = 0.0 ; j_ = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( kb . x < 0.0 || kb . y < 0.0 || kb . z < 0.0 ) j_ = u_wireframe_edge_color ; else if ( gl_FrontFacing ) j_ = jX ; else j_ = jY ; ka = 1.0 ; }".split(" ")}]}},
{type:"elif",c:["WIREFRAME_QUALITY","==","1"],group:{type:"group",a:[{type:"extension",b:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",b:"vec3 kc = fwidth ( jU ) ; vec3 kd = smoothstep ( vec3 ( 0.0 ) , kc * jV , jU ) ; float ke = min ( min ( kd . x , kd . y ) , kd . z ) ; ke = clamp ( ke , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { j_ = vec3 ( mix ( u_wireframe_edge_color , jZ , ke ) ) ; ka = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { j_ = u_wireframe_edge_color ; ka = mix ( 1.0 , 0.0 , ke ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) j_ = mix ( u_wireframe_edge_color , jX , ke ) ; else j_ = mix ( u_wireframe_edge_color , jY , ke ) ; ka = 1.0 ; }".split(" ")}]}}]},
{type:"textline",b:["ei","(","j_",")",";"]},{type:"condition",a:[{type:"if",c:["ALPHA"],group:{type:"group",a:[{type:"textline",b:"el ( j_ , ka ) ;".split(" ")}]}}]},{type:"textline",b:"gl_FragColor = vec4 ( j_ , ka ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",a:[{type:"var",name:"AU_QUALIFIER",b:["uniform"]},{type:"var",name:"PRECISION",b:["lowp"]},{type:"var",name:"MAX_BONES",b:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",b:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",a:[{type:"textline",b:["attribute","float","a_bending_col_main",";"]},{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",b:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",
a:[{type:"textline",b:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["STATIC_BATCH"],group:{type:"group",a:[{type:"textline",b:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",b:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"condition",
a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]}]}}]},
{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ;".split(" ")}]}}]}]}}]},{type:"textline",b:["varying","vec3","jU",";"]},{type:"condition",a:[{type:"if",c:["!","DEBUG_SPHERE"],group:{type:"group",a:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",
file:"dynamic_grass.glslv"}]}}]},{type:"textline",b:"void main ( ) { if ( a_polyindex == 0.0 ) jU = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) jU = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) jU = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 iB = a_position ; vec3 iC = a_normal ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEBUG_SPHERE"],group:{type:"group",a:[{type:"textline",b:"c iD = al ( iB , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["VERTEX_ANIM"],group:{type:"group",a:[{type:"textline",b:"iB = mix ( iB , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"textline",b:"vec3 iE = vec3 ( 0.0 ) ; vec3 iF = vec3 ( 0.0 ) ; bq ( iB , iE , iF , iC ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND","||","DYNAMIC_GRASS","||","HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",
b:["vec3","iG","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 iG = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"c iD = dY ( iB , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , iG , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"condition",a:[{type:"if",
c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"vec3 iH = ( u_model_matrix * vec4 ( iG , 1.0 ) ) . xyz ; mat4 iI = ae ( u_camera_eye , iH , u_view_matrix ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["WIND_BEND","&&","HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"vec3 iJ = ( u_model_matrix * vec4 ( iG , 1.0 ) ) . xyz ; iI = iI * S ( u_wind , u_time , u_jitter_amp , u_jitter_freq , iJ ) ;".split(" ")}]}}]},{type:"textline",b:"c iD = al ( iB - iG , iG , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , iI ) ; iD . b = iH ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"c iD = al ( iB , iG , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"ch ( iD . a , iD . b , iC ) ;".split(" ")}]}}]}]}}]},{type:"textline",b:"vec4 iK = u_view_matrix * vec4 ( iD . a , 1.0 ) ; gl_Position = u_proj_matrix * iK ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},
{type:"textline",b:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 a ; void main ( ) { vec4 iB = texture2D ( u_sampler_left , a ) ; vec4 iC = texture2D ( u_sampler_right , a ) ; gl_FragColor = vec4 ( iB [ 0 ] , iC [ 1 ] , iC [ 2 ] , iB [ 3 ] + iC [ 3 ] ) ; }".split(" ")}]};a["postprocessing/antialiasing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",b:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",
b:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",b:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",b:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",b:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",b:["8.0"]},{type:"textline",b:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 a ; vec4 iE ( float iB , float iC ) { vec2 iD = a + vec2 ( iB , iC ) * u_texel_size ; return texture2D ( u_color , iD ) ; } float iI ( vec4 iF ) { vec3 iG = vec3 ( 0.299 , 0.587 , 0.114 ) ; float iH = dot ( iF . rgb , iG ) ; return iH ; } vec4 jX ( ) { vec4 iJ = iE ( - 1.0 , - 1.0 ) ; vec4 iK = iE ( 1.0 , - 1.0 ) ; vec4 iL = iE ( - 1.0 , 1.0 ) ; vec4 iM = iE ( 1.0 , 1.0 ) ; vec4 iN = iE ( 0.0 , 0.0 ) ; float iO = iI ( iJ ) ; float iP = iI ( iK ) ; float iQ = iI ( iL ) ; float iR = iI ( iM ) ; float iS = iI ( iN ) ; float iT = min ( iS , min ( min ( iO , iP ) , min ( iQ , iR ) ) ) ; float iU = max ( iS , max ( max ( iO , iP ) , max ( iQ , iR ) ) ) ; vec2 iV ; iV . x = - ( ( iO + iP ) - ( iQ + iR ) ) ; iV . y = ( ( iO + iQ ) - ( iP + iR ) ) ; float iW = max ( ( iO + iP + iQ + iR ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float iX = 1.0 / ( min ( abs ( iV . x ) , abs ( iV . y ) ) + iW ) ; iV = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , iV * iX ) ) * u_texel_size ; vec4 iY = 0.5 * ( texture2D ( u_color , a + iV * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , a + iV * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 jV = iY * 0.5 + 0.25 * ( texture2D ( u_color , a + iV * - 0.5 ) + texture2D ( u_color , a + iV * 0.5 ) ) ; float jW = iI ( jV ) ; if ( ( jW < iT ) || ( jW > iU ) ) return iY ; else return jV ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",b:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",b:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",b:["(","3.0","/","4.0",")"]},{type:"textline",b:"vec4 lI ( ) { vec2 jY ; jY . x = a . x ; jY . y = a . y ; vec4 jZ = texture2D ( u_color , jY ) ; vec4 j_ = iE ( 0.0 , 1.0 ) ; vec4 ka = iE ( 1.0 , 0.0 ) ; vec4 kb = iE ( 0.0 , - 1.0 ) ; vec4 kc = iE ( - 1.0 , 0.0 ) ; float kd = iI ( j_ ) ; float ke = iI ( ka ) ; float kf = iI ( kb ) ; float kg = iI ( kc ) ; float kh = iI ( jZ ) ; float ki = max ( kd , kh ) ; float kj = min ( kd , kh ) ; float kk = max ( ke , ki ) ; float kl = min ( ke , kj ) ; float km = max ( kf , kg ) ; float kn = min ( kf , kg ) ; float ko = max ( km , kk ) ; float kp = min ( kn , kl ) ; float kq = ko * FXAA_QUALITY_EDGE_THRESHOLD ; float kr = ko - kp ; float ks = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , kq ) ; bool kt = kr < ks ; if ( kt ) return jZ ; vec4 ku = iE ( - 1.0 , - 1.0 ) ; vec4 kv = iE ( 1.0 , 1.0 ) ; vec4 kw = iE ( 1.0 , - 1.0 ) ; vec4 kx = iE ( - 1.0 , 1.0 ) ; float ky = iI ( ku ) ; float kz = iI ( kv ) ; float kA = iI ( kw ) ; float kB = iI ( kx ) ; float kC = kf + kd ; float kD = kg + ke ; float kE = 1.0 / kr ; float kF = kC + kD ; float kG = ( - 2.0 * kh ) + kC ; float kH = ( - 2.0 * kh ) + kD ; float kI = kA + kz ; float kJ = ky + kA ; float kK = ( - 2.0 * ke ) + kI ; float kL = ( - 2.0 * kf ) + kJ ; float kM = ky + kB ; float kN = kB + kz ; float kO = ( abs ( kG ) * 2.0 ) + abs ( kK ) ; float kP = ( abs ( kH ) * 2.0 ) + abs ( kL ) ; float kQ = ( - 2.0 * kg ) + kM ; float kR = ( - 2.0 * kd ) + kN ; float kS = abs ( kQ ) + kO ; float kT = abs ( kR ) + kP ; float kU = kM + kI ; float kV = u_texel_size . x ; bool kW = kS >= kT ; float kX = kF * 2.0 + kU ; if ( ! kW ) kf = kg ; if ( ! kW ) kd = ke ; if ( kW ) kV = u_texel_size . y ; float kY = ( kX * ( 1.0 / 12.0 ) ) - kh ; float kZ = kf - kh ; float k_ = kd - kh ; float la = kf + kh ; float lb = kd + kh ; bool lc = abs ( kZ ) >= abs ( k_ ) ; float ld = max ( abs ( kZ ) , abs ( k_ ) ) ; if ( lc ) kV = - kV ; float le = clamp ( abs ( kY ) * kE , 0.0 , 1.0 ) ; vec2 lf ; lf . x = jY . x ; lf . y = jY . y ; vec2 lg ; lg . x = ( ! kW ) ? 0.0 : u_texel_size . x ; lg . y = ( kW ) ? 0.0 : u_texel_size . y ; if ( ! kW ) lf . x += kV * 0.5 ; if ( kW ) lf . y += kV * 0.5 ; vec2 lh ; lh . x = lf . x - lg . x ; lh . y = lf . y - lg . y ; vec2 li ; li . x = lf . x + lg . x ; li . y = lf . y + lg . y ; float lj = ( ( - 2.0 ) * le ) + 3.0 ; float lk = iI ( texture2D ( u_color , lh ) ) ; float ll = le * le ; float lm = iI ( texture2D ( u_color , li ) ) ; if ( ! lc ) la = lb ; float ln = ld * 1.0 / 4.0 ; float lo = kh - la * 0.5 ; float lp = lj * ll ; bool lq = lo < 0.0 ; lk -= la * 0.5 ; lm -= la * 0.5 ; bool lr = abs ( lk ) >= ln ; bool ls = abs ( lm ) >= ln ; if ( ! lr ) lh . x -= lg . x * 1.5 ; if ( ! lr ) lh . y -= lg . y * 1.5 ; bool lt = ( ! lr ) || ( ! ls ) ; if ( ! ls ) li . x += lg . x * 1.5 ; if ( ! ls ) li . y += lg . y * 1.5 ; if ( lt ) { if ( ! lr ) lk = iI ( texture2D ( u_color , lh . xy ) ) ; if ( ! ls ) lm = iI ( texture2D ( u_color , li . xy ) ) ; if ( ! lr ) lk = lk - la * 0.5 ; if ( ! ls ) lm = lm - la * 0.5 ; lr = abs ( lk ) >= ln ; ls = abs ( lm ) >= ln ; if ( ! lr ) lh . x -= lg . x * 2.0 ; if ( ! lr ) lh . y -= lg . y * 2.0 ; lt = ( ! lr ) || ( ! ls ) ; if ( ! ls ) li . x += lg . x * 2.0 ; if ( ! ls ) li . y += lg . y * 2.0 ; if ( lt ) { if ( ! lr ) lk = iI ( texture2D ( u_color , lh . xy ) ) ; if ( ! ls ) lm = iI ( texture2D ( u_color , li . xy ) ) ; if ( ! lr ) lk = lk - la * 0.5 ; if ( ! ls ) lm = lm - la * 0.5 ; lr = abs ( lk ) >= ln ; ls = abs ( lm ) >= ln ; if ( ! lr ) lh . x -= lg . x * 2.0 ; if ( ! lr ) lh . y -= lg . y * 2.0 ; lt = ( ! lr ) || ( ! ls ) ; if ( ! ls ) li . x += lg . x * 2.0 ; if ( ! ls ) li . y += lg . y * 2.0 ; if ( lt ) { if ( ! lr ) lk = iI ( texture2D ( u_color , lh . xy ) ) ; if ( ! ls ) lm = iI ( texture2D ( u_color , li . xy ) ) ; if ( ! lr ) lk = lk - la * 0.5 ; if ( ! ls ) lm = lm - la * 0.5 ; lr = abs ( lk ) >= ln ; ls = abs ( lm ) >= ln ; if ( ! lr ) lh . x -= lg . x * 4.0 ; if ( ! lr ) lh . y -= lg . y * 4.0 ; lt = ( ! lr ) || ( ! ls ) ; if ( ! ls ) li . x += lg . x * 4.0 ; if ( ! ls ) li . y += lg . y * 4.0 ; if ( lt ) { if ( ! lr ) lk = iI ( texture2D ( u_color , lh . xy ) ) ; if ( ! ls ) lm = iI ( texture2D ( u_color , li . xy ) ) ; if ( ! lr ) lk = lk - la * 0.5 ; if ( ! ls ) lm = lm - la * 0.5 ; lr = abs ( lk ) >= ln ; ls = abs ( lm ) >= ln ; if ( ! lr ) lh . x -= lg . x * 2.0 ; if ( ! lr ) lh . y -= lg . y * 2.0 ; if ( ! ls ) li . x += lg . x * 2.0 ; if ( ! ls ) li . y += lg . y * 2.0 ; } } } } float lu = jY . x - lh . x ; float lv = li . x - jY . x ; if ( ! kW ) lu = jY . y - lh . y ; if ( ! kW ) lv = li . y - jY . y ; bool lw = ( lk < 0.0 ) != lq ; float lx = ( lv + lu ) ; bool ly = ( lm < 0.0 ) != lq ; float lz = 1.0 / lx ; bool lA = lu < lv ; float lB = min ( lu , lv ) ; bool lC = lA ? lw : ly ; float lD = lp * lp ; float lE = ( lB * ( - lz ) ) + 0.5 ; float lF = lD * FXAA_QUALITY_SUBPIX ; float lG = lC ? lE : 0.0 ; float lH = max ( lG , lF ) ; if ( ! kW ) jY . x += lH * kV ; if ( kW ) jY . y += lH * kV ; return texture2D ( u_color , jY ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",b:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",b:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",b:["0.05"]},{type:"textline",b:["void","main","(",")","{"]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_PASS"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_LIGHT"],group:{type:"group",a:[{type:"textline",
b:"gl_FragColor = jX ( ) ;".split(" ")}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_FXAA_QUALITY"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = lI ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , a ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec2 iB = vec2 ( 0.0 , 0.0 ) ; vec2 iC = u_texel_size ; vec4 iD = texture2D ( u_color , a ) ; gl_FragColor = iD * 0.0875447373698 ; iB += iC ; gl_FragColor += texture2D ( u_color , a + iB ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , a - iB ) * 0.0858112354248 ; iB += iC ; gl_FragColor += texture2D ( u_color , a + iB ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , a - iB ) * 0.0808139781061 ; iB += iC ; gl_FragColor += texture2D ( u_color , a + iB ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , a - iB ) * 0.0731235112908 ; iB += iC ; gl_FragColor += texture2D ( u_color , a + iB ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , a - iB ) * 0.0635705267419 ; iB += iC ; gl_FragColor += texture2D ( u_color , a + iB ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , a - iB ) * 0.0530985673112 ; iB += iC ; gl_FragColor += texture2D ( u_color , a + iB ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , a - iB ) * 0.0426125984122 ; iB += iC ; gl_FragColor += texture2D ( u_color , a + iB ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , a - iB ) * 0.0328565115809 ; iB += iC ; gl_FragColor += texture2D ( u_color , a + iB ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , a - iB ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * iD , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 a ; void main ( ) { vec4 iB = texture2D ( u_main , a ) ; vec4 iC = texture2D ( u_bloom , a ) ; vec4 iD = iB ; iD += iC ; gl_FragColor = vec4 ( iD . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/blur_depth.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},
{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform vec2 u_texel_size ; uniform vec2 u_camera_range ; uniform float u_blur_depth_edge_size ; uniform float u_blur_depth_diff_threshold ; varying vec2 a ; float kd ( in vec2 kc ) { return kb ( u_depth , kc , u_camera_range ) ; } void main ( ) { vec2 ke = u_texel_size ; vec4 kf = texture2D ( u_color , a ) ; float kg = kd ( a ) ; float kh = kd ( a + u_blur_depth_edge_size * ke ) ; float ki = kd ( a - u_blur_depth_edge_size * ke ) ; float kj = abs ( kg - kh ) ; float kk = abs ( kg - ki ) ; float kl = max ( kj , kk ) ; if ( kl > u_blur_depth_diff_threshold ) { gl_FragColor = kf ; return ; } vec2 km = vec2 ( 0.0 , 0.0 ) ; gl_FragColor = kf * 0.2270270270 ; km += ke ; gl_FragColor += texture2D ( u_color , a + km ) * 0.1945945946 , gl_FragColor += texture2D ( u_color , a - km ) * 0.1945945946 , km += ke ; gl_FragColor += texture2D ( u_color , a + km ) * 0.1216216216 , gl_FragColor += texture2D ( u_color , a - km ) * 0.1216216216 , km += ke ; gl_FragColor += texture2D ( u_color , a + km ) * 0.0540540541 , gl_FragColor += texture2D ( u_color , a - km ) * 0.0540540541 , km += ke ; gl_FragColor += texture2D ( u_color , a + km ) * 0.0162162162 ; gl_FragColor += texture2D ( u_color , a - km ) * 0.0162162162 ; }".split(" ")}]};
a["postprocessing/compositing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"PI_4",b:["0.785398163"]},{type:"textline",b:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 a ; void main ( ) { vec4 iB = texture2D ( u_color , a ) ; vec3 iC = iB . rgb ; if ( u_brightness < 0.0 ) iC = iC * ( 1.0 + u_brightness ) ; else iC = iC + ( ( 1.0 - iC ) * u_brightness ) ; iC = ( iC - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; iC *= u_exposure ; vec3 iD = vec3 ( 0.299 , 0.587 , 0.114 ) ; float iE = dot ( iC , iD ) ; iC = mix ( vec3 ( iE ) , iC , u_saturation ) ; gl_FragColor = vec4 ( iC , iB . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { gl_FragColor = cm ( clamp ( kb ( u_depth , a , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};a["postprocessing/dof.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"depth_fetch.glslf"},{type:"textline",b:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 a ; void main ( ) { vec4 kc = texture2D ( u_sharp , a ) ; if ( u_dof_dist > 0.0 ) { float kd = kb ( u_depth , a , u_camera_range ) ; kd *= u_view_max_depth ; float ke ; if ( kd < u_dof_dist ) ke = ( u_dof_dist - kd ) / u_dof_front ; else ke = ( kd - u_dof_dist ) / u_dof_rear ; ke = clamp ( ke , 0.0 , 1.0 ) ; vec4 kf = texture2D ( u_blurred , a ) ; gl_FragColor = mix ( kc , kf , ke ) ; } else gl_FragColor = kc ; }".split(" ")}]};
a["postprocessing/edge.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",b:"uniform sampler2D u_sampler ; uniform vec2 u_texel_size ; varying vec2 a ; float iG ( float iB , float iC , float iD ) { vec2 iE = a + vec2 ( iB , iC ) * u_texel_size ; vec4 iF = texture2D ( u_sampler , iE ) * iD ; return cq ( iF ) ; } void main ( ) { float iH = ( iG ( - 1.0 , - 1.0 , - 1.0 ) + iG ( 0.0 , - 1.0 , - 1.0 ) + iG ( 1.0 , - 1.0 , - 1.0 ) + iG ( - 1.0 , 0.0 , - 1.0 ) + iG ( 0.0 , 0.0 , 8.0 ) + iG ( 1.0 , 0.0 , - 1.0 ) + iG ( - 1.0 , 1.0 , - 1.0 ) + iG ( 0.0 , 1.0 , - 1.0 ) + iG ( 1.0 , 1.0 , - 1.0 ) ) ; iH *= 1000.0 ; gl_FragColor = vec4 ( iH , iH , iH , 1.0 ) ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_glow_src ; uniform sampler2D u_glow_mask ; uniform sampler2D u_glow_mask_blurred ; uniform vec3 u_glow_color ; uniform float u_draw_glow ; varying vec2 a ; void main ( ) { vec4 iB = texture2D ( u_glow_src , a ) ; gl_FragColor = iB ; if ( u_draw_glow != 0.0 ) { vec4 iC = texture2D ( u_glow_mask , a ) ; vec4 iD = texture2D ( u_glow_mask_blurred , a ) ; float iE = iD . a - iC . a ; if ( iE != 0.0 ) { float iF = smoothstep ( 0.0 , 1.0 , iD . a ) ; if ( iC . a == 0.0 ) { vec3 iG = u_glow_color ; ei ( iG ) ; vec4 iH = vec4 ( clamp ( iG , 0.0 , 1.0 ) , iF ) ; gl_FragColor = mix ( iB , iH , iF ) ; } } } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"var",name:"STEPS_PER_PASS",b:["0.0"]},{type:"textline",b:"uniform float u_time ; uniform float u_radial_blur_step ; uniform vec3 u_sun_intensity ; uniform sampler2D u_input ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec2","u_camera_range",
";"]},{type:"condition",a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"varying float kc ; varying vec2 kd ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 ke ; void main ( ) { vec3 kf = u_sun_intensity ; vec2 kg = ( ke . xy - a ) ; float kh = length ( kg ) ; vec2 ki = u_radial_blur_step * kg / kh ; float kj = kh / u_radial_blur_step ; ki *= min ( kj , STEPS_PER_PASS ) / STEPS_PER_PASS ; kj = max ( kj , STEPS_PER_PASS ) ; vec2 kk = a ; float kl = 0.0 ; for ( float km = 0.0 ; km < STEPS_PER_PASS ; km += 1.0 ) { if ( km <= kj ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:"float kn = kb ( u_input , kk , u_camera_range ) ; kl += ( 1.0 - pow ( kh , 0.3 ) ) * kn ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"kl += texture2D ( u_input , kk ) . r ;".split(" ")}]}}]},{type:"textline",b:"} kk += ki ; }".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"vec2 ko = a + kd ; float kp = gY ( vec2 ( 2.5 * ( ko . x ) , 2.5 * ( ko . y ) + 1.0 * u_time ) ) . x + 0.75 * gY ( vec2 ( 5.0 * ( ko . x ) - 0.66 * u_time , 5.0 * ( ko . y ) + 0.66 * u_time ) ) . x + 0.5 * hC ( vec2 ( 7.5 * ( ko . x ) + 0.33 * u_time , 7.5 * ( ko . y ) - 0.33 * u_time ) ) ; kp *= clamp ( 1.2 - sqrt ( 0.2 * kh ) , 0.0 , 1.0 ) * kc ; kl = max ( kp , kl ) ;".split(" ")}]}}]},
{type:"textline",b:"gl_FragColor = vec4 ( kl / STEPS_PER_PASS * clamp ( kf , 0.4 , 0.8 ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]={type:"group",a:[{type:"define",name:"LIGHT_INDEX",b:["0"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",a:[{type:"if",c:["DEPTH_RGBA"],group:{type:"group",a:[{type:"textline",b:["uniform","vec3","u_camera_eye",";"]},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"uniform vec4 u_camera_quat ; uniform vec4 u_refl_plane ; varying float kc ; varying vec2 kd ;".split(" ")}]}}]}]}}]},{type:"textline",b:"varying vec2 a ; varying vec4 ke ; void iI ( in vec4 iB , in vec3 iC , out vec3 iD ) { float iE = iB . w * iC . x + iB . y * iC . z - iB . z * iC . y ; float iF = iB . w * iC . y + iB . z * iC . x - iB . x * iC . z ; float iG = iB . w * iC . z + iB . x * iC . y - iB . y * iC . x ; float iH = - iB . x * iC . x - iB . y * iC . y - iB . z * iC . z ; iD . x = iE * iB . w - iH * iB . x - iF * iB . z + iG * iB . y ; iD . y = iF * iB . w - iH * iB . y - iG * iB . x + iE * iB . z ; iD . z = iG * iB . w - iH * iB . z - iE * iB . y + iF * iB . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 iJ = normalize ( u_sun_direction ) ; ke = u_proj_matrix * u_view_matrix * vec4 ( iJ , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DEPTH_RGBA","&&","WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"if ( u_camera_eye . y + a_bb_vertex . t < - u_refl_plane . w ) { kc = 1.0 ; vec3 iK = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 iL ; iI ( u_camera_quat , iK , iL ) ; iL = normalize ( iL ) ; float iM = dot ( iL , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float iN = atan ( iL . x , iL . z ) ; kd = vec2 ( - iN , acos ( iM ) ) ; } else { kc = 0.0 ; }".split(" ")}]}}]},{type:"textline",b:"ke . x /= ke . w ; ke . y /= ke . w ; ke . x = 0.5 * ( ke . x + 1.0 ) ; ke . y = 0.5 * ( ke . y + 1.0 ) ; ke += 99999.0 * step ( ke . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; varying vec2 a ; void main ( ) { vec4 iB = texture2D ( u_main , a ) ; eg ( iB . rgb ) ; vec3 iC = iB . rgb + u_god_rays_intensity * ( texture2D ( u_god_rays , a ) ) . rgb ; ei ( iC ) ; gl_FragColor . rgb = iC ; gl_FragColor . a = iB . a ; }".split(" ")}]};
a["postprocessing/lanczos.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) { vec4 iB = texture2D ( u_color , a ) * 0.38026 ; iB += texture2D ( u_color , a - u_texel_size ) * 0.27667 ; iB += texture2D ( u_color , a + u_texel_size ) * 0.27667 ; iB += texture2D ( u_color , a - 2.0 * u_texel_size ) * 0.08074 ; iB += texture2D ( u_color , a + 2.0 * u_texel_size ) * 0.08074 ; iB += texture2D ( u_color , a - 3.0 * u_texel_size ) * - 0.02612 ; iB += texture2D ( u_color , a + 3.0 * u_texel_size ) * - 0.02612 ; iB += texture2D ( u_color , a - 4.0 * u_texel_size ) * - 0.02143 ; iB += texture2D ( u_color , a + 4.0 * u_texel_size ) * - 0.02143 ; gl_FragColor = iB ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; varying vec2 a ; void main ( ) { vec4 iB = texture2D ( u_input , a ) ; float iC = dot ( iB . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( iC ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_input ; void main ( ) { float iB ; float iC = 0.0 ; for ( float iD = 0.025 ; iD < 1.0 ; iD += 0.05 ) for ( float iE = 0.025 ; iE < 1.0 ; iE += 0.05 ) { iB = max ( texture2D ( u_input , vec2 ( iD , iE ) ) . r , 0.01 ) ; iC += log ( iB ) ; } float iF = exp ( iC / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( iF ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 a ; varying float kf ; void main ( ) { float kg = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float kh = texture2D ( u_luminance , a ) . r ; vec4 ki = texture2D ( u_main , a ) ; float kj = kh / kg ; float kk = u_bloom_edge_lum ; gl_FragColor = ki * max ( kj - kk , 0.0 ) * kf ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 a ; varying float kf ; const vec3 iB = vec3 ( 0.0 , 1.0 , 0.0 ) ; void iJ ( in vec4 iC , in vec3 iD , out vec3 iE ) { float iF = iC . w * iD . x + iC . y * iD . z - iC . z * iD . y ; float iG = iC . w * iD . y + iC . z * iD . x - iC . x * iD . z ; float iH = iC . w * iD . z + iC . x * iD . y - iC . y * iD . x ; float iI = - iC . x * iD . x - iC . y * iD . y - iC . z * iD . z ; iE . x = iF * iC . w - iI * iC . x - iG * iC . z + iH * iC . y ; iE . y = iG * iC . w - iI * iC . y - iH * iC . x + iF * iC . z ; iE . z = iH * iC . w - iI * iC . z - iF * iC . y + iG * iC . x ; } void main ( ) { a = a_bb_vertex + 0.5 ; vec3 iK ; iJ ( u_camera_quat , iB , iK ) ; kf = dot ( - iK , u_sun_direction ) * u_bloom_key ; kf *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",a:[{type:"var",name:"BLUR_DECAY_THRESHOLD",b:["0.0"]},{type:"include",file:"precision_statement.glslf"},{type:"textline",b:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; varying vec2 a ; void main ( ) { vec4 iB = texture2D ( u_mb_tex_curr , a ) ; vec4 iC = texture2D ( u_mb_tex_accum , a ) ; if ( length ( iB - iC ) > BLUR_DECAY_THRESHOLD ) { gl_FragColor = ( 1.0 - u_motion_blur_exp ) * iB + u_motion_blur_exp * iC ; } else { gl_FragColor = iB ; } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",b:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",b:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",b:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",b:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",b:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",b:["6"]},{type:"textline",b:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 a ; void main ( ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["POST_EFFECT","==","POST_EFFECT_NONE"],group:{type:"group",a:[{type:"textline",b:"gl_FragColor = texture2D ( u_color , a ) ;".split(" ")}]}},{type:"elif",c:["POST_EFFECT","==","POST_EFFECT_GRAYSCALE"],group:{type:"group",a:[{type:"textline",b:"vec4 iB = texture2D ( u_color , a ) ; gl_FragColor . rgb = vec3 ( ( iB . r + iB . g + iB . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_BLUR || POST_EFFECT == POST_EFFECT_Y_BLUR".split(" "),
group:{type:"group",a:[{type:"textline",b:"vec2 iC = vec2 ( 0.0 , 0.0 ) ; vec2 iD = u_texel_size ; vec4 iE ; iE = texture2D ( u_color , a ) ; gl_FragColor = iE * 0.2270270270 ; iC += iD ; iE = texture2D ( u_color , a + iC ) ; gl_FragColor += iE * 0.1945945946 ; iE = texture2D ( u_color , a - iC ) ; gl_FragColor += iE * 0.1945945946 ; iC += iD ; iE = texture2D ( u_color , a + iC ) ; gl_FragColor += iE * 0.1216216216 ; iE = texture2D ( u_color , a - iC ) ; gl_FragColor += iE * 0.1216216216 ; iC += iD ; iE = texture2D ( u_color , a + iC ) ; gl_FragColor += iE * 0.0540540541 ; iE = texture2D ( u_color , a - iC ) ; gl_FragColor += iE * 0.0540540541 ; iC += iD ; iE = texture2D ( u_color , a + iC ) ; gl_FragColor += iE * 0.0162162162 ; iE = texture2D ( u_color , a - iC ) ; gl_FragColor += iE * 0.0162162162 ;".split(" ")}]}},
{type:"elif",c:"POST_EFFECT == POST_EFFECT_X_EXTEND || POST_EFFECT == POST_EFFECT_Y_EXTEND".split(" "),group:{type:"group",a:[{type:"textline",b:"vec2 iD = u_texel_size ; vec4 iE = texture2D ( u_color , a ) ; gl_FragColor = iE ; if ( iE . a == 0.0 ) { iE = texture2D ( u_color , a + iD ) ; if ( iE . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , iE . a ) ; else { iE = texture2D ( u_color , a - iD ) ; if ( iE . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , iE . a ) ; } }".split(" ")}]}}]},{type:"textline",
b:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",a:[{type:"textline",b:"attribute vec2 a_bb_vertex ; varying vec2 a ; void main ( ) { a = a_bb_vertex + 0.5 ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},
{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:["uniform","sampler2D","u_color",";"]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_blend",";"]},{type:"condition",
a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_velocity_tex",";"]}]}}]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION","&&","SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ;".split(" ")}]}}]},
{type:"textline",b:"uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kg",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 kg [ 3 ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","kh",";"]}]}}]},{type:"condition",
a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",b:["1"]}]}},
{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",b:["0"]},{type:"define",
name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_THRESHOLD",b:["0.1"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",b:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",
a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",b:["8"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",a:[{type:"define",name:"SMAA_CORNER_ROUNDING",b:["25"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",a:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION",
b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",b:["0.01"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_SCALE",b:["2.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",a:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",b:["0.4"]}]}}]},{type:"condition",a:[{type:"ifndef",
name:"SMAA_REPROJECTION",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION",b:["0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",a:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",b:["30.0"]}]}}]},{type:"condition",a:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",b:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",
b:["20"]},{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",b:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",b:["(","1.0","/","7.0",")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",b:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",b:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",b:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"textline",b:"vec3 ko ( vec2 ki , vec4 kj [ 3 ] , sampler2D kk ) { float kl = texture2D ( kk , ki ) . r ; float km = texture2D ( kk , kj [ 0 ] . xy ) . r ; float kn = texture2D ( kk , kj [ 0 ] . zw ) . r ; return vec3 ( kl , km , kn ) ; } vec2 kv ( vec2 kp , vec4 kq [ 3 ] , sampler2D kr ) { vec3 ks = ko ( kp , kq , kr ) ; vec2 kt = abs ( ks . xx - ks . yz ) ; vec2 ku = step ( SMAA_PREDICATION_THRESHOLD , kt ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * ku ) ; } void kz ( bvec2 kw , inout vec2 kx , vec2 ky ) { if ( kw . x ) kx . x = ky . x ; if ( kw . y ) kx . y = ky . y ; } void kz ( bvec4 kA , inout vec4 kB , vec4 kC ) { kz ( kA . xy , kB . xy , kC . xy ) ; kz ( kA . zw , kB . zw , kC . zw ) ; } vec2 kE ( vec2 kD ) { return sign ( kD ) * floor ( abs ( kD ) + .5 ) ; } vec4 kE ( vec4 kF ) { return sign ( kF ) * floor ( abs ( kF ) + .5 ) ; } vec2 kX ( vec2 kG , vec4 kH [ 3 ] , sampler2D kI".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","kJ"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 kK = kv ( kG , kH , kJ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec2 kK = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"vec3 kL = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float kM = dot ( texture2D ( kI , kG ) . rgb , kL ) ; float kN = dot ( texture2D ( kI , kH [ 0 ] . xy ) . rgb , kL ) ; float kO = dot ( texture2D ( kI , kH [ 0 ] . zw ) . rgb , kL ) ; vec4 kP ; kP . xy = abs ( kM - vec2 ( kN , kO ) ) ; vec2 kQ = step ( kK , kP . xy ) ; if ( dot ( kQ , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float kR = dot ( texture2D ( kI , kH [ 1 ] . xy ) . rgb , kL ) ; float kS = dot ( texture2D ( kI , kH [ 1 ] . zw ) . rgb , kL ) ; kP . zw = abs ( kM - vec2 ( kR , kS ) ) ; vec2 kT = max ( kP . xy , kP . zw ) ; float kU = dot ( texture2D ( kI , kH [ 2 ] . xy ) . rgb , kL ) ; float kV = dot ( texture2D ( kI , kH [ 2 ] . zw ) . rgb , kL ) ; kP . zw = abs ( vec2 ( kN , kO ) - vec2 ( kU , kV ) ) ; kT = max ( kT . xy , kP . zw ) ; float kW = max ( kT . x , kT . y ) ; kQ . xy *= step ( kW , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * kP . xy ) ; return kQ ; } vec2 lo ( vec2 kY , vec4 kZ [ 3 ] , sampler2D k_".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","la"]}]}}]},{type:"textline",b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:"vec2 lb = kv ( kY , kZ , la ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec2 lb = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",b:"vec4 lc ; vec3 ld = texture2D ( k_ , kY ) . rgb ; vec3 le = texture2D ( k_ , kZ [ 0 ] . xy ) . rgb ; vec3 lf = abs ( ld - le ) ; lc . x = max ( max ( lf . r , lf . g ) , lf . b ) ; vec3 lg = texture2D ( k_ , kZ [ 0 ] . zw ) . rgb ; lf = abs ( ld - lg ) ; lc . y = max ( max ( lf . r , lf . g ) , lf . b ) ; vec2 lh = step ( lb , lc . xy ) ; if ( dot ( lh , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; vec3 li = texture2D ( k_ , kZ [ 1 ] . xy ) . rgb ; lf = abs ( ld - li ) ; lc . z = max ( max ( lf . r , lf . g ) , lf . b ) ; vec3 lj = texture2D ( k_ , kZ [ 1 ] . zw ) . rgb ; lf = abs ( ld - lj ) ; lc . w = max ( max ( lf . r , lf . g ) , lf . b ) ; vec2 lk = max ( lc . xy , lc . zw ) ; vec3 ll = texture2D ( k_ , kZ [ 2 ] . xy ) . rgb ; lf = abs ( ld - ll ) ; lc . z = max ( max ( lf . r , lf . g ) , lf . b ) ; vec3 lm = texture2D ( k_ , kZ [ 2 ] . zw ) . rgb ; lf = abs ( ld - lm ) ; lc . w = max ( max ( lf . r , lf . g ) , lf . b ) ; lk = max ( lk . xy , lc . zw ) ; float ln = max ( lk . x , lk . y ) ; lh . xy *= step ( ln , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * lc . xy ) ; return lh ; } vec2 lv ( vec2 lp , vec4 lq [ 3 ] , sampler2D lr ) { vec3 ls = ko ( lp , lq , lr ) ; vec2 lt = abs ( ls . xx - vec2 ( ls . y , ls . z ) ) ; vec2 lu = step ( SMAA_DEPTH_THRESHOLD , lt ) ; if ( dot ( lu , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; return lu ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 lx ( vec2 lw ) { lw . r = lw . r * abs ( 5.0 * lw . r - 5.0 * 0.75 ) ; return kE ( lw ) ; } vec4 lx ( vec4 ly ) { ly . rb = ly . rb * abs ( 5.0 * ly . rb - 5.0 * 0.75 ) ; return kE ( ly ) ; } vec2 lG ( sampler2D lz , vec2 lA , vec2 lB , out vec2 lC ) { vec4 lD = vec4 ( lA , - 1.0 , 1.0 ) ; vec3 lE = vec3 ( u_texel_size , 1.0 ) ; for ( int lF = 0 ; lF < SMAA_MAX_SEARCH_STEPS_DIAG ; lF ++ ) { if ( lD . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && lD . w > 0.9 ) { lD . xyz += lE * vec3 ( lB , 1.0 ) ; lC = texture2D ( lz , lD . xy , 0.0 ) . rg ; lD . w = dot ( lC , vec2 ( 0.5 , 0.5 ) ) ; } } return lD . zw ; } vec2 lO ( sampler2D lH , vec2 lI , vec2 lJ , out vec2 lK ) { vec4 lL = vec4 ( lI , - 1.0 , 1.0 ) ; lL . x += 0.25 * u_texel_size . x ; vec3 lM = vec3 ( u_texel_size , 1.0 ) ; for ( int lN = 0 ; lN < SMAA_MAX_SEARCH_STEPS_DIAG ; lN ++ ) { if ( lL . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && lL . w > 0.9 ) { lL . xyz = lM * vec3 ( lJ , 1.0 ) + lL . xyz ; lK = texture2D ( lH , lL . xy , 0.0 ) . rg ; lK = lx ( lK ) ; lL . w = dot ( lK , vec2 ( 0.5 , 0.5 ) ) ; } } return lL . zw ; } vec2 lU ( sampler2D lP , vec2 lQ , vec2 lR , float lS ) { vec2 lT = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * lR + lQ ; lT = SMAA_AREATEX_PIXEL_SIZE * lT + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; lT . x += 0.5 ; lT . y += SMAA_AREATEX_SUBTEX_SIZE * lS ; return texture2D ( lP , lT , 0.0 ) . rg ; } vec2 mi ( sampler2D lV , sampler2D lW , vec2 lX , vec2 lY , vec4 lZ ) { vec2 l_ = vec2 ( 0.0 , 0.0 ) ; vec4 ma ; vec2 mb ; if ( lY . r > 0.0 ) { ma . xz = lG ( lV , lX , vec2 ( - 1.0 , 1.0 ) , mb ) ; ma . x += float ( mb . y > 0.9 ) ; } else ma . xz = vec2 ( 0.0 , 0.0 ) ; ma . yw = lG ( lV , lX , vec2 ( 1.0 , - 1.0 ) , mb ) ; if ( ma . x + ma . y > 2.0 ) { vec4 mc = vec4 ( - ma . x + 0.25 , ma . x , ma . y , - ma . y - 0.25 ) * u_texel_size . xyxy + lX . xyxy ; vec4 md ; md . xy = texture2D ( lV , mc . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; md . zw = texture2D ( lV , mc . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; md . yxwz = lx ( md . xyzw ) ; vec2 me = vec2 ( 2.0 , 2.0 ) * md . xz + md . yw ; kz ( bvec2 ( step ( 0.9 , ma . zw ) ) , me , vec2 ( 0.0 , 0.0 ) ) ; l_ += lU ( lW , ma . xy , me , lZ . z ) ; } ma . xz = lO ( lV , lX , vec2 ( - 1 , - 1 ) , mb ) ; if ( texture2D ( lV , lX + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { ma . yw = lO ( lV , lX , vec2 ( 1 , 1 ) , mb ) ; ma . y += float ( mb . y > 0.9 ) ; } else ma . yw = vec2 ( 0.0 , 0.0 ) ; if ( ma . x + ma . y > 2.0 ) { vec4 mf = vec4 ( - ma . x , - ma . x , ma . y , ma . y ) * u_texel_size . xyxy + lX . xyxy ; vec4 mg ; mg . x = texture2D ( lV , mf . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; mg . y = texture2D ( lV , mf . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; mg . zw = texture2D ( lV , mf . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 mh = vec2 ( 2.0 , 2.0 ) * mg . xz + mg . yw ; kz ( bvec2 ( step ( 0.9 , ma . zw ) ) , mh , vec2 ( 0 , 0 ) ) ; l_ += lU ( lW , ma . xy , mh , lZ . w ) . gr ; } return l_ ; }".split(" ")}]}}]},
{type:"textline",b:"float mo ( sampler2D mj , vec2 mk , float ml ) { vec2 mm = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 mn = SMAA_SEARCHTEX_SIZE * vec2 ( ml , 1.0 ) ; mm += vec2 ( - 1.0 , 1.0 ) ; mn += vec2 ( 0.5 , - 0.5 ) ; mm *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; mn *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( mj , mm * mk + mn , 0.0 ) . r ; } float mw ( sampler2D mp , sampler2D mq , vec2 mr , float ms ) { vec2 mt = vec2 ( 0.0 , 1.0 ) ; for ( int mu = 0 ; mu < SMAA_MAX_SEARCH_STEPS ; mu ++ ) { if ( mr . x > ms && mt . g > 0.8281 && mt . r == 0.0 ) { mt = texture2D ( mp , mr , 0.0 ) . rg ; mr = - vec2 ( 2.0 , 0.0 ) * u_texel_size + mr ; } } float mv = - ( 255.0 / 127.0 ) * mo ( mq , mt , 0.0 ) + 3.25 ; return u_texel_size . x * mv + mr . x ; } float mE ( sampler2D mx , sampler2D my , vec2 mz , float mA ) { vec2 mB = vec2 ( 0.0 , 1.0 ) ; for ( int mC = 0 ; mC < SMAA_MAX_SEARCH_STEPS ; mC ++ ) { if ( mz . x < mA && mB . g > 0.8281 && mB . r == 0.0 ) { mB = texture2D ( mx , mz , 0.0 ) . rg ; mz = vec2 ( 2.0 , 0.0 ) * u_texel_size + mz ; } } float mD = - ( 255.0 / 127.0 ) * mo ( my , mB , 0.5 ) + 3.25 ; return - u_texel_size . x * mD + mz . x ; } float mM ( sampler2D mF , sampler2D mG , vec2 mH , float mI ) { vec2 mJ = vec2 ( 1.0 , 0.0 ) ; for ( int mK = 0 ; mK < SMAA_MAX_SEARCH_STEPS ; mK ++ ) { if ( mH . y > mI && mJ . r > 0.8281 && mJ . g == 0.0 ) { mJ = texture2D ( mF , mH , 0.0 ) . rg ; mH = - vec2 ( 0.0 , 2.0 ) * u_texel_size + mH ; } } float mL = - ( 255.0 / 127.0 ) * mo ( mG , mJ . gr , 0.0 ) + 3.25 ; return u_texel_size . y * mL + mH . y ; } float mU ( sampler2D mN , sampler2D mO , vec2 mP , float mQ ) { vec2 mR = vec2 ( 1.0 , 0.0 ) ; for ( int mS = 0 ; mS < SMAA_MAX_SEARCH_STEPS ; mS ++ ) { if ( mP . y < mQ && mR . r > 0.8281 && mR . g == 0.0 ) { mR = texture2D ( mN , mP , 0.0 ) . rg ; mP = vec2 ( 0.0 , 2.0 ) * u_texel_size + mP ; } } float mT = - ( 255.0 / 127.0 ) * mo ( mO , mR . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * mT + mP . y ; } vec2 na ( sampler2D mV , vec2 mW , float mX , float mY , float mZ ) { vec2 m_ = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * kE ( 4.0 * vec2 ( mX , mY ) ) + mW ; m_ = SMAA_AREATEX_PIXEL_SIZE * m_ + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; m_ . y = SMAA_AREATEX_SUBTEX_SIZE * mZ + m_ . y ; return texture2D ( mV , m_ , 0.0 ) . rg ; } void ni ( sampler2D nb , inout vec2 nc , vec4 nd , vec2 ne ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nf = step ( ne . xy , ne . yx ) ; vec2 ng = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * nf ; ng /= nf . x + nf . y ; vec2 nh = vec2 ( 1.0 , 1.0 ) ; nh . x -= ng . x * texture2D ( nb , nd . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; nh . x -= ng . y * texture2D ( nb , nd . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; nh . y -= ng . x * texture2D ( nb , nd . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; nh . y -= ng . y * texture2D ( nb , nd . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; nc *= clamp ( nh , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void nq ( sampler2D nj , inout vec2 nk , vec4 nl , vec2 nm ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_CORNER_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nn = step ( nm . xy , nm . yx ) ; vec2 no = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * nn ; no /= nn . x + nn . y ; vec2 np = vec2 ( 1.0 , 1.0 ) ; np . x -= no . x * texture2D ( nj , nl . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; np . x -= no . y * texture2D ( nj , nl . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; np . y -= no . x * texture2D ( nj , nl . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; np . y -= no . y * texture2D ( nj , nl . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; nk *= clamp ( np , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec4 nK ( vec2 nr , vec2 ns , vec4 nt [ 3 ] , sampler2D nu , sampler2D nv , sampler2D nw , vec4 nx ) { vec4 ny = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 nz = texture2D ( nu , nr ) . rg ; if ( nz . g > 0.0 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"ny . rg = mi ( nu , nv , nr , nz , nx ) ; if ( ny . r == - ny . g ) {".split(" ")}]}}]},{type:"textline",b:"vec2 nA ; vec3 nB ; nB . x = mw ( nu , nw , nt [ 0 ] . xy , nt [ 2 ] . x ) ; nB . y = nt [ 1 ] . y ; nA . x = nB . x ; float nC = texture2D ( nu , nB . xy , 0.0 ) . r ; nB . z = mE ( nu , nw , nt [ 0 ] . zw , nt [ 2 ] . y ) ; nA . y = nB . z ; nA = abs ( kE ( nA / u_texel_size . xx - ns . xx ) ) ; vec2 nD = sqrt ( nA ) ; float nE = texture2D ( nu , nB . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; ny . rg = na ( nv , nD , nC , nE , nx . y ) ; nB . y = nr . y ; ni ( nu , ny . rg , nB . xyzy , nA ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["!","SMAA_DISABLE_DIAG_DETECTION"],group:{type:"group",a:[{type:"textline",b:"} else nz . r = 0.0 ;".split(" ")}]}}]},{type:"textline",b:"} if ( nz . r > 0.0 ) { vec2 nF ; vec3 nG ; nG . y = mM ( nu , nw , nt [ 1 ] . xy , nt [ 2 ] . z ) ; nG . x = nt [ 0 ] . x ; nF . x = nG . y ; float nH = texture2D ( nu , nG . xy , 0.0 ) . g ; nG . z = mU ( nu , nw , nt [ 1 ] . zw , nt [ 2 ] . w ) ; nF . y = nG . z ; nF = abs ( kE ( nF / u_texel_size . yy - ns . yy ) ) ; vec2 nI = sqrt ( nF ) ; float nJ = texture2D ( nu , nG . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; ny . ba = na ( nv , nI , nH , nJ , nx . x ) ; nG . x = nr . x ; nq ( nu , ny . ba , nG . xyxz , nF ) ; } return ny ; } vec4 nZ ( vec2 nL , vec4 nM , sampler2D nN , sampler2D nO".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","nP"]}]}}]},{type:"textline",b:") { vec4 nQ ; nQ . x = texture2D ( nO , nM . xy ) . a ; nQ . y = texture2D ( nO , nM . zw ) . g ; nQ . wz = texture2D ( nO , nL ) . xz ; if ( dot ( nQ , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 nR = texture2D ( nN , nL , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nS = texture2D ( nP , nL , 0.0 ) . rg ; nR . a = sqrt ( 5.0 * length ( nS ) ) ;".split(" ")}]}}]},
{type:"textline",b:"return nR ; } else { bool nT = max ( nQ . x , nQ . z ) > max ( nQ . y , nQ . w ) ; vec4 nU = vec4 ( 0.0 , nQ . y , 0.0 , nQ . w ) ; vec2 nV = nQ . yw ; kz ( bvec4 ( nT , nT , nT , nT ) , nU , vec4 ( nQ . x , 0.0 , nQ . z , 0.0 ) ) ; kz ( bvec2 ( nT , nT ) , nV , nQ . xz ) ; nV /= dot ( nV , vec2 ( 1.0 , 1.0 ) ) ; vec4 nW = nU * vec4 ( u_texel_size , - u_texel_size ) + nL . xyxy ; vec4 nX = nV . x * texture2D ( nN , nW . xy , 0.0 ) ; nX += nV . y * texture2D ( nN , nW . zw , 0.0 ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 nY = nV . x * texture2D ( nP , nW . xy , 0.0 ) . rg ; nY += nV . y * texture2D ( nP , nW . zw , 0.0 ) . rg ; nX . a = sqrt ( 5.0 * length ( nY ) ) ;".split(" ")}]}}]},{type:"textline",b:"return nX ; } } vec4 oi ( vec2 n_ , sampler2D oa , sampler2D ob".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","sampler2D","oc"]}]}}]},{type:"textline",
b:[")","{"]},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:"vec2 od = - texture2D ( oc , n_ ) . rg ; vec4 oe = texture2D ( oa , n_ ) ; vec4 of = texture2D ( ob , n_ + od ) ; float og = abs ( oe . a * oe . a - of . a * of . a ) / 5.0 ; float oh = 0.5 * clamp ( 1.0 - sqrt ( og ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; return mix ( oe , of , oh ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 oe = texture2D ( oa , n_ ) ; vec4 of = texture2D ( ob , n_ ) ; return mix ( oe , of , 0.5 ) ;".split(" ")}]}}]},
{type:"textline",b:"} void main ( ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"vec4 oj = vec4 ( kX ( a , kg , u_color".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_PREDICATION"],group:{type:"group",a:[{type:"textline",b:[",","u_predication_tex"]}]}}]},{type:"textline",b:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",
b:"vec4 ok = vec4 ( 0.0 ) ; vec4 oj = nK ( a , kh , kg , u_color , u_area_tex , u_search_tex , ok ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec4 oj = nZ ( a , kg , u_color , u_blend".split(" ")},{type:"condition",a:[{type:"if",c:["SMAA_REPROJECTION"],group:{type:"group",a:[{type:"textline",b:[",","u_velocity_tex"]}]}}]},{type:"textline",b:[")",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec4 oj = texture2D ( u_color , a ) ;".split(" ")}]}}]},
{type:"textline",b:["gl_FragColor","=","oj",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",a:[{type:"define",name:"SMAA_EDGE_DETECTION",b:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",b:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",b:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",b:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",b:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",b:["4"]},{type:"textline",b:"attribute vec2 a_bb_vertex ; uniform vec2 u_texel_size ; varying vec2 a ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:["varying","vec4","kg",";"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"varying vec4 kg [ 3 ] ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:["varying","vec2","kh",";"]}]}}]},{type:"condition",a:[{type:"if",c:["AA_METHOD","==","AA_METHOD_SMAA_LOW"],group:{type:"group",
a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["4"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_MEDIUM"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["8"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_HIGH"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}},{type:"elif",c:["AA_METHOD","==","AA_METHOD_SMAA_ULTRA"],group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["32"]}]}}]},{type:"condition",a:[{type:"ifndef",
name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",a:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",b:["16"]}]}}]},{type:"textline",b:"void iD ( vec2 iB , out vec4 iC [ 3 ] ) { iC [ 0 ] = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + iB . xyxy ; iC [ 1 ] = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + iB . xyxy ; iC [ 2 ] = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + iB . xyxy ; } void iH ( vec2 iE , out vec2 iF , out vec4 iG [ 3 ] ) { iF = iE / u_texel_size ; iG [ 0 ] = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + iE . xyxy ; iG [ 1 ] = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + iE . xyxy ; iG [ 2 ] = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( iG [ 0 ] . xz , iG [ 1 ] . yw ) ; } void iK ( vec2 iI , out vec4 iJ ) { iJ = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + iI . xyxy ; } void main ( ) { a = a_bb_vertex + 0.5 ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SMAA_PASS","==","SMAA_EDGE_DETECTION"],group:{type:"group",a:[{type:"textline",b:"iD ( a , kg ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_BLENDING_WEIGHT_CALCULATION"],group:{type:"group",a:[{type:"textline",b:"iH ( a , kh , kg ) ;".split(" ")}]}},{type:"elif",c:["SMAA_PASS","==","SMAA_NEIGHBORHOOD_BLENDING"],group:{type:"group",a:[{type:"textline",b:"iK ( a , kg ) ;".split(" ")}]}}]},{type:"textline",b:"gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/ssao.glslf"]={type:"group",a:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"define",name:"SSAO_QUALITY_16",b:["1"]},{type:"define",name:"SSAO_QUALITY_32",b:["2"]},{type:"textline",b:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform vec2 u_texel_size ; uniform float u_view_max_depth ; uniform vec2 u_camera_range ; varying vec2 a ; uniform float u_ssao_radius_increase ; uniform float u_ssao_dithering_amount ; uniform float u_ssao_gauss_center ; uniform float u_ssao_gauss_width_square ; uniform float u_ssao_gauss_width_left_square ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; vec2 kn ( vec2 ki ) { float kj = dot ( ki , vec2 ( 12.9898 , 78.233 ) ) ; float kk = dot ( ki , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float kl = fract ( sin ( kj ) * 43758.5453 ) * 2.0 - 1.0 ; float km = fract ( sin ( kk ) * 43758.5453 ) * 2.0 - 1.0 ; return vec2 ( kl , km ) ; } float kp ( in vec2 ko ) { return kb ( u_depth , ko , u_camera_range ) ; } float kx ( in float kq , in float kr , inout int ks ) { float kt = u_ssao_gauss_width_square ; float ku = ( kq - kr ) * 100.0 ; if ( ku < u_ssao_gauss_center ) kt = u_ssao_gauss_width_left_square ; else ks = 1 ; float kv = ku - u_ssao_gauss_center ; float kw = exp ( - 2.0 * kv * kv / kt ) ; return kw ; } float kG ( float ky , vec2 kz ) { float kA = 0.0 ; float kB = 0.0 ; float kC = max ( 1.0 , u_view_max_depth / 100.0 ) ; ky *= kC ; kz /= ky ; vec2 kD = a + kz ; vec2 kE = a - kz ; int kF = 0 ; kA = kx ( ky , kC * kp ( kD ) , kF ) ; if ( kF > 0 || kD . y < 0.0 || kD . y > 1.0 || kD . x < 0.0 || kD . x > 1.0 ) { kB = kx ( kC * kp ( kE ) , ky , kF ) ; kA += ( 1.0 - kA ) * kB ; } return kA ; } void main ( ) { vec2 kH = kn ( a ) * u_ssao_dithering_amount ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:["kH","*=","1.5",";"]}]}}]},{type:"textline",b:"float kI = kp ( a ) ; float kJ = 0.0 ; vec2 kK = u_texel_size * 0.5 ; for ( int kL = 0 ; kL < 4 ; kL ++ ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"if ( kL == 0 || kL == 2 ) {".split(" ")}]}}]},{type:"textline",b:"kJ += kG ( kI , kK ) ; kJ += kG ( kI , vec2 ( kK . x , - kK . y ) ) ; kJ += kG ( kI , vec2 ( - kK . x , kK . y ) ) ; kJ += kG ( kI , vec2 ( - kK . x , - kK . y ) ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"} else if ( kL == 1 || kL == 3 ) {".split(" ")}]}}]},{type:"textline",b:"kJ += kG ( kI , vec2 ( kK . x * 1.2 , 0.0 ) ) ; kJ += kG ( kI , vec2 ( - kK . x * 1.2 , 0.0 ) ) ; kJ += kG ( kI , vec2 ( 0.0 , kK . y * 1.2 ) ) ; kJ += kG ( kI , vec2 ( 0.0 , - kK . y * 1.2 ) ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",
b:["}"]}]}}]},{type:"textline",b:"kK += kH ; kK *= u_ssao_radius_increase ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SSAO_QUALITY","==","SSAO_QUALITY_16"],group:{type:"group",a:[{type:"textline",b:"kJ = 1.0 - kJ / 16.0 ;".split(" ")}]}},{type:"elif",c:["SSAO_QUALITY","==","SSAO_QUALITY_32"],group:{type:"group",a:[{type:"textline",b:"kJ = 1.0 - kJ / 32.0 ;".split(" ")}]}}]},{type:"textline",b:"float kM = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * kI ) ; kJ = ( 1.0 - kM ) + kJ * kM ;".split(" ")},
{type:"condition",a:[{type:"if",c:["SSAO_WHITE"],group:{type:"group",a:[{type:"textline",b:["kJ","=","1.0",";"]}]}}]},{type:"textline",b:"float kN = texture2D ( u_color , a ) . r ; gl_FragColor = vec4 ( kN , kJ , 0.0 , 1.0 ) ; }".split(" ")}]};a["include/precision_statement.glslf"]={type:"group",a:[{type:"var",name:"PRECISION",b:["lowp"]},{type:"textline",b:["precision","PRECISION","float",";"]}]};a["include/math.glslv"]={type:"group",a:[{type:"textline",b:"float b = .000001 ; struct c { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool f ( float d , float e ) { return abs ( d - e ) < b ; } vec3 i ( in vec4 g , in vec3 h ) { return h + 2.0 * cross ( g . xyz , cross ( g . xyz , h ) + g . w * h ) ; } mat3 l ( mat3 j ) { mat3 k = j ; k [ 0 ] [ 1 ] = j [ 1 ] [ 0 ] ; k [ 0 ] [ 2 ] = j [ 2 ] [ 0 ] ; k [ 1 ] [ 0 ] = j [ 0 ] [ 1 ] ; k [ 1 ] [ 2 ] = j [ 2 ] [ 1 ] ; k [ 2 ] [ 0 ] = j [ 0 ] [ 2 ] ; k [ 2 ] [ 1 ] = j [ 1 ] [ 2 ] ; return k ; } mat4 m ( ) { return mat4 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 ) ; } mat4 o ( float n ) { return mat4 ( 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , cos ( n ) , - sin ( n ) , 0.0 , 0.0 , sin ( n ) , cos ( n ) , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 ) ; } mat4 q ( float p ) { return mat4 ( cos ( p ) , 0.0 , sin ( p ) , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , - sin ( p ) , 0.0 , cos ( p ) , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 ) ; } mat4 s ( float r ) { return mat4 ( cos ( r ) , - sin ( r ) , 0.0 , 0.0 , sin ( r ) , cos ( r ) , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 ) ; } c u ( in c t ) { return c ( t . a , t . b , normalize ( t . c ) , normalize ( t . d ) , normalize ( t . e ) , t . f ) ; }".split(" ")}]};
a["include/to_world.glslv"]={type:"group",a:[{type:"define",name:"SKIN_SLERP",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"define",name:"BILLBOARD_THRESHOLD",b:["M_PI","/","3.0"]},{type:"textline",b:"const vec3 v = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_SPHERICAL"],group:{type:"group",a:[{type:"textline",b:"mat4 B ( vec3 w , mat4 x ) { vec3 y = vec3 ( x [ 0 ] [ 0 ] , x [ 1 ] [ 0 ] , x [ 2 ] [ 0 ] ) ; vec3 z = vec3 ( x [ 0 ] [ 1 ] , x [ 1 ] [ 1 ] , x [ 2 ] [ 1 ] ) ; vec3 A = vec3 ( x [ 0 ] [ 2 ] , x [ 1 ] [ 2 ] , x [ 2 ] [ 2 ] ) ; z = cross ( A , y ) ; return mat4 ( vec4 ( y , 0.0 ) , vec4 ( z , 0.0 ) , vec4 ( A , 0.0 ) , vec4 ( w , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 H ( vec3 C , vec3 D ) { vec3 E = C - D ; E . y = 0.0 ; E = normalize ( E ) ; vec3 F = normalize ( cross ( v , E ) ) ; vec3 G = normalize ( cross ( E , F ) ) ; return mat4 ( vec4 ( F , 0.0 ) , vec4 ( G , 0.0 ) , vec4 ( E , 0.0 ) , vec4 ( D , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_JITTERED"],group:{type:"group",a:[{type:"textline",b:"mat4 S ( in vec3 I , float J , float L , float M , vec3 N ) { float O = fract ( length ( N ) / 0.17 ) ; float P = M + O / 10.0 ; float Q = O / M ; I *= 1.0 + 0.5 * sin ( J ) ; float R = length ( I ) * L * sin ( 2.0 * 3.14 * J * P + Q ) ; return s ( R ) ; }".split(" ")}]}}]},
{type:"textline",b:"mat4 ae ( in vec3 T , in vec3 U , in mat4 V ) {".split(" ")},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_SPHERICAL"],group:{type:"group",a:[{type:"textline",b:"mat4 W = B ( U , V ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"mat4 W = H ( T , U ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD_RANDOM"],group:{type:"group",a:[{type:"textline",b:"vec3 X = T - U ; X [ 1 ] = 0.0 ; float Y = fract ( dot ( U , U ) / 127.0 ) ; float Z = 2.0 * M_PI * Y ; X = ( q ( Z ) * vec4 ( X , 0.0 ) ) . xyz ; X = normalize ( X ) ; float _ = X [ 2 ] ; float aa = X [ 0 ] ; if ( abs ( _ ) > cos ( BILLBOARD_THRESHOLD ) ) { if ( _ < 0.0 ) W = W * q ( M_PI ) ; } else { float ab = acos ( _ ) ; if ( aa < 0.0 ) ab = 2.0 * M_PI - ab ; float ac = BILLBOARD_THRESHOLD / ( M_PI / 2.0 - BILLBOARD_THRESHOLD ) ; float ad = ( ac + 1.0 ) * ( ab - sign ( aa ) * BILLBOARD_THRESHOLD ) ; W = W * q ( ad ) ; }".split(" ")}]}}]},
{type:"textline",b:"return W ; } c al ( in vec3 af , in vec3 ag , in vec3 ah , in vec3 ai , in vec3 aj , in mat4 ak ) { af = ( ak * vec4 ( af , 1.0 ) ) . xyz ; ag = ( ak * vec4 ( ag , 1.0 ) ) . xyz ; ah = ( ak * vec4 ( ah , 0.0 ) ) . xyz ; ai = ( ak * vec4 ( ai , 0.0 ) ) . xyz ; aj = ( ak * vec4 ( aj , 0.0 ) ) . xyz ; return u ( c ( af , ag , ah , ai , aj , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]={type:"group",a:[{type:"textline",b:"vec2 ao ( vec2 am , vec3 an ) { return ( am + 0.5 ) * an . xy - 0.5 ; }".split(" ")}]};
a["include/skin.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["SKINNED"],group:{type:"group",a:[{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 ax ( in vec4 ap , in vec4 aq , in float ar ) { float as = ap [ 0 ] * aq [ 0 ] + ap [ 1 ] * aq [ 1 ] + ap [ 2 ] * aq [ 2 ] + ap [ 3 ] * aq [ 3 ] ; if ( as < 0.0 ) { aq *= - 1.0 ; as = - as ; } if ( abs ( as ) >= 1.0 ) return ap ; float at = acos ( as ) ; float au = sqrt ( 1.0 - as * as ) ; if ( abs ( au ) < 0.001 ) return vec4 ( ap * 0.5 + aq * 0.5 ) ; float av = sin ( ( 1.0 - ar ) * at ) / au ; float aw = sin ( ar * at ) / au ; return ap * av + aq * aw ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"vec3 aM ( in vec3 ay , in vec4 az , in vec4 aA , in vec4 aB , in vec4 aC , in float aD ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aE = ax ( az , aA , aD ) ; vec4 aF = mix ( aB , aC , aD ) ; vec3 aG = i ( aE , ay ) ; vec3 aH = aG * aF . w + aF . xyz ; return aH ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aI = i ( az , ay ) ; vec3 aJ = i ( aA , ay ) ; vec3 aK = aI * aB . w + aB . xyz ; vec3 aL = aJ * aC . w + aC . xyz ; return mix ( aK , aL , aD ) ;".split(" ")}]}}]},
{type:"textline",b:"} vec3 aV ( in vec3 aN , in vec4 aO , in vec4 aP , in float aQ ) {".split(" ")},{type:"condition",a:[{type:"if",c:["SKIN_SLERP"],group:{type:"group",a:[{type:"textline",b:"vec4 aR = ax ( aO , aP , aQ ) ; vec3 aS = i ( aR , aN ) ; return aS ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 aT = i ( aO , aN ) ; vec3 aU = i ( aP , aN ) ; return mix ( aT , aU , aQ ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"else",group:{type:"group",a:[{type:"textline",
b:"vec3 aM ( in vec3 aW , in vec4 aX , in vec4 aY ) { vec3 aZ = i ( aX , aW ) ; vec3 a_ = aZ * aY . w + aY . xyz ; return a_ ; } vec3 aV ( in vec3 ba , in vec4 bb ) { vec3 bc = i ( bb , ba ) ; return bc ; }".split(" ")}]}}]},{type:"textline",b:"void bq ( inout vec3 bd , inout vec3 be , inout vec3 bf , inout vec3 bg ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:["float","bh","=","u_frame_factor",";"]}]}}]},{type:"textline",b:"if ( a_influence . y > 0.0 ) { vec3 bi = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bj = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bk = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 bl = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int bm = 0 ; bm < 4 ; bm ++ ) { int bn = int ( a_influence [ bm ] ) ; float bo = fract ( a_influence [ bm ] ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bi += bo * aM ( bd , u_quatsb [ bn ] , u_quatsa [ bn ] , u_transb [ bn ] , u_transa [ bn ] , bh ) ; bj += bo * aV ( be , u_quatsb [ bn ] , u_quatsa [ bn ] , bh ) ; bk += bo * aV ( bf , u_quatsb [ bn ] , u_quatsa [ bn ] , bh ) ; bl += bo * aV ( bg , u_quatsb [ bn ] , u_quatsa [ bn ] , bh ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bi += bo * aM ( bd , u_quatsb [ bn ] , u_transb [ bn ] ) ; bj += bo * aV ( be , u_quatsb [ bn ] ) ; bk += bo * aV ( bf , u_quatsb [ bn ] ) ; bl += bo * aV ( bg , u_quatsb [ bn ] ) ;".split(" ")}]}}]},
{type:"textline",b:"} bd = bi ; be = bj ; bf = bk ; bg = bl ; } else { int bp = int ( a_influence [ 0 ] - 1.0 ) ; if ( bp > - 1 ) {".split(" ")},{type:"condition",a:[{type:"if",c:["FRAMES_BLENDING"],group:{type:"group",a:[{type:"textline",b:"bd = aM ( bd , u_quatsb [ bp ] , u_quatsa [ bp ] , u_transb [ bp ] , u_transa [ bp ] , bh ) ; be = aV ( be , u_quatsb [ bp ] , u_quatsa [ bp ] , bh ) ; bf = aV ( bf , u_quatsb [ bp ] , u_quatsa [ bp ] , bh ) ; bg = aV ( bg , u_quatsb [ bp ] , u_quatsa [ bp ] , bh ) ;".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"bd = aM ( bd , u_quatsb [ bp ] , u_transb [ bp ] ) ; be = aV ( be , u_quatsb [ bp ] ) ; bf = aV ( bf , u_quatsb [ bp ] ) ; bg = aV ( bg , u_quatsb [ bp ] ) ;".split(" ")}]}}]},{type:"textline",b:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["WIND_BEND"],group:{type:"group",a:[{type:"textline",b:"void bE ( inout vec3 br , in vec3 bs , in float bt , in float bu , in float bv , in vec3 bw , in float bx ) { float by = length ( bs ) ; float bz = bu * ( 1.0 + 0.1 * fract ( by ) ) ; float bA = bt * bx * ( 1.0 + sin ( 2.0 * 3.14 * bv * bz + by ) ) ; float bB = ( br . y - bs . y ) * abs ( bA ) ; bB += 1.0 ; bB *= bB ; bB = bB * bB - bB ; vec3 bC = br ; bC . xz += bw . xz * bB * sign ( bA ) ; float bD = length ( br - bs ) ; br = bs + normalize ( bC - bs ) * bD ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"vec4 bG ( vec4 bF ) { return bF * bF * ( 3.0 - 2.0 * bF ) ; } vec4 bI ( vec4 bH ) { return abs ( fract ( bH + 0.5 ) * 2.0 - 1.0 ) ; } vec4 bK ( vec4 bJ ) { return bG ( bI ( bJ ) ) ; } void ca ( inout vec3 bL , in float bM , in vec3 bN , in vec3 bO , in vec3 bP , in float bQ , in float bR , in float bS , in vec3 bT ) { float bU ; float bV ; float bW ; vec2 bX ; vec4 bY ; vec2 bZ ; vec3 b_ ; bU = dot ( bP , vec3 ( 1.0 ) ) ; bV = bU + bT . g ; bW = dot ( bL , vec3 ( bT . g ) ) ; bX = ( bM + vec2 ( bW , bV ) ) ; bY = ( ( fract ( ( bX . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( bO ) * bQ ; bY = bK ( bY ) ; bZ = bY . xz + bY . yw ; bZ . y = 0.5 - bZ . y ; b_ = bZ . xyx * bT . rbr * vec3 ( bR * bN . x , bS , bR * bN . z ) ; bL += b_ ; }".split(" ")}]}}]},
{type:"textline",b:"void ch ( inout vec3 cb , inout vec3 cc , in vec3 cd ) { vec3 ce = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"vec3 cf = cc ; vec3 cg = ( u_model_matrix * vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ) . xyz ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"vec3 cf = cb ; vec3 cg = cc ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["MAIN_BEND_COL"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["DETAIL_BEND"],group:{type:"group",a:[{type:"textline",b:"ca ( cf , u_time , cd , ce , cg , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",b:"bE ( cf , cg , au_wind_bending_amp , au_wind_bending_freq , u_time , ce , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"bE ( cf , cg , au_wind_bending_amp , au_wind_bending_freq , u_time , ce , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["BEND_CENTER_ONLY"],group:{type:"group",a:[{type:"textline",b:"cb += cf - cc ; cc = cf ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"cb = cf ; cc = cg ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/std_enums.glsl"]={type:"group",a:[{type:"define",name:"TEXTURE_COORDS_UV",b:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",b:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",b:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",
b:["2"]},{type:"define",name:"SHADOW_SRC_NONE",b:["1"]},{type:"define",name:"SHADOW_SRC_RGBA",b:["2"]},{type:"define",name:"SHADOW_SRC_RGBA_PCF",b:["3"]},{type:"define",name:"SHADOW_SRC_DEPTH",b:["4"]},{type:"define",name:"SHADOW_SRC_VSM",b:["5"]},{type:"define",name:"SHADOW_SRC_MASK",b:["6"]},{type:"define",name:"SHADOW_DST_NONE",b:["1"]},{type:"define",name:"SHADOW_DST_RGBA",b:["2"]},{type:"define",name:"SHADOW_DST_DEPTH",b:["3"]},{type:"define",name:"SHADOW_DST_VSM",b:["4"]},{type:"define",name:"SHADOW_DST_MASK",
b:["5"]},{type:"define",name:"SPECULAR_PHONG",b:["1"]},{type:"define",name:"SPECULAR_COOKTORR",b:["2"]},{type:"define",name:"SPECULAR_WARDISO",b:["3"]},{type:"define",name:"DIFFUSE_LAMBERT",b:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",b:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",b:["3"]}]};a["include/pack.glslf"]={type:"group",a:[{type:"textline",b:"vec4 cm ( const in float ci ) { const vec4 cj = vec4 ( 255.0 * 255.0 * 255.0 , 255.0 * 255.0 , 255.0 , 1.0 ) ; const vec4 ck = vec4 ( 0.0 , 1.0 / 255.0 , 1.0 / 255.0 , 1.0 / 255.0 ) ; vec4 cl = fract ( ci * cj ) ; cl -= cl . xxyz * ck ; return cl ; } float cq ( const in vec4 cn ) { float co ; const vec4 cp = vec4 ( 1.0 / ( 255.0 * 255.0 * 255.0 ) , 1.0 / ( 255.0 * 255.0 ) , 1.0 / 255.0 , 1.0 ) ; co = dot ( cn , cp ) ; return co ; }".split(" ")}]};
a["include/shadow.glslf"]={type:"group",a:[{type:"var",name:"CSM_SECTION_DIST0",b:["0.0"]},{type:"var",name:"CSM_SECTION_DIST1",b:["0.0"]},{type:"var",name:"CSM_SECTION_DIST2",b:["0.0"]},{type:"var",name:"CSM_SECTION_DIST3",b:["0.0"]},{type:"var",name:"PCF_TEXEL_SIZE",b:["0.0"]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:["vec4","cy",";"]}]}}]},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",
a:[{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_RGBA_PCF"],group:{type:"group",a:[{type:"textline",b:"float cF ( sampler2D cz , vec3 cA , float cB , float cC ) { vec2 cD = cA . xy + vec2 ( cB , cC ) * PCF_TEXEL_SIZE ; vec4 cE = texture2D ( cz , cD ) ; return cq ( cE ) ; }".split(" ")}]}}]},{type:"textline",b:"float cU ( vec3 cG , sampler2D cH , float cI ) { float cJ ; cG . z = clamp ( cG . z , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_RGBA"],
group:{type:"group",a:[{type:"textline",b:"vec4 cK = texture2D ( cH , cG . xy ) ; float cL = cq ( cK ) ; if ( all ( lessThan ( cG . xy , vec2 ( 1.0 ) ) ) && all ( greaterThan ( cG . xy , vec2 ( 0.0 ) ) ) && cL < cG . z ) { float cM = cG . z - cL ; cJ = exp ( - cM * cI ) ; } else cJ = 1.0 ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","==","SHADOW_SRC_RGBA_PCF"],group:{type:"group",a:[{type:"textline",b:"vec4 cL ; cL . r = cF ( cH , cG , 0.5 , 0.5 ) ; cL . g = cF ( cH , cG , 0.5 , - 0.5 ) ; cL . b = cF ( cH , cG , - 0.5 , - 0.5 ) ; cL . a = cF ( cH , cG , - 0.5 , 0.5 ) ; vec4 cN = vec4 ( cG . z , cG . z , cG . z , cG . z ) ; if ( all ( lessThan ( cG . xy , vec2 ( 1.0 ) ) ) && all ( greaterThan ( cG . xy , vec2 ( 0.0 ) ) ) ) cJ = dot ( vec4 ( greaterThanEqual ( cL , cN ) ) , vec4 ( 0.25 , 0.25 , 0.25 , 0.25 ) ) ; else cJ = 1.0 ;".split(" ")}]}},
{type:"elif",c:["SHADOW_SRC","==","SHADOW_SRC_VSM"],group:{type:"group",a:[{type:"textline",b:"vec4 cO = texture2D ( cH , cG . xy ) ; float cP = cO . r ; float cQ = cO . g ; if ( all ( lessThan ( cG . xy , vec2 ( 1.0 ) ) ) && all ( greaterThan ( cG . xy , vec2 ( 0.0 ) ) ) && cP < cG . z ) { float cR = cQ - cP * cP ; float cS = cG . z - cP ; cJ = cR / ( cR + cS * cS ) ; } else cJ = 1.0 ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","==","SHADOW_SRC_DEPTH"],group:{type:"group",a:[{type:"textline",b:"float cL = texture2D ( cH , cG . xy ) . r ; if ( all ( lessThan ( cG . xy , vec2 ( 1.0 ) ) ) && all ( greaterThan ( cG . xy , vec2 ( 0.0 ) ) ) && cL < cG . z ) { cJ = 0.0 ; float cT = cG . z - cL ; cJ = exp ( - cT * cI ) ; } else cJ = 1.0 ;".split(" ")}]}}]},
{type:"textline",b:"return clamp ( cJ , 0.0 , 1.0 ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["SHADOW_SRC","!=","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"float c_ ( float cV , float cW ) { vec3 cX ; float cY = 1.0 ; float cZ = - cV ; if ( cZ < CSM_SECTION_DIST0 ) { cX = cs . xyz / cs . w ; cY = cU ( cX , u_shadow_map0 , cW ) ; }".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"else if ( cZ < CSM_SECTION_DIST1 ) { cX = ct . xyz / ct . w ; cY = cU ( cX , u_shadow_map1 , cW ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"else if ( cZ < CSM_SECTION_DIST2 ) { cX = cu . xyz / cu . w ; cY = cU ( cX , u_shadow_map2 , cW ) ; }".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"else if ( cZ < CSM_SECTION_DIST3 ) { cX = cv . xyz / cv . w ; cY = cU ( cX , u_shadow_map3 , cW ) ; }".split(" ")}]}}]},{type:"textline",b:["return","cY",";","}"]}]}}]}]}}]},{type:"textline",b:"float df ( in float da , inout vec3 db ) {".split(" ")},
{type:"condition",a:[{type:"if",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"vec2 dc = texture2DProj ( u_shadow_mask , cw ) . rg ; vec3 dd = vec3 ( dc . r ) ; float de = dc . g ; cy = vec4 ( dd , de ) ; db *= cy . a ; return cy . r ;".split(" ")}]}},{type:"elif",c:["SHADOW_SRC","!=","SHADOW_SRC_NONE"],group:{type:"group",a:[{type:"textline",b:"return c_ ( cx . z , da ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["return","1.0",";"]}]}}]},
{type:"textline",b:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["DYNAMIC_GRASS"],group:{type:"group",a:[{type:"textline",b:"const float dg = 2.0 ; const float dh = 0.3 ; vec2 dm ( vec3 di , float dj , vec2 dk ) { vec2 dl = vec2 ( ( di . x - dk . x ) / dj , - ( di . z - dk . y ) / dj ) ; return fract ( dl ) ; } vec2 dr ( vec2 dn , float dp , vec2 dq ) { return vec2 ( dn . x * dp , - dn . y * dp ) + dq ; } c ds ( ) { return c ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } c dY ( vec3 dt , vec3 du , vec3 dv , vec3 dw , vec3 dx , sampler2D dy , sampler2D dz , vec3 dA , float dB , vec3 dC , vec4 dD , mat4 dE ) { vec3 dF = i ( dD , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float dG = - dF . x ; float dH = - dF . z ; vec2 dI = vec2 ( dC . x + dB * ( - 1.0 - dG ) / 2.0 , dC . z + dB * ( 1.0 - dH ) / 2.0 ) ; vec2 dJ = dm ( dx , dB , dI ) ; float dK = dB / dA . z ; vec2 dL = ( dJ - vec2 ( 0.5 ) ) * dK + vec2 ( 0.5 ) ; vec3 dM = dF * ( dB / dA . z - 1.0 ) / 2.0 ; dL . x += dM . x ; dL . y -= dM . z ; float dN = dB / 2.0 - dg ; vec2 dO = abs ( dr ( dJ - vec2 ( 0.5 ) , dB , vec2 ( 0.0 ) ) ) ; if ( ( dO . x > dN ) || ( dO . y > dN ) ) return ds ( ) ; float dP = dN * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( dO ) > dP ) return ds ( ) ; vec4 dQ = texture2D ( dz , dL ) ; float dR = dQ . r ; if ( dR < dh ) return ds ( ) ; dt . y *= dR ; vec3 dS = dQ . gba ; vec2 dT = dm ( dt , dB , dI ) ; dt . xz = dr ( dT , dB , dI ) ; float dU = dA . y - dA . x ; float dV = dA . y - texture2D ( dy , dL ) . r * dU ; dt . y += dV ; dx . xz = dr ( dJ , dB , dI ) ; dx . y = dV ;".split(" ")},
{type:"condition",a:[{type:"if",c:["HAIR_BILLBOARD"],group:{type:"group",a:[{type:"textline",b:"dt -= dx ; mat4 dW = ae ( dC , dx , dE ) ; c dX = al ( dt , dx , du , dv , dw , dW ) ; dX . b = dx ; dX . f = dS ; return u ( dX ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"return u ( c ( dt , dx , du , dv , dw , dS ) ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",a:[{type:"condition",a:[{type:"if",c:"SHADOW_SRC != SHADOW_SRC_MASK && SHADOW_SRC != SHADOW_SRC_NONE".split(" "),
group:{type:"group",a:[{type:"textline",b:"void d_ ( vec3 dZ ) { cs = u_b_light_matrix * u_p_light_matrix0 * u_v_light_matrix * vec4 ( dZ , 1.0 ) ;".split(" ")},{type:"condition",a:[{type:"if",c:["CSM_SECTION1"],group:{type:"group",a:[{type:"textline",b:"ct = u_b_light_matrix * u_p_light_matrix1 * u_v_light_matrix * vec4 ( dZ , 1.0 ) ;".split(" ")}]}}]},{type:"condition",a:[{type:"if",c:["CSM_SECTION2"],group:{type:"group",a:[{type:"textline",b:"cu = u_b_light_matrix * u_p_light_matrix2 * u_v_light_matrix * vec4 ( dZ , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["CSM_SECTION3"],group:{type:"group",a:[{type:"textline",b:"cv = u_b_light_matrix * u_p_light_matrix3 * u_v_light_matrix * vec4 ( dZ , 1.0 ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}},{type:"elif",c:["SHADOW_SRC","==","SHADOW_SRC_MASK"],group:{type:"group",a:[{type:"textline",b:"void d_ ( vec4 ea ) { float eb = ea . x ; float ec = ea . y ; float ed = ea . w ; cw . x = ( eb + ed ) / 2.0 ; cw . y = ( ec + ed ) / 2.0 ; cw . z = ed ; }".split(" ")}]}}]}]};a["include/gamma.glslf"]=
{type:"group",a:[{type:"define",name:"GAMMA",b:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",b:["1"]},{type:"textline",b:"void eg ( inout vec3 ef ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"ef = pow ( ef , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",b:"} void ei ( inout vec3 eh ) {".split(" ")},{type:"condition",a:[{type:"if",c:["GAMMA"],group:{type:"group",a:[{type:"textline",b:"eh = pow ( eh , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},
{type:"textline",b:"} void el ( inout vec3 ej , in float ek ) {".split(" ")},{type:"condition",a:[{type:"if",c:["PREMULTIPLY_ALPHA"],group:{type:"group",a:[{type:"textline",b:"ej = ej * ek ;".split(" ")}]}}]},{type:"textline",b:["}"]}]};a["include/fog.glslf"]={type:"group",a:[{type:"var",name:"WAVES_HEIGHT",b:["0.0"]},{type:"textline",b:"float et ( inout vec3 eo , in float ep , in vec4 eq ) { float er = eq . w * ep ; float es = exp ( - er * er ) ; es = clamp ( es , 0.0 , 1.0 ) ; eo = mix ( eq . rgb , eo , es ) ; return es ; }".split(" ")},
{type:"condition",a:[{type:"if",c:["PROCEDURAL_FOG"],group:{type:"group",a:[{type:"textline",b:"vec3 eA ( in mat4 eu , in vec3 ev ) { vec3 ew = mix ( eu [ 0 ] . rgb , eu [ 1 ] . rgb , max ( sign ( ev . x ) , 0.0 ) ) ; vec3 ex = mix ( eu [ 2 ] . rgb , eu [ 3 ] . rgb , max ( sign ( ev . z ) , 0.0 ) ) ; vec3 ey = vec3 ( eu [ 0 ] . a , eu [ 1 ] . a , eu [ 2 ] . a ) ; vec3 ez = mix ( ew , ex , abs ( ev . z ) ) ; ez = mix ( ez , ey , abs ( ev . y ) ) ; return ez ; }".split(" ")}]}}]},{type:"condition",
a:[{type:"if",c:["WATER_EFFECTS"],group:{type:"group",a:[{type:"textline",b:"void eC ( inout float eB ) { eB -= 0.5 ; eB = 4.0 * ( eB * eB * eB ) + 0.5 ; } float eR ( inout vec3 eD , in float eE , in float eF , in float eG , in vec4 eH , in vec4 eI , in float eJ , in float eK ) { eF = clamp ( eF , 0.0 , 1.0 ) ; float eL = eI . w * eE ; float eM = exp ( - eL * eL ) ; eM = clamp ( eM , 0.0 , 1.0 ) ; eE = max ( eE - max ( eG / eF , 0.0 ) , 0.0 ) ; eL = eH . w * eE ; float eN = 1.0 - eL ; eN += max ( eJ - WAVES_HEIGHT - 0.05 , 0.0 ) ; + max ( eJ / WAVES_HEIGHT , 0.0 ) ; eN = clamp ( eN , 0.0 , 1.0 ) ; eC ( eN ) ; if ( eN < eM ) { vec3 eO = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 eP = eH . rgb ; eG = clamp ( - eG * 0.03 , 0.0 , 0.8 ) ; vec3 eQ = mix ( eP , eO , min ( eF , 1.0 ) ) ; eQ = mix ( eQ , vec3 ( 0.0 ) , eG ) * eK ; eD = mix ( eQ , eD , eN ) ; return eN ; } else if ( eN >= eM ) { eD = mix ( eI . rgb , eD , eM ) ; return eM ; } } float e_ ( inout vec3 eS , in float eT , in float eU , in vec4 eV , in float eW ) { float eX = eV . w * eT ; float eY = 1.0 - eX ; eY = clamp ( eY , 0.0 , 1.0 ) ; eC ( eY ) ; eU = clamp ( - eU * 0.03 , 0.0 , 0.8 ) ; vec3 eZ = mix ( eV . rgb , vec3 ( 0.0 ) , eU ) * eW ; eS = mix ( eZ , eS , eY ) ; return eY ; }".split(" ")}]}}]}]};
a["include/lighting.glslf"]={type:"group",a:[{type:"var",name:"NUM_LIGHTS",b:["0"]},{type:"define",name:"M_PI",b:["3.14159265359"]},{type:"textline",b:"struct fa { vec4 a ; vec3 b ; } ;".split(" ")},{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float fi ( vec3 fb , vec3 fc , vec3 fd , vec4 fe , float ff ) { vec3 fg = normalize ( fb + fc ) ; float fh = fe [ 0 ] * max ( dot ( fd , fg ) , 0.0 ) + fe [ 1 ] ; return pow ( fh , ff ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float ft ( vec3 fj , vec3 fk , vec3 fl , float fm ) { vec3 fn = normalize ( fj + fk ) ; float fo = max ( dot ( fl , fn ) , 0.001 ) ; float fp = max ( dot ( fl , fk ) , 0.001 ) ; float fq = max ( dot ( fl , fj ) , 0.001 ) ; float fr = tan ( acos ( fo ) ) ; float fs = max ( fm , 0.001 ) ; return fq * ( 1.0 / ( 4.0 * M_PI * fs * fs ) ) * ( exp ( - ( fr * fr ) / ( fs * fs ) ) / ( sqrt ( fp * fq ) ) ) ; }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"void fL ( float fu , vec3 fv , vec3 fw , vec3 fx , float fy , inout float fz ) { if ( fy > 0.0 ) { float fA = max ( dot ( fv , fx ) , 0.0 ) ; float fB = acos ( fu ) ; float fC = acos ( fA ) ; vec3 fD = normalize ( fw - fu * fv ) ; vec3 fE = normalize ( fx - fA * fv ) ; float fF = max ( dot ( fD , fE ) , 0.0 ) ; float fG , fH ; fG = max ( fB , fC ) ; fH = min ( fB , fC ) ; float fI = fy * fy ; float fJ = 1.0 - 0.5 * ( fI / ( fI + 0.33 ) ) ; float fK = 0.45 * ( fI / ( fI + 0.09 ) ) ; fH *= 0.95 ; fz = fz * ( fJ + ( fK * fF * sin ( fG ) * tan ( fH ) ) ) ; } else { fz = fz ; } }".split(" ")}]}}]},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"void fS ( vec3 fM , vec3 fN , float fO , float fP , out float fQ ) { float fR ; if ( fO == 0.0 ) { fQ = 1.0 ; } else { fR = 1.0 + abs ( dot ( fN , fM ) ) ; fR = fP + ( 1.0 - fP ) * pow ( fR , fO ) ; fQ = clamp ( fR , 0.0 , 1.0 ) ; } }".split(" ")}]}}]},{type:"textline",b:"fa gE ( vec3 fT , vec3 fU , vec3 fV , vec3 fW , vec3 fX , vec3 fY , vec3 fZ , float f_ , vec2 ga , float gb , vec3 gc [ NUM_LIGHTS ] , vec3 gd [ NUM_LIGHTS ] , vec3 ge [ NUM_LIGHTS ] , vec4 gf [ NUM_LIGHTS ] , vec4 gg [ NUM_LIGHTS ] , float gh , vec4 gi ) { fa gj ; gj . a = vec4 ( fT + fV * fU , 0.0 ) ; gj . b = vec3 ( 0.0 ) ; for ( int gk = 0 ; gk < NUM_LIGHTS ; gk ++ ) { vec4 gl = gf [ gk ] ; vec4 gm = gg [ gk ] ; vec3 gn = vec3 ( 0.0 ) ; vec3 go = ge [ gk ] ; go *= gb ; float gp = gm . z ; if ( gp > - 1.0 ) { gn = gc [ gk ] - fX ; float gq = length ( gn ) ; go *= gp / ( gp + gq * gq ) ; gn = normalize ( gn ) ; float gr = gm . x ; float gs = gm . y ; if ( gr > - 1.0 ) { float gt = dot ( gn , gd [ gk ] ) ; gt *= smoothstep ( 0.0 , 1.0 , ( gt - gr ) / gs ) ; go *= gt ; } } else if ( gp == - 1.0 ) { gn = gd [ gk ] ; } float gu ;".split(" ")},
{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_FRESNEL"],group:{type:"group",a:[{type:"textline",b:"fS ( fY , gn , ga [ 0 ] , ga [ 1 ] , gu ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"float gv = max ( dot ( fY , gn ) , 0.0 ) ; gu = gl [ 0 ] * gv + gl [ 1 ] ;".split(" ")},{type:"condition",a:[{type:"if",c:["DIFFUSE_SHADER","==","DIFFUSE_OREN_NAYAR"],group:{type:"group",a:[{type:"textline",b:"fL ( gv , fY , gn , fZ , ga [ 0 ] , gu ) ;".split(" ")}]}}]}]}}]},
{type:"condition",a:[{type:"if",c:"SPECULAR_SHADER == SPECULAR_PHONG || SPECULAR_SHADER == SPECULAR_COOKTORR".split(" "),group:{type:"group",a:[{type:"textline",b:"float gw = fi ( gn , fZ , fY , gl , f_ ) ;".split(" ")}]}},{type:"elif",c:["SPECULAR_SHADER","==","SPECULAR_WARDISO"],group:{type:"group",a:[{type:"textline",b:"float gw = ft ( gn , fZ , fY , f_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:["float","gw","=","0.0",";"]}]}}]},{type:"condition",a:[{type:"if",
c:["USE_NODE_TRANSLUCENCY"],group:{type:"group",a:[{type:"textline",b:"if ( dot ( gn , fY ) * dot ( fZ , fY ) < 0.0 ) { float gx = gi . x ; float gy = gi . y ; float gz = gi . z ; float gA = gi . w ; float gB = clamp ( abs ( dot ( gn , fY ) ) , 0.0 , 1.0 ) ; float gC = clamp ( dot ( fZ , - gn ) , 0.0 , 1.0 ) ; float gD = pow ( gC , gy ) ; gj . a += gh * vec4 ( go * gB * pow ( fV , vec3 ( gx ) ) , 1.0 ) ; gj . a += gz * mix ( vec4 ( fV , 1.0 ) , vec4 ( 1.0 ) , gA ) * gh * vec4 ( go * gB * vec3 ( gD ) , 1.0 ) ; } else { gj . b += go * fW * gw ; gj . a += vec4 ( go * fV * gu , gw ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",a:[{type:"textline",b:"gj . b += go * fW * gw ; gj . a += vec4 ( go * fV * gu , gw ) ;".split(" ")}]}}]},{type:"textline",b:["}","return","gj",";","}"]}]};a["include/procedural.glslf"]={type:"group",a:[{type:"textline",b:"vec4 gG ( vec4 gF ) { return gF - floor ( gF * ( 1.0 / 289.0 ) ) * 289.0 ; } vec3 gG ( vec3 gH ) { return gH - floor ( gH * ( 1.0 / 289.0 ) ) * 289.0 ; } vec2 gG ( vec2 gI ) { return gI - floor ( gI * ( 1.0 / 289.0 ) ) * 289.0 ; } vec4 gK ( vec4 gJ ) { return gJ - floor ( gJ * ( 1.0 / 7.0 ) ) * 7.0 ; } vec4 gM ( vec4 gL ) { return gG ( ( 34.0 * gL + 5.0 ) * gL ) ; }".split(" ")},
{type:"define",name:"K",b:["0.142857142857"]},{type:"define",name:"K2",b:["0.0714285714285"]},{type:"define",name:"JITTER",b:["0.7"]},{type:"textline",b:"vec2 gY ( vec2 gN ) { vec2 gO = gG ( floor ( gN ) ) ; vec2 gP = fract ( gN ) ; vec4 gQ = gP . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 gR = gP . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 gS = gM ( gO . x + vec4 ( 0.0 , 1.0 , 0.0 , 1.0 ) ) ; gS = gM ( gS + gO . y + vec4 ( 0.0 , 0.0 , 1.0 , 1.0 ) ) ; vec4 gT = gK ( gS ) * K + K2 ; vec4 gU = gK ( floor ( gS * K ) ) * K + K2 ; vec4 gV = gQ + JITTER * gT ; vec4 gW = gR + JITTER * gU ; vec4 gX = gV * gV + gW * gW ;".split(" ")},
{type:"condition",a:[{type:"if",c:["1"],group:{type:"group",a:[{type:"textline",b:"gX . xy = min ( gX . xy , gX . zw ) ; gX . x = min ( gX . x , gX . y ) ; return gX . xx ;".split(" ")}]}},{type:"else",group:{type:"group",a:[{type:"textline",b:"gX . xy = ( gX . x < gX . y ) ? gX . xy : gX . yx ; gX . xz = ( gX . x < gX . z ) ? gX . xz : gX . zx ; gX . xw = ( gX . x < gX . w ) ? gX . xw : gX . wx ; gX . y = min ( gX . y , gX . z ) ; gX . y = min ( gX . y , gX . w ) ; return sqrt ( gX . xy ) ;".split(" ")}]}}]},
{type:"textline",b:"} mat3 hm ( vec2 gZ , float g_ ) { vec2 ha = gG ( floor ( gZ ) ) ; vec2 hb = fract ( gZ ) ; vec4 hc = hb . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 hd = hb . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 he = gM ( ha . x + vec4 ( 0.0 , 1.0 , 0.0 , 1.0 ) ) ; he = gM ( he + ha . y + vec4 ( 0.0 , 0.0 , 1.0 , 1.0 ) ) ; vec4 hf = gK ( he ) * K + K2 ; vec4 hg = gK ( floor ( he * K ) ) * K + K2 ; vec4 hh = hc + JITTER * hf ; vec4 hi = hd + JITTER * hg ; vec4 hj = hh * hh + hi * hi ; hh += g_ ; hi += g_ ; vec4 hk = hh * hh + hi * hi ; hh += g_ ; hi += g_ ; vec4 hl = hh * hh + hi * hi ; hj . xy = min ( hj . xy , hj . zw ) ; hj . x = min ( hj . x , hj . y ) ; hk . xy = min ( hk . xy , hk . zw ) ; hk . x = min ( hk . x , hk . y ) ; hl . xy = min ( hl . xy , hl . zw ) ; hl . x = min ( hl . x , hl . y ) ; return mat3 ( hj . xx , 0.0 , hk . xx , 0.0 , hl . xx , 0.0 ) ; } vec3 ho ( vec3 hn ) { return gG ( ( ( hn * 34.0 ) + 1.0 ) * hn ) ; } float hC ( vec2 hp ) { const vec4 hq = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 hr = floor ( hp + dot ( hp , hq . yy ) ) ; vec2 hs = hp - hr + dot ( hr , hq . xx ) ; vec2 ht ; ht = ( hs . x > hs . y ) ? vec2 ( 1.0 , 0.0 ) : vec2 ( 0.0 , 1.0 ) ; vec4 hu = hs . xyxy + hq . xxzz ; hu . xy -= ht ; hr = gG ( hr ) ; vec3 hv = ho ( ho ( hr . y + vec3 ( 0.0 , ht . y , 1.0 ) ) + hr . x + vec3 ( 0.0 , ht . x , 1.0 ) ) ; vec3 hw = max ( 0.5 - vec3 ( dot ( hs , hs ) , dot ( hu . xy , hu . xy ) , dot ( hu . zw , hu . zw ) ) , 0.0 ) ; hw = hw * hw ; hw = hw * hw ; vec3 hx = 2.0 * fract ( hv * hq . www ) - 1.0 ; vec3 hy = abs ( hx ) - 0.5 ; vec3 hz = floor ( hx + 0.5 ) ; vec3 hA = hx - hz ; hw *= 1.79284291400159 - 0.85373472095314 * ( hA * hA + hy * hy ) ; vec3 hB ; hB . x = hA . x * hs . x + hy . x * hs . y ; hB . yz = hA . yz * hu . xz + hy . yz * hu . yw ; return 130.0 * dot ( hw , hB ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",a:[{type:"var",name:"CAUST_SPEED",b:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",b:["0.0"]},{type:"var",name:"CAUST_BRIGHT",b:["0.0"]},{type:"textline",b:"void hY ( inout vec3 hD , vec2 hE , float hF , float hG , float hH , vec3 hI , vec3 hJ , vec3 hK , in vec3 hL ) { vec3 hM = hJ ; float hN = max ( dot ( hI , hM ) , 0.0 ) ; float hO = 0.025 ; hE . s += 0.5 * sin ( dot ( hL + hG , vec3 ( 1.0 ) ) ) ; hE . t += 0.7 * ( - sin ( dot ( hL - hG , vec3 ( - 0.7 ) ) ) ) ; hE . st += 0.23 * cos ( 4.0 * hF - CAUST_SPEED . x * hG ) ; hE . st += 3.0 * sin ( hF - 0.3 * CAUST_SPEED . y * hG ) ; float hP = max ( sign ( hF ) , 0.0 ) ; float hQ = CAUST_SCALE * ( 1.0 + max ( 0.1 * hF , 0.0 ) ) ; mat3 hR = hm ( ( hE / hQ ) , hO ) ; float hS = ( hR * vec3 ( 1.0 , 0.0 , 0.0 ) ) . x ; float hT = ( hR * vec3 ( 0.0 , 1.0 , 0.0 ) ) . x ; float hU = ( hR * vec3 ( 0.0 , 0.0 , 1.0 ) ) . x ; vec3 hV = CAUST_BRIGHT * vec3 ( hS , hT , hU ) ; float hW = hH * hN ; hW = min ( hW + 0.5 * sign ( - hI . y ) * hP , 1.0 ) ; hW *= 1.0 - hP * ( 0.1 * hF ) ; hV *= hW ; hV *= hV ; float hX = min ( - hF + 10.0 , 1.0 ) ; hD += max ( ( 2.0 * hK * hV ) * hX , 0.0 ) ; }".split(" ")}]};
a["include/mirror.glslf"]={type:"group",a:[{type:"condition",a:[{type:"if",c:["REFLECTIVE","||","TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",b:"float il ( in vec3 id , in vec3 ie , in float ig , in float ih ) { vec3 ii = normalize ( ie + id ) ; float ij = 1.0 - dot ( id , ii ) ; float ik = ih + ( 1.0 - ih ) * pow ( ij , ig ) ; return ik ; } void iA ( inout vec3 im , in vec3 io , in vec3 ip , in float iq , in float ir , in vec3 is , in vec2 it ) { vec3 iu = reflect ( - io , ip ) ; float iv = il ( io , iu , iq , ir ) ;".split(" ")},
{type:"condition",a:[{type:"if",c:["REFLECTIVE"],group:{type:"group",a:[{type:"textline",b:"float iw = 0.1 ; vec2 ix = cw . xy / cw . z ;".split(" ")},{type:"condition",a:[{type:"if",c:["TEXTURE_NORM"],group:{type:"group",a:[{type:"textline",b:"ix += it * iw ;".split(" ")}]}}]},{type:"textline",b:"vec3 iy = texture2D ( u_reflectmap , ix ) . rgb ; eg ( iy . rgb ) ; iy *= is ; im = mix ( im , iy , u_reflect_factor * iv ) ;".split(" ")}]}},{type:"elif",c:["TEXTURE_MIRROR"],group:{type:"group",a:[{type:"textline",
b:"vec3 iz = textureCube ( u_mirrormap , iu ) . xyz ; eg ( iz . rgb ) ; iz *= is ; im = mix ( im , iz , u_mirror_factor * iv ) ;".split(" ")}]}}]},{type:"textline",b:["}"]}]}}]}]};a["include/particles.glslv"]={type:"group",a:[{type:"define",name:"RAMPSIZE",b:["4"]},{type:"textline",b:"float jt ( float ji , float jj , vec2 jk [ RAMPSIZE ] ) { if ( jk [ 0 ] [ 0 ] < 0.0 ) return 1.0 ; float jl = ji / jj ; bool jm = false ; float jn = 0.0 ; float jo = jk [ 0 ] [ 1 ] ; float jp = 1.0 ; float jq = 1.0 ; for ( int jr = 0 ; jr < RAMPSIZE ; jr ++ ) { if ( ! jm ) { if ( jk [ jr ] [ 0 ] >= 0.0 ) { if ( jl >= jn && jl < jk [ jr ] [ 0 ] ) { jp = jk [ jr ] [ 0 ] ; jq = jk [ jr ] [ 1 ] ; jm = true ; } else if ( jl < jn || jl >= jk [ jr ] [ 0 ] ) { jn = jk [ jr ] [ 0 ] ; jo = jk [ jr ] [ 1 ] ; } } else if ( jk [ jr ] [ 0 ] < 0.0 ) { jq = jo ; jm = true ; } } } if ( ! jm ) jq = jo ; float js = ( jq - jo ) / ( jp - jn ) ; return jo + js * ( jl - jn ) ; } vec3 jF ( float ju , float jv , vec4 jw [ RAMPSIZE ] ) { if ( jw [ 0 ] [ 0 ] < 0.0 ) return vec3 ( 1.0 , 1.0 , 1.0 ) ; float jx = ju / jv ; bool jy = false ; float jz = 0.0 ; vec3 jA = jw [ 0 ] . yzw ; float jB = 1.0 ; vec3 jC = vec3 ( 1.0 , 1.0 , 1.0 ) ; for ( int jD = 0 ; jD < RAMPSIZE ; jD ++ ) { if ( ! jy ) { if ( jw [ jD ] [ 0 ] >= 0.0 ) { if ( jx >= jz && jx < jw [ jD ] [ 0 ] ) { jB = jw [ jD ] [ 0 ] ; jC = jw [ jD ] . yzw ; jy = true ; } else if ( jx < jz || jx >= jw [ jD ] [ 0 ] ) { jz = jw [ jD ] [ 0 ] ; jA = jw [ jD ] . yzw ; } } else if ( jw [ jD ] [ 0 ] < 0.0 ) { jC = jA ; jy = true ; } } } if ( ! jy ) jC = jA ; vec3 jE = ( jC - jA ) / ( jB - jz ) ; return jA + jE * ( jx - jz ) ; } float jO ( float jG , float jH , float jI , float jJ ) { float jK = max ( 0.01 , min ( jH , jI ) ) ; float jL = max ( 0.01 , min ( jH , jJ ) ) ; float jM = jH - jL ; float jN = clamp ( jG / jK , 0.0 , 1.0 ) - step ( jM , jG ) * ( jG - jM ) / jL ; return jN ; }".split(" ")}]};
a["include/depth_fetch.glslf"]={type:"group",a:[{type:"textline",b:"float kb ( in sampler2D jV , in vec2 jW , in vec2 jX ) { float jY = texture2D ( jV , jW ) . r ; float jZ = jX . x ; float j_ = jX . y ; float ka = 2.0 * jZ / ( jZ + j_ - ( 2.0 * jY - 1.0 ) * ( j_ - jZ ) ) ; return ka ; }".split(" ")}]}};b4w.module.__geometry=function(a,r){function b(a){return a.J>E?D.oo()?!1:!0:!1}function c(a){return 0<a.ja.length?!0:!1}function d(a,b,c){c||B.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.J*(b||1)+", will use drawArrays","color: #aa0");b=a.ja;c=a.J;var d=a.Z,g=a.r,m;for(m in d){var h=d[m],q=f(h,c);d[m]=e(b,h,q)}for(d=0;d<g.length;d++){var k=g[d];for(m in k)h=k[m],q=f(h,c),k[m]=e(b,h,q)}a.J=b.length;a.ja=new Uint16Array(0);return a}function e(a,b,c){if(0==b.length)return new Float32Array(0);
for(var d=new Float32Array(a.length*c),f=0;f<a.length;f++)for(var m=a[f],e=0;e<c;e++)d[c*f+e]=b[c*m+e];return d}function l(b,c){var d,f;switch(c){case a.fg:case a.df:d=H.TRIANGLES;f=H.STATIC_DRAW;break;case a.Gm:d=H.POINTS;f=H.STATIC_DRAW;break;case a.Em:d=H.TRIANGLES;f=H.DYNAMIC_DRAW;break;case a.Qq:d=H.POINTS;f=H.DYNAMIC_DRAW;break;case a.Fm:d=H.LINES;f=H.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.Ij=f}function g(a){a.Ae?(a.Nd||(a.Nd=H.createBuffer()),H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,
a.Nd),H.bufferData(H.ELEMENT_ARRAY_BUFFER,a.Ae,a.Ij),a.zk=a.Ae.byteLength):a.zk=0;a.Yf||(a.Yf=H.createBuffer());H.bindBuffer(H.ARRAY_BUFFER,a.Yf);H.bufferData(H.ARRAY_BUFFER,a.ie,a.Ij);a.Eu=a.ie.byteLength}function p(a){for(var b=y.sb("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].ja.length;b.ja=new Uint32Array(c);for(d=c=0;d<a.length;d++)c+=a[d].J;b.J=c;var e=a[0],m;for(m in e.Z){for(d=c=0;d<a.length;d++)c+=a[d].Z[m].length;b.Z[m]=new Float32Array(c)}for(m in e.r[0]){for(d=c=0;d<a.length;d++)c+=
a[d].r[0][m].length;for(d=0;d<e.r.length;d++)b.r[d]=b.r[d]||{},b.r[d][m]=new Float32Array(c)}for(e=d=c=0;e<a.length;e++){m=a[e];for(var g=m.ja,h=m.J,q=m.Z,k=0;k<g.length;k++)b.ja[c+k]=g[k]+d;var c=c+g.length,n;for(n in q){var g=q[n],p=d*f(g,h);b.Z[n].set(g,p)}for(k=0;k<m.r.length;k++){var q=m.r[k],l=b.r[k];for(n in q)g=q[n],p=d*f(g,h),l[n].set(g,p)}d+=h}return b}function n(a,b,c,f,e,m){var g=y.sb("SUBMESH_"+a.name+"_"+b);b=a.submeshes[b];var q=b.base_length;g.J=q;var n=k(c,"a_texcoord")?new Float32Array(b.texcoord):
new Float32Array(0),p,l=b.group;if(k(c,"a_influence")&&f){p=new Float32Array(q*Q);for(var v=l.length/q,u=new Float32Array(v),t=0;t<v;t++){u[t]=-1;for(var z in f){var w=f[z];if(w.mm===t){u[t]=w.Eg;break}}}var D=3<v?v:4;f=new Float32Array(D);z=new Uint32Array(D);for(var t=new Float32Array(Q),w=new Float32Array(D),D=new Uint32Array(D),E=new Float32Array(Q),r=0;r<q;r++)f.set(w),z.set(D),t.set(E),p.set(h(l,v,r,q,u,f,z,t),r*Q)}else p=new Float32Array(0);l=e?y.$a(e):{};l.a_color={xe:!0};l.a_color.src=k(c,
"a_color")&&a.active_vcol_name?[{name:a.active_vcol_name,Wb:7}]:[];e={a_texcoord:n,a_influence:p};n=b.vertex_colors;p=b.color;v=[];for(u=0;u<n.length;u++)v.push(n[u].name);for(var G in l)if(u=l[G].src,u.length){for(z=f=0;z<u.length;z++)f+=y.Oe(u[z].Wb);e[G]=new Float32Array(f*q);for(z=t=0;z<u.length;z++){var aa=u[z].name,w=u[z].Wb,D=y.Kp(w),fa=v.indexOf(aa);if(-1==fa)throw'B4W Error: vertex color "'+aa+'" not found';E=n[fa].mask;r=y.Oe(E);(w&E)!==w&&B.error("B4W Error: Wrong color extraction from "+
aa+" to "+G+".");for(var M=aa=0;M<fa;M++)aa+=y.Oe(n[M].mask);fa=aa*q;for(aa=0;aa<q;aa++)for(M=0;M<I;M++)D[M]&&(e[G][aa*f+(t+y.Bh(w,M))]=p[fa+aa*r+y.Bh(E,M)]);t+=r}}else e[G]=new Float32Array(0);G=a.uv_textures;l=b.texcoord;n=b.texcoord2;a=a.name;if(m)for(var ba in m){p=G.indexOf(ba);if(-1==p)throw'B4W Error: uv map "'+ba+'" for mesh "'+a+'" not found';if(0==p)var ga=new Float32Array(l);else 1==p&&(ga=new Float32Array(n));e[m[ba]]=ga}g.Z=e;g.ja=new Uint32Array(b.indices);ba=b.position.length/q/x;a=
(ga=k(c,"a_normal")&&b.normal.length?!0:!1)&&k(c,"a_tangent")&&b.tangent.length?!0:!1;for(G=0;G<ba;G++)m={},e=new Float32Array(q*x),l=new Float32Array(ga?q*L:0),n=new Float32Array(a?q*R:0),p=G*q*x,v=p+q*x,e.set(b.position.subarray(p,v),0),ga&&(p=G*q*L,v=p+q*L,l.set(b.normal.subarray(p,v),0)),a&&(p=G*q*R,v=p+q*R,n.set(b.tangent.subarray(p,v),0)),m.a_position=e,m.a_normal=l,m.a_tangent=n,g.r.push(m);if(1<ba){b=g.r[0];m={};for(var ha in b)m[ha]=new Float32Array(b[ha]);g.r.push(m)}k(c,"a_polyindex")&&
(d(g,1,!0),g.Z.a_polyindex=s(g));return g}function k(a,b){return-1<a.indexOf(b)?!0:!1}function h(a,b,c,d,f,m,e,g){for(var h=!0,q=0;q<b;q++){var k=a[q*d+c];if(-1!==k){var n=f[q];-1!==n&&(m[q]=k,e[q]=n,h=!1)}}if(h)return g;t(m,e);for(q=a=0;q<Q;q++)a+=m[q];if(0.01>a)return g;for(q=0;q<Q;q++)m[q]/=a;if(0.01>Math.abs(m[0]-1))g[0]=e[0]+1;else for(q=0;q<Q;q++)g[q]=e[q]+m[q];return g}function f(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+
c+", base length="+b;return d}function t(a,b,c){var d=a.length,f=d,m=!1;for(c=1==c?-1:1;1<f||m;){1<f&&(f=Math.floor(f/M));for(var m=!1,e=0;f+e<d;e++)0>c*(a[e]-a[e+f])&&(m=a[e],a[e]=a[e+f],a[e+f]=m,m=b[e],b[e]=b[e+f],b[e+f]=m,m=!0)}}function u(a,b,c){var d=[],f=[];z.subtract(b,a,d);z.subtract(c,a,f);z.normalize(d,d);z.normalize(f,f);return Math.acos(z.dot(d,f))}function w(a,b,d){b||(b=[]);d=d?a.r[0].a_normal:a.r[0].a_position;if(c(a)){a=a.ja;for(var f=a.length/3,e=0;e<f;e++){var m=new Float32Array(9),
g=a[3*e];m[0]=d[3*g];m[1]=d[3*g+1];m[2]=d[3*g+2];g=a[3*e+1];m[3]=d[3*g];m[4]=d[3*g+1];m[5]=d[3*g+2];g=a[3*e+2];m[6]=d[3*g];m[7]=d[3*g+1];m[8]=d[3*g+2];b[e]=m}}else for(e=0;e<d.length;e++)m=new Float32Array(9),m[0]=d[9*e],m[1]=d[9*e+1],m[2]=d[9*e+2],m[3]=d[9*e+3],m[4]=d[9*e+4],m[5]=d[9*e+5],m[6]=d[9*e+6],m[7]=d[9*e+7],m[8]=d[9*e+8],b[e]=m;return b}function s(a){for(var b=new Float32Array(a.J),c=0;c<a.J;c++)b[c]=c%3;return b}var B=r("__print"),q=r("__tsr"),y=r("__util"),D=r("__extensions"),z=r("vec3"),
E=65536,M=1.247330950103979,x=3,L=3,R=4,I=3,Q=4;a.tc=10;a.Pm=20;a.$A=30;a.df=10;a.Gm=20;a.Em=30;a.Qq=40;a.Fm=50;a.fg=a.df;var H;a.mc=function(a){H=a};a.xB=function(a){var b=_buffers[a];H.deleteBuffer(b.Nd);H.deleteBuffer(b.Yf);delete _buffers[a]};a.Nz=function(e,q,h,k){b(e)&&c(e)&&d(e);var n=e.ja,m=e.J,F=e.r,C={},p;for(p in e.Z)p in k&&!k[p].xe||(C[p]=e.Z[p]);if(n.length)if(k=n.length,m<=E){p=new Uint16Array(n);var s=H.UNSIGNED_SHORT}else p=new Uint32Array(n),s=H.UNSIGNED_INT;else k=m,p=null;var u=
0,v=F.length,B;for(B in F[0])var t=F[0][B],u=u+t.length*v;for(B in C)t=C[B],u+=t.length;B=new Float32Array(u);var u=0,v={},z;for(z in C){var y=C[z];if(t=y.length)B.set(y,u),v[z]={aB:z,lh:f(y,m),offset:u,frames:1,length:t},u+=t}C=F.length;for(z in F[0])if(y=F[0][z],t=y.length,y=f(y,m),t){v[z]={lh:y,offset:u,frames:C,length:t};1<C&&(v[z+"_next"]={lh:y,offset:u+t,frames:C,length:t});for(var w=0;w<C;w++)y=F[w][z],B.set(y,u),u+=t}m={count:k,Ae:p,ie:B,Mo:s,th:v};l(m,h);g(m);q!=a.tc&&c(e)&&(m.Zk={yx:new Float32Array(n.length),
zx:new Float32Array(n.length),Ou:new Float32Array(n.length/3),type:q});return m};a.dx=b;a.bx=c;a.rq=d;a.vk=function(a,b,c){var d={ie:[],th:{}};l(d,a);d.mode==H.TRIANGLES?(d.count=b.length,d.Ae=b,d.Mo=d.count<=E?H.UNSIGNED_SHORT:H.UNSIGNED_INT):d.mode==H.POINTS&&(d.count=c,d.Ae=null);return d};a.Ib=function(a,b,c,d){var f=a.ie,m=a.th,e=m[b];if(e){if(e.lh!=c)throw'Error: invalid num_comp for "'+b+'"';f.set(d,e.offset)}else f=f.length,e=new Float32Array(f+d.length),e.set(a.ie),e.set(d,f),a.ie=e,m[b]=
{lh:c,offset:f};g(a);return a};a.sC=function(a){a.Ij=H.STATIC_DRAW};a.fp=function(a){a.Ij=H.DYNAMIC_DRAW};a.ot=function(a){a.Nd&&H.deleteBuffer(a.Nd);a.Yf&&H.deleteBuffer(a.Yf)};a.Io=function(a,b){return a.submeshes[b].base_length?!1:!0};a.rx=function(a,b,c,d){for(var f=[],m=0;m<a.length;m++){var e=a[m],g=n(e.aj,e.Ob,b,null,c,d);if(g.J){for(var h=g,k=e,e=h.J,l=k.transform,s=0;s<h.r.length;s++){var u=h.r[s].a_position;q.yq(u,l,u,0);u=h.r[s].a_normal;0<u.length&&q.wq(u,l,u,0);u=h.r[s].a_tangent;0<u.length&&
q.xq(u,l,u,0)}k=k.$;l=void 0;for(l in k)for(s=k[l].length,h.Z[l]=new Float32Array(s*e),u=0;u<e;u++)for(var B=0;B<s;B++)h.Z[l][u*s+B]=k[l][B];f.push(g)}}return 0==f.length?y.sb("EMPTY"):1==f.length?f[0]:p(f)};a.sq=p;a.sx=function(a,b,c,e,g){var m=n(a.aj,a.Ob,b,null,c,e);if(!m.J)return y.sb("EMPTY");b=g.length;m.J*b>E&&!D.oo()&&d(m,b);var h=m.ja;c=m.J;e=m.Z;var m=m.r,k=a.$,p;for(p in k){var l=k[p].length,s=l*c;e[p]=new Float32Array(s);for(a=0;a<c;a++)for(s=0;s<l;s++)e[p][a*l+s]=k[p][s]}p=y.sb("CLONE_"+
b+"_SUBMESHES");p.J=c*b;p.ja=new Uint32Array(h.length*b);for(a=0;a<b;a++)for(l=h.length*a,k=c*a,s=0;s<h.length;s++)p.ja[l+s]=h[s]+k;for(var u in e)for(h=e[u],s=h.length*b,l=f(h,c),p.Z[u]=new Float32Array(s),a=0;a<b;a++)k=c*l*a,p.Z[u].set(h,k);for(u in m[0])for(a=0;a<m.length;a++)for(h=m[a][u],s=h.length*b,l=f(h,c),p.r[a]=p.r[a]||{},p.r[a][u]=new Float32Array(s),s=0;s<b;s++)switch(e=g[s],k=c*l*s,u){case "a_position":q.yq(h,e,p.r[a][u],k);break;case "a_normal":q.wq(h,e,p.r[a][u],k);break;case "a_tangent":q.xq(h,
e,p.r[a][u],k);break;default:throw"Wrong attribute name: "+u;}return p};a.gv=n;a.ev=function(a){var b=a.J,c=a.r[0].a_position,d=new Float32Array(12*b),f=new Float32Array(8*b);a=new Uint16Array(4*a.ja.length);for(var m=0;m<b;m++)d[12*m]=c[3*m],d[12*m+1]=c[3*m+1],d[12*m+2]=c[3*m+2],d[12*m+3]=c[3*m],d[12*m+4]=c[3*m+1],d[12*m+5]=c[3*m+2],d[12*m+6]=c[3*m],d[12*m+7]=c[3*m+1],d[12*m+8]=c[3*m+2],d[12*m+9]=c[3*m],d[12*m+10]=c[3*m+1],d[12*m+11]=c[3*m+2],f[8*m]=-0.5,f[8*m+1]=-0.5,f[8*m+2]=-0.5,f[8*m+3]=0.5,
f[8*m+4]=0.5,f[8*m+5]=0.5,f[8*m+6]=0.5,f[8*m+7]=-0.5,a[6*m]=4*m+2,a[6*m+1]=4*m+1,a[6*m+2]=4*m,a[6*m+3]=4*m+2,a[6*m+4]=4*m,a[6*m+5]=4*m+3;c=y.sb("HALO");c.r=[];c.r[0]={};c.J=4*b;c.r[0].a_position=d;c.Z.a_halo_bb_vertex=f;c.ja=a;return c};a.Jw=k;a.hv=function(a){for(var b=["a_position","a_normal"],c=[],d=0;d<a.submeshes.length;d++){var f=n(a,d,b,null,null,null);f.J&&c.push(f)}return 0==c.length?y.sb("EMPTY"):1==c.length?c[0]:p(c)};a.fA=function(a,b,c){var d=a.Ae,f;var m=a.ie,e=a.th.a_position;if(e)f=
m.subarray(e.offset,e.offset+e.length);else throw"extract_array() failed; invalid name: a_position";for(var m=a.Zk,e=m.yx,g=m.zx,m=m.Ou,h=d,q=h.length/3,k=0;k<q;k++){var n=h[3*k],p=h[3*k+1],l=h[3*k+2],s=f[3*n+1],u=f[3*n+2],B=f[3*p+1],t=f[3*p+2],z=f[3*l+1],G=f[3*l+2];e[3*k]=(f[3*n]+f[3*p]+f[3*l])/3;e[3*k+1]=(s+B+z)/3;e[3*k+2]=(u+t+G)/3}y.Me(e,b,g);b=e.length/3;for(g=0;g<b;g++)h=e[3*g]-c[0],f=e[3*g+1]-c[1],q=e[3*g+2]-c[2],m[g]=h*h+f*f+q*q;c=d;d=m.length;if(!(2>d))for(e=d,g=!1;1<e||g;)for(1<e&&(e=Math.floor(e/
M)),g=!1,b=0;e+b<d;b++)0>m[b]-m[b+e]&&(g=m[b],m[b]=m[b+e],m[b+e]=g,g=c,h=b,f=b+e,q=g[3*h],k=g[3*h+1],n=g[3*h+2],g[3*h]=g[3*f],g[3*h+1]=g[3*f+1],g[3*h+2]=g[3*f+2],g[3*f]=q,g[3*f+1]=k,g[3*f+2]=n,g=!0);d=c;H.bindBuffer(H.ELEMENT_ARRAY_BUFFER,a.Nd);H.bufferData(H.ELEMENT_ARRAY_BUFFER,d,H.DYNAMIC_DRAW)};a.xz=t;a.Rs=function(a,b,c){for(var d=b.length/x,f=a.length/3,m=[],e=Array(3),g=Array(3),h=Array(3),q=0;q<f;q++){for(var k=a[3*q],n=a[3*q+1],p=a[3*q+2],l=0;l<x;l++)e[l]=b[x*k+l],g[l]=b[x*n+l],h[l]=b[x*
p+l];if(c)var l=u(e,g,h),s=u(g,h,e),B=Math.PI-l-s;else B=s=l=1;var t=m,y;y=e;var w=h,G=[],aa=[],D=[];z.subtract(g,y,G);z.subtract(w,y,aa);z.cross(G,aa,D);z.normalize(D,D);y=D;for(w=0;w<L;w++)G=L*n+w,aa=L*p+w,t[L*k+w]=l*y[w],t[G]=s*y[w],t[aa]=B*y[w]}if(c)for(var E in c)for(q=c[E],a=0;a<L;a++){b=L*q[0]+a;for(f=1;f<q.length;f++)e=L*q[f]+a,m[b]+=m[e];for(f=1;f<q.length;f++)e=L*q[f]+a,m[e]=m[b]}for(q=0;q<d;q++){c=q;E=m;a=new Float32Array(L);for(b=0;b<L;b++)f=L*c+b,a[b]=E[f];z.normalize(a,a);for(b=0;b<
L;b++)f=L*c+b,E[f]=a[b]}return m};a.Ss=function(a,b,c){for(var d={},f=b.length/3,m=0;m<f;m++){var e=String(b[3*m])+String(b[3*m+1])+String(b[3*m+2]);d[e]=[]}f=a.length;for(m=0;m<f;m++)b=a[m],e=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),e in d&&d[e].push(b);return d};a.Nk=function(a,b,c,d){var f=w(a,null,!1);if(c)var m=w(a,null,!0);var e=f.length,g=new Float32Array(e);for(a=0;a<e;a++){var h=f[a],q=g,k=a,n=h,p=new Float32Array([n[0],n[1],n[2]]),h=new Float32Array([n[3],n[4],n[5]]),l=new Float32Array([n[6],
n[7],n[8]]),n=z.dist(p,h),p=z.dist(p,l),h=z.dist(h,l),l=(n+p+h)/2;q[k]=Math.sqrt(l*(l-n)*(l-p)*(l-h))}q=new Float32Array(e);q[0]=g[0];for(a=1;a<e;a++)q[a]=q[a-1]+g[a];e=q[g.length-1];g=[];for(a=0;a<b;a++){var k=e*y.Yb(d),k=y.gi(q,k,0,q.length-1),h=c?m[k]:f[k],k=g,n=a,s=h,u=d,h=void 0,h=new Float32Array(3),p=s[0],B=s[1],t=s[2],l=s[3],D=s[4],G=s[5],aa=s[6],E=s[7],x=s[8],s=y.Yb(u),u=y.Yb(u);1<s+u&&(s=1-s,u=1-u);var r=1-s-u,B=r*B+s*D+u*E,t=r*t+s*G+u*x;h[0]=r*p+s*l+u*aa;h[1]=B;h[2]=t;k[n]=h}return g};
a.CB=w;a.fv=s;a.Cy=function(a,b,c){a=a.r[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]}};b4w.module.__particles=function(a,r){function b(){throw"_rand() undefined";}function c(a){a?(l.Jz(a),b=function(){return l.my()}):b=function(){return Math.random()}}var d=r("__config"),e=r("__geometry"),l=r("__util"),g=r("vec3"),p=d.lg,n=[0,0,0];a.Pi=function(a){return 0<a.particle_systems.length?!0:!1};a.Iw=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;return!1};a.Lw=function(a){for(var b=0;b<a.particle_systems.length;b++)if("HAIR"==
a.particle_systems[b].settings.type)return!0;return!1};a.Bv=function(d,h,f,n,u){f.Jb=f.Jb||{};var w=e.hv(h),s=f.settings.count,B=f.settings.frame_start/p.fb,q=f.settings.frame_end/p.fb,y=f.settings.lifetime/p.fb,D=f.settings.lifetime_random,z=f.settings.emit_from,E=f.settings.factor_random,r=f.settings.angular_velocity_mode,x=f.settings.angular_velocity_factor,L=f.settings.b4w_randomize_emission;c(f.seed);if(h=n.halo?!1:!0){var R;R=[];for(var I=0;I<s;I++)R.push(-0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,-0.5);
R=new Float32Array(R);for(var I=[],Q=0;Q<s;Q++)I.push(4*Q,4*Q+2,4*Q+1,4*Q,4*Q+3,4*Q+2);I=new Uint16Array(I)}switch(z){case "VERT":for(var Q=w.r[0].a_position,w=w.r[0].a_normal,H=Q.length/3,z=[],K=0;K<s;K++){var S=Math.round((H-1)*b());z.push(S);h&&(z.push(S),z.push(S),z.push(S))}H=[];for(K=0;K<z.length;K++)H.push(Q[3*z[K]]),H.push(Q[3*z[K]+1]),H.push(Q[3*z[K]+2]);Q=new Float32Array(H);H=[];for(K=0;K<z.length;K++)H.push(w[3*z[K]]),H.push(w[3*z[K]+1]),H.push(w[3*z[K]+2]);z=new Float32Array(H);break;
case "FACE":Q=[];z=[];K=[];l.Ri(0,K);H=e.Nk(w,s,!1,K);l.Ri(0,K);w=e.Nk(w,s,!0,K);for(K=0;K<H.length;K++)Q.push(H[K][0],H[K][1],H[K][2]),h&&(Q.push(H[K][0],H[K][1],H[K][2]),Q.push(H[K][0],H[K][1],H[K][2]),Q.push(H[K][0],H[K][1],H[K][2])),z.push(w[K][0],w[K][1],w[K][2]),h&&(z.push(w[K][0],w[K][1],w[K][2]),z.push(w[K][0],w[K][1],w[K][2]),z.push(w[K][0],w[K][1],w[K][2]));Q=new Float32Array(Q);z=new Float32Array(z);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";
}z=[Q,z];w=z[0];z=z[1];f.Jb.Cp=new Float32Array(w);f.Jb.mp=new Float32Array(z);f.Jb.by=new Float32Array(w.length);f.Jb.Ix=new Float32Array(z.length);l.Me(w,u,w,0);l.jm(z,u,z);u=[];B=(q-B)/s;for(q=0;q<s;q++)Q=L?B*q+10*B*(0.5-b()):B*q,u.push(Q),h&&(u.push(Q),u.push(Q),u.push(Q));L=new Float32Array(u);f.Jb.Iu=new Float32Array(L);u=[];D*=y;for(B=0;B<s;B++)q=D*b(),u.push(y-q),h&&(u.push(y-q),u.push(y-q),u.push(y-q));y=new Float32Array(u);D=[];for(u=0;u<s;u++){B=[b()-0.5,b()-0.5,b()-0.5];g.normalize(B,
B);D.push(E*B[0]);D.push(E*B[1]);D.push(E*B[2]);switch(r){case "NONE":D.push(0);break;case "SPIN":case "VELOCITY":D.push(x);break;case "RAND":D.push(2*x*(b()-0.5));break;default:throw"Undefined velocity factor";}if(h)for(B=D.slice(-4),q=0;12>q;q++)D.push(B[q%4])}E=new Float32Array(D);s=h?e.vk(e.df,I,0):e.vk(e.Gm,[],s);e.Ib(s,"a_position",3,w);e.Ib(s,"a_normal",3,z);e.Ib(s,"a_p_delay",1,L);e.Ib(s,"a_p_lifetime",1,y);e.Ib(s,"a_p_vels",4,E);h&&e.Ib(s,"a_p_bb_vertex",2,R);h=f.settings.lifetime/p.fb;I=
f.settings.frame_end/p.fb;y=f.settings.normal_factor;D=9.81*f.settings.effector_weights.gravity;R=f.settings.effector_weights.wind;E=f.settings.mass;r=f.settings.b4w_fade_in/p.fb;x=f.settings.b4w_fade_out/p.fb;L=f.settings.b4w_cyclic;d.tp=f.settings.frame_start/p.fb;d.sp=I;d.rp=L?1:0;d.Tx=y;d.Qx=D;I=a.Pb();d.Wx=new Float32Array([I[0]*R,I[1]*R,I[2]*R]);d.Sx=h;d.Rx=E;d.Ox=r;d.Px=x;n.halo?(h=n.halo.size,R=n.halo.hardness,30>R?(R=0.5,E=0.9):40>R?(R=0.1,E=1):50>R?(R=0,E=0.8):(R=0,E=0.5)):(h=f.settings.particle_size,
E=R=1);d.Ux=h;d.Mx=R;d.Lx=E;h=f.settings.texture_slots;f=[-1,0,-1,0,-1,0,-1,0];if(h[0]&&h[0].use_map_size&&h[0].texture&&"BLEND"==h[0].texture.type&&h[0].texture.use_color_ramp)for(h=h[0].texture.color_ramp.elements,R=Math.min(2*h.length,f.length),E=0;E<R;E+=2)r=h[E/2],f[E]=r.position,f[E+1]=(r.color[0]+r.color[1]+r.color[2])/3;d.Vx=new Float32Array(f);h=n.texture_slots;f=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(h[0]&&"STRAND"==h[0].texture_coords&&h[0].texture&&"BLEND"==h[0].texture.type&&h[0].texture.use_color_ramp){h=
h[0].texture.color_ramp.elements;R=Math.min(4*h.length,f.length);for(E=0;E<R;E+=4)r=h[E/4],f[E]=r.position,f[E+1]=r.color[0],f[E+2]=r.color[1],f[E+3]=r.color[2];n.texture_slots=[]}d.Nx=new Float32Array(f);return s};a.iA=function(a){for(var b=a.B,c=0;c<b.length;c++){var d=b[c].h,g=b[c].zp;if(g){var d=d.fc,n=g.Jb.by,p=g.Jb.Ix,B=g.Jb.mp,q=a.d.G,y=p;l.Me(g.Jb.Cp,q,n,0);l.jm(B,q,y);e.fp(d);e.Ib(d,"a_position",3,n);e.Ib(d,"a_normal",3,p)}}};a.hA=function(a){for(var b=a.B,c=0;c<b.length;c++){var d=b[c].h,
n=b[c].zp;if(n){var d=d.fc,w=n.Jb.Cp,s=n.Jb.mp,B=n.Jb.Iu,q=n.settings.frame_start/p.fb,y=a.f.e,D=a.f.cb;if(y&&D){for(var n=w,z=s,E=B,r=0;r<n.length;r+=3){var x=[n[r],n[r+1],n[r+2]],L=[z[r],z[r+1],z[r+2]],R=(E[r/3]+q)*p.fb,I=Math.floor(R),Q=I+1,H=R-I;0<y.length&&0<=I&&I<y.length-1?(R=l.hi(y[I],y[Q],H),I=l.hi(D[I],D[Q],H)):(R=[0,0,0],I=[0,0,0,1]);Q=[];H=[];g.transformQuat(x,I,Q);g.transformQuat(L,I,H);n[r]=Q[0]+R[0];n[r+1]=Q[1]+R[1];n[r+2]=Q[2]+R[2];z[r]=H[0];z[r+1]=H[1];z[r+2]=H[2]}e.fp(d);e.Ib(d,
"a_position",3,w);e.Ib(d,"a_normal",3,s);e.Ib(d,"a_p_delay",1,B)}}}};a.cy=function(a){var b=a.J,c=new Uint16Array(a.ja),d=a.r[0].a_position;a=a.Z.a_texcoord;for(var g=[],n=[],p=0;p<b;p++)n.push(d[3*p]),n.push(d[3*p+1]),g.push(d[3*p+2]);g=new Float32Array(g);n=new Float32Array(n);b=e.vk(e.df,c);b=e.Ib(b,"a_lf_dist",1,g);b=e.Ib(b,"a_lf_bb_vertex",2,n);return b=e.Ib(b,"a_texcoord",2,a)};a.Fj=function(a){"WIND"==a.field.type&&(a=a.d,l.Mb(a.i,l.hb,n),n=g.normalize(n,n),g.scale(n,a.co,n))};a.Pb=function(){return n};
a.pa=function(){n[0]=0;n[1]=0;n[2]=0}};b4w.module.__primitives=function(a,r){function b(a,b,c,d){for(var f=[],e=[],l=[],w=[],s=2*c/(a-1),B=2*d/(b-1),q=0;q<a;q++)for(var y=-c+q*s,D=0;D<b;D++)if(e.push(y,0,-d+D*B),l.push(0,1,0),w.push(q/(a-1),D/(b-1)),q&&D){var z=q*b+D,E=z-1,r=(q-1)*b+D,x=r-1;f.push(z,E,r);f.push(E,x,r)}a=g.qe();a.a_position=new Float32Array(e);a.a_normal=new Float32Array(l);l=g.sb("GRID_PLANE");l.r[0]=a;l.Z.a_texcoord=new Float32Array(w);l.ja=new Uint32Array(f);l.J=e.length/3;return l}function c(a){var b=a.length;if(b%
4)throw"Wrong array";for(var c=[],d=[],f=0;f<b;f+=4){var l=a[f+1],u=a[f+2],w=a[f+3];e(a[f],d);e(l,d);e(u,d);e(w,d);c.push(f,f+1,f+2);c.push(f,f+2,f+3)}a=g.qe();a.a_position=new Float32Array(d);b=g.sb("FROM_QUADS");b.r[0]=a;b.ja=new Uint32Array(c);b.J=d.length/3;return b}function d(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function e(a,b){b.push(a[0],a[1],a[2])}var l=r("__geometry"),g=r("__util");a.Fv=function(){for(var a=g.sb("LINE"),b=[],c=0;2>c;c++)b.push(c);c=g.qe();c.a_point=new Float32Array(b);
a.r[0]=c;a.ja=new Uint32Array(b);a.J=2;return a};a.NB=function(a,c){var d=b(2,2,a,c);d.name="PLANE";return d};a.MB=b;a.Hv=function(a,b,c){function d(a,b){return 1==a%2&&(0==b||b==w-1)||1==b%2&&(0==a||a==l-1)?!0:!1}var f=c/Math.pow(2,a-1),e=c=f,l=b+1,w=b+1;b=[];for(var f=[],s=[],B=0,q=0,y=-1,D=[],z=0;z<a;z++){for(var E=2*c/(l-1),r=2*e/(w-1),x=[],L=[],R=0,I=0;I<l;I++){for(var Q=-c+I*E,H=[],K=0;K<w;K++){var S=-e+K*r;if(Q>-B&&Q<B&&S>-q&&S<q)H.push(-1),R++;else{for(var P=null,O=0;O<D.length;O+=3)if(Q==
D[O]&&S==D[O+1]){P=D[O+2];break}O=null!==P?P:y+1;d(I,K)?(H.push(-2),R++):(null==P&&(0!=K&&K!=w-1&&0!=I&&I!=l-1||z==a-1?s.push(E):(s.push(2*E),x.push(Q,S,O)),f.push(Q,0,S),y++),H.push(O));if(I&&K)if(1==I)if(d(I-1,K)){if(1<K){var S=O-1,P=L[I-1][K+1],T=P-1;b.push(O,S,T)}else P=L[I-1][K+1],T=P-1;b.push(O,T,P)}else d(I,K)||(S=O-1,P=L[I-1][K],b.push(O,S,P));else if(I==l-1){if(!d(I,K))if(K==w-1)S=O-1,P=L[I-1][K-1],T=L[I-2][K],b.push(O,S,P),b.push(O,P,T);else{var S=O-1,P=L[I-1][K],T=P-1,m=P+1;b.push(O,S,
T);b.push(O,T,P);b.push(O,P,m);2==K&&(m=L[I-2][K-2],b.push(S,m,T))}}else 1==K?d(I,K-1)?(S=L[I-1][K],P=L[I-1][K-1],b.push(O,P,S)):(S=H[K-1],P=L[I-1][K],T=L[I-2][K-1],b.push(O,S,P),b.push(S,T,P)):K==w-1?d(I,K)||(S=H[K-1],P=L[I-1][K-1],T=L[I-2][K],b.push(O,S,P),b.push(O,P,T)):-1!=L[I-1][K]&&-1!=L[I-1][K-1]&&-1!=H[K-1]?(S=H[K-1],P=L[I-1][K],T=L[I-1][K-1],b.push(O,S,P),b.push(S,T,P),K==w-2&&d(I,K+1)&&(m=L[I-1][K+1],b.push(O,P,m))):K==w-2&&d(I,K+1)&&(P=L[I-1][K],m=L[I-1][K+1],b.push(O,P,m))}}L.push(H)}D=
x;B=c;q=e;c*=2;e*=2}if(2E4>B)for(Q=-2E4,f.push(-2E4,-1,-2E4),f.push(-2E4,-1,2E4),f.push(-B,-1,-q),f.push(-B,-1,q),f.push(2E4,-1,-2E4),f.push(2E4,-1,2E4),f.push(B,-1,-q),f.push(B,-1,q),O=y+1,b.push(O+3,O+2,O+1,O+2,O+0,O+1,O+6,O+4,O+2,O+4,O+0,O+2,O+5,O+7,O+1,O+7,O+3,O+1,O+5,O+4,O+7,O+7,O+4,O+6),E=2*B/(l-1),I=0;8>I;I++)s.push(-E);a=g.qe();a.a_position=new Float32Array(f);a.a_cascad_step=new Float32Array(s);c=g.sb("multigrid_plane");c.r[0]=a;c.ja=new Uint32Array(b);c.J=f.length/3;return c};a.LB=function(a){var b=
a.length;if(b%3)throw"Wrong array";for(var c=[],d=[],f=0;f<b;f+=3){var l=a[f+1],u=a[f+2];e(a[f],d);e(l,d);e(u,d);c.push(f,f+1,f+2)}a=g.qe();a.a_position=new Float32Array(d);b=g.sb("FROM_TRIANGLES");b.r[0]=a;b.ja=new Uint32Array(c);b.J=d.length/3;return b};a.KB=c;a.Ev=function(a){a=g.uA(a);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=c(b);a.name="FRUSTUM";return a};
a.Ka=function(){var a=g.sb("BILLBOARD"),b=g.qe();b.a_bb_vertex=new Float32Array([-0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,-0.5]);a.r[0]=b;a.ja=new Uint32Array([0,2,1,0,3,2]);a.J=4;return a};a.Cv=function(){var a=g.sb("CUBEMAP_BOARD"),b=g.qe();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.r[0]=b;a.ja=new Uint32Array([0,2,1,0,3,2]);a.J=4;return a};a.io=function(a,b){var c=g.sb("UV_SPHERE"),h,f,t=[],u=[],w=[];for(f=0;8>=f;f++)for(h=0;16>=h;h++){var s=h/16,B=f/8;u.push(-a*Math.cos(2*s*Math.PI)*Math.sin(B*
Math.PI)+b[0],a*Math.cos(B*Math.PI)+b[1],a*Math.sin(2*s*Math.PI)*Math.sin(B*Math.PI)+b[2])}for(f=s=0;8>f;f++)for(h=0;16>h;h++){var B=d(u,17*f+h+1),q=d(u,17*f+h),y=d(u,17*(f+1)+h),D=d(u,17*(f+1)+h+1);Math.abs(B[1])==a+b[1]?(e(B,t),e(y,t),e(D,t),w.push(s,s+1,s+2),s+=3):Math.abs(y[1])==a+b[1]?(e(B,t),e(q,t),e(y,t),w.push(s,s+1,s+2),s+=3):(e(B,t),e(q,t),e(y,t),e(D,t),w.push(s,s+1,s+2),w.push(s,s+2,s+3),s+=4)}h={};h.a_position=t;u=l.Ss(w,u,t);h.a_normal=l.Rs(w,t,u);h.a_tangent=[];c.Z.a_influence=[];c.Z.a_color=
[];c.Z.a_texcoord=[];c.r[0]=h;c.ja=w;c.J=t.length/3;return c}};b4w.module.__prerender=function(a,r){var b=r("__config"),c=r("__debug"),d=r("__geometry"),e=r("vec3"),l=r("__util"),g=b.u,p="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT SHADOW_CAST DEPTH GLOW_MASK WIREFRAME".split(" ");a.ey=function(a){if(-1<p.indexOf(a.type)){for(var b=!1,h=a.o,f=0;f<h.length;f++){var t=h[f],u=t,w=a,s=u.Wa,B=w.k;u.K=!0;if(s)if(s.Qi)u.K=!1;else if("GLOW_MASK"!=w.type||Boolean(u.h.Ld)){var q=B.Jd,y=s.Cd.F,D=s.wf,q=Math.sqrt((y[0]-q[0])*(y[0]-q[0])+(y[1]-q[1])*(y[1]-q[1])+(y[2]-q[2])*(y[2]-
q[2]));q>=Math.max(0,s.dh-0)&&q<D?(B=B.Lk,s.Bi?s=!1:"STATIC"===s.type?(D=s.Cd,s=D.F,s=l.Cz(s,B,D.sa)):(D=s.lk,s=D.F,s=l.av(s,B,D.vd,D.wd,D.xd)),s?u.K=!1:"WIREFRAME"==w.type&&(u.K=u.h.Lj==c.Om.WM_DEBUG_SPHERES?u.h.Ak:!u.h.Ak)):u.K=!1}else u.K=!1;else u.K=!1;t.K&&(b=!0)}switch(a.type){case "WIREFRAME":break;default:a.K="MAIN_OPAQUE"===a.type||"DEPTH"===a.type||b?!0:!1}}if("MAIN_BLEND"==a.type&&(b=a.k.Jd,e.dist(b,a.Mj)>g.ck&&g.bk&&a.o)){for(h=0;h<a.o.length;h++)t=a.o[h],u=t.h,f=t.Wa.G,u&&u.O&&u.Lc!=
d.tc&&(u=u.fc)&&t.K&&(t=u.Zk)&&t.type==d.Pm&&d.fA(u,f,b);a.Mj[0]=b[0];a.Mj[1]=b[1];a.Mj[2]=b[2]}}};b4w.module.__print=function(a){var r=!1;a.jz=function(a){r=a};a.log=function(){r&&console.log.apply(console,arguments)};a.error=function(){r&&console.error.apply(console,arguments)};a.warn=function(){r&&console.warn.apply(console,arguments)};a.time=function(){r&&console.time.apply(console,arguments)};a.timeEnd=function(){r&&console.timeEnd.apply(console,arguments)};a.group=function(){r&&console.group.apply(console,arguments)};a.groupCollapsed=function(){r&&console.groupCollapsed.apply(console,arguments)};
a.groupEnd=function(){r&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,r){function b(a,b,c){u?p.warn("WARNING "+String(c)+" for "+String(a)+' "'+b.name+'" undefined, reexport '+(b.library?"library "+d(b):"main scene")):w=!0}function c(a,b,c){u?p.warn('B4W Warning: "'+String(c)+'" for '+String(a)+' "'+b.name+'" is deprecated, reexport '+(b.library?'library "'+d(b)+'"':"main scene.")):w=!0}function d(a){return a.library.split("/").slice(-1)[0]}function e(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=
null;var f=n.kf(a);a.materials=c;a.submeshes=d;f.name=b;f.materials=a.materials.slice(0);f.submeshes=[];for(c=0;c<d.length;c++){var e=n.mi(d[c]);f.submeshes.push(e)}return f}var l=r("__boundings"),g=r("__curve"),p=r("__print"),n=r("__util"),k=r("vec3"),h=r("vec4"),f=r("quat"),t=r("mat4"),u=!0,w=!1;a.ft=function(a){var f=a.worlds;if(0==f.length){u?p.warn("WARNING Datablock world is missing, reexport scene"):w=!0;var e={name:"DEFAULT",horizon_color:[0,0,0],zenith_color:[0,0,0],light_settings:{use_environment_light:!1,
environment_energy:1,environment_color:"PLAIN"},b4w_fog_color:[0.5,0.5,0.5],b4w_fog_density:0};f.push(e)}for(var f=a.worlds,g=0;g<f.length;g++){var e=f[g],h=e.b4w_ssao_settings;"dist_factor"in h||(b("world",e,"b4w_ssao_settings.dist_factor"),h.dist_factor=0,h.samples=16);"b4w_glow_color"in e||(e.b4w_glow_color=new Float32Array(3),e.b4w_glow_color=[1,1,1],b("object",e,"b4w_glow_color"));"b4w_glow_factor"in e||(e.b4w_glow_factor=1,b("object",e,"b4w_glow_factor"));"b4w_fog_density"in e||(b("world",e,
"b4w_fog_density"),e.b4w_fog_density=0);"b4w_sky_settings"in e&&"rayleigh_brightness"in e.b4w_sky_settings||(b("world",e,"rayleigh_brightness"),e.b4w_sky_settings={color:[0.24,0.43,0.75],rayleigh_brightness:3.3,mie_brightness:0.1,spot_brightness:10,scatter_strength:0.2,rayleigh_strength:0.2,mie_strength:0.006,rayleigh_collection_power:0.5,mie_collection_power:0.5,mie_distribution:0.4});"b4w_bloom_settings"in e?("blur"in e.b4w_bloom_settings||(b("world",e,"b4w_bloom_settings.blur"),e.b4w_bloom_settings.blur=
4),"edge_lum"in e.b4w_bloom_settings||(b("world",e,"b4w_bloom_settings.edge_lum"),e.b4w_bloom_settings.edge_lum=1)):(b("world",e,"b4w_bloom_settings"),e.b4w_bloom_settings={key:0.2,blur:4});"b4w_motion_blur_settings"in e?("motion_blur_factor"in e.b4w_motion_blur_settings||(b("world",e,"b4w_motion_blur_settings.motion_blur_factor"),e.b4w_motion_blur_settings.motion_blur_factor=0.01),"motion_blur_decay_threshold"in e.b4w_motion_blur_settings||(b("world",e,"b4w_motion_blur_settings.motion_blur_decay_threshold"),
e.b4w_motion_blur_settings.motion_blur_decay_threshold=0.01)):(b("world",e,"b4w_motion_blur_settings"),e.b4w_motion_blur_settings={motion_blur_factor:0.01,motion_blur_decay_threshold:0.01});"b4w_color_correction_settings"in e||(b("world",e,"b4w_color_correction_settings"),e.b4w_color_correction_settings={brightness:0,contrast:0,exposure:1,saturation:1});"steps_per_pass"in e.b4w_god_rays_settings||(b("world",e,"b4w_god_rays_settings.steps_per_pass"),e.b4w_god_rays_settings.steps_per_pass=10)}f=a.scenes;
for(g=0;g<f.length;g++)e=f[g],"b4w_detect_collisions"in e&&(c("scene",e,"b4w_detect_collisions"),delete e.b4w_detect_collisions),"audio_doppler_speed"in e||(e.audio_doppler_speed=343.3),"audio_doppler_factor"in e||(e.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in e||(e.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:0.003,release:0.25},b("scene",e,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in e||(e.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in
e||(e.b4w_enable_bloom=!1,b("scene",e,"b4w_enable_bloom")),"b4w_enable_motion_blur"in e||(e.b4w_enable_motion_blur=!1,b("scene",e,"b4w_enable_motion_blur")),"b4w_enable_color_correction"in e||(e.b4w_enable_color_correction=!1,b("scene",e,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in e||(e.b4w_enable_antialiasing=!0,b("scene",e,"b4w_enable_antialiasing"));f=a.meshes;for(g=0;g<f.length;g++)e=f[g],e.b4w_bounding_box||(b("mesh",e,"b4w_bounding_box"),e.b4w_bounding_box={max_x:0,max_y:0,max_z:0,
min_x:0,min_y:0,min_z:0}),e.uv_textures||(b("mesh",e,"uv_textures"),e.uv_textures=[]),e.b4w_bounding_sphere_center||(e.b4w_bounding_sphere_center=[0,0,0]),e.b4w_bounding_cylinder_center||(e.b4w_bounding_cylinder_center=[0,0,0]),e.b4w_bounding_ellipsoid_center||(e.b4w_bounding_ellipsoid_center=[0,0,0]),e.b4w_bounding_ellipsoid_axes||(h=e.b4w_bounding_box,e.b4w_bounding_ellipsoid_axes=[(h.max_x-h.min_x)/2,(h.max_y-h.min_y)/2,(h.max_z-h.min_z)/2]);f=a.cameras;for(g=0;g<f.length;g++)e=f[g],e.type||(e.type=
"PERSP",b("camera",e,"type")),"b4w_eye_target_dist"in e&&(delete e.b4w_eye_target_dist,c("camera",e,"b4w_eye_target_dist")),"b4w_use_distance_limits"in e||(e.b4w_use_distance_limits=!1,b("camera",e,"b4w_use_distance_limits")),"b4w_distance_min"in e||(e.b4w_distance_min=1,b("camera",e,"b4w_distance_min")),"b4w_distance_max"in e||(e.b4w_distance_max=100,b("camera",e,"b4w_distance_max")),"b4w_use_vertical_clamping"in e||(e.b4w_use_vertical_clamping=!1,b("camera",e,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in
e||(e.b4w_rotation_down_limit=Math.PI/2,b("camera",e,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in e||(e.b4w_rotation_up_limit=Math.PI/2,b("camera",e,"b4w_rotation_up_limit"));f=a.lamps;for(g=0;g<f.length;g++)e=f[g],"b4w_generate_shadows"in e||(e.b4w_generate_shadows=!1,b("lamp",e,"b4w_generate_shadows")),"b4w_dynamic_intensity"in e||(e.b4w_dynamic_intensity=!1,b("lamp",e,"b4w_dynamic_intensity"));f=a.speakers;for(g=0;g<f.length;g++)e=f[g],"b4w_behavior"in e||(e.b4w_behavior=e.b4w_background_music?
"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in e||(e.b4w_disable_doppler=!1),"b4w_delay"in e||(e.b4w_delay=0),"b4w_delay_random"in e||(e.b4w_delay_random=0),"b4w_volume_random"in e||(e.b4w_volume_random=0),"b4w_pitch_random"in e||(e.b4w_pitch_random=0),"b4w_fade_in"in e||(e.b4w_fade_in=0),"b4w_fade_out"in e||(e.b4w_fade_out=0),"b4w_loop"in e||(e.b4w_loop=!1),"b4w_loop_count"in e||(e.b4w_loop_count=0),"b4w_loop_count_random"in e||(e.b4w_loop_count_random=0),"b4w_playlist_id"in e||(e.b4w_playlist_id=
"");f=a.textures;for(g=0;g<f.length;g++)e=f[g],"b4w_anisotropic_filtering"in e||(e.b4w_anisotropic_filtering="OFF",b("texture",e,"b4w_anisotropic_filtering")),"b4w_water_foam"in e||(e.b4w_water_foam=!1,b("texture",e,"b4w_water_foam")),"b4w_foam_uv_freq"in e||(e.b4w_foam_uv_freq=0,b("texture",e,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in e||(e.b4w_foam_uv_magnitude=0,b("texture",e,"b4w_foam_uv_magnitude")),"b4w_foam_uv_magnitude"in e||(e.b4w_foam_uv_magnitude=0,b("texture",e,"b4w_foam_uv_magnitude")),
"b4w_affect_foam"in e||(e.b4w_affect_foam=!1,b("texture",e,"b4w_affect_foam")),"b4w_parallax_steps"in e||(e.b4w_parallax_steps=5,b("material",e,"b4w_parallax_steps")),"b4w_shore_dist_map"in e||(e.b4w_shore_dist_map=!1,b("texture",e,"b4w_shore_dist_map")),"b4w_shore_boundings"in e||(e.b4w_shore_boundings=new Float32Array(4),e.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",e,"b4w_shore_boundings")),"b4w_max_shore_dist"in e||(e.b4w_max_shore_dist=100,b("texture",e,"b4w_max_shore_dist"));e=a.materials;
for(g=0;g<e.length;g++)for(f=e[g],("b4w_node_mat_type"in f)&&c("material",f,"b4w_node_mat_type"),f.b4w_water&&("b4w_water_shore_smoothing"in f||(f.b4w_water_shore_smoothing=!1,b("material",f,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in f||(f.b4w_water_dynamic=!1,b("material",f,"b4w_water_dynamic")),"b4w_waves_height"in f||(f.b4w_waves_height=1,b("material",f,"b4w_waves_height")),"b4w_waves_length"in f||(f.b4w_waves_length=1,b("material",f,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in
f||(f.b4w_water_dst_noise_scale0=0.05,b("material",f,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in f||(f.b4w_water_dst_noise_scale1=0.03,b("material",f,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in f||(f.b4w_water_dst_noise_freq0=1.3,b("material",f,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in f||(f.b4w_water_dst_noise_freq1=1,b("material",f,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in f||(f.b4w_water_dir_min_shore_fac=0.4,b("material",
f,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in f||(f.b4w_water_dir_freq=0.5,b("material",f,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in f||(f.b4w_water_dir_noise_scale=0.05,b("material",f,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in f||(f.b4w_water_dir_noise_freq=0.07,b("material",f,"b4w_water_dir_noise_freq")),"b4w_water_dir_min_noise_fac"in f||(f.b4w_water_dir_min_noise_fac=0.5,b("material",f,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in f||(f.b4w_water_dst_min_fac=
0.2,b("material",f,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in f||(f.b4w_water_waves_hor_fac=5,b("material",f,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in f||(f.b4w_water_absorb_factor=6,b("material",f,"b4w_water_absorb_factor")),"b4w_water_fog_color"in f||(f.b4w_water_fog_color=new Float32Array(3),f.b4w_water_fog_color=[0.5,0.7,0.7],b("material",f,"b4w_water_fog_color")),"b4w_foam_factor"in f||(f.b4w_foam_factor=5,b("material",f,"b4w_foam_factor")),"b4w_generated_mesh"in f||
(f.b4w_generated_mesh=!1,b("material",f,"b4w_generated_mesh")),"b4w_water_num_cascads"in f||(f.b4w_water_num_cascads=5,b("material",f,"b4w_water_num_cascads")),"b4w_water_subdivs"in f||(f.b4w_water_subdivs=64,b("material",f,"b4w_water_subdivs")),"b4w_water_detailed_dist"in f||(f.b4w_water_detailed_dist=1E3,b("material",f,"b4w_water_detailed_dist"))),("b4w_dynamic_grass_size"in f)||(f.b4w_dynamic_grass_size=""),("b4w_dynamic_grass_color"in f)||(f.b4w_dynamic_grass_color=""),("diffuse_intensity"in f)||
(f.diffuse_intensity=1,b("material",f,"diffuse_intensity")),("b4w_procedural_skydome"in f)||(f.b4w_procedural_skydome=!1,b("material",f,"b4w_procedural_skydome")),("b4w_use_ghost"in f)||(f.b4w_use_ghost=!1),("b4w_collision_group"in f)||(f.b4w_collision_group=128,b("material",f,"b4w_collision_group")),("b4w_collision_mask"in f)||(f.b4w_collision_mask=127,b("material",f,"b4w_collision_mask")),"HALO"!=f.type||("b4w_halo_sky_stars"in f)||(f.b4w_halo_sky_stars=!1,b("material",f,"b4w_halo_sky_stars")),
"HALO"!=f.type||("b4w_halo_stars_blend_height"in f)||(f.b4w_halo_stars_blend_height=10,b("material",f,"b4w_halo_stars_blend_height")),"HALO"!=f.type||("b4w_halo_stars_min_height"in f)||(f.b4w_halo_stars_min_height=0,b("material",f,"b4w_halo_stars_min_height")),("specular_shader"in f)||(f.specular_shader="COOKTORR",b("material",f,"specular_shader")),("diffuse_shader"in f)||(f.diffuse_shader="LAMBERT",b("material",f,"diffuse_shader")),("roughness"in f)||(f.roughness=0.5,b("material",f,"roughness")),
("diffuse_fresnel"in f)||(f.diffuse_fresnel=0.1,b("material",f,"diffuse_fresnel")),("diffuse_fresnel_factor"in f)||(f.diffuse_fresnel_factor=0.5,b("material",f,"diffuse_fresnel_factor")),("specular_slope"in f)||(f.specular_slope=0.2,b("material",f,"specular_slope")),("b4w_wettable"in f)||(f.b4w_wettable=!1,b("material",f,"b4w_wettable")),("b4w_shallow_water_col"in f)||(f.b4w_shallow_water_col=[0,0.8,0.3],b("material",f,"b4w_shallow_water_col")),("b4w_shore_water_col"in f)||(f.b4w_shore_water_col=
[0,0.9,0.2],b("material",f,"b4w_shore_water_col")),("b4w_shallow_water_col_fac"in f)||(f.b4w_shallow_water_col_fac=1,b("material",f,"b4w_shallow_water_col_fac")),("b4w_shore_water_col_fac"in f)||(f.b4w_shore_water_col_fac=0.5,b("material",f,"b4w_shore_water_col_fac")),("b4w_water_sss_strength"in f)||(f.b4w_water_sss_strength=5.9,b("material",f,"b4w_water_sss_strength")),("b4w_water_sss_width"in f)||(f.b4w_water_sss_width=0.45,b("material",f,"b4w_water_sss_width")),h=f.texture_slots,f=0;f<h.length;f++){var k=
h[f];"blend_type"in k||(k.blend_type="MIX",b("texture_slot",k,"blend_type"))}a=a.objects;for(g=0;g<a.length;g++){e=a[g];switch(e.type){case "MESH":"b4w_reflexible"in e||(e.b4w_reflexible=!1);"b4w_reflexible_only"in e||(e.b4w_reflexible_only=!1);"b4w_reflective"in e||(e.b4w_reflective=!1);"b4w_wind_bending"in e||(e.b4w_wind_bending=!1,b("object",e,"b4w_wind_bending"));"b4w_wind_bending_angle"in e||(e.b4w_wind_bending_angle=10,e.b4w_wind_bending_freq=0.25,b("object",e,"wind bending params"));"b4w_detail_bending_amp"in
e||(e.b4w_detail_bending_amp=0.1,e.b4w_branch_bending_amp=0.3,b("object",e,"detail bending params"));"b4w_detail_bending_freq"in e||(e.b4w_detail_bending_freq=1,b("object",e,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in e||(e.b4w_main_bend_stiffness_col="",b("object",e,"b4w_main_bend_stiffness_col"));"b4w_detail_bend_colors"in e||(e.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",e,"b4w_detail_bend_colors"));"b4w_caustics"in e||
(e.b4w_caustics=!1);"vertex_groups"in e&&e.vertex_groups.length&&e.data&&0==e.data.vertex_groups.length&&(e.data.vertex_groups=e.vertex_groups,delete e.vertex_groups,b("object",e,"vertex_groups"));"b4w_vertex_anim"in e&&e.b4w_vertex_anim.length&&e.data&&0==e.data.b4w_vertex_anim.length&&(e.data.b4w_vertex_anim=e.b4w_vertex_anim,delete e.b4w_vertex_anim,b("object",e,"b4w_vertex_anim"));"b4w_do_not_render"in e||(e.b4w_do_not_render=!1);"b4w_character_settings"in e||(e.b4w_character_settings={walk_speed:4,
run_speed:8,step_height:0.25,jump_strength:5,waterline:0},b("object",e,"b4w_character_settings"));"waterline"in e.b4w_character_settings||(e.b4w_character_settings.waterline=0);"use_ghost"in e.game||(e.game.use_ghost=!1);"use_sleep"in e.game||(e.game.use_sleep=!1);"velocity_min"in e.game||(e.game.velocity_min=0);"velocity_max"in e.game||(e.game.velocity_max=0);"collision_group"in e.game||(e.game.collision_group=1);"collision_mask"in e.game||(e.game.collision_mask=255);"steering_ratio"in e.b4w_vehicle_settings||
(e.b4w_vehicle_settings.steering_ratio=10);"steering_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.steering_max=1);"force_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.force_max=1500);"brake_max"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.brake_max=100);"speed_ratio"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.speed_ratio=0.027);"max_speed_angle"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.max_speed_angle=Math.PI);"delta_tach_angle"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.delta_tach_angle=
4.43);"suspension_compression"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_compression=4.4);"suspension_stiffness"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_stiffness=20);"suspension_damping"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.suspension_damping=2.3);"wheel_friction"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.wheel_friction=1E3);"roll_influence"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.roll_influence=0.1);"max_suspension_travel_cm"in
e.b4w_vehicle_settings||(e.b4w_vehicle_settings.max_suspension_travel_cm=30);"floating_factor"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.floating_factor=3);"floating_factor"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.floating_factor=3);"water_lin_damp"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.water_lin_damp=0.9);"water_rot_damp"in e.b4w_vehicle_settings||(e.b4w_vehicle_settings.water_rot_damp=0.9);"b4w_floating_settings"in e||(e.b4w_floating_settings={},e.b4w_floating_settings.floating_factor=
3,e.b4w_floating_settings.water_lin_damp=0.8,e.b4w_floating_settings.water_rot_damp=0.8,b("object",e,"b4w_floating_settings"));"b4w_selectable"in e||(e.b4w_selectable=!1,b("object",e,"b4w_selectable"));"b4w_glow_settings"in e||(e.b4w_glow_settings={},e.b4w_glow_settings.glow_duration=1,e.b4w_glow_settings.glow_period=1,e.b4w_glow_settings.glow_relapses=0,b("object",e,"b4w_glow_settings"));"b4w_lods_num"in e||(e.b4w_lods_num=0,b("object",e,"b4w_lods_num"));break;case "EMPTY":"b4w_group_relative"in
e||(e.b4w_group_relative=!1,b("object",e,"b4w_group_relative"))}"webgl_do_not_batch"in e&&(e.b4w_do_not_batch=e.webgl_do_not_batch)&&c("object",e,"webgl_do_not_batch");"b4w_shadow_cast_only"in e||(e.b4w_shadow_cast_only=!1,b("object",e,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in e||(e.b4w_correct_bounding_offset="AUTO",b("object",e,"b4w_correct_bounding_offset"));h=e.particle_systems;for(f=0;f<h.length;f++){var k=h[f],n=k.settings;"use_whole_group"in n||(n.use_whole_group=!1,b("object",
n,"use_whole_group"));k.transforms||(k.transforms=new Float32Array,b("particle_system",k,"transforms"));"b4w_billboard_align"in n||(n.b4w_billboard_align="VIEW",b("particle_settings",n,"b4w_billboard_align"));"b4w_dynamic_grass"in n||(n.b4w_dynamic_grass=!1,b("object",n,"b4w_dynamic_grass"));"b4w_initial_rand_rotation"in n||(n.b4w_initial_rand_rotation=!1,b("particle_settings",n,"b4w_initial_rand_rotation"));"b4w_rotation_type"in n||(n.b4w_rotation_type="Z",b("particle_settings",n,"b4w_rotation_type"));
"b4w_rand_rotation_strength"in n||(n.b4w_rand_rotation_strength=1,b("particle_settings",n,"b4w_rand_rotation_strength"));"b4w_hair_billboard"in n||(n.b4w_hair_billboard=!1,b("particle_settings",n,"b4w_hair_billboard"));"b4w_hair_billboard_type"in n||(n.b4w_hair_billboard_type="BASIC",b("particle_settings",n,"b4w_hair_billboard_type"));"b4w_hair_billboard_jitter_amp"in n||(n.b4w_hair_billboard_jitter_amp=0,b("particle_settings",n,"b4w_hair_billboard_jitter_amp"));"b4w_hair_billboard_jitter_freq"in
n||(n.b4w_hair_billboard_jitter_freq=0,b("particle_settings",n,"b4w_hair_billboard_jitter_freq"));"b4w_hair_billboard_geometry"in n||(n.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",n,"b4w_hair_billboard_geometry"));"b4w_wind_bend_inheritance"in n||(n.b4w_wind_bend_inheritance="PARENT",b("particle_settings",n,"b4w_wind_bend_inheritance"));"b4w_shadow_inheritance"in n||(n.b4w_shadow_inheritance="PARENT",b("particle_settings",n,"b4w_shadow_inheritance"));"b4w_reflection_inheritance"in
n||(n.b4w_reflection_inheritance="PARENT",b("particle_settings",n,"b4w_reflection_inheritance"));"b4w_vcol_from_name"in n||(n.b4w_vcol_from_name="",b("particle_settings",n,"b4w_vcol_from_name"));"b4w_vcol_to_name"in n||(n.b4w_vcol_to_name="",b("particle_settings",n,"b4w_vcol_to_name"))}"constraints"in e||(e.constraints=[],b("object",e,"constraints"));h=e.modifiers;for(f=0;f<h.length;f++){a:{k=h[f];switch(k.type){case "ARRAY":if(!("fit_type"in k)){u?p.error("WARNING Incomplete modifier "+String(k.type)+
' for "'+e.name+'", reexport '+(e.library?"library"+d(e):"main scene")):w=!0;k=!1;break a}}k=!0}k||(h.splice(f,1),f--)}"b4w_collision_id"in e||(e.b4w_collision_id="",b("material",e,"b4w_collision_id"));f=e.scale;h=Math.abs((f[1]-f[2])/f[1]);0.001>Math.abs((f[0]-f[1])/f[0])&&0.001>h||(u?p.warn("B4W Warning: non-uniform scale for object "+e.name):w=!0)}w&&p.error("Compatibility issues detected")};a.ts=function(a){var b;a:{b=a.modifiers;for(var c=0;c<b.length;c++){var d=b[c].type;if("ARRAY"==d||"CURVE"==
d){b=!0;break a}}b=!1}if(!b)return null;b=e(a.data,a.data.name+"_MOD");a=a.modifiers;for(c=0;c<a.length;c++){var p=a[c];switch(p.type){case "ARRAY":for(var d=b,u=p,w=0,r=0,x=0,L=new Float32Array(16),p=[],R=1;R<u.count;R++){u.use_constant_offset&&(w+=u.constant_offset_displace[0],r+=u.constant_offset_displace[1],x+=u.constant_offset_displace[2]);if(u.use_relative_offset)var I=d.b4w_bounding_box,w=w+(I.max_x-I.min_x)*u.relative_offset_displace[0],r=r+(I.max_y-I.min_y)*u.relative_offset_displace[1],
x=x+(I.max_z-I.min_z)*u.relative_offset_displace[2];n.Vz(w,r,x,L);for(var Q=I=e(d),H=L,K=0;K<Q.submeshes.length;K++){var S=Q.submeshes[K];n.Me(S.position,H,S.position,0);n.jm(S.normal,H,S.normal);n.Rz(S.tangent,H,S.tangent)}p.push(I)}for(R=0;R<p.length;R++)for(u=d,w=p[R],r=0;r<u.submeshes.length;r++){x=u.submeshes[r];L=w.submeshes[r];I=x.base_length;Q=x.indices.length;x.base_length+=L.base_length;for(var P in x)if("base_length"!=P)if("indices"==P)for(x[P]=n.Zz(x[P],L[P]),H=Q;H<x.indices.length;H++)x.indices[H]+=
I;else x[P]=n.lv(x[P],L[P])}break;case "CURVE":for(var d=b,R=p.object.bs,u=new Float32Array(16),r=R.Od?4:3,w=new Float32Array(r),r=new Float32Array(r),x=new Float32Array(3),L=new Float32Array(4),I=new Float32Array(4),Q=new Float32Array(3),H=new Float32Array(3),K=new Float32Array(3),S=new Float32Array(4),O=new Float32Array(4),T=0;T<d.submeshes.length;T++){var m=d.submeshes[T],F=m.position,C=m.normal,m=m.tangent,X;a:switch(X=p.deform_axis,X){case "POS_X":case "NEG_X":X=0;break a;case "POS_Y":case "NEG_Y":X=
1;break a;case "POS_Z":case "NEG_Z":X=2;break a;default:throw"Wrong deform axis value "+X;}Q[0]=0;Q[1]=0;Q[2]=0;Q[X]=1;for(var Z=g.Fz(R),V=0;V<F.length/3;V++){K[0]=F[3*V];K[1]=F[3*V+1];K[2]=F[3*V+2];var v=K[X],ka=g.Ez(R,v);g.Gz(R,ka,w);x[0]=w[0];x[1]=w[1];x[2]=w[2];g.Dz(R,ka,r);H[0]=r[0];H[1]=0;H[2]=r[2];k.normalize(H,H);f.rotationTo(Q,H,L);0>v?(w[0]=H[0],w[1]=H[1],w[2]=H[2],k.scale(w,v,w),k.add(x,w,x)):v>Z&&(w[0]=H[0],w[1]=H[1],w[2]=H[2],k.scale(w,v-Z,w),k.add(x,w,x));t.fromRotationTranslation(L,
x,u);R.Od&&(f.setAxisAngle(Q,w[3],I),k.transformQuat(K,I,K));K[X]=0;k.transformMat4(K,u,K);F[3*V]=K[0];F[3*V+1]=K[1];F[3*V+2]=K[2];C.length&&(S[0]=C[3*V],S[1]=C[3*V+1],S[2]=C[3*V+2],S[3]=0,h.transformMat4(S,u,S),C[3*V]=S[0],C[3*V+1]=S[1],C[3*V+2]=S[2]);m.length&&(O[0]=m[3*V],O[1]=m[3*V+1],O[2]=m[3*V+2],O[3]=0,h.transformMat4(O,u,O),m[3*V]=O[0],m[3*V+1]=O[1],m[3*V+2]=O[2])}}}l.ry(b)}return b};a.sB=function(){return{name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[0.8,0.8,0.8],diffuse_intensity:1,
alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:0.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:0.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[0.5,0.5,0.5],b4w_water_fog_density:0.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,
b4w_terrain:!1,b4w_terrain_tex_type:"B4W_TERRAIN_NONE",b4w_skydome:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:0.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},node_tree:null,texture_slots:[]}}};b4w.module.__scenegraph=function(a,r){function b(a){a=ab.$a(a);a.Kd=null;a.Na=null;a.Tb=null;return a}function c(a,b){var c=[];N.Ze(a,function(b,d,f){-1<c.indexOf(f)?N.wy(a,b,d,f,l(f)):c.push(f)});N.U(a,function(b,d){for(var f=0;f<d.la.length;f++){var e=d.la[f];-1<c.indexOf(e)?d.la[f]=l(e):c.push(e)}"GLOW"==d.type&&N.pc(a,b,function(c,d,f){if("u_glow_src"==f.L)return N.Jc(a,b,function(b,d,f){d=l(f);d.aa=!1;d.L=f.L;d.Cf="GLOW_AROUND";N.Qc(a,c,b,d)}),!0});"ANTIALIASING"==d.type&&N.pc(a,b,function(a,
b){if("MOTION_BLUR"==b.type)for(var c=0;c<b.la.length;c++){var d=b.la[c];d.Aa=W.v;d.za=W.v}})});N.U(a,function(c){var f={};d(a,c,f);for(var m in f){c=f[m];if(b)for(var g=0;g<c.length;g++){var h=c[g];if("DEPTH"==h.t){if(e(h))throw"Failed to use renderbuffer as input texture: "+h.t+"->"+h.L;h.Wf=!0}}h=c[0];for(g=0;g<c.length;g++)if(c[g].Aa==W.v){h=c[g];break}for(var k=c[0],g=0;g<c.length;g++)if(c[g].za==W.v){k=c[g];break}for(var G=c[0],g=0;g<c.length;g++)if(!c[g].Wf){G=c[g];break}for(g=0;g<c.length;g++)c[g].Aa=
h.Aa,c[g].za=k.za,c[g].Wf=G.Wf}})}function d(a,b,c){N.pc(a,b,function(b,f,e){e.aa&&e.t==e.L&&(c[e.t]=c[e.t]||[],-1==c[e.t].indexOf(e)&&c[e.t].push(e),d(a,b,c))});N.Jc(a,b,function(a,b,d){d.aa&&(c[d.t]=c[d.t]||[],-1==c[d.t].indexOf(d)&&c[d.t].push(d))});b=N.Pa(a,b);if("MOTION_BLUR"==b.type)for(var f=0;f<b.la.length;f++){var e=b.la[f];c[e.t].push(e)}}function e(a){switch(a.L){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "NONE":return!1;default:return!0}}function l(a){if(a.na)throw"Failed to clone slink with attached texture";
return ab.kf(a)}function g(a){var b=N.vq(a),c=[];N.U(b,function(a,d){switch(d.type){case "MOTION_BLUR":var e=[];break;default:e=c}for(var m=0;m<d.la.length;m++){var g=d.la[m],G=f(e,g,n(g));g.na=G;d.Ic[m]=G}for(m=0;m<d.Ic.length;m++)G=d.Ic[m],h(e,G);"MOTION_BLUR"==d.type&&(e=[]);N.Jc(b,a,function(c,d,m){if((c=k(b,a,m.t))&&m.aa&&!m.na){if(m.t!=m.L){d=e;for(var g=c,h=0;h<d.length;h++){var G=d[h];G.Zl===g&&G.zh++}}}else c=f(e,m,n(m));m.na=c});N.pc(b,a,function(a,b,c){c.t!=c.L&&h(e,c.na)});N.Jc(b,a,function(a,
b,c){c.na&&"NONE"==c.L&&h(e,c.na)})})}function p(a){u(a,function(b,c,d){b.Uh&&la(a,d,"LANCZOS")&&"LANCZOS_Y"!=d.Zo&&(b.Ue*=ta.wb)})}function n(a){a=ab.kf(a);delete a.L;delete a.aa;return JSON.stringify(a)}function k(a,b,c){var d=null;N.pc(a,b,function(a,b,f){if(f.aa&&f.t==f.L&&f.t==c&&f.na)return d=f.na,!0});N.Jc(a,b,function(a,b,f){if(f.aa&&f.t==c&&f.na)return d=f.na,!0});return d}function h(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.Zl===b&&d.zh&&d.zh--}}function f(a,b,c){for(var d=null,f=0;f<
a.length;f++){var e=a[f];if(e.id==c&&0===e.zh){d=e;break}}if(d&&!Kb)return d.zh++,d.Zl;b=t(b);a.push({id:c,zh:1,Zl:b});return b}function t(a){var b=a.Ue*a.size;switch(a.t){case "COLOR":var c=W.si("COLOR",W.me);W.If(c,b,b);W.tj(c,a.Aa,a.za);return c;case "DEPTH":return a.Wf?(c=W.si("DEPTH_RBUF",W.ff),W.If(c,b,b)):(c=W.si("DEPTH_TEX",W.gg),W.If(c,b,b),W.tj(c,a.Aa,a.za)),c;case "CUBEMAP":return c=W.St(b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.t;}}function u(a,b){var c=!1;N.Ze(a,
function(d,f,e){if(e&&(d=N.Pa(a,d),f=N.Pa(a,f),b(e,!1,d,f)))return c=!0});c||N.U(a,function(a,c){for(var d=0;d<c.la.length;d++)if(b(c.la[d],!0,c,null))return!0})}function w(a){N.U(a,function(b,c){if("SINK"!=c.type){var d=c.k;N.Jc(a,b,function(a,b,c){c.aa&&c.na&&(ga.sj(d,c.t,c.na),c.t==c.L&&b.k&&ga.sj(b.k,c.t,c.na))});for(var f=0;f<c.la.length;f++){var e=c.la[f];e.aa&&e.t==e.L&&ga.sj(d,e.t,c.Ic[f])}!d.Na&&!d.Tb||d.Kd||(d.Kd=ya.Jp(d.Na,d.Tb))}})}function s(a){var b=B("SHADOW_CAST");b.H=!0;b.On=a;b.Pb=
new Float32Array(3);a=ga.eb(ga.ig);b.k=a;return b}function B(a){var b={};b.type=a;b.o=[];b.K=!0;b.H=!0;b.fa=!0;b.ia=!0;b.kb=!0;b.O=!1;b.ek=!1;b.jx=[];b.Ra=!0;b.la=[];b.Ic=[];b.ti=0;return b}function q(a,b,c,d,f){return{t:a,L:b,size:c,Ue:d,Uh:f,aa:!0,na:null,Wf:!1,Aa:W.sc,za:W.sc}}function y(){var a=B("GRASS_MAP");a.H=!0;var b=ga.eb(ga.hg);a.k=b;a.Lb=new Float32Array(3);return a}function D(a){var b=B("POSTPROCESSING");b.H=!0;b.fa=!1;b.ia=!1;b.kb=!1;var c=ga.eb(ga.Ya);b.k=c;b.oj=a;return b}function z(a){var b=
B("BLOOM_BLUR");b.H=!0;b.fa=!1;b.ia=!1;b.kb=!1;var c=ga.eb(ga.Ya);b.k=c;b.oj=a;return b}function E(a,b,c,d,f,e,m){var g=B("MAIN_"+a);g.H=!0;if("OPAQUE"===a&&c)g.fa=!0,g.ia=!1,g.O=!1;else if("OPAQUE"===a)g.fa=!0,g.ia=!0,g.O=!1;else if("BLEND"===a&&c)g.fa=!1,g.ia=!1,g.O=!0;else if("BLEND"===a)g.fa=!0,g.ia=!0,g.O=!0;else if("REFLECT"===a)g.fa=!0,g.ia=!0,g.O=!1;else throw"wrong main subscene type";"BLEND"==a&&(g.Mj=new Float32Array([0,0,0]));g.k=b;g.Ac=new Float32Array(m.Ac);g.Kc=new Float32Array(m.Kc);
g.Id=m.Id;g.Cb=e;g.Pb=new Float32Array(3);d?(g.Ea=d,d.Cb?(g.yb=new Float32Array(4),Ua.copy(d.Cb,g.yb)):g.yb=null,g.bf=d.Kj,g.bg=d.qm,g.af=d.af,d.li?(g.jf=1,g.tn=d.li,g.un=d.sk,g.sn=d.rk):g.jf=0,d.od?(g.nd=new Float32Array(2),g.Fc=new Float32Array(2),a=d.sz,g.nd[0]=(a[0]+a[1])/2,g.nd[1]=(a[2]+a[3])/2,g.Fc[0]=a[0]-a[1],g.Fc[1]=a[2]-a[3],g.Mf=d.Mf,g.od=d.od,g.fh=d.fh):(g.nd=null,g.Fc=null,g.Mf=null,g.od=null)):g.Ea=null;g.mh=0;g.Yg=new Float32Array(3*f);g.ah=new Float32Array(3*f);g.Xg=new Float32Array(3*
f);g.Zg=new Float32Array(4*f);g.$g=new Float32Array(4*f);g.Qh=new Float32Array(4);g.Ph=new Float32Array(3);g.Ye=new Float32Array(3);return g}function M(a){var b=B("COLOR_PICKING");b.H=!1;b.k=a;b.Pb=new Float32Array(3);return b}function x(a){var b=B("WIREFRAME");b.K=!1;b.fa=!1;b.ia=!1;b.k=a;return b}function L(a,b){var c=B("DEPTH");c.H=!0;c.k=a;c.Fl=b;c.Pb=new Float32Array(3);return c}function R(a,b,c,d,f){var e=B("BLUR_DEPTH");e.H=!0;e.fa=!1;e.ia=!1;e.kb=!1;e.k=a;e.orientation=b;e.qg=c;e.pg=d;e.og=
f;return e}function I(a){var b=B("DEPTH_PACK");b.H=!0;b.fa=!1;b.ia=!1;b.k=a;return b}function Q(a,b,c){var d=B("SSAO");d.H=!0;d.fa=!1;d.ia=!1;d.kb=!1;d.k=a;d.Cb=b;d.yb=new Float32Array(4);Ua.copy(b,d.yb);d.Wl=c.ly;d.Rl=c.Su/1E3;d.Sl=c.vv;d.Ul=c.xv;d.Tl=c.wv;d.Vl=c.Pw;d.Ql=c.Pu;d.Kz=c.Ay;d.kq=0;return d}function H(){var a=B("ANTIALIASING");a.H=!0;a.fa=!1;a.ia=!1;a.kb=!1;var b=ga.eb(ga.Ya);a.k=b;return a}function K(a){var b=B("LANCZOS");b.H=!0;b.fa=!1;b.ia=!1;b.kb=!1;b.Zo=a;a=ga.eb(ga.Ya);b.k=a;return b}
function S(a,b,c,d){var f=B("COMPOSITING");f.H=!0;f.fa=!1;f.ia=!1;f.kb=!1;var e=ga.eb(ga.Ya);f.k=e;f.tg=a;f.Ag=b;f.Ng=c;f.Ch=d;return f}function P(a,b){var c=B("MOTION_BLUR");c.H=!0;c.fa=!1;c.ia=!1;c.kb=!1;var d=ga.eb(ga.Ya);c.k=d;c.ek=!0;c.ll=a;c.ml=b;return c}function O(a){var b=B("DOF");b.H=!0;b.fa=!1;b.ia=!1;b.kb=!1;b.k=a;return b}function T(a){var b=B("GLOW_MASK");b.k=a;b.Pb=new Float32Array(3);b.kb=!1;return b}function m(a){var b=B("GLOW");b.Ni=a.Ni;b.Vk=a.Vk;b.dv=5;b.Ms=3;b.kb=!1;a=ga.eb(ga.Ya);
b.k=a;return b}function F(){var a=B("REFRACT");a.H=!0;a.fa=!1;a.ia=!1;a.kb=!1;var b=ga.eb(ga.Ya);a.k=b;return a}function C(a,b,c,d,f,e,m){var g=B("GOD_RAYS");g.H=!0;g.fa=!1;g.ia=!1;g.kb=!1;g.Ac=new Float32Array([1,1,1]);g.Kc=new Float32Array([1,1,1]);g.Id=1;g.Xx=d;g.ag=b;g.zl=f;g.eh=c;g.Oh=m;g.k=a;g.mh=e;g.Yg=new Float32Array(3*e);g.ah=new Float32Array(3*e);g.Xg=new Float32Array(3*e);g.Zg=new Float32Array(4*e);g.$g=new Float32Array(4*e);g.Qh=new Float32Array(4);g.Ph=new Float32Array(3);g.Ye=new Float32Array(3);
g.Pb=new Float32Array(3);return g}function X(a){var b=B("GOD_RAYS_COMBINE");b.H=!0;b.fa=!1;b.ia=!1;b.kb=!1;var c=ga.eb(ga.Ya);b.k=c;b.Wk=a;return b}function Z(a,b){var c=B("SKY");c.H=!1;c.fa=!1;c.ia=!1;c.kb=!1;var d=ga.eb(ga.Ya);d.width=Ub;d.height=Ub;c.k=d;c.Au=ab.Dv();c.mh=a;c.Yg=new Float32Array(3*a);c.ah=new Float32Array(3*a);c.Xg=new Float32Array(3*a);c.Zg=new Float32Array(4*a);c.$g=new Float32Array(4*a);c.Qh=new Float32Array(4);c.Ph=new Float32Array(3);c.Ye=new Float32Array(3);c.Ac=new Float32Array([1,
1,1]);c.Kc=new Float32Array([1,1,1]);c.Id=1;c.Jh=new Float32Array(b.Jh);c.wh=b.wh;c.gh=b.gh;c.Mh=b.Mh;c.Dh=b.Dh;c.yh=b.yh;c.jh=b.jh;c.xh=b.xh;c.hh=b.hh;c.ih=b.ih;c.dj=!1;c.Uc=new Float32Array(16);return c}function V(){var a=B("SCREEN");a.H=!0;a.fa=!1;a.ia=!1;var b=ga.eb(ga.Ya);a.k=b;return a}function v(){var a=B("ANAGLYPH");a.H=!0;a.fa=!1;a.ia=!1;var b=ga.eb(ga.Ya);a.k=b;return a}function ka(){var a=B("LUMINANCE");a.H=!0;a.fa=!1;a.ia=!1;var b=ga.eb(ga.Ya);a.k=b;return a}function ea(){var a=B("AVERAGE_LUMINANCE");
a.H=!0;a.fa=!1;a.ia=!1;var b=ga.eb(ga.Ya);a.k=b;return a}function J(a,b,c,d){var f=B("LUMINANCE_TRUNCED");f.H=!0;f.fa=!1;f.ia=!1;f.nk=a;f.mk=b;f.k=d;f.mh=0;f.Yg=new Float32Array(3*c);f.ah=new Float32Array(3*c);f.Xg=new Float32Array(3*c);f.Zg=new Float32Array(4*c);f.$g=new Float32Array(4*c);f.Qh=new Float32Array(4);f.Ph=new Float32Array(3);f.Ye=new Float32Array(3);f.Ac=new Float32Array(3);f.Kc=new Float32Array(3);f.Id=0;return f}function ma(a){var b=B("BLOOM");b.H=!0;b.fa=!1;b.ia=!1;var c=ga.eb(ga.Ya);
b.k=c;b.mn=a;return b}function ja(){var a=B("SINK");a.H=!1;return a}function la(a,b,c){if(b.type===c)return!0;b=fa(a,b);for(var d=0;d<b.length;d++)if(la(a,b[d],c))return!0;return!1}function da(a,b,c){if(b.type===c)return!0;b=aa(a,b);for(var d=0;d<b.length;d++)if(da(a,b[d],c))return!0;return!1}function G(a,b,c){if(b.type===c)return b;b=aa(a,b);for(var d=0;d<b.length;d++){var f=G(a,b[d],c);if(f)return f}return null}function aa(a,b){var c=N.kh(a,b);if(c==N.Im)throw"Subscene not in graph";for(var d=[],
f=N.Oo(a,c),e=0;e<f;e++){var m=N.ye(a,c,e);m!=c&&d.push(N.Pa(a,m))}return d}function fa(a,b){var c=N.kh(a,b);if(c==N.Im)throw"Subscene not in graph";for(var d=[],f=N.Je(a,c),e=0;e<f;e++){var m=N.ze(a,c,e);m!=c&&d.push(N.Pa(a,m))}return d}function oa(a){var b=[],c=[];u(a,function(a){a.na&&-1==b.indexOf(a.na)&&(b.push(a.na),c.push(a.na,b.length-1))});return c}function ba(a,b){var c;c=""+(a.t+"\\n");c+="NONE"!=a.L?a.L+"\\n":"";c+="(";if(a.Uh){var d=a.Ue;Math.round(d)!=d&&(d=d.toFixed(2));d=(1==d?"":
d)+"S";c+=d+"x"+d}else c+=a.size+"x"+a.size;if("SCREEN"!=a.t){c+=" ";if(a.Wf)c+="RR";else{var d=a.Aa,f=a.za,e="";d==W.v?e+="L":d==W.sc&&(e+="N");f==W.v?e+="L":f==W.sc&&(e+="N");c+=e}for(d=0;d<b.length;d+=2)b[d]==a.na&&(c+=" "+b[d+1])}return c+")\\n"}var ga=r("__camera"),ha=r("__config"),Fa=r("__debug"),N=r("__graph"),ya=r("__renderer"),W=r("__textures"),ab=r("__util"),Ua=r("vec4"),ta=ha.u,Va=ha.Jf,Kb=!1,Ub=384;a.ku=function(a,d){var f=N.create(),e=a.ea[0],m=d.dl,h=d.um,k=d.Cb,G=E("OPAQUE",e,!1,d.Ea,
m,k,h);N.q(f,G);k=E("BLEND",e,!0,null,m,k,h);N.q(f,k);N.l(f,G,k,q("SCREEN","NONE",1,1,!0));h=ja();N.q(f,h);ta.cg?(e=x(e),N.q(f,e),N.l(f,k,e,q("SCREEN","NONE",1,1,!0)),N.l(f,e,h,q("SCREEN","NONE",1,1,!0))):N.l(f,k,h,q("SCREEN","NONE",1,1,!0));d.Fh&&(e=b(G.k),a.ea.push(e),G=M(e),N.q(f,G),N.l(f,G,h,q("COLOR","NONE",1,1,!0)),N.l(f,G,h,q("DEPTH","NONE",1,1,!0)));d.Ef&&(m=Z(m,d.Kl),N.q(f,m),N.l(f,m,h,q("CUBEMAP","u_sky",Ub,1,!1)));c(f,!0);1<ta.wb&&p(f);g(f);w(f);return f};a.mt=e;a.Xz=u;a.ju=function(a,
d,f){var e=N.create(),h=[],k=[],G=[],n=[],l=[],u=[],t=[],aa=[],fa=[],B=[],r=[],ba=d.dl,oa=d.Ea,la=d.uy,ua=d.de,uc=d.Md,Lb=d.Zd,Ya=d.sy,vc=d.zd,Mb=d.Qd,ha=d.Ed,da=d.ec,ya=d.um,Vb=d.Cb,Ua=d.Ih,tb=d.xx,bc=d.Ls,Za=d.$s,Kb=d.Aw,mc=d.xw;if(la){var wc=Ua.Dg;if(!wc)throw"Zero CSM sections is forbidden";for(var Y=0;Y<wc;Y++){var bb=s(Y);N.q(e,bb);B.push(bb);var Ra=Va.kd,qa=bb.k;qa.width=Ra;qa.height=Ra;bb.fa=!1;r.push(q("DEPTH","u_shadow_map"+Y,Ra,1,!1));Fa.wn()&&bb.la.push(q("COLOR","COLOR",Ra,1,!1))}}var Nb=
ta.of&&(0<f.Fd||f.Ig)?!0:!1,va=[];if(ta.di&&!a){var Eb=f.ea[0],dc=b(Eb);ga.hp(Eb,ga.pb);ga.hp(dc,ga.zb);va.push(Eb,dc);f.ea.push(dc)}else qa=f.ea[0],va.push(qa);if(0<Ya.length&&!a)for(Y=0;Y<va.length;Y++){qa=b(va[Y]);f.ea.push(qa);var pa=E("REFLECT",qa,!1,oa,ba,Vb,ya);pa.vb=Ya[0];pa.k.vb=Ya[0];N.q(e,pa);u.push(pa);t.push(q("COLOR","u_reflectmap",1,ta.Ff,!0));pa.la.push(q("DEPTH","DEPTH",1,ta.Ff,!0))}h=[];k=[];if(d.ta){var Ka=y();N.q(e,Ka);Ra=Va.tf;Ka.k.width=Ra;Ka.k.height=Ra;var fb=q("DEPTH","u_grass_map_depth",
Ra,1,!1);fb.Aa=W.v;fb.za=W.v;var na=q("COLOR","u_grass_map_color",Ra,1,!1);na.Aa=W.v;na.za=W.v}else na=fb=Ka=null;for(Y=0;Y<va.length;Y++){var qa=va[Y],La=b(qa),Fb=Ua.vA;f.ea.push(La);if(la){var wa=L(La,Fb);N.q(e,wa);for(var Sa=0;Sa<B.length;Sa++){var bb=B[Sa],Ob=r[Sa];N.l(e,bb,wa,Ob)}var ec=q("COLOR","u_color",1,1,!0),Wb=q("DEPTH","u_depth",1,1,!0);if(ua){var ub=b(qa);f.ea.push(ub);var Xb=Q(ub,Vb,d.lq);N.q(e,Xb);var Yb=q("COLOR","u_color",1,1,!0);N.l(e,wa,Xb,ec);N.l(e,wa,Xb,Wb)}var Pb=b(qa);f.ea.push(Pb);
var nc=b(qa);f.ea.push(nc);var oc=Ua.qg,vb=Ua.pg,mb=Ua.og,Qb=R(Pb,"X",oc,vb,mb);N.q(e,Qb);var $a=q("COLOR","u_color",1,1,!0);ua?N.l(e,Xb,Qb,Yb):N.l(e,wa,Qb,ec);N.l(e,wa,Qb,Wb);var nb=R(nc,"Y",oc,vb,mb);N.q(e,nb);N.l(e,Qb,nb,$a);N.l(e,wa,nb,Wb);var gb=q("COLOR","u_shadow_mask",1,1,!0),wb=b(La);f.ea.push(wb);var Ia=I(wb);N.q(e,Ia);N.l(e,wa,Ia,q("DEPTH","u_depth",1,1,!0));G.push(Ia);var A=q("DEPTH","DEPTH",1,1,!0);l.push(A)}else wa=L(La,Fb),N.q(e,wa),A=q("DEPTH","DEPTH",1,1,!0),l.push(A),Fa.wn()&&wa.la.push(q("COLOR",
"COLOR",1,1,!0)),wb=b(La),f.ea.push(wb),Ia=I(wb),N.q(e,Ia),N.l(e,wa,Ia,q("DEPTH","u_depth",1,1,!0)),G.push(Ia);Ka&&(N.l(e,Ka,wa,fb),N.l(e,Ka,wa,na));pa=E("OPAQUE",qa,!0,oa,ba,Vb,ya);N.q(e,pa);k.push(pa);N.l(e,wa,pa,l[Y]);nb&&N.l(e,nb,pa,gb);var Xa=q("COLOR","u_color",1,1,!0);n.push(q("COLOR","COLOR",1,1,!0));Ka&&(N.l(e,Ka,pa,fb),N.l(e,Ka,pa,na));u.length&&(N.l(e,u[Y],pa,t[Y]),pa.vb=Ya[0])}h=k;k=[];if(!a&&d.Fh){qa=b(h[0].k);f.ea.push(qa);var ia=M(qa);N.q(e,ia)}else ia=null;if(Lb&&!a)for(Y=0;Y<va.length;Y++){var Ga=
F();N.q(e,Ga);N.l(e,h[Y],Ga,Xa);aa.push(Ga);fa.push(q("COLOR","u_refractmap",1,1,!0))}for(var sa=[],Y=0;Y<va.length;Y++){wa=G[Y];qa=b(va[Y]);f.ea.push(qa);pa=E("BLEND",qa,!0,oa,ba,Vb,ya);k.push(pa);N.q(e,pa);N.l(e,h[Y],pa,n[Y]);N.l(e,h[Y],pa,l[Y]);Ka&&(N.l(e,Ka,pa,fb),N.l(e,Ka,pa,na));for(Sa=0;Sa<B.length;Sa++)bb=B[Sa],Ob=r[Sa],N.l(e,bb,pa,Ob);if("DEPTH_PACK"==wa.type){var U=q("COLOR","u_shore_depth",1,1,!0);U.Aa=W.sc;U.za=W.sc}else U=q("DEPTH","u_shore_depth",1,1,!0),U.Aa=W.v,U.za=W.v;N.l(e,wa,pa,
U);u.length&&(N.l(e,u[Y],pa,t[Y]),pa.vb=Ya[0]);aa.length&&N.l(e,aa[Y],pa,fa[Y]);sa.push(pa)}h=k;k=[];if(ta.cg){for(Y=0;Y<va.length;Y++){qa=ab.$a(va[Y]);f.ea.push(qa);var ra=x(qa);k.push(ra);N.q(e,ra);N.l(e,h[Y],ra,n[Y]);N.l(e,h[Y],ra,l[Y]);Ka&&(N.l(e,Ka,ra,fb),N.l(e,Ka,ra,na))}h=k;k=[]}if(uc&&!a){for(Y=0;Y<va.length;Y++){var cb=Kb.eh,Zb=Kb.Uw,ob=Kb.Oh,Ba=h[Y],Gb=oa?1:0,xb=q("DEPTH","u_input",1,1,!0);xb.Aa=W.v;xb.za=W.v;var Hb=q("COLOR","u_input",1,0.25,!0);Hb.Aa=W.v;Hb.za=W.sc;var yb=cb/ob,pb=b(va[Y]);
f.ea.push(pb);var za=C(pb,Gb,cb,!0,yb,ba,ob);N.q(e,za);N.l(e,Ba,za,xb);var yb=0.5*(cb/ob),Ca=b(va[Y]);f.ea.push(Ca);var Ma=C(Ca,Gb,cb,!1,yb,ba,ob);N.q(e,Ma);N.l(e,za,Ma,Hb);var yb=0.25*(cb/ob),fc=b(va[Y]);f.ea.push(fc);var Ib=C(fc,Gb,cb,!1,yb,ba,ob);N.q(e,Ib);N.l(e,Ma,Ib,Hb);u.length&&(za.vb=Ya[0],Ma.vb=Ya[0],Ib.vb=Ya[0]);var qb=X(Zb);k.push(qb);N.q(e,qb);N.l(e,Ba,qb,q("COLOR","u_main",1,1,!0));N.l(e,Ib,qb,q("COLOR","u_god_rays",1,1,!0))}h=k;k=[]}if(vc&&!a){for(Y=0;Y<va.length;Y++){var Ba=h[Y],db=
ka();N.q(e,db);N.l(e,Ba,db,q("COLOR","u_input",1,1,!0));var zb=ea();N.q(e,zb);zb.k.width=Ra;zb.k.height=Ra;var xc=q("COLOR","u_input",1,0.25,!0);xc.Aa=W.v;xc.za=W.v;var hb=q("COLOR","u_luminance",1,0.25,!0);hb.Aa=W.v;hb.za=W.v;N.l(e,db,zb,xc);var Ab=bc.key,Lc=bc.Yu,ib=b(va[Y]);f.ea.push(ib);var gc=J(Ab,Lc,ba,ib);N.q(e,gc);N.l(e,Ba,gc,q("COLOR","u_main",1,1,!0));N.l(e,db,gc,hb);N.l(e,zb,gc,q("COLOR","u_average_lum",1,1,!1));var Bb=q("COLOR","u_color",1,0.25,!0);Bb.Aa=W.v;Bb.za=W.v;var pc=z("X_BLUR");
N.q(e,pc);N.l(e,gc,pc,Bb);var yc=z("Y_BLUR");N.q(e,yc);N.l(e,pc,yc,Bb);var eb=ma(bc.blur);N.q(e,eb);N.l(e,yc,eb,q("COLOR","u_bloom",1,0.25,!0));N.l(e,Ba,eb,q("COLOR","u_main",1,1,!0));k.push(eb)}h=k;k=[]}if(Mb&&!a){for(Y=0;Y<h.length;Y++){var qc=h[Y],rc=P(tb.ll,tb.ml);k.push(rc);N.q(e,rc);N.l(e,qc,rc,q("COLOR","u_mb_tex_curr",1,1,!0));rc.la.push(q("COLOR","u_mb_tex_accum",1,1,!0))}h=k;k=[]}if(Nb&&!a){for(Y=0;Y<h.length;Y++){var Ba=h[Y],Ta=b(va[Y]);f.ea.push(Ta);Bb=q("COLOR","u_color",1,1,!0);Bb.Aa=
W.v;Bb.za=W.v;var Rb=D("X_BLUR");N.q(e,Rb);N.l(e,Ba,Rb,Bb);var hc=D("Y_BLUR");N.q(e,hc);N.l(e,Rb,hc,Bb);var wa=sa[Y],Hc=O(Ta);Ta.Fd=f.Fd;Ta.Ig=f.Ig;Ta.Hg=f.Hg;Ta.Jg=f.Jg;Ta.Gd=f.Gd;Ta.Dk=1;k.push(Hc);N.q(e,Hc);N.l(e,Ba,Hc,q("COLOR","u_sharp",1,1,!0));N.l(e,hc,Hc,q("COLOR","u_blurred",1,1,!0));N.l(e,wa,Hc,q("DEPTH","u_depth",1,1,!0))}h=k;k=[]}if(!a&&d.Fh){for(Y=0;Y<va.length;Y++){var Ba=h[Y],Mc=b(va[Y]);f.ea.push(Mc);var Tc=T(Mc);N.q(e,Tc);var Ic=D("X_EXTEND"),ca=q("COLOR","u_color",1,1,!0),Ha=q("COLOR",
"u_glow_mask",1,1,!0);Ic.Tg=!0;N.q(e,Ic);N.l(e,Tc,Ic,ca);var Nc=q("COLOR","u_color",1,0.5,!0);Nc.Aa=W.v;Nc.za=W.v;var $b=D("Y_EXTEND");$b.Tg=!0;N.q(e,$b);N.l(e,Ic,$b,Nc);Rb=D("X_BLUR");Rb.Tg=!0;N.q(e,Rb);N.l(e,$b,Rb,Nc);var xa=q("COLOR","u_color",1,0.25,!0);xa.Aa=W.v;xa.za=W.v;var Na=q("COLOR","u_glow_mask_blurred",1,0.25,!0);Na.Aa=W.v;Na.za=W.v;hc=D("Y_BLUR");hc.Tg=!0;N.q(e,hc);N.l(e,Rb,hc,xa);var Jc=m(mc);N.q(e,Jc);N.l(e,Ba,Jc,q("COLOR","u_glow_src",1,1,!0));N.l(e,Tc,Jc,Ha);N.l(e,hc,Jc,Na);k.push(Jc)}h=
k;k=[]}if(ha&&!a){for(Y=0;Y<h.length;Y++){var Ba=h[Y],Wa=S(Za.tg,Za.Ag,Za.Ng,Za.Ch);N.q(e,Wa);N.l(e,Ba,Wa,q("COLOR","u_color",1,1,!0));k.push(Wa)}h=k;k=[]}if(da&&!a){for(Y=0;Y<h.length;Y++)if(Ba=h[Y],ta.Ve||1<ta.wb){var zc=q("COLOR","u_color",1,1,!0);zc.Aa=W.v;zc.za=W.v;var ic=K("LANCZOS_X");N.q(e,ic);N.l(e,Ba,ic,zc);var Ac=q("COLOR","u_color",1,1,!0);Ac.Aa=W.v;Ac.za=W.v;var jc=K("LANCZOS_Y");N.q(e,jc);N.l(e,ic,jc,Ac);k.push(jc)}else{var Bc=H();N.q(e,Bc);var kc=q("COLOR","u_color",1,1,!0);kc.Aa=W.v;
kc.za=W.v;N.l(e,Ba,Bc,kc);k.push(Bc)}h=k;k=[]}if(ta.di&&!a){var Oc=v();N.q(e,Oc);N.l(e,h[0],Oc,q("COLOR","u_sampler_left",1,1,!0));N.l(e,h[1],Oc,q("COLOR","u_sampler_right",1,1,!0));k.push(Oc)}else k.push(h[0]);var Wc=N.kh(e,h[0]),Sb=!1;N.pc(e,Wc,function(a,b,c){if(c.t==c.L)return Sb=!0});if(Sb||a){var Cc=V();N.q(e,Cc);N.l(e,h[0],Cc,q("COLOR","u_color",1,1,!0));h=k;k=[];k.push(Cc)}ia&&k.push(ia);if(!a&&d.Ef){var Uc=Z(ba,d.Kl);N.q(e,Uc);k.push(Uc)}var Dc=ja();N.q(e,Dc);for(Y=0;Y<k.length;Y++)switch(k[Y].type){case "COLOR_PICKING":N.l(e,
k[Y],Dc,q("COLOR","NONE",1,1,!0));N.l(e,k[Y],Dc,q("DEPTH","NONE",1,1,!0));break;case "SKY":N.l(e,Uc,Dc,q("CUBEMAP","u_sky",Ub,1,!1));break;default:N.l(e,k[Y],Dc,q("SCREEN","NONE",1,1,!0))}for(var Ec=N.zo(e),Y=0;Y<Ec.length;Y++)for(var Yc=Ec[Y],Sa=0;Sa<G.length;Sa++)wa=G[Sa],N.Pa(e,Yc)==wa&&N.Hf(e,Yc);c(e,!1);1<ta.wb&&p(e);g(e);w(e);return e};a.FB=function(a){var b=null;N.U(a,function(a,c){return c.k&&null===c.k.Kd?(b=c,!0):!1});return b};a.bb=function(a,b,c){a=aa(a,b);for(b=0;b<a.length;b++)if(a[b].type===
c)return a[b];return null};a.aC=la;a.Mw=da;a.kv=G;a.ro=aa;a.TB=fa;a.Oa=function(a,b){var c=null;N.U(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.Cu=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=oa(a);N.U(a,function(a,d){var f=b+="    ",e="",e=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type?e+=" ("+d.oj.replace(/_/g," ")+")":"BLUR_DEPTH"==d.type&&(e+=" ("+d.orientation+
")");if(d.k){for(var e=e+"\\n",m=0;m<c.length;m+=2)c[m]==d.k.Na&&(e+="C"+c[m+1]+" ");for(m=0;m<c.length;m+=2)c[m]==d.k.Tb&&(e+="D"+c[m+1])}d.la.length&&(e+="\\n-----\\n");for(m=0;m<d.la.length;m++)e+=ba(d.la[m],c);m="SINK"==d.type?"dotted":d.H?"solid":"dashed";b=f+(String(a)+' [label="'+e+'" color="black" style="'+(m+",bold")+'"];\n')});N.Ze(a,function(a,d,f){b+="    ";b+=String(a)+" -> "+String(d)+' [label="'+ba(f,c)+'" style="'+(f.aa?"solid":"dotted")+'"];\n'});return b+="}"};a.Mn=function(a){a=
N.Sz(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.H&&b.push(d)}return b}};b4w.module.__textures=function(a,r){function b(a){f.texParameteri(a,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(a,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.texParameteri(a,f.TEXTURE_MAG_FILTER,f.NEAREST);f.texParameteri(a,f.TEXTURE_MIN_FILTER,f.NEAREST)}function c(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function d(b){switch(b.type){case a.me:b=f.RGBA;break;case a.Uj:b=f.RGB;break;case a.Zh:b=f.RGBA;break;case a.$h:b=f.RGB;break;
case a.gg:b=f.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function e(b){switch(b.type){case a.me:b=f.UNSIGNED_BYTE;break;case a.Uj:b=f.UNSIGNED_BYTE;break;case a.Zh:b=f.FLOAT;break;case a.$h:b=f.FLOAT;break;case a.gg:b=f.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}var l=r("__config"),g=r("__print"),p=r("__dds"),n=r("__extensions"),k=r("__util"),h=l.u;a.sc=0;a.v=0;a.Xr=0;a.Vr=0;a.Wr=0;a.Ur=0;a.me=10;a.Uj=20;a.Zh=30;a.$h=40;a.gg=50;a.ff=60;var f,t;a.mc=function(b){f=
b;t=[f.NEAREST_MIPMAP_NEAREST,f.NEAREST_MIPMAP_LINEAR,f.LINEAR_MIPMAP_NEAREST,f.LINEAR_MIPMAP_LINEAR];a.sc=f.NEAREST;a.v=f.LINEAR;a.Xr=f.NEAREST_MIPMAP_NEAREST;a.Vr=f.LINEAR_MIPMAP_NEAREST;a.Wr=f.NEAREST_MIPMAP_LINEAR;a.Ur=f.LINEAR_MIPMAP_LINEAR};a.si=function(b,c){var d={};d.name=b;d.type=c;d.source="NONE";d.width=0;d.height=0;d.yg=1;if(c==a.ff)d.Xh=f.createRenderbuffer();else{var e=f.TEXTURE_2D,g=f.createTexture();f.bindTexture(e,g);f.texParameteri(e,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(e,
f.TEXTURE_MIN_FILTER,f.LINEAR);f.texParameteri(e,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(e,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.bindTexture(e,null);d.xb=e;d.Ua=g}return d};a.St=function(b){var c=f.createTexture(),d=f.TEXTURE_CUBE_MAP;f.bindTexture(d,c);f.texParameteri(d,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(d,f.TEXTURE_MIN_FILTER,f.LINEAR);f.texParameteri(d,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(d,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);for(var e="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),
g=0;6>g;g++)f.texImage2D(f[e[g]],0,f.RGBA,b,b,0,f.RGBA,f.UNSIGNED_BYTE,null);f.bindTexture(d,null);d={name:"CUBEMAP"};d.type=a.me;d.source="NONE";d.width=3*b;d.height=2*b;d.yg=1;d.Ua=c;d.xb=f.TEXTURE_CUBE_MAP;return d};a.tj=function(b,c,d){if(b.type!=a.ff){var e=b.xb;f.bindTexture(e,b.Ua);c&&f.texParameteri(e,f.TEXTURE_MIN_FILTER,c);d&&f.texParameteri(e,f.TEXTURE_MAG_FILTER,d);f.bindTexture(e,null)}};a.RB=function(b){if(b.type==a.ff)return{min:a.sc,qx:a.sc};var c=b.xb;f.bindTexture(c,b.Ua);b=f.getTexParameter(c,
f.TEXTURE_MIN_FILTER);var d=f.getTexParameter(c,f.TEXTURE_MAG_FILTER);f.bindTexture(c,null);return{min:b,qx:d}};a.If=function(b,c,g){c=Math.max(c,1);g=Math.max(g,1);if(b.width!=c||b.height!=g){if(b.type==a.ff)f.bindRenderbuffer(f.RENDERBUFFER,b.Xh),f.renderbufferStorage(f.RENDERBUFFER,f.DEPTH_COMPONENT16,c,g),f.bindRenderbuffer(f.RENDERBUFFER,null);else{var h=b.xb;f.bindTexture(h,b.Ua);var k=d(b),n=e(b);f.texImage2D(h,0,k,c,g,0,k,n,null);f.bindTexture(h,null)}b.width=c;b.height=g}};a.su=function(b,
c,d){var e=b.type,l=new Uint8Array([204,204,204,255]),p={};switch(e){case "IMAGE":d=f.createTexture();var D=f.TEXTURE_2D;f.bindTexture(D,d);f.texImage2D(D,0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,l);break;case "NONE":if(b.b4w_render_scene)if(d=k.ic("name",b.b4w_render_scene,d))p.pp=d,d.Tm=!0,d=f.createTexture(),D=f.TEXTURE_2D,f.bindTexture(D,d),f.texImage2D(D,0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,l);else return;else return;break;case "ENVIRONMENT_MAP":d=f.createTexture();D=f.TEXTURE_CUBE_MAP;f.bindTexture(D,
d);for(var z="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" "),E=0;6>E;E++)f.texImage2D(f["TEXTURE_CUBE_MAP_"+z[E]],0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,l);break;case "VORONOI":case "BLEND":return;default:g.error('B4W warning: texture "'+b.name+'" has unsupported type "'+e+'"');return}"NONE"==e?f.texParameteri(D,f.TEXTURE_MIN_FILTER,f.LINEAR):f.texParameteri(D,f.TEXTURE_MIN_FILTER,t[h.Tf]);f.texParameteri(D,f.TEXTURE_MAG_FILTER,f.LINEAR);l=D;z=b.b4w_anisotropic_filtering;
"DEFAULT"===z&&(z=c);"OFF"!==z&&(c=n.Ov())&&(z=parseFloat(z.split("x")[0]),f.texParameterf(l,c.TEXTURE_MAX_ANISOTROPY_EXT,z));"REPEAT"==b.extension&&"NONE"!=e?(f.texParameteri(D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(D,f.TEXTURE_WRAP_T,f.REPEAT)):(f.texParameteri(D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE));f.generateMipmap(D);f.bindTexture(D,null);p.name=b.name;p.type=a.me;p.source=e;p.width=1;p.height=1;p.yg=1;p.Ua=d;p.xb=D;b.d=p};a.tu=function(){var b=
f.createTexture(),c=f.TEXTURE_2D;f.bindTexture(c,b);f.texParameteri(c,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(c,f.TEXTURE_MIN_FILTER,f.LINEAR);f.texParameteri(c,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(c,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.bindTexture(c,null);var d=document.createElement("canvas");d.width=1;d.height=1;var e=d.getContext("2d"),g={name:"HUD"};g.type=a.me;g.source="CANVAS";g.width=1;g.height=1;g.yg=1;g.Ua=b;g.xb=c;g.canvas=d;g.eB=e;return g};a.BC=function(a,b,c){if("CANVAS"!=
a.source)throw"Wrong texture";b=Math.max(b,1);c=Math.max(c,1);var g=a.canvas;g.width=b;g.height=c;if("CANVAS"!=a.source)throw"Wrong texture";b=a.xb;f.bindTexture(b,a.Ua);c=d(a);var g=e(a),h=a.canvas;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!0);f.texImage2D(b,0,c,c,g,h);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1);f.bindTexture(b,null);a.width=width;a.height=height};a.Hj=function(a,d,e,h){var k=a.source,l=a.xb;f.bindTexture(l,a.Ua);if(4==d.length){var t=!0;d=new Uint8Array([255*d[0],255*d[1],255*d[2],255*d[3]])}if("IMAGE"==
k)t?(f.texImage2D(l,0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,d),a.width=1,a.height=1):e?(p.nA(f,n.yo(),d,!0),e=p.Eo(d),c(e.width,e.height)&&(g.warn("B4W warning: using NPOT-texture",h),b(l)),a.width=e.width,a.height=e.height,a.yg=p.Vv(d)):(f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!0),f.texImage2D(l,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,d),a.width=d.width,a.height=d.height,c(d.width,d.height)?(g.warn("B4W warning: using NPOT-texture",h),b(l)):f.generateMipmap(l));else if("ENVIRONMENT_MAP"==k)if(e=[["POSITIVE_X",
2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],t){for(h=0;6>h;h++)t=e[h],f.texImage2D(f["TEXTURE_CUBE_MAP_"+t[0]],0,f.RGBA,1,1,0,f.RGBA,f.UNSIGNED_BYTE,d);a.width=3;a.height=2}else{if(c(d.width/3,d.height/2))throw"Warning: Wrong environment map dimensions "+h;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1);k=d.width/3;for(h=0;6>h;h++){var t=e[h],z=document.createElement("canvas");z.width=k;z.height=k;var E=z.getContext("2d");"POSITIVE_Y"==t[0]||"NEGATIVE_Y"==
t[0]?(E.translate(0,k),E.scale(1,-1)):(E.translate(k,0),E.scale(-1,1));E.drawImage(d,t[1]*k,t[2]*k,k,k,0,0,k,k);f.texImage2D(f["TEXTURE_CUBE_MAP_"+t[0]],0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,z)}a.width=3*k;a.height=2*k;f.generateMipmap(l)}f.bindTexture(l,null)};a.Ku=function(a){f.deleteTexture(a)};a.Vg=function(a){return a&&a.name&&(a.Ua||a.Xh)?!0:!1};a.Uo=function(a){return a&&a.name&&a.Xh?!0:!1};a.hC=function(b){return b.type==a.Zh||b.type==a.$h?!0:!1};a.qw=function(b){var c=0;switch(b.type){case a.me:case a.Uj:c=
4;break;case a.Zh:case a.$h:c=16;break;case a.gg:c=3;break;case a.ff:c=2}return c};a.Us=function(a){var b={},c;for(c in a)b[c]=a[c];delete b.pp;return JSON.stringify(b)}};b4w.module.__assets=function(a,r){function b(){return b4w.module_check(k.Db.ki)?r(k.Db.ki).data:null}function c(){var a={Wj:null,as:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:jb(),open:function(b,c){a.Wj=c;a.readyState=1},send:function(){a.status=404;
a.readyState=4;var c=b();c&&a.Wj in c&&(a.response=a.as(c[a.Wj]),a.status=200);if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function d(b){for(var c=0,d=0;d<b.length;d++){var f=b[d];f.state===s&&c++;if(c>=u.vx)break;if(f.state===w)switch(f.state=s,c++,f.type){case a.dg:e(f,"arraybuffer");break;case a.Qj:e(f,"json");break;case a.xm:e(f,"text");break;case a.Oj:l(f);break;case a.eg:g(f);break;case a.Pj:p(f);break;default:throw"Wrong asset type: "+f.type;
}}}function e(a,d){var e=b(),f=e&&a.w in e?new c:new XMLHttpRequest;f.open("GET",a.w,!0);"text"==d?(f.overrideMimeType("text/plain"),f.responseType="text"):"json"==d?(f.overrideMimeType("application/json"),f.responseType="text"):f.responseType=d;f.onreadystatechange=function(){if(4==f.readyState)if(200==f.status||0==f.status){var b=f.response;if(b){if("json"==d&&"string"==typeof b)try{b=JSON.parse(b)}catch(c){a.uc(null,a.uri,a.type,a.w);h.error(c+" (parsing JSON "+a.w+")");return}a.uc(b,a.uri,a.type,
a.w);a.state=B}else a.uc(null,a.uri,a.type,a.w),h.error("B4W Error: empty responce when trying to get "+a.w)}else a.uc(null,a.uri,a.type,a.w),h.error("B4W Error: "+f.status+" when trying to get "+a.w)};f.send(null)}function l(a){var d=b(),e=d&&a.w in d?new c:new XMLHttpRequest;e.open("GET",a.w,!0);e.responseType="arraybuffer";e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status||0==e.status){var b=e.response;b?f.Fu(b,function(b){a.uc(b,a.uri,a.type,a.w);a.state=B},function(){a.uc(null,
a.uri,a.type,a.w);h.error("B4W Error: failed to decode "+a.w)}):(a.uc(null,a.uri,a.type,a.w),h.error("B4W Error: empty responce when trying to get "+a.w))}else a.uc(null,a.uri,a.type,a.w),h.error("B4W Error: "+e.status+" when trying to get "+a.w)};e.send(null)}function g(a){var c=document.createElement("img");c.onload=function(){a.uc(c,a.uri,a.type,a.w);a.state=B};c.addEventListener("error",function(){h.error("B4W Error: could not load image: "+a.w)},!1);var d=b();c.src=d&&a.w in d?"data:image;base64,"+
d[a.w]:a.w}function p(a){var c=document.createElement("audio");c.addEventListener("loadeddata",function(){a.uc(c,a.uri,a.type,a.w);a.state=B},!1);c.addEventListener("error",function(){h.error("B4W Error: could not load sound: "+a.w)},!1);var d=b();if(d&&a.w in d){var e=n(a.w);c.src="data:"+e+";base64,"+d[a.w]}else c.src=a.w;setTimeout(function(){c.JC=1},5E3)}function n(a){var b="audio";switch(/(?:\.([^.]+))?$/.exec(a)[1]){case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "mp4":b+="/mp4"}return b}
var k=r("__config"),h=r("__print"),f=r("__sfx"),t=r("__version"),u=k.ud;a.dg=10;a.Qj=20;a.xm=30;a.Oj=40;a.eg=50;a.Pj=60;var w=10,s=20,B=30,q=[],y=0,D={};a.Pl=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.pw=function(a){if(D[a])return D[a];var b=u.Dp?a+t.timestamp():a,c=new XMLHttpRequest;c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return D[a]=b;throw"Error XHR: responce is empty, GET "+
a;}throw"Error XHR: "+c.status+", GET "+a;};a.pa=function(){q=[];y=0;D={}};a.H=function(a,c,e){for(var f=0;f<a.length;f++){var g=a[f],g={uri:g[0],type:g[1],w:g[2],name:g[3],state:w,uc:c||jb(),up:e||jb(),vp:y};if(u.Dp){var h=b();h&&g.w in h||(g.w+=t.timestamp())}q.push(g)}d(q);y++};a.update=function(){d(q);for(var a=q,b=0,c=!0,e=0;e<a.length;e++){var f=a[e];f.vp===a[b].vp?f.state!==B&&(c=!1):(c&&(a[e-1].up(),c=e-b,a.splice(b,c),e-=c),b=e,c=a[e].state===B?!0:!1);e===a.length-1&&c&&(a[e].up(),a.splice(b))}}};b4w.module.__loader=function(a,r){function b(b,d,e,g){var h=t.create(),k;for(k in b){var n=c(b[k]);e&&n.ub&&f(n);t.q(h,n)}for(k in b)for(n=b[k],n.name=k,e=0;e<n.X.length;e++)t.l(h,b[n.X[e]],n,null);b=c({name:"out",gb:a.Rq,jb:function(a,b,c,d,e){e(b,c);b.Bc=!0;g(a);u.log("%cLOADED CALLBACK",z)}});var l=[];if(d)for(d=t.zo(h),e=0;e<d.length;e++)l.push(t.Pa(h,d[e]));else t.U(h,function(a,b){b.rb||l.push(b)});t.q(h,b);for(e=0;e<l.length;e++)b.X.push(l[e].name),t.l(h,l[e],b,null);return h}function c(a){a.rb=
a.rb||!1;a.gb||0===a.gb||(a.gb=a.ef);a.X=a.X||[];a.Sg=a.Sg||!1;a.Jl=a.Jl||!1;a.Fb=a.Fb||0;a.ub=a.ub||!1;a.status=s;a.qC=0;a.gl=0;a.oe=a.oe||null;return a}function d(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];t.Pa(a.ee,f).Sg&&(t.Jc(a.ee,f,function(d){var e=!0;t.pc(a.ee,d,function(a,b){if(!b.Sg)return e=!1,1});e&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-1;0<=e;e--)b.splice(d[e],1);return c}function e(a){function b(c,d){var e=t.Pa(a.ee,c),f=t.Pa(a.ee,d),g=
f.gb-e.gb;0==g&&(g=e.rb-f.rb);return g}var c=[],e=a.Xe,f=!1;do{var g=d(a,e);c.push.apply(c,e);0<g.length&&(f=!0);e=g}while(0<g.length);f&&c.sort(b);a.Xe=c;return a.Xe.length}function l(a,b,c){if(b.Jl)return b.Sg=!0,D&&u.log("%cSKIP STAGE: "+b.name,z),!1;if(D&&b.status==s){var d=g(a);u.log("%c"+d+"% "+("LOADING START: "+b.name)+" "+Math.round(performance.now()-a.Rh)+"ms ",z)}if(!b.jb&&!b.vg&&!b.ug)return p(a,b),!1;if(b.status==s&&(b.status++,b.jb))return b.jb(c,a,b,b.oe,p,n),!0;if(b.status==B){if(b.vg)return b.vg(c,
a,b,b.oe,p,n),!0;b.status++}return b.status==q&&(b.status++,b.ug)?(b.ug(c,a,b,b.oe,p,n),!0):!1}function g(a){if(0==a.yj)return 100;var b=0;t.U(a.ee,function(c,d){a.te&&d.ub||(b+=d.gl*d.Fb)});return w.qc(100*b/a.yj)}function p(a,b){b.Sg=!0;b.status=y;if(D){var c=g(a);u.log("%c"+c+"% "+("LOADING END: "+b.name)+" "+Math.round(performance.now()-a.Rh)+"ms ",z)}k(a,b,1)}function n(a,b,c){1>c?k(a,b,c):b.status++}function k(a,b,c){if(b.jb||b.vg||b.ug)b.gl=c,b=g(a),a.Qn!=b&&(a.mq(b,performance.now()-a.Rh),
a.Qn=b)}function h(a,b){var c=null;t.U(a.ee,function(a,d){if(d.name==b)return c=d,1});return c}function f(a){a.Jl=!0;a.gl=1}var t=r("__graph"),u=r("__print"),w=r("__util"),s=0,B=1,q=2,y=3,D=!1,z="color: #f0f;";a.ef=0;a.je=1;a.Rq=2;a.lu=function(a,c,d,e,f,g,h){var k={w:c,dB:null,mq:e||jb(),wt:f||jb(),status:0,Bl:!1,Rh:0,Qn:0,yj:0,YC:g,Bc:!1};a=b(a,g,h,d||jb());k.ee=a;c=[];d=t.mw(a);for(e=0;e<d.length;e++)c.push(d[e]);k.Xe=c;t.U(a,function(a,b){!(b.jb||b.vg||b.ug)||k.te&&b.ub||(k.yj+=b.Fb)});return k};
a.lA=function(b,c){if(b){var d=performance.now();do{if(2==b.status)break;0==b.status&&(b.status=1,b.Rh=performance.now(),b.mq(0,0),D&&u.log("%c0% LOADING START 0ms",z));if(e(b)){var f=b,g=c,h=f.Xe.length;do{var k=t.Pa(f.ee,f.Xe[0]),n=l(f,k,g);k.gb==a.je&&(f.Bl=!0);k=f.Xe.shift();f.Xe.push(k);h--}while(!n&&0!=h)}else{b.wt(c,b);b.status=2;D&&u.log("%c100% LOADING END "+Math.round(performance.now()-b.Rh)+"ms",z);break}if(b.Bl){b.Bl=!1;break}}while(16>performance.now()-d)}};a.MC=n;a.WB=h;a.cq=function(a,
b){var c=h(a,b);null!==c&&f(c)};a.Bc=function(a){return a?a.Bc:!1}};b4w.module.__camera=function(a,r){function b(b){var c={Ue:1};c.type=b;c.Kd=null;c.Na=null;c.Tb=null;if(b==a.Ya)return c;c.Da=new Float32Array(16);c.ua=new Float32Array(16);c.Jd=new Float32Array(3);c.$n=new Float32Array(3);c.i=new Float32Array(4);c.Gc=new Float32Array(16);c.Zf=new Float32Array(16);c.Lk={left:[0,0,0,0],right:[0,0,0,0],top:[0,0,0,0],bottom:[0,0,0,0],lb:[0,0,0,0],ab:[0,0,0,0]};switch(b){case a.Oc:e(c,M,x,L);break;case a.gf:e(c,E,x,L);break;case a.hf:break;case a.hg:break;case a.ig:break;
case a.pb:case a.zb:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function c(b,c,d){if(b.type!=a.pb&&b.type!=a.zb)throw"set_stereo_params(): wrong camera type";b.zj=c;b.pd=d;p(b,b.ib)}function d(a,b){var c=a.d,d=w.Mb(c.i,w.sd,I),e=Math.asin(d[1]/s.length(d));if(0==d[0]&&0==d[2])c=0;else if(Math.abs(e)>Math.PI/4){var f=w.Mb(c.i,w.Rj,Q),c=Math.atan(Math.abs(f[0]/f[2]));0>=d[1]?(0>f[2]&&(c=Math.PI-c),0>f[0]&&(c=2*Math.PI-c)):(0<f[2]&&(c=Math.PI-
c),0<f[0]&&(c=2*Math.PI-c))}else c=Math.atan(Math.abs(d[0]/d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c);b[0]=c;b[1]=e;return b}function e(b,c,d,e,f){switch(b.type){case a.Oc:case a.pb:case a.zb:b.Zc=c;b.ib=1;break;case a.gf:b.top=c;b.ib=1;break;case a.hf:delete b.Zc;b.Zc=c;b.ib=f/c;break;case a.hg:b.top=c;b.ib=f/c;break;default:u.error("set_frustum(): Unsupported camera type: "+b.type)}b.lb=d;b.ab=e}function l(b,c){var d=c.d.e,e=c.d.i,f=O;D.rotateX(c.d.G,-Math.PI/2,f);D.invert(f,b.Da);if(b.vb){var f=
b.vb[0],g=b.vb[1],h=b.vb[2],k=b.vb[3],l=O;l[0]=1-2*f*f;l[1]=-2*f*g;l[2]=-2*f*h;l[3]=0;l[4]=-2*f*g;l[5]=1-2*g*g;l[6]=-2*g*h;l[7]=0;l[8]=-2*f*h;l[9]=-2*g*h;l[10]=1-2*h*h;l[11]=0;l[12]=-2*f*k;l[13]=-2*g*k;l[14]=-2*h*k;l[15]=1;D.multiply(b.Da,l,b.Da);p(b,b.ib,!0);f=K;g=O;D.invert(b.Da,g);D.transpose(g,g);B.transformMat4(b.vb,g,f);g=S;g[0]=(w.Te(f[0])+b.ua[8])/b.ua[0];g[1]=(w.Te(f[1])+b.ua[9])/b.ua[5];g[2]=-1;g[3]=(1+b.ua[10])/b.ua[14];B.scale(f,2/(f[0]*g[0]+f[1]*g[1]+f[2]*g[2]+f[3]*g[3]),f);b.ua[2]=f[0];
b.ua[6]=f[1];b.ua[10]=f[2]+1;b.ua[14]=f[3]}b.type==a.pb?b.Da[12]+=b.pd/2:b.type==a.zb&&(b.Da[12]-=b.pd/2);D.multiply(b.ua,b.Da,b.Zf);n(b);s.copy(b.Jd,b.$n);s.copy(d,b.Jd);q.copy(e,b.i)}function g(b,c,d,e){D.lookAt(c,d,e,b.Da);b.type==a.pb?b.Da[12]+=b.pd/2:b.type==a.zb&&(b.Da[12]-=b.pd/2);D.multiply(b.ua,b.Da,b.Zf);n(b);s.copy(c,b.Jd)}function p(b,c,d){switch(b.type){case a.Oc:if(!c)throw"No aspect ratio";b.ib=c;case a.hf:D.perspective(w.ky(b.Zc),b.ib,b.lb,b.ab,b.ua);break;case a.gf:if(!c)throw"No aspect ratio";
b.ib=c;case a.hg:c=b.top*b.ib;D.ortho(-c,c,-b.top,b.top,b.lb,b.ab,b.ua);break;case a.ig:D.ortho(b.left,b.right,b.bottom,b.top,b.lb,b.ab,b.ua);break;case a.pb:case a.zb:if(!c)throw"No aspect ratio";b.ib=c;var e=Math.tan(b.Zc*Math.PI/360);c=b.lb*e;var f=b.ib*b.zj*e;b.type==a.pb?(e=f-b.pd/2,f+=b.pd/2):(e=f+b.pd/2,f-=b.pd/2);e=-(b.lb/b.zj*e);f*=b.lb/b.zj;D.frustum(e,f,-c,c,b.lb,b.ab,b.ua);b.left=e;b.right=f;break;case a.Ya:return;default:throw"Wrong camera type: "+b.type;}d||(D.multiply(b.ua,b.Da,b.Zf),
n(b))}function n(a){D.copy(a.Da,a.Gc);a.Gc[12]=0;a.Gc[13]=0;a.Gc[14]=0;a.Gc[15]=1;D.multiply(a.ua,a.Gc,a.Gc);D.invert(a.Gc,a.Gc)}function k(a){return"CAMERA"===a.type?!0:!1}var h=r("__boundings"),f=r("__config"),t=r("__constraints"),u=r("__print"),w=r("__util"),s=r("vec3"),B=r("vec4"),q=r("quat"),y=r("mat3"),D=r("mat4"),z=f.controls;a.Ya=10;a.Oc=20;a.gf=30;a.hf=40;a.hg=50;a.ig=60;a.pb=70;a.zb=80;a.Hm=0;a.cr=1;a.ke=2;a.Sj=3;var E=2.5,M=40,x=0.1,L=1E3,R=new Float32Array(2),I=new Float32Array(3),Q=new Float32Array(3),
H=new Float32Array(4),K=new Float32Array(4),S=new Float32Array(4),P=new Float32Array(16),O=new Float32Array(16);a.Zs=function(c){var d=c.d,f=c.data;switch(f.type){case "PERSP":var g=b(a.Oc);if(f.angle_y)var h=180*(f.angle_y/Math.PI);e(g,h,f.clip_start,f.clip_end);break;case "ORTHO":g=b(a.gf),e(g,f.ortho_scale/2,f.clip_start,f.clip_end)}g.name=c.name;d.bm=z.Xs.slice();d.$z=!1;a:switch(f.b4w_move_style){case "STATIC":h=a.Hm;break a;case "TARGET":h=a.ke;break a;case "EYE":h=a.Sj;break a;default:throw"Unknown move style";
}d.yf=h;d.Fd=c.data.dof_distance;d.Ig=c.data.dof_object;d.Hg=c.data.b4w_dof_front;d.Jg=c.data.b4w_dof_rear;d.Gd=c.data.b4w_dof_power;d.ea=[g];d.oA=f.b4w_use_distance_limits;d.Ru=f.b4w_distance_min;d.Qu=f.b4w_distance_max;d.yf==a.ke?(d.Le=new Float32Array(3),g=new Float32Array(f.b4w_target),a.Vp(c,g)):d.Le=null;d.bc=null;d.yf!=a.ke&&d.yf!=a.Sj||!f.b4w_use_vertical_clamping||(d.bc={Kg:f.b4w_rotation_down_limit,Th:f.b4w_rotation_up_limit})};a.Vp=function(a,b){var c=a.d;s.copy(b,c.Le);c.oA?t.Ym(a,c.Le,
c.Ru,c.Qu):t.cn(a,c.Le)};a.eb=b;a.fB=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.Na);case "DEPTH":return Boolean(a.Tb);case "SCREEN":return!Boolean(a.Na)&&!Boolean(a.Tb);default:throw"Wrong attachment type: "+b;}};a.sj=function(a,b,c){switch(b){case "COLOR":case "CUBEMAP":a.Na=c;break;case "DEPTH":a.Tb=c;break;case "SCREEN":a.Na=null;a.Tb=null;break;default:throw"Wrong attachment type: "+b;}};a.PB=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.Na;case "DEPTH":return a.Tb;
case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.hp=function(b,d){if(b.type!=a.Oc||d!=a.pb&&d!=a.zb)throw"make_stereo(): wrong camera type";b.type=d;c(b,6,0.065)};a.hz=c;a.Lp=function(a,b){var c=a.d.i,d=I;d[0]=0;d[1]=1;d[2]=0;q.setAxisAngle(d,b,H);q.multiply(H,c,c)};a.EC=function(a,b){var c=a.d.i,d=I;d[0]=1;d[1]=0;d[2]=0;q.setAxisAngle(d,b,H);q.multiply(H,c,c)};a.DC=function(a,b){var c=a.d.i;q.invert(c,c);var d=I;d[0]=0;d[1]=0;d[2]=1;q.setAxisAngle(d,-b,H);q.multiply(H,c,c);
q.invert(c,c)};a.Dl=function(a,b){var c=a.d.i;q.invert(c,c);var d=I;d[0]=1;d[1]=0;d[2]=0;q.setAxisAngle(d,-b,H);q.multiply(H,c,c);q.invert(c,c)};a.Mv=d;a.Tp=e;a.Zy=function(b,c,d,e,f,g,h){switch(b.type){case a.ig:b.left=c;b.right=d;b.bottom=e;b.top=f;b.lb=g;b.ab=h;break;default:u.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.gw=function(a){return a.d.yf};a.HC=l;a.IC=g;a.Zp=function(a,b,c){var d=I;d[0]=0;d[1]=-1;d[2]=0;s.transformQuat(d,c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];
var e=Q;e[0]=0;e[1]=0;e[2]=-1;s.transformQuat(e,c,e);g(a,b,d,e)};a.FC=function(a,b,c){if("CAMERA"!=a.type)throw"Wrong camera object";a=a.d;a.e[0]=b[0];a.e[1]=b[1];a.e[2]=b[2];a.i[0]=c[0];a.i[1]=c[1];a.i[2]=c[2];a.i[3]=c[3]};a.iv=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];D.lookAt(a,b,c,O);D.invert(O,O);D.rotateX(O,Math.PI/2,O);y.fromMat4(O,P);w.ux(P,e)};a.Cq=function(a){var b=a.d.ea;if(!b)throw"Wrong object";for(var c=a.d,d=0;d<b.length;d++){var e=b[d];l(e,a);w.Zn(e.Zf,e.Lk);if(e.Ig)if(e.Dk){var f=
s.dist(c.e,e.Ig.location);e.Fd=f}else e.Fd=0}};a.nt=function(b){var c=b.d;if(null!==c.bc){var e=d(b,R),f=e[0],e=e[1],g=w.Mb(c.i,w.Rj,I),g=w.Te(g[1]);Math.abs(e)>Math.PI/4&&1==g&&(f+=Math.PI);var h=e;1==g&&(h=w.Te(e)*Math.PI-e);var k=!1;if(h<-c.bc.Kg){var n=-c.bc.Kg;n<-Math.PI/2&&(n=-Math.PI-n);var l=-g*(n-e);1==g&&c.bc.Kg<Math.PI/2&&(f+=Math.PI,l+=Math.PI-2*c.bc.Kg);k=!0}h>c.bc.Th&&(n=c.bc.Th,n>Math.PI/2&&(n=Math.PI-n),l=-g*(n-e),1==g&&c.bc.Th<Math.PI/2&&(f+=Math.PI,l-=Math.PI-2*c.bc.Th),k=!0);k&&
(c.yf==a.ke&&(e=Math.sin(f),f=Math.cos(f),g=Math.sin(n),n=Math.cos(n),c.e[0]-=b.wa.target[0],c.e[1]-=b.wa.target[1],c.e[2]-=b.wa.target[2],h=s.length(c.e),c.e[0]=n*e,c.e[1]=-g,c.e[2]=n*f,s.scale(c.e,h/s.length(c.e),c.e),c.e[0]+=b.wa.target[0],c.e[1]+=b.wa.target[1],c.e[2]+=b.wa.target[2]),b=s.transformQuat(w.zm,c.i,I),s.normalize(b,b),l=q.setAxisAngle(b,l,H),q.multiply(l,c.i,c.i))}};a.iC=function(b){switch(b.type){case a.Oc:case a.gf:case a.pb:case a.zb:return!0;default:return!1}};a.Nv=function(b){b=
b.d.ea[0];switch(b.type){case a.Oc:case a.hf:case a.pb:case a.zb:return Math.PI*b.Zc/180;default:return u.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.Kf=p;a.Ts=n;a.Yn=function(b,c,d,e){e||(e=new Float32Array(24));c||(c=b.lb);d||(d=b.ab);var f,g,h,k,n,l,p,q;switch(b.type){case a.Ya:throw"Extraction from NONE camera is not possible";case a.Oc:case a.hf:f=c*Math.tan(b.Zc*Math.PI/360);g=f*b.ib;k=-f;h=-g;n=d*Math.tan(b.Zc*Math.PI/360);l=n*b.ib;q=-n;p=-l;break;case a.gf:case a.hg:h=b.top*
b.ib;f=n=b.top;g=l=h;k=q=-b.top;h=p=-h;break;case a.ig:f=n=b.top;g=l=b.right;k=q=b.bottom;h=p=b.left;break;case a.pb:case a.zb:f=c*Math.tan(b.Zc*Math.PI/360);g=b.right;k=-f;h=b.left;p=d/c;n=f*p;l=g*p;q=k*p;p*=h;break;default:throw"Wrong camera type: "+b.type;}e[0]=h;e[1]=k;e[2]=-c;e[3]=g;e[4]=k;e[5]=-c;e[6]=g;e[7]=f;e[8]=-c;e[9]=h;e[10]=f;e[11]=-c;e[12]=p;e[13]=q;e[14]=-d;e[15]=p;e[16]=n;e[17]=-d;e[18]=l;e[19]=n;e[20]=-d;e[21]=l;e[22]=q;e[23]=-d;c=O;D.invert(b.Da,c);w.Me(e,c,e,0);return e};a.Cs=function(a){a=
a.d;var b=h.rd();b.R=-0.5;b.T=0.5;b.A=-0.5;b.D=0.5;b.ka=0;b.ga=1.8;a.Bb=b;a.Bd={F:[0,0,0],sa:0,sa:2};a.jk={sa:0.35,height:1.05,F:[0,0,0.725]}};a.$k=k;a.Wi=function(b){return k(b)&&b.d&&b.d.yf==a.ke?!0:!1}};b4w.module.__lights=function(a,r){function b(a){a.xg[0]=a.color[0]*a.qf;a.xg[1]=a.color[1]*a.qf;a.xg[2]=a.color[2]*a.qf}var c=r("__util"),d=r("vec3"),e=0;a.ix=function(a){var g={};g.direction=new Float32Array(3);d.normalize(g.direction,g.direction);g.color=new Float32Array(3);g.qf=1;g.xg=new Float32Array(3);b(g);g.distance=25;g.Iv=!1;g.index=e++;g.name=a.name;var p=a.data;g.type=p.type;var n=c.Mb(a.d.i,c.hb,[]);d.normalize(n,n);g.direction[0]=n[0];g.direction[1]=n[1];g.direction[2]=n[2];g.color[0]=
p.color[0];g.color[1]=p.color[1];g.color[2]=p.color[2];g.qf=p.energy;b(g);g.distance=p.distance;if("POINT"===g.type||"SPOT"===g.type)g.EB=p.falloff_type;"SPOT"===g.type&&(g.Iz=p.spot_size,g.Hz=p.spot_blend);g.Iv=p.b4w_generate_shadows;g.Xu=p.b4w_dynamic_intensity;a.dc=g};a.cz=function(a,c){a.color[0]=c[0];a.color[1]=c[1];a.color[2]=c[2];b(a)};a.Up=function(a,c){a.qf=c;b(a)};a.jA=function(a){if("LAMP"!=a.type)throw"Wrong light object";var b=a.dc;b&&c.Mb(a.d.i,c.hb,b.direction)};a.pa=function(){e=0}};b4w.module.__scenes=function(a,r){function b(){if(!Aa)throw"no active scene";return Aa}function c(a,b){b||(b="ALL");var c=[];d(a.objects,b,c);return c}function d(a,b,c){for(var e=0;e<a.length;e++){var f=a[e];"ALL"!=b&&b!=f.type||c.push(f);(f=f.dupli_group)&&d(f.objects,b,c)}}function e(a){var b=Q(a),c=[];a=R(a,"MESH");for(var d=0;d<b.length;d++){var e=b[d];if(e.b4w_water){for(var f={},m=0;m<a.length;m++)for(var g=a[m],h=g.data,k=h.materials,G=0;G<k.length;G++)k[G]==e&&(f.af=g.location[1]+h.submeshes[0].position[1]);
if(W.Vc)for(f.Cb=e.b4w_water_fog_color.slice(0),f.Cb.push(e.b4w_water_fog_density),e.b4w_water_dynamic?(f.pf=!0,f.Kj=e.b4w_waves_height,f.qm=e.b4w_waves_length,f.Hi=e.b4w_water_dst_noise_scale0,f.Ii=e.b4w_water_dst_noise_scale1,f.Fi=e.b4w_water_dst_noise_freq0,f.Gi=e.b4w_water_dst_noise_freq1,f.wi=e.b4w_water_dir_min_shore_fac,f.ui=e.b4w_water_dir_freq,f.yi=e.b4w_water_dir_noise_scale,f.xi=e.b4w_water_dir_noise_freq,f.vi=e.b4w_water_dir_min_noise_fac,f.Ei=e.b4w_water_dst_min_fac,f.pm=e.b4w_water_waves_hor_fac):
(f.pf=!1,f.Kj=0,f.qm=0),f.li=null,f.rk=null,f.sk=new Float32Array(2),f.od=null,e=e.texture_slots,m=0;m<e.length;m++)g=e[m].texture,"VORONOI"==g.type&&(f.li=g.noise_scale,f.sk=g.b4w_uv_velocity_trans,f.rk=g.noise_intensity),!0===g.b4w_shore_dist_map&&(f.od=g.image,f.Mf=g.image.size[0],f.sz=g.b4w_shore_boundings,f.fh=g.b4w_max_shore_dist);else f.Kj=0,f.qm=0,f.li=null,f.rk=null,f.sk=null,f.Cb=null,f.pf=!1;c.push(f)}}if(0<c.length){f=c[0];if(!f.pf)for(d=0;d<c.length;d++)c[d].pf&&(f=c[d]);return f}return null}
function l(a){a=R(a,"MESH");for(var b=0;b<a.length;b++)for(var c=a[b].data.materials,d=0;d<c.length;d++){var e=c[d];if(e.b4w_skydome&&e.b4w_procedural_skydome)return!0}return!1}function g(a){var b={};a=a.world.b4w_sky_settings;b.Jh=a.color;b.wh=a.rayleigh_brightness;b.gh=a.mie_brightness;b.Mh=a.spot_brightness;b.Dh=a.scatter_strength;b.yh=a.rayleigh_strength;b.jh=a.mie_strength;b.xh=a.rayleigh_collection_power;b.hh=a.mie_collection_power;b.ih=a.mie_distribution;return b}function p(a){var b={};a=a.world.b4w_ssao_settings;
b.ly=a.radius_increase;b.Su=a.dithering_amount;b.vv=a.gauss_center;b.xv=a.gauss_width*a.gauss_width;b.wv=a.gauss_width_left*a.gauss_width_left;b.Pw=a.influence;b.Pu=a.dist_factor;b.Ay=a.samples;return b}function n(a){var b=a.world,c=[0,0,0],d=[0,0,0],e=a.world.light_settings;if(e.use_environment_light)if("SKY_COLOR"==e.environment_color)c=a.world.horizon_color.slice(0),d=b.zenith_color.slice(0);else if("PLAIN"==e.environment_color)c=[1,1,1],d=[1,1,1];else throw"Unsupported world environment color"+
e.environment_color;a={};a.Id=e.environment_energy;a.Ac=c;a.Kc=d;return a}function k(a){a=R(a,"MESH");for(var b=0;b<a.length;b++)if(a[b].d.ae)return!0;return!1}function h(a,b,c){c=ja.kh(a,b);ja.pc(a,c,function(a,c,d){if(d.aa){switch(d.t){case "COLOR":case "CUBEMAP":a=c.k.Na;break;case "DEPTH":a=c.k.Tb;break;case "SCREEN":a=null;break;default:throw"Wrong slink";}switch(d.L){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:if(!a)throw"Connection of SCREEN is forbidden";
c=b.o;for(var e=0;e<c.length;e++){var f=c[e].h;ha.yn(f.Zb,d.L)&&v.ei(f,a,d.L)}}}});for(a=0;a<b.la.length;a++){var d=b.la[a],e=b.Ic[a];switch(d.L){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":break;default:for(var f=b.o,m=0;m<f.length;m++)c=f[m].h,ha.yn(c.Zb,d.L)&&v.ei(c,e,d.L)}}}function f(a,b,c,d,e){var f=b.d;b=b.B;for(var m=0;m<b.length;m++){var g=b[m].h;if(!(g.Dc||g.fd||"SHADELESS"!=g.type&&"MAIN"!=g.type&&"NODES"!=g.type||y(a,g))){if("OPAQUE"===d){if(g.O)continue;var k=ba.Oa(c,
"SHADOW_CAST")&&g.Nb?"SHADOW_SRC_MASK":"SHADOW_SRC_NONE"}else if("BLEND"===d){if(!g.O)continue;if(ba.Oa(c,"SHADOW_CAST")&&g.Nb)switch(W.ld){case "RGBA":k="SHADOW_SRC_RGBA";break;case "RGBA_PCF":k="SHADOW_SRC_RGBA_PCF";break;case "DEPTH":k="SHADOW_SRC_DEPTH";break;case "VSM":k="SHADOW_SRC_VSM";break;default:throw"Wrong shadows type";}else k="SHADOW_SRC_NONE"}else throw"Wrong main subscene type";var G=g.Ja;ha.S(G,"SHADOW_SRC",k);v.dk(g,E(e));ha.S(G,"NUM_LIGHTS",a.mh);"special_skydome.glslf"==ha.qo(G)&&
ha.S(G,"REFLECTION_PASS",0);ha.S(G,"SSAO_ONLY",0);a.Ea&&a.yb?ha.S(G,"WATER_EFFECTS",1):ha.S(G,"WATER_EFFECTS",0);a.Ea&&a.jf&&f.jf?(ha.S(G,"CAUSTICS",1),ha.S(G,"CAUST_SCALE",a.tn),ha.S(G,"CAUST_SPEED",ha.s(a.un,2)),ha.S(G,"CAUST_BRIGHT",a.sn)):ha.S(G,"CAUSTICS",0);a.Ea&&(ha.S(G,"WAVES_HEIGHT",ha.s(a.bf)),ha.S(G,"WAVES_LENGTH",ha.s(a.bg)),ha.S(G,"WATER_LEVEL",ha.s(a.af)));g.Xd&&ba.Oa(c,"MAIN_REFLECT")&&-1===g.nb.indexOf("u_mirrormap")?ha.S(G,"REFLECTIVE",1):ha.S(G,"REFLECTIVE",0);var n=ba.Oa(c,"SKY");
if(n)if(g.Ef){var l=n.k.Na;v.ei(g,l,"u_sky")}else!W.Vd||"MAIN_OPAQUE"!==a.type&&"MAIN_BLEND"!==a.type?ha.S(G,"PROCEDURAL_FOG",0):(g.Uc=n.Uc,ha.S(G,"PROCEDURAL_FOG",1));else ha.S(G,"PROCEDURAL_FOG",0);g.ta&&(n=ba.Oa(c,"GRASS_MAP"))&&q(g,n,f);g.ag&&(ba.Oa(c,"REFRACT")?ha.S(G,"REFRACTIVE",1):ha.S(G,"REFRACTIVE",0),g.Iq&&ba.Oa(c,"DEPTH")?ha.S(G,"SHORE_SMOOTHING",1):ha.S(G,"SHORE_SMOOTHING",0),g.rc&&a.Ea&&a.bf?ha.S(G,"DYNAMIC",1):ha.S(G,"DYNAMIC",0));if("OPAQUE"===d||"BLEND"===d)for(G=g.Ba,n=0;n<G.length;n++){var l=
G[n],p=l.pp;if(p){var F=p.d.Qa,C=null,s=null;ja.Ze(F,function(a,b,c){if("SCREEN"==c.t)return C=ja.Pa(F,a),s=c,!0});if(!C||!s)throw"Failed to assign RTT";Fa.tj(l,Fa.v,Fa.v);s.na=l;var aa=C.k;aa.Na=l;aa.Kd=oa.Jp(l,null);H(p,ab.Fe,ab.Fe,!0);l=ba.Mn(F);for(p=l.length-1;0<=p;p--)aa=l[p],ea.Kf(aa.k,1),e.d.vh.unshift(aa)}}B(c,a,k);v.ob(g);k={K:!0,Wa:f,h:g};t(g);a.o.push(k);h(c,a,g);u(g)}}a.o.sort(function(a,b){return a.h&&b.h?(a.h.O==b.h.O?0:a.h.O>b.h.O?1:-1)||(a.h.Sd==b.h.Sd?0:a.h.Sd>b.h.Sd?1:-1):0})}function t(a){var b=
a.Zb.attributes,c=a.fc.th,d;for(d in b)if(!c[d])throw'B4W Error: missing data for "'+d+'" attribute';"MAIN"==a.type&&(b=4+w(a.Zb.attributes,["a_color","a_tangent","a_texcoord"]),b+=w(a.Zb.qd,["u_shadow_map0","u_shadow_map1","u_shadow_map2","u_shadow_map3","u_shadow_mask"]),b>Jb&&fa.warn("B4W Warning: Varying limit exceeded for main shader - "+b+', material "'+s(a)+'"'));"NODES"==a.type&&(b=2,d=c=0,a.he&&(c+=N.no(a.he),b+=c),a.Ca&&(d+=N.no(a.Ca),b+=d),b+=w(a.Zb.attributes,["a_color","a_normal","a_tangent"]),
b+=w(a.Zb.qd,["u_shadow_map0","u_shadow_map1","u_shadow_map2","u_shadow_map3","u_shadow_mask"]),b>Jb&&fa.warn("B4W Warning: Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', material "'+s(a)+'"'))}function u(a){a.Ba.length>Sc&&fa.warn("B4W Warning: too many textures used - "+a.Ba.length+" (max "+Sc+'), material "'+s(a)+'"')}function w(a,b){for(var c=0,d=0;d<b.length;d++)b[d]in a&&c++;return c}function s(a){for(var b=0;b<Ea.length;b++)for(var c=R(Ea[b],"MESH"),d=0;d<c.length;d++){var e=
c[d];if(e.B)for(var f=e.data.materials,m=0;m<e.B.length;m++){var g=e.B[m];if(g.h==a&&-1<g.Ob)return f[g.Ob].name}}return null}function B(a,b,c){for(var d=0,e=ba.ro(a,b),f=0;f<e.length;f++){var m=e[f];"SHADOW_SRC_RGBA"!=c&&"SHADOW_SRC_RGBA_PCF"!=c&&"SHADOW_SRC_DEPTH"!=c&&"SHADOW_SRC_VSM"!=c||"SHADOW_CAST"!=m.type&&"POSTPROCESSING"!=m.type||(m=ba.kv(a,m,"SHADOW_CAST").k,b.qA=m.Da,b.Fs=new Float32Array([0.5,0,0,0,0,0.5,0,0,0,0,0.5,0,0.5,0.5,0.5,1]),b.Df=b.Df||[],b.Df[d]=m.ua,d++)}}function q(a,b,c){a.Lb=
b.Lb;var d=b.Lb[0],e=b.Lb[1],f=b.Lb[2];c=c.Bb;c=Math.max(c.T-c.R,c.ga-c.ka);f=0==f?c:Math.max(f,c);b.Lb[2]=f;b=b.k;ea.Tp(b,f/2,-e,-d,f/2);ea.Kf(b);d=a.Go||0;d=0==d?c:Math.max(d,c);a.Go=d}function y(a,b){for(var c=a.o,d=0;d<c.length;d++){var e=c[d].h;if(e&&e.id==b.id)return!0}return!1}function D(a){var b=P(a,"MAIN_OPAQUE");ja.U(a.d.Qa,function(c,d){"SHADOW_CAST"===d.type&&z(d,b,d.o,a)})}function z(a,b,c,d){if(0!=c.length){var e=a.k;b=b.k;var f=I(d,"LAMP"),m;a:{for(m=0;m<f.length;m++){var g=f[m];if(g.data.b4w_generate_shadows){m=
g;break a}}m=!1}f=(m||f[0]).d;ea.Zp(e,f.e,f.i);ya.copy(b.Jd,e.Jd);d=d.d.Ih;a=d.Cg*d.re*Math.pow(d.Bg/d.re,(a.On+1)/d.Dg)+(1-d.Cg)*(d.re+(a.On+1)/d.Dg*(d.Bg-d.re));a=a>b.ab?b.ab:a;d=Fc;f=lb;ea.Yn(b,b.lb,a,f);N.Me(f,e.Da,f,0);ka.Hs(f,d);b=sb;ka.rd(b);f=e.Da;m=!1;for(g=0;g<c.length;g++){var h=ka.ji(c[g].Wa.yd,f,Cb);ka.dt(h,d)&&(m?ka.Xn(b,h):(ka.Dt(h,b),m=!0))}c=b.ga;ka.vz(b,d,b);b.ga=c;c=b.T-b.R;d=b.D-b.A;m=64/Math.ceil(64/(c/(2*a)));f=64/Math.ceil(64/(d/(2*a)));m=2*m*a;a*=2*f;b.R-=0.5*(m-c);b.T+=0.5*
(m-c);b.A-=0.5*(a-d);b.D+=0.5*(a-d);c=(b.T-b.R)/ab.kd;a=(b.D-b.A)/ab.kd;b.R=Math.floor(b.R/c)*c;b.T=Math.floor(b.T/c)*c;b.A=Math.floor(b.A/a)*a;b.D=Math.floor(b.D/a)*a;ea.Zy(e,b.R,b.T,b.A,b.D,-b.ga,-b.ka);ea.Kf(e);N.Zn(e.Zf,e.Lk)}}function E(a){var b=a.d.Ih;a=b.re;for(var c=b.Bg,d=b.Dg,b=b.Cg,e=[],f=1;f<=d;f++){var m=b*a*Math.pow(c/a,f/d)+(1-b)*(a+f/d*(c-a));m===Math.round(m)&&(m+=1E-4);e.push(m)}return e}function M(a){var b=N.mi(a);a.Ja=JSON.parse(JSON.stringify(a.Ja));return b}function x(a,b){for(var c=
S(b,Va),d=a.dc,e=a.d,f=d.index,m=0;m<c.length;m++){var g=c[m];g.ah.set(e.e,3*f);g.Yg.set(d.direction,3*f);g.Xg.set(d.xg,3*f);var h=tc;h[0]=1;h[1]=0;h[2]=0;h[3]=0;var k=ac;k[0]=-1;k[1]=-1;k[2]=-1;k[3]=0;switch(d.type){case "SUN":g.Qh.set(e.i,0);g.Ph=d.xg;if("SKY"===g.type){var G=rb;G[0]=G[1]=G[2]=1;var n=Math.acos(ya.dot(g.Ye,G)),G=Math.acos(ya.dot(d.direction,G));g.dj=Math.floor(n/0.025)!=Math.floor(G/0.025)?!0:!1;ya.copy(d.direction,g.Ye);L(b,g)}else ya.copy(d.direction,g.Ye);break;case "HEMI":h[0]=
0.5;h[1]=0.5;break;case "POINT":k[2]=d.distance;break;case "SPOT":k[2]=d.distance;n=k[0]=Math.cos(d.Iz/2);k[1]=d.Hz*(1-n);break;default:fa.error("B4W Warning: unknown light type: "+d.type)}g.Zg.set(h,4*f);g.$g.set(k,4*f);g.Ra=!0}}function L(a,b){oa.Ci(b);if(b.dj)for(var c=S(a,["MAIN_OPAQUE","MAIN_BLEND"]),d=0;d<c.length;d++)for(var e=c[d].o,f=0;f<e.length;f++){var m=e[f];m.K&&(m=m.h,v.ct(m)&&oa.eA(m))}}function R(a,b){if(!a.ai)throw"Access to uninitialized scene";b||(b="ALL");return a.ai[b]}function I(a,
b){b||(b="ALL");return a.Ab[b]}function Q(a){var b=[];a=R(a,"MESH");for(var c=0;c<a.length;c++)for(var d=a[c].data,e=0;e<d.materials.length;e++){var f=d.materials[e];-1==b.indexOf(f)&&b.push(f)}return b}function H(a,b,c,d){for(var e=a.camera.d.ea,f=0;f<e.length;f++)ea.Kf(e[f],b/c);ea.Cq(a.camera);ba.Xz(a.d.Qa,function(e,f,m){if(d||e.Uh){var g=e.Ue*b,h=e.Ue*c;if(f)for(f=0;f<m.la.length;f++)m.la[f]==e&&Fa.If(e.na,g,h);else Fa.Vg(e.na)&&Fa.If(e.na,g,h),e=m.k,e.width=g,e.height=h,"DOF"==m.type&&O(a,{dof_power:m.k.Gd,
dof_on:m.k.Dk}),"ANTIALIASING"==m.type?K(m,1/b/W.wb,1/c/W.wb):K(m,1/b,1/c)}})}function K(a,b,c){a=a.o;for(var d=0;d<a.length;d++){var e=a[d].h;e&&e.ca&&v.Hh(e,b,c)}}function S(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];ja.U(a.d.Qa,function(a,b){b.type==e&&c.push(b)})}return c}function P(a,b){return ba.Oa(a.d.Qa,b)}function O(a,b){var c=P(a,"DOF");if(!c)return fa.error("DOF is not enabled on scene. Check camera settings"),0;var d=a.d.Qa;"dof_on"in b&&(c.k.Dk=parseFloat(b.dof_on));"dof_distance"in
b&&(c.k.Fd=b.dof_distance);"dof_front"in b&&(c.k.Hg=b.dof_front);"dof_rear"in b&&(c.k.Jg=b.dof_rear);if("dof_power"in b){c.k.Gd=b.dof_power;for(var e=ba.bb(d,c,"POSTPROCESSING"),d=ba.bb(d,e,"POSTPROCESSING"),e=[e,d],d=0;d<e.length;d++){var f=e[d].o[0].h;f&&f.ca&&(v.jd(f,c.k.Gd),K(e[d],1/c.k.width,1/c.k.height))}}c.Ra=!0}function T(a,b,c){if(c.K!=b.K)if("POSTPROCESSING"==b.type&&b.Tg)b.K=c.K;else if("GLOW"==b.type){var d=ja.kh(a,b),e=null,f=null,g=null,h=[],k=[],G=[],n=[];ja.pc(a,d,function(a,b,c){if("GLOW_MASK"!=
b.type&&!b.Tg)return e=b,f=a,g=c,!0});ja.Jc(a,d,function(a,b,c){h.push(b);k.push(a);G.push(c)});if(!e||!h.length)throw"Failed to define glow environment";for(d=0;d<G.length;d++)if("SCREEN"==G[d].t)return;for(d=0;d<G.length;d++)ja.pc(a,k[d],function(a,b,c){if(a==f)return n.push(c),!0});b.K=c.K;Pa||(Pa=b.K?e.k.Na:n[0].na);if(b.K){b=e.k.Na;g.aa=!0;for(d=0;d<G.length;d++)G[d].aa=!0,n[d].aa=!1;m(a,f,g.t,Pa);for(d=0;d<G.length;d++)F(a,k[d],G[d].L,G[d].na)}else{b=e.k.Na;g.aa=!1;for(d=0;d<G.length;d++)G[d].aa=
!1,n[d].aa=!0;m(a,f,g.t,Pa)}Pa=b}}function m(a,b,c,d){var e=ja.Pa(a,b);ea.sj(e.k,c,d);e.ek=!0;ja.Jc(a,b,function(b,e,f){f.aa&&f.t==c&&ba.mt(f)&&F(a,b,f.L,d)});ja.pc(a,b,function(b,e,f){f.aa&&f.t==c&&f.t==f.L&&m(a,b,c,d)})}function F(a,b,c,d){a=ja.Pa(a,b).o;for(b=0;b<a.length;b++)v.xy(a[b].h,d,c)}function C(a){var b=P(a,"GRASS_MAP");if(b){var c=b.k,d=a.camera.d,e=d.e;a=rb;a[0]=0;a[1]=-b.Lb[2]/2;a[2]=0;ya.transformQuat(a,d.i,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=Qa;b[0]=0;b[1]=0;b[2]=0;b[3]=1;ea.Zp(c,a,
b)}}function X(a,b){ja.U(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.la[0]||!d.Ic[0])throw"Wrong MOTION_BLUR subscene";var e=d.la[0],f=d.Ic[0];d.Ic[0]=d.k.Na;ja.Jc(a,c,function(b,c,d){d.aa&&F(a,b,d.L,f)});m(a,c,e.t,f);F(a,c,e.L,d.Ic[0]);d.Ax=Math.exp(-b/d.ml)}})}function Z(b,c){var d=0,e=b.$r;0==e.$l&&(e.$l=c);var f=c-e.$l;if(e.Fp&&f/e.lj>=e.Fp)a.En(b);else{f%=e.lj;if(f<e.Fo)switch(e=f/(e.Fo/5),f=Math.floor(e),f){case 0:d=(e-f)/2;break;case 1:d=(e-f)/2+0.5;break;case 2:d=1;break;case 3:d=1-(e-
f)/2;break;case 4:d=0.5-(e-f)/2}for(e=0;e<b.B.length;e++)f=b.B[e],"COLOR_ID"==f.h.type&&"undefined"!==typeof f.h.Ld&&(f.h.Ld=d)}}function V(a){ja.U(a.d.Qa,function(a,b){b.Ra=!0})}var v=r("__batch"),ka=r("__boundings"),ea=r("__camera"),J=r("__config"),ma=r("__debug");r("__geometry");var ja=r("__graph"),la=r("__hud"),da=r("__particles"),G=r("__prerender"),aa=r("__primitives"),fa=r("__print"),oa=r("__renderer"),ba=r("__scenegraph"),ga=r("__sfx"),ha=r("__shaders"),Fa=r("__textures"),N=r("__util"),ya=
r("vec3"),W=J.u,ab=J.Jf,Ua="ARMATURE CAMERA CURVE EMPTY LAMP MESH SPEAKER".split(" "),ta="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT COLOR_PICKING DEPTH GLOW_MASK WIREFRAME".split(" "),Va="MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT GOD_RAYS SKY LUMINANCE_TRUNCED".split(" "),Kb=["MAIN_OPAQUE","SSAO","MAIN_BLEND","MAIN_REFLECT"],Ub="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_REFLECT COLOR_PICKING DEPTH GOD_RAYS GLOW_MASK WIREFRAME".split(" "),sc=["MAIN_OPAQUE","MAIN_BLEND","MAIN_REFLECT"],Sc=8,
Aa=null,Ea=[],Oa=[],Pa=null,kb,Ja,Jb=10,Da=new Float32Array(2),rb=new Float32Array(3),tc=new Float32Array(4),ac=new Float32Array(4),Qa=new Float32Array(4),lb=new Float32Array(24),Fc=ka.rd(),sb=ka.rd(),Cb=ka.rd();a.Qp=function(a){Aa=a;ga.Hy(a)};a.dy=function(a){if(!a.Tm){for(var b=a.d,c=ba.Mn(b.Qa),d=0;d<c.length;d++)b.vh.push(c[d]);H(a,kb,Ja,!1)}b=da.Pb();a=S(a,Ub);for(d=0;d<a.length;d++)a[d].Pb=b};a.n=b;a.P=function(){return Aa?!0:!1};a.Ok=function(){return Ea};a.js=function(a){a.ai={ALL:[]};a.Ab=
{ALL:[]};for(var b in Ua){var d=Ua[b],f=c(a,d);a.ai[d]=f;for(var m=0;m<f.length;m++)a.ai.ALL.push(f[m]);a.Ab[d]=[]}a.d=a.d||{};b=a.d;d=a.camera.d;f=a.world.b4w_shadow_settings;m=b.Ih={};m.re=f.csm_near;m.Bg=f.csm_far;m.Dg=f.csm_num;m.Cg=f.csm_lambda;m.qg=f.blur_depth_size_mult;m.pg=f.blur_depth_edge_size;m.og=f.blur_depth_diff_threshold/1E3;m.vA=f.visibility_falloff;f=a.world.b4w_fog_color;b.Cb=new Float32Array([f[0],f[1],f[2],a.world.b4w_fog_density]);if(W.Vc){f=a.Tm;a:{if("NONE"!=W.ld&&a.b4w_render_shadows)for(var h=
m=!1,G=R(a,"MESH"),F=0;F<G.length;F++){var q=G[F];q.b4w_shadow_cast&&(m=!0);q.b4w_shadow_receive&&(h=!0);if(m&&h){m=!0;break a}}m=!1}b.uy=m;b.IB=a.world.b4w_fog_color;a:{if(W.Ec)for(m=Q(a),h=0;h<m.length;h++)if(G=m[h],G.b4w_water&&G.b4w_water_shore_smoothing){m=!0;break a}m=!1}b.Ec=m;if(W.Gf&&a.b4w_render_reflections)for(m=[],h=R(a,"MESH"),G=0;G<h.length;G++){if(q=h[G],q.b4w_reflective){b:{for(var F=q.constraints,q=q.b4w_lods_num,C=0,s=0;s<F.length;s++){var v=F[s];if("LOCKED_TRACK"==v.type){if(C==
q){q=v.target;break b}C++}}q=null}q&&(F=q.location,q=q.d.i,C=new Float32Array(4),N.Wz(F,q,N.hb,C),m.push(C))}}else m=!1;b.sy=m;b.Ea=e(a);b.Ef=l(a);b.Kl=g(a);b.lq=p(a);m={};h=a.world.b4w_bloom_settings;m.blur=h.blur;m.Yu=h.edge_lum;m.key=h.key;b.Ls=m;m={};h=a.world.b4w_motion_blur_settings;m.ll=h.motion_blur_decay_threshold;m.ml=h.motion_blur_factor;b.xx=m;m={};h=a.world.b4w_color_correction_settings;m.tg=h.brightness;m.Ag=h.contrast;m.Ng=h.exposure;m.Ch=h.saturation;b.$s=m;m={};h=a.world.b4w_god_rays_settings;
m.Uw=h.intensity;m.eh=h.max_ray_length;m.Oh=h.steps_per_pass;b.Aw=m;m={};h=a.world;m.Ni=h.b4w_glow_color;m.Vk=h.b4w_glow_factor;b.xw=m;b.um=n(a);a:{if(W.ta)for(h=m=!1,G=R(a,"MESH"),F=0;F<G.length;F++){C=G[F];s=C.data.materials;for(q=0;q<s.length;q++)s[q].b4w_terrain&&(m=!0);C=C.particle_systems;for(q=0;q<C.length;q++)s=C[q].settings,"HAIR"==s.type&&s.b4w_dynamic_grass&&(h=!0);if(m&&h){m=!0;break a}}m=!1}b.ta=m;b.Qd=W.Qd&&a.b4w_enable_motion_blur;b.Ed=W.Ed&&a.b4w_enable_color_correction;b.ec=W.ec&&
a.b4w_enable_antialiasing;b.dl=R(a,"LAMP").length;b.zd=W.zd&&a.b4w_enable_bloom;b.de=W.de&&a.b4w_enable_ssao;b.Md=W.Md&&a.b4w_enable_god_rays;b.Zd=W.Zd&&a.b4w_render_refractions;b.Fh=k(a);b.Qa=ba.ju(f,b,d)}else b.Kl=g(a),b.um=n(a),b.lq=p(a),b.dl=R(a,"LAMP").length,b.Ef=l(a),b.Ea=e(a),b.ta=!1,b.Fh=k(a),b.Qa=ba.ku(d,b);b.vh=[];b.ql=!1;b.pl=!1;Ea.push(a)};a.pi=c;a.Rk=function(a){return a.d.Qa};a.Av=function(a){ja.U(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=v.Ln(c.oj);break;case "SSAO":d=
v.ru(c.Kz);break;case "DEPTH_PACK":d=v.Ut();break;case "BLUR_DEPTH":d=v.Lt(c.orientation);v.jd(d,c.qg);break;case "REFRACT":case "SCREEN":d=v.Ln("NONE");break;case "GOD_RAYS":ba.bb(a,c,"WIREFRAME")||ba.bb(a,c,"MAIN_BLEND")||ba.bb(a,c,"GOD_RAYS");d=v.Yt(c.Xx?1:0,c.vb&&c.ag?1:0,c.Oh);break;case "GOD_RAYS_COMBINE":ba.bb(a,c,"WIREFRAME")||ba.bb(a,c,"MAIN_BLEND");ba.bb(a,c,"GOD_RAYS");d=v.Zt();break;case "MOTION_BLUR":d=v.du(c.ll);break;case "DOF":d=v.Vt();v.jd(d,c.k.Gd);for(var e=ba.bb(a,c,"POSTPROCESSING"),
f=ba.bb(a,e,"POSTPROCESSING"),m=[e,f],g=0;g<m.length;g++){var k=m[g].o;(e=k[0].h)&&e.ca&&v.jd(e,c.k.Gd)}break;case "GLOW":m=ba.bb(a,c,"POSTPROCESSING");g=ba.bb(a,m,"POSTPROCESSING");e=ba.bb(a,g,"POSTPROCESSING");f=ba.bb(a,e,"POSTPROCESSING");d=v.Xt();m=[g,m];for(g=0;g<m.length;g++)k=m[g].o,(k=k[0].h)&&k.ca&&v.jd(k,c.Ms);m=[f,e];for(g=0;g<m.length;g++)k=m[g].o,(k=k[0].h)&&k.ca&&v.jd(k,c.dv*c.Vk);break;case "COMPOSITING":d=v.Rt();break;case "ANTIALIASING":d=v.Ht();break;case "LANCZOS":d=v.au(c.Zo);
break;case "SMAA":d=v.pu(c.wz);break;case "ANAGLYPH":d=v.Gt();break;case "HUD":d=v.$t();e=Fa.tu();v.ei(d,e);break;case "SKY":d=v.nu();v.Hh(d,1/c.k.width,1/c.k.height);break;case "LUMINANCE":d=v.bu();break;case "AVERAGE_LUMINANCE":d=v.It();break;case "LUMINANCE_TRUNCED":d=v.cu();break;case "BLOOM_BLUR":d=v.Jt(c.oj);v.Hh(d,1/c.k.width,1/c.k.height);break;case "BLOOM":d=ba.bb(a,c,"BLOOM_BLUR");m=[ba.bb(a,d,"BLOOM_BLUR"),d];for(g=0;g<m.length;g++)k=m[g].o,(k=k[0].h)&&k.ca&&v.jd(k,c.mn);d=v.Kt()}d&&(e=
{K:!0,Wa:N.ri("NONE"),h:d},t(d),c.o.push(e),h(a,c,d),u(d))})};a.mg=function(a,b){var c=b.type,d=a.Ab[c];if(d)if(-1!=d.indexOf(b))fa.error("B4W Error - add object(): already added");else switch(a.Ab[c].push(b),a.Ab.ALL.push(b),c){case "MESH":c=a.d.Qa;d=b.d;!ba.Oa(c,"SHADOW_CAST")&&d.Nb&&(d.Nb=!1);for(var d=S(a,ta),e=0;e<d.length;e++){var m=d[e],g=b,k=c,G=a;switch(m.type){case "MAIN_OPAQUE":f(m,g,k,"OPAQUE",G);break;case "MAIN_BLEND":f(m,g,k,"BLEND",G);break;case "MAIN_REFLECT":k=g.d;g=g.B;for(G=0;G<
g.length;G++){var n=M(g[G].h);if(!("SHADELESS"!=n.type&&"MAIN"!=n.type&&"NODES"!=n.type||y(m,n)||n.O)&&n.Yd){var l=n.Ja;ha.S(l,"DISABLE_FOG",0);ha.S(l,"WATER_EFFECTS",0);"special_skydome.glslf"==ha.qo(l)&&ha.S(l,"REFLECTION_PASS",1);ha.S(l,"SHADOW_SRC","SHADOW_SRC_NONE");ha.S(l,"TEXTURE_NORM",0);v.ob(n);l={K:!0,Wa:k,h:n};t(n);m.o.push(l)}}break;case "DEPTH":n=g.d;g=g.B;for(l=0;l<g.length;l++){var p=g[l].h;if("DEPTH"==p.type&&!y(m,p)&&!p.Dc){if(ba.Mw(k,m,"SHADOW_CAST"))if(p.Nb){switch(W.ld){case "RGBA":var F=
"SHADOW_SRC_RGBA",C="SHADOW_DST_MASK";break;case "RGBA_PCF":F="SHADOW_SRC_RGBA_PCF";C="SHADOW_DST_MASK";break;case "DEPTH":F="SHADOW_SRC_DEPTH";C="SHADOW_DST_MASK";break;case "VSM":F="SHADOW_SRC_VSM";C="SHADOW_DST_MASK";break;default:throw"Wrong shadows type";}p=v.Li(p,F,C);v.dk(p,E(G));ba.ro(k,m);B(k,m,F)}else p=v.Li(p,"SHADOW_SRC_NONE","SHADOW_DST_MASK");else p=v.Li(p,"SHADOW_SRC_NONE","SHADOW_DST_NONE");p.ta&&(F=ba.Oa(k,"GRASS_MAP"))&&q(p,F,n);v.ob(p);F={K:!0,Wa:n,h:p};t(p);m.o.push(F);h(k,m,p);
u(p)}}break;case "SHADOW_CAST":n=!1;l=g.d;g=g.B;for(F=0;F<g.length;F++)if(p=g[F].h,p.Cc||p.Nb)if(n=!0,"DEPTH"==p.type&&!y(m,p)&&p.Cc){switch(W.ld){case "RGBA":case "RGBA_PCF":C="SHADOW_DST_RGBA";break;case "DEPTH":C="SHADOW_DST_DEPTH";break;case "VSM":C="SHADOW_DST_VSM";break;default:throw"Wrong shadows type";}p=v.Li(p,"SHADOW_SRC_NONE",C);p.ta&&(C=ba.Oa(k,"GRASS_MAP"))&&q(p,C,l);v.ob(p);C={K:!0,Wa:l,h:p};t(p);m.o.push(C)}n&&z(m,ba.Oa(k,"MAIN_OPAQUE"),m.o,G);break;case "COLOR_PICKING":k=g.d;g=g.B;
for(G=0;G<g.length;G++)n=g[G].h,"COLOR_ID"!=n.type||y(m,n)||(v.ha(n,"USE_GLOW",0),v.ob(n),l={K:!0,Wa:k,h:n},t(n),m.o.push(l));break;case "GRASS_MAP":k=g.d;g=g.B;for(G=0;G<g.length;G++)n=g[G].h,"GRASS_MAP"!=n.type||y(m,n)||(v.ob(n),l={K:!0,Wa:k,h:n},t(n),m.o.push(l),n=m.k,C=k.yd,l=m.Lb[0],F=m.Lb[1],p=m.Lb[2],0==l&&0==F?(l=C.A,F=C.D):(l=Math.min(l,C.A),F=Math.max(F,C.D)),C=1E-4*(F-l),m.Lb[0]=l-C,m.Lb[1]=F+C,ea.Tp(n,p/2,-F,-l,p/2),ea.Kf(n));break;case "GLOW_MASK":k=g.d;g=g.B;for(G=0;G<g.length;G++)n=
g[G].h,"COLOR_ID"!=n.type||y(m,n)||(n=M(n),n.Ld=0,v.ha(n,"USE_GLOW",1),v.ob(n),g.push(v.ou(n,g[G].Ob)),l={K:!0,Wa:k,h:n},t(n),m.o.push(l));break;case "WIREFRAME":for(G=g.d,g=g.B,n=0;n<g.length;n++)l=g[n].h,"WIREFRAME"!=l.type||y(m,l)||(l.ta&&(F=ba.Oa(k,"GRASS_MAP"))&&q(l,F,G),v.ob(l),F={K:!0,Wa:G,h:l},t(l),m.o.push(F),h(k,m,l),u(l))}}break;case "LAMP":c=S(a,Va);for(d=0;d<c.length;d++)c[d].mh++;x(b,a)}else fa.error("B4W Error - add object(): unsupported object type",c)};a.ZB=y;a.El=function(a){a.d.ql=
!0};a.ko=E;a.Ow=function(a){a.d.Qi=!0};a.uz=function(a){a.d.Qi=!1};a.AC=function(a,b){var c=b.d;if("DYNAMIC"!=c.type)return!1;for(var d=S(a,ta),e=0;e<d.length;e++)for(var f=d[e].o,m=0;m<f.length;m++)f[m].Wa==c&&(f.splice(m,1),m--);c=a.Ab.MESH.indexOf(b);-1!=c&&a.Ab.MESH.splice(c,1);c=a.Ab.ALL.indexOf(b);-1!=c&&a.Ab.ALL.splice(c,1)};a.jt=function(a,b){return b.Ab[a.type]&&-1<b.Ab[a.type].indexOf(a)?!0:!1};a.Gj=x;a.pa=function(){for(var a=0;a<Ea.length;a++){var b=Ea[a];ja.U(b.d.Qa,function(a,b){if("SINK"!=
b.type){var c=b.k;oa.vy(c.Kd,c.Na,c.Tb,c.width,c.height);for(var c=b.o,d=0;d<c.length;d++){var e=c[d].h;e&&v.pt(e)}}});b.d.Qa=[];b.d.vh=[]}Aa=null;Ea.length=0;Oa.length=0;Pa=null};a.gp=function(a,b,c){a=ea.Yn(a,a.lb,a.ab,null);var d=aa.Ev(a);a=N.ri("DYNAMIC");a.yd=a.Bb={T:1E12,R:-1E12,D:1E12,A:-1E12,ga:1E12,ka:-1E12};a.Cd=a.Bd={F:[0,0,0],sa:1E12};c=v.mu(d,c);b.o.push({K:!0,Wa:a,h:c})};a.La=R;a.Pv=I;a.jw=function(a){return[a.frame_start,a.frame_end]};a.aq=function(a,b){kb=a;Ja=b;Aa&&H(Aa,a,b,!1)};
a.Hh=K;a.Bj=S;a.qa=P;a.aw=function(a){a=S(a,Va)[0];var b=a.Ac,c=a.Kc,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.Id,d,e]};a.Sp=function(a,b,c,d){a=S(a,Va);for(var e=0;e<a.length;e++){var f=a[e];isNaN(b)||(f.Id=b);c&&(f.Ac[0]=c[0],f.Ac[1]=c[1],f.Ac[2]=c[2]);d&&(f.Kc[0]=d[0],f.Kc[1]=d[1],f.Kc[2]=d[2]);f.Ra=!0}};a.lw=function(a){if(a=P(a,"SKY")){var b={};b.color=a.Jh;b.rayleigh_brightness=a.wh;b.mie_brightness=a.gh;b.spot_brightness=a.Mh;b.scatter_strength=a.Dh;b.rayleigh_strength=
a.yh;b.mie_strength=a.jh;b.rayleigh_collection_power=a.xh;b.mie_collection_power=a.hh;b.mie_distribution=a.ih;return b}return null};a.fz=function(a,c){for(var d=S(a,["SKY"]),e=0;e<d.length;e++){var f=d[e];"color"in c&&(f.Jh=c.color);"rayleigh_brightness"in c&&(f.wh=c.rayleigh_brightness);"mie_brightness"in c&&(f.gh=c.mie_brightness);"spot_brightness"in c&&(f.Mh=c.spot_brightness);"scatter_strength"in c&&(f.Dh=c.scatter_strength);"rayleigh_strength"in c&&(f.yh=c.rayleigh_strength);"mie_strength"in
c&&(f.jh=c.mie_strength);"rayleigh_collection_power"in c&&(f.xh=c.rayleigh_collection_power);"mie_collection_power"in c&&(f.hh=c.mie_collection_power);"mie_distribution"in c&&(f.ih=c.mie_distribution);f.Ra=!0;f.dj=!0;L(b(),f);oa.Ci(f)}};a.dw=function(a,b){var c=b||[],d=S(a,Kb)[0].Cb;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.Yy=function(a,b){for(var c=S(a,Kb),d=0;d<c.length;d++){var e=c[d],f=e.Cb;f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[3];e.Ra=!0}};a.nw=function(a){a=P(a,"SSAO");if(!a)return null;
var b=a.o[0].h,c={};c.ssao_quality=v.Va(b,"SSAO_QUALITY")[1];c.radius_increase=a.Wl;c.dithering_amount=a.Rl;c.gauss_center=a.Sl;c.gauss_width_square=a.Ul;c.gauss_width_left_square=a.Tl;c.influence=a.Vl;c.dist_factor=a.Ql;c.ssao_only=a.kq;c.ssao_white=v.Va(b,"SSAO_WHITE")[1];return c};a.gz=function(a,b){var c=P(a,"SSAO");if(c){if("ssao_quality"in b){var d=c.o[0].h;v.ha(d,"SSAO_QUALITY",b.ssao_quality);v.ob(d,!0)}"ssao_radius_increase"in b&&(c.Wl=b.ssao_radius_increase);"ssao_dithering_amount"in b&&
(c.Rl=b.ssao_dithering_amount);"ssao_gauss_center"in b&&(c.Sl=b.ssao_gauss_center);"ssao_gauss_width_square"in b&&(c.Ul=b.ssao_gauss_width_square);"ssao_gauss_width_left_square"in b&&(c.Tl=b.ssao_gauss_width_left_square);"ssao_influence"in b&&(c.Vl=b.ssao_influence);"ssao_dist_factor"in b&&(c.Ql=b.ssao_dist_factor);if("ssao_only"in b){c=P(a,"MAIN_OPAQUE");c.kq=b.ssao_only;for(var e=0;e<c.o.length;e++)d=c.o[e].h,v.ha(d,"SSAO_ONLY",b.ssao_only),v.ob(d,!0)}"ssao_white"in b&&(d=c.o[0].h,v.ha(d,"SSAO_WHITE",
b.ssao_white),v.ob(d,!0));c.Ra=!0}else fa.error("SSAO is not enabled on scene")};a.Jv=function(a){a=P(a,"ANTIALIASING");if(!a)return null;var b={};b.aa_method=v.Va(a.o[0].h,"AA_METHOD")[1];return b};a.Gy=function(a,b){var c=P(a,"ANTIALIASING");c?(c=c.o[0].h,"aa_method"in b&&(v.ha(c,"AA_METHOD",b.aa_method),v.ob(c,!0))):fa.error("AA is not enabled on scene")};a.$v=function(a){a=P(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.k.Fd;b.dof_front=a.k.Hg;b.dof_rear=a.k.Jg;b.dof_power=a.k.Gd;return b};
a.Wy=O;a.ew=function(a){var b=S(a,["GOD_RAYS"]);a=P(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].eh;c.god_rays_intensity=a.Wk;c.god_rays_steps=v.Va(b[0].o[0].h,"STEPS_PER_PASS")[1];return c};a.$y=function(a,b){var c=S(a,["GOD_RAYS"]),d=P(a,"GOD_RAYS_COMBINE");if(c&&d){"god_rays_intensity"in b&&(d.Wk=b.god_rays_intensity);if("god_rays_max_ray_length"in b)for(var e=b.god_rays_max_ray_length,f=0;f<c.length;f++)c[f].eh=e,c[f].zl=e/c[f].Oh/(f+1),c[f].Ra=!0;if("god_rays_steps"in
b)for(var m=ha.s(b.god_rays_steps,1),e=c[0].eh,f=0;f<c.length;f++){c[f].Oh=m;c[f].zl=e/m/(f+1);c[f].Ra=!0;var g=c[f].o[0].h;v.ha(g,"STEPS_PER_PASS",m);v.ob(g,!0)}d.Ra=!0}else fa.error("God Rays are not enabled on scene")};a.Rv=function(a){var b=P(a,["LUMINANCE_TRUNCED"]);a=P(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.nk;c.bloom_edge_lum=b.mk;c.bloom_blur=a.mn;return c};a.Jy=function(a,b){var c=P(a,"LUMINANCE_TRUNCED"),d=P(a,"BLOOM");if(c&&d){if("bloom_key"in b&&(c.nk=b.bloom_key,c.Ra=
!0),"bloom_edge_lum"in b&&(c.mk=b.bloom_edge_lum,c.Ra=!0),"bloom_blur"in b)for(var e=a.d.Qa,c=ba.bb(e,d,"BLOOM_BLUR"),e=ba.bb(e,c,"BLOOM_BLUR"),c=[c,e],e=0;e<c.length;e++){var f=c[e].o[0].h;f&&f.ca&&(v.jd(f,b.bloom_blur),K(c[e],1/d.k.width,1/d.k.height))}}else fa.error("Bloom is not enabled on scene")};a.vw=function(){var a=da.Pb(),b=ya.length(a);if(0==b)return null;var c={};c.wind_dir=180*Math.atan(a[0]/a[2])/Math.PI;c.wind_strength=b;return c};a.lz=function(a,b){for(var c=R(a),d=0;d<c.length;d++){var e=
c[d];if("EMPTY"===e.type&&e.field&&"WIND"===e.field.type)var f=e}f?(c=f.d,"wind_dir"in b&&(rb=[0,b.wind_dir/180*Math.PI,-Math.PI/2],N.Mg(rb,Qa),c.i[0]=Qa[0],c.i[1]=Qa[1],c.i[2]=Qa[2],c.i[3]=Qa[3],da.Fj(f)),"wind_strength"in b&&(c.co=b.wind_strength,da.Fj(f)),V(a)):fa.error("There is no wind on the scene")};a.Dy=function(a){a.d.pl=!0};a.Do=function(a,b){var c=P(Aa,"MAIN_OPAQUE");if(!c||!c.Ea)return fa.error("get_water_surface_level() - no water parameters on this scene"),0;var d=c.bf,e=c.bg,f=c.af,
m=c.Ea;if(!d||!m.pf)return m.af;var g=ya.length(c.Pb),h=c.time;h||(h=0);g&&(h*=g);Da[0]=20/e*(a-0.25*h);Da[1]=20/e*(b-0.25*h);g=N.vn(Da);Da[0]=17/e*(b+0.1*h);Da[1]=17/e*(a+0.1*h);var k=N.vn(Da),g=g+k-1,G=m.Hi,k=m.Ii,n=m.Fi,l=m.Gi;Da[0]=G*(a+n*h);Da[1]=G*(b+n*h);G=N.Nl(Da);Da[0]=k*(b-l*h);Da[1]=k*(a-l*h);k=N.Nl(Da);k*=d*G;if(c.od)if(l=(a-c.nd[0])/c.Fc[0],G=(c.nd[1]+b)/c.Fc[1],l+=0.5,G+=0.5,1<l||0>l||1<G||0>G)d=k;else var l=N.jo(Aa.d.Hl,c.Mf,l,G),n=m.ui,p=m.yi,F=m.xi,q=m.vi,G=m.Ei,c=e/c.fh/Math.PI,
p=[p/e*(a+F*h),p/e*(b+F*h)],e=Math.sqrt(l),d=d*Math.max(l,m.wi)*Math.sin(e/c+n*h)*Math.max(N.Nl(p),q),m=Math.max(e,G),d=d*(1-m)+k*m,g=g*l;else d=k;return f+(d+0.05*g)};a.uw=function(a,b){var c=P(a,"MAIN_OPAQUE");if(c&&(b.waves_height=c.bf,b.waves_length=c.bg,c.yb)){b.water_fog_density=c.yb[3];var d=b.water_fog_color=[];d[0]=c.yb[0];d[1]=c.yb[1];d[2]=c.yb[2]}};a.kz=function(a,b){var c=P(a,"MAIN_OPAQUE");if(c&&c.Ea){c=c.Ea;"dst_noise_scale0"in b&&(c.Hi=b.dst_noise_scale0);"dst_noise_scale1"in b&&(c.Ii=
b.dst_noise_scale1);"dst_noise_freq0"in b&&(c.Fi=b.dst_noise_freq0);"dst_noise_freq1"in b&&(c.Gi=b.dst_noise_freq1);"dir_min_shore_fac"in b&&(c.wi=b.dir_min_shore_fac);"dir_freq"in b&&(c.ui=b.dir_freq);"dir_noise_scale"in b&&(c.yi=b.dir_noise_scale);"dir_noise_freq"in b&&(c.xi=b.dir_noise_freq);"dir_min_noise_fac"in b&&(c.vi=b.dir_min_noise_fac);"dst_min_fac"in b&&(c.Ei=b.dst_min_fac);"waves_hor_fac"in b&&(c.pm=b.waves_hor_fac);"water_dynamic"in b&&(c.pf=b.water_dynamic);for(var d=S(a,sc),e=0;e<d.length;e++){var f=
d[e];"water_fog_density"in b&&c.Cb&&(f.yb[3]=b.water_fog_density);"water_fog_color"in b&&c.Cb&&(f.yb[0]=b.water_fog_color[0],f.yb[1]=b.water_fog_color[1],f.yb[2]=b.water_fog_color[2]);"waves_height"in b&&(f.bf=b.waves_height);"waves_length"in b&&(f.bg=b.waves_length);f.Ra=!0}}else fa.error("set_water_params() - no water parameters on this scene")};a.kw=function(a,b){var c=P(Aa,"MAIN_OPAQUE");if(!c.od)return 100;var d=c.fh,e=c.af,f=(a[0]-c.nd[0])/c.Fc[0],m=(c.nd[1]+a[2])/c.Fc[1],f=f+0.5,m=m+0.5;if(1<
f||0>f||1<m||0>m)e=1;else return c=d*N.jo(Aa.d.Hl,c.Mf,f,m),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(c,d){for(var e=0;e<Ea.length;e++){var f=Ea[e],m=f.d.Qa;if(f.d.Ea)var g=b().camera.d,h=g.e[1]-a.Do(g.e[0],g.e[2]);ja.U(m,function(a,b){-1<Ub.indexOf(b.type)&&(b.time=c);-1<sc.indexOf(b.type)&&f.d.Ea&&(b.rn=h)})}if(W.Vc)for(e=0;e<Oa.length;e++)Z(Oa[e],c);for(e=0;e<Ea.length;e++)if(f=Ea[e],m=f.d,m.ql&&(D(f),m.ql=!1),m.pl&&(C(f),m.pl=!1),m.vh.length){f.b4w_enable_motion_blur&&X(m.Qa,d);if(W.Vc&&
m.Fh){for(var e=P(f,"GLOW_MASK").o,k=0,g=0;g<e.length;g++)k+=e[g].h.Ld;ja.U(f.d.Qa,function(a,b){"GLOW"===b.type&&(b.Tu=k)})}for(var n=m.vh,l=null,e=0;e<n.length;e++)if("GLOW_MASK"==n[e].type){l=e;break}for(g=0;g<n.length;g++){var p=n[g];null!==l&&T(m.Qa,p,n[l])}for(g=0;g<n.length;g++)p=n[g],G.ey(p),oa.Ci(p)}W.xj&&la.tz(Ea,d)};a.Pk=function(a){var b=[];ja.U(a.d.Qa,function(a,c){b.push(c)});return b};a.fn=function(a,b,c,d){a.$r={$l:0,Fo:b,lj:c,Fp:d};Oa.push(a)};a.En=function(a){for(var b=0;b<a.B.length;b++){var c=
a.B[b];"COLOR_ID"==c.h.type&&"undefined"!==typeof c.h.Ld&&(c.h.Ld=0)}a=Oa.indexOf(a);-1!=a&&Oa.splice(a,1)};a.nB=function(){Oa=[]};a.Tv=function(){var a=P(Aa,"MAIN_BLEND"),b=Aa;return a||b.d.Ea?a.rn:null};a.kA=V;a.nz=function(a,b){switch(b){case "WM_NONE":a.K=!1;break;case "WM_OPAQUE_WIREFRAME":case "WM_TRANSPARENT_WIREFRAME":case "WM_FRONT_BACK_VIEW":case "WM_DEBUG_SPHERES":for(var c=0;c<a.o.length;c++)a.o[c].h.Lj=ma.Om[b];a.K=!0}a.O="WM_TRANSPARENT_WIREFRAME"==b;a.Ra=!0};a.mz=function(a,b){for(var c=
0;c<a.o.length;c++)a.o[c].h.Jq=b,a.Ra=!0}};b4w.module.__physics=function(a,r){function b(a,c){for(var d=a.td,e=0;e<d.length;e++)d[e].game.use_collision_compound&&c.push(d[e]),b(d[e],c)}function c(a,b){if(F)switch(a){case x.Xq:L.dA();break;case x.Yq:E.log(b);break;case x.Uq:E.error(b);break;case x.Vq:M.Hk.apply(this,b.slice(1));break;case x.ar:var c=d(b.body_id);if(c){var e=b.trans,f=b.quat,g=b.linvel,h=b.angvel,c=c.m;c.wk=b.time;Q.Gh(e,1,f,c.xk);S.copy(g,c.ep);S.copy(h,c.Wm)}break;case x.Zq:(e=d(b.chassis_hull_body_id))&&Q.Gh(b.trans,1,b.quat,
e.g.uh[b.prop_ind]);break;case x.Wq:if(c=d(b[1]))e=b[4],c=c.cc.ii[b[2]],I.lc(c,b[3]),I.Pe(c,e),I.Y(c);break;case x.br:c=d(b[1]);c.g.speed=b[2];break;case x.Sq:for(var e=b[1],c=b[2],f=b[3],g=b[4],e=parseInt(e),h=F.m.o,k=0;k<h.length;k++)for(var n=h[k].mb,l=0;l<n.vc.length;l++){for(var p=n.vc[l],q=p.ij,C=!1,s=0;s<q.length;s++){var v=q[s];if(v[0]===e&&v[1]===c){p.wp[s]=f;C=!0;break}}if(C){q=p.wp;for(s=C=0;s<q.length;s++)C=C||q[s];(C&&!p.fl||!C&&p.fl)&&p.ne(C,g);p.fl=C}}break;case x.Tq:c=d(b[1]);c=c.m;
c.oi&&c.oi(b[2]);break;case x.$q:if(c=d(b.body_id))for(c=c.m,f=b.from,g=b.to,h=b.local,k=b.body_id_b_hit,n=b.cur_result,l=0;l<c.Wd.length;l++)if(q=c.Wd[l],H.ni(q.t,f,m)&&H.ni(q.L,g,m)&&q.vf==h){if(-1==k)for(e in q.hd)q.hd[e]=1;else q.hd[k]=n;for(var p=q.gc,s=q.ne,q=q.hd,C=!1,v=1,t=0;t<F.m.o.length;t++){var u=F.m.o[t].mb;if(("ANY"==p||u.id==p)&&u.C in q&&1!==q[u.C]){C=!0;v=q[u.C];break}}s(C,v)}break;default:E.error("Wrong message: "+a)}}function d(a){a=parseInt(a);for(var b=0;b<C.length;b++){var c=
C[b];if(c.m.C===a)return c}return null}function e(){X.body++;return X.body}function l(a){return{C:a,jl:0,Ui:!1,be:!0,kC:!1,Si:!1,Zw:!1,qi:null,id:"",pB:{},vc:[],oi:null,Wd:[],wk:0,xk:new Float32Array([0,0,0,1,0,0,0,1]),ep:new Float32Array(3),Wm:new Float32Array(3)}}function g(a,b){switch(a){case "BOX":var c=b.Bb;break;case "CYLINDER":c=b.Js;break;case "CONE":c=b.Is;break;case "SPHERE":c=b.Bd;break;case "CAPSULE":c=b.jk}return c}function p(a){if(!a)return null;var b={};"number"===typeof a.R&&(b.min_x=
a.R);"number"===typeof a.A&&(b.min_y=a.A);"number"===typeof a.ka&&(b.min_z=a.ka);"number"===typeof a.T&&(b.max_x=a.T);"number"===typeof a.D&&(b.max_y=a.D);"number"===typeof a.ga&&(b.max_z=a.ga);"object"===typeof a.F&&(b.center=a.F);"number"===typeof a.sa&&(b.radius=a.sa);"number"===typeof a.height&&(b.height=a.height);return b}function n(a,b,c,d){var e=a.d.e,f=b.d.G,m=new Float32Array(16);O.invert(f,m);f=new Float32Array(3);S.transformMat4(e,m,f);switch(b.g.type){case ma:b=b.b4w_vehicle_settings;
a=a.d.Bb;x.p(x.er,c,f,b.suspension_rest_length,b.roll_influence,(a.D-a.A)/2,d);break;case ja:x.p(x.dr,c,f,a.OC)}}function k(a){return a.m&&a.m.qi?!0:!1}function h(a,b,c,d,e,f,m,g,h,k){var n;X.Jn++;n=X.Jn.toString(16);x.p(x.lr,n,a,g,b.m.C,c,d,e.m.C,f,m,h,k);b.m.qi=n}function f(a){var b=a.m;if(b&&(0===b.jl||!0===b.Ui||!1===b.be||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)){var b=a.m,c=x.so(x.le);c.msg_id=x.le;c.body_id=a.m.C;c.trans=a.d.e;"DYNAMIC"===b.type?(c.quat=V,P.identity(V)):c.quat=a.d.i;x.p(x.le,
c)}a=a.td;for(b=0;b<a.length;b++)f(a[b])}function t(a,b,c,d,e,f,m){m=m||new Float32Array(3);var g=a.d.i;if(e)m[0]=b,m[1]=c,m[2]=d,a=S.transformQuat(m,g,m);else if("CAMERA"==a.type)m[0]=b,m[1]=c,m[2]=0,a=S.transformQuat(m,g,m),a[1]=-d;else if("MESH"==a.type)m[0]=b,m[1]=0,m[2]=d,a=S.transformQuat(m,g,m),a[1]=c;else throw"Wrong object type";f&&0<a[1]&&(a[1]=0)}function u(a,b,c,d){if(!c&&!d)throw"At least one destination required";for(var e=0;e<b.m.o.length;e++){var f=b.m.o[e];if("ANY"==a||f.mb.id==a)f=
f.mb.C,c&&-1==c.indexOf(f)&&c.push(f),d&&(d[f]=0)}}function w(a,b){x.p(x.Nc,a);if(b.length){for(var c={},d=0;d<b.length;d++){var e=b[d],f=H.gn(e.t)+H.gn(e.L)+String(e.vf);c[f]=c[f]||{t:e.t,L:e.L,vf:e.vf,nn:[]};var m=c[f].nn,g;for(g in e.hd)-1==m.indexOf(g)&&m.push(g)}for(f in c)d=c[f].t,e=c[f].L,g=c[f].vf,m=c[f].nn,x.p(x.Km,a,d,e,g,m)}else x.p(x.Km,a,null,null,!1,null)}function s(a,b){var c=a.m.C,d=b.rf*b.bo,e=b.rg*b.pn,f=2*-b.Of*b.Xl*Math.PI/b.oq;switch(b.type){case ma:x.p(x.Nc,c);x.p(x.Rr,c,d,e,
f);break;case ja:x.p(x.Nc,c),x.p(x.Qr,c,d,e,f)}}function B(a){return a.b4w_vehicle&&"CHASSIS"==a.b4w_vehicle_settings.part?!0:!1}function q(a){return a.b4w_vehicle&&"HULL"==a.b4w_vehicle_settings.part?!0:!1}function y(a){return a.b4w_character?!0:!1}function D(a){return a.b4w_floating&&"MAIN_BODY"==a.b4w_floating_settings.part?!0:!1}var z=r("__config"),E=r("__print"),M=r("__debug"),x=r("__ipc"),L=r("__renderer"),R=r("__scenes"),I=r("__transform"),Q=r("__tsr"),H=r("__util"),K=r("__version"),S=r("vec3"),
P=r("quat"),O=r("mat4"),T=z.mb,m=1E-7,F=null,C=[],X={Kq:0,body:0,Jn:0,shape:0},Z=new Float32Array(3),V=new Float32Array(4),v=new Float32Array(4),ka=new Float32Array(16),ea=new Float32Array(8),J=new Float32Array(8),ma=10,ja=20;a.Rw=function(){if(T.enabled){var a=T.hm+K.timestamp();E.log("%cLOAD PHYSICS","color: #0a0",a);a=new Worker(a);x.Rg(a,c)}};a.Ds=function(a){var b;X.Kq++;b=X.Kq;x.p(x.qr,b);a.m={};a.m.GA=b;a.m.o=[]};a.pa=function(){if(T.enabled){x.p(x.wr);F=null;C.length=0;for(var a in X)X[a]=
0}};a.mg=function(a,c){F=c;x.p(x.Fr,c.m.GA);if(!a.d)throw"No object render: "+a.name;if(a.parent&&a.game.use_collision_compound)return null;var d=[];a.game.use_collision_compound&&b(a,d);for(var f=a.B||[],m=0;m<f.length;m++){var t=f[m].h,u;if(u="PHYSICS"==t.type){var w;a:{for(var z=c.m.o,T=0;T<z.length;T++){var r=z[T].h;if(r&&r.id==t.id){w=!0;break a}}w=!1}u=!w}if(u)if(t.oc.J)if(t.ag&&c.d.Ea){var X=t;x.p(x.pr);var V=F,Z=R.qa(V,"MAIN_OPAQUE");if(Z.Ea&&X.zA){var J={};J.dst_noise_scale0=X.Hi;J.dst_noise_scale1=
X.Ii;J.dst_noise_freq0=X.Fi;J.dst_noise_freq1=X.Gi;J.dir_min_shore_fac=X.wi;J.dir_freq=X.ui;J.dir_noise_scale=X.yi;J.dir_noise_freq=X.xi;J.dir_min_noise_fac=X.vi;J.dst_min_fac=X.Ei;J.waves_hor_fac=X.pm;var M=Z.bf,I=Z.bg,L=Z.af;Z.Fc?x.p(x.Jm,J,Z.Fc[0],Z.Fc[1],Z.nd[0],Z.nd[1],Z.fh,M,I,L,Z.Mf,V.d.Hl):x.p(x.Jm,J,0,0,0,0,0,M,I,L,0,null)}}else{var K;if(t.pA){var ea=a,Q=t,Aa=e(),Ea=Q.oc;x.p(x.nr,Aa,Ea.r[0].a_position,Ea.ja||null,ea.d.e,Q.Hn,Q.In);var Oa=l(Aa);Oa.Ui=!0;K=Oa}else{var Pa=a,kb=t,Ja=e(),Jb=kb.oc;
x.p(x.or,Ja,Jb.r[0].a_position,Jb.ja||null,Pa.d.e,kb.Kk,kb.Ek,kb.Hn,kb.In);K=l(Ja)}var Da=K;Da.id=t.gc;var rb={h:t,mb:Da};c.m.o.push(rb)}else E.error("Object "+a.name+" has collision material with no assigned vertices")}var tc=a.game.physics_type;if(B(a)||q(a)||y(a)||D(a)||a.b4w_collision){var ac=a,Qa=ac.d,lb=ac.game,Fc=e();if("CAMERA"==ac.type)var sb="CAPSULE",Cb=Qa.jk,ua={F:[Cb.F[0],-Cb.F[2],Cb.F[1]],sa:Cb.sa,height:Cb.height},uc=null,Lb=0.5,Ya=0;else"EMPTY"==ac.type?(sb="EMPTY",ua=null,uc=Qa.i,
Ya=Lb=0):(sb=lb.use_collision_bounds?lb.collision_bounds_type:"BOX",uc=Qa.i,ua=g(sb,Qa),Lb=Qa.Kk,Ya=Qa.Ek);var vc=Qa.e,Mb=lb.use_ghost,Kc=lb.use_sleep,Gc=lb.mass,Vc=lb.velocity_min,Vb=lb.velocity_max,Db=lb.damping,tb=lb.rotation_damping,bc=lb.collision_group,Za=lb.collision_mask,cc=Qa.Bd.sa,mc=p(ua),wc=ac.b4w_correct_bounding_offset,Y;var bb=sb;if(d.length){var Ra=[],qa={};qa.quat=new Float32Array([0,0,0,1]);qa.trans=new Float32Array(3);qa.worker_bounding=mc;qa.bounding_type=bb;Ra.push(qa);O.invert(Qa.G,
ka);P.invert(Qa.i,v);for(var Nb=0;Nb<d.length;Nb++){var va={},Eb=d[Nb],dc=Eb.game.collision_bounds_type,pa=new Float32Array(4),Ka=new Float32Array(3);S.transformMat4(Eb.d.e,ka,Ka);P.multiply(v,Eb.d.i,pa);va.trans=Ka;va.quat=pa;va.bounding_type=dc;va.worker_bounding=p(g(dc,Eb.d));Ra.push(va)}Y=Ra}else Y=[];x.p(x.hr,Fc,vc,uc,tc,Mb,Kc,Gc,Vc,Vb,Db,tb,bc,Za,sb,mc,cc,Lb,Ya,Y,wc);C.push(ac);var fb=l(Fc);fb.type=tc;fb.jl=Gc;fb.Ui=Mb;Da=fb;a.m=Da;rb={h:null,mb:Da};c.m.o.push(rb)}if(B(a)||q(a)){var na=a,La=
na.m.C;B(na)?(na.g.type=ma,x.p(x.ir,La,na.g.Oz,na.g.Qz,na.g.Pz,na.g.EA,na.g.wx)):q(na)&&(na.g.type=ja,x.p(x.gr,La,na.g.Ik,na.g.nm,na.g.om));if(na.g.Ne){var Fb=na.g.Ne;switch(na.g.type){case ma:n(Fb[1],na,La,!0);n(Fb[0],na,La,!0);n(Fb[3],na,La,!1);n(Fb[2],na,La,!1);break;case ja:for(var wa=0;wa<Fb.length;wa++)n(Fb[wa],na,La,!1)}}na.m.id=na.b4w_vehicle_settings.name;s(a,a.g)}else if(y(a)){var Sa=a.d,Ob=a.m,ec=Sa.Bb.D-Sa.Bb.A,Wb=Ob.C,ub=a.b4w_character_settings,Xb=ub.walk_speed,Yb=ub.run_speed,Pb=ub.step_height,
nc=ub.jump_strength,oc=ub.waterline,vb=H.Mu(a);x.p(x.jr,Wb,vb,ec,Xb,Yb,Pb,nc,oc);Ob.Si=!0}else if(D(a)){var mb=a,Qb=mb.m.C;x.p(x.mr,Qb,mb.cc.Ik,mb.cc.nm,mb.cc.om);if(mb.cc.ii)for(var $a=mb.cc.ii,nb=0;nb<$a.length;nb++){var gb=$a[nb],wb=gb.d.e,Ia=mb.d.G,A=new Float32Array(16);O.invert(Ia,A);var Xa=new Float32Array(3);S.transformMat4(wb,A,Xa);x.p(x.fr,Qb,Xa,gb.Ns)}mb.m.Zw=!0}else a.b4w_collision&&(Da.id=a.b4w_collision_id);for(m=0;m<C.length;m++)if(a=C[m],a.m){var ia=a;if(!k(ia))for(var Ga=0;Ga<ia.constraints.length;Ga++){var sa=
ia.constraints[Ga],U=sa.target,ra=sa.pivot_type;if("RIGID_BODY_JOINT"==sa.type&&U.m){var cb=new Float32Array([sa.pivot_x,sa.pivot_y,sa.pivot_z]),Zb,ob=new Float32Array([sa.axis_x,sa.axis_y,sa.axis_z]);Zb=H.Mg(ob,new Float32Array(4));var Ba=O.fromRotationTranslation(Zb,cb,new Float32Array(16)),Gb=O.multiply(ia.d.G,Ba,new Float32Array(16)),xb=O.invert(U.d.G,new Float32Array(16)),Hb=O.multiply(xb,Gb,xb),yb=H.De(Hb),pb=H.Pd(Hb),za=sa,Ca={};Ca.use_limit_x=za.use_limit_x;Ca.use_limit_y=za.use_limit_y;Ca.use_limit_z=
za.use_limit_z;Ca.use_angular_limit_x=za.use_angular_limit_x;Ca.use_angular_limit_y=za.use_angular_limit_y;Ca.use_angular_limit_z=za.use_angular_limit_z;Ca.limit_max_x=za.limit_max_x;Ca.limit_min_x=za.limit_min_x;Ca.limit_max_y=za.limit_max_y;Ca.limit_min_y=za.limit_min_y;Ca.limit_max_z=za.limit_max_z;Ca.limit_min_z=za.limit_min_z;Ca.limit_angle_max_x=za.limit_angle_max_x;Ca.limit_angle_min_x=za.limit_angle_min_x;Ca.limit_angle_max_y=za.limit_angle_max_y;Ca.limit_angle_min_y=za.limit_angle_min_y;
Ca.limit_angle_max_z=za.limit_angle_max_z;Ca.limit_angle_min_z=za.limit_angle_min_z;h(ra,ia,cb,Zb,U,yb,pb,Ca,null,null)}}}};a.jv=d;a.update=function(a,b){F&&(x.p(x.Ar,a,b),L.ox());for(var c=0;c<C.length;c++){var d=C[c],e=d.m;if(e.be&&e.wk){var m=a-e.wk,m=Math.min(m,10/60),g=ea;Q.Tw(e.xk,m,e.ep,e.Wm,ea);I.lc(d,Q.Tk(g));"CAMERA"!=d.type&&I.Pe(d,Q.wo(g));I.Y(d);f(d);if(d.g)for(var e=d,m=e.g.Ne,g=e.d.Uf,h=ea,k=0;k<m.length;k++){var n=m[k];Q.multiply(g,e.g.uh[k],h);I.Yp(n,h);I.Y(n)}d.g&&d.g.Nh&&(e=d.g,
m=e.Nh)&&(g=d.g.pq,n=ka,h=d.d.e,k=d.d.i,H.dm(d.g.qq,k,h,n),H.De(n,m.d.e),H.Pd(n,m.d.i),n=V,H.em(g,k,h,n),g=v,P.setAxisAngle(n,2*-e.Of*e.Xl*Math.PI,g),P.multiply(g,m.d.i,m.d.i),I.Y(m));d.g&&d.g.Ol&&(e=d.g,m=e.Ol)&&(h=d.g.iq,g=ka,k=d.d.e,n=d.d.i,H.dm(d.g.jq,n,k,g),H.De(g,m.d.e),H.Pd(g,m.d.i),g=V,H.em(h,n,k,g),h=v,k=Math.abs(e.speed)*e.hq,k>e.kl&&(k=e.kl),P.setAxisAngle(g,-k,h),P.multiply(h,m.d.i,m.d.i),I.Y(m));d.g&&d.g.Yl&&(e=d.g,m=e.Yl)&&(g=d.g.tq,n=ka,h=d.d.e,k=d.d.i,H.dm(d.g.uq,k,h,n),H.De(n,m.d.e),
H.Pd(n,m.d.i),d=V,H.em(g,k,h,d),g=v,P.setAxisAngle(d,-Math.abs(e.rf)*e.Tn,g),P.multiply(g,m.d.i,m.d.i),I.Y(m))}}if(c=F)c=R.qa(c,"MAIN_OPAQUE"),c.Ea&&0<c.Ea.Kj&&(d=S.length(c.Pb),x.p(x.Pr,c.time*d))};a.Kv=function(){return F};a.pause=function(){T.enabled&&x.p(x.Br)};a.Cl=function(){T.enabled&&x.p(x.Er)};a.Wn=function(a){a=a.m;if(!a)throw"No object physics";if(!a.be){var b=a.C;a.be=!0;x.p(x.zr,b)}};a.Un=function(a){a=a.m;if(!a)throw"No object physics";if(a.be){var b=a.C;a.be=!1;x.p(x.yr,b)}};a.Yk=function(a){return a.m?
!0:!1};a.$B=function(a){return(a=a.m)&&a.be&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.jl&&!1==a.Ui?!0:!1};a.Jo=function(a){return(a=a.m)&&a.be?!0:!1};a.az=function(a,b){x.p(x.Or,a.m.C,b)};a.Kw=k;a.rs=h;a.qt=function(a){a=a.m;x.p(x.Dr,a.qi);a.qi=null};a.gy=function(b,c,d,e,f,m){c=Q.mf(c,1,d,ea);f=Q.mf(f,1,m,J);Q.invert(c,c);Q.multiply(f,c,c);I.rw(e,f);Q.multiply(f,c,c);I.Yp(b,c);I.Y(b);a.Xp(b,b.d.e,b.d.i)};a.Xp=function(a,b,c){Q.Gh(a.d.e,1,a.d.i,a.m.xk);var d=x.so(x.le);d.msg_id=x.le;d.body_id=
a.m.C;d.trans=b;d.quat=c;x.p(x.le,d)};a.$b=f;a.ys=function(a,b,c,d,e,f){t(a,b,c,d,e,f,Z);a=a.m.C;x.p(x.Nc,a);b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);e=Math.abs(Z[0]);f=Math.abs(Z[1]);var m=Math.abs(Z[2]);Z[0]=e?Z[0]/e*Math.max(e,b):0;Z[1]=f?Z[1]/f*Math.max(f,c):0;Z[2]=m?Z[2]/m*Math.max(m,d):0;x.p(x.Lm,a,Z[0],Z[1],Z[2])};a.zs=function(a,b,c,d){a=a.m.C;x.p(x.Nc,a);x.p(x.Lm,a,b,c,d)};a.ss=function(a,b,c,d,e,f){t(a,b,c,d,e,f,Z);a=a.m.C;x.p(x.Nc,a);x.p(x.rr,a,Z[0],Z[1],Z[2])};a.xs=function(a,b,c,d){t(a,
b,c,d,!0,!1,Z);a=a.m.C;x.p(x.Nc,a);x.p(x.tr,a,Z[0],Z[1],Z[2])};a.Ly=function(a,b,c){a=a.m.C;x.p(x.Nc,a);x.p(x.Ir,a,b,c)};a.My=function(a,b){x.p(x.Jr,a.m.C,b)};a.Ry=function(a,b){x.p(x.Nr,a.m.C,b)};a.Qy=function(a,b){x.p(x.Lr,a.m.C,b)};a.Ky=function(a,b){x.p(x.Gr,a.m.C,b)};a.at=function(a){x.p(x.ur,a.m.C)};a.bt=function(a,b,c){x.p(x.vr,a.m.C,b,c)};a.Ny=function(a,b,c){x.p(x.Kr,a.m.C,b,c)};a.Oy=function(a,b){x.p(x.Hr,a.m.C,b)};a.Py=function(a,b){x.p(x.Mr,a.m.C,b)};a.lB=Rc(!1);a.jB=Rc(!1);a.gB=function(){E.error("check_collision() deprecated");
return!1};a.hB=function(){E.error("check_collision_any() deprecated");return!1};a.kB=function(){E.error("check_ray_hit() deprecated");return!1};a.UC=function(){E.error("update_object_coords() deprecated")};a.Xm=function(a,b,c){var d=a.m,e=d.C;b=b||"ANY";for(var f=0;f<d.vc.length;f++){var m=d.vc[f];if(m.gc==b&&m.ne==c)return}f=[];a=a.m.C;m=[];u(b,F,m,null);for(var g=0;g<m.length;g++){var h=m[g];a<h?f.push([a,h]):a>h&&f.push([h,a])}m={gc:b,ne:c,ij:f,wp:new Uint8Array(f.length),fl:0};d.vc.push(m);x.p(x.Nc,
e);x.p(x.kr,f)};a.Gp=function(a,b,c){a=a.m;b=b||"ANY";for(var d=0;d<a.vc.length;d++){var e=a.vc[d];if(e.gc==b&&e.ne==c){a.vc.splice(d,1);d--;for(var e=e.ij,f=F.m.o,m=0;m<f.length;m++)for(var g=f[m].mb,h=0;h<g.vc.length;h++)for(var k=g.vc[h],n=0;n<k.ij.length;n++)for(var l=k.ij[n],p=0;p<e.length;p++){var q=e[p];l[0]===q[0]&&l[1]===q[1]&&(e.splice(p,1),p--)}e.length&&x.p(x.Cr,e)}}};a.dn=function(a,b){var c=a.m;c?(x.p(x.sr,c.C),c.oi=b):E.error("Object "+a.name+" has no physics")};a.Dn=function(a){var b=
a.m;b?(x.p(x.xr,b.C),b.oi=null):E.error("Object "+a.name+" has no physics")};a.$m=function(a,b,c,d,e,f){var m=a.m;if(m){a=m.C;b=b||"ANY";c={t:new Float32Array(c),L:new Float32Array(d),vf:e,ne:f,gc:b,hd:{}};u(b,F,null,c.hd);delete c.hd[a];for(var g in c.hd)c.hd[g]=1;m.Wd.push(c);w(a,m.Wd)}else E.error("Object "+a.name+" has no physics")};a.Hp=function(a,b,c,d){var e=a.m;if(e){a=e.C;for(var f=0;f<e.Wd.length;f++){var g=e.Wd[f];H.ni(g.t,b,m)&&H.ni(g.L,c,m)&&g.vf==d&&(e.Wd.splice(f,1),f--)}w(a,e.Wd)}else E.error("Object "+
a.name+" has no physics")};a.Fq=function(a,b){var c=a.g;c.rf=b;s(a,c)};a.Eq=function(a,b){var c=a.g;c.Of=b;s(a,c)};a.Dq=function(a,b){var c=a.g;c.rg=b;s(a,c)};a.Ub=B;a.Vb=q;a.Yw=function(a){if(!a.b4w_vehicle)return!1;a=a.b4w_vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.Xw=function(a){return a.b4w_vehicle?"BOB"==a.b4w_vehicle_settings.part?!0:!1:!1};a.$w=function(a){return a.b4w_floating?"BOB"==a.b4w_floating_settings.part?
!0:!1:!1};a.Wo=function(a){return a.b4w_vehicle&&"STEERING_WHEEL"==a.b4w_vehicle_settings.part?!0:!1};a.Vo=function(a){return a.b4w_vehicle&&"SPEEDOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.Xo=function(a){return a.b4w_vehicle&&"TACHOMETER"==a.b4w_vehicle_settings.part?!0:!1};a.sw=function(a){return a.g.speed};a.FA=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.Si=y;a.jC=D;a.SB=Rc(0)};b4w.module.__data=function(a,r){function b(a){a=H(a);for(var b=0;b<a.length;b++){var c=a[b];"MESH"==c.type&&delete c.data.submeshes}Ea={}}function c(a,b){var c,d;a instanceof ArrayBuffer?(d=v.Eo(a),c=d.width,d=d.height):(c=a.width,d=a.height);G.log("%cLOAD IMAGE "+c+"x"+d,"color: #"+(2048<c||2048<d?"a00":1024<c||1024<d?"aa0":"0a0"),b);-1==b.indexOf(Ja)&&G.warn("B4W Warning: image",b,"is not from app root")}function d(a,b,c,d,e){d=b.w;if(!d)throw"Nothing requested";ma.H([[d,ma.Qj,d]],function(d,f,
m,g){if(d){G.log("%cLOAD METADATA","color: #616",g);f=d.b4w_format_version;if(Number(f)<Va.jp)throw"Incompatible file version: "+f+". Required: "+Va.jp;for(var h in d)a[h]=d[h];b.ln=a.binaries[0].binfile;b.ln||(J.cq(b,"load_binaries"),J.cq(b,"prepare_bindata"));if(a.b4w_export_warnings)for(d=0;d<a.b4w_export_warnings.length;d++)G.error("EXPORT WARNING:",a.b4w_export_warnings[d]);e(b,c)}},null)}function e(a,b,c,d,e){d=I(b.w)+b.ln;if(!d)throw"Binary data is missing";ma.H([[d,ma.dg,d]],function(d,f,
m,g){d&&(G.log("%cLOAD BINARY","color: #616",g),a.bin_data=d,e(b,c))},null)}function l(a,b,c,d,e){d=a.bin_data;var f=a.binaries[0],m=a.objects,h=a.meshes;a=W.ht();for(var k=["indices"],n="position normal tangent texcoord texcoord2 color group".split(" "),l=0;l<h.length;l++)for(var G=h[l].submeshes,p=0;p<G.length;p++)for(var F in G[p])if(-1!=k.indexOf(F)){var q=4*G[p][F][0]+f["int"],C=G[p][F][1],s=G[p],v=F,t=d;if(a)var u=new Uint32Array(t,q,C);else for(var u=new Uint32Array(C),t=new DataView(t),y=
0;y<C;y++)u=t.getUint32(q+4*y,!0);s[v]=u}else-1!=n.indexOf(F)&&(q=4*G[p][F][0]+f["float"],C=G[p][F][1],G[p][F]=g(d,q,C,a));for(F=0;F<m.length;F++)for(h=m[F].particle_systems,k=0;k<h.length;k++)n=h[k],n.transforms=g(d,4*n.transforms[0]+f["float"],n.transforms[1],a);e(b,c)}function g(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d=a.getFloat32(b+4*e,!0)}return d}function p(a,b,c,d,e){for(var m=a.cameras,g=a.groups,k=a.materials,n=a.meshes,l=
a.objects,p=a.particles,F=a.scenes,C=a.speakers,t=a.textures,v="actions armatures cameras curves groups images lamps materials meshes objects particles scenes sounds speakers textures worlds".split(" "),u={},w=0;w<v.length;w++)for(var D=a[v[w]],z=0;z<D.length;z++){var r=D[z];u[r.uuid]=r}for(var fa=0;fa<F.length;fa++){for(var X=F[fa],x=X.objects,E=0;E<x.length;E++)h(x,E,u);X.camera&&h(X,"camera",u);X.world&&h(X,"world",u)}for(fa=0;fa<g.length;fa++)for(var N=g[fa].objects,E=0;E<N.length;E++)h(N,E,u);
for(fa=0;fa<l.length;fa++){var V=l[fa];V.dupli_group&&h(V,"dupli_group",u);V.parent&&h(V,"parent",u);V.animation_data&&V.animation_data.action&&h(V.animation_data,"action",u);switch(V.type){case "MESH":if(!V.data)throw"mesh not found for object "+V.name;h(V,"data",u);for(var P=V.modifiers,E=0;E<P.length;E++){var Z=P[E];"ARMATURE"==Z.type?h(Z,"object",u):"CURVE"==Z.type&&h(Z,"object",u)}var J=V.particle_systems;if(J)for(E=0;E<J.length;E++)h(J[E],"settings",u);break;case "ARMATURE":h(V,"data",u);for(var S=
V.pose.bones,M=V.data.bones,E=0;E<S.length;E++){var ga=S[E];ga.bone=M[ga.bone];for(var I=ga.parent_recursive,L=0;L<I.length;L++)I[L]=S[I[L]]}break;case "LAMP":h(V,"data",u);break;case "CAMERA":h(V,"data",u);break;case "SPEAKER":h(V,"data",u);break;case "CURVE":h(V,"data",u)}var R=V.constraints;if(R)for(E=0;E<R.length;E++){var ka=R[E];ka.target&&h(ka,"target",u)}}for(fa=0;fa<n.length;fa++)for(var Q=n[fa].materials,E=0;E<Q.length;E++)h(Q,E,u);for(fa=0;fa<k.length;fa++){for(var Fa=k[fa],ea=Fa.texture_slots,
E=0;E<ea.length;E++)h(ea[E],"texture",u);var ya=Fa.node_tree;if(ya){for(var ma=ya.nodes,E=0;E<ma.length;E++){var ja=ma[E];"MATERIAL"!=ja.type&&"MATERIAL_EXT"!=ja.type||!ja.material||h(ja,"material",u);"TEXTURE"==ja.type&&ja.texture&&h(ja,"texture",u)}for(var ab=ya.links,E=0;E<ab.length;E++){var Aa=ab[E];Aa.from_node=W.ic("name",Aa.from_node.name,ma);Aa.to_node=W.ic("name",Aa.to_node.name,ma);f(Aa,"from_socket",Aa.from_node.outputs);f(Aa,"to_socket",Aa.to_node.inputs)}}}for(fa=0;fa<t.length;fa++){var sc=
t[fa],la=sc.type;"IMAGE"!=la&&"ENVIRONMENT_MAP"!=la||h(sc,"image",u)}for(fa=0;fa<m.length;fa++){var Oa=m[fa];Oa.dof_object&&h(Oa,"dof_object",u)}for(fa=0;fa<C.length;fa++){var Ea=C[fa];Ea.sound&&h(Ea,"sound",u);Ea.animation_data&&Ea.animation_data.action&&h(Ea.animation_data,"action",u)}for(fa=0;fa<p.length;fa++){for(var Pa=p[fa],ea=Pa.texture_slots,E=0;E<ea.length;E++)h(ea[E],"texture",u);Pa.dupli_group&&h(Pa,"dupli_group",u);Pa.dupli_object&&h(Pa,"dupli_object",u)}aa.ft(a);for(var Da=a.textures,
kb=a.scenes[0].b4w_anisotropic_filtering,Ja=0;Ja<Da.length;Ja++)ha.su(Da[Ja],kb,a.scenes);a.materials.push({name:"DEFAULT",use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[0.8,0.8,0.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:0.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:0.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,
b4w_water_shore_smoothing:!1,b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[0.5,0.5,0.5],b4w_water_fog_density:0.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_terrain_tex_type:"B4W_TERRAIN_NONE",b4w_skydome:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,physics:{friction:0.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,game_settings:{alpha_blend:"OPAQUE",use_backface_culling:!0},
node_tree:null,texture_slots:[]});for(var rb=W.ic("name","DEFAULT",a.materials),Jb=a.meshes,gb=0;gb<Jb.length;gb++){var wb=Jb[gb];0==wb.materials.length&&wb.materials.push(rb)}for(var Ia={},A=a.objects,Xa=0;Xa<A.length;Xa++){var ia=A[Xa];if("MESH"===ia.type&&!ia.particle_systems.length)for(var Ga=ia.data,sa=Ga.name,U=Ga.submeshes,ra=Ga.materials,cb=0;cb<U.length;cb++)0!==U[cb].base_length||Ia[sa]||(G.warn('B4W Warning: material "'+ra[cb].name+'" is not assigned to any faces (object "'+ia.name+'")'),
Ia[sa]=!0)}for(var Zb=a.actions,ob=0;ob<Zb.length;ob++)O.fs(Zb[ob]);for(var Ba=a.scenes,Gb=0;Gb<Ba.length;Gb++){for(var xb=Ba[Gb],Hb=oa.pi(xb,"ALL"),yb=[],pb=0;pb<Hb.length;pb++)for(var za=Hb[pb].particle_systems,Ca=0;Ca<za.length;Ca++){var Ma=za[Ca].settings;if("HAIR"==Ma.type)if("OBJECT"==Ma.render_type)y(Ma.dupli_object);else if("GROUP"==Ma.render_type){for(var fc=Ma.dupli_group,Ib=oa.pi(xb,"EMPTY"),qb=0;qb<Ib.length;qb++)Ib[qb].dupli_group==fc&&yb.push(Ib[qb]);for(qb=0;qb<fc.objects.length;qb++)y(fc.objects[qb])}else G.warn("B4W Warning: render type",
Ma.render_type,"not supported for particle systems ("+Ma.name+")")}for(pb=0;pb<yb.length;pb++)q(yb[pb],[xb])}K(a);for(var db=a.scenes,zb=0;zb<db.length;zb++){for(var xc=db[zb],hb=[],Ab=[],Lc=db[zb].objects,ib=0;ib<Lc.length;ib++){var gc=Lc[ib];s(Lc,gc,hb,Ab);var Bb=gc.dupli_group;if(Bb)for(var pc=Bb.objects,yc=0;yc<pc.length;yc++)s(pc,pc[yc],hb,Ab)}for(ib=0;ib<Ab.length;ib++)q(Ab[ib],[xc]);for(ib=0;ib<hb.length;ib++)W.qs(hb[ib][0],hb[ib][1])}K(a);for(var eb=H(a),Ja=0;Ja<eb.length;Ja++){var qc=eb[Ja];
y(qc)}for(var rc=0;rc<eb.length;rc++){var Ta=eb[rc];if(W.Ug(Ta)){var Rb=Ta.b4w_lods_num;if(Rb){Ta.d.el=!1;for(var hc=Ta.d.wf,Hc=0,Mc=0;Mc<Rb;Mc++){var Tc=B(Ta,Mc);Tc.d.dh=hc;Ta.d.el=!1;hc=Tc.d.wf;Hc=Mc}B(Ta,Hc).d.el=!0}}}for(var Ic=0;Ic<eb.length;Ic++){var ca=eb[Ic];if(ca.b4w_vehicle){var Ha=ca.b4w_vehicle_settings;if("CHASSIS"==Ha.part){ca.g={};ca.g.bo=Ha.force_max;ca.g.pn=Ha.brake_max;ca.g.Oz=Ha.suspension_compression;ca.g.Qz=Ha.suspension_stiffness;ca.g.Pz=Ha.suspension_damping;ca.g.EA=Ha.wheel_friction;
ca.g.CC=Ha.roll_influence;ca.g.wx=Ha.max_suspension_travel_cm;ca.g.rf=0;ca.g.rg=1;ca.g.Of=0;ca.g.speed=0;ca.g.Ne=[];ca.g.uh=[];ca.g.Nh=null;for(var Nc=ca.Qb?ca.Qb.dupli_group.objects:eb,$b=0;$b<Nc.length;$b++){var xa=Nc[$b];if(xa.b4w_vehicle){var Na=xa.b4w_vehicle_settings;if(da.Yw(xa)&&Ha.name==Na.name){var Jc=da.FA(xa.b4w_vehicle_settings.part);ca.g.Ne[Jc]=xa;ca.g.uh[Jc]=new Float32Array(8)}else if(da.Wo(xa)&&Ha.name==Na.name){ca.g.Nh=xa;ca.g.Xl=Na.steering_max;ca.g.oq=Na.steering_ratio;var Wa=
ta.invert(ca.d.G,new Float32Array(16)),zc=ta.multiply(Wa,xa.d.G,Wa);ca.g.qq=zc;var ic=new Float32Array([1,0,0,0]);Ua.transformMat4(ic,zc,ic);ca.g.pq=ic}else if(da.Vo(xa)&&Ha.name==Na.name){ca.g.Ol=xa;ca.g.hq=Na.speed_ratio;ca.g.kl=Na.max_speed_angle;var Wa=ta.invert(ca.d.G,new Float32Array(16)),Ac=ta.multiply(Wa,xa.d.G,Wa);ca.g.jq=Ac;var jc=new Float32Array([1,0,0,0]);Ua.transformMat4(jc,Ac,jc);ca.g.iq=jc}else if(da.Xo(xa)&&Ha.name==Na.name){ca.g.Yl=xa;ca.g.Tn=Na.delta_tach_angle;var Wa=ta.invert(ca.d.G,
new Float32Array(16)),Bc=ta.multiply(Wa,xa.d.G,Wa);ca.g.uq=Bc;var kc=new Float32Array([1,0,0,0]);Ua.transformMat4(kc,Bc,kc);ca.g.tq=kc}}}if(4!=ca.g.Ne.length)throw"Not enough wheels for chassis "+ca.name;}else if("HULL"==Ha.part){ca.g={};ca.g.Ne=[];ca.g.uh=[];ca.g.bo=Ha.force_max;ca.g.pn=Ha.brake_max;ca.g.Ik=Ha.floating_factor;ca.g.nm=Ha.water_lin_damp;ca.g.om=Ha.water_rot_damp;ca.g.rf=0;ca.g.rg=1;ca.g.Of=0;ca.g.speed=0;ca.g.Nh=null;for(var Oc=ca.Qb?ca.Qb.dupli_group.objects:eb,$b=0;$b<Oc.length;$b++)xa=
Oc[$b],xa.b4w_vehicle&&(Na=xa.b4w_vehicle_settings,da.Xw(xa)&&Ha.name==Na.name?(ca.g.Ne.push(xa),ca.g.uh.push(new Float32Array(8))):da.Wo(xa)&&Ha.name==Na.name?(ca.g.Nh=xa,ca.g.Xl=Na.steering_max,ca.g.oq=Na.steering_ratio,Wa=ta.invert(ca.d.G,new Float32Array(16)),zc=ta.multiply(Wa,xa.d.G,Wa),ca.g.qq=zc,ic=new Float32Array([1,0,0,0]),Ua.transformMat4(ic,zc,ic),ca.g.pq=ic):da.Vo(xa)&&Ha.name==Na.name?(ca.g.Ol=xa,ca.g.hq=Na.speed_ratio,ca.g.kl=Na.max_speed_angle,Wa=ta.invert(ca.d.G,new Float32Array(16)),
Ac=ta.multiply(Wa,xa.d.G,Wa),ca.g.jq=Ac,jc=new Float32Array([1,0,0,0]),Ua.transformMat4(jc,Ac,jc),ca.g.iq=jc):da.Xo(xa)&&Ha.name==Na.name&&(ca.g.Yl=xa,ca.g.Tn=Na.delta_tach_angle,Wa=ta.invert(ca.d.G,new Float32Array(16)),Bc=ta.multiply(Wa,xa.d.G,Wa),ca.g.uq=Bc,kc=new Float32Array([1,0,0,0]),Ua.transformMat4(kc,Bc,kc),ca.g.tq=kc))}}}for(var Wc=0;Wc<eb.length;Wc++){var Sb=eb[Wc];if(Sb.b4w_floating){var Cc=Sb.b4w_floating_settings;if("MAIN_BODY"==Cc.part){Sb.cc={};Sb.cc.Ik=Cc.floating_factor;Sb.cc.nm=
Cc.water_lin_damp;Sb.cc.om=Cc.water_rot_damp;Sb.cc.ii=[];for(var Uc=Sb.Qb?Sb.Qb.dupli_group.objects:eb,Dc=0;Dc<Uc.length;Dc++){var Ec=Uc[Dc];if(Ec.b4w_floating){var Yc=Ec.b4w_floating_settings;da.$w(Ec)&&Cc.name==Yc.name&&(Sb.cc.ii.push(Ec),Ec.Ns=Ec.b4w_floating_settings.synchronize_position)}}}}}for(Ja=0;Ja<a.scenes.length;Ja++){var lc=a.scenes[Ja];if(!lc.camera)throw"Scene check failed: No camera";if(!oa.pi(lc,"LAMP").length)throw"Scene check failed: No lamp";for(var ad=oa.pi(lc,"MESH"),bd=0;bd<
ad.length;bd++){var qc=ad[bd],cd=aa.ts(qc);cd&&(a.meshes.push(cd),qc.data=cd)}for(var jd=H(a),dd=a.meshes,Zc=dd.slice(0),Pc=0;Pc<jd.length;Pc++){var kd=jd[Pc];if("MESH"==kd.type){var ld=Zc.indexOf(kd.data);-1<ld&&Zc.splice(ld,1)}}for(Pc=0;Pc<Zc.length;Pc++)dd.splice(dd.indexOf(Zc[Pc]),1);oa.js(lc);Ub.enabled&&lc.b4w_enable_physics&&da.Ds(lc);lc.b4w_enable_audio&&ba.Es(lc);T.Gv(oa.Rk(lc),lc.b4w_batch_grid_size,ad);oa.Av(oa.Rk(lc))}var md=a.materials;if(Kb.yk&&Va.im)for(var ed=0;ed<md.length;ed++){for(var fd=
md[ed],nd=fd.texture_slots,Qc=0;Qc<nd.length;Qc++){var od=nd[Qc],Xc=od.texture;if("IMAGE"==Xc.type||"ENVIRONMENT_MAP"==Xc.type){var Tb=Xc.image;Tb.Rb||(-1<Tb.filepath.indexOf(".dds")?Tb.Rb=!0:(Tb.Rb=!od.use_map_normal&&"ENVIRONMENT_MAP"!=Xc.type&&!Xc.b4w_shore_dist_map,Tb.Rb&&(Tb.filepath+=".dds")))}}var pd=fd.node_tree;if(pd)for(var qd=pd.nodes,Qc=0;Qc<qd.length;Qc++){var rd=qd[Qc];if("TEXTURE"==rd.type){var gd=rd.texture;gd?(Tb=gd.image,Tb.Rb||(Tb.Rb=gd.d.ak,Tb.Rb&&(Tb.filepath+=".dds"))):G.warn("B4W Warning: material ",
fd.name," has empty textures")}}}else for(var sd=a.images,hd=0;hd<sd.length;hd++){var id=sd[hd];id.Rb=Boolean("FILE"==id.source&&-1<id.filepath.indexOf(".dds"))}Sc&&G.log("%cDEBUG BPYDATA:","color: #a0a",a);e(b,c)}function n(a,b,c,d,e){d=a.groups;a=a.objects;for(var f={},m={},g={},h={},n=0;n<d.length;n++){var l=d[n];f[l.uuid]=l;g[l.uuid]=l}for(n=0;n<a.length;n++)l=a[n],m[l.uuid]=l,h[l.uuid]=l;k(a,null,h,g);for(var G in g)G in f||d.push(g[G]);for(G in h)G in m||a.push(h[G]);e(b,c)}function k(a,b,c,
d){for(var e=[],f=0;f<a.length;f++){var m=a[f],g=c[m.uuid];if(m=g.proxy){b&&-1==e.indexOf(m.uuid)&&e.push(m.uuid);for(var h=c[m.uuid].constraints,m=0;m<h.length;m++){var n=W.kf(h[m]);n.name+="_CLONE";g.constraints.push(n)}}}for(f=0;f<e.length;f++)g=W.Qg(a,"uuid",e[f]),-1<g&&a.splice(g,1);e={};for(f=0;f<a.length;f++)m=a[f],g=c[m.uuid],b&&(h=W.kf(g),h.name=b+"*"+g.name,h.origin_name=g.name,h.uuid=ja.Lo("Object"+h.name),c[h.uuid]=h,e[m.uuid]=h.uuid,m.uuid=h.uuid),g=c[m.uuid],g.dupli_group&&(m=g.dupli_group,
h=d[m.uuid],n=W.kf(h),n.name=W.cA(h.name+"_CLONE"),n.uuid=ja.Lo("Group"+n.name),d[n.uuid]=n,m.uuid=n.uuid,k(n.objects,g.name,c,d));if(b)for(f=0;f<a.length;f++){m=a[f];g=c[m.uuid];g.parent&&g.parent.uuid in e&&(g.parent.uuid=e[g.parent.uuid]);h=g.constraints;for(m=0;m<h.length;m++)b=h[m],b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=g.modifiers;for(m=0;m<b.length;m++)d=b[m],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid])}}function h(a,b,c){(c=c[a[b].uuid])||G.error("Dangling link found:",
b,a);a[b]=c}function f(a,b,c){a[b]=W.ic("identifier",a[b].identifier,c)}function t(a,b,d,e,f,m){if(!Va.te){for(var g=I(b.w),h=a.images,k={},n=[],l=0;l<h.length;l++){var p=h[l],F=p.uuid;if("FILE"===p.source){var q=u(p,a.textures);if(!q.length)G.warn("B4W Warning: image ",p.name," has no users");else if(!q[0].b4w_shore_dist_map){var C=Q(g+p.filepath),q=p.Rb?ma.dg:ma.eg;Kb.nl&&Va.Vf&&(C=ma.Pl(C),"dds"==C[1]?(C=ma.Pl(C[0]),C=C[0]+".min50."+C[1]+".dds"):C=C[0]+".min50."+C[1]);n.push([F,q,C,p.name]);k[F]=
p}}}n.length?(e.No=0,ma.H(n,function(f,g,h,l){if(f){c(f,l);g=k[g];h=u(g,a.textures);for(l=0;l<h.length;l++){var G=h[l];ha.Hj(G.d,f,g.Rb,G.image.filepath)}f=++e.No/n.length;m(b,d,f)}},function(){G.log("%cLOADED ALL IMAGES","color: #0a0");f(b,d)})):f(b,d)}}function u(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function w(a,b,c,d,e,f){if(!Va.te){a=H(a);for(var m=I(b.w),g=[],h={},k=0;k<a.length;k++){var n=a[k];if(ba.uf(n)&&ba.eq(n)!=ba.wm){var l=n.data.sound,p=l.uuid;
"BACKGROUND_MUSIC"==ba.Bo(n)&&(p=W.zv());if(!(p in h)){h[p]=[];l=Q(m+l.filepath);switch(ba.eq(n)){case ba.Nj:var F=ma.Oj;break;case ba.vm:F=ma.Pj}var l=ma.Pl(l),q=ba.Lu(l[1]),l=q!=l[1]?l[0]+".lossconv."+q:l[0]+"."+q;g.push([p,F,l])}h[p].push(n)}}g.length?ma.H(g,function(a,e,m,k){if(a){G.log("%cLOAD SOUND","color: #0aa",k);-1==k.indexOf(Ja)&&G.warn("B4W Warning: sound",k,"is not from app root");e=h[e];for(m=0;m<e.length;m++)ba.mA(e[m],a);a=++d.yz/g.length;f(b,c,a)}},function(){G.log("%cLOADED ALL SOUNDS",
"color: #0aa");for(var a=oa.n(),a=oa.Pv(a,"SPEAKER"),d=0;d<a.length;d++){var f=a[d];ba.uf(f)&&ba.Ti(f)&&ba.Bp(f)}e(b,c)}):e(b,c)}}function s(a,b,c,d){for(var e=b.b4w_lods_num,f=0,m=b.constraints,g=0;f<e;g++){var h=m[g];if("LOCKED_TRACK"==h.type&&h.target){var k=h.target,n=W.mi(k);n.name=b.name+"_LOD_"+String(f+1);c.push([a,n]);d.push(k);h.target=n;f++}}}function B(a,b){for(var c=a.constraints,d=0,e=0;e<c.length;e++){var f=c[e];if("LOCKED_TRACK"==f.type){if(b===d)return f.target;d++}}return null}function q(a,
b){for(var c=0;c<b.length;c++){for(var d=b[c].objects,e=0;e<d.length;e++){var f=d[e].dupli_group;f&&(f=f.objects,m=f.indexOf(a),-1<m&&f.splice(m,1))}var m=d.indexOf(a);-1<m&&d.splice(m,1)}}function y(a){a.d=W.ri("MESH"===a.type?D(a):a.type);a.wa=null;a.td=[];var b=a.d,c=a.rotation_euler,d=a.scale[0];N.lc(a,a.location);N.vj(a,c);N.Qe(a,d);switch(a.type){case "ARMATURE":c=a.pose.bones;for(d=0;d<c.length;d++){var e=c[d],f=e.bone,g=new Float32Array(f.matrix_local),h=new Float32Array(16);ta.invert(g,h);
var k=new Float32Array(e.matrix_basis),n=new Float32Array(3);ab.subtract(f.tail_local,f.head_local,n);W.tA(n,h,n);e.cs=n;e.Zr=[e].concat(e.parent_recursive);e.Yj=Fa.fo(g,Fa.create());e.Um=Fa.fo(k,Fa.create());e.Xj=Fa.create();e.bi=!1}d=O.Qs(a);b.Ad=d;d=O.qn(a,d);b.rj=d.cb;b.qj=d.cb;b.Dj=d.e;b.Cj=d.e;b.Mi=0;break;case "MESH":b.ae=Va.ci||a.b4w_selectable;b.sl=a.b4w_selectable;b.Uk={ww:a.b4w_glow_settings.glow_duration,yw:a.b4w_glow_settings.glow_period,zw:a.b4w_glow_settings.glow_relapses};b.ae&&(d=
kb,d+=1,132651<d&&G.error("Color ID pool depleted"),c=Math.floor(d/2601),d%=2601,e=Math.floor(d/51),a.Qm=[c/51,e/51,d%51/51],kb++);if("MESH"!=a.type)throw"Wrong object type: "+a.name;d=a.d;if(c=O.po(a))if(e=a.data,e.vertex_groups.length){d.Vi=!0;f=e.vertex_groups;g=c.data.bones;h=c.pose.bones;k=0;e={};for(n=0;n<g.length;n++){var l=g[n].name,p=W.ic("name",l,f);if(p){var q=W.Qg(h,"name",l);e[l]={on:n,Eg:k++,nj:q,mm:p.index}}}f=k;g=Va.jc;f>g?(G.warn('B4W Warning: too many bones for "'+a.name+" / "+c.name+
'": '+f+" bones (max "+g+"). Blending between frames will be disabled"),d.eo=!1):d.eo=!0;d.Ad=e}else d.Vi=!1;else d.Vi=!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;a.d.km=a.data.b4w_vertex_anim.length?!0:!1;if(c=O.po(a))d=a.d.Ad,d=O.qn(c,d),b.rj=d.cb,b.qj=d.cb,b.Dj=d.e,b.Cj=d.e,b.Mi=0;a.B=[];b.Cc=a.b4w_shadow_cast;b.Nb=a.b4w_shadow_receive;b.Dc=a.b4w_shadow_cast_only&&b.Cc;b.Yd=a.b4w_reflexible;b.fd=a.b4w_reflexible_only&&b.Yd;b.Xd=a.b4w_reflective;b.jf=a.b4w_caustics;b.cf=a.b4w_wind_bending;
b.tm=a.b4w_wind_bending_angle;d=T.CA(a.b4w_wind_bending_angle,T.Gs(a.data.b4w_bounding_box),a.scale[0]);b.sm=d;b.Yh=a.b4w_wind_bending_freq;b.Gg=a.b4w_detail_bending_freq;b.Fg=a.b4w_detail_bending_amp;b.sg=a.b4w_branch_bending_amp;b.Qi=!1;b.xf=a.b4w_main_bend_stiffness_col;d=a.b4w_detail_bend_colors;b.Kb={};b.Kb.dp=d.leaves_stiffness_col;b.Kb.cp=d.leaves_phase_col;b.Kb.qp=d.overall_stiffness_col;b.ta=!1;b.Bi=a.b4w_do_not_cull;b.Ck=a.b4w_disable_fogging;if("MESH"!==a.type)throw"Wrong object";d=a.data.materials[0];
b.Kk=d.physics.friction;b.Ek=d.physics.elasticity;b.dh=0;b.wf=a.b4w_lod_distance;Aa&&1E4===a.b4w_lod_distance&&G.warn('B4W Warning: object "'+a.name+'" has default LOD distance');b.el=!0;break;case "CAMERA":F.Zs(a);F.Cs(a);break;case "LAMP":ea.ix(a);break;case "CURVE":if(d=V.qu(a))a.bs=d;break;case "EMPTY":b.Bb=m.rd(),b.Bd={F:[0,0,0],sa:0}}a.parent&&"OBJECT"==a.parent_type&&"ARMATURE"!=a.parent.type?(c=b.e,e=b.i,d=b.scale,X.bn(a,a.parent,c,e,d)):a.parent&&"BONE"==a.parent_type&&"ARMATURE"==a.parent.type?
(c=b.e,e=b.i,X.an(a,a.parent,a.parent_bone,c,e)):a.Qb&&a.Qb.b4w_group_relative?(d=Fa.mf(b.e,b.scale,b.i),X.gs(a,a.Qb,d)):a.Qb&&!a.Qb.b4w_group_relative&&(N.Y(a),e=b.G,ta.multiply(a.Qb.d.G,e,e),c=W.De(e),d=W.Zi(e),e=W.Pd(e),N.lc(a,c),N.Pe(a,e),N.Qe(a,d));a.field&&(b.co=a.field.strength,la.Fj(a));if(b=a.dupli_group)for(b=b.objects,d=0;d<b.length;d++)b[d].Qb=a;N.Y(a)}function D(a){var b=O.Ro(a),c=a.b4w_do_not_batch,d=la.Pi(a),e=a.b4w_collision,f=a.b4w_vehicle,m=a.b4w_floating,g;if(!(g=sc)){if(!b){if(!c){if(!d){if(!e){if(!f){if(!m){a:{m=
a.data;for(f=0;f<m.materials.length;f++)if(m.materials[f].b4w_skydome){m=!0;break a}m=!1}if(!m)a:{a=a.data;for(m=0;m<a.materials.length;m++)if("LENS_FLARES"===a.materials[m].name){m=!0;break a}m=!1}}f=m}e=f}d=e}c=d}b=c}g=b}return g?"DYNAMIC":"STATIC"}function z(a,b,c,d,e){for(d=0;d<a.scenes.length;d++)for(var f=a.scenes[d],m=0;m<Da.length;m++)for(var g=oa.La(f,Da[m]),h=0;h<g.length;h++){var k=g[h];Ub.enabled&&f.b4w_enable_physics&&da.mg(k,f)}e(b,c)}function E(a,b,d,e,f){var m={};e=[];for(var g=a.scenes,
h=0;h<a.scenes.length;h++){var k=g[h];if(k.d.Ea&&(k=k.d.Ea.od)&&"FILE"===k.source){var n=k.uuid,l=I(b.w),l=Q(l+k.filepath);e.push([n,k.Rb?ma.dg:ma.eg,l,k.name]);m[n]=k}}e.length?ma.H(e,function(b,d,e,f){if(b){c(b,f);d=m[d];f=u(d,a.textures);for(e=0;e<f.length;e++){var h=f[e];ha.Hj(h.d,b,d.Rb,h.image.filepath)}for(e=0;e<g.length;e++)if(f=g[e],f.d.Ea.od===d){var k=b,n=d,l=document.createElement("canvas"),h=n.size[0],n=n.size[1];l.width=h;l.height=n;l=l.getContext("2d");l.drawImage(k,0,0);k=l.getImageData(0,
0,h,n).data;l=new Float32Array(4);l[0]=1/16581375;l[1]=1/65025;l[2]=1/255;l[3]=1;for(var h=h*n,n=new Float32Array(h),G=0;G<h;G++)n[G]=l[1]*k[4*G+2]+l[2]*k[4*G+3];f.d.Hl=n}}},function(){f(b,d)}):f(b,d)}function M(a,b,d,e,f){if(Va.ec&&Va.Ve)if(e=oa.Bj(a.scenes[0],["SMAA"]),e.length){a=[];I(b.w);var m=ma.eg;a.push(["SEARCH_TEXTURE",m,C.Db.Ml,"smaa_search_texture"]);a.push(["AREA_TEXTURE",m,C.Db.Ll,"smaa_area_texture"]);for(m=0;m<e.length;m++){var g=e[m];if("SMAA_BLENDING_WEIGHT_CALCULATION"==g.wz){e=
g.la;for(m=0;m<e.length;m++)if(g=e[m],"u_search_tex"==g.L)var h=g.na;else if("u_area_tex"==g.L)var k=g.na;break}}a.length?ma.H(a,function(a,b,d,e){a&&(c(a,e),b="SEARCH_TEXTURE"==b?h:k,b.source="IMAGE",ha.Hj(b,a,-1!=e.indexOf(".dds")?1:0,e),ha.tj(b,ha.v,ha.v))},function(){f(b,d)}):f(b,d)}else f(b,d);else f(b,d)}function x(a,b,c,d){for(b=0;b<a.scenes.length;b++)if(c=a.scenes[b],!c.b4w_load_empty){for(var e=0;e<Jb.length;e++)for(var f=Jb[e],f=oa.La(c,f),m=0;m<f.length;m++){var g=f[m];d.$j.push({Op:c,
nh:g,type:"obj"})}for(e=0;e<rb.length;e++)for(f=rb[e],f=oa.La(c,f),m=0;m<f.length;m++)g=f[m],c.b4w_enable_audio&&d.$j.push({Op:c,nh:g,type:"sfx_obj"})}}function L(a,b,c,d,e,f){a=d.$j;e=d.op;if(a){var m=a[e].nh,g=a[e].Op;switch(a[e].type){case "obj":oa.mg(g,m);break;case "sfx_obj":ba.mg(m,g)}d=++d.op/a.length}else d=1;f(b,c,d)}function R(a,b,c,d,e){for(d=0;d<a.scenes.length;d++)oa.dy(a.scenes[d]);oa.Qp(a.scenes[0]);a=H(a);for(d=0;d<a.length;d++){var f=a[d];!f.d||"DYNAMIC"!=f.d.type&&"CAMERA"!=f.d.type||
N.Y(f);f.b4w_use_default_animation&&O.Ro(f)&&(O.en(f),f.b4w_cyclic_animation&&O.yc(f,!0),O.play(f))}e(b,c)}function I(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function Q(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}function H(a){Pa||
K(a);return Pa}function K(a){var b=a.scenes;a=[];for(var c=0;c<b.length;c++)S(b[c].objects,0,a);Pa=[];for(c=0;c<a.length;c++)for(var b=a[c],d=0;d<b.length;d++)for(var e=b[d],f=0;f<e.length;f++)Pa.push(e[f])}function S(a,b,c){c[b]=c[b]||[];for(var d=c[b],e=0;e<a.length;e++){var f=a[e],m=P(f);d[m]=d[m]||[];-1==d[m].indexOf(f)&&d[m].push(f);(f=f.dupli_group)&&S(f.objects,b+1,c)}}function P(a){return(a=a.parent)?1+P(a):0}var O=r("__animation"),T=r("__batch"),m=r("__boundings"),F=r("__camera"),C=r("__config"),
X=r("__constraints"),Z=r("__controls"),V=r("__curve"),v=r("__dds");r("__debug");var ka=r("__extensions"),ea=r("__lights"),J=r("__loader"),ma=r("__assets"),ja=r("__md5"),la=r("__particles");r("__prerender");var da=r("__physics"),G=r("__print"),aa=r("__reformer"),fa=r("__renderer"),oa=r("__scenes"),ba=r("__sfx"),ga=r("__shaders"),ha=r("__textures"),Fa=r("__tsr"),N=r("__transform"),ya=r("__nodemat"),W=r("__util"),ab=r("vec3"),Ua=r("vec4"),ta=r("mat4"),Va=C.u,Kb=C.ud,Ub=C.mb,sc=!1,Sc=!1,Aa=!1,Ea={},Oa=
null,Pa=null,kb=0,Ja="",Jb=["LAMP","EMPTY","CAMERA","SPEAKER","MESH"],Da=["MESH","CAMERA","EMPTY"],rb=["SPEAKER"];a.Bc=function(){return J.Bc(Oa)};a.update=function(){J.lA(Oa,Ea)};a.load=function(a,c,f,m){Oa=J.lu({load_main:{gb:J.je,rb:!1,X:[],ub:!1,Fb:50,jb:d},duplicate_objects:{gb:J.ef,rb:!1,X:["load_main"],ub:!1,Fb:50,jb:n},load_binaries:{gb:J.je,rb:!1,X:["load_main"],ub:!1,Fb:10,jb:e},prepare_bindata:{gb:J.ef,rb:!1,X:["duplicate_objects","load_binaries"],ub:!1,Fb:0,jb:l},prepare_root:{gb:J.ef,
rb:!1,X:["duplicate_objects","prepare_bindata"],ub:!1,Fb:500,jb:p},load_smaa_textures:{gb:J.je,rb:!0,X:["prepare_root"],ub:!1,Fb:10,jb:M},load_shoremap:{gb:J.je,rb:!0,X:["prepare_root"],ub:!1,Fb:10,jb:E},load_textures:{gb:J.je,rb:!0,X:["prepare_root"],ub:!0,Fb:500,jb:t,oe:{No:0}},add_physics_objects:{gb:J.ef,rb:!1,X:["load_shoremap"],ub:!1,Fb:20,jb:z},add_objects:{gb:J.ef,rb:!1,X:["add_physics_objects"],ub:!1,Fb:800,jb:x,vg:L,ug:R,oe:{$j:[],op:0}},load_speakers:{gb:J.je,rb:!0,X:["add_objects"],ub:!0,
Fb:30,jb:w,oe:{yz:0}}},a,c,f,b,m,Va.te)};a.Bq=function(){G.log("%cUNLOAD","color: #00a");var a=Oa;a&&a.w&&(O.pa(),ba.pa(),oa.pa(),ea.pa(),da.pa(),W.pa(),fa.pa(),ya.pa(),ga.pa(),Z.pa(),ka.pa(),ma.pa(),la.pa(),Pa=null,Oa={},kb=0)};a.Uy=function(a){Ja=a}};b4w.module.__batch=function(a,r){function b(a){return{type:a,Ba:[],nb:[],wc:[],he:{},Ja:null,ej:null,fj:0,Bf:0,vt:!0,M:!0,oa:!1,Hd:S.fg,O:!1,xa:new Float32Array([0,0,0,1]),Lc:S.tc,Ca:{}}}function c(a,b,c){if(b)b=c*(b.D-b.A);else throw"No bounding box for mesh";return 0==b?0:0.5*(Math.sqrt(2*Math.sqrt(4*b*Math.tan(a/180*Math.PI)+1)+2)/2-1)/b}function d(a){return{T:a.max_x,R:a.min_x,D:a.max_y,A:a.min_y,ga:a.max_z,ka:a.min_z}}function e(a,c,d,e){var f=[];if(a.b4w_do_not_render)return f;for(var m=JSON.stringify(c),
h=a.data,k=h.materials,n=l(d,c),p={},C=0;C<n.length;C++){var t=n[C];if("COLOR_ID"!==t||c.ae)for(var y=0;y<k.length;y++)if(!S.Io(h,y)){var w=b(t);if(g(w,k[y],!0)){w.Hd=h.Hd||S.fg;"COLOR_ID"===t&&(w.ut=new Float32Array(a.Qm));u(w,c);for(var z=w,r=a.particle_systems,X=0;X<r.length;X++){var x=r[X].settings.b4w_vcol_from_name,P=r[X].settings.b4w_vcol_to_name;""!==x&&""!==P&&(z.Ca[x]={xe:!1,src:[{name:x,Wb:7}]})}e?(w.Cf=a.uuid,D(w,m),p[w.id]||(p[w.id]={h:w,Aj:[]}),p[w.id].Aj.push(y)):(D(w,m),f.push(E(w,
y)))}}}n=a.particle_systems;z=!1;for(C=0;C<n.length;C++)if(t=n[C],0==t.transforms.length||"PARENT"==t.settings.b4w_wind_bend_inheritance||t.settings.b4w_vcol_from_name&&t.settings.b4w_vcol_to_name){z=!0;break}if(e)for(var Z in p){C=[];w=p[Z].h;t=w.wc;r=w.Ad;X=p[Z].Aj[0];for(y in p[Z].Aj)x=S.gv(h,p[Z].Aj[y],t,r,w.Ca,w.he),C.push(x);1<C.length?(x=S.sq(C),f.push(E(w))):(x=C[0],f.push(E(w,X)));"LENS_FLARES"==k[X].name?(C=T.cy(x),w.fc=C):T.Lw(a)?(B(w,x),z&&(w.oc=x)):"PHYSICS"==w.type?w.oc=x:B(w,x)}if(0<
n.length&&f.length){if(!e)throw"Particle systems require geometry processing";w=!0;for(C=0;C<n.length;C++)if(t=n[C],t.settings.use_render_emitter){w=!1;break}e=f;k=w?[]:f;for(C=0;C<n.length;C++)if(t=n[C],p=t.settings,f=V.Ri(t.seed),"EMITTER"==p.type){f=w=b("MAIN");r=h;Z=t;X=a.d.G;y=r.materials[Z.settings.material-1];z={name:"PARTICLES"};"HALO"===y.type?(z.halo=y.halo,z.texture_slots=[]):z.texture_slots=y.texture_slots;z.offset_z=y.offset_z;z.diffuse_color=y.diffuse_color;z.diffuse_shader=y.diffuse_shader;
z.specular_color=y.specular_color;z.specular_shader=y.specular_shader;z.diffuse_intensity=y.diffuse_intensity;z.alpha=y.alpha;z.game_settings=y.game_settings;z.raytrace_transparency=y.raytrace_transparency;z.raytrace_mirror=y.raytrace_mirror;g(f,z,!0);z.texture_slots=y.texture_slots;r=T.Bv(f,r,Z,z,X);f.PC=z.texture_slots;f.fc=r;switch(Z.settings.b4w_billboard_align){case "VIEW":s(f,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":s(f,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":s(f,
"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":s(f,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");break;default:throw"Wrong billboard align value";}u(w,c);w.Cf=p.uuid;D(w,m);k.push(E(w,-1,t))}else if("HAIR"==p.type){p.b4w_dynamic_grass&&(c.Bi=!0);w=e[0].h;if(t.transforms.length)x=t.transforms;else for(Z=S.Nk(w.oc,p.count,!1,f),x=new Float32Array(4*Z.length),y=0;y<Z.length;y++)z=0.75+0.5*V.Yb(f),x[4*y]=Z[y][0],x[4*y+1]=Z[y][1],x[4*y+2]=Z[y][2],x[4*y+3]=z;Z=F.Oa(d,"GRASS_MAP")?!0:!1;if("OBJECT"==
p.render_type)z=[l(d,p.dupli_object.d)],f=q(a,w,[p.dupli_object],z,[x],p,t,Z,f,!1),k=k.concat(f);else if("GROUP"==p.render_type){r=p.dupli_group.objects;X=!1;z=[];for(y=0;y<r.length;y++)P=l(d,p.dupli_group.objects[y].d),z.push(P);if(p.use_whole_group){X=x;y=r;x={};for(P=0;P<X.length;P+=4)for(var J=0;J<y.length;J++){var M=v.create();v.scale(y[J].d.e,y[J].d.scale,M);var O=v.clone([X[P],X[P+1],X[P+2]]);v.add(O,M,O);x[J]||(x[J]=new Float32Array(X.length));x[J][P]=O[0];x[J][P+1]=O[1];x[J][P+2]=O[2];x[J][P+
3]=X[P+3]}y=x;X=!0}else if(p.use_group_count){for(var y=x,O=r,I=p.dupli_weights,x=f,P={},J=[],M=0;M<O.length;M++)for(var L=O[M],L=L.origin_name||L.name,K=0;K<I.length;K++){var R=I[K];L==R.name.split(": ")[0]&&J.push(R)}I.length!=J.length&&H.error("B4W Error: dupli weights match failed");for(M=0;M<y.length;M+=4){var ka,I=J;ka=[0];for(O=0;O<I.length;O++)ka[O+1]=ka[O]+I[O].count;I=ka[ka.length-1]*V.Yb(x);for(O=L=0;O<ka.length;O++)if(I>=ka[O]&&I<ka[O+1]){L=O;break}ka=L;P[ka]=P[ka]||[];P[ka].push(y[M],
y[M+1],y[M+2],y[M+3])}for(ka in P)P[ka]=new Float32Array(P[ka]);y=P}else{y=x;x=f;P=r.length;J={};for(M=0;M<y.length;M+=4){var ea=Math.floor(P*V.Yb(x));J[ea]=J[ea]||[];J[ea].push(y[M],y[M+1],y[M+2],y[M+3])}for(ea in J)J[ea]=new Float32Array(J[ea]);y=J}f=q(a,w,r,z,y,p,t,Z,f,X);k=k.concat(f)}"INSTANCE"==p.b4w_wind_bend_inheritance&&(c.sm=0)}else throw"Unknown particle settings type";f=k}return f}function l(a,b){var c=["SHADELESS","MAIN","NODES"];(F.Oa(a,"COLOR_PICKING")||F.Oa(a,"GLOW_MASK"))&&c.push("COLOR_ID");
F.Oa(a,"WIREFRAME")&&c.push("WIREFRAME");c.push("PHYSICS");(F.Oa(a,"DEPTH")||F.Oa(a,"SHADOW_CAST"))&&c.push("DEPTH");F.Oa(a,"GRASS_MAP")&&c.push("GRASS_MAP");if(b.Dc||b.fd){var d=null;b.Dc&&(d="SHADELESS MAIN NODES COLOR_ID PHYSICS WIREFRAME".split(" "));if(b.fd)var e=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],d=null!==d?V.As(d,e):e;for(e=0;e<d.length;e++){var f=c.indexOf(d[e]);-1!==f&&c.splice(f,1)}}return c}function g(a,b,c){var d,e;switch(a.type){case "SHADELESS":if(b.b4w_collision||!b.use_shadeless||
b.use_nodes)a=!1;else{x(a,"shadeless.glslv","shadeless.glslf");var m=b.game_settings.alpha_blend;s(a,"ALPHA","OPAQUE"===m?0:1);s(a,"ALPHA_CLIP","CLIP"===m?1:0);w(a,"a_position");var g=b.texture_slots,m=k("use_map_color_diffuse",g)[0],l=k("use_map_color_diffuse",g)[1],g=k("use_rgb_to_intensity",g)[0]&&k("use_stencil",g)[0],F=new Float32Array([b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha]);a.xa=F;if(m){s(a,"TEXTURE_COLOR",1);switch(m.blend_type){case "MIX":s(a,"TEXTURE_BLEND_TYPE",
"TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":s(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}w(a,"a_texcoord");F="IMAGE"==m.texture.d.source&&c?[F[0],F[1],F[2],1]:"ENVIRONMENT_MAP"==m.texture.d.source&&c?[0.8,0.8,0.8,1]:null;F=n(m,F);L(a,F,"u_colormap0");a.Wc=m.diffuse_color_factor;a.hc=new Float32Array(m.texture.b4w_uv_velocity_trans);a.Hc=new Float32Array(m.scale)}m&&l&&g&&(s(a,"TEXTURE_STENCIL_ALPHA_MASK",1),F=c?[0.8,0.8,0.8,1]:null,F=n(l,F),L(a,F,"u_colormap1"),F=c?[0.5,0.5,0.5,1]:
null,F=n(g,F),L(a,F,"u_stencil0"));b.use_vertex_color_paint?(s(a,"VERTEX_COLOR",1),w(a,"a_color")):s(a,"VERTEX_COLOR",0);a.Sd=b.offset_z;p(a,b);a=!0}break;case "MAIN":if(b.b4w_collision||b.use_shadeless||b.use_nodes)a=!1;else{a.hc=new Float32Array([0,0]);a.Ee=Array(4);for(m=0;4>m;m++)a.Ee[m]=new Float32Array([0,0]);p(a,b);a.Sd=b.offset_z;a.Hc=new Float32Array([1,1,1]);var q=b.texture_slots,m=new Float32Array([b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha]);switch(b.name){case "LENS_FLARES":x(a,
"special_lens_flares.glslv","special_lens_flares.glslf");w(a,"a_position");w(a,"a_texcoord");var t=c?[1,1,1,0]:null,t=n(q[0],t);L(a,t);break;case "PARTICLES":0==q.length?x(a,"particles_color.glslv","particles_color.glslf"):(x(a,"particles_texture.glslv","particles_texture.glslf"),(t=n(q[0]))&&L(a,t));break;default:x(a,"main.glslv","main.glslf");var l=k("use_map_color_diffuse",q)[0],u=k("use_map_color_spec",q)[0],v=k("use_map_normal",q)[0],y=k("use_map_mirror",q)[0],g=k("use_map_color_diffuse",q)[1],
z=k("use_rgb_to_intensity",q)[0]&&k("use_stencil",q)[0];if(l){switch(l.blend_type){case "MIX":s(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":s(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}t="IMAGE"==l.texture.d.source&&c?[m[0],m[1],m[2],1]:"ENVIRONMENT_MAP"==l.texture.d.source&&c?[0.8,0.8,0.8,1]:null;t=n(l,t);L(a,t,"u_colormap0");a.Wc=l.diffuse_color_factor;a.hc=new Float32Array(l.texture.b4w_uv_velocity_trans);a.Hc=new Float32Array(l.scale)}var D=l&&l==u;u&&(D||
(t=c?[0.5,0.5,0.5,1]:null,t=n(u,t),L(a,t,"u_specmap")),a.Bz=u.specular_color_factor);v&&(t=c?[0.5,0.5,1,1]:null,t=n(v,t),L(a,t,"u_normalmap0"),a.Hx=v.normal_factor,a.Ee[0].set(v.texture.b4w_uv_velocity_trans));y?(t=c?[0,0,0.5,1]:null,t=n(y,t),L(a,t,"u_mirrormap"),a.bj=y.mirror_factor):a.bj=0;if(F=l&&g&&z?1:0)t=c?[0.8,0.8,0.8,1]:null,t=n(g,t),L(a,t,"u_colormap1"),t=c?[0.5,0.5,0.5,1]:null,t=n(z,t),L(a,t,"u_stencil0");(z=l||u||v)&&a.Hc.set(z.scale);s(a,"TEXTURE_COLOR",void 0==l?0:1);s(a,"TEXTURE_SPEC",
void 0==u?0:1);s(a,"TEXTURE_NORM",void 0==v?0:1);s(a,"TEXTURE_MIRROR",void 0==y?0:1);s(a,"ALPHA_AS_SPEC",D?1:0);s(a,"TEXTURE_STENCIL_ALPHA_MASK",F);w(a,"a_position");w(a,"a_normal");v&&(w(a,"a_normal"),w(a,"a_tangent"),y=v.texture,y.b4w_use_map_parallax&&ea.Ud&&(D=C.s(y.b4w_parallax_steps),s(a,"PARALLAX",1),s(a,"PARALLAX_STEPS",D),a.tl=y.b4w_parallax_scale));(l||u||v)&&w(a,"a_texcoord");if(b.b4w_water){a.ag=!0;a.Iq=b.b4w_water_shore_smoothing;a.rc=b.b4w_water_dynamic;u=b.texture_slots;x(a,"special_water.glslv",
"special_water.glslf");w(a,"a_position");w(a,"a_texcoord");w(a,"a_normal");w(a,"a_tangent");v=k("use_map_normal",u);y=k("use_map_mirror",u)[0];D=k("use_map_alpha",u)[0];v.length&&(z=n(v[0]),L(a,z,"u_normalmap0"));s(a,"NUM_NORMALMAPS",v.length);a.Af=Array(v.length);for(z=0;z<v.length;z++)a.Ee[z].set(v[z].texture.b4w_uv_velocity_trans),a.Af[z]=new Float32Array(2),a.Af[z].set([v[z].scale[0],v[z].scale[1]]);y?(s(a,"TEXTURE_MIRROR",1),z=n(y),L(a,z,"u_mirrormap"),a.bj=y.mirror_factor):(s(a,"TEXTURE_MIRROR",
0),a.bj=0);D?(s(a,"ALPHA_MAP",1),y=n(D),L(a,y,"u_alphamap")):s(a,"ALPHA_MAP",0);y=null;for(z=0;z<u.length;z++)if(e=u[z],!0===e.texture.b4w_water_foam){y=e;break}if(y&&ea.Yc){if(s(a,"FOAM",1),D=n(y),L(a,D,"u_foam"),a.Jk=b.b4w_foam_factor,a.ov=y.texture.b4w_foam_uv_freq,a.mv=y.texture.b4w_foam_uv_magnitude,a.nv=new Float32Array([y.scale[0],y.scale[1]]),v.length)for(z=0;z<v.length;z++)v[z].texture.b4w_affect_foam?s(a,"NORM_FOAM"+String(z),1):s(a,"NORM_FOAM"+String(z),0)}else s(a,"FOAM",0);for(z=0;z<
u.length;z++)if(e=u[z],!0===e.texture.b4w_shore_dist_map){var r=e;break}r?(r=n(r),L(a,r,"u_shore_dist_map"),s(a,"SHORE_PARAMS",1),r=e.texture.b4w_shore_boundings,s(a,"MAX_SHORE_DIST",C.s(e.texture.b4w_max_shore_dist)),s(a,"SHORE_MAP_SIZE_X",C.s(r[0]-r[1])),s(a,"SHORE_MAP_SIZE_Z",C.s(r[2]-r[3])),s(a,"SHORE_MAP_CENTER_X",C.s((r[0]+r[1])/2)),s(a,"SHORE_MAP_CENTER_Z",C.s((r[2]+r[3])/2))):s(a,"SHORE_PARAMS",0);b.b4w_generated_mesh&&ea.Vc?(s(a,"GENERATED_MESH",1),a.Hq=!0,a.AA=b.b4w_water_num_cascads,a.BA=
b.b4w_water_subdivs,a.yA=b.b4w_water_detailed_dist):(s(a,"GENERATED_MESH",0),a.Hq=!1);if(b.b4w_water_dynamic){e=C.s(b.b4w_water_dst_noise_scale0);var r=C.s(b.b4w_water_dst_noise_scale1),u=C.s(b.b4w_water_dst_noise_freq0),v=C.s(b.b4w_water_dst_noise_freq1),y=C.s(b.b4w_water_dir_min_shore_fac),D=C.s(b.b4w_water_dir_freq),z=C.s(b.b4w_water_dir_noise_scale),t=C.s(b.b4w_water_dir_noise_freq),T=C.s(b.b4w_water_dir_min_noise_fac),B=C.s(b.b4w_water_dst_min_fac),X=C.s(b.b4w_water_waves_hor_fac);s(a,"DST_NOISE_SCALE_0",
e);s(a,"DST_NOISE_SCALE_1",r);s(a,"DST_NOISE_FREQ_0",u);s(a,"DST_NOISE_FREQ_1",v);s(a,"DIR_MIN_SHR_FAC",y);s(a,"DIR_FREQ",D);s(a,"DIR_NOISE_SCALE",z);s(a,"DIR_NOISE_FREQ",t);s(a,"DIR_MIN_NOISE_FAC",T);s(a,"DST_MIN_FAC",B);s(a,"WAVES_HOR_FAC",X)}switch(b.specular_shader){case "PHONG":case "COOKTORR":s(a,"SPECULAR_SHADER","SPECULAR_PHONG");d=b.specular_hardness;break;case "WARDISO":s(a,"SPECULAR_SHADER","SPECULAR_WARDISO"),d=b.specular_slope}a.Hb=new Float32Array([b.specular_intensity,d]);switch(b.diffuse_shader){case "LAMBERT":s(a,
"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.se=[0,0];break;case "OREN_NAYAR":s(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.se=[b.roughness,0];break;case "FRESNEL":s(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL"),a.se=[b.diffuse_fresnel,b.diffuse_fresnel_factor]}a.Re=b.b4w_shallow_water_col;a.Se=b.b4w_shore_water_col;a.Gl=b.b4w_shallow_water_col_fac;a.Il=b.b4w_shore_water_col_fac;s(a,"ABSORB",C.s(b.b4w_water_absorb_factor));s(a,"SSS_STRENGTH",C.s(b.b4w_water_sss_strength));s(a,"SSS_WIDTH",C.s(b.b4w_water_sss_width));
d=a.Ja;e=a.wc;a.Ja=d;a.wc=e}b.b4w_skydome&&(x(a,"special_skydome.glslv","special_skydome.glslf"),b.b4w_procedural_skydome?a.Ef=!0:(t=c?[0.07,0.13,0.58,1]:null,t=n(q[0],t),L(a,t,"u_sky"),a.Ef=!1),w(a,"a_position"),a.Sd=99999);"HALO"===b.type?(c=b.halo,x(a,"halo.glslv","halo.glslf"),s(a,"NUM_RINGS",c.ring_count),s(a,"NUM_LINES",c.line_count),s(a,"NUM_STARS",c.star_tip_count),s(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.wc=["a_position"],a.Fw=c.size,a.Cw=c.hardness/20,a.Ew=c.b4w_halo_rings_color,a.Dw=
c.b4w_halo_lines_color,a.Gw=1/b.b4w_halo_stars_blend_height,a.Hw=b.b4w_halo_stars_min_height,a.Ho=!0):a.Ho=!1;l&&"NORMAL"==l.texture_coords||F&&"NORMAL"==g.texture_coords?s(a,"TEXTURE_COORDS","TEXTURE_COORDS_NORMAL"):l&&"UV"==l.texture_coords?s(a,"TEXTURE_COORDS","TEXTURE_COORDS_UV"):s(a,"TEXTURE_COORDS",0)}a.xa=m;c=b.game_settings.alpha_blend;s(a,"ALPHA","OPAQUE"===c?0:1);s(a,"ALPHA_CLIP","CLIP"===c?1:0);s(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);b.use_vertex_color_paint?(s(a,"VERTEX_COLOR",
1),w(a,"a_color")):s(a,"VERTEX_COLOR",0);a.Pc=b.ambient;a.nf=b.diffuse_intensity;a.ve=b.emit;a.Gb=new Float32Array(b.specular_color);switch(b.specular_shader){case "PHONG":case "COOKTORR":s(a,"SPECULAR_SHADER","SPECULAR_PHONG");c=b.specular_hardness;break;case "WARDISO":s(a,"SPECULAR_SHADER","SPECULAR_WARDISO");c=b.specular_slope;break;default:H.error("B4W Error: unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.Hb=new Float32Array([b.specular_intensity,
c]);switch(b.diffuse_shader){case "LAMBERT":s(a,"DIFFUSE_SHADER","DIFFUSE_LAMBERT");a.se=[0,0];break;case "OREN_NAYAR":s(a,"DIFFUSE_SHADER","DIFFUSE_OREN_NAYAR");a.se=[b.roughness,0];break;case "FRESNEL":s(a,"DIFFUSE_SHADER","DIFFUSE_FRESNEL");a.se=[b.diffuse_fresnel,b.diffuse_fresnel_factor];break;default:H.error("B4W Error: unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.se=[0,0]}b.b4w_wettable?s(a,"WETTABLE",1):s(a,"WETTABLE",0);h(a,b);a=!0}break;case "NODES":a=f(a,
b);break;case "DEPTH":if("LENS_FLARES"===b.name||"PARTICLES"===b.name||b.b4w_water||b.b4w_skydome||b.b4w_collision||"HALO"===b.type)a=!1;else if(p(a,b),a.O)a=!1;else{x(a,"depth.glslv","depth.glslf");w(a,"a_position");c=b.game_settings.alpha_blend;s(a,"ALPHA","OPAQUE"===c?0:1);a.Hc=new Float32Array([1,1,1]);if((b=k("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===c){a.Hc.set(b.scale);s(a,"TEXTURE_COLOR",1);w(a,"a_texcoord");a.hc=new Float32Array([0,0]);if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==
b.texture.d.source)c=n(b),L(a,c,"u_colormap0"),a.hc.set(b.texture.b4w_uv_velocity_trans);"NONE"==b.texture.d.source&&(c=n(b),L(a,c,"u_colormap0"),a.hc.set(b.texture.b4w_uv_velocity_trans))}else s(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.pA=b.b4w_use_ghost,a.gc=b.b4w_collision_id,a.Hn=b.b4w_collision_group,a.In=b.b4w_collision_mask,a.Kk=b.physics.friction,a.Ek=b.physics.elasticity,a=!0):b.b4w_water?(a.ag=!0,a.zA=b.b4w_water_dynamic,a.Hi=b.b4w_water_dst_noise_scale0,a.Ii=b.b4w_water_dst_noise_scale1,
a.Fi=b.b4w_water_dst_noise_freq0,a.Gi=b.b4w_water_dst_noise_freq1,a.wi=b.b4w_water_dir_min_shore_fac,a.ui=b.b4w_water_dir_freq,a.yi=b.b4w_water_dir_noise_scale,a.xi=b.b4w_water_dir_noise_freq,a.vi=b.b4w_water_dir_min_noise_fac,a.Ei=b.b4w_water_dst_min_fac,a.pm=b.b4w_water_waves_hor_fac,a=!0):a=!1;break;case "COLOR_ID":if("LENS_FLARES"===b.name||"PARTICLES"===b.name||b.b4w_skydome||b.b4w_collision||"HALO"===b.type)a=!1;else{p(a,b);a.O=!1;x(a,"color_id.glslv","color_id.glslf");w(a,"a_position");c=b.game_settings.alpha_blend;
s(a,"ALPHA","OPAQUE"===c?0:1);a.Hc=new Float32Array([1,1,1]);if((b=k("use_map_color_diffuse",b.texture_slots)[0])&&"CLIP"===c){a.Hc.set(b.scale);s(a,"TEXTURE_COLOR",1);w(a,"a_texcoord");a.hc=new Float32Array([0,0]);if("IMAGE"==b.texture.d.source||"ENVIRONMENT_MAP"==b.texture.d.source)c=n(b),L(a,c,"u_colormap0"),a.hc.set(b.texture.b4w_uv_velocity_trans);"NONE"==b.texture.d.source&&(c=n(b),L(a,c,"u_colormap0"),a.hc.set(b.texture.b4w_uv_velocity_trans))}else s(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":b.b4w_terrain?
(p(a,b),a.O=!1,a.Lc=S.tc,a.M=!0,x(a,"grass_map.glslv","grass_map.glslf"),w(a,"a_position"),c=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.Ca.a_grass_size={xe:!0,src:[]},c?(a.Ca.a_grass_size.src.push({name:c,Wb:4}),s(a,"DYNAMIC_GRASS_SIZE",1)):s(a,"DYNAMIC_GRASS_SIZE",0),a.Ca.a_grass_color={xe:!0,src:[]},b?(a.Ca.a_grass_color.src.push({name:b,Wb:7}),s(a,"DYNAMIC_GRASS_COLOR",1)):s(a,"DYNAMIC_GRASS_COLOR",0),a=!0):a=!1;break;case "WIREFRAME":"LENS_FLARES"===
b.name||"PARTICLES"===b.name||b.b4w_water||b.b4w_skydome||b.b4w_collision||"HALO"===b.type?a=!1:(x(a,"wireframe.glslv","wireframe.glslf"),w(a,"a_position"),w(a,"a_normal"),w(a,"a_polyindex"),a.M=!0,a.Lj=0,a.Jq=[0,0,0],a=!0);break;default:throw"Wrong batch type: "+a.type;}return a}function p(a,b){var c=b.game_settings;switch(c.alpha_blend){case "ALPHA_SORT":a.O=!0;a.Lc=S.Pm;a.M=!0;break;case "ALPHA":a.O=!0;a.Lc=S.tc;a.M=!0;break;case "CLIP":a.O=!1;a.Lc=S.tc;a.M=!0;break;case "ADD":a.O=!0;a.Lc=S.tc;
a.M=!1;break;case "OPAQUE":a.O=!1;a.Lc=S.tc;a.M=!0;break;default:throw Error("Unknown alpha blend mode: "+alpha_blend);}a.oa=c.use_backface_culling}function n(a,b){var c=a.texture,d=c.d,e=c.image.filepath;d&&b&&X.Hj(d,b,c.image.Rb,e);return d}function k(a,b){for(var c=[],d=b.length,e=0;e<d;e++){var f=b[e];!0==f[a]&&f.texture&&f.texture.d&&c.push(f)}return c}function h(a,b){a.$c=new Float32Array(4);var c=b.raytrace_transparency;a.$c[0]=c.fresnel;a.$c[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.Al=
c.reflect_factor;a.$c[2]=c.fresnel;a.$c[3]=1-c.fresnel_factor/5}function f(a,b){if(!b.use_nodes)return!1;var c=O.xt(b.node_tree,b.uuid);if(!c)return H.error("Failed to create node graph for material "+b.name+", disable nodes"),t(a,b),!0;x(a,"nodes.glslv","nodes.glslf");var d=b.game_settings.alpha_blend;s(a,"ALPHA","OPAQUE"===d?0:1);s(a,"ALPHA_CLIP","CLIP"===d?1:0);s(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?1:0);w(a,"a_position");p(a,b);a.Sd=b.offset_z;a.xa=new Float32Array([b.diffuse_color[0],
b.diffuse_color[1],b.diffuse_color[2],b.alpha]);a.ve=b.emit;a.Pc=b.ambient;h(a,b);b.b4w_wettable?s(a,"WETTABLE",1):s(a,"WETTABLE",0);a.ej=O.yt(c);P.U(c,function(c,d){switch(d.type){case "GEOMETRY_UV":var e=d.data.name,f=d.data.value;f?a.he[f]=e:H.error("Missing UV layer in node ",d.name,"for material ",b.name);break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":e=d.data.name;if(f=d.data.value){a.Ca[e]={xe:!0,src:[{name:f}]};f=0;if("GEOMETRY_VC"==d.type)f=7;else for(var m=
0;m<d.Sa.length;m++){var g="RGB".indexOf(d.Sa[m].identifier);-1<g&&(f|=1<<2-g)}a.Ca[e].src[0].Wb=f}else H.error("Missing vertex color layer in node ",d.name,"for material ",b.name);break;case "GEOMETRY_NO":w(a,"a_normal");break;case "MATERIAL":case "MATERIAL_EXT":e=d.data.value;s(a,"SHADED",1);w(a,"a_normal");s(a,"DIFFUSE_SHADER","DIFFUSE_"+e.diffuse_shader);s(a,"SPECULAR_SHADER","SPECULAR_"+e.specular_shader);break;case "TEXTURE_COLOR":case "TEXTURE_COLOR2":case "TEXTURE_COLOR3":case "TEXTURE_ENVIRONMENT":case "PARALLAX":e=
d.data.name;(f=d.data.value)?(!1!==f.d.ak&&(f.d.ak="TEXTURE_ENVIRONMENT"!=d.type?!0:!1),L(a,f.d,e)):H.error("Missing texture in node ",d.name,"for material ",b.name);break;case "TEXTURE_NORMAL":case "TEXTURE_NORMAL2":case "TEXTURE_NORMAL3":s(a,"CALC_TBN_SPACE",1),w(a,"a_normal"),w(a,"a_tangent"),e=d.data.name,(f=d.data.value)?(f.d.ak=!1,L(a,f.d,e)):H.error("Missing texture in node ",d.name,"for material ",b.name)}});return!0}function t(a,b){x(a,"shadeless.glslv","shadeless.glslf");var c=b.game_settings.alpha_blend;
s(a,"ALPHA","OPAQUE"===c?0:1);s(a,"ALPHA_CLIP","CLIP"===c?1:0);w(a,"a_position");a.xa=new Float32Array([1,0,1,1]);s(a,"VERTEX_COLOR",0);a.Sd=b.offset_z;p(a,b)}function u(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.ax?s(a,"AU_QUALIFIER","attribute"):s(a,"AU_QUALIFIER","uniform"),s(a,"STATIC_BATCH",0)):(s(a,"AU_QUALIFIER","attribute"),s(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(K.ow()?s(a,"WIREFRAME_QUALITY",1):s(a,"WIREFRAME_QUALITY",0),a.Ak?(s(a,"DEBUG_SPHERE",1),a.Sn?s(a,"DEBUG_SPHERE_DYNAMIC",
1):s(a,"DEBUG_SPHERE_DYNAMIC",0)):s(a,"DEBUG_SPHERE",0),s(a,"ALPHA",1));b.cf?(""!==b.xf?(a.Ca.a_bending_col_main={xe:!0,src:[{name:b.xf,Wb:4}]},w(a,"a_bending_col_main"),""!==b.Kb.dp&&""!==b.Kb.cp&&""!==b.Kb.qp?(a.Ca.a_bending_col_detail={xe:!0,src:[{name:b.Kb.dp,Wb:4},{name:b.Kb.cp,Wb:2},{name:b.Kb.qp,Wb:1}]},w(a,"a_bending_col_detail"),w(a,"a_normal"),s(a,"DETAIL_BEND",1)):s(a,"DETAIL_BEND",0),s(a,"MAIN_BEND_COL",1)):s(a,"MAIN_BEND_COL",0),s(a,"WIND_BEND",1)):s(a,"WIND_BEND",0);b.jn?s(a,"BEND_CENTER_ONLY",
1):s(a,"BEND_CENTER_ONLY",0);b.Oi?s(a,"HAIR_BILLBOARD",1):s(a,"HAIR_BILLBOARD",0);!1===b.Bw?s(a,"HAIR_BILLBOARD_SPHERICAL",0):s(a,"HAIR_BILLBOARD_SPHERICAL",1);switch(b.Xk){case "RANDOM":s(a,"HAIR_BILLBOARD_RANDOM",1);s(a,"HAIR_BILLBOARD_JITTERED",0);break;case "JITTERED":s(a,"HAIR_BILLBOARD_RANDOM",0);s(a,"HAIR_BILLBOARD_JITTERED",1);break;default:s(a,"HAIR_BILLBOARD_RANDOM",0),s(a,"HAIR_BILLBOARD_JITTERED",0)}b.ta?s(a,"DYNAMIC_GRASS",1):s(a,"DYNAMIC_GRASS",0);a.ta=b.ta;a.Cc=b.Cc;a.Dc=b.Dc;a.Nb=
b.Nb;a.Yd=b.Yd;a.fd=b.fd;a.Xd=b.Xd;b.Vi?(w(a,"a_influence"),s(a,"SKINNED",1),b.eo?(s(a,"FRAMES_BLENDING",1),s(a,"MAX_BONES",ea.jc)):(s(a,"FRAMES_BLENDING",0),s(a,"MAX_BONES",ea.ed))):(s(a,"SKINNED",0),s(a,"FRAMES_BLENDING",0));b.km?s(a,"VERTEX_ANIM",1):s(a,"VERTEX_ANIM",0);if(b.Vi&&b.km)throw"Skinning and vertex animation are mutually exlusive";b.Ck?s(a,"DISABLE_FOG",1):s(a,"DISABLE_FOG",0);b.Ad&&(a.Ad=b.Ad)}}function w(a,b){var c=a.wc;-1==c.indexOf(b)&&c.push(b)}function s(a,b,c){C.S(a.Ja,b,c)}function B(a,
b){var c=a.Lc,d=a.Hd;a.Ho&&(b=S.ev(b));a.Hq&&(b=m.Hv(a.AA,a.BA,a.yA));c=S.Nz(b,c,d,a.Ca);ja||c.Zk||(delete c.Ae,delete c.ie);a.fc=c;c=b.r.length;a.fj=b.J*c;a:switch(a.Hd){case S.fg:case S.df:case S.Em:d=!0;break a;default:d=!1}d?S.bx(b)?a.Bf=b.ja.length/3*c:a.Bf=b.J/3*c:a.Bf=0;ma&&(a.oc=b)}function q(a,e,f,m,h,k,n,l,p,F){var q=[],C="INSTANCE"==k.b4w_wind_bend_inheritance,t="INSTANCE"==k.b4w_shadow_inheritance,s="INSTANCE"==k.b4w_reflection_inheritance,w=k.b4w_dynamic_grass;if(!l&&w)return q;for(var z=
[],r=[],T=0;T<f.length;T++){var X=f[T],x=V.mi(a.d);x.Oi=k.b4w_hair_billboard;x.Xk=k.b4w_hair_billboard_type;x.ta=w;x.Bw="SPHERICAL"==k.b4w_hair_billboard_geometry;x.ax=!0;C?(x.cf=X.d.cf,x.tm=X.d.tm,x.Yh=X.d.Yh,x.Gg=X.d.Gg,x.xf=X.d.xf,x.Fg=X.d.Fg,x.sg=X.d.sg,x.Kb=X.d.Kb,x.jn=!1,x.Bb=d(X.data.b4w_bounding_box)):x.jn=!0;t&&(x.Cc=X.d.Cc,x.Dc=X.d.Dc,x.Nb=X.d.Nb);s&&(x.Yd=X.d.Yd,x.fd=X.d.fd,x.Xd=X.d.Xd);z.push(x);var P=h[T];P||(P=new Float32Array);F&&V.Ri(n.seed,p);for(var J=new Float32Array(3),M=new Float32Array([0,
0,0,1]),O=[],I=0;I<P.length;I+=4){J[0]=P[I];J[1]=P[I+1];J[2]=P[I+2];var L=P[I+3];if(k.b4w_initial_rand_rotation){switch(k.b4w_rotation_type){case "XYZ":var K=new Float32Array([V.Yb(p),V.Yb(p),V.Yb(p)]);v.normalize(K,K);break;case "Z":K=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+k.b4w_rotation_type;}ka.setAxisAngle(K,k.b4w_rand_rotation_strength*(2*Math.PI*V.Yb(p)-Math.PI),M)}var R=Z.mf(J,L,M);O.push(R)}r.push(O)}for(var ea={},T=0;T<f.length;T++){var Q=m[T],x=
z[T],ma=JSON.stringify(x),O=r[T];if(O.length)for(var ja=f[T].data,la=ja.materials,I=0;I<la.length;I++)if(!S.Io(ja,I))for(var sb=0;sb<Q.length;sb++){var Cb=Q[sb];if("COLOR_ID"!==Cb){var ua=b(Cb);g(ua,la[I],!0)&&(ua.Hd=ja.Hd||S.fg,u(ua,x),ua.Cf=k.uuid,D(ua,ma),ea[ua.id]||(ea[ua.id]={h:ua,gj:[]}),ea[ua.id].gj.push([T,I]))}}}if("JITTERED"==k.b4w_hair_billboard_type)for(T in ea)ea[T].h.bl=k.b4w_hair_billboard_jitter_amp,ea[T].h.cl=k.b4w_hair_billboard_jitter_freq;var uc={},Lb;for(Lb in ea){var Ya=[],vc=
[],ua=ea[Lb].h;for(T in ea[Lb].gj){var Mb=ea[Lb].gj[T][0],Kc,Gc=f[Mb],Vc=ea[Lb].gj[T][1],Vb=r[Mb],Db=z[Mb],Vb=Vb||y(Db),tb={nh:Gc,transform:Vb,$:{},aj:Gc.data,Ob:Vc};if(Db.cf||Db.ta||Db.Oi){var bc=c(Db.tm,Db.Bb,Gc.scale[0]);tb.$.au_wind_bending_amp=[bc];tb.$.au_wind_bending_freq=[Db.Yh];tb.$.au_detail_bending_freq=[Db.Gg];tb.$.au_detail_bending_amp=[Db.Fg];tb.$.au_branch_bending_amp=[Db.sg]}Kc=tb;C||(delete ua.Ca.a_bending_col_main,delete ua.Ca.a_bending_col_detail);var Za=S.sx(Kc,ua.wc,ua.Ca,ua.he,
r[Mb]),cc=Za,mc=r[Mb];cc.Z.au_center_pos=new Float32Array(3*cc.J);for(var wc=mc.length,Y=cc.J/wc,bb=0;bb<wc;bb++)for(var Ra=mc[bb],qa=3*Y*bb,Nb=0;Nb<Y;Nb++)cc.Z.au_center_pos[qa+3*Nb]=Ra[0],cc.Z.au_center_pos[qa+3*Nb+1]=Ra[1],cc.Z.au_center_pos[qa+3*Nb+2]=Ra[2];var Za=cc,va=k.b4w_vcol_from_name,Eb=k.b4w_vcol_to_name,dc=ua,pa=e,Ka=!C,fb=Kc.aj,na=[];if(""!==va&&""!==Eb){var La,Fb=Eb,wa=dc.Ca,Sa=[],Ob=void 0;for(Ob in wa)for(var ec=wa[Ob].src,Wb=0,ub=0;ub<ec.length;ub++){var Xb=ec[ub].Wb;Fb==ec[ub].name&&
Sa.push(Ob,Xb,Wb);Wb+=V.Oe(Xb)}La=Sa;if(0<La.length)for(var Yb=0;Yb<La.length;Yb+=3)na.push({Lg:va,Ki:7,jj:La[Yb],kj:La[Yb+1],Di:La[Yb+2]});else S.Jw(dc.wc,"a_color")&&Eb==fb.active_vcol_name&&na.push({Lg:va,Ki:7,jj:"a_color",kj:7,Di:0})}Ka&&("a_bending_col_main"in pa.Ca&&na.push({Lg:"a_bending_col_main",Ki:4,jj:"a_bending_col_main",kj:4,Di:0}),"a_bending_col_detail"in pa.Ca&&na.push({Lg:"a_bending_col_detail",Ki:7,jj:"a_bending_col_detail",kj:7,Di:0}));for(var Pb=Za,nc=r[Mb],oc=e,vb=na,mb=ua.Ca,
Qb=!1,$a=0;$a<vb.length;$a++){var nb=vb[$a].Lg,gb=oc.oc.Z[nb];if(gb&&0<gb.length){Qb=!0;break}}if(Qb){var wb,Ia=a.d.Bb,A=oc.oc.r[0].a_position,Xa=nc,ia=uc,Ga=new Float32Array(3),sa=new Float32Array(3),U=new Uint32Array(Xa.length);if(!("verts_indices"in ia)){ia.Sc=new Float32Array(3);ia.Rc=new Float32Array(3);ia.lm=new Uint32Array(A.length/3);ia.oh=new Uint32Array(A.length/3);ia.Sc[0]=(Ia.T-Ia.R)/da;ia.Sc[1]=(Ia.D-Ia.A)/da;ia.Sc[2]=(Ia.ga-Ia.ka)/da;ia.Rc[0]=Ia.R;ia.Rc[1]=Ia.A;ia.Rc[2]=Ia.ka;for(var ra=
0;ra<A.length/3;ra++){var cb=V.qc((A[3*ra]-ia.Rc[0])/ia.Sc[0]),Zb=V.qc((A[3*ra+1]-ia.Rc[1])/ia.Sc[1]),ob=V.qc((A[3*ra+2]-ia.Rc[2])/ia.Sc[2]),cb=V.Za(cb,0,da-1),Zb=V.Za(Zb,0,da-1),ob=V.Za(ob,0,da-1);ia.lm[ra]=ra;ia.oh[ra]=ob*Math.pow(da,2)+Zb*da+cb}S.xz(ia.oh,ia.lm,1);ia.$e=new Uint32Array(Math.pow(da,3));for(ra=0;ra<ia.oh.length;ra++)ia.$e[ia.oh[ra]]++;delete ia.oh;for(ra=1;ra<ia.$e.length;ra++)ia.$e[ra]+=ia.$e[ra-1]}for(var Ba=0;Ba<Xa.length;Ba++){Ga[0]=Xa[Ba][0];Ga[1]=Xa[Ba][1];Ga[2]=Xa[Ba][2];
for(var Gb=1E10,xb=-1,Hb=V.qc((Ga[0]-ia.Rc[0])/ia.Sc[0]),yb=V.qc((Ga[1]-ia.Rc[1])/ia.Sc[1]),pb=V.qc((Ga[2]-ia.Rc[2])/ia.Sc[2]),Hb=V.Za(Hb,0,da-1),yb=V.Za(yb,0,da-1),pb=V.Za(pb,0,da-1),za=pb*Math.pow(da,2)+yb*da+Hb,Ca=ia.$e[za],Ma=0==za?0:ia.$e[za-1];Ma<Ca;Ma++){var fc=ia.lm[Ma];sa[0]=A[3*fc];sa[1]=A[3*fc+1];sa[2]=A[3*fc+2];v.sub(sa,Ga,sa);var Ib=v.sqrLen(sa);Ib<=Gb&&(Gb=Ib,xb=fc)}if(-1==xb)for(Ma=0;Ma<A.length/3;Ma++)sa[0]=A[3*Ma],sa[1]=A[3*Ma+1],sa[2]=A[3*Ma+2],v.sub(sa,Ga,sa),Ib=v.sqrLen(sa),Ib<=
Gb&&(Gb=Ib,xb=Ma);U[Ba]=xb}wb=U;for(var qb=Pb.J/nc.length,$a=0;$a<vb.length;$a++){var db=vb[$a].jj,zb=vb[$a].kj,nb=vb[$a].Lg,xc=vb[$a].Ki,gb=oc.oc.Z[nb];switch(db){case "a_bending_col_main":var hb=1;break;case "a_bending_col_detail":hb=3;break;case "a_color":hb=3;break;default:for(var Ab=hb=0;Ab<mb[db].src.length;Ab++)hb+=V.Oe(mb[db].src[Ab].Wb)}if(gb&&0<gb.length){var Lc=V.Oe(xc),ib=V.Oe(zb),gc=xc&zb,Bb=V.Kp(gc);gc!=zb&&H.error("Wrong color extraction from "+nb+" to "+db+".");if("a_bending_col_main"==
db||"a_bending_col_detail"==db)Pb.Z[db]=new Float32Array(Pb.J*ib);for(Ab=0;Ab<nc.length;Ab++){var pc=wb[Ab],yc=pc*Lc,eb=Ab*qb*hb;if(-1!=pc)for(var qc=0;qc<qb;qc++)for(var rc=qc*hb,Ta=0;Ta<Bb.length;Ta++)Bb[Ta]&&(Pb.Z[db][eb+rc+(vb[$a].Di+V.Bh(zb,Ta))]=gb[yc+V.Bh(xc,Ta)])}}else Pb.Z[db]=new Float32Array(0)}}Za=Pb;S.dx(Za)||vc.push(T);Ya.push(Za)}if(vc.length<Ya.length)for(var Rb in vc)S.rq(Ya[Rb]);Za=S.sq(Ya);"PHYSICS"===ua.type?ua.oc=Za:B(ua,Za);q.push(E(ua))}return q}function y(a){return Z.mf(a.e,
a.scale,a.i)}function D(a,b){delete a.id;var c={},d;for(d in a)c[d]=a[d]&&"object"==typeof a[d]?V.Ww(a[d])?a[d]:a[d]instanceof Array&&a[d][0]&&"object"==typeof a[d][0]?["NA"]:a[d]instanceof Array?a[d]:{N:"A"}:a[d];c.Ja=a.Ja;c.ej=a.ej;c.Ca=a.Ca;c.he=a.he;c.Ba=[];for(d=0;d<a.Ba.length;d++)c.Ba.push(X.Us(a.Ba[d]));a.id=JSON.stringify(c)+b}function z(a,b,e,f){e=e||y(f);b={nh:a,transform:e,$:{},aj:a.data,Ob:b};"STATIC"==f.type&&f.cf&&(f=[],f.push(e[0],e[1],e[2]),b.$.au_center_pos=f,e=c(a.b4w_wind_bending_angle,
d(a.data.b4w_bounding_box),a.scale[0]),b.$.au_wind_bending_amp=[e],b.$.au_wind_bending_freq=[a.b4w_wind_bending_freq],b.$.au_detail_bending_amp=[a.b4w_detail_bending_amp],b.$.au_detail_bending_freq=[a.b4w_detail_bending_freq],b.$.au_branch_bending_amp=[a.b4w_branch_bending_amp]);return b}function E(a,b,c){return{h:a,Ob:"number"==typeof b?b:-1,zp:c||null,Vh:!1}}function M(a,c,d){var e=b("WIREFRAME");x(e,"wireframe.glslv","wireframe.glslf");e.Lj=0;e.Ak=!0;e.M=!0;e.Cf=c.name;d?(d=m.io(1,a.F),S.Cy(d,
[a.vd[0],a.wd[1],a.xd[2]],a.F)):d=m.io(a.sa,a.F);S.rq(d,1,!0);d.Z.a_polyindex=S.fv(d);B(e,d);D(e,JSON.stringify(c.d));return e}function x(a,b,c){a.Ja={da:b,ba:c,W:[]};C.Vy(a.Ja)}function L(a,b,c){1==a.Ba.length&&0==a.nb.length&&a.nb.push("default0");c=c||"default"+String(a.Ba.length);-1==a.nb.indexOf(c)&&(a.Ba.push(b),a.nb.push(c))}function R(a){if(!a.Ja)throw"No shaders info for batch "+a.name;a.Zb=C.Qk(a.Ja,a.ej)}var I=r("__boundings"),Q=r("__config"),H=r("__print"),K=r("__extensions"),S=r("__geometry"),
P=r("__graph"),O=r("__nodemat"),T=r("__particles"),m=r("__primitives"),F=r("__scenegraph"),C=r("__shaders"),X=r("__textures"),Z=r("__tsr"),V=r("__util"),v=r("vec3"),ka=r("quat"),ea=Q.u,J=Q.Jf,ma=!1,ja=!1,la=["MAIN","NODES","SHADELESS"],da=20;a.Gv=function(a,b,c){for(var f=0;f<c.length;f++){var m=c[f];if("DYNAMIC"==m.d.type){var g=m.d,h=d(m.data.b4w_bounding_box);g.Bb=h;var k=m.data.b4w_bounding_cylinder_radius,n=g,l=k,p=h;n.Js=I.Ot(l,p);n.jk=I.Mt(k,p);n.Is=I.Nt(l,p);h=I.ji(h,g.G);g.yd=h;h={sa:m.data.b4w_bounding_sphere_radius,
F:m.data.b4w_bounding_sphere_center};g.Bd=h;h=I.pk(h,g.G);g.Cd=h;h=m.data.b4w_bounding_ellipsoid_axes;h={vd:new Float32Array([h[0],0,0]),wd:new Float32Array([0,h[1],0]),xd:new Float32Array([0,0,h[2]]),F:m.data.b4w_bounding_ellipsoid_center};g.kk=h;h=I.ok(h,g.Uf);g.lk=h;h=e(m,m.d,a,!0);m.B=h;if(ea.cg){n=!1;for(h=0;h<m.B.length;h++)if(-1<la.indexOf(m.B[h].h.type)){n=!0;break}n&&(h={},n=M(g.kk,m,!0),n.Sn=!0,u(n,g),h.h=n,m.B.push(h))}}}h=[];for(f=0;f<c.length;f++)m=c[f],"STATIC"==m.d.type&&h.push(m);
c=[];f={};for(g=0;g<h.length;g++)m=h[g],l=m.d,n={},n.Cc=l.Cc,n.Dc=l.Dc,n.Nb=l.Nb,n.ae=l.ae,n.sl=l.sl,n.Uk=l.Uk,n.Yd=l.Yd,n.fd=l.fd,n.Xd=l.Xd,n.jf=l.jf,n.cf=l.cf,n.xf=l.xf,n.Kb=l.Kb,n.Oi=l.Oi,n.Xk=l.Xk,n.ta=l.ta,n.Bi=l.Bi,n.Ck=l.Ck,n.YB=0==b?[0,0]:[Math.floor(l.e[0]/b),Math.floor(l.e[2]/b)],n.wf=l.wf,n.dh=l.dh,n=JSON.stringify(n),f[n]=f[n]||[],f[n].push(m);for(var F in f){n=JSON.parse(F);b=f[F];var m=V.ri("STATIC"),q;for(q in n)m[q]=n[q];m.sm=0;m.Yh=0;m.Gg=0;m.Fg=0;m.sg=0;m.Qi=!1;for(g=0;g<b.length;g++)h=
b[g],n=I.ji(d(h.data.b4w_bounding_box),h.d.G),0==g?m.yd=n:I.Xn(m.yd,n),n=I.pk({sa:h.data.b4w_bounding_sphere_radius,F:h.data.b4w_bounding_sphere_center},h.d.G),0==g?m.Cd=n:I.cv(m.Cd,n),n=h.data.b4w_bounding_ellipsoid_axes,h={vd:new Float32Array([n[0],0,0]),wd:new Float32Array([0,n[1],0]),xd:new Float32Array([0,0,n[2]]),F:h.data.b4w_bounding_ellipsoid_center},m.kk=h,h=I.ok(h,m.Uf),m.lk=h;m.Bb=V.$a(m.yd);m.Bd=V.$a(m.Cd);c.push({ty:m,Kx:b})}for(f=0;f<c.length;f++){g=c[f].ty;p=F=c[f].Kx;q=g;m=a;for(b=
0;b<p.length;b++){var k=p[b],C=e(k,q,m,!1);k.B=C;for(h=0;h<C.length;h++)C[h].Vh=!1}m=[];for(b=0;b<p.length;b++)for(var t=p[b],s=t.B,h=0;h<s.length;h++)if(l=s[h],!l.Vh){n=[];n.push(z(t,l.Ob,y(t.d),q));l.Vh=!0;var v=l.h;m.push({h:v,Sw:n});for(var w=b;w<p.length;w++)for(var k=p[w],C=k.B,D=0;D<C.length;D++){var r=C[D];r.Vh||(l=r.h,v.id==l.id&&(n.push(z(k,r.Ob,y(k.d),q)),r.Vh=!0))}}p=null;for(b=0;b<m.length;b++)for(h=m[b],l=h.h,n=h.Sw,h=S.rx(n,l.wc,l.Ca,l.he),"PHYSICS"===l.type?l.oc=h:B(l,h),h=0;h<n.length;h++){k=
n[h].nh;if(ea.cg&&null===p){r=!1;for(C=0;C<k.B.length;C++)if(-1<la.indexOf(k.B[C].h.type)){r=!0;break}if(r)a:{for(p={},p.h=M(q.Bd,k,!1),p.h.Sn=!1,u(p.h,q),r=0;r<k.B.length;r++)if(k.B[r].h==p.h)break a;k.B.push(p)}}for(C=0;C<k.B.length;C++)r=k.B[C],r.h.id==l.id&&(r.h=l)}for(h=0;h<F.length;h++)F[h].Rm=F[h].d,F[h].d=g}};a.CA=c;a.Gs=d;a.TC=g;a.dk=function(a,b){s(a,"CSM_SECTION0",0);s(a,"CSM_SECTION1",0);s(a,"CSM_SECTION2",0);s(a,"CSM_SECTION3",0);for(var c=0;c<b.length;c++)s(a,"CSM_SECTION"+String(c),
1),s(a,"CSM_SECTION_DIST"+String(c),b[c]);s(a,"PCF_TEXEL_SIZE",1/J.kd)};a.ha=s;a.Va=function(a,b){return C.Zv(a.Ja,b)};a.ou=E;a.ei=L;a.xy=function(a,b,c){c=a.nb.indexOf(c);-1<c&&(a.Ba[c]=b)};a.mu=function(a,c){var d=b("SHADELESS");x(d,"shadeless.glslv","shadeless.glslf");R(d);d.O=!0;d.xa=new Float32Array([c[0],c[1],c[2],0.5]);d.M=!1;d.Lc=S.tc;d.M=!0;d.Hd=S.df;B(d,a);return d};a.ob=R;a.ct=function(a){return(a=a.Zb.rh)?a.u_cube_fog?!0:!1:!1};a.Li=function(a,c,d){var e=b("DEPTH");e.O=!1;x(e,"depth.glslv",
"depth.glslf");var f=e.Ja;C.Qw(f,a.Ja);C.S(f,"SHADOW_SRC",c);C.S(f,"SHADOW_DST",d);e.oa=a.oa;e.Hc=a.Hc;e.ta=a.ta;e.fc=a.fc;e.id=a.id;a.Ba.length&&(e.Ba[0]=a.Ba[0],e.nb[0]=a.nb[0]);e.hc=a.hc;e.wc=a.wc;e.bl=a.bl;e.cl=a.cl;e.Bf=a.Bf;e.fj=a.fj;e.Cf=a.Cf;a.wg||(a.wg=[]);a.wg.push(e);return e};a.Ut=function(){var a=b("DEPTH_PACK");x(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");R(a);a.oa=!0;a.O=!1;a.M=!1;var c=m.Ka();B(a,c);return a};a.$t=function(){var a=b("HUD");x(a,"postprocessing/postprocessing.glslv",
"postprocessing/postprocessing.glslf");R(a);a.oa=!0;a.O=!0;a.Lc=S.tc;a.M=!1;a.ca=new Float32Array([0,0]);a.ma=new Float32Array([1,1]);a.Ta=1;var c=m.Ka();B(a,c);return a};a.Ln=function(a){var c=b("POSTPROCESSING");x(c,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":s(c,"POST_EFFECT","POST_EFFECT_NONE");c.ma=new Float32Array([1,1]);break;case "GRAYSCALE":s(c,"POST_EFFECT","POST_EFFECT_GRAYSCALE");c.ma=new Float32Array([1,1]);break;case "X_BLUR":s(c,
"POST_EFFECT","POST_EFFECT_X_BLUR");c.ma=new Float32Array([1,0]);break;case "Y_BLUR":s(c,"POST_EFFECT","POST_EFFECT_Y_BLUR");c.ma=new Float32Array([0,1]);break;case "X_EXTEND":s(c,"POST_EFFECT","POST_EFFECT_X_EXTEND");c.ma=new Float32Array([1,0]);break;case "Y_EXTEND":s(c,"POST_EFFECT","POST_EFFECT_Y_EXTEND");c.ma=new Float32Array([0,1]);break;default:throw"Wrong postprocessing effect: "+a;}R(c);c.ca=new Float32Array([0,0]);c.Ta=1;c.oa=!0;c.O=!1;c.M=!1;a=m.Ka();B(c,a);return c};a.qB=function(){var a=
b("EDGE");x(a,"postprocessing/postprocessing.glslv","postprocessing/edge.glslf");R(a);a.M=!1;a.oa=!0;a.ca=new Float32Array([0,0]);a.ma=new Float32Array([1,1]);a.Ta=1;var c=m.Ka();B(a,c);return a};a.ru=function(a){var c=b("SSAO");x(c,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");s(c,"SSAO_QUALITY","SSAO_QUALITY_"+a);R(c);c.M=!1;c.oa=!0;c.ca=new Float32Array([0,0]);c.ma=new Float32Array([1,1]);c.Ta=1;a=m.Ka();B(c,a);return c};a.Vt=function(){var a=b("DOF");x(a,"postprocessing/postprocessing.glslv",
"postprocessing/dof.glslf");s(a,"DEPTH_RGBA",1);R(a);a.M=!1;a.oa=!0;a.ca=new Float32Array([0,0]);a.ma=new Float32Array([1,1]);a.Ta=1;var c=m.Ka();B(a,c);return a};a.Xt=function(){var a=b("GLOW");x(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");R(a);a.M=!1;a.oa=!0;a.ca=new Float32Array([0,0]);a.ma=new Float32Array([1,1]);a.Ta=1;var c=m.Ka();B(a,c);return a};a.Yt=function(a,c,d){var e=b("GOD_RAYS");x(e,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");s(e,"DEPTH_RGBA",
a);s(e,"WATER_EFFECTS",c);s(e,"STEPS_PER_PASS",C.s(d,1));R(e);e.M=!1;e.oa=!0;e.ca=new Float32Array([0,0]);e.ma=new Float32Array([1,1]);e.Ta=1;a=m.Ka();B(e,a);return e};a.Zt=function(){var a=b("GOD_RAYS_COM");x(a,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");R(a);a.M=!1;a.oa=!0;a.ca=new Float32Array([0,0]);a.ma=new Float32Array([1,1]);a.Ta=1;var c=m.Ka();B(a,c);return a};a.nu=function(){var a=b("SKY");x(a,"procedural_skydome.glslv","procedural_skydome.glslf");s(a,"NUM_LIGHTS",
1);s(a,"WATER_EFFECTS",1);R(a);a.M=!1;a.oa=!0;a.ca=new Float32Array([0,0]);a.ma=new Float32Array([1,1]);a.Ta=1;var c=m.Cv();B(a,c);return a};a.Lt=function(a){var c=b("BLUR_DEPTH");x(c,"postprocessing/postprocessing.glslv","postprocessing/blur_depth.glslf");R(c);c.M=!1;c.oa=!0;c.ca=new Float32Array([0,0]);c.ma=new Float32Array("X"===a?[1,0]:[0,1]);c.Ta=1;a=m.Ka();B(c,a);return c};a.Ht=function(){var a=b("ANTIALIASING");x(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");
s(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY");R(a);a.M=!1;a.oa=!0;a.ca=new Float32Array([0,0]);a.ma=new Float32Array([1,1]);a.Ta=1;var c=m.Ka();B(a,c);return a};a.pu=function(a){var c=b("SMAA");x(c,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");s(c,"AA_METHOD","AA_METHOD_SMAA_HIGH");s(c,"SMAA_PASS",a);R(c);c.M=!1;c.oa=!0;c.ca=new Float32Array([0,0]);c.ma=new Float32Array([1,1]);c.Ta=1/ea.wb;a=m.Ka();B(c,a);return c};a.au=function(a){var c=b("LANCZOS");x(c,"postprocessing/postprocessing.glslv",
"postprocessing/lanczos.glslf");R(c);c.M=!1;c.oa=!0;c.ca=new Float32Array([0,0]);c.Ta=1/ea.wb;"LANCZOS_X"==a?c.ma=new Float32Array([1,0]):"LANCZOS_Y"==a&&(c.ma=new Float32Array([0,1]));a=m.Ka();B(c,a);return c};a.Rt=function(){var a=b("COMPOSITING");x(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");R(a);a.M=!1;a.oa=!0;a.ca=new Float32Array([0,0]);a.ma=new Float32Array([1,1]);a.Ta=1;var c=m.Ka();B(a,c);return a};a.du=function(a){var c=b("MOTION_BLUR");x(c,"postprocessing/postprocessing.glslv",
"postprocessing/motion_blur.glslf");s(c,"BLUR_DECAY_THRESHOLD",C.s(a));R(c);c.oa=!0;c.O=!1;c.M=!1;a=m.Ka();B(c,a);return c};a.Gt=function(){var a=b("ANAGLYPH");x(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");R(a);a.oa=!0;a.O=!1;a.M=!1;var c=m.Ka();B(a,c);return a};a.rB=function(){var a=b("MAIN");x(a,"line.glslv","line.glslf");s(a,"NUM_POINTS",2);R(a);a.oa=!1;a.O=!1;a.M=!1;a.xa=new Float32Array([0,1,0,1]);a.Hd=S.Fm;a.kx=new Float32Array([0,0,0,1,1,1]);var c=m.Fv();B(a,c);
return a};a.bu=function(){var a=b("LUMINANCE");x(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");R(a);a.M=!1;a.oa=!0;a.ca=new Float32Array([0,0]);a.ma=new Float32Array([1,1]);a.Ta=1;var c=m.Ka();B(a,c);return a};a.It=function(){var a=b("LUMINANCE");x(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");R(a);a.M=!1;a.oa=!0;a.ca=new Float32Array([0,0]);a.ma=new Float32Array([1,1]);a.Ta=1;var c=m.Ka();B(a,c);return a};a.cu=function(){var a=b("LUMINANCE_X_BLUR");
x(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");R(a);a.M=!1;a.oa=!0;a.ca=new Float32Array([0,0]);a.ma=new Float32Array([1,1]);a.Ta=1;var c=m.Ka();B(a,c);return a};a.Jt=function(a){var c=b("POSTPROCESSING");x(c,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");switch(a){case "X_BLUR":c.ma=new Float32Array([1,0]);break;case "Y_BLUR":c.ma=new Float32Array([0,1]);break;default:throw"Wrong postprocessing effect for bloom blur: "+a;}R(c);c.ca=
new Float32Array([0,0]);c.Ta=1;c.oa=!0;c.O=!1;c.M=!1;a=m.Ka();B(c,a);return c};a.Kt=function(){var a=b("BLOOM");x(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");R(a);a.M=!1;a.oa=!0;a.ca=new Float32Array([0,0]);a.ma=new Float32Array([1,1]);a.Ta=1;var c=m.Ka();B(a,c);return a};a.Hh=function(a,b,c){var d=a.Ta;a.ca[0]=b*a.ma[0]*d;a.ca[1]=c*a.ma[1]*d};a.jd=function(a,b){a.Ta=b};a.pt=function(a){for(var b=a.Ba,c=0;c<b.length;c++)X.Ku(b[c].Ua);S.ot(a.fc)}};b4w.module.__nodemat=function(a,r){function b(a){var b=!1,c=!1;M.U(a,function(a,d){if("MATERIAL"==d.type||"MATERIAL_EXT"==d.type)c=!0;"TEXTURE_NORMAL"==d.type&&(b=!0)});return b&&!c?!1:!0}function c(a){M.U(a,function(b,c){for(var e=c.X,f=c.Sa,g=0;g<e.length;g++)d(a,e[g],b,g,1);for(g=0;g<f.length;g++)d(a,f[g],b,g,0)})}function d(a,b,c,d,e){if(b.dd){var f=!0;M.Ze(a,function(a,b,g){if(!e&&a==c&&g[0]==d||e&&b==c&&g[1]==d)f=!1});f&&(b.dd=!1)}}function e(a){var b=[];M.U(a,function(c,d){switch(d.type){case "TRANSLUCENCY":M.Ze(a,
function(a,e,f){a==c&&"Translucency"==d.Sa[f[0]].name&&b.push(a,e,[f[0]+1,f[1]+1])})}});for(var c=0;c<b.length;c+=3)M.Qc(a,b[c],b[c+1],b[c+2])}function l(a,b){var c=[];M.U(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function g(a){var b=[];M.U(a,function(a,c){"REPLACE"==c.type&&b.push(a,c);"PARALLAX"==c.type&&b.push(a,c);"REROUTE"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("REPLACE"==e.type){var f=M.ye(a,d,0),g=M.ye(a,d,1),
e=M.bd(a,f,d,0),h=M.bd(a,g,d,0);M.gd(a,f,d,-1);M.gd(a,g,d,-1);if(1==e[1])var g=f,k=e[0];else k=h[0];e=[];for(h=0;h<M.Je(a,d);h++){var n=M.ze(a,d,h),l=M.bd(a,d,n,0)[1];M.Qc(a,g,n,[k,l]);e.push(d,n)}for(h=0;h<e.length;h+=2)M.gd(a,e[h],e[h+1],-1)}else if("PARALLAX"==e.type)g=M.ye(a,d,1),-1!=g&&(h=M.ye(a,g,0),M.gd(a,g,d,-1),-1!=h&&M.gd(a,h,g,-1),d=M.Pa(a,g),e.data=d.data,e.$[0]=d.$[0],M.Hf(a,g)),e.X.splice(1,1);else if("REROUTE"==e.type){for(var g=M.ye(a,d,0),k=M.Je(a,d),e=[],f=[],p=[],h=0;h<k;h++)n=
M.ze(a,d,h),l=f.indexOf(n),-1!=l?p[l]+=1:(f.push(n),p.push(1),e.push(d,n));if(-1!=g)for(k=M.bd(a,g,d,0)[0],h=0;h<f.length;h++)for(n=0;n<p[h];n++)l=M.bd(a,d,f[h],n)[1],M.Qc(a,g,f[h],[k,l]);for(h=0;h<e.length;h+=2)M.gd(a,e[h],e[h+1],-1)}}}function p(a){var b=[];M.U(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_UV"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<
c.length;h++){var n=c[h];if(k(f,n.Fa)){g=[];h=M.Je(a,e);for(q=0;q<h;q++){var l=M.ze(a,e,q),p=M.bd(a,e,l,0);g.push(e,l,p);M.Qc(a,n.id,l,p)}for(var q=0;q<g.length;q+=3)M.gd(a,g[q],g[q+1],0);M.Hf(a,e);g=!1;break}}g&&(n={id:e,Fa:f},c.push(n))}}function n(a){var b=[];M.U(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],f=b[d+1],g=!0,h=0;h<c.length;h++){var n=c[h];if(!(2<=n.$i.length)&&k(f,n.Fa)){for(var h=[],l=M.Oo(a,e),g=
{},p=0;p<l;p++){var q=M.ye(a,e,p);q in g||(g[q]=0);var t=M.bd(a,q,e,g[q]++);h.push(q,e,t)}for(var l=[],g=M.Je(a,e),s={},p=0;p<g;p++)q=M.ze(a,e,p),q in s||(s[q]=0),t=M.bd(a,e,q,s[q]++),l.push(e,q,t);for(var g=h.concat(l),p=0;p<g.length;p+=3)M.gd(a,g[p],g[p+1],0);M.Hf(a,e);p={Fa:f,Zu:h,$u:l};n.$i.push(p);g=!1;break}}g&&(n={id:e,Fa:f,$i:[]},c.push(n))}for(d=0;d<c.length;d++){n=c[d];e=n.$i.length;l=n.Fa.X.length;g=n.Fa.Sa.length;for(h=0;h<e;h++){t=n.$i[h];p=t.Fa;f=t.Zu;s=t.$u;n.Fa.X=n.Fa.X.concat(p.X);
n.Fa.Sa=n.Fa.Sa.concat(p.Sa);for(p=0;p<n.Fa.X.length;p++)n.Fa.X[p].identifier+=L.qc(p/l)+1;for(p=0;p<n.Fa.Sa.length;p++)n.Fa.Sa[p].identifier+=L.qc(p/g)+1;for(p=0;p<f.length;p+=3)q=f[p],t=f[p+2],t[1]+=(h+1)*l,M.Qc(a,q,n.id,t);for(p=0;p<s.length;p+=3)q=s[p+1],t=s[p+2],t[0]+=(h+1)*g,M.Qc(a,n.id,q,t)}switch(e){case 1:n.Fa.type+="2";break;case 2:n.Fa.type+="3"}M.Hf(a,n.id);M.Zm(a,n.id,n.Fa)}}function k(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":case "GEOMETRY_UV":return a.data.value==
b.data.value;case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function h(a){var b=[];M.U(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],f=!1,g=[],h=[],k=[[],[],[]],n=M.Je(a,d),l=0;l<n;l++){var p=M.ze(a,d,l);if("SEPRGB"!=M.Pa(a,p).type){f=!1;break}g.push(d,p);for(var q={},t=M.Je(a,p),f=0;f<t;f++){var s=M.ze(a,p,
f);s in q||(q[s]=0);var u=M.bd(a,p,s,q[s]++);g.push(p,s);k[u[0]].push(d,s,u)}h.push(p);f=!0}if(f){for(l=d=n=0;l<k.length;l++)k[l].length&&(n++,d|=1<<2-l);if(n){e.type+=n;e.Sa=[];for(l=0;l<k.length;l++)if(k[l].length)for(e.Sa.push({tb:0,identifier:"RGB"[l],dd:!0,name:"RGB"[l]}),f=0;f<k[l].length;f+=3)k[l][f+2][0]=L.Bh(d,l);for(l=0;l<g.length;l+=2)M.gd(a,g[l],g[l+1],0);for(l=0;l<h.length;l++)M.Hf(a,h[l]);for(l=0;l<k.length;l++)for(f=0;f<k[l].length;f+=3)M.Qc(a,k[l][f],k[l][f+1],k[l][f+2])}}}}function f(a,
b,c){var d=b.name,e=b.type,g=[],h=[],k=[],n=[],l=null;switch(e){case "CAMERA":h=[];k=D(b);break;case "COMBRGB":h=y(b);k=D(b);break;case "GEOMETRY":a:{for(var e=b.outputs,p=0;p<e.length;p++)if(e[p].is_linked){e=!0;break a}e=!1}if(!e)return!0;e=u(b,c);if(!e)return E.error("Geometry output is not supported"),!1;switch(e){case "GEOMETRY_UV":l=t("param_GEOMETRY_UV_a");p=t("param_GEOMETRY_UV_v");g.push(z(l));g.push(z(p));k.push(s(b,"UV"));n.push(z(p));l={name:l,value:b.uv_layer};break;case "GEOMETRY_VC":l=
t("param_GEOMETRY_VC_a");p=t("param_GEOMETRY_VC_v");g.push(z(l));g.push(z(p));k.push(s(b,"Vertex Color"));n.push(z(p));l={name:l,value:b.color_layer};break;case "GEOMETRY_NO":k.push(s(b,"Normal"));break;case "GEOMETRY_FB":k.push(s(b,"Front/Back"));break;case "GEOMETRY_VW":k.push(s(b,"View"));break;case "GEOMETRY_GL":k.push(s(b,"Global"))}break;case "GROUP":switch(b.node_tree_name){case "LINEAR_TO_SRGB":e="LINEAR_TO_SRGB";break;case "NORMAL_VIEW":e="NORMAL_VIEW";break;case "REPLACE":e="REPLACE";break;
case "SRGB_TO_LINEAR":e="SRGB_TO_LINEAR";break;case "REFLECT":e="REFLECT";break;case "PARALLAX":e="PARALLAX";p=t("temp_texture");n.push(z(p));break;case "CLAMP":e="CLAMP";break;case "TRANSLUCENCY":e="TRANSLUCENCY";break;default:return E.error("Wrong group node: "+b.node_tree_name),!1}h=y(b);k=D(b);"TRANSLUCENCY"==b.node_tree_name&&(p=q("TranslucencyParams","TranslucencyParams",[0,0,0,0]),p.dd=k[0].dd,k.push(p));break;case "NORMAL":h=y(b);k=D(b);p=s(b,"Normal");n.push(z(t("param_NORMAL_Normal"),p.tb,
3));break;case "MAPPING":h.push(w(b,"Vector"));k.push(s(b,"Vector"));if(0!=R.length(b.translation)||0!=R.length(b.rotation)||b.use_max||b.use_min){var e="MAPPING_HEAVY",r=b.rotation,p=I.create(),B=Math.cos(r[0]),x=Math.cos(r[1]),H=Math.cos(r[2]),K=Math.sin(r[0]),la=Math.sin(r[1]),r=Math.sin(r[2]),da=B*H,G=B*r,aa=K*H,fa=K*r;p[0]=x*H;p[1]=x*r;p[2]=-la;p[3]=la*aa-G;p[4]=la*fa+da;p[5]=x*K;p[6]=la*da+fa;p[7]=la*G-aa;p[8]=x*B;B=b.scale;x=new Float32Array([B[0],0,0,0,B[1],0,0,0,B[2]]);B=I.create();I.multiply(p,
x,B);p=b.translation;B=L.tx(B,Q.create());B[12]=p[0];B[13]=p[1];B[14]=p[2];n.push(z(t("param_MAPPING_HEAVY_trs_matrix"),B,16));n.push(z(t("param_MAPPING_HEAVY_use_min"),~~b.use_min,1));n.push(z(t("param_MAPPING_HEAVY_use_max"),~~b.use_max,1));n.push(z(t("param_MAPPING_LIGHT_min_clip"),b.min,3));n.push(z(t("param_MAPPING_LIGHT_max_clip"),b.max,3))}else e="MAPPING_LIGHT",n.push(z(t("param_MAPPING_LIGHT_scale"),b.scale,3));break;case "MATERIAL":case "MATERIAL_EXT":l=b.material;if(!l)return E.error("Emtpy material slot in node: "+
b.name),!1;H=w(b,"Color");H.tb.splice(3);h.push(H);(H=w(b,"Alpha"))?h.push(H):h.push(q("Alpha","Alpha",1));H=w(b,"Spec");H.tb.splice(3);h.push(H);K=w(b,"Normal");K.tb.splice(3);h.push(K);k.push(s(b,"Color"));k.push(s(b,"Alpha"));k.push(s(b,"Normal"));"MATERIAL_EXT"==e&&((H=w(b,"Emit"))?h.push(H):h.push(q("Emit","Emit",0)),H=w(b,"Translucency"),H.tb=0,H.name="Translucency",H.identifier="Translucency",H?h.push(H):h.push(q(H.name,H.identifier,H.tb)),H=w(b,"Translucency"),H.tb=[0,0,0,0],H.name="TranslucencyParams",
H.identifier="TranslucencyParams",H?h.push(H):h.push(q(H.name,H.identifier,H.tb)),k.push(s(b,"Diffuse")),k.push(s(b,"Spec")));switch(l.specular_shader){case "COOKTORR":case "PHONG":p=l.specular_hardness;break;case "WARDISO":p=l.specular_slope}switch(l.diffuse_shader){case "LAMBERT":x=B=0;break;case "OREN_NAYAR":B=l.roughness;x=0;break;case "FRESNEL":B=l.diffuse_fresnel,x=l.diffuse_fresnel_factor}n.push(z(t("param_MATERIAL_diffuse"),[b.use_diffuse?1:0,B,x],3));n.push(z(t("param_MATERIAL_spec"),[b.use_specular?
1:0,l.specular_intensity,p],3));n.push(z(t("param_MATERIAL_norm"),K.dd?1:0,1));l={name:b.name,value:l};break;case "MATH":switch(b.operation){case "ADD":e="MATH_ADD";break;case "SUBTRACT":e="MATH_SUBTRACT";break;case "MULTIPLY":e="MATH_MULTIPLY";break;case "DIVIDE":e="MATH_DIVIDE";break;case "SINE":e="MATH_SINE";break;case "COSINE":e="MATH_COSINE";break;case "TANGENT":e="MATH_TANGENT";break;case "ARCSINE":e="MATH_ARCSINE";break;case "ARCCOSINE":e="MATH_ARCCOSINE";break;case "ARCTANGENT":e="MATH_ARCTANGENT";
break;case "POWER":e="MATH_POWER";break;case "LOGARITHM":e="MATH_LOGARITHM";break;case "MINIMUM":e="MATH_MINIMUM";break;case "MAXIMUM":e="MATH_MAXIMUM";break;case "ROUND":e="MATH_ROUND";break;case "LESS_THAN":e="MATH_LESS_THAN";break;case "GREATER_THAN":e="MATH_GREATER_THAN";break;case "MODULO":e="MATH_MODULO";break;default:return E.error("Unsupported MATH operation: "+b.operation),!1}h=y(b);k=D(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":e="MIX_RGB_MIX";break;case "ADD":e="MIX_RGB_ADD";
break;case "MULTIPLY":e="MIX_RGB_MULTIPLY";break;case "SUBTRACT":e="MIX_RGB_SUBTRACT";break;case "SCREEN":e="MIX_RGB_SCREEN";break;case "DIVIDE":e="MIX_RGB_DIVIDE";break;case "DIFFERENCE":e="MIX_RGB_DIFFERENCE";break;case "DARKEN":e="MIX_RGB_DARKEN";break;case "LIGHTEN":e="MIX_RGB_LIGHTEN";break;case "OVERLAY":e="MIX_RGB_OVERLAY";break;case "DODGE":e="MIX_RGB_DODGE";break;case "BURN":e="MIX_RGB_BURN";break;case "HUE":e="MIX_RGB_HUE";break;case "SATURATION":e="MIX_RGB_SATURATION";break;case "VALUE":e=
"MIX_RGB_VALUE";break;case "COLOR":e="MIX_RGB_COLOR";break;case "SOFT_LIGHT":e="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":e="MIX_RGB_LINEAR_LIGHT";break;default:return E.error("Unsupported MIX_RGB blend type: "+b.blend_type),!1}h=y(b);k=D(b);break;case "OUTPUT":h=y(b);k=[];break;case "RGB":p=s(b,"Color");k.push(p);n.push(z(t("param_RGB_Color"),p.tb,3));break;case "SEPRGB":h=y(b);k=D(b);break;case "TEXTURE":if(!b.texture)return E.error("No texture attached to node: "+b.name),!1;a:{e=b.outputs;
l=!1;for(p=0;p<e.length;p++)if(B=e[p],B.is_linked)switch(B.identifier){case "Color":e="ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";break a;case "Normal":e="TEXTURE_NORMAL";break a;case "Value":l=!0;break;default:throw"Unknown texture output";}e=l?"ENVIRONMENT_MAP"==b.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR":void 0}h.push(w(b,"Vector"));if("TEXTURE_COLOR"==e||"TEXTURE_ENVIRONMENT"==e)k.push(s(b,"Color")),k.push(s(b,"Value"));"TEXTURE_NORMAL"==e&&(k.push(s(b,"Normal")),
k.push(s(b,"Value")));p=t("param_TEXTURE_texture");n.push(z(p));l={name:p,value:b.texture};break;case "VALUE":p=s(b,"Value");k.push(p);n.push(z(t("param_VALUE_Value"),p.tb,1));break;case "VECT_MATH":switch(b.operation){case "ADD":e="VECT_MATH_ADD";break;case "SUBTRACT":e="VECT_MATH_SUBTRACT";break;case "AVERAGE":e="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":e="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":e="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":e="VECT_MATH_NORMALIZE";break;default:return E.error("Unsupported VECT_MATH operation: "+
b.operation),!1}h=y(b);k=D(b);break;default:h=y(b),k=D(b)}d={name:d,type:e,Wh:g,X:h,Sa:k,$:n,data:l};M.Zm(a,M.yv(a),d);if(d="GEOMETRY"==b.type)a:{d=b.outputs;for(h=g=0;h<d.length;h++)if(d[h].is_linked&&g++>c){d=!0;break a}d=!1}return d&&!f(a,b,++c)?!1:!0}function t(a){H[a]||(H[a]=0);var b=a+H[a],b=b.replace(/ /g,"_").replace(/\//g,"_");H[a]++;return b}function u(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var f=c[e];if(f.is_linked&&!(d++<b))switch(f.identifier){case "UV":return"GEOMETRY_UV";
case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";default:return null}}}function w(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return B(e)}return null}function s(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return B(e)}return null}function B(a){return{name:a.name,identifier:a.identifier,dd:a.is_linked,tb:L.Wg(a.default_value)?
a.default_value.slice(0):a.default_value}}function q(a,b,c){return{name:a,identifier:b,dd:!1,tb:c}}function y(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=B(a.inputs[c]);d.tb.length&&d.tb.splice(3);b.push(d)}return b}function D(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=B(a.outputs[c]);b.push(d)}return b}function z(a,b,c){b=null===b||void 0===b?null:x.s(b,c);return{name:a,value:b}}var E=r("__print"),M=r("__graph"),x=r("__shaders"),L=r("__util"),R=r("vec3"),I=r("mat3"),Q=r("mat4"),H={},
K={};a.xt=function(a,d){if(d in K)return K[d];for(var k=M.create(),q=a.nodes,m=0;m<q.length;m++)if(!f(k,q[m],0))return K[d]=null;q=a.links;for(m=0;m<q.length;m++)for(var F=q[m],C=l(F.from_node,k),t=l(F.to_node,k),s=0;s<C.length;s++)for(var u=0;u<t.length;u++){for(var y=C[s],w=t[u],z=M.Pa(k,y),D=M.Pa(k,w),r=k,B=D,D=[],x=F.from_socket.identifier,I=F.to_socket.identifier,G=z.Sa,z=0;z<G.length;z++)if(G[z].identifier==x){D.push(z);break}B=B.X;for(z=0;z<B.length;z++)if(B[z].identifier==I){D.push(z);break}2==
D.length&&M.Qc(r,y,w,D)}e(k);m=a.nodes;q=null;for(F=0;F<m.length;F++)C=m[F],"OUTPUT"==C.type&&(q=C);q?m=l(q,k)[0]:(E.error("No output in node material"),m=-1);if(-1==m)return K[d]=null;g(k);k=M.Mz(k,m,M.Pq);c(k);p(k);n(k);h(k);return b(k)?K[d]=k:(E.error("Material has normalmap node but no material node"),K[d]=null)};a.yt=function(a){var b=[],c={};H={};var d=M.vq(a);M.U(d,function(a,d){var e;e=[];for(var f=[],g=[],h=[],k=[],n=[],l=0;l<d.X.length;l++){var p=d.X[l];p.dd?(e.push(null),f.push(null)):
(e.push(t("in_"+d.type+"_"+p.identifier)),f.push(x.s(p.tb,0)))}for(l=0;l<d.Sa.length;l++)p=d.Sa[l],p.dd?g.push(null):g.push(t("out_"+d.type+"_"+p.identifier));for(l=0;l<d.$.length;l++)p=d.$[l],h.push(p.name),k.push(p.value);for(l=0;l<d.Wh.length;l++)n.push(d.Wh[l].name);e={id:d.type,X:e,Po:f,Sa:g,$:h,xp:k,Wh:n};b.push(e);c[a]=e});M.Ze(d,function(a,b,e){var f=M.Pa(d,a);M.Pa(d,b);var g=f.Sa[e[0]];a=c[a].Sa;b=c[b].X;f=a[e[0]]||t("out_"+f.type+"_"+g.identifier);a[e[0]]=f;b[e[1]]=f});return b};a.pa=function(){for(var a in K)delete K[a]}};b4w.module.__animation=function(a,r){function b(a,b){a.f.type=T;var c=b.frame_start,d=b.frame_end-c+1;a.f.start=c;a.f.Sb=c;a.f.length=d;for(d=c=0;d<a.data.b4w_vertex_anim.length;d++){var e=a.data.b4w_vertex_anim[d];if(e==b)break;else c+=e.frame_end-e.frame_start+1}a.f.sA=c}function c(a){return(a=a.animation_data)&&a.nla_tracks?a.nla_tracks:null}function d(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==c.type)return c.object}}function e(a){a.f&&(a.f.play=!1,delete a.f.ao)}function l(a,
b){if(!b.fcurves.length)throw Error('No fcurves in action "'+b.name+'"');var c=b.frame_range,e=b.d;a.f.action=b.name;a.f.Zj=c;a.f.es=e.Zx;a.f.ds=e.Ks;a.f.start=c[0];a.f.Sb=c[0];a.f.length=c[1]-c[0];var c=e.np,h=d(a);if(I.So(a)){a.f.type=K;var k=g(a,b);k||(c=n(a),k=f(a,b,c),a.jg.push(b,k));a.f.e=k.e;a.f.cb=k.cb}else if(h)a.f.type=S,k=g(a,b),k||(c=a.d.Ad,k=f(h,b,c),a.jg.push(b,k)),a.f.e=k.e,a.f.cb=k.cb;else if(x.uf(a)&&(e.$.volume||e.$.pitch))a.f.volume=e.$.volume||null,a.f.pitch=e.$.pitch||null,a.f.type=
m;else{var l=[],k=[],q=p(a.constraints);q&&(h=q.target,q=q.subtarget,k=g(a,b),k||(l=h.pose.bones,k=I.Qg(h.data.bones,"name",q),k=f(h,b,[-1<k?{on:k,Eg:0,nj:I.Qg(l,"name",q),mm:-1}:null]),a.jg.push(b,k)),l=k.e,k=k.cb,a.f.Yz=I.ic("name",q,h.pose.bones).Yj);if(0<l.length)a.f.e=l,a.f.cb=k,a.f.type=P;else if(e=e.$.tsr){a.f.e=[];a.f.cb=[];for(h=0;h<c;h++)a.f.e.push(e.subarray(8*h,8*h+4)),a.f.cb.push(e.subarray(8*h+4,8*h+8));a.f.type=O}else E.warn('B4W Warning: Incompatible action "'+b.name+'" has been applied to object "'+
a.name+'"'),a.f.type=F}}function g(a,b){for(var c=a.jg,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function p(a){for(var b=0;b<a.length;b++){var c=a[b];if("COPY_LOCATION"==c.type){var d=c.target;if(d&&"ARMATURE"==d.type)return c}}return!1}function n(a){var b=a.data.bones;a=a.pose.bones;for(var c={},d=0;d<b.length;d++){var e=b[d].name;c[e]={on:d,Eg:d,nj:I.Qg(a,"name",e),mm:-1}}return c}function k(a,b){if(a.f&&(a.f.play||0==b)){var c=a.d,d=a.f.Sb,f=a.f.start,g=a.f.length,k,d=d+b*H.fb;if(d>=
f+g)switch(k=a.f.ao,a.f.V){case V:d=(d-f)%g+f;a.f&&x.uf(a)&&x.Az(a);break;case v:d=f;e(a);break;case ka:d=f+g-1E-6,e(a)}a.f.Sb=d;a.d.time=(d-f)/H.fb;var n=a.f.type;switch(n){case K:case S:var f=h(a.f,d,ea),d=f[0],l=f[1],f=f[2],g=a.f.e,p=a.f.cb;c.rj=p[d];c.qj=p[l];c.Dj=g[d];c.Cj=g[l];c.Mi=f;n===K&&L.Y(a);break;case P:f=h(a.f,d,ea);d=f[0];l=f[1];f=f[2];g=a.f.e;p=a.f.cb;c=a.f.Yz;g=I.hi(g[d],g[l],f);f=I.hi(p[d],p[l],f);d=R.create();R.Wp(g,d);R.uj(f,d);R.multiply(d,c,d);L.lc(a,R.Tk(d));L.Y(a);break;case O:l=
f=h(a.f,d,ea);(c=J)||(c=new Float32Array(4));var g=l[0],d=l[1],l=l[2],n=a.f.e,p=n[g][1],q=n[g][2],t=n[d][1],C=n[d][2];c[0]=(1-l)*n[g][0]+l*n[d][0];c[1]=(1-l)*p+l*t;c[2]=(1-l)*q+l*C;g=c;c=f;(d=ja)||(d=new Float32Array(4));l=a.f.cb;Q.slerp(l[c[0]].subarray(0,4),l[c[1]].subarray(0,4),c[2],d);c=d;d=f[2];l=a.f.e;f=(1-d)*l[f[0]][3]+d*l[f[1]][3];a.f.am&&(d=ma,L.Co(a,d),I.Kh(g,d,b,a.f.am,g));a.f.yl&&(d=la,L.xo(a,d),I.dq(c,d,b,a.f.yl,c));L.lc(a,g);L.Pe(a,c);L.Qe(a,f);L.Y(a);z.$b(a);break;case T:g=a.f;(f=ea)||
(f=Array(3));n=d-g.start;0>n&&(n=0);n>=g.length&&(n=g.length);d=Math.floor(n);l=d+1;n-=d;g.V!=V&&l==g.length&&(l=d-=1,n=1);g=g.sA;f[0]=d+g;f[1]=l+g;f[2]=n;f=ea;c.Jj=f[0];c.rA=f[2];break;case m:f=h(a.f,d,ea);c=f[0];g=f[1];f=f[2];a.f.volume&&x.$p(a,(1-f)*a.f.volume[c]+f*a.f.volume[g]);a.f.pitch&&x.mj(a,(1-f)*a.f.pitch[c]+f*a.f.pitch[g]);break;case F:break;default:throw"Unknown animation type:"+n;}k&&k(a)}}function h(a,b,c){c||(c=Array(3));var d=a.Zj[0],e=a.Zj[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.es;
e=Math.floor(b);a=a.ds[e]?b-e:0;c[0]=e;c[1]=e+1;c[2]=a;return c}function f(a,b,c){for(var d=a.pose.bones,e=[],f=[],g=b.d.np,m=0;m<g;m++){for(var h=0;h<d.length;h++){var k=d[h],n=R.create(),l=b.d.Ps[k.name];l&&R.copy(l.subarray(8*m,8*m+8),n);k.Um=n;k.bi=!1}h=t(a,c);e.push(h.e);f.push(h.cb)}new Float32Array(4);new Float32Array(4);for(m=0;m<f.length-1;m++)for(a=f[m],b=f[m+1],h=0;h<a.length;h+=4)0>a[h]*b[h]+a[h+1]*b[h+1]+a[h+2]*b[h+2]+a[h+3]*b[h+3]&&(b[h]*=-1,b[h+1]*=-1,b[h+2]*=-1,b[h+3]*=-1);return{e:e,
cb:f}}function t(a,b){var c=[],d=[],e=a.pose.bones,f=new Float32Array(4),m=new Float32Array(4),g;for(g in b){var h=b[g],k=h.Eg,n=e[h.nj],h=f,l=m,p=n.Zr,q=p[p.length-1],F=q.Xj;q.bi||R.identity(F);for(q=p.length-1;0<=q;q--){var n=p[q],t=n.Xj;if(n.bi)F=t;else{var C=n.Yj,s=n.Um;R.invert(C,da);R.multiply(s,da,da);R.multiply(C,da,da);R.multiply(F,da,t);F=t;n.bi=!0}}n=n.Xj;h[0]=n[0];h[1]=n[1];h[2]=n[2];h[3]=n[3];l[0]=n[4];l[1]=n[5];l[2]=n[6];l[3]=n[7];Q.normalize(l,l);for(h=0;4>h;h++)l=4*k+h,c[l]=f[h],d[l]=
m[h]}c=new Float32Array(c);d=new Float32Array(d);return{e:c,cb:d}}function u(a,b,c){for(var d,e,f=[],m=0;m<a.length;m++){e=a[m];var g=e[0],h=g===Z?0:1,k=e[1],n=e[2];if(0==m&&b<k)for(var l=0;l<k-b;l+=1)f.push(0,n);f.push(h,n);var p=a[m+1];if(p){d=[k,n];var q=[e[5],e[6]],F=[p[3],p[4]];e=[p[1],p[2]];p=e[0];switch(g){case C:var l=d,g=q,t=F,u=e,y=[],z=[],v=void 0,D=void 0,r=void 0,v=void 0;y[0]=l[0]-g[0];y[1]=l[1]-g[1];z[0]=u[0]-t[0];z[1]=u[1]-t[1];r=u[0]-l[0];v=Math.abs(y[0]);D=Math.abs(z[0]);0!=v+D&&
v+D>r&&(v=r/(v+D),g[0]=l[0]-v*y[0],g[1]=l[1]-v*y[1],t[0]=u[0]-v*z[0],t[1]=u[1]-v*z[1]);for(l=k+1;l<p;l+=1)f.push(h,s(w(0,1,l,d[0],q[0],F[0],e[0]),d[1],q[1],F[1],e[1]));break;case X:q=d[0];F=d[1];d=e=(e[1]-F)/(e[0]-q);e=F-e*q;for(l=k+1;l<p;l+=1)f.push(h,d*l+e);break;case Z:for(l=k+1;l<p;l+=1)f.push(h,n);break;default:throw"Unknown keyframe intepolation mode: "+g;}}if(m==a.length-1&&k<c)for(l=0;l<c-k;l+=1)f.push(0,n)}return f}function w(a,b,c,d,e,f,m){var g=a+(b-a)/2,h=s(g,d,e,f,m)-c;return 0.02>Math.abs(h)?
g:0<h?w(a,g,c,d,e,f,m):w(g,b,c,d,e,f,m)}function s(a,b,c,d,e){var f=1-a;return b*f*f*f+3*c*f*f*a+3*d*f*a*a+e*a*a*a}function B(a){a.f={};a.f.play=!1;a.f.V=v;a.f.Sb=0;a.f.start=0;a.f.length=0;a.f.am=0;a.f.yl=0;a.jg=a.jg||[];-1==G.indexOf(a)&&G.push(a)}function q(a){L.Y(a);z.$b(a);D.Pi(a)&&D.hA(a)}var y=r("__config");r("__debug");var D=r("__particles"),z=r("__physics"),E=r("__print"),M=r("__scenes"),x=r("__sfx"),L=r("__transform"),R=r("__tsr"),I=r("__util");r("mat4");var Q=r("quat"),H=y.lg,K=10,S=20,
P=30,O=40,T=50,m=60,F=70,C=0,X=1,Z=2,V=10,v=20,ka=30;a.Lq=V;a.Mq=v;a.Nq=ka;var ea=Array(3),J=new Float32Array(3),ma=new Float32Array(3),ja=new Float32Array(4),la=new Float32Array(4),da=new Float32Array(8);new Float32Array(16);var G=[],aa=[];a.rv=function(a){return a/H.fb};a.update=function(a){for(var b=0;b<G.length;b++){var c=G[b];if(!c.f)throw"Non-animated object";k(c,a);"SPEAKER"==c.type&&x.fq(c,a)}};a.Lv=function(){return aa};a.Xv=function(a){return a.f?a.f.action:null};a.en=function(a){var e;
a:{var f=d(a);if(f&&(f=f.animation_data)&&f.action){e=f.action;break a}if((f=p(a.constraints))&&(f=f.target)&&(f=f.animation_data)&&f.action){e=f.action;break a}e=(f=a.animation_data)&&f.action?f.action:x.uf(a)&&a.data.animation_data&&a.data.animation_data.action?a.data.animation_data.action:null}f=c(a);if(e)B(a),l(a,e);else if(f){B(a);a.f.type=F;for(var m=e=0,g=0;g<f.length;g++){var h=f[g].strips;if(h)for(var k=0;k<h.length;k++){var n=h[k];e=Math.min(e,n.frame_start);m=Math.max(m,n.frame_end)}}f=
[e,m-e];a.f.start=f[0];a.f.Sb=f[0];a.f.length=f[1];x.uf(a)&&x.gq(a)}else I.Ug(a)&&a.d.km?(B(a),b(a,a.data.b4w_vertex_anim[0])):(B(a),a.f.type=F,f=M.jw(M.n()),a.f.start=f[0],a.f.Sb=f[0],a.f.length=f[1]-f[0]+1);q(a)};a.po=d;a.play=function(a,b,c){a.f&&(a.f.play&&e(a),c&&(a.f.Sb+=H.fb*c),a.f.play=!0,a.f.ao=b?b:null)};a.stop=e;a.al=function(a){if(a.f)return a.f.play};a.Rp=function(a,b){a.f&&(a.f.Sb=b)};a.lo=function(a){return a.f&&a.f.Sb?a.f.Sb:!1};a.yc=function(a,b){a.f&&(a.f.V=b?V:v)};a.Ti=function(a){if(a.f)return a.f.V==
V?!0:!1};a.Iy=function(a,b){a.f&&(a.f.V=b)};a.Qv=function(a){if(a.f)return a.f.V};a.ws=function(a,b,c){a.f&&(a.f.am=b||0,a.f.yl=c||0)};a.gm=function(a,b){b||(b=0);k(a,b)};a.Ro=function(a){if("ARMATURE"==a.type||d(a)||p(a.constraints))return!0;var b=a.animation_data;return b&&b.action||"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.action?!0:(b=c(a))&&0<b.length||D.Pi(a)&&D.Iw(a)||"MESH"==a.type&&a.data.b4w_vertex_anim.length?!0:!1};a.Vw=function(a){return a.f?!0:!1};a.Qs=n;a.qn=t;
a.fs=function(a){function b(a,c){for(var d=0;d<c;d++){var e=a[8*d+3];a[8*d+3]=0==e?1:e/3;e=a.subarray(8*d+4,8*d+8);Q.normalize(e,e)}}function c(a,b){if(-1<a.indexOf("location"))var d=0,e=b;else-1<a.indexOf("rotation_quaternion")?(d=4,e=0==b?3:b-1):(d=-1<a.indexOf("scale")?3:0,e=0);return d+e}function d(a,b,c,e){if(-1<c.search(h)){a=b;c=c.split('"')[1];var f=k}else-1<c.indexOf("location")?(c="tsr",f=k):-1<c.indexOf("rotation_quaternion")?(c="tsr",f=k):-1<c.indexOf("scale")?(c="tsr",f=k):f=0;if(!a[c]){b=
a;var m=c;if("object"==typeof f&&f.length)for(var g=f.length,n=new Float32Array(e*g),l=0;l<e;l++)for(var p=0;p<g;p++)n[l*g+p]=f[p];else if("number"==typeof f)for(n=new Float32Array(e),l=0;l<e;l++)n[l]=f;else throw"Wrong storage default value";b[m]=n}return a[c]}a.d={};var e=a.d,f=a.frame_range,m=f[0],g=f[1];e.Zx=1;for(var h=RegExp(/pose.bones\[\".+\"\]/g),k=new Float32Array([0,0,0,0,0,0,0,1]),f=a.fcurves,n=0;n<f.length;n++){var l=f[n];l.Sm=u(l[2],m,g)}m=f.length?f[0].Sm.length/2:0;e.np=m;for(var g=
{},p={},q=new Float32Array(m),n=0;n<f.length;n++)for(var l=f[n],F=l[0],t=l[1],l=l.Sm,C=d(g,p,F,m),s=C.length/m,F=c(F,t),t=0;t<m;t++){l[2*t]&&(q[t]=1);var y=l[2*t+1];C[t*s+F]=3==F?C[t*s+F]+y:y}for(var w in g)"tsr"==w&&b(g[w],m);for(var z in p)b(p[z],m);e.$=g;e.Ps=p;e.Ks=q;aa.push(a)};a.GB=function(a){for(var b=0;b<a.length;b++)if(a[b].f)return a[b];return!1};a.apply=function(a,c){if(I.Ug(a)){var d=I.ic("name",c,a.data.b4w_vertex_anim);if(d){B(a);b(a,d);q(a);return}}(d=I.ic("name",c,aa))?(B(a),l(a,
d),q(a)):E.error("Unsupported object or animation name: ",c)};a.remove=function(a){a.f=null;var b=G.indexOf(a);b?G.splice(b,1):E.error("Object ",a.name," doesn't have animation")};a.pa=function(){G.length=0;aa.length=0}};b4w.module.__transform=function(a,r){function b(a){var f=a.d;e.gA(a,B);"CAMERA"==a.type&&d.nt(a);var t=f.e,s=f.scale,w=f.i;k.Gh(t,s,w,f.Uf);var r=f.G;u.identity(r);u.fromQuat(w,r);h.By(r,s,r);r[12]=t[0];r[13]=t[1];r[14]=t[2];u.invert(r,f.Qo);a.f&&!a.f.e&&g.Pi(a)&&g.iA(a);f.Bb&&f.yd&&(c.ji(f.Bb,r,f.yd),c.pk(f.Bd,r,f.Cd),c.ok(f.kk,f.Uf,f.lk),f.Cc&&p.El(p.n()));switch(a.type){case "SPEAKER":n.fq(a,B);break;case "CAMERA":d.Cq(a);p.P()&&n.mx(p.n(),t,w,B);break;case "LAMP":l.jA(a);p.P()&&p.Gj(a,p.n());
break;case "EMPTY":a.field&&g.Fj(a)}"LAMP"!=a.type&&"CAMERA"!=a.type||!p.P()||(f=p.n(),p.El(f),p.Dy(f));a=a.td;for(f=0;f<a.length;f++)b(a[f])}var c=r("__boundings"),d=r("__camera"),e=r("__constraints"),l=r("__lights"),g=r("__particles"),p=r("__scenes"),n=r("__sfx"),k=r("__tsr"),h=r("__util"),f=r("vec3"),t=r("quat"),u=r("mat4"),w=new Float32Array(3),s=new Float32Array(4),B=0;a.update=function(a){B=a};a.lc=function(a,b){if(e.cd(a)==e.Mc)k.iz(b,e.ad(a));else{var c=a.d;c.e[0]=b[0];c.e[1]=b[1];c.e[2]=
b[2]}};a.Co=function(a,b){e.cd(a)==e.Mc?f.copy(k.Tk(e.ad(a)),b):f.copy(a.d.e,b)};a.Pe=function(a,b){if(e.cd(a)==e.Mc)k.uj(b,e.ad(a));else{var c=a.d;c.i[0]=b[0];c.i[1]=b[1];c.i[2]=b[2];c.i[3]=b[3]}};a.xo=function(a,b){e.cd(a)==e.Mc?t.copy(k.wo(e.ad(a)),b):t.copy(a.d.i,b)};a.vj=function(a,b){if(e.cd(a)==e.Mc){var c=h.Mg(b,s);k.uj(c,e.ad(a))}else h.Mg(b,a.d.i)};a.Qe=function(a,b){e.cd(a)==e.Mc?k.Qe(b,e.ad(a)):a.d.scale=b};a.Sk=function(a){return e.cd(a)==e.Mc?k.Sk(e.ad(a)):a.d.scale};a.rw=function(a,
b){if(e.cd(a)==e.Mc)k.copy(e.ad(a),b);else{var c=a.d;k.Gh(c.e,c.scale,c.i,b)}};a.Yp=function(a,b){if(e.cd(a)==e.Mc)k.copy(b,e.ad(a));else{var c=a.d;c.e[0]=b[0];c.e[1]=b[1];c.e[2]=b[2];c.scale=b[3];c.i[0]=b[4];c.i[1]=b[5];c.i[2]=b[6];c.i[3]=b[7]}};a.vo=function(a){var b="STATIC"==a.d.type?a.Rm:a.d,c=a.data.b4w_bounding_box;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return 0.5*Math.sqrt(a*a+d*d+b*b)};a.uo=function(a,b,c){c||(c=new Float32Array(3));b?(b=a.d,
f.copy(b.Cd.F,c)):(b="STATIC"==a.d.type?a.Rm:a.d,a=a.data.b4w_bounding_box,c[0]=(a.max_x+a.min_x)/2,c[1]=(a.max_y+a.min_y)/2,c[2]=(a.max_z+a.min_z)/2,f.transformMat4(c,b.G,c));return c};a.kp=function(a,b,c,d){a=a.d;var e=a.G;f.transformMat4(a.e,a.Qo,w);w[0]+=b;w[1]+=c;w[2]+=d;f.transformMat4(w,e,a.e)};a.Y=b;a.distance=function(a,b){return f.dist(a.d.e,b.d.e)};a.Jx=function(a,b){return f.dist(a.d.e,b)}};b4w.module.__tsr=function(a,r){function b(a,b,c,d){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=b;d[4]=c[0];d[5]=c[1];d[6]=c[2];d[7]=c[3]}function c(a,b,c){var d=a[0],e=a[1],g=a[2],l=a[3],p=a[4],r=a[5],q=a[6];a=a[7];var y=b[0]*l,D=b[1]*l,z=b[2]*l;b=a*y+r*z-q*D;var l=a*D+q*y-p*z,E=a*z+p*D-r*y,y=-p*y-r*D-q*z;c[0]=b*a+y*-p+l*-q-E*-r;c[1]=l*a+y*-r+E*-p-b*-q;c[2]=E*a+y*-q+b*-r-l*-p;c[0]+=d;c[1]+=e;c[2]+=g;return c}var d=r("__util"),e=r("vec3"),l=r("quat");r("mat4");var g=new Float32Array(3),p=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.copy=function(a,b){b.set(a)};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.mf=function(a,c,d,e){e||(e=new Float32Array(8));b(a,c,d,e);return e};a.Gh=b;a.iz=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2]};a.Qe=function(a,b){b[3]=a};a.Wp=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};a.uj=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3]};a.Tk=function(a){return a.subarray(0,
3)};a.Sk=function(a){return a[3]};a.wo=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var d=a[0],e=a[1],g=a[2];p[0]=a[4];p[1]=a[5];p[2]=a[6];p[3]=a[7];l.invert(p,p);var w=p[0],s=p[1],r=p[2],q=p[3],d=d*c,e=e*c,y=g*c,g=q*d+s*y-r*e,D=q*e+r*d-w*y,z=q*y+w*e-s*d,d=-w*d-s*e-r*y;b[0]=-(g*q+d*-w+D*-r-z*-s);b[1]=-(D*q+d*-s+z*-w-g*-r);b[2]=-(z*q+d*-r+g*-s-D*-w);b[3]=c;b[4]=w;b[5]=s;b[6]=r;b[7]=q;return b};a.fo=function(a,c){var e=d.De(a,g),f=d.Zi(a),l=d.Pd(a,p);b(e,f,
l,c);return c};a.multiply=function(a,b,d){c(a,b,d);d[3]=a[3]*b[3];var e=a[4],g=a[5],l=a[6];a=a[7];var p=b[4],s=b[5],r=b[6];b=b[7];d[4]=e*b+a*p+g*r-l*s;d[5]=g*b+a*s+l*p-e*r;d[6]=l*b+a*r+e*s-g*p;d[7]=a*b-e*p-g*s-l*r;return d};a.Ej=c;a.yq=function(a,b,c,d){d||(d=0);var e=a.length,g=b[0],l=b[1],p=b[2],r=b[3],q=b[4],y=b[5],D=b[6];b=b[7];for(var z=0;z<e;z+=3){var E=a[z]*r,M=a[z+1]*r,x=a[z+2]*r,L=b*E+y*x-D*M,R=b*M+D*E-q*x,I=b*x+q*M-y*E,E=-q*E-y*M-D*x;c[d+z]=L*b+E*-q+R*-D-I*-y;c[d+z+1]=R*b+E*-y+I*-q-L*-D;
c[d+z+2]=I*b+E*-D+L*-y-R*-q;c[d+z]+=g;c[d+z+1]+=l;c[d+z+2]+=p}};a.wq=function(a,b,c,d){d||(d=0);var e=a.length,g=b[3],l=b[4],p=b[5],r=b[6];b=b[7];for(var q=0;q<e;q+=3){var y=a[q]*g,D=a[q+1]*g,z=a[q+2]*g,E=b*y+p*z-r*D,M=b*D+r*y-l*z,x=b*z+l*D-p*y,y=-l*y-p*D-r*z;c[d+q]=E*b+y*-l+M*-r-x*-p;c[d+q+1]=M*b+y*-p+x*-l-E*-r;c[d+q+2]=x*b+y*-r+E*-p-M*-l}};a.cm=function(a,b,c){var d=b[3],e=b[4],g=b[5],l=b[6];b=b[7];var p=a[0]*d,r=a[1]*d,q=a[2]*d;a=b*p+g*q-l*r;var d=b*r+l*p-e*q,y=b*q+e*r-g*p,p=-e*p-g*r-l*q;c[0]=
a*b+p*-e+d*-l-y*-g;c[1]=d*b+p*-g+y*-e-a*-l;c[2]=y*b+p*-l+a*-g-d*-e};a.xq=function(a,b,c,d){d||(d=0);var e=a.length,g=b[3],l=b[4],p=b[5],r=b[6];b=b[7];for(var q=0;q<e;q+=4){var y=a[q]*g,D=a[q+1]*g,z=a[q+2]*g,E=b*y+p*z-r*D,M=b*D+r*y-l*z,x=b*z+l*D-p*y,y=-l*y-p*D-r*z;c[d+q]=E*b+y*-l+M*-r-x*-p;c[d+q+1]=M*b+y*-p+x*-l-E*-r;c[d+q+2]=x*b+y*-r+E*-p-M*-l;c[d+q+3]=a[q+3]}};a.translate=function(a,b,c){var d=a[3],e=a[4],g=a[5],l=a[6],p=a[7],r=b[0]*d,q=b[1]*d,y=b[2]*d;b=p*r+g*y-l*q;var d=p*q+l*r-e*y,D=p*y+e*q-g*
r,r=-e*r-g*q-l*y;c[0]=a[0]+b*p+r*-e+d*-l-D*-g;c[1]=a[1]+d*p+r*-g+D*-e-b*-l;c[2]=a[2]+D*p+r*-l+b*-g-d*-e;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.dC=function(a,b,c,d){d||(d=new Float32Array(8));e.lerp(a.subarray(0,3),b.subarray(0,3),c,d.subarray(0,3));var g=a[3];d[3]=g+c*(b[3]-g);l.slerp(a.subarray(4),b.subarray(4),c,d.subarray(4));return d};a.DB=function(a,b,c,d){d||(d=new Float32Array(8));var e=a.subarray(0,3),g=b.subarray(0,3),p=d.subarray(0,3);p[0]=g[0]*(c+1)-e[0]*c;p[1]=g[1]*
(c+1)-e[1]*c;p[2]=g[2]*(c+1)-e[2]*c;d[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);e=d.subarray(4);e[0]=b[0]*(c+1)-a[0]*c;e[1]=b[1]*(c+1)-a[1]*c;e[2]=b[2]*(c+1)-a[2]*c;e[3]=b[3]*(c+1)-a[3]*c;l.normalize(e,e);return d};a.Tw=function(a,b,c,d,e){var g=a.subarray(0,3),p=e.subarray(0,3);p[0]=g[0]+b*c[0];p[1]=g[1]+b*c[1];p[2]=g[2]+b*c[2];e[3]=a[3];a=a.subarray(4);e=e.subarray(4);c=d[0];g=d[1];d=d[2];var p=a[0],s=a[1],r=a[2],q=a[3];e[0]=0.5*(c*q+g*r-d*s);e[1]=0.5*(g*q+d*p-c*r);e[2]=0.5*(d*q+c*s-
g*p);e[3]=0.5*(-c*p-g*s-d*r);e[0]=a[0]+e[0]*b;e[1]=a[1]+e[1]*b;e[2]=a[2]+e[2]*b;e[3]=a[3]+e[3]*b;l.normalize(e,e)}};b4w.module.__util=function(a,r){function b(a,b,c){for(var d=[],e=c.length,f=0;f<e;f++){var g=c[f];g[a]==b&&d.push(g)}return d}function c(a,b){var d=a instanceof Array?[]:{},e;for(e in a)d[e]=!a[e]||"object"!=typeof a[e]||-1!=b.indexOf(a[e])||a[e]instanceof Float32Array?a[e]:c(a[e],b);return d}function d(a,b){b||(b=new Float32Array(4));t.fromMat3(a,b);b[0]=-b[0];b[1]=-b[1];b[2]=-b[2];return b}function e(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=Math.sqrt(b*b+c*c+d*d),f=1/f;a[0]=b*f;a[1]=c*f;a[2]=d*f;a[3]=
e*f}function l(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function g(a){return(34*a+1)*a%289}function p(a){return(34*a+5)*a-289*Math.floor((34*a+5)*a/289)}function n(a){return a-7*Math.floor(a/7)}var k=r("__print"),h=r("vec3"),f=r("vec4"),t=r("quat"),u=r("mat3"),w=r("mat4"),s=0,B={},q=new Float32Array(3),y=new Float32Array(3),D=new Float32Array(4),z=new Float32Array(4),E=new Float32Array(9),M=new Float32Array(16),x=new Float32Array([0,0,0]),L=new Float32Array([0,0,0,1]),R=new Float32Array([0,
0,0,1,0,0,0,1]),I=new Float32Array([1,0,0]),Q=new Float32Array([0,1,0]),H=new Float32Array([0,0,1]),K=new Float32Array([-1,0,0]),S=new Float32Array([0,-1,0]),P=new Float32Array([0,0,-1]),O=Math.floor(44488.07041494893);a.Yr=x;a.Tr=L;a.YA=R;a.zm=I;a.hb=Q;a.Rj=H;a.Oq=K;a.sd=S;a.ym=P;a.Yo=b;a.lv=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.Zz=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.ht=function(){var a=new Uint16Array([255]);
return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.As=function(a,b){var c=[],d={},e=b.length,f,g;for(f=0;f<e;f++)d[b[f]]=!0;e=a.length;for(f=0;f<e;f++)g=a[f],g in d&&c.push(g);return c};a.Te=function(a){return 0<a?1:0>a?-1:0};a.mC=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.ic=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.lC=function(a,b,c,d,e){for(var f=0;f<e.length;f++){var g=e[f];if(g[a]==b&&g[c]==d)return g}return null};
a.Qg=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.qs=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.mB=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.zC=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e.type==b&&c.push(e)}return c};a.xC=function(a,c){var d=b("name",c,a);1<d.length&&k.error("obj_by_name(): name resolution ambiguity");return d};a.yC=function(a,c){var d=b("name",
c,a),e=d.length;1<e&&k.error("obj_by_name(): name resolution ambiguity");if(0>=e)return[];for(var f=[],g=0;g<e;g++){var h=d[g];if("EMPTY"==h.type&&h.dupli_group)for(var h=h.dupli_group.objects,l=0;l<h.length;l++)f.push(h[l])}return d=d.concat(f)};a.Vz=function(a,b,c,d){d||(d=new Float32Array(16));w.identity(d);d[12]=a;d[13]=b;d[14]=c};var T=1;a.my=function(){T=(69069*T+5)%Math.pow(2,32);return Math.round(T/65536)%32768/32767};a.Jz=function(a){T=a};a.Yb=function(a){var b=48271*(a[0]%O)-3399*Math.floor(a[0]/
O);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.Ri=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.Mg=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),f=Math.sin(a[1]/2),g=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=f*g*e+c*d*h;b[1]=f*d*e+c*g*h;b[2]=c*g*e-f*d*h;b[3]=c*d*e-f*g*h;return b};a.jy=function(a){var b=[],c=a[0],d=a[1],e=a[2];a=a[3];var f=e*e,g=c*d+e*a;0.499999<g?(b[0]=0,b[1]=2*Math.atan2(c,a),b[2]=Math.PI/2):-0.499999>g?
(b[0]=0,b[1]=-2*Math.atan2(c,a),b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*a-2*d*e,1-2*c*c-2*f),b[1]=Math.atan2(2*d*a-2*c*e,1-2*d*d-2*f),b[2]=Math.asin(2*c*d+2*e*a));return b};a.Mb=function(a,b,c){c||(c=new Float32Array(3));h.transformQuat(b,a,c);return c};a.zB=function(a,b,c){c||(c=new Float32Array(4));a=h.normalize(a,q);var d=h.dot(b,a);a=h.cross(b,a,y);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.Wz=function(a,b,c,d){d||(d=new Float32Array(4));
h.transformQuat(c,b,d);d[3]=-h.dot(a,d)};a.Mu=function(a){var b=a.d.i;switch(a.type){case "CAMERA":q[0]=0;q[1]=-1;q[2]=0;h.transformQuat(q,b,q);y[0]=0;y[1]=0;y[2]=-1;break;case "MESH":q[0]=0;q[1]=0;q[2]=1;h.transformQuat(q,b,q);y[0]=0;y[1]=0;y[2]=1;break;case "EMPTY":q[0]=0,q[1]=1,q[2]=0,h.transformQuat(q,b,q),y[0]=0,y[1]=1,y[2]=0}q[1]=0;h.normalize(q,q);a=h.dot(q,y);return Math.acos(a)*(0<-q[0]*y[2]?-1:1)};a.hi=function(a,b,c){if(0==c)return a;for(var d=[],e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e];
return d};a.SC=function(){s++;return s.toString(16)};a.cA=function(a){B[a]||(B[a]=0);var b=a+B[a];B[a]++;return b};a.qe=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.sb=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,J:0,ja:null,r:[],Z:b}};a.ri=function(a){var b={};b.type=a;switch(a){case "DYNAMIC":case "STATIC":case "CAMERA":case "EMPTY":case "LAMP":case "ARMATURE":case "SPEAKER":case "CURVE":case "FONT":b.e=
new Float32Array([0,0,0]);b.scale=1;b.i=new Float32Array([0,0,0,1]);b.Uf=new Float32Array([0,0,0,1,0,0,0,1]);a=new Float32Array(16);w.identity(a);b.G=a;a=new Float32Array(16);w.identity(a);b.Qo=a;b.wf=1E4;b.dh=0;b.Jj=0;break;case "NONE":b.Jj=0}return b};a.cC=function(a,b){return{name:a,type:b,data:{},location:[0,0,0],rotation_euler:[0,0,0],scale:[1,1,1],modifiers:[],constraints:[],particle_systems:[],game:{physics_type:"NO_COLLISION",mass:1,damping:0.04,rotation_damping:0.1,lock_location_x:!1,lock_location_y:!1,
lock_location_z:!1,lock_rotation_x:!1,lock_rotation_y:!1,lock_rotation_z:!1,use_collision_bounds:!1,collision_bounds_type:"BOX"},b4w_collision_id:""}};a.kf=function(a){return JSON.parse(JSON.stringify(a))};a.oB=function(a,b){var d=[],e;for(e in b){var f=b[e];if(f)for(var g=0;g<f.length;g++)d.push(f[g])}return c(a,d)};a.$a=function(b){var c=b instanceof Array?[]:{},d;for(d in b)c[d]=b[d]&&"object"==typeof b[d]?b[d]instanceof Float32Array?new Float32Array(b[d]):b[d]instanceof Uint32Array?new Uint32Array(b[d]):
b[d]instanceof Uint16Array?new Uint16Array(b[d]):a.$a(b[d]):b[d];return c};a.mi=function(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=a[c]&&"object"==typeof a[c]?a[c]instanceof Float32Array?new Float32Array(a[c]):a[c]instanceof Uint32Array?new Uint32Array(a[c]):a[c]instanceof Uint16Array?new Uint16Array(a[c]):a[c]instanceof Array?a[c].slice(0):a[c]:a[c];return b};a.Ug=function(a){return"MESH"===a.type?!0:!1};a.To=function(a){return"MESH"===a.type&&a.d&&"DYNAMIC"===a.d.type?!0:!1};a.So=function(a){return"ARMATURE"===
a.type?!0:!1};a.Pd=function(a,b){b||(b=new Float32Array(4));u.fromMat4(a,E);var c=E[0],e=E[3],f=E[6],g=E[1],h=E[4],l=E[7],k=E[2],n=E[5],p=E[8],c=Math.sqrt(c*c+e*e+f*f)||1,g=Math.sqrt(g*g+h*h+l*l)||1,k=Math.sqrt(k*k+n*n+p*p)||1;E[0]/=c;E[3]/=c;E[6]/=c;E[1]/=g;E[4]/=g;E[7]/=g;E[2]/=k;E[5]/=k;E[8]/=k;d(E,b);return b};a.ux=d;a.De=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.Zi=function(a){D[0]=0.577350269189626;D[1]=0.577350269189626;D[2]=0.577350269189626;D[3]=
0;f.transformMat4(D,a,D);return f.length(D)};a.Zn=function(a,b){var c=b.left,d=b.right,f=b.top,g=b.bottom,h=b.lb,l=b.ab;c[0]=a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-a[8];d[3]=a[15]-a[12];f[0]=a[3]-a[1];f[1]=a[7]-a[5];f[2]=a[11]-a[9];f[3]=a[15]-a[13];g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];h[0]=a[3]+a[2];h[1]=a[7]+a[6];h[2]=a[11]+a[10];h[3]=a[15]+a[14];l[0]=a[3]-a[2];l[1]=a[7]-a[6];l[2]=a[11]-a[10];l[3]=a[15]-a[14];e(c);
e(d);e(f);e(g);e(h);e(l)};a.Cz=function(a,b,c){return c<-l(a,b.left)||c<-l(a,b.right)||c<-l(a,b.top)||c<-l(a,b.bottom)||c<-l(a,b.lb)||c<-l(a,b.ab)?!0:!1};a.av=function(a,b,c,d,e){f=h.dot(c,b.ab);g=h.dot(d,b.ab);k=h.dot(e,b.ab);f=Math.sqrt(f*f+g*g+k*k);if(f<-l(a,b.lb)||f<-l(a,b.ab))return!0;var f=h.dot(c,b.left),g=h.dot(d,b.left),k=h.dot(e,b.left);if(Math.sqrt(f*f+g*g+k*k)<-l(a,b.left))return!0;f=h.dot(c,b.right);g=h.dot(d,b.right);k=h.dot(e,b.right);if(Math.sqrt(f*f+g*g+k*k)<-l(a,b.right))return!0;
f=h.dot(c,b.top);g=h.dot(d,b.top);k=h.dot(e,b.top);if(Math.sqrt(f*f+g*g+k*k)<-l(a,b.top))return!0;f=h.dot(c,b.bottom);g=h.dot(d,b.bottom);k=h.dot(e,b.bottom);return Math.sqrt(f*f+g*g+k*k)<-l(a,b.bottom)?!0:!1};a.Me=function(a,b,c,d){d||(d=0);for(var e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],l=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*l+b[12];c[d+f+1]=b[1]*g+b[5]*h+b[9]*l+b[13];c[d+f+2]=b[2]*g+b[6]*h+b[10]*l+b[14]}};a.jm=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=3){var g=a[f],h=a[f+1],l=a[f+
2];c[d+f]=b[0]*g+b[4]*h+b[8]*l;c[d+f+1]=b[1]*g+b[5]*h+b[9]*l;c[d+f+2]=b[2]*g+b[6]*h+b[10]*l}};a.Rz=function(a,b,c){for(var d=0,d=0,e=a.length,f=0;f<e;f+=4){var g=a[f],h=a[f+1],l=a[f+2];c[d+f]=b[0]*g+b[4]*h+b[8]*l;c[d+f+1]=b[1]*g+b[5]*h+b[9]*l;c[d+f+2]=b[2]*g+b[6]*h+b[10]*l;c[d+f+3]=a[f+3]}};a.tA=function(a,b,c){c||(c=new Float32Array(3));D[0]=a[0];D[1]=a[1];D[2]=a[2];D[3]=0;f.transformMat4(D,b,D);c[0]=D[0];c[1]=D[1];c[2]=D[2]};a.HB=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";
var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*d));for(var e=0;e<c;e++)for(var f=0;f<d;f++)b[e*d+f]=a[e][f];return b};a.uA=function(a){for(var b=[],c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.gi=function(b,c,d,e){if(e<d)return d;var f=d+Math.floor((e-d)/2);return b[f]>c?a.gi(b,c,d,f-1):b[f]<c?a.gi(b,c,f+1,e):f};a.Dd=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.ni=function(a,b,c){for(var d=
0;d<a.length;d++)if(Math.abs(a[d]-b[d])>c)return!1;return!0};a.By=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15]};a.dm=function(a,b,c,d){d||(d=new Float32Array(16));b=w.fromRotationTranslation(b,c,M);w.multiply(b,a,d)};a.Ej=function(a,b,c,d,e){e||(e=new Float32Array(3));b=w.fromRotationTranslation(c,d,M);h.transformMat4(a,b,e);return e};a.em=function(a,b,c,d){d||(d=new Float32Array(4));b=w.fromRotationTranslation(b,c,M);
f.transformMat4(a,b,d)};a.eC=function(a,b,c,d,e){e||(e=new Float32Array(3));b=w.fromRotationTranslation(c,d,M);w.invert(b,b);h.transformMat4(a,b,e);return e};a.QC=function(a,b,c){c||(c=new Float32Array(16));w.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.wC=function(b,c,d){a.De(b,c);c[3]=a.Zi(b);a.Pd(b,d)};a.gn=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.Mp=function(a,b,c,d){d||(d=new Float32Array(3));h.subtract(b,a,q);h.transformQuat(q,
c,q);h.subtract(b,q,d)};a.Dv=function(){var a=new Float32Array([0,0,0]),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),f=new Float32Array(16),g=new Float32Array(16);w.lookAt(a,[-1,0,0],[0,-1,0],b);w.scale(b,[-1,1,1],b);w.scale(b,[-1,1,-1],c);w.lookAt(a,[0,0,-1],[0,-1,0],d);w.scale(d,[-1,1,1],d);w.scale(d,[-1,1,-1],e);w.lookAt(a,[0,-1,0],[0,0,-1],g);w.scale(g,[1,1,-1],g);w.scale(g,[-1,-1,-1],f);return[f,g,b,c,d,e]};a.Ko=function(a){for(var b=0,c=0;c<a.length;c++)b=
(b<<5)-b+a.charCodeAt(c),b&=b;return b};a.vC=function(a,b,c){var d=b[0],e=b[1];b=b[2];var f,g,h,l,k,n,p,q,t,s,u,y;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;f=a[0];g=a[1];h=a[2];l=a[3];k=a[4];n=a[5];p=a[6];q=a[7];t=a[8];s=a[9];u=a[10];y=a[11];c[0]=f;c[1]=g;c[2]=h;c[3]=l;c[4]=k;c[5]=n;c[6]=p;c[7]=q;c[8]=t;c[9]=s;c[10]=u;c[11]=y;c[12]=f*d+k*e+t*b+a[12];c[13]=g*d+n*e+s*b+a[13];c[14]=h*d+p*
e+u*b+a[14];c[15]=l*d+q*e+y*b+a[15];return c};a.tx=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.iy=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.qc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.ky=function(a){return a*Math.PI/
180};a.wB=function(a){return 180*a/Math.PI};a.Nl=function(a){var b=0.366025403784439*a[0]+0.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=0.211324865405187*c+0.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var f=b>a?1:0,h=1-f,e=b+0.211324865405187-f,l=a+0.211324865405187-h,k=b+-0.577350269189626,n=a+-0.577350269189626,c=c%289,d=d%289,p=g(g(d)+c),h=g(g(d+h)+c+f),q=g(g(d+1)+c+1),c=Math.max(0.5-(b*b+a*a),0),d=Math.max(0.5-(e*e+l*l),0),f=Math.max(0.5-(k*k+n*n),0),t=2*(0.024390243902439*p-
Math.floor(0.024390243902439*p))-1,s=2*(0.024390243902439*h-Math.floor(0.024390243902439*h))-1,u=2*(0.024390243902439*q-Math.floor(0.024390243902439*q))-1,p=Math.abs(t)-0.5,h=Math.abs(s)-0.5,q=Math.abs(u)-0.5,t=t-Math.floor(t+0.5),s=s-Math.floor(s+0.5),u=u-Math.floor(u+0.5),c=c*c*c*c*(1.79284291400159-0.85373472095314*(t*t+p*p)),d=d*d*d*d*(1.79284291400159-0.85373472095314*(s*s+h*h)),f=f*f*f*f*(1.79284291400159-0.85373472095314*(u*u+q*q));return 130*(c*(t*b+p*a)+d*(s*e+h*l)+f*(u*k+q*n))};a.vn=function(a){var b=
1/7,c=b/2,d=Math.floor(a[0])-289*Math.floor(Math.floor(a[0])/289),e=Math.floor(a[1])-289*Math.floor(Math.floor(a[1])/289),f=a[0]-Math.floor(a[0]);a=a[1]-Math.floor(a[1]);var g=f-0.5,h=f-1.5,f=a-0.5;a-=1.5;var l=p(d),k=p(d+1),q=l,d=k,l=p(l+e),k=p(k+e),q=p(q+e+1),d=p(d+e+1),e=g+0.7*(n(l)*b+c),t=h+0.7*(n(k)*b+c),g=g+0.7*(n(q)*b+c),h=h+0.7*(n(d)*b+c),l=f+0.7*(n(Math.floor(l*b))*b+c),f=f+0.7*(n(Math.floor(k*b))*b+c),q=a+0.7*(n(Math.floor(q*b))*b+c),b=a+0.7*(n(Math.floor(d*b))*b+c);return Math.min(e*e+
l*l,t*t+f*f,g*g+q*q,h*h+b*b)};a.Ep=function(a,b,c,d,e){e||(e=new Float32Array(4));a=h.transformQuat(b,a,q);b=c[0];var f=c[1];c=c[2];E[0]=f*f+c*c;E[1]=-f*b;E[2]=-c*b;E[3]=-b*f;E[4]=b*b+c*c;E[5]=-c*f;E[6]=-b*c;E[7]=-f*c;E[8]=b*b+f*f;h.transformMat3(a,E,a);h.normalize(a,a);t.rotationTo(d,a,e);return e};a.Ws=function(a,b){b||(b=new Float32Array(4));var c=D,d=z,c=t.setAxisAngle([0,1,0],Math.PI,t.create()),d=t.setAxisAngle([1,0,0],Math.PI/2,t.create());t.multiply(c,d,c);t.multiply(a,c,b);return b};a.pa=
function(){s=0;B={}};a.Za=function(a,b,c){return Math.min(Math.max(a,b),c)};a.Nf=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.Kh=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.dq=function(a,b,c,d,e){e||(e=new Float32Array(a.length));t.slerp(a,b,Math.exp(-c/d),e)};a.Ww=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?!0:!1};a.Wg=function(a,b){if(a instanceof Array||a.buffer&&
a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.Et=function(a,b){var c=u.fromQuat(a,E);y[0]=0;y[1]=1;y[2]=0;q[0]=c[3];q[1]=c[4];q[2]=c[5];var d=h.cross(y,q,q);h.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);y[0]=c[0];y[1]=c[1];y[2]=c[2];h.normalize(y,y);t.rotationTo(y,d,z);t.multiply(z,a,a)};a.jo=function(a,b,c,d){c=c*b-0.5;var e=d*b-0.5;d=c-Math.floor(c);var f=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),g=b-1,h=a[e*b+c],l=a[e*b+Math.min(c+1,g)],
k=a[Math.min(e+1,g)*b+c];a=a[Math.min(e+1,g)*b+Math.min(c+1,g)];return(h*(1-d)+l*d)*(1-f)+(k*(1-d)+a*d)*f};a.Oe=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.Kp=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.Bh=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<(a&2)&&c++;return c};a.zv=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.no=function(a){var b=
0;for($c in a)a.hasOwnProperty($c)&&b++;return b};a.oy=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.HA=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];h.normalize(c,c)};a.RC=function(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],g=b[1],h=b[2];b=b[3];var l=g*a-h*e,k=h*d-f*a,n=f*e-g*d,p=g*n-h*k,h=h*l-f*n,f=f*k-g*l;c[0]=d+2*l*b+2*p;c[1]=e+2*k*b+2*h;c[2]=a+2*n*b+2*f;return c}};b4w.module.__sfx=function(a,r){function b(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;t.warn("B4W warning: deprecated WebAudio implementation");return null}t.warn("B4W warning: WebAudio is not supported");return null}function c(a,b,c){var d=a.j;if("NONE"!=d.V){c||(c=0);var f=d.loop,g=d.pitch;if(d.src&&(f||0<=c)){d.ik=Math.floor(5E4*Math.random());b=y.currentTime+b;d.nc=b;d.state=K;var h=a.j;if(!h.Eb){var p=a.d.e,q=a.d.i;if(B.cj){var t=y.createBiquadFilter();
t.type="peaking"}else t=null;var s=y.createGain();switch(h.V){case "POSITIONAL":var r=y.createPanner();r.panningModel=r.EQUALPOWER;r.distanceModel=r.INVERSE_DISTANCE;r.setPosition(p[0],p[1],p[2]);var z=L;u.Mb(q,u.sd,z);r.setOrientation(z[0],z[1],z[2]);r.refDistance=h.Ai;r.maxDistance=h.zi;r.rolloffFactor=h.fi;r.coneInnerAngle=h.zt;r.coneOuterAngle=h.At;r.coneOuterGain=h.Bt;z=y.createGain();z.gain.value=k(h);t?(r.connect(t),t.connect(z)):r.connect(z);z.connect(s);h.Eb=r;if(h.$f){var w=y.createGain();
s.connect(w);w.connect(y?D.j.Eb:null)}else w=null,s.connect(y?D.j.Eb:null);break;case "BACKGROUND_SOUND":r=null;z=y.createGain();z.gain.value=k(h);t?(h.Eb=t,t.connect(z)):h.Eb=z;z.connect(s);h.$f?(w=y.createGain(),s.connect(w),w.connect(y?D.j.Eb:null)):(w=null,s.connect(y?D.j.Eb:null));break;case "BACKGROUND_MUSIC":w=z=r=null,t?(t.connect(s),h.Eb=t):h.Eb=s,s.connect(y?D.j.Eb:null)}h.qh=r;h.zc=t;h.sf=z;h.we=s;h.ny=w}if("POSITIONAL"==d.V||"BACKGROUND_SOUND"==d.V)r=y.createBufferSource(),r.buffer=d.src,
r.playbackRate.value=g,f?(d.Xa&&d.Xa.disconnect(),r.loop=!0,r.start(b),d.duration=0):(f=r.buffer?r.buffer.duration:0,c>f?(f=b+c+d.Xc,r.loop=!0,r.start(b),r.stop(f),d.duration=c):(r.loop=!1,r.start(b),d.duration=f)),r.connect(d.Eb),d.Xa=r,e(a,b);else if("BACKGROUND_MUSIC"==d.V){window.clearTimeout(d.kn);c=a.j;if(f=c.src)f.volume=n(a),f.loop=c.yc,c.Xa=c.Xa||y.createMediaElementSource(f),c.Xa.connect(c.Eb),c.state==K&&f.play();d.duration=1E6}l(d,b)}}}function d(a){var b=a.j,d=b.duration,b=b.Hu+b.Ju*
Math.random();c(a,b,d)}function e(a,b){var c=a.j;if(c.$f||c.sh){var d=c.ny,e=c.Xa,f=e.buffer?e.buffer.duration:0;if(f){c.$f&&d.gain.cancelScheduledValues(b);c.sh&&e.playbackRate.cancelScheduledValues(b);var g=b;Q[0]=c.ik;for(var h=0;h<O;h++){if(c.$f){var l=1-u.Za(c.$f,0,1)*Math.random();d.gain.setValueAtTime(l,g)}l=c.pitch+c.sh*u.Yb(Q);c.sh&&e.playbackRate.setValueAtTime(l,g);g+=f/l}}}}function l(a,b){if(a.Gk||a.Xc){var c=a.we;c.gain.cancelScheduledValues(b);a.Gk&&(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,
b+a.Gk));a.Xc&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.Xc))}}function g(a){if("SPEAKER"!=a.type)throw"Wrong object type";a=a.j;if(a.state==K||a.state==P){var b=a.we,c=y.currentTime;a.Xc&&(b.gain.setValueAtTime(b.gain.value,c),b.gain.linearRampToValueAtTime(0,c+a.Xc));if("BACKGROUND_MUSIC"==a.V){var d=a.src;d&&(a.kn=window.setTimeout(function(){d.currentTime&&(d.currentTime=0);d.pause()},1E3*a.Xc))}else b=a.Xa,a.duration<b.buffer.duration?a.Xc&&
a.state==K?b.stop(c+a.Xc):a.state==K&&(b.stop(0),b.disconnect()):b.disconnect(),a.nc=0,a.ul=0,a.qk=0;a.state=S}}function p(a){return!a.j||a.j.state!=K&&a.j.state!=P&&a.j.state!=S?!1:!0}function n(a){return Math.min(a.j.muted?0:a.j.volume,1)}function k(a){return a.muted?0:a.volume}var h=r("__config"),f=r("__debug"),t=r("__print"),u=r("__util"),w=r("vec3"),s=h.lg,B=h.Lf,q=[],y=null,D=null,z=new Float32Array(3),E=new Float32Array(3),M=10,x=[],L=new Float32Array(3),R=new Float32Array(3),I=new Float32Array(3),
Q=[1],H=null,K=20,S=30,P=40,O=1200;a.wm=10;a.Nj=20;a.vm=30;a.Rg=function(){var a=document.createElement("audio");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&q.push("ogg"),""!=a.canPlayType("audio/mpeg")&&q.push("mp3"),""!=a.canPlayType("audio/mp4")&&q.push("mp4"));(y=B.DA?b():null)&&t.log("%cINIT WEBAUDIO: "+y.sampleRate+"Hz","color: #00a")};a.Es=function(a){var b={};a.j=b;if(y){var c=y.createGain(),d=y.createGain();b.sf=c;b.we=d;c.connect(d);d.connect(y.destination);if(a.b4w_enable_dynamic_compressor){var d=
y.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.zg=d;b.Eb=d}else b.zg=null,b.Eb=c;c=y.listener;c.dopplerFactor=a.audio_doppler_factor;c.speedOfSound=a.audio_doppler_speed;b.muted=!1;b.volume=1;b.ue=0}};a.Hy=function(a){D=a};a.Lu=function(a){a||(a="ogg");new Audio;return-1<q.indexOf(a)?a:"ogg"==a&&-1<q.indexOf("mp4")?"mp4":"mp3"==a&&-1<q.indexOf("ogg")?
"ogg":"mp4"==a&&-1<q.indexOf("ogg")?"ogg":""};a.mg=function(a){if("SPEAKER"!=a.type)throw"Wrong speaker object";var b=a.data;a.j={};switch(b.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":a.j.V=y?b.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var c=a.j,d;y?(window.MediaElementAudioSourceNode&&!f.gt()?d=!0:(t.warn("B4W warning: MediaElementAudioSourceNode not found"),d=!1),d=d?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):d="NONE";c.V=d;break;default:throw"Wrong speaker behavior";}b.sound||
(a.j.V="NONE");a.j.Nu=b.b4w_disable_doppler;a.j.muted=b.muted;a.j.volume=b.volume;a.j.pitch=b.pitch;a.j.fi=b.attenuation;a.j.Ai=b.distance_reference;a.j.zi=b.distance_max||1E4;a.j.zt=b.cone_angle_inner;a.j.At=b.cone_angle_outer;a.j.Bt=b.cone_volume_outer;a.j.yc=b.b4w_cyclic_play;a.j.loop=b.b4w_loop;a.j.Hu=b.b4w_delay;a.j.Ju=b.b4w_delay_random;a.j.$f=b.b4w_volume_random;a.j.sh=b.b4w_pitch_random;a.j.Gk=b.b4w_fade_in;a.j.Xc=b.b4w_fade_out;a.j.nc=0;a.j.ul=0;a.j.qk=0;a.j.duration=0;a.j.ik=1;a.j.src=null;
a.j.state=10;a.j.$o=new Float32Array(a.d.e);a.j.We=new Float32Array(a.d.e);a.j.kn=null;a.j.ue=0;x.push(a)};a.eq=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.j.V){case "POSITIONAL":return a.Nj;case "BACKGROUND_SOUND":return a.Nj;case "BACKGROUND_MUSIC":return a.vm;case "NONE":return a.wm;default:throw"Wrong speaker behavior";}};a.mA=function(a,b){if("SPEAKER"!=a.type)throw"Wrong object type";var c=a.j;switch(c.V){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=
b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.Fu=function(a,b,c){y?y.decodeAudioData(a,b,c):c()};a.KC=function(a){g(a);delete a.j;x.splice(x.indexOf(a),1)};a.pa=function(){for(var a=0;a<x.length;a++){var b=x[a].j;"BACKGROUND_MUSIC"==b.V?(b=b.src)&&b.pause():b.Xa&&b.Xa.disconnect()}D=null;x.splice(0);z[0]=0;z[0]=0;z[0]=0;E[0]=0;E[1]=0;E[2]=0;M=10;H=null};a.gq=function(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.animation_data;if(b&&b.nla_tracks){a=a.j;for(var b=
b.nla_tracks,c=[],d=0;d<b.length;d++){var e=b[d].strips;if(e)for(var f=0;f<e.length;f++){var g=e[f],h=[];h.push(g.frame_start);h.push(g.frame_end);c.push(h)}}a.vl=c}};a.Az=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";b.j.vl&&(g(b),a.gq(b))};a.update=function(a){if(0!=x.length){for(var b=0;b<x.length;b++){var e=x[b],f=e.j;!f.loop&&f.yc&&f.state==K&&f.duration&&y&&f.nc+f.duration<y.currentTime&&d(e);if(e.f){var f=e.f.Sb,h=e.j.vl;if(h){for(var l=[],k=0;k<h.length;k++){var n=h[k],p=n[1];
f>=n[0]-1?c(e,0,(p-f)/s.fb):l.push(n)}e.j.vl=l}}}H&&(-1==H.aa||a>H.Vm+H.Vn[H.aa])&&(b=H,-1<b.aa&&g(b.ce[b.aa]),-1==b.aa&&b.random?e=Math.round(Math.random()*(b.ce.length-1)):b.random?(e=1+Math.round(Math.random()*(b.ce.length-2)),e=(b.aa+e)%b.ce.length):e=(b.aa+1)%b.ce.length,d(b.ce[e]),b.aa=e,b.Vm=a)}};a.play=c;a.Bp=d;a.stop=g;a.al=function(a){return a.j.state==K};a.mj=function(a,b){var c=a.j;c.pitch=b;!p(a)||"POSITIONAL"!=c.V&&"BACKGROUND_SOUND"!=c.V||(c.Xa.playbackRate.value=b,e(a,c.nc))};a.VB=
function(a){return a.j.pitch};a.yc=function(a,b){a.j.yc=Boolean(b)};a.Ti=function(a){return a.j.yc};a.mx=function(a,b,c,d){y&&(a=L,a[0]=0,a[1]=-1,a[2]=0,w.transformQuat(a,c,a),R[0]=0,R[1]=0,R[2]=-1,w.transformQuat(R,c,R),c=y.listener,c.setPosition(b[0],b[1],b[2]),c.setOrientation(a[0],a[1],a[2],R[0],R[1],R[2]),d&&(I[0]=(b[0]-z[0])/d,I[1]=(b[1]-z[1])/d,I[2]=(b[2]-z[2])/d,u.Kh(I,E,d,0.3,I),M?M--:c.setVelocity(I[0],I[1],I[2]),E[0]=I[0],E[1]=I[1],E[2]=I[2],z[0]=b[0],z[1]=b[1],z[2]=b[2]))};a.lx=function(){y&&
(y.listener.setVelocity(0,0,0),E[0]=0,E[1]=0,E[2]=0)};a.fq=function(a,b){var c=a.j;if(p(a)&&"POSITIONAL"==c.V){var d=a.d.e,e=c.qh;e.setPosition(d[0],d[1],d[2]);var f=L;u.Mb(a.d.i,u.sd,f);e.setOrientation(f[0],f[1],f[2]);!c.Nu&&b&&(f=c.$o,R[0]=(d[0]-f[0])/b,R[1]=(d[1]-f[1])/b,R[2]=(d[2]-f[2])/b,u.Kh(R,c.We,b,0.3,R),e.setVelocity(R[0],R[1],R[2]),c.We[0]=R[0],c.We[1]=R[1],c.We[2]=R[2],f[0]=d[0],f[1]=d[1],f[2]=d[2])}};a.zz=function(a){var b=a.j;p(a)&&"POSITIONAL"==b.V&&(b.qh.setVelocity(0,0,0),b.We[0]=
0,b.We[1]=0,b.We[2]=0,a=a.d.e,b=b.$o,b[0]=a[0],b[1]=a[1],b[2]=a[2])};a.uf=function(a){return a.j?!0:!1};a.Bo=function(a){return a.j.V};a.dz=function(a){var b=D.j;b&&(b.volume=a,y&&(b.sf.gain.value=k(b)))};a.fw=function(){var a=D.j;return a?a.volume:0};a.$p=function(a,b){var c=a.j;c.volume=b;p(a)&&("BACKGROUND_MUSIC"==c.V?c.src.volume=n(a):c.sf.gain.value=k(c))};a.tw=function(a){return a.j.volume};a.lp=function(a,b){a.j.muted=Boolean(b);if(p(a))if("BACKGROUND_MUSIC"==a.j.V){var c=a.j.src;c?c.volume=
n(a):t.warn("B4W Warning: could not mute sound (no audio element)")}else a.j.sf.gain.value=k(a.j)};a.fx=function(a){return a.j.muted};a.Gx=function(a){var b=D.j;b&&(b.muted=Boolean(a),y&&(b.sf.gain.value=k(b)))};a.ex=function(){var a=D.j;return a?a.muted:!1};a.Ao=function(){return x};a.pause=function(){for(var a=0;a<x.length;a++){var b=x[a].j;if(b.state==K){if("BACKGROUND_MUSIC"==b.V){var c=b.src;c&&c.pause()}else{var d=y.currentTime;b.ul=d;var c=b,e;if(d>b.nc){e=b;Q[0]=e.ik;for(var f=e.Xa.buffer.duration,
g=e.nc,h=void 0;g<d;)h=e.pitch+e.sh*u.Yb(Q),g+=f/h;e=(f/h-(g-d))*h}else e=0;c.qk=e;b.Xa.stop(0);b.Xa.disconnect()}b.state=P}}};a.Cl=function(){for(var a=0;a<x.length;a++){var b=x[a],c=b.j;if(c.state==P){if("BACKGROUND_MUSIC"==c.V)c.src.play();else{var d=b.j,f=y.createBufferSource();f.loop=d.Xa.loop;f.buffer=d.Xa.buffer;f.playbackRate.value=d.Xa.playbackRate.value;d.qh?f.connect(d.qh):f.connect(d.sf);d.Xa=f;c.nc+=y.currentTime-c.ul;c.Xa.start(c.nc,c.qk);e(b,c.nc);l(c,c.nc)}c.state=K}}};a.Ty=function(a,
b){if(a.j&&a.j.zg){var c=a.j.zg;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.Wv=function(a){if(!a.j||!a.j.zg)return null;a=a.j.zg;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,release:a.release.value}};a.Vu=function(a,b,c){if(p(a)){a=a.j;var d=a.we,e=y.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(b,e+c);a.ue=c}};a.aA=function(a){if(p(a)){a=
a.j;var b=a.we,c=y.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.ue);a.ue=0}};a.Wu=function(a,b){if(y){var c=D.j,d=c.we,e=y.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,e+b);c.ue=b}};a.bA=function(){if(y){var a=D.j,b=a.we,c=y.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.ue);a.ue=0}};a.us=function(a,b,c){H={aa:-1,Vm:0,random:c,ce:[],Vn:[]};for(c=0;c<a.length;c++){var d=a[c];g(d);
H.ce.push(d);d=d.j;d="POSITIONAL"==d.V||"BACKGROUND_SOUND"==d.V?(d=d.Xa)&&d.buffer?d.buffer.duration:0:(d=d.src)?d.duration:0;H.Vn.push(d+b)}};a.rt=function(){if(H)for(var a=H.ce,b=0;b<a.length;b++)g(a[b]);H=null};a.hw=function(a){return(a=a.j)&&"POSITIONAL"==a.V?{dist_ref:a.Ai,dist_max:a.zi,attenuation:a.fi}:null};a.ez=function(a,b){var c=a.j;if(c&&"POSITIONAL"==c.V){c.Ai=b.dist_ref;c.zi=b.dist_max;c.fi=b.attenuation;var d=c.qh;d&&(d.refDistance=c.Ai,d.maxDistance=c.zi,d.rolloffFactor=c.fi)}};a.Xy=
function(a,b){var c=a.j;c&&c.zc&&(c.zc.sv.value=b.freq,c.zc.Sr.value=b.Q,c.zc.gain.value=b.gain)};a.cw=function(a){return(a=a.j)&&a.zc?{freq:a.zc.sv.value,Q:a.zc.Sr.value,gain:a.zc.gain.value}:null};a.bw=function(a,b,c,d){a=a.j;if(!a||!a.zc)return null;a.zc.OB(b,c,d)}};b4w.module.vec3=function(a){var r="undefined"!==typeof Float32Array?Float32Array:Array,b=Math.random;a.create=function(){var a=new r(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var b=new r(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.fromValues=function(a,b,e){var l=new r(3);l[0]=a;l[1]=b;l[2]=e;return l};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set=function(a,b,e,l){l[0]=a;l[1]=b;l[2]=e;return l};a.add=function(a,b,e){e[0]=a[0]+b[0];e[1]=a[1]+b[1];e[2]=a[2]+b[2];return e};
a.subtract=function(a,b,e){e[0]=a[0]-b[0];e[1]=a[1]-b[1];e[2]=a[2]-b[2];return e};a.sub=a.subtract;a.multiply=function(a,b,e){e[0]=a[0]*b[0];e[1]=a[1]*b[1];e[2]=a[2]*b[2];return e};a.mul=a.multiply;a.divide=function(a,b,e){e[0]=a[0]/b[0];e[1]=a[1]/b[1];e[2]=a[2]/b[2];return e};a.div=a.divide;a.min=function(a,b,e){e[0]=Math.min(a[0],b[0]);e[1]=Math.min(a[1],b[1]);e[2]=Math.min(a[2],b[2]);return e};a.max=function(a,b,e){e[0]=Math.max(a[0],b[0]);e[1]=Math.max(a[1],b[1]);e[2]=Math.max(a[2],b[2]);return e};
a.scale=function(a,b,e){e[0]=a[0]*b;e[1]=a[1]*b;e[2]=a[2]*b;return e};a.scaleAndAdd=function(a,b,e,l){l[0]=a[0]+b[0]*e;l[1]=a[1]+b[1]*e;l[2]=a[2]+b[2]*e;return l};a.distance=function(a,b){var e=b[0]-a[0],l=b[1]-a[1],g=b[2]-a[2];return Math.sqrt(e*e+l*l+g*g)};a.dist=a.distance;a.squaredDistance=function(a,b){var e=b[0]-a[0],l=b[1]-a[1],g=b[2]-a[2];return e*e+l*l+g*g};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],e=a[1];a=a[2];return Math.sqrt(b*b+e*e+a*a)};a.len=a.length;a.squaredLength=
function(a){var b=a[0],e=a[1];a=a[2];return b*b+e*e+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};a.normalize=function(a,b){var e=a[0],l=a[1],g=a[2],e=e*e+l*l+g*g;0<e&&(e=1/Math.sqrt(e),b[0]=a[0]*e,b[1]=a[1]*e,b[2]=a[2]*e);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};a.cross=function(a,b,e){var l=a[0],g=a[1];a=a[2];var p=b[0],n=b[1];b=b[2];e[0]=g*b-a*n;e[1]=a*p-l*b;e[2]=l*n-g*p;return e};a.lerp=function(a,b,e,l){var g=a[0],p=
a[1];a=a[2];l[0]=g+e*(b[0]-g);l[1]=p+e*(b[1]-p);l[2]=a+e*(b[2]-a);return l};a.random=function(a,d){a=a||1;var e=2*b()*Math.PI,l=2*b()-1,g=Math.sqrt(1-l*l)*a;d[0]=Math.cos(e)*g;d[1]=Math.sin(e)*g;d[2]=l*a;return d};a.transformMat4=function(a,b,e){var l=a[0],g=a[1];a=a[2];e[0]=b[0]*l+b[4]*g+b[8]*a+b[12];e[1]=b[1]*l+b[5]*g+b[9]*a+b[13];e[2]=b[2]*l+b[6]*g+b[10]*a+b[14];return e};a.transformMat3=function(a,b,e){var l=a[0],g=a[1];a=a[2];e[0]=l*b[0]+g*b[3]+a*b[6];e[1]=l*b[1]+g*b[4]+a*b[7];e[2]=l*b[2]+g*
b[5]+a*b[8];return e};a.transformQuat=function(a,b,e){var l=a[0],g=a[1],p=a[2];a=b[0];var n=b[1],k=b[2];b=b[3];var h=b*l+n*p-k*g,f=b*g+k*l-a*p,t=b*p+a*g-n*l,l=-a*l-n*g-k*p;e[0]=h*b+l*-a+f*-k-t*-n;e[1]=f*b+l*-n+t*-a-h*-k;e[2]=t*b+l*-k+h*-n-f*-a;return e};a.rotateX=function(a,b,e,l){var g=[],p=[];g[0]=a[0]-b[0];g[1]=a[1]-b[1];g[2]=a[2]-b[2];p[0]=g[0];p[1]=g[1]*Math.cos(e)-g[2]*Math.sin(e);p[2]=g[1]*Math.sin(e)+g[2]*Math.cos(e);l[0]=p[0]+b[0];l[1]=p[1]+b[1];l[2]=p[2]+b[2];return l};a.rotateY=function(a,
b,e,l){var g=[],p=[];g[0]=a[0]-b[0];g[1]=a[1]-b[1];g[2]=a[2]-b[2];p[0]=g[2]*Math.sin(e)+g[0]*Math.cos(e);p[1]=g[1];p[2]=g[2]*Math.cos(e)-g[0]*Math.sin(e);l[0]=p[0]+b[0];l[1]=p[1]+b[1];l[2]=p[2]+b[2];return l};a.rotateZ=function(a,b,e,l){var g=[],p=[];g[0]=a[0]-b[0];g[1]=a[1]-b[1];g[2]=a[2]-b[2];p[0]=g[0]*Math.cos(e)-g[1]*Math.sin(e);p[1]=g[0]*Math.sin(e)+g[1]*Math.cos(e);p[2]=g[2];l[0]=p[0]+b[0];l[1]=p[1]+b[1];l[2]=p[2]+b[2];return l};a.forEach=function(){var b=a.create();return function(a,e,l,g,
p,n){e||(e=3);l||(l=0);for(g=g?Math.min(g*e+l,a.length):a.length;l<g;l+=e)b[0]=a[l],b[1]=a[l+1],b[2]=a[l+2],p(b,n,b),a[l]=b[0],a[l+1]=b[1],a[l+2]=b[2];return a}}();a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==typeof a&&(a.VC=a)};
b4w.module.vec4=function(a){var r="undefined"!==typeof Float32Array?Float32Array:Array,b=Math.random;a.create=function(){var a=new r(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var b=new r(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=function(a,b,e,l){var g=new r(4);g[0]=a;g[1]=b;g[2]=e;g[3]=l;return g};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set=function(a,b,e,l,g){g[0]=a;g[1]=b;g[2]=e;g[3]=l;return g};a.add=function(a,b,e){e[0]=
a[0]+b[0];e[1]=a[1]+b[1];e[2]=a[2]+b[2];e[3]=a[3]+b[3];return e};a.subtract=function(a,b,e){e[0]=a[0]-b[0];e[1]=a[1]-b[1];e[2]=a[2]-b[2];e[3]=a[3]-b[3];return e};a.sub=a.subtract;a.multiply=function(a,b,e){e[0]=a[0]*b[0];e[1]=a[1]*b[1];e[2]=a[2]*b[2];e[3]=a[3]*b[3];return e};a.mul=a.multiply;a.divide=function(a,b,e){e[0]=a[0]/b[0];e[1]=a[1]/b[1];e[2]=a[2]/b[2];e[3]=a[3]/b[3];return e};a.div=a.divide;a.min=function(a,b,e){e[0]=Math.min(a[0],b[0]);e[1]=Math.min(a[1],b[1]);e[2]=Math.min(a[2],b[2]);e[3]=
Math.min(a[3],b[3]);return e};a.max=function(a,b,e){e[0]=Math.max(a[0],b[0]);e[1]=Math.max(a[1],b[1]);e[2]=Math.max(a[2],b[2]);e[3]=Math.max(a[3],b[3]);return e};a.scale=function(a,b,e){e[0]=a[0]*b;e[1]=a[1]*b;e[2]=a[2]*b;e[3]=a[3]*b;return e};a.scaleAndAdd=function(a,b,e,l){l[0]=a[0]+b[0]*e;l[1]=a[1]+b[1]*e;l[2]=a[2]+b[2]*e;l[3]=a[3]+b[3]*e;return l};a.distance=function(a,b){var e=b[0]-a[0],l=b[1]-a[1],g=b[2]-a[2],p=b[3]-a[3];return Math.sqrt(e*e+l*l+g*g+p*p)};a.dist=a.distance;a.squaredDistance=
function(a,b){var e=b[0]-a[0],l=b[1]-a[1],g=b[2]-a[2],p=b[3]-a[3];return e*e+l*l+g*g+p*p};a.sqrDist=a.squaredDistance;a.length=function(a){var b=a[0],e=a[1],l=a[2];a=a[3];return Math.sqrt(b*b+e*e+l*l+a*a)};a.len=a.length;a.squaredLength=function(a){var b=a[0],e=a[1],l=a[2];a=a[3];return b*b+e*e+l*l+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};a.normalize=function(a,b){var e=a[0],l=a[1],g=a[2],p=a[3],e=e*e+l*l+g*g+p*p;0<e&&(e=1/Math.sqrt(e),
b[0]=a[0]*e,b[1]=a[1]*e,b[2]=a[2]*e,b[3]=a[3]*e);return b};a.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};a.lerp=function(a,b,e,l){var g=a[0],p=a[1],n=a[2];a=a[3];l[0]=g+e*(b[0]-g);l[1]=p+e*(b[1]-p);l[2]=n+e*(b[2]-n);l[3]=a+e*(b[3]-a);return l};a.random=function(c,d){c=c||1;d[0]=b();d[1]=b();d[2]=b();d[3]=b();a.normalize(d,d);a.scale(d,c,d);return d};a.transformMat4=function(a,b,e){var l=a[0],g=a[1],p=a[2];a=a[3];e[0]=b[0]*l+b[4]*g+b[8]*p+b[12]*a;e[1]=b[1]*l+b[5]*g+b[9]*p+b[13]*
a;e[2]=b[2]*l+b[6]*g+b[10]*p+b[14]*a;e[3]=b[3]*l+b[7]*g+b[11]*p+b[15]*a;return e};a.transformQuat=function(a,b,e){var l=a[0],g=a[1],p=a[2];a=b[0];var n=b[1],k=b[2];b=b[3];var h=b*l+n*p-k*g,f=b*g+k*l-a*p,t=b*p+a*g-n*l,l=-a*l-n*g-k*p;e[0]=h*b+l*-a+f*-k-t*-n;e[1]=f*b+l*-n+t*-a-h*-k;e[2]=t*b+l*-k+h*-n-f*-a;return e};a.forEach=function(){var b=a.create();return function(a,e,l,g,p,n){e||(e=4);l||(l=0);for(g=g?Math.min(g*e+l,a.length):a.length;l<g;l+=e)b[0]=a[l],b[1]=a[l+1],b[2]=a[l+2],b[3]=a[l+3],p(b,n,
b),a[l]=b[0],a[l+1]=b[1],a[l+2]=b[2],a[l+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.WC=a)};
b4w.module.quat=function(a,r){var b=r("vec3"),c=r("vec4"),d=r("mat3"),e="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new e(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var c=b.create(),d=b.fromValues(1,0,0),e=b.fromValues(0,1,0);return function(n,k,h){var f=b.dot(n,k);if(-0.9999999>f)return b.cross(d,n,c),1E-6>b.length(c)&&b.cross(e,n,c),b.normalize(c,c),a.setAxisAngle(c,Math.PI,h),h;if(0.9999999<f)return h[0]=0,h[1]=0,h[2]=0,h[3]=1,h;b.cross(n,
k,c);h[0]=c[0];h[1]=c[1];h[2]=c[2];h[3]=1+f;return a.normalize(h,h)}}();a.setAxes=function(){var b=d.create();return function(c,d,e,k){b[0]=d[0];b[3]=d[1];b[6]=d[2];b[1]=e[0];b[4]=e[1];b[7]=e[2];b[2]=-c[0];b[5]=-c[1];b[8]=-c[2];return a.normalize(a.fromMat3(b,k),k)}}();a.clone=c.clone;a.fromValues=c.fromValues;a.copy=c.copy;a.set=c.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,c){b*=0.5;var d=Math.sin(b);c[0]=d*a[0];c[1]=d*a[1];c[2]=d*a[2];c[3]=Math.cos(b);
return c};a.add=c.add;a.multiply=function(a,b,c){var d=a[0],e=a[1],h=a[2];a=a[3];var f=b[0],t=b[1],u=b[2];b=b[3];c[0]=d*b+a*f+e*u-h*t;c[1]=e*b+a*t+h*f-d*u;c[2]=h*b+a*u+d*t-e*f;c[3]=a*b-d*f-e*t-h*u;return c};a.mul=a.multiply;a.scale=c.scale;a.rotateX=function(a,b,c){b*=0.5;var d=a[0],e=a[1],h=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=d*b+a*f;c[1]=e*b+h*f;c[2]=h*b-e*f;c[3]=a*b-d*f;return c};a.rotateY=function(a,b,c){b*=0.5;var d=a[0],e=a[1],h=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=
d*b-h*f;c[1]=e*b+a*f;c[2]=h*b+d*f;c[3]=a*b-e*f;return c};a.rotateZ=function(a,b,c){b*=0.5;var d=a[0],e=a[1],h=a[2];a=a[3];var f=Math.sin(b);b=Math.cos(b);c[0]=d*b+e*f;c[1]=e*b-d*f;c[2]=h*b+a*f;c[3]=a*b-h*f;return c};a.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];b[0]=c;b[1]=d;b[2]=e;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};a.dot=c.dot;a.lerp=c.lerp;a.slerp=function(a,b,c,d){var e=a[0],h=a[1],f=a[2];a=a[3];var t=b[0],u=b[1],r=b[2];b=b[3];var s,B,q;B=e*t+h*u+f*r+a*b;0>B&&(B=-B,t=-t,u=
-u,r=-r,b=-b);1E-6<1-B?(s=Math.acos(B),q=Math.sin(s),B=Math.sin((1-c)*s)/q,c=Math.sin(c*s)/q):B=1-c;d[0]=B*e+c*t;d[1]=B*h+c*u;d[2]=B*f+c*r;d[3]=B*a+c*b;return d};a.invert=function(a,b){var c=a[0],d=a[1],e=a[2],h=a[3],f=c*c+d*d+e*e+h*h,f=f?1/f:0;b[0]=-c*f;b[1]=-d*f;b[2]=-e*f;b[3]=h*f;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=c.length;a.len=a.length;a.squaredLength=c.squaredLength;a.sqrLen=a.squaredLength;a.normalize=c.normalize;a.fromMat3=function(a,
b){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=0.5*c,c=0.5/c,b[0]=(a[7]-a[5])*c,b[1]=(a[2]-a[6])*c,b[2]=(a[3]-a[1])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var e=(d+1)%3,h=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*e+e]-a[3*h+h]+1);b[d]=0.5*c;c=0.5/c;b[3]=(a[3*h+e]-a[3*e+h])*c;b[e]=(a[3*e+d]+a[3*d+e])*c;b[h]=(a[3*h+d]+a[3*d+h])*c}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.i=a)};
b4w.module.mat3=function(a){var r="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new r(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[4];c[4]=a[5];c[5]=a[6];c[6]=a[8];c[7]=a[9];c[8]=a[10];return c};a.clone=function(a){var c=new r(9);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.copy=function(a,c){c[0]=a[0];c[1]=a[1];c[2]=
a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,c){if(c===a){var d=a[1],e=a[2],l=a[5];c[1]=a[3];c[2]=a[6];c[3]=d;c[5]=a[7];c[6]=e;c[7]=l}else c[0]=a[0],c[1]=a[3],c[2]=a[6],c[3]=a[1],c[4]=a[4],c[5]=a[7],c[6]=a[2],c[7]=a[5],c[8]=a[8];return c};a.invert=function(a,c){var d=a[0],e=a[1],l=a[2],g=a[3],p=a[4],n=a[5],k=a[6],h=a[7],f=a[8],t=f*p-n*h,u=-f*g+n*k,r=
h*g-p*k,s=d*t+e*u+l*r;if(!s)return null;s=1/s;c[0]=t*s;c[1]=(-f*e+l*h)*s;c[2]=(n*e-l*p)*s;c[3]=u*s;c[4]=(f*d-l*k)*s;c[5]=(-n*d+l*g)*s;c[6]=r*s;c[7]=(-h*d+e*k)*s;c[8]=(p*d-e*g)*s;return c};a.adjoint=function(a,c){var d=a[0],e=a[1],l=a[2],g=a[3],p=a[4],n=a[5],k=a[6],h=a[7],f=a[8];c[0]=p*f-n*h;c[1]=l*h-e*f;c[2]=e*n-l*p;c[3]=n*k-g*f;c[4]=d*f-l*k;c[5]=l*g-d*n;c[6]=g*h-p*k;c[7]=e*k-d*h;c[8]=d*p-e*g;return c};a.determinant=function(a){var c=a[3],d=a[4],e=a[5],l=a[6],g=a[7],p=a[8];return a[0]*(p*d-e*g)+a[1]*
(-p*c+e*l)+a[2]*(g*c-d*l)};a.multiply=function(a,c,d){var e=a[0],l=a[1],g=a[2],p=a[3],n=a[4],k=a[5],h=a[6],f=a[7];a=a[8];var t=c[0],u=c[1],r=c[2],s=c[3],B=c[4],q=c[5],y=c[6],D=c[7];c=c[8];d[0]=t*e+u*p+r*h;d[1]=t*l+u*n+r*f;d[2]=t*g+u*k+r*a;d[3]=s*e+B*p+q*h;d[4]=s*l+B*n+q*f;d[5]=s*g+B*k+q*a;d[6]=y*e+D*p+c*h;d[7]=y*l+D*n+c*f;d[8]=y*g+D*k+c*a;return d};a.mul=a.multiply;a.translate=function(a,c,d){var e=a[0],l=a[1],g=a[2],p=a[3],n=a[4],k=a[5],h=a[6],f=a[7];a=a[8];var t=c[0];c=c[1];d[0]=e;d[1]=l;d[2]=g;
d[3]=p;d[4]=n;d[5]=k;d[6]=t*e+c*p+h;d[7]=t*l+c*n+f;d[8]=t*g+c*k+a;return d};a.rotate=function(a,c,d){var e=a[0],l=a[1],g=a[2],p=a[3],n=a[4],k=a[5],h=a[6],f=a[7];a=a[8];var t=Math.sin(c);c=Math.cos(c);d[0]=c*e+t*p;d[1]=c*l+t*n;d[2]=c*g+t*k;d[3]=c*p-t*e;d[4]=c*n-t*l;d[5]=c*k-t*g;d[6]=h;d[7]=f;d[8]=a;return d};a.scale=function(a,c,d){var e=c[0];c=c[1];d[0]=e*a[0];d[1]=e*a[1];d[2]=e*a[2];d[3]=c*a[3];d[4]=c*a[4];d[5]=c*a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];return d};a.fromMat2d=function(a,c){c[0]=a[0];c[1]=
a[1];c[2]=0;c[3]=a[2];c[4]=a[3];c[5]=0;c[6]=a[4];c[7]=a[5];c[8]=1;return c};a.fromQuat=function(a,c){var d=a[0],e=a[1],l=a[2],g=a[3],p=d+d,n=e+e,k=l+l,d=d*p,h=e*p,e=e*n,f=l*p,t=l*n,l=l*k,p=g*p,n=g*n,g=g*k;c[0]=1-e-l;c[3]=h-g;c[6]=f+n;c[1]=h+g;c[4]=1-d-l;c[7]=t-p;c[2]=f-n;c[5]=t+p;c[8]=1-d-e;return c};a.normalFromMat4=function(a,c){var d=a[0],e=a[1],l=a[2],g=a[3],p=a[4],n=a[5],k=a[6],h=a[7],f=a[8],t=a[9],u=a[10],r=a[11],s=a[12],B=a[13],q=a[14],y=a[15],D=d*n-e*p,z=d*k-l*p,E=d*h-g*p,M=e*k-l*n,x=e*h-
g*n,L=l*h-g*k,R=f*B-t*s,I=f*q-u*s,f=f*y-r*s,Q=t*q-u*B,t=t*y-r*B,u=u*y-r*q,r=D*u-z*t+E*Q+M*f-x*I+L*R;if(!r)return null;r=1/r;c[0]=(n*u-k*t+h*Q)*r;c[1]=(k*f-p*u-h*I)*r;c[2]=(p*t-n*f+h*R)*r;c[3]=(l*t-e*u-g*Q)*r;c[4]=(d*u-l*f+g*I)*r;c[5]=(e*f-d*t-g*R)*r;c[6]=(B*L-q*x+y*M)*r;c[7]=(q*E-s*L-y*z)*r;c[8]=(s*x-B*E+y*D)*r;return c};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.tv=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],
2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof a&&(a.tC=a)};
b4w.module.mat4=function(a){var r="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new r(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var c=new r(16);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.copy=function(a,c){c[0]=a[0];c[1]=
a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,c){if(c===a){var d=a[1],e=a[2],l=a[3],g=a[6],p=a[7],n=a[11];c[1]=a[4];c[2]=a[8];c[3]=a[12];c[4]=d;c[6]=a[9];c[7]=a[13];c[8]=e;c[9]=g;c[11]=a[14];c[12]=l;c[13]=p;
c[14]=n}else c[0]=a[0],c[1]=a[4],c[2]=a[8],c[3]=a[12],c[4]=a[1],c[5]=a[5],c[6]=a[9],c[7]=a[13],c[8]=a[2],c[9]=a[6],c[10]=a[10],c[11]=a[14],c[12]=a[3],c[13]=a[7],c[14]=a[11],c[15]=a[15];return c};a.invert=function(a,c){var d=a[0],e=a[1],l=a[2],g=a[3],p=a[4],n=a[5],k=a[6],h=a[7],f=a[8],t=a[9],u=a[10],r=a[11],s=a[12],B=a[13],q=a[14],y=a[15],D=d*n-e*p,z=d*k-l*p,E=d*h-g*p,M=e*k-l*n,x=e*h-g*n,L=l*h-g*k,R=f*B-t*s,I=f*q-u*s,Q=f*y-r*s,H=t*q-u*B,K=t*y-r*B,S=u*y-r*q,P=D*S-z*K+E*H+M*Q-x*I+L*R;if(!P)return null;
P=1/P;c[0]=(n*S-k*K+h*H)*P;c[1]=(l*K-e*S-g*H)*P;c[2]=(B*L-q*x+y*M)*P;c[3]=(u*x-t*L-r*M)*P;c[4]=(k*Q-p*S-h*I)*P;c[5]=(d*S-l*Q+g*I)*P;c[6]=(q*E-s*L-y*z)*P;c[7]=(f*L-u*E+r*z)*P;c[8]=(p*K-n*Q+h*R)*P;c[9]=(e*Q-d*K-g*R)*P;c[10]=(s*x-B*E+y*D)*P;c[11]=(t*E-f*x-r*D)*P;c[12]=(n*I-p*H-k*R)*P;c[13]=(d*H-e*I+l*R)*P;c[14]=(B*z-s*M-q*D)*P;c[15]=(f*M-t*z+u*D)*P;return c};a.adjoint=function(a,c){var d=a[0],e=a[1],l=a[2],g=a[3],p=a[4],n=a[5],k=a[6],h=a[7],f=a[8],t=a[9],u=a[10],r=a[11],s=a[12],B=a[13],q=a[14],y=a[15];
c[0]=n*(u*y-r*q)-t*(k*y-h*q)+B*(k*r-h*u);c[1]=-(e*(u*y-r*q)-t*(l*y-g*q)+B*(l*r-g*u));c[2]=e*(k*y-h*q)-n*(l*y-g*q)+B*(l*h-g*k);c[3]=-(e*(k*r-h*u)-n*(l*r-g*u)+t*(l*h-g*k));c[4]=-(p*(u*y-r*q)-f*(k*y-h*q)+s*(k*r-h*u));c[5]=d*(u*y-r*q)-f*(l*y-g*q)+s*(l*r-g*u);c[6]=-(d*(k*y-h*q)-p*(l*y-g*q)+s*(l*h-g*k));c[7]=d*(k*r-h*u)-p*(l*r-g*u)+f*(l*h-g*k);c[8]=p*(t*y-r*B)-f*(n*y-h*B)+s*(n*r-h*t);c[9]=-(d*(t*y-r*B)-f*(e*y-g*B)+s*(e*r-g*t));c[10]=d*(n*y-h*B)-p*(e*y-g*B)+s*(e*h-g*n);c[11]=-(d*(n*r-h*t)-p*(e*r-g*t)+f*
(e*h-g*n));c[12]=-(p*(t*q-u*B)-f*(n*q-k*B)+s*(n*u-k*t));c[13]=d*(t*q-u*B)-f*(e*q-l*B)+s*(e*u-l*t);c[14]=-(d*(n*q-k*B)-p*(e*q-l*B)+s*(e*k-l*n));c[15]=d*(n*u-k*t)-p*(e*u-l*t)+f*(e*k-l*n);return c};a.determinant=function(a){var c=a[0],d=a[1],e=a[2],l=a[3],g=a[4],p=a[5],n=a[6],k=a[7],h=a[8],f=a[9],t=a[10],r=a[11],w=a[12],s=a[13],B=a[14];a=a[15];return(c*p-d*g)*(t*a-r*B)-(c*n-e*g)*(f*a-r*s)+(c*k-l*g)*(f*B-t*s)+(d*n-e*p)*(h*a-r*w)-(d*k-l*p)*(h*B-t*w)+(e*k-l*n)*(h*s-f*w)};a.multiply=function(a,c,d){var e=
a[0],l=a[1],g=a[2],p=a[3],n=a[4],k=a[5],h=a[6],f=a[7],t=a[8],r=a[9],w=a[10],s=a[11],B=a[12],q=a[13],y=a[14];a=a[15];var D=c[0],z=c[1],E=c[2],M=c[3];d[0]=D*e+z*n+E*t+M*B;d[1]=D*l+z*k+E*r+M*q;d[2]=D*g+z*h+E*w+M*y;d[3]=D*p+z*f+E*s+M*a;D=c[4];z=c[5];E=c[6];M=c[7];d[4]=D*e+z*n+E*t+M*B;d[5]=D*l+z*k+E*r+M*q;d[6]=D*g+z*h+E*w+M*y;d[7]=D*p+z*f+E*s+M*a;D=c[8];z=c[9];E=c[10];M=c[11];d[8]=D*e+z*n+E*t+M*B;d[9]=D*l+z*k+E*r+M*q;d[10]=D*g+z*h+E*w+M*y;d[11]=D*p+z*f+E*s+M*a;D=c[12];z=c[13];E=c[14];M=c[15];d[12]=D*e+
z*n+E*t+M*B;d[13]=D*l+z*k+E*r+M*q;d[14]=D*g+z*h+E*w+M*y;d[15]=D*p+z*f+E*s+M*a;return d};a.mul=a.multiply;a.translate=function(a,c,d){var e=c[0],l=c[1];c=c[2];var g,p,n,k,h,f,t,r,w,s,B,q;a===d?(d[12]=a[0]*e+a[4]*l+a[8]*c+a[12],d[13]=a[1]*e+a[5]*l+a[9]*c+a[13],d[14]=a[2]*e+a[6]*l+a[10]*c+a[14],d[15]=a[3]*e+a[7]*l+a[11]*c+a[15]):(g=a[0],p=a[1],n=a[2],k=a[3],h=a[4],f=a[5],t=a[6],r=a[7],w=a[8],s=a[9],B=a[10],q=a[11],d[0]=g,d[1]=p,d[2]=n,d[3]=k,d[4]=h,d[5]=f,d[6]=t,d[7]=r,d[8]=w,d[9]=s,d[10]=B,d[11]=q,
d[12]=g*e+h*l+w*c+a[12],d[13]=p*e+f*l+s*c+a[13],d[14]=n*e+t*l+B*c+a[14],d[15]=k*e+r*l+q*c+a[15]);return d};a.scale=function(a,c,d){var e=c[0],l=c[1];c=c[2];d[0]=a[0]*e;d[1]=a[1]*e;d[2]=a[2]*e;d[3]=a[3]*e;d[4]=a[4]*l;d[5]=a[5]*l;d[6]=a[6]*l;d[7]=a[7]*l;d[8]=a[8]*c;d[9]=a[9]*c;d[10]=a[10]*c;d[11]=a[11]*c;d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};a.rotate=function(a,c,d,e){var l=d[0],g=d[1];d=d[2];var p=Math.sqrt(l*l+g*g+d*d),n,k,h,f,t,r,w,s,B,q,y,D,z,E,M,x,L,R,I,Q;if(1E-7>Math.abs(p))return null;
p=1/p;l*=p;g*=p;d*=p;n=Math.sin(c);k=Math.cos(c);h=1-k;c=a[0];p=a[1];f=a[2];t=a[3];r=a[4];w=a[5];s=a[6];B=a[7];q=a[8];y=a[9];D=a[10];z=a[11];E=l*l*h+k;M=g*l*h+d*n;x=d*l*h-g*n;L=l*g*h-d*n;R=g*g*h+k;I=d*g*h+l*n;Q=l*d*h+g*n;l=g*d*h-l*n;g=d*d*h+k;e[0]=c*E+r*M+q*x;e[1]=p*E+w*M+y*x;e[2]=f*E+s*M+D*x;e[3]=t*E+B*M+z*x;e[4]=c*L+r*R+q*I;e[5]=p*L+w*R+y*I;e[6]=f*L+s*R+D*I;e[7]=t*L+B*R+z*I;e[8]=c*Q+r*l+q*g;e[9]=p*Q+w*l+y*g;e[10]=f*Q+s*l+D*g;e[11]=t*Q+B*l+z*g;a!==e&&(e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);
return e};a.rotateX=function(a,c,d){var e=Math.sin(c);c=Math.cos(c);var l=a[4],g=a[5],p=a[6],n=a[7],k=a[8],h=a[9],f=a[10],t=a[11];a!==d&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);d[4]=l*c+k*e;d[5]=g*c+h*e;d[6]=p*c+f*e;d[7]=n*c+t*e;d[8]=k*c-l*e;d[9]=h*c-g*e;d[10]=f*c-p*e;d[11]=t*c-n*e;return d};a.rotateY=function(a,c,d){var e=Math.sin(c);c=Math.cos(c);var l=a[0],g=a[1],p=a[2],n=a[3],k=a[8],h=a[9],f=a[10],t=a[11];a!==d&&(d[4]=a[4],d[5]=a[5],d[6]=a[6],
d[7]=a[7],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);d[0]=l*c-k*e;d[1]=g*c-h*e;d[2]=p*c-f*e;d[3]=n*c-t*e;d[8]=l*e+k*c;d[9]=g*e+h*c;d[10]=p*e+f*c;d[11]=n*e+t*c;return d};a.rotateZ=function(a,c,d){var e=Math.sin(c);c=Math.cos(c);var l=a[0],g=a[1],p=a[2],n=a[3],k=a[4],h=a[5],f=a[6],t=a[7];a!==d&&(d[8]=a[8],d[9]=a[9],d[10]=a[10],d[11]=a[11],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);d[0]=l*c+k*e;d[1]=g*c+h*e;d[2]=p*c+f*e;d[3]=n*c+t*e;d[4]=k*c-l*e;d[5]=h*c-g*e;d[6]=f*c-p*e;d[7]=t*c-n*e;return d};
a.fromRotationTranslation=function(a,c,d){var e=a[0],l=a[1],g=a[2],p=a[3],n=e+e,k=l+l,h=g+g;a=e*n;var f=e*k,e=e*h,t=l*k,l=l*h,g=g*h,n=p*n,k=p*k,p=p*h;d[0]=1-(t+g);d[1]=f+p;d[2]=e-k;d[3]=0;d[4]=f-p;d[5]=1-(a+g);d[6]=l+n;d[7]=0;d[8]=e+k;d[9]=l-n;d[10]=1-(a+t);d[11]=0;d[12]=c[0];d[13]=c[1];d[14]=c[2];d[15]=1;return d};a.fromQuat=function(a,c){var d=a[0],e=a[1],l=a[2],g=a[3],p=d+d,n=e+e,k=l+l,d=d*p,h=e*p,e=e*n,f=l*p,t=l*n,l=l*k,p=g*p,n=g*n,g=g*k;c[0]=1-e-l;c[1]=h+g;c[2]=f-n;c[3]=0;c[4]=h-g;c[5]=1-d-l;
c[6]=t+p;c[7]=0;c[8]=f+n;c[9]=t-p;c[10]=1-d-e;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.frustum=function(a,c,d,e,l,g,p){var n=1/(c-a),k=1/(e-d),h=1/(l-g);p[0]=2*l*n;p[1]=0;p[2]=0;p[3]=0;p[4]=0;p[5]=2*l*k;p[6]=0;p[7]=0;p[8]=(c+a)*n;p[9]=(e+d)*k;p[10]=(g+l)*h;p[11]=-1;p[12]=0;p[13]=0;p[14]=2*g*l*h;p[15]=0;return p};a.perspective=function(a,c,d,e,l){a=1/Math.tan(a/2);var g=1/(d-e);l[0]=a/c;l[1]=0;l[2]=0;l[3]=0;l[4]=0;l[5]=a;l[6]=0;l[7]=0;l[8]=0;l[9]=0;l[10]=(e+d)*g;l[11]=-1;l[12]=0;l[13]=0;
l[14]=2*e*d*g;l[15]=0;return l};a.ortho=function(a,c,d,e,l,g,p){var n=1/(a-c),k=1/(d-e),h=1/(l-g);p[0]=-2*n;p[1]=0;p[2]=0;p[3]=0;p[4]=0;p[5]=-2*k;p[6]=0;p[7]=0;p[8]=0;p[9]=0;p[10]=2*h;p[11]=0;p[12]=(a+c)*n;p[13]=(e+d)*k;p[14]=(g+l)*h;p[15]=1;return p};a.lookAt=function(b,c,d,e){var l,g,p,n,k,h,f,t,r=b[0],w=b[1];b=b[2];p=d[0];n=d[1];g=d[2];f=c[0];d=c[1];l=c[2];if(1E-7>Math.abs(r-f)&&1E-7>Math.abs(w-d)&&1E-7>Math.abs(b-l))return a.identity(e);c=r-f;d=w-d;f=b-l;t=1/Math.sqrt(c*c+d*d+f*f);c*=t;d*=t;f*=
t;l=n*f-g*d;g=g*c-p*f;p=p*d-n*c;(t=Math.sqrt(l*l+g*g+p*p))?(t=1/t,l*=t,g*=t,p*=t):p=g=l=0;n=d*p-f*g;k=f*l-c*p;h=c*g-d*l;(t=Math.sqrt(n*n+k*k+h*h))?(t=1/t,n*=t,k*=t,h*=t):h=k=n=0;e[0]=l;e[1]=n;e[2]=c;e[3]=0;e[4]=g;e[5]=k;e[6]=d;e[7]=0;e[8]=p;e[9]=h;e[10]=f;e[11]=0;e[12]=-(l*r+g*w+p*b);e[13]=-(n*r+k*w+h*b);e[14]=-(c*r+d*w+f*b);e[15]=1;return e};a.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+
", "+a[13]+", "+a[14]+", "+a[15]+")"};a.tv=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof a&&(a.uC=a)};b4w.module.__gpp_eval=function(a){a.yp=function(){function a(b,c,d,e,l,g){this.message=b;this.offset=e;this.bh=l;this.lf=g;this.name="SyntaxError"}(function(a,c){function d(){this.constructor=a}d.prototype=c.prototype;a.prototype=new d})(a,Error);return{XA:a,parse:function(b){function c(a,b){switch(a){case "++":return++b;case "--":return--b;case "+":return+b;case "-":return-b;case "~":return~b;case "!":return!b}}function d(a){if(Xa!==a){Xa>a&&(Xa=0,ia={bh:1,lf:1,Eh:!1});var c=ia,d,e;for(d=Xa;d<a;d++)e=
b.charAt(d),"\n"===e?(c.Eh||c.bh++,c.lf=1,c.Eh=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(c.bh++,c.lf=1,c.Eh=!0):(c.lf++,c.Eh=!1);Xa=a}return ia}function e(a){A<Ga||(A>Ga&&(Ga=A,sa=[]),sa.push(a))}function l(){var a,c,d;a=A;c=C();c!==v?(c=g(),c!==v?(d=C(),d!==v?(U++,10===b.charCodeAt(A)?(d=mb,A++):(d=v,0===U&&e(Qb)),d===v&&(b.substr(A,2)===$a?(d=$a,A+=2):(d=v,0===U&&e(nb)),d===v&&(13===b.charCodeAt(A)?(d=gb,A++):(d=v,0===U&&e(wb)))),U--,d===v&&0===U&&e(vb),d===v&&(d=ma),d!==v?a=c:(A=a,a=J)):(A=a,a=
J)):(A=a,a=J)):(A=a,a=J);return a}function g(){var a,c,d,f,g,h,k,l;a=A;c=p();if(c!==v){d=[];f=A;g=C();g!==v?(44===b.charCodeAt(A)?(h=ja,A++):(h=v,0===U&&e(la)),h!==v?(k=C(),k!==v?(l=p(),l!==v?f=g=[g,h,k,l]:(A=f,f=J)):(A=f,f=J)):(A=f,f=J)):(A=f,f=J);for(;f!==v;)d.push(f),f=A,g=C(),g!==v?(44===b.charCodeAt(A)?(h=ja,A++):(h=v,0===U&&e(la)),h!==v?(k=C(),k!==v?(l=p(),l!==v?f=g=[g,h,k,l]:(A=f,f=J)):(A=f,f=J)):(A=f,f=J)):(A=f,f=J);d!==v?a=c=0==d.length?c:d[d.length-1]:(A=a,a=J)}else A=a,a=J;return a}function p(){var a,
c,d,f;a=A;c=n();c!==v?(d=C(),d!==v?(63===b.charCodeAt(A)?(d=da,A++):(d=v,0===U&&e(G)),d!==v?(d=C(),d!==v?(d=g(),d!==v?(f=C(),f!==v?(58===b.charCodeAt(A)?(f=aa,A++):(f=v,0===U&&e(fa)),f!==v?(f=C(),f!==v?(f=g(),f!==v?a=c?d:f:(A=a,a=J)):(A=a,a=J)):(A=a,a=J)):(A=a,a=J)):(A=a,a=J)):(A=a,a=J)):(A=a,a=J)):(A=a,a=J)):(A=a,a=J);a===v&&(a=n());return a}function n(){var a,b,c,d,e,f,g,h;a=A;b=k();if(b!==v){c=[];d=A;e=C();e!==v?(f=F(),f!==v?(g=C(),g!==v?(h=k(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=
J)):(A=d,d=J);for(;d!==v;)c.push(d),d=A,e=C(),e!==v?(f=F(),f!==v?(g=C(),g!==v?(h=k(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);if(c!==v)for(a=b,b=0;b<c.length;b++)a=a||c[b][3];else A=a,a=J}else A=a,a=J;return a}function k(){var a,b,c,d,e,f,g,k;a=A;b=h();if(b!==v){c=[];d=A;e=C();e!==v?(f=m(),f!==v?(g=C(),g!==v?(k=h(),k!==v?d=e=[e,f,g,k]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);for(;d!==v;)c.push(d),d=A,e=C(),e!==v?(f=m(),f!==v?(g=C(),g!==v?(k=h(),k!==v?d=e=[e,f,g,k]:(A=d,d=J)):
(A=d,d=J)):(A=d,d=J)):(A=d,d=J);if(c!==v)for(a=b,b=0;b<c.length;b++)a=a&&c[b][3];else A=a,a=J}else A=a,a=J;return a}function h(){var a,b,c,d,e,g,h,k;a=A;b=f();if(b!==v){c=[];d=A;e=C();e!==v?(g=T(),g!==v?(h=C(),h!==v?(k=f(),k!==v?d=e=[e,g,h,k]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);for(;d!==v;)c.push(d),d=A,e=C(),e!==v?(g=T(),g!==v?(h=C(),h!==v?(k=f(),k!==v?d=e=[e,g,h,k]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);if(c!==v)for(a=b,b=0;b<c.length;b++)a|=c[b][3];else A=a,a=J}else A=a,a=J;return a}
function f(){var a,b,c,d,e,f,g,h;a=A;b=t();if(b!==v){c=[];d=A;e=C();e!==v?(f=O(),f!==v?(g=C(),g!==v?(h=t(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);for(;d!==v;)c.push(d),d=A,e=C(),e!==v?(f=O(),f!==v?(g=C(),g!==v?(h=t(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);if(c!==v)for(a=b,b=0;b<c.length;b++)a^=c[b][3];else A=a,a=J}else A=a,a=J;return a}function t(){var a,b,c,d,e,f,g,h;a=A;b=u();if(b!==v){c=[];d=A;e=C();e!==v?(f=P(),f!==v?(g=C(),g!==v?(h=u(),h!==v?d=
e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);for(;d!==v;)c.push(d),d=A,e=C(),e!==v?(f=P(),f!==v?(g=C(),g!==v?(h=u(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);if(c!==v)for(a=b,b=0;b<c.length;b++)a&=c[b][3];else A=a,a=J}else A=a,a=J;return a}function u(){var a,b,c,d,e,f,g,h;a=A;b=w();if(b!==v){c=[];d=A;e=C();e!==v?(f=S(),f!==v?(g=C(),g!==v?(h=w(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);for(;d!==v;)c.push(d),d=A,e=C(),e!==v?(f=S(),f!==v?(g=C(),g!==
v?(h=w(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);if(c!==v)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "==":a=a==c[b][3];break;case "!=":a=a!=c[b][3]}else A=a,a=J}else A=a,a=J;return a}function w(){var a,b,c,d,e,f,g,h;a=A;b=s();if(b!==v){c=[];d=A;e=C();e!==v?(f=K(),f!==v?(g=C(),g!==v?(h=s(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);for(;d!==v;)c.push(d),d=A,e=C(),e!==v?(f=K(),f!==v?(g=C(),g!==v?(h=s(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=
J)):(A=d,d=J);if(c!==v)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<=":a=a<=c[b][3];break;case ">=":a=a>=c[b][3];break;case "<":a=a<c[b][3];break;case ">":a=a>c[b][3]}else A=a,a=J}else A=a,a=J;return a}function s(){var a,b,c,d,e,f,g,h;a=A;b=B();if(b!==v){c=[];d=A;e=C();e!==v?(f=H(),f!==v?(g=C(),g!==v?(h=B(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);for(;d!==v;)c.push(d),d=A,e=C(),e!==v?(f=H(),f!==v?(g=C(),g!==v?(h=B(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):
(A=d,d=J);if(c!==v)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "<<":a<<=c[b][3];break;case ">>":a>>=c[b][3]}else A=a,a=J}else A=a,a=J;return a}function B(){var a,b,c,d,e,f,g,h;a=A;b=q();if(b!==v){c=[];d=A;e=C();e!==v?(f=Q(),f!==v?(g=C(),g!==v?(h=q(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);for(;d!==v;)c.push(d),d=A,e=C(),e!==v?(f=Q(),f!==v?(g=C(),g!==v?(h=q(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);if(c!==v)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "+":a+=
c[b][3];break;case "-":a-=c[b][3]}else A=a,a=J}else A=a,a=J;return a}function q(){var a,b,c,d,e,f,g,h;a=A;b=y();if(b!==v){c=[];d=A;e=C();e!==v?(f=I(),f!==v?(g=C(),g!==v?(h=y(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);for(;d!==v;)c.push(d),d=A,e=C(),e!==v?(f=I(),f!==v?(g=C(),g!==v?(h=y(),h!==v?d=e=[e,f,g,h]:(A=d,d=J)):(A=d,d=J)):(A=d,d=J)):(A=d,d=J);if(c!==v)for(a=b,b=0;b<c.length;b++)switch(c[b][1]){case "*":a*=c[b][3];break;case "/":a=Math.floor(a/c[b][3]);break;case "%":a%=
c[b][3]}else A=a,a=J}else A=a,a=J;return a}function y(){var a,d,f;a=A;b.substr(A,7)===oa?(d=oa,A+=7):(d=v,0===U&&e(ba));d!==v?(f=C(),f!==v?(f=z(),f!==v?a=f:(A=a,a=J)):(A=a,a=J)):(A=a,a=J);if(a===v){a=A;d=D();if(d!==v)if(f=C(),f!==v)if(b.substr(A,2)===tc?(f=tc,A+=2):(f=v,0===U&&e(ac)),f===v&&(b.substr(A,2)===Qa?(f=Qa,A+=2):(f=v,0===U&&e(lb))),f!==v){a:{a=d;switch(f){case "++":d=++a;break a;case "--":d=--a;break a}d=void 0}a=d}else A=a,a=J;else A=a,a=J;else A=a,a=J;a===v&&(a=D());a===v&&(a=A,b.substr(A,
2)===tc?(d=tc,A+=2):(d=v,0===U&&e(ac)),d===v&&(b.substr(A,2)===Qa?(d=Qa,A+=2):(d=v,0===U&&e(lb)),d===v&&(43===b.charCodeAt(A)?(d=Fc,A++):(d=v,0===U&&e(sb)),d===v&&(45===b.charCodeAt(A)?(d=Cb,A++):(d=v,0===U&&e(ua)),d===v&&(126===b.charCodeAt(A)?(d=uc,A++):(d=v,0===U&&e(Lb)),d===v&&(33===b.charCodeAt(A)?(d=Ya,A++):(d=v,0===U&&e(vc))))))),d!==v?(f=C(),f!==v?(f=y(),f!==v?a=d=c(d,f):(A=a,a=J)):(A=a,a=J)):(A=a,a=J))}return a}function D(){var a,c,d;U++;var f;a=A;48===b.charCodeAt(A)?(c=ab,A++):(c=v,0===
U&&e(Ua));if(c!==v)if(sc.test(b.charAt(A))?(c=b.charAt(A),A++):(c=v,0===U&&e(Sc)),c!==v){c=A;d=[];f=M();if(f!==v)for(;f!==v;)d.push(f),f=M();else d=J;d!==v&&(d=b.substring(c,A));c=d;c!==v?a=c=parseInt("0x"+c):(A=a,a=J)}else A=a,a=J;else A=a,a=J;if(a===v){a=A;48===b.charCodeAt(A)?(c=ab,A++):(c=v,0===U&&e(Ua));if(c===v)if(c=A,Kb.test(b.charAt(A))?(d=b.charAt(A),A++):(d=v,0===U&&e(Ub)),d!==v){var h;f=[];h=E();if(h!==v)for(;h!==v;)f.push(h),h=E();else f=J;f===v&&(f=ma);f!==v?c=d=[d,f]:(A=c,c=J)}else A=
c,c=J;c!==v&&(c=b.substring(a,A));a=c;a!==v&&(a=parseInt(a))}U--;a===v&&0===U&&e(W);a===v&&(c=x(),c!==v&&(c=0),a=c,a===v&&(a=A,40===b.charCodeAt(A)?(c=ga,A++):(c=v,0===U&&e(ha)),c!==v?(c=C(),c!==v?(c=g(),c!==v?(d=C(),d!==v?(41===b.charCodeAt(A)?(d=Fa,A++):(d=v,0===U&&e(N)),d!==v?a=c:(A=a,a=J)):(A=a,a=J)):(A=a,a=J)):(A=a,a=J)):(A=a,a=J)));return a}function z(){var a,c,d,f,g;c=x();c!==v&&(c=0);a=c;if(a===v){c=[];f=d=A;U++;40===b.charCodeAt(A)?(g=ga,A++):(g=v,0===U&&e(ha));g===v&&(41===b.charCodeAt(A)?
(g=Fa,A++):(g=v,0===U&&e(N)));U--;g===v?f=ya:(A=f,f=J);f!==v?(g=Z(),g!==v?d=f=[f,g]:(A=d,d=J)):(A=d,d=J);if(d!==v)for(;d!==v;)c.push(d),f=d=A,U++,40===b.charCodeAt(A)?(g=ga,A++):(g=v,0===U&&e(ha)),g===v&&(41===b.charCodeAt(A)?(g=Fa,A++):(g=v,0===U&&e(N))),U--,g===v?f=ya:(A=f,f=J),f!==v?(g=Z(),g!==v?d=f=[f,g]:(A=d,d=J)):(A=d,d=J);else c=J;c!==v&&(c=1);a=c;a===v&&(a=A,40===b.charCodeAt(A)?(c=ga,A++):(c=v,0===U&&e(ha)),c!==v?(d=C(),d!==v?(f=z(),f!==v?(g=C(),g!==v?(41===b.charCodeAt(A)?(c=Fa,A++):(c=
v,0===U&&e(N)),c!==v?a=f:(A=a,a=J)):(A=a,a=J)):(A=a,a=J)):(A=a,a=J)):(A=a,a=J))}return a}function E(){var a;ta.test(b.charAt(A))?(a=b.charAt(A),A++):(a=v,0===U&&e(Va));return a}function M(){var a;Aa.test(b.charAt(A))?(a=b.charAt(A),A++):(a=v,0===U&&e(Ea));return a}function x(){var a,c;U++;c=a=A;U++;var d,f,g,h;d=A;b.substr(A,7)===oa?(f=oa,A+=7):(f=v,0===U&&e(ba));f!==v?(g=A,U++,h=R(),U--,h===v?g=ya:(A=g,g=J),g!==v?d=f=[f,g]:(A=d,d=J)):(A=d,d=J);U--;d===v?c=ya:(A=c,c=J);if(c!==v){U++;c=A;d=L();if(d!==
v){f=[];for(g=R();g!==v;)f.push(g),g=R();f!==v?c=d+=f.join(""):(A=c,c=J)}else A=c,c=J;U--;c===v&&0===U&&e(Oa);c!==v?a=c:(A=a,a=J)}else A=a,a=J;U--;a===v&&0===U&&e(Oa);return a}function L(){var a;Da.test(b.charAt(A))?(a=b.charAt(A),A++):(a=v,0===U&&e(rb));a===v&&(36===b.charCodeAt(A)?(a=Pa,A++):(a=v,0===U&&e(kb)),a===v&&(95===b.charCodeAt(A)?(a=Ja,A++):(a=v,0===U&&e(Jb))));return a}function R(){var a;a=L();a===v&&(a=E());return a}function I(){var a,c,d,f;a=A;42===b.charCodeAt(A)?(c=Mb,A++):(c=v,0===
U&&e(Kc));c===v&&(47===b.charCodeAt(A)?(c=Gc,A++):(c=v,0===U&&e(Vc)),c===v&&(37===b.charCodeAt(A)?(c=Vb,A++):(c=v,0===U&&e(Db))));c!==v?(d=A,U++,61===b.charCodeAt(A)?(f=tb,A++):(f=v,0===U&&e(bc)),U--,f===v?d=ya:(A=d,d=J),d!==v?a=c:(A=a,a=J)):(A=a,a=J);return a}function Q(){var a,c,d;a=A;43===b.charCodeAt(A)?(c=Fc,A++):(c=v,0===U&&e(sb));c!==v?(c=A,U++,43===b.charCodeAt(A)?(d=Fc,A++):(d=v,0===U&&e(sb)),d===v&&(61===b.charCodeAt(A)?(d=tb,A++):(d=v,0===U&&e(bc))),U--,d===v?c=ya:(A=c,c=J),c!==v?a="+":
(A=a,a=J)):(A=a,a=J);a===v&&(a=A,45===b.charCodeAt(A)?(c=Cb,A++):(c=v,0===U&&e(ua)),c!==v?(c=A,U++,45===b.charCodeAt(A)?(d=Cb,A++):(d=v,0===U&&e(ua)),d===v&&(61===b.charCodeAt(A)?(d=tb,A++):(d=v,0===U&&e(bc))),U--,d===v?c=ya:(A=c,c=J),c!==v?a="-":(A=a,a=J)):(A=a,a=J));return a}function H(){var a;b.substr(A,2)===Za?(a=Za,A+=2):(a=v,0===U&&e(cc));a===v&&(b.substr(A,2)===mc?(a=mc,A+=2):(a=v,0===U&&e(wc)));return a}function K(){var a;b.substr(A,2)===Y?(a=Y,A+=2):(a=v,0===U&&e(bb));a===v&&(b.substr(A,
2)===Ra?(a=Ra,A+=2):(a=v,0===U&&e(qa)),a===v&&(60===b.charCodeAt(A)?(a=Nb,A++):(a=v,0===U&&e(va)),a===v&&(62===b.charCodeAt(A)?(a=Eb,A++):(a=v,0===U&&e(dc)))));return a}function S(){var a;b.substr(A,2)===pa?(a=pa,A+=2):(a=v,0===U&&e(Ka));a===v&&(b.substr(A,2)===fb?(a=fb,A+=2):(a=v,0===U&&e(na)));return a}function P(){var a,c,d;a=A;38===b.charCodeAt(A)?(c=La,A++):(c=v,0===U&&e(Fb));c!==v?(c=A,U++,38===b.charCodeAt(A)?(d=La,A++):(d=v,0===U&&e(Fb)),U--,d===v?c=ya:(A=c,c=J),c!==v?a="&":(A=a,a=J)):(A=
a,a=J);return a}function O(){var a,c,d;a=A;94===b.charCodeAt(A)?(c=wa,A++):(c=v,0===U&&e(Sa));c!==v?(c=A,U++,94===b.charCodeAt(A)?(d=wa,A++):(d=v,0===U&&e(Sa)),U--,d===v?c=ya:(A=c,c=J),c!==v?a="^":(A=a,a=J)):(A=a,a=J);return a}function T(){var a,c,d;a=A;124===b.charCodeAt(A)?(c=Ob,A++):(c=v,0===U&&e(ec));c!==v?(c=A,U++,124===b.charCodeAt(A)?(d=Ob,A++):(d=v,0===U&&e(ec)),U--,d===v?c=ya:(A=c,c=J),c!==v?a="|":(A=a,a=J)):(A=a,a=J);return a}function m(){var a;b.substr(A,2)===Wb?(a=Wb,A+=2):(a=v,0===U&&
e(ub));a!==v&&(a="&&");return a}function F(){var a;b.substr(A,2)===Xb?(a=Xb,A+=2):(a=v,0===U&&e(Yb));a!==v&&(a="||");return a}function C(){var a,b;a=[];for(b=X();b!==v;)a.push(b),b=X();return a}function X(){var a;U++;nc.test(b.charAt(A))?(a=b.charAt(A),A++):(a=v,0===U&&e(oc));U--;a===v&&0===U&&e(Pb);return a}function Z(){var a;b.length>A?(a=b.charAt(A),A++):(a=v,0===U&&e(Ia));return a}var V=1<arguments.length?arguments[1]:{},v={},ka={start:l},ea=l,J=v,ma=null,ja=",",la={type:"literal",value:",",description:'","'},
da="?",G={type:"literal",value:"?",description:'"?"'},aa=":",fa={type:"literal",value:":",description:'":"'},oa="defined",ba={type:"literal",value:"defined",description:'"defined"'},ga="(",ha={type:"literal",value:"(",description:'"("'},Fa=")",N={type:"literal",value:")",description:'")"'},ya=void 0,W={type:"other",description:"number"},ab="0",Ua={type:"literal",value:"0",description:'"0"'},ta=/^[0-9]/,Va={type:"class",value:"[0-9]",description:"[0-9]"},Kb=/^[1-9]/,Ub={type:"class",value:"[1-9]",
description:"[1-9]"},sc=/^[xX]/,Sc={type:"class",value:"[xX]",description:"[xX]"},Aa=/^[0-9a-fA-F]/,Ea={type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},Oa={type:"other",description:"identifier"},Pa="$",kb={type:"literal",value:"$",description:'"$"'},Ja="_",Jb={type:"literal",value:"_",description:'"_"'},Da=/^[a-zA-Z]/,rb={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},tc="++",ac={type:"literal",value:"++",description:'"++"'},Qa="--",lb={type:"literal",value:"--",description:'"--"'},
Fc="+",sb={type:"literal",value:"+",description:'"+"'},Cb="-",ua={type:"literal",value:"-",description:'"-"'},uc="~",Lb={type:"literal",value:"~",description:'"~"'},Ya="!",vc={type:"literal",value:"!",description:'"!"'},Mb="*",Kc={type:"literal",value:"*",description:'"*"'},Gc="/",Vc={type:"literal",value:"/",description:'"/"'},Vb="%",Db={type:"literal",value:"%",description:'"%"'},tb="=",bc={type:"literal",value:"=",description:'"="'},Za="<<",cc={type:"literal",value:"<<",description:'"<<"'},mc=
">>",wc={type:"literal",value:">>",description:'">>"'},Y="<=",bb={type:"literal",value:"<=",description:'"<="'},Ra=">=",qa={type:"literal",value:">=",description:'">="'},Nb="<",va={type:"literal",value:"<",description:'"<"'},Eb=">",dc={type:"literal",value:">",description:'">"'},pa="==",Ka={type:"literal",value:"==",description:'"=="'},fb="!=",na={type:"literal",value:"!=",description:'"!="'},La="&",Fb={type:"literal",value:"&",description:'"&"'},wa="^",Sa={type:"literal",value:"^",description:'"^"'},
Ob="|",ec={type:"literal",value:"|",description:'"|"'},Wb="&&",ub={type:"literal",value:"&&",description:'"&&"'},Xb="||",Yb={type:"literal",value:"||",description:'"||"'},Pb={type:"other",description:"whitespace"},nc=/^[\t\x0B\f ]/,oc={type:"class",value:"[\\t\\x0B\\f ]",description:"[\\t\\x0B\\f ]"},vb={type:"other",description:"end of line"},mb="\n",Qb={type:"literal",value:"\n",description:'"\\n"'},$a="\r\n",nb={type:"literal",value:"\r\n",description:'"\\r\\n"'},gb="\r",wb={type:"literal",value:"\r",
description:'"\\r"'},Ia={type:"any",description:"any character"},A=0,Xa=0,ia={bh:1,lf:1,Eh:!1},Ga=0,sa=[],U=0,ra;if("startRule"in V){if(!(V.nq in ka))throw Error("Can't start parsing from rule \""+V.nq+'".');ea=ka[V.nq]}ra=ea();if(ra!==v&&A===b.length)return ra;ra!==v&&A<b.length&&e({type:"end",description:"end of input"});throw function(c,e,f){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,
1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}
var d=Array(a.length),e;for(e=0;e<a.length;e++)d[e]=a[e].description;d=1<a.length?d.slice(0,-1).join(", ")+" or "+d[a.length-1]:d[0];e=b?'"'+c(b)+'"':"end of input";return"Expected "+d+" but "+e+" found."}var k=d(f),l=f<b.length?b.charAt(f):null;null!==e&&g(e);return new a(null!==c?c:h(e,l),0,0,f,k.bh,k.lf)}(null,sa,Ga);}}}()};b4w.module.__md5=function(a){function r(a,l){var n=a[0],k=a[1],h=a[2],f=a[3],n=c(n,k,h,f,l[0],7,-680876936),f=c(f,n,k,h,l[1],12,-389564586),h=c(h,f,n,k,l[2],17,606105819),k=c(k,h,f,n,l[3],22,-1044525330),n=c(n,k,h,f,l[4],7,-176418897),f=c(f,n,k,h,l[5],12,1200080426),h=c(h,f,n,k,l[6],17,-1473231341),k=c(k,h,f,n,l[7],22,-45705983),n=c(n,k,h,f,l[8],7,1770035416),f=c(f,n,k,h,l[9],12,-1958414417),h=c(h,f,n,k,l[10],17,-42063),k=c(k,h,f,n,l[11],22,-1990404162),n=c(n,k,h,f,l[12],7,1804603682),f=c(f,n,k,h,
l[13],12,-40341101),h=c(h,f,n,k,l[14],17,-1502002290),k=c(k,h,f,n,l[15],22,1236535329),n=d(n,k,h,f,l[1],5,-165796510),f=d(f,n,k,h,l[6],9,-1069501632),h=d(h,f,n,k,l[11],14,643717713),k=d(k,h,f,n,l[0],20,-373897302),n=d(n,k,h,f,l[5],5,-701558691),f=d(f,n,k,h,l[10],9,38016083),h=d(h,f,n,k,l[15],14,-660478335),k=d(k,h,f,n,l[4],20,-405537848),n=d(n,k,h,f,l[9],5,568446438),f=d(f,n,k,h,l[14],9,-1019803690),h=d(h,f,n,k,l[3],14,-187363961),k=d(k,h,f,n,l[8],20,1163531501),n=d(n,k,h,f,l[13],5,-1444681467),f=
d(f,n,k,h,l[2],9,-51403784),h=d(h,f,n,k,l[7],14,1735328473),k=d(k,h,f,n,l[12],20,-1926607734),n=b(k^h^f,n,k,l[5],4,-378558),f=b(n^k^h,f,n,l[8],11,-2022574463),h=b(f^n^k,h,f,l[11],16,1839030562),k=b(h^f^n,k,h,l[14],23,-35309556),n=b(k^h^f,n,k,l[1],4,-1530992060),f=b(n^k^h,f,n,l[4],11,1272893353),h=b(f^n^k,h,f,l[7],16,-155497632),k=b(h^f^n,k,h,l[10],23,-1094730640),n=b(k^h^f,n,k,l[13],4,681279174),f=b(n^k^h,f,n,l[0],11,-358537222),h=b(f^n^k,h,f,l[3],16,-722521979),k=b(h^f^n,k,h,l[6],23,76029189),n=
b(k^h^f,n,k,l[9],4,-640364487),f=b(n^k^h,f,n,l[12],11,-421815835),h=b(f^n^k,h,f,l[15],16,530742520),k=b(h^f^n,k,h,l[2],23,-995338651),n=e(n,k,h,f,l[0],6,-198630844),f=e(f,n,k,h,l[7],10,1126891415),h=e(h,f,n,k,l[14],15,-1416354905),k=e(k,h,f,n,l[5],21,-57434055),n=e(n,k,h,f,l[12],6,1700485571),f=e(f,n,k,h,l[3],10,-1894986606),h=e(h,f,n,k,l[10],15,-1051523),k=e(k,h,f,n,l[1],21,-2054922799),n=e(n,k,h,f,l[8],6,1873313359),f=e(f,n,k,h,l[15],10,-30611744),h=e(h,f,n,k,l[6],15,-1560198380),k=e(k,h,f,n,l[13],
21,1309151649),n=e(n,k,h,f,l[4],6,-145523070),f=e(f,n,k,h,l[11],10,-1120210379),h=e(h,f,n,k,l[2],15,718787259),k=e(k,h,f,n,l[9],21,-343485551);a[0]=n+a[0]&4294967295;a[1]=k+a[1]&4294967295;a[2]=h+a[2]&4294967295;a[3]=f+a[3]&4294967295}function b(a,b,c,d,e,f){b=(b+a&4294967295)+(d+f&4294967295)&4294967295;return(b<<e|b>>>32-e)+c&4294967295}function c(a,c,d,e,h,f,l){return b(c&d|~c&e,a,c,h,f,l)}function d(a,c,d,e,h,f,l){return b(c&e|d&~e,a,c,h,f,l)}function e(a,c,d,e,h,f,l){return b(d^(c|~e),a,c,h,
f,l)}var l="0123456789abcdef".split("");a.Lo=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var d;for(d=64;d<=b.length;d+=64){for(var e=b.substring(d-64,d),f=[],t=void 0,t=0;64>t;t+=4)f[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);r(a,f)}b=b.substring(d-64);e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<b.length;d++)e[d>>2]|=b.charCodeAt(d)<<(d%4<<3);e[d>>2]|=128<<(d%4<<3);if(55<d)for(r(a,e),d=0;16>d;d++)e[d]=0;e[14]=8*
c;r(a,e);for(b=0;b<a.length;b++){c=a[b];d="";for(e=0;4>e;e++)d+=l[c>>8*e+4&15]+l[c>>8*e&15];a[b]=d}return a.join("")}};b4w.module.animation=function(a,r){var b=r("__animation"),c=r("__constraints"),d=r("__physics"),e=r("__util");a.AB_CYCLIC=b.Lq;a.AB_FINISH_RESET=b.Mq;a.AB_FINISH_STOP=b.Nq;var l=new Float32Array(4);a.is_animated=function(a){return b.Vw(a)};a.get_actions=function(){for(var a=[],c=b.Lv(),d=0;d<c.length;d++)a.push(c[d].name);return a};a.get_current_action=function(a){return b.Xv(a)};a.apply=function(a,c){b.apply(a,c)};a.remove=function(a){b.remove(a)};a.apply_def=function(a){b.en(a)};a.play=function(a,
c,d){b.play(a,c,d);b.gm(a)};a.stop=function(a){b.stop(a)};a.is_play=function(a){return b.al(a)};a.set_current_frame_float=function(a,c){b.Rp(a,c)};a.get_current_frame_float=function(a){return b.lo(a)};a.set_frame=function(a,c){b.Rp(a,c);b.gm(a,0)};a.get_frame=function(a){return b.lo(a)};a.get_frame_range=function(a){return a.f?a.f.Zj:null};a.get_anim_length=function(a){return a.f?a.f.length:-1};a.cyclic=function(a,c){b.yc(a,c)};a.is_cyclic=function(a){return b.Ti(a)};a.set_behavior=function(a,c){b.Iy(a,
c)};a.get_behavior=function(a){return b.Qv(a)};a.apply_smoothing=function(a,c,d){b.ws(a,c,d)};a.update_object_animation=function(a,c){b.gm(a,c)};a.frame_to_sec=function(a){return b.rv(a)};a.detect_collisions=function(a,b){b?d.Wn(a):d.Un(a)};a.is_detect_collisions_used=function(a){return d.Jo(a)};a.get_bone_translation=function(a,b,d){if(!e.So(a))return null;d||(d=new Float32Array(3));c.Sv(a,b,!1,l,null);d[0]=l[0];d[1]=l[1];d[2]=l[2];return d};a.update_object_transform=function(){throw"Deprecated method execution";
};a.set_translation=function(){throw"Deprecated method execution";};a.set_translation_v=function(){throw"Deprecated method execution";};a.set_translation_rel=function(){throw"Deprecated method execution";};a.get_translation=function(){throw"Deprecated method execution";};a.set_rotation_quat=function(){throw"Deprecated method execution";};a.set_rotation_quat_v=function(){throw"Deprecated method execution";};a.get_rotation_quat=function(){throw"Deprecated method execution";};a.set_rotation_euler=function(){throw"Deprecated method execution";
};a.set_rotation_euler_v=function(){throw"Deprecated method execution";};a.set_scale=function(){throw"Deprecated method execution";};a.empty_reset_transform=function(){throw"Deprecated method execution";}};b4w.module.assets=function(a,r){var b=r("__assets");a.AT_ARRAYBUFFER=b.dg;a.AT_JSON=b.Qj;a.AT_TEXT=b.xm;a.AT_AUDIOBUFFER=b.Oj;a.AT_IMAGE_ELEMENT=b.eg;a.AT_AUDIO_ELEMENT=b.Pj;a.enqueue=function(a,d,e){b.H(a,d,e)}};b4w.module.camera=function(a,r){function b(a,b){c.Wi(a)?c.Vp(a,b):e.error("set_pivot(): Wrong object or camera move style")}var c=r("__camera"),d=r("__config"),e=r("__print"),l=r("__constraints"),g=r("__scenes"),p=r("__transform"),n=r("__util"),k=r("vec3"),h=r("vec4"),f=r("quat"),t=r("mat4"),u=d.controls,w=new Float32Array(3);new Float32Array(3);var s=new Float32Array(4),B=new Float32Array(4);a.MS_STATIC=c.Hm;a.MS_ANIMATION=c.cr;a.MS_CONTROLS=c.ke;a.MS_TARGET_CONTROLS=c.ke;a.MS_EYE_CONTROLS=c.Sj;
a.is_camera=function(a){return c.$k(a)};a.set_move_style=jb();a.get_move_style=function(a){return c.$k(a)?c.gw(a):(e.error("Wrong object"),null)};a.change_eye_target_dist=function(){e.error("change_eye_target_dist() deprecated")};a.change_trans_speed=function(a,b){var c=a.d,d=c.bm[0],d=d*(1+b*u.Ys);c.bm=[d,d,d]};a.get_trans_speed=function(a){return c.$k(a)?a.d.bm[0]:(e.error("Wrong object"),0)};a.set_look_at=function(a,b,d,e){var f=a.d;g.n();c.iv(b,d,e,f.e,f.i);p.Y(a)};a.get_eye=function(a){return a.d.e};
a.set_pivot=b;a.get_pivot=function(a,b){if(c.Wi(a))return b||(b=new Float32Array(3)),k.copy(a.d.Le,b),b;e.error("set_pivot(): Wrong object or camera move style")};a.rotate_pivot=function(a,b,d){if(c.Wi(a)){var h=a.d;g.n();w[0]=0;w[1]=1;w[2]=0;f.setAxisAngle(w,b,s);n.Mp(h.e,h.Le,s,h.e);w[0]=1;w[1]=0;w[2]=0;k.transformQuat(w,h.i,w);f.setAxisAngle(w,d,s);n.Mp(h.e,h.Le,s,h.e);p.Y(a)}else e.error("rotate_pivot(): wrong object")};a.apply_vertical_limits=function(a,b,c){a.d.bc={Kg:b,Th:c}};a.clear_vertical_limits=
function(a){a.d.bc=null};a.set_eye_params=function(a,b,d){var e=a.d;g.n();f.identity(e.i);c.Dl(a,Math.PI/2);c.Lp(a,b);c.Dl(a,-d);p.Y(a)};a.is_look_up=function(a){n.Mb(a.d.i,n.sd,w);return 0<=w[1]?!0:!1};a.rotate=function(a,b,d){g.n();c.Lp(a,b);c.Dl(a,-d);p.Y(a)};a.get_angles=function(a,b){b||(b=new Float32Array(2));c.Mv(a,b);return b};a.set_stereo_distance=function(a,b){for(var d=a.d.ea,e=0;e<d.length;e++){var f=d[e];f.type!=c.pb&&f.type!=c.zb||c.hz(f,b,f.pd)}};a.get_stereo_distance=function(a){a=
a.d.ea;for(var b=0;b<a.length;b++){var d=a[b];if(d.type==c.pb||d.type==c.zb)return d.zj}return 0};a.is_underwater=function(a){return a.d.$z};a.translate_view=function(a,b,d,e){a=a.d.ea;for(var f=0;f<a.length;f++){var g=a[f];g.vb||c.Kf(g,g.ib);var h=w;h[0]=-b;h[1]=-d;h[2]=0;t.translate(g.ua,h,g.ua);t.rotateZ(g.ua,e,g.ua);t.multiply(g.ua,g.Da,g.Zf);c.Ts(g)}};a.correct_up=function(a,b){b||(b=n.hb);l.Ft(a,b)};a.zoom_object=function(a,d){if(c.Wi(a)){g.n();p.uo(d,!1,w);b(a,w);p.Y(a);var f=p.vo(d),h=c.Nv(a)/
2,f=f/Math.sin(h),h=p.Jx(a,w);p.kp(a,0,f-h,0);p.Y(a)}else e.error("zoom_object(): wrong object")};a.calc_ray=function(a,b,d,f){f||(f=new Float32Array(3));var g=a.d.ea[0];switch(g.type){case c.Oc:case c.hf:case c.pb:case c.zb:var l=Math.tan(g.Zc*Math.PI/360);B[0]=(2*b/g.width-1)*l*g.ib;B[1]=-1;B[2]=(2*d/g.height-1)*l;B[3]=0;h.transformMat4(B,a.d.G,B);f[0]=B[0];f[1]=B[1];f[2]=B[2];k.normalize(f,f);return f;default:return e.error("Non-compatible camera"),f}}};b4w.module.config=function(a,r){var b=r("__config");a.P_ULTRA=b.Nm;a.P_HIGH=b.Tj;a.P_LOW=b.Mm;a.set=b.set;a.get=b.get;a.reset=b.reset};b4w.module.controls=function(a,r){var b=r("__print"),c=r("__controls");a.CT_CONTINUOUS=c.Am;a.CT_TRIGGER=c.Dm;a.CT_SHOT=c.Cm;a.CT_LEVEL=c.Bm;a.KEY_SHIFT=16;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_A=65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=
76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=
222;a.H_ROT=0;a.V_ROT=0;a.H_TRA=0;a.V_TRA=0;a.F_TRA=0;a.JUMP=0;a.X_TRA=0;a.Y_TRA=0;a.Z_TRA=0;a.set=function(){b.error("set() deprecated, use new sensor-based API")};a.get=function(){b.error("get() deprecated, use new sensor-based API");return null};a.get_type=function(){b.error("get_type() deprecated, use new sensor-based API");return null};a.release=function(){b.error("release() deprecated, use new sensor-based API")};a.create_custom_sensor=c.Tt;a.create_keyboard_sensor=c.Kn;a.create_collision_sensor=
c.Qt;a.create_collision_impulse_sensor=c.Pt;a.create_ray_sensor=c.iu;a.create_mouse_click_sensor=c.fu;a.create_mouse_wheel_sensor=c.hu;a.create_mouse_move_sensor=c.gu;a.create_touch_move_sensor=c.wu;a.create_touch_zoom_sensor=c.xu;a.create_motion_sensor=c.eu;a.create_vertical_velocity_sensor=c.yu;a.create_timer_sensor=c.vu;a.reset_timer_sensor=c.yy;a.create_elapsed_sensor=c.Wt;a.create_timeline_sensor=c.uu;a.set_custom_sensor=function(a,b){c.Ey(a,b)};a.get_custom_sensor=function(a){return a.value};
a.get_sensor_value=function(a,c,l){a=a.qb;if(!a||!a[c])return b.error("get_sensor_value(): wrong object"),null;c=a[c].kc[l];return c?c.value:(b.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=function(a,c,l){a=a.qb;if(!a||!a[c])return b.error("get_sensor_payload(): wrong object"),null;c=a[c].kc[l];return c?c.Xb:(b.error("get_sensor_payload(): sensor not found"),null)};a.sensor_make_positive=function(){throw"Deprecated method execution";};a.sensor_make_negative=function(){throw"Deprecated method execution";
};a.create_sensor_lock=function(a,b,l){a.il=b.slice(0);a.hl=Array(b.length);a.Yi=l||c.Gu};a.remove_sensor_lock=function(a){a.il=null;a.hl=null;a.Yi=null};a.create_sensor_manifold=c.Nn;a.create_kb_sensor_manifold=function(a,b,l,g,p,n){g=c.Kn(g);c.Nn(a,b,l,[g],null,p,n)};a.check_sensor_manifolds=function(a){return c.xn(a,null)};a.check_sensor_manifold=c.xn;a.remove_sensor_manifolds=function(a){c.Ip(a,null)};a.remove_sensor_manifold=c.Ip;a.reset=c.reset;a.keydown_cb=c.gx;a.keyup_cb=c.hx;a.mouse_down_cb=
c.Bx;a.mouse_up_cb=c.Dx;a.mouse_wheel_cb=c.Ex;a.mouse_move_cb=c.Cx;a.touch_start_cb=c.Uz;a.touch_move_cb=c.Tz};b4w.module.constraints=function(a,r){var b=r("__constraints");a.append_stiff=function(a,d,e,l){d instanceof Array&&2==d.length?b.an(a,d[0],d[1],e,l):b.bn(a,d,e,l)};a.append_semi_stiff=function(a,d,e,l){b.ms(a,d,e,l)};a.append_semi_stiff_cam=function(a,d,e,l,g,p,n,k){b.ls(a,d,e,l,g,p,n,k)};a.append_semi_soft_cam=function(a,d,e){b.ks(a,d,e)};a.append_stiff_trans=function(a,d,e){b.ns(a,d,e)};a.append_copy_trans=function(a,d,e){b.hs(a,d,e)};a.append_stiff_trans_rot=function(a,d,e,l){b.os(a,d,e,l)};a.append_track=
function(a,d){3==d.length?b.cn(a,d):b.ps(a,d)};a.append_follow=function(a,d,e,l){3==d.length?b.Ym(a,d,e,l):b.is(a,d,e,l)};a.remove=function(a){a.wa&&b.remove(a)}};b4w.module.data=function(a,r){var b=r("__print"),c=r("__data");a.load=c.load;a.load_and_add_new=c.load;a.unload=function(){c.Bq()};a.cleanup=a.unload;a.get_bpy_world=function(){b.error("get_bpy_world() deprecated");return null};a.set_debug_resources_root=c.Uy};b4w.module.debug=function(a,r){r("__batch");var b=r("__print"),c=r("__controls"),d=r("__debug"),e=r("__physics"),l=r("__scenegraph"),g=r("__scenes"),p=r("__sfx"),n=r("__textures"),k=r("__util"),h=r("vec3");a.physics_worker=function(){e.p("debug")};a.physics_id=function(a){b.log("O",e.jv(a));for(var c=e.Kv().m.o,d=0;d<c.length;d++){var g=c[d];g.mb.C==a&&b.log("B",g)}};a.visible_objects=function(){for(var a=g.n(),c=a.Ab.MESH,a=g.qa(a,"MAIN_OPAQUE").o,d=0;d<c.length;d++){var e=c[d],h=e.d;if("DYNAMIC"==
h.type)for(var l=0;l<a.length;l++){var k=a[l];if(k.K&&k.Wa==h){b.log(e.name,e);break}}}};a.object_info=function(a){for(var c=g.n(),d=c.Ab.MESH,e=0;e<d.length;e++){var h=d[e];if(h.name==a){b.log("Object",h);for(var l=g.Pk(c),k=0;k<l.length;k++){for(var n=l[k],p=n.o,r=[],E=0;E<p.length;E++)p[E].Wa==h.d&&r.push(p[E]);b.log("Subscene "+n.type,r)}}}};a.objects_stat=function(){var a=g.n();console.log("Armatures: "+g.La(a,"ARMATURE").length);console.log("Cameras: "+g.La(a,"CAMERA").length);console.log("Curves: "+
g.La(a,"CURVE").length);console.log("Empties: "+g.La(a,"EMPTY").length);console.log("Lamps: "+g.La(a,"LAMP").length);console.log("Meshes: "+g.La(a,"MESH").length);console.log("Speakers: "+g.La(a,"SPEAKER").length)};a.num_vertices=function(){for(var a=0,b=g.n(),b=[g.qa(b,"MAIN_OPAQUE"),g.qa(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.o,e=0;e<d.length;e++){var h=d[e].h;h&&(a+=h.fj)}}return a};a.num_triangles=function(){for(var a=0,b=g.n(),b=[g.qa(b,"MAIN_OPAQUE"),g.qa(b,"MAIN_BLEND")],
c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.o,e=0;e<d.length;e++){var h=d[e].h;h&&(a+=h.Bf)}}return a};a.num_draw_calls=function(){var a=g.n(),a=[g.qa(a,"MAIN_OPAQUE"),g.qa(a,"MAIN_BLEND")];return a[0].o.length+a[1].o.length};a.geometry_stats=function(){for(var a=g.n(),b=g.Pk(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.o,h=0;h<e.length;h++){var l=e[h].h,k=e[h].Wa;l&&("COLOR_PICKING"!=d.type&&"GLOW_MASK"!=d.type||k.sl)&&(a[l.id]=l)}}var e=d=c=b=0,n;
for(n in a)l=a[n],l=l.fc,l.zk&&(d++,e+=l.zk/1048576),b++,c+=l.Eu/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=g.n(),c=[g.qa(c,"MAIN_OPAQUE"),g.qa(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=e.o,h=0;h<e.length;h++){var l=e[h].h;if(l)for(var l=l.Ba,k=0;k<l.length;k++){var n=l[k];if("IMAGE"===n.source||"ENVIRONMENT_MAP"===n.source){var p=n.Ua;-1===a.indexOf(p)&&(a.push(p),n=4*n.width*n.height/1048576/n.yg,n*=1.3333,
b+=n)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=g.n(),c=g.Pk(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var h=e.k,l=[h.Na,h.Tb];l.push.apply(l,e.Ic);for(e=0;e<l.length;e++){var k=l[e];n.Vg(k)&&-1==a.indexOf(k)&&(a.push(k),b+=h.width*h.height*n.qw(k))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=g.n();(a=g.qa(a,"MAIN_OPAQUE"))&&g.gp(a.k,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=g.n(),b=
g.qa(a,"MAIN_OPAQUE"),a=g.Bj(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}g.gp(d.k,b,e)}};a.scenegraph_to_dot=function(){var a=g.n();b.log(l.Cu(g.Rk(a)))};a.controls_info=c.debug;a.object_distance=function(a,b){return h.dist(a.d.e,b.d.e)};a.msg=d.ol;a.fbmsg=d.Hk;a.print_telemetry=d.fy;a.plot_telemetry=d.ay;a.fbres=function(a,b){function c(){d.Hk("FBRES",a());setTimeout(c,b)}b||(b=16);
c()};a.check_constants=function(){var a=new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),g=new Float32Array([-1,0,0]),h=new Float32Array([0,-1,0]),l=new Float32Array([0,0,-1]);if(!k.Dd(a,k.Yr))throw"Wrong VEC3_IDENT";if(!k.Dd(b,k.Tr))throw"Wrong QUAT4_IDENT";if(!k.Dd(c,k.zm))throw"Wrong AXIS_X";if(!k.Dd(d,k.hb))throw"Wrong AXIS_Y";if(!k.Dd(e,k.Rj))throw"Wrong AXIS_Z";if(!k.Dd(g,k.Oq))throw"Wrong AXIS_MX";if(!k.Dd(h,
k.sd))throw"Wrong AXIS_MY";if(!k.Dd(l,k.ym))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=p.Ao(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==p.Bo(c)&&p.lp(c,!0)}};a.check_finite=jb();a.set_debug_params=function(a){var b=g.n();if(b=g.qa(b,"WIREFRAME"))"wireframe_mode"in a&&g.nz(b,a.wireframe_mode),"wireframe_edge_color"in a&&g.mz(b,a.wireframe_edge_color);else throw"Wireframe subscene not found.";}};b4w.module.hud=function(a,r){r("__print");var b=r("__hud");a.plot_array=b.$x;a.draw_mixer_strip=b.Uu};b4w.module.lights=function(a,r){function b(a){for(var b=e.n(),h=e.La(b,"LAMP"),k=0;k<h.length;k++){var r=h[k];if("SUN"==r.dc.type){var B=r;break}}if(!B)return c.error("There is no sun on the scene"),null;"hor_position"in a&&"vert_position"in a&&(h=(90-a.vert_position)/180*Math.PI,k=B.d,l.vj(B,[h,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),g.Mb(k.i,g.hb,a),k=p.length(k.e),p.copy(a,n),p.scale(n,k,n),l.lc(B,n),l.Y(B),a=B.dc,a.Xu&&(r=B.data.energy,k=b.world.light_settings.environment_energy,
h=Math.cos(Math.abs(h)),r*=Math.max(Math.min(3*h,1),0),h=Math.max(h,0.1)*k,d.Up(a,r),e.Sp(b,h,null,null)),e.Gj(B,b))}var c=r("__print"),d=r("__lights"),e=r("__scenes"),l=r("__transform"),g=r("__util"),p=r("vec3"),n=new Float32Array(3),k,h=60;a.get_lamps=function(a){var b=e.n(),b=e.La(b,"LAMP");if(!a)return b;for(var c=[],d=0;d<b.length;d++){var g=b[d];g.dc.type===a&&c.push(g)}return c};a.get_sun_params=function(){for(var a=e.n(),a=e.La(a,"LAMP"),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.dc.type){b=
d;break}}return b?(b=b.dc.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=b;a.set_day_time=function(a){for(var d=e.n(),d=e.La(d,"LAMP"),g=0;g<d.length;g++){var l=d[g];if("SUN"==l.dc.type){var k=l;break}}if(!k)return c.error("There is no sun on the scene"),null;k=-Math.cos(a/12*Math.PI)*h;d={};d.hor_position=12>a?15*a:15*(a-24);d.vert_position=k;b(d)};a.set_date=
function(a){(k=a.getDate())?1582==k&&10==a.rC&&4<a.Bu&&15>a.Bu&&c.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"):c.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){h=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){var b=e.n();if(!b)return c.error("No active scene"),!1;for(var b=e.La(b,"LAMP"),d=0;d<b.length;d++){var g=b[d];if(g.name===a){var h=g.dc;break}}return h?{light_color:h.color,light_energy:h.qf}:(c.error('B2W Warning: light "'+
a+'" not found'),!1)};a.set_light_params=function(a,b){var g=e.n();if(!g)return c.error("No active scene"),!1;for(var h=e.La(g,"LAMP"),l=0;l<h.length;l++){var k=h[l];if(k.name===a){var n=k.dc;break}}if(!n)return c.error('B2W Warning: light "'+a+'" not found'),!1;"light_energy"in b&&(d.Up(n,b.light_energy),e.Gj(k,g));"light_color"in b&&(d.cz(n,b.light_color),e.Gj(k,g))};a.get_lights_names=function(){var a=e.n();if(!a)return c.error("No active scene"),!1;for(var b=[],a=e.La(a,"LAMP"),d=0;d<a.length;d++)b.push(a[d].dc.name);
return b}};b4w.module.material=function(a,r){function b(a,b,c){var d=a.data.materials;a=a.B;for(var e=0;e<d.length;e++)if(d[e].name===b)for(var f=0;f<a.length;f++){var g=a[f],h=g.h;if(g.Ob===e&&(c&&h.type==c||!c))return h}return null}function c(a,b){for(var c=a.data.materials,d=a.B,e=0;e<c.length;e++)if(c[e].name===b)for(var f=0;f<d.length;f++){var g=d[f],h=g.h;if(g.Ob===e&&("MAIN"==h.type||"SHADELESS"==h.type))return!0}return!1}function d(a,c){var d=b(a,c);return d&&d.xa}function e(a,c){var d=b(a,c);return d&&
d.nf}function l(a,c){var d=b(a,c);return d&&d.Gb}function g(a,c){var d=b(a,c);return d&&d.Hb&&d.Hb[0]}function p(a,c){var d=b(a,c);return d&&d.Hb&&d.Hb[1]}function n(a,c){var d=b(a,c);return d&&d.ve}function k(a,c){var d=b(a,c);return d&&d.Pc}function h(a,c){var d=b(a,c);return d&&d.Wc}var f=r("__batch"),t=r("__config"),u=r("__print"),w=r("__util"),s=r("__shaders");r("__renderer");var B=t.u,q="u_colormap0 u_colormap1 u_stencil0 u_specmap u_normalmap0 u_mirrormap".split(" ");a.max_bones=function(){u.error("max_bones() deprecated, return default value");
return B.jc};a.set_max_bones=function(){u.error("set_max_bones() deprecated")};a.set_batch_param=function(){u.error("set_batch_param() deprecated")};a.inherit_material=function(a,c,d,e){var f=b(a,c,"MAIN"),g=b(d,e,"MAIN");if(w.To(d)&&w.To(a))if(f&&g){g.xa[0]=f.xa[0];g.xa[1]=f.xa[1];g.xa[2]=f.xa[2];g.xa[3]=f.xa[3];g.nf=f.nf;g.Gb[0]=f.Gb[0];g.Gb[1]=f.Gb[1];g.Gb[2]=f.Gb[2];g.Hb[0]=f.Hb[0];g.Hb[1]=f.Hb[1];g.ve=f.ve;g.Pc=f.Pc;g.Pc=f.Pc;isNaN(g.Wc)||isNaN(f.Wc)||(g.Wc=f.Wc);for(var h=0;h<g.nb.length;h++){var l=
g.nb[h];if(-1!==q.indexOf(l)){var k=f.nb.indexOf(l);-1!==k&&(g.Ba[h]=f.Ba[k])}}a=b(a,c,"DEPTH");d=b(d,e,"DEPTH");for(h=0;h<d.nb.length;h++)if(l=d.nb[h],-1!==q.indexOf(l)&&(k=a.nb.indexOf(l),-1!==k&&(d.Ba[h]=a.Ba[k],d.wg)))for(e=0;e<d.wg.length;e++)c=d.wg[e],f=c.nb.indexOf(l),-1!==f&&(c.Ba[f]=a.Ba[k])}else u.error("Wrong objects for inheriting material!");else u.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.data.materials;for(var c=0;c<a.length;c++)b.push(a[c].name);
return b};a.set_diffuse_color=function(a,c,e){d(a,c)||u.error('Property "diffuse_color" is missing!');a=b(a,c);a.xa[0]=e[0];a.xa[1]=e[1];a.xa[2]=e[2];a.xa[3]=e[3]};a.get_diffuse_color=function(a,c){d(a,c)||u.error('Property "diffuse_color" is missing!');var e=b(a,c),f=Array(4);f[0]=e.xa[0];f[1]=e.xa[1];f[2]=e.xa[2];f[3]=e.xa[3];return f};a.check_diffuse_color=d;a.set_diffuse_intensity=function(a,c,d){e(a,c)||u.error('Property "diffuse_intensity" is missing!');b(a,c).nf=d};a.get_diffuse_intensity=
function(a,c){e(a,c)||u.error('Property "diffuse_intensity" is missing!');return b(a,c).nf};a.check_diffuse_intensity=e;a.set_specular_color=function(a,c,d){l(a,c)||u.error('Property "specular_color" is missing!');a=b(a,c);a.Gb[0]=d[0];a.Gb[1]=d[1];a.Gb[2]=d[2]};a.get_specular_color=function(a,c){l(a,c)||u.error('Property "specular_color" is missing!');var d=b(a,c),e=Array(3);e[0]=d.Gb[0];e[1]=d.Gb[1];e[2]=d.Gb[2];return e};a.check_specular_color=l;a.set_specular_intensity=function(a,c,d){g(a,c)||
u.error('Property "specular_intensity" is missing!');b(a,c).Hb[0]=d};a.get_specular_intensity=function(a,c){g(a,c)||u.error('Property "specular_intensity" is missing!');return b(a,c).Hb[0]};a.check_specular_intensity=g;a.set_specular_hardness=function(a,c,d){p(a,c)||u.error('Property "specular_hardness" is missing!');b(a,c).Hb[1]=d};a.get_specular_hardness=function(a,c){p(a,c)||u.error('Property "specular_hardness" is missing!');return b(a,c).Hb[1]};a.check_specular_hardness=p;a.set_emit_factor=function(a,
c,d){n(a,c)||u.error('Property "emit" is missing!');b(a,c).ve=d};a.get_emit_factor=function(a,c){n(a,c)||u.error('Property "emit" is missing!');return b(a,c).ve};a.check_emit_factor=n;a.set_ambient_factor=function(a,c,d){k(a,c)||u.error('Property "ambient" is missing!');b(a,c).Pc=d};a.get_ambient_factor=function(a,c){k(a,c)||u.error('Property "ambient" is missing!');return b(a,c).Pc};a.check_ambient_factor=k;a.set_diffuse_color_factor=function(a,c,d){h(a,c)||u.error('Property "diffuse_color_factor" is missing!');
b(a,c).Wc=d};a.get_diffuse_color_factor=function(a,c){h(a,c)||u.error('Property "diffuse_color_factor" is missing!');return b(a,c).Wc};a.check_diffuse_color_factor=h;a.get_material_extended_params=function(a,d){if(!a||!d)return u.error("B2W Error: missing arguments in get_material_params"),null;if(!c(a,d))return null;var e=b(a,d);if(!e)return u.warn("B2W Warning: material not found"),null;var g={};"MAIN"==e.type&&(g.reflect_factor=e.Al,g.fresnel=e.$c[2],g.fresnel_factor=5*(1-e.$c[3]),g.parallax_scale=
e.tl,g.parallax_steps=f.Va(e,"PARALLAX_STEPS")[1]);return g};a.get_water_material_params=function(a,d){if(!a||!d)return u.error("B2W Error: missing arguments in get_water_material_params"),null;if(!c(a,d))return null;var e=b(a,d);if(!e.ag)return null;if(!e)return u.warn("B2W Warning: material not found"),null;var g={};if("MAIN"==e.type){if(B.md){var h=g.shallow_water_col=Array(3);h[0]=e.Re[0];h[1]=e.Re[1];h[2]=e.Re[2];h=g.shore_water_col=Array(3);h[0]=e.Se[0];h[1]=e.Se[1];h[2]=e.Se[2];g.shallow_water_col_fac=
e.Gl;g.shore_water_col_fac=e.Il}g.foam_factor=e.Jk;g.absorb_factor=f.Va(e,"ABSORB")[1];g.sss_strength=f.Va(e,"SSS_STRENGTH")[1];g.sss_width=f.Va(e,"SSS_WIDTH")[1];g.dst_noise_scale0=f.Va(e,"DST_NOISE_SCALE_0")[1];g.dst_noise_scale1=f.Va(e,"DST_NOISE_SCALE_1")[1];g.dst_noise_freq0=f.Va(e,"DST_NOISE_FREQ_0")[1];g.dst_noise_freq1=f.Va(e,"DST_NOISE_FREQ_1")[1];g.dir_min_shore_fac=f.Va(e,"DIR_MIN_SHR_FAC")[1];g.dir_freq=f.Va(e,"DIR_FREQ")[1];g.dir_noise_scale=f.Va(e,"DIR_NOISE_SCALE")[1];g.dir_noise_freq=
f.Va(e,"DIR_NOISE_FREQ")[1];g.dir_min_noise_fac=f.Va(e,"DIR_MIN_NOISE_FAC")[1];g.dst_min_fac=f.Va(e,"DST_MIN_FAC")[1];g.waves_hor_fac=f.Va(e,"WAVES_HOR_FAC")[1]}return g};a.set_material_extended_params=function(a,d,e){if(a&&d&&e){if(!c(a,d))return u.warn("B2W Warning: setting material params is not possible"),null;d=b(a,d);d?"MAIN"==d.type&&("material_reflectivity"in e&&a.d.Xd&&(d.Al=e.material_reflectivity),"material_fresnel"in e&&(d.$c[2]=e.material_fresnel),"material_fresnel_factor"in e&&(d.$c[3]=
1-e.material_fresnel_factor/5),"material_parallax_scale"in e&&(d.tl=e.material_parallax_scale),"material_parallax_steps"in e&&(a=s.s(parseFloat(e.material_parallax_steps)),f.ha(d,"PARALLAX_STEPS",a),f.ob(d,!0))):u.warn("B2W Warning: material not found")}else u.error("B2W Error: missing arguments in set_material_params")};a.set_water_material_params=function(a,d,e){if(!a||!d||!e)return u.error("B2W Error: missing arguments in set_water_material_params"),null;if(!c(a,d))return u.warn("B2W Warning: setting water material params is not possible"),
null;a=b(a,d);if(!a)return u.warn("B2W Warning: material not found"),null;"MAIN"==a.type&&(B.md&&("shallow_water_col"in e&&(d=e.shallow_water_col,a.Re[0]=d[0],a.Re[1]=d[1],a.Re[2]=d[2]),"shallow_water_col_fac"in e&&(a.Gl=e.shallow_water_col_fac),"shore_water_col"in e&&(d=e.shore_water_col,a.Se[0]=d[0],a.Se[1]=d[1],a.Se[2]=d[2]),"shore_water_col_fac"in e&&(a.Il=e.shore_water_col_fac)),B.Ec&&a.Iq&&("shore_smoothing"in e&&(e.shore_smoothing?f.ha(a,"SHORE_SMOOTHING",1):f.ha(a,"SHORE_SMOOTHING",0)),"absorb_factor"in
e&&(d=s.s(parseFloat(e.absorb_factor)),f.ha(a,"ABSORB",d))),"foam_factor"in e&&B.Yc&&(a.Jk=e.foam_factor),B.rc&&a.rc&&("water_dynamic"in e&&(e.water_dynamic?f.ha(a,"DYNAMIC",1):f.ha(a,"DYNAMIC",0)),"waves_height"in e&&(d=s.s(parseFloat(e.waves_height)),f.ha(a,"WAVES_HEIGHT",d)),"waves_length"in e&&(d=s.s(parseFloat(e.waves_length)),f.ha(a,"WAVES_LENGTH",d)),"sss_strength"in e&&(d=s.s(parseFloat(e.sss_strength)),f.ha(a,"SSS_STRENGTH",d)),"sss_width"in e&&(d=s.s(parseFloat(e.sss_width)),f.ha(a,"SSS_WIDTH",
d)),"dst_noise_scale0"in e&&(d=s.s(parseFloat(e.dst_noise_scale0)),f.ha(a,"DST_NOISE_SCALE_0",d)),"dst_noise_scale1"in e&&(d=s.s(parseFloat(e.dst_noise_scale1)),f.ha(a,"DST_NOISE_SCALE_1",d)),"dst_noise_freq0"in e&&(d=s.s(parseFloat(e.dst_noise_freq0)),f.ha(a,"DST_NOISE_FREQ_0",d)),"dst_noise_freq1"in e&&(d=s.s(parseFloat(e.dst_noise_freq1)),f.ha(a,"DST_NOISE_FREQ_1",d)),"dir_min_shore_fac"in e&&(d=s.s(parseFloat(e.dir_min_shore_fac)),f.ha(a,"DIR_MIN_SHR_FAC",d)),"dir_freq"in e&&(d=s.s(parseFloat(e.dir_freq)),
f.ha(a,"DIR_FREQ",d)),"dir_noise_scale"in e&&(d=s.s(parseFloat(e.dir_noise_scale)),f.ha(a,"DIR_NOISE_SCALE",d)),"dir_noise_freq"in e&&(d=s.s(parseFloat(e.dir_noise_freq)),f.ha(a,"DIR_NOISE_FREQ",d)),"dir_min_noise_fac"in e&&(d=s.s(parseFloat(e.dir_min_noise_fac)),f.ha(a,"DIR_MIN_NOISE_FAC",d)),"dst_min_fac"in e&&(d=s.s(parseFloat(e.dst_min_fac)),f.ha(a,"DST_MIN_FAC",d)),"waves_hor_fac"in e&&(e=s.s(parseFloat(e.waves_hor_fac)),f.ha(a,"WAVES_HOR_FAC",e))),f.ob(a,!0));return!0}};b4w.module.physics=function(a,r){var b=r("__print"),c=r("__physics"),d=r("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){c.Wn(a)};a.disable_simulation=function(a){c.Un(a)};a.has_simulated_physics=function(a){return c.Jo(a)};a.set_gravity=function(a,d){a.m?c.az(a,d):b.error("No physics for object "+a.name)};a.set_damping=function(a,d,g){a.m?c.p("set_damping",a.m.C,d,g):b.error("No physics for object "+a.name)};a.reset_damping=function(a){if(a.m){var d=a.game;
c.p("set_damping",a.m.C,d.damping,d.rotation_damping)}else b.error("No physics for object "+a.name)};a.set_transform=function(a,b,d){c.Xp.apply(this,arguments)};a.sync_transform=function(a){c.$b(a)};a.apply_velocity=function(a){c.ys.apply(this,arguments)};a.apply_velocity_world=function(a){c.zs.apply(this,arguments)};a.apply_force=function(a,b,d,p,n,k){n=n||!1;k=k||!1;c.ss.apply(this,arguments)};a.apply_torque=function(a,b,d,p){c.xs.apply(this,arguments)};a.vehicle_throttle=function(a,l){c.Ub(a)||
c.Vb(a)||b.error("Wrong object");c.Fq(a,d.Za(l,-1,1))};a.vehicle_throttle_inc=function(a,l,g){c.Ub(a)||c.Vb(a)||b.error("Wrong object");l=d.Za(l,0,1);var p=a.g.rf;-1==g||1==g?p=Math.max(-1,Math.min(p+g*l,1)):0==g&&0<=p?(p-=l,p=Math.max(0,p)):0==g&&0>p?(p+=l,p=Math.min(0,p)):b.error("Wrong steering direction");c.Fq(a,d.Za(p,-1,1))};a.vehicle_steer=function(a,l){c.Ub(a)||c.Vb(a)||b.error("Wrong object");c.Eq(a,d.Za(l,-1,1))};a.vehicle_steer_inc=function(a,l,g){c.Ub(a)||c.Vb(a)||b.error("Wrong object");
l=d.Za(l,0,1);var p=a.g.Of;-1==g||1==g?p=Math.max(-1,Math.min(p+g*l,1)):0==g&&0<=p?(p-=l,p=Math.max(0,p)):0==g&&0>p?(p+=l,p=Math.min(0,p)):b.error("Wrong steering direction");c.Eq(a,d.Za(p,-1,1))};a.vehicle_brake=function(a,l){c.Ub(a)||c.Vb(a)||b.error("Wrong object");c.Dq(a,d.Za(l,0,1))};a.vehicle_brake_inc=function(a,l){c.Ub(a)||c.Vb(a)||b.error("Wrong object");l=d.Za(l,-1,1);var g=a.g.rg;c.Dq(a,d.Za(g+g*l,0,1))};a.is_vehicle_chassis=function(a){return c.Ub(a)};a.is_vehicle_hull=function(a){return c.Vb(a)};
a.get_vehicle_name=function(a){if(c.Ub(a)||c.Vb(a))return a.b4w_vehicle_settings.name;b.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(c.Ub(a)||c.Vb(a))return a.g.rf;b.error("Wrong object")};a.get_vehicle_steering=function(a){if(c.Ub(a)||c.Vb(a))return a.g.Of;b.error("Wrong object")};a.get_vehicle_brake=function(a){if(c.Ub(a)||c.Vb(a))return a.g.rg;b.error("Wrong object")};a.get_vehicle_speed=function(a){if(c.Ub(a)||c.Vb(a))return c.sw(a);b.error("Wrong object")};a.is_character=
function(a){return c.Si(a)};a.set_character_move_dir=function(a,b,d){c.Ly(a,b,d)};a.set_character_move_type=function(a,b){c.My(a,b)};a.set_character_dist_to_water=function(){b.warn("Function set_character_dist_to_water() is deprecated")};a.set_character_walk_velocity=function(a,b){c.Ry(a,b)};a.set_character_run_velocity=function(a,b){c.Qy(a,b)};a.set_character_fly_velocity=function(a,b){c.Ky(a,b)};a.character_jump=function(a){c.at(a)};a.character_rotation_inc=function(a,b,d){c.bt(a,b,d)};a.set_character_rotation_quat=
function(a,b){c.GC(a,b)};a.set_character_rotation=function(a,b,d){c.Ny(a,b,d)};a.set_character_rotation_v=function(a,b){c.Py(a,b)};a.set_character_rotation_h=function(a,b){c.Oy(a,b)};a.append_collision_test=function(a,b,d){c.Xm(a,b,d)};a.remove_collision_test=function(a,b){c.Gp(a,b)};a.apply_collision_impulse_test=function(a,b){c.dn(a,b)};a.clear_collision_impulse_test=function(a){c.Dn(a)};a.append_ray_test=function(a,b,d,p,n,k){c.$m(a,b,d,p,n,k)};a.remove_ray_test=function(a,b,d,p,n){c.Hp(a,d,p,
n)};a.apply_constraint=function(a,d,g,p,n,k,h,f,r,u){c.Yk(d)&&c.Yk(n)?c.rs(a,d,g,p,n,k,h,f,r,u):b.error("Wrong objects")};a.clear_constraint=function(a){c.Yk(a)&&c.Kw(a)?c.qt(a):b.error("Wrong object")};a.pull_to_constraint_pivot=function(a,b,d,p,n,k){c.gy(a,b,d,p,n,k)}};b4w.module.scenes=function(a,r){var b=r("__batch"),c=r("__config"),d=r("__print"),e=r("__physics"),l=r("__renderer"),g=r("__scenes"),p=r("__util");r("__camera");var n=c.u,k=["MAIN_OPAQUE","MAIN_BLEND","MAIN_REFLECT","GOD_RAYS","SKY"];a.set_active=function(a){g.Qp(p.ic("name",a,g.Ok()))};a.get_active=function(){return g.P()?g.n().name:""};a.get_scenes=function(){for(var a=g.Ok(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_screen_scenes=function(){d.log("get_screen_scenes() deprecated");
return""};a.get_active_camera=function(){if(g.P())return g.n().camera;d.error("No active scene");return!1};a.get_object_by_name=function(a){if(!g.P())return d.error("No active scene"),!1;var b=g.La(g.n()),b=p.Yo("name",a,b);if(1==b.length)return b[0];d.warn("get_object_by_name("+a+"): not found");return!1};a.get_object_by_empty_name=function(a,b){if(!g.P())return d.error("No active scene"),!1;for(var c=g.La(g.n()),e=0;e<c.length;e++){var k=c[e];if(k.dupli_group&&k.name==a)for(var k=k.dupli_group.objects,
l=0;l<k.length;l++){var n=k[l];if(n.origin_name==b)return n}}d.warn("get_object_by_empty_name("+a+", "+b+"): not found");return null};a.pick_object=function(a,b){if(!g.P())return d.error("No active scene"),"";var c=g.n(),e=g.qa(c,"COLOR_PICKING");if(!n.ci&&!e)return d.error("Color picking disabled by engine configuration"),"";if(e){l.Ci(e);e=e.k;b=e.height-b;for(var e=l.qy(e.Kd,a,b),c=c.Ab.MESH,k=0;k<c.length;k++){var p=c[k].Qm;if(p&&5>Math.abs(255*p[0]-e[0])&&5>Math.abs(255*p[1]-e[1])&&5>Math.abs(255*
p[2]-e[2]))return c[k].name}}return""};a.set_glow_intensity=function(a,b){for(var c=0;c<a.B.length;c++){var d=a.B[c];"COLOR_ID"==d.h.type&&(d.h.Ld=b)}};a.apply_glow_anim=function(a,b,c,d){a.d&&a.d.ae&&g.fn(a,b,c,d)};a.apply_glow_anim_def=function(a){if(a.d&&a.d.ae){var b=a.d.Uk;g.fn(a,b.ww,b.yw,b.zw)}};a.clear_glow_anim=function(a){a.d&&a.d.ae&&g.En(a)};a.set_glow_color=function(a){var b=g.n();if(b=g.qa(b,"GLOW"))b.Ni=a,b.Ra=!0};a.set_light_pos=function(){d.error("set_light_pos() deprecated, use lights module instead")};
a.set_light_direction=function(){d.error("set_light_direction() deprecated, use lights module instead")};a.set_dir_light_color=function(){d.error("set_dir_light_color() deprecated, use lights module instead")};a.get_lights_names=function(){d.error("set_dir_light_color() deprecated, use lights module instead")};a.get_shadow_params=function(){if(!g.P())return d.error("No active scene"),!1;var a=g.n();if(!g.qa(a,"SHADOW_CAST"))return null;var b={},c=g.qa(a,"BLUR_DEPTH");c&&(b.blur_depth_size_mult=c.qg,
b.blur_depth_edge_size=c.pg,b.blur_depth_diff_threshold=1E3*c.og);if(c=g.qa(a,"DEPTH"))b.shadow_visibility_falloff=c.Fl;c=a.d.Ih;b.csm_near=c.re;b.csm_far=c.Bg;b.csm_num=c.Dg;b.csm_lambda=c.Cg;b.csm_borders=g.ko(a);return b};a.set_shadow_params=function(a){if(!g.P())return d.error("No active scene"),!1;var c=g.n(),e=g.Bj(c,k),l=g.qa(c,"DEPTH");l&&"shadow_visibility_falloff"in a&&(l.Fl=a.shadow_visibility_falloff);for(var e=g.Bj(c,["BLUR_DEPTH"]),n=0;n<e.length;n++){l=e[n];if("blur_depth_size_mult"in
a){l.qg=a.blur_depth_size_mult;var p=l.o,r=p[0].h;r&&r.ca&&(b.jd(r,a.blur_depth_size_mult),g.Hh(l,1/l.k.width,1/l.k.width))}"blur_depth_edge_size"in a&&(l.pg=a.blur_depth_edge_size);"blur_depth_diff_threshold"in a&&(l.og=a.blur_depth_diff_threshold/1E3);l.Ra=!0}l=c.d.Ih;"csm_near"in a&&(l.re=a.csm_near);"csm_far"in a&&(l.Bg=a.csm_far);"csm_lambda"in a&&(l.Cg=a.csm_lambda);if(l=g.qa(c,"DEPTH")){p=l.o;for(n=0;n<p.length;n++)a=p[n],a.Wa.Nb&&(r=a.h,b.dk(r,g.ko(c)),b.ob(r));l.Ra=!0}g.El(c)};a.get_environment_colors=
function(){if(!g.P())return d.error("No active scene"),!1;var a=g.n();return g.aw(a)};a.set_environment_colors=function(a,b,c){if(!g.P())return d.error("No active scene"),!1;var e=g.n();g.Sp(e,parseFloat(a),b,c)};a.get_fog_color_density=function(a){if(!g.P())return d.error("No active scene"),!1;var b=g.n();return g.dw(b,a)};a.set_fog_color_density=function(a){if(!g.P())return d.error("No active scene"),!1;var b=g.n();g.Yy(b,a)};a.get_ssao_params=function(){if(!g.P())return d.error("No active scene"),
!1;var a=g.n();return g.nw(a)};a.set_ssao_params=function(a){if(!g.P())return d.error("No active scene"),!1;var b=g.n();g.gz(b,a)};a.get_color_correction_params=function(){if(!g.P())return d.error("No active scene"),null;var a=g.n(),a=g.qa(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.tg;b.contrast=a.Ag;b.exposure=a.Ng;b.saturation=a.Ch;return b};a.set_color_correction_params=function(a){if(!g.P())return d.error("No active scene"),null;var b=g.n(),b=g.qa(b,"COMPOSITING");if(!b)return null;
"brightness"in a&&(b.tg=a.brightness);"contrast"in a&&(b.Ag=a.contrast);"exposure"in a&&(b.Ng=a.exposure);"saturation"in a&&(b.Ch=a.saturation)};a.get_sky_params=function(){if(!g.P())return d.error("No active scene"),!1;var a=g.n();return g.lw(a)};a.set_sky_params=function(a){if(!g.P())return d.error("No active scene"),!1;var b=g.n();g.fz(b,a)};a.get_aa_params=function(){if(!g.P())return d.error("No active scene"),!1;var a=g.n();return g.Jv(a)};a.set_aa_params=function(a){if(!g.P())return d.error("No active scene"),
!1;var b=g.n();g.Gy(b,a)};a.get_dof_params=function(){if(!g.P())return d.error("No active scene"),!1;var a=g.n();return g.qa(a,"DOF")?g.$v(a):null};a.set_dof_params=function(a){if(!g.P())return d.error("No active scene"),!1;var b=g.n();g.Wy(b,a)};a.get_god_rays_params=function(){if(!g.P())return d.error("No active scene"),!1;var a=g.n();return g.qa(a,"GOD_RAYS")?g.ew(a):null};a.set_god_rays_params=function(a){if(!g.P())return d.error("No active scene"),!1;var b=g.n();g.$y(b,a)};a.get_bloom_params=
function(){if(!g.P())return d.error("No active scene"),!1;var a=g.n();return g.qa(a,"BLOOM")?g.Rv(a):null};a.set_bloom_params=function(a){if(!g.P())return d.error("No active scene"),!1;var b=g.n();g.Jy(b,a)};a.get_wind_params=function(){return g.vw()};a.set_wind_params=function(a){if(!g.P())return d.error("No active scene"),!1;var b=g.n();g.lz(b,a)};a.get_water_surface_level=g.Do;a.set_water_params=function(a){if(!g.P())return d.error("No active scene"),!1;var b=g.n();g.kz(b,a)};a.get_water_mat_params=
function(a){if(!g.P())return d.error("No active scene"),!1;var b=g.n();g.uw(b,a)};a.update_scene_materials_params=function(){if(!g.P())return d.error("No active scene"),!1;var a=g.n();g.kA(a)};a.append_object=function(){throw'Method "append_object" is deprecated';};a.add_object=function(){throw'Method "add_object" is deprecated';};a.remove_object=function(){throw'Method "remove_object" is deprecated';};a.hide_object=function(a){g.n();g.Ow(a)};a.show_object=function(a){g.n();g.uz(a)};a.check_object=
function(a){return g.P()?g.jt(a,g.n()):(d.error("No active scene"),!1)};a.remove_all=function(){throw"unimplemented";};a.check_collision=Rc(!1);a.check_ray_hit=Rc(!1);a.get_object_name=function(a){return a?a.name:(d.error("Wrong object name"),"")};a.get_object_type=function(a){return a&&a.type?a.type:(d.error("Wrong object ID"),"UNDEFINED")};a.get_object_children=function(a){return a.td.slice(0)};a.get_first_character=function(){for(var a=g.La(g.n(),"MESH"),b=0;b<a.length;b++){var c=a[b];if(e.Si(c))return c}return null};
a.get_shore_dist=function(a,b){b||0===b||(b=1);return g.kw(a,b)};a.get_cam_water_depth=function(){return g.Tv()}};b4w.module.sfx=function(a,r){var b=r("__scenes"),c=r("__sfx");a.play=function(a,b,l){c.play(a,b,l)};a.play_def=function(a){c.Bp(a)};a.is_play=function(a){return c.al(a)};a.speaker_play=function(a,b,l,g){c.yc(a,b);g&&c.mj(a,g);c.play(a,0,l)};a.speaker_stop=function(a){c.stop(a)};a.stop=function(a){c.stop(a)};a.speaker_playback_rate=function(a,b){c.mj(a,b)};a.playrate=function(a,b){c.mj(a,b)};a.cyclic=function(a,b){c.yc(a,b)};a.is_cyclic=function(a){return c.Ti(a)};a.listener_reset_speed=function(){c.lx()};
a.speaker_reset_speed=function(a){c.zz(a)};a.get_volume=function(a){return a&&"object"===typeof a?c.tw(a):c.fw()};a.set_volume=function(a,b){a&&"object"===typeof a?c.$p(a,b):c.dz(b)};a.mute=function(a,b){a&&"object"===typeof a?c.lp(a,b):c.Gx(b)};a.is_muted=function(a){return a&&"object"===typeof a?c.fx(a):c.ex()};a.get_speaker_objects=function(){return c.Ao().slice(0)};a.get_speakers=function(){return a.get_speaker_objects()};a.set_compressor_params=function(a){c.Ty(b.n(),a)};a.get_compressor_params=
function(){return c.Wv(b.n())};a.duck=function(a,b,l){a&&"object"===typeof a?c.Vu(a,b,l):c.Wu(b,l)};a.unduck=function(a){a&&"object"===typeof a?c.aA(a):c.bA()};a.apply_playlist=c.us;a.clear_playlist=c.rt;a.set_positional_params=c.ez;a.get_positional_params=c.hw;a.set_filter_params=c.Xy;a.get_filter_params=c.cw;a.get_filter_freq_response=c.bw};b4w.module.shaders=function(a,r){function b(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function c(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);
if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function d(a){for(var b=1;999>=b;b++){var c={da:"main.glslv",ba:"main.glslf",W:[["MAX_BONES",b],["SKINNED",1],["FRAMES_BLENDING",a],["WIND_BEND",0],["DETAIL_BEND",0],["DYNAMIC_GRASS",0],["VERTEX_ANIM",0],["TEXTURE_COLOR",1],["TEXTURE_SPEC",1],["TEXTURE_NORM",1],["TEXTURE_MIRROR",1],["VERTEX_COLOR",1],["WATER_EFFECTS",1],["REFLECTIVE",0],["REFLECTION_PASS",0],["SHADOW_SRC_NONE",10],["SHADOW_SRC_RGBA",20],["SHADOW_SRC_RGBA_PCF",
30],["SHADOW_SRC_DEPTH",40],["SHADOW_SRC_VSM",50],["SHADOW_SRC_MASK",60],["SHADOW_SRC","SHADOW_SRC_DEPTH"],["CSM_SECTION1",1],["CSM_SECTION2",1],["CSM_SECTION3",0],["CSM_SECTION_DIST0",2.0001],["CSM_SECTION_DIST1",4.0001],["CSM_SECTION_DIST2",7.0001],["CSM_SECTION_DIST3",9.0001],["NUM_LIGHTS",4],["DOUBLE_SIDED_LIGHTING",1],["NUM_CAUSTS",3],["TEXTURE_COORDS_UV",10],["TEXTURE_COORDS_NORMAL",20],["TEXTURE_COORDS","TEXTURE_COORDS_NORMAL"],["DISABLE_FOG",0],["ALPHA_AS_SPEC",0],["TEXTURE_STENCIL_ALPHA_MASK",
0],["PARALLAX",0],["PARALLAX_STEPS",0],["TEXTURE_BLEND_TYPE_MIX",10],["TEXTURE_BLEND_TYPE_MULTIPLY",20],["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX"],["ALPHA",1],["ALPHA_CLIP",0],["SSAO_ONLY",0]]};try{h.Qk(c,null)}catch(d){return p.log("vertex uniforms limit exceeded, max bones =",b-1),b-1}p.log("shaders successfully compiled and linked")}return 999}function e(a){for(var b=k.Ok(),c=0;c<b.length;c++)for(var d=k.La(b[c],"MESH"),e=0;e<d.length;e++){var f=d[e];if(f.B)for(var g=f.data.materials,h=0;h<
f.B.length;h++){var l=f.B[h];if(l.h.Zb==a&&-1<l.Ob)return g[l.Ob].name}}return null}function l(a){a.sort(function(a,b){return b.Mk.ALU_OPS-a.Mk.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.Mk,f=c.xA,g=e(c.zu),g=g?"\t\t("+g+")":"\t\t(NA)";p.groupCollapsed("FRAG --\x3e","ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",f.ALU_OPS,"TEX",f.TEX_OPS,g);p.groupCollapsed("directives");for(var g=c.Ja.W,h=0;h<g.length;h++){var l=g[h];p.log(l[0],l[1])}p.groupEnd();p.groupCollapsed("vert src");p.log(c.wA);
p.groupEnd();p.groupCollapsed("vert stats");for(var k in f)"ALU_OPS"!=k&&"TEX_OPS"!=k&&p.log(k,f[k]);p.groupEnd();p.groupCollapsed("frag src");p.log(c.uv);p.groupEnd();p.groupCollapsed("frag stats");for(k in d)"ALU_OPS"!=k&&"TEX_OPS"!=k&&p.log(k,d[k]);p.groupEnd();p.groupEnd()}}function g(a){function b(a){for(var c=l-1;0<=c;c--)if(a[c]+1>d[c].Xf.length-1)a[c]=0;else{a[c]++;break}}function c(a){for(var b=Array(a.length),d=0;d<a.length;d++)b[d]=a[d];return b}for(var d=[],e=0;e<a.Ma.length;e++)d.push({name:a.Ma[e],
Xf:[0,1]});for(e=0;e<a.Ia.length;e++){var f=a.Ia[e][0];d.push({name:f,Xf:a.Ia[e][1]})}for(e=0;e<a.Ga.length;e++){for(var f=a.Ga[e][0],g=a.Ga[e][1],h=0;h<g.length;h++)d.push({name:g[h],Xf:[10+10*h]});d.push({name:f,Xf:g})}var l=d.length;a=[];for(var k,f=1,e=0;e<d.length;e++)f*=d[e].Xf.length;for(e=0;e<f;e++){if(k)k=c(k),b(k);else for(k=Array(l),h=0;h<l;h++)k[h]=0;a.push(k)}f=[];for(e=0;e<a.length;e++){k=a[e];g=[];for(h=0;h<k.length;h++){var n=d[h];g.push([n.name,n.Xf[k[h]]])}f.push(g)}return f}r("__config");
var p=r("__print"),n=r("__extensions"),k=r("__scenes"),h=r("__shaders");r("__util");var f=[{da:"depth.glslv",ba:"depth.glslf",W:{Ma:"SKINNED FRAMES_BLENDING WIND_BEND DETAIL_BEND VERTEX_ANIM TEXTURE_COLOR VERTEX_COLOR DEPTH_RGBA ALPHA CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 PCF_SHADOWS VSM_SHADOWS".split(" "),Ia:[["MAX_BONES",[100]],["CSM_SECTION_DIST0",[2.0001]],["CSM_SECTION_DIST1",[4.0001]],["CSM_SECTION_DIST2",[7.0001]],["CSM_SECTION_DIST3",[9.0001]],["PCF_TEXEL_SIZE",[1/1024]]],Ga:[["SHADOW_SOURCE",
["SHADOW_SOURCE_NONE","SHADOW_SOURCE_MAP","SHADOW_SOURCE_MASK"]]]}},{da:"shadeless.glslv",ba:"shadeless.glslf",W:{Ma:"SKINNED FRAMES_BLENDING WIND_BEND DETAIL_BEND VERTEX_ANIM VERTEX_COLOR TEXTURE_STENCIL_ALPHA_MASK REFLECTION TEXTURE_COLOR WATER_EFFECTS ALPHA ALPHA_CLIP DISABLE_FOG".split(" "),Ia:[["MAX_BONES",[100]]],Ga:[["TEXTURE_BLEND_TYPE",["TEXTURE_BLEND_TYPE_MIX","TEXTURE_BLEND_TYPE_MULTIPLY"]]]}},{da:"color_id.glslv",ba:"color_id.glslf",W:{Ma:"SKINNED FRAMES_BLENDING WIND_BEND DETAIL_BEND VERTEX_ANIM TEXTURE_COLOR ALPHA_CLIP".split(" "),
Ia:[["MAX_BONES",[100]]],Ga:[]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/anaglyph.glslf",W:{Ma:[],Ia:[],Ga:[]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/antialiasing.glslf",W:{Ma:[],Ia:[],Ga:[["AA_METHOD",["AA_METHOD_PASS","AA_METHOD_LIGHT","AA_METHOD_QUALITY"]]]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/blur_depth.glslf",W:{Ma:[],Ia:[],Ga:[]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/compositing.glslf",W:{Ma:[],Ia:[],
Ga:[]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/depth_pack.glslf",W:{Ma:["DEPTH_RGBA"],Ia:[],Ga:[]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/dof.glslf",W:{Ma:["DEPTH_RGBA"],Ia:[],Ga:[]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/edge.glslf",W:{Ma:["DEPTH_RGBA"],Ia:[],Ga:[]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/bloom_combine.glslf",W:{Ma:[],Ia:[],Ga:[]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/luminance.glslf",
W:{Ma:[],Ia:[],Ga:[]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/luminance_av.glslf",W:{Ma:[],Ia:[],Ga:[]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/luminance_trunced.glslf",W:{Ma:[],Ia:[],Ga:[]}},{da:"postprocessing/god_rays.glslv",ba:"postprocessing/god_rays.glslf",W:{Ma:["DEPTH_RGBA","WATER_EFFECTS"],Ia:[["NUM_LIGHTS",[1,10,100]]],Ga:[]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/god_rays_combine.glslf",W:{Ma:[],Ia:[],Ga:[]}},{da:"special_skydome.glslv",
ba:"procedural_skydome.glslf",W:{Ia:[["NUM_LIGHTS",[1,10,100]]],Ga:[]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/motion_blur.glslf",W:{Ma:[],Ia:[["MAX_STEPS",[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,100]]],Ga:[]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/postprocessing.glslf",W:{Ma:[],Ia:[],Ga:[["POST_EFFECT",["POST_EFFECT_NONE","POST_EFFECT_GRAYSCALE","POST_EFFECT_X_BLUR","POST_EFFECT_Y_BLUR"]]]}},{da:"postprocessing/postprocessing.glslv",ba:"postprocessing/ssao.glslf",
W:{Ma:["SSAO_WHITE"],Ia:[],Ga:[]}}];a.determine_max_bones=function(){return{max_bones:d(1),max_bones_no_blending:d(0)}};a.report_repeatful_compilation=function(){var a=h.Du(),b=0,c;for(c in a){var d=a[c],e=d.count;1<e&&p.log(e-1,d.pz,d.Nw);b+=e-1}p.log("TOTAL OVERHEAD:",b);return"OK"};a.analyze=function(a){var d=h.Uv(),e=0,f;for(f in d)a&&-1===f.indexOf(a)||e++;var e="of "+e+" analyzing...",g={};for(f in d)if(!a||-1!==f.indexOf(a)){var k=d[f],r;var D=k.Gq;r=k.ho;var z=n.mo();if(z){D=z.getTranslatedShaderSource(D);
r=z.getTranslatedShaderSource(r);var z=c("/nvidia_vert",D),E=b(z),M=c("/nvidia_frag",r),x=b(M);r={wA:D,XC:z,xA:E,uv:r,JB:M,Mk:x}}else p.error("B2W Error: WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),r=void 0;z=k.Ja;D=z.da+" + "+z.ba;r.zu=k;r.Ja=z;k=g[D]=g[D]||[];k.push(r);p.log(e)}for(D in g)p.group("%c"+D,"color: #800"),k=g[D],l(k),p.groupEnd()};a.compile_all=function(a,b){function c(){cleanup();for(var a=L;d.length&&a--;){var b=d.shift();p.log(b.ol);h.Qk(b.Ja,
null)}setTimeout(c,R)}for(var d=[],e=0;e<f.length;e++){var k=f[e].da,l=f[e].ba,n=g(f[e].W),r=n.length,E="of "+r+" "+k+" + "+l,M=a||0,x=b||r;x>r&&(x=r);for(r=M;r<x;r++)d.push({Ja:{da:k,ba:l,W:n[r]},ol:E})}var L=100,R=50;setTimeout(c,0)}};b4w.module.transform=function(a,r){var b=r("__print"),c=r("__physics"),d=r("__transform"),e=r("__util"),l=new Float32Array(3),g=new Float32Array(4);a.set_translation=function(a,b,e,g){l[0]=b;l[1]=e;l[2]=g;d.lc(a,l);d.Y(a);c.$b(a)};a.set_translation_v=function(a,b){d.lc(a,b);d.Y(a);c.$b(a)};a.set_translation_rel=function(a,b,g,h,f){l[0]=b;l[1]=g;l[2]=h;e.Ej(l,1,f.d.i,f.d.e,l);d.lc(a,l);d.Y(a);c.$b(a)};a.get_translation=function(a,b){b||(b=new Float32Array(3));d.Co(a,b);return b};a.set_rotation=function(a,
b,e,h,f){g[0]=b;g[1]=e;g[2]=h;g[3]=f;d.Pe(a,g);d.Y(a);c.$b(a)};a.set_rotation_quat=a.set_rotation;a.set_rotation_v=function(a,b){d.Pe(a,b);d.Y(a);c.$b(a)};a.set_rotation_quat_v=a.set_rotation_v;a.get_rotation=function(a,b){b||(b=new Float32Array(4));d.xo(a,b);return b};a.get_rotation_quat=a.get_rotation;a.set_rotation_euler=function(a,b,e,g){l[0]=b;l[1]=e;l[2]=g;d.vj(a,l);d.Y(a);c.$b(a)};a.set_rotation_euler_v=function(a,b){d.vj(a,b);d.Y(a);c.$b(a)};a.set_scale=function(a,b){d.Qe(a,b);d.Y(a)};a.get_scale=
function(a){return d.Sk(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)return b.error("Wrong object: "+a.name),!1;d.lc(a,[0,0,0]);d.Pe(a,[0,0,0,1]);d.Qe(a,1);d.Y(a);c.$b(a)};a.get_object_size=function(a){return e.Ug(a)?d.vo(a):(b.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,c,g){return e.Ug(a)?d.uo(a,c,g):(b.error("Wrong object: "+a.name),null)};a.move_local=function(a,b,e,g){d.kp(a,b,e,g);d.Y(a);c.$b(a)}};b4w.module.util=function(a,r){var b=r("__print"),c=r("__util"),d=r("vec3");r("mat4");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.keyfind=c.Yo;a.keysearch=c.ic;a.matrix_to_quat=function(a){return c.Pd(a)};a.euler_to_quat=function(a){return c.Mg(a)};a.quat_to_euler=function(a){return c.jy(a)};a.sign=c.Te;a.clamp=c.Za;a.quat_to_dir=
c.Mb;a.ground_project_quat=function(a,b){return c.Ep(a,c.sd,c.hb,c.ym,b)};a.cam_quat_to_mesh_quat=function(a,b){return c.Ws(a,b)};a.quat_project=function(a,l,g,p,n){return 0!=d.dot(g,p)?(b.error("Wrong in-plane direction"),null):c.Ep(a,l,g,p,n)};a.hash_code=c.Ko;a.smooth=c.Nf;a.smooth_v=c.Kh;a.is_vector=c.Wg;a.correct_cam_quat_up=c.Et;a.quat_to_angle_axis=c.iy;a.random_from_array=c.oy;a.xz_direction=c.HA};"object"==typeof module&&module.Fk&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,r){var b=r("__version");a.version=b.version;a.type=b.type;a.date=b.Rn};"object"==typeof module&&module.Fk&&b4w.module.version(exports);b4w.module.main=function(a,r){function b(){}function c(){}function d(){}function e(a){for(var b=null,c=0;c<X.length;c++){var d=X[c];try{b=a.getContext(d,S)}catch(e){}if(b)break}return b}function l(a){a.addEventListener("webglcontextlost",function(a){a.preventDefault();u.error("B2W Error: WebGL context lost");p()},!1);q.mc(Z);var b=q.iw();b&&u.log("%cRENDERER INFO:","color: #00a",Z.getParameter(b.UNMASKED_VENDOR_WEBGL)+", "+Z.getParameter(b.UNMASKED_RENDERER_WEBGL));M.mc(Z);y.mc(Z);I.mc(Z);R.mc(Z);
B.mc(Z);x.aq(a.width,a.height);L.Rg();m=0;c=h();n()}function g(){b=jb()}function p(){C=!1;L.pause();E.pause()}function n(){V(n);var a=performance.now()/1E3;F||(F=a);var b=a-F;b<1/P.ip||M.cx()||(F=a,C&&(m+=b,B.update(),z.update(),s.update(),k(m,b),c(b)))}function k(a,c){s.Bc()&&(D.reset(),Q.update(c),L.update(a,c),f.update(c),s.Bc()&&(E.update(a,c),s.Bc()&&(b(c,a),s.Bc()&&(w.update(a,c),s.Bc()&&x.update(a,c)))))}function h(){var a=60,b=0,c=0,e=P.qv,f=P.pv;return function(g){a=H.Nf(1/g,a,g,e);b=H.Nf(0,
b,g,e);c=(c+1)%f;0==c&&d(Math.round(a),Math.round(b))}}var f=r("__animation"),t=r("__config"),u=r("__print"),w=r("__controls"),s=r("__data"),B=r("__debug"),q=r("__extensions"),y=r("__geometry"),D=r("__hud"),z=r("__assets"),E=r("__physics"),M=r("__renderer"),x=r("__scenes"),L=r("__sfx"),R=r("__shaders"),I=r("__textures"),Q=r("__transform"),H=r("__util"),K=r("__version"),S=t.context,P=t.u,O=null,T=null,m=0,F=0,C=!0,X=["webgl","experimental-webgl"],Z=null,V=function(){return window.requestAnimationFrame||
window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/P.ip)}}();a.INIT_OK=100;a.BROWSER_NOT_SUPPORTED=110;a.UNDERLYING_ERROR=120;a.init=function(b,c){u.jz(P.tk);var d=K.version()+" "+K.type()+" ("+K.Rn()+")";u.log("%cINIT B2W ENGINE","color: #00a",d);if(!window.WebGLRenderingContext)return a.BROWSER_NOT_SUPPORTED;window.performance||(u.log("Apply performance workaround"),window.performance=
{});window.performance.now||(u.log("Apply performance.now() workaround"),window.performance.now=function(){return(new Date).getTime()});O=b;Z=e(b);if(!Z)return a.UNDERLYING_ERROR;l(O);t.bz(Z);t.vs();u.log("%cSET PRECISION:","color: #00a",P.precision);c?(D.Rg(c),T=c):(t.u.xj=!1,t.Lf.cj=!1);E.Rw();return a.INIT_OK};a.set_check_gl_errors=function(a){B.Sy(a)};a.resize=function(a,b){O.style.width=a+"px";O.style.height=b+"px";T&&(T.style.width=a+"px",T.style.height=b+"px");O.width=a;O.height=b;T&&(T.width=
a,T.height=b);D.Uh();x.aq(a,b);M.clear();k(m,0)};a.set_fps_callback=function(a){d=a};a.clear_fps_callback=function(){d=jb()};a.set_on_before_render_callback=function(a){b=a};a.set_render_callback=function(a){b=a};a.clear_on_before_render_callback=function(){g()};a.clear_render_callback=function(){g()};a.global_timeline=function(){return m};a.reset_timeline=function(){F=m=0};a.set_texture_quality=function(){u.error("set_texture_quality() deprecated")};a.set_shaders_dir=function(){u.error("set_shaders_dir() deprecated")};
a.redraw=function(){k(m,0)};a.resume=function(){C=!0;L.Cl();E.Cl()};a.pause=p;a.is_paused=function(){return!C};a.reset=function(){s.Bq();T=O=null;F=m=0;d=jb();c=jb();b=jb();C=!0;Z=null};a.canvas_data_url=jb()};b4w.animation=b4w.require("animation");b4w.assets=b4w.require("assets");b4w.camera=b4w.require("camera");b4w.config=b4w.require("config");b4w.controls=b4w.require("controls");b4w.constraints=b4w.require("constraints");b4w.data=b4w.require("data");b4w.debug=b4w.require("debug");b4w.lights=b4w.require("lights");
b4w.main=b4w.require("main");b4w.material=b4w.require("material");b4w.physics=b4w.require("physics");b4w.scenes=b4w.require("scenes");b4w.shaders=b4w.require("shaders");b4w.sfx=b4w.require("sfx");b4w.transform=b4w.require("transform");b4w.util=b4w.require("util");b4w.version=b4w.require("version");b4w.vec3=b4w.require("vec3");b4w.vec4=b4w.require("vec4");b4w.quat=b4w.require("quat");b4w.mat3=b4w.require("mat3");b4w.mat4=b4w.require("mat4");for(var $c in b4w.main)b4w[$c]=b4w.main[$c];
