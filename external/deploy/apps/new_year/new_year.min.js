b4w.register("new_year_language",function(s,c){var t="en",z={default_text:{ru:"\u0423\u0432\u0430\u0436\u0430\u0435\u043c\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438!\n\u041d\u0430 \u044d\u0442\u043e\u0442 \u041d\u043e\u0432\u044b\u0439 \u0433\u043e\u0434 \u043c\u044b \u043f\u0440\u0438\u0433\u043e\u0442\u043e\u0432\u0438\u043b\u0438 \u0434\u043b\u044f \u0432\u0430\u0441 \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u044b\u0439 \u043f\u043e\u0434\u0430\u0440\u043e\u043a.\n\u042d\u0442\u043e\u0439 \u0442\u0440\u0451\u0445\u043c\u0435\u0440\u043d\u043e\u0439 \u043e\u0442\u043a\u0440\u044b\u0442\u043a\u043e\u0439 \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u043e\u0437\u0434\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u0432\u043e\u0438\u0445 \u0431\u043b\u0438\u0437\u043a\u0438\u0445, \u0437\u043d\u0430\u043a\u043e\u043c\u044b\u0445 \u0438 \u043f\u0440\u043e\u0441\u0442\u043e \u0432\u0441\u0435\u0445 \u0442\u0435\u0445, \u043a\u0442\u043e \u043f\u043e\u0441\u0435\u0442\u0438\u0442 \u0432\u0430\u0448\u0443 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0432 \u0441\u043e\u0446\u0441\u0435\u0442\u0438 \u0438\u043b\u0438 \u0432 \u0431\u043b\u043e\u0433\u0435.\n\u0416\u0435\u043b\u0430\u0435\u043c \u0412\u0430\u043c \u043f\u0440\u043e\u0446\u0432\u0435\u0442\u0430\u043d\u0438\u044f \u0438 \u0431\u043b\u0430\u0433\u043e\u043f\u043e\u043b\u0443\u0447\u0438\u044f \u0432 2015 \u0433\u043e\u0434\u0443!",
en:"Dear users!\nFor this New Year's we have prepared a special gift for you.\nWith this 3D greeting card you can congratulate your family, friends and the visitors of your blog or social account.\nWe wish you happiness and prosperity in the coming 2015!"},title:{ru:"\u0421 \u041d\u043e\u0432\u044b\u043c \u0413\u043e\u0434\u043e\u043c! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u043f\u043e\u0434\u0430\u0440\u043a\u0438, \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0442\u0435\u043b\u0435\u0432\u0438\u0437\u043e\u0440, \u043e\u0442\u043f\u0440\u0430\u0432\u044c\u0442\u0435 \u0434\u0440\u0443\u0437\u044c\u044f\u043c \u0441\u0432\u043e\u0435 \u043f\u043e\u0437\u0434\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435!",
en:"Happy New Year! Try opening the presents, turn on the TV and even send a personal greeting!"}};s.set_language=function(c){t=c};s.get_language=function(){return t};s.get_translation=function(c){var q=z[c];return q?(q=q[t])?q:"[TRANSLATION FOR "+c+": NO SUCH LANGUAGE]":"[TRANSLATION FOR "+c+": NO SUCH KEY]"}});b4w.register("new_year_main",function(s,c){function t(a,d){d?(p.enable_controls(a),H.create_simple_preloader({bg_color:"#00000000",bar_color:"#FFF",background_container_id:"background_image_container",canvas_container_id:"canvas3d"}),w.detect_mobile()||a.addEventListener("mousedown",I),a.addEventListener("touchstart",I),window.onresize=J,J(),K=W?"../../external/deploy/assets/new_year/":"../../assets/new_year/",X.load(K+"christmas_tree.json",z,Y,!0)):console.log("b4w init failure")}function z(a){window.Ya?
new Ya.share({element:"yandex_icons",elementStyle:{type:"none",quickServices:"facebook twitter vkontakte odnoklassniki gplus moimir".split(" ")},onready:function(a){q();document.getElementById("send_button").onclick=function(){L();a.updateShareLink(window.location.href+" via Blend4Web",k.get_translation("title"))};a.updateShareLink(window.location.href+" via Blend4Web",k.get_translation("title"))}}):document.getElementById("send_button").onclick=function(){L()};document.getElementById("mail_to").onclick=
function(){this.href=onclick="mailto:yourfriends?subject="+k.get_translation("title")+"&body="+window.location.href.replace("&","%26")};p.enable_camera_controls();V();Z();u.enable_mouse_hover_glow()}function V(){var a=e.get_active_camera();A=l.get_eye(a);M=l.get_pivot(a);var d=new Float32Array(3);l.get_pivot(a,d);N=O.dist(d,A);B=l.get_angles(a);var a=e.get_object_by_name("letter"),d=e.get_object_by_dupli_name("letter","armature_letter"),n=e.get_object_by_dupli_name("gift","Armature.001");b.apply(a,
"letter_fly_group");b.apply(n,"cap_fly");b.apply(d,"letter_fly_fin");b.set_behavior(a,b.AB_FINISH_STOP);b.set_behavior(d,b.AB_FINISH_STOP);b.set_behavior(n,b.AB_FINISH_STOP);a=e.get_object_by_dupli_name("gift_monkey","Armature_gift_monkey");d=e.get_object_by_dupli_name("gift_monkey.001","Armature");b.apply(a,"cap_fly");b.set_behavior(a,b.AB_FINISH_STOP);b.set_frame(d,0);b.apply(d,"jump_B4W_BAKED");b.set_behavior(d,b.AB_FINISH_STOP);g.push(e.get_object_by_dupli_name("confetti","Cylinder"));g.push(e.get_object_by_dupli_name("confetti",
"Cylinder.001"));g.push(e.get_object_by_dupli_name("confetti","Cylinder.002"));g.push(e.get_object_by_dupli_name("confetti","Cylinder.003"));g.push(e.get_object_by_dupli_name("confetti","Cylinder.004"));g.push(e.get_object_by_dupli_name("confetti","Cylinder.005"));a=e.get_object_by_dupli_name("gift_5","Armature_gift_5");b.apply(a,"cap_fly");b.set_behavior(a,b.AB_FINISH_STOP);for(a=0;a<g.length;a++)b.apply(g[a],"ParticleSystem 3"),b.set_behavior(g[a],b.AB_FINISH_STOP);a=e.get_object_by_dupli_name("confetti_ribbons",
"ribbons_flom_above");d=e.get_object_by_dupli_name("confetti","ribbons_from_below");b.apply(a,"Shader NodetreeAction.004");b.set_behavior(a,b.AB_FINISH_STOP);b.apply(d,"Shader NodetreeAction");b.set_behavior(d,b.AB_FINISH_STOP);a=e.get_object_by_dupli_name("bear","bear");b.apply(a,"bear_wiggle");b.set_behavior(a,b.AB_FINISH_STOP);b.set_frame(a,0);a=document.getElementById("simple_preloader_container");document.body.removeChild(a);(a=p.get_url_params())&&a.lang&&"ru"==a.lang?(k.set_language(a.lang),
document.body.className="lang_ru"):document.body.className="lang_en";a=a&&a.text?a.text:null;P();$(a)}function q(){var a=p.get_url_params();a&&a.lang&&"ru"==a.lang&&k.set_language(a.lang)}function P(){var a=m.get_canvas_texture_context("my_letter");a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.globalAlpha=.95,a.globalAlpha=1,a.font="44px congratulatory_font, 'URW Chancery L', cursive",a.fillStyle="#ffffff",m.update_canvas_texture_context("my_letter"))}function $(a){var d=document.getElementById("text_element");
d.oninput=function(){300<d.value.length&&(d.value=d.value.substr(0,300))};var b=m.get_canvas_texture_context("my_letter");d.value=a?aa(a):k.get_translation("default_text");a=Q(d.value,b);R(a)}function ba(){var a=document.getElementById("container"),d=document.getElementById("open_button"),n=document.getElementById("close_button"),f=document.getElementById("text_container"),x=document.getElementById("icons");x.style.visibility="visible";d.addEventListener("click",function(){f.style.visibility="visible";
n.style.visibility="hidden";d.style.visibility="hidden";P();var a=document.getElementById("open_button"),b=document.getElementById("text_element"),e=document.getElementById("text_container");b.disabled=!1;a.style.visibility="hidden";e.style.visibility="visible"},!1);n.addEventListener("click",function(){C=!1;u.enable_mouse_hover_glow();a.style.visibility="hidden";f.style.visibility="hidden";x.style.visibility="hidden";var d=e.get_object_by_name("letter"),n=e.get_object_by_dupli_name("letter","armature_letter"),
c=e.get_object_by_dupli_name("gift","Armature.001");b.set_speed(d,-2);b.set_speed(c,-2);b.set_speed(n,-2);b.play(d);b.play(c);b.play(n);p.enable_camera_controls()},!1);a.style.visibility="visible"}function L(){var a=document.getElementById("text_element"),d=document.getElementById("text_container"),b=document.getElementById("open_button"),f=document.getElementById("close_button"),a=a.value,e=m.get_canvas_texture_context("my_letter"),e=Q(a,e);R(e);d.style.visibility="hidden";b.style.visibility="inherit";
f.style.visibility="inherit";for(var f="",e=300<a.length?300:a.length,c=0;c<e;c++){for(var d=a[c].charCodeAt(0).toString(16),b=4-d.length,g=0;g<b;g++)d="0"+d;f+=d}a=f;window.history.pushState("","","?lang="+k.get_language()+"&text="+a)}function J(){var a=window.innerWidth,d=window.innerHeight;w.resize(a,d);document.getElementById("text_element").style.fontSize=(.025*d).toString()+"px";var b=document.getElementsByTagName("html")[0];b.style.height=d.toString()+"px";b.style.width=a.toString()+"px";a=
document.getElementById("container");a.style.width=(.5*d).toString()+"px";a.style.height=(.6*d).toString()+"px";a.style.top=(.03*d).toString()+"px"}function Q(a,b){for(var e=a.split(""),f="",c="",g=[],h=0;h<e.length;h++){if(300<=h){c+="...";break}"\n"==e[h]?(f+=c,g.push(f),c=f=""):-1<" ,.-+!?".indexOf(e[h])?(515<b.measureText(f+c).width&&(g.push(f),f=""),f+=c,c="",f+=e[h]):(c+=e[h],515<b.measureText(c).width&&(f+=c,g.push(f),f=c=""))}g.push(f+c);12<g.length&&(g.length=12,g.push("..."));return g}function R(a){if(a){for(var b=
m.get_canvas_texture_context("my_letter"),e=b.font.split("px"),e=parseInt(e[0]),f=0;f<a.length;f++)b.fillText(a[f],235,Math.round(1.25*e*f+185));m.update_canvas_texture_context("my_letter")}}function aa(a){for(var b="",e="",f=0;f<a.length;f+=4)b+=a[f]+a[f+1]+a[f+2]+a[f+3],e+=String.fromCharCode(parseInt(b,16)),b="";return e}function I(a){if(!C){a.preventDefault&&a.preventDefault();var d=u.get_coords_x(a);a=u.get_coords_y(a);if(d=e.pick_object(d,a))switch(e.get_object_name(d)){case "gift*box":d=e.get_object_by_name("letter");
a=e.get_object_by_dupli_name("letter","armature_letter");var c=e.get_object_by_dupli_name("gift","Armature.001"),f=e.get_object_by_dupli_name("gift","letter");h.speaker_stop(f);h.speaker_play(f);C=!0;u.disable_mouse_hover_glow();S=w.global_timeline();var f=e.get_active_camera(),x=l.get_pivot(f,ca),k=l.get_eye(f,da);T=O.dist(x,k);l.get_angles(f,r);r[0]>Math.PI&&(r[0]-=2*Math.PI);p.disable_camera_controls();b.set_speed(d,1);b.set_speed(c,1);b.set_speed(a,1);b.play(d,ba);b.play(c);b.play(a);break;case "gift_5*box_5":c=
e.get_object_by_dupli_name("gift_5","Armature_gift_5");d=e.get_object_by_dupli_name("confetti","ribbons_from_below");a=e.get_object_by_dupli_name("confetti_ribbons","ribbons_flom_above");f=e.get_object_by_dupli_name("gift_5","fireworks");h.speaker_stop(f);if(D){b.set_speed(c,-2);b.play(c);for(c=0;c<g.length;c++)b.stop(g[c]),b.set_frame(g[c],0);b.stop(d);b.set_frame(d,0);b.stop(a);b.set_frame(a,0)}else for(b.set_speed(c,1),b.play(c),b.play(d,ea),h.speaker_play(f),c=0;c<g.length;c++)b.play(g[c]);D=
!D;break;case "gift_monkey*box_6":d=e.get_object_by_dupli_name("gift_monkey","Armature_gift_monkey");a=e.get_object_by_dupli_name("gift_monkey.001","Armature");c=e.get_object_by_dupli_name("gift_monkey","monkey");h.speaker_stop(c);h.speaker_play(c);E?(b.set_speed(d,-1.7),b.play(d),b.set_speed(a,-3)):(b.set_speed(d,1),b.play(d),b.set_speed(a,1));b.play(a);E=!E;break;case "TV*tv":e.get_object_by_name("lamp");d=e.get_object_by_dupli_name("TV","speaker");F?(m.stop_video("Texture"),m.reset_video("Texture"),
h.speaker_stop(d)):(m.play_video("Texture"),h.speaker_play(d));F=!F;break;case "bear*bear":d=e.get_object_by_dupli_name("bear","bear"),a=e.get_object_by_dupli_name("bear","spk_bear"),h.speaker_stop(a),h.speaker_play(a),G?b.set_speed(d,-1):b.set_speed(d,1),b.play(d),G=!G}}}function ea(){var a=e.get_object_by_dupli_name("confetti_ribbons","ribbons_flom_above");b.play(a)}function Z(){var a=e.get_active_camera(),b=v.create_timeline_sensor(),c=v.create_elapsed_sensor();v.create_sensor_manifold(a,"CAMERA_MOVE",
v.CT_CONTINUOUS,[b,c],function(a){return a[0]-S<y},function(a,b,c){if(0<c){b=v.get_sensor_value(a,b,1);c=b/y*(B[0]-r[0]);var d=b/y*(B[1]-r[1]);fa.move_local(a,0,b/y*(N-T),0);l.rotate_pivot(a,c,d)}else l.set_look_at(a,A,M,ga.AXIS_Y)})}function Y(a){H.update_preloader(a)}var m=c("textures"),X=c("data"),p=c("app"),w=c("main"),ha=c("version"),e=c("scenes"),b=c("animation"),l=c("camera"),O=c("vec3"),v=c("controls"),fa=c("transform"),ga=c("util"),h=c("sfx"),u=c("mouse");c("lights");var H=c("preloader"),
k=c("new_year_language"),U=c("config"),K,W="DEBUG"===ha.type(),A,T,M,N,B,ca,da=new Float32Array(3),r=new Float32Array(2),S=0,y=25/24,g=[],D=!1,E=!1,G=!1,F=!1,C=!1;s.init=function(){w.detect_mobile()&&U.set("quality",U.P_LOW);p.init({canvas_container_id:"canvas3d",callback:t,pause_invisible:!1,physics_enabled:!1,key_pause_enabled:!1})}});b4w.require("new_year_main").init();
