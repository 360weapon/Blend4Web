.. _problems_and_solutions:

******************
Проблемы и решения
******************

.. _webgl_not_working:

Инициализация WebGL
===================

Сайт http://get.webgl.org/ при просмотре в браузерах Chrome или Firefox последней версии сообщает о проблемах. Что делать? 

**На Windows**:

1. Установить доступные `обновления <http://support.microsoft.com/kb/311047/ru>`_ для системы. Установить последнюю версию `DirectX <http://www.microsoft.com/downloads/ru-ru/details.aspx?FamilyID=2da43d38-db71-4c1b-bc6a-9b6652cd92a3&displayLang=ru>`_. Перезагрузить систему.

2. В некоторых случаях может понадобиться установка драйверов от производителей графических карт. Чтобы определить тип и производителя карты, можно воспользоваться средством диагностики DirectX...

.. image:: src_images/dxdiag.jpg
   :alt: Определение типа и производителя графического процессора с помощью средства диагностики DirectX
   :align: center
   :width: 100%

или ввести about:gpu в адресную строку браузера Chrome.

.. image:: src_images/about_gpu_directx.jpg
   :alt: Определение типа и производителя графического процессора с помощью средства диагностики браузера Chrome
   :align: center
   :width: 100%

Необходимо загрузить драйверы с соответствующего центра поддержки (например, `Intel <http://downloadcenter.intel.com/Default.aspx?lang=rus>`_, `Nvidia <http://www.nvidia.com/Download/index.aspx?lang=ru>`_, `AMD/ATI <http://support.amd.com/us/gpudownload/Pages/index.aspx>`_). После установки драйверов перезагрузить систему.

3. Если в результате вышеперечисленных действий инициализировать рендеринг не удается (или нет возможности обновить систему), можно попробовать изменить настройки браузера. 

*В Chrome*:

Ввести about:flags в адресную строку браузера, нажать :file:`Включить` (:file:`Enable`) под опцией :file:`Переопределение списка программного рендеринга` (:file:`Override software rendering list`) и перезапустить браузер.

.. image:: src_images/about_flags_force_webgl.jpg
   :alt: Форсирование использования WebGL в Chrome
   :align: center
   :width: 100%


*В Firefox*: 

Ввести about:config в адресную строку браузера, найти параметр ``webgl.force-enabled`` и переключить его двойным щелчком мыши из ``false`` в ``true``. 

.. image:: src_images/about_config_force_webgl.jpg
   :alt: Форсирование использования WebGL в Firefox
   :align: center
   :width: 100%

**На Linux**:

1. Ввиду неполной реализации OpenGL стека в драйверах с открытым кодом в настоящий момент рекомендуется использовать проприетарные драйверы текущей версии для графических процессоров Nvidia и AMD. 

2. Форсирование графической акселерации из п. 3 для Windows происходит аналогично для Chrome. В случае Firefox предлагается использовать переменную окружения::

    > MOZ_GLX_IGNORE_BLACKLIST=1 firefox


.. _browser_for_local_loading:

Настройка браузера для загрузки локальных ресурсов
==================================================

Движок является Web-приложением, и его работа происходит при просмотре html-файла в браузере. После инициализации происходит загрузка ресурсов (сцен, текстур), которая подчиняется `правилу ограничения домена <http://ru.wikipedia.org/wiki/Правило_ограничения_домена>`_, запрещающему, в частности, загрузку из локальной директории. Простым способом обхода этого ограничения может быть настройка браузера (рекомендуется). Другой способ заключается в использовании :ref:`локального web-сервера <local_web_server>`.

.. note::
    Рекомендуется использовать такой браузер только для просмотра локального контента, поскольку изменение настроек может привести к понижению безопасности.

*Chrome на Windows*:

Правой кнопкой мыши нажать на ярлыке на рабочем столе, выбрать ``Свойства`` (``Properties``), после чего в поле для пути к исполняемому файлу добавить после пробела ``--allow-file-access-from-files``. Нажать ``ОК``.

.. image:: src_images/chrome_file_access.jpg
   :alt: Настройка Chrome для загрузки локальных ресурсов
   :align: center
   :width: 100%


Для удобства можно предварительно создать копию ярлыка и изменить ее для локального просмотра, оставив оригинальную версию ярлыка для запуска браузера в обычном режиме.

*Chrome/Chromium на Linux*:

Запустить браузер с параметром::

    > google-chrome --allow-file-access-from-files
    

или::
    
    > chromium-browser --allow-file-access-from-files

*Firefox на Windows/Linux*:

Ввести about:config в адресную строку браузера, найти параметр ``security.fileuri.strict_origin_policy`` и переключить его двойным щелчком мыши из ``true`` в ``false``. 

.. image:: src_images/firefox_strict_origin.jpg
   :alt: Настройка Firefox для загрузки локальных ресурсов
   :align: center
   :width: 100%

.. _local_web_server:

Использование локального web-сервера
====================================

Простым вариантом может быть запуск web-сервера из стандартной библиотеки `Python <http://ru.wikipedia.org/wiki/Python>`_.

*На Windows*:

1. Загрузить и инсталлировать последнюю версию Python с `официального сайта <http://www.python.org/download/releases/>`_. На сегодняшний день это версия 3.2, и по умолчанию установка произойдет в директорию :file:`Python32` на диске :file:`C`.

2. Запустить командную строку (Command Prompt).

3. Выполнить команды::

    > c:
    > /Python32/python -m http.server

4. Перейти на страницу http://localhost:8000, на которой выбрать нужный файл для отображения.

*На Linux*::

    > python -m SimpleHTTPServer


или::


    > python3 -m http.server

Можно указать порт дополнительным параметром::

    > python -m SimpleHTTPServer 8080




.. _renderer_not_working:


Проблемы при запуске рендерера
==============================

*1. Появляется сообщение "browser not supported".*

Браузер не поддерживается.

*2. Появляется сообщение "underlying error".*

Следует выполнить действия, описанные в разделе :ref:`webgl_not_working`. 

*3. Видны элементы интерфейса и фон, но не виден куб или он отображается не корректно. При этом тестовый сайт http://get.webgl.org/ и другие примеры работают корректно.*

Вероятные причины: 

* Браузер не настроен или не правильно настроен для работы с локальными ресурсами. :ref:`browser_for_local_loading`.

* Файлы ресурсов, которые пытается загрузить рендерер, были перемещены или удалены.

* На Linux при использовании графических процессоров Intel, а также Nvidia и AMD с открытыми драйверами, это может происходить по причине использования рендерером возможностей (стандартных), в настоящий момент не реализованных в Mesa (таких как uniform массивы в шейдерах).

