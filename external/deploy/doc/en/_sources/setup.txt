.. _setup:

******************************
Развёртывание среды разработки
******************************

Следующий вариант установки подойдет для разработчиков 3D приложений. 
Если же нужно простое ознакомление с аддоном Blend4Web, то, возможно, будет удобнее :ref:`экспресс-установка <quick_install>`.

Для работы необходим дистрибутив движка, браузер (настроенный для локального
просмотра) и Blender (с установленным аддоном).

.. _getting_started_distribution:

Установка дистрибутива
======================

Стабильные версии дистрибутива поставляются в виде архива
(``blend4web_sdk_free.zip`` -- бесплатный SDK, ``blend4web_sdk_pro.zip`` --
коммерческий SDK). Для установки достаточно распаковать данный архив в любое
место на диске.

В дистрибутиве находятся исходный код движка, компактная версия для приложений,
скрипты к Blender'у, исходные blend-файлы группы разработки, экспортированные
сцены, текстуры и звуковые файлы (см. подробную :ref:`структуру репозитория
<repo_file_structure>`).

.. index:: браузер; настройка

.. _getting_started_browser:

Выбор браузера
==============

Для работы движка требуется :ref:`браузер с поддержкой WebGL <browser_webgl_support>`. Для проверки можно перейти на страницу http://get.webgl.org/. Должна
появиться надпись зеленого цвета и вращающийся куб:

.. image:: src_images/browser_supports_webgl.jpg
   :alt: Страница тестового сайта при успешной инициализации WebGL
   :align: center
   :width: 100%

|


.. _browser_for_local_loading:

Настройка браузера для загрузки локальных ресурсов
==================================================

Рендерер движка является Web-приложением, и его работа происходит при просмотре HTML-файла в браузере. После инициализации происходит загрузка ресурсов (сцен, текстур), которая подчиняется `правилу ограничения домена <http://ru.wikipedia.org/wiki/Правило_ограничения_домена>`_, запрещающему, в частности, загрузку из локальной директории. Простым способом обхода этого ограничения может быть настройка браузера (рекомендуется). Другой способ заключается в использовании :ref:`локального web-сервера <local_web_server>`.

.. note::
    Рекомендуется использовать такой браузер только для просмотра локального контента, поскольку изменение настроек может привести к понижению безопасности.

|

*Chrome на Windows*:

Правой кнопкой мыши нажать на ярлыке на рабочем столе, выбрать ``Свойства`` (``Properties``), после чего в поле для пути к исполняемому файлу добавить после пробела ``--allow-file-access-from-files``. Нажать ``ОК``.

|

.. image:: src_images/chrome_file_access.jpg
   :alt: Настройка Chrome для загрузки локальных ресурсов
   :align: center
   :width: 100%

|

Для удобства можно предварительно создать копию ярлыка и изменить ее для локального просмотра, оставив оригинальную версию ярлыка для запуска браузера в обычном режиме.

|

*Chrome на OS X*:

Открыть Терминал и запустить браузер с параметром::

    > /Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --allow-file-access-from-files

|

*Chrome/Chromium на Linux*:

Запустить браузер с параметром::

    > google-chrome --allow-file-access-from-files
    

или::
    
    > chromium-browser --allow-file-access-from-files

|

*Firefox на Windows/Linux/OS X*:

Ввести **about:config** в адресную строку браузера, найти параметр ``security.fileuri.strict_origin_policy`` и переключить его двойным щелчком мыши из ``true`` в ``false``. 

|

.. image:: src_images/firefox_strict_origin.jpg
   :alt: Настройка Firefox для загрузки локальных ресурсов
   :align: center
   :width: 100%

|

*Safari/OS X*:

Включить в настройках отображение меню "Develop", затем активировать опцию "Disable Local File Restrictions".

.. image:: src_images/safari_setup.png
   :alt: Настройка Safari для загрузки локальных ресурсов
   :align: center
   :width: 100%

|


.. index:: просмотрщик; запуск

.. _getting_started_launching_viewer:

Запуск просмотрщика сцен
========================

Откройте файл :file:`apps_dev/viewer/viewer_dev.html` в настроенном браузере. Должна отобразиться страница с окном рендерера и элементами интерфейса.

.. image:: src_images/engine_screens/default_page.jpg
   :alt: Первый запуск рендерера
   :align: center
   :width: 100%

|

.. note::

   Если страница не отображается корректно, или появляются сообщения об ошибках, необходимо предпринять действия, описанные в разделе :ref:`renderer_not_working`.


.. index:: Blender; установка

.. _getting_started_addon:

Установка аддона движка
=======================

.. note::

   Если аддон ранее был установлен с помощью :ref:`экспресс-установки <quick_install>`, то рекомендуется прежде его удалить.

Запустить Blender, загрузить сцену по умолчанию :file:`File > New` (горячие клавиши :file:`Ctrl-N`).
Вызвать окно пользовательских настроек :file:`File > User Preferences...` (горячие клавиши :file:`Ctrl-Alt-U`). Во вкладке  :file:`File` в поле  :file:`Scripts` выбрать путь к директории :file:`blender_scripts`. 

.. image:: src_images/blender_screens/user_preferences_scripts_path.jpg
   :alt: Указание пути для скриптов в окне пользовательских настроек
   :align: center
   :width: 100%

Нажать :file:`Save User Settings` и перезапустить Blender.


.. note::

    Вместо этого можно скопировать директорию со скриптами :file:`blender_scripts/addons/blend4web` в уже используемую пользовательскую директорию для скриптов или даже в установочную директорию, например:

    :file:`C:\\Program Files\\Blender Foundation\\Blender\\2.70\\scripts\\addons\\blend4web`.


Повторно загрузить сцену по умолчанию, вызвать окно пользовательских настроек, перейти на вкладку :file:`Addons` и выбрать категорию :file:`Import-Export`. Отметить галочку напротив :file:`Import-Export: Blend4Web`. 

.. image:: src_images/blender_screens/user_preferences_enable_addon.jpg
   :alt: Инициализация скриптов в окне пользовательских настроек
   :align: center
   :width: 100%

|

Нажать :file:`Save User Settings`. Перезапуск Blender не требуется.

*Для проверки:*

В меню :file:`File > Export` должны появиться опции :file:`Blend4Web (.json)` и :file:`Blend4Web (.html)`. Кроме того должны появиться операторы при выполнении поиска по "B4W" (горячая клавиша :file:`ПРОБЕЛ`).


Включение опции экспорта в HTML
-------------------------------

Опция :file:`Blend4Web (.html)` в меню :file:`File > Export` по умолчанию не активна, в отличие от версии одиночного аддона (см. :ref:`экспресс-установка <quick_install>`). 

В случае необходимости (например, если требуется отладка HTML экспорта) данную опцию можно включить. Для этого указать путь к сборке приложения ``embed``, входящего в состав дистрибутива, в поле :file:`Path to b4w source`. Стандартный путь относительно корня движка :file:`external/deploy/apps/embed`.


.. image:: src_images/blender_screens/user_preferences_enable_addon_HTML_option.jpg
   :alt: Включение опции экспорта в HTML
   :align: center
   :width: 100%




