.. _animation:

.. index:: анимация, animation

********
Анимация
********

В общем случае, к анимации относятся изменения параметров объектов во времени.
Движком поддерживаются следующие типы анимации:

* Перемещение объекта в пространстве как единого целого (объектная анимация).
  Изменяемые параметры: координаты центра (``Location``), кватернион поворота
  (``Rotation`` в режиме ``Quaternion(WXYZ)``) и масштабирование (``Scale``).

* Деформация объекта с помощью системы костей (скиннинг и скелетная анимация) а
  также анимация костей в арматурном объекте с целью прикрепления объектов к костям.

* Покадровая запись деформаций объекта с последующим воспроизведением
  (вертексная анимация).

* Параметризация параметров источников звука. Изменяемые параметры: громкость
  (``Volume``) и высота звука (``Pitch``).

* Процедурная анимация в виде колебаний объекта под действием ветра. Описано
  :ref:`отдельно <wind>`.

* Эмиссия частиц из источника. Описано в :ref:`соответствующем разделе <particles>`.

Управление анимацией
====================

Управление анимацией в движке осуществляется одним из трёх способов:

#. Автоматически, с помощью указания свойств ``Animation: Use default`` и
   ``Animation: Cyclic`` в свойствах объекта. В данном случае будет осуществлён
   поиск доступного метода и в случае положительного результата, объект
   анимируется с момента загрузки сцены.

#. Программно, используя функции модуля ``animation``.

#. Автоматически, с помощью редактирования файла ``assets.json``. В настройках
   загрузки сцены добавляется свойство ``animated_objects``, являющееся массивом
   имён объектов, либо пар ["имя объекта-дупликатора группы", "имя объекта
   внутри группы"]. Метод подходит только для приложений, использующих
   информацию из файла ``assets.json`` (в настоящий момент к ним относится
   просмоторщик сцен ``viewer``).

В случае анимации меша, необходимо назначение свойства ``Do not batch`` на
вкладке свойств объекта.

Объектная анимация
==================

Осуществляется с помощью добавления ключей анимации в программе Blender и
их последующего воспроизведения в движке.

Поддерживаются следующие типы ключей:

* *Location*

* *Rotation* -- необходимо осуществлять в режиме ``Quaternion(WXYZ)``.

* *Scale* -- для получения корректных результатов, фактор масштабирования должен быть одинаковым вдоль любых из осей.

* *LocRot* -- комбинация *Location* и *Rotation*.

* *LocScale* -- комбинация *Location* и *Scale*.

* *LocRotScale* -- комбинация *Location*, *Rotation* и *Scale*.

* *RotScale* -- комбинация *Rotation* и *Scale*.

Скиннинг и скелетная анимация
=============================

Для осуществленя скелетной анимации, кроме анимированного объекта-меша требуется
объект-арматура. Осуществляется в четыре этапа:

#. Создание скелета объекта в арматурном объекте.
#. Назначение вертексных групп в объекте-меше и их привязка к костям. Может быть осуществлено, например, методом ``weight painting``.
#. Анимация костей в арматурном объекте. Используются те же ключи, что и в случае 
   объектной анимации.
#. В случае нетривиальных видов скелетной анимации, включающих инверсную кинематику,
   требуется стадия запекания анимационных акторов (блок ``Action`` в Blender).
   Запекание производится с помощью интерфейса, вызываемого через пробел:
   ``B4W Animation Bake``.

Вертексная анимация
===================

Позволяет зафиксировать и воспроизвести любые манипуляции с геометрией
объекта-меша. С другой стороны, для этого требуется огромное количество
ресурсов (прежде всего возрастает объём загружаемых файлов и количество
используемой видео-памяти).

Для запекания вертексной анимации предусмотрен инструмент ``B4W Vertex Anim
Baker``, расположенный на панели инструментов ``Blend4Web``.

Параметризация источников звука
===============================

На объектах-спикерах дополнительно поддерживаются следующие типы анимационных
ключей:

* *Volume* -- громкость звука источника.

* *Pitch* -- высота звука источника.
