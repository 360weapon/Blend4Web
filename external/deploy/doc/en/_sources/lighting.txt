.. _lighting:

.. index:: освещение

****************
Освещение и тени
****************

.. index:: источники света

Освещение от источников света
=============================

На сцене может быть несколько (но не менее одного) источников света разного типа.


Типы источников света
---------------------

Поддерживаются источники света следующих типов:

*Point*
    Точечный. Свет распространяется из одной точки равномерно во все стороны, с постепенным затуханием.
    
*Sun*
    "Солнце". Свет распространяется из бесконечной плоскости прямолинейно в одном направлении, без затухания.

*Spot*
    Прожектор. Свет распространяется из одной точки, с ограничением угла распространения, с постепенным затуханием.

*Hemi*
    Полусфера. Свет распространяется из бесконечной полусферы, без затухания.


Настройка источников света
--------------------------

Производится во вкладке ``Object Data`` при выборе объекта-лампы.

.. image:: src_images/lighting/lighting_setup.jpg
   :alt: Настройка источников света
   :align: center
   :width: 100%

|

*Color*
    Цветовая характеристика света. Значение по умолчанию (1.0, 1.0, 1.0) (белый).
    
*Energy*
    Интенсивность излучения. Значение по умолчанию 1.0.

*Falloff*
    Тип затухания. Значение экспортируется, но в движке всегда используется ``Inverse Square`` (обратный квадратичный). Применяется для источников света типа ``Point`` и ``Spot``. Значение по умолчанию ``Inverse Square``. 
    
*Distance*
    Параметр затухания. Применяется для источников света типа ``Point`` и ``Spot``. Значение по умолчанию 25.0.

*Spot Shape > Size*
    Угол конуса в градусах. Применяется для источников света типа ``Spot``. Значение по умолчанию 45º.

*Spot Shape > Blend*
    Параметр смягчения края светового пятна. Применяется для источников света типа ``Spot``. Значение по умолчанию 0.15.

*Blend4Web > Do not export*
    Не экспортировать. По умолчанию отключено.

*Blend4Web > Generate shadows*
    Источник света используется для расчета падающих теней. Применяется в случае наличия нескольких источников света. По умолчанию отключено.
    
*Blend4Web > Dynamic intesity*
    Источник света используется для расчета изменения времени суток. Применяется для источников света типа "Солнце". По умолчанию отключено.


Освещение от окружающей среды
=============================

Движком используется простая полусферическая модель освещения, в которой задается цвет горизонта и цвет зенита.


Активация
---------

Включить опцию ``Environment Lighting`` во вкладке ``World``.

.. image:: src_images/lighting/lighting_environment.jpg
   :alt: Освещение от окружающей среды
   :align: center
   :width: 100%


Настройка
---------

*Environment Lighting > Energy* 
    Интенсивность освещения от окружающей среды. Значение по умолчанию 1.0.
    
*Environment Lighting > Environment Color* 
    Тип источника освещения, поддерживаются ``White`` и ``Sky Color``. При выборе ``White`` назначается белый цвет горизонта и белый цвет зенита. При выборе ``Sky Color`` цвет горизонта и цвет зенита задаются цветоподборщиками ``World > Horizon Color`` и ``World > Zenith Color``. Значение по умолчанию ``White``.
    
*World > Horizon Color* и *World > Zenith Color*
    Цвет горизонта и цвет зенита. При выборе цвета рекомендуется активировать опцию ``World > Blend Sky``.


Тени
====


Активация
---------

#. На объектах, **отбрасывающих** тени, включить опцию ``Blend4Web > Shadows: Cast`` во вкладке ``Object``.
#. На объектах, **получающих** тени, включить опцию ``Blend4Web > Shadows: Receive`` во вкладке ``Object``.
#. Убедиться, что включена опция ``Blend4Web > Render shadows`` во вкладке ``Scene``.


Настройка
---------

*Направление*
    В случае наличия нескольких источников света рекомендуется указать, какой именно источник света будет использоваться для расчета падающих теней, включив опцию ``Blend4Web > Generate shadows`` во вкладке ``Object Data`` при выборе объекта-лампы.

*Цвет*
    Цвет тени определяется настройками освещения от окружающей среды.

Во вкладке ``World`` на панели ``Blend4Web > Shadow Settings`` находятся дополнительные настройки:


Каскады
.......

Для обеспечения приемлемого качества теней и одновременно покрытия значительных пространств необходимо использовать несколько стадий генерации теней (каскадов). При этом вблизи наблюдателя располагается каскад с наилучшим качеством, вдали от наблюдателя — с наихудшим.

.. image:: src_images/lighting/shadow_cascades.jpg
   :alt: Тени
   :align: center
   :width: 100%

|
    
*CSM number*
    Количество каскадов теней. Поддерживается от 1 до 4 каскадов. Значение по умолчанию 3.

*CSM near*
    Ближняя граница отображения теней. Значение по умолчанию 0.1.

*CSM far*
    Дальняя граница отображения теней. Значение по умолчанию 100.0.

*CSM lambda*
    Фактор распределения границ между каскадами. Рассчитанные значения границ каскадов отображаются в просмотрщике во вкладке ``Shadows``. Значение по умолчанию 0.875.


Мягкие тени
...........

*Visibility falloff*
    Фактор экспонециального уменьшения видимости тени в зависимости от расстояния от точки отбрасывания до точки получения. Применяется для уменьшения видимости артефактов собственных теней (т.е. отбрасывания объектом тени на себя). Значение по умолчанию 3500.0.

*Blur depth size mult*
    Размер ядра сглаживания. Влияет на степень смягчения теней. Значение по умолчанию 1.0.

*Blur depth edge size*
    Разница между сэмплами (в текселях) при определении границ. Уменьшает ореол, исключая сглаживание границ. Значение по умолчанию 2.0.

*Blur depth diff threshold*
    Максимум разницы глубины при определении границ, умноженный на 1000. Уменьшает ореол, исключая сглаживание границ. Значение по умолчанию 0.1.




