.. _release_notes:

*******************
Замечания к релизам
*******************

.. index:: замечания к релизам

v14.10
======

Новый функционал
----------------

* *Новый веб-плеер*
    Новый минималистичный дизайн веб-плеера удачно сочетается с любыми трёхмерными
    сценами, имеет упрощённый интерфейс и встроенную подсказку по управлению.
    Веб-плеер работает на всём спектре оборудования, включая мобильные устройства.

* *Улучшение системы теней.*
    Добавлена возможность выбора некаскадной модели теней на основе одной
    оптимизированной карты теней. Такая модель проще в настройке и хорошо
    подходит для небольших сцен. Подробности в :ref:`документации <shadows>`.

* *Многочисленные улучшения в системе нелинейной анимации (NLA).*
    Появилась возможность создания сложной логики в инструменте NLA Script
    с помощью блоков ``Conditional Jump``, ``Register Store`` и ``Math
    Operation``, а также переменных, сохраняемых в регистрах.

    Возможность использования в NLA всех типов анимации, поддерживаемых движком,
    включая воспроизведение звуков, вертексную анимацию и эмиссию частиц.
    Анимацию различных типов теперь возможно проигрывать параллельно.

* *Поддержка биллбординга объектов*
    Объектам добавлены :ref:`опции <objects_billboarding_properties>`, позволяющие настроить биллбординг.

* *Поддержка режима "XYZ Euler" для анимации поворота.*
    Объектная и скелетная анимация теперь поддерживают режим ``XYZ Euler`` для анимации поворота.

* *Поддержка текстурных координат типа GENERATED.*

* *Добавлена поддержка загрузки ресурсов с удаленного сервера (Cross-origin resource sharing).*

* *Упрощен процесс экспорта сцен.*
    Ряд ошибок, возникающих при экспорте материала, теперь не блокирует экспорт.
    Вместо этого при загрузке сцены данный материал будет
    отображаться розовым цветом. Более подробное описание ошибок доступно в
    :ref:`документации <export_errors_warnings>`.

* *Добавлена поддержка опции "Do not export" для системы частиц.*

* *Улучшена стабильность работы приложений на устройствах с мобильной
  операционной системой Apple iOS*


Изменения
---------

* *В SDK изменился путь для настройки экспорта в HTML.*
    В настройках аддона, установленного через SDK, теперь достаточно указывать
    путь непосредственно к корневой директории SDK. Ранее требовалось указывать
    путь к приложению embed. Обратите внимание, старое поведение более не
    поддерживается.

* *Объявлена устаревшей опция текстур "UV translation velocity".*
    Опция будет удалена начиная с версии 14.11.

* *Удалена опция "Do not export" на панели "Object data".*

* *Опция Blend4Web>Animation>Cyclic на вкладке свойств объектов удалена.*
    Вместо неё следует использовать опцию ``Blend4Web > Animation >
    Behavior``, расположенную там же. В сценах, где циклическая анимация
    назначается по умолчанию, возможно нарушение работы анимации, соответственно
    в них необходимо установить поведение в ``Cyclic``.

* *Изменена реализация алгоритма SSAO*
    Новая реализация работает значительно быстрее и показывает лучшее качество изображения.
    Параметры настройки алгоритма также изменились. Подробнее в :ref:`документации <ssao>`.

Исправления
-----------

* *Исправлена ошибка рендеринга материала типа HALO.*

* *Исправлена ошибка рендеринга объекта при выставлении опции "Do not batch", если он имел родительский объект.*

* *Исправлена ошибка назначения горячих клавиш на экспорт аддона Blend4Web.*
    Устранена ошибка, не позволяющая назначить горячие клавиши на экспорт в форматы JSON и HTML:
    ``File->Export->Blend4Web(.json)`` и ``File->Export->Blend4Web(.html)``.

* *Исправлена ошибка загрузки текстур, превышающих допустимый размер для данного устройства.*

* *Исправлены ошибки анимации нодовых материалов, приводившие к нестабильной работе движка.*

* *Устранена ошибка нодовых материалов, содержащих сложные группы нод (Node
  Groups)*

* *Исправлены ошибки компиляции шейдеров на устройствах с мобильной графикой
  Qualcomm Adreno 305*
* *Исправлена ошибка рендеринга при использовании ноды REFRACTION на непрозрачных материалах.*

* *Исправлен сброс значения текущего кадра анимации после её запечения при
  помощи инструмента "B4W Vertex Anim Baker".*

Известные проблемы
------------------

* *Проблемы с обновлением аддона в Blender*
    Настоятельно не рекомендуется устанавливать новую версию аддона Blender, не удалив предварительно старую версию, особенно это касается систем Windows.

v14.09
======

Новый функционал
----------------

* *Поддержка типа ABSOLUTE для ноды MATH.*

* *Поддержка специализированной ноды LEVELS_OF_QUALITY.*
    Позволяет управлять сложностью материала в зависимости от профиля качества,
    указанного пользователем при загрузке движка.

* *Поддержка специализированной ноды SMOOTHSTEP.*
    Упрощает создание некоторых эффектов в нодовом материале.

* *Поддержка нодовых групп.*
    `Нодовые группы <http://wiki.blender.org/index.php/Doc:2.6/Manual/Composite_Nodes/Node_Groups>`_ позволяют повторное использования блока нод одного материала в составе другого.

* *Возможность вывода промежуточных результатов рендеринга с целью отладки.*
    Результат рендеринга конкретной стадии теперь можно вывести поверх основного изображения. Настройка осуществляется в модуле ``config.js`` опциями группы ``debug_subs``.

* *Реализация логики управления NLA-анимацией в Blender с помощью визуального редактора.*
    В интерфейс Blender добавлен инструмент NLA Script, который позволяет с
    помощью визуальных блоков реализовывать простые сценарии, например
    осуществить управление текущей анимацией в ответ на действия пользователя.

* *Многочисленные улучшения системы сенсоров.*
    В модуле ``controls`` разрешено регистрировать *множества сенсоров*
    глобально, без привязки к конкретному объекту, для чего в соответствующие
    API необходимо подавать параметр ``null``. Обеспечена более предсказуемая и
    надёжная обработка логики сенсоров, в соответствии с последовательностью
    создания их *множеств*. Обработчики событий, связанных с действиями
    пользователя теперь назначаются с помощью функций вида
    ``register_<inputtype>_events()``. В данные функции теперь можно подавать
    флаг ``prevent_default``, позволяющий заблокировать стандартное поведение
    браузера, происходящее после возникновения соответствующих событий.

* *Поддержка использования физики в веб-плеере.*
    Работает только в версии веб-плеера с раздельной загрузкой JSON-файлов. В
    одиночных HTML файлах физика не поддерживается.

* *Поддержка смешивания различных скелетных анимаций.*
    В модуле ``animation.js`` добавились API, позволяющие осуществлять плавные
    переходы между скелетными анимациями: get_skel_mix_factor() - для получения
    текущего значения коэффициента смешинвания и set_skel_mix_factor() - для его
    назначения.

* *Поддержка анимации ноды Value в нодовых материалах.*
    Функциональность работает аналогично другим видам анимации. Поддерживается работа в NLA.

* *Поддержка параметров Specular и Diffuse в источниках освещения.*

* *Возможность рендеринга полупрозрачного объекта поверх остальных объектов на сцене.*
    Активируется с помощью опции ``Render above all`` для прозрачных материалов (т.е. не ``Opaque``).

* *Автоматическое применение масштаба к мешу объекта.*
    Реализуется включением опции ``Apply scale`` в настройках объекта.

* *Поддержка профиля высокого качества (включая тени, динамическое отражение и антиалиасинг) для iOS.*


Изменения
---------

* *Улучшение рендеринга теней.*
    Существенно изменена система отрисовки теней, которая теперь основывается на технике ``Stable Cascaded Shadow Maps``. Техника позволяет существенно уменьшить мерцание краев теней при движении камеры. Между каскадами реализовано сглаживание. Также тени последнего каскада плавно исчезают при удалении. Для рендеринга мягких теней реализована техника ``Percentage Closer Shadows``. Переработана и упрощена система пользовательских настроек теней. Теперь можно задавать размеры карт теней, степень размытия, настройки для компенсации ошибок самозатенения. Новые настройки подробно :ref:`документированы <shadows>`.

* *Настройка качества графики в веб-плеере теперь сохраняется для каждой сцены независимо.*

* *Изменено поведение настроек конфигурации приложения: physics_uranium_path, smaa_search_texture_path и smaa_area_texture_path.*
    Данные настройки конфигурации теперь рассчитываются автоматически в зависимости от местоположения запускаемого HTML-файла, если они не были переопределены при инициализации приложения.

* *Завершён переход на систему модулей, подключаемых через вызов b4w.require().*
    Это также означает, что начиная с текущей версии в релиз-версии движка
    модули нельзя вызывать с помощью устаревшего интерфейса ``b4w.<module>``.
    С целью совместимости создан аддон ``ns_compat.js``, подключение которого
    позволяет восстановить старое поведение.

* *Добавлена возможность сокрытия панели управления в веб-плеере.*

* *Скелетная анимация применяется только к объекту арматуры.*
    Нет необходимости применять скелетную анимацию к объектам типа ``MESH``.
    Eсли они привязаны к какой-либо анимированной арматуре, скиннинг будет происходить автоматически.

* *Демонстрационные приложения и обучающие материалы приведены в соответствие с новым функционалом.*

Исправления
-----------

* *Индикатор загрузки не скрывался, если в процессе происходила ошибка загрузки ресурса (текстуры либо звукового файла).*

* *Исправлены лаги при масштабировании и повороте на touch-устройствах.*

* *Устранено дрожание камеры типа TARGET при небольших поворотах.*

* *Исправлено управление камерой типа EYE на мобильных устройствах.*

* *Улучшено управление в приложении Ферма в браузере Safari.*

* *Исправлены ошибки при использовании неподдерживаемых моделей освещения на нодовых материалах.*

* *Для объектов без материалов теперь работает опция "Selectable".*

* *Более нет необходимости включать "Do not batch" для объектов, анимирующихся с использованием NLA.*

* *Исправлена ошибка для систем частиц, в которых дуплицируемый объект входит в иерархию с другими объектами.*

Известные проблемы
------------------

* *Проблемы с обновлением аддона в Blender*
    Настоятельно не рекомендуется устанавливать новую версию аддона Blender, не удалив предварительно старую версию, особенно это касается систем Windows.

* *Смешивание скелетной анимации не работает в некоторых браузерах*
    Если при использовании API смешивания скелетной анимации возникают необработанные ошибки, следует переопределить стандартную функцию Math.sign следующим образом:

    .. code-block:: javascript

        var m_util  = require("util");
        Math.sign = m_util.sign;

