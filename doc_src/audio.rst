.. _audio:

*******************
Звуковая подсистема
*******************

Создание звуковых источников осуществляется в Blender'e. Используется стандартный объект ``Speaker``.

.. image:: src_images/audio/speaker.jpg
   :align: center
   :width: 100%

|

Настройка звуковых источников
=============================

Настройки спикера выставляются в панели ``Properties`` на вкладке ``Object Data``.

Движком поддерживаются все стандартные параметры. Специфичные для движка настройки располагаются на панели ``Blend4Web``.

*Speaker behavior*
    Поведение звукового источника.

    ``Positional`` --- высококачественный звук, допускающий позиционирование и
    имеющий направленность (конусность). Для рендеринга используется Web Audio
    API. Воспроизведение подобных звуков обладает наименьшей производительностью,
    поэтому их использовать целесообразно только для коротких сэмплов.

    ``Background sound`` --- высококачественный всенаправленный звук без возможности
    позиционирования в пространстве. Для рендеринга используется Web Audio API.
    Более производителен, однако нецелесообразен для музыки.

    ``Background music`` --- используется для воспроизведения музыки. Максимальная
    производительность вследствие использования тега Audio, минимальная гибкость.

*Disable doppler*
    Игнорировать смещение частоты источника при его перемещении.

*Cyclic play*
    Зацикливать воспроизведение звука.

*Delay*
    Задержка в секундах перед началом проигрывания звука.

*Random delay*
    Дополнительная рандомизация задержки, результирующее значение определяется
    по формуле :math:`Delay_{result} = Delay + Delay_{random} * Random_{[0-1]}`.

*Random volume*
    Дополнительная рандомизация громкости. Результирующее значение определяется
    аналогично задержке.

*Random pitch*
    Дополнительная рандомизация скорости проигрывания звука. Результирующее значение определяется
    аналогично задержке.

*Fade-in*
    Интервал плавного включения звука.

*Fade-out*
    Интервал плавного выключения звука.

*Loop*
    Зацикливать воспроизведение звука. Отличается от ``Cyclic play``,
    тем, что способен обеспечить нулевую задержку при повторении. Опция доступна
    только для звуковых источников с поведением ``Positional`` или ``Background
    sound``.

*Loop count*
    Не реализовано

*Random loop count*
    Не реализовано

*Playlist ID*
    Не реализовано


.. image:: src_images/audio/speaker_settings.jpg
   :align: center
   :width: 100%

|

.. _encoding:

Обработка и кодирование
=======================

Поддерживаемые форматы (контейнеры):
------------------------------------

* ogg, кодек Vorbis (Chrome, Firefox)
* mp3 (Chrome, Safari)
* mp4, кодек AAC (Chrome, Safari)

Рекомендуется использовать **ogg**, который является открытым стандартом, поддерживается многими браузерами, обеспечивает хорошее качество звука. Оптимальным с точки зрения качества и
совместимости является формат 48кГц/16бит. Одноканальный звук (моно) используется
для хранения коротких сэмплов, двухканальный звук (стерео) - для музыкального
сопровождения.

В состав дистрибутива включен Python скрипт (scripts/converter.py) для конвертации исходных файлов в другие форматы с целью
расширения спектра поддерживаемых платформ. Для конвертации необходимо выполнить
команду:

.. code-block:: bash

    > ./converter.py convert_sounds

Преобразование происходит по схеме:

* ogg -> mp4
* mp3 -> ogg
* mp4 -> ogg

Конвертация ресурсов происходит с потерей качества, поэтому сконвертированные
файлы получают суффикс .lossconv.


